[
    {
        "content": "<p>Hi, for today's AoC I tried creating the following small function</p>\n<div class=\"codehilite\"><pre><span></span><code>parse_direction : Str -&gt; Try(I64, [RotationIsNotLR, BadNumStr])\nparse_direction = |string| {\n    if string.starts_with(&quot;L&quot;) {\n        parse_attempt = string.drop_prefix(&quot;L&quot;) -&gt; I64.from_str\n        l_result = map_ok(parse_attempt, |n| n*-1)?\n        Ok(l_result)\n    } else if string.starts_with(&quot;R&quot;) {\n        parse_attempt = string.drop_prefix(&quot;R&quot;) -&gt; I64.from_str\n        r_result = parse_attempt?\n        Ok(r_result)\n    } else {\n        Err(RotationIsNotLR)\n    }\n}\n</code></pre></div>\n<p>which looks like it should simply propagate the parse errors up to the error set and then keep moving forward. However the compiler actually gives me the following type error:</p>\n<div class=\"codehilite\"><pre><span></span><code>-- TYPE MISMATCH ---------------------------------\n\nThis expression is used in an unexpected way:\n     ┌─ aoc_2025_01.roc:4479:20\n     │\n4479 │         l_result = map_ok(parse_attempt, |n| n*-1)?\n     │                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n\nIt has the type:\n    [Err([BadNumStr])][Ok(I64)]\n\nBut I expected it to be:\n    Try(I64, [BadNumStr, RotationIsNotLR])\n</code></pre></div>\n<p>So it seems like ? is having trouble correctly converting the original error to the expanded error set. If resolving this isn't too crazy I can also take a crack at the issue tomorrow.</p>",
        "id": 561312276,
        "sender_full_name": "Edwin Santos",
        "timestamp": 1764641857
    },
    {
        "content": "<p>I can take a look at it tonight, thanks for the reproduction!</p>",
        "id": 561312853,
        "sender_full_name": "Richard Feldman",
        "timestamp": 1764642251
    },
    {
        "content": "<p>Yup, also uses map_ok (I'll put a PR up once I've finished up snapshot tests):</p>\n<div class=\"codehilite\"><pre><span></span><code>        map_ok : Try(a, err), (a -&gt; b) -&gt; Try(b, err)\n        map_ok = |try, fn| {\n            match try {\n            Ok(ok_val) =&gt; Ok(fn(ok_val))\n            Err(e) =&gt; Err(e)\n            }\n        }\n</code></pre></div>",
        "id": 561314263,
        "sender_full_name": "Edwin Santos",
        "timestamp": 1764643362
    }
]