[
    {
        "content": "<p>I’ve got another panic with long stdin input. Using the same oneline.txt stdin as in <a class=\"stream-topic\" data-stream-id=\"463736\" href=\"/#narrow/channel/463736-bugs/topic/.E2.9C.94.20Panic.20use-after-free.20with.20long.20Stdin.20.2B.20List.2Eappend/with/563430386\">#bugs &gt; ✔ Panic use-after-free with long Stdin + List.append</a> </p>\n<p>This time, the minimal bug happens with a while loop.</p>\n<div class=\"codehilite\" data-code-language=\"Ruby\"><pre><span></span><code><span class=\"n\">main!</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"o\">|</span><span class=\"n\">_args</span><span class=\"o\">|</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">    </span><span class=\"k\">while</span><span class=\"w\"> </span><span class=\"no\">True</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">        </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"no\">Stdin</span><span class=\"o\">.</span><span class=\"n\">line!</span><span class=\"p\">()</span><span class=\"w\"> </span><span class=\"o\">==</span><span class=\"w\"> </span><span class=\"s2\">\"\"</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">            </span><span class=\"k\">return</span><span class=\"w\"> </span><span class=\"no\">Ok</span><span class=\"p\">({})</span>\n<span class=\"w\">        </span><span class=\"p\">}</span>\n<span class=\"w\">    </span><span class=\"p\">}</span>\n<span class=\"w\">    </span><span class=\"no\">Ok</span><span class=\"p\">({})</span>\n<span class=\"p\">}</span>\n</code></pre></div>\n<p>I opened an issue <a href=\"https://github.com/roc-lang/roc/issues/8642\">https://github.com/roc-lang/roc/issues/8642</a></p>",
        "id": 563443128,
        "sender_full_name": "Matthieu Pizenberg",
        "timestamp": 1765536191
    },
    {
        "content": "<p><a href=\"https://github.com/roc-lang/roc/pull/8649\">https://github.com/roc-lang/roc/pull/8649</a> should fix this</p>",
        "id": 563484685,
        "sender_full_name": "Richard Feldman",
        "timestamp": 1765549112
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"281383\">Richard Feldman</span> <a href=\"#narrow/channel/463736-bugs/topic/Panic.20use-after-free.20with.20long.20Stdin.20.2B.20while.20loop/near/563484685\">said</a>:</p>\n<blockquote>\n<p><a href=\"https://github.com/roc-lang/roc/pull/8649\">https://github.com/roc-lang/roc/pull/8649</a> should fix this</p>\n</blockquote>\n<p>Hello, I've tested some code with a similar error on your fix branch, and I still got the following use-after-free error :</p>\n<p>The spaghetti-flavored, not minimal repro-ified code below :</p>\n<div class=\"codehilite\" data-code-language=\"Ruby\"><pre><span></span><code><span class=\"n\">the_menagerie_with_cumulative_parts</span><span class=\"w\"> </span><span class=\"o\">=</span>\n<span class=\"w\">    </span><span class=\"o\">[</span><span class=\"s2\">\"fly\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"s2\">\"spider\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"s2\">\"bird\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"s2\">\"cat\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"s2\">\"dog\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"s2\">\"goat\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"s2\">\"cow\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"s2\">\"horse\"</span><span class=\"o\">]</span>\n<span class=\"w\">        </span><span class=\"o\">.</span><span class=\"n\">fold</span><span class=\"p\">(</span>\n<span class=\"w\">            </span><span class=\"p\">{</span><span class=\"ss\">list</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"o\">[]</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"ss\">acc_str</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"\"</span><span class=\"p\">},</span>\n<span class=\"w\">            </span><span class=\"o\">|</span><span class=\"n\">state</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">animal</span><span class=\"o\">|</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">                </span><span class=\"n\">dbg</span><span class=\"w\"> </span><span class=\"n\">state</span>\n<span class=\"w\">                </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"n\">animal</span><span class=\"w\"> </span><span class=\"o\">==</span><span class=\"w\"> </span><span class=\"s2\">\"horse\"</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">                    </span><span class=\"k\">return</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">                        </span><span class=\"ss\">list</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"n\">state</span><span class=\"o\">.</span><span class=\"n\">list</span><span class=\"o\">.</span><span class=\"n\">append</span><span class=\"p\">(</span>\n<span class=\"w\">                            </span><span class=\"p\">(</span><span class=\"n\">animal</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"s2\">\"\"</span><span class=\"p\">),</span>\n<span class=\"w\">                        </span><span class=\"p\">),</span>\n<span class=\"w\">                        </span><span class=\"ss\">acc_str</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"\"</span><span class=\"p\">,</span>\n<span class=\"w\">                    </span><span class=\"p\">}</span>\n<span class=\"w\">                </span><span class=\"p\">}</span>\n\n\n<span class=\"w\">                </span><span class=\"n\">new_part</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">add_line</span><span class=\"p\">(</span><span class=\"n\">animal</span><span class=\"p\">),</span><span class=\"w\"> </span><span class=\"n\">state</span><span class=\"o\">.</span><span class=\"n\">acc_str</span><span class=\"o\">]-&gt;</span><span class=\"no\">Str</span><span class=\"o\">.</span><span class=\"n\">join_with</span><span class=\"p\">(</span><span class=\"s2\">\"</span><span class=\"se\">\\n</span><span class=\"s2\">\"</span><span class=\"p\">)</span>\n\n<span class=\"w\">                </span><span class=\"p\">{</span>\n<span class=\"w\">                    </span><span class=\"ss\">list</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"n\">state</span><span class=\"o\">.</span><span class=\"n\">list</span><span class=\"o\">.</span><span class=\"n\">append</span><span class=\"p\">(</span>\n<span class=\"w\">                        </span><span class=\"p\">(</span><span class=\"n\">animal</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">new_part</span><span class=\"p\">),</span>\n<span class=\"w\">                    </span><span class=\"p\">),</span>\n<span class=\"w\">                    </span><span class=\"ss\">acc_str</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"n\">new_part</span><span class=\"p\">,</span>\n<span class=\"w\">                </span><span class=\"p\">}</span>\n<span class=\"w\">            </span><span class=\"p\">},</span>\n<span class=\"w\">        </span><span class=\"p\">)</span>\n\n<span class=\"n\">add_line</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"o\">|</span><span class=\"n\">animal</span><span class=\"o\">|</span>\n<span class=\"w\">    </span><span class=\"n\">match</span><span class=\"w\"> </span><span class=\"n\">animal</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">        </span><span class=\"s2\">\"fly\"</span><span class=\"w\"> </span><span class=\"o\">=&gt;</span>\n<span class=\"w\">            </span><span class=\"p\">\\\\</span><span class=\"n\">I</span><span class=\"w\"> </span><span class=\"n\">don</span><span class=\"s1\">'t know why she swallowed a fly.</span>\n<span class=\"s1\">            </span><span class=\"se\">\\\\</span><span class=\"s1\">Perhaps she'</span><span class=\"n\">ll</span><span class=\"w\"> </span><span class=\"n\">die</span><span class=\"o\">.</span>\n\n<span class=\"w\">        </span><span class=\"s2\">\"spider\"</span><span class=\"w\"> </span><span class=\"o\">=&gt;</span>\n<span class=\"w\">            </span><span class=\"s2\">\"She swallowed the spider to catch the fly.\"</span>\n\n<span class=\"w\">        </span><span class=\"s2\">\"bird\"</span><span class=\"w\"> </span><span class=\"o\">=&gt;</span>\n<span class=\"w\">            </span><span class=\"s2\">\"She swallowed the bird to catch the spider that wriggled and jiggled and tickled inside her.\"</span>\n\n<span class=\"w\">        </span><span class=\"s2\">\"cat\"</span><span class=\"w\"> </span><span class=\"o\">=&gt;</span>\n<span class=\"w\">            </span><span class=\"s2\">\"She swallowed the cat to catch the bird.\"</span>\n\n<span class=\"w\">        </span><span class=\"s2\">\"dog\"</span><span class=\"w\"> </span><span class=\"o\">=&gt;</span>\n<span class=\"w\">            </span><span class=\"s2\">\"She swallowed the dog to catch the cat.\"</span>\n\n<span class=\"w\">        </span><span class=\"s2\">\"goat\"</span><span class=\"w\"> </span><span class=\"o\">=&gt;</span>\n<span class=\"w\">            </span><span class=\"s2\">\"She swallowed the goat to catch the dog.\"</span>\n<span class=\"w\">        </span><span class=\"p\">}</span>\n</code></pre></div>\n<p>The check output :</p>\n<div class=\"codehilite\" data-code-language=\"Ruby\"><pre><span></span><code><span class=\"o\">[</span><span class=\"n\">dbg</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\"> </span><span class=\"ss\">acc_str</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"ss\">list</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"o\">[]</span><span class=\"w\"> </span><span class=\"p\">}</span>\n<span class=\"o\">[</span><span class=\"n\">dbg</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\"> </span><span class=\"ss\">acc_str</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"I don't know why she swallowed a fly.</span>\n<span class=\"s2\">Perhaps she'll die.</span>\n<span class=\"s2\">\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"ss\">list</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"p\">(</span><span class=\"s2\">\"fly\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"s2\">\"I don't know why she swallowed a fly.</span>\n<span class=\"s2\">Perhaps she'll die.</span>\n<span class=\"s2\">\"</span><span class=\"p\">)</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"p\">}</span>\n<span class=\"n\">thread</span><span class=\"w\"> </span><span class=\"mi\">68798</span><span class=\"w\"> </span><span class=\"ss\">panic</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"no\">Use</span><span class=\"o\">-</span><span class=\"n\">after</span><span class=\"o\">-</span><span class=\"ss\">free</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"n\">decref</span><span class=\"w\"> </span><span class=\"n\">on</span><span class=\"w\"> </span><span class=\"n\">already</span><span class=\"o\">-</span><span class=\"n\">freed</span><span class=\"w\"> </span><span class=\"n\">memory</span>\n<span class=\"sr\">/home/</span><span class=\"n\">astating</span><span class=\"o\">/</span><span class=\"n\">roc</span><span class=\"o\">/</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">builtins</span><span class=\"o\">/</span><span class=\"n\">utils</span><span class=\"o\">.</span><span class=\"n\">zig</span><span class=\"p\">:</span><span class=\"mi\">525</span><span class=\"p\">:</span><span class=\"mi\">13</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"mh\">0x4ffea36</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"n\">decref</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">mod</span><span class=\"o\">.</span><span class=\"n\">zig</span><span class=\"p\">)</span>\n<span class=\"w\">            </span><span class=\"vi\">@panic</span><span class=\"p\">(</span><span class=\"s2\">\"Use-after-free: decref on already-freed memory\"</span><span class=\"p\">);</span>\n<span class=\"w\">            </span><span class=\"o\">^</span>\n<span class=\"sr\">/home/</span><span class=\"n\">astating</span><span class=\"o\">/</span><span class=\"n\">roc</span><span class=\"o\">/</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">builtins</span><span class=\"o\">/</span><span class=\"n\">str</span><span class=\"o\">.</span><span class=\"n\">zig</span><span class=\"p\">:</span><span class=\"mi\">267</span><span class=\"p\">:</span><span class=\"mi\">40</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"mh\">0x4ce0606</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"n\">decref</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">mod</span><span class=\"o\">.</span><span class=\"n\">zig</span><span class=\"p\">)</span>\n<span class=\"w\">            </span><span class=\"vi\">@import</span><span class=\"p\">(</span><span class=\"s2\">\"utils.zig\"</span><span class=\"p\">)</span><span class=\"o\">.</span><span class=\"n\">decref</span><span class=\"p\">(</span><span class=\"nb\">self</span><span class=\"o\">.</span><span class=\"n\">getAllocationPtr</span><span class=\"p\">(),</span><span class=\"w\"> </span><span class=\"nb\">self</span><span class=\"o\">.</span><span class=\"n\">capacity_or_alloc_ptr</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"no\">RocStr</span><span class=\"o\">.</span><span class=\"n\">alignment</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"kp\">false</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">roc_ops</span><span class=\"p\">);</span>\n<span class=\"w\">                                       </span><span class=\"o\">^</span>\n<span class=\"sr\">/home/</span><span class=\"n\">astating</span><span class=\"o\">/</span><span class=\"n\">roc</span><span class=\"o\">/</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"nb\">eval</span><span class=\"o\">/</span><span class=\"no\">StackValue</span><span class=\"o\">.</span><span class=\"n\">zig</span><span class=\"p\">:</span><span class=\"mi\">114</span><span class=\"p\">:</span><span class=\"mi\">23</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"mh\">0x4ce0c34</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"n\">decrefLayoutPtr</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">mod</span><span class=\"o\">.</span><span class=\"n\">zig</span><span class=\"p\">)</span>\n<span class=\"w\">        </span><span class=\"n\">roc_str</span><span class=\"o\">.</span><span class=\"n\">decref</span><span class=\"p\">(</span><span class=\"n\">ops</span><span class=\"p\">);</span>\n<span class=\"w\">                      </span><span class=\"o\">^</span>\n<span class=\"sr\">/home/</span><span class=\"n\">astating</span><span class=\"o\">/</span><span class=\"n\">roc</span><span class=\"o\">/</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"nb\">eval</span><span class=\"o\">/</span><span class=\"no\">StackValue</span><span class=\"o\">.</span><span class=\"n\">zig</span><span class=\"p\">:</span><span class=\"mi\">210</span><span class=\"p\">:</span><span class=\"mi\">28</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"mh\">0x4ce21b0</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"n\">decrefLayoutPtr</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">mod</span><span class=\"o\">.</span><span class=\"n\">zig</span><span class=\"p\">)</span>\n<span class=\"w\">            </span><span class=\"n\">decrefLayoutPtr</span><span class=\"p\">(</span><span class=\"n\">elem_layout</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">elem_ptr</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">layout_cache</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">ops</span><span class=\"p\">);</span>\n<span class=\"w\">                           </span><span class=\"o\">^</span>\n<span class=\"sr\">/home/</span><span class=\"n\">astating</span><span class=\"o\">/</span><span class=\"n\">roc</span><span class=\"o\">/</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"nb\">eval</span><span class=\"o\">/</span><span class=\"no\">StackValue</span><span class=\"o\">.</span><span class=\"n\">zig</span><span class=\"p\">:</span><span class=\"mi\">133</span><span class=\"p\">:</span><span class=\"mi\">36</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"mh\">0x4ce11f9</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"n\">decrefLayoutPtr</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">mod</span><span class=\"o\">.</span><span class=\"n\">zig</span><span class=\"p\">)</span>\n<span class=\"w\">                    </span><span class=\"n\">decrefLayoutPtr</span><span class=\"p\">(</span><span class=\"n\">elem_layout</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"vi\">@ptrCast</span><span class=\"p\">(</span><span class=\"n\">elem_ptr</span><span class=\"p\">),</span><span class=\"w\"> </span><span class=\"n\">layout_cache</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">ops</span><span class=\"p\">);</span>\n<span class=\"w\">                                   </span><span class=\"o\">^</span>\n<span class=\"sr\">/home/</span><span class=\"n\">astating</span><span class=\"o\">/</span><span class=\"n\">roc</span><span class=\"o\">/</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"nb\">eval</span><span class=\"o\">/</span><span class=\"no\">StackValue</span><span class=\"o\">.</span><span class=\"n\">zig</span><span class=\"p\">:</span><span class=\"mi\">192</span><span class=\"p\">:</span><span class=\"mi\">28</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"mh\">0x4ce1d07</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"n\">decrefLayoutPtr</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">mod</span><span class=\"o\">.</span><span class=\"n\">zig</span><span class=\"p\">)</span>\n<span class=\"w\">            </span><span class=\"n\">decrefLayoutPtr</span><span class=\"p\">(</span><span class=\"n\">field_layout</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">field_ptr</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">layout_cache</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">ops</span><span class=\"p\">);</span>\n<span class=\"w\">                           </span><span class=\"o\">^</span>\n<span class=\"sr\">/home/</span><span class=\"n\">astating</span><span class=\"o\">/</span><span class=\"n\">roc</span><span class=\"o\">/</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"nb\">eval</span><span class=\"o\">/</span><span class=\"no\">StackValue</span><span class=\"o\">.</span><span class=\"n\">zig</span><span class=\"p\">:</span><span class=\"mi\">1730</span><span class=\"p\">:</span><span class=\"mi\">28</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"mh\">0x4a38b40</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"n\">decref</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">mod</span><span class=\"o\">.</span><span class=\"n\">zig</span><span class=\"p\">)</span>\n<span class=\"w\">            </span><span class=\"n\">decrefLayoutPtr</span><span class=\"p\">(</span><span class=\"nb\">self</span><span class=\"o\">.</span><span class=\"n\">layout</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"nb\">self</span><span class=\"o\">.</span><span class=\"n\">ptr</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">layout_cache</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">ops</span><span class=\"p\">);</span>\n<span class=\"w\">                           </span><span class=\"o\">^</span>\n<span class=\"sr\">/home/</span><span class=\"n\">astating</span><span class=\"o\">/</span><span class=\"n\">roc</span><span class=\"o\">/</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"nb\">eval</span><span class=\"o\">/</span><span class=\"n\">interpreter</span><span class=\"o\">.</span><span class=\"n\">zig</span><span class=\"p\">:</span><span class=\"mi\">15802</span><span class=\"p\">:</span><span class=\"mi\">60</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"mh\">0x4da4664</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"n\">applyContinuation</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">mod</span><span class=\"o\">.</span><span class=\"n\">zig</span><span class=\"p\">)</span>\n<span class=\"w\">                        </span><span class=\"nb\">self</span><span class=\"o\">.</span><span class=\"n\">bindings</span><span class=\"o\">.</span><span class=\"n\">items</span><span class=\"o\">[</span><span class=\"n\">j</span><span class=\"o\">].</span><span class=\"n\">value</span><span class=\"o\">.</span><span class=\"n\">decref</span><span class=\"p\">(</span><span class=\"o\">&amp;</span><span class=\"nb\">self</span><span class=\"o\">.</span><span class=\"n\">runtime_layout_store</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">roc_ops</span><span class=\"p\">);</span>\n<span class=\"w\">                                                           </span><span class=\"o\">^</span>\n<span class=\"sr\">/home/</span><span class=\"n\">astating</span><span class=\"o\">/</span><span class=\"n\">roc</span><span class=\"o\">/</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"nb\">eval</span><span class=\"o\">/</span><span class=\"n\">interpreter</span><span class=\"o\">.</span><span class=\"n\">zig</span><span class=\"p\">:</span><span class=\"mi\">9852</span><span class=\"p\">:</span><span class=\"mi\">71</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"mh\">0x4a72680</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"n\">evalWithExpectedType</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">mod</span><span class=\"o\">.</span><span class=\"n\">zig</span><span class=\"p\">)</span>\n<span class=\"w\">                    </span><span class=\"n\">const</span><span class=\"w\"> </span><span class=\"n\">should_continue</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">try</span><span class=\"w\"> </span><span class=\"nb\">self</span><span class=\"o\">.</span><span class=\"n\">applyContinuation</span><span class=\"p\">(</span><span class=\"o\">&amp;</span><span class=\"n\">work_stack</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"o\">&amp;</span><span class=\"n\">value_stack</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">cont</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">roc_ops</span><span class=\"p\">);</span>\n<span class=\"w\">                                                                      </span><span class=\"o\">^</span>\n<span class=\"sr\">/home/</span><span class=\"n\">astating</span><span class=\"o\">/</span><span class=\"n\">roc</span><span class=\"o\">/</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"nb\">eval</span><span class=\"o\">/</span><span class=\"n\">interpreter</span><span class=\"o\">.</span><span class=\"n\">zig</span><span class=\"p\">:</span><span class=\"mi\">558</span><span class=\"p\">:</span><span class=\"mi\">45</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"mh\">0x4a379cf</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"nb\">eval</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">mod</span><span class=\"o\">.</span><span class=\"n\">zig</span><span class=\"p\">)</span>\n<span class=\"w\">        </span><span class=\"k\">return</span><span class=\"w\"> </span><span class=\"n\">try</span><span class=\"w\"> </span><span class=\"nb\">self</span><span class=\"o\">.</span><span class=\"n\">evalWithExpectedType</span><span class=\"p\">(</span><span class=\"n\">expr_idx</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">roc_ops</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">null</span><span class=\"p\">);</span>\n<span class=\"w\">                                            </span><span class=\"o\">^</span>\n<span class=\"sr\">/home/</span><span class=\"n\">astating</span><span class=\"o\">/</span><span class=\"n\">roc</span><span class=\"o\">/</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"nb\">eval</span><span class=\"o\">/</span><span class=\"n\">comptime_evaluator</span><span class=\"o\">.</span><span class=\"n\">zig</span><span class=\"p\">:</span><span class=\"mi\">291</span><span class=\"p\">:</span><span class=\"mi\">45</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"mh\">0x47fd32b</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"n\">evalDecl</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">mod</span><span class=\"o\">.</span><span class=\"n\">zig</span><span class=\"p\">)</span>\n<span class=\"w\">        </span><span class=\"n\">const</span><span class=\"w\"> </span><span class=\"n\">result</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"nb\">self</span><span class=\"o\">.</span><span class=\"n\">interpreter</span><span class=\"o\">.</span><span class=\"n\">eval</span><span class=\"p\">(</span><span class=\"n\">expr_idx</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">ops</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"kp\">catch</span><span class=\"w\"> </span><span class=\"o\">|</span><span class=\"n\">err</span><span class=\"o\">|</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">                                            </span><span class=\"o\">^</span>\n<span class=\"sr\">/home/</span><span class=\"n\">astating</span><span class=\"o\">/</span><span class=\"n\">roc</span><span class=\"o\">/</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"nb\">eval</span><span class=\"o\">/</span><span class=\"n\">comptime_evaluator</span><span class=\"o\">.</span><span class=\"n\">zig</span><span class=\"p\">:</span><span class=\"mi\">1494</span><span class=\"p\">:</span><span class=\"mi\">50</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"mh\">0x47ff101</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"n\">evalAll</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">mod</span><span class=\"o\">.</span><span class=\"n\">zig</span><span class=\"p\">)</span>\n<span class=\"w\">                </span><span class=\"n\">const</span><span class=\"w\"> </span><span class=\"n\">eval_result</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"nb\">self</span><span class=\"o\">.</span><span class=\"n\">evalDecl</span><span class=\"p\">(</span><span class=\"n\">def_idx</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"kp\">catch</span><span class=\"w\"> </span><span class=\"o\">|</span><span class=\"n\">err</span><span class=\"o\">|</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">                                                 </span><span class=\"o\">^</span>\n<span class=\"sr\">/home/</span><span class=\"n\">astating</span><span class=\"o\">/</span><span class=\"n\">roc</span><span class=\"o\">/</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">compile</span><span class=\"o\">/</span><span class=\"n\">compile_package</span><span class=\"o\">.</span><span class=\"n\">zig</span><span class=\"p\">:</span><span class=\"mi\">1065</span><span class=\"p\">:</span><span class=\"mi\">43</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"mh\">0x49c0984</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"n\">typeCheckModule</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">mod</span><span class=\"o\">.</span><span class=\"n\">zig</span><span class=\"p\">)</span>\n<span class=\"w\">        </span><span class=\"n\">_</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">try</span><span class=\"w\"> </span><span class=\"n\">comptime_evaluator</span><span class=\"o\">.</span><span class=\"n\">evalAll</span><span class=\"p\">();</span>\n<span class=\"w\">                                          </span><span class=\"o\">^</span>\n<span class=\"sr\">/home/</span><span class=\"n\">astating</span><span class=\"o\">/</span><span class=\"n\">roc</span><span class=\"o\">/</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">compile</span><span class=\"o\">/</span><span class=\"n\">compile_package</span><span class=\"o\">.</span><span class=\"n\">zig</span><span class=\"p\">:</span><span class=\"mi\">1118</span><span class=\"p\">:</span><span class=\"mi\">42</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"mh\">0x49c1c38</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"n\">doTypeCheck</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">mod</span><span class=\"o\">.</span><span class=\"n\">zig</span><span class=\"p\">)</span>\n<span class=\"w\">        </span><span class=\"n\">var</span><span class=\"w\"> </span><span class=\"n\">checker</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">try</span><span class=\"w\"> </span><span class=\"n\">typeCheckModule</span><span class=\"p\">(</span><span class=\"nb\">self</span><span class=\"o\">.</span><span class=\"n\">gpa</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">env</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"nb\">self</span><span class=\"o\">.</span><span class=\"n\">builtin_modules</span><span class=\"o\">.</span><span class=\"n\">builtin_module</span><span class=\"o\">.</span><span class=\"n\">env</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">imported_envs</span><span class=\"o\">.</span><span class=\"n\">items</span><span class=\"p\">);</span>\n<span class=\"w\">                                         </span><span class=\"o\">^</span>\n<span class=\"sr\">/home/</span><span class=\"n\">astating</span><span class=\"o\">/</span><span class=\"n\">roc</span><span class=\"o\">/</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">compile</span><span class=\"o\">/</span><span class=\"n\">compile_package</span><span class=\"o\">.</span><span class=\"n\">zig</span><span class=\"p\">:</span><span class=\"mi\">593</span><span class=\"p\">:</span><span class=\"mi\">37</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"mh\">0x49c48fc</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"n\">process</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">mod</span><span class=\"o\">.</span><span class=\"n\">zig</span><span class=\"p\">)</span>\n<span class=\"w\">                </span><span class=\"n\">try</span><span class=\"w\"> </span><span class=\"nb\">self</span><span class=\"o\">.</span><span class=\"n\">doTypeCheck</span><span class=\"p\">(</span><span class=\"n\">task</span><span class=\"o\">.</span><span class=\"n\">module_id</span><span class=\"p\">);</span>\n<span class=\"w\">                                    </span><span class=\"o\">^</span>\n<span class=\"sr\">/home/</span><span class=\"n\">astating</span><span class=\"o\">/</span><span class=\"n\">roc</span><span class=\"o\">/</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">compile</span><span class=\"o\">/</span><span class=\"n\">compile_package</span><span class=\"o\">.</span><span class=\"n\">zig</span><span class=\"p\">:</span><span class=\"mi\">365</span><span class=\"p\">:</span><span class=\"mi\">33</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"mh\">0x49c59d2</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"n\">runSingleThread</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">mod</span><span class=\"o\">.</span><span class=\"n\">zig</span><span class=\"p\">)</span>\n<span class=\"w\">                </span><span class=\"n\">try</span><span class=\"w\"> </span><span class=\"nb\">self</span><span class=\"o\">.</span><span class=\"n\">process</span><span class=\"p\">(</span><span class=\"n\">task</span><span class=\"p\">);</span>\n<span class=\"w\">                                </span><span class=\"o\">^</span>\n<span class=\"sr\">/home/</span><span class=\"n\">astating</span><span class=\"o\">/</span><span class=\"n\">roc</span><span class=\"o\">/</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">compile</span><span class=\"o\">/</span><span class=\"n\">compile_package</span><span class=\"o\">.</span><span class=\"n\">zig</span><span class=\"p\">:</span><span class=\"mi\">349</span><span class=\"p\">:</span><span class=\"mi\">65</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"mh\">0x49c7846</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"n\">buildRoot</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">mod</span><span class=\"o\">.</span><span class=\"n\">zig</span><span class=\"p\">)</span>\n<span class=\"w\">                    </span><span class=\"o\">.</span><span class=\"n\">single_threaded</span><span class=\"w\"> </span><span class=\"o\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">try</span><span class=\"w\"> </span><span class=\"nb\">self</span><span class=\"o\">.</span><span class=\"n\">runSingleThread</span><span class=\"p\">(),</span>\n<span class=\"w\">                                                                </span><span class=\"o\">^</span>\n<span class=\"sr\">/home/</span><span class=\"n\">astating</span><span class=\"o\">/</span><span class=\"n\">roc</span><span class=\"o\">/</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">compile</span><span class=\"o\">/</span><span class=\"n\">compile_build</span><span class=\"o\">.</span><span class=\"n\">zig</span><span class=\"p\">:</span><span class=\"mi\">569</span><span class=\"p\">:</span><span class=\"mi\">35</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"mh\">0x49ce37d</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"n\">build</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">mod</span><span class=\"o\">.</span><span class=\"n\">zig</span><span class=\"p\">)</span>\n<span class=\"w\">        </span><span class=\"n\">try</span><span class=\"w\"> </span><span class=\"n\">root_sched</span><span class=\"o\">.</span><span class=\"n n-Operator\">*</span><span class=\"o\">.</span><span class=\"n\">buildRoot</span><span class=\"p\">(</span><span class=\"n\">pkg_root_file</span><span class=\"p\">);</span>\n<span class=\"w\">                                  </span><span class=\"o\">^</span>\n<span class=\"sr\">/home/</span><span class=\"n\">astating</span><span class=\"o\">/</span><span class=\"n\">roc</span><span class=\"o\">/</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">cli</span><span class=\"o\">/</span><span class=\"n\">main</span><span class=\"o\">.</span><span class=\"n\">zig</span><span class=\"p\">:</span><span class=\"mi\">4411</span><span class=\"p\">:</span><span class=\"mi\">20</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"mh\">0x49d3e12</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"n\">checkFileWithBuildEnv</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">main</span><span class=\"o\">.</span><span class=\"n\">zig</span><span class=\"p\">)</span>\n<span class=\"w\">    </span><span class=\"n\">build_env</span><span class=\"o\">.</span><span class=\"n\">build</span><span class=\"p\">(</span><span class=\"n\">filepath</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"kp\">catch</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">                   </span><span class=\"o\">^</span>\n<span class=\"sr\">/home/</span><span class=\"n\">astating</span><span class=\"o\">/</span><span class=\"n\">roc</span><span class=\"o\">/</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">cli</span><span class=\"o\">/</span><span class=\"n\">main</span><span class=\"o\">.</span><span class=\"n\">zig</span><span class=\"p\">:</span><span class=\"mi\">4508</span><span class=\"p\">:</span><span class=\"mi\">45</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"mh\">0x45e5e6e</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"n\">rocCheck</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">main</span><span class=\"o\">.</span><span class=\"n\">zig</span><span class=\"p\">)</span>\n<span class=\"w\">    </span><span class=\"n\">var</span><span class=\"w\"> </span><span class=\"n\">check_result</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">checkFileWithBuildEnv</span><span class=\"p\">(</span>\n<span class=\"w\">                                            </span><span class=\"o\">^</span>\n<span class=\"sr\">/home/</span><span class=\"n\">astating</span><span class=\"o\">/</span><span class=\"n\">roc</span><span class=\"o\">/</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">cli</span><span class=\"o\">/</span><span class=\"n\">main</span><span class=\"o\">.</span><span class=\"n\">zig</span><span class=\"p\">:</span><span class=\"mi\">741</span><span class=\"p\">:</span><span class=\"mi\">40</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"mh\">0x486ff28</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"n\">mainArgs</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">main</span><span class=\"o\">.</span><span class=\"n\">zig</span><span class=\"p\">)</span>\n<span class=\"w\">        </span><span class=\"o\">.</span><span class=\"n\">check</span><span class=\"w\"> </span><span class=\"o\">=&gt;</span><span class=\"w\"> </span><span class=\"o\">|</span><span class=\"n\">check_args</span><span class=\"o\">|</span><span class=\"w\"> </span><span class=\"n\">rocCheck</span><span class=\"p\">(</span><span class=\"n\">allocs</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">check_args</span><span class=\"p\">),</span>\n<span class=\"w\">                                       </span><span class=\"o\">^</span>\n<span class=\"sr\">/home/</span><span class=\"n\">astating</span><span class=\"o\">/</span><span class=\"n\">roc</span><span class=\"o\">/</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">cli</span><span class=\"o\">/</span><span class=\"n\">main</span><span class=\"o\">.</span><span class=\"n\">zig</span><span class=\"p\">:</span><span class=\"mi\">678</span><span class=\"p\">:</span><span class=\"mi\">13</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"mh\">0x48724c8</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"n\">main</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">main</span><span class=\"o\">.</span><span class=\"n\">zig</span><span class=\"p\">)</span>\n<span class=\"w\">    </span><span class=\"n\">mainArgs</span><span class=\"p\">(</span><span class=\"o\">&amp;</span><span class=\"n\">allocs</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">args</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"kp\">catch</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">            </span><span class=\"o\">^</span>\n<span class=\"sr\">/home/</span><span class=\"n\">astating</span><span class=\"o\">/</span><span class=\"n\">zig</span><span class=\"o\">-</span><span class=\"n\">x86_64</span><span class=\"o\">-</span><span class=\"n\">linux</span><span class=\"o\">-</span><span class=\"mi\">0</span><span class=\"o\">.</span><span class=\"mi\">15</span><span class=\"o\">.</span><span class=\"mi\">2</span><span class=\"o\">/</span><span class=\"n\">lib</span><span class=\"o\">/</span><span class=\"n\">std</span><span class=\"o\">/</span><span class=\"n\">start</span><span class=\"o\">.</span><span class=\"n\">zig</span><span class=\"p\">:</span><span class=\"mi\">627</span><span class=\"p\">:</span><span class=\"mi\">37</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"mh\">0x4872a81</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"n\">main</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">std</span><span class=\"o\">.</span><span class=\"n\">zig</span><span class=\"p\">)</span>\n<span class=\"w\">            </span><span class=\"n\">const</span><span class=\"w\"> </span><span class=\"n\">result</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">root</span><span class=\"o\">.</span><span class=\"n\">main</span><span class=\"p\">()</span><span class=\"w\"> </span><span class=\"kp\">catch</span><span class=\"w\"> </span><span class=\"o\">|</span><span class=\"n\">err</span><span class=\"o\">|</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">                                    </span><span class=\"o\">^</span>\n<span class=\"sr\">/home/</span><span class=\"n\">astating</span><span class=\"o\">/</span><span class=\"n\">zig</span><span class=\"o\">-</span><span class=\"n\">x86_64</span><span class=\"o\">-</span><span class=\"n\">linux</span><span class=\"o\">-</span><span class=\"mi\">0</span><span class=\"o\">.</span><span class=\"mi\">15</span><span class=\"o\">.</span><span class=\"mi\">2</span><span class=\"o\">/</span><span class=\"n\">lib</span><span class=\"o\">/</span><span class=\"n\">libc</span><span class=\"o\">/</span><span class=\"n\">musl</span><span class=\"o\">/</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">env</span><span class=\"o\">/</span><span class=\"n\">__libc_start_main</span><span class=\"o\">.</span><span class=\"n\">c</span><span class=\"p\">:</span><span class=\"mi\">95</span><span class=\"p\">:</span><span class=\"mi\">7</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"mh\">0x9621e9f</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"n\">libc_start_main_stage2</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"sr\">/home/</span><span class=\"n\">astating</span><span class=\"o\">/</span><span class=\"n\">zig</span><span class=\"o\">-</span><span class=\"n\">x86_64</span><span class=\"o\">-</span><span class=\"n\">linux</span><span class=\"o\">-</span><span class=\"mi\">0</span><span class=\"o\">.</span><span class=\"mi\">15</span><span class=\"o\">.</span><span class=\"mi\">2</span><span class=\"o\">/</span><span class=\"n\">lib</span><span class=\"o\">/</span><span class=\"n\">libc</span><span class=\"o\">/</span><span class=\"n\">musl</span><span class=\"o\">/</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">env</span><span class=\"o\">/</span><span class=\"n\">__libc_start_main</span><span class=\"o\">.</span><span class=\"n\">c</span><span class=\"p\">)</span>\n<span class=\"w\"> </span><span class=\"nb\">exit</span><span class=\"p\">(</span><span class=\"n\">main</span><span class=\"p\">(</span><span class=\"n\">argc</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">argv</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">envp</span><span class=\"p\">));</span>\n<span class=\"w\">      </span><span class=\"o\">^</span>\n<span class=\"sc\">???:?:?:</span><span class=\"w\"> </span><span class=\"mh\">0x957af09</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"sc\">??</span><span class=\"p\">?</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"sc\">???)</span>\n<span class=\"no\">Unwind</span><span class=\"w\"> </span><span class=\"n\">error</span><span class=\"w\"> </span><span class=\"n\">at</span><span class=\"w\"> </span><span class=\"n\">address</span><span class=\"w\"> </span><span class=\"sb\">`exe:0x957af09`</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">error</span><span class=\"o\">.</span><span class=\"n\">MissingFDE</span><span class=\"p\">),</span><span class=\"w\"> </span><span class=\"n\">trace</span><span class=\"w\"> </span><span class=\"n\">may</span><span class=\"w\"> </span><span class=\"n\">be</span><span class=\"w\"> </span><span class=\"n\">incomplete</span>\n\n<span class=\"no\">Aborted</span>\n</code></pre></div>\n<p>run output :</p>\n<div class=\"codehilite\"><pre><span></span><code>dbg: { acc_str: &quot;&quot;, list: [] }\n\nRoc crashed: e_closure(expr=125): failed to resolve capture &#39;the_menagerie_with_cumulative_parts&#39; (pattern_idx=0) in module &#39;food_chain.roc&#39;, bindings.len=9\n</code></pre></div>\n<p>Should I create a separate issue ?</p>",
        "id": 563495455,
        "sender_full_name": "Astating",
        "timestamp": 1765551964
    },
    {
        "content": "<p>Hi <span class=\"user-mention\" data-user-id=\"763724\">@Astating</span>,<br>\nCan you try again with <code>roc yourfile.roc --no-cache</code> to make sure it is using the latest stuff?</p>",
        "id": 563496273,
        "sender_full_name": "Anton",
        "timestamp": 1765552113
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"361169\">Anton</span> <a href=\"#narrow/channel/463736-bugs/topic/Panic.20use-after-free.20with.20long.20Stdin.20.2B.20while.20loop/near/563496273\">said</a>:</p>\n<blockquote>\n<p>Hi <span class=\"user-mention silent\" data-user-id=\"763724\">Astating</span>,<br>\nCan you try again with <code>roc yourfile.roc --no-cache</code> to make sure it is using the latest stuff?</p>\n</blockquote>\n<p>Done, same outputs.</p>\n<p>With a little bit reduced example with smaller strings, it does not fail on the same iteration but a bit later :</p>\n<div class=\"codehilite\" data-code-language=\"Ruby\"><pre><span></span><code><span class=\"n\">the_menagerie_with_cumulative_parts</span><span class=\"w\"> </span><span class=\"o\">=</span>\n<span class=\"w\">    </span><span class=\"o\">[</span><span class=\"s2\">\"fly\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"s2\">\"spider\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"s2\">\"bird\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"s2\">\"cat\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"s2\">\"dog\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"s2\">\"goat\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"s2\">\"cow\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"s2\">\"horse\"</span><span class=\"o\">]</span>\n<span class=\"w\">        </span><span class=\"o\">.</span><span class=\"n\">fold</span><span class=\"p\">(</span>\n<span class=\"w\">            </span><span class=\"p\">{</span><span class=\"ss\">list</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"o\">[]</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"ss\">acc_str</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"\"</span><span class=\"p\">},</span>\n<span class=\"w\">            </span><span class=\"o\">|</span><span class=\"n\">state</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">animal</span><span class=\"o\">|</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">                </span><span class=\"n\">dbg</span><span class=\"w\"> </span><span class=\"n\">state</span>\n\n<span class=\"w\">                </span><span class=\"n\">new_part</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">animal</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">state</span><span class=\"o\">.</span><span class=\"n\">acc_str</span><span class=\"o\">]-&gt;</span><span class=\"no\">Str</span><span class=\"o\">.</span><span class=\"n\">join_with</span><span class=\"p\">(</span><span class=\"s2\">\"</span><span class=\"se\">\\n</span><span class=\"s2\">\"</span><span class=\"p\">)</span>\n\n<span class=\"w\">                </span><span class=\"p\">{</span>\n<span class=\"w\">                    </span><span class=\"ss\">list</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"n\">state</span><span class=\"o\">.</span><span class=\"n\">list</span><span class=\"o\">.</span><span class=\"n\">append</span><span class=\"p\">(</span>\n<span class=\"w\">                        </span><span class=\"p\">(</span><span class=\"n\">animal</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">new_part</span><span class=\"p\">),</span>\n<span class=\"w\">                    </span><span class=\"p\">),</span>\n<span class=\"w\">                    </span><span class=\"ss\">acc_str</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"n\">new_part</span><span class=\"p\">,</span>\n<span class=\"w\">                </span><span class=\"p\">}</span>\n<span class=\"w\">            </span><span class=\"p\">},</span>\n<span class=\"w\">        </span><span class=\"p\">)</span>\n</code></pre></div>\n<div class=\"codehilite\" data-code-language=\"Ruby\"><pre><span></span><code><span class=\"o\">[</span><span class=\"n\">dbg</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\"> </span><span class=\"ss\">acc_str</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"ss\">list</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"o\">[]</span><span class=\"w\"> </span><span class=\"p\">}</span>\n<span class=\"o\">[</span><span class=\"n\">dbg</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\"> </span><span class=\"ss\">acc_str</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"fly</span>\n<span class=\"s2\">\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"ss\">list</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"p\">(</span><span class=\"s2\">\"fly\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"s2\">\"fly</span>\n<span class=\"s2\">\"</span><span class=\"p\">)</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"p\">}</span>\n<span class=\"o\">[</span><span class=\"n\">dbg</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\"> </span><span class=\"ss\">acc_str</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"spider</span>\n<span class=\"s2\">fly</span>\n<span class=\"s2\">\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"ss\">list</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"p\">(</span><span class=\"s2\">\"fly\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"s2\">\"fly</span>\n<span class=\"s2\">\"</span><span class=\"p\">),</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"s2\">\"spider\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"s2\">\"spider</span>\n<span class=\"s2\">fly</span>\n<span class=\"s2\">\"</span><span class=\"p\">)</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"p\">}</span>\n<span class=\"o\">[</span><span class=\"n\">dbg</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\"> </span><span class=\"ss\">acc_str</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"bird</span>\n<span class=\"s2\">spider</span>\n<span class=\"s2\">fly</span>\n<span class=\"s2\">\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"ss\">list</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"p\">(</span><span class=\"s2\">\"fly\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"s2\">\"fly</span>\n<span class=\"s2\">\"</span><span class=\"p\">),</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"s2\">\"spider\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"s2\">\"spider</span>\n<span class=\"s2\">fly</span>\n<span class=\"s2\">\"</span><span class=\"p\">),</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"s2\">\"bird\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"s2\">\"bird</span>\n<span class=\"s2\">spider</span>\n<span class=\"s2\">fly</span>\n<span class=\"s2\">\"</span><span class=\"p\">)</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"p\">}</span>\n<span class=\"o\">[</span><span class=\"n\">dbg</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\"> </span><span class=\"ss\">acc_str</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"cat</span>\n<span class=\"s2\">bird</span>\n<span class=\"s2\">spider</span>\n<span class=\"s2\">fly</span>\n<span class=\"s2\">\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"ss\">list</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"p\">(</span><span class=\"s2\">\"fly\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"s2\">\"fly</span>\n<span class=\"s2\">\"</span><span class=\"p\">),</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"s2\">\"spider\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"s2\">\"spider</span>\n<span class=\"s2\">fly</span>\n<span class=\"s2\">\"</span><span class=\"p\">),</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"s2\">\"bird\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"s2\">\"bird</span>\n<span class=\"s2\">spider</span>\n<span class=\"s2\">fly</span>\n<span class=\"s2\">\"</span><span class=\"p\">),</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"s2\">\"cat\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"s2\">\"cat</span>\n<span class=\"s2\">bird</span>\n<span class=\"s2\">spider</span>\n<span class=\"s2\">fly</span>\n<span class=\"s2\">\"</span><span class=\"p\">)</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"p\">}</span>\n<span class=\"o\">[</span><span class=\"n\">dbg</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\"> </span><span class=\"ss\">acc_str</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"dog</span>\n<span class=\"s2\">cat</span>\n<span class=\"s2\">bird</span>\n<span class=\"s2\">spider</span>\n<span class=\"s2\">fly</span>\n<span class=\"s2\">\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"ss\">list</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"p\">(</span><span class=\"s2\">\"fly\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"s2\">\"fly</span>\n<span class=\"s2\">\"</span><span class=\"p\">),</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"s2\">\"spider\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"s2\">\"spider</span>\n<span class=\"s2\">fly</span>\n<span class=\"s2\">\"</span><span class=\"p\">),</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"s2\">\"bird\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"s2\">\"bird</span>\n<span class=\"s2\">spider</span>\n<span class=\"s2\">fly</span>\n<span class=\"s2\">\"</span><span class=\"p\">),</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"s2\">\"cat\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"s2\">\"cat</span>\n<span class=\"s2\">bird</span>\n<span class=\"s2\">spider</span>\n<span class=\"s2\">fly</span>\n<span class=\"s2\">\"</span><span class=\"p\">),</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"s2\">\"dog\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"s2\">\"dog</span>\n<span class=\"s2\">cat</span>\n<span class=\"s2\">bird</span>\n<span class=\"s2\">spider</span>\n<span class=\"s2\">fly</span>\n<span class=\"s2\">\"</span><span class=\"p\">)</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"p\">}</span>\n<span class=\"n\">thread</span><span class=\"w\"> </span><span class=\"mi\">70700</span><span class=\"w\"> </span><span class=\"ss\">panic</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"no\">Use</span><span class=\"o\">-</span><span class=\"n\">after</span><span class=\"o\">-</span><span class=\"ss\">free</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"n\">decref</span><span class=\"w\"> </span><span class=\"n\">on</span><span class=\"w\"> </span><span class=\"n\">already</span><span class=\"o\">-</span><span class=\"n\">freed</span><span class=\"w\"> </span><span class=\"n\">memory</span>\n</code></pre></div>",
        "id": 563496724,
        "sender_full_name": "Astating",
        "timestamp": 1765552216
    },
    {
        "content": "<blockquote>\n<p>Should I create a separate issue ?</p>\n</blockquote>\n<p>Yes, please</p>",
        "id": 563501879,
        "sender_full_name": "Anton",
        "timestamp": 1765553546
    }
]