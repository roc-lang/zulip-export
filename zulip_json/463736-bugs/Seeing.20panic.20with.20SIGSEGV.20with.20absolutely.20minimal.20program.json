[
    {
        "content": "<p>Using <span class=\"user-mention\" data-user-id=\"515757\">@Luke Boswell</span> 's roc-platform-template-zig:</p>\n<div class=\"codehilite\" data-code-language=\"Ruby\"><pre><span></span><code><span class=\"n\">app</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">main!</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">    </span><span class=\"ss\">pf</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"n\">platform</span><span class=\"w\"> </span><span class=\"s2\">\"https://github.com/lukewilliamboswell/roc-platform-template-zig/releases/download/0.6/2BfGn4M9uWJNhDVeMghGeXNVDFijMfPsmmVeo6M4QjKX.tar.zst\"</span>\n<span class=\"p\">}</span>\n\n<span class=\"n\">main!</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"o\">|</span><span class=\"n\">_args</span><span class=\"o\">|</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">    </span><span class=\"no\">Err</span><span class=\"p\">(</span><span class=\"no\">Exit</span><span class=\"p\">(</span><span class=\"mi\">1</span><span class=\"p\">))</span><span class=\"w\"> </span><span class=\"c1\"># You can put Ok({}) as well, and it fails</span>\n<span class=\"p\">}</span>\n</code></pre></div>\n<p>I've tried about 10 different programs adding and removing certain language features, but they all fail.  This is _likely_ a platform issue - maybe specific to mac.  I can build very small programs successfully with the test/fx platform, but it is limited (no cli args for example)</p>",
        "id": 565451482,
        "sender_full_name": "Anthony Bullard",
        "timestamp": 1766762771
    },
    {
        "content": "<p>Error output:</p>\n<div class=\"codehilite\"><pre><span></span><code>❯ ../roc/zig-out/bin/roc examples/CommandLineArgs/main.roc || echo $?\nthread 206406346 panic: reached unreachable code\n???:?:?: 0x1024c40eb in ??? (main.roc)\n???:?:?: 0x1024d288f in ??? (main.roc)\n???:?:?: 0x1024bd9c3 in ??? (main.roc)\n???:?:?: 0x1024ba703 in ??? (main.roc)\n???:?:?: 0x1024ba1a7 in ??? (main.roc)\n???:?:?: 0x10285f383 in ??? (main.roc)\n???:?:?: 0x10241fec7 in ??? (main.roc)\n???:?:?: 0x18f5b6b97 in ??? (???)\n???:?:?: 0x0 in ??? (???)\n134\n</code></pre></div>",
        "id": 565451513,
        "sender_full_name": "Anthony Bullard",
        "timestamp": 1766762799
    },
    {
        "content": "<p>Obviously the stack trace is less than helpful</p>",
        "id": 565451590,
        "sender_full_name": "Anthony Bullard",
        "timestamp": 1766762863
    },
    {
        "content": "<p>Interestingly enough, this runs successfully with a locally built version of the platform</p>",
        "id": 565452140,
        "sender_full_name": "Anthony Bullard",
        "timestamp": 1766763271
    },
    {
        "content": "<p>Hmm strange, are you on intel mac?</p>",
        "id": 565452153,
        "sender_full_name": "Anton",
        "timestamp": 1766763288
    },
    {
        "content": "<p>No M1</p>",
        "id": 565452328,
        "sender_full_name": "Anthony Bullard",
        "timestamp": 1766763417
    },
    {
        "content": "<p>Here's what's stranger</p>",
        "id": 565452335,
        "sender_full_name": "Anthony Bullard",
        "timestamp": 1766763423
    },
    {
        "content": "<p>I actually get the same error with the local built platform when called from where I was.</p>\n<div class=\"codehilite\"><pre><span></span><code># Root of roc-examples repo (roc is a sibling dir)\n../roc/zig-out/bin/roc examples/CommandLineArgs/main.roc\n</code></pre></div>\n<p>with this output:</p>\n<div class=\"codehilite\"><pre><span></span><code>❯ ../roc/zig-out/bin/roc examples/CommandLineArgs/main.roc\nthread 206427882 panic: reached unreachable code\n???:?:?: 0x102ba00eb in ??? (main.roc)\n???:?:?: 0x102bae88f in ??? (main.roc)\n???:?:?: 0x102b999c3 in ??? (main.roc)\n???:?:?: 0x102b96703 in ??? (main.roc)\n???:?:?: 0x102b961a7 in ??? (main.roc)\n???:?:?: 0x102f3b383 in ??? (main.roc)\n???:?:?: 0x102afbec7 in ??? (main.roc)\n???:?:?: 0x18f5b6b97 in ??? (???)\n???:?:?: 0x0 in ??? (???)\n</code></pre></div>\n<p>But when I cd out one level to the parent of roc,roc-example, and roc-platform-template-zig:</p>\n<div class=\"codehilite\"><pre><span></span><code>./roc/zig-out/bin/roc roc-examples/examples/CommandLineArgs/main.roc\n</code></pre></div>\n<p>I get the following output (and success):</p>\n<div class=\"codehilite\"><pre><span></span><code>debug: [HOST] Building args...\ndebug: [ALLOC] ptr=0x103160008 size=40 align=8\ndebug: [ALLOC] ptr=0x103180008 size=117 align=8\ndebug: [HOST] args_list ptr=0x103160018 len=1\ndebug: [HOST] Calling roc__main_for_host...\ndebug: [ALLOC] ptr=0x103160048 size=45 align=8\ndbg: &quot;???&quot;\ndebug: [ALLOC] ptr=0x103160088 size=45 align=8\ndebug: [ALLOC] ptr=0x103340008 size=256 align=8\ndebug: [DEALLOC] ptr=0x103340008 align=8\ndebug: [ALLOC] ptr=0x103180088 size=64 align=8\nPart 1 (demo): 3\ndebug: [DEALLOC] ptr=0x103180088 align=8\ndebug: [ALLOC] ptr=0x103360008 size=256 align=8\ndebug: [DEALLOC] ptr=0x103360008 align=8\ndebug: [ALLOC] ptr=0x103180108 size=64 align=8\nPart 1: 3\ndebug: [DEALLOC] ptr=0x103180108 align=8\ndebug: [ALLOC] ptr=0x103380008 size=256 align=8\ndebug: [DEALLOC] ptr=0x103380008 align=8\ndebug: [ALLOC] ptr=0x103180188 size=64 align=8\nPart 2 (demo): 0\ndebug: [DEALLOC] ptr=0x103180188 align=8\ndebug: [ALLOC] ptr=0x1033a0008 size=256 align=8\ndebug: [DEALLOC] ptr=0x1033a0008 align=8\ndebug: [ALLOC] ptr=0x103180208 size=64 align=8\nPart 2: 0\ndebug: [DEALLOC] ptr=0x103180208 align=8\ndebug: [DEALLOC] ptr=0x103160088 align=8\ndebug: [DEALLOC] ptr=0x103160048 align=8\ndebug: [DEALLOC] ptr=0x103180008 align=8\ndebug: [DEALLOC] ptr=0x103160008 align=8\ndebug: [HOST] Returned from roc, exit_code=0\n</code></pre></div>\n<p>BUT, when I call it from the <code>roc-platform-template-zig</code> directory, I get the following output:</p>\n<div class=\"codehilite\"><pre><span></span><code>❯ ../roc/zig-out/bin/roc ../roc-examples/examples/CommandLineArgs/main.roc\ndbg: &quot;???&quot;\nPart 1 (demo): 3\nPart 1: 3\nPart 2 (demo): 0\nPart 2: 0\n</code></pre></div>\n<p>All using the same code / object files / binary</p>",
        "id": 565452562,
        "sender_full_name": "Anthony Bullard",
        "timestamp": 1766763579
    },
    {
        "content": "<p>This works for me with latest main roc on m2 cpu:</p>\n<div class=\"codehilite\" data-code-language=\"Ruby\"><pre><span></span><code><span class=\"n\">app</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">main!</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">    </span><span class=\"ss\">pf</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"n\">platform</span><span class=\"w\"> </span><span class=\"s2\">\"https://github.com/lukewilliamboswell/roc-platform-template-zig/releases/download/0.6/2BfGn4M9uWJNhDVeMghGeXNVDFijMfPsmmVeo6M4QjKX.tar.zst\"</span>\n<span class=\"p\">}</span>\n\n<span class=\"n\">main!</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"o\">|</span><span class=\"n\">_args</span><span class=\"o\">|</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">    </span><span class=\"no\">Err</span><span class=\"p\">(</span><span class=\"no\">Exit</span><span class=\"p\">(</span><span class=\"mi\">1</span><span class=\"p\">))</span><span class=\"w\"> </span><span class=\"c1\"># You can put Ok({}) as well, and it fails</span>\n<span class=\"p\">}</span>\n</code></pre></div>\n<p>I recommend doing a <code>git clean -fdx</code> to remove old platform files.</p>",
        "id": 565452773,
        "sender_full_name": "Anton",
        "timestamp": 1766763762
    },
    {
        "content": "<p><a href=\"/user_uploads/22008/eqGWwQsB-3Ug1oh_F-R4uT1J/Screen-Recording-2025-12-26-at-9.41.29AM.mov\">Screen Recording 2025-12-26 at 9.41.29 AM.mov</a><br>\nHere's a video</p>",
        "id": 565452811,
        "sender_full_name": "Anthony Bullard",
        "timestamp": 1766763797
    },
    {
        "content": "<p>Same behavior after git clean -xfd AND rm -rf ~/.cache/roc</p>",
        "id": 565452924,
        "sender_full_name": "Anthony Bullard",
        "timestamp": 1766763887
    },
    {
        "content": "<p>This is obviously with a program with some behavior now</p>",
        "id": 565452955,
        "sender_full_name": "Anthony Bullard",
        "timestamp": 1766763908
    },
    {
        "content": "<p>Hmm, how about with <code>roc main.roc --no-cache</code>?</p>",
        "id": 565452975,
        "sender_full_name": "Anton",
        "timestamp": 1766763923
    },
    {
        "content": "<p>Also, Hi Anton, I hope you have ben well</p>",
        "id": 565452984,
        "sender_full_name": "Anthony Bullard",
        "timestamp": 1766763928
    },
    {
        "content": "<p>Hi Anthony, I have been doing well :) How about you?</p>",
        "id": 565453034,
        "sender_full_name": "Anton",
        "timestamp": 1766763971
    },
    {
        "content": "<p>Wow.  Adding <code>--no-cache</code> (thanks for that) makes them all behave the same...</p>",
        "id": 565453086,
        "sender_full_name": "Anthony Bullard",
        "timestamp": 1766764011
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"781658\">Anthony Bullard</span> <a href=\"#narrow/channel/463736-bugs/topic/Seeing.20panic.20with.20SIGSEGV.20with.20absolutely.20minimal.20program/near/565452955\">said</a>:</p>\n<blockquote>\n<p>This is obviously with a program with some behavior now</p>\n</blockquote>\n<p>I don't know what that means :p</p>",
        "id": 565453099,
        "sender_full_name": "Anton",
        "timestamp": 1766764020
    },
    {
        "content": "<p>Where is this magical cache</p>",
        "id": 565453102,
        "sender_full_name": "Anthony Bullard",
        "timestamp": 1766764021
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"361169\">Anton</span> <a href=\"#narrow/channel/463736-bugs/topic/Seeing.20panic.20with.20SIGSEGV.20with.20absolutely.20minimal.20program/near/565453099\">said</a>:</p>\n<blockquote>\n<p><span class=\"user-mention silent\" data-user-id=\"781658\">Anthony Bullard</span> <a href=\"#narrow/channel/463736-bugs/topic/Seeing.20panic.20with.20SIGSEGV.20with.20absolutely.20minimal.20program/near/565452955\">said</a>:</p>\n<blockquote>\n<p>This is obviously with a program with some behavior now</p>\n</blockquote>\n<p>I don't know what that means :p</p>\n</blockquote>\n<p>Sorry, I meant that I put some actual code back into this file once I had it working with the locally built platform</p>",
        "id": 565453136,
        "sender_full_name": "Anthony Bullard",
        "timestamp": 1766764057
    },
    {
        "content": "<p>Are we rebuilding <code>./zig-out/lib/libroc_shim.a</code>?</p>",
        "id": 565453212,
        "sender_full_name": "Anthony Bullard",
        "timestamp": 1766764132
    },
    {
        "content": "<p>I'm not sure, let me check</p>",
        "id": 565453229,
        "sender_full_name": "Anton",
        "timestamp": 1766764148
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"781658\">Anthony Bullard</span> <a href=\"#narrow/channel/463736-bugs/topic/Seeing.20panic.20with.20SIGSEGV.20with.20absolutely.20minimal.20program/near/565453102\">said</a>:</p>\n<blockquote>\n<p>Where is this magical cache</p>\n</blockquote>\n<p>I think it's ~/Library/Caches/roc/</p>",
        "id": 565453510,
        "sender_full_name": "Anton",
        "timestamp": 1766764428
    },
    {
        "content": "<p>Yep, just found it too</p>",
        "id": 565453557,
        "sender_full_name": "Anthony Bullard",
        "timestamp": 1766764477
    },
    {
        "content": "<p>So interesting.  I don't still understand why calling the same code with the same binary from different locations would differ</p>",
        "id": 565453582,
        "sender_full_name": "Anthony Bullard",
        "timestamp": 1766764508
    },
    {
        "content": "<p>But, I'm unblocked so thank you my good sir.  I will now use <code>--no-cache</code> first before I raise an issue</p>",
        "id": 565453613,
        "sender_full_name": "Anthony Bullard",
        "timestamp": 1766764544
    },
    {
        "content": "<p>I learned this the hard way as well lol</p>",
        "id": 565460735,
        "sender_full_name": "nandi",
        "timestamp": 1766771427
    }
]