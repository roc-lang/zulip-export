[
    {
        "content": "<p>I was trying to use Stdin from platform v0.6 to improve my AoC template, and stumbled upon some weird panic. Here is what I’ve been able to reduce it to:</p>\n<p>I’ve got some input text file with 24 char + a final newline: <a href=\"/user_uploads/22008/e4fe0iCMT-0pPty2vJn_czNU/oneline.txt\">oneline.txt</a></p>\n<p>And then I’ve got the following roc file</p>\n<div class=\"codehilite\" data-code-language=\"Ruby\"><pre><span></span><code><span class=\"c1\"># cat oneline.txt | roc crash.roc</span>\n\n<span class=\"n\">app</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">main!</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\"> </span><span class=\"ss\">pf</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"n\">platform</span><span class=\"w\"> </span><span class=\"s2\">\"https://github.com/lukewilliamboswell/roc-platform-template-zig/releases/download/0.6/2BfGn4M9uWJNhDVeMghGeXNVDFijMfPsmmVeo6M4QjKX.tar.zst\"</span><span class=\"w\"> </span><span class=\"p\">}</span>\n\n<span class=\"n\">import</span><span class=\"w\"> </span><span class=\"n\">pf</span><span class=\"o\">.</span><span class=\"n\">Stdin</span>\n\n<span class=\"n\">main!</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"o\">|</span><span class=\"n\">_args</span><span class=\"o\">|</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">    </span><span class=\"c1\">#_l = [Stdin.line!()] # &lt;- this works</span>\n<span class=\"w\">    </span><span class=\"c1\">#_l = List.append([], Stdin.line!()) # &lt;- this panics</span>\n<span class=\"w\">    </span><span class=\"n\">_l</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"o\">[].</span><span class=\"n\">append</span><span class=\"p\">(</span><span class=\"no\">Stdin</span><span class=\"o\">.</span><span class=\"n\">line!</span><span class=\"p\">())</span><span class=\"w\"> </span><span class=\"c1\"># &lt;- this panics</span>\n<span class=\"w\">    </span><span class=\"no\">Ok</span><span class=\"p\">({})</span>\n<span class=\"p\">}</span>\n</code></pre></div>\n<p>When calling <code>cat oneline.txt | roc crash.roc</code>, I get the following panic.</p>\n<div class=\"codehilite\" data-code-language=\"Bash Session\"><pre><span></span><code><span class=\"go\">❯ cat ../inputs/oneline.txt | roc crash.roc</span>\n<span class=\"go\">thread 1901738 panic: Use-after-free: decref on already-freed memory</span>\n<span class=\"go\">???:?:?: 0x10496be5f in ??? (crash.roc)</span>\n<span class=\"go\">???:?:?: 0x1048f4a8f in ??? (crash.roc)</span>\n<span class=\"go\">???:?:?: 0x1048f4dfb in ??? (crash.roc)</span>\n<span class=\"go\">???:?:?: 0x1048d404b in ??? (crash.roc)</span>\n<span class=\"go\">???:?:?: 0x1048ce0d3 in ??? (crash.roc)</span>\n<span class=\"go\">???:?:?: 0x1049157d7 in ??? (crash.roc)</span>\n<span class=\"go\">???:?:?: 0x1048d629b in ??? (crash.roc)</span>\n<span class=\"go\">???:?:?: 0x1048ab05f in ??? (crash.roc)</span>\n<span class=\"go\">???:?:?: 0x1048a83fb in ??? (crash.roc)</span>\n<span class=\"go\">???:?:?: 0x1048a7edf in ??? (crash.roc)</span>\n<span class=\"go\">???:?:?: 0x104c04eab in ??? (crash.roc)</span>\n<span class=\"go\">???:?:?: 0x181ddab97 in ??? (???)</span>\n<span class=\"go\">???:?:?: 0x0 in ??? (???)</span>\n</code></pre></div>",
        "id": 563262248,
        "sender_full_name": "Matthieu Pizenberg",
        "timestamp": 1765479342
    },
    {
        "content": "<p>I suppose this is a bug related to the platform, but I don’t know maybe it’s also related to the type checking or interpreter since there is this weird interaction with the <code>List.append</code> function? I’ve tried using the stdin with other functions and haven’t found another that also triggers the panic. I just found <code>append</code>.</p>\n<p>So not sure where to open an issue for this one.</p>",
        "id": 563262641,
        "sender_full_name": "Matthieu Pizenberg",
        "timestamp": 1765479472
    },
    {
        "content": "<p>I'll investigate!</p>",
        "id": 563277514,
        "sender_full_name": "Richard Feldman",
        "timestamp": 1765484881
    },
    {
        "content": "<p><a href=\"https://github.com/roc-lang/roc/pull/8635\">https://github.com/roc-lang/roc/pull/8635</a> should fix this</p>",
        "id": 563286248,
        "sender_full_name": "Richard Feldman",
        "timestamp": 1765488753
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"361169\">Anton</span> has marked this topic as resolved.</p>",
        "id": 563430386,
        "sender_full_name": "Notification Bot",
        "timestamp": 1765532195
    }
]