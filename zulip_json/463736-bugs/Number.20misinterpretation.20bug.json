[
    {
        "content": "<p>Getting unexpected results from:</p>\n<div class=\"codehilite\" data-code-language=\"Haskell\"><pre><span></span><code><span class=\"nf\">app</span><span class=\"w\"> </span><span class=\"p\">[</span><span class=\"n\">main</span><span class=\"o\">!</span><span class=\"p\">]</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\"> </span><span class=\"n\">pf</span><span class=\"kt\">:</span><span class=\"w\"> </span><span class=\"n\">platform</span><span class=\"w\"> </span><span class=\"s\">\"../roc/test/fx/platform/main.roc\"</span><span class=\"w\"> </span><span class=\"p\">}</span>\n\n<span class=\"kr\">import</span><span class=\"w\"> </span><span class=\"nn\">pf.Stdout</span>\n\n<span class=\"nf\">main</span><span class=\"o\">!</span><span class=\"w\"> </span><span class=\"ow\">=</span><span class=\"w\"> </span><span class=\"o\">||</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">    </span><span class=\"n\">result</span><span class=\"w\"> </span><span class=\"ow\">=</span><span class=\"w\"> </span><span class=\"n\">sum_lambda</span><span class=\"p\">(</span><span class=\"mi\">2400</span><span class=\"p\">)</span>\n\n<span class=\"w\">    </span><span class=\"n\">dbg</span><span class=\"w\"> </span><span class=\"n\">result</span>\n<span class=\"w\">    </span><span class=\"kt\">Stdout</span><span class=\"o\">.</span><span class=\"n\">line</span><span class=\"o\">!</span><span class=\"p\">(</span><span class=\"s\">\"Stdout: ${result.to_str()}\"</span><span class=\"p\">)</span>\n<span class=\"p\">}</span>\n\n<span class=\"nf\">sum_lambda</span><span class=\"w\"> </span><span class=\"kt\">:</span><span class=\"w\"> </span><span class=\"kt\">U64</span><span class=\"w\"> </span><span class=\"ow\">-&gt;</span><span class=\"w\"> </span><span class=\"kt\">U64</span>\n<span class=\"nf\">sum_lambda</span><span class=\"w\"> </span><span class=\"ow\">=</span><span class=\"w\"> </span><span class=\"o\">|</span><span class=\"n\">num</span><span class=\"o\">|</span><span class=\"w\"> </span><span class=\"n\">sum</span><span class=\"p\">(</span><span class=\"n\">num</span><span class=\"p\">)</span>\n\n<span class=\"o\">#</span><span class=\"w\"> </span><span class=\"n\">sum</span><span class=\"w\"> </span><span class=\"kt\">:</span><span class=\"w\"> </span><span class=\"kt\">U64</span><span class=\"w\"> </span><span class=\"ow\">-&gt;</span><span class=\"w\"> </span><span class=\"kt\">U64</span>\n<span class=\"nf\">sum</span><span class=\"w\"> </span><span class=\"ow\">=</span><span class=\"w\"> </span><span class=\"o\">|</span><span class=\"n\">num</span><span class=\"o\">|</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">    </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"o\">+</span><span class=\"w\"> </span><span class=\"n\">num</span>\n<span class=\"p\">}</span>\n</code></pre></div>\n<p>Output:</p>\n<div class=\"codehilite\"><pre><span></span><code>ROC DBG: 2400\nStdout: 1923270417758289920\n</code></pre></div>\n<p>Works correctly when I comment out the <code>sum_lambda</code> type:</p>\n<div class=\"codehilite\"><pre><span></span><code>ROC DBG: 2400\nStdout: 2400.0\n</code></pre></div>\n<p>and also when I uncomment the type of <code>sum</code>:</p>\n<div class=\"codehilite\"><pre><span></span><code>ROC DBG: 2400\nStdout: 2400\n</code></pre></div>\n<p>I can see the same problem for all number types - except <code>Dec</code>.<br>\nUsing current \"Roc compiler version debug-9a5eb3c9\"</p>",
        "id": 561017438,
        "sender_full_name": "Artur Domurad",
        "timestamp": 1764523984
    },
    {
        "content": "<p>I think it's a double decref bug -- is my guess</p>",
        "id": 561017721,
        "sender_full_name": "Luke Boswell",
        "timestamp": 1764524224
    },
    {
        "content": "<p>Hopefully my current patches will resolve this class of bugs more generally</p>",
        "id": 561017744,
        "sender_full_name": "Luke Boswell",
        "timestamp": 1764524243
    },
    {
        "content": "<p>Or maybe there is something going funny with the type annotation</p>",
        "id": 561017788,
        "sender_full_name": "Luke Boswell",
        "timestamp": 1764524275
    },
    {
        "content": "<p>I can look into it after Luke's stuff lands</p>",
        "id": 561018092,
        "sender_full_name": "Richard Feldman",
        "timestamp": 1764524579
    }
]