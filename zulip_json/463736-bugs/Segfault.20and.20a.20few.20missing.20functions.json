[
    {
        "content": "<p>Hi there,<br>\nI'm still trying to get AoC 2025 Day 01 to work.<br>\nI was missing <code>List.split_on</code> and <code>List.map_try</code> so I tried to implement them.<br>\nIt took me a while but I managed to have zero compilation error or warning. However, I'm getting a segfault now:</p>\n<p>Here's my full program:</p>\n<div class=\"codehilite\" data-code-language=\"Ruby\"><pre><span></span><code><span class=\"n\">app</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">main!</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\"> </span><span class=\"ss\">pf</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"n\">platform</span><span class=\"w\"> </span><span class=\"s2\">\"https://github.com/lukewilliamboswell/roc-platform-template-zig/releases/download/0.3/98T93wthPgoBRLYtPTT4RBBsQunrfDG94gihPf1zYYmE.tar.zst\"</span><span class=\"w\"> </span><span class=\"p\">}</span>\n\n<span class=\"n\">import</span><span class=\"w\"> </span><span class=\"n\">pf</span><span class=\"o\">.</span><span class=\"n\">Stdout</span>\n\n<span class=\"n\">data</span><span class=\"w\"> </span><span class=\"o\">=</span>\n<span class=\"w\">    </span><span class=\"p\">\\\\</span><span class=\"no\">L50</span>\n<span class=\"w\">    </span><span class=\"p\">\\\\</span><span class=\"no\">L12</span>\n<span class=\"w\">    </span><span class=\"p\">\\\\</span><span class=\"no\">R13</span>\n<span class=\"w\">    </span><span class=\"p\">\\\\</span><span class=\"no\">L1</span>\n<span class=\"w\">    </span><span class=\"p\">\\\\</span><span class=\"no\">L5</span>\n<span class=\"w\">    </span><span class=\"p\">\\\\</span><span class=\"no\">R5</span>\n\n\n<span class=\"ss\">parse_instruction</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"no\">List</span><span class=\"p\">(</span><span class=\"no\">U8</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"o\">-&gt;</span><span class=\"w\"> </span><span class=\"no\">Try</span><span class=\"p\">(</span><span class=\"no\">I32</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">_</span><span class=\"p\">)</span>\n<span class=\"n\">parse_instruction</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"o\">|</span><span class=\"n\">chars</span><span class=\"o\">|</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">    </span><span class=\"n\">match</span><span class=\"w\"> </span><span class=\"n\">chars</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">        </span><span class=\"o\">[]</span><span class=\"w\"> </span><span class=\"o\">=&gt;</span><span class=\"w\"> </span><span class=\"no\">Err</span><span class=\"p\">(</span><span class=\"no\">ParsingError</span><span class=\"p\">)</span>\n<span class=\"w\">        </span><span class=\"o\">[</span><span class=\"n\">c</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"o\">..</span><span class=\"n\">rest</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">=&gt;</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">            </span><span class=\"n\">num_str</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"no\">Str</span><span class=\"o\">.</span><span class=\"n\">from_utf8</span><span class=\"p\">(</span><span class=\"n\">rest</span><span class=\"p\">)?</span>\n<span class=\"w\">            </span><span class=\"n\">num</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"no\">I32</span><span class=\"o\">.</span><span class=\"n\">from_str</span><span class=\"p\">(</span><span class=\"n\">num_str</span><span class=\"p\">)?</span>\n<span class=\"w\">            </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"o\">==</span><span class=\"w\"> </span><span class=\"s1\">'L'</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\"> </span><span class=\"no\">Ok</span><span class=\"p\">(</span><span class=\"o\">-</span><span class=\"n\">num</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"p\">}</span><span class=\"w\"> </span><span class=\"k\">else</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\"> </span><span class=\"no\">Ok</span><span class=\"p\">(</span><span class=\"n\">num</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"p\">}</span>\n<span class=\"w\">        </span><span class=\"p\">}</span>\n<span class=\"w\">    </span><span class=\"p\">}</span>\n<span class=\"p\">}</span>\n\n<span class=\"ss\">count_zeroes</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"no\">List</span><span class=\"p\">(</span><span class=\"no\">I32</span><span class=\"p\">),</span><span class=\"w\"> </span><span class=\"no\">I32</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"no\">U32</span><span class=\"w\"> </span><span class=\"o\">-&gt;</span><span class=\"w\"> </span><span class=\"no\">U32</span>\n<span class=\"n\">count_zeroes</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"o\">|</span><span class=\"n\">instructions</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">pos</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">count</span><span class=\"o\">|</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">    </span><span class=\"n\">match</span><span class=\"w\"> </span><span class=\"n\">instructions</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">        </span><span class=\"o\">[]</span><span class=\"w\"> </span><span class=\"o\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">count</span>\n<span class=\"w\">        </span><span class=\"o\">[</span><span class=\"n\">inst</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"o\">..</span><span class=\"n\">rest</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">=&gt;</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">            </span><span class=\"n\">new_pos</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">pos</span><span class=\"w\"> </span><span class=\"o\">+</span><span class=\"w\"> </span><span class=\"n\">inst</span>\n<span class=\"w\">            </span><span class=\"n\">new_count</span><span class=\"w\"> </span><span class=\"o\">=</span>\n<span class=\"w\">                </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"n\">new_pos</span><span class=\"w\"> </span><span class=\"o\">%</span><span class=\"w\"> </span><span class=\"mi\">100</span><span class=\"w\"> </span><span class=\"o\">==</span><span class=\"w\"> </span><span class=\"mi\">0</span>\n<span class=\"w\">                    </span><span class=\"n\">count</span><span class=\"w\"> </span><span class=\"o\">+</span><span class=\"w\"> </span><span class=\"mi\">1</span>\n<span class=\"w\">                </span><span class=\"k\">else</span>\n<span class=\"w\">                    </span><span class=\"n\">count</span>\n<span class=\"w\">            </span><span class=\"n\">rest</span><span class=\"o\">-&gt;</span><span class=\"n\">count_zeroes</span><span class=\"p\">(</span><span class=\"n\">new_pos</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">new_count</span><span class=\"p\">)</span>\n<span class=\"w\">        </span><span class=\"p\">}</span>\n<span class=\"w\">    </span><span class=\"p\">}</span>\n<span class=\"p\">}</span>\n\n<span class=\"ss\">split_on</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"no\">List</span><span class=\"p\">(</span><span class=\"n\">a</span><span class=\"p\">),</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"o\">-&gt;</span><span class=\"w\"> </span><span class=\"no\">List</span><span class=\"p\">(</span><span class=\"no\">List</span><span class=\"p\">(</span><span class=\"n\">a</span><span class=\"p\">))</span><span class=\"w\"> </span><span class=\"n\">where</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">a</span><span class=\"o\">.</span><span class=\"n\">is_eq</span><span class=\"w\"> </span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"o\">-&gt;</span><span class=\"w\"> </span><span class=\"no\">Bool</span><span class=\"o\">]</span>\n<span class=\"n\">split_on</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"o\">|</span><span class=\"n\">elements</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">delimiter</span><span class=\"o\">|</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">    </span><span class=\"n\">help</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"o\">|</span><span class=\"n\">remaining</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">chunks</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">current_chunk</span><span class=\"o\">|</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">        </span><span class=\"n\">match</span><span class=\"w\"> </span><span class=\"n\">remaining</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">            </span><span class=\"o\">[]</span><span class=\"w\"> </span><span class=\"o\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">chunks</span><span class=\"o\">.</span><span class=\"n\">append</span><span class=\"p\">(</span><span class=\"n\">current_chunk</span><span class=\"p\">)</span>\n<span class=\"w\">            </span><span class=\"o\">[</span><span class=\"n\">x</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"o\">..</span><span class=\"n\">rest</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">=&gt;</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">                </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">==</span><span class=\"w\"> </span><span class=\"n\">delimiter</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">                    </span><span class=\"n\">help</span><span class=\"p\">(</span><span class=\"n\">rest</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">chunks</span><span class=\"o\">.</span><span class=\"n\">append</span><span class=\"p\">(</span><span class=\"n\">current_chunk</span><span class=\"p\">),</span><span class=\"w\"> </span><span class=\"o\">[]</span><span class=\"p\">)</span>\n<span class=\"w\">                </span><span class=\"p\">}</span><span class=\"w\"> </span><span class=\"k\">else</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">                    </span><span class=\"n\">help</span><span class=\"p\">(</span><span class=\"n\">rest</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">chunks</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">current_chunk</span><span class=\"o\">.</span><span class=\"n\">append</span><span class=\"p\">(</span><span class=\"n\">x</span><span class=\"p\">))</span>\n<span class=\"w\">                </span><span class=\"p\">}</span>\n<span class=\"w\">            </span><span class=\"p\">}</span>\n<span class=\"w\">        </span><span class=\"p\">}</span>\n<span class=\"w\">    </span><span class=\"p\">}</span>\n<span class=\"w\">    </span><span class=\"n\">help</span><span class=\"p\">(</span><span class=\"n\">elements</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"o\">[]</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"o\">[]</span><span class=\"p\">)</span>\n<span class=\"p\">}</span>\n\n<span class=\"ss\">map_try</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"no\">List</span><span class=\"p\">(</span><span class=\"n\">a</span><span class=\"p\">),</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"o\">-&gt;</span><span class=\"w\"> </span><span class=\"no\">Try</span><span class=\"p\">(</span><span class=\"n\">b</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"p\">))</span><span class=\"w\"> </span><span class=\"o\">-&gt;</span><span class=\"w\"> </span><span class=\"no\">Try</span><span class=\"p\">(</span><span class=\"no\">List</span><span class=\"p\">(</span><span class=\"n\">b</span><span class=\"p\">),</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"p\">)</span>\n<span class=\"n\">map_try</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"o\">|</span><span class=\"n\">list</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">to_result_fun</span><span class=\"o\">|</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">    </span><span class=\"n\">list</span><span class=\"o\">-&gt;</span><span class=\"n\">walk_try</span><span class=\"p\">(</span>\n<span class=\"w\">        </span><span class=\"o\">[]</span><span class=\"p\">,</span>\n<span class=\"w\">        </span><span class=\"o\">|</span><span class=\"n\">state</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">elem</span><span class=\"o\">|</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">            </span><span class=\"n\">match</span><span class=\"w\"> </span><span class=\"n\">to_result_fun</span><span class=\"p\">(</span><span class=\"n\">elem</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">                </span><span class=\"no\">Ok</span><span class=\"p\">(</span><span class=\"n\">ok</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"o\">=&gt;</span><span class=\"w\"> </span><span class=\"no\">Ok</span><span class=\"p\">(</span><span class=\"n\">state</span><span class=\"o\">-&gt;</span><span class=\"no\">List</span><span class=\"o\">.</span><span class=\"n\">append</span><span class=\"p\">(</span><span class=\"n\">ok</span><span class=\"p\">))</span>\n<span class=\"w\">                </span><span class=\"no\">Err</span><span class=\"p\">(</span><span class=\"n\">b</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"o\">=&gt;</span><span class=\"w\"> </span><span class=\"no\">Err</span><span class=\"p\">(</span><span class=\"n\">b</span><span class=\"p\">)</span>\n<span class=\"w\">            </span><span class=\"p\">}</span>\n<span class=\"w\">        </span><span class=\"p\">}</span>\n<span class=\"w\">    </span><span class=\"p\">)</span>\n<span class=\"p\">}</span>\n\n<span class=\"ss\">walk_try</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"no\">List</span><span class=\"p\">(</span><span class=\"n\">a</span><span class=\"p\">),</span><span class=\"w\"> </span><span class=\"n\">s</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">s</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"o\">-&gt;</span><span class=\"w\"> </span><span class=\"no\">Try</span><span class=\"p\">(</span><span class=\"n\">s</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"p\">))</span><span class=\"w\"> </span><span class=\"o\">-&gt;</span><span class=\"w\"> </span><span class=\"no\">Try</span><span class=\"p\">(</span><span class=\"n\">s</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"p\">)</span>\n<span class=\"n\">walk_try</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"o\">|</span><span class=\"n\">list</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">init</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">func</span><span class=\"o\">|</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">    </span><span class=\"n\">match</span><span class=\"w\"> </span><span class=\"n\">list</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">        </span><span class=\"o\">[]</span><span class=\"w\"> </span><span class=\"o\">=&gt;</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\"> </span><span class=\"no\">Ok</span><span class=\"p\">(</span><span class=\"n\">init</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"p\">}</span>\n<span class=\"w\">        </span><span class=\"o\">[</span><span class=\"n\">val</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"o\">..</span><span class=\"n\">rest</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">=&gt;</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">            </span><span class=\"n\">maybe_state</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">func</span><span class=\"p\">(</span><span class=\"n\">init</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">val</span><span class=\"p\">)</span>\n<span class=\"w\">            </span><span class=\"n\">match</span><span class=\"w\"> </span><span class=\"n\">maybe_state</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">                </span><span class=\"no\">Ok</span><span class=\"p\">(</span><span class=\"n\">state</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"o\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">walk_try</span><span class=\"p\">(</span><span class=\"n\">rest</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">state</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">func</span><span class=\"p\">)</span>\n<span class=\"w\">                </span><span class=\"no\">Err</span><span class=\"p\">(</span><span class=\"n\">b</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"o\">=&gt;</span><span class=\"w\"> </span><span class=\"no\">Err</span><span class=\"p\">(</span><span class=\"n\">b</span><span class=\"p\">)</span>\n<span class=\"w\">            </span><span class=\"p\">}</span>\n<span class=\"w\">        </span><span class=\"p\">}</span>\n<span class=\"w\">    </span><span class=\"p\">}</span>\n<span class=\"p\">}</span>\n\n<span class=\"n\">main!</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"no\">List</span><span class=\"w\"> </span><span class=\"no\">Str</span><span class=\"w\"> </span><span class=\"o\">-&gt;</span><span class=\"w\"> </span><span class=\"no\">Try</span><span class=\"p\">({},</span><span class=\"w\"> </span><span class=\"no\">Exit</span><span class=\"p\">)</span>\n<span class=\"n\">main!</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"o\">|</span><span class=\"n\">_args</span><span class=\"o\">|</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">    </span><span class=\"n\">maybe_instructions</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">to_utf8</span><span class=\"p\">()</span><span class=\"o\">-&gt;</span><span class=\"n\">split_on</span><span class=\"p\">(</span><span class=\"s1\">'</span><span class=\"se\">\\n</span><span class=\"s1\">'</span><span class=\"p\">)</span><span class=\"o\">-&gt;</span><span class=\"n\">map_try</span><span class=\"p\">(</span><span class=\"n\">parse_instruction</span><span class=\"p\">)</span>\n<span class=\"w\">    </span><span class=\"n\">match</span><span class=\"w\"> </span><span class=\"n\">maybe_instructions</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">        </span><span class=\"no\">Ok</span><span class=\"p\">(</span><span class=\"n\">instructions</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"o\">=&gt;</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">            </span><span class=\"n\">result1</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">instructions</span><span class=\"o\">-&gt;</span><span class=\"n\">count_zeroes</span><span class=\"p\">(</span><span class=\"mi\">50</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"p\">)</span>\n<span class=\"w\">            </span><span class=\"no\">Stdout</span><span class=\"o\">.</span><span class=\"n\">line!</span><span class=\"p\">(</span><span class=\"n\">result1</span><span class=\"o\">.</span><span class=\"n\">to_str</span><span class=\"p\">())</span>\n<span class=\"w\">            </span><span class=\"no\">Ok</span><span class=\"p\">({})</span>\n<span class=\"w\">        </span><span class=\"p\">}</span>\n<span class=\"w\">        </span><span class=\"n\">_</span><span class=\"w\"> </span><span class=\"o\">=&gt;</span><span class=\"w\"> </span><span class=\"no\">Err</span><span class=\"p\">(</span><span class=\"no\">Exit</span><span class=\"p\">(</span><span class=\"mi\">1</span><span class=\"p\">))</span>\n<span class=\"w\">    </span><span class=\"p\">}</span>\n<span class=\"p\">}</span>\n</code></pre></div>\n<p>Here's the segfault:</p>\n<div class=\"codehilite\"><pre><span></span><code>error: Child process /Users/ageron/Library/Caches/roc/e59c636351ad64c25ba81dca340f7248/temp/roc-tmp-9Tj9smFRS15c5UvOO30epYt9BZ2CYQ9G/roc_run_994723065 killed by signal: 11\nerror: Child process crashed with segmentation fault (SIGSEGV)\n</code></pre></div>\n<p>I'm running the latest code compiled from source (<code>Roc compiler version debug-b578eea3</code>).</p>\n<p>Thanks for your help!</p>",
        "id": 561773634,
        "sender_full_name": "Aurélien Geron",
        "timestamp": 1764807594
    },
    {
        "content": "<p>Is that type annotation on main correct? <code>main!: List Str -&gt; Try({}, Exit)</code></p>",
        "id": 561774027,
        "sender_full_name": "Luke Boswell",
        "timestamp": 1764807862
    },
    {
        "content": "<p>I think it should be </p>\n<div class=\"codehilite\"><pre><span></span><code>main! : List(Str) =&gt; Try({}, [Exit(I32)])\n</code></pre></div>",
        "id": 561774093,
        "sender_full_name": "Luke Boswell",
        "timestamp": 1764807899
    },
    {
        "content": "<p>Oh good point, thanks. I commented it out and still got the segfault</p>",
        "id": 561774154,
        "sender_full_name": "Aurélien Geron",
        "timestamp": 1764807937
    },
    {
        "content": "<p>Are you able to post a copy of your cli running <code>roc check</code> <code>roc test</code> and <code>roc ...</code></p>",
        "id": 561774162,
        "sender_full_name": "Luke Boswell",
        "timestamp": 1764807943
    },
    {
        "content": "<p>Sure. Here's <code>roc check</code>:</p>\n<div class=\"codehilite\"><pre><span></span><code>-- BAD LIST REST PATTERN SYNTAX ------------------\n\nList rest patterns should use the `.. as name` syntax, not `..name`.\nFor example, use `[first, .. as rest]` instead of `[first, ..rest]`.\n\n   ┌─ /Users/ageron/dev/roc/aoc2025-roc/day01.roc:18:13\n   │\n18 │         [c, ..rest] =&gt; {\n   │             ^^^^^^\n\n-- BAD LIST REST PATTERN SYNTAX ------------------\n\nList rest patterns should use the `.. as name` syntax, not `..name`.\nFor example, use `[first, .. as rest]` instead of `[first, ..rest]`.\n\n   ┌─ /Users/ageron/dev/roc/aoc2025-roc/day01.roc:30:16\n   │\n30 │         [inst, ..rest] =&gt; {\n   │                ^^^^^^\n\n-- BAD LIST REST PATTERN SYNTAX ------------------\n\nList rest patterns should use the `.. as name` syntax, not `..name`.\nFor example, use `[first, .. as rest]` instead of `[first, ..rest]`.\n\n   ┌─ /Users/ageron/dev/roc/aoc2025-roc/day01.roc:47:17\n   │\n47 │             [x, ..rest] =&gt; {\n   │                 ^^^^^^\n\n-- BAD LIST REST PATTERN SYNTAX ------------------\n\nList rest patterns should use the `.. as name` syntax, not `..name`.\nFor example, use `[first, .. as rest]` instead of `[first, ..rest]`.\n\n   ┌─ /Users/ageron/dev/roc/aoc2025-roc/day01.roc:76:15\n   │\n76 │         [val, ..rest] =&gt; {\n   │               ^^^^^^\n</code></pre></div>",
        "id": 561774231,
        "sender_full_name": "Aurélien Geron",
        "timestamp": 1764808002
    },
    {
        "content": "<p><code>roc test</code> gives a segfault:</p>\n<div class=\"codehilite\"><pre><span></span><code>zsh: segmentation fault  roc2 test day01.roc\n</code></pre></div>\n<p>Not sure whether it matters but I'm using a symlink named <code>roc2</code>.</p>",
        "id": 561774355,
        "sender_full_name": "Aurélien Geron",
        "timestamp": 1764808099
    },
    {
        "content": "<p>I tried replacing <code>..rest</code> with <code>.. as rest</code>, and now <code>roc check</code> gives no error, but I still get the segfault.</p>",
        "id": 561774467,
        "sender_full_name": "Aurélien Geron",
        "timestamp": 1764808182
    },
    {
        "content": "<p>My guess is the segfault is refcounting related... shouldn't be too hard to find.</p>",
        "id": 561774547,
        "sender_full_name": "Luke Boswell",
        "timestamp": 1764808248
    },
    {
        "content": "<p>If you're interested to explore yourself, you can build roc with refcount tracing <code>zig build roc -Dtrace-refcount</code> and if you build a debug version of the zig platform template it also has refcount tracing... then when you run you will get a detailed trace of every allocation (incref/decref)</p>",
        "id": 561774642,
        "sender_full_name": "Luke Boswell",
        "timestamp": 1764808322
    },
    {
        "content": "<p>Cool, thanks Luke</p>",
        "id": 561774683,
        "sender_full_name": "Aurélien Geron",
        "timestamp": 1764808353
    },
    {
        "content": "<p>I normally feed that trace into claude and a few moment later have narrowed down which builtin isn't following the correct ownership semantics</p>",
        "id": 561774703,
        "sender_full_name": "Luke Boswell",
        "timestamp": 1764808370
    },
    {
        "content": "<p>Write a test to reproduce, then fix, then verify etc... <span aria-label=\"smiley\" class=\"emoji emoji-1f603\" role=\"img\" title=\"smiley\">:smiley:</span></p>",
        "id": 561774726,
        "sender_full_name": "Luke Boswell",
        "timestamp": 1764808397
    },
    {
        "content": "<p>A couple questions:</p>\n<ul>\n<li>Where can I find the list of builtin functions that are currently implemented in the new compiler?</li>\n<li>Am I supposed to use <code>.. as rest</code> or <code>..rest</code> in the new compiler?</li>\n</ul>",
        "id": 561774740,
        "sender_full_name": "Aurélien Geron",
        "timestamp": 1764808410
    },
    {
        "content": "<p>builtins currently implemented <a href=\"https://github.com/roc-lang/roc/blob/bb17e26f7bd1aa51ce8e18a2a795eab9d07369a9/src/build/roc/Builtin.roc#L4\">https://github.com/roc-lang/roc/blob/bb17e26f7bd1aa51ce8e18a2a795eab9d07369a9/src/build/roc/Builtin.roc#L4</a></p>",
        "id": 561774914,
        "sender_full_name": "Luke Boswell",
        "timestamp": 1764808504
    },
    {
        "content": "<p>about the rest thing... I'm not sure -- the discussions are many and so these things get blurry. I would look into the code, or maybe try it out on a smaller test program.</p>",
        "id": 561774971,
        "sender_full_name": "Luke Boswell",
        "timestamp": 1764808532
    },
    {
        "content": "<p>I ran <code>zig build roc -Dtrace-refcount</code> and now when I run <code>roc day01.roc</code> I get:</p>\n<div class=\"codehilite\"><pre><span></span><code>[REFCOUNT] INCREF list (copyToPtr) ptr=0x101460018 len=1 rc=1 slice=0 elems_rc=1\nerror: Child process /Users/ageron/Library/Caches/roc/e59c636351ad64c25ba81dca340f7248/temp/roc-tmp-2q9ZB7TrXASkuFMITQ3Xqvx7AXG5qNWK/roc_run_994723065 killed by signal: 11\nerror: Child process crashed with segmentation fault (SIGSEGV)\n</code></pre></div>\n<blockquote>\n<p>and if you build a debug version of the zig platform template</p>\n</blockquote>\n<p>How can I do that?</p>",
        "id": 561775214,
        "sender_full_name": "Aurélien Geron",
        "timestamp": 1764808703
    },
    {
        "content": "<p>Clone the template repository, then <code>zig build</code> you can also do <code>zig build native</code> which is quicker because it only builds the libraries for your current system and doesn't cross-compile for all the supported os/arches</p>",
        "id": 561775395,
        "sender_full_name": "Luke Boswell",
        "timestamp": 1764808802
    },
    {
        "content": "<p>Use a relative path to the <code>../roc-platform-template-zig/platform/main.roc</code> in your test app</p>",
        "id": 561775449,
        "sender_full_name": "Luke Boswell",
        "timestamp": 1764808840
    },
    {
        "content": "<p>I'll try that after lunch, thanks Luke.</p>",
        "id": 561775512,
        "sender_full_name": "Aurélien Geron",
        "timestamp": 1764808898
    }
]