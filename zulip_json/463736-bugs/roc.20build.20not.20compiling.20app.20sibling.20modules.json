[
    {
        "content": "<ul>\n<li><code>roc</code> goes through <code>setupSharedMemoryWithModuleEnv</code> and <strong>explicitly compiles sibling modules before app canonicalization</strong>, based on imports extracted from the app AST.<ul>\n<li>File: <code>/home/nandi/code/roc/src/cli/main.zig</code> (see the section starting with “Compile sibling .roc files BEFORE app canonicalization.”)</li>\n</ul>\n</li>\n<li><code>roc build</code> uses <code>compileAndSerializeModulesForEmbedding</code>, which <strong>only compiles platform modules + app</strong>, and does <strong>not</strong> compile app sibling modules.<ul>\n<li>File: <code>/home/nandi/code/roc/src/cli/main.zig</code> inside <code>compileAndSerializeModulesForEmbedding</code>.</li>\n</ul>\n</li>\n</ul>",
        "id": 569151617,
        "sender_full_name": "nandi",
        "timestamp": 1768956228
    },
    {
        "content": "<p>Is this a question or bug report?</p>",
        "id": 569178921,
        "sender_full_name": "Luke Boswell",
        "timestamp": 1768976324
    },
    {
        "content": "<p>Have you observed some behaviour that isn't right?</p>",
        "id": 569178941,
        "sender_full_name": "Luke Boswell",
        "timestamp": 1768976341
    },
    {
        "content": "<p>Is it a bug that <code>roc build</code> doesnt compile sibling modules?</p>",
        "id": 569180732,
        "sender_full_name": "nandi",
        "timestamp": 1768977427
    },
    {
        "content": "<p>I don't understand what you mean by doesn't compile sibling modules. </p>\n<p>Like if I have an app, with an <code>import Foo</code> in it -- you can't use <code>Foo</code> with <code>roc build app.roc</code> but you can with <code>roc app.roc</code>?</p>",
        "id": 569181657,
        "sender_full_name": "Luke Boswell",
        "timestamp": 1768978001
    },
    {
        "content": "<p>It has to be in platform folder in <code>roc build</code></p>",
        "id": 569182363,
        "sender_full_name": "nandi",
        "timestamp": 1768978423
    },
    {
        "content": "<p>Which kinda breaks for modules that aren't in platforms</p>",
        "id": 569182426,
        "sender_full_name": "nandi",
        "timestamp": 1768978464
    },
    {
        "content": "<p>I've reproduced this... should be able to fix it soon</p>",
        "id": 569596552,
        "sender_full_name": "Luke Boswell",
        "timestamp": 1769119347
    },
    {
        "content": "<p>ok <em>fixed</em> it... but going to take a side quest to refactor things and hopefully eliminate this kind of bug from happening again</p>",
        "id": 569603792,
        "sender_full_name": "Luke Boswell",
        "timestamp": 1769122699
    },
    {
        "content": "<p>what do you mean \"this kind of bug\"?</p>",
        "id": 569604330,
        "sender_full_name": "nandi",
        "timestamp": 1769122951
    },
    {
        "content": "<p>Where there are different code paths <code>roc check</code> <code>roc test</code> <code>roc build</code> etc doing the same thing in different ways</p>",
        "id": 569605334,
        "sender_full_name": "Luke Boswell",
        "timestamp": 1769123505
    },
    {
        "content": "<p>Just  refactor the common parts into helpers and keep things DRY</p>",
        "id": 569605421,
        "sender_full_name": "Luke Boswell",
        "timestamp": 1769123545
    },
    {
        "content": "<p>I had noticed some different behavior with <code>roc build</code> that was unexpected but assumed I was Doing It Wrong.  i think i hit this, though</p>",
        "id": 569607519,
        "sender_full_name": "Rick Hull",
        "timestamp": 1769124745
    },
    {
        "content": "<p><a href=\"https://github.com/roc-lang/roc/pull/9072\">https://github.com/roc-lang/roc/pull/9072</a></p>",
        "id": 569612189,
        "sender_full_name": "Luke Boswell",
        "timestamp": 1769127031
    }
]