[
    {
        "content": "<p>x86_64 linux</p>\n<p>Commit: <code>719fcae1151c0f1ecd30894366cbe4c9e2f99397</code></p>\n<p>Adding a <code>std.Thread.spawn</code> call...</p>\n<div class=\"codehilite\" data-code-language=\"Zig\"><pre><span></span><code><span class=\"k\">fn</span><span class=\"w\"> </span><span class=\"n\">hostedStdoutLine</span><span class=\"p\">(</span><span class=\"n\">ops</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">*</span><span class=\"n\">builtins</span><span class=\"p\">.</span><span class=\"n\">host_abi</span><span class=\"p\">.</span><span class=\"n\">RocOps</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">ret_ptr</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">*</span><span class=\"n\">anyopaque</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">args_ptr</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">*</span><span class=\"n\">anyopaque</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"n\">callconv</span><span class=\"p\">(.</span><span class=\"n\">c</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"kt\">void</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">    </span><span class=\"n\">_</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">ops</span><span class=\"p\">;</span>\n<span class=\"w\">    </span><span class=\"n\">_</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">ret_ptr</span><span class=\"p\">;</span>\n<span class=\"w\">    </span><span class=\"n\">_</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">args_ptr</span><span class=\"p\">;</span>\n\n<span class=\"w\">    </span><span class=\"c1\">// ...</span>\n\n<span class=\"w\">    </span><span class=\"kr\">const</span><span class=\"w\"> </span><span class=\"n\">thread_test</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"k\">struct</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">        </span><span class=\"k\">fn</span><span class=\"w\"> </span><span class=\"n\">worker</span><span class=\"p\">()</span><span class=\"w\"> </span><span class=\"kt\">void</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">            </span><span class=\"n\">std</span><span class=\"p\">.</span><span class=\"n\">Thread</span><span class=\"p\">.</span><span class=\"n\">sleep</span><span class=\"p\">(</span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"o\">*</span><span class=\"w\"> </span><span class=\"n\">std</span><span class=\"p\">.</span><span class=\"n\">time</span><span class=\"p\">.</span><span class=\"n\">ns_per_s</span><span class=\"p\">);</span>\n<span class=\"w\">        </span><span class=\"p\">}</span>\n<span class=\"w\">    </span><span class=\"p\">};</span>\n\n<span class=\"w\">    </span><span class=\"n\">_</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">std</span><span class=\"p\">.</span><span class=\"n\">Thread</span><span class=\"p\">.</span><span class=\"n\">spawn</span><span class=\"p\">(.{},</span><span class=\"w\"> </span><span class=\"n\">thread_test</span><span class=\"p\">.</span><span class=\"n\">worker</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"p\">.{})</span><span class=\"w\"> </span><span class=\"k\">catch</span><span class=\"w\"> </span><span class=\"p\">{};</span>\n\n<span class=\"w\">    </span><span class=\"c1\">// ...</span>\n<span class=\"p\">}</span>\n</code></pre></div>\n<p>Result: <code>thread 54669 panic: reached unreachable code</code></p>\n<div class=\"codehilite\"><pre><span></span><code>[anon@nixos:~/Projects/roc]$ zig build test\n[...tests fail...]\n\n[anon@nixos:~/Projects/roc]$ ./zig-out/bin/roc ./test/fx/app.roc\nthread 54669 panic: reached unreachable code\nerror: Child process /home/anon/.cache/roc/75fed07d9047282a9e6197f23853ba39/temp/roc-tmp-RmsPvqoZLOh3Y7e4JvbGzW1HSRiQC1uu/roc_run_3344319531 killed by signal: 11\nerror: Child process crashed with segmentation fault (SIGSEGV)\n</code></pre></div>\n<p>Then program exits, without continuing.</p>",
        "id": 561713970,
        "sender_full_name": "Scott Campbell",
        "timestamp": 1764782859
    },
    {
        "content": "<p>Hi <span class=\"user-mention\" data-user-id=\"683808\">@Scott Campbell</span>,<br>\nCan you make a github issue for this? It may be some time before we get to it, we're currently focused on advent of code related fixes and improvements.</p>",
        "id": 561717303,
        "sender_full_name": "Anton",
        "timestamp": 1764783765
    },
    {
        "content": "<p>Done!</p>\n<p><a href=\"https://github.com/roc-lang/roc/issues/8566\">#8566</a></p>\n<p>It's not urgent, I don't actually need threads yet.</p>\n<p>I can probably try to make do with some kind of single threaded event loop if needed, and zig's newish IO interface, for async style concurrent code. Then it'll be easy to swap out the implementation later.</p>\n<p>If it bothers me too much, I'll try grab a debugger and learn how to find zig segfaults...</p>",
        "id": 561791518,
        "sender_full_name": "Scott Campbell",
        "timestamp": 1764821484
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"683808\">Scott Campbell</span> has marked this topic as resolved.</p>",
        "id": 561792036,
        "sender_full_name": "Notification Bot",
        "timestamp": 1764821932
    }
]