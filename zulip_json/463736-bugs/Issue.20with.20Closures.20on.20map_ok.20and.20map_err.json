[
    {
        "content": "<p>Hi, I just rebuilt the compiler from source and while trying to implement map_ok and map_err I'm getting an error on the following:</p>\n<div class=\"codehilite\"><pre><span></span><code>main! = |args| {\n    identity = |a| a\n    swap_errs = |_| Exit(101)\n    init_try : Try(U32, [SomeError, ..others])\n    init_try = Ok(30) #Try.Err(SomeError)\n    final_try1 = map_err(init_try, swap_errs)\n    final_try2 = map_ok(init_try, identity)\n\n    Ok({})\n\n}\n\nmap_ok : Try(a, err), (a -&gt; b) -&gt; Try(b, err)\nmap_ok = |try, fn| {\n    match try {\n        Ok(ok_val) =&gt; Ok(fn(ok_val))\n        Err(e) =&gt; Err(e)\n    }\n}\n\nmap_err : Try(a, err_1), (err_1 -&gt; err_2) -&gt; Try(a, err_2)\nmap_err = |try, err_fn| {\n    match try {\n        Ok(ok) =&gt; Ok(ok)\n        Err(e) =&gt; Err(err_fn(e))\n    }\n}\n</code></pre></div>\n<p>Yields the following panicking stack trace:</p>\n<div class=\"codehilite\"><pre><span></span><code>thread 3865772 panic: trying to add var at rank 2, but current rank is 1\n???:?:?: 0x106346793 in _generalize.VarPool.addVarToRank (???)\n???:?:?: 0x10635031b in _Check.unifyWithCtx (???)\n???:?:?: 0x10620805b in _Check.unify (???)\n???:?:?: 0x10634963b in _Check.generateAnnoTypeInPlace (???)\n???:?:?: 0x10634979f in _Check.generateAnnoTypeInPlace (???)\n???:?:?: 0x10634af8b in _Check.generateAnnotationType (???)\n???:?:?: 0x1061fc7fb in _Check.checkDef (???)\n???:?:?: 0x106202aa3 in _Check.checkExpr (???)\n???:?:?: 0x106204893 in _Check.checkExpr (???)\n???:?:?: 0x10634e0cb in _Check.checkBlockStatements (???)\n???:?:?: 0x1061fd577 in _Check.checkExpr (???)\n???:?:?: 0x1062041db in _Check.checkExpr (???)\n???:?:?: 0x1061fd5e7 in _Check.checkExpr (???)\n???:?:?: 0x1061fc82b in _Check.checkDef (???)\n???:?:?: 0x10601fa8b in _Check.checkFile (???)\n???:?:?: 0x10602844f in _main.setupSharedMemoryWithModuleEnv (???)\n???:?:?: 0x10602f9f7 in _main.rocRun (???)\n???:?:?: 0x106184773 in _main.mainArgs (???)\n???:?:?: 0x106185bf3 in _main.main (???)\n???:?:?: 0x1061860fb in _main (???)\n???:?:?: 0x191628273 in ??? (???)\n???:?:?: 0x0 in ??? (???)\nzsh: abort      roc aoc_2025_01.roc\n</code></pre></div>\n<p>map_err or map_ok will panic in isolation, also tried with both an Ok as the original value and the commented out Err. All combinations result in this stack trace.</p>",
        "id": 561722787,
        "sender_full_name": "Edwin Santos",
        "timestamp": 1764785512
    }
]