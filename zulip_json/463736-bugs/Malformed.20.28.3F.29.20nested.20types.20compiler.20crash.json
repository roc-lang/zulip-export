[
    {
        "content": "<p>Ran into this issue during AoC. Here is a minimal repro.</p>\n<p>Bad source:</p>\n<div class=\"codehilite\" data-code-language=\"Elm\"><pre><span></span><code><span class=\"nv\">app</span><span class=\"w\"> </span><span class=\"p\">[</span><span class=\"nv\">main</span><span class=\"p\">]</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\"> </span><span class=\"nv\">pf</span><span class=\"nf\">:</span><span class=\"w\"> </span><span class=\"nv\">platform</span><span class=\"w\"> </span><span class=\"s\">\"https://github.com/roc-lang/basic-cli/releases/download/0.17.0/lZFLstMUCUvd5bjnnpYromZJXkQUrdhbva4xdBInicE.tar.br\"</span><span class=\"w\"> </span><span class=\"p\">}</span>\n\n<span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"nc\">pf.Stdout</span>\n\n<span class=\"kr\">main </span><span class=\"nf\">=</span>\n<span class=\"w\">    </span><span class=\"kt\">Stdout</span><span class=\"nf\">.</span><span class=\"nv\">line</span><span class=\"err\">!</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"kt\">Inspect</span><span class=\"nf\">.</span><span class=\"nv\">toStr</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"nv\">bar</span><span class=\"w\"> </span><span class=\"mi\">3</span><span class=\"p\">))</span>\n\n\n<span class=\"nv\">bar</span><span class=\"w\"> </span><span class=\"nf\">:</span><span class=\"w\"> </span><span class=\"kt\">U8</span><span class=\"w\"> </span><span class=\"nf\">-&gt;</span><span class=\"w\"> </span><span class=\"kt\">List</span><span class=\"w\"> </span><span class=\"kt\">List</span><span class=\"w\"> </span><span class=\"kt\">U8</span>\n<span class=\"nv\">bar</span><span class=\"w\"> </span><span class=\"nf\">=</span><span class=\"w\"> </span><span class=\"nf\">\\</span><span class=\"nv\">x</span><span class=\"w\"> </span><span class=\"nf\">-&gt;</span>\n<span class=\"w\">    </span><span class=\"p\">[[</span><span class=\"nv\">x</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"nv\">x</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"nv\">x</span><span class=\"p\">]]</span>\n</code></pre></div>\n<p>Running <code>roc check</code> on the above file yields</p>\n<div class=\"codehilite\"><pre><span></span><code>❯ roc check foo.roc\n0 errors and 0 warnings found in 25 ms\n</code></pre></div>\n<p>But trying to actually build or run that file will get you a crash, kind of... It actually hangs with this error message and has to be killed with <code>ctrl-c</code>:</p>\n<div class=\"codehilite\"><pre><span></span><code>❯ RUST_BACKTRACE=1 roc build foo.roc\nthread &#39;&lt;unnamed&gt;&#39; panicked at crates/compiler/mono/src/ir.rs:6166:56:\ncalled `Option::unwrap()` on a `None` value\nstack backtrace:\nnote: Some details are omitted, run with `RUST_BACKTRACE=full` for a verbose backtrace.\n^C\n</code></pre></div>\n<p>Changing the type signature of <code>bar</code> to add parens to the output type fixes this:</p>\n<div class=\"codehilite\" data-code-language=\"Elm\"><pre><span></span><code><span class=\"nv\">app</span><span class=\"w\"> </span><span class=\"p\">[</span><span class=\"nv\">main</span><span class=\"p\">]</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\"> </span><span class=\"nv\">pf</span><span class=\"nf\">:</span><span class=\"w\"> </span><span class=\"nv\">platform</span><span class=\"w\"> </span><span class=\"s\">\"https://github.com/roc-lang/basic-cli/releases/download/0.17.0/lZFLstMUCUvd5bjnnpYromZJXkQUrdhbva4xdBInicE.tar.br\"</span><span class=\"w\"> </span><span class=\"p\">}</span>\n\n<span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"nc\">pf.Stdout</span>\n\n<span class=\"kr\">main </span><span class=\"nf\">=</span>\n<span class=\"w\">    </span><span class=\"kt\">Stdout</span><span class=\"nf\">.</span><span class=\"nv\">line</span><span class=\"err\">!</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"kt\">Inspect</span><span class=\"nf\">.</span><span class=\"nv\">toStr</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"nv\">bar</span><span class=\"w\"> </span><span class=\"mi\">3</span><span class=\"p\">))</span>\n\n\n<span class=\"nv\">bar</span><span class=\"w\"> </span><span class=\"nf\">:</span><span class=\"w\"> </span><span class=\"kt\">U8</span><span class=\"w\"> </span><span class=\"nf\">-&gt;</span><span class=\"w\"> </span><span class=\"kt\">List</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"kt\">List</span><span class=\"w\"> </span><span class=\"kt\">U8</span><span class=\"p\">)</span>\n<span class=\"nv\">bar</span><span class=\"w\"> </span><span class=\"nf\">=</span><span class=\"w\"> </span><span class=\"nf\">\\</span><span class=\"nv\">x</span><span class=\"w\"> </span><span class=\"nf\">-&gt;</span>\n<span class=\"w\">    </span><span class=\"p\">[[</span><span class=\"nv\">x</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"nv\">x</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"nv\">x</span><span class=\"p\">]]</span>\n</code></pre></div>\n<div class=\"codehilite\"><pre><span></span><code>❯ roc foo.roc\n[[3, 3, 3]]\n</code></pre></div>\n<p>Compiler version:</p>\n<div class=\"codehilite\"><pre><span></span><code>❯ roc --version\nroc nightly pre-release, built from commit a7168a4 on Mo 02 Dez 2024 09:02:13 UTC\n</code></pre></div>",
        "id": 485914908,
        "sender_full_name": "Ryan Barth",
        "timestamp": 1733248098
    },
    {
        "content": "<p>Thanks for the minimal reproduction <span class=\"user-mention\" data-user-id=\"453714\">@Ryan Barth</span>, I created <a href=\"https://github.com/roc-lang/roc/issues/7303\">#7303</a> for this</p>",
        "id": 485928460,
        "sender_full_name": "Anton",
        "timestamp": 1733252179
    }
]