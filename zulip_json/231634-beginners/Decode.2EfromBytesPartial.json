[
    {
        "content": "<p>Is there a way to use <code>Decode.fromBytesPartial</code> to decode Utf8 into a Roc type such as a F64, or U64? I am unsure if this has been implemented, and is working. I've been looking through tests and examples but haven't found anything yet. It would be great if this was something that worked in the REPL. I would like to update the builtin docs and also use it in my parsers.</p>",
        "id": 314165625,
        "sender_full_name": "Luke Boswell",
        "timestamp": 1670298676
    },
    {
        "content": "<p>I've been researching different primitives and thought I might attempt to implement a parser for floats and integers; e.g. <code>1_024</code> <code>6.022e23</code> <code>U+00FC0034</code> <code>0xAC</code> <code>0o01``0b0001_0002</code> etc</p>",
        "id": 314166235,
        "sender_full_name": "Luke Boswell",
        "timestamp": 1670299296
    },
    {
        "content": "<p>Yes, it is possible - see <a href=\"https://github.com/roc-lang/roc/blob/8ae88571250a69a2d0119a76df56f731aa55dd8c/crates/compiler/test_gen/src/gen_abilities.rs#L949\">https://github.com/roc-lang/roc/blob/8ae88571250a69a2d0119a76df56f731aa55dd8c/crates/compiler/test_gen/src/gen_abilities.rs#L949</a>. That said, you will probably need to write a parser for the exact style of ints/float you want to parse - and it may not be worth implementing a whole decoder in order to do so.</p>",
        "id": 314168706,
        "sender_full_name": "Ayaz Hafiz",
        "timestamp": 1670301484
    },
    {
        "content": "<p>Thanks for that Ayaz! I've got an initial proof of concept working. So far it appears to handle everything I've thrown at it. I had some type errors along the way, but separating things out into different functions seems to have worked well. </p>\n<p><strong>Question.</strong> is something like this reasonably efficient for parsing floats? How would you test that? My thinking is that if I use <code>walkUntil</code> to build up the state as I go then the compiler should be able to optimise this so it doesn't need to copy the whole input each time, and can probably do mutations in place. </p>\n<div class=\"codehilite\"><pre><span></span><code>float : Parser (List U8) F64\nfloat =\n    buildPrimitiveParser \\input -&gt;\n        digitState =\n            List.walkUntil input initDigitState \\state, elem -&gt;\n                when elem is\n                    &#39;0&#39; -&gt; state |&gt; pushDigit elem |&gt; Continue\n                    &#39;1&#39; -&gt; state |&gt; pushDigit elem |&gt; Continue\n                    &#39;2&#39; -&gt; state |&gt; pushDigit elem |&gt; Continue\n                    &#39;3&#39; -&gt; state |&gt; pushDigit elem |&gt; Continue\n                    &#39;4&#39; -&gt; state |&gt; pushDigit elem |&gt; Continue\n                    &#39;5&#39; -&gt; state |&gt; pushDigit elem |&gt; Continue\n                    &#39;6&#39; -&gt; state |&gt; pushDigit elem |&gt; Continue\n                    &#39;7&#39; -&gt; state |&gt; pushDigit elem |&gt; Continue\n                    &#39;8&#39; -&gt; state |&gt; pushDigit elem |&gt; Continue\n                    &#39;9&#39; -&gt; state |&gt; pushDigit elem |&gt; Continue\n                    &#39;.&#39; -&gt;\n                        if state.decimalPoint then\n                            Break state\n                        else\n                            state |&gt; pushDecimal |&gt; Continue\n                    &#39;_&#39; -&gt; state |&gt; pushUnderscore |&gt; Continue\n                    _ -&gt; Break state\n\n        when Decode.fromBytes digitState.digits Json.fromUtf8 is\n            Ok n -&gt; Ok { val: n, input: List.drop input digitState.length }\n            Err _ -&gt; Err (ParsingFailure &quot;Not a float&quot;)\n\nDigitState : {\n    digits : List U8,\n    length : Nat,\n    decimalPoint : Bool,\n}\n\ninitDigitState : DigitState\ninitDigitState = {\n    digits : [],\n    length : 0,\n    decimalPoint : Bool.false\n}\n\npushDigit : DigitState, U8 -&gt; DigitState\npushDigit = \\state, digit -&gt;\n    {state &amp; length : state.length + 1, digits : List.append state.digits digit}\n\npushDecimal : DigitState -&gt; DigitState\npushDecimal = \\state -&gt;\n    {state &amp; length : state.length + 1, digits : List.append state.digits &#39;.&#39;, decimalPoint : Bool.true}\n\npushUnderscore : DigitState -&gt; DigitState\npushUnderscore = \\state -&gt;\n    {state &amp; length : state.length + 1}\n</code></pre></div>",
        "id": 314174197,
        "sender_full_name": "Luke Boswell",
        "timestamp": 1670305704
    },
    {
        "content": "<p>Not sure if/how much it matters for performance, but you can use or between cases: <code>'0' | '1' -&gt; ...</code></p>",
        "id": 314175380,
        "sender_full_name": "Brendan Hansknecht",
        "timestamp": 1670306574
    },
    {
        "content": "<p>Also, not sure how well llvm optimizes the switch, but is would question whether it would be faster to use an if. <code>if '0' &lt;= elem &amp;&amp; ...</code></p>\n<p>Would definitely need to test though. Hard to judge these kinds of things from just reading the code.</p>",
        "id": 314175529,
        "sender_full_name": "Brendan Hansknecht",
        "timestamp": 1670306665
    },
    {
        "content": "<p>As long as you can verify you aren't allocating and copying by accident, i would be this is ok.</p>",
        "id": 314175598,
        "sender_full_name": "Brendan Hansknecht",
        "timestamp": 1670306701
    },
    {
        "content": "<p>Oh, though due to how roc currently works and some optimization problems, i am pretty sure that <code>pushDecimal</code> is copying every time.</p>",
        "id": 314175674,
        "sender_full_name": "Brendan Hansknecht",
        "timestamp": 1670306753
    },
    {
        "content": "<p>Lastly, may want to use <code>List.withCapacity</code> to help minimize allocations</p>",
        "id": 314175783,
        "sender_full_name": "Brendan Hansknecht",
        "timestamp": 1670306805
    },
    {
        "content": "<p>I think the biggest thing that stands out to me is, could you build up the float as you walk the list of bytes instead of pushing them into an intermediate list? That would eliminate all allocation. Or if not, you could instead use the walk to figure what the start/end indices of the input list are, and then do a <code>List.slice</code> (I forget the exact function name, apologies) at the end to get a sub-list. Once Roc has slices that should require zero allocation for this use case</p>",
        "id": 314175871,
        "sender_full_name": "Ayaz Hafiz",
        "timestamp": 1670306866
    },
    {
        "content": "<p>How would I test this:<br>\nMicro benchmark. Just make a corpus and run it through. Loop it many times if necessary to get decently accurate performance results. Then can time either with the platform or a cli tool like hyperfine.</p>",
        "id": 314175997,
        "sender_full_name": "Brendan Hansknecht",
        "timestamp": 1670306933
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"343810\">Brendan Hansknecht</span> <a href=\"#narrow/stream/231634-beginners/topic/Decode.2EfromBytesPartial/near/314175380\">said</a>:</p>\n<blockquote>\n<p>Not sure if/how much it matters for performance, but you can use or between cases: <code>'0' | '1' -&gt; ...</code></p>\n</blockquote>\n<p>aside: the performance should be the same - the compiler desugars or-patterns into multiple independent patterns.</p>",
        "id": 314176056,
        "sender_full_name": "Ayaz Hafiz",
        "timestamp": 1670307001
    },
    {
        "content": "<p>Also FWIW this function is repeating what <code>Decode.fromBytes .. Json.fromUtf8</code> does (though it also handles _ in the float, which the JSON decoding format does not). It is building a list that is then passed to <code>Decode.fromBytes</code>, which calls the appropriate float decoder, which itself attempts to parse the list of bytes as a float. It think you'd want to either use this function to immediately decode into a float yourself, or use the JSON decoding of a float from the start - you can call <code>Decode.fromBytesPartial</code>, and if it succeeds for a float type, you know you've parsed a JSON float with something left over; if it failed, the input was not a JSON float.</p>",
        "id": 314176439,
        "sender_full_name": "Ayaz Hafiz",
        "timestamp": 1670307285
    },
    {
        "content": "<p>I asked gptchat for an implementation of float parsing that didn't allocate, and it said <code>strtof</code> from libc. I asked how that was implemented and it said it varies by libc but here's an example implementation:</p>\n<div class=\"codehilite\" data-code-language=\"C\"><pre><span></span><code><span class=\"kt\">float</span><span class=\"w\"> </span><span class=\"nf\">strtof</span><span class=\"p\">(</span><span class=\"k\">const</span><span class=\"w\"> </span><span class=\"kt\">char</span><span class=\"w\"> </span><span class=\"o\">*</span><span class=\"n\">str</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"kt\">char</span><span class=\"w\"> </span><span class=\"o\">**</span><span class=\"n\">endptr</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\"></span>\n<span class=\"w\">  </span><span class=\"kt\">char</span><span class=\"w\"> </span><span class=\"o\">*</span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">str</span><span class=\"p\">;</span><span class=\"w\"></span>\n<span class=\"w\">  </span><span class=\"c1\">// Skip leading white space</span>\n<span class=\"w\">  </span><span class=\"k\">while</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">isspace</span><span class=\"p\">(</span><span class=\"o\">*</span><span class=\"n\">p</span><span class=\"p\">))</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"o\">++</span><span class=\"p\">;</span><span class=\"w\"></span>\n\n<span class=\"w\">  </span><span class=\"c1\">// Check for an optional plus or minus sign</span>\n<span class=\"w\">  </span><span class=\"kt\">int</span><span class=\"w\"> </span><span class=\"n\">sign</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"p\">;</span><span class=\"w\"></span>\n<span class=\"w\">  </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"o\">*</span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"o\">==</span><span class=\"w\"> </span><span class=\"sc\">'+'</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"n\">p</span><span class=\"o\">++</span><span class=\"p\">;</span><span class=\"w\"></span>\n<span class=\"w\">  </span><span class=\"p\">}</span><span class=\"w\"> </span><span class=\"k\">else</span><span class=\"w\"> </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"o\">*</span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"o\">==</span><span class=\"w\"> </span><span class=\"sc\">'-'</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"n\">p</span><span class=\"o\">++</span><span class=\"p\">;</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"n\">sign</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mi\">-1</span><span class=\"p\">;</span><span class=\"w\"></span>\n<span class=\"w\">  </span><span class=\"p\">}</span><span class=\"w\"></span>\n\n<span class=\"w\">  </span><span class=\"c1\">// Parse the integer part of the mantissa</span>\n<span class=\"w\">  </span><span class=\"kt\">float</span><span class=\"w\"> </span><span class=\"n\">mantissa</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mf\">0.0</span><span class=\"p\">;</span><span class=\"w\"></span>\n<span class=\"w\">  </span><span class=\"k\">while</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">isdigit</span><span class=\"p\">(</span><span class=\"o\">*</span><span class=\"n\">p</span><span class=\"p\">))</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"n\">mantissa</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">mantissa</span><span class=\"w\"> </span><span class=\"o\">*</span><span class=\"w\"> </span><span class=\"mf\">10.0</span><span class=\"w\"> </span><span class=\"o\">+</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"o\">*</span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"w\"> </span><span class=\"sc\">'0'</span><span class=\"p\">);</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"n\">p</span><span class=\"o\">++</span><span class=\"p\">;</span><span class=\"w\"></span>\n<span class=\"w\">  </span><span class=\"p\">}</span><span class=\"w\"></span>\n\n<span class=\"w\">  </span><span class=\"c1\">// Check for a decimal point</span>\n<span class=\"w\">  </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"o\">*</span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"o\">==</span><span class=\"w\"> </span><span class=\"sc\">'.'</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"n\">p</span><span class=\"o\">++</span><span class=\"p\">;</span><span class=\"w\"></span>\n\n<span class=\"w\">    </span><span class=\"c1\">// Parse the fractional part of the mantissa</span>\n<span class=\"w\">    </span><span class=\"kt\">float</span><span class=\"w\"> </span><span class=\"n\">frac</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mf\">0.0</span><span class=\"p\">;</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"kt\">float</span><span class=\"w\"> </span><span class=\"n\">divisor</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mf\">1.0</span><span class=\"p\">;</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"k\">while</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">isdigit</span><span class=\"p\">(</span><span class=\"o\">*</span><span class=\"n\">p</span><span class=\"p\">))</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\"></span>\n<span class=\"w\">      </span><span class=\"n\">frac</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">frac</span><span class=\"w\"> </span><span class=\"o\">*</span><span class=\"w\"> </span><span class=\"mf\">10.0</span><span class=\"w\"> </span><span class=\"o\">+</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"o\">*</span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"w\"> </span><span class=\"sc\">'0'</span><span class=\"p\">);</span><span class=\"w\"></span>\n<span class=\"w\">      </span><span class=\"n\">divisor</span><span class=\"w\"> </span><span class=\"o\">*=</span><span class=\"w\"> </span><span class=\"mf\">10.0</span><span class=\"p\">;</span><span class=\"w\"></span>\n<span class=\"w\">      </span><span class=\"n\">p</span><span class=\"o\">++</span><span class=\"p\">;</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"p\">}</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"n\">mantissa</span><span class=\"w\"> </span><span class=\"o\">+=</span><span class=\"w\"> </span><span class=\"n\">frac</span><span class=\"w\"> </span><span class=\"o\">/</span><span class=\"w\"> </span><span class=\"n\">divisor</span><span class=\"p\">;</span><span class=\"w\"></span>\n<span class=\"w\">  </span><span class=\"p\">}</span><span class=\"w\"></span>\n\n<span class=\"w\">  </span><span class=\"c1\">// Check for an optional exponent</span>\n<span class=\"w\">  </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"o\">*</span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"o\">==</span><span class=\"w\"> </span><span class=\"sc\">'e'</span><span class=\"w\"> </span><span class=\"o\">||</span><span class=\"w\"> </span><span class=\"o\">*</span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"o\">==</span><span class=\"w\"> </span><span class=\"sc\">'E'</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"n\">p</span><span class=\"o\">++</span><span class=\"p\">;</span><span class=\"w\"></span>\n\n<span class=\"w\">    </span><span class=\"c1\">// Check for an optional exponent sign</span>\n<span class=\"w\">    </span><span class=\"kt\">int</span><span class=\"w\"> </span><span class=\"n\">exp_sign</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"p\">;</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"o\">*</span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"o\">==</span><span class=\"w\"> </span><span class=\"sc\">'+'</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\"></span>\n<span class=\"w\">      </span><span class=\"n\">p</span><span class=\"o\">++</span><span class=\"p\">;</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"p\">}</span><span class=\"w\"> </span><span class=\"k\">else</span><span class=\"w\"> </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"o\">*</span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"o\">==</span><span class=\"w\"> </span><span class=\"sc\">'-'</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\"></span>\n<span class=\"w\">      </span><span class=\"n\">p</span><span class=\"o\">++</span><span class=\"p\">;</span><span class=\"w\"></span>\n<span class=\"w\">      </span><span class=\"n\">exp_sign</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mi\">-1</span><span class=\"p\">;</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"p\">}</span><span class=\"w\"></span>\n\n<span class=\"w\">    </span><span class=\"c1\">// Parse the exponent</span>\n<span class=\"w\">    </span><span class=\"kt\">int</span><span class=\"w\"> </span><span class=\"n\">exponent</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"p\">;</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"k\">while</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">isdigit</span><span class=\"p\">(</span><span class=\"o\">*</span><span class=\"n\">p</span><span class=\"p\">))</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\"></span>\n<span class=\"w\">      </span><span class=\"n\">exponent</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">exponent</span><span class=\"w\"> </span><span class=\"o\">*</span><span class=\"w\"> </span><span class=\"mi\">10</span><span class=\"w\"> </span><span class=\"o\">+</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"o\">*</span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"w\"> </span><span class=\"sc\">'0'</span><span class=\"p\">);</span><span class=\"w\"></span>\n<span class=\"w\">      </span><span class=\"n\">p</span><span class=\"o\">++</span><span class=\"p\">;</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"p\">}</span><span class=\"w\"></span>\n\n<span class=\"w\">    </span><span class=\"c1\">// Adjust the mantissa and exponent based on the exponent sign</span>\n<span class=\"w\">    </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">exp_sign</span><span class=\"w\"> </span><span class=\"o\">==</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\"></span>\n<span class=\"w\">      </span><span class=\"k\">for</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"kt\">int</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"p\">;</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"o\">&lt;</span><span class=\"w\"> </span><span class=\"n\">exponent</span><span class=\"p\">;</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"o\">++</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\"></span>\n<span class=\"w\">        </span><span class=\"n\">mantissa</span><span class=\"w\"> </span><span class=\"o\">*=</span><span class=\"w\"> </span><span class=\"mf\">10.0</span><span class=\"p\">;</span><span class=\"w\"></span>\n<span class=\"w\">      </span><span class=\"p\">}</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"p\">}</span><span class=\"w\"> </span><span class=\"k\">else</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\"></span>\n<span class=\"w\">      </span><span class=\"k\">for</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"kt\">int</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"p\">;</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"o\">&lt;</span><span class=\"w\"> </span><span class=\"n\">exponent</span><span class=\"p\">;</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"o\">++</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\"></span>\n<span class=\"w\">        </span><span class=\"n\">mantissa</span><span class=\"w\"> </span><span class=\"o\">/=</span><span class=\"w\"> </span><span class=\"mf\">10.0</span><span class=\"p\">;</span><span class=\"w\"></span>\n<span class=\"w\">      </span><span class=\"p\">}</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"p\">}</span><span class=\"w\"></span>\n<span class=\"w\">  </span><span class=\"p\">}</span><span class=\"w\"></span>\n\n<span class=\"w\">  </span><span class=\"c1\">// Return the final float value</span>\n<span class=\"w\">  </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">endptr</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"o\">*</span><span class=\"n\">endptr</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"p\">;</span><span class=\"w\"></span>\n<span class=\"w\">  </span><span class=\"k\">return</span><span class=\"w\"> </span><span class=\"n\">sign</span><span class=\"w\"> </span><span class=\"o\">*</span><span class=\"w\"> </span><span class=\"n\">mantissa</span><span class=\"p\">;</span><span class=\"w\"></span>\n<span class=\"p\">}</span><span class=\"w\"></span>\n</code></pre></div>",
        "id": 314179054,
        "sender_full_name": "Richard Feldman",
        "timestamp": 1670309417
    },
    {
        "content": "<p>certainly looks like it should work, but then again gptchamp is outstanding at generating stuff that looks like it should work but is actually wrong <span aria-label=\"laughing\" class=\"emoji emoji-1f606\" role=\"img\" title=\"laughing\">:laughing:</span></p>",
        "id": 314179058,
        "sender_full_name": "Richard Feldman",
        "timestamp": 1670309421
    },
    {
        "content": "<p>so might be worth looking up <code>strtof</code> in a specific libc implementation, e.g. musl</p>",
        "id": 314179081,
        "sender_full_name": "Richard Feldman",
        "timestamp": 1670309448
    },
    {
        "content": "<p>Hey thanks gptchat! That's neat. I think I might be able make a version that doesn't allocate, or at least builds up the float as it parses. It's relatively easy to follow along with that source. I'll see if I can find another copy in glibc or something.</p>",
        "id": 314183017,
        "sender_full_name": "Luke Boswell",
        "timestamp": 1670311825
    },
    {
        "content": "<p>ha ha ha I do not recommend trying to understand glibc source code! Try musl libc instead!</p>",
        "id": 314333251,
        "sender_full_name": "Brian Carroll",
        "timestamp": 1670363546
    },
    {
        "content": "<p>maybe you're more familiar than me though, in which case, go for it!</p>",
        "id": 314333289,
        "sender_full_name": "Brian Carroll",
        "timestamp": 1670363563
    },
    {
        "content": "<p>Definitely not familiar here, just a curious adventure into the unknown...</p>",
        "id": 314335169,
        "sender_full_name": "Luke Boswell",
        "timestamp": 1670364298
    }
]