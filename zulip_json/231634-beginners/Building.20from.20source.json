[
    {
        "content": "<p>I'm having trouble getting llvm set up on Windows, getting this error:</p>\n<div class=\"codehilite\"><pre><span></span><code>error: failed to run custom build command for `llvm-sys v100.2.0`\n</code></pre></div>\n\n\n<p>I've run through the Building from Source guide a few times, building llvm in different ways. Does anyone have some insight on what I need to do to fix this? Thanks!</p>",
        "id": 210073903,
        "sender_full_name": "Bob Shelline",
        "timestamp": 1600125236
    },
    {
        "content": "<p>not a windows user, but this seems like a good windows-specific guide <a href=\"https://github.com/ziglang/zig/wiki/How-to-build-LLVM,-libclang,-and-liblld-from-source#windows\">https://github.com/ziglang/zig/wiki/How-to-build-LLVM,-libclang,-and-liblld-from-source#windows</a> if you want to do it from source</p>",
        "id": 210076715,
        "sender_full_name": "Folkert de Vries",
        "timestamp": 1600127519
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"282726\">@Ian Mackenzie</span> was very helpful in getting me set up!</p>",
        "id": 210077986,
        "sender_full_name": "Richard Feldman",
        "timestamp": 1600128704
    },
    {
        "content": "<p>Got it working and successfully ran the repl!</p>",
        "id": 210133722,
        "sender_full_name": "Bob Shelline",
        "timestamp": 1600178751
    },
    {
        "content": "<p>nice!!!</p>",
        "id": 210134084,
        "sender_full_name": "Richard Feldman",
        "timestamp": 1600178912
    },
    {
        "content": "<p>if you have any edits to the instructions that might help the next person get up and running on Windows, a PR would be great!</p>",
        "id": 210134235,
        "sender_full_name": "Richard Feldman",
        "timestamp": 1600178988
    },
    {
        "content": "<p>Haha, that's the trick. I'm not sure what I was doing wrong. It may be that I was missing the Python or CMake dependencies that I installed while trying the Zig guide that Folkert linked. Ultimately I went through the steps in the Roc guide again with nmake and it worked.</p>",
        "id": 210134585,
        "sender_full_name": "Bob Shelline",
        "timestamp": 1600179124
    },
    {
        "content": "<p>I'll make a PR to add those possible dependencies though.</p>",
        "id": 210134924,
        "sender_full_name": "Bob Shelline",
        "timestamp": 1600179286
    },
    {
        "content": "<p>Oh, you know what, the <a href=\"https://llvm.org/docs/GettingStarted.html\">https://llvm.org/docs/GettingStarted.html</a> guide does list those dependencies further below. I hadn't read the rest of that guide.</p>",
        "id": 210135175,
        "sender_full_name": "Bob Shelline",
        "timestamp": 1600179403
    },
    {
        "content": "<p>I was looking at this section and couldn't find the recommended version to install on Mac OS X <a href=\"https://github.com/rtfeldman/roc/blob/trunk/BUILDING_FROM_SOURCE.md#llvm\">https://github.com/rtfeldman/roc/blob/trunk/BUILDING_FROM_SOURCE.md#llvm</a></p>",
        "id": 231955665,
        "sender_full_name": "Ju Liu",
        "timestamp": 1616761824
    },
    {
        "content": "<p>so I'm trying with the latest and greatest. Will report if it works fine or not</p>",
        "id": 231955698,
        "sender_full_name": "Ju Liu",
        "timestamp": 1616761843
    },
    {
        "content": "<p>What version do you see on <code>brew info llvm</code>? It might be llvm 11 and I'm confident that version will not work. I'm currently using 10.0.1.</p>",
        "id": 231956158,
        "sender_full_name": "Anton",
        "timestamp": 1616762106
    },
    {
        "content": "<p>yep, can confirm it doesn't. the readme above suggests using 10.0.0_3 which is what I'm trying</p>",
        "id": 231956436,
        "sender_full_name": "Ju Liu",
        "timestamp": 1616762246
    },
    {
        "content": "<p>there's still something wrong :(</p>\n<div class=\"codehilite\"><pre><span></span><code>$ brew info llvm\nllvm: stable 10.0.0 (bottled), HEAD [keg-only]\nNext-gen compiler infrastructure\nhttps://llvm.org/\n/usr/local/Cellar/llvm/10.0.0_3 (7,055 files, 1GB)\n  Poured from bottle on 2021-03-26 at 12:36:37\nFrom: https://github.com/Homebrew/homebrew-core/blob/HEAD/Formula/llvm.rb\n==&gt; Dependencies\nBuild: cmake ✘, python@3.8 ✘\nRequired: libffi ✔\n==&gt; Requirements\nBuild: Xcode ✔\n==&gt; Options\n--HEAD\n    Install HEAD version\n==&gt; Caveats\nTo use the bundled libc++ please add the following LDFLAGS:\n  LDFLAGS=&quot;-L/usr/local/opt/llvm/lib -Wl,-rpath,/usr/local/opt/llvm/lib&quot;\n\nllvm is keg-only, which means it was not symlinked into /usr/local,\nbecause macOS already provides this software and installing another version in\nparallel can cause all kinds of trouble.\n\nIf you need to have llvm first in your PATH, run:\n  echo &#39;export PATH=&quot;/usr/local/opt/llvm/bin:$PATH&quot;&#39; &gt;&gt; /Users/arkham/.bash_profile\n\nFor compilers to find llvm you may need to set:\n  export LDFLAGS=&quot;-L/usr/local/opt/llvm/lib&quot;\n  export CPPFLAGS=&quot;-I/usr/local/opt/llvm/include&quot;\n\n==&gt; Analytics\ninstall: 18,593 (30 days), 68,307 (90 days), 234,327 (365 days)\ninstall-on-request: 15,100 (30 days), 54,439 (90 days), 185,622 (365 days)\nbuild-error: 0 (30 days)\n</code></pre></div>",
        "id": 231957644,
        "sender_full_name": "Ju Liu",
        "timestamp": 1616762847
    },
    {
        "content": "<p>and the error I get is:</p>\n<div class=\"codehilite\"><pre><span></span><code>$ cargo run repl\n   Compiling roc_builtins v0.1.0 (/Users/arkham/code/roc/compiler/builtins)\n   Compiling cc v1.0.67\n   Compiling rand_core v0.6.2\n   Compiling directories-next v2.0.0\n   Compiling colored v2.0.0\n   Compiling dirs-next v2.0.0\n   Compiling petgraph v0.5.1\n   Compiling backtrace v0.3.56\n   Compiling spirv_headers v1.5.0\nerror: failed to run custom build command for `roc_builtins v0.1.0 (/Users/arkham/code/roc/compiler/builtins)`\n\nCaused by:\n  process didn&#39;t exit successfully: `/Users/arkham/code/roc/target/debug/build/roc_builtins-abe28cf79a8a01a1/build-script-build` (exit code: 101)\n  --- stdout\n  Compiling zig object to: /Users/arkham/code/roc/compiler/builtins/bitcode/builtins.o\n  Moving zig object to: /Users/arkham/code/roc/target/debug/build/roc_builtins-8a0ab0a538352427/out/builtins.o\n  Compiling ir to: /Users/arkham/code/roc/compiler/builtins/bitcode/builtins.ll\n  Compiling bitcode to: /Users/arkham/code/roc/target/debug/build/roc_builtins-8a0ab0a538352427/out/builtins.bc\n\n  --- stderr\n  thread &#39;main&#39; panicked at &#39;llvm-as-10 failed: No such file or directory (os error 2)&#39;, compiler/builtins/build.rs:78:24\n  note: run with `RUST_BACKTRACE=1` environment variable to display a backtrace\nwarning: build failed, waiting for other jobs to finish...\nerror: build failed\n</code></pre></div>",
        "id": 231957671,
        "sender_full_name": "Ju Liu",
        "timestamp": 1616762863
    },
    {
        "content": "<p>I've exported <code>LDFLAGS</code> and <code>CPPFLAGS</code> as brew suggested</p>",
        "id": 231957756,
        "sender_full_name": "Ju Liu",
        "timestamp": 1616762890
    },
    {
        "content": "<p>oh, is it because it's trying to run <code>llvm-as-10</code>, while the locally installed version is just <code>llvm-as</code>?</p>",
        "id": 231957873,
        "sender_full_name": "Ju Liu",
        "timestamp": 1616762960
    },
    {
        "content": "<p>yup, that was it :)</p>",
        "id": 231958145,
        "sender_full_name": "Ju Liu",
        "timestamp": 1616763081
    },
    {
        "content": "<div class=\"codehilite\"><pre><span></span><code>    Finished dev [unoptimized + debuginfo] target(s) in 2m 18s\n     Running `target/debug/roc repl`\n  The rockin&#39; roc repl\n────────────────────────\nEnter an expression, or :help, or :exit/:q.\n» 1 + 100\n101 : Num *\n</code></pre></div>\n<p>oh yeahh</p>",
        "id": 231958583,
        "sender_full_name": "Ju Liu",
        "timestamp": 1616763284
    },
    {
        "content": "<p>updated instructions here: <a href=\"https://github.com/rtfeldman/roc/pull/1113\">https://github.com/rtfeldman/roc/pull/1113</a></p>",
        "id": 231960291,
        "sender_full_name": "Ju Liu",
        "timestamp": 1616763977
    },
    {
        "content": "<p><span aria-label=\"+1\" class=\"emoji emoji-1f44d\" role=\"img\" title=\"+1\">:+1:</span> I think the CI error could be because we're not using the latest rust version on CI yet, I'll check it out.</p>",
        "id": 231961809,
        "sender_full_name": "Anton",
        "timestamp": 1616764598
    },
    {
        "content": "<p>Looks like Richard  was already working on it :)</p>",
        "id": 231963189,
        "sender_full_name": "Anton",
        "timestamp": 1616765136
    },
    {
        "content": "<p><a href=\"https://github.com/rtfeldman/roc/pull/1112\">https://github.com/rtfeldman/roc/pull/1112</a></p>",
        "id": 231963233,
        "sender_full_name": "Anton",
        "timestamp": 1616765159
    },
    {
        "content": "<p>I am getting errors when building from source. I am on MacOS and I've tried the steps in the troubleshooting section. Can someone help me?<br>\n╰─ cargo run repl  <br>\n Compiling roc_builtins v0.1.0 (/Users/motionstatic/ws/dev/roc/compiler/builtins)<br>\nCompiling cgmath v0.18.0<br>\nCompiling im-rc v14.3.0<br>\nCompiling im v14.3.0<br>\nCompiling crossbeam-deque v0.7.3<br>\nCompiling im v15.0.0<br>\nCompiling im-rc v15.0.0<br>\nCompiling thiserror v1.0.24<br>\nCompiling rand v0.7.3<br>\nCompiling serde v1.0.124<br>\nerror: failed to run custom build command for <code>roc_builtins v0.1.0 (/Users/motionstatic/ws/dev/roc/compiler/builtins)</code></p>\n<p>Caused by:<br>\nprocess didn't exit successfully: <code>/Users/motionstatic/ws/dev/roc/target/debug/build/roc_builtins-7f77b815e7e30688/build-script-build</code> (exit code: 101)<br>\n--- stdout<br>\nCompiling zig object to: /Users/motionstatic/ws/dev/roc/compiler/builtins/bitcode/builtins.o</p>\n<p>--- stderr<br>\nthread 'main' panicked at 'zig failed: Unable to create builtin.zig: file not found<br>\n', compiler/builtins/build.rs:75:17<br>\nnote: run with <code>RUST_BACKTRACE=1</code> environment variable to display a backtrace<br>\nwarning: build failed, waiting for other jobs to finish...<br>\nerror: build failed</p>",
        "id": 232088226,
        "sender_full_name": "Peter Fields",
        "timestamp": 1616849615
    },
    {
        "content": "<p>Do you have Zig installed?</p>",
        "id": 232090083,
        "sender_full_name": "Zeljko Nesic",
        "timestamp": 1616851429
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"341959\">Zeljko Nesic</span> <a href=\"#narrow/stream/231634-beginners/topic/building.20from.20source/near/232090083\">said</a>:</p>\n<blockquote>\n<p>Do you have Zig installed?</p>\n</blockquote>\n<p>Yes.<br>\n─ zig version = 0.6.0</p>\n<p>I used brew install zig</p>",
        "id": 232097516,
        "sender_full_name": "Peter Fields",
        "timestamp": 1616859009
    },
    {
        "content": "<p>Hi Peter, we're currently using zig 0.7.1, I'll make sure to add that to the zig section of BUILDING_FROM_SOURCE.</p>",
        "id": 232098134,
        "sender_full_name": "Anton",
        "timestamp": 1616859566
    },
    {
        "content": "<p>apparently the install instructions give you llvm 11 now on macos at least. Can we find instructions to get a specific version?</p>",
        "id": 232165211,
        "sender_full_name": "Folkert de Vries",
        "timestamp": 1616936079
    },
    {
        "content": "<p>we use llvm 10 for the moment; also need to upgrade that at some point but that'll cause a bunch of breakage/frustration probably</p>",
        "id": 232165230,
        "sender_full_name": "Folkert de Vries",
        "timestamp": 1616936116
    },
    {
        "content": "<p>I've recently updated the instructions for mac os! <a href=\"https://github.com/rtfeldman/roc/blob/trunk/BUILDING_FROM_SOURCE.md#llvm-installation-on-macos\">https://github.com/rtfeldman/roc/blob/trunk/BUILDING_FROM_SOURCE.md#llvm-installation-on-macos</a></p>",
        "id": 232165434,
        "sender_full_name": "Ju Liu",
        "timestamp": 1616936339
    },
    {
        "content": "<p>ah, excellent, <span class=\"user-mention\" data-user-id=\"400181\">@Peter Fields</span> maybe the updated version gives better results</p>",
        "id": 232165462,
        "sender_full_name": "Folkert de Vries",
        "timestamp": 1616936400
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"400181\">@Peter Fields</span> pre-built binaries also work well but it's not as elegant</p>",
        "id": 232172659,
        "sender_full_name": "Lucas Rosa",
        "timestamp": 1616944221
    },
    {
        "content": "<p>Inkwell supports LLVM 11 now, so  in theory we could update our fork to take advantage of that</p>",
        "id": 232174066,
        "sender_full_name": "Richard Feldman",
        "timestamp": 1616945805
    },
    {
        "content": "<p>So it's like 6 hours later and the nix build still seems to be going... is this normal? <span aria-label=\"thinking\" class=\"emoji emoji-1f914\" role=\"img\" title=\"thinking\">:thinking:</span> </p>\n<p>Seems to have selected an awfully large number of packages which appear to all be building from scratch?</p>\n<p><a href=\"/user_uploads/22008/X-KUzJPUaVZga2qt7eIWGIWX/direnv-init.txt\">direnv-init.txt</a></p>",
        "id": 234577965,
        "sender_full_name": "Mario",
        "timestamp": 1618434953
    },
    {
        "content": "<p>kind of, LLVM takes super super long to build. depends on how much power your machine has, so hard to say if 6hrs itself is normal</p>",
        "id": 234582681,
        "sender_full_name": "Lucas Rosa",
        "timestamp": 1618437211
    },
    {
        "content": "<p>I'm going throw the pain now cause I just switched to linux, also I think the nix setup is broken at the moment</p>",
        "id": 234582761,
        "sender_full_name": "Lucas Rosa",
        "timestamp": 1618437248
    },
    {
        "content": "<p>Seems it's given up here:</p>\n<div class=\"codehilite\"><pre><span></span><code>trying https://ziglang.org/builds/zig-macos-x86_64-0.7.1.tar.xz\n  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current\n                                 Dload  Upload   Total   Spent    Left  Speed\n  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0\ncurl: (22) The requested URL returned error: 403\nerror: cannot download zig-macos-x86_64-0.7.1.tar.xz from any mirror\nbuilder for &#39;/nix/store/m4a7fps28v1qh7v12dyfgx96899j7h97-zig-macos-x86_64-0.7.1.tar.xz.drv&#39; failed with exit code 1\nbuilding &#39;/nix/store/zmlxwgfzagln7yqg14c00g6xd0mq1gjj-python-2.7.18.drv&#39;...\ncannot build derivation &#39;/nix/store/2y7qyxdlgg9qmbwcclylmd9myqac4c2a-zig-0.7.1.drv&#39;: 1 dependencies couldn&#39;t be built\n</code></pre></div>",
        "id": 234588904,
        "sender_full_name": "Mario",
        "timestamp": 1618440725
    },
    {
        "content": "<p>oofff. for macOS I just downloaded a pre-built llvm and mapped some ENV vars myself</p>",
        "id": 234591935,
        "sender_full_name": "Lucas Rosa",
        "timestamp": 1618442499
    },
    {
        "content": "<p>the error that made think nix was messed up is happening to me without nix, so forget what I said</p>",
        "id": 234592870,
        "sender_full_name": "Lucas Rosa",
        "timestamp": 1618443151
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"281566\">@Mario</span> great to see you! <span aria-label=\"wave\" class=\"emoji emoji-1f44b\" role=\"img\" title=\"wave\">:wave:</span></p>",
        "id": 234598803,
        "sender_full_name": "Richard Feldman",
        "timestamp": 1618447181
    },
    {
        "content": "<p>I think you might be the first one to try building Roc on M1 hardware, so I have no idea what to expect there, on Nix or otherwise <span aria-label=\"laughing\" class=\"emoji emoji-1f606\" role=\"img\" title=\"laughing\">:laughing:</span></p>",
        "id": 234598825,
        "sender_full_name": "Richard Feldman",
        "timestamp": 1618447201
    },
    {
        "content": "<p>I think <span class=\"user-mention\" data-user-id=\"343810\">@Brendan Hansknecht</span> has built it successfully on a Raspberry Pi though, which also runs on ARM, but that was awhile ago and I don't think it was on Nix <span aria-label=\"thinking\" class=\"emoji emoji-1f914\" role=\"img\" title=\"thinking\">:thinking:</span></p>",
        "id": 234598893,
        "sender_full_name": "Richard Feldman",
        "timestamp": 1618447230
    },
    {
        "content": "<blockquote>\n<p>cannot download zig-macos-x86_64-0.7.1.tar.xz</p>\n</blockquote>\n<p>seems like it's missing from the Nix store - Roc's standard library is written in <a href=\"https://ziglang.org/\">https://ziglang.org/</a> so the <code>zig</code> executable needs to be on your <code>PATH</code> to build Roc - I forget if there's a way to add mirrors to Nix derivations, but the file it's looking for is hosted here on the Zig website: <a href=\"https://ziglang.org/download/0.7.1/zig-macos-x86_64-0.7.1.tar.xz\">https://ziglang.org/download/0.7.1/zig-macos-x86_64-0.7.1.tar.xz</a></p>",
        "id": 234599177,
        "sender_full_name": "Richard Feldman",
        "timestamp": 1618447483
    },
    {
        "content": "<p>ha, perfect timing - here's a fix for Nix on aarch64! <a href=\"https://github.com/rtfeldman/roc/pull/1198#issuecomment-820021740\">https://github.com/rtfeldman/roc/pull/1198#issuecomment-820021740</a></p>\n<p>cc <span class=\"user-mention\" data-user-id=\"281566\">@Mario</span></p>",
        "id": 234609868,
        "sender_full_name": "Richard Feldman",
        "timestamp": 1618456254
    },
    {
        "content": "<p>I just got everything working really smooth on fedora</p>",
        "id": 234620302,
        "sender_full_name": "Lucas Rosa",
        "timestamp": 1618465405
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"281383\">Richard Feldman</span> <a href=\"#narrow/stream/231634-beginners/topic/building.20from.20source/near/234598825\">said</a>:</p>\n<blockquote>\n<p>I think you might be the first one to try building Roc on M1 hardware, so I have no idea what to expect there, on Nix or otherwise <span aria-label=\"laughing\" class=\"emoji emoji-1f606\" role=\"img\" title=\"laughing\">:laughing:</span></p>\n</blockquote>\n<p>Awesome! <span aria-label=\"tada\" class=\"emoji emoji-1f389\" role=\"img\" title=\"tada\">:tada:</span> Continuing the build... will report back... eventually? :D</p>",
        "id": 234764600,
        "sender_full_name": "Mario",
        "timestamp": 1618525865
    },
    {
        "content": "<p>I'm _kind of_ making progress on the M1 nix build! I've started a PR with details here: any help/tips appreciated! <a href=\"https://github.com/rtfeldman/roc/pull/1204\">https://github.com/rtfeldman/roc/pull/1204</a></p>",
        "id": 234884924,
        "sender_full_name": "Mario",
        "timestamp": 1618590989
    },
    {
        "content": "<p>I'm struggling to get anywhere on macOS, I've been trying since yesterday to get llvm installed. Not really sure which direction I need to be going in. Some things I have tried: </p>\n<ul>\n<li>Following the guide and editing the brew install script to pin it to version 10, but that gives an HTTP 404 Not Found.</li>\n<li>Dowloading llvm binaries manually, but with the new security restrictions I'm not really sure how that is even supposed to work.</li>\n<li>After clearing some space on my disk to be able to install XCode, I tried building llvm from source through brew, but that, unsurprisingly perhaps, isn't going to happen. Probably not even worth investigating why that one is failing.</li>\n</ul>\n<p>So I'm not really sure what my next step here is. Am I missing something obvious, or do I need to set up a Linux environment?</p>",
        "id": 238639306,
        "sender_full_name": "Tarjei Skjærset",
        "timestamp": 1620920687
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"411497\">@Tarjei Skjærset</span> on macos I never managed to even build LLVM from source, not even with <code>llvmenv</code> (which is what I use on linux)</p>\n<p>I recommend two options:<br>\n1) use nix and nix-shell which should be working<br>\n2) download a pre-built llvm for macos and add this function to your .bashrc/.zshrc</p>\n<div class=\"codehilite\"><pre><span></span><code>llvminit() {\n  export LLVM_SYS_100_PREFIX=$HOME/Downloads/llvm\n  export PATH=$PATH:$HOME/PATH_TO_ROC_REPO/nix/bin:$HOME/Downloads/llvm:$HOME/Downloads/llvm/bin\n}\n</code></pre></div>",
        "id": 238640310,
        "sender_full_name": "Lucas Rosa",
        "timestamp": 1620921142
    },
    {
        "content": "<p>then everytime I start a new terminal session and switch to the roc folder I run <code>llvminit</code> first and everything should work</p>",
        "id": 238640633,
        "sender_full_name": "Lucas Rosa",
        "timestamp": 1620921298
    },
    {
        "content": "<p>make sure your Rust version is up to date as well</p>",
        "id": 238640716,
        "sender_full_name": "Lucas Rosa",
        "timestamp": 1620921328
    },
    {
        "content": "<p>I'm happy to jump on a call and get you started let me know</p>",
        "id": 238640859,
        "sender_full_name": "Lucas Rosa",
        "timestamp": 1620921390
    },
    {
        "content": "<p>Is the nix-shell supposed to be working without llvm explicitly installed? I tried running <code>cargo run repl</code> earlier, but assumed the reason it didn't work was because I hadn't gotten the llvm installation working. As for 2), I'm guessing that's essentially what I was doing when I tried downloading the binaries, but the issue I ran into there was with macOS' security model where it just won't run stuff unless you allow it in the privacy &amp; security thingy - which I tried, but there are just so many executables.</p>\n<p>What Rust version am I supposed to be on, and how do I check?</p>",
        "id": 238641148,
        "sender_full_name": "Tarjei Skjærset",
        "timestamp": 1620921553
    },
    {
        "content": "<p>nix shell pulls llvm for you so yes</p>",
        "id": 238641166,
        "sender_full_name": "Lucas Rosa",
        "timestamp": 1620921572
    },
    {
        "content": "<p>it could be that the nix setup on mac is broken, it didn't work for me over a month ago suddenly and I gave up on it</p>",
        "id": 238641200,
        "sender_full_name": "Lucas Rosa",
        "timestamp": 1620921600
    },
    {
        "content": "<p>Ohh okay, well I'm happy to rely on nix-shell (although hadn't heard about it before), so that's a separate problem then</p>",
        "id": 238641254,
        "sender_full_name": "Tarjei Skjærset",
        "timestamp": 1620921606
    },
    {
        "content": "<p>so to allow the binaries to run, you just quickly open system preferences and hit allow</p>",
        "id": 238641325,
        "sender_full_name": "Lucas Rosa",
        "timestamp": 1620921642
    },
    {
        "content": "<p>it should show up in the Security &amp; Privacy section of system preferences after you try to run it the first time</p>",
        "id": 238641387,
        "sender_full_name": "Lucas Rosa",
        "timestamp": 1620921664
    },
    {
        "content": "<p>Yeah I did try that , but there were literally tens of them. I didn't get it to work, so I scrapped it and tried other stuff, but I'm happy to try that again. Give me a second to uninstall everything else, and I'll give the prebuilt binaries a go again</p>",
        "id": 238641626,
        "sender_full_name": "Tarjei Skjærset",
        "timestamp": 1620921731
    },
    {
        "content": "<p>oh I see gotcha, I was only prompted for like 2 of them, I wonder if you can enable them via the CLI and do it all in one go</p>",
        "id": 238642137,
        "sender_full_name": "Lucas Rosa",
        "timestamp": 1620921848
    },
    {
        "content": "<p>for the rust version, you probably have rustup installed (hopefully), so just rustup update and you're good</p>",
        "id": 238642279,
        "sender_full_name": "Lucas Rosa",
        "timestamp": 1620921928
    },
    {
        "content": "<p>to check versions you can do <code>rustup show</code></p>",
        "id": 238642348,
        "sender_full_name": "Lucas Rosa",
        "timestamp": 1620921957
    },
    {
        "content": "<p>I'm here all day so just ping here again with an update</p>",
        "id": 238642427,
        "sender_full_name": "Lucas Rosa",
        "timestamp": 1620921980
    },
    {
        "content": "<p>So have you just left your llvm binaries in your Downloads folder? I tried copying them around to where I thought they were supposed to go, but I was doing that blind.</p>",
        "id": 238642466,
        "sender_full_name": "Tarjei Skjærset",
        "timestamp": 1620922005
    },
    {
        "content": "<p>I left it in downloads, <span aria-label=\"shrug\" class=\"emoji emoji-1f937\" role=\"img\" title=\"shrug\">:shrug:</span></p>",
        "id": 238642601,
        "sender_full_name": "Lucas Rosa",
        "timestamp": 1620922080
    },
    {
        "content": "<p>Ah, rustup says rustc 1.52.1</p>",
        "id": 238642655,
        "sender_full_name": "Tarjei Skjærset",
        "timestamp": 1620922089
    },
    {
        "content": "<p>and I only bring them into the path when in the roc folder via the <code>llvminit</code> function</p>",
        "id": 238642693,
        "sender_full_name": "Lucas Rosa",
        "timestamp": 1620922111
    },
    {
        "content": "<p>cause mac has it's own version anyways</p>",
        "id": 238642735,
        "sender_full_name": "Lucas Rosa",
        "timestamp": 1620922133
    },
    {
        "content": "<p>it's just newer than the one we need for inkwell</p>",
        "id": 238642773,
        "sender_full_name": "Lucas Rosa",
        "timestamp": 1620922149
    },
    {
        "content": "<p>you might have luck with llvmenv</p>",
        "id": 238642810,
        "sender_full_name": "Lucas Rosa",
        "timestamp": 1620922175
    },
    {
        "content": "<p>oh actually no, it has no clue where <code>-lSystem</code> is on Big Sur</p>",
        "id": 238642833,
        "sender_full_name": "Lucas Rosa",
        "timestamp": 1620922197
    },
    {
        "content": "<p>Okay that's fine by me. Is it just supposed to work now?</p>",
        "id": 238642951,
        "sender_full_name": "Tarjei Skjærset",
        "timestamp": 1620922227
    },
    {
        "content": "<p>you got llvm locally ?</p>",
        "id": 238642981,
        "sender_full_name": "Lucas Rosa",
        "timestamp": 1620922241
    },
    {
        "content": "<p>and everything in your path?</p>",
        "id": 238643002,
        "sender_full_name": "Lucas Rosa",
        "timestamp": 1620922251
    },
    {
        "content": "<p>try <code>cargo run repl</code> and see what happens</p>",
        "id": 238643040,
        "sender_full_name": "Lucas Rosa",
        "timestamp": 1620922272
    },
    {
        "content": "<p>Seems to be compiling fine when I run <code>cargo run repl</code> in regular zsh. Maybe I got tripped up trying to run nix-shell yesterday and thought the llvm binaries weren't working.</p>",
        "id": 238643060,
        "sender_full_name": "Tarjei Skjærset",
        "timestamp": 1620922286
    },
    {
        "content": "<p>perfect</p>",
        "id": 238643071,
        "sender_full_name": "Lucas Rosa",
        "timestamp": 1620922294
    },
    {
        "content": "<p>if LLVM_AS_SYS doesn't scream right away you're in the clear I think</p>",
        "id": 238643103,
        "sender_full_name": "Lucas Rosa",
        "timestamp": 1620922315
    },
    {
        "content": "<p>It's still going! How long is it supposed to take? Are there incremental builds?</p>",
        "id": 238643200,
        "sender_full_name": "Tarjei Skjærset",
        "timestamp": 1620922346
    },
    {
        "content": "<p>fresh one will take a few seconds maybe a minute, not sure what your specs are but the rust compiler is just slower on mac in general from what I noticed</p>",
        "id": 238643274,
        "sender_full_name": "Lucas Rosa",
        "timestamp": 1620922386
    },
    {
        "content": "<p>incremental builds, not sure, whatever rust does</p>",
        "id": 238643317,
        "sender_full_name": "Lucas Rosa",
        "timestamp": 1620922407
    },
    {
        "content": "<p>I think because we have a mono repo of crates yes</p>",
        "id": 238643361,
        "sender_full_name": "Lucas Rosa",
        "timestamp": 1620922424
    },
    {
        "content": "<p>I got a repl! Man, so excited</p>",
        "id": 238643449,
        "sender_full_name": "Tarjei Skjærset",
        "timestamp": 1620922450
    },
    {
        "content": "<p>Well it crashed</p>",
        "id": 238643466,
        "sender_full_name": "Tarjei Skjærset",
        "timestamp": 1620922456
    },
    {
        "content": "<p>for sure probably Security?</p>",
        "id": 238643484,
        "sender_full_name": "Lucas Rosa",
        "timestamp": 1620922467
    },
    {
        "content": "<p>But that's progress, thanks man!</p>",
        "id": 238643485,
        "sender_full_name": "Tarjei Skjærset",
        "timestamp": 1620922467
    },
    {
        "content": "<p>was it a linker error?</p>",
        "id": 238643507,
        "sender_full_name": "Lucas Rosa",
        "timestamp": 1620922476
    },
    {
        "content": "<p>Yeah, ld: framework not found Security</p>",
        "id": 238643579,
        "sender_full_name": "Tarjei Skjærset",
        "timestamp": 1620922506
    },
    {
        "content": "<p>you can just comment out the -framework Security thing in <a href=\"http://link.rs\">link.rs</a></p>",
        "id": 238643597,
        "sender_full_name": "Lucas Rosa",
        "timestamp": 1620922513
    },
    {
        "content": "<p>or <a href=\"http://linking.rs\">linking.rs</a></p>",
        "id": 238643612,
        "sender_full_name": "Lucas Rosa",
        "timestamp": 1620922517
    },
    {
        "content": "<p>just global search the project for <code>Security</code> and comment out that and the line above it</p>",
        "id": 238643645,
        "sender_full_name": "Lucas Rosa",
        "timestamp": 1620922538
    },
    {
        "content": "<p>it's mostly just for running a single example and won't be there long term anyways</p>",
        "id": 238643679,
        "sender_full_name": "Lucas Rosa",
        "timestamp": 1620922553
    },
    {
        "content": "<p>I do that everytime if I'm on mac lol</p>",
        "id": 238643751,
        "sender_full_name": "Lucas Rosa",
        "timestamp": 1620922568
    },
    {
        "content": "<p>Oh god</p>",
        "id": 238643810,
        "sender_full_name": "Tarjei Skjærset",
        "timestamp": 1620922595
    },
    {
        "content": "<p><a href=\"http://link.rs\">link.rs</a> line 469 &amp; 470</p>",
        "id": 238643840,
        "sender_full_name": "Lucas Rosa",
        "timestamp": 1620922611
    },
    {
        "content": "<p>Yeah I found it! I just worried about the thought of doing that every time I pull trunk</p>",
        "id": 238643877,
        "sender_full_name": "Tarjei Skjærset",
        "timestamp": 1620922629
    },
    {
        "content": "<p>it's fine, you can probably figure out how to make that framework available</p>",
        "id": 238643902,
        "sender_full_name": "Lucas Rosa",
        "timestamp": 1620922643
    },
    {
        "content": "<p>I just didn't care</p>",
        "id": 238643909,
        "sender_full_name": "Lucas Rosa",
        "timestamp": 1620922648
    },
    {
        "content": "<p>Heey there we go, my first Roc expression! <a href=\"/user_uploads/22008/xReMRybRU2Z5R2APh3MM03P6/image.png\">image.png</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/22008/xReMRybRU2Z5R2APh3MM03P6/image.png\" title=\"image.png\"><img src=\"/user_uploads/22008/xReMRybRU2Z5R2APh3MM03P6/image.png\"></a></div>",
        "id": 238643930,
        "sender_full_name": "Tarjei Skjærset",
        "timestamp": 1620922662
    },
    {
        "content": "<p><a href=\"http://List.map\">List.map</a> [ 1, 2, 3, 4 ] \\x -&gt; x + 1</p>",
        "id": 238643949,
        "sender_full_name": "Lucas Rosa",
        "timestamp": 1620922678
    },
    {
        "content": "<p>Thanks so much for the help! I'll play around for a bit, but I would really love to pair some time <span aria-label=\"smiley\" class=\"emoji emoji-1f603\" role=\"img\" title=\"smiley\">:smiley:</span></p>",
        "id": 238644117,
        "sender_full_name": "Tarjei Skjærset",
        "timestamp": 1620922783
    },
    {
        "content": "<p>I'm good any day and in Miami, FL usually awake by 7-9AM</p>",
        "id": 238645033,
        "sender_full_name": "Lucas Rosa",
        "timestamp": 1620923248
    },
    {
        "content": "<p>yeah, you can see why we're all about the \"not ready for a release yet!\" in how we talk about Roc publicly <span aria-label=\"joy\" class=\"emoji emoji-1f602\" role=\"img\" title=\"joy\">:joy:</span></p>",
        "id": 238662571,
        "sender_full_name": "Richard Feldman",
        "timestamp": 1620931471
    },
    {
        "content": "<p>long-term goal is that there's a single <code>roc</code> executable to download and that's it - it has the editor, no external libraries to install, etc</p>",
        "id": 238662602,
        "sender_full_name": "Richard Feldman",
        "timestamp": 1620931495
    },
    {
        "content": "<p>but that will take some doing <span aria-label=\"big smile\" class=\"emoji emoji-1f604\" role=\"img\" title=\"big smile\">:big_smile:</span></p>",
        "id": 238662695,
        "sender_full_name": "Richard Feldman",
        "timestamp": 1620931554
    },
    {
        "content": "<p>thanks for being patient with it, and thanks <span class=\"user-mention\" data-user-id=\"357305\">@Lucas Rosa</span> for helping out!</p>",
        "id": 238663328,
        "sender_full_name": "Richard Feldman",
        "timestamp": 1620931851
    },
    {
        "content": "<p>Following <a href=\"https://github.com/rtfeldman/roc/issues/1418\">https://github.com/rtfeldman/roc/issues/1418</a>, I still get the error using nix installation. <code>examples/hello-world/hello-world: symbol lookup error: /nix/store/sbbifs2ykc05inws26203h0xwcadnf0l-glibc-2.32-46/lib/libc.so.6: undefined symbol: _dl_fatal_printf, version GLIBC_PRIVATE</code> <span aria-label=\"sweat smile\" class=\"emoji emoji-1f605\" role=\"img\" title=\"sweat smile\">:sweat_smile:</span></p>",
        "id": 243285557,
        "sender_full_name": "Chen Yu",
        "timestamp": 1624163303
    },
    {
        "content": "<p>hm, any ideas <span class=\"user-mention\" data-user-id=\"341568\">@Jared Ramirez</span>? <span aria-label=\"thinking\" class=\"emoji emoji-1f914\" role=\"img\" title=\"thinking\">:thinking:</span></p>",
        "id": 243297788,
        "sender_full_name": "Richard Feldman",
        "timestamp": 1624186399
    },
    {
        "content": "<p>I'm not sure. I just ran <code>cargo run run examples/hello-world/Hello.roc</code> on the latest <code>trunk</code> on macos with everything installed via nix and it worked for me. My guess is that there's a difference on Ubuntu</p>",
        "id": 243326619,
        "sender_full_name": "Jared Ramirez",
        "timestamp": 1624231091
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"421664\">@Chen Yu</span> one alternate idea is to run the manual instructions in <code>BUILDING_FROM_SOURCE.md</code> - both <span class=\"user-mention\" data-user-id=\"281543\">@Folkert de Vries</span> and I run that setup on Ubuntu without Nix, and it's entirely possible that currently there's nobody else trying to build Roc from Nix on Ubuntu <span aria-label=\"sweat smile\" class=\"emoji emoji-1f605\" role=\"img\" title=\"sweat smile\">:sweat_smile:</span></p>",
        "id": 243332646,
        "sender_full_name": "Richard Feldman",
        "timestamp": 1624241034
    },
    {
        "content": "<p>OK, thanks~ If I figure it out I will inform you folks~</p>",
        "id": 243332860,
        "sender_full_name": "Chen Yu",
        "timestamp": 1624241362
    },
    {
        "content": "<p>I build from source on fedora without nix using llvmenv to manage multiple llvm versions, feel free to bother me as well</p>",
        "id": 243333009,
        "sender_full_name": "Lucas Rosa",
        "timestamp": 1624241608
    },
    {
        "content": "<p>Sorry for the silly questions - is it possible to output wasm somehow?</p>",
        "id": 248719192,
        "sender_full_name": "Jan Wirth",
        "timestamp": 1628346910
    },
    {
        "content": "<p>I think LLVM can yes</p>",
        "id": 248719198,
        "sender_full_name": "Lucas Rosa",
        "timestamp": 1628346924
    },
    {
        "content": "<p>but not sure anyone has bothered yet</p>",
        "id": 248719204,
        "sender_full_name": "Lucas Rosa",
        "timestamp": 1628346933
    },
    {
        "content": "<p>well in theory we allow 32-bit pointers but nobody has tested that yet</p>",
        "id": 248719214,
        "sender_full_name": "Folkert de Vries",
        "timestamp": 1628346955
    },
    {
        "content": "<p>Which command would I need to run<br>\nI am not very experienced with this lower-level deelopment</p>",
        "id": 248719229,
        "sender_full_name": "Jan Wirth",
        "timestamp": 1628346963
    },
    {
        "content": "<p>so everything is built to allow it, but it's untested</p>",
        "id": 248719247,
        "sender_full_name": "Folkert de Vries",
        "timestamp": 1628346964
    },
    {
        "content": "<p>hmm, no idea actually</p>",
        "id": 248719266,
        "sender_full_name": "Folkert de Vries",
        "timestamp": 1628346996
    },
    {
        "content": "<p>I’m not sure there is one single command at the moment</p>",
        "id": 248719269,
        "sender_full_name": "Lucas Rosa",
        "timestamp": 1628347003
    },
    {
        "content": "<p>might have to dig in the code and pass some flags to LLVM at code gen?</p>",
        "id": 248719273,
        "sender_full_name": "Lucas Rosa",
        "timestamp": 1628347020
    },
    {
        "content": "<p>my assumption is that you'd need to get a hold of the LLVM IR (this is not hard, but not exposed in a friendly way) and then convert that to wasm</p>",
        "id": 248719280,
        "sender_full_name": "Folkert de Vries",
        "timestamp": 1628347032
    },
    {
        "content": "<p>Ah I see</p>",
        "id": 248719282,
        "sender_full_name": "Jan Wirth",
        "timestamp": 1628347036
    },
    {
        "content": "<p>but also you'd need to then also compile the host to wasm, and then link stuff together</p>",
        "id": 248719288,
        "sender_full_name": "Folkert de Vries",
        "timestamp": 1628347057
    },
    {
        "content": "<p>and we have some external dependencies too right now</p>",
        "id": 248719295,
        "sender_full_name": "Folkert de Vries",
        "timestamp": 1628347069
    },
    {
        "content": "<p>so, yea, it's not easy, might not totally work, but things are in place to make it possible at some point</p>",
        "id": 248719343,
        "sender_full_name": "Folkert de Vries",
        "timestamp": 1628347105
    },
    {
        "content": "<p>I see that there is compiler/build/src/target and there is a lot of llvm going on :D</p>",
        "id": 248719364,
        "sender_full_name": "Jan Wirth",
        "timestamp": 1628347111
    },
    {
        "content": "<p><a href=\"https://gist.github.com/yurydelendik/4eeff8248aeb14ce763e\">https://gist.github.com/yurydelendik/4eeff8248aeb14ce763e</a></p>\n<p>seems informative</p>",
        "id": 248719366,
        "sender_full_name": "Lucas Rosa",
        "timestamp": 1628347119
    },
    {
        "content": "<p>meh nvm, not so much, forget that link lol</p>",
        "id": 248719373,
        "sender_full_name": "Lucas Rosa",
        "timestamp": 1628347153
    },
    {
        "content": "<p>there sure is a lot of llvm going on. Now in theory we could also directly emit wasm bytecode</p>",
        "id": 248719430,
        "sender_full_name": "Folkert de Vries",
        "timestamp": 1628347218
    },
    {
        "content": "<p>for debug builds</p>",
        "id": 248719432,
        "sender_full_name": "Folkert de Vries",
        "timestamp": 1628347224
    },
    {
        "content": "<p>I was hoping maybe I can convert the dylib C code to wasm but that seems to not be the right way to go. Again I have next to no experience with compilers. I only compiled my beloved kakoune from source and managed to compile roc now, but I'm more an end-user than a direct user.</p>",
        "id": 248719435,
        "sender_full_name": "Jan Wirth",
        "timestamp": 1628347226
    },
    {
        "content": "<p>because LLVM is slow</p>",
        "id": 248719436,
        "sender_full_name": "Folkert de Vries",
        "timestamp": 1628347230
    },
    {
        "content": "<p>may I suggest zig to import the C source an emit wasm?</p>",
        "id": 248719449,
        "sender_full_name": "Folkert de Vries",
        "timestamp": 1628347273
    },
    {
        "content": "<p>How would emitting wasm bytecode hook into the compiler arch?</p>\n<p>I'm going to take a look at zig.</p>",
        "id": 248719452,
        "sender_full_name": "Jan Wirth",
        "timestamp": 1628347297
    },
    {
        "content": "<p>not sure what dylib you mean btw, but in general if you have C code and want wasm then I think zig is basicallythe easiest approach</p>",
        "id": 248719455,
        "sender_full_name": "Folkert de Vries",
        "timestamp": 1628347302
    },
    {
        "content": "<p>we already have <code>gen_llvm</code> and <code>gen_dev</code></p>",
        "id": 248719498,
        "sender_full_name": "Folkert de Vries",
        "timestamp": 1628347351
    },
    {
        "content": "<p>we could quite easily have a <code>gen_wasm</code></p>",
        "id": 248719501,
        "sender_full_name": "Folkert de Vries",
        "timestamp": 1628347360
    },
    {
        "content": "<p>it takes our intermediate representation and emits the bytecode</p>",
        "id": 248719508,
        "sender_full_name": "Folkert de Vries",
        "timestamp": 1628347370
    },
    {
        "content": "<p>I mean there's more to it than that, but at a high level</p>",
        "id": 248719514,
        "sender_full_name": "Folkert de Vries",
        "timestamp": 1628347389
    },
    {
        "content": "<p>I mean the dylib I can compile to with the --lib option. But that's not C code I just saw.</p>",
        "id": 248719609,
        "sender_full_name": "Jan Wirth",
        "timestamp": 1628347533
    },
    {
        "content": "<p>Yea using zig to build C code and cross compiling to wasm is smooth</p>",
        "id": 248719665,
        "sender_full_name": "Lucas Rosa",
        "timestamp": 1628347571
    },
    {
        "content": "<p>gen_wasm <span aria-label=\"drooling\" class=\"emoji emoji-1f924\" role=\"img\" title=\"drooling\">:drooling:</span></p>",
        "id": 248719681,
        "sender_full_name": "Lucas Rosa",
        "timestamp": 1628347606
    },
    {
        "content": "<p>one day for sure</p>",
        "id": 248719694,
        "sender_full_name": "Lucas Rosa",
        "timestamp": 1628347635
    },
    {
        "content": "<p>Do you have a good starting point to read about how to build a compiler?</p>",
        "id": 248719747,
        "sender_full_name": "Jan Wirth",
        "timestamp": 1628347695
    },
    {
        "content": "<p>not really, interestingly. It's such a broad topic, and there is a lot of space between \"technically working\" and what you should do if you write a real production-grade compiler</p>",
        "id": 248719828,
        "sender_full_name": "Folkert de Vries",
        "timestamp": 1628347834
    },
    {
        "content": "<p>but in general, there are 4 big phases: parsing, canonicalization (make sure names are defined and such), type checking, and code generation</p>",
        "id": 248719849,
        "sender_full_name": "Folkert de Vries",
        "timestamp": 1628347879
    },
    {
        "content": "<p>in practice there is also optimization as a part of code gen</p>",
        "id": 248719857,
        "sender_full_name": "Folkert de Vries",
        "timestamp": 1628347909
    },
    {
        "content": "<p>So the gen_wasm is only the last step, right? Are there guides on generator design? Or is it essentially learning how wasm bytecode works and then building a big ol module that outputs it with whatever means necessary?</p>",
        "id": 248719898,
        "sender_full_name": "Jan Wirth",
        "timestamp": 1628347942
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"431336\">@Jan Wirth</span> are you interested in working on adding wasm generation support to the Roc compiler? if so, I'd be happy to help via pair programming and such!</p>",
        "id": 248719917,
        "sender_full_name": "Richard Feldman",
        "timestamp": 1628347984
    },
    {
        "content": "<p>yes it's only the last step</p>",
        "id": 248719925,
        "sender_full_name": "Folkert de Vries",
        "timestamp": 1628347993
    },
    {
        "content": "<p>we do a lot of collaboration that way around here <span aria-label=\"big smile\" class=\"emoji emoji-1f604\" role=\"img\" title=\"big smile\">:big_smile:</span></p>",
        "id": 248719926,
        "sender_full_name": "Richard Feldman",
        "timestamp": 1628347995
    },
    {
        "content": "<p>idem on the pairing btw</p>",
        "id": 248719927,
        "sender_full_name": "Folkert de Vries",
        "timestamp": 1628347998
    },
    {
        "content": "<p>idem? <span aria-label=\"thinking\" class=\"emoji emoji-1f914\" role=\"img\" title=\"thinking\">:thinking:</span></p>",
        "id": 248719937,
        "sender_full_name": "Richard Feldman",
        "timestamp": 1628348015
    },
    {
        "content": "<p>it should mean \"the same\" or \"likewise\" in latin?</p>",
        "id": 248719946,
        "sender_full_name": "Folkert de Vries",
        "timestamp": 1628348036
    },
    {
        "content": "<p>I would be very pleased to do that but I would need to carve out some time / energy.</p>",
        "id": 248719986,
        "sender_full_name": "Jan Wirth",
        "timestamp": 1628348047
    },
    {
        "content": "<p>oh! TIL <span aria-label=\"big smile\" class=\"emoji emoji-1f604\" role=\"img\" title=\"big smile\">:big_smile:</span></p>",
        "id": 248719991,
        "sender_full_name": "Richard Feldman",
        "timestamp": 1628348052
    },
    {
        "content": "<p>and yea it's in essence converting our intermediate representation to the right  sequence of wasm bytecode instructions</p>",
        "id": 248719994,
        "sender_full_name": "Folkert de Vries",
        "timestamp": 1628348059
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"431336\">@Jan Wirth</span> cool! No pressure or anything, but feel free to hit me up anytime if you decide you want to dive into it!</p>",
        "id": 248720001,
        "sender_full_name": "Richard Feldman",
        "timestamp": 1628348093
    },
    {
        "content": "<p>but there are some design issues there with regards to how we use external code</p>",
        "id": 248720004,
        "sender_full_name": "Folkert de Vries",
        "timestamp": 1628348100
    },
    {
        "content": "<p>for sure</p>",
        "id": 248720014,
        "sender_full_name": "Richard Feldman",
        "timestamp": 1628348114
    },
    {
        "content": "<p>e.g. the host or some libc bits that we use</p>",
        "id": 248720017,
        "sender_full_name": "Folkert de Vries",
        "timestamp": 1628348116
    },
    {
        "content": "<p>I go on vacay in a week because I really need it and then I think I can decide if I can take it on and to what extend. I have an elm frontend to ship :)</p>",
        "id": 248720022,
        "sender_full_name": "Jan Wirth",
        "timestamp": 1628348124
    },
    {
        "content": "<p>cool cool! <span aria-label=\"thumbs up\" class=\"emoji emoji-1f44d\" role=\"img\" title=\"thumbs up\">:thumbs_up:</span></p>",
        "id": 248720025,
        "sender_full_name": "Richard Feldman",
        "timestamp": 1628348137
    },
    {
        "content": "<p>enjoy the vacation! <span aria-label=\"smiley\" class=\"emoji emoji-1f603\" role=\"img\" title=\"smiley\">:smiley:</span></p>",
        "id": 248720026,
        "sender_full_name": "Richard Feldman",
        "timestamp": 1628348141
    },
    {
        "content": "<p>so that makes me think maybe taking the LLVM IR we already make and try to turn that into a working wasm app may be an easier starting point</p>",
        "id": 248720027,
        "sender_full_name": "Folkert de Vries",
        "timestamp": 1628348143
    },
    {
        "content": "<p>could be, yeah</p>",
        "id": 248720030,
        "sender_full_name": "Richard Feldman",
        "timestamp": 1628348162
    },
    {
        "content": "<p>as a proof of concept</p>",
        "id": 248720069,
        "sender_full_name": "Richard Feldman",
        "timestamp": 1628348176
    },
    {
        "content": "<p>I'm happy and keen to put some stuff on my kindle though, so if you have a nice guide to pair-programming or compilers etc. please share :)</p>",
        "id": 248720070,
        "sender_full_name": "Jan Wirth",
        "timestamp": 1628348184
    },
    {
        "content": "<p>idem - as the first part of idempotence :)</p>",
        "id": 248720158,
        "sender_full_name": "Jan Wirth",
        "timestamp": 1628348354
    },
    {
        "content": "<p>not very kindle-friendly but I think elm's compiler source code is kind of the best thing to read (if you appreciate haskell, of course)</p>",
        "id": 248720237,
        "sender_full_name": "Folkert de Vries",
        "timestamp": 1628348416
    },
    {
        "content": "<p>I was already planning to write some <code>Str</code> docs today, so I'll see about adding some overall compiler docs in there</p>",
        "id": 248720255,
        "sender_full_name": "Richard Feldman",
        "timestamp": 1628348430
    },
    {
        "content": "<p>We would be targeting wat rather than wasm right?</p>",
        "id": 248720481,
        "sender_full_name": "Jan Wirth",
        "timestamp": 1628348830
    },
    {
        "content": "<p>I think wasm bytecode would break my brain <span aria-label=\"joy\" class=\"emoji emoji-1f602\" role=\"img\" title=\"joy\">:joy:</span></p>",
        "id": 248720505,
        "sender_full_name": "Jan Wirth",
        "timestamp": 1628348871
    },
    {
        "content": "<p>for speed you should really target the bytecode</p>",
        "id": 248720587,
        "sender_full_name": "Folkert de Vries",
        "timestamp": 1628349001
    },
    {
        "content": "<p>but you can always decompile that right to the text-based representation</p>",
        "id": 248720634,
        "sender_full_name": "Folkert de Vries",
        "timestamp": 1628349025
    },
    {
        "content": "<p>also doing the text-based one first is totally an option</p>",
        "id": 248720642,
        "sender_full_name": "Folkert de Vries",
        "timestamp": 1628349043
    },
    {
        "content": "<p>just to build up the experience of what the WASM format looks like</p>",
        "id": 248720651,
        "sender_full_name": "Folkert de Vries",
        "timestamp": 1628349062
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"431336\">@Jan Wirth</span> the <a href=\"http://craftinginterpreters.com\">craftinginterpreters.com</a> book is awesome, new, and beginner friendly. There is a web version available for free</p>",
        "id": 248721019,
        "sender_full_name": "Lucas Rosa",
        "timestamp": 1628349576
    },
    {
        "content": "<p>I'd imagine that also does a bunch with bytecode ?</p>",
        "id": 248721092,
        "sender_full_name": "Folkert de Vries",
        "timestamp": 1628349618
    },
    {
        "content": "<p>so part 2 is a tree walk interpreter and just traverses the AST for evaluation. Part 3 he redoes everything in C, makes a VM, bytecode from AST, and even a GC</p>",
        "id": 248721191,
        "sender_full_name": "Lucas Rosa",
        "timestamp": 1628349760
    },
    {
        "content": "<p>Part 2 is in Java but I’ve been translating it to rust as I go. Part 3 will be in zig for me</p>",
        "id": 248721203,
        "sender_full_name": "Lucas Rosa",
        "timestamp": 1628349784
    },
    {
        "content": "<p>oh and this new video is fun: <a href=\"https://youtu.be/Zkd3mZYOOvw\">https://youtu.be/Zkd3mZYOOvw</a></p>\n<div class=\"youtube-video message_inline_image\"><a data-id=\"Zkd3mZYOOvw\" href=\"https://youtu.be/Zkd3mZYOOvw\"><img src=\"https://uploads.zulipusercontent.net/5c72d8fcd2b5b335a2c70d77c438dc1a85cfe623/68747470733a2f2f692e7974696d672e636f6d2f76692f5a6b64336d5a594f4f76772f64656661756c742e6a7067\"></a></div>",
        "id": 248721411,
        "sender_full_name": "Lucas Rosa",
        "timestamp": 1628349995
    },
    {
        "content": "<p>JT worked on typescript, currently does nushell, and was on the same episode of zig showtime as me :D</p>",
        "id": 248721423,
        "sender_full_name": "Lucas Rosa",
        "timestamp": 1628350033
    },
    {
        "content": "<p>I just pulled the latest trunk and <code>cargo build</code> is throwing an error. Looks like a new package got added maybe? Anyone know how to fix it? I'm pretty new to Rust so it's probably something silly.</p>\n<div class=\"codehilite\"><pre><span></span><code>error: failed to run custom build command for `alsa-sys v0.3.1`\n\nthread &#39;main&#39; panicked at &#39;Failed to run `&quot;pkg-config&quot; &quot;--libs&quot; &quot;--cflags&quot; &quot;alsa&quot;`: No such file or directory (os error 2)&#39;, /home/brian/.cargo/registry/src/github.com-1ecc6299db9ec823/alsa-sys-0.3.1/build.rs:13:18\n</code></pre></div>",
        "id": 256979187,
        "sender_full_name": "Brian Carroll",
        "timestamp": 1633894960
    },
    {
        "content": "<p>if you're on Linux, the mention of <code>alsa</code> might mean it's related to audio - which we recently introduced to the editor</p>",
        "id": 256981083,
        "sender_full_name": "Richard Feldman",
        "timestamp": 1633896767
    },
    {
        "content": "<p>specifically the error seems to be coming from this crate: <a href=\"https://github.com/diwic/alsa-sys\">https://github.com/diwic/alsa-sys</a></p>",
        "id": 256981134,
        "sender_full_name": "Richard Feldman",
        "timestamp": 1633896838
    },
    {
        "content": "<p>it looks like the alsa-sys crate is using pkg-config to build something when the crate gets installed, but it's missing something</p>",
        "id": 256981341,
        "sender_full_name": "Richard Feldman",
        "timestamp": 1633896964
    },
    {
        "content": "<p>oh I bet it's this: <a href=\"https://github.com/diwic/alsa-sys/issues/9\">https://github.com/diwic/alsa-sys/issues/9</a></p>",
        "id": 256981404,
        "sender_full_name": "Richard Feldman",
        "timestamp": 1633897037
    },
    {
        "content": "<p>so maybe you need to have pkg-config installed? (And if so, maybe we need to add that to the building from source instructions)</p>",
        "id": 256981433,
        "sender_full_name": "Richard Feldman",
        "timestamp": 1633897074
    },
    {
        "content": "<p>Aha! <code>sudo apt-get install pkg-config</code> seems to have solved it. Thanks Richard!</p>",
        "id": 256989684,
        "sender_full_name": "Brian Carroll",
        "timestamp": 1633904528
    },
    {
        "content": "<p>I added <code>pkg-config</code> to building from source. I think I'll make a script to install everything required to build from source starting with Ubuntu/Debian.</p>",
        "id": 257025235,
        "sender_full_name": "Anton",
        "timestamp": 1633938105
    },
    {
        "content": "<p>Trying to build locally for the first time on WSL and getting</p>\n<div class=\"codehilite\"><pre><span></span><code>&gt; cargo run repl\n   Compiling roc_builtins v0.1.0 (/home/wolfadex/Development/roc/compiler/builtins)\n   Compiling pulldown-cmark v0.8.0\n   Compiling nix v0.17.0\n   Compiling dlib v0.5.0\n   Compiling ash v0.33.3+1.2.191\n   Compiling dlib v0.4.2\n   Compiling libc v0.2.101\n   Compiling proc-macro2 v1.0.29\nerror: failed to run custom build command for `roc_builtins v0.1.0 (/home/wolfadex/Development/roc/compiler/builtins)`\nCaused by:\n  process didn&#39;t exit successfully: `/home/wolfadex/Development/roc/target/debug/build/roc_builtins-9e4973e4a864c4ee/build-script-build` (exit status: 101)\n  --- stdout\n  cargo:rerun-if-changed=build.rs\n  cargo:rustc-env=BUILTINS_O=/home/wolfadex/Development/roc/target/debug/build/roc_builtins-00366df05b0327aa/out/builtins.o\n  Compiling zig object to: /home/wolfadex/Development/roc/compiler/builtins/bitcode/builtins-host.o\n\n  --- stderr\n  thread &#39;main&#39; panicked at &#39;zig failed: error: unable to find zig installation directory: FileNotFound\n  &#39;, compiler/builtins/build.rs:124:17\n  note: run with `RUST_BACKTRACE=1` environment variable to display a backtrace\nwarning: build failed, waiting for other jobs to finish...\nerror: build failed\n</code></pre></div>\n<p>Seems to be something Zig specific. Dug a little and saw that it's trying to do a <code>zig build ...</code> from <code>/compiler/builtins</code> and notice that if I run <code>zig build</code> I get the same error</p>\n<div class=\"codehilite\"><pre><span></span><code>&gt; zig build\nerror: unable to find zig installation directory: FileNotFound\n</code></pre></div>\n<p>Wanted to see if anyone had seen similar before I go digging more</p>",
        "id": 257129397,
        "sender_full_name": "Wolfgang Schuster",
        "timestamp": 1633995681
    },
    {
        "content": "<p>how did you install zig?</p>",
        "id": 257130226,
        "sender_full_name": "Lucas Rosa",
        "timestamp": 1633996378
    },
    {
        "content": "<p>It might not know where the source for zig std is</p>",
        "id": 257130332,
        "sender_full_name": "Lucas Rosa",
        "timestamp": 1633996449
    },
    {
        "content": "<p>I don't actually remember because I installed it many, many months ago. I'll try re-installing though, thanks!</p>",
        "id": 257131098,
        "sender_full_name": "Wolfgang Schuster",
        "timestamp": 1633997033
    },
    {
        "content": "<p>Thank you! That got me further</p>",
        "id": 257133831,
        "sender_full_name": "Wolfgang Schuster",
        "timestamp": 1633999445
    },
    {
        "content": "<p>no problem</p>",
        "id": 257134150,
        "sender_full_name": "Lucas Rosa",
        "timestamp": 1633999734
    },
    {
        "content": "<p>Hi all, silly question :)<br>\nwhen I run <code>cargo build --release</code>, should I see a roc CLI binary in <code>./target/release</code>?<br>\nI can see <code>roc</code>, but that's the editor right?<br>\nI was imagining I would build a binary executable and then add it to my PATH so that I can use roc in any arbitrary directory. <span aria-label=\"sweat smile\" class=\"emoji emoji-1f605\" role=\"img\" title=\"sweat smile\">:sweat_smile:</span></p>",
        "id": 258940543,
        "sender_full_name": "Nathan Kramer",
        "timestamp": 1635157705
    },
    {
        "content": "<p>If you use roc without any arguments, it opens the editor. You can also do<code>roc repl</code>, <code>roc FILENAME</code> or <code>roc --help</code>.</p>",
        "id": 258947043,
        "sender_full_name": "Shritesh Bhattarai",
        "timestamp": 1635162177
    },
    {
        "content": "<p>ohhh! that makes a lot of sense. Thank you!</p>",
        "id": 258947864,
        "sender_full_name": "Nathan Kramer",
        "timestamp": 1635162753
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"452796\">Nathan Kramer</span> has marked this topic as resolved.</p>",
        "id": 258947872,
        "sender_full_name": "Notification Bot",
        "timestamp": 1635162757
    },
    {
        "content": "<div class=\"codehilite\" data-code-language=\"Fish\"><pre><span></span><code><span class=\"o\">&gt;</span> cargo run --release examples/hello-world/Hello.roc\n    Finished release <span class=\"o\">[</span>optimized<span class=\"o\">]</span> target<span class=\"o\">(</span>s<span class=\"o\">)</span> <span class=\"k\">in</span> 0.23s\n     Running <span class=\"err\">`</span>target/release/roc examples/hello-world/Hello.roc<span class=\"err\">`</span>\n<span class=\"nb\">fish</span>: Job 1, <span class=\"s1\">'cargo run --release examples/he…'</span> terminated by signal SIGILL <span class=\"o\">(</span>Illegal instruction<span class=\"o\">)</span>\n</code></pre></div>",
        "id": 259190051,
        "sender_full_name": "Locria Cyber",
        "timestamp": 1635306553
    },
    {
        "content": "<p>I can't run any example code</p>",
        "id": 259190059,
        "sender_full_name": "Locria Cyber",
        "timestamp": 1635306576
    },
    {
        "content": "<p>What system are you running on? Also, if you run <code>cargo test</code>, which ones pass/fail?</p>",
        "id": 259192544,
        "sender_full_name": "Brendan Hansknecht",
        "timestamp": 1635309713
    },
    {
        "content": "<div class=\"codehilite\"><pre><span></span><code>running 22 tests\ntest cli_run::effect ... FAILED\ntest cli_run::closure ... FAILED\ntest cli_run::cli ... FAILED\ntest cli_run::hello_web ... ok\ntest cli_run::fib ... FAILED\ntest cli_run::cfold ... FAILED\ntest cli_run::hello_rust ... FAILED\ntest cli_run::astar ... FAILED\ntest cli_run::quicksort_app ... ok\ntest cli_run::hello_world ... FAILED\ntest cli_run::hello_zig ... FAILED\ntest cli_run::quicksort ... FAILED\ntest cli_run::run_multi_dep_str_optimized ... FAILED\ntest cli_run::nqueens ... FAILED\ntest cli_run::base64 ... FAILED\ntest cli_run::rbtree_insert ... FAILED\ntest cli_run::rbtree_ck ... FAILED\ntest cli_run::run_multi_dep_str_unoptimized ... FAILED\ntest cli_run::run_multi_dep_thunk_optimized ... FAILED\ntest cli_run::run_multi_dep_thunk_unoptimized ... FAILED\ntest cli_run::deriv ... FAILED\ntest cli_run::false_interpreter ... FAILED\n</code></pre></div>",
        "id": 259198890,
        "sender_full_name": "Locria Cyber",
        "timestamp": 1635317453
    },
    {
        "content": "<p>Linux</p>",
        "id": 259198903,
        "sender_full_name": "Locria Cyber",
        "timestamp": 1635317473
    },
    {
        "content": "<p>is this still with zig 9? because that just does not work</p>",
        "id": 259201302,
        "sender_full_name": "Folkert de Vries",
        "timestamp": 1635319406
    },
    {
        "content": "<p>the llvm versions are not compatible</p>",
        "id": 259201306,
        "sender_full_name": "Folkert de Vries",
        "timestamp": 1635319414
    },
    {
        "content": "<p>zig 0.8</p>",
        "id": 259201740,
        "sender_full_name": "Locria Cyber",
        "timestamp": 1635319735
    },
    {
        "content": "<p>interesting. does <code>cargo run -- build --release examples/hello-world/Hello.roc</code> work?</p>",
        "id": 259202510,
        "sender_full_name": "Folkert de Vries",
        "timestamp": 1635320323
    },
    {
        "content": "<p>that just makes the executable, but does not yet run it</p>",
        "id": 259202517,
        "sender_full_name": "Folkert de Vries",
        "timestamp": 1635320338
    },
    {
        "content": "<p>No</p>",
        "id": 259202827,
        "sender_full_name": "Locria Cyber",
        "timestamp": 1635320616
    },
    {
        "content": "<div class=\"codehilite\"><pre><span></span><code>Thread 1 &quot;roc&quot; received signal SIGILL, Illegal instruction.\n&lt;some location&gt; in llvm::getTimeTraceProfilerInstance() ()\n</code></pre></div>\n<p>from gdb</p>",
        "id": 259202946,
        "sender_full_name": "Locria Cyber",
        "timestamp": 1635320685
    },
    {
        "content": "<p>That just seem like LLVM's fault</p>",
        "id": 259202989,
        "sender_full_name": "Locria Cyber",
        "timestamp": 1635320720
    },
    {
        "content": "<p>which llvm version do you have?</p>",
        "id": 259203179,
        "sender_full_name": "Folkert de Vries",
        "timestamp": 1635320847
    },
    {
        "content": "<p>12.0.1-4</p>",
        "id": 259203773,
        "sender_full_name": "Locria Cyber",
        "timestamp": 1635321315
    },
    {
        "content": "<p>is there a way to build within a container with all the dependencies required?</p>",
        "id": 259203879,
        "sender_full_name": "Locria Cyber",
        "timestamp": 1635321377
    },
    {
        "content": "<p>there is a nix recipe, and also our CI script is like a container specification</p>",
        "id": 259203939,
        "sender_full_name": "Folkert de Vries",
        "timestamp": 1635321428
    },
    {
        "content": "<p>my guess would be that llvm 12.0.1 is not fully compatible with llvm 12.0</p>",
        "id": 259204043,
        "sender_full_name": "Folkert de Vries",
        "timestamp": 1635321483
    },
    {
        "content": "<p>will check out tomorrow</p>",
        "id": 259206501,
        "sender_full_name": "Locria Cyber",
        "timestamp": 1635323140
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"453395\">@Locria Cyber</span> if you want to try running roc, there is a nightly release available from a couple of days ago <a href=\"https://github.com/rtfeldman/roc/releases\">here</a>. If you want to change any source code there is a <a href=\"https://github.com/rtfeldman/roc/blob/install-script/developer_install.sh\">developer_install.sh script</a>(Debian/Ubuntu) that I still need to double check but should work as is. I also made you a docker container, I'll post a link when it is finished uploading. If you want to use nix, make sure to apply matthiasbeyer's fix, see PR #1831.</p>",
        "id": 259235200,
        "sender_full_name": "Anton",
        "timestamp": 1635340071
    },
    {
        "content": "<p><a href=\"https://www.dropbox.com/s/xhflg72q686l43y/rocdeps_docker.tar.gz?dl=0\">docker image download link</a></p>\n<div class=\"message_inline_ref\"><a href=\"https://www.dropbox.com/s/xhflg72q686l43y/rocdeps_docker.tar.gz?dl=0\" title=\"rocdeps_docker.tar.gz\"><img src=\"https://uploads.zulipusercontent.net/74b727dd00743da5547e0bcad41df666979ace9d/68747470733a2f2f7777772e64726f70626f782e636f6d2f7374617469632f696d616765732f737065637472756d2d69636f6e732f67656e6572617465642f636f6e74656e742f636f6e74656e742d7a69702d6c617267652e706e67\"></a><div><div class=\"message_inline_image_title\">rocdeps_docker.tar.gz</div><desc class=\"message_inline_image_desc\"></desc></div></div>",
        "id": 259235890,
        "sender_full_name": "Anton",
        "timestamp": 1635340381
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"361169\">@Anton</span> omg I did not know this was an option to use roc like that without all the install steps!</p>",
        "id": 259243914,
        "sender_full_name": "Oliver Schöning",
        "timestamp": 1635343590
    },
    {
        "content": "<p>It's a very recent addition :) I was planning on adding it to the docs once the release runs automatically every night, which should be soon.</p>",
        "id": 259253920,
        "sender_full_name": "Anton",
        "timestamp": 1635347214
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"361169\">@Anton</span> speaking of docs. If I want to see the docs do I need to run <code>cargo run docs</code> ?<br>\nCoz I tried that and got this on the latest master branch:</p>\n<div class=\"codehilite\"><pre><span></span><code>oliverschoning@pop-os:~/Projects/roc$ cargo run docs\n    Finished dev [unoptimized + debuginfo] target(s) in 0.18s\n     Running `target/debug/roc docs`\n── FILE NOT FOUND ──────────────────────────────────────────────────────────────\n\nI am looking for this file, but it&#39;s not there:\n\n    ./compiler/load/tests/fixtures/build/no_deps/ThisFileIsMissing.roc\n\nIs the file supposed to be there? Maybe there is a typo in the file\nname?\nthread &#39;main&#39; panicked at &#39;explicit panic&#39;, docs/src/lib.rs:436:17\nnote: run with `RUST_BACKTRACE=1` environment variable to display a backtrace\n</code></pre></div>",
        "id": 259255132,
        "sender_full_name": "Oliver Schöning",
        "timestamp": 1635347636
    },
    {
        "content": "<p>I dunno what \"Docs\" entails tbh. So far I am just looking at the examples folder and trying to see if I can manage to build something myself <span aria-label=\"big smile\" class=\"emoji emoji-1f604\" role=\"img\" title=\"big smile\">:big_smile:</span></p>",
        "id": 259255558,
        "sender_full_name": "Oliver Schöning",
        "timestamp": 1635347775
    },
    {
        "content": "<p>With docs I was referring to the repo README.<br>\nI suppose for making or changing examples, it is best to use these resources:</p>\n<ul>\n<li><a href=\"https://github.com/rtfeldman/roc/tree/trunk/compiler/builtins/docs\">builtin docs</a></li>\n<li><a href=\"https://github.com/rtfeldman/roc/blob/trunk/roc-for-elm-programmers.md\">roc-for-elm-programmers</a></li>\n<li><a href=\"https://www.youtube.com/watch?v=6qzWm_eoUXM\">intro to roc video by Richard</a><div class=\"youtube-video message_inline_image\"><a data-id=\"6qzWm_eoUXM\" href=\"https://www.youtube.com/watch?v=6qzWm_eoUXM\"><img src=\"https://uploads.zulipusercontent.net/c3a925ed18fe1016e197f6abdd6cd3ed6c8f1858/68747470733a2f2f692e7974696d672e636f6d2f76692f36717a576d5f656f55584d2f64656661756c742e6a7067\"></a></div></li>\n</ul>",
        "id": 259257282,
        "sender_full_name": "Anton",
        "timestamp": 1635348446
    },
    {
        "content": "<p>Ok thanks!</p>",
        "id": 259257501,
        "sender_full_name": "Oliver Schöning",
        "timestamp": 1635348526
    },
    {
        "content": "<p><code>cargo run  docs</code> generates documentation for roc files/projects, we're still working on docs syntax highlighting so I'm not sure how much the <code>cargo run docs</code> command does yet.</p>",
        "id": 259257577,
        "sender_full_name": "Anton",
        "timestamp": 1635348561
    },
    {
        "content": "<p>Ok, yeah I have never been this early to a project I suppose <span aria-label=\"smiley\" class=\"emoji emoji-1f603\" role=\"img\" title=\"smiley\">:smiley:</span></p>",
        "id": 259257689,
        "sender_full_name": "Oliver Schöning",
        "timestamp": 1635348603
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"361169\">Anton</span> <a href=\"#narrow/stream/231634-beginners/topic/.E2.9C.94.20building.20from.20source/near/259235200\">said</a>:</p>\n<blockquote>\n<p><span class=\"user-mention silent\" data-user-id=\"453395\">Locria Cyber</span> if you want to try running roc, there is a nightly release available from a couple of days ago <a href=\"https://github.com/rtfeldman/roc/releases\">here</a>. If you want to change any source code there is a <a href=\"https://github.com/rtfeldman/roc/blob/install-script/developer_install.sh\">developer_install.sh script</a>(Debian/Ubuntu) that I still need to double check but should work as is. I also made you a docker container, I'll post a link when it is finished uploading. If you want to use nix, make sure to apply matthiasbeyer's fix, see PR #1831.</p>\n</blockquote>\n<p>Can't use nightly release because of  <a href=\"https://github.com/rtfeldman/roc/issues/1811\">https://github.com/rtfeldman/roc/issues/1811</a></p>",
        "id": 259316070,
        "sender_full_name": "Locria Cyber",
        "timestamp": 1635373885
    },
    {
        "content": "<p>Can you try using the <code>--roc-linker</code> flag if you are on Linux?</p>",
        "id": 259323980,
        "sender_full_name": "Brendan Hansknecht",
        "timestamp": 1635379810
    },
    {
        "content": "<p>Hopefully this is the right forum for this, if not please advise!</p>\n<p>I'm trying to build from source on macOS Big Sur (11.6) and getting an error about llvm:</p>\n<p>I installed <code>llvm</code> with <code>brew install llvm@12</code> and then added <code>/usr/local/opt/llvm/bin</code> to my path, but noticed that no path by that name exists on my system, but <code>/usr/local/opt/llvm@12/bin</code> does, so I added that to my path and afterwards running <code>llc --version</code> generates output starting with <code>Homebrew LLVM version 12.0.1</code> as <code>BUILDING_FROM_SOURCE.md</code> mentions.</p>\n<p>Here's the output I get from running <code>cargo run repl</code>:</p>\n<div class=\"codehilite\"><pre><span></span><code>cargo run repl\n   Compiling llvm-sys v120.2.1\n   Compiling snafu v0.6.10\n   Compiling parking_lot_core v0.8.5\n   Compiling wasmer-vm v2.0.0\n   Compiling wasmer-wasi-types v2.0.0\n   Compiling cranelift-frontend v0.74.0\n   Compiling rodio v0.14.0\nerror: No suitable version of LLVM was found system-wide or pointed\n       to by LLVM_SYS_120_PREFIX.\n\n       Consider using `llvmenv` to compile an appropriate copy of LLVM, and\n       refer to the llvm-sys documentation for more information.\n\n       llvm-sys: https://crates.io/crates/llvm-sys\n       llvmenv: https://crates.io/crates/llvmenv\n   --&gt; /Users/llowder/.cargo/registry/src/github.com-1ecc6299db9ec823/llvm-sys-120.2.1/src/lib.rs:486:1\n    |\n486 | / std::compile_error!(concat!(\n487 | |     &quot;No suitable version of LLVM was found system-wide or pointed\n488 | |        to by LLVM_SYS_&quot;,\n489 | |     env!(&quot;CARGO_PKG_VERSION_MAJOR&quot;),\n...   |\n496 | |        llvmenv: https://crates.io/crates/llvmenv&quot;\n497 | | ));\n    | |___^\n\nerror: could not compile `llvm-sys` due to previous error\nwarning: build failed, waiting for other jobs to finish...\nerror: build failed\n</code></pre></div>",
        "id": 259586940,
        "sender_full_name": "Logan Lowder",
        "timestamp": 1635543880
    },
    {
        "content": "<p>Went ahead and opened an issue for posterity: <a href=\"https://github.com/rtfeldman/roc/issues/1843\">https://github.com/rtfeldman/roc/issues/1843</a></p>",
        "id": 259587501,
        "sender_full_name": "Logan Lowder",
        "timestamp": 1635544333
    },
    {
        "content": "<p>you can set that environment variable explicitly, I have this in </p>\n<div class=\"codehilite\"><pre><span></span><code>set -x LLVM_SYS_120_PREFIX &quot;/home/folkertdev/Downloads/clang+llvm-12.0.0-x86_64-linux-gnu-ubuntu-20.04&quot;\n</code></pre></div>",
        "id": 259587597,
        "sender_full_name": "Folkert de Vries",
        "timestamp": 1635544416
    },
    {
        "content": "<p>the fish shell equivalent of <code>.bashrc</code></p>",
        "id": 259587652,
        "sender_full_name": "Folkert de Vries",
        "timestamp": 1635544449
    },
    {
        "content": "<p>Thanks! Let me noodle on this see if I can get it working</p>",
        "id": 259588557,
        "sender_full_name": "Logan Lowder",
        "timestamp": 1635545061
    },
    {
        "content": "<p>Hmm wondering where I can find the path of that file on my system <span aria-label=\"thinking\" class=\"emoji emoji-1f914\" role=\"img\" title=\"thinking\">:thinking:</span></p>",
        "id": 259588744,
        "sender_full_name": "Logan Lowder",
        "timestamp": 1635545192
    },
    {
        "content": "<p>it might be easier to install Nix and do things that way <span aria-label=\"sweat smile\" class=\"emoji emoji-1f605\" role=\"img\" title=\"sweat smile\">:sweat_smile:</span></p>",
        "id": 259588787,
        "sender_full_name": "Richard Feldman",
        "timestamp": 1635545247
    },
    {
        "content": "<p>ha maybe I should</p>",
        "id": 259588805,
        "sender_full_name": "Logan Lowder",
        "timestamp": 1635545266
    },
    {
        "content": "<p>I think I was over thinking it! <code>export LLVM_SYS_120_PREFIX=/usr/local/opt/llvm@12</code> seems to make it happier</p>",
        "id": 259588977,
        "sender_full_name": "Logan Lowder",
        "timestamp": 1635545382
    },
    {
        "content": "<p>I was thinking the prefix was supposed to be a specific executable rather than the dir where llvm lives</p>",
        "id": 259589061,
        "sender_full_name": "Logan Lowder",
        "timestamp": 1635545416
    },
    {
        "content": "<blockquote>\n<p>The rockin’ roc repl</p>\n</blockquote>\n<p>HUZZAH</p>",
        "id": 259589084,
        "sender_full_name": "Logan Lowder",
        "timestamp": 1635545434
    },
    {
        "content": "<p>Perhaps I should open a PR to update BUILDING_FROM_SOURCE.md</p>",
        "id": 259589133,
        "sender_full_name": "Logan Lowder",
        "timestamp": 1635545477
    },
    {
        "content": "<p>awesome, please do! <span aria-label=\"tada\" class=\"emoji emoji-1f389\" role=\"img\" title=\"tada\">:tada:</span></p>",
        "id": 259589669,
        "sender_full_name": "Richard Feldman",
        "timestamp": 1635545814
    },
    {
        "content": "<p><a href=\"https://github.com/rtfeldman/roc/pull/1850\">https://github.com/rtfeldman/roc/pull/1850</a></p>",
        "id": 259744603,
        "sender_full_name": "Logan Lowder",
        "timestamp": 1635618276
    },
    {
        "content": "<p>I tried to use Nix for building Roc.</p>",
        "id": 259771047,
        "sender_full_name": "Locria Cyber",
        "timestamp": 1635660203
    },
    {
        "content": "<div class=\"codehilite\"><pre><span></span><code>thread &#39;main&#39; panicked at &#39;Request adapter&#39;, editor/src/editor/main.rs:82:14\n</code></pre></div>",
        "id": 259771049,
        "sender_full_name": "Locria Cyber",
        "timestamp": 1635660212
    },
    {
        "content": "<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"w\">    </span><span class=\"kd\">let</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">gpu_device</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">cmd_queue</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">futures</span>::<span class=\"n\">executor</span>::<span class=\"n\">block_on</span><span class=\"p\">(</span><span class=\"k\">async</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\"></span>\n<span class=\"w\">        </span><span class=\"kd\">let</span><span class=\"w\"> </span><span class=\"n\">adapter</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">instance</span><span class=\"w\"></span>\n<span class=\"w\">            </span><span class=\"p\">.</span><span class=\"n\">request_adapter</span><span class=\"p\">(</span><span class=\"o\">&amp;</span><span class=\"n\">wgpu</span>::<span class=\"n\">RequestAdapterOptions</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\"></span>\n<span class=\"w\">                </span><span class=\"n\">power_preference</span>: <span class=\"nc\">wgpu</span>::<span class=\"n\">PowerPreference</span>::<span class=\"n\">HighPerformance</span><span class=\"p\">,</span><span class=\"w\"></span>\n<span class=\"w\">                </span><span class=\"n\">compatible_surface</span>: <span class=\"nb\">Some</span><span class=\"p\">(</span><span class=\"o\">&amp;</span><span class=\"n\">surface</span><span class=\"p\">),</span><span class=\"w\"></span>\n<span class=\"w\">            </span><span class=\"p\">})</span><span class=\"w\"></span>\n<span class=\"w\">            </span><span class=\"p\">.</span><span class=\"k\">await</span><span class=\"w\"></span>\n<span class=\"w\">            </span><span class=\"p\">.</span><span class=\"n\">expect</span><span class=\"p\">(</span><span class=\"s\">\"Request adapter\"</span><span class=\"p\">);</span><span class=\"w\"></span>\n</code></pre></div>",
        "id": 259771053,
        "sender_full_name": "Locria Cyber",
        "timestamp": 1635660222
    },
    {
        "content": "<div class=\"codehilite\"><pre><span></span><code>[nix-shell:~/computing/roc]$ glxgears\nglxgears: symbol lookup error: /nix/store/mij848h2x5wiqkwhg027byvmf9x3gx7y-glibc-2.33-50/lib/libdl.so.2: undefined symbol: _dl_catch_error_ptr, version GLIBC_PRIVATE\n\n[nix-shell:~/computing/roc]$ vulkaninfo\nERROR: [Loader Message] Code 0 : libdrm.so.2: cannot open shared object file: No such file or directory\nERROR: [Loader Message] Code 0 : libLLVM-12.so: cannot open shared object file: No such file or directory\nERROR: [Loader Message] Code 0 : libGLX_nvidia.so.0: cannot open shared object file: No such file or directory\nCannot create Vulkan instance.\nThis problem is often caused by a faulty installation of the Vulkan driver or attempting to use a GPU that does not support Vulkan.\nERROR at /build/source/vulkaninfo/vulkaninfo.h:687:vkCreateInstance failed with ERROR_INCOMPATIBLE_DRIVER\n\n[nix-shell:~/computing/roc]$ which vulkaninfo\n/nix/store/9bn3gwiw64bdxi7k9a2h39974c39cs89-vulkan-tools-1.2.189.1/bin/vulkaninfo\n</code></pre></div>",
        "id": 259771165,
        "sender_full_name": "Locria Cyber",
        "timestamp": 1635660369
    },
    {
        "content": "<p>totally not working</p>",
        "id": 259771173,
        "sender_full_name": "Locria Cyber",
        "timestamp": 1635660391
    },
    {
        "content": "<p>At least hello world works now</p>",
        "id": 259771664,
        "sender_full_name": "Locria Cyber",
        "timestamp": 1635661272
    },
    {
        "content": "<p>Installed nixGL, and now another library panics. I think I'll not use roc-editor then.</p>",
        "id": 259772150,
        "sender_full_name": "Locria Cyber",
        "timestamp": 1635662117
    },
    {
        "content": "<p>Hi Locria, sorry about this, it sounds very frustrating.<br>\nThe roc editor is still a WIP and not ready yet to replace your favorite editor, I'll make sure to mention this in the BUILDING_FROM_SOURCE file.<br>\nThe editor installation process will be much improved in the near future.<br>\nI was able to reproduce this error locally and will look at it soon.</p>",
        "id": 259783023,
        "sender_full_name": "Anton",
        "timestamp": 1635679103
    },
    {
        "content": "<p>This is the fix for when you have a Nvidia GPU:</p>\n<div class=\"codehilite\"><pre><span></span><code># outside of nix shell:\nnix-channel --add https://github.com/guibou/nixGL/archive/main.tar.gz nixgl &amp;&amp; nix-channel --update\nnix-env -iA nixgl.auto.nixVulkanNvidia\n# does not work with nix-shell --pure\nnix-shell\n# 460.91.03 may be different for you, type nixVulkanNvidia and press tab to autocomplete for your version\nnixVulkanNvidia-460.91.03 cargo run edit\n</code></pre></div>\n<p>I'll post a fix for integrated intel graphics soon (after I verified it).</p>",
        "id": 259787898,
        "sender_full_name": "Anton",
        "timestamp": 1635686820
    },
    {
        "content": "<p>Fixing nixGL with integrated intel graphics is going to take some time.</p>",
        "id": 259791711,
        "sender_full_name": "Anton",
        "timestamp": 1635692576
    },
    {
        "content": "<p>I've had no problems in running the tests while writing builtins, but I just tried the REPL on macOS and it just fail upon evaluating any Roc code. Seems like it can't find a given dylib. Any ideas?</p>\n<p><a href=\"/user_uploads/22008/Ck1LP6SUxAworTF8n7U_Vgve/Screenshot-2021-11-03-at-12.41.57.png\">Screenshot-2021-11-03-at-12.41.57.png</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/22008/Ck1LP6SUxAworTF8n7U_Vgve/Screenshot-2021-11-03-at-12.41.57.png\" title=\"Screenshot-2021-11-03-at-12.41.57.png\"><img src=\"/user_uploads/22008/Ck1LP6SUxAworTF8n7U_Vgve/Screenshot-2021-11-03-at-12.41.57.png\"></a></div>",
        "id": 260121250,
        "sender_full_name": "Kevin Hovsäter",
        "timestamp": 1635939722
    },
    {
        "content": "<p>Hmm something else must be going on. All tests are failing since I updated my branch with latest <code>trunk</code>.</p>",
        "id": 260121882,
        "sender_full_name": "Kevin Hovsäter",
        "timestamp": 1635940163
    },
    {
        "content": "<p><a href=\"/user_uploads/22008/A-0BZ1bi1skrQlu_KrmUnKKn/Screenshot-2021-11-03-at-12.49.52.png\">Screenshot-2021-11-03-at-12.49.52.png</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/22008/A-0BZ1bi1skrQlu_KrmUnKKn/Screenshot-2021-11-03-at-12.49.52.png\" title=\"Screenshot-2021-11-03-at-12.49.52.png\"><img src=\"/user_uploads/22008/A-0BZ1bi1skrQlu_KrmUnKKn/Screenshot-2021-11-03-at-12.49.52.png\"></a></div>",
        "id": 260121916,
        "sender_full_name": "Kevin Hovsäter",
        "timestamp": 1635940198
    },
    {
        "content": "<p>Problems averted. Turns out I had to upgrade my CLT since upgrading to macOS Monterey. All good now. <span aria-label=\"smile\" class=\"emoji emoji-1f642\" role=\"img\" title=\"smile\">:smile:</span></p>",
        "id": 260123067,
        "sender_full_name": "Kevin Hovsäter",
        "timestamp": 1635940886
    },
    {
        "content": "<p>Looks like I get a failing test case though when running <code>cargo test</code>. This is on macOS 12.0.1, running Rust 1.56.0 and Zig 0.8.1.</p>\n<p><a href=\"/user_uploads/22008/BuNOlQ4_ntomQTuDvu7uXC9l/Screenshot-2021-11-03-at-13.11.34.png\">Screenshot-2021-11-03-at-13.11.34.png</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/22008/BuNOlQ4_ntomQTuDvu7uXC9l/Screenshot-2021-11-03-at-13.11.34.png\" title=\"Screenshot-2021-11-03-at-13.11.34.png\"><img src=\"/user_uploads/22008/BuNOlQ4_ntomQTuDvu7uXC9l/Screenshot-2021-11-03-at-13.11.34.png\"></a></div>",
        "id": 260124303,
        "sender_full_name": "Kevin Hovsäter",
        "timestamp": 1635941537
    },
    {
        "content": "<p>Rerunning the tests using <code>cargo test -p test_gen --lib</code> gave me the following error:</p>\n<p><a href=\"/user_uploads/22008/Gv6SIqxd_iI2D8SVyWzQtRpl/Screenshot-2021-11-03-at-13.39.39.png\">Screenshot-2021-11-03-at-13.39.39.png</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/22008/Gv6SIqxd_iI2D8SVyWzQtRpl/Screenshot-2021-11-03-at-13.39.39.png\" title=\"Screenshot-2021-11-03-at-13.39.39.png\"><img src=\"/user_uploads/22008/Gv6SIqxd_iI2D8SVyWzQtRpl/Screenshot-2021-11-03-at-13.39.39.png\"></a></div>",
        "id": 260127668,
        "sender_full_name": "Kevin Hovsäter",
        "timestamp": 1635943223
    },
    {
        "content": "<p>Rerunning the tests inside of <code>lldb</code> breaks on <code>gen_primitives::lambda_set_enum_byte_byte</code>, but running the test in isolation doesn't cause any issues.</p>",
        "id": 260128072,
        "sender_full_name": "Kevin Hovsäter",
        "timestamp": 1635943448
    },
    {
        "content": "<p>I've never used tools such as <code>gdb</code>, <code>lldb</code> and <code>valgrind</code>, so I'm not really sure how to debug this. I'd love to pair on it if someone wants to.</p>",
        "id": 260128301,
        "sender_full_name": "Kevin Hovsäter",
        "timestamp": 1635943581
    },
    {
        "content": "<p>Not sure if this helps or not, but running <code>cargo test --release -p test_gen --lib</code> also cause the same issue. So it's persistent in both debug and release builds.</p>",
        "id": 260158236,
        "sender_full_name": "Kevin Hovsäter",
        "timestamp": 1635956242
    },
    {
        "content": "<p>probably another case of macos being more strict, let me run this with valgrind</p>",
        "id": 260158404,
        "sender_full_name": "Folkert de Vries",
        "timestamp": 1635956313
    },
    {
        "content": "<p>and for you to follow along, I put the test into its own file (I pick <code>examples/benchmarks/Scratchpad.roc</code> for this</p>\n<div class=\"codehilite\"><pre><span></span><code>app &quot;scratchpad&quot;\n     packages { base: &quot;platform&quot; }\n     imports [base.Task]\n     provides [ main ] to base\n\n\nmain : Task.Task {} []\nmain =\n    r : [ Red, Green, Blue ]\n    r = Red\n\n    g : [ Red, Green, Blue ]\n    g = Green\n\n    p1 = (\\u -&gt; r == u)\n    p2 = (\\u -&gt; g == u)\n    oneOfResult = List.map [p1, p2] (\\p -&gt; p Green)\n\n    when List.len oneOfResult is\n        n -&gt; Task.putLine (Str.fromInt n)\n</code></pre></div>\n\n<p>Now we can compile this. I use the <code>--debug</code> flag, which will give extra info like line numbers. It requires you install <code>debugir</code>. If you haven't, just run this and the error message will point you to where to get it from:</p>\n<div class=\"codehilite\"><pre><span></span><code>cargo run -- --debug examples/benchmarks/Scratchpad.roc\n</code></pre></div>\n\n<p>Now, from <code>examples/benchmarks</code>, we can run valgrind</p>\n<div class=\"codehilite\"><pre><span></span><code>valgrind --leak-check=full --track-origins=yes ./scratchpad\n</code></pre></div>\n\n<p>Which gives a bunch of errors</p>\n<div class=\"codehilite\"><pre><span></span><code>==346834== Memcheck, a memory error detector\n==346834== Copyright (C) 2002-2017, and GNU GPL&#39;d, by Julian Seward et al.\n==346834== Using Valgrind-3.15.0 and LibVEX; rerun with -h for copyright info\n==346834== Command: ./scratchpad\n==346834== \n==346834== Invalid write of size 8\n==346834==    at 0x152714: ??? (Scratchpad.ll:1665)\n==346834==    by 0x152628: roc__mainForHost_1_exposed_generic (Scratchpad.ll:1593)\n==346834==    by 0x1112A0: main (host.zig:103)\n==346834==  Address 0x4c05060 is 6 bytes after a block of size 26 alloc&#39;d\n==346834==    at 0x483B7F3: malloc (in /usr/lib/x86_64-linux-gnu/valgrind/vgpreload_memcheck-amd64-linux.so)\n==346834==    by 0x110D57: roc_alloc (host.zig:48)\n==346834==    by 0x1526F2: ??? (Scratchpad.ll:1651)\n==346834==    by 0x152628: roc__mainForHost_1_exposed_generic (Scratchpad.ll:1593)\n==346834==    by 0x1112A0: main (host.zig:103)\n==346834== \n==346834== Invalid read of size 8\n==346834==    at 0x152850: ??? (Scratchpad.ll:1764)\n==346834==    by 0x152725: ??? (Scratchpad.ll:1668)\n==346834==    by 0x152628: roc__mainForHost_1_exposed_generic (Scratchpad.ll:1593)\n==346834==    by 0x1112A0: main (host.zig:103)\n==346834==  Address 0x4c05059 is 25 bytes inside a block of size 26 alloc&#39;d\n==346834==    at 0x483B7F3: malloc (in /usr/lib/x86_64-linux-gnu/valgrind/vgpreload_memcheck-amd64-linux.so)\n==346834==    by 0x110D57: roc_alloc (host.zig:48)\n==346834==    by 0x1526F2: ??? (Scratchpad.ll:1651)\n==346834==    by 0x152628: roc__mainForHost_1_exposed_generic (Scratchpad.ll:1593)\n==346834==    by 0x1112A0: main (host.zig:103)\n==346834== \n==346834== Conditional jump or move depends on uninitialised value(s)\n==346834==    at 0x152766: ??? (Scratchpad.ll:1681)\n==346834==    by 0x15285A: ??? (Scratchpad.ll:1765)\n==346834==    by 0x152725: ??? (Scratchpad.ll:1668)\n==346834==    by 0x152628: roc__mainForHost_1_exposed_generic (Scratchpad.ll:1593)\n==346834==    by 0x1112A0: main (host.zig:103)\n==346834==  Uninitialised value was created by a heap allocation\n==346834==    at 0x483B7F3: malloc (in /usr/lib/x86_64-linux-gnu/valgrind/vgpreload_memcheck-amd64-linux.so)\n==346834==    by 0x110D57: roc_alloc (host.zig:48)\n==346834==    by 0x1526F2: ??? (Scratchpad.ll:1651)\n==346834==    by 0x152628: roc__mainForHost_1_exposed_generic (Scratchpad.ll:1593)\n==346834==    by 0x1112A0: main (host.zig:103)\n==346834== \n2\nruntime: 17.481ms\n==346834== \n==346834== HEAP SUMMARY:\n==346834==     in use at exit: 0 bytes in 0 blocks\n==346834==   total heap usage: 2 allocs, 2 frees, 36 bytes allocated\n==346834== \n==346834== All heap blocks were freed -- no leaks are possible\n==346834== \n==346834== For lists of detected and suppressed errors, rerun with: -s\n==346834== ERROR SUMMARY: 3 errors from 3 contexts (suppressed: 0 from 0)\n</code></pre></div>\n\n<p>That <code>--debug</code> flag also make sure the LLVM IR is written to <code>Scratchpad.ll</code>, so we can inspect it. Usually it makes most sense to work from the top error downward. In this case, that line points us to this LLVM IR</p>\n<div class=\"codehilite\"><pre><span></span><code>%roc_alloc = tail call i8* @roc_alloc(i64 26, i32 1)\n...\n%.repack22 = getelementptr inbounds i8, i8* %roc_alloc, i64 32\n</code></pre></div>\n\n<p>where we allocate something that is 26 bytes, but then get a pointer to its 32th byte. That's an out of bounds access, and definitely a bug</p>",
        "id": 260160245,
        "sender_full_name": "Folkert de Vries",
        "timestamp": 1635957120
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"452574\">Kevin Sjöberg</span> <a href=\"#narrow/stream/231634-beginners/topic/.E2.9C.94.20building.20from.20source/near/260128301\">said</a>:</p>\n<blockquote>\n<p>I've never used tools such as <code>gdb</code>, <code>lldb</code> and <code>valgrind</code>, so I'm not really sure how to debug this. I'd love to pair on it if someone wants to.</p>\n</blockquote>\n<p>If your ever interested in learning more about these tools, I am willing to pair. Just DM me. I have used them quite a bit, especially since I tend to deal with low level stuff within roc.</p>",
        "id": 260160705,
        "sender_full_name": "Brendan Hansknecht",
        "timestamp": 1635957293
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"281543\">Folkert de Vries</span> <a href=\"#narrow/stream/231634-beginners/topic/.E2.9C.94.20building.20from.20source/near/260160245\">said</a>:</p>\n<blockquote>\n<p>and for you to follow along, I put the test into its own file (I pick <code>examples/benchmarks/Scratchpad.roc</code> for this</p>\n<div class=\"codehilite\"><pre><span></span><code>app &quot;scratchpad&quot;\n     packages { base: &quot;platform&quot; }\n     imports [base.Task]\n     provides [ main ] to base\n\n\nmain : Task.Task {} []\nmain =\n    r : [ Red, Green, Blue ]\n    r = Red\n\n    g : [ Red, Green, Blue ]\n    g = Green\n\n    p1 = (\\u -&gt; r == u)\n    p2 = (\\u -&gt; g == u)\n    oneOfResult = List.map [p1, p2] (\\p -&gt; p Green)\n\n    when List.len oneOfResult is\n        n -&gt; Task.putLine (Str.fromInt n)\n</code></pre></div>\n\n<p>Now we can compile this. I use the <code>--debug</code> flag, which will give extra info like line numbers. It requires you install <code>debugir</code>. If you haven't, just run this and the error message will point you to where to get it from:</p>\n<div class=\"codehilite\"><pre><span></span><code>cargo run -- --debug examples/benchmarks/Scratchpad.roc\n</code></pre></div>\n\n<p>Now, from <code>examples/benchmarks</code>, we can run valgrind</p>\n<div class=\"codehilite\"><pre><span></span><code>valgrind --leak-check=full --track-origins=yes ./scratchpad\n</code></pre></div>\n\n<p>Which gives a bunch of errors</p>\n<div class=\"codehilite\"><pre><span></span><code>==346834== Memcheck, a memory error detector\n==346834== Copyright (C) 2002-2017, and GNU GPL&#39;d, by Julian Seward et al.\n==346834== Using Valgrind-3.15.0 and LibVEX; rerun with -h for copyright info\n==346834== Command: ./scratchpad\n==346834== \n==346834== Invalid write of size 8\n==346834==    at 0x152714: ??? (Scratchpad.ll:1665)\n==346834==    by 0x152628: roc__mainForHost_1_exposed_generic (Scratchpad.ll:1593)\n==346834==    by 0x1112A0: main (host.zig:103)\n==346834==  Address 0x4c05060 is 6 bytes after a block of size 26 alloc&#39;d\n==346834==    at 0x483B7F3: malloc (in /usr/lib/x86_64-linux-gnu/valgrind/vgpreload_memcheck-amd64-linux.so)\n==346834==    by 0x110D57: roc_alloc (host.zig:48)\n==346834==    by 0x1526F2: ??? (Scratchpad.ll:1651)\n==346834==    by 0x152628: roc__mainForHost_1_exposed_generic (Scratchpad.ll:1593)\n==346834==    by 0x1112A0: main (host.zig:103)\n==346834== \n==346834== Invalid read of size 8\n==346834==    at 0x152850: ??? (Scratchpad.ll:1764)\n==346834==    by 0x152725: ??? (Scratchpad.ll:1668)\n==346834==    by 0x152628: roc__mainForHost_1_exposed_generic (Scratchpad.ll:1593)\n==346834==    by 0x1112A0: main (host.zig:103)\n==346834==  Address 0x4c05059 is 25 bytes inside a block of size 26 alloc&#39;d\n==346834==    at 0x483B7F3: malloc (in /usr/lib/x86_64-linux-gnu/valgrind/vgpreload_memcheck-amd64-linux.so)\n==346834==    by 0x110D57: roc_alloc (host.zig:48)\n==346834==    by 0x1526F2: ??? (Scratchpad.ll:1651)\n==346834==    by 0x152628: roc__mainForHost_1_exposed_generic (Scratchpad.ll:1593)\n==346834==    by 0x1112A0: main (host.zig:103)\n==346834== \n==346834== Conditional jump or move depends on uninitialised value(s)\n==346834==    at 0x152766: ??? (Scratchpad.ll:1681)\n==346834==    by 0x15285A: ??? (Scratchpad.ll:1765)\n==346834==    by 0x152725: ??? (Scratchpad.ll:1668)\n==346834==    by 0x152628: roc__mainForHost_1_exposed_generic (Scratchpad.ll:1593)\n==346834==    by 0x1112A0: main (host.zig:103)\n==346834==  Uninitialised value was created by a heap allocation\n==346834==    at 0x483B7F3: malloc (in /usr/lib/x86_64-linux-gnu/valgrind/vgpreload_memcheck-amd64-linux.so)\n==346834==    by 0x110D57: roc_alloc (host.zig:48)\n==346834==    by 0x1526F2: ??? (Scratchpad.ll:1651)\n==346834==    by 0x152628: roc__mainForHost_1_exposed_generic (Scratchpad.ll:1593)\n==346834==    by 0x1112A0: main (host.zig:103)\n==346834== \n2\nruntime: 17.481ms\n==346834== \n==346834== HEAP SUMMARY:\n==346834==     in use at exit: 0 bytes in 0 blocks\n==346834==   total heap usage: 2 allocs, 2 frees, 36 bytes allocated\n==346834== \n==346834== All heap blocks were freed -- no leaks are possible\n==346834== \n==346834== For lists of detected and suppressed errors, rerun with: -s\n==346834== ERROR SUMMARY: 3 errors from 3 contexts (suppressed: 0 from 0)\n</code></pre></div>\n\n<p>That <code>--debug</code> flag also make sure the LLVM IR is written to <code>Scratchpad.ll</code>, so we can inspect it. Usually it makes most sense to work from the top error downward. In this case, that line points us to this LLVM IR</p>\n<div class=\"codehilite\"><pre><span></span><code>%roc_alloc = tail call i8* @roc_alloc(i64 26, i32 1)\n...\n%.repack22 = getelementptr inbounds i8, i8* %roc_alloc, i64 32\n</code></pre></div>\n\n<p>where we allocate something that is 26 bytes, but then get a pointer to its 32th byte. That's an out of bounds access, and definitely a bug</p>\n</blockquote>\n<p>This was super helpful! How did you know which test to use? To me it looked like it was failing randomly on different test cases.</p>",
        "id": 260161977,
        "sender_full_name": "Kevin Hovsäter",
        "timestamp": 1635957833
    },
    {
        "content": "<p>this was the one that you said failed. I'd usually use lldb to find out where the segfault happens</p>",
        "id": 260162145,
        "sender_full_name": "Folkert de Vries",
        "timestamp": 1635957889
    },
    {
        "content": "<p>I see. Are you looking into it now or should I give it a shot myself?</p>",
        "id": 260162656,
        "sender_full_name": "Kevin Hovsäter",
        "timestamp": 1635958103
    },
    {
        "content": "<p>I'm looking at it, you can give it a go too. My theory is that we're allocating too little memory here, likely not taking alignment into account</p>",
        "id": 260162950,
        "sender_full_name": "Folkert de Vries",
        "timestamp": 1635958219
    },
    {
        "content": "<p>I got it</p>",
        "id": 260164311,
        "sender_full_name": "Folkert de Vries",
        "timestamp": 1635958738
    },
    {
        "content": "<p>can you check the tests with this PR <a href=\"https://github.com/rtfeldman/roc/pull/1885\">https://github.com/rtfeldman/roc/pull/1885</a></p>",
        "id": 260167844,
        "sender_full_name": "Folkert de Vries",
        "timestamp": 1635960199
    },
    {
        "content": "<p>Sure. I’ll try it out. Really impressed with your debugging skills. Would love to know more about how you ended up finding where the problem was. 🙂</p>",
        "id": 260168315,
        "sender_full_name": "Kevin Hovsäter",
        "timestamp": 1635960418
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"281543\">@Folkert de Vries</span> seems to have fixed it! Get another failure, but I think it's unrelated. It's the hello_swift one.</p>",
        "id": 260172372,
        "sender_full_name": "Kevin Hovsäter",
        "timestamp": 1635962228
    },
    {
        "content": "<p>hm, <code>gen_tags</code> fails for me on that branch on x64 macOS</p>\n<div class=\"codehilite\"><pre><span></span><code>test gen_tags::false_is_false ... ok\ntest gen_tags::applied_tag_just_enum ... ok\ntest gen_tags::alignment_in_multi_tag_construction_two ... ok\ntest_gen-ef19d83dce25afb6(25024,0x700007630000) malloc: *** error for object 0x7fee1a1705d0: pointer being freed was not allocated\ntest_gen-ef19d83dce25afb6(25024,0x700007630000) malloc: *** set a breakpoint in malloc_error_break to debug\n</code></pre></div>",
        "id": 260174255,
        "sender_full_name": "Richard Feldman",
        "timestamp": 1635962974
    },
    {
        "content": "<p>I'm also on x64. I had a failure initially, but after running <code>cargo clean</code> and then <code>cargo test</code> they all seem to pass consistently.</p>",
        "id": 260175276,
        "sender_full_name": "Kevin Hovsäter",
        "timestamp": 1635963378
    },
    {
        "content": "<p>interesting - I ran <code>cargo clean</code> and now <code>hello_swift</code> is failing, but <code>gen_tags</code> is still failing <span aria-label=\"laughing\" class=\"emoji emoji-1f606\" role=\"img\" title=\"laughing\">:laughing:</span></p>",
        "id": 260176334,
        "sender_full_name": "Richard Feldman",
        "timestamp": 1635963854
    },
    {
        "content": "<div class=\"codehilite\"><pre><span></span><code>$ cargo test --lib gen_tags\n\nrunning 54 tests\ntest gen_tags::applied_tag_just_enum ... ok\ntest gen_tags::alignment_in_multi_tag_construction_two ... ok\ntest gen_tags::applied_tag_just_ir ... ok\ntest gen_tags::applied_tag_just ... ok\nerror: test failed, to rerun pass &#39;-p test_gen --lib&#39;\n\nCaused by:\n  process didn&#39;t exit successfully: `/Users/rtfeldman/code/roc/target/debug/deps/test_gen-ef19d83dce25afb6 gen_tags` (signal: 11, SIGSEGV: invalid memory reference)\n</code></pre></div>",
        "id": 260176416,
        "sender_full_name": "Richard Feldman",
        "timestamp": 1635963895
    },
    {
        "content": "<p>can you run<code>lldb /Users/rtfeldman/code/roc/target/debug/deps/test_gen-ef19d83dce25afb6 -- gen_tags</code></p>",
        "id": 260176492,
        "sender_full_name": "Folkert de Vries",
        "timestamp": 1635963933
    },
    {
        "content": "<p>that opens up a repl thing, then run <code>run</code> and then <code>bt</code> and that should show you which test case is responsible</p>",
        "id": 260176538,
        "sender_full_name": "Folkert de Vries",
        "timestamp": 1635963955
    },
    {
        "content": "<div class=\"codehilite\"><pre><span></span><code>running 54 tests\ntest gen_tags::applied_tag_just ... ok\ntest gen_tags::applied_tag_just_ir ... ok\ntest_gen-ef19d83dce25afb6(28983,0x700007235000) malloc: *** error for object 0x113057d00: pointer being freed was not allocated\ntest_gen-ef19d83dce25afb6(28983,0x700007235000) malloc: *** set a breakpoint in malloc_error_break to debug\nProcess 28983 stopped\n* thread #9, name = &#39;gen_tags::applied_tag_function_result&#39;, stop reason = signal SIGABRT\n    frame #0: 0x00007fff202e492e libsystem_kernel.dylib`__pthread_kill + 10\nlibsystem_kernel.dylib`__pthread_kill:\n-&gt;  0x7fff202e492e &lt;+10&gt;: jae    0x7fff202e4938            ; &lt;+20&gt;\n    0x7fff202e4930 &lt;+12&gt;: movq   %rax, %rdi\n    0x7fff202e4933 &lt;+15&gt;: jmp    0x7fff202dead9            ; cerror_nocancel\n    0x7fff202e4938 &lt;+20&gt;: retq\n</code></pre></div>",
        "id": 260176617,
        "sender_full_name": "Richard Feldman",
        "timestamp": 1635963980
    },
    {
        "content": "<p>yup valgrind shows some issues for that one too</p>",
        "id": 260176946,
        "sender_full_name": "Folkert de Vries",
        "timestamp": 1635964140
    },
    {
        "content": "<p>looks like that macos CI machine would be really valuable</p>",
        "id": 260176996,
        "sender_full_name": "Folkert de Vries",
        "timestamp": 1635964162
    },
    {
        "content": "<p>for sure <span aria-label=\"big smile\" class=\"emoji emoji-1f604\" role=\"img\" title=\"big smile\">:big_smile:</span></p>",
        "id": 260177200,
        "sender_full_name": "Richard Feldman",
        "timestamp": 1635964222
    },
    {
        "content": "<p>I can spend some more time on that after next week's conferences</p>",
        "id": 260177282,
        "sender_full_name": "Richard Feldman",
        "timestamp": 1635964271
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"281383\">@Richard Feldman</span> do you remember when this worked last? because I think we're hitting a more fundamental problem with our RC insertion here</p>",
        "id": 260197702,
        "sender_full_name": "Folkert de Vries",
        "timestamp": 1635973651
    },
    {
        "content": "<p>and I don't see why it would be recently introduced</p>",
        "id": 260197743,
        "sender_full_name": "Folkert de Vries",
        "timestamp": 1635973680
    },
    {
        "content": "<p>I'll git bisect it!</p>",
        "id": 260198046,
        "sender_full_name": "Richard Feldman",
        "timestamp": 1635973830
    },
    {
        "content": "<p>bisect says 5cb7dbd3cccf4b4af6b949a4e2d06485cbf49289 is the first bad commit</p>",
        "id": 260202334,
        "sender_full_name": "Richard Feldman",
        "timestamp": 1635976162
    },
    {
        "content": "<p>I love a good git bisect</p>",
        "id": 260203215,
        "sender_full_name": "Lucas Rosa",
        "timestamp": 1635976667
    },
    {
        "content": "<p>I’m gonna try to get a build today on my M1 Max, finally done configuring it</p>",
        "id": 260203273,
        "sender_full_name": "Lucas Rosa",
        "timestamp": 1635976690
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"281383\">Richard Feldman</span> <a href=\"#narrow/stream/231634-beginners/topic/.E2.9C.94.20building.20from.20source/near/260202334\">said</a>:</p>\n<blockquote>\n<p>bisect says 5cb7dbd3cccf4b4af6b949a4e2d06485cbf49289 is the first bad commit</p>\n</blockquote>\n<p>hmm well maybe it does not crash but it still gives valgrind errors before that commit</p>",
        "id": 260203824,
        "sender_full_name": "Folkert de Vries",
        "timestamp": 1635976990
    },
    {
        "content": "<p>does it still give valgrind errors even if you <code>cherry-pick</code> the fix from the branch? <span aria-label=\"thinking\" class=\"emoji emoji-1f914\" role=\"img\" title=\"thinking\">:thinking:</span></p>",
        "id": 260210693,
        "sender_full_name": "Richard Feldman",
        "timestamp": 1635981450
    },
    {
        "content": "<p>Roc still can't run on Arch Linux with official packages from <code>pacman</code>.</p>\n<p>How's how to reproduce it in Vagrant:<br>\n<a href=\"#narrow/stream/304641-ideas/topic/Faster.20builds.20and.20reproducible.20development.20environment/near/260232240\">https://roc.zulipchat.com/#narrow/stream/304641-ideas/topic/Faster.20builds.20and.20reproducible.20development.20environment/near/260232240</a></p>",
        "id": 260232284,
        "sender_full_name": "Locria Cyber",
        "timestamp": 1636005590
    },
    {
        "content": "<blockquote>\n<p>Roc still can't run on Arch Linux with official packages from <code>pacman</code>.</p>\n</blockquote>\n<p>What specifically is causing an issue for that? I have had roc running on arch before.</p>",
        "id": 260232631,
        "sender_full_name": "Brendan Hansknecht",
        "timestamp": 1636005853
    },
    {
        "content": "<p>Is it specifically an issue of needing software from the <code>aur</code> or something different like versioning issues?</p>",
        "id": 260232656,
        "sender_full_name": "Brendan Hansknecht",
        "timestamp": 1636005912
    },
    {
        "content": "<p>inkwell</p>",
        "id": 260232819,
        "sender_full_name": "Locria Cyber",
        "timestamp": 1636006138
    },
    {
        "content": "<p>What about it? Issues with llvm version/dev build to use with inkwell?</p>",
        "id": 260232899,
        "sender_full_name": "Brendan Hansknecht",
        "timestamp": 1636006208
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"281383\">Richard Feldman</span> <a href=\"#narrow/stream/231634-beginners/topic/.E2.9C.94.20building.20from.20source/near/260174255\">said</a>:</p>\n<blockquote>\n<p>hm, <code>gen_tags</code> fails for me on that branch on x64 macOS</p>\n<p><div class=\"codehilite\"><pre><span></span><code>test gen_tags::false_is_false ... ok\ntest gen_tags::applied_tag_just_enum ... ok\ntest gen_tags::alignment_in_multi_tag_construction_two ... ok\ntest_gen-ef19d83dce25afb6(25024,0x700007630000) malloc: *** error for object 0x7fee1a1705d0: pointer being freed was not allocated\ntest_gen-ef19d83dce25afb6(25024,0x700007630000) malloc: *** set a breakpoint in malloc_error_break to debug\n</code></pre></div><br>\n</p>\n</blockquote>\n<p>It's now failing for me as well. So yeah, still an issue.</p>",
        "id": 260241064,
        "sender_full_name": "Kevin Hovsäter",
        "timestamp": 1636014886
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"357305\">Lucas Rosa</span> <a href=\"#narrow/stream/231634-beginners/topic/.E2.9C.94.20building.20from.20source/near/260203273\">said</a>:</p>\n<blockquote>\n<p>I’m gonna try to get a build today on my M1 Max, finally done configuring it</p>\n</blockquote>\n<p><span class=\"user-mention\" data-user-id=\"357305\">@Lucas Rosa</span>  I almost have a build with nix working on my M1 mac mini.</p>",
        "id": 260243381,
        "sender_full_name": "Anton",
        "timestamp": 1636016388
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"281383\">Richard Feldman</span> <a href=\"#narrow/stream/231634-beginners/topic/.E2.9C.94.20building.20from.20source/near/260210693\">said</a>:</p>\n<blockquote>\n<p>does it still give valgrind errors even if you <code>cherry-pick</code> the fix from the branch? <span aria-label=\"thinking\" class=\"emoji emoji-1f914\" role=\"img\" title=\"thinking\">:thinking:</span></p>\n</blockquote>\n<p>yes, it makes sense that this is a problem</p>\n<p>What we do is we infer a borrow signature first for <code>List.map</code> (or any lowlevel that takes a function argument), and only later for the function that we pass in practice. That means in this case that <code>List.map</code> thinks that the passed function borrows the element, while in practice it owns it.</p>",
        "id": 260248492,
        "sender_full_name": "Folkert de Vries",
        "timestamp": 1636019797
    },
    {
        "content": "<p>and therefore it's freed twice</p>",
        "id": 260248530,
        "sender_full_name": "Folkert de Vries",
        "timestamp": 1636019834
    },
    {
        "content": "<p>ahh gotcha</p>",
        "id": 260255489,
        "sender_full_name": "Richard Feldman",
        "timestamp": 1636024251
    },
    {
        "content": "<p>I guess I don't need to look into it then?</p>",
        "id": 260256332,
        "sender_full_name": "Kevin Hovsäter",
        "timestamp": 1636024915
    },
    {
        "content": "<p>ok here we go, finally running the tests on the M1 Max</p>",
        "id": 260268388,
        "sender_full_name": "Lucas Rosa",
        "timestamp": 1636032231
    },
    {
        "content": "<p>some failing tests, probably my fault, gonna try the repl now</p>",
        "id": 260268661,
        "sender_full_name": "Lucas Rosa",
        "timestamp": 1636032374
    },
    {
        "content": "<p>repl works fine :p</p>",
        "id": 260268714,
        "sender_full_name": "Lucas Rosa",
        "timestamp": 1636032398
    },
    {
        "content": "<p>ok this is good enough for me to start getting some work done, I'll sort out why I have failing tests later</p>",
        "id": 260268926,
        "sender_full_name": "Lucas Rosa",
        "timestamp": 1636032504
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"361169\">Anton</span> <a href=\"#narrow/stream/231634-beginners/topic/.E2.9C.94.20building.20from.20source/near/260243381\">said</a>:</p>\n<blockquote>\n<p><span class=\"user-mention silent\" data-user-id=\"357305\">Lucas Rosa</span> <a href=\"#narrow/stream/231634-beginners/topic/.E2.9C.94.20building.20from.20source/near/260203273\">said</a>:</p>\n<blockquote>\n<p>I’m gonna try to get a build today on my M1 Max, finally done configuring it</p>\n</blockquote>\n<p><span class=\"user-mention silent\" data-user-id=\"357305\">Lucas Rosa</span>  I almost have a build with nix working on my M1 mac mini.</p>\n</blockquote>\n<p>oh super nice, I'll give it a try as well :)</p>",
        "id": 260269033,
        "sender_full_name": "Lucas Rosa",
        "timestamp": 1636032551
    },
    {
        "content": "<p>but yo, this builds super fast lol, it's almost scary <span aria-label=\"laughter tears\" class=\"emoji emoji-1f602\" role=\"img\" title=\"laughter tears\">:laughter_tears:</span></p>",
        "id": 260269467,
        "sender_full_name": "Lucas Rosa",
        "timestamp": 1636032741
    },
    {
        "content": "<div class=\"codehilite\"><pre><span></span><code>rm -rf target\n\ntime cargo test -p test_gen gen_dict\n\n223.99s user 18.11s system 549% cpu 44.097 total\n</code></pre></div>",
        "id": 260269908,
        "sender_full_name": "Lucas Rosa",
        "timestamp": 1636032957
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"281543\">@Folkert de Vries</span> good numbers or na? ^</p>",
        "id": 260269990,
        "sender_full_name": "Lucas Rosa",
        "timestamp": 1636032978
    },
    {
        "content": "<p>which time is the relevant here? I always forget</p>",
        "id": 260270109,
        "sender_full_name": "Folkert de Vries",
        "timestamp": 1636033052
    },
    {
        "content": "<p>if it's the 18 seconds then that's very good</p>",
        "id": 260270142,
        "sender_full_name": "Folkert de Vries",
        "timestamp": 1636033068
    },
    {
        "content": "<p>system I think</p>",
        "id": 260270149,
        "sender_full_name": "Lucas Rosa",
        "timestamp": 1636033072
    },
    {
        "content": "<p>I forget too lol</p>",
        "id": 260270162,
        "sender_full_name": "Lucas Rosa",
        "timestamp": 1636033081
    },
    {
        "content": "<p>although 223s is still pretty fast considering it had to compile most of the crates before running the tests</p>",
        "id": 260270275,
        "sender_full_name": "Lucas Rosa",
        "timestamp": 1636033130
    },
    {
        "content": "<p>true</p>",
        "id": 260270608,
        "sender_full_name": "Folkert de Vries",
        "timestamp": 1636033290
    },
    {
        "content": "<p>Is there a guide somewhere about how to enable M1 support? Mabye a specific branch?</p>",
        "id": 260270993,
        "sender_full_name": "Oleksii Skidan",
        "timestamp": 1636033500
    },
    {
        "content": "<p>I didn't really do much outside of <code>brew install llvm@12</code>, but I've only ran a few tests and the repl which is usually enough for me to get some work done. What command did you run or what code did you try that is giving you trouble?</p>",
        "id": 260271247,
        "sender_full_name": "Lucas Rosa",
        "timestamp": 1636033633
    },
    {
        "content": "<p>I finally nailed it. Roc builds and runs on my MacBook Pro just fine. <span aria-label=\"tada\" class=\"emoji emoji-1f389\" role=\"img\" title=\"tada\">:tada:</span><br>\nAccording to CONTRIBUTING.md I have to talk to an existing contributor about the pull request that I want to make. Who shall I talk to?</p>",
        "id": 260331933,
        "sender_full_name": "Oleksii Skidan",
        "timestamp": 1636058700
    },
    {
        "content": "<p>A bit of a problem as well for me, my Mac is running low on disk space (30GB left out of 256GB). There's nothing I can do to clean up some space. That guide is telling me to run tests in Earthly prior to making a PR. Unfortunately, I won't be able to run them now. :( Not until I have access to my home PC where I can run Linux. The fun part is that Earthly won't exercise any of the macOS-specific stuff  then as far as I can tell, will it?</p>",
        "id": 260332398,
        "sender_full_name": "Oleksii Skidan",
        "timestamp": 1636058899
    },
    {
        "content": "<p>I've never installed Earthly or used it and I think that's fine</p>",
        "id": 260332525,
        "sender_full_name": "Shritesh Bhattarai",
        "timestamp": 1636058969
    },
    {
        "content": "<p>I wouldn't worry about earthly. It is what CI runs and is nice if you really want to make sure a pr is good, but doesn't matter a ton for local testing.</p>",
        "id": 260333279,
        "sender_full_name": "Brendan Hansknecht",
        "timestamp": 1636059321
    },
    {
        "content": "<p>Go ahead and just make a branch and then create a PR.</p>",
        "id": 260333300,
        "sender_full_name": "Brendan Hansknecht",
        "timestamp": 1636059335
    },
    {
        "content": "<p>The main thing about talking to existing contributors is probably for if you are going to make larger changes. Don't want to waste effort when multiple people work on the same thing or someone adds features in a way that fundamentally Roc doesn't want. But for bug fixes and getting the programming working on a new system, just opening a PR should be great.</p>",
        "id": 260333573,
        "sender_full_name": "Brendan Hansknecht",
        "timestamp": 1636059467
    },
    {
        "content": "<p>OK, what's the procedure then? Shall I push a new branch with the fix, if so is there any specific format for how to name it?</p>",
        "id": 260334652,
        "sender_full_name": "Oleksii Skidan",
        "timestamp": 1636059956
    },
    {
        "content": "<p>yes make a branch. There is no naming format, pick something descriptive and you should be good</p>",
        "id": 260334856,
        "sender_full_name": "Folkert de Vries",
        "timestamp": 1636060055
    },
    {
        "content": "<p>Who to add into reviewers of this PR? <a href=\"https://github.com/rtfeldman/roc/pull/1890\">https://github.com/rtfeldman/roc/pull/1890</a></p>",
        "id": 260337017,
        "sender_full_name": "Oleksii Skidan",
        "timestamp": 1636061116
    },
    {
        "content": "<p>Trying Roc for the first time (for advent of code; not sure I should post there instead), but getting this while trying <code>cargo build</code>:</p>\n<div class=\"codehilite\"><pre><span></span><code>  thread &#39;main&#39; panicked at &#39;zig failed: error: AccessDenied\n  &#39;, compiler/builtins/build.rs:150:17\n</code></pre></div>\n<p>Does that look familiar to anyone? Fresh install of zig 0.8.0.</p>",
        "id": 263357543,
        "sender_full_name": "Johannes Hoff",
        "timestamp": 1638392649
    },
    {
        "content": "<p>interesting</p>",
        "id": 263357695,
        "sender_full_name": "Lucas Rosa",
        "timestamp": 1638392758
    },
    {
        "content": "<p>how did you install zig?</p>",
        "id": 263357711,
        "sender_full_name": "Lucas Rosa",
        "timestamp": 1638392763
    },
    {
        "content": "<p>Downloaded the 0.8.0 binary from here: <a href=\"https://ziglang.org/download/\">https://ziglang.org/download/</a></p>",
        "id": 263357781,
        "sender_full_name": "Johannes Hoff",
        "timestamp": 1638392796
    },
    {
        "content": "<p>I managed to build and run hello world in zig, so at least the installation isn't completely broken</p>",
        "id": 263357788,
        "sender_full_name": "Johannes Hoff",
        "timestamp": 1638392805
    },
    {
        "content": "<p>what os are you on?</p>",
        "id": 263358379,
        "sender_full_name": "Brendan Hansknecht",
        "timestamp": 1638393137
    },
    {
        "content": "<p>I think that happens when you run the compiler in the wrong directory</p>",
        "id": 263358427,
        "sender_full_name": "Folkert de Vries",
        "timestamp": 1638393173
    },
    {
        "content": "<p>and then some path does not work</p>",
        "id": 263358445,
        "sender_full_name": "Folkert de Vries",
        "timestamp": 1638393187
    },
    {
        "content": "<p>all commands should be executed from the top directory</p>",
        "id": 263358501,
        "sender_full_name": "Folkert de Vries",
        "timestamp": 1638393225
    },
    {
        "content": "<p>I'm on MacOS/aarch64. I'm running cargo build from the project root (i.e. the folder with <code>.git</code>)</p>",
        "id": 263359009,
        "sender_full_name": "Johannes Hoff",
        "timestamp": 1638393493
    },
    {
        "content": "<p>using nix or direct install of everything?</p>",
        "id": 263359056,
        "sender_full_name": "Brendan Hansknecht",
        "timestamp": 1638393531
    },
    {
        "content": "<p>Direct installed everything. Rust, zig, llvm</p>",
        "id": 263359268,
        "sender_full_name": "Johannes Hoff",
        "timestamp": 1638393645
    },
    {
        "content": "<p>Maybe I should give nix a try</p>",
        "id": 263359278,
        "sender_full_name": "Johannes Hoff",
        "timestamp": 1638393653
    },
    {
        "content": "<p>maybe just chmod that whole builtins directory?</p>",
        "id": 263359301,
        "sender_full_name": "Folkert de Vries",
        "timestamp": 1638393667
    },
    {
        "content": "<p>it does seem vaguely familiar, but I don't remember any details</p>",
        "id": 263359317,
        "sender_full_name": "Folkert de Vries",
        "timestamp": 1638393682
    },
    {
        "content": "<p>Otherwise, it is possible an issue with cache dir resolution for some reason, like is mentioned here: <a href=\"https://github.com/ziglang/zig/issues/6810\">https://github.com/ziglang/zig/issues/6810</a><br>\nThough, not nix specific as in the linked issue</p>",
        "id": 263359429,
        "sender_full_name": "Brendan Hansknecht",
        "timestamp": 1638393730
    },
    {
        "content": "<p>Oh, I see what the problem is. I totally created this problem myself. Had copied something from another user and had to <code>chown</code> it. Sorry for the trouble; should have caught it myself</p>",
        "id": 263359810,
        "sender_full_name": "Johannes Hoff",
        "timestamp": 1638393959
    },
    {
        "content": "<p>makes sense, all good :)</p>",
        "id": 263359878,
        "sender_full_name": "Lucas Rosa",
        "timestamp": 1638393980
    },
    {
        "content": "<p>Anyone know what to do about this? </p>\n<div class=\"codehilite\"><pre><span></span><code>error: failed to run custom build command for `roc_builtins v0.1.0 (C:\\Users\\taylo\\Documents\\Projects\\roc\\compiler\\builtins)`\n\nCaused by:\n  process didn&#39;t exit successfully: `C:\\Users\\path\\to\\roc\\target\\debug\\build\\roc_builtins-f32964a2162d4b2f\\build-script-build` (exit code: 101)\n  --- stdout\n  cargo:rerun-if-changed=build.rs\n  Compiling host ir to: \\\\?\\C:\\Users\\path\\to\\roc\\compiler\\builtins\\bitcode\\builtins-host.ll\n\n  --- stderr\n  thread &#39;main&#39; panicked at &#39;zig failed:\n  Unhandled Exception: System.ArgumentException: Illegal characters in path.\n     at System.Security.Permissions.FileIOPermission.EmulateFileIOPermissionChecks(String fullPath)\n     at System.IO.Directory.InternalGetCurrentDirectory(Boolean checkHost)\n     at shim.ShimProgram.Main(String[] args)\n  &#39;, compiler\\builtins\\build.rs:150:17\n  note: run with `RUST_BACKTRACE=1` environment variable to display a backtrace\n</code></pre></div>",
        "id": 264514978,
        "sender_full_name": "Taylor Allred",
        "timestamp": 1639173843
    },
    {
        "content": "<p>Hi <span class=\"user-mention\" data-user-id=\"458687\">@Taylor Allred</span>,<br>\nI notice the <code>C:\\</code> in your path, are you using windows or perhaps the Windows Subsystem for Linux?</p>",
        "id": 264551988,
        "sender_full_name": "Anton",
        "timestamp": 1639214431
    },
    {
        "content": "<p>Hi all! Is there a way to specify the install path of Zig?<br>\nI mainly develop using Zig so the one installed in my $PATH is the master version.<br>\nSo in short, I'd like to overwrite what's in my $PATH and specify the installation directory of zig 0.8.0 when building the Roc compiler from source.</p>",
        "id": 264617300,
        "sender_full_name": "Luuk de Gram",
        "timestamp": 1639307449
    },
    {
        "content": "<p>Hi Luuk,<br>\nI've made issue #2189 to provide a nice solution for this, until that is done you can either:</p>\n<ul>\n<li>build the compiler from source <a href=\"https://github.com/rtfeldman/roc/blob/trunk/BUILDING_FROM_SOURCE.md#using-nix\">using nix</a></li>\n<li>Or replace every mention in the source code of <code>Command::new(\"zig\")</code> with say <code>Command::new(\"zig8\")</code>. This replacement may not cover all cases. You could temporarily rename your <code>zig</code> command to <code>notzig</code> and see where errors occur and then replace the use of zig there with zig8.</li>\n</ul>",
        "id": 264618757,
        "sender_full_name": "Anton",
        "timestamp": 1639309544
    },
    {
        "content": "<p>Thanks Anton!<br>\nAs all I have to do is test some changes, I'll just use option 2 for now :)<br>\n(Also thank you for making the issue).</p>",
        "id": 264619129,
        "sender_full_name": "Luuk de Gram",
        "timestamp": 1639310106
    },
    {
        "content": "<p>Hi LuuK :)</p>",
        "id": 264638345,
        "sender_full_name": "Lucas Rosa",
        "timestamp": 1639335745
    },
    {
        "content": "<p>Hi! I'm trying to build roc rn for the first time.<br>\nI just installed zig, and when I'm running cargo build I get the following error:</p>\n<div class=\"codehilite\"><pre><span></span><code>error: failed to run custom build command for `roc_builtins v0.1.0 (G:\\Projects\\roc\\compiler\\builtins)`\n\nCaused by:\n  process didn&#39;t exit successfully: `G:\\Projects\\roc\\target\\debug\\build\\roc_builtins-4fc5c156ddb0b51a\\build-script-build` (exit code: 101)\n  --- stdout\n  cargo:rerun-if-changed=build.rs\n  Compiling host ir to: \\\\?\\G:\\Projects\\roc\\compiler\\builtins\\bitcode\\builtins-host.ll\n\n  --- stderr\n  thread &#39;main&#39; panicked at &#39;zig failed:\n  Unhandled Exception: System.ArgumentException: Illegal characters in path.\n     at System.Security.Permissions.FileIOPermission.EmulateFileIOPermissionChecks(String fullPath)\n     at System.IO.Directory.InternalGetCurrentDirectory(Boolean checkHost)\n     at shim.ShimProgram.Main(String[] args)\n  &#39;, compiler\\builtins\\build.rs:157:17\n  note: run with `RUST_BACKTRACE=1` environment variable to display a backtrace\n</code></pre></div>\n<p>I am on windows.<br>\nMy windows user does have hebrew characters, but I don't know what it could be trying to access under user.<br>\nMaybe somebody knows what's up?</p>",
        "id": 271746409,
        "sender_full_name": "Yonatan Reicher",
        "timestamp": 1644759288
    },
    {
        "content": "<p>What version of Zig did you install? I believe Roc requires Zig <del>v0.8.0</del> v0.8.1<br>\nI'm on macOS using Nix, so all I know about Roc+Windows is <a href=\"https://github.com/rtfeldman/roc/blob/trunk/getting_started/windows.md\">this warning</a></p>",
        "id": 271746895,
        "sender_full_name": "jan kili",
        "timestamp": 1644759931
    },
    {
        "content": "<p>I'm not the right one to help you with this, but for more info on Roc's dependencies you could skim <a href=\"https://github.com/rtfeldman/roc/blob/trunk/shell.nix\">this</a> and <a href=\"https://github.com/rtfeldman/roc/tree/trunk/nix\">these</a></p>",
        "id": 271747052,
        "sender_full_name": "jan kili",
        "timestamp": 1644760167
    },
    {
        "content": "<p>Thank you for responding, I downloaded zig 0.9, should I get 0.8.1?<br>\nI think I saw in another thread that you can build on windows but linking wont work</p>",
        "id": 271747194,
        "sender_full_name": "Yonatan Reicher",
        "timestamp": 1644760381
    },
    {
        "content": "<p>Yes, sorry, that's part of what I meant - Zig v0.9.0 support is coming soon</p>",
        "id": 271747433,
        "sender_full_name": "jan kili",
        "timestamp": 1644760723
    },
    {
        "content": "<p>Ok, thx!</p>",
        "id": 271747590,
        "sender_full_name": "Yonatan Reicher",
        "timestamp": 1644760898
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"361169\">Anton</span> <a href=\"#narrow/stream/231634-beginners/topic/.E2.9C.94.20building.20from.20source/near/264551988\">said</a>:</p>\n<blockquote>\n<p>Hi <span class=\"user-mention silent\" data-user-id=\"458687\">Taylor Allred</span>,<br>\nI notice the <code>C:\\</code> in your path, are you using windows or perhaps the Windows Subsystem for Linux?</p>\n</blockquote>\n<p>Hi <span class=\"user-mention\" data-user-id=\"361169\">@Anton</span>. Sorry for not responding way back when. I believe I was running on windows not in WSL. I'll try this again in both and see how it goes.</p>",
        "id": 275029431,
        "sender_full_name": "Taylor Allred",
        "timestamp": 1647030404
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"361169\">Anton</span> has marked this topic as unresolved.</p>",
        "id": 275084126,
        "sender_full_name": "Notification Bot",
        "timestamp": 1647072464
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"458687\">@Taylor Allred</span> we did get building on windows working but running roc programs will not work because linking on windows still has to be implemented. Using WSL should work though.</p>",
        "id": 275084187,
        "sender_full_name": "Anton",
        "timestamp": 1647072558
    },
    {
        "content": "<p>Hi! I'm trying to build from source on an <code>aarch64</code> Debian GNU/Linux system, using the latest in the trunk.  I get the following error during the cargo build</p>\n<div class=\"codehilite\" data-code-language=\"Bash\"><pre><span></span><code>$ cargo build\n   Compiling roc_linker v0.1.0 <span class=\"o\">(</span>/path-to/roc/linker<span class=\"o\">)</span>\nerror<span class=\"o\">[</span>E0308<span class=\"o\">]</span>: mismatched types\n   --&gt; linker/src/lib.rs:676:40\n    <span class=\"p\">|</span>\n<span class=\"m\">676</span> <span class=\"p\">|</span>             <span class=\"nb\">let</span> c_buf: *const <span class=\"nv\">c_char</span> <span class=\"o\">=</span> dynstr_data<span class=\"o\">[</span>dynstr_off..<span class=\"o\">]</span>.as_ptr<span class=\"o\">()</span> as *const i8<span class=\"p\">;</span>\n    <span class=\"p\">|</span>                        -------------   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ expected <span class=\"sb\">`</span>u8<span class=\"sb\">`</span>, found <span class=\"sb\">`</span>i8<span class=\"sb\">`</span>\n    <span class=\"p\">|</span>                        <span class=\"p\">|</span>\n    <span class=\"p\">|</span>                        expected due to this\n    <span class=\"p\">|</span>\n    <span class=\"o\">=</span> note: expected raw pointer <span class=\"sb\">`</span>*const u8<span class=\"sb\">`</span>\n               found raw pointer <span class=\"sb\">`</span>*const i8<span class=\"sb\">`</span>\n\nFor more information about this error, try <span class=\"sb\">`</span>rustc --explain E0308<span class=\"sb\">`</span>.\nerror: could not compile <span class=\"sb\">`</span>roc_linker<span class=\"sb\">`</span> due to previous error\n</code></pre></div>\n<p>I can get the build to succeed by changing from <code>i8</code> to <code>c_char</code>, as hinted by the error, but I'm not sure the implications of that... Has anybody encountered this before? I'm brand new to all of this but trying to learn <span aria-label=\"smile\" class=\"emoji emoji-1f642\" role=\"img\" title=\"smile\">:smile:</span></p>",
        "id": 276700818,
        "sender_full_name": "Jake",
        "timestamp": 1648262422
    },
    {
        "content": "<p>even after getting past that error with that naive change, I cannot get many of the cli_run tests to pass. Lots of this error</p>\n<div class=\"codehilite\" data-code-language=\"Bash\"><pre><span></span><code>---- cli_run::cfold stdout ----\nthread <span class=\"s1\">'cli_run::cfold'</span> panicked at <span class=\"s1\">'roc build had stderr: thread '</span>&lt;unnamed&gt;<span class=\"s1\">' panicked at '</span>Failed to rebuild host.zig - stderr of the <span class=\"sb\">`</span>zig<span class=\"sb\">`</span> <span class=\"nb\">command</span> was:\nerror: UnknownOperatingSystem\n<span class=\"s1\">', compiler/build/src/link.rs:1111:27</span>\n<span class=\"s1\">note: run with `RUST_BACKTRACE=1` environment variable to display a backtrace</span>\n<span class=\"s1\">thread '</span>main<span class=\"s1\">' panicked at '</span>called <span class=\"sb\">`</span>Result::unwrap<span class=\"o\">()</span><span class=\"sb\">`</span> on an <span class=\"sb\">`</span>Err<span class=\"sb\">`</span> value: Any <span class=\"o\">{</span> .. <span class=\"o\">}</span><span class=\"s1\">', cli/src/build.rs:233:50</span>\n<span class=\"s1\">'</span>, cli/tests/cli_run.rs:87:13\nnote: run with <span class=\"sb\">`</span><span class=\"nv\">RUST_BACKTRACE</span><span class=\"o\">=</span><span class=\"m\">1</span><span class=\"sb\">`</span> environment variable to display a backtrace\n</code></pre></div>\n<p>Any thoughts on how to proceed from here?</p>",
        "id": 276700974,
        "sender_full_name": "Jake",
        "timestamp": 1648262734
    },
    {
        "content": "<p>Regarding the first error, what version of rustc are you using?</p>",
        "id": 276701025,
        "sender_full_name": "Ayaz Hafiz",
        "timestamp": 1648262791
    },
    {
        "content": "<p>The first change looks to be a bug on our part. No matter the rust version, we should be converting that to a <code>c_char</code> instead of the exact numeric type. That should be a safe change.</p>",
        "id": 276701120,
        "sender_full_name": "Brendan Hansknecht",
        "timestamp": 1648262986
    },
    {
        "content": "<p>Regarding the second, are you able to run “zig build” in examples/hello-world/zig-platform? the error message indicates it may be a zig problem</p>",
        "id": 276701126,
        "sender_full_name": "Ayaz Hafiz",
        "timestamp": 1648262998
    },
    {
        "content": "<p>yeah, the first one is our bug - it looks like c_char is target-dependent <a href=\"https://doc.rust-lang.org/src/std/os/raw/mod.rs.html#92-135\">https://doc.rust-lang.org/src/std/os/raw/mod.rs.html#92-135</a></p>",
        "id": 276701194,
        "sender_full_name": "Ayaz Hafiz",
        "timestamp": 1648263109
    },
    {
        "content": "<p>Yes, I guess my system treats c_char as a u8 instead of an i8</p>",
        "id": 276701240,
        "sender_full_name": "Jake",
        "timestamp": 1648263146
    },
    {
        "content": "<p>I'm happy to open a PR for the first issue once I can get all my test failures fixed.</p>\n<p><span class=\"user-mention\" data-user-id=\"454654\">@Ayaz Hafiz</span> I was able to get a successful <code>zig build</code> in that directory you mentioned. I had to <code>zig init-exe</code> first though? Sorry, I'm brand new to Rust, Zig, Roc, the works <span aria-label=\"smile\" class=\"emoji emoji-1f642\" role=\"img\" title=\"smile\">:smile:</span> . I appreciate the help!</p>",
        "id": 276701335,
        "sender_full_name": "Jake",
        "timestamp": 1648263357
    },
    {
        "content": "<p>ah, this gives me the same zig <code>UnknownOperatingSystem</code> error as above</p>\n<div class=\"codehilite\" data-code-language=\"Bash\"><pre><span></span><code>$ cargo run examples/hello-world/zig-platform/helloZig.roc\n</code></pre></div>\n<p>I'll take another look through the docs to make sure I didn't miss something in all the installation steps</p>",
        "id": 276701704,
        "sender_full_name": "Jake",
        "timestamp": 1648263927
    },
    {
        "content": "<p>sorry, i have to hop off to work but i will try to take a deeper look tomorrow morning if you or another helpful friend are unable to resolve this by then!</p>",
        "id": 276701846,
        "sender_full_name": "Ayaz Hafiz",
        "timestamp": 1648264118
    },
    {
        "content": "<p>no worries! I appreciate the help so far and will try to do my best to figure it out in the meantime</p>",
        "id": 276701866,
        "sender_full_name": "Jake",
        "timestamp": 1648264190
    },
    {
        "content": "<p>So <code>zig biuld</code> was actually the wrong command here. We manually build the host with a more complex form of <code>zig build-obj</code> with a solid number of flags</p>",
        "id": 276702309,
        "sender_full_name": "Brendan Hansknecht",
        "timestamp": 1648264954
    },
    {
        "content": "<p>To start simpler and check if the compiler is working in general, can you try:<br>\n<code>cargo run examples/hello-world/rust-platform/helloRust.roc</code></p>",
        "id": 276702327,
        "sender_full_name": "Brendan Hansknecht",
        "timestamp": 1648265030
    },
    {
        "content": "<p>Since we know rust is installed and running happily.</p>",
        "id": 276702369,
        "sender_full_name": "Brendan Hansknecht",
        "timestamp": 1648265046
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"343810\">Brendan Hansknecht</span> <a href=\"#narrow/stream/231634-beginners/topic/building.20from.20source/near/276702327\">said</a>:</p>\n<blockquote>\n<p>To start simpler and check if the compiler is working in general, can you try:<br>\n<code>cargo run examples/hello-world/rust-platform/helloRust.roc</code></p>\n</blockquote>\n<p>Yes, this works fine! I was testing that and several other examples that are using Rust platforms and they seem fine.</p>",
        "id": 276702533,
        "sender_full_name": "Jake",
        "timestamp": 1648265357
    },
    {
        "content": "<p>Good to know. So definitely a zig related issue. Can you try and run a zig hello world program on your computer, unrelated to roc.</p>",
        "id": 276702633,
        "sender_full_name": "Brendan Hansknecht",
        "timestamp": 1648265471
    },
    {
        "content": "<p>Should just be:</p>\n<div class=\"codehilite\"><pre><span></span><code>mkdir hello-world\ncd hello-world\nzig init-exe\nzig build run\n</code></pre></div>",
        "id": 276702692,
        "sender_full_name": "Brendan Hansknecht",
        "timestamp": 1648265535
    },
    {
        "content": "<p>yep that works, as does a more typical hello-world like the one quoted here <a href=\"https://ziglearn.org/#hello-world\">https://ziglearn.org/#hello-world</a></p>",
        "id": 276702767,
        "sender_full_name": "Jake",
        "timestamp": 1648265646
    },
    {
        "content": "<p>just to double check, what does <code>zig version</code> print?</p>",
        "id": 276703368,
        "sender_full_name": "Richard Feldman",
        "timestamp": 1648266760
    },
    {
        "content": "<p>0.8.1</p>",
        "id": 276703514,
        "sender_full_name": "Jake",
        "timestamp": 1648267025
    },
    {
        "content": "<p>Can you change <code>compiler/build/link.rs:131</code> from <code>        target,</code> to <code>        dbg!(target),</code>?</p>",
        "id": 276703593,
        "sender_full_name": "Brendan Hansknecht",
        "timestamp": 1648267153
    },
    {
        "content": "<p>I want to see what OS we are telling zig to compiler for.</p>",
        "id": 276703596,
        "sender_full_name": "Brendan Hansknecht",
        "timestamp": 1648267175
    },
    {
        "content": "<p>Since that is apparently the issue</p>",
        "id": 276703601,
        "sender_full_name": "Brendan Hansknecht",
        "timestamp": 1648267184
    },
    {
        "content": "<p>Side note, good change that commenting out that line and the line above it will fix the issue.</p>",
        "id": 276703770,
        "sender_full_name": "Brendan Hansknecht",
        "timestamp": 1648267365
    },
    {
        "content": "<div class=\"codehilite\" data-code-language=\"Bash\"><pre><span></span><code><span class=\"o\">[</span>compiler/build/src/link.rs:131<span class=\"o\">]</span> <span class=\"nv\">target</span> <span class=\"o\">=</span> <span class=\"s2\">\"aarch64-unknown-linux-gnu\"</span>\n</code></pre></div>",
        "id": 276703982,
        "sender_full_name": "Jake",
        "timestamp": 1648267615
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"343810\">Brendan Hansknecht</span> <a href=\"#narrow/stream/231634-beginners/topic/building.20from.20source/near/276703770\">said</a>:</p>\n<blockquote>\n<p>Side note, good change that commenting out that line and the line above it will fix the issue.</p>\n</blockquote>\n<p>yes, commenting out those two lines did allow me to successfully run the helloZig.roc file!</p>",
        "id": 276704056,
        "sender_full_name": "Jake",
        "timestamp": 1648267787
    },
    {
        "content": "<p>How is <code>linux-gnu</code> an unknown operating system.</p>",
        "id": 276704241,
        "sender_full_name": "Brendan Hansknecht",
        "timestamp": 1648268099
    },
    {
        "content": "<p>...zig bug?</p>",
        "id": 276704245,
        "sender_full_name": "Brendan Hansknecht",
        "timestamp": 1648268110
    },
    {
        "content": "<p>based on the pattern I see hardcoded elsewhere in the file, it seems that the <code>-unknown-</code> piece maybe shouldn't be present?<br>\nFor example, we don't have that piece here <a href=\"https://github.com/rtfeldman/roc/blob/trunk/compiler/build/src/link.rs#L445\">https://github.com/rtfeldman/roc/blob/trunk/compiler/build/src/link.rs#L445</a></p>",
        "id": 276704931,
        "sender_full_name": "Jake",
        "timestamp": 1648269202
    },
    {
        "content": "<p>I think this might be what we're aiming to match? <a href=\"https://github.com/ziglang/zig/blob/88e98a0611b9fb41c1da026febac2467548bb129/tools/process_headers.zig#L63\">https://github.com/ziglang/zig/blob/88e98a0611b9fb41c1da026febac2467548bb129/tools/process_headers.zig#L63</a><br>\nso it should just be <code>aarch64-linux-gnu</code> in my case</p>\n<p>I will test that hardcoded to see if it solves my issue</p>",
        "id": 276705056,
        "sender_full_name": "Jake",
        "timestamp": 1648269414
    },
    {
        "content": "<p>yes, confirmed that hardcoding <code>aarch64-linux-gnu</code> as the target lets me run the zig platform example locally. Seems like there's some synchronization that needs to be done with the <a href=\"https://github.com/rtfeldman/roc/blob/d91df421476a5f599efafefcfe1cf8e0aa87a8fa/compiler/build/src/target.rs#L10\"><code>target_triple_str</code> function</a> and how it relates to the zig <code>-target</code> mappings</p>",
        "id": 276705630,
        "sender_full_name": "Jake",
        "timestamp": 1648270382
    },
    {
        "content": "<p>The unknown should be part of the triple. It is the vendor. So on Macos it is apple.</p>",
        "id": 276705704,
        "sender_full_name": "Brendan Hansknecht",
        "timestamp": 1648270499
    },
    {
        "content": "<p>On most things it is unknown.</p>",
        "id": 276705709,
        "sender_full_name": "Brendan Hansknecht",
        "timestamp": 1648270505
    },
    {
        "content": "<p>Maybe zig just removed it cause it generally isn't useful even if it is part of the triple</p>",
        "id": 276705729,
        "sender_full_name": "Brendan Hansknecht",
        "timestamp": 1648270558
    },
    {
        "content": "<p>these seem like relevant zig issues</p>\n<ul>\n<li><a href=\"https://github.com/ziglang/zig/issues/7360\">https://github.com/ziglang/zig/issues/7360</a></li>\n<li><a href=\"https://github.com/ziglang/zig/issues/4911\">https://github.com/ziglang/zig/issues/4911</a></li>\n</ul>",
        "id": 276706305,
        "sender_full_name": "Jake",
        "timestamp": 1648271193
    },
    {
        "content": "<p>the zig wiki also mentions some about how these targets are updated in that repo</p>\n<ul>\n<li><a href=\"https://github.com/ziglang/zig/wiki/Updating-libc\">https://github.com/ziglang/zig/wiki/Updating-libc</a></li>\n</ul>",
        "id": 276706465,
        "sender_full_name": "Jake",
        "timestamp": 1648271442
    },
    {
        "content": "<p>Wow, so it actually is a zig issue...kinda</p>",
        "id": 276707239,
        "sender_full_name": "Brendan Hansknecht",
        "timestamp": 1648272768
    },
    {
        "content": "<p>Feel free to add a special exceptions. Probably add a comment with a link to the issue.</p>",
        "id": 276707324,
        "sender_full_name": "Brendan Hansknecht",
        "timestamp": 1648272898
    },
    {
        "content": "<p>Okay. I've gotta go for the night but am happy to work on this later this weekend</p>",
        "id": 276707388,
        "sender_full_name": "Jake",
        "timestamp": 1648272971
    },
    {
        "content": "<p>Thanks, all, for the assistance!</p>",
        "id": 276707391,
        "sender_full_name": "Jake",
        "timestamp": 1648272981
    },
    {
        "content": "<p>Yep. No rush</p>",
        "id": 276707393,
        "sender_full_name": "Brendan Hansknecht",
        "timestamp": 1648272988
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"361169\">@Anton</span> Hi, I ran into the same issue you did with nixGL. nixVulkanIntel cannot be installed from nix-channel. But when I clone the repo and try <code>nix-env -f ./ -iA nixgl.auto.nixVulkanIntel</code> I still get <code>error: attribute 'nixgl' in selection path 'nixgl.auto.nixVulkanIntel' not found</code>. What did you do? (or anybody else that got nixVulkanIntel to work)</p>",
        "id": 276722327,
        "sender_full_name": "Jurek Breuninger",
        "timestamp": 1648295853
    },
    {
        "content": "<p>What OS?</p>",
        "id": 276728817,
        "sender_full_name": "Brendan Hansknecht",
        "timestamp": 1648305023
    },
    {
        "content": "<p>If actual nix os, I know their is s nix flakes PR rn due to it running into some bugs. Not sure if it is the solution though.</p>",
        "id": 276729272,
        "sender_full_name": "Brendan Hansknecht",
        "timestamp": 1648305744
    },
    {
        "content": "<p><a href=\"https://github.com/rtfeldman/roc/pull/2732\">https://github.com/rtfeldman/roc/pull/2732</a></p>",
        "id": 276729287,
        "sender_full_name": "Brendan Hansknecht",
        "timestamp": 1648305803
    },
    {
        "content": "<p>Hi Jurek, I'll take a look on Monday.</p>",
        "id": 276738356,
        "sender_full_name": "Anton",
        "timestamp": 1648318253
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"343810\">Brendan Hansknecht</span> <a href=\"#narrow/stream/231634-beginners/topic/building.20from.20source/near/276728817\">said</a>:</p>\n<blockquote>\n<p>What OS?</p>\n</blockquote>\n<p>Arch Linux</p>",
        "id": 276740704,
        "sender_full_name": "Jurek Breuninger",
        "timestamp": 1648321568
    },
    {
        "content": "<p>I've opened a PR for my GNU/Linux + ARM build issues, though I still have a few tests which I have not been able to have succeed on my system (more details in the PR)<br>\n<a href=\"https://github.com/rtfeldman/roc/pull/2774\">https://github.com/rtfeldman/roc/pull/2774</a><br>\nI'm just feeling my way through all of this so happy to have suggestions</p>",
        "id": 276807840,
        "sender_full_name": "Jake",
        "timestamp": 1648415163
    },
    {
        "content": "<p>Oh, extra note, some tests may not pass without much more work. I know that on M1 we have some bugs. Might affect you too.</p>",
        "id": 276808493,
        "sender_full_name": "Brendan Hansknecht",
        "timestamp": 1648416039
    },
    {
        "content": "<p><code>gui</code> is very slow to build, so it may just need a bit longer (it can take, idk maybe up to 5/10 min the first time)</p>",
        "id": 276808912,
        "sender_full_name": "Folkert de Vries",
        "timestamp": 1648416541
    },
    {
        "content": "<p>for <code>astar</code> it would be interesting to see the valgrind output, that is <code>valgrind valgrind --leak-check=full --track-origins=yes ./test-astar</code> in the <code>examples/benchmarks</code> folder</p>",
        "id": 276808937,
        "sender_full_name": "Folkert de Vries",
        "timestamp": 1648416591
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"485476\">@Jurek Breuninger</span> I created an issue on the nixGL repo, resolving that should make it easy to fix things for your case.</p>",
        "id": 277005599,
        "sender_full_name": "Anton",
        "timestamp": 1648561117
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"281543\">Folkert de Vries</span> <a href=\"#narrow/stream/231634-beginners/topic/building.20from.20source/near/276808912\">said</a>:</p>\n<blockquote>\n<p><code>gui</code> is very slow to build, so it may just need a bit longer (it can take, idk maybe up to 5/10 min the first time)</p>\n</blockquote>\n<p>you were right, it just took a while to build. However, I still can't run it successfully. I'll share the output here in case it help, but I haven't spent any time digging into it yet:</p>\n<div class=\"codehilite\" data-code-language=\"Bash\"><pre><span></span><code>---- cli_run::gui stdout ----\nthread <span class=\"s1\">'cli_run::gui'</span> panicked at <span class=\"s1\">'roc build had stderr: ld: /home/jake/roc/examples/gui/platform/host.o:(.data..L_MergedGlobals+0x18): undefined reference to `__dso_handle'</span>\nld: /usr/lib/aarch64-linux-gnu/libc_nonshared.a<span class=\"o\">(</span>pthread_atfork.oS<span class=\"o\">)</span>: <span class=\"k\">in</span> <span class=\"k\">function</span> <span class=\"sb\">`</span>__pthread_atfork<span class=\"s1\">':</span>\n<span class=\"s1\">(.text+0x0): undefined reference to `__dso_handle'</span>\nld: <span class=\"o\">(</span>.text+0x4<span class=\"o\">)</span>: undefined reference to <span class=\"sb\">`</span>__dso_handle<span class=\"s1\">'</span>\n<span class=\"s1\">ld: /home/jake/roc/examples/gui/hello-gui: hidden symbol `__dso_handle'</span> isn<span class=\"s1\">'t defined</span>\n<span class=\"s1\">ld: final link failed: bad value</span>\n<span class=\"s1\">'</span>, cli/tests/cli_run.rs:87:13\n</code></pre></div>",
        "id": 277225084,
        "sender_full_name": "Jake",
        "timestamp": 1648692826
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"281543\">Folkert de Vries</span> <a href=\"#narrow/stream/231634-beginners/topic/building.20from.20source/near/276808937\">said</a>:</p>\n<blockquote>\n<p>for <code>astar</code> it would be interesting to see the valgrind output, that is <code>valgrind valgrind --leak-check=full --track-origins=yes ./test-astar</code> in the <code>examples/benchmarks</code> folder</p>\n</blockquote>\n<p>I'm not familiar with valgrind or how to use it yet, but here's the output (in a gist since it's so long) in case it helps you:<br>\n<a href=\"https://gist.github.com/SylvanSign/64d23f9c72e65359c0db4f0566bb0296\">https://gist.github.com/SylvanSign/64d23f9c72e65359c0db4f0566bb0296</a></p>",
        "id": 277225172,
        "sender_full_name": "Jake",
        "timestamp": 1648692935
    },
    {
        "content": "<p>Hi, I'm sorry if messages in this thread are getting a bit repetitive with people getting some variation of the same error when building from source...<br>\nWhen I run <code>cargo build</code>, I get this error:</p>\n<div class=\"codehilite\" data-code-language=\"Fish\"><pre><span></span><code>error: failed to run custom build <span class=\"nb\">command </span><span class=\"k\">for</span> <span class=\"err\">`</span>roc_builtins v0.1.0 <span class=\"o\">(</span>/Users/nikitamounier/Desktop/roc/compiler/builtins<span class=\"o\">)</span><span class=\"err\">`</span>\n\nCaused by:\n  process didn<span class=\"s1\">'t exit successfully: `/Users/nikitamounier/Desktop/roc/target/debug/build/roc_builtins-4cc28b6b1e39ca55/build-script-build` (exit status: 101)</span>\n<span class=\"s1\">  --- stdout</span>\n<span class=\"s1\">  cargo:rerun-if-changed=build.rs</span>\n<span class=\"s1\">  Compiling host ir to: /Users/nikitamounier/Desktop/roc/compiler/builtins/bitcode/builtins-host.ll</span>\n\n<span class=\"s1\">  --- stderr</span>\n<span class=\"s1\">  thread '</span>main<span class=\"s1\">' panicked at '</span>zig failed: error: unable to create compilation: FileNotFound\n  <span class=\"err\">'</span>, compiler/builtins/build.rs:170:17\n  note: run with <span class=\"err\">`</span><span class=\"nv\">RUST_BACKTRACE</span><span class=\"o\">=</span>1<span class=\"err\">`</span> environment variable to display a backtrace\nwarning: build failed, waiting <span class=\"k\">for</span> other <span class=\"nb\">jobs </span>to finish...\nerror: build failed\n</code></pre></div>\n<p>I'm running macOS Monterey on an M1 with the nix-shell. According to <code>llvm-config --version</code>, I'm on LLVM 12.01, and according to <code>zig version</code> I'm on zig 0.8.1. I'm able to run <code>zig build run</code> on a simple hello-world zig project. </p>\n<p>Any idea what I could be doing wrong?</p>",
        "id": 278095201,
        "sender_full_name": "Nikita Mounier",
        "timestamp": 1649284420
    },
    {
        "content": "<p>Sometimes that just flakily fails on my M1 mac and I simply have to run cargo build twice. So try running it again before anything else</p>",
        "id": 278095872,
        "sender_full_name": "Brendan Hansknecht",
        "timestamp": 1649284912
    },
    {
        "content": "<p>Hi! Yeah I've tried running cargo build a couple times now, quit my terminal session in between sometimes and all. No luck for me yet, still getting the same error message</p>",
        "id": 278096471,
        "sender_full_name": "Nikita Mounier",
        "timestamp": 1649285370
    },
    {
        "content": "<p>Just a note, one general option is just to use nix and it should auto-magically work. Otherwise, I'll try to look into this more in a bit to figure out what is going on.</p>",
        "id": 278097341,
        "sender_full_name": "Brendan Hansknecht",
        "timestamp": 1649285987
    },
    {
        "content": "<p>That's just the thing --- I am using nix (that's what I meant when I said I'm on an M1 with nix-shell), which makes it all the more perplexing...</p>",
        "id": 278098234,
        "sender_full_name": "Nikita Mounier",
        "timestamp": 1649286474
    },
    {
        "content": "<p>Sorry, I missed the nix line. Can you run with <code>RUST_BACKTRACE=1</code> I want to see which specific zig command is failing</p>",
        "id": 278104515,
        "sender_full_name": "Brendan Hansknecht",
        "timestamp": 1649291564
    },
    {
        "content": "<p>Actually, I am able to reproduce in a pure shell. Let me debug.</p>",
        "id": 278105862,
        "sender_full_name": "Brendan Hansknecht",
        "timestamp": 1649293011
    },
    {
        "content": "<p>Sure! Here's the stacktrace when I run with <code>RUST_BACKTRACE=1</code>:</p>\n<div class=\"codehilite\" data-code-language=\"Swift\"><pre><span></span><code><span class=\"n\">stack</span> <span class=\"n\">backtrace</span><span class=\"p\">:</span>\n     <span class=\"mi\">0</span><span class=\"p\">:</span> <span class=\"n\">rust_begin_unwind</span>\n               <span class=\"n\">at</span> <span class=\"o\">/</span><span class=\"n\">rustc</span><span class=\"o\">/</span><span class=\"mi\">02072</span><span class=\"n\">b482a8b5357f7fb5e5637444ae30e423c40</span><span class=\"o\">/</span><span class=\"n\">library</span><span class=\"o\">/</span><span class=\"n\">std</span><span class=\"o\">/</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">panicking</span><span class=\"p\">.</span><span class=\"n\">rs</span><span class=\"p\">:</span><span class=\"mi\">498</span><span class=\"p\">:</span><span class=\"mi\">5</span>\n     <span class=\"mi\">1</span><span class=\"p\">:</span> <span class=\"n\">core</span><span class=\"p\">::</span><span class=\"n\">panicking</span><span class=\"p\">::</span><span class=\"n\">panic_fmt</span>\n               <span class=\"n\">at</span> <span class=\"o\">/</span><span class=\"n\">rustc</span><span class=\"o\">/</span><span class=\"mi\">02072</span><span class=\"n\">b482a8b5357f7fb5e5637444ae30e423c40</span><span class=\"o\">/</span><span class=\"n\">library</span><span class=\"o\">/</span><span class=\"n\">core</span><span class=\"o\">/</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">panicking</span><span class=\"p\">.</span><span class=\"n\">rs</span><span class=\"p\">:</span><span class=\"mi\">107</span><span class=\"p\">:</span><span class=\"mi\">14</span>\n     <span class=\"mi\">2</span><span class=\"p\">:</span> <span class=\"n\">build_script_build</span><span class=\"p\">::</span><span class=\"n\">run_command</span>\n               <span class=\"n\">at</span> <span class=\"p\">.</span><span class=\"o\">/</span><span class=\"n\">build</span><span class=\"p\">.</span><span class=\"n\">rs</span><span class=\"p\">:</span><span class=\"mi\">170</span><span class=\"p\">:</span><span class=\"mi\">17</span>\n     <span class=\"mi\">3</span><span class=\"p\">:</span> <span class=\"n\">build_script_build</span><span class=\"p\">::</span><span class=\"n\">generate_bc_file</span>\n               <span class=\"n\">at</span> <span class=\"p\">.</span><span class=\"o\">/</span><span class=\"n\">build</span><span class=\"p\">.</span><span class=\"n\">rs</span><span class=\"p\">:</span><span class=\"mi\">134</span><span class=\"p\">:</span><span class=\"mi\">5</span>\n     <span class=\"mi\">4</span><span class=\"p\">:</span> <span class=\"n\">build_script_build</span><span class=\"p\">::</span><span class=\"n\">main</span>\n               <span class=\"n\">at</span> <span class=\"p\">.</span><span class=\"o\">/</span><span class=\"n\">build</span><span class=\"p\">.</span><span class=\"n\">rs</span><span class=\"p\">:</span><span class=\"mi\">39</span><span class=\"p\">:</span><span class=\"mi\">5</span>\n     <span class=\"mi\">5</span><span class=\"p\">:</span> <span class=\"n\">core</span><span class=\"p\">::</span><span class=\"n\">ops</span><span class=\"p\">::</span><span class=\"n\">function</span><span class=\"p\">::</span><span class=\"n\">FnOnce</span><span class=\"p\">::</span><span class=\"n\">call_once</span>\n               <span class=\"n\">at</span> <span class=\"o\">/</span><span class=\"n\">rustc</span><span class=\"o\">/</span><span class=\"mi\">02072</span><span class=\"n\">b482a8b5357f7fb5e5637444ae30e423c40</span><span class=\"o\">/</span><span class=\"n\">library</span><span class=\"o\">/</span><span class=\"n\">core</span><span class=\"o\">/</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">ops</span><span class=\"o\">/</span><span class=\"n\">function</span><span class=\"p\">.</span><span class=\"n\">rs</span><span class=\"p\">:</span><span class=\"mi\">227</span><span class=\"p\">:</span><span class=\"mi\">5</span>\n  <span class=\"n\">note</span><span class=\"p\">:</span> <span class=\"n\">Some</span> <span class=\"n\">details</span> <span class=\"n\">are</span> <span class=\"n\">omitted</span><span class=\"p\">,</span> <span class=\"n\">run</span> <span class=\"n\">with</span> <span class=\"p\">`</span><span class=\"n\">RUST_BACKTRACE</span><span class=\"p\">=</span><span class=\"n\">full</span><span class=\"p\">`</span> <span class=\"k\">for</span> <span class=\"n\">a</span> <span class=\"n\">verbose</span> <span class=\"n\">backtrace</span><span class=\"p\">.</span>\n</code></pre></div>\n<p>Let me know if you'd like the <code>RUST_BACKTRACE=full</code> version!</p>",
        "id": 278107138,
        "sender_full_name": "Nikita Mounier",
        "timestamp": 1649294338
    },
    {
        "content": "<p>So I think something is likely messed up with how we setup zig with nix. In a pure nix shell we have some interesting behaviour:</p>\n<div class=\"codehilite\" data-code-language=\"Bash Session\"><pre><span></span><code><span class=\"gp\">[nix-shell:~/Projects/roc]$ </span>mkdir <span class=\"nb\">test</span>\n\n<span class=\"gp\">[nix-shell:~/Projects/roc]$ </span><span class=\"nb\">cd</span> <span class=\"nb\">test</span>\n\n<span class=\"gp\">[nix-shell:~/Projects/roc/test]$ </span>zig init-exe\n<span class=\"go\">info: Created build.zig</span>\n<span class=\"go\">info: Created src/main.zig</span>\n<span class=\"go\">info: Next, try `zig build --help` or `zig build run`</span>\n\n<span class=\"gp\">[nix-shell:~/Projects/roc/test]$ </span>zig build --help\n<span class=\"go\">error: unable to create compilation: FileNotFound</span>\n</code></pre></div>",
        "id": 278111655,
        "sender_full_name": "Brendan Hansknecht",
        "timestamp": 1649299807
    },
    {
        "content": "<p>I think the files that are failing to compile are the zig build cache for the standard library or something of that nature. I think nix may be restricting file writing permissions. That is at least my first guess.</p>",
        "id": 278111674,
        "sender_full_name": "Brendan Hansknecht",
        "timestamp": 1649299859
    },
    {
        "content": "<p>Potentially a work around is just making sure that people never use pure nix shells or use tools like direnv/lorri, but I am not sure if they would still run into the issue either way.</p>",
        "id": 278111773,
        "sender_full_name": "Brendan Hansknecht",
        "timestamp": 1649299954
    },
    {
        "content": "<p>I <span aria-label=\"heart\" class=\"emoji emoji-2764\" role=\"img\" title=\"heart\">:heart:</span>️ Nix</p>",
        "id": 278111962,
        "sender_full_name": "jan kili",
        "timestamp": 1649300230
    },
    {
        "content": "<p>I have been poking at this for a bit, and at least for now, I am unsure what specifically is going on. Though I did learn that <code>gimmeMoreOfThoseSweetSweetFileDescriptors()</code> is a function in the zig compiler.</p>",
        "id": 278113117,
        "sender_full_name": "Brendan Hansknecht",
        "timestamp": 1649301754
    },
    {
        "content": "<p>Oh, good news, this issue looks to be fixed with zig 0.9.1</p>",
        "id": 278113225,
        "sender_full_name": "Brendan Hansknecht",
        "timestamp": 1649301930
    },
    {
        "content": "<p>Since the compiler is about to update zig versions, this should be fixed very soon.</p>",
        "id": 278113228,
        "sender_full_name": "Brendan Hansknecht",
        "timestamp": 1649301946
    },
    {
        "content": "<p>The zig 0.9.1 branch isn't fully working, but <span class=\"user-mention\" data-user-id=\"492598\">@Nikita Mounier</span>  can you check if you can at least build the compiler on the <code>update_zig_09</code> branch? (please <code>git pull</code> I just pushed a change to it)</p>",
        "id": 278113579,
        "sender_full_name": "Brendan Hansknecht",
        "timestamp": 1649302352
    },
    {
        "content": "<p>Sure, I'll give it a shot!</p>",
        "id": 278148087,
        "sender_full_name": "Nikita Mounier",
        "timestamp": 1649330372
    },
    {
        "content": "<p>Building the compiler works!</p>",
        "id": 278150900,
        "sender_full_name": "Nikita Mounier",
        "timestamp": 1649331874
    },
    {
        "content": "<blockquote>\n<p>The zig 0.9.1 branch isn't fully working</p>\n</blockquote>\n<p>What should I look out for that isn't fully working for now?</p>",
        "id": 278150990,
        "sender_full_name": "Nikita Mounier",
        "timestamp": 1649331939
    },
    {
        "content": "<p>some functions for strings &lt;-&gt; number conversion</p>",
        "id": 278151070,
        "sender_full_name": "Folkert de Vries",
        "timestamp": 1649331976
    },
    {
        "content": "<p>and the tests fail because of memory errors</p>",
        "id": 278151079,
        "sender_full_name": "Folkert de Vries",
        "timestamp": 1649331987
    },
    {
        "content": "<p>macos is rather strict in going out of bounds so if you see random segfaults, that might be it</p>",
        "id": 278151096,
        "sender_full_name": "Folkert de Vries",
        "timestamp": 1649332010
    },
    {
        "content": "<p>I'll continue work on it tonight/over the weekend, so it should all be fixed soon</p>",
        "id": 278151125,
        "sender_full_name": "Folkert de Vries",
        "timestamp": 1649332026
    },
    {
        "content": "<p>I see, thanks for the info. Should be fine for now for me to hack around a little with Roc</p>",
        "id": 278151129,
        "sender_full_name": "Nikita Mounier",
        "timestamp": 1649332031
    },
    {
        "content": "<p>Sounds good, thanks a lot!</p>",
        "id": 278151141,
        "sender_full_name": "Nikita Mounier",
        "timestamp": 1649332041
    },
    {
        "content": "<p>Ok actually although I'm able to build the compiler, I'm not able to compile a Roc file. When doing <code>cargo run examples/hello-world/helloWorld.roc</code>, I get this error with this stacktrace:</p>\n<div class=\"codehilite\" data-code-language=\"Swift\"><pre><span></span><code><span class=\"err\">🔨</span> <span class=\"n\">Rebuilding</span> <span class=\"n\">host</span><span class=\"p\">...</span> <span class=\"n\">Done</span><span class=\"p\">!</span>\n<span class=\"n\">thread</span> <span class=\"err\">'</span><span class=\"n\">main</span><span class=\"err\">'</span> <span class=\"n\">panicked</span> <span class=\"n\">at</span> <span class=\"err\">'</span><span class=\"n\">Failed</span> <span class=\"n\">to</span> <span class=\"n\">execute</span> <span class=\"n\">command</span> <span class=\"err\">'</span><span class=\"n\">sw_vers</span> <span class=\"o\">-</span><span class=\"n\">productVersion</span><span class=\"err\">'</span><span class=\"p\">:</span> <span class=\"n\">Os</span> <span class=\"p\">{</span> <span class=\"n\">code</span><span class=\"p\">:</span> <span class=\"mi\">2</span><span class=\"p\">,</span> <span class=\"n\">kind</span><span class=\"p\">:</span> <span class=\"n\">NotFound</span><span class=\"p\">,</span> <span class=\"n\">message</span><span class=\"p\">:</span> <span class=\"s\">\"No such file or directory\"</span> <span class=\"p\">}</span><span class=\"err\">'</span><span class=\"p\">,</span> <span class=\"n\">compiler</span><span class=\"o\">/</span><span class=\"n\">build</span><span class=\"o\">/</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">link</span><span class=\"p\">.</span><span class=\"n\">rs</span><span class=\"p\">:</span><span class=\"mi\">1006</span><span class=\"p\">:</span><span class=\"mi\">10</span>\n<span class=\"n\">stack</span> <span class=\"n\">backtrace</span><span class=\"p\">:</span>\n   <span class=\"mi\">0</span><span class=\"p\">:</span> <span class=\"n\">rust_begin_unwind</span>\n             <span class=\"n\">at</span> <span class=\"o\">/</span><span class=\"n\">rustc</span><span class=\"o\">/</span><span class=\"mi\">02072</span><span class=\"n\">b482a8b5357f7fb5e5637444ae30e423c40</span><span class=\"o\">/</span><span class=\"n\">library</span><span class=\"o\">/</span><span class=\"n\">std</span><span class=\"o\">/</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">panicking</span><span class=\"p\">.</span><span class=\"n\">rs</span><span class=\"p\">:</span><span class=\"mi\">498</span><span class=\"p\">:</span><span class=\"mi\">5</span>\n   <span class=\"mi\">1</span><span class=\"p\">:</span> <span class=\"n\">core</span><span class=\"p\">::</span><span class=\"n\">panicking</span><span class=\"p\">::</span><span class=\"n\">panic_fmt</span>\n             <span class=\"n\">at</span> <span class=\"o\">/</span><span class=\"n\">rustc</span><span class=\"o\">/</span><span class=\"mi\">02072</span><span class=\"n\">b482a8b5357f7fb5e5637444ae30e423c40</span><span class=\"o\">/</span><span class=\"n\">library</span><span class=\"o\">/</span><span class=\"n\">core</span><span class=\"o\">/</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">panicking</span><span class=\"p\">.</span><span class=\"n\">rs</span><span class=\"p\">:</span><span class=\"mi\">107</span><span class=\"p\">:</span><span class=\"mi\">14</span>\n   <span class=\"mi\">2</span><span class=\"p\">:</span> <span class=\"n\">core</span><span class=\"p\">::</span><span class=\"n\">result</span><span class=\"p\">::</span><span class=\"n\">unwrap_failed</span>\n             <span class=\"n\">at</span> <span class=\"o\">/</span><span class=\"n\">rustc</span><span class=\"o\">/</span><span class=\"mi\">02072</span><span class=\"n\">b482a8b5357f7fb5e5637444ae30e423c40</span><span class=\"o\">/</span><span class=\"n\">library</span><span class=\"o\">/</span><span class=\"n\">core</span><span class=\"o\">/</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">result</span><span class=\"p\">.</span><span class=\"n\">rs</span><span class=\"p\">:</span><span class=\"mi\">1613</span><span class=\"p\">:</span><span class=\"mi\">5</span>\n   <span class=\"mi\">3</span><span class=\"p\">:</span> <span class=\"n\">core</span><span class=\"p\">::</span><span class=\"n\">result</span><span class=\"p\">::</span><span class=\"n\">Result</span><span class=\"p\">&lt;</span><span class=\"n\">T</span><span class=\"p\">,</span><span class=\"n\">E</span><span class=\"p\">&gt;::</span><span class=\"n\">expect</span>\n             <span class=\"n\">at</span> <span class=\"o\">/</span><span class=\"n\">rustc</span><span class=\"o\">/</span><span class=\"mi\">02072</span><span class=\"n\">b482a8b5357f7fb5e5637444ae30e423c40</span><span class=\"o\">/</span><span class=\"n\">library</span><span class=\"o\">/</span><span class=\"n\">core</span><span class=\"o\">/</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">result</span><span class=\"p\">.</span><span class=\"n\">rs</span><span class=\"p\">:</span><span class=\"mi\">1255</span><span class=\"p\">:</span><span class=\"mi\">23</span>\n   <span class=\"mi\">4</span><span class=\"p\">:</span> <span class=\"n\">roc_build</span><span class=\"p\">::</span><span class=\"n\">link</span><span class=\"p\">::</span><span class=\"n\">get_macos_version</span>\n             <span class=\"n\">at</span> <span class=\"o\">/</span><span class=\"n\">Users</span><span class=\"o\">/</span><span class=\"n\">nikitamounier</span><span class=\"o\">/</span><span class=\"n\">Desktop</span><span class=\"o\">/</span><span class=\"n\">roc</span><span class=\"o\">/</span><span class=\"n\">compiler</span><span class=\"o\">/</span><span class=\"n\">build</span><span class=\"o\">/</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">link</span><span class=\"p\">.</span><span class=\"n\">rs</span><span class=\"p\">:</span><span class=\"mi\">1003</span><span class=\"p\">:</span><span class=\"mi\">22</span>\n   <span class=\"mi\">5</span><span class=\"p\">:</span> <span class=\"n\">roc_build</span><span class=\"p\">::</span><span class=\"n\">link</span><span class=\"p\">::</span><span class=\"n\">link_macos</span>\n             <span class=\"n\">at</span> <span class=\"o\">/</span><span class=\"n\">Users</span><span class=\"o\">/</span><span class=\"n\">nikitamounier</span><span class=\"o\">/</span><span class=\"n\">Desktop</span><span class=\"o\">/</span><span class=\"n\">roc</span><span class=\"o\">/</span><span class=\"n\">compiler</span><span class=\"o\">/</span><span class=\"n\">build</span><span class=\"o\">/</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">link</span><span class=\"p\">.</span><span class=\"n\">rs</span><span class=\"p\">:</span><span class=\"mi\">931</span><span class=\"p\">:</span><span class=\"mi\">14</span>\n   <span class=\"mi\">6</span><span class=\"p\">:</span> <span class=\"n\">roc_build</span><span class=\"p\">::</span><span class=\"n\">link</span><span class=\"p\">::</span><span class=\"n\">link</span>\n             <span class=\"n\">at</span> <span class=\"o\">/</span><span class=\"n\">Users</span><span class=\"o\">/</span><span class=\"n\">nikitamounier</span><span class=\"o\">/</span><span class=\"n\">Desktop</span><span class=\"o\">/</span><span class=\"n\">roc</span><span class=\"o\">/</span><span class=\"n\">compiler</span><span class=\"o\">/</span><span class=\"n\">build</span><span class=\"o\">/</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">link</span><span class=\"p\">.</span><span class=\"n\">rs</span><span class=\"p\">:</span><span class=\"mi\">48</span><span class=\"p\">:</span><span class=\"mi\">14</span>\n   <span class=\"mi\">7</span><span class=\"p\">:</span> <span class=\"n\">roc_cli</span><span class=\"p\">::</span><span class=\"n\">build</span><span class=\"p\">::</span><span class=\"n\">build_file</span>\n             <span class=\"n\">at</span> <span class=\"o\">/</span><span class=\"n\">Users</span><span class=\"o\">/</span><span class=\"n\">nikitamounier</span><span class=\"o\">/</span><span class=\"n\">Desktop</span><span class=\"o\">/</span><span class=\"n\">roc</span><span class=\"o\">/</span><span class=\"n\">cli</span><span class=\"o\">/</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">build</span><span class=\"p\">.</span><span class=\"n\">rs</span><span class=\"p\">:</span><span class=\"mi\">259</span><span class=\"p\">:</span><span class=\"mi\">13</span>\n   <span class=\"mi\">8</span><span class=\"p\">:</span> <span class=\"n\">roc_cli</span><span class=\"p\">::</span><span class=\"n\">build</span>\n             <span class=\"n\">at</span> <span class=\"o\">/</span><span class=\"n\">Users</span><span class=\"o\">/</span><span class=\"n\">nikitamounier</span><span class=\"o\">/</span><span class=\"n\">Desktop</span><span class=\"o\">/</span><span class=\"n\">roc</span><span class=\"o\">/</span><span class=\"n\">cli</span><span class=\"o\">/</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">lib</span><span class=\"p\">.</span><span class=\"n\">rs</span><span class=\"p\">:</span><span class=\"mi\">332</span><span class=\"p\">:</span><span class=\"mi\">27</span>\n   <span class=\"mi\">9</span><span class=\"p\">:</span> <span class=\"n\">roc</span><span class=\"p\">::</span><span class=\"n\">main</span>\n             <span class=\"n\">at</span> <span class=\"o\">/</span><span class=\"n\">Users</span><span class=\"o\">/</span><span class=\"n\">nikitamounier</span><span class=\"o\">/</span><span class=\"n\">Desktop</span><span class=\"o\">/</span><span class=\"n\">roc</span><span class=\"o\">/</span><span class=\"n\">cli</span><span class=\"o\">/</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">main</span><span class=\"p\">.</span><span class=\"n\">rs</span><span class=\"p\">:</span><span class=\"mi\">30</span><span class=\"p\">:</span><span class=\"mi\">21</span>\n  <span class=\"mi\">10</span><span class=\"p\">:</span> <span class=\"n\">core</span><span class=\"p\">::</span><span class=\"n\">ops</span><span class=\"p\">::</span><span class=\"n\">function</span><span class=\"p\">::</span><span class=\"n\">FnOnce</span><span class=\"p\">::</span><span class=\"n\">call_once</span>\n             <span class=\"n\">at</span> <span class=\"o\">/</span><span class=\"n\">rustc</span><span class=\"o\">/</span><span class=\"mi\">02072</span><span class=\"n\">b482a8b5357f7fb5e5637444ae30e423c40</span><span class=\"o\">/</span><span class=\"n\">library</span><span class=\"o\">/</span><span class=\"n\">core</span><span class=\"o\">/</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">ops</span><span class=\"o\">/</span><span class=\"n\">function</span><span class=\"p\">.</span><span class=\"n\">rs</span><span class=\"p\">:</span><span class=\"mi\">227</span><span class=\"p\">:</span><span class=\"mi\">5</span>\n</code></pre></div>\n<p>Same thing happens with <code>cargo run --release</code>.<br>\nI did a quick search on the Zulip chat to see if this error has already popped up for someone, but it seems like it hasn't. What do you think?</p>",
        "id": 278152811,
        "sender_full_name": "Nikita Mounier",
        "timestamp": 1649332912
    },
    {
        "content": "<p>yeah this is one of those memory issues</p>",
        "id": 278153550,
        "sender_full_name": "Folkert de Vries",
        "timestamp": 1649333304
    },
    {
        "content": "<p>I'm not sure whether this is helpful or not, but I get a different (probably related) error when running <code>cargo run examples/algorithms/fibonacci.roc</code>:</p>\n<div class=\"codehilite\" data-code-language=\"Swift\"><pre><span></span><code><span class=\"n\">thread</span> <span class=\"err\">'</span><span class=\"p\">&lt;</span><span class=\"n\">unnamed</span><span class=\"p\">&gt;</span><span class=\"err\">'</span> <span class=\"n\">panicked</span> <span class=\"n\">at</span> <span class=\"err\">'</span><span class=\"n\">TODO</span> <span class=\"n\">gracefully</span> <span class=\"n\">handle</span> <span class=\"n\">unsupported</span> <span class=\"n\">target</span><span class=\"p\">:</span> <span class=\"n\">Triple</span> <span class=\"p\">{</span> <span class=\"n\">architecture</span><span class=\"p\">:</span> <span class=\"n\">Aarch64</span><span class=\"p\">(</span><span class=\"n\">Aarch64</span><span class=\"p\">),</span> <span class=\"n\">vendor</span><span class=\"p\">:</span> <span class=\"n\">Apple</span><span class=\"p\">,</span> <span class=\"n\">operating_system</span><span class=\"p\">:</span> <span class=\"n\">Darwin</span><span class=\"p\">,</span> <span class=\"n\">environment</span><span class=\"p\">:</span> <span class=\"n\">Unknown</span><span class=\"p\">,</span> <span class=\"n\">binary_format</span><span class=\"p\">:</span> <span class=\"n\">Macho</span> <span class=\"p\">}</span><span class=\"err\">'</span><span class=\"p\">,</span> <span class=\"n\">compiler</span><span class=\"o\">/</span><span class=\"n\">build</span><span class=\"o\">/</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">target</span><span class=\"p\">.</span><span class=\"n\">rs</span><span class=\"p\">:</span><span class=\"mi\">75</span><span class=\"p\">:</span><span class=\"mi\">14</span>\n<span class=\"n\">stack</span> <span class=\"n\">backtrace</span><span class=\"p\">:</span>\n   <span class=\"mi\">0</span><span class=\"p\">:</span> <span class=\"n\">rust_begin_unwind</span>\n             <span class=\"n\">at</span> <span class=\"o\">/</span><span class=\"n\">rustc</span><span class=\"o\">/</span><span class=\"mi\">02072</span><span class=\"n\">b482a8b5357f7fb5e5637444ae30e423c40</span><span class=\"o\">/</span><span class=\"n\">library</span><span class=\"o\">/</span><span class=\"n\">std</span><span class=\"o\">/</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">panicking</span><span class=\"p\">.</span><span class=\"n\">rs</span><span class=\"p\">:</span><span class=\"mi\">498</span><span class=\"p\">:</span><span class=\"mi\">5</span>\n   <span class=\"mi\">1</span><span class=\"p\">:</span> <span class=\"n\">core</span><span class=\"p\">::</span><span class=\"n\">panicking</span><span class=\"p\">::</span><span class=\"n\">panic_fmt</span>\n             <span class=\"n\">at</span> <span class=\"o\">/</span><span class=\"n\">rustc</span><span class=\"o\">/</span><span class=\"mi\">02072</span><span class=\"n\">b482a8b5357f7fb5e5637444ae30e423c40</span><span class=\"o\">/</span><span class=\"n\">library</span><span class=\"o\">/</span><span class=\"n\">core</span><span class=\"o\">/</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">panicking</span><span class=\"p\">.</span><span class=\"n\">rs</span><span class=\"p\">:</span><span class=\"mi\">107</span><span class=\"p\">:</span><span class=\"mi\">14</span>\n   <span class=\"mi\">2</span><span class=\"p\">:</span> <span class=\"n\">roc_build</span><span class=\"p\">::</span><span class=\"n\">target</span><span class=\"p\">::</span><span class=\"n\">target_zig_str</span>\n             <span class=\"n\">at</span> <span class=\"p\">.</span><span class=\"o\">/</span><span class=\"n\">compiler</span><span class=\"o\">/</span><span class=\"n\">build</span><span class=\"o\">/</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">target</span><span class=\"p\">.</span><span class=\"n\">rs</span><span class=\"p\">:</span><span class=\"mi\">75</span><span class=\"p\">:</span><span class=\"mi\">14</span>\n   <span class=\"mi\">3</span><span class=\"p\">:</span> <span class=\"n\">roc_build</span><span class=\"p\">::</span><span class=\"n\">link</span><span class=\"p\">::</span><span class=\"n\">rebuild_host</span>\n             <span class=\"n\">at</span> <span class=\"p\">.</span><span class=\"o\">/</span><span class=\"n\">compiler</span><span class=\"o\">/</span><span class=\"n\">build</span><span class=\"o\">/</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">link</span><span class=\"p\">.</span><span class=\"n\">rs</span><span class=\"p\">:</span><span class=\"mi\">460</span><span class=\"p\">:</span><span class=\"mi\">21</span>\n   <span class=\"mi\">4</span><span class=\"p\">:</span> <span class=\"n\">roc_cli</span><span class=\"p\">::</span><span class=\"n\">build</span><span class=\"p\">::</span><span class=\"n\">spawn_rebuild_thread</span><span class=\"p\">::{{</span><span class=\"n\">closure</span><span class=\"p\">}}</span>\n             <span class=\"n\">at</span> <span class=\"p\">.</span><span class=\"o\">/</span><span class=\"n\">cli</span><span class=\"o\">/</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">build</span><span class=\"p\">.</span><span class=\"n\">rs</span><span class=\"p\">:</span><span class=\"mi\">326</span><span class=\"p\">:</span><span class=\"mi\">17</span>\n<span class=\"n\">note</span><span class=\"p\">:</span> <span class=\"n\">Some</span> <span class=\"n\">details</span> <span class=\"n\">are</span> <span class=\"n\">omitted</span><span class=\"p\">,</span> <span class=\"n\">run</span> <span class=\"n\">with</span> <span class=\"p\">`</span><span class=\"n\">RUST_BACKTRACE</span><span class=\"p\">=</span><span class=\"n\">full</span><span class=\"p\">`</span> <span class=\"k\">for</span> <span class=\"n\">a</span> <span class=\"n\">verbose</span> <span class=\"n\">backtrace</span><span class=\"p\">.</span>\n<span class=\"n\">thread</span> <span class=\"err\">'</span><span class=\"n\">main</span><span class=\"err\">'</span> <span class=\"n\">panicked</span> <span class=\"n\">at</span> <span class=\"err\">'</span><span class=\"n\">called</span> <span class=\"p\">`</span><span class=\"n\">Result</span><span class=\"p\">::</span><span class=\"n\">unwrap</span><span class=\"p\">()`</span> <span class=\"n\">on</span> <span class=\"n\">an</span> <span class=\"p\">`</span><span class=\"n\">Err</span><span class=\"p\">`</span> <span class=\"n\">value</span><span class=\"p\">:</span> <span class=\"nb\">Any</span> <span class=\"p\">{</span> <span class=\"p\">..</span> <span class=\"p\">}</span><span class=\"err\">'</span><span class=\"p\">,</span> <span class=\"n\">cli</span><span class=\"o\">/</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">build</span><span class=\"p\">.</span><span class=\"n\">rs</span><span class=\"p\">:</span><span class=\"mi\">233</span><span class=\"p\">:</span><span class=\"mi\">50</span>\n<span class=\"n\">stack</span> <span class=\"n\">backtrace</span><span class=\"p\">:</span>\n   <span class=\"mi\">0</span><span class=\"p\">:</span> <span class=\"n\">rust_begin_unwind</span>\n             <span class=\"n\">at</span> <span class=\"o\">/</span><span class=\"n\">rustc</span><span class=\"o\">/</span><span class=\"mi\">02072</span><span class=\"n\">b482a8b5357f7fb5e5637444ae30e423c40</span><span class=\"o\">/</span><span class=\"n\">library</span><span class=\"o\">/</span><span class=\"n\">std</span><span class=\"o\">/</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">panicking</span><span class=\"p\">.</span><span class=\"n\">rs</span><span class=\"p\">:</span><span class=\"mi\">498</span><span class=\"p\">:</span><span class=\"mi\">5</span>\n   <span class=\"mi\">1</span><span class=\"p\">:</span> <span class=\"n\">core</span><span class=\"p\">::</span><span class=\"n\">panicking</span><span class=\"p\">::</span><span class=\"n\">panic_fmt</span>\n             <span class=\"n\">at</span> <span class=\"o\">/</span><span class=\"n\">rustc</span><span class=\"o\">/</span><span class=\"mi\">02072</span><span class=\"n\">b482a8b5357f7fb5e5637444ae30e423c40</span><span class=\"o\">/</span><span class=\"n\">library</span><span class=\"o\">/</span><span class=\"n\">core</span><span class=\"o\">/</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">panicking</span><span class=\"p\">.</span><span class=\"n\">rs</span><span class=\"p\">:</span><span class=\"mi\">107</span><span class=\"p\">:</span><span class=\"mi\">14</span>\n   <span class=\"mi\">2</span><span class=\"p\">:</span> <span class=\"n\">core</span><span class=\"p\">::</span><span class=\"n\">result</span><span class=\"p\">::</span><span class=\"n\">unwrap_failed</span>\n             <span class=\"n\">at</span> <span class=\"o\">/</span><span class=\"n\">rustc</span><span class=\"o\">/</span><span class=\"mi\">02072</span><span class=\"n\">b482a8b5357f7fb5e5637444ae30e423c40</span><span class=\"o\">/</span><span class=\"n\">library</span><span class=\"o\">/</span><span class=\"n\">core</span><span class=\"o\">/</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">result</span><span class=\"p\">.</span><span class=\"n\">rs</span><span class=\"p\">:</span><span class=\"mi\">1613</span><span class=\"p\">:</span><span class=\"mi\">5</span>\n   <span class=\"mi\">3</span><span class=\"p\">:</span> <span class=\"n\">core</span><span class=\"p\">::</span><span class=\"n\">result</span><span class=\"p\">::</span><span class=\"n\">Result</span><span class=\"p\">&lt;</span><span class=\"n\">T</span><span class=\"p\">,</span><span class=\"n\">E</span><span class=\"p\">&gt;::</span><span class=\"n\">unwrap</span>\n             <span class=\"n\">at</span> <span class=\"o\">/</span><span class=\"n\">rustc</span><span class=\"o\">/</span><span class=\"mi\">02072</span><span class=\"n\">b482a8b5357f7fb5e5637444ae30e423c40</span><span class=\"o\">/</span><span class=\"n\">library</span><span class=\"o\">/</span><span class=\"n\">core</span><span class=\"o\">/</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">result</span><span class=\"p\">.</span><span class=\"n\">rs</span><span class=\"p\">:</span><span class=\"mi\">1295</span><span class=\"p\">:</span><span class=\"mi\">23</span>\n   <span class=\"mi\">4</span><span class=\"p\">:</span> <span class=\"n\">roc_cli</span><span class=\"p\">::</span><span class=\"n\">build</span><span class=\"p\">::</span><span class=\"n\">build_file</span>\n             <span class=\"n\">at</span> <span class=\"p\">.</span><span class=\"o\">/</span><span class=\"n\">cli</span><span class=\"o\">/</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">build</span><span class=\"p\">.</span><span class=\"n\">rs</span><span class=\"p\">:</span><span class=\"mi\">233</span><span class=\"p\">:</span><span class=\"mi\">28</span>\n   <span class=\"mi\">5</span><span class=\"p\">:</span> <span class=\"n\">roc_cli</span><span class=\"p\">::</span><span class=\"n\">build</span>\n             <span class=\"n\">at</span> <span class=\"p\">.</span><span class=\"o\">/</span><span class=\"n\">cli</span><span class=\"o\">/</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">lib</span><span class=\"p\">.</span><span class=\"n\">rs</span><span class=\"p\">:</span><span class=\"mi\">332</span><span class=\"p\">:</span><span class=\"mi\">27</span>\n   <span class=\"mi\">6</span><span class=\"p\">:</span> <span class=\"n\">roc</span><span class=\"p\">::</span><span class=\"n\">main</span>\n             <span class=\"n\">at</span> <span class=\"p\">.</span><span class=\"o\">/</span><span class=\"n\">cli</span><span class=\"o\">/</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">main</span><span class=\"p\">.</span><span class=\"n\">rs</span><span class=\"p\">:</span><span class=\"mi\">30</span><span class=\"p\">:</span><span class=\"mi\">21</span>\n   <span class=\"mi\">7</span><span class=\"p\">:</span> <span class=\"n\">core</span><span class=\"p\">::</span><span class=\"n\">ops</span><span class=\"p\">::</span><span class=\"n\">function</span><span class=\"p\">::</span><span class=\"n\">FnOnce</span><span class=\"p\">::</span><span class=\"n\">call_once</span>\n</code></pre></div>\n<p>Lmk if there's anything else I can do to help!</p>",
        "id": 278158462,
        "sender_full_name": "Nikita Mounier",
        "timestamp": 1649335678
    },
    {
        "content": "<p>huh, that unsupported target is weird. <span class=\"user-mention\" data-user-id=\"343810\">@Brendan Hansknecht</span> how could that happen? you run roc on your M1 right?</p>",
        "id": 278158811,
        "sender_full_name": "Folkert de Vries",
        "timestamp": 1649335819
    },
    {
        "content": "<p>I ran into that too when running a test yesterday, but it worked on a re-run. We should handle that target correctly: <a href=\"https://github.com/rtfeldman/roc/blob/37729c08cc8ed6d808e323d7c1ba5a8a79b58228/compiler/build/src/target.rs#L34-L38\">https://github.com/rtfeldman/roc/blob/37729c08cc8ed6d808e323d7c1ba5a8a79b58228/compiler/build/src/target.rs#L34-L38</a></p>",
        "id": 278159790,
        "sender_full_name": "Ayaz Hafiz",
        "timestamp": 1649336294
    },
    {
        "content": "<p>I've been running most of the example files to see the different kind of errors I get, it seems like I only get the unsupported target error with algorithms/quicksort.roc, algorithms/fibonacci.roc, and effects/Effect.roc<br>\nFor the other files it's just the memory-related one</p>",
        "id": 278160133,
        "sender_full_name": "Nikita Mounier",
        "timestamp": 1649336428
    },
    {
        "content": "<p>This might not be useful, but can you share the output of <code>uname -a; arch</code>?</p>",
        "id": 278160557,
        "sender_full_name": "Ayaz Hafiz",
        "timestamp": 1649336636
    },
    {
        "content": "<p>Sure:</p>\n<div class=\"codehilite\" data-code-language=\"Swift\"><pre><span></span><code><span class=\"n\">Darwin</span> <span class=\"n\">Nikitas</span><span class=\"o\">-</span><span class=\"n\">MacBook</span><span class=\"o\">-</span><span class=\"n\">Pro</span><span class=\"p\">.</span><span class=\"n\">local</span> <span class=\"mf\">21.4</span><span class=\"p\">.</span><span class=\"mi\">0</span> <span class=\"n\">Darwin</span> <span class=\"n\">Kernel</span> <span class=\"n\">Version</span> <span class=\"mf\">21.4</span><span class=\"p\">.</span><span class=\"mi\">0</span><span class=\"p\">:</span> <span class=\"n\">Mon</span> <span class=\"n\">Feb</span> <span class=\"mi\">21</span> <span class=\"mi\">20</span><span class=\"p\">:</span><span class=\"mi\">36</span><span class=\"p\">:</span><span class=\"mi\">53</span> <span class=\"n\">PST</span> <span class=\"mi\">2022</span><span class=\"p\">;</span> <span class=\"n\">root</span><span class=\"p\">:</span><span class=\"n\">xnu</span><span class=\"o\">-</span><span class=\"mf\">8020.101</span><span class=\"p\">.</span><span class=\"mi\">4</span><span class=\"o\">~</span><span class=\"mi\">2</span><span class=\"o\">/</span><span class=\"n\">RELEASE_ARM64_T8101</span> <span class=\"n\">arm64</span> <span class=\"n\">arm64</span> <span class=\"n\">MacBookPro17</span><span class=\"p\">,</span><span class=\"mi\">1</span> <span class=\"n\">Darwin</span>\n<span class=\"n\">bash</span><span class=\"p\">:</span> <span class=\"n\">arch</span><span class=\"p\">:</span> <span class=\"n\">command</span> <span class=\"n\">not</span> <span class=\"n\">found</span>\n</code></pre></div>",
        "id": 278160765,
        "sender_full_name": "Nikita Mounier",
        "timestamp": 1649336713
    },
    {
        "content": "<p>What is the current commit of the repo you are building from?</p>",
        "id": 278161535,
        "sender_full_name": "Ayaz Hafiz",
        "timestamp": 1649337058
    },
    {
        "content": "<p>Ok, I think I've confirmed that the unsupported-platform error only shows up when using a zig platform in the Roc file. For instance in examples/hello-world/helloWorld.roc, I get the usual memory-related error for c and rust, but only get the unsupported platform one when using zig. The two algorithm files and the Effects.roc file also use zig as the platform.</p>",
        "id": 278161764,
        "sender_full_name": "Nikita Mounier",
        "timestamp": 1649337167
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"454654\">@Ayaz Hafiz</span> </p>\n<blockquote>\n<p>What is the current commit of the repo you are building from?</p>\n</blockquote>\n<p>I'm on the update_zig_09 branch using the latest commit dcc876d03aa5df139a6f5402c9d348f5e1be184b</p>",
        "id": 278161909,
        "sender_full_name": "Nikita Mounier",
        "timestamp": 1649337243
    },
    {
        "content": "<p>Yeah that makes sense, you're hitting a panic in the function that gets the target for building zig code. Looks like that commit is missing the branch for Darwin on Mac. I just pushed 29739876876335b5ab4ca79b04290c58bb7749ed to that branch that should fix it; can you try?</p>",
        "id": 278162285,
        "sender_full_name": "Ayaz Hafiz",
        "timestamp": 1649337467
    },
    {
        "content": "<p>I'm actually also getting the same unsupported-platform error when using <code>web-platform</code> in the helloWorld.roc. Not sure if that's related though</p>",
        "id": 278162310,
        "sender_full_name": "Nikita Mounier",
        "timestamp": 1649337478
    },
    {
        "content": "<p>Sure, I'll give it a try</p>",
        "id": 278162356,
        "sender_full_name": "Nikita Mounier",
        "timestamp": 1649337485
    },
    {
        "content": "<p>Ok, so I tried compiling algorithms/fibonacci.roc and hello-world/helloWorld.roc using <code>zig-platform</code>, and I'm not getting the unsupported-platform error anymore, but I am getting a new kind of error:</p>\n<div class=\"codehilite\" data-code-language=\"Swift\"><pre><span></span><code><span class=\"n\">thread</span> <span class=\"err\">'</span><span class=\"p\">&lt;</span><span class=\"n\">unnamed</span><span class=\"p\">&gt;</span><span class=\"err\">'</span> <span class=\"n\">panicked</span> <span class=\"n\">at</span> <span class=\"err\">'</span><span class=\"n\">Failed</span> <span class=\"n\">to</span> <span class=\"n\">rebuild</span> <span class=\"n\">host</span><span class=\"p\">.</span><span class=\"n\">zig</span> <span class=\"o\">-</span> <span class=\"n\">stderr</span> <span class=\"n\">of</span> <span class=\"n\">the</span> <span class=\"p\">`</span><span class=\"n\">zig</span><span class=\"p\">`</span> <span class=\"n\">command</span> <span class=\"n\">was</span><span class=\"p\">:</span>\n<span class=\"o\">/</span><span class=\"n\">Users</span><span class=\"o\">/</span><span class=\"n\">nikitamounier</span><span class=\"o\">/</span><span class=\"n\">Desktop</span><span class=\"o\">/</span><span class=\"n\">roc</span><span class=\"o\">/</span><span class=\"n\">examples</span><span class=\"o\">/</span><span class=\"n\">algorithms</span><span class=\"o\">/</span><span class=\"n\">fibonacci</span><span class=\"o\">-</span><span class=\"n\">platform</span><span class=\"o\">/</span><span class=\"n\">host</span><span class=\"p\">.</span><span class=\"n\">zig</span><span class=\"p\">:</span><span class=\"mi\">28</span><span class=\"p\">:</span><span class=\"mi\">69</span><span class=\"p\">:</span> <span class=\"n\">error</span><span class=\"p\">:</span> <span class=\"n\">use</span> <span class=\"n\">of</span> <span class=\"n\">undeclared</span> <span class=\"n\">identifier</span> <span class=\"err\">'</span><span class=\"n\">c_void</span><span class=\"err\">'</span>\n<span class=\"o\">/</span><span class=\"n\">Users</span><span class=\"o\">/</span><span class=\"n\">nikitamounier</span><span class=\"o\">/</span><span class=\"n\">Desktop</span><span class=\"o\">/</span><span class=\"n\">roc</span><span class=\"o\">/</span><span class=\"n\">examples</span><span class=\"o\">/</span><span class=\"n\">algorithms</span><span class=\"o\">/</span><span class=\"n\">fibonacci</span><span class=\"o\">-</span><span class=\"n\">platform</span><span class=\"o\">/</span><span class=\"n\">host</span><span class=\"p\">.</span><span class=\"n\">zig</span><span class=\"p\">:</span><span class=\"mi\">29</span><span class=\"p\">:</span><span class=\"mi\">84</span><span class=\"p\">:</span> <span class=\"n\">error</span><span class=\"p\">:</span> <span class=\"n\">use</span> <span class=\"n\">of</span> <span class=\"n\">undeclared</span> <span class=\"n\">identifier</span> <span class=\"err\">'</span><span class=\"n\">c_void</span><span class=\"err\">'</span>\n<span class=\"o\">/</span><span class=\"n\">Users</span><span class=\"o\">/</span><span class=\"n\">nikitamounier</span><span class=\"o\">/</span><span class=\"n\">Desktop</span><span class=\"o\">/</span><span class=\"n\">roc</span><span class=\"o\">/</span><span class=\"n\">examples</span><span class=\"o\">/</span><span class=\"n\">algorithms</span><span class=\"o\">/</span><span class=\"n\">fibonacci</span><span class=\"o\">-</span><span class=\"n\">platform</span><span class=\"o\">/</span><span class=\"n\">host</span><span class=\"p\">.</span><span class=\"n\">zig</span><span class=\"p\">:</span><span class=\"mi\">34</span><span class=\"p\">:</span><span class=\"mi\">65</span><span class=\"p\">:</span> <span class=\"n\">error</span><span class=\"p\">:</span> <span class=\"n\">use</span> <span class=\"n\">of</span> <span class=\"n\">undeclared</span> <span class=\"n\">identifier</span> <span class=\"err\">'</span><span class=\"n\">c_void</span><span class=\"err\">'</span>\n<span class=\"o\">/</span><span class=\"n\">Users</span><span class=\"o\">/</span><span class=\"n\">nikitamounier</span><span class=\"o\">/</span><span class=\"n\">Desktop</span><span class=\"o\">/</span><span class=\"n\">roc</span><span class=\"o\">/</span><span class=\"n\">examples</span><span class=\"o\">/</span><span class=\"n\">algorithms</span><span class=\"o\">/</span><span class=\"n\">fibonacci</span><span class=\"o\">-</span><span class=\"n\">platform</span><span class=\"o\">/</span><span class=\"n\">host</span><span class=\"p\">.</span><span class=\"n\">zig</span><span class=\"p\">:</span><span class=\"mi\">45</span><span class=\"p\">:</span><span class=\"mi\">31</span><span class=\"p\">:</span> <span class=\"n\">error</span><span class=\"p\">:</span> <span class=\"n\">use</span> <span class=\"n\">of</span> <span class=\"n\">undeclared</span> <span class=\"n\">identifier</span> <span class=\"err\">'</span><span class=\"n\">c_void</span><span class=\"err\">'</span>\n<span class=\"o\">/</span><span class=\"n\">Users</span><span class=\"o\">/</span><span class=\"n\">nikitamounier</span><span class=\"o\">/</span><span class=\"n\">Desktop</span><span class=\"o\">/</span><span class=\"n\">roc</span><span class=\"o\">/</span><span class=\"n\">examples</span><span class=\"o\">/</span><span class=\"n\">algorithms</span><span class=\"o\">/</span><span class=\"n\">fibonacci</span><span class=\"o\">-</span><span class=\"n\">platform</span><span class=\"o\">/</span><span class=\"n\">host</span><span class=\"p\">.</span><span class=\"n\">zig</span><span class=\"p\">:</span><span class=\"mi\">54</span><span class=\"p\">:</span><span class=\"mi\">31</span><span class=\"p\">:</span> <span class=\"n\">error</span><span class=\"p\">:</span> <span class=\"n\">use</span> <span class=\"n\">of</span> <span class=\"n\">undeclared</span> <span class=\"n\">identifier</span> <span class=\"err\">'</span><span class=\"n\">c_void</span><span class=\"err\">'</span>\n<span class=\"o\">/</span><span class=\"n\">Users</span><span class=\"o\">/</span><span class=\"n\">nikitamounier</span><span class=\"o\">/</span><span class=\"n\">Desktop</span><span class=\"o\">/</span><span class=\"n\">roc</span><span class=\"o\">/</span><span class=\"n\">examples</span><span class=\"o\">/</span><span class=\"n\">algorithms</span><span class=\"o\">/</span><span class=\"n\">fibonacci</span><span class=\"o\">-</span><span class=\"n\">platform</span><span class=\"o\">/</span><span class=\"n\">host</span><span class=\"p\">.</span><span class=\"n\">zig</span><span class=\"p\">:</span><span class=\"mi\">63</span><span class=\"p\">:</span><span class=\"mi\">29</span><span class=\"p\">:</span> <span class=\"n\">error</span><span class=\"p\">:</span> <span class=\"n\">use</span> <span class=\"n\">of</span> <span class=\"n\">undeclared</span> <span class=\"n\">identifier</span> <span class=\"err\">'</span><span class=\"n\">c_void</span><span class=\"err\">'</span>\n<span class=\"err\">'</span><span class=\"p\">,</span> <span class=\"n\">compiler</span><span class=\"o\">/</span><span class=\"n\">build</span><span class=\"o\">/</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">link</span><span class=\"p\">.</span><span class=\"n\">rs</span><span class=\"p\">:</span><span class=\"mi\">1111</span><span class=\"p\">:</span><span class=\"mi\">27</span>\n<span class=\"n\">stack</span> <span class=\"n\">backtrace</span><span class=\"p\">:</span>\n   <span class=\"mi\">0</span><span class=\"p\">:</span> <span class=\"n\">rust_begin_unwind</span>\n             <span class=\"n\">at</span> <span class=\"o\">/</span><span class=\"n\">rustc</span><span class=\"o\">/</span><span class=\"mi\">02072</span><span class=\"n\">b482a8b5357f7fb5e5637444ae30e423c40</span><span class=\"o\">/</span><span class=\"n\">library</span><span class=\"o\">/</span><span class=\"n\">std</span><span class=\"o\">/</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">panicking</span><span class=\"p\">.</span><span class=\"n\">rs</span><span class=\"p\">:</span><span class=\"mi\">498</span><span class=\"p\">:</span><span class=\"mi\">5</span>\n   <span class=\"mi\">1</span><span class=\"p\">:</span> <span class=\"n\">core</span><span class=\"p\">::</span><span class=\"n\">panicking</span><span class=\"p\">::</span><span class=\"n\">panic_fmt</span>\n             <span class=\"n\">at</span> <span class=\"o\">/</span><span class=\"n\">rustc</span><span class=\"o\">/</span><span class=\"mi\">02072</span><span class=\"n\">b482a8b5357f7fb5e5637444ae30e423c40</span><span class=\"o\">/</span><span class=\"n\">library</span><span class=\"o\">/</span><span class=\"n\">core</span><span class=\"o\">/</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">panicking</span><span class=\"p\">.</span><span class=\"n\">rs</span><span class=\"p\">:</span><span class=\"mi\">107</span><span class=\"p\">:</span><span class=\"mi\">14</span>\n   <span class=\"mi\">2</span><span class=\"p\">:</span> <span class=\"n\">roc_build</span><span class=\"p\">::</span><span class=\"n\">link</span><span class=\"p\">::</span><span class=\"n\">validate_output</span>\n             <span class=\"n\">at</span> <span class=\"p\">.</span><span class=\"o\">/</span><span class=\"n\">compiler</span><span class=\"o\">/</span><span class=\"n\">build</span><span class=\"o\">/</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">link</span><span class=\"p\">.</span><span class=\"n\">rs</span><span class=\"p\">:</span><span class=\"mi\">1111</span><span class=\"p\">:</span><span class=\"mi\">27</span>\n   <span class=\"mi\">3</span><span class=\"p\">:</span> <span class=\"n\">roc_build</span><span class=\"p\">::</span><span class=\"n\">link</span><span class=\"p\">::</span><span class=\"n\">rebuild_host</span>\n             <span class=\"n\">at</span> <span class=\"p\">.</span><span class=\"o\">/</span><span class=\"n\">compiler</span><span class=\"o\">/</span><span class=\"n\">build</span><span class=\"o\">/</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">link</span><span class=\"p\">.</span><span class=\"n\">rs</span><span class=\"p\">:</span><span class=\"mi\">469</span><span class=\"p\">:</span><span class=\"mi\">9</span>\n   <span class=\"mi\">4</span><span class=\"p\">:</span> <span class=\"n\">roc_cli</span><span class=\"p\">::</span><span class=\"n\">build</span><span class=\"p\">::</span><span class=\"n\">spawn_rebuild_thread</span><span class=\"p\">::{{</span><span class=\"n\">closure</span><span class=\"p\">}}</span>\n             <span class=\"n\">at</span> <span class=\"p\">.</span><span class=\"o\">/</span><span class=\"n\">cli</span><span class=\"o\">/</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">build</span><span class=\"p\">.</span><span class=\"n\">rs</span><span class=\"p\">:</span><span class=\"mi\">326</span><span class=\"p\">:</span><span class=\"mi\">17</span>\n<span class=\"n\">note</span><span class=\"p\">:</span> <span class=\"n\">Some</span> <span class=\"n\">details</span> <span class=\"n\">are</span> <span class=\"n\">omitted</span><span class=\"p\">,</span> <span class=\"n\">run</span> <span class=\"n\">with</span> <span class=\"p\">`</span><span class=\"n\">RUST_BACKTRACE</span><span class=\"p\">=</span><span class=\"n\">full</span><span class=\"p\">`</span> <span class=\"k\">for</span> <span class=\"n\">a</span> <span class=\"n\">verbose</span> <span class=\"n\">backtrace</span><span class=\"p\">.</span>\n<span class=\"n\">thread</span> <span class=\"err\">'</span><span class=\"n\">main</span><span class=\"err\">'</span> <span class=\"n\">panicked</span> <span class=\"n\">at</span> <span class=\"err\">'</span><span class=\"n\">called</span> <span class=\"p\">`</span><span class=\"n\">Result</span><span class=\"p\">::</span><span class=\"n\">unwrap</span><span class=\"p\">()`</span> <span class=\"n\">on</span> <span class=\"n\">an</span> <span class=\"p\">`</span><span class=\"n\">Err</span><span class=\"p\">`</span> <span class=\"n\">value</span><span class=\"p\">:</span> <span class=\"nb\">Any</span> <span class=\"p\">{</span> <span class=\"p\">..</span> <span class=\"p\">}</span><span class=\"err\">'</span><span class=\"p\">,</span> <span class=\"n\">cli</span><span class=\"o\">/</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">build</span><span class=\"p\">.</span><span class=\"n\">rs</span><span class=\"p\">:</span><span class=\"mi\">233</span><span class=\"p\">:</span><span class=\"mi\">50</span>\n<span class=\"n\">stack</span> <span class=\"n\">backtrace</span><span class=\"p\">:</span>\n   <span class=\"mi\">0</span><span class=\"p\">:</span> <span class=\"n\">rust_begin_unwind</span>\n             <span class=\"n\">at</span> <span class=\"o\">/</span><span class=\"n\">rustc</span><span class=\"o\">/</span><span class=\"mi\">02072</span><span class=\"n\">b482a8b5357f7fb5e5637444ae30e423c40</span><span class=\"o\">/</span><span class=\"n\">library</span><span class=\"o\">/</span><span class=\"n\">std</span><span class=\"o\">/</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">panicking</span><span class=\"p\">.</span><span class=\"n\">rs</span><span class=\"p\">:</span><span class=\"mi\">498</span><span class=\"p\">:</span><span class=\"mi\">5</span>\n   <span class=\"mi\">1</span><span class=\"p\">:</span> <span class=\"n\">core</span><span class=\"p\">::</span><span class=\"n\">panicking</span><span class=\"p\">::</span><span class=\"n\">panic_fmt</span>\n             <span class=\"n\">at</span> <span class=\"o\">/</span><span class=\"n\">rustc</span><span class=\"o\">/</span><span class=\"mi\">02072</span><span class=\"n\">b482a8b5357f7fb5e5637444ae30e423c40</span><span class=\"o\">/</span><span class=\"n\">library</span><span class=\"o\">/</span><span class=\"n\">core</span><span class=\"o\">/</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">panicking</span><span class=\"p\">.</span><span class=\"n\">rs</span><span class=\"p\">:</span><span class=\"mi\">107</span><span class=\"p\">:</span><span class=\"mi\">14</span>\n   <span class=\"mi\">2</span><span class=\"p\">:</span> <span class=\"n\">core</span><span class=\"p\">::</span><span class=\"n\">result</span><span class=\"p\">::</span><span class=\"n\">unwrap_failed</span>\n             <span class=\"n\">at</span> <span class=\"o\">/</span><span class=\"n\">rustc</span><span class=\"o\">/</span><span class=\"mi\">02072</span><span class=\"n\">b482a8b5357f7fb5e5637444ae30e423c40</span><span class=\"o\">/</span><span class=\"n\">library</span><span class=\"o\">/</span><span class=\"n\">core</span><span class=\"o\">/</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">result</span><span class=\"p\">.</span><span class=\"n\">rs</span><span class=\"p\">:</span><span class=\"mi\">1613</span><span class=\"p\">:</span><span class=\"mi\">5</span>\n   <span class=\"mi\">3</span><span class=\"p\">:</span> <span class=\"n\">core</span><span class=\"p\">::</span><span class=\"n\">result</span><span class=\"p\">::</span><span class=\"n\">Result</span><span class=\"p\">&lt;</span><span class=\"n\">T</span><span class=\"p\">,</span><span class=\"n\">E</span><span class=\"p\">&gt;::</span><span class=\"n\">unwrap</span>\n             <span class=\"n\">at</span> <span class=\"o\">/</span><span class=\"n\">rustc</span><span class=\"o\">/</span><span class=\"mi\">02072</span><span class=\"n\">b482a8b5357f7fb5e5637444ae30e423c40</span><span class=\"o\">/</span><span class=\"n\">library</span><span class=\"o\">/</span><span class=\"n\">core</span><span class=\"o\">/</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">result</span><span class=\"p\">.</span><span class=\"n\">rs</span><span class=\"p\">:</span><span class=\"mi\">1295</span><span class=\"p\">:</span><span class=\"mi\">23</span>\n   <span class=\"mi\">4</span><span class=\"p\">:</span> <span class=\"n\">roc_cli</span><span class=\"p\">::</span><span class=\"n\">build</span><span class=\"p\">::</span><span class=\"n\">build_file</span>\n             <span class=\"n\">at</span> <span class=\"p\">.</span><span class=\"o\">/</span><span class=\"n\">cli</span><span class=\"o\">/</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">build</span><span class=\"p\">.</span><span class=\"n\">rs</span><span class=\"p\">:</span><span class=\"mi\">233</span><span class=\"p\">:</span><span class=\"mi\">28</span>\n   <span class=\"mi\">5</span><span class=\"p\">:</span> <span class=\"n\">roc_cli</span><span class=\"p\">::</span><span class=\"n\">build</span>\n             <span class=\"n\">at</span> <span class=\"p\">.</span><span class=\"o\">/</span><span class=\"n\">cli</span><span class=\"o\">/</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">lib</span><span class=\"p\">.</span><span class=\"n\">rs</span><span class=\"p\">:</span><span class=\"mi\">332</span><span class=\"p\">:</span><span class=\"mi\">27</span>\n   <span class=\"mi\">6</span><span class=\"p\">:</span> <span class=\"n\">roc</span><span class=\"p\">::</span><span class=\"n\">main</span>\n             <span class=\"n\">at</span> <span class=\"p\">.</span><span class=\"o\">/</span><span class=\"n\">cli</span><span class=\"o\">/</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">main</span><span class=\"p\">.</span><span class=\"n\">rs</span><span class=\"p\">:</span><span class=\"mi\">30</span><span class=\"p\">:</span><span class=\"mi\">21</span>\n   <span class=\"mi\">7</span><span class=\"p\">:</span> <span class=\"n\">core</span><span class=\"p\">::</span><span class=\"n\">ops</span><span class=\"p\">::</span><span class=\"n\">function</span><span class=\"p\">::</span><span class=\"n\">FnOnce</span><span class=\"p\">::</span><span class=\"n\">call_once</span>\n             <span class=\"n\">at</span> <span class=\"o\">/</span><span class=\"n\">rustc</span><span class=\"o\">/</span><span class=\"mi\">02072</span><span class=\"n\">b482a8b5357f7fb5e5637444ae30e423c40</span><span class=\"o\">/</span><span class=\"n\">library</span><span class=\"o\">/</span><span class=\"n\">core</span><span class=\"o\">/</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">ops</span><span class=\"o\">/</span><span class=\"n\">function</span><span class=\"p\">.</span><span class=\"n\">rs</span><span class=\"p\">:</span><span class=\"mi\">227</span><span class=\"p\">:</span><span class=\"mi\">5</span>\n</code></pre></div>",
        "id": 278163088,
        "sender_full_name": "Nikita Mounier",
        "timestamp": 1649337895
    },
    {
        "content": "<p>Okay I fixed the zig errors and I think it should actually work now. Can you pull and try?</p>",
        "id": 278164162,
        "sender_full_name": "Ayaz Hafiz",
        "timestamp": 1649338422
    },
    {
        "content": "<p>Yep, I'm not getting the zig-specific errors anymore (except in interactive/effects.roc which I forgot to mention up above) – I'm only getting the memory-related errors now from before</p>",
        "id": 278164834,
        "sender_full_name": "Nikita Mounier",
        "timestamp": 1649338708
    },
    {
        "content": "<p>Pushed compile error fixes for effects.roc now too, but there are segfaults there when you actually run it :)</p>",
        "id": 278164911,
        "sender_full_name": "Ayaz Hafiz",
        "timestamp": 1649338754
    },
    {
        "content": "<p>Are <code>arch</code> and <code>sw_vers</code> present under your <code>/usr/bin</code>?</p>",
        "id": 278165254,
        "sender_full_name": "Ayaz Hafiz",
        "timestamp": 1649338905
    },
    {
        "content": "<blockquote>\n<p>Are <code>arch</code> and <code>sw_vers</code> present under your <code>/usr/bin</code>?</p>\n</blockquote>\n<p>Yep!</p>",
        "id": 278169138,
        "sender_full_name": "Nikita Mounier",
        "timestamp": 1649340515
    },
    {
        "content": "<blockquote>\n<p>Pushed compile error fixes for effects.roc now too, but there are segfaults there when you actually run it :)</p>\n</blockquote>\n<p>Can confirm, same here.</p>",
        "id": 278169228,
        "sender_full_name": "Nikita Mounier",
        "timestamp": 1649340565
    },
    {
        "content": "<p>Is <code>/usr/bin</code> in your path? Your error with <code>cargo run examples/hello-world/helloWorld.roc</code> is presumably because <code>sw_vers</code> couldn't be run</p>",
        "id": 278169495,
        "sender_full_name": "Ayaz Hafiz",
        "timestamp": 1649340680
    },
    {
        "content": "<p>You're right that's my mistake --- my default shell is fish, but I forgot that nix uses bash, so had to update my .bashrc path.</p>",
        "id": 278177193,
        "sender_full_name": "Nikita Mounier",
        "timestamp": 1649343739
    },
    {
        "content": "<p>So I'm back to getting the same zig error as before (the <code>c_void</code>) one from up above, with the same stacktrace, in interactive/tui.roc and hello-world/helloWorld.roc (on <code>zig-platform</code>). Otherwise, everything else compiles very nicely! Just whenever I do some Stdin input (like on interactive/echo.roc), I get back a seg fault 11.</p>",
        "id": 278178251,
        "sender_full_name": "Nikita Mounier",
        "timestamp": 1649344094
    },
    {
        "content": "<p>I think <code>c_void</code> was just a change between zig 0.8.1 an 0.9.1. So the example probably hasn't been updated yet</p>",
        "id": 278178995,
        "sender_full_name": "Brendan Hansknecht",
        "timestamp": 1649344408
    },
    {
        "content": "<p>It is now <code>anyopaque</code></p>",
        "id": 278179014,
        "sender_full_name": "Brendan Hansknecht",
        "timestamp": 1649344417
    },
    {
        "content": "<p>It's been working like a charm, until just recently where whenever I try to do a <code>cargo build</code> or <code>cargo run</code>, it's unable to compile the <code>roc_cli</code> with:</p>\n<div class=\"codehilite\" data-code-language=\"Swift\"><pre><span></span><code><span class=\"n\">error</span><span class=\"p\">:</span> <span class=\"n\">linking</span> <span class=\"n\">with</span> <span class=\"p\">`</span><span class=\"n\">cc</span><span class=\"p\">`</span> <span class=\"n\">failed</span><span class=\"p\">:</span> <span class=\"n\">exit</span> <span class=\"n\">status</span><span class=\"p\">:</span> <span class=\"mi\">1</span>\n  <span class=\"o\">|</span>\n  <span class=\"p\">=</span> <span class=\"n\">note</span><span class=\"p\">:</span> <span class=\"s\">\"cc\"</span> <span class=\"s\">\"-arch\"</span> <span class=\"s\">\"arm64\"</span> <span class=\"p\">......</span>\n  <span class=\"p\">=</span> <span class=\"n\">note</span><span class=\"p\">:</span> <span class=\"n\">ld</span><span class=\"p\">:</span> <span class=\"n\">library</span> <span class=\"n\">not</span> <span class=\"n\">found</span> <span class=\"k\">for</span> <span class=\"o\">-</span><span class=\"n\">ltinfo</span>\n          <span class=\"n\">clang</span><span class=\"p\">:</span> <span class=\"n\">error</span><span class=\"p\">:</span> <span class=\"n\">linker</span> <span class=\"n\">command</span> <span class=\"n\">failed</span> <span class=\"n\">with</span> <span class=\"n\">exit</span> <span class=\"n\">code</span> <span class=\"mi\">1</span> <span class=\"p\">(</span><span class=\"n\">use</span> <span class=\"o\">-</span><span class=\"n\">v</span> <span class=\"n\">to</span> <span class=\"n\">see</span> <span class=\"n\">invocation</span><span class=\"p\">)</span>\n</code></pre></div>\n<p>I'm not sure why this error is popping up now, I don't think I changed anything or inadvertently removed a file. I downloaded a clean build of the repo and all, but to no avail --- same error.</p>",
        "id": 278214950,
        "sender_full_name": "Nikita Mounier",
        "timestamp": 1649359885
    },
    {
        "content": "<p>I've been looking around online to see how to fix the issue – I found this potential solution:</p>\n<div class=\"codehilite\" data-code-language=\"Swift\"><pre><span></span><code><span class=\"n\">cd</span> <span class=\"o\">/</span><span class=\"n\">usr</span><span class=\"o\">/</span><span class=\"n\">lib</span>\n<span class=\"n\">ln</span> <span class=\"o\">-</span><span class=\"n\">s</span> <span class=\"n\">libncurses</span><span class=\"p\">.</span><span class=\"n\">so</span><span class=\"p\">.</span><span class=\"mi\">5</span> <span class=\"n\">libtinfo</span><span class=\"p\">.</span><span class=\"n\">so</span><span class=\"p\">.</span><span class=\"mi\">5</span>\n<span class=\"n\">ln</span> <span class=\"o\">-</span><span class=\"n\">s</span> <span class=\"n\">libtinfo</span><span class=\"p\">.</span><span class=\"n\">so</span><span class=\"p\">.</span><span class=\"mi\">5</span> <span class=\"n\">libtinfo</span><span class=\"p\">.</span><span class=\"n\">so</span>\n</code></pre></div>\n<p>What do you think?</p>",
        "id": 278345847,
        "sender_full_name": "Nikita Mounier",
        "timestamp": 1649443405
    },
    {
        "content": "<p>what does “which cc” say?</p>",
        "id": 278345983,
        "sender_full_name": "Ayaz Hafiz",
        "timestamp": 1649443463
    },
    {
        "content": "<div class=\"codehilite\" data-code-language=\"Swift\"><pre><span></span><code><span class=\"o\">/</span><span class=\"n\">usr</span><span class=\"o\">/</span><span class=\"n\">bin</span><span class=\"o\">/</span><span class=\"n\">cc</span>\n</code></pre></div>",
        "id": 278347251,
        "sender_full_name": "Nikita Mounier",
        "timestamp": 1649444109
    },
    {
        "content": "<p>Is it as simple as me have some libraries missing from my PATH?</p>",
        "id": 278347487,
        "sender_full_name": "Nikita Mounier",
        "timestamp": 1649444214
    },
    {
        "content": "<p>I think you want the <code>cc</code> from nix. If you updated your bashrc, maybe you want to add <code>/usr/bin</code> to the back of the path rather than the front?</p>",
        "id": 278347737,
        "sender_full_name": "Ayaz Hafiz",
        "timestamp": 1649444328
    },
    {
        "content": "<p>btw that branch should be a lot more usable now, basically everything besides the wasm backend seems to at least work</p>",
        "id": 278347973,
        "sender_full_name": "Folkert de Vries",
        "timestamp": 1649444417
    },
    {
        "content": "<p>there are some tricky memory-related issues still, but those won't come up often if you're just playing around</p>",
        "id": 278348033,
        "sender_full_name": "Folkert de Vries",
        "timestamp": 1649444435
    },
    {
        "content": "<blockquote>\n<p>If you updated your bashrc, maybe you want to add <code>/usr/bin</code> to the back of the path rather than the front?</p>\n</blockquote>\n<p>I actually ended up downloading a plugin that lets me use fish with nix. Weird thing is, all of the nix-related things like <code>/Users/nikitamounier/.nix-profile/bin</code> are already at the front path. <br>\nHere's my PATH for reference:</p>\n<div class=\"codehilite\" data-code-language=\"Swift\"><pre><span></span><code><span class=\"o\">/</span><span class=\"n\">nix</span><span class=\"o\">/</span><span class=\"kd\">var</span><span class=\"o\">/</span><span class=\"n\">nix</span><span class=\"o\">/</span><span class=\"n\">profiles</span><span class=\"o\">/</span><span class=\"k\">default</span><span class=\"o\">/</span><span class=\"n\">bin</span> <span class=\"o\">/</span><span class=\"n\">Users</span><span class=\"o\">/</span><span class=\"n\">nikitamounier</span><span class=\"o\">/</span><span class=\"p\">.</span><span class=\"n\">nix</span><span class=\"o\">-</span><span class=\"n\">profile</span><span class=\"o\">/</span><span class=\"n\">bin</span> <span class=\"o\">/</span><span class=\"n\">usr</span><span class=\"o\">/</span><span class=\"n\">bin</span> <span class=\"o\">/</span><span class=\"n\">opt</span><span class=\"o\">/</span><span class=\"n\">homebrew</span><span class=\"o\">/</span><span class=\"n\">opt</span><span class=\"o\">/</span><span class=\"n\">libpq</span><span class=\"o\">/</span><span class=\"n\">bin</span> <span class=\"o\">/</span><span class=\"n\">opt</span><span class=\"o\">/</span><span class=\"n\">homebrew</span><span class=\"o\">/</span><span class=\"n\">opt</span><span class=\"o\">/</span><span class=\"n\">llvm</span><span class=\"p\">@</span><span class=\"mi\">12</span><span class=\"o\">/</span><span class=\"n\">bin</span> <span class=\"o\">/</span><span class=\"n\">usr</span><span class=\"o\">/</span><span class=\"n\">local</span><span class=\"o\">/</span><span class=\"n\">bin</span> <span class=\"o\">/</span><span class=\"n\">Users</span><span class=\"o\">/</span><span class=\"n\">nikitamounier</span><span class=\"o\">/</span><span class=\"p\">.</span><span class=\"n\">cargo</span><span class=\"o\">/</span><span class=\"n\">bin</span> <span class=\"o\">/</span><span class=\"n\">opt</span><span class=\"o\">/</span><span class=\"n\">homebrew</span><span class=\"o\">/</span><span class=\"n\">bin</span> <span class=\"c1\">//opt/homebrew/bin /Users/nikitamounier/.fig/bin /Users/nikitamounier/.fzf/bin /bin /usr/sbin /sbin /opt/X11/bin /Library/Apple/usr/bin /Library/TeX/texbin /Applications/kitty.app/Contents/MacOS</span>\n</code></pre></div>",
        "id": 278350269,
        "sender_full_name": "Nikita Mounier",
        "timestamp": 1649445517
    },
    {
        "content": "<p>Are you in a <code>nix-shell</code>?</p>",
        "id": 278350974,
        "sender_full_name": "Ayaz Hafiz",
        "timestamp": 1649445905
    },
    {
        "content": "<p>In my nix shell I see a bunch of opaque paths to stuff in <code>nix/store</code> at the front of my path</p>",
        "id": 278351038,
        "sender_full_name": "Ayaz Hafiz",
        "timestamp": 1649445954
    },
    {
        "content": "<p><span aria-label=\"face palm\" class=\"emoji emoji-1f926\" role=\"img\" title=\"face palm\">:face_palm:</span> Forgot that nix-shell has a different PATH. Attempting to move <code>usr/bin</code> to the end of the path, but fish is giving me a weirdly difficult time...</p>",
        "id": 278354847,
        "sender_full_name": "Nikita Mounier",
        "timestamp": 1649447880
    },
    {
        "content": "<p>You were right! I was able to finally get the <code>usr/bin</code> to move at the end of PATH, and now it all works. Maybe someone could add to BUILDING_FROM_SOURCE.md that people using nix-shell should do this? I'll be happy to open a PR</p>",
        "id": 278356419,
        "sender_full_name": "Nikita Mounier",
        "timestamp": 1649448767
    },
    {
        "content": "<p>Feel free to send a PR! All your insights here would be valuable.</p>",
        "id": 278357057,
        "sender_full_name": "Ayaz Hafiz",
        "timestamp": 1649449089
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"281543\">Folkert de Vries</span> <a href=\"#narrow/stream/231634-beginners/topic/building.20from.20source/near/278347973\">said</a>:</p>\n<blockquote>\n<p>btw that branch should be a lot more usable now, basically everything besides the wasm backend seems to at least work</p>\n</blockquote>\n<p>Sounds good! Yeah, looks like <code>Stdin</code> still doesn't work for me (getting a SIGSEGV), I guess I'll try to avoid that for now. Everything else works like a charm though!</p>",
        "id": 278364049,
        "sender_full_name": "Nikita Mounier",
        "timestamp": 1649452963
    },
    {
        "content": "<p>Actually, it's only the effects-platform and the cli-platform (from examples/interactive) that segfault on user input, the rest work great!</p>",
        "id": 278375162,
        "sender_full_name": "Nikita Mounier",
        "timestamp": 1649461753
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"343810\">Brendan Hansknecht</span> <a href=\"#narrow/stream/231634-beginners/topic/building.20from.20source/near/278113579\">said</a>:</p>\n<blockquote>\n<p>The zig 0.9.1 branch isn't fully working, but <span class=\"user-mention silent\" data-user-id=\"492598\">Nikita Mounier</span>  can you check if you can at least build the compiler on the <code>update_zig_09</code> branch? (please <code>git pull</code> I just pushed a change to it)</p>\n</blockquote>\n<p>I see the <a href=\"https://github.com/rtfeldman/roc/pull/2268\">Update to Zig 0.9 PR</a> doesn't say WIP anymore – so this will merge with trunk/upstream soon?</p>",
        "id": 278963853,
        "sender_full_name": "Nikita Mounier",
        "timestamp": 1649942030
    },
    {
        "content": "<p>yeah, likely somewhere in the next 14 days</p>",
        "id": 278964061,
        "sender_full_name": "Folkert de Vries",
        "timestamp": 1649942127
    },
    {
        "content": "<p>merging it is disruptive because everyone needs to get a new zig + llvm version</p>",
        "id": 278964087,
        "sender_full_name": "Folkert de Vries",
        "timestamp": 1649942144
    },
    {
        "content": "<p>so we don't want to do that before Richard records his demo, but soon after probably</p>",
        "id": 278964160,
        "sender_full_name": "Folkert de Vries",
        "timestamp": 1649942165
    },
    {
        "content": "<p>Gotcha!</p>",
        "id": 278964207,
        "sender_full_name": "Nikita Mounier",
        "timestamp": 1649942194
    },
    {
        "content": "<p>Yeah I guess it'll be a smoother experience for those of us who are on <code>nix-shell</code></p>",
        "id": 278964262,
        "sender_full_name": "Nikita Mounier",
        "timestamp": 1649942220
    },
    {
        "content": "<p>yeah and in general the upgrade process is a lot smoother now than it was in the past. We know (kinda) what we're doing now</p>",
        "id": 278964684,
        "sender_full_name": "Folkert de Vries",
        "timestamp": 1649942423
    },
    {
        "content": "<p>but still, it's complex and we want to time it right</p>",
        "id": 278964703,
        "sender_full_name": "Folkert de Vries",
        "timestamp": 1649942432
    },
    {
        "content": "<p>Trying to build Roc from GitHub repo sources on Ubuntu 20.04 running inside WSL (not WSL2). </p>\n<p>Ran into this issue on trying to run nix-shell:</p>\n<div class=\"codehilite\" data-code-language=\"Bash Session\"><pre><span></span><code><span class=\"go\">Build with /nix/store/m0xw42nwrlfznfasiqfzwdavi4421x32-ghc-8.10.7.</span>\n<span class=\"go\">ghc-pkg: Couldn't open database /tmp/nix-build-niv-0.2.19.drv-0/setup-package.conf.d for modification: {handle: /tmp/nix-build-niv-0.2.19.drv-0/setup-package.conf.d/package.cache.lock}: hLock: invalid argument (Invalid argument)</span>\n<span class=\"go\">error: builder for '/nix/store/k5cy1lsddvq61hni78jdfyls8rf2ybsk-niv-0.2.19.drv' failed with exit code 1</span>\n<span class=\"go\">error: build of '/nix/store/10p69ddbzjzbln6zhpkxlgywlqm6ax3w-zig-0.8.1.drv', '/nix/store/ac6vy5ly0is5xr7jnhabr2kd975gvi6p-debugir.drv', '/nix/store/k5cy1lsddvq61hni78jdfyls8rf2ybsk-niv-0.2.19.drv' failed</span>\n</code></pre></div>\n<p>Have you seen this error before?</p>\n<p>Seems like this issue: <a href=\"https://github.com/NixOS/nixpkgs/issues/79441\">https://github.com/NixOS/nixpkgs/issues/79441</a></p>",
        "id": 279038513,
        "sender_full_name": "Viktor Ferenczi",
        "timestamp": 1649983379
    },
    {
        "content": "<p>Arm?</p>",
        "id": 279039036,
        "sender_full_name": "Brendan Hansknecht",
        "timestamp": 1649983935
    },
    {
        "content": "<p>Just a regular 64 bit Windows on a Ryzen 7 3800X (x86) CPU.</p>",
        "id": 279074245,
        "sender_full_name": "Viktor Ferenczi",
        "timestamp": 1650024170
    },
    {
        "content": "<p>We also have a flake.nix file, can you give <a href=\"https://nixos.wiki/wiki/Flakes\">that</a> a try?</p>",
        "id": 279074886,
        "sender_full_name": "Anton",
        "timestamp": 1650024806
    },
    {
        "content": "<p>I'm installing Roc on a new installation of Ubuntu 20.04. Installed nix and all the packages. But now I keep getting this error. Any ideas how to fix it?</p>\n<div class=\"codehilite\"><pre><span></span><code>[nix-shell:~/code/roc]$ nix rebuild\nnix: /nix/store/nprym6lf8lzhp1irb42lb4vp8069l5rj-glibc-2.32-54/lib/libc.so.6: version `GLIBC_2.33&#39; not found (required by /nix/store/dd8swlwhpdhn6bv219562vyxhi8278hs-gcc-10.3.0-lib/lib/libstdc++.so.6)\n</code></pre></div>",
        "id": 279740076,
        "sender_full_name": "Brian Carroll",
        "timestamp": 1650575229
    },
    {
        "content": "<p>Actually I still seem to be able to run <code>cargo</code> and things, so it doesn't seem to be really blocking me</p>",
        "id": 279741131,
        "sender_full_name": "Brian Carroll",
        "timestamp": 1650575855
    },
    {
        "content": "<p>OK this is actually blocking me for some commands</p>\n<div class=\"codehilite\"><pre><span></span><code>[nix-shell:~/code/roc]$ perf record target/debug/roc build examples/false-interpreter/False.roc\n/bin/bash: /nix/store/wgp4l0jl7hm510x5615qsv4xikybzqb3-ncurses-6.2/lib/libtinfo.so.6: no version information available (required by /bin/bash)\n/bin/bash: /lib/x86_64-linux-gnu/libc.so.6: version `GLIBC_2.33&#39; not found (required by /nix/store/wgp4l0jl7hm510x5615qsv4xikybzqb3-ncurses-6.2/lib/libtinfo.so.6)\n</code></pre></div>",
        "id": 279783866,
        "sender_full_name": "Brian Carroll",
        "timestamp": 1650608203
    },
    {
        "content": "<p>Anyone else using Ubuntu 20.04 with nix? Have you seen anything like this? Did you solve it?</p>",
        "id": 279784129,
        "sender_full_name": "Brian Carroll",
        "timestamp": 1650608511
    },
    {
        "content": "<p>You can use the flake.nix:</p>\n<ul>\n<li><a href=\"https://nixos.wiki/wiki/Flakes\">install flakes</a> (see Non-NixOS)</li>\n<li>reboot</li>\n<li>At the root of the repo in a terminal use <code>nix develop</code> (instead of nix-shell)</li>\n</ul>\n<p>building will spam a different ncurses message but as far as I could tell that one does not affect anything.</p>",
        "id": 279787185,
        "sender_full_name": "Anton",
        "timestamp": 1650611347
    },
    {
        "content": "<p>Hi! I am having trouble compiling from source in an ubuntu VM running on an M1 mac.</p>\n<ol>\n<li>I run into an error when I try <code>nix develop</code>which said:</li>\n</ol>\n<div class=\"codehilite\" data-code-language=\"error\"><pre><span></span><code>       Did you mean devShell?\n</code></pre></div>\n<p>I solved this by adding \"aarch64-linux\" to the supportedSystems in the flake.nix file.</p>\n<ol start=\"2\">\n<li>I then run into more trouble when doing <code>cargo  run help</code>and <code>cargo build</code>which says:</li>\n</ol>\n<div class=\"codehilite\" data-code-language=\"error\"><pre><span></span><code>   --&gt; crates/linker/src/lib.rs:505:65\n    |\n505 | ...                   let c_str = unsafe { CStr::from_ptr(str_bytes.as_ptr() as *const i8) };\n    |                                                           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ expected `u8`, found `i8`\n    |\n    = note: expected raw pointer `*const u8`\n               found raw pointer `*const i8`\n\nerror[E0308]: mismatched types\n    --&gt; crates/linker/src/lib.rs:1811:40\n     |\n1811 |             let c_buf: *const c_char = dynstr_data[dynstr_off..].as_ptr() as *const i8;\n     |                        -------------   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ expected `u8`, found `i8`\n     |                        |\n     |                        expected due to this\n     |\n     = note: expected raw pointer `*const u8`\n                found raw pointer `*const i8`\n\nFor more information about this error, try `rustc --explain E0308`.\nerror: could not compile `roc_linker` due to 2 previous errors\nwarning: build failed, waiting for other jobs to finish...\n</code></pre></div>\n<p>Has anyone seen this before? it is a type mismatch from the linker, so this should have come up before right?<br>\nI installed everything from scratch following the build from source file. <br>\nMy system is updated.<br>\nCould it be related to the issues with the silicon-Mac platform? Or versioning of some of the required libraries?</p>",
        "id": 293177652,
        "sender_full_name": "Eric Guedes Pinto",
        "timestamp": 1660331867
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"521508\">Eric Guedes Pinto</span> has marked this topic as resolved.</p>",
        "id": 293177875,
        "sender_full_name": "Notification Bot",
        "timestamp": 1660331929
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"521508\">Eric Guedes Pinto</span> has marked this topic as unresolved.</p>",
        "id": 293178076,
        "sender_full_name": "Notification Bot",
        "timestamp": 1660332003
    },
    {
        "content": "<p>Hi eric, we do not (yet?) support the aarch64-linux platform. You should be able to run on macos aarch64 though.</p>",
        "id": 293178217,
        "sender_full_name": "Anton",
        "timestamp": 1660332043
    },
    {
        "content": "<p>Ok, I'll do that<br>\nThanks</p>",
        "id": 293178334,
        "sender_full_name": "Eric Guedes Pinto",
        "timestamp": 1660332090
    },
    {
        "content": "<p>The first error you got was not very clear, I'll make an issue for that.</p>",
        "id": 293180899,
        "sender_full_name": "Anton",
        "timestamp": 1660333032
    },
    {
        "content": "<p>Oh, the second issue is a bug I have run into before and keep forgetting to fix. We just need to update some types as the error says.</p>",
        "id": 293191863,
        "sender_full_name": "Brendan Hansknecht",
        "timestamp": 1660337874
    },
    {
        "content": "<p>I developed that on x86, but didn't think about generic types because char is unsigned on some platforms and signed on others.</p>",
        "id": 293191976,
        "sender_full_name": "Brendan Hansknecht",
        "timestamp": 1660337912
    },
    {
        "content": "<p>Should be an easy fix, I just am traveling and can't deal with it currently.</p>",
        "id": 293192022,
        "sender_full_name": "Brendan Hansknecht",
        "timestamp": 1660337935
    },
    {
        "content": "<p>Hello, I am trying to build Roc from the latest commit on main on Windows, and it fails trying to link the symbols defined in roc_std.<br>\n<a href=\"https://github.com/roc-lang/roc/blob/38a7b6cef0efa339af5d6bed25dfd45f2163f682/crates/roc_std/src/lib.rs#L25-L32\">https://github.com/roc-lang/roc/blob/38a7b6cef0efa339af5d6bed25dfd45f2163f682/crates/roc_std/src/lib.rs#L25-L32</a><br>\nThis has happened with both the MSVC linker, and with LLD. I am not very familiar with linker failure modes so some guidance would be appreciated.</p>\n<p>The specific error is:</p>\n<div class=\"codehilite\"><pre><span></span><code>note: lld: error: undefined symbol: roc_alloc\n          &gt;&gt;&gt; referenced by C:\\Users\\RossSmyth\\Documents\\roc\\crates\\roc_std\\src\\lib.rs:51\n          &gt;&gt;&gt;               libroc_std-c05e5e25b8ffcb50.rlib(roc_std-c05e5e25b8ffcb50.46ifwog7cqzs4dpa.rcgu.o):(roc_std::roc_alloc_refcounted_help::h08260161a777fba6)\n</code></pre></div>\n<p>repeated for roc_dealloc and roc_realloc but with different object names.</p>\n<div class=\"codehilite\"><pre><span></span><code>error: could not compile `roc_load` due to previous error\n</code></pre></div>\n<p>After the undefined symbol error.</p>",
        "id": 293336573,
        "sender_full_name": "Ross Smyth",
        "timestamp": 1660443093
    },
    {
        "content": "<p>Windows support is very new <span aria-label=\"sweat smile\" class=\"emoji emoji-1f605\" role=\"img\" title=\"sweat smile\">:sweat_smile:</span></p>\n<p><span class=\"user-mention\" data-user-id=\"281543\">@Folkert de Vries</span> is this a known issue?</p>",
        "id": 293338041,
        "sender_full_name": "Richard Feldman",
        "timestamp": 1660445208
    },
    {
        "content": "<p>I'll need some more info here. What are you trying to build (what is the command) and where exactly does it fail?</p>",
        "id": 293381132,
        "sender_full_name": "Folkert de Vries",
        "timestamp": 1660481817
    },
    {
        "content": "<p>and yeah the status of windows is:  I got it to work once on one machine a little while ago</p>",
        "id": 293381184,
        "sender_full_name": "Folkert de Vries",
        "timestamp": 1660481852
    },
    {
        "content": "<ol>\n<li>git clone</li>\n<li>Put the LLVM archive file noted in the docs in <code>LLVM_SYS_130_PREFIX</code></li>\n<li>Put the LLVM archive bin directory in PATH</li>\n<li>cargo install bindgen</li>\n<li><code>cd roc</code></li>\n<li>\n<p>git pull<br>\n(for MSVC linker)</p>\n</li>\n<li>\n<p><code>cargo +1.61.0-msvc build</code><br>\n(For LLD)</p>\n</li>\n<li>\n<p><code>$Env:RUSTFLAGS = \"-Clinker=lld\"</code></p>\n</li>\n<li>\n<p><code>cargo +1.61.0-msvc build</code><br>\n(Both, but LLD's error message is much clearer. both have same missing symbols though)</p>\n</li>\n<li>\n<p>Gets to building 416/434 crates (on roc_load) and fails with message above.</p>\n</li>\n</ol>",
        "id": 293428414,
        "sender_full_name": "Ross Smyth",
        "timestamp": 1660500445
    },
    {
        "content": "<p>hmm, ok</p>",
        "id": 293428510,
        "sender_full_name": "Folkert de Vries",
        "timestamp": 1660500511
    },
    {
        "content": "<p>do you know how to set environment variables? (I didn't really)</p>",
        "id": 293428528,
        "sender_full_name": "Folkert de Vries",
        "timestamp": 1660500534
    },
    {
        "content": "<p>Yeah, that's the <code>$Env:RUSTFLAGS = \"-Clinker=lld\"</code></p>",
        "id": 293428563,
        "sender_full_name": "Ross Smyth",
        "timestamp": 1660500560
    },
    {
        "content": "<p>we recently added a flag <code>ROC_SKIP_SUBS_CACHE=1 cargo run</code> that should at least make that part work</p>",
        "id": 293428575,
        "sender_full_name": "Folkert de Vries",
        "timestamp": 1660500574
    },
    {
        "content": "<p>in powershell at least. In cmd you use <code>set RUSTFLAGS = -Clinker=lld</code></p>",
        "id": 293428598,
        "sender_full_name": "Ross Smyth",
        "timestamp": 1660500595
    },
    {
        "content": "<p>Alrigth I'll try it</p>",
        "id": 293428671,
        "sender_full_name": "Ross Smyth",
        "timestamp": 1660500626
    },
    {
        "content": "<p>Still fails, same location and error. Watching it closely as it is building it seems to fail specifically in the roc_load <a href=\"http://build.rs\">build.rs</a>. I did do <code>cargo +1.61.0-msvc clean</code>to be safe as well.</p>",
        "id": 293429251,
        "sender_full_name": "Ross Smyth",
        "timestamp": 1660501053
    },
    {
        "content": "<p>ok, that is weird and different from what I got</p>",
        "id": 293429746,
        "sender_full_name": "Folkert de Vries",
        "timestamp": 1660501409
    },
    {
        "content": "<p>or, well, maybe not</p>",
        "id": 293429763,
        "sender_full_name": "Folkert de Vries",
        "timestamp": 1660501430
    },
    {
        "content": "<p>so, basically, we want that <a href=\"http://build.rs\">build.rs</a> script to do nothing</p>",
        "id": 293429850,
        "sender_full_name": "Folkert de Vries",
        "timestamp": 1660501471
    },
    {
        "content": "<p>the thing is, msvc on windows does not seem to do dead code elimination, so those function, that are not used, still need to be there on windows for some reason</p>",
        "id": 293429890,
        "sender_full_name": "Folkert de Vries",
        "timestamp": 1660501503
    },
    {
        "content": "<p>it is weird that lld also needs them to be there. But maybe this is really a windows-specific thing</p>",
        "id": 293429898,
        "sender_full_name": "Folkert de Vries",
        "timestamp": 1660501519
    },
    {
        "content": "<p>I pushed some changes to the <code>disable-subs-caching-windows</code>, can you try that?</p>",
        "id": 293430269,
        "sender_full_name": "Folkert de Vries",
        "timestamp": 1660501854
    },
    {
        "content": "<p>hope that compiles, but I hope the idea is clear from <a href=\"https://github.com/roc-lang/roc/compare/disable-subs-caching-windows\">https://github.com/roc-lang/roc/compare/disable-subs-caching-windows</a>: we want to make sure the business logic just does not run on windows</p>",
        "id": 293430303,
        "sender_full_name": "Folkert de Vries",
        "timestamp": 1660501894
    },
    {
        "content": "<p>or actually, it's not even there on windows. That's really the important part</p>",
        "id": 293430312,
        "sender_full_name": "Folkert de Vries",
        "timestamp": 1660501911
    },
    {
        "content": "<p>I nuked my repo and recloned it just to be extra safe, checked out that branch, and same error. It is ignoring them because I get the \"unused...\" warnings, for example \"warning: constant is never used: <code>SKIP_SUBS_CACHE</code>\"</p>\n<p>I then tried to build it in release (<code>cargo +1.61.0 build --release</code>) since LTO is on in release mode. There are spurious other linker failures in Zig in release before the failure above. Seems to do with file locking? But on a \"good \" run it still hit the failure above.</p>\n<p>My next train of thought was maybe some weird parallel compilation race condition was messing things up, so I attempted to build with <code>cargo +1.61.0-msvc build -j 0</code>. Same failure.</p>",
        "id": 293436526,
        "sender_full_name": "Ross Smyth",
        "timestamp": 1660506532
    },
    {
        "content": "<p>ok well you should now be able to just comment pretty much all of that <a href=\"http://build.rs\">build.rs</a> away</p>",
        "id": 293437835,
        "sender_full_name": "Folkert de Vries",
        "timestamp": 1660507468
    },
    {
        "content": "<p>and yes on windows for now at least you'll get a bunch of unused warnings in many places.</p>",
        "id": 293437869,
        "sender_full_name": "Folkert de Vries",
        "timestamp": 1660507494
    },
    {
        "content": "<p>I just deleted the build file and roc_load finally built! But now the same error some from both roc_cli and roc_docs_cli <span aria-label=\"sad\" class=\"emoji emoji-2639\" role=\"img\" title=\"sad\">:sad:</span></p>",
        "id": 293438461,
        "sender_full_name": "Ross Smyth",
        "timestamp": 1660507835
    },
    {
        "content": "<p>here's a new good first issue involving the repl! <a href=\"https://github.com/roc-lang/roc/issues/3793\">https://github.com/roc-lang/roc/issues/3793</a></p>",
        "id": 293440029,
        "sender_full_name": "Richard Feldman",
        "timestamp": 1660509021
    },
    {
        "content": "<p>if anyone is interested in picking it up, we'd be happy to help you get started on it!</p>",
        "id": 293440065,
        "sender_full_name": "Richard Feldman",
        "timestamp": 1660509058
    },
    {
        "content": "<p>yeah, you can disable that by removing it from the top-level <code>Cargo.toml</code></p>",
        "id": 293441862,
        "sender_full_name": "Folkert de Vries",
        "timestamp": 1660510762
    },
    {
        "content": "<p>and then you have something that works</p>",
        "id": 293441865,
        "sender_full_name": "Folkert de Vries",
        "timestamp": 1660510770
    },
    {
        "content": "<p>That \"worked\" with some further modification. I'll write up something in an issue.</p>",
        "id": 293445447,
        "sender_full_name": "Ross Smyth",
        "timestamp": 1660514823
    },
    {
        "content": "<p><a href=\"https://github.com/roc-lang/roc/issues/3805\">https://github.com/roc-lang/roc/issues/3805</a></p>",
        "id": 293448548,
        "sender_full_name": "Ross Smyth",
        "timestamp": 1660518711
    },
    {
        "content": "<p>I don't have much experience in git PRs nor much with Rust, but this seems very approachable. Where could I get started on it? (i also need to get my nix environment set up for the latest version of the compiler, but that's a different issue)</p>",
        "id": 293451155,
        "sender_full_name": "Thomas Dwyer",
        "timestamp": 1660522243
    },
    {
        "content": "<p>Awesome! Two places where the change would need to be made are at <a href=\"https://github.com/roc-lang/roc/blob/603f6b6613d7d8380a5690700918a3e64b5ae013/crates/repl_eval/src/eval.rs#L337-L345\">https://github.com/roc-lang/roc/blob/603f6b6613d7d8380a5690700918a3e64b5ae013/crates/repl_eval/src/eval.rs#L337-L345</a> and <a href=\"https://github.com/roc-lang/roc/blob/603f6b6613d7d8380a5690700918a3e64b5ae013/crates/repl_eval/src/eval.rs#L548-L552\">https://github.com/roc-lang/roc/blob/603f6b6613d7d8380a5690700918a3e64b5ae013/crates/repl_eval/src/eval.rs#L548-L552</a> - that's where we read back a string from the memory of the Roc code executed in the repl, and build up the AST representation of the string expression, which is then printed out. We'll want to change the <code>StrLiteral</code> variant used in the cases where the string is multi-line.</p>\n<p>The tests for the repl live in <a href=\"https://github.com/roc-lang/roc/blob/main/crates/repl_test/src/tests.rs\">https://github.com/roc-lang/roc/blob/main/crates/repl_test/src/tests.rs</a> - before you run them, you'll need to build the roc cli (<code>cargo build -p roc_cli</code>).</p>",
        "id": 293452362,
        "sender_full_name": "Ayaz Hafiz",
        "timestamp": 1660523823
    },
    {
        "content": "<p>Building everything works currently, but i run those tests after building the cli and i get a complaint about not finding GLIBC_2.34 for wasm3-sys. Checking the chat history here and on the issues page says using flakes solves this, but i <em>am</em> using flakes. My system libc version is 2.33 but in the nix develop environment it is 2.34. Any ideas? (This should be moved to <a class=\"stream-topic\" data-stream-id=\"231634\" href=\"/#narrow/stream/231634-beginners/topic/building.20from.20source\">#beginners &gt; building from source</a> )</p>",
        "id": 293455502,
        "sender_full_name": "Thomas Dwyer",
        "timestamp": 1660528132
    },
    {
        "content": "<p>5 messages were moved here from <a class=\"stream-topic\" data-stream-id=\"316715\" href=\"/#narrow/stream/316715-contributing/topic/good.20first.20issues\">#contributing &gt; good first issues</a> by <span class=\"user-mention silent\" data-user-id=\"281383\">Richard Feldman</span>.</p>",
        "id": 293456280,
        "sender_full_name": "Notification Bot",
        "timestamp": 1660529230
    },
    {
        "content": "<p>Hi <span class=\"user-mention\" data-user-id=\"484835\">@Thomas Dwyer</span>, I'll try to look at your issue today. Can you tell me the exact sequence of commands you ran?</p>",
        "id": 293489841,
        "sender_full_name": "Anton",
        "timestamp": 1660555742
    },
    {
        "content": "<p>well i entered the nix shell with <code>nix develop</code>, built the roc cli using <code>cargo build -p roc_cli</code>, then simply ran <code>cargo test repl_test</code> (<code>cargo test</code> has the same issue). i get the following error: <br>\n<a href=\"/user_uploads/22008/SVw7g01crPgF1Rc-0f6YFNLr/image.png\">image.png</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/22008/SVw7g01crPgF1Rc-0f6YFNLr/image.png\" title=\"image.png\"><img src=\"/user_uploads/22008/SVw7g01crPgF1Rc-0f6YFNLr/image.png\"></a></div>",
        "id": 293490208,
        "sender_full_name": "Thomas Dwyer",
        "timestamp": 1660555928
    },
    {
        "content": "<p>Thanks <span class=\"user-mention\" data-user-id=\"484835\">@Thomas Dwyer</span>, I'll see if I can reproduce that.</p>",
        "id": 293490869,
        "sender_full_name": "Anton",
        "timestamp": 1660556298
    },
    {
        "content": "<p>I failed to reproduce this on NixOS, can you tell me what operating system you are on <span class=\"user-mention\" data-user-id=\"484835\">@Thomas Dwyer</span>?</p>",
        "id": 293494435,
        "sender_full_name": "Anton",
        "timestamp": 1660558207
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"361169\">@Anton</span> I am running WSL2 under my windows 10 pc. This is a single user nix installation.</p>",
        "id": 293565120,
        "sender_full_name": "Thomas Dwyer",
        "timestamp": 1660579666
    },
    {
        "content": "<p>I will try to reproduce that with the same setup this week, hopefully tomorrow.</p>",
        "id": 293569235,
        "sender_full_name": "Anton",
        "timestamp": 1660581010
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"484835\">@Thomas Dwyer</span> can you try <code>nix develop</code> followed by <code>cargo clean</code> and <code>cargo build</code>? Doing that fixed it for someone else with a very similar error.</p>",
        "id": 294513234,
        "sender_full_name": "Anton",
        "timestamp": 1661064269
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"361169\">@Anton</span> Thank you, that works! really strange! Perhaps there should be a troubleshooting section in the installation file for cases like this. Nix is a strange beast for many people (including me), so we should aim to make its use as simple as possible. I really do wonder <em>why</em> nix was doing this, but I'm not too bothered now that it's solved.</p>",
        "id": 294568760,
        "sender_full_name": "Thomas Dwyer",
        "timestamp": 1661104199
    },
    {
        "content": "<p>Generally that happens when you build outside of nix and that pulls in the system Glibc then nix breaks due to linking to object files with the wrong glibc.</p>",
        "id": 294569121,
        "sender_full_name": "Brendan Hansknecht",
        "timestamp": 1661104446
    },
    {
        "content": "<p>Yes indeed, simply put it's because you probably did <code>cargo build</code> without doing <code>nix develop</code> first. I will mention this in BUILDING_FROM_SOURCE and create an issue for it so people can also find it that way.</p>",
        "id": 294616320,
        "sender_full_name": "Anton",
        "timestamp": 1661151469
    },
    {
        "content": "<p>When running <code>nix develop</code>, I get an error linking debugir. Does this sound like an issue with my Nix setup or somerhing else? (WSL2, Ubuntu 22.04). Happy to share logs if that would be helpful.</p>",
        "id": 295828104,
        "sender_full_name": "Bryce Miller",
        "timestamp": 1661773783
    },
    {
        "content": "<p>Hi <span class=\"user-mention\" data-user-id=\"522634\">@Bryce Miller</span>, that is unexpected. A detailed error message and logs would indeed be very helpful.</p>",
        "id": 295944763,
        "sender_full_name": "Anton",
        "timestamp": 1661789125
    },
    {
        "content": "<p>I'm also setting up a 22.04 virtual machine, the error did not reproduce on 20.04.</p>",
        "id": 295945436,
        "sender_full_name": "Anton",
        "timestamp": 1661789327
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"361169\">@Anton</span>  Here's the log file. <a href=\"/user_uploads/22008/7RLb4nmzkBm77BskrpNMyE3u/nix_log.txt\">nix_log.txt</a></p>",
        "id": 295945903,
        "sender_full_name": "Bryce Miller",
        "timestamp": 1661789467
    },
    {
        "content": "<p>I believe it was working when I had 20.04 under WSL2 on my win10 box. Can't quite remember though.</p>",
        "id": 295946213,
        "sender_full_name": "Bryce Miller",
        "timestamp": 1661789564
    },
    {
        "content": "<p>Curious to find out whether you get the same error on your VM. If not, maybe something peculiar about WSL?</p>",
        "id": 295946703,
        "sender_full_name": "Bryce Miller",
        "timestamp": 1661789684
    },
    {
        "content": "<p>Here's the error that gets printed to the console, in case it helps: </p>\n<div class=\"codehilite\"><pre><span></span><code>error: builder for &#39;/nix/store/8c55wxck5wxir0gsycdwxcdsa62ng41l-debugir.drv&#39; failed with exit code 2;\n       last 10 log lines:\n       &gt; /nix/store/vhf2cr6immz4qdxd83y025fnxim8mmfg-binutils-2.38/bin/ld: Main.cpp:(.text.startup+0xaf9): undefined reference to `llvm::raw_string_ostream::~raw_string_ostream()&#39;\n       &gt; /nix/store/vhf2cr6immz4qdxd83y025fnxim8mmfg-binutils-2.38/bin/ld: CMakeFiles/debugir.dir/Main.cpp.o:(.data.rel.ro._ZTIN4llvm2cl15OptionValueCopyINSt7__cxx1112basic_stringIcSt11char_traitsIcESaIcEEEEE[_ZTIN4llvm2cl15OptionValueCopyINSt7__cxx1112basic_stringIcSt11char_traitsIcESaIcEEEEE]+0x10): undefined reference to `typeinfo for llvm::cl::GenericOptionValue&#39;\n       &gt; /nix/store/vhf2cr6immz4qdxd83y025fnxim8mmfg-binutils-2.38/bin/ld: CMakeFiles/debugir.dir/Main.cpp.o:(.data.rel.ro._ZTIN4llvm2cl15OptionValueCopyIbEE[_ZTIN4llvm2cl15OptionValueCopyIbEE]+0x10): undefined reference to `typeinfo for llvm::cl::GenericOptionValue&#39;\n       &gt; /nix/store/vhf2cr6immz4qdxd83y025fnxim8mmfg-binutils-2.38/bin/ld: CMakeFiles/debugir.dir/Main.cpp.o:(.data.rel.ro._ZTVN4llvm2cl15OptionValueCopyINSt7__cxx1112basic_stringIcSt11char_traitsIcESaIcEEEEE[_ZTVN4llvm2cl15OptionValueCopyINSt7__cxx1112basic_stringIcSt11char_traitsIcESaIcEEEEE]+0x18): undefined reference to `llvm::cl::GenericOptionValue::anchor()&#39;\n       &gt; /nix/store/vhf2cr6immz4qdxd83y025fnxim8mmfg-binutils-2.38/bin/ld: CMakeFiles/debugir.dir/Main.cpp.o:(.data.rel.ro._ZTVN4llvm2cl11OptionValueIbEE[_ZTVN4llvm2cl11OptionValueIbEE]+0x18): undefined reference to `llvm::cl::GenericOptionValue::anchor()&#39;\n       &gt; /nix/store/vhf2cr6immz4qdxd83y025fnxim8mmfg-binutils-2.38/bin/ld: CMakeFiles/debugir.dir/Main.cpp.o:(.data.rel+0x0): undefined reference to `llvm::DisableABIBreakingChecks&#39;\n       &gt; collect2: error: ld returned 1 exit status\n       &gt; make[2]: *** [CMakeFiles/debugir.dir/build.make:134: debugir] Error 1\n       &gt; make[1]: *** [CMakeFiles/Makefile2:164: CMakeFiles/debugir.dir/all] Error 2\n       &gt; make: *** [Makefile:91: all] Error 2\n       For full logs, run &#39;nix log /nix/store/8c55wxck5wxir0gsycdwxcdsa62ng41l-debugir.drv&#39;.\nerror: 1 dependencies of derivation &#39;/nix/store/6c85ff13cb9xdv6x6hmq3axrdkjj7gwc-nix-shell-env.drv&#39; failed to build\n</code></pre></div>\n<p>Let me know if there's anything else I can share/test!</p>",
        "id": 295947382,
        "sender_full_name": "Bryce Miller",
        "timestamp": 1661789922
    },
    {
        "content": "<p>We've had a <a href=\"https://github.com/roc-lang/roc/issues/3528\">similar issue</a> before that I never really figured out but it disappeared with different versions of nixpkgs. Can you check with <code>git status</code> if the <code>flake.lock</code> file changed?</p>",
        "id": 295947652,
        "sender_full_name": "Anton",
        "timestamp": 1661790016
    },
    {
        "content": "<p>no uncommitted changes here. Should be the same as what's on <code>main</code></p>",
        "id": 295948188,
        "sender_full_name": "Bryce Miller",
        "timestamp": 1661790210
    },
    {
        "content": "<p>I was going to test on my M1 Mac last night but I managed to screw up my Nix installation lol. Last I checked it worked there.</p>",
        "id": 295949734,
        "sender_full_name": "Bryce Miller",
        "timestamp": 1661790755
    },
    {
        "content": "<p>Uhu, yeah we test nix on an M1 for every PR.</p>",
        "id": 295958728,
        "sender_full_name": "Anton",
        "timestamp": 1661793588
    },
    {
        "content": "<p>I failed to reproduce this in the VM on Ubuntu 22.04. I'll continue to investigate but if you want to unblock yourself you can just remove the <code>debugir</code> line from inside <code>sharedInputs = (with pkgs; [</code> in <code>flake.nix</code>. <code>debugir</code> is only used to debug a specific part of the compiler when needed, the build and tests can all pass without <code>debugir</code>. A similar error as you're having now can occur for another nix dependency though.</p>",
        "id": 295962818,
        "sender_full_name": "Anton",
        "timestamp": 1661794885
    },
    {
        "content": "<p>Commented out that line and it worked! Some  stuff isn't building now but I'm able to get into the shell at least. It also works without issue on my mac, so I can always use that. Definitely let me know if there is anything else I can do to help troubleshoot this, and I'll let you know if I find out anything new.</p>",
        "id": 295964797,
        "sender_full_name": "Bryce Miller",
        "timestamp": 1661795517
    },
    {
        "content": "<p>I'll let you now :) I'll try it out in WSL2 tomorrow.<br>\nCan you also share the errors for \"Some stuff isn't building now\"? Do those errors occur when doing <code>cargo build</code> or is this still with <code>nix develop</code>?</p>",
        "id": 295966253,
        "sender_full_name": "Anton",
        "timestamp": 1661795985
    },
    {
        "content": "<p>Doing <code>nix develop</code> successfully puts me into the shell. <code>cargo clean &amp;&amp; cargo build</code> results in the following:</p>\n<div class=\"codehilite\"><pre><span></span><code>...\n   Compiling x11-dl v2.19.1\n   Compiling wgpu-core v0.12.2\nerror: failed to run custom build command for `wasi_libc_sys v0.0.1 (/home/bdm/src/contrib/roc/crates/wasi-libc-sys)`\n\nCaused by:\n  process didn&#39;t exit successfully: `/home/bdm/src/contrib/roc/target/debug/build/wasi_libc_sys-ea0d16e6299e57fc/build-script-build` (exit status: 101)\n  --- stdout\n  cargo:rerun-if-changed=build.rs\n  cargo:rerun-if-changed=src/dummy.c\n\n  --- stderr\n  thread &#39;main&#39; panicked at &#39;called `Result::unwrap()` on an `Err` value: Os { code: 2, kind: NotFound, message: &quot;No such file or directory&quot; }&#39;, crates/wasi-libc-sys/build.rs:33:10\n  note: run with `RUST_BACKTRACE=1` environment variable to display a backtrace\nwarning: build failed, waiting for other jobs to finish...\n</code></pre></div>",
        "id": 295966926,
        "sender_full_name": "Bryce Miller",
        "timestamp": 1661796168
    },
    {
        "content": "<p>Here's a similar error I got on my mac when I tried to<code>cargo build</code> <em>before</em> running <code>cargo clean</code>.</p>\n<div class=\"codehilite\"><pre><span></span><code>error: failed to run custom build command for `roc_repl_wasm v0.0.1 (/Users/bryce/src/roc/crates/repl_wasm)`\n\nCaused by:\n  process didn&#39;t exit successfully: `/Users/bryce/src/roc/target/debug/build/roc_repl_wasm-447f50ffdcb4a716/build-script-build` (exit status: 101)\n  --- stdout\n  cargo:rerun-if-changed=build.rs\n  cargo:rerun-if-changed=src/repl_platform.c\n\n  --- stderr\n  thread &#39;main&#39; panicked at &#39;Output {\n      status: ExitStatus(\n          unix_wait_status(\n              256,\n          ),\n      ),\n      stdout: &quot;&quot;,\n      stderr: &quot;wasm-ld: error: cannot open /Users/bryce/code/roc/target/debug/build/wasi_libc_sys-b55c70ecf1892372/out/zig-cache/o/1bb0d1cbfb762560ef47ddccdb2efdcf/compiler_rt.o: No such file or directory\\nwasm-ld: error: cannot open /Users/bryce/code/roc/target/debug/build/wasi_libc_sys-b55c70ecf1892372/out/wasi-libc.a: No such file or directory\\n&quot;,\n  }&#39;, crates/repl_wasm/build.rs:42:5\n  note: run with `RUST_BACKTRACE=1` environment variable to display a backtrace\nwarning: build failed, waiting for other jobs to finish...\n</code></pre></div>\n<p>Oddly, after I got this error, <code>cargo run repl</code> worked without running <code>cargo clean</code> first.  <code>cargo clean &amp;&amp; cargo build</code> fixed the build issue. </p>\n<p>So to be clear, no problems on my Mac, but this is an issue that popped up and was easily fixable with <code>cargo clean</code>.</p>",
        "id": 295968006,
        "sender_full_name": "Bryce Miller",
        "timestamp": 1661796525
    },
    {
        "content": "<p>You may have run <code>cargo build</code> once without doing <code>nix develop</code> first. Later trying to use nix with pre-built artifacts made without nix is known to lead to all kinds of problems. We mention this in BUILDING_FROM_SOURCE but I will improve the wording. To prevent this: tools like direnv or lorri can automatically put you in a nix shell whenever you <code>cd</code> into the directory, I also like using <a href=\"https://starship.rs/\">starship</a> which clearly shows if you are in a nix shell or not.</p>",
        "id": 296060239,
        "sender_full_name": "Anton",
        "timestamp": 1661849608
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"522634\">@Bryce Miller</span> I failed to reproduce the debugir error with Ubuntu 22.04 on WSL. Because we are working on native windows support I'd like to end the investigation here.</p>",
        "id": 296142960,
        "sender_full_name": "Anton",
        "timestamp": 1661872263
    },
    {
        "content": "<p>Thanks for the tips! I believe I did run cargo build once before remembering to drop into the Nix shell. I just didn’t know how to clean up the mess beyond trying cargo clean. </p>\n<p>Fair enough, you have higher priority things to work on! If I do manage to figure out a fix, should I share it here?</p>",
        "id": 296146217,
        "sender_full_name": "Bryce Miller",
        "timestamp": 1661873198
    },
    {
        "content": "<p>Thanks again for looking into this for me.</p>",
        "id": 296146254,
        "sender_full_name": "Bryce Miller",
        "timestamp": 1661873208
    },
    {
        "content": "<p>Update: I tried using the \"Ubuntu 22.04.1\" package from the Microsoft Store instead of the \"Ubuntu\" package. Nix shell and build worked flawlessly. Either I messed something up in the other environment, or there is some subtle difference in the way they are set up by default. Hope this helps for anyone else using WSL2.</p>",
        "id": 296381933,
        "sender_full_name": "Bryce Miller",
        "timestamp": 1661962241
    },
    {
        "content": "<p>Hi,<br>\nHow can I just build a executable?<br>\nI try</p>\n<div class=\"codehilite\" data-code-language=\"Bash Session\"><pre><span></span><code><span class=\"go\">nix develop</span>\n<span class=\"go\">cargo install</span>\n</code></pre></div>\n<p>and I get</p>\n<div class=\"codehilite\" data-code-language=\"Bash Session\"><pre><span></span><code><span class=\"go\">error: found a virtual manifest at `/path/to/roc/Cargo.toml` instead of a package manifest</span>\n</code></pre></div>",
        "id": 297873960,
        "sender_full_name": "Hashi364",
        "timestamp": 1662675846
    },
    {
        "content": "<p><code>cargo build</code></p>",
        "id": 297874019,
        "sender_full_name": "Folkert de Vries",
        "timestamp": 1662675891
    },
    {
        "content": "<p>Where is the binary?<br>\nSorry, I forgot to say that I want a binary and not to run <code>cargo run -- foo</code> every time</p>",
        "id": 297874501,
        "sender_full_name": "Hashi364",
        "timestamp": 1662676153
    },
    {
        "content": "<p>ah</p>",
        "id": 297874517,
        "sender_full_name": "Folkert de Vries",
        "timestamp": 1662676166
    },
    {
        "content": "<p><code>/target/debug/roc</code> probably, or <code>/target/release/roc</code> is you built with <code>--release</code></p>",
        "id": 297874549,
        "sender_full_name": "Folkert de Vries",
        "timestamp": 1662676186
    },
    {
        "content": "<p>you should symlink that though, and not move the binary; it uses some files with a relative path</p>",
        "id": 297874664,
        "sender_full_name": "Folkert de Vries",
        "timestamp": 1662676229
    },
    {
        "content": "<p>Thanks, I was planning to do that (if I rebuild, I can just \"do nothing\")</p>",
        "id": 297874803,
        "sender_full_name": "Hashi364",
        "timestamp": 1662676310
    },
    {
        "content": "<p>The guide says:</p>\n<blockquote>\n<p>If you want to load all dependencies automatically whenever you cd into roc, check out direnv. Then you will no longer need to execute nix develop first.</p>\n</blockquote>\n<p>What environment variables do I add to direnv?</p>",
        "id": 304271482,
        "sender_full_name": "Arbil",
        "timestamp": 1665899652
    },
    {
        "content": "<p><code>echo \"use nix\" &gt;&gt; .envrc</code></p>",
        "id": 304271717,
        "sender_full_name": "Brendan Hansknecht",
        "timestamp": 1665899887
    },
    {
        "content": "<p>That should work if you have nix setup correctly and direnv installed through nix</p>",
        "id": 304271729,
        "sender_full_name": "Brendan Hansknecht",
        "timestamp": 1665899911
    },
    {
        "content": "<p>That said, it is nicer to use <a href=\"https://github.com/nix-community/lorri\">lorri</a> with nix</p>",
        "id": 304271770,
        "sender_full_name": "Brendan Hansknecht",
        "timestamp": 1665899952
    },
    {
        "content": "<p>It basically rebuilds the nix environment behind the scenes and caches the nix environment better. So you can just use things without waiting on updates.</p>",
        "id": 304271804,
        "sender_full_name": "Brendan Hansknecht",
        "timestamp": 1665899995
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"522634\">Bryce Miller</span> <a href=\"#narrow/stream/231634-beginners/topic/building.20from.20source/near/295966926\">said</a>:</p>\n<blockquote>\n<p>Doing <code>nix develop</code> successfully puts me into the shell. <code>cargo clean &amp;&amp; cargo build</code> results in the following:</p>\n<p><div class=\"codehilite\"><pre><span></span><code>...\n   Compiling x11-dl v2.19.1\n   Compiling wgpu-core v0.12.2\nerror: failed to run custom build command for `wasi_libc_sys v0.0.1 (/home/bdm/src/contrib/roc/crates/wasi-libc-sys)`\n\nCaused by:\n  process didn&#39;t exit successfully: `/home/bdm/src/contrib/roc/target/debug/build/wasi_libc_sys-ea0d16e6299e57fc/build-script-build` (exit status: 101)\n  --- stdout\n  cargo:rerun-if-changed=build.rs\n  cargo:rerun-if-changed=src/dummy.c\n\n  --- stderr\n  thread &#39;main&#39; panicked at &#39;called `Result::unwrap()` on an `Err` value: Os { code: 2, kind: NotFound, message: &quot;No such file or directory&quot; }&#39;, crates/wasi-libc-sys/build.rs:33:10\n  note: run with `RUST_BACKTRACE=1` environment variable to display a backtrace\nwarning: build failed, waiting for other jobs to finish...\n</code></pre></div><br>\n</p>\n</blockquote>\n<p>Hello! I am coming back to Roc since last working on it around February. Trying to build from source now, I am hitting this exact error Bryce reported. For me, <code>cargo clean</code> is not resolving. Has anyone else run into it?</p>",
        "id": 304362337,
        "sender_full_name": "Chad Stearns",
        "timestamp": 1665965658
    },
    {
        "content": "<p>I am hitting this issue on my mac.</p>",
        "id": 304362414,
        "sender_full_name": "Chad Stearns",
        "timestamp": 1665965764
    },
    {
        "content": "<p>Hi Chad, that error suggests that a previous Zig command failed. Maybe check what <code>zig version</code> says? We require Zig 0.9.1. We first check to see if the environment variable <code>ROC_ZIG</code> contains a path, and if not, we default to <code>zig</code>.</p>",
        "id": 304395607,
        "sender_full_name": "Brian Carroll",
        "timestamp": 1665991189
    },
    {
        "content": "<p>Welcome back <span class=\"user-mention\" data-user-id=\"281385\">@Chad Stearns</span> :)<br>\nLike Bryce, did you also do <code>nix develop</code> first? Zig should definitely be the right version when using <code>nix develop</code>.</p>",
        "id": 304421770,
        "sender_full_name": "Anton",
        "timestamp": 1666000801
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"343810\">Brendan Hansknecht</span> <a href=\"#narrow/stream/231634-beginners/topic/building.20from.20source/near/304271717\">said</a>:</p>\n<blockquote>\n<p><code>echo \"use nix\" &gt;&gt; .envrc</code></p>\n</blockquote>\n<p>Thanks, it's working. However, every call of <code>nix develop</code>, or entry through direnv, takes away about 10GB of disk space which quickly kills this resource constrained box. Part of that seems copying of <code>roc-main</code> directory with all the compilation artifacts. <code>nix-collect-garbage</code> on the other hand forces download &amp; install of all dependencies again (and doesn't seem to free all the disk space anyway)</p>",
        "id": 304469659,
        "sender_full_name": "Arbil",
        "timestamp": 1666015566
    },
    {
        "content": "<p>Is there a way to deal with this?</p>",
        "id": 304469699,
        "sender_full_name": "Arbil",
        "timestamp": 1666015577
    },
    {
        "content": "<p>Yeah....nix can be annoying with storage space. I have never run out of space on my machine, so I can't imagine the 10 GB being consistently added without some other form of issue (though even a few times could be problematic). <span class=\"user-mention\" data-user-id=\"361169\">@Anton</span> any ideas? Can we get nix to ignore the files? Especially the target folder? Theoretically, nix should be able to just change paths and not move any data, right?</p>",
        "id": 304495693,
        "sender_full_name": "Brendan Hansknecht",
        "timestamp": 1666021612
    },
    {
        "content": "<p>I like using <a href=\"https://github.com/hercules-ci/gitignore.nix\">https://github.com/hercules-ci/gitignore.nix</a> for this but it only makes sense for the <code>shell.nix</code>/<code>default.nix</code> combo. If you have a version of Nix that can use flakes, I'd recommend using <code>use flake</code> in your <code>.envrc</code> instead, as it'll ignore gitignored files automatically.</p>",
        "id": 304496170,
        "sender_full_name": "Brian Hicks",
        "timestamp": 1666021745
    },
    {
        "content": "<p>(although I think <code>nix develop</code> uses flakes already so I am not sure what could be happening there.)</p>",
        "id": 304496251,
        "sender_full_name": "Brian Hicks",
        "timestamp": 1666021773
    },
    {
        "content": "<p>I think our <code>shell.nix</code> was modified to be the same as <code>nix develop</code> as well</p>",
        "id": 304496524,
        "sender_full_name": "Brendan Hansknecht",
        "timestamp": 1666021850
    },
    {
        "content": "<p>Also, didn't realize <code>direnv</code> can support flakes directly now. Might switch to that until lorri updates.</p>",
        "id": 304498100,
        "sender_full_name": "Brendan Hansknecht",
        "timestamp": 1666022268
    },
    {
        "content": "<p>I switched away from Lorri a long time ago, FWIW. The only thing I miss is building in the background. I've got a direnv snippet loaded with home-manager that caches shells so that shell startup is negligible with just <code>use nix</code> or <code>use flake</code> without having to run a daemon.</p>",
        "id": 304498738,
        "sender_full_name": "Brian Hicks",
        "timestamp": 1666022420
    },
    {
        "content": "<p>I can send it to you if you'd like, but I think I just got it from the Nix wiki</p>",
        "id": 304498778,
        "sender_full_name": "Brian Hicks",
        "timestamp": 1666022433
    },
    {
        "content": "<p>No worries, found it.</p>",
        "id": 304500434,
        "sender_full_name": "Brendan Hansknecht",
        "timestamp": 1666022860
    },
    {
        "content": "<p>I don't think compilation artifacts are copied, but once you run <code>cargo build</code> after <code>nix develop</code> they will appear in the <code>nix/store/hash-source</code> folder.</p>",
        "id": 304517371,
        "sender_full_name": "Anton",
        "timestamp": 1666027900
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"550456\">@Arbil</span> I would check your target folder to make sure that you don't have both <code>release</code> and <code>debug</code> folders. Your IDE may also generate compiler artifacts. I would delete the <code>debug</code> folder and test building with <code>cargo build --release -p name_of_crate_you_changed</code> and testing with <code>cargo test --release -p name_of_crate_you_changed</code> to save storage space. I will send you a flake.nix tomorrow that does not contain the editor's dependencies, that should also save some space.</p>",
        "id": 304522208,
        "sender_full_name": "Anton",
        "timestamp": 1666029269
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"361169\">Anton</span> <a href=\"#narrow/stream/231634-beginners/topic/building.20from.20source/near/304517371\">said</a>:</p>\n<blockquote>\n<p>I don't think compilation artifacts are copied, but once you run <code>cargo build</code> after <code>nix develop</code> they will appear in the <code>nix/store/hash-source</code> folder.</p>\n</blockquote>\n<p>Thank you. I've done a quick reformat of this box and it seems more managable this time. BTW, I'm using the vscode flake and 'arrow up' doesn't work in inbuilt terminal for 'previous command', is that normal?</p>",
        "id": 304609717,
        "sender_full_name": "Arbil",
        "timestamp": 1666069053
    },
    {
        "content": "<p>the flake terminal and your normal terminal have different histories.</p>",
        "id": 304609843,
        "sender_full_name": "Brendan Hansknecht",
        "timestamp": 1666069177
    },
    {
        "content": "<p>but up arrow should work within the history of your flake terminal</p>",
        "id": 304609864,
        "sender_full_name": "Brendan Hansknecht",
        "timestamp": 1666069194
    },
    {
        "content": "<blockquote>\n<p>I'm using the vscode flake and 'arrow up' doesn't work in inbuilt terminal for 'previous command', is that normal?</p>\n</blockquote>\n<p>Yeah it's not just the different histories, I also have this. I tried digging into it but came up empty, so I use the terminal in which I entered <code>nix develop</code>.</p>",
        "id": 304615554,
        "sender_full_name": "Anton",
        "timestamp": 1666073379
    },
    {
        "content": "<p>Oh, weird</p>",
        "id": 304615761,
        "sender_full_name": "Brendan Hansknecht",
        "timestamp": 1666073511
    },
    {
        "content": "<p>My terminal also looks like this:<br>\n<a href=\"/user_uploads/22008/aJKhN1ZLNRElVF_lSzae6QmZ/nix_vscode_terminal.png\">nix_vscode_terminal.png</a> </p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/22008/aJKhN1ZLNRElVF_lSzae6QmZ/nix_vscode_terminal.png\" title=\"nix_vscode_terminal.png\"><img src=\"/user_uploads/22008/aJKhN1ZLNRElVF_lSzae6QmZ/nix_vscode_terminal.png\"></a></div><p>I wonder if it's because I use <a href=\"http://starship.rs\">starship.rs</a></p>",
        "id": 304616102,
        "sender_full_name": "Anton",
        "timestamp": 1666073735
    },
    {
        "content": "<p>Mine looks similar though not identical. I don't use starship</p>",
        "id": 304635282,
        "sender_full_name": "Arbil",
        "timestamp": 1666082863
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"550456\">@Arbil</span> here is the flake.nix with all editor dependencies left out:</p>\n<div class=\"codehilite\" data-code-language=\"Nix\"><pre><span></span><code><span class=\"p\">{</span>\n  <span class=\"ss\">description =</span> <span class=\"s2\">\"Roc flake\"</span><span class=\"p\">;</span>\n\n  <span class=\"ss\">inputs =</span> <span class=\"p\">{</span>\n    nixpkgs<span class=\"o\">.</span><span class=\"ss\">url =</span> <span class=\"s2\">\"github:nixos/nixpkgs/nixos-unstable\"</span><span class=\"p\">;</span>\n\n    <span class=\"c1\"># rust from nixpkgs has some libc problems, this is patched in the rust-overlay</span>\n    <span class=\"ss\">rust-overlay =</span> <span class=\"p\">{</span>\n      <span class=\"ss\">url =</span> <span class=\"s2\">\"github:oxalica/rust-overlay\"</span><span class=\"p\">;</span>\n      inputs<span class=\"o\">.</span>nixpkgs<span class=\"o\">.</span><span class=\"ss\">follows =</span> <span class=\"s2\">\"nixpkgs\"</span><span class=\"p\">;</span>\n    <span class=\"p\">};</span>\n    <span class=\"c1\"># to easily make configs for multiple architectures</span>\n    flake-utils<span class=\"o\">.</span><span class=\"ss\">url =</span> <span class=\"s2\">\"github:numtide/flake-utils\"</span><span class=\"p\">;</span>\n    <span class=\"c1\"># to be able to use vulkan system libs for editor graphics</span>\n    <span class=\"ss\">nixgl =</span> <span class=\"p\">{</span>\n      <span class=\"ss\">url =</span> <span class=\"s2\">\"github:guibou/nixGL\"</span><span class=\"p\">;</span>\n      inputs<span class=\"o\">.</span>nixpkgs<span class=\"o\">.</span><span class=\"ss\">follows =</span> <span class=\"s2\">\"nixpkgs\"</span><span class=\"p\">;</span>\n    <span class=\"p\">};</span>\n  <span class=\"p\">};</span>\n\n  <span class=\"ss\">outputs =</span> <span class=\"p\">{</span> self<span class=\"p\">,</span> nixpkgs<span class=\"p\">,</span> rust-overlay<span class=\"p\">,</span> flake-utils<span class=\"p\">,</span> nixgl <span class=\"p\">}:</span>\n    <span class=\"k\">let</span> <span class=\"ss\">supportedSystems =</span> <span class=\"p\">[</span> <span class=\"s2\">\"x86_64-linux\"</span> <span class=\"s2\">\"x86_64-darwin\"</span> <span class=\"s2\">\"aarch64-darwin\"</span> <span class=\"p\">];</span>\n    <span class=\"k\">in</span> flake-utils<span class=\"o\">.</span>lib<span class=\"o\">.</span>eachSystem supportedSystems <span class=\"p\">(</span>system<span class=\"p\">:</span>\n      <span class=\"k\">let</span>\n        <span class=\"ss\">overlays =</span> <span class=\"p\">[</span> <span class=\"p\">(</span><span class=\"nb\">import</span> rust-overlay<span class=\"p\">)</span> <span class=\"p\">]</span>\n          <span class=\"o\">++</span> <span class=\"p\">(</span><span class=\"k\">if</span> <span class=\"ss\">system =</span><span class=\"o\">=</span> <span class=\"s2\">\"x86_64-linux\"</span> <span class=\"k\">then</span> <span class=\"p\">[</span> nixgl<span class=\"o\">.</span>overlay <span class=\"p\">]</span> <span class=\"k\">else</span> <span class=\"p\">[</span> <span class=\"p\">]);</span>\n        <span class=\"ss\">pkgs =</span> <span class=\"nb\">import</span> nixpkgs <span class=\"p\">{</span> <span class=\"k\">inherit</span> system overlays<span class=\"p\">;</span> <span class=\"p\">};</span>\n        <span class=\"ss\">llvmPkgs =</span> pkgs<span class=\"o\">.</span>llvmPackages_13<span class=\"p\">;</span>\n\n        <span class=\"c1\"># get current working directory</span>\n        <span class=\"ss\">cwd =</span> <span class=\"nb\">builtins</span><span class=\"o\">.</span><span class=\"nb\">toString</span> <span class=\"o\">.</span><span class=\"l\">/.</span><span class=\"p\">;</span>\n        <span class=\"ss\">rust =</span>\n          pkgs<span class=\"o\">.</span>rust-bin<span class=\"o\">.</span>fromRustupToolchainFile <span class=\"s2\">\"</span><span class=\"si\">${</span>cwd<span class=\"si\">}</span><span class=\"s2\">/rust-toolchain.toml\"</span><span class=\"p\">;</span>\n\n        <span class=\"ss\">linuxInputs =</span> <span class=\"k\">with</span> pkgs<span class=\"p\">;</span>\n          lib<span class=\"o\">.</span>optionals stdenv<span class=\"o\">.</span>isLinux <span class=\"p\">[</span>\n            valgrind <span class=\"c1\"># used in cli tests, see cli/tests/cli_run.rs</span>\n            <span class=\"c1\">#vulkan-headers</span>\n            <span class=\"c1\">#vulkan-loader</span>\n            <span class=\"c1\">#vulkan-tools</span>\n            <span class=\"c1\">#vulkan-validation-layers</span>\n            <span class=\"c1\">#xorg.libX11</span>\n            <span class=\"c1\">#xorg.libXcursor</span>\n            <span class=\"c1\">#xorg.libXrandr</span>\n            <span class=\"c1\">#xorg.libXi</span>\n            xorg<span class=\"o\">.</span>libxcb\n            <span class=\"c1\">#alsa-lib</span>\n          <span class=\"p\">];</span>\n\n        <span class=\"ss\">darwinInputs =</span> <span class=\"k\">with</span> pkgs<span class=\"p\">;</span>\n          lib<span class=\"o\">.</span>optionals stdenv<span class=\"o\">.</span>isDarwin\n          <span class=\"p\">(</span><span class=\"k\">with</span> pkgs<span class=\"o\">.</span>darwin<span class=\"o\">.</span>apple_sdk<span class=\"o\">.</span>frameworks<span class=\"p\">;</span> <span class=\"p\">[</span>\n            AppKit\n            CoreFoundation\n            CoreServices\n            CoreVideo\n            Foundation\n            Metal\n            Security\n          <span class=\"p\">]);</span>\n\n        <span class=\"c1\"># For debugging LLVM IR</span>\n        <span class=\"c1\">#debugir = pkgs.stdenv.mkDerivation {</span>\n        <span class=\"c1\">#  name = \"debugir\";</span>\n        <span class=\"c1\">#  src = pkgs.fetchFromGitHub {</span>\n        <span class=\"c1\">#    owner = \"vaivaswatha\";</span>\n        <span class=\"c1\">#    repo = \"debugir\";</span>\n        <span class=\"c1\">#    rev = \"b981e0b74872d9896ba447dd6391dfeb63332b80\";</span>\n        <span class=\"c1\">#    sha256 = \"Gzey0SF0NZkpiObk5e29nbc41dn4Olv1dx+6YixaZH0=\";</span>\n        <span class=\"c1\">#  };</span>\n        <span class=\"c1\">#  buildInputs = with pkgs; [ cmake libxml2 llvmPackages_13.llvm.dev ];</span>\n        <span class=\"c1\">#  buildPhase = ''</span>\n        <span class=\"c1\">#    mkdir build</span>\n        <span class=\"c1\">#    cd build</span>\n        <span class=\"c1\">#    cmake -DLLVM_DIR=${pkgs.llvmPackages_13.llvm.dev} -DCMAKE_BUILD_TYPE=Release ../</span>\n        <span class=\"c1\">#    cmake --build ../</span>\n        <span class=\"c1\">#    cp ../debugir .</span>\n        <span class=\"c1\">#  '';</span>\n        <span class=\"c1\">#  installPhase = ''</span>\n        <span class=\"c1\">#    mkdir -p $out/bin</span>\n        <span class=\"c1\">#    cp debugir $out/bin</span>\n        <span class=\"c1\">#  '';</span>\n        <span class=\"c1\">#};</span>\n\n        <span class=\"ss\">sharedInputs =</span> <span class=\"p\">(</span><span class=\"k\">with</span> pkgs<span class=\"p\">;</span> <span class=\"p\">[</span>\n          <span class=\"c1\"># build libraries</span>\n          cmake\n          git\n          python3\n          llvmPkgs<span class=\"o\">.</span>llvm<span class=\"o\">.</span>dev\n          llvmPkgs<span class=\"o\">.</span>clang\n          libxkbcommon\n          pkg-config\n          zig <span class=\"c1\"># roc builtins are implemented in zig, see compiler/builtins/bitcode/</span>\n\n          <span class=\"c1\"># lib deps</span>\n          libffi\n          libxml2\n          ncurses\n          zlib\n          libiconv\n\n          <span class=\"c1\"># faster builds - see https://github.com/roc-lang/roc/blob/main/BUILDING_FROM_SOURCE.md#use-lld-for-the-linker</span>\n          llvmPkgs<span class=\"o\">.</span>lld\n          <span class=\"c1\">#debugir</span>\n          rust\n          rust-bindgen\n        <span class=\"p\">]);</span>\n      <span class=\"k\">in</span> <span class=\"p\">{</span>\n\n        <span class=\"ss\">devShell =</span> pkgs<span class=\"o\">.</span>mkShell <span class=\"p\">{</span>\n          <span class=\"ss\">buildInputs =</span> sharedInputs <span class=\"o\">++</span> darwinInputs <span class=\"o\">++</span> linuxInputs\n            <span class=\"o\">++</span> <span class=\"p\">(</span><span class=\"k\">if</span> <span class=\"ss\">system =</span><span class=\"o\">=</span> <span class=\"s2\">\"x86_64-linux\"</span> <span class=\"k\">then</span>\n              <span class=\"p\">[</span> pkgs<span class=\"o\">.</span>nixgl<span class=\"o\">.</span>nixVulkanIntel <span class=\"p\">]</span>\n            <span class=\"k\">else</span>\n              <span class=\"p\">[</span> <span class=\"p\">]);</span>\n\n          <span class=\"ss\">LLVM_SYS_130_PREFIX =</span> <span class=\"s2\">\"</span><span class=\"si\">${</span>llvmPkgs<span class=\"o\">.</span>llvm<span class=\"o\">.</span>dev<span class=\"si\">}</span><span class=\"s2\">\"</span><span class=\"p\">;</span>\n          <span class=\"c1\"># nix does not store libs in /usr/lib or /lib</span>\n          <span class=\"ss\">NIX_GLIBC_PATH =</span>\n            <span class=\"k\">if</span> pkgs<span class=\"o\">.</span>stdenv<span class=\"o\">.</span>isLinux <span class=\"k\">then</span> <span class=\"s2\">\"</span><span class=\"si\">${</span>pkgs<span class=\"o\">.</span>glibc<span class=\"o\">.</span>out<span class=\"si\">}</span><span class=\"s2\">/lib\"</span> <span class=\"k\">else</span> <span class=\"s2\">\"\"</span><span class=\"p\">;</span>\n          <span class=\"ss\">LD_LIBRARY_PATH =</span> <span class=\"k\">with</span> pkgs<span class=\"p\">;</span>\n            lib<span class=\"o\">.</span>makeLibraryPath\n            <span class=\"p\">([</span> pkg-config stdenv<span class=\"o\">.</span>cc<span class=\"o\">.</span>cc<span class=\"o\">.</span>lib libffi ncurses zlib <span class=\"p\">]</span>\n              <span class=\"o\">++</span> linuxInputs<span class=\"p\">);</span>\n          <span class=\"ss\">NIXPKGS_ALLOW_UNFREE =</span>\n            <span class=\"mi\">1</span><span class=\"p\">;</span> <span class=\"c1\"># to run the editor with NVIDIA's closed source drivers</span>\n        <span class=\"p\">};</span>\n\n        <span class=\"ss\">formatter =</span> pkgs<span class=\"o\">.</span>nixpkgs-fmt<span class=\"p\">;</span>\n\n        <span class=\"c1\"># You can build this package (the roc CLI) with the `nix build` command.</span>\n        packages<span class=\"o\">.</span><span class=\"ss\">default =</span> <span class=\"nb\">import</span> <span class=\"o\">.</span><span class=\"l\">/.</span> <span class=\"p\">{</span> <span class=\"k\">inherit</span> pkgs<span class=\"p\">;</span> <span class=\"p\">};</span>\n      <span class=\"p\">});</span>\n<span class=\"p\">}</span>\n</code></pre></div>",
        "id": 304648444,
        "sender_full_name": "Anton",
        "timestamp": 1666088298
    },
    {
        "content": "<p>Thank you very much. Will use today</p>",
        "id": 304651591,
        "sender_full_name": "Arbil",
        "timestamp": 1666089565
    },
    {
        "content": "<p>Hey <span class=\"user-mention\" data-user-id=\"361169\">@Anton</span> <span class=\"user-mention\" data-user-id=\"431893\">@Brian Carroll</span> . Nice to see you all. I am not on nix. When I do <code>zig version</code> I do see <code>0.9.1</code>. I tried setting <code>ROC_ZIG</code> just in case and I am still seeing the same error. Looking at the error again, it is exactly the same one as Bryce's (except for the directory names of course).</p>",
        "id": 305616166,
        "sender_full_name": "Chad Stearns",
        "timestamp": 1666497438
    },
    {
        "content": "<p>I see <code>build.rs</code> now. I am going to try adding some debugs and printlns.</p>",
        "id": 305617051,
        "sender_full_name": "Chad Stearns",
        "timestamp": 1666497990
    },
    {
        "content": "<p>Yeah I can see that it is looking for my zig cache at:</p>\n<div class=\"codehilite\"><pre><span></span><code>/Users/chad/code/roc/target/debug/build/wasi_libc_sys-1aefd8d65824087d/out/zig-cache\n</code></pre></div>\n<p>but when I check that spot <code>zig-cache</code> is not present<br>\n<a href=\"/user_uploads/22008/1mAqQ3pjstAy8fyGAoL2L5e4/Screen-Shot-2022-10-23-at-12.20.02-AM.png\">Screen-Shot-2022-10-23-at-12.20.02-AM.png</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/22008/1mAqQ3pjstAy8fyGAoL2L5e4/Screen-Shot-2022-10-23-at-12.20.02-AM.png\" title=\"Screen-Shot-2022-10-23-at-12.20.02-AM.png\"><img src=\"/user_uploads/22008/1mAqQ3pjstAy8fyGAoL2L5e4/Screen-Shot-2022-10-23-at-12.20.02-AM.png\"></a></div>",
        "id": 305617950,
        "sender_full_name": "Chad Stearns",
        "timestamp": 1666498975
    },
    {
        "content": "<p>Hi Chad, I'd recommend adding some dbg prints to get the necessary values and executing <code>zig build-exe...</code> manually from the same working dir.</p>",
        "id": 305632308,
        "sender_full_name": "Anton",
        "timestamp": 1666511172
    },
    {
        "content": "<p>Is there a more granular command to build the roc compiler than <code>cargo build</code> in project root? This one builds some editor, wasm and repl stuff also</p>",
        "id": 305748166,
        "sender_full_name": "Arbil",
        "timestamp": 1666588534
    },
    {
        "content": "<p>Rust let's you build specific packages. Otherwise, the compiler does have some feature flags that can reduce what is pulled in, but it is pretty limited in what can be removed</p>",
        "id": 305751706,
        "sender_full_name": "Brendan Hansknecht",
        "timestamp": 1666591164
    },
    {
        "content": "<p>Hi,<br>\nYesterday I made the upgrade of MacOS to Ventura 13.0, and now my build fails <span aria-label=\"cry\" class=\"emoji emoji-1f622\" role=\"img\" title=\"cry\">:cry:</span> <br>\nI tried <code>cargo clean</code>, but same output for <code>cargo build</code>:</p>\n<div class=\"codehilite\" data-code-language=\"Bash\"><pre><span></span><code>bash-5.1$ <span class=\"nv\">RUST_BACKTRACE</span><span class=\"o\">=</span><span class=\"m\">1</span> cargo build\n   Compiling roc_builtins v0.0.1 <span class=\"o\">(</span>/Users/ghigt/code/roc/source/crates/compiler/builtins<span class=\"o\">)</span>\n   Compiling serde v1.0.144\n   Compiling sha2 v0.10.2\n   Compiling clap_derive v3.2.18\n   Compiling futures-util v0.3.24\n   Compiling wasm-bindgen-macro-support v0.2.83\n   Compiling objc-foundation v0.1.1\n   Compiling bytemuck v1.12.1\n   Compiling object v0.29.0\n   Compiling roc_collections v0.0.1 <span class=\"o\">(</span>/Users/ghigt/code/roc/source/crates/compiler/collections<span class=\"o\">)</span>\nerror: failed to run custom build <span class=\"nb\">command</span> <span class=\"k\">for</span> <span class=\"sb\">`</span>roc_builtins v0.0.1 <span class=\"o\">(</span>/Users/ghigt/code/roc/source/crates/compiler/builtins<span class=\"o\">)</span><span class=\"sb\">`</span>\n\nCaused by:\n  process didn<span class=\"s1\">'t exit successfully: `/Users/ghigt/code/roc/source/target/debug/build/roc_builtins-4ce1b28dcf05f93e/build-script-build` (exit status: 101)</span>\n<span class=\"s1\">  --- stdout</span>\n<span class=\"s1\">  cargo:rerun-if-changed=build.rs</span>\n<span class=\"s1\">  Compiling host ir to: /Users/ghigt/code/roc/source/crates/compiler/builtins/bitcode/builtins-host.ll</span>\n<span class=\"s1\">  Compiling 64-bit bitcode to: /Users/ghigt/code/roc/source/crates/compiler/builtins/bitcode/builtins-host.bc</span>\n\n<span class=\"s1\">  --- stderr</span>\n<span class=\"s1\">  thread '</span>main<span class=\"s1\">' panicked at '</span>zig failed: thread <span class=\"m\">333562</span> panic: Darwin is handled separately via std.zig.system.darwin module\n  Unable to dump stack trace: debug info stripped\n  <span class=\"err\">'</span>, crates/compiler/builtins/build.rs:240:21\n  stack backtrace:\n     <span class=\"m\">0</span>: rust_begin_unwind\n               at /rustc/fe5b13d681f25ee6474be29d748c65adcd91f69e/library/std/src/panicking.rs:584:5\n     <span class=\"m\">1</span>: core::panicking::panic_fmt\n               at /rustc/fe5b13d681f25ee6474be29d748c65adcd91f69e/library/core/src/panicking.rs:143:14\n     <span class=\"m\">2</span>: build_script_build::run_command\n               at ./build.rs:240:21\n     <span class=\"m\">3</span>: build_script_build::generate_bc_file\n               at ./build.rs:133:5\n     <span class=\"m\">4</span>: build_script_build::main\n               at ./build.rs:40:5\n     <span class=\"m\">5</span>: core::ops::function::FnOnce::call_once\n               at /rustc/fe5b13d681f25ee6474be29d748c65adcd91f69e/library/core/src/ops/function.rs:227:5\n  note: Some details are omitted, run with <span class=\"sb\">`</span><span class=\"nv\">RUST_BACKTRACE</span><span class=\"o\">=</span>full<span class=\"sb\">`</span> <span class=\"k\">for</span> a verbose backtrace.\nwarning: build failed, waiting <span class=\"k\">for</span> other <span class=\"nb\">jobs</span> to finish...\n</code></pre></div>\n<p>(I use <code>nix develop</code>)</p>",
        "id": 306251249,
        "sender_full_name": "Ghislain",
        "timestamp": 1666794145
    },
    {
        "content": "<p>Also, the previous builds using MacOS 12.0 are now failing:</p>\n<div class=\"codehilite\" data-code-language=\"Bash\"><pre><span></span><code>» <span class=\"m\">1</span>+1\nld: warning: directory not found <span class=\"k\">for</span> option <span class=\"s1\">'-F/Library/Developer/CommandLineTools/SDKs/MacOSX.sdk/System/Library/Frameworks/'</span>\nld: library not found <span class=\"k\">for</span> -lSystem\n/var/folders/y4/y9696g7j7hx_dhcfdlv9f4600000gn/T/.tmpOlm155/app.dylib: No such file or directory\n</code></pre></div>",
        "id": 306252341,
        "sender_full_name": "Ghislain",
        "timestamp": 1666794422
    },
    {
        "content": "<p>I guess they change the location of the system library?</p>",
        "id": 306252754,
        "sender_full_name": "Brendan Hansknecht",
        "timestamp": 1666794516
    },
    {
        "content": "<p>ah you're right, I currently have <code>/Library/Developer/CommandLineTools/SDKs/MacOSX12.1.sdk/</code></p>",
        "id": 306252977,
        "sender_full_name": "Ghislain",
        "timestamp": 1666794586
    },
    {
        "content": "<p>brew is telling me to upgrade to XCode 14.1 instead of 14.0.1 but it is only in RC 2 and should be released in the next days, maybe it is related and will default to <code>MacOSX.sdk</code></p>",
        "id": 306253665,
        "sender_full_name": "Ghislain",
        "timestamp": 1666794745
    },
    {
        "content": "<p>I don't know if I can <code>ln</code> the folder</p>",
        "id": 306253847,
        "sender_full_name": "Ghislain",
        "timestamp": 1666794801
    },
    {
        "content": "<p>ok, after having the <code>/Library/Developer/CommandLineTools/SDKs/MacOSX.sdk</code> folder link, the previous builds work!</p>",
        "id": 306257547,
        "sender_full_name": "Ghislain",
        "timestamp": 1666795752
    },
    {
        "content": "<p>But still, I can't build new one any more</p>",
        "id": 306257639,
        "sender_full_name": "Ghislain",
        "timestamp": 1666795781
    },
    {
        "content": "<p>Zig has a branch up <a href=\"https://github.com/ziglang/zig/issues/10478\">with a fix</a> but that is for zig master, it'll probably take them some time to release 0.9.2 I suppose.</p>",
        "id": 306267467,
        "sender_full_name": "Anton",
        "timestamp": 1666798267
    },
    {
        "content": "<p>Thank you <span class=\"user-mention\" data-user-id=\"361169\">@Anton</span>, so I guess we're not able to compile on MacOS Ventura until then</p>",
        "id": 306273841,
        "sender_full_name": "Ghislain",
        "timestamp": 1666799972
    },
    {
        "content": "<p>That will teach me to update too soon <span aria-label=\"sweat smile\" class=\"emoji emoji-1f605\" role=\"img\" title=\"sweat smile\">:sweat_smile:</span></p>",
        "id": 306274357,
        "sender_full_name": "Ghislain",
        "timestamp": 1666800102
    },
    {
        "content": "<p>Yeah, I've heard several macos/ios update horror stories before...</p>",
        "id": 306274631,
        "sender_full_name": "Anton",
        "timestamp": 1666800167
    },
    {
        "content": "<p>Would it be possible (following this answer <a href=\"https://github.com/ziglang/zig/issues/10478#issuecomment-1294313967\">https://github.com/ziglang/zig/issues/10478#issuecomment-1294313967</a>) to make it run on Ventura using <code>-target native-macos.12</code>?<br>\nI tried with a simple <code>hello-world.zig</code> and it works, but I'm lost in the Roc repo to know where to put and try it</p>",
        "id": 306630612,
        "sender_full_name": "Ghislain",
        "timestamp": 1666955086
    },
    {
        "content": "<p>It's probably going to need to be added in multiple places. Based on the error you originally posted I would add <code>-target native-macos.12</code> <a href=\"https://github.com/roc-lang/roc/blob/de6e7840cb8e9ad114cc85c440002f125567f17d/crates/compiler/builtins/build.rs#L136\">here</a> to get started.</p>",
        "id": 306634427,
        "sender_full_name": "Anton",
        "timestamp": 1666956654
    },
    {
        "content": "<p>I tried to change this line, but without any result (I'm very new to Rust/Zig). Then I switched to <a href=\"https://github.com/roc-lang/roc/blob/de6e7840cb8e9ad114cc85c440002f125567f17d/crates/compiler/builtins/bitcode/build.zig#L25\">build.zig</a> but I can't find how to manage this object.</p>",
        "id": 306634859,
        "sender_full_name": "Ghislain",
        "timestamp": 1666956829
    },
    {
        "content": "<p>Did you get the exact same error? Feel free to post it again to make sure.</p>",
        "id": 306635063,
        "sender_full_name": "Anton",
        "timestamp": 1666956899
    },
    {
        "content": "<p>yes, it's like I did nothing</p>",
        "id": 306635421,
        "sender_full_name": "Ghislain",
        "timestamp": 1666957035
    },
    {
        "content": "<p>Maybe I'm doing something wrong, I changed it to:</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"n\">run_command</span><span class=\"p\">(</span><span class=\"w\"></span>\n<span class=\"w\">        </span><span class=\"o\">&amp;</span><span class=\"n\">bitcode_path</span><span class=\"p\">,</span><span class=\"w\"></span>\n<span class=\"w\">        </span><span class=\"o\">&amp;</span><span class=\"n\">zig_executable</span><span class=\"p\">(),</span><span class=\"w\"></span>\n<span class=\"w\">        </span><span class=\"o\">&amp;</span><span class=\"p\">[</span><span class=\"w\"></span>\n<span class=\"w\">            </span><span class=\"s\">\"build\"</span><span class=\"p\">,</span><span class=\"w\"></span>\n<span class=\"w\">            </span><span class=\"n\">zig_object</span><span class=\"p\">,</span><span class=\"w\"></span>\n<span class=\"w\">            </span><span class=\"s\">\"-target\"</span><span class=\"p\">,</span><span class=\"w\"></span>\n<span class=\"w\">            </span><span class=\"s\">\"native-macos.12\"</span><span class=\"p\">,</span><span class=\"w\"></span>\n<span class=\"w\">            </span><span class=\"s\">\"-Drelease=true\"</span><span class=\"p\">,</span><span class=\"w\"></span>\n<span class=\"w\">        </span><span class=\"p\">],</span><span class=\"w\"></span>\n<span class=\"w\">        </span><span class=\"mi\">0</span><span class=\"p\">,</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"p\">);</span><span class=\"w\"></span>\n</code></pre></div>",
        "id": 306635751,
        "sender_full_name": "Ghislain",
        "timestamp": 1666957142
    },
    {
        "content": "<p>I think there are just more places you need to change the target</p>",
        "id": 306636087,
        "sender_full_name": "Folkert de Vries",
        "timestamp": 1666957249
    },
    {
        "content": "<p>llvm generation needs to use the right target, but probably generic macos is good enough there, then the host needs to be built with the right target, and the final linking needs to use the right target</p>",
        "id": 306636230,
        "sender_full_name": "Folkert de Vries",
        "timestamp": 1666957300
    },
    {
        "content": "<p>It would probably be good to make a single <code>zig_cmd</code> function that is used everywhere instead of going through <code>std::process::Command</code> in multiple places. I'll make an issue for that.</p>",
        "id": 306638697,
        "sender_full_name": "Anton",
        "timestamp": 1666958261
    },
    {
        "content": "<p>well, that does not always work. You need the flexibility of <code>Command</code> sometimes</p>",
        "id": 306639088,
        "sender_full_name": "Folkert de Vries",
        "timestamp": 1666958404
    },
    {
        "content": "<p>Could the <code>zig_cmd</code> function not offer the same flexibility but still be centralized?</p>",
        "id": 306639680,
        "sender_full_name": "Anton",
        "timestamp": 1666958593
    },
    {
        "content": "<p>not sure what type you have in mind, is it <code>fn zig_cmd() -&gt; Command</code>?</p>",
        "id": 306640569,
        "sender_full_name": "Folkert de Vries",
        "timestamp": 1666958950
    },
    {
        "content": "<p>Anoton we do lots of different things with Zig in different places. Sometimes we're compiling a host, sometimes an app, sometimes a preprocessed host, could be targeting WebAssembly or native, compiling C code or Zig code...<br>\nSo it's not just the same thing duplicated all over the place. There may be some duplication but I'm skeptical we can write just one command to satisfy all these needs.</p>",
        "id": 306645695,
        "sender_full_name": "Brian Carroll",
        "timestamp": 1666960679
    },
    {
        "content": "<p>Oops, not an app! <span aria-label=\"sweat smile\" class=\"emoji emoji-1f605\" role=\"img\" title=\"sweat smile\">:sweat_smile:</span> But the other stuff</p>",
        "id": 306646773,
        "sender_full_name": "Brian Carroll",
        "timestamp": 1666960992
    },
    {
        "content": "<p>I'm aware of that, the intent is not really to avoid duplication but to have one central function that allows us to easily track where in the code base zig is used. As Folkert suggested; <code>fn zig_cmd() -&gt; Command</code> would allow us to do this tracking without sacrificing any flexibility. You can still add args to the <code>Command</code> that gets returned.</p>\n<p>Perhaps it makes sense to eventually go to a slightly less flexible version of <code>fn zig_cmd() -&gt; Command</code>, but it is a good start.</p>",
        "id": 306648117,
        "sender_full_name": "Anton",
        "timestamp": 1666961469
    },
    {
        "content": "<p>Ok, so it looks out of my competence, I'll downgrade to MacOS Monterey until Roc migrate to zig 0.10.x (which looks to be released in the next 4 days)</p>",
        "id": 306656076,
        "sender_full_name": "Ghislain",
        "timestamp": 1666963761
    },
    {
        "content": "<p>To set expectations; I believe zig 0.10 requires us upgrading to llvm 14 which requires significant effort.</p>",
        "id": 306657034,
        "sender_full_name": "Anton",
        "timestamp": 1666963982
    },
    {
        "content": "<p>yeah if I were to guess, I'd guess we won't end up upgrading to Zig 0.10 until early 2023</p>",
        "id": 306659372,
        "sender_full_name": "Richard Feldman",
        "timestamp": 1666964688
    },
    {
        "content": "<p>mainly because we're currently focusing on Advent of Code experience (which naturally runs through December), the 0.10 upgrade isn't needed for any of that, and it's a significant project</p>",
        "id": 306659858,
        "sender_full_name": "Richard Feldman",
        "timestamp": 1666964820
    },
    {
        "content": "<p>Yes, I totally understand, so it's simpler - if I want to dive into the roc code and mess around with it - for me to downgrade</p>",
        "id": 306660348,
        "sender_full_name": "Ghislain",
        "timestamp": 1666964948
    },
    {
        "content": "<p>Done, everything's working fine now I'm back to MacOS 12!</p>",
        "id": 306716154,
        "sender_full_name": "Ghislain",
        "timestamp": 1666979483
    },
    {
        "content": "<p>For <span class=\"user-mention\" data-user-id=\"550456\">@Arbil</span> and others who had this issue with the vscode terminal from inside nix:<br>\n<a href=\"/user_uploads/22008/aJKhN1ZLNRElVF_lSzae6QmZ/nix_vscode_terminal.png\">nix_vscode_terminal.png</a> </p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/22008/aJKhN1ZLNRElVF_lSzae6QmZ/nix_vscode_terminal.png\" title=\"nix_vscode_terminal.png\"><img src=\"/user_uploads/22008/aJKhN1ZLNRElVF_lSzae6QmZ/nix_vscode_terminal.png\"></a></div><p>I was able to resolve it in <a href=\"https://github.com/roc-lang/roc/pull/4868\">this PR</a></p>",
        "id": 320279139,
        "sender_full_name": "Anton",
        "timestamp": 1673284226
    },
    {
        "content": "<p>Hi! I'm having an issue when building from source on macOS. <code>cargo build</code> works fine, and <code>cargo run repl</code> starts the repl, but when I enter anything it panics. I actually had the repl working fine when I initially set things up a few weeks ago, so I must have accidentally messed up my environment, but I can't figure out what changed. I'm using nix, and this is what happens after running <code>cargo clean</code>, <code>nix develop</code>, <code>cargo run repl</code> and then entering a value in the repl. Any ideas what this error is related to?</p>\n<div class=\"codehilite\"><pre><span></span><code>» 123\nld: unknown option: -no_fixup_chains\nthread &#39;main&#39; panicked at &#39;\n___________\nLinking command failed with status ExitStatus(unix_wait_status(256)):\n\n  Child { stdin: None, stdout: None, stderr: None, .. }\n___________\n&#39;, crates/compiler/build/src/link.rs:1464:5\nstack backtrace:\n   0: rust_begin_unwind\n             at /rustc/a55dd71d5fb0ec5a6a3a9e8c27b2127ba491ce52/library/std/src/panicking.rs:584:5\n   1: core::panicking::panic_fmt\n             at /rustc/a55dd71d5fb0ec5a6a3a9e8c27b2127ba491ce52/library/core/src/panicking.rs:142:14\n   2: roc_build::link::llvm_module_to_dylib\n             at ./crates/compiler/build/src/link.rs:1464:5\n   3: roc_repl_cli::cli_gen::mono_module_to_dylib\n             at ./crates/repl_cli/src/cli_gen.rs:286:5\n   4: roc_repl_cli::cli_gen::gen_and_eval_llvm\n             at ./crates/repl_cli/src/cli_gen.rs:73:9\n   5: roc_repl_cli::repl_state::ReplState::eval_and_format\n             at ./crates/repl_cli/src/repl_state.rs:260:46\n   6: roc_repl_cli::repl_state::ReplState::step\n             at ./crates/repl_cli/src/repl_state.rs:122:46\n   7: roc_repl_cli::main\n             at ./crates/repl_cli/src/lib.rs:49:23\n   8: roc::main\n             at ./crates/cli/src/main.rs:194:35\n   9: core::ops::function::FnOnce::call_once\n             at /rustc/a55dd71d5fb0ec5a6a3a9e8c27b2127ba491ce52/library/core/src/ops/function.rs:248:5\n</code></pre></div>",
        "id": 326502325,
        "sender_full_name": "Fred",
        "timestamp": 1675829880
    },
    {
        "content": "<p>I tried it out using latest main and it seems to work for me. I'm on MacOS 12.6 using M2 silicon. </p>\n<div class=\"codehilite\" data-code-language=\"Bash\"><pre><span></span><code><span class=\"m\">192</span>-168-1-105:roc<span class=\"w\"> </span>luke$<span class=\"w\"> </span>cargo<span class=\"w\"> </span>clean\n<span class=\"m\">192</span>-168-1-105:roc<span class=\"w\"> </span>luke$<span class=\"w\"> </span>nix<span class=\"w\"> </span>develop\n<span class=\"m\">192</span>-168-1-105:roc<span class=\"w\"> </span>luke$<span class=\"w\"> </span>cargo<span class=\"w\"> </span>run<span class=\"w\"> </span>repl\n<span class=\"w\">   </span>Compiling<span class=\"w\"> </span>libc<span class=\"w\"> </span>v0.2.135\n<span class=\"w\">   </span><span class=\"o\">[]</span>...<span class=\"w\"> </span>deleted<span class=\"w\"> </span>extra<span class=\"w\"> </span>lines<span class=\"w\"> </span>...<span class=\"o\">[]</span>\n<span class=\"w\">   </span>Compiling<span class=\"w\"> </span>roc_docs<span class=\"w\"> </span>v0.0.1<span class=\"w\"> </span><span class=\"o\">(</span>/Users/luke/Documents/GitHub/roc/crates/docs<span class=\"o\">)</span>\n<span class=\"w\">    </span>Finished<span class=\"w\"> </span>dev<span class=\"w\"> </span><span class=\"o\">[</span>unoptimized<span class=\"w\"> </span>+<span class=\"w\"> </span>debuginfo<span class=\"o\">]</span><span class=\"w\"> </span>target<span class=\"o\">(</span>s<span class=\"o\">)</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span>1m<span class=\"w\"> </span>20s\n<span class=\"w\">     </span>Running<span class=\"w\"> </span><span class=\"sb\">`</span>target/debug/roc<span class=\"w\"> </span>repl<span class=\"sb\">`</span>\n\n<span class=\"w\">  </span>The<span class=\"w\"> </span>rockin’<span class=\"w\"> </span>roc<span class=\"w\"> </span>repl\n────────────────────────\n\nEnter<span class=\"w\"> </span>an<span class=\"w\"> </span>expression,<span class=\"w\"> </span>or<span class=\"w\"> </span>:help,<span class=\"w\"> </span>or<span class=\"w\"> </span>:q<span class=\"w\"> </span>to<span class=\"w\"> </span>quit.\n\n»<span class=\"w\"> </span><span class=\"m\">123</span>\n\n<span class=\"m\">123</span><span class=\"w\"> </span>:<span class=\"w\"> </span>Num<span class=\"w\"> </span>*<span class=\"w\">               </span><span class=\"c1\"># val1</span>\n</code></pre></div>",
        "id": 326510911,
        "sender_full_name": "Luke Boswell",
        "timestamp": 1675836438
    },
    {
        "content": "<p>I was able to get this working by deleting \"-no_fixup_chains\" from crates/compiler/build/src/link.rs line 1283! Looks like it was <a href=\"https://github.com/roc-lang/roc/commit/1164fb47677ac208876b2da687780865c9542ceb\">added in December</a>, so must have been before that when it was working for me.  I am also on MacOS 12.6 but with an intel chip by the way</p>",
        "id": 327000563,
        "sender_full_name": "Fred",
        "timestamp": 1676021321
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"343810\">Brendan Hansknecht</span> <a href=\"#narrow/stream/231634-beginners/topic/building.20from.20source/near/304271717\">said</a>:</p>\n<blockquote>\n<p><code>echo \"use nix\" &gt;&gt; .envrc</code></p>\n</blockquote>\n<p>is quite slow</p>\n<div class=\"codehilite\"><pre><span></span><code>$ cd roc\ndirenv: loading ~/git/roc-lang/roc/.envrc\ndirenv: using nix\ndirenv: ([/opt/homebrew/bin/direnv export zsh]) is taking a while to execute. Use CTRL-C to give up.\n</code></pre></div>\n<p>am I doing it right?</p>\n<div class=\"codehilite\"><pre><span></span><code>$ cat .envrc\nuse nix\nPATH_add target/debug\n</code></pre></div>",
        "id": 343934612,
        "sender_full_name": "choonkeat",
        "timestamp": 1679567968
    },
    {
        "content": "<p>The very first time is slow. Same with calling <code>nix develop</code> for the first time. After that, it should be cached and fast.</p>\n<p>Not sure about the second line though. What does it do? If it cause nix to reevaluate whenever <code>target/debug</code> changes, that may break caching, but i have never used the <code>PATH_add</code> command. So i am not truly sure.</p>",
        "id": 344011036,
        "sender_full_name": "Brendan Hansknecht",
        "timestamp": 1679584467
    },
    {
        "content": "<p>My full <code>.envrc</code> is:</p>\n<div class=\"codehilite\"><pre><span></span><code>use flake\nnix_direnv_watch_file rust-toolchain.toml\n</code></pre></div>",
        "id": 344011724,
        "sender_full_name": "Brendan Hansknecht",
        "timestamp": 1679584606
    },
    {
        "content": "<p>First line at some point changed from <code>use nix</code> to <code>use flake</code>. Both should work cause our <code>shell.nix</code> just points to the flake. Not sure the real difference</p>",
        "id": 344011964,
        "sender_full_name": "Brendan Hansknecht",
        "timestamp": 1679584661
    },
    {
        "content": "<p>The second line is so that when I change the rust version to nightly (which I need for fuzzing and some random other times), it will force a re-evaluation</p>",
        "id": 344012156,
        "sender_full_name": "Brendan Hansknecht",
        "timestamp": 1679584696
    },
    {
        "content": "<p>Also, just looked of <code>PATH_add</code>, yeah, should be harmless. So probably just a matter of waiting for the first invocation that has to download and set everything up.</p>",
        "id": 344012915,
        "sender_full_name": "Brendan Hansknecht",
        "timestamp": 1679584847
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"343810\">Brendan Hansknecht</span> <a href=\"#narrow/stream/231634-beginners/topic/building.20from.20source/near/344011964\">said</a>:</p>\n<blockquote>\n<p>First line at some point changed from <code>use nix</code> to <code>use flake</code>. Both should work cause our <code>shell.nix</code> just points to the flake. Not sure the real difference</p>\n</blockquote>\n<p>using <code>use nix</code>, it's slow every time (not just first time)<br>\nusing <code>use flake</code> fails:</p>\n<div class=\"codehilite\"><pre><span></span><code>$ cd roc\ndirenv: loading ~/git/roc-lang/roc/.envrc\ndirenv: using flake\n/bin/bash: eval:2231: conditional binary operator expected\n/bin/bash: eval:2231: syntax error near `enableParallelBuilding&#39;\n/bin/bash: eval:2231: `    if ! [[ -v enableParallelBuilding ]]; then&#39;\ndirenv: export +AR +AR_FOR_TARGET +AS +AS_FOR_TARGET +CC +CC_FOR_TARGET +CMAKE_FRAMEWORK_PATH +CMAKE_INCLUDE_PATH +CMAKE_LIBRARY_PATH +CMAKE_PREFIX_PATH +CONFIG_SHELL +CXX +CXX_FOR_TARGET +DETERMINISTIC_BUILD +HOST_PATH +IN_NIX_SHELL +LD +LD_DYLD_PATH +LD_FOR_TARGET +LD_LIBRARY_PATH +LLVM_SYS_130_PREFIX +MACOSX_DEPLOYMENT_TARGET +NIXPKGS_ALLOW_UNFREE +NIX_BINTOOLS +NIX_BINTOOLS_FOR_TARGET +NIX_BINTOOLS_WRAPPER_TARGET_HOST_aarch64_apple_darwin +NIX_BINTOOLS_WRAPPER_TARGET_TARGET_aarch64_apple_darwin +NIX_BUILD_CORES +NIX_CC +NIX_CC_FOR_TARGET +NIX_CC_WRAPPER_TARGET_HOST_aarch64_apple_darwin +NIX_CC_WRAPPER_TARGET_TARGET_aarch64_apple_darwin +NIX_CFLAGS_COMPILE +NIX_CFLAGS_COMPILE_FOR_TARGET +NIX_COREFOUNDATION_RPATH +NIX_DONT_SET_RPATH +NIX_DONT_SET_RPATH_FOR_BUILD +NIX_ENFORCE_NO_NATIVE +NIX_GLIBC_PATH +NIX_HARDENING_ENABLE +NIX_IGNORE_LD_THROUGH_GCC +NIX_INDENT_MAKE +NIX_LDFLAGS +NIX_LDFLAGS_FOR_TARGET +NIX_NO_SELF_RPATH +NIX_PKG_CONFIG_WRAPPER_TARGET_TARGET_aarch64_apple_darwin +NIX_STORE +NM +NM_FOR_TARGET +PATH_LOCALE +PKG_CONFIG_FOR_TARGET +PKG_CONFIG_PATH_FOR_TARGET +PYTHONHASHSEED +PYTHONNOUSERSITE +PYTHONPATH +RANLIB +RANLIB_FOR_TARGET +SIZE +SIZE_FOR_TARGET +SOURCE_DATE_EPOCH +STRINGS +STRINGS_FOR_TARGET +STRIP +STRIP_FOR_TARGET +XDG_DATA_DIRS +XML_CATALOG_FILES +__darwinAllowLocalNetworking +__impureHostDeps +__propagatedImpureHostDeps +__propagatedSandboxProfile +__sandboxProfile +__structuredAttrs +buildInputs +buildPhase +builder +cmakeFlags +configureFlags +depsBuildBuild +depsBuildBuildPropagated +depsBuildTarget +depsBuildTargetPropagated +depsHostHost +depsHostHostPropagated +depsTargetTarget +depsTargetTargetPropagated +doCheck +doInstallCheck +dontAddDisableDepTrack +mesonFlags +name +nativeBuildInputs +out +outputs +patches +phases +propagatedBuildInputs +propagatedNativeBuildInputs +shell +shellHook +stdenv +strictDeps +system ~PATH\n</code></pre></div>\n<p>so weird. probably my machine</p>\n<div class=\"codehilite\"><pre><span></span><code>$ nix --version\nnix (Nix) 2.13.3\n$ direnv version\n2.32.2\n</code></pre></div>",
        "id": 344400712,
        "sender_full_name": "choonkeat",
        "timestamp": 1679709850
    },
    {
        "content": "<p>I don't have an immediate idea. What happens when you disable direnv and run <code>nix develop</code>?</p>",
        "id": 344408249,
        "sender_full_name": "Brendan Hansknecht",
        "timestamp": 1679716024
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"343810\">Brendan Hansknecht</span> <a href=\"#narrow/stream/231634-beginners/topic/building.20from.20source/near/344408249\">said</a>:</p>\n<blockquote>\n<p>I don't have an immediate idea. What happens when you disable direnv and run <code>nix develop</code>?</p>\n</blockquote>\n<p>running <code>nix develop</code> without any <code>direnv</code> interference works great (i.e. <code>cargo build</code> works)</p>\n<p>just to close the loop: though I'd seen the notices about <code>old version of bash used in MacOS</code> everywhere but somehow my mind refused to follow the trail maybe because I'm using zsh?... but whatevs, I finally <code>brew install bash</code> and now <code>use flake</code> in my <code>.envrc</code> works and is super fast <span aria-label=\"tada\" class=\"emoji emoji-1f389\" role=\"img\" title=\"tada\">:tada:</span><span aria-label=\"face palm\" class=\"emoji emoji-1f926\" role=\"img\" title=\"face palm\">:face_palm:</span>‍♂️</p>",
        "id": 346290069,
        "sender_full_name": "choonkeat",
        "timestamp": 1680408617
    },
    {
        "content": "<p>Glad you found a workaround. Direnv can definitely work with zsh in Mac, but i guess it may hit whatever issue you had. Maybe the issue is with trying to load bash config into the zsh shell...no real idea.</p>",
        "id": 346304200,
        "sender_full_name": "Brendan Hansknecht",
        "timestamp": 1680418027
    },
    {
        "content": "<p>I'm not familiar with Cargo, is there a \"clean\" command I can run? Or can I just delete the <code>target/</code> folder?</p>",
        "id": 405363525,
        "sender_full_name": "Matthew Phillips",
        "timestamp": 1701437284
    },
    {
        "content": "<p><code>cargo clean</code> should delete all the temporary stuff, yeah</p>",
        "id": 405364017,
        "sender_full_name": "Richard Feldman",
        "timestamp": 1701437437
    },
    {
        "content": "<p>Hello, After a few tries I finally succeeded to build from source. There were warnings, but no more blocking errors. However, when I run <code>./target/debug/roc</code>, I got below message.</p>\n<p>\"Target triple (aarch64-unknown-freebsd) is not currently supported by the roc compiler.\"</p>\n<p>Is FreeBSD a no-go, or did I miss something? Thank you.</p>",
        "id": 438157187,
        "sender_full_name": "ZD",
        "timestamp": 1715489754
    },
    {
        "content": "<p>Probably would be easy to support</p>",
        "id": 438162145,
        "sender_full_name": "Brendan Hansknecht",
        "timestamp": 1715495462
    },
    {
        "content": "<p>We just don't have it in the compiler</p>",
        "id": 438162153,
        "sender_full_name": "Brendan Hansknecht",
        "timestamp": 1715495473
    },
    {
        "content": "<p>Like probably could just be mapped to Linux or a generic Unix. I don't think anything is special about it</p>",
        "id": 438162167,
        "sender_full_name": "Brendan Hansknecht",
        "timestamp": 1715495498
    },
    {
        "content": "<p>Noted, thank you</p>",
        "id": 438172908,
        "sender_full_name": "ZD",
        "timestamp": 1715507269
    }
]