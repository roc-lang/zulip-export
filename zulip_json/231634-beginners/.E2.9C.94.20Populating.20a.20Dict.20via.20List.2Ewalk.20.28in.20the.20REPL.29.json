[
    {
        "content": "<p>With the intention of performing much more complex dictionary updates (involving <code>Dict.update</code>), I'm currently stuck on the following:</p>\n<div class=\"codehilite\" data-code-language=\"Elm\"><pre><span></span><code><span class=\"nv\">list</span><span class=\"w\"> </span><span class=\"nf\">=</span><span class=\"w\"> </span><span class=\"p\">[</span><span class=\"s\">\"a\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"s\">\"b\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"s\">\"c\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"s\">\"d\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"s\">\"e\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"s\">\"f\"</span><span class=\"p\">]</span>\n\n<span class=\"cm\">{- [\"a\", \"b\", \"c\", \"d\", \"e\", \"f\"] : List Str-}</span>\n\n<span class=\"nv\">d</span><span class=\"w\"> </span><span class=\"nf\">=</span><span class=\"w\"> </span><span class=\"kt\">List</span><span class=\"nf\">.</span><span class=\"nv\">walkWithIndex</span><span class=\"w\"> </span><span class=\"nv\">list</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"kt\">Dict</span><span class=\"nf\">.</span><span class=\"nv\">empty</span><span class=\"w\"> </span><span class=\"p\">{})</span><span class=\"w\"> </span><span class=\"nf\">\\</span><span class=\"nv\">state</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"nv\">elem</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"nv\">i</span><span class=\"w\"> </span><span class=\"nf\">-&gt;</span><span class=\"w\"> </span><span class=\"kt\">Dict</span><span class=\"nf\">.</span><span class=\"nv\">insert</span><span class=\"w\"> </span><span class=\"nv\">state</span><span class=\"w\"> </span><span class=\"nv\">elem</span><span class=\"w\"> </span><span class=\"nv\">i</span>\n\n<span class=\"cm\">{- @Dict { buckets: [{ dataIndex: 5, distAndFingerprint: 466 </span><span class=\"err\">}</span><span class=\"cm\">, { dataIndex: 3, distAndFingerprint: 721 </span><span class=\"err\">}</span><span class=\"cm\">, { dataIndex: 4, distAndFingerprint: 977 </span><span class=\"err\">}</span><span class=\"cm\">, { dataIndex: 1, distAndFingerprint: 1231 </span><span class=\"err\">}</span><span class=\"cm\">, { dataIndex: 2, distAndFingerprint: 1487 </span><span class=\"err\">}</span><span class=\"cm\">, { dataIndex: 0, distAndFingerprint: 1634 </span><span class=\"err\">}</span><span class=\"cm\">, { dataIndex: 0, distAndFingerprint: 0 </span><span class=\"err\">}</span><span class=\"cm\">, { dataIndex: 0,</span>\n<span class=\"cm\">distAndFingerprint: 0 </span><span class=\"err\">}</span><span class=\"cm\">, { dataIndex: 0, distAndFingerprint: 0 </span><span class=\"err\">}</span><span class=\"cm\">, { dataIndex: 0, distAndFingerprint: 0 </span><span class=\"err\">}</span><span class=\"cm\">, { dataIndex: 0, distAndFingerprint: 0 </span><span class=\"err\">}</span><span class=\"cm\">, { dataIndex: 0, distAndFingerprint: 0 </span><span class=\"err\">}</span><span class=\"cm\">, { dataIndex: 0, distAndFingerprint: 0 </span><span class=\"err\">}</span><span class=\"cm\">, { dataIndex: 0, distAndFingerprint: 0 </span><span class=\"err\">}</span><span class=\"cm\">, { dataIndex: 0, distAndFingerprint: 0 </span><span class=\"err\">}</span><span class=\"cm\">, { dataIndex: 0, distAndFingerprint: 0 </span><span class=\"err\">}</span><span class=\"cm\">], data: [(\"a\", 0), (\"b\", 1), (\"c\", 2), (\"d\", 3), (\"e\", 4), (\"f\", 5)], maxBucketCapacity: 12, maxLoadFactor: 0.8, shifts: 60 </span><span class=\"err\">}</span><span class=\"cm\"> : Dict Str U64 -}</span>\n\n<span class=\"kt\">Dict</span><span class=\"nf\">.</span><span class=\"nv\">get</span><span class=\"w\"> </span><span class=\"nv\">d</span><span class=\"w\"> </span><span class=\"s\">\"c\"</span>\n\n<span class=\"cm\">{- Err KeyNotFound : Result U64 [KeyNotFound] -}</span>\n\n<span class=\"cm\">{- Tried alternatively with the following, but the effect was equivalent:</span>\n<span class=\"cm\">d = List.walkWithIndex list (Dict.empty {</span><span class=\"err\">}</span><span class=\"cm\">) \\state, elem, i -&gt; state |&gt; Dict.insert elem i -}</span>\n</code></pre></div>\n<p>whereas</p>\n<div class=\"codehilite\" data-code-language=\"Elm\"><pre><span></span><code><span class=\"nv\">d</span><span class=\"w\"> </span><span class=\"nf\">=</span>\n<span class=\"w\">     </span><span class=\"kt\">Dict</span><span class=\"nf\">.</span><span class=\"nv\">empty</span><span class=\"w\"> </span><span class=\"p\">{}</span>\n<span class=\"w\">     </span><span class=\"nf\">|&gt;</span><span class=\"w\"> </span><span class=\"kt\">Dict</span><span class=\"nf\">.</span><span class=\"nv\">insert</span><span class=\"w\"> </span><span class=\"s\">\"a\"</span><span class=\"w\"> </span><span class=\"mi\">0</span>\n<span class=\"w\">     </span><span class=\"nf\">|&gt;</span><span class=\"w\"> </span><span class=\"kt\">Dict</span><span class=\"nf\">.</span><span class=\"nv\">insert</span><span class=\"w\"> </span><span class=\"s\">\"b\"</span><span class=\"w\"> </span><span class=\"mi\">1</span>\n<span class=\"w\">     </span><span class=\"nf\">|&gt;</span><span class=\"w\"> </span><span class=\"kt\">Dict</span><span class=\"nf\">.</span><span class=\"nv\">insert</span><span class=\"w\"> </span><span class=\"s\">\"c\"</span><span class=\"w\"> </span><span class=\"mi\">2</span>\n<span class=\"w\">     </span><span class=\"nf\">|&gt;</span><span class=\"w\"> </span><span class=\"kt\">Dict</span><span class=\"nf\">.</span><span class=\"nv\">insert</span><span class=\"w\"> </span><span class=\"s\">\"d\"</span><span class=\"w\"> </span><span class=\"mi\">3</span>\n<span class=\"w\">     </span><span class=\"nf\">|&gt;</span><span class=\"w\"> </span><span class=\"kt\">Dict</span><span class=\"nf\">.</span><span class=\"nv\">insert</span><span class=\"w\"> </span><span class=\"s\">\"e\"</span><span class=\"w\"> </span><span class=\"mi\">4</span>\n<span class=\"w\">     </span><span class=\"nf\">|&gt;</span><span class=\"w\"> </span><span class=\"kt\">Dict</span><span class=\"nf\">.</span><span class=\"nv\">insert</span><span class=\"w\"> </span><span class=\"s\">\"f\"</span><span class=\"w\"> </span><span class=\"mi\">5</span>\n\n<span class=\"cm\">{- @Dict { buckets: [{ dataIndex: 3, distAndFingerprint: 497 </span><span class=\"err\">}</span><span class=\"cm\">, { dataIndex: 4, distAndFingerprint: 753 </span><span class=\"err\">}</span><span class=\"cm\">, { dataIndex: 5, distAndFingerprint: 1008 </span><span class=\"err\">}</span><span class=\"cm\">, { dataIndex: 2, distAndFingerprint: 1263 </span><span class=\"err\">}</span><span class=\"cm\">, { dataIndex: 1, distAndFingerprint: 1518 </span><span class=\"err\">}</span><span class=\"cm\">, { dataIndex: 0, distAndFingerprint: 1551 </span><span class=\"err\">}</span><span class=\"cm\">, { dataIndex: 0, distAndFingerprint: 0 </span><span class=\"err\">}</span><span class=\"cm\">, { dataIndex: 0, distAndFingerprint: 0 </span><span class=\"err\">}</span><span class=\"cm\">, { dataIndex: 0, distAndFingerprint: 0 </span><span class=\"err\">}</span><span class=\"cm\">, { dataIndex: 0, distAndFingerprint: 0 </span><span class=\"err\">}</span><span class=\"cm\">, { dataIndex: 0, distAndFingerprint: 0 </span><span class=\"err\">}</span><span class=\"cm\">, { dataIndex: 0, distAndFingerprint: 0 </span><span class=\"err\">}</span><span class=\"cm\">, { dataIndex: 0, distAndFingerprint: 0 </span><span class=\"err\">}</span><span class=\"cm\">, { dataIndex: 0, distAndFingerprint: 0 </span><span class=\"err\">}</span><span class=\"cm\">, { dataIndex: 0, distAndFingerprint: 0 </span><span class=\"err\">}</span><span class=\"cm\">, { dataIndex: 0, distAndFingerprint: 0 </span><span class=\"err\">}</span><span class=\"cm\">], data: [(\"a\", 0), (\"b\", 1), (\"c\", 2), (\"d\", 3), (\"e\", 4), (\"f\", 5)], maxBucketCapacity: 12, maxLoadFactor: 0.8, shifts: 60 </span><span class=\"err\">}</span><span class=\"cm\"> : Dict Str (Num *) -}</span>\n\n<span class=\"kt\">Dict</span><span class=\"nf\">.</span><span class=\"nv\">get</span><span class=\"w\"> </span><span class=\"nv\">d</span><span class=\"w\"> </span><span class=\"s\">\"c\"</span>\n\n<span class=\"cm\">{- Ok 2 : Result (Num *) [KeyNotFound] -}</span>\n</code></pre></div>\n<p>Please, note that equivalent behaviour is observed when utilising <code>List.walk</code> as well.</p>\n<p>Could somebody please point me to where the issue in my code is?<br>\nThank you for your time!</p>",
        "id": 425763416,
        "sender_full_name": "Hristo",
        "timestamp": 1710067681
    },
    {
        "content": "<p>Looks like a bug to me. I think these should produce the same thing.</p>",
        "id": 425764509,
        "sender_full_name": "Luke Boswell",
        "timestamp": 1710068755
    },
    {
        "content": "<p>Thank you for confirming! </p>\n<p>Yes, the data portions of those are indeed the same, and I'd expect equivalent behaviour as well ( I just wasn't sure if I was using the correct syntax, even though I tried multiple variations of positioning parentheses).</p>\n<p>I've been getting some odd functionality when trying to utilise <code>Dict.update</code> and (independently) when using <code>List</code> as the state.</p>\n<p>I'll raise a GitHub ticket about this when I get a chance.</p>",
        "id": 425764745,
        "sender_full_name": "Hristo",
        "timestamp": 1710068958
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"693045\">Hristo</span> has marked this topic as resolved.</p>",
        "id": 425792876,
        "sender_full_name": "Notification Bot",
        "timestamp": 1710094391
    },
    {
        "content": "<p>Just adding a bit more context - this only occurs in Roc's REPL.<br>\nIn traditionally compiled Roc, this hasn't been reproduced.</p>",
        "id": 425797618,
        "sender_full_name": "Hristo",
        "timestamp": 1710098060
    },
    {
        "content": "<p>Cool. So bug on the dev backend</p>",
        "id": 425799689,
        "sender_full_name": "Brendan Hansknecht",
        "timestamp": 1710099752
    }
]