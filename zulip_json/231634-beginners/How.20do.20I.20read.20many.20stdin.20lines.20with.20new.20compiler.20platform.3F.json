[
    {
        "content": "<p>I tried to create a small util that would read unknown beforehand amount of lines from stdin.  It reads, checks that the line is not a stop marker, and adds a line to a list.</p>\n<p>Not only was it agonizingly slow (about 470 lines per second), but it ran out of stack memory on line 3330. </p>\n<p>Was something wrong with my implementation?</p>\n<p>Here is my code:</p>\n<div class=\"codehilite\" data-code-language=\"roc\"><pre><span></span><code>app [main!] { pf: platform \"https://github.com/lukewilliamboswell/roc-platform-template-zig/releases/download/0.6/2BfGn4M9uWJNhDVeMghGeXNVDFijMfPsmmVeo6M4QjKX.tar.zst\" }\n\nimport pf.Stdout\n\nread_stdin_until! : Str, List(Str) =&gt; List(Str)\nread_stdin_until! = |break_str, buffer| {\n    new_line = Stdin.line!()\n    if new_line == break_str {\n        buffer\n    } else {\n        read_stdin_until!(break_str, buffer.append(new_line))\n    }\n}\n</code></pre></div>\n<p>Run result: <code>Roc crashed: This Roc program overflowed its stack memory. This usually means there is infinite recursion somewhere in the code.</code></p>\n<p>P.S. The file that I piped into my Roc app was small: about 25 Kb in total, ~4500 lines with 3-5 chars</p>",
        "id": 566246274,
        "sender_full_name": "Artem",
        "timestamp": 1767556717
    },
    {
        "content": "<p>Probably an interpretter bug in my opinion.</p>",
        "id": 566250211,
        "sender_full_name": "Brendan Hansknecht",
        "timestamp": 1767560724
    },
    {
        "content": "<p>The interpretter needs to be smart enough to do tail call optimization and avoid these kinds of stack overflows</p>",
        "id": 566250225,
        "sender_full_name": "Brendan Hansknecht",
        "timestamp": 1767560742
    },
    {
        "content": "<p>We dont have any TCO yet I believe</p>",
        "id": 566252768,
        "sender_full_name": "Luke Boswell",
        "timestamp": 1767563620
    },
    {
        "content": "<p>yeah TCO has not been ported over yet</p>",
        "id": 566256113,
        "sender_full_name": "Richard Feldman",
        "timestamp": 1767567717
    },
    {
        "content": "<p>I would normally start porting it, but I've already hit my Claude Max weekly limit halfway through the week, and rather than get a second account (which I did consider) I'm going to use this as a forcing function to spend my time on langref instead <span aria-label=\"laughing\" class=\"emoji emoji-1f606\" role=\"img\" title=\"laughing\">:laughing:</span></p>",
        "id": 566256286,
        "sender_full_name": "Richard Feldman",
        "timestamp": 1767567973
    },
    {
        "content": "<p>Do you guys maybe have any ideas on how to smuggle a file into Roc? I don't want to bring it as a list into the source .roc files because it's a matter of principle now. </p>\n<p>I assume that old file import syntax doesn't work on new compiler and since platform doesn't have files API, my only option is stdin. Is that correct? At this point I am considering concatenating all input into one huge line <span aria-label=\"sweat smile\" class=\"emoji emoji-1f605\" role=\"img\" title=\"sweat smile\">:sweat_smile:</span>. Or maybe read it in chunks to avoid stack growth</p>",
        "id": 566256894,
        "sender_full_name": "Artem",
        "timestamp": 1767568736
    },
    {
        "content": "<p>But I was curious, of course, about exotic and silly hacks</p>",
        "id": 566256934,
        "sender_full_name": "Artem",
        "timestamp": 1767568800
    },
    {
        "content": "<p>I think the old file import syntax works but I wouldn't swear to it <span aria-label=\"smile\" class=\"emoji emoji-1f604\" role=\"img\" title=\"smile\">:smile:</span></p>",
        "id": 566257446,
        "sender_full_name": "Richard Feldman",
        "timestamp": 1767569598
    },
    {
        "content": "<p>I'm on mobile but I recommend giving it a try!</p>",
        "id": 566257461,
        "sender_full_name": "Richard Feldman",
        "timestamp": 1767569609
    },
    {
        "content": "<p>Yeah I'm pretty sure we haven't implemented the import file stuff yet</p>",
        "id": 566261487,
        "sender_full_name": "Luke Boswell",
        "timestamp": 1767574751
    },
    {
        "content": "<p>Btw you can use basic-cli if you're happy to build the platform from source</p>",
        "id": 566261551,
        "sender_full_name": "Luke Boswell",
        "timestamp": 1767574764
    },
    {
        "content": "<p>Use this branch <a href=\"https://github.com/roc-lang/basic-cli/pull/413\">https://github.com/roc-lang/basic-cli/pull/413</a></p>",
        "id": 566261556,
        "sender_full_name": "Luke Boswell",
        "timestamp": 1767574780
    },
    {
        "content": "<p>I've just been working through some issues preventing us from completing the other effects, but I think I just solved it -- so hopefully those can migrate now too</p>",
        "id": 566261667,
        "sender_full_name": "Luke Boswell",
        "timestamp": 1767574831
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"281383\">Richard Feldman</span> <a href=\"#narrow/channel/231634-beginners/topic/How.20do.20I.20read.20many.20stdin.20lines.20with.20new.20compiler.20platform.3F/near/566256286\">said</a>:</p>\n<blockquote>\n<p>I would normally start porting it, but I've already hit my Claude Max weekly limit halfway through the week, and rather than get a second account (which I did consider) I'm going to use this as a forcing function to spend my time on langref instead <span aria-label=\"laughing\" class=\"emoji emoji-1f606\" role=\"img\" title=\"laughing\">:laughing:</span></p>\n</blockquote>\n<p>I use opus with copilot because copilot doesn't have usage limits, its not a horrible agent either</p>",
        "id": 566277780,
        "sender_full_name": "nandi",
        "timestamp": 1767590317
    },
    {
        "content": "<p>How does that work? like Opus does the thinking/reasoning and copilot does the tasks?</p>",
        "id": 566277827,
        "sender_full_name": "Luke Boswell",
        "timestamp": 1767590369
    },
    {
        "content": "<p>yeah it's like claude code but its a copilot binary instead of a claude code binary <a href=\"https://github.com/github/copilot-cli\">https://github.com/github/copilot-cli</a></p>",
        "id": 566277928,
        "sender_full_name": "nandi",
        "timestamp": 1767590472
    },
    {
        "content": "<p>Cool, I'll give that a try when I hit my daily usage limit <span aria-label=\"smile\" class=\"emoji emoji-1f604\" role=\"img\" title=\"smile\">:smile:</span></p>",
        "id": 566278023,
        "sender_full_name": "Luke Boswell",
        "timestamp": 1767590572
    },
    {
        "content": "<p>There is a monthly limit and then they charge you but I've hit the monthly multiple months in a row and it just keeps going without ending I dunno if a bug or what. I'm trying not to publicize it too much in case they decide to fix it heh</p>\n<p><a href=\"/user_uploads/22008/zfkpJ3RiG_tc89BITR1tpY8u/image.png\">image.png</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/22008/zfkpJ3RiG_tc89BITR1tpY8u/image.png\" title=\"image.png\"><img data-original-content-type=\"image/png\" data-original-dimensions=\"967x240\" src=\"/user_uploads/thumbnail/22008/zfkpJ3RiG_tc89BITR1tpY8u/image.png/840x560.webp\"></a></div>",
        "id": 566278210,
        "sender_full_name": "nandi",
        "timestamp": 1767590730
    },
    {
        "content": "<p><a href=\"/user_uploads/22008/Go84InZFhyaf1fCAxUyH1OtH/image.png\">image.png</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/22008/Go84InZFhyaf1fCAxUyH1OtH/image.png\" title=\"image.png\"><img data-original-content-type=\"image/png\" data-original-dimensions=\"925x161\" src=\"/user_uploads/thumbnail/22008/Go84InZFhyaf1fCAxUyH1OtH/image.png/840x560.webp\"></a></div>",
        "id": 566278446,
        "sender_full_name": "nandi",
        "timestamp": 1767590942
    },
    {
        "content": "<p>I've got it up to over 400% last month</p>",
        "id": 566278544,
        "sender_full_name": "nandi",
        "timestamp": 1767591034
    },
    {
        "content": "<p>turns out their billing UX is just bad, lol got charged 100 bucks for last month usage. Not horrible but still not what I was wanting lol.</p>",
        "id": 566418571,
        "sender_full_name": "nandi",
        "timestamp": 1767638943
    }
]