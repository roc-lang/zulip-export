[
    {
        "content": "<p>Hello all,</p>\n<p>I am dipping my toes with the new compiler and I hit something strange, not knowing if it's me not understanding something obvious with the new syntax or if I've hit a bug/unimplemented feature.</p>\n<p>Context: I am using the latest <em>basic_cli</em> with the recommended nightly build of <em>roc</em> (although I get the same error with the latest, along with others).</p>\n<p>I've identified the part I don't understand within the code which is in the <em>walk_directory!</em> method:</p>\n<div class=\"codehilite\" data-code-language=\"Text only\"><pre><span></span><code>app [main!] { pf: platform \"../roc-new-compiler/basic-cli/platform/main.roc\"}\n\nimport pf.Stdout\nimport pf.Dir\n\nmain! = |args| {\n\n    root_paths = List.drop_first(args, 1).take_first(1)\n    dirs = fold!(root_paths, [], walk_directory!)\n\n    Stdout.line!(Str.inspect(dirs))\n\n    Ok({})\n}\n\nfold! : List(item), state, (state, item =&gt; state) =&gt; state\nfold! = |list, init, step| {\n    var $state = init\n\n    for item in list {\n        $state = step($state, item)\n    }\n\n    $state\n}\n\nwalk_directory! : List(Str), Str =&gt; List(Str)\nwalk_directory! = |paths, root_path| {\n    children = match Dir.list!(root_path) {\n        Ok(new_paths) =&gt; new_paths\n        Err(_) =&gt; []\n    }\n\n    end_state = fold!(children, {files: [], directories: []},\n\n            # This doesn't work:\n            #\n            # |state, _path|\n            #     full_path = \"A file name\"\n            #     {..state, files: List.append(state.files, full_path)}\n\n            # But this does works :\n            |state, _path|\n                {..state, files: List.append(state.files, \"A file name\")}\n        )\n\n    List.concat(paths, end_state.files)\n}\n</code></pre></div>\n<p>With the chunk of code uncommented I get this error:</p>\n<div class=\"codehilite\" data-code-language=\"Text only\"><pre><span></span><code>-- PARSE ERROR -----------------------------------\n\nA parsing error occurred: expected_expr_apply_close_round\nThis is an unexpected parsing error. Please check your syntax.\n\n   ┌─ main.roc:34:17\n   │\n34 │     end_state = fold!(children, {files: [], directories: []},\n   │                 ^^^^^\n\n-- UNEXPECTED TOKEN IN EXPRESSION ----------------\n\nThe token ) is not expected in an expression.\nExpressions can be identifiers, literals, function calls, or operators.\n\n   ┌─ main.roc:45:9\n   │\n45 │         )\n   │         ^\n</code></pre></div>",
        "id": 574412888,
        "sender_full_name": "Claude Précourt",
        "timestamp": 1771376982
    },
    {
        "content": "<p>The issue with this is you are missing the block expression I think</p>\n<div class=\"codehilite\"><pre><span></span><code># no block\n|state, _path|\n    full_path = &quot;A file name&quot;\n    {..state, files: List.append(state.files, full_path)}\n\n# with block\n|state, _path| {\n    full_path = &quot;A file name&quot;\n    {..state, files: List.append(state.files, full_path)}\n}\n</code></pre></div>",
        "id": 574413945,
        "sender_full_name": "Luke Boswell",
        "timestamp": 1771377581
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"928710\">Claude Précourt</span> has marked this topic as resolved.</p>",
        "id": 574414508,
        "sender_full_name": "Notification Bot",
        "timestamp": 1771377950
    },
    {
        "content": "<p>Exactly! It <em>felt</em> like a simple mistake... Thank you so much!</p>",
        "id": 574414578,
        "sender_full_name": "Claude Précourt",
        "timestamp": 1771378013
    },
    {
        "content": "<p>I feel like we had a rough plan for detecting this exact syntax error and providing a more helpful error message... but I can't remember.</p>",
        "id": 574414889,
        "sender_full_name": "Luke Boswell",
        "timestamp": 1771378245
    },
    {
        "content": "<p>I imagine it is difficult to solve in a really general way, so I feel like it was a heuristic trial and error thing</p>",
        "id": 574414935,
        "sender_full_name": "Luke Boswell",
        "timestamp": 1771378285
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"453336\">@Joshua Warner</span> can you remember if we had a plan for this?</p>",
        "id": 574414947,
        "sender_full_name": "Luke Boswell",
        "timestamp": 1771378300
    },
    {
        "content": "<p>Roughly: track indentation and use that as a hint in the parser, but only for error code paths (never the happy path)</p>",
        "id": 574415131,
        "sender_full_name": "Joshua Warner",
        "timestamp": 1771378436
    },
    {
        "content": "<p>I also have a pet project idea to train a tiny languages model of like 20m parameters that knows how to fix a variety of syntax errors, is well within the range that can be cheaply inferenced locally, and can just ship with the compiler.</p>",
        "id": 574415290,
        "sender_full_name": "Joshua Warner",
        "timestamp": 1771378541
    },
    {
        "content": "<p>Generally bullish on the approach of having a significant corpus of roc code, with a way to introduce real syntax errors in ways that the fix remains “obvious” by looking at a small amount of context. Then you use that to either train a model, or tune a bunch of heuristics (possibly automatically), etc.</p>",
        "id": 574415616,
        "sender_full_name": "Joshua Warner",
        "timestamp": 1771378778
    },
    {
        "content": "<p>Would it be worth putting anything together about this in a GH Issue so we can track it -- even if it's only an R&amp;D concept at this stage?</p>",
        "id": 574415925,
        "sender_full_name": "Luke Boswell",
        "timestamp": 1771379007
    },
    {
        "content": "<p>It sounds like a generally interesting problem someone may want to pick up -- if you haven't already called dibbs <span class=\"user-mention\" data-user-id=\"453336\">@Joshua Warner</span></p>",
        "id": 574416068,
        "sender_full_name": "Luke Boswell",
        "timestamp": 1771379077
    },
    {
        "content": "<p>It’s wide open! Happy to mentor someone a bit, but my time is incredibly limited currently.</p>",
        "id": 574416150,
        "sender_full_name": "Joshua Warner",
        "timestamp": 1771379141
    }
]