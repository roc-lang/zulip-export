[
    {
        "content": "<p>Hello,<br>\nI am coming from nodes/js/ts environment and just stumble upon Roc.</p>\n<p>I am sorry for being stupid, but I somehow cannot wrap my head about the relationship between core Roc lang and platform. How is it comparable to other languages where you typically have the lang itself, some standard library and various frameworks on top of that?</p>\n<p>Also as I understand from few posts, Roc on its own cannot handle IO and is reliant on platform. Isn't it quite limiting to not have such important feature in the basic package? Is there some strong reason to have it this way?</p>",
        "id": 467735054,
        "sender_full_name": "Michal Timko",
        "timestamp": 1725518746
    },
    {
        "content": "<p>G'day <span class=\"user-mention\" data-user-id=\"748533\">@Michal Timko</span> , welcome <span aria-label=\"wave\" class=\"emoji emoji-1f44b\" role=\"img\" title=\"wave\">:wave:</span> </p>\n<p>Have you seen this guide? <a href=\"https://www.roc-lang.org/platforms\">https://www.roc-lang.org/platforms</a></p>",
        "id": 467737773,
        "sender_full_name": "Luke Boswell",
        "timestamp": 1725519601
    },
    {
        "content": "<p>I read through that. <br>\nIt looks like platform is something like both external library and interface between Roc and another lang, that actually compile some executable from the code.</p>\n<p>But the it raise another questions like if it doesn't make Roc just nice interface for Rust and what is possible to do with Roc without platform (can I even compile it to executable without platform?)</p>\n<p>So for me is unclear what type of entity the platform is and what I can expect from it. But maybe when i try to build something, it will start making sense.</p>",
        "id": 467740321,
        "sender_full_name": "Michal Timko",
        "timestamp": 1725520215
    },
    {
        "content": "<p>Yeah, I definitely recommend you try roc out. Maybe checkout the basic-cli and basic-webserver first. You could then also look at roc-wasm4 (a game platform), or one of the others.</p>",
        "id": 467740714,
        "sender_full_name": "Luke Boswell",
        "timestamp": 1725520335
    },
    {
        "content": "<p>My background is web developer, so my first intuition is \"how to build server with this?\"<br>\nAnd when I read a bit about platforms and the IO limitations, second question was \"Can I build https server with this, if I need both web based api and IO in one platform?\"</p>\n<p>So I will see, what I can do.</p>",
        "id": 467742017,
        "sender_full_name": "Michal Timko",
        "timestamp": 1725520667
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"748533\">@Michal Timko</span> I think Roc's platforms make more explicit the relationship we have to lower level languages. The reason we use JS to write webservers is because we don't want to think about how to do stuff like manage memory or access resources, we want a PL that has done that adequately for us.</p>",
        "id": 467745191,
        "sender_full_name": "Sam Mohr",
        "timestamp": 1725521342
    },
    {
        "content": "<p>Roc functions as a language that is easy to write in and think about, and actively talks to someone else for the important stuff. But I'd rather write my logic in an easy language like Roc and have Rust do the hard stuff that needs to be done particularly and efficiently</p>",
        "id": 467745490,
        "sender_full_name": "Sam Mohr",
        "timestamp": 1725521413
    },
    {
        "content": "<p>JS doesn't go quite as far, but there are a lot of \"performance critical\" libs written in C that get wrapped in JS. Platforms work a similar way to that FFI</p>",
        "id": 467745693,
        "sender_full_name": "Sam Mohr",
        "timestamp": 1725521488
    },
    {
        "content": "<p>Shameless plug for my demo app <a href=\"https://github.com/lukewilliamboswell/roc-htmx-tailwindcss-demo\">https://github.com/lukewilliamboswell/roc-htmx-tailwindcss-demo</a></p>",
        "id": 467748533,
        "sender_full_name": "Luke Boswell",
        "timestamp": 1725522252
    },
    {
        "content": "<p>If you're coming from a web background, and looking for something to hack around with... you're welcome to play with that and if you want to make a PR with any features I'd be happy to review.</p>",
        "id": 467748663,
        "sender_full_name": "Luke Boswell",
        "timestamp": 1725522291
    },
    {
        "content": "<p>The goal of that demo is to be a good starting point for building web apps with roc, and demonstrate how to use familiar technologies like htmx and tailwindcss. </p>\n<p>There's a lot more we could add in there, I just get distracted easily with other things <span aria-label=\"smiley\" class=\"emoji emoji-1f603\" role=\"img\" title=\"smiley\">:smiley:</span></p>",
        "id": 467748920,
        "sender_full_name": "Luke Boswell",
        "timestamp": 1725522359
    },
    {
        "content": "<p>Thank you,<br>\nwill look into it.</p>",
        "id": 467749154,
        "sender_full_name": "Michal Timko",
        "timestamp": 1725522415
    },
    {
        "content": "<blockquote>\n<p>Can I build https server with this, if I need both web based api and IO in one platform?</p>\n</blockquote>\n<p><a href=\"https://github.com/roc-lang/basic-webserver\">basic-webserver</a> has both, it support for example <a href=\"https://roc-lang.github.io/basic-webserver/File/#write\">File.write</a>, <a href=\"https://roc-lang.github.io/basic-webserver/Stdout/#line\">Stdout.line</a> and <a href=\"https://roc-lang.github.io/basic-webserver/Http/#get\">Http.get</a>, ...</p>",
        "id": 468070292,
        "sender_full_name": "Anton",
        "timestamp": 1725600178
    },
    {
        "content": "<p>Yeah...I already realize it too. It just that in one speech Feldman mention something along the line that you probably don't need IO for web based apps, so I just assume that web oriented platforms are without IO...silly me.</p>",
        "id": 468080906,
        "sender_full_name": "Michal Timko",
        "timestamp": 1725603585
    },
    {
        "content": "<p>I am writing a basic platform that calls into libsecp256k1 to do some crypto stuff.  I have a platform/host.c  with some LLM help.  it seems like there is a naming convention like roc_fx_blah that allows calling C functions from Roc.  is this documented?</p>",
        "id": 568083316,
        "sender_full_name": "Rick Hull",
        "timestamp": 1768426034
    },
    {
        "content": "<p>Tell me where I'm wrong:   in modern platform Roc, i would create a function signature, within a module, named with an exclamation mark.  this means impure (does it directly imply it's a host-implemented function?).  all calls into the host are impure.  if roc sees this with no def, it will construct a symbol based on the function name, and try to call that symbol.  If I had module Rick, function hull!, then roc constructs roc_fx_rickHull   (note the casing and lack of underscores) and I would need to have this defined in my host.c</p>",
        "id": 568086856,
        "sender_full_name": "Rick Hull",
        "timestamp": 1768427546
    },
    {
        "content": "<p>i ran glm on codebase and this is what it said:</p>\n<p>There's a Zig-based platform in test-platform-effects-zig/host.zig. Looking at the code, the function naming follows<br>\n   the same convention:</p>\n<p>The naming convention is:<br>\n   •  Strip the ! from the Roc function name<br>\n   •  Prefix with roc_fx_<br>\n   •  No CamelCase conversion - underscores stay as-is</p>\n<p>Examples from the Zig host:</p>\n<p>zig<br>\n     pub export fn roc_fx_get_line() str.RocStr { ... }<br>\n     pub export fn roc_fx_put_line(rocPath: *str.RocStr) i64 { ... }<br>\n     pub export fn roc_fx_get_int() GetInt { ... }<br>\n     pub export fn roc_fx_id_effectful(input_num: u64) u64 { ... }</p>\n<p>So if you had a Roc module with Rick.hull!, the Zig host would define:</p>\n<p>zig<br>\n     pub export fn roc_fx_hull(...) {<br>\n         // your implementation<br>\n     }</p>\n<p>The key points:</p>\n<p>1. <code>!</code> suffix = impure function (side effects)<br>\n   2. <code>roc_fx_</code> prefix = foreign function that Roc calls<br>\n   3. No casing conversion - original identifier name is preserved<br>\n   4. Must be marked pub export in Zig to be callable from Roc</p>",
        "id": 568089874,
        "sender_full_name": "nandi",
        "timestamp": 1768428903
    },
    {
        "content": "<p>The calling convention is documented in <a href=\"https://github.com/roc-lang/roc/blob/2ca9919d86d429751149bd8877e57e9ecbc7243f/src/builtins/host_abi.zig\">https://github.com/roc-lang/roc/blob/2ca9919d86d429751149bd8877e57e9ecbc7243f/src/builtins/host_abi.zig</a></p>",
        "id": 568089934,
        "sender_full_name": "Luke Boswell",
        "timestamp": 1768428923
    },
    {
        "content": "<p>A type module with an annotation only definition is a \"hosted effect\".</p>",
        "id": 568090040,
        "sender_full_name": "Luke Boswell",
        "timestamp": 1768428961
    },
    {
        "content": "<p>Ah... are you talking about the new compiler or the old rust one?</p>",
        "id": 568090168,
        "sender_full_name": "Luke Boswell",
        "timestamp": 1768429020
    },
    {
        "content": "<p>They're quite different</p>",
        "id": 568090181,
        "sender_full_name": "Luke Boswell",
        "timestamp": 1768429027
    },
    {
        "content": "<p>Host calling into Roc -- these are the entrypoints which are defined in the platform header \"provides\" section</p>\n<p>Roc calling back into Host -- these are the hosted effects, i.e. functions without definition like <code>hull! : Str =&gt; {}</code></p>",
        "id": 568090452,
        "sender_full_name": "Luke Boswell",
        "timestamp": 1768429140
    },
    {
        "content": "<p>Thanks, this is helpful!  so the module name is no longer included?  I suppose I am asking about hosted effects.  also, I am currently using C and gcc on the host side.  i haven't actually installed roc yet, heh</p>",
        "id": 568093497,
        "sender_full_name": "Rick Hull",
        "timestamp": 1768430473
    },
    {
        "content": "<p><a href=\"https://gist.github.com/rickhull/e4ae108e4f00de5582f37689146003c0\">https://gist.github.com/rickhull/e4ae108e4f00de5582f37689146003c0</a>    how does this look?</p>",
        "id": 568093759,
        "sender_full_name": "Rick Hull",
        "timestamp": 1768430627
    },
    {
        "content": "<p>also, where does the zig (rust?) for basic-cli live?  i was looking for e.g. platform/host.zig     is that an old convention?</p>",
        "id": 568094442,
        "sender_full_name": "Rick Hull",
        "timestamp": 1768431034
    },
    {
        "content": "<p>The basic-cli platform is still in the process of being migrated to the new compiler, you can see the work here <a href=\"https://github.com/roc-lang/basic-cli/pull/413\">https://github.com/roc-lang/basic-cli/pull/413</a></p>\n<p>My <a href=\"https://github.com/lukewilliamboswell/roc-platform-template-zig\">roc-platform-template-zig</a> and <a href=\"https://github.com/lukewilliamboswell/roc-platform-template-rust\">roc-platform-template-rust</a> are both already upgraded to the new compiler.</p>",
        "id": 568094696,
        "sender_full_name": "Luke Boswell",
        "timestamp": 1768431173
    },
    {
        "content": "<p>Yes the <code>module</code> keyword has been deprecated. We now use \"type modules\" which are centered around a single nominal type with associated functions, like </p>\n<div class=\"codehilite\"><pre><span></span><code>Sqlite := [].{\n    ...\n}\n</code></pre></div>",
        "id": 568094801,
        "sender_full_name": "Luke Boswell",
        "timestamp": 1768431253
    },
    {
        "content": "<p>All of your syntax is for the old rust compiler... are you wanting to write a platform for that or the new compiler?</p>",
        "id": 568094862,
        "sender_full_name": "Luke Boswell",
        "timestamp": 1768431303
    },
    {
        "content": "<p>the new compiler is more fun, join us <span aria-label=\"rolling on the floor laughing\" class=\"emoji emoji-1f923\" role=\"img\" title=\"rolling on the floor laughing\">:rolling_on_the_floor_laughing:</span></p>",
        "id": 568095253,
        "sender_full_name": "nandi",
        "timestamp": 1768431519
    },
    {
        "content": "<p>I think I should probably keep it simple and use whatever is most documented.  i might then migrate to the new compiler.  it won't be much code</p>",
        "id": 568118519,
        "sender_full_name": "Rick Hull",
        "timestamp": 1768447180
    },
    {
        "content": "<p>I'd recommend the new compiler, it's a much more sane experience for platform authors.</p>",
        "id": 568119974,
        "sender_full_name": "Luke Boswell",
        "timestamp": 1768448524
    },
    {
        "content": "<p>what are some good approaches for length validation?  for example, a 32 byte SHA256 result.  my current understanding is this would commonly be represented as List U8.  I have come up with a way to make a Digest type that does some length validation.  basically an opaque type, accompanied by a constructor function that does the validation.</p>",
        "id": 568129874,
        "sender_full_name": "Rick Hull",
        "timestamp": 1768456432
    },
    {
        "content": "<p>If I wanted to guarantee something was a fixed size, I would use a nominal record </p>\n<div class=\"codehilite\"><pre><span></span><code>SHA256 :: {\n    field1: U8,\n    field2: U8,\n    field3: U8,\n    field4: U8,\n    field5: U8,\n    ....\n}.{\n    ## put methods here to work with etc\n}\n</code></pre></div>",
        "id": 568130009,
        "sender_full_name": "Luke Boswell",
        "timestamp": 1768456570
    },
    {
        "content": "<p>Another advantage of this over a list is that it isn't refcounted</p>",
        "id": 568130183,
        "sender_full_name": "Luke Boswell",
        "timestamp": 1768456745
    },
    {
        "content": "<p>hmmm, i would never want to address the individual fields.  but this is interesting.</p>",
        "id": 568130199,
        "sender_full_name": "Rick Hull",
        "timestamp": 1768456752
    },
    {
        "content": "<p>i am calling into libsecp256k1; is it sensible to stick with C, or should I try Zig?  I am a bad C programmer ;)</p>",
        "id": 568130436,
        "sender_full_name": "Rick Hull",
        "timestamp": 1768456909
    },
    {
        "content": "<p>zig zig zig</p>",
        "id": 568130630,
        "sender_full_name": "nandi",
        "timestamp": 1768457018
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"515757\">@Luke Boswell</span> can I strongly request that your platform templates be added to: <a href=\"https://www.roc-lang.org/platforms\">https://www.roc-lang.org/platforms</a>   where it says:</p>\n<blockquote>\n<p>Anyone can implement their own platform. There isn't yet an official guide about how to do this, so the best way to get help if you'd like to create a platform is to <a href=\"#narrow/stream/231634-beginners\">say hi in the <code>#beginners</code> channel</a> on <a href=\"https://roc.zulipchat.com/\">Roc Zulip!</a></p>\n</blockquote>",
        "id": 568352333,
        "sender_full_name": "Rick Hull",
        "timestamp": 1768535600
    },
    {
        "content": "<p>I will improve the docs there</p>",
        "id": 568390888,
        "sender_full_name": "Anton",
        "timestamp": 1768555776
    },
    {
        "content": "<p><a href=\"https://github.com/roc-lang/www.roc-lang.org/pull/46\">https://github.com/roc-lang/www.roc-lang.org/pull/46</a></p>",
        "id": 568392072,
        "sender_full_name": "Anton",
        "timestamp": 1768556156
    },
    {
        "content": "<p>I am still working on my libsecp256k1 platform, but I started from roc-platform-template-zig this time, and I'm using the latest nightly compiler.  however, I am getting a lot of weird errors that don't agree with the tutorial or stdlib.  e.g.</p>\n<p>Error: Exit code 1<br>\n     roc hello_world.roc<br>\n     -- DOES NOT EXIST --------------------------------</p>\n<div class=\"codehilite\"><pre><span></span><code> Num.to_str does not exist.\n\n    ┌─ hello_world.roc:19:36\n    │\n 19 │     Stdout.line!(&quot;pubkey length: ${Num.to_str(len)}&quot;)\n    │                                    ^^^^^^^^^^\n</code></pre></div>",
        "id": 568446253,
        "sender_full_name": "Rick Hull",
        "timestamp": 1768573462
    },
    {
        "content": "<p><a href=\"https://gist.github.com/rickhull/7e3c2468f2327853d29b00391824cf63\">https://gist.github.com/rickhull/7e3c2468f2327853d29b00391824cf63</a>    why might this be happening?</p>",
        "id": 568450855,
        "sender_full_name": "Rick Hull",
        "timestamp": 1768574661
    },
    {
        "content": "<p>The tutorial and stdlib docs are for roc alpha 4, for the new nightlies you can look at:</p>\n<ul>\n<li><a href=\"https://github.com/roc-lang/roc/blob/main/src/build/roc/Builtin.roc\">https://github.com/roc-lang/roc/blob/main/src/build/roc/Builtin.roc</a></li>\n<li><a href=\"https://github.com/roc-lang/roc/blob/main/test/fx/all_syntax_test.roc\">https://github.com/roc-lang/roc/blob/main/test/fx/all_syntax_test.roc</a></li>\n</ul>",
        "id": 568451937,
        "sender_full_name": "Anton",
        "timestamp": 1768574974
    },
    {
        "content": "<p>I see -- and this implied by the redirect URL.     now, it looks like I have roc-src on one commit (from Jan 1) but my compiler is from Jan 15.  going to fix this and retry with the proper builtin calls</p>",
        "id": 568452731,
        "sender_full_name": "Rick Hull",
        "timestamp": 1768575194
    },
    {
        "content": "<p>If you are using the nightly compiler from <a href=\"https://github.com/roc-lang/nightlies/releases\">https://github.com/roc-lang/nightlies/releases</a> you probably do not need roc-src as well</p>",
        "id": 568453519,
        "sender_full_name": "Anton",
        "timestamp": 1768575406
    },
    {
        "content": "<p>I think Luke used roc-src for easy debugging</p>",
        "id": 568453718,
        "sender_full_name": "Anton",
        "timestamp": 1768575458
    },
    {
        "content": "<p>to what extent is the tutorial specific to alpha-4?  is it just the builtin calls or is it more subtle?</p>",
        "id": 568454840,
        "sender_full_name": "Rick Hull",
        "timestamp": 1768575721
    },
    {
        "content": "<p>It's quite broad, alpha4 has different syntax, different features, different builtins. For a quick comparison between alpha4 and the new compiler(=nightlies) you can check <a href=\"https://github.com/roc-lang/roc/blob/main/test/fx/all_syntax_test.roc\">https://github.com/roc-lang/roc/blob/main/test/fx/all_syntax_test.roc</a> vs <a href=\"https://github.com/roc-lang/examples/blob/main/examples/AllSyntax/main.roc\">https://github.com/roc-lang/examples/blob/main/examples/AllSyntax/main.roc</a> (alpha4)</p>",
        "id": 568457525,
        "sender_full_name": "Anton",
        "timestamp": 1768576445
    },
    {
        "content": "<p>What do we think about possibly adopting Just (justfile) instead of shell scripts?  I have only just started using it (heh), and I've found it fantastically easy and helpful.   for example, instead of <code>roc-platform-template-zig/bundle.sh</code>    there would be a <code>just bundle</code> task.  instead of <code>ci/all_test.sh</code>, <code>just ci</code><br>\nI understand that it's not desirable to force tooling like this on users, but it seems like a nicer fit for my own projects</p>",
        "id": 568496021,
        "sender_full_name": "Rick Hull",
        "timestamp": 1768587442
    },
    {
        "content": "<p>Just does not come pre-installed on github CI, that's already adding more friction than I would like. Also, I would like to convert the sh scripts to Roc scripts once basic-cli is ported for the new compiler and works well enough. Roc does not come pre-installed on CI but it's good to test our own stuff in the real world :)</p>",
        "id": 568499712,
        "sender_full_name": "Anton",
        "timestamp": 1768588678
    },
    {
        "content": "<p>good to know.  i see that Just also executes each line in its own shell environment, so complex scripts are not suited.  I haven't looked at build.roc but I have come across it.  and I am also using build.zig.zon    so, many things overlap.  what is the story with build.roc ?</p>",
        "id": 568499995,
        "sender_full_name": "Rick Hull",
        "timestamp": 1768588768
    },
    {
        "content": "<p>isn't there some way to specify some existing tools in the GH CI environment, like in a cached image or something?</p>",
        "id": 568500218,
        "sender_full_name": "Rick Hull",
        "timestamp": 1768588856
    },
    {
        "content": "<blockquote>\n<p>what is the story with build.roc ?</p>\n</blockquote>\n<p>build.roc should be in charge of building the platform. old Roc did not work well on windows so you may see e.g. .sh files instead.</p>",
        "id": 568501126,
        "sender_full_name": "Anton",
        "timestamp": 1768589194
    },
    {
        "content": "<p>what about testing conventions?  I am vaguely aware of the <code>expect</code> keyword.  in my case, I am working on a platform first, so my question is maybe oriented around platforms.  i am tempted to make e.g. test/host.roc to test functions in the Host module.  I have also seen examples/test.roc</p>",
        "id": 568501315,
        "sender_full_name": "Rick Hull",
        "timestamp": 1768589260
    },
    {
        "content": "<blockquote>\n<p>isn't there some way to specify some existing tools in the GH CI environment, like in a cached image or something?</p>\n</blockquote>\n<p>github cache space is precious with only 10 GB which is easily filled with all the different systems we have to support.</p>",
        "id": 568501379,
        "sender_full_name": "Anton",
        "timestamp": 1768589286
    },
    {
        "content": "<p>i know this is a bad idea, but I wonder if we should use a different forge as the central repo, or even run our own.  and mirror to GH.  I can imagine it just adds operational headache and expense</p>",
        "id": 568501815,
        "sender_full_name": "Rick Hull",
        "timestamp": 1768589429
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"780900\">Rick Hull</span> <a href=\"#narrow/channel/231634-beginners/topic/Platform.20basics/near/568501315\">said</a>:</p>\n<blockquote>\n<p>what about testing conventions?  I am vaguely aware of the <code>expect</code> keyword.  in my case, I am working on a platform first, so my question is maybe oriented around platforms.  i am tempted to make e.g. test/host.roc to test functions in the Host module.  I have also seen examples/test.roc</p>\n</blockquote>\n<p>For end-to-end integration tests I typically use expect: <a href=\"https://github.com/roc-lang/basic-cli/blob/main/ci/expect_scripts/bytes-stdin-stdout.exp\">https://github.com/roc-lang/basic-cli/blob/main/ci/expect_scripts/bytes-stdin-stdout.exp</a> . I also want to replace that with Roc when possible though.</p>\n<p>Example for unit tests: <a href=\"https://github.com/roc-lang/basic-cli/blob/b5bc8ba9435633cd4aeea28d116127eeaea818d2/platform/Url.roc#L513\">https://github.com/roc-lang/basic-cli/blob/b5bc8ba9435633cd4aeea28d116127eeaea818d2/platform/Url.roc#L513</a></p>",
        "id": 568502202,
        "sender_full_name": "Anton",
        "timestamp": 1768589556
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"780900\">Rick Hull</span> <a href=\"#narrow/channel/231634-beginners/topic/Platform.20basics/near/568501815\">said</a>:</p>\n<blockquote>\n<p>i know this is a bad idea, but I wonder if we should use a different forge as the central repo, or even run our own.  and mirror to GH.  I can imagine it just adds operational headache and expense</p>\n</blockquote>\n<p>It's hard to beat free CI <span aria-label=\"smile\" class=\"emoji emoji-1f604\" role=\"img\" title=\"smile\">:smile:</span></p>",
        "id": 568502692,
        "sender_full_name": "Anton",
        "timestamp": 1768589718
    },
    {
        "content": "<p>for my use case: I have <code>just nuke</code>, <code>just clean</code>, <code>just build</code>, etc.  i am trying to support an edit-build-test cycle.  i currently have a <code>just run</code>, which just does something like <code>roc hello_world.roc</code> or <code>roc main.roc</code>. </p>\n<p>so then I have some workflow tasks: <code>just dev</code> (build + run), <code>just fresh</code> (clean + dev).   <code>just nuke</code> wipes all cache and is invoked on its own.   i think <code>just run</code> is actually a bad idea and I really want <code>just test</code>.  this would run \"unit tests\" that are roughly analogous to smoke tests, doing slightly more than hello world to show the build was successful</p>",
        "id": 568502894,
        "sender_full_name": "Rick Hull",
        "timestamp": 1768589776
    },
    {
        "content": "<p>test/host.roc, test/sha256.roc, test/sign.roc      something like that</p>",
        "id": 568503053,
        "sender_full_name": "Rick Hull",
        "timestamp": 1768589828
    },
    {
        "content": "<p>I like simple commands too, I have it set up with nix:</p>\n<div class=\"codehilite\"><pre><span></span><code>roc/src on  zig-compiler-benchmarks\n❯ nix develop\nRestored session: Fri Jan 16 19:58:49 CET 2026\nSome convenient commands:\n  buildcmd =   zig build roc\n  testcmd =   zig build snapshot &amp;&amp; zig build test\n  fmtcmd =   zig build fmt\n  covcmd =   zig build coverage\n  cicmd =   zig build fmt &amp;&amp; ./ci/zig_lints.sh &amp;&amp; zig build &amp;&amp; zig build snapshot &amp;&amp; zig build test &amp;&amp; zig build test-playground &amp;&amp; zig build coverage\n$\n</code></pre></div>",
        "id": 568503563,
        "sender_full_name": "Anton",
        "timestamp": 1768589994
    },
    {
        "content": "<p>I used to run nixos and have used nix in anger, but I emphasize anger.  it never clicked for me.  but I think there could be some really cool synergy / symmetry with its immutable nature and use in build environments</p>",
        "id": 568503791,
        "sender_full_name": "Rick Hull",
        "timestamp": 1768590056
    },
    {
        "content": "<p>so it looks like you are really leaning on the zig runner (?) in a way that I'm not.  maybe that's a natural direction to go in</p>",
        "id": 568504038,
        "sender_full_name": "Rick Hull",
        "timestamp": 1768590138
    },
    {
        "content": "<blockquote>\n<p>so it looks like you are really leaning on the zig runner (?)</p>\n</blockquote>\n<p>Yes for the main repo, a ton is in build.zig. It has been working well for us.</p>",
        "id": 568504305,
        "sender_full_name": "Anton",
        "timestamp": 1768590218
    },
    {
        "content": "<p>I am brand new to Zig, Roc, and platforms.  nearly all of my direct experience is with scripts against runtimes (shell, ruby, elixir, etc).  but I've long had an itch for gradual-strong typing (to enforce correctness without being a huge PITA) and deployable artifacts (no runtime)<br>\nI guess what I'm getting at is that I started with roc-alpha-4 and C, so I needed a Makefile (ugh!).  then I adopted Just (yay!).  but now that I'm basing my host on Zig, there is a world of Zig tooling that I'm totally unaware of, analogous but not exactly comparable to the C ecosystem (a good thing!)</p>",
        "id": 568504491,
        "sender_full_name": "Rick Hull",
        "timestamp": 1768590276
    },
    {
        "content": "<p>I'm signing off for today <span aria-label=\"wave\" class=\"emoji emoji-1f44b\" role=\"img\" title=\"wave\">:wave:</span> but others should be available for additional questions :)</p>",
        "id": 568504743,
        "sender_full_name": "Anton",
        "timestamp": 1768590364
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"361169\">Anton</span> <a href=\"#narrow/channel/231634-beginners/topic/Platform.20basics/near/568504305\">said</a>:</p>\n<blockquote>\n<blockquote>\n<p>so it looks like you are really leaning on the zig runner (?)</p>\n</blockquote>\n<p>Yes for the main repo, a ton is in build.zig. It has been working well for us.</p>\n</blockquote>\n<p>I use zig build system for every language lol zig4lyfe</p>",
        "id": 568522367,
        "sender_full_name": "nandi",
        "timestamp": 1768597024
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"780900\">Rick Hull</span> <a href=\"#narrow/channel/231634-beginners/topic/Platform.20basics/near/568503791\">said</a>:</p>\n<blockquote>\n<p>I used to run nixos and have used nix in anger, but I emphasize anger.  it never clicked for me.  but I think there could be some really cool synergy / symmetry with its immutable nature and use in build environments</p>\n</blockquote>\n<p>I have such a like/dislike relationship with nix. On the one hand it think it's conceptually kinda cool. On the other hand, I've usually been able to do something similar much simpler</p>",
        "id": 568522691,
        "sender_full_name": "nandi",
        "timestamp": 1768597171
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"780900\">Rick Hull</span> <a href=\"#narrow/channel/231634-beginners/topic/Platform.20basics/near/568504491\">said</a>:</p>\n<blockquote>\n<p>I am brand new to Zig, Roc, and platforms.  nearly all of my direct experience is with scripts against runtimes (shell, ruby, elixir, etc).  but I've long had an itch for gradual-strong typing (to enforce correctness without being a huge PITA) and deployable artifacts (no runtime)<br>\nI guess what I'm getting at is that I started with roc-alpha-4 and C, so I needed a Makefile (ugh!).  then I adopted Just (yay!).  but now that I'm basing my host on Zig, there is a world of Zig tooling that I'm totally unaware of, analogous but not exactly comparable to the C ecosystem (a good thing!)</p>\n</blockquote>\n<p>I was building a zig/rust hybrid project the other day, this is a section of my zig build file</p>\n<div class=\"codehilite\"><pre><span></span><code>    // =========================================================================\n    // Step 1: Build Rust Library\n    // =========================================================================\n    const cargo_build = b.addSystemCommand(&amp;[_][]const u8{\n        &quot;cargo&quot;,\n        &quot;build&quot;,\n        &quot;--release&quot;,\n        &quot;--lib&quot;,\n        &quot;--features&quot;,\n        &quot;gtk&quot;,\n    });\n    cargo_build.cwd = b.path(&quot;.&quot;);\n</code></pre></div>",
        "id": 568523208,
        "sender_full_name": "nandi",
        "timestamp": 1768597378
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"361169\">Anton</span> <a href=\"#narrow/channel/231634-beginners/topic/Platform.20basics/near/568499712\">said</a>:</p>\n<blockquote>\n<p>Just does not come pre-installed on github CI, that's already adding more friction than I would like. Also, I would like to convert the sh scripts to Roc scripts once basic-cli is ported for the new compiler and works well enough. Roc does not come pre-installed on CI but it's good to test our own stuff in the real world :)</p>\n</blockquote>\n<p>Yeah -- basic cli was such a nice cross-platform scripting setup. We'll be back there soon <span aria-label=\"smiley\" class=\"emoji emoji-1f603\" role=\"img\" title=\"smiley\">:smiley:</span></p>",
        "id": 568547361,
        "sender_full_name": "Luke Boswell",
        "timestamp": 1768612914
    },
    {
        "content": "<p>a <code>/scripts</code> dir full of <code>.roc</code> files would let you claim to be partially self-hosted</p>",
        "id": 568549344,
        "sender_full_name": "Dan G Knutson",
        "timestamp": 1768615123
    },
    {
        "content": "<p>I ran into a very confusing issue where my <code>platform/host.zig</code> has <code>hosted_function_ptrs</code> with a specific order, and when I removed some modules from my <code>exposes</code> in <code>platform/main.roc</code> for troubleshooting, the wrong functions were being called.  this coupling seems difficult to validate and troubleshoot.  have people run into this before?</p>",
        "id": 568554717,
        "sender_full_name": "Rick Hull",
        "timestamp": 1768620977
    },
    {
        "content": "<p>The hosted functions are those exposed by the platform... so this makes sense in that it's the platform authors responsibility to ensure the function pointers are in the correct order.</p>",
        "id": 568554839,
        "sender_full_name": "Luke Boswell",
        "timestamp": 1768621076
    },
    {
        "content": "<p>This statement probably doesn't help you much though. I think you and I may be the only people who have written a platform in the new compiler <span class=\"user-mention\" data-user-id=\"780900\">@Rick Hull</span> <span aria-label=\"smiley\" class=\"emoji emoji-1f603\" role=\"img\" title=\"smiley\">:smiley:</span></p>",
        "id": 568554884,
        "sender_full_name": "Luke Boswell",
        "timestamp": 1768621129
    },
    {
        "content": "<p>The order is alphabetical based on fully qualified name if I recall.</p>",
        "id": 568554906,
        "sender_full_name": "Luke Boswell",
        "timestamp": 1768621162
    },
    {
        "content": "<p>I'd like to mention also... that the intended design for platform authors is to use <code>roc glue</code> instead of rolling all these manually. We are just in that awkward place in time where the <code>glue</code> subcommand isn't implemented yet for the new compiler so it's all manual</p>",
        "id": 568554962,
        "sender_full_name": "Luke Boswell",
        "timestamp": 1768621214
    },
    {
        "content": "<p>All quite sensible, thanks!</p>",
        "id": 568554999,
        "sender_full_name": "Rick Hull",
        "timestamp": 1768621255
    },
    {
        "content": "<p><code>roc glue path/to/generate_c_platform.roc path/to/my/platform/main.roc</code> or something like that and it scaffolds out literally everything you need with a nice type safe (maybe not in C <span aria-label=\"sweat smile\" class=\"emoji emoji-1f605\" role=\"img\" title=\"sweat smile\">:sweat_smile:</span> ) implementation.</p>",
        "id": 568555035,
        "sender_full_name": "Luke Boswell",
        "timestamp": 1768621289
    },
    {
        "content": "<p>i'm so happy with the zig template and the zig DX, compared to trying make a platform from scratch in C as my \"hello world\" LOL.  i don't mind a little less magic at this stage.</p>\n<p>I literally could not have done it without extensive help from Claude code (<a href=\"http://z.ai\">z.ai</a> models, cheaper) and a little bit of Gemini CLI (free)</p>",
        "id": 568555076,
        "sender_full_name": "Rick Hull",
        "timestamp": 1768621340
    },
    {
        "content": "<p>On of the assumptions we have for the future is that platforms will be abundant and should be easy to fork and modify to meet individual needs. It's good to know that LLM's can help with that and the tools should only make that even easier I think. <span aria-label=\"smiley\" class=\"emoji emoji-1f603\" role=\"img\" title=\"smiley\">:smiley:</span></p>",
        "id": 568555857,
        "sender_full_name": "Luke Boswell",
        "timestamp": 1768622368
    },
    {
        "content": "<p>re: justfile, one thing I do sometimes is add one for just myself (like a script for installing), and then put it in <code>.git/info/exclude</code>. In the case of the roc repo, they already ignore extra files with no extensions, so you just need to be careful to not delete it. I think just also has some walk-up-the-tree feature that would let you keep your personal scripts for a repo outside the repo (or you could symlink it)</p>",
        "id": 568591212,
        "sender_full_name": "Dan G Knutson",
        "timestamp": 1768660192
    },
    {
        "content": "<p>the way I have decided to structure my project for now, is I have <code>examples/</code> and <code>test/</code>;  I have <code>test/host.roc</code> and <code>test/host.zig</code>, targeting <code>platform/Host.roc</code> and <code>platform/host.zig</code> respectively.  I can use the roc and zig test runners, but I am using Just as \"my metalayer\" to tie everything together and support \"complex workflows\" like edit-build-test (heh)</p>\n<p>for a scripts-on-runtime-person, i am used to executing things immediately, and i don't automatically know to e.g. <code>zig build test</code> but Just helps me with that</p>",
        "id": 568622583,
        "sender_full_name": "Rick Hull",
        "timestamp": 1768691900
    },
    {
        "content": "<p>also, I think zig has a feature, or is this roc?, where you put the tests in the implementation file, at the toplevel.   maybe I should use that more?</p>",
        "id": 568622889,
        "sender_full_name": "Rick Hull",
        "timestamp": 1768692344
    },
    {
        "content": "<p>to answer my question, zig supports inline tests at the toplevel, but these have a restricted \"scope\" -- they should be used like unit tests for pure-ish functions defined within the file.</p>\n<p>roc supports inline tests at the toplevel, what I am calling <code>comptime</code> tests.  these use the <code>expect</code> keyword invoked by <code>roc test</code>.  or you can make a \"test script\" that calls <code>expect</code> within a main function.  these are <code>runtime</code> tests invoked by <code>roc</code>.</p>\n<p>Is this accurate?</p>",
        "id": 568632950,
        "sender_full_name": "Rick Hull",
        "timestamp": 1768707195
    },
    {
        "content": "<p>Separately, all host functions are impure by definition, and pure functions cannot call impure functions.  so if my application is purely functional, then I cannot call any platform functions?</p>\n<p>I know I have a misunderstanding somewhere, just not sure where</p>",
        "id": 568635456,
        "sender_full_name": "Rick Hull",
        "timestamp": 1768710723
    },
    {
        "content": "<p><code>expect</code> at the top level is a unit test - these are run with <code>roc test</code><br>\n<code>expect</code> within an expression (like a block expression) is an assertion - these throw a runtime error if not true.</p>",
        "id": 568635909,
        "sender_full_name": "Luke Boswell",
        "timestamp": 1768711000
    },
    {
        "content": "<p>this confirms, but gives me better language.  unit test vs assertion</p>",
        "id": 568636676,
        "sender_full_name": "Rick Hull",
        "timestamp": 1768711959
    },
    {
        "content": "<p>important detail: unlike assertions, <code>expect</code> never stops execution</p>",
        "id": 568639454,
        "sender_full_name": "Richard Feldman",
        "timestamp": 1768714919
    },
    {
        "content": "<p>it will cause a test to fail, and it will <em>report</em> an error, but program execution always continues normally no matter what happens with them</p>",
        "id": 568639482,
        "sender_full_name": "Richard Feldman",
        "timestamp": 1768714945
    },
    {
        "content": "<p>The platform host has a special handler it provides Roc <code>roc_expect_failed</code> or similar which is called when these fail right?</p>",
        "id": 568639536,
        "sender_full_name": "Luke Boswell",
        "timestamp": 1768715035
    },
    {
        "content": "<p>So the platform author is responsible for deciding what to do with that</p>",
        "id": 568639548,
        "sender_full_name": "Luke Boswell",
        "timestamp": 1768715059
    },
    {
        "content": "<p>true, but in <code>--optimize</code> builds the <code>expect</code>s are removed, so the semantics of that function are supposed to match - just report, don't end the program</p>",
        "id": 568639616,
        "sender_full_name": "Richard Feldman",
        "timestamp": 1768715167
    },
    {
        "content": "<p>ah, good point.  in a test suite, keep going.  but a failed runtime assertion should halt.  so expect is not ideal in a \"runtime test suite\"</p>",
        "id": 568660162,
        "sender_full_name": "Rick Hull",
        "timestamp": 1768739103
    },
    {
        "content": "<p>Still wondering, if all host functions are impure by definition, and pure functions cannot call impure functions, so if my application is purely functional, then I cannot call any platform functions?   This doesn't seem quite right.</p>",
        "id": 568660393,
        "sender_full_name": "Rick Hull",
        "timestamp": 1768739328
    },
    {
        "content": "<blockquote>\n<p>so expect is not ideal in a \"runtime test suite\"</p>\n</blockquote>\n<p>yeah, if you want the program to halt, that's what <code>crash</code> is for</p>",
        "id": 568661510,
        "sender_full_name": "Richard Feldman",
        "timestamp": 1768740526
    },
    {
        "content": "<p>oh, good clarification.  runtime expect throws an error (which would interrupt a typical test suite) but does not automatically halt</p>",
        "id": 568662535,
        "sender_full_name": "Rick Hull",
        "timestamp": 1768741601
    },
    {
        "content": "<p>it doesn't interrupt the test suite, it adds to a list of failed expectations</p>",
        "id": 568664162,
        "sender_full_name": "Richard Feldman",
        "timestamp": 1768743474
    },
    {
        "content": "<p>and then at the end of the suite, they all get aggregated and reported together</p>",
        "id": 568664171,
        "sender_full_name": "Richard Feldman",
        "timestamp": 1768743494
    },
    {
        "content": "<p>that's only the comptime <code>expect</code> at the toplevel, as executed by <code>roc test</code>, right?   and what i'm calling runtime <code>expect</code>, within a block, would throw a runtime error if it fails, and this error would typically interrupt a naive test suite that is just a series of assertions.  that is: a test suite which is not prepared to handle the error thrown by expect.  or would such a test suite be forced to handle the error?  i'm still trying to figure this stuff out but I'm sure it will become obvious to me with more usage</p>",
        "id": 568666048,
        "sender_full_name": "Rick Hull",
        "timestamp": 1768745374
    },
    {
        "content": "<p>the number one rule of <code>expect</code> is that it never affects control flow in any way</p>",
        "id": 568666370,
        "sender_full_name": "Richard Feldman",
        "timestamp": 1768745698
    },
    {
        "content": "<p>no matter where it is used</p>",
        "id": 568666375,
        "sender_full_name": "Richard Feldman",
        "timestamp": 1768745702
    },
    {
        "content": "<p>it is a harmless report</p>",
        "id": 568666397,
        "sender_full_name": "Richard Feldman",
        "timestamp": 1768745720
    },
    {
        "content": "<p>maybe a better way to think of it is \"debug print that an expectation was false, and then mark this test as 'must fail' when it finishes running\"</p>",
        "id": 568666495,
        "sender_full_name": "Richard Feldman",
        "timestamp": 1768745816
    },
    {
        "content": "<p>Thanks!  Big fan of the podcast, and I made my introduction here about a year ago, but my focus shifted.  Glad to be back</p>",
        "id": 568667919,
        "sender_full_name": "Rick Hull",
        "timestamp": 1768747103
    },
    {
        "content": "<blockquote>\n<p>zig4lyfe</p>\n</blockquote>\n<p>That would be cool for a tattoo :p <br>\nFun fact: a former contributor has a tattoo of the Roc logo <img alt=\":roc:\" class=\"emoji\" src=\"https://avatars.zulip.com/22008/emoji/images/5f42d943.png\" title=\"roc\"></p>",
        "id": 568779099,
        "sender_full_name": "Anton",
        "timestamp": 1768822140
    },
    {
        "content": "<p>what are some guidelines for \"platform modules\" under roc-nightly?  I know that they must contain at least one Type with the same name.  I was going to make <code>platform/Crypto.roc</code> with nominal tag unions: <code>SecretKey</code> <code>PublicKey</code> <code>Signature</code> <code>Digest</code> but this isn't allowed</p>",
        "id": 568873294,
        "sender_full_name": "Rick Hull",
        "timestamp": 1768851570
    },
    {
        "content": "<p>I have a strange(?) question...</p>\n<p>Most of the best functional workflows I've ever used were for Data science, and I'm seriously looking into how to get e.g. Arrow, BLAS, etc. bindings working in Roc. </p>\n<p>My understanding right now is that those kinds of I/O would be done via a platform, right? So there might be an \"arrow\" platform, or a \"BLAS\" platform. But the problem I'm running into is ... I would never want to use _only_ BLAS, or _only_ Arrow, rather I would use them to accomplish something in the context of another platform (e.g.  a basic-cli tool)</p>\n<p>But I'm seeing the documentation tutorial says every app has \"exactly one platform\". What is considered \"one platform\"? In a declaration like: </p>\n<p><code>app [main!] { cli: platform \"https://github.com/roc-lang/basic-cli/releases/download/0.20.0/X73hGh05nNTkDHU06FHC0YfFaQB1pimX7gncRcao5mU.tar.br\" }</code></p>\n<p>is the platform only \"cli\" or is it the whole record? Can I have multiple keys in the platform declaration record?</p>",
        "id": 568931220,
        "sender_full_name": "Rachael Sexton",
        "timestamp": 1768876024
    },
    {
        "content": "<p>my take, as newbie but also a platform developer, is that you would incorporate all features into the platform.  you can have a \"BLAS\" module or \"arrow\" module, and maybe a platform specific to each.  but if you want both, you can have both, if you work to make them live together which is usually not difficult</p>",
        "id": 568932358,
        "sender_full_name": "Rick Hull",
        "timestamp": 1768877204
    },
    {
        "content": "<p>what is exactly considered one platform?  <code>basic-cli</code> is an amazing resource.  it has way more features than I would imagine for a <code>basic-cli</code>, but it also stays simple and approachable</p>",
        "id": 568932523,
        "sender_full_name": "Rick Hull",
        "timestamp": 1768877379
    },
    {
        "content": "<p>clone this <a href=\"https://github.com/roc-lang/basic-cli\">https://github.com/roc-lang/basic-cli</a> and poke around</p>",
        "id": 568932585,
        "sender_full_name": "Rick Hull",
        "timestamp": 1768877442
    },
    {
        "content": "<p>it looks like you are targeting the documented Roc, which I would call <code>roc-alpha-4</code>, aka the  \"old Rust compiler\".   Keep in mind, there is a \"new Zig compiler\" and the language is changing; I personally target <code>roc-nightly</code>, based on the new compiler (and it's a different language).</p>",
        "id": 568932648,
        "sender_full_name": "Rick Hull",
        "timestamp": 1768877506
    },
    {
        "content": "<p>Ah, but then how would someone else reuse my \"blas platform\" code? They would have to build their own platform that combines my BLAS I/O with their own platform?</p>",
        "id": 568933968,
        "sender_full_name": "Rachael Sexton",
        "timestamp": 1768878884
    },
    {
        "content": "<p>so BLAS and LAPACK have been two longstanding questions in this area - but this is the first I'm hearing of Arrow! (I know almost nothing about data science; I only know about these libraries because of people asking about them in the context of Roc! <span aria-label=\"smile\" class=\"emoji emoji-1f604\" role=\"img\" title=\"smile\">:smile:</span>)</p>",
        "id": 568939056,
        "sender_full_name": "Richard Feldman",
        "timestamp": 1768883107
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"1017059\">@Rachael Sexton</span> I think the running hypothesis is that platforms will evolve around a domain. So if you are working on a particular kind of software, and having these kind of libraries is necessary for e.g. performance reasons, then I would expect the platform author to think of a good API to integrate those. However I'm not sure they will be exposing the functionality 1-1 with those library APIs but maybe wrapping them in a more ergonomic or idiomatic way. So under the hood a platform may be using a particular library but this isn't a detail an application author would be concerned with.</p>",
        "id": 568951803,
        "sender_full_name": "Luke Boswell",
        "timestamp": 1768891716
    },
    {
        "content": "<p>A data science platform sounds like the way to go.</p>",
        "id": 568973712,
        "sender_full_name": "Anton",
        "timestamp": 1768900579
    },
    {
        "content": "<p>that's probably the way to go for now</p>",
        "id": 569015556,
        "sender_full_name": "Richard Feldman",
        "timestamp": 1768913348
    },
    {
        "content": "<p>personally I think the most promising long-term direction is using an LLM to port BLAS/LAPACK/etc. to pure Roc</p>",
        "id": 569015643,
        "sender_full_name": "Richard Feldman",
        "timestamp": 1768913377
    },
    {
        "content": "<p>they're all pure functions and our (currently non-SIMD) numeric code can optimize to the same things that LLVM optimizes to</p>",
        "id": 569015802,
        "sender_full_name": "Richard Feldman",
        "timestamp": 1768913428
    },
    {
        "content": "<p>what are some guidelines for \"platform modules\" using the new compiler? I know that they must contain at least one type with the same name. I was going to make <code>platform/Crypto.roc</code> with nominal tag unions: <code>SecretKey</code> <code>PublicKey</code> <code>Signature</code> <code>Digest</code> but this isn't allowed</p>",
        "id": 569023037,
        "sender_full_name": "Rick Hull",
        "timestamp": 1768915249
    },
    {
        "content": "<p>If I just named it <code>Signature.roc</code> would that be expected to work?  I am not sure about visibility / scoping.  I ran in to not being able to resolve e.g. <code>Digest</code> from a test file</p>",
        "id": 569023372,
        "sender_full_name": "Rick Hull",
        "timestamp": 1768915331
    },
    {
        "content": "<p>Let me take a moment to try some stuff</p>",
        "id": 569032852,
        "sender_full_name": "Anton",
        "timestamp": 1768917591
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"281383\">Richard Feldman</span> <a href=\"#narrow/channel/231634-beginners/topic/Platform.20basics/near/569015643\">said</a>:</p>\n<blockquote>\n<p>personally I think the most promising long-term direction is using an LLM to port BLAS/LAPACK/etc. to pure Roc</p>\n</blockquote>\n<p>Interesting. So, what about cases where a lightweight c library exists already, is it idiomatic for module/library authors to depend on c functions right now? E.g. <a href=\"https://arrow.apache.org/nanoarrow/latest/index.html\">nano arrow</a> should make porting arrow to roc very easy, if so.</p>\n<p>Similarly, I wouldn't want to reimplement e.g. <a href=\"http://pola.rs\">pola.rs</a> in roc myself, but it is a rust library that already gets used in node, r, python, and I believe available natively in Nushell</p>",
        "id": 569049476,
        "sender_full_name": "Rachael Sexton",
        "timestamp": 1768921063
    },
    {
        "content": "<p>The platform can depend on C functions, Luke's <a href=\"https://github.com/lukewilliamboswell/roc-ray/tree/new-compiler\">raylib</a> is basically a complex demonstration of how you can set something like that up.</p>",
        "id": 569051476,
        "sender_full_name": "Anton",
        "timestamp": 1768921475
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"361169\">@Anton</span> (platform module resolution) <a href=\"https://gist.github.com/rickhull/68f3fbf668db9f61598628b29ba0feb0\">https://gist.github.com/rickhull/68f3fbf668db9f61598628b29ba0feb0</a></p>",
        "id": 569060255,
        "sender_full_name": "Rick Hull",
        "timestamp": 1768923344
    },
    {
        "content": "<p>Thanks Rick, I will try to make that work or make an issue</p>",
        "id": 569060814,
        "sender_full_name": "Anton",
        "timestamp": 1768923454
    },
    {
        "content": "<p>oh whoops, you'll need Signature.roc; <del>updating</del> UPDATED</p>\n<p>My presumption is that I'm <strong>Doing It Wrong (tm)</strong></p>",
        "id": 569066478,
        "sender_full_name": "Rick Hull",
        "timestamp": 1768924740
    },
    {
        "content": "<blockquote>\n<p>Similarly, I wouldn't want to reimplement e.g. <a href=\"http://pola.rs/\">pola.rs</a> in roc myself, but it is a rust library that already gets used in node, r, python, and I believe available natively in Nushell</p>\n</blockquote>\n<p>I think <a href=\"http://pola.rs\">pola.rs</a> is a good model for what I'm talking about - the <a href=\"http://pola.rs\">pola.rs</a> folks didn't do FFI to the C code underlying the already-popular pandas, they built a new library in pure Rust <span aria-label=\"smile\" class=\"emoji emoji-1f604\" role=\"img\" title=\"smile\">:smile:</span></p>",
        "id": 569069490,
        "sender_full_name": "Richard Feldman",
        "timestamp": 1768925335
    },
    {
        "content": "<p>building new things can be done, and I think there's a lot of precedent for it being the way to get the best outcome!</p>",
        "id": 569069641,
        "sender_full_name": "Richard Feldman",
        "timestamp": 1768925372
    },
    {
        "content": "<p>To further this idea, I am writing <code>nostr-platform</code>, mainly so I can build on top of libsecp256k1.  I could implement Schnorr signatures in Roc -- I've already done it <a href=\"https://github.com/rickhull/schnorr_sig\">in Ruby</a>, maybe the repo I am most proud of, done entirely without LLM <del>assistance</del> agents or code.  (I used a lot of LLM assistance for understanding elliptic curve crypto.  See the README.md -- it's great, and written by me!)</p>\n<p>But in this case, it makes much more sense to rely on a battle-tested lib (Bitcoin!) for important crypto stuff.</p>",
        "id": 569077267,
        "sender_full_name": "Rick Hull",
        "timestamp": 1768927231
    },
    {
        "content": "<blockquote>\n<p>for important crypto stuff.</p>\n</blockquote>\n<p>Yeah in that case you want to use the original lib indeed</p>",
        "id": 569077662,
        "sender_full_name": "Anton",
        "timestamp": 1768927334
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"361169\">@Anton</span> for the platform module, I can access <code>Signature.Digest</code> but not <code>Digest</code>.  so the module acts as a namespace.  I would like to name it <code>Crypto.roc</code> and I'd be fine with <code>Crypto.Signature</code> but I have to expose a \"Crypto type\".  is this a misfeature?</p>",
        "id": 569079841,
        "sender_full_name": "Rick Hull",
        "timestamp": 1768927890
    },
    {
        "content": "<p>No, I think that is as intended</p>",
        "id": 569080159,
        "sender_full_name": "Anton",
        "timestamp": 1768927975
    },
    {
        "content": "<p>So if I just want a Crypto namespace, what should a trivial Crypto type look like?  or maybe I will have a real type?  for what?</p>",
        "id": 569080635,
        "sender_full_name": "Rick Hull",
        "timestamp": 1768928097
    },
    {
        "content": "<p>alternatively, I could have Digest.roc PublicKey.roc etc.  that seems fine, if maybe a bit chatty.  Is that more along the intent of platform modules?</p>",
        "id": 569080963,
        "sender_full_name": "Rick Hull",
        "timestamp": 1768928173
    },
    {
        "content": "<p>For the trivial type you can do <code>Crypto := [].{}</code></p>",
        "id": 569081017,
        "sender_full_name": "Anton",
        "timestamp": 1768928187
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"281383\">@Richard Feldman</span> may have useful thoughts here</p>",
        "id": 569081143,
        "sender_full_name": "Anton",
        "timestamp": 1768928219
    },
    {
        "content": "<p>with more testing, I am thinking I should have these nominal tag unions be their own module.  it just seems like less friction.  but i am continuing to test.</p>",
        "id": 569083251,
        "sender_full_name": "Rick Hull",
        "timestamp": 1768928764
    },
    {
        "content": "<p><a href=\"https://gist.github.com/rickhull/c5f63e552465180f4e3c76b99e460f57\">https://gist.github.com/rickhull/c5f63e552465180f4e3c76b99e460f57</a>   (generated via: <code>./rocgist.sh test/signature.roc platform/Crypto.roc</code>)</p>",
        "id": 569084400,
        "sender_full_name": "Rick Hull",
        "timestamp": 1768929068
    },
    {
        "content": "<p>this tells me that the trivial type as namespace is flawed.  i am going to put the nominal tag unions as their own modules and move on</p>",
        "id": 569084744,
        "sender_full_name": "Rick Hull",
        "timestamp": 1768929165
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"361169\">Anton</span> <a href=\"#narrow/channel/231634-beginners/topic/Platform.20basics/near/569081017\">said</a>:</p>\n<blockquote>\n<p>For the trivial type you can do <code>Crypto := [].{}</code></p>\n</blockquote>\n<p>We had a builtin named the same, though I guess now these crypto stuff would just live under <code>Builtin</code> now so that namespace is free to use if people want to roll thier own. </p>\n<p>We decided that most of the core cryptographic algorithms should ge implemented by Roc so we can garuntee they are secure and avoid timing attacks. At least that is what I recall, I would need to dig out the zulip thread to refresh myself. We haven't implemented any crypto in the new builtins yet.</p>",
        "id": 569109519,
        "sender_full_name": "Luke Boswell",
        "timestamp": 1768936649
    },
    {
        "content": "<p>See <a href=\"https://github.com/roc-lang/roc/pull/6977\">https://github.com/roc-lang/roc/pull/6977</a></p>",
        "id": 569109932,
        "sender_full_name": "Luke Boswell",
        "timestamp": 1768936794
    },
    {
        "content": "<p>I dont see any issue with implementing algorthims in pure Roc for learning etc, but just wanted to mention this as we haven't talked about it in a while.</p>",
        "id": 569110316,
        "sender_full_name": "Luke Boswell",
        "timestamp": 1768936922
    },
    {
        "content": "<p>Interesting.  I have rolled my own crypto systems before, but always for test, not production, stuff like 3DES EDE-CBC; not a crypto engineer; I implemented schnorr sig as an exercise in learning elliptic curve crypto and to enable a pure ruby nostr impl.  I don't think I was hitting a name clash with my Roc attempts.  I have now abandoned the name \"Crypto\" in my current platform impl.</p>",
        "id": 569113186,
        "sender_full_name": "Rick Hull",
        "timestamp": 1768937837
    },
    {
        "content": "<p>I am working on <a href=\"https://gist.github.com/rickhull/eb8553868ed70b6731b8a31054bda3c0\"><code>ZIG_PLATFORM_GUIDE.md</code></a>.  This is a different document than what was here, earlier.  This has a better starting basis, written mostly by me (!), and will be augmented.</p>\n<p>I am using claude's help, and this is a little bit of the blind leading the blind, so please highlight any mistakes, errors, misconceptions, or needed fixes.</p>",
        "id": 569570145,
        "sender_full_name": "Rick Hull",
        "timestamp": 1769109047
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"515757\">@Luke Boswell</span> ^^ if you get a chance</p>",
        "id": 569599548,
        "sender_full_name": "Rick Hull",
        "timestamp": 1769120621
    },
    {
        "content": "<p>It's very meh... there is some detail that is mostly right, and others that is overly specific to the zig template.</p>",
        "id": 569599952,
        "sender_full_name": "Luke Boswell",
        "timestamp": 1769120755
    },
    {
        "content": "<p>I wouldn't want to share something like that as an authoritative guide or anything as it would probably mostly confuse people</p>",
        "id": 569600027,
        "sender_full_name": "Luke Boswell",
        "timestamp": 1769120786
    },
    {
        "content": "<p>Regarding platform documentation -- I think we are intentionally leaving this undocumented for now.</p>",
        "id": 569600139,
        "sender_full_name": "Luke Boswell",
        "timestamp": 1769120830
    },
    {
        "content": "<p>There are higher priorities, and platform development requires a much higher level of knowledge and experience than application development.</p>",
        "id": 569600263,
        "sender_full_name": "Luke Boswell",
        "timestamp": 1769120874
    },
    {
        "content": "<p>There are many details that are still being validated with the new calling convention. I think it <em>should</em> be stable but there are still a lot of things that just haven't been built yet and so some things may need to change</p>",
        "id": 569600403,
        "sender_full_name": "Luke Boswell",
        "timestamp": 1769120933
    },
    {
        "content": "<p>Good to know.  I am basically documenting what I learned about the Zig template.  it sounds like <code>basic-cli</code> can be used now?  I didn't totally realize that -- it just needs building from source?</p>",
        "id": 569600417,
        "sender_full_name": "Rick Hull",
        "timestamp": 1769120939
    },
    {
        "content": "<p>E.g. we probably need to sort out the Windows linking story -- but that is hard when we don't have any super experienced Windows devs contributing right now, so it just takes a long time to do anything related with that. I take bites at it every now and then because I'd love to see it happen (for the Windows developers out there) but it can be a slog</p>",
        "id": 569600498,
        "sender_full_name": "Luke Boswell",
        "timestamp": 1769120970
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"780900\">Rick Hull</span> <a href=\"#narrow/channel/231634-beginners/topic/Platform.20basics/near/569600417\">said</a>:</p>\n<blockquote>\n<p>Good to know.  I am basically documenting what I learned about the Zig template.  it sounds like <code>basic-cli</code> can be used now?  I didn't totally realize that -- it just needs building from source?</p>\n</blockquote>\n<p>Yeah it's working nicely</p>",
        "id": 569600537,
        "sender_full_name": "Luke Boswell",
        "timestamp": 1769120986
    },
    {
        "content": "<p>i want to get <code>basic-cli</code> going now -- what's step 1, just poke around the repo <code>HEAD</code>?</p>",
        "id": 569600654,
        "sender_full_name": "Rick Hull",
        "timestamp": 1769121035
    },
    {
        "content": "<p>I have a windows box, and if there is a way to script builds on windows, i can poke around a bit.  but i'm guessing it would be a huge PITA to get a semblance of a build environment going on a typical windows desktop</p>",
        "id": 569600871,
        "sender_full_name": "Rick Hull",
        "timestamp": 1769121138
    },
    {
        "content": "<p>Clone <code>https://github.com/roc-lang/basic-cli</code> then <code>git checkout migrate-zig-compiler</code> then <code>./build.sh</code></p>",
        "id": 569600898,
        "sender_full_name": "Luke Boswell",
        "timestamp": 1769121153
    },
    {
        "content": "<p>You will then be able to run the examples using the platform locally</p>",
        "id": 569600931,
        "sender_full_name": "Luke Boswell",
        "timestamp": 1769121168
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"780900\">Rick Hull</span> <a href=\"#narrow/channel/231634-beginners/topic/Platform.20basics/near/569600871\">said</a>:</p>\n<blockquote>\n<p>I have a windows box, and if there is a way to script builds on windows, i can poke around a bit.  but i'm guessing it would be a huge PITA to get a semblance of a build environment going on a typical windows desktop</p>\n</blockquote>\n<p>It's not a huge PITA or anything... it's just that it requires a fairly deep level of expertise in linking and low level things. Not an area the LLMs are able to provide much assistance... it feels more like voodoo science than engineering</p>",
        "id": 569601210,
        "sender_full_name": "Luke Boswell",
        "timestamp": 1769121288
    },
    {
        "content": "<p>that's like taking the One Ring from gollum <span aria-label=\"rolling on the floor laughing\" class=\"emoji emoji-1f923\" role=\"img\" title=\"rolling on the floor laughing\">:rolling_on_the_floor_laughing:</span></p>",
        "id": 569601353,
        "sender_full_name": "Rick Hull",
        "timestamp": 1769121355
    },
    {
        "content": "<p>I've reframed that doc as <code>ZIG_PLATFORM_GUIDE.md</code> and it lives in <code>roc-init</code> for now.  I think it's ok to have \"rough guides\" that are not official docs to be relied upon</p>",
        "id": 569601837,
        "sender_full_name": "Rick Hull",
        "timestamp": 1769121583
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"515757\">Luke Boswell</span> <a href=\"#narrow/channel/231634-beginners/topic/Platform.20basics/near/569600898\">said</a>:</p>\n<blockquote>\n<p>Clone <code>https://github.com/roc-lang/basic-cli</code> then <code>git checkout migrate-zig-compiler</code> then <code>./build.sh</code></p>\n</blockquote>\n<p>I've been working on my own branch, didn't realize this already existed lol</p>",
        "id": 569603657,
        "sender_full_name": "nandi",
        "timestamp": 1769122624
    },
    {
        "content": "<p>I would say the basic-cli migration is like 3/4 done -- all the <em>hard</em> stuff is behind us, we have resolved all the known bugs that were holding it back now, and we have CI working for all the supported targets. It's only got these modules implemented <code>Cmd, Dir, Env, File, Path, Random, Sleep, Stdin, Stdout, Stderr, Utc</code> so missing things like <code>Http</code> etc... and the implementation of the se modules is definitely a WIP as we need to do a few passes to make these more idiomatic with the new static dispatch approach.</p>",
        "id": 569604836,
        "sender_full_name": "Luke Boswell",
        "timestamp": 1769123237
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"281383\">Richard Feldman</span> <a href=\"#narrow/channel/231634-beginners/topic/Platform.20basics/near/569015802\">said</a>:</p>\n<blockquote>\n<p>they're all pure functions and our (currently non-SIMD) numeric code can optimize to the same things that LLVM optimizes to</p>\n</blockquote>\n<p>Here is the kind of code that needs to be written in Mojo to write efficient matmul<br>\n<a href=\"https://github.com/jon-chuang/mojo/blob/422256e2490a1899b204e7b3a9cae2c6007433e8/examples/matmul.mojo\">https://github.com/jon-chuang/mojo/blob/422256e2490a1899b204e7b3a9cae2c6007433e8/examples/matmul.mojo</a></p>\n<p>It is all about tiling SIMD vectors and doing ops on them. The best tiling strategy depends on the matrix dimensions (which is usually only known at runtime) and the host architecture. Numpy dispatches to the best kernel at runtime. Mojo compiles the exact best kernel only through comptime parametrization. Python using Mojo would JIT compile specialized kernels for the current matrices.</p>\n<p>Even then you don't exactly meet numpy(OpenBLAS) performance. <a href=\"https://github.com/modular/modular/pull/3248\">https://github.com/modular/modular/pull/3248</a> (NB: unreliable benchmarking).</p>\n<p>These are the kind of challenges that roc would have to enable to reimplement BLAS/LAPACK libraries</p>",
        "id": 571784052,
        "sender_full_name": "Romain Lepert",
        "timestamp": 1770160046
    },
    {
        "content": "<p>whoa, this is super helpful <span class=\"user-mention\" data-user-id=\"680911\">@Romain Lepert</span> , thank you so much! <span aria-label=\"star struck\" class=\"emoji emoji-1f929\" role=\"img\" title=\"star struck\">:star_struck:</span> </p>\n<p><span class=\"user-mention silent\" data-user-id=\"680911\">Romain Lepert</span> <a href=\"#narrow/channel/231634-beginners/topic/Platform.20basics/near/571784052\">said</a>:</p>\n<blockquote>\n<p>The best tiling strategy depends on the matrix dimensions (which is usually only known at runtime) and the host architecture. Numpy dispatches to the best kernel at runtime. Mojo compiles the exact best kernel only through comptime parametrization. Python using Mojo would JIT compile specialized kernels for the current matrices.</p>\n</blockquote>\n<p>just to check my understanding: the \"kernel\" in this case refers to the tiling strategy?</p>\n<p>I think from a comptime perspective we'd be on par with mojo, since if the matrices are statically known, we'd do the dispatch at comptime too (since these are all pure functions).</p>\n<p>that said, I don't know if any of the tricks they used to get <a href=\"https://github.com/modular/modular/pull/3250#issuecomment-2229251647\">3x the perf of numpy</a> (with the extreme caveat that the numpy benchmarks they're comparing to have been really inconsistent, and an earlier run would have had the reverse outcome - numpy being 3x the perf of mojo instead of the other way around) require using memory-unsafe APIs, which would be the main concern I'd have about achieving perf parity there</p>",
        "id": 571807067,
        "sender_full_name": "Richard Feldman",
        "timestamp": 1770173285
    },
    {
        "content": "<p>cc <span class=\"user-mention\" data-user-id=\"343810\">@Brendan Hansknecht</span></p>",
        "id": 571807076,
        "sender_full_name": "Richard Feldman",
        "timestamp": 1770173291
    },
    {
        "content": "<p>we don't have any SIMD APIs currently, and a major reason for that is my not knowing what to target <span aria-label=\"laughing\" class=\"emoji emoji-1f606\" role=\"img\" title=\"laughing\">:laughing:</span></p>",
        "id": 571807109,
        "sender_full_name": "Richard Feldman",
        "timestamp": 1770173328
    },
    {
        "content": "<p>but if we had a realistic target of \"be able to compete with numpy using only memory-safe pure Roc APIs\" that would be excellent for unblocking that design work! <span aria-label=\"smiley\" class=\"emoji emoji-1f603\" role=\"img\" title=\"smiley\">:smiley:</span></p>",
        "id": 571807183,
        "sender_full_name": "Richard Feldman",
        "timestamp": 1770173375
    },
    {
        "content": "<p>Haha, that GitHub diff is so useless. Looks to be showing lots of random changes from main rather than just the example changes</p>",
        "id": 571809648,
        "sender_full_name": "Brendan Hansknecht",
        "timestamp": 1770175405
    },
    {
        "content": "<p>Yeah, so what is missing for roc to do that:</p>\n<ol>\n<li>Simd instructions. Preferably with explicit load and store, but not strictly required. Without explicit load store, you depend on roc (and minorly llvm), to properly remove all refcounting and bounds checking.</li>\n<li>Explicit loop unrolling.</li>\n<li>Vectorize is just a convenience and I don't think is needed.</li>\n<li>Multithreaded work queuing/distribution</li>\n<li>Comptime integer parameters and the ability to do math on them. Not technically required but really required if you want a usable API. Otherwise you need every matrix size to be a different type and to explicitly be managed. It just isn't practical with large matrices.</li>\n<li>System information exposed to roc at compile time so it can specialize to hardware</li>\n<li>GPU/XPU support if you want the full magic of mojo.</li>\n</ol>",
        "id": 571810594,
        "sender_full_name": "Brendan Hansknecht",
        "timestamp": 1770176172
    },
    {
        "content": "<p>isn't loop unrolling also a convenience?</p>",
        "id": 571827241,
        "sender_full_name": "Richard Feldman",
        "timestamp": 1770187337
    },
    {
        "content": "<p>Sadly not. It can be fundamental for performance</p>",
        "id": 571833413,
        "sender_full_name": "Brendan Hansknecht",
        "timestamp": 1770190116
    },
    {
        "content": "<p>Of course when everything goes right llvm can do it.</p>",
        "id": 571833470,
        "sender_full_name": "Brendan Hansknecht",
        "timestamp": 1770190145
    },
    {
        "content": "<p>But sometimes you need to fully unroll or even partially unroll to get better utilization. Balancing code bloat/instruction cache size vs number of branch checks (even if fully predicted it can cause issues)</p>",
        "id": 571833648,
        "sender_full_name": "Brendan Hansknecht",
        "timestamp": 1770190221
    },
    {
        "content": "<p>regarding comptime type parameters with arithmetic - I'm surprised that would be considered a requirement for ergonomics. Lots of languages support these use cases from a perf perspective, but which ones actually have that feature? <span aria-label=\"sweat smile\" class=\"emoji emoji-1f605\" role=\"img\" title=\"sweat smile\">:sweat_smile:</span></p>\n<p>is it that dynamic languages like Python don't need to care about the static type implications of the APIs, so those ergonomics are out of scope?</p>",
        "id": 571968256,
        "sender_full_name": "Richard Feldman",
        "timestamp": 1770225526
    },
    {
        "content": "<p>In Mojo you write</p>\n<div class=\"codehilite\" data-code-language=\"Mojo\"><pre><span></span><code><span class=\"k\">fn</span><span class=\"w\"> </span><span class=\"nf\">matmul</span><span class=\"p\">[</span><span class=\"n\">M</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nb\">Int</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">N</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nb\">Int</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">K</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nb\">Int</span><span class=\"p\">](</span><span class=\"n\">a</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nb\">Tensor</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nb\">Tensor</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nb\">Tensor</span><span class=\"p\">)</span>\n</code></pre></div>\n<p>and inside you might need to do some arithmetic on the M, N, K comptime type parameters </p>\n<ul>\n<li><code>M / tile</code></li>\n<li><code>M % vectorWidth</code></li>\n<li><code>ceilDiv(M, blockSize)</code></li>\n<li><code>min(M, 128)</code></li>\n</ul>\n<p>in C++ you don't have comptime type parameters so you have to use template for that which has a lot worse development ergonomics</p>\n<div class=\"codehilite\" data-code-language=\"C++\"><pre><span></span><code><span class=\"k\">template</span><span class=\"o\">&lt;</span><span class=\"kt\">int</span><span class=\"w\"> </span><span class=\"n\">M</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"kt\">int</span><span class=\"w\"> </span><span class=\"n\">N</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"kt\">int</span><span class=\"w\"> </span><span class=\"n\">K</span><span class=\"o\">&gt;</span>\n<span class=\"kt\">void</span><span class=\"w\"> </span><span class=\"n\">matmul</span><span class=\"p\">(</span><span class=\"n\">Tensor</span><span class=\"o\">&amp;</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">Tensor</span><span class=\"o\">&amp;</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">Tensor</span><span class=\"o\">&amp;</span><span class=\"p\">);</span>\n</code></pre></div>\n<p>in python you don't care because you delegate to a precompiled library that would look like this in C++</p>\n<div class=\"codehilite\" data-code-language=\"C++\"><pre><span></span><code><span class=\"kt\">void</span><span class=\"w\"> </span><span class=\"nf\">matmul</span><span class=\"p\">(</span><span class=\"n\">Tensor</span><span class=\"o\">&amp;</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">Tensor</span><span class=\"o\">&amp;</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">Tensor</span><span class=\"o\">&amp;</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"p\">)</span>\n<span class=\"p\">{</span>\n<span class=\"w\">    </span><span class=\"k\">const</span><span class=\"w\"> </span><span class=\"kt\">int</span><span class=\"w\"> </span><span class=\"n\">M</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"p\">.</span><span class=\"n\">shape</span><span class=\"p\">[</span><span class=\"mi\">0</span><span class=\"p\">];</span>\n<span class=\"w\">    </span><span class=\"k\">const</span><span class=\"w\"> </span><span class=\"kt\">int</span><span class=\"w\"> </span><span class=\"n\">N</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"p\">.</span><span class=\"n\">shape</span><span class=\"p\">[</span><span class=\"mi\">1</span><span class=\"p\">];</span>\n<span class=\"w\">    </span><span class=\"k\">const</span><span class=\"w\"> </span><span class=\"kt\">int</span><span class=\"w\"> </span><span class=\"n\">K</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"p\">.</span><span class=\"n\">shape</span><span class=\"p\">[</span><span class=\"mi\">1</span><span class=\"p\">];</span>\n\n<span class=\"w\">    </span><span class=\"c1\">// Example: a small hand-picked set of fast kernels</span>\n<span class=\"w\">    </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">M</span><span class=\"w\"> </span><span class=\"o\">==</span><span class=\"w\"> </span><span class=\"mi\">128</span><span class=\"w\"> </span><span class=\"o\">&amp;&amp;</span><span class=\"w\"> </span><span class=\"n\">N</span><span class=\"w\"> </span><span class=\"o\">==</span><span class=\"w\"> </span><span class=\"mi\">64</span><span class=\"w\"> </span><span class=\"o\">&amp;&amp;</span><span class=\"w\"> </span><span class=\"n\">K</span><span class=\"w\"> </span><span class=\"o\">==</span><span class=\"w\"> </span><span class=\"mi\">256</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">        </span><span class=\"n\">matmul</span><span class=\"o\">&lt;</span><span class=\"mi\">128</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"mi\">64</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"mi\">256</span><span class=\"o\">&gt;</span><span class=\"p\">(</span><span class=\"n\">a</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"p\">);</span>\n<span class=\"w\">        </span><span class=\"k\">return</span><span class=\"p\">;</span>\n<span class=\"w\">    </span><span class=\"p\">}</span>\n\n<span class=\"w\">    </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">M</span><span class=\"w\"> </span><span class=\"o\">==</span><span class=\"w\"> </span><span class=\"mi\">256</span><span class=\"w\"> </span><span class=\"o\">&amp;&amp;</span><span class=\"w\"> </span><span class=\"n\">N</span><span class=\"w\"> </span><span class=\"o\">==</span><span class=\"w\"> </span><span class=\"mi\">64</span><span class=\"w\"> </span><span class=\"o\">&amp;&amp;</span><span class=\"w\"> </span><span class=\"n\">K</span><span class=\"w\"> </span><span class=\"o\">==</span><span class=\"w\"> </span><span class=\"mi\">256</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">        </span><span class=\"n\">matmul</span><span class=\"o\">&lt;</span><span class=\"mi\">256</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"mi\">64</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"mi\">256</span><span class=\"o\">&gt;</span><span class=\"p\">(</span><span class=\"n\">a</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"p\">);</span>\n<span class=\"w\">        </span><span class=\"k\">return</span><span class=\"p\">;</span>\n<span class=\"w\">    </span><span class=\"p\">}</span>\n\n<span class=\"w\">    </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">M</span><span class=\"w\"> </span><span class=\"o\">==</span><span class=\"w\"> </span><span class=\"mi\">128</span><span class=\"w\"> </span><span class=\"o\">&amp;&amp;</span><span class=\"w\"> </span><span class=\"n\">N</span><span class=\"w\"> </span><span class=\"o\">==</span><span class=\"w\"> </span><span class=\"mi\">128</span><span class=\"w\"> </span><span class=\"o\">&amp;&amp;</span><span class=\"w\"> </span><span class=\"n\">K</span><span class=\"w\"> </span><span class=\"o\">==</span><span class=\"w\"> </span><span class=\"mi\">256</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">        </span><span class=\"n\">matmul</span><span class=\"o\">&lt;</span><span class=\"mi\">128</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"mi\">128</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"mi\">256</span><span class=\"o\">&gt;</span><span class=\"p\">(</span><span class=\"n\">a</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"p\">);</span>\n<span class=\"w\">        </span><span class=\"k\">return</span><span class=\"p\">;</span>\n<span class=\"w\">    </span><span class=\"p\">}</span>\n\n<span class=\"w\">    </span><span class=\"c1\">// fallback</span>\n<span class=\"w\">    </span><span class=\"n\">matmul_generic</span><span class=\"p\">(</span><span class=\"n\">a</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"p\">);</span>\n<span class=\"p\">}</span>\n</code></pre></div>",
        "id": 572003435,
        "sender_full_name": "Romain Lepert",
        "timestamp": 1770237024
    },
    {
        "content": "<p>Yeah, Romain has the right basis. Fundamentally, when python calls the high performance libaries, the first step is to dispatch based on the shape to an optimized kernel for the shape. When you do this, you end up having N different kernels for various kinds of shapes. This is the standard way to deal with dynamism. It actually limits reaching peak performance in some case.</p>\n<p>If you are to go to the very extreme like is seen with max graphs:</p>\n<ol>\n<li>Every kernel  shape can be specialized and custom compiled for.  That said, for exceptionally dynamic dimensions you still do the mapping form essentially infinite options to N kernel choices.</li>\n<li>Back to back or neighboring operations can often be fused to really push performance. So instead of having a matmul kernel and a relu kernel. You have one super kernel that does matmul + relu. This kernel has all the matmul specialization from 1. It also halves the number of loads and stores by merging the relu operation into the matmul operations.</li>\n</ol>\n<hr>\n<p>I don't expect roc to compete in this space. I don't think it needs to in general. That sad, I do think it should be able to compete with numpy or blas or lapack with the right user guiding it. Those libraries tend to have hand rolled loops but minimal extreme specialization. They tend to still treat shapes fully dynamically.</p>",
        "id": 572031173,
        "sender_full_name": "Brendan Hansknecht",
        "timestamp": 1770248052
    }
]