[
    {
        "content": "<p>I have declared a type alias with optional field, but I am not able to satisfy the type system, see below.<br>\nIs it a compiler bug or what do I do wrong?</p>\n<div class=\"codehilite\"><pre><span></span><code>package &quot;testing&quot; exposes [] packages {}\n\nEventSystemAlertsCreate : {\n    submitId : Str,\n    refs ? Str,\n}\n\nevent1: EventSystemAlertsCreate\nevent1 = {\n    submitId: &quot;123&quot;,\n    refs: &quot;456&quot;\n}\n\nevent2: EventSystemAlertsCreate\nevent2 = {\n    submitId: &quot;123&quot;,\n\n}\n</code></pre></div>\n<div class=\"codehilite\"><pre><span></span><code>$ roc check test.roc\n\n── TYPE MISMATCH in test.roc ───────────────────────────────────────────────────\n\nSomething is off with the body of the event1 definition:\n\n 8│   event1: EventSystemAlertsCreate\n 9│&gt;  event1 = {\n10│&gt;      submitId: &quot;123&quot;,\n11│&gt;      refs: &quot;456&quot;\n12│&gt;  }\n\nThe body is a record of type:\n\n    {\n        refs : Str,\n        submitId : Str,\n    }\n\nBut the type annotation on event1 says it should be:\n\n    {\n        refs ? Str,\n        submitId : Str,\n    }\n\nTip: To extract the .refs field it must be non-optional, but the type\nsays this field is optional. Learn more about optional fields at TODO.\n\n\n── TYPE MISMATCH in test.roc ───────────────────────────────────────────────────\n\nSomething is off with the body of the event2 definition:\n\n14│   event2: EventSystemAlertsCreate\n15│&gt;  event2 = {\n16│&gt;      submitId: &quot;123&quot;,\n17│&gt;\n18│&gt;  }\n\nThe body is a record of type:\n\n    { submitId : Str }\n\nBut the type annotation on event2 says it should be:\n\n    {\n        refs ? Str,\n        submitId : Str,\n    }\n\nTip: Looks like the refs field is missing.\n\n────────────────────────────────────────────────────────────────────────────────\n\n2 errors and 2 warnings found in 30 ms\n</code></pre></div>\n<div class=\"codehilite\"><pre><span></span><code>$ roc version\nroc nightly pre-release, built from commit 62cc19c on Di 02 Apr 2024 09:01:38 UTC\n</code></pre></div>",
        "id": 430855645,
        "sender_full_name": "witoldsz",
        "timestamp": 1712084799
    },
    {
        "content": "<p>Optional fields are named poorly. They are really default value fields. They require a value. The value will be specified during a destructuring. This generally happens when passing a record into a function and wanted default values.</p>",
        "id": 430862164,
        "sender_full_name": "Brendan Hansknecht",
        "timestamp": 1712087446
    },
    {
        "content": "<p>You probably want to directly represent an optional in the type system</p>",
        "id": 430862225,
        "sender_full_name": "Brendan Hansknecht",
        "timestamp": 1712087465
    },
    {
        "content": "<p>Something like <code>refs: Result Str [NoRefSpecified]</code></p>",
        "id": 430862370,
        "sender_full_name": "Brendan Hansknecht",
        "timestamp": 1712087520
    },
    {
        "content": "<p>Ok, so how do I use optional fields? I know I have to destructure to access them, but in my example I was unable just to create an object.</p>",
        "id": 430892267,
        "sender_full_name": "witoldsz",
        "timestamp": 1712100940
    },
    {
        "content": "<p>Generally as a function input, something like:</p>\n<div class=\"codehilite\"><pre><span></span><code>someFn: EventSystemAlertsCreate -&gt; ...\nsomeFn = \\{ submitId, refs ? &quot;default value&quot; } -&gt;\n    ...\n\nsomeFn { submitId: &quot;123&quot;, refs: &quot;456&quot; }\nsomeFn { submitId: &quot;123&quot; }\n</code></pre></div>",
        "id": 430894841,
        "sender_full_name": "Brendan Hansknecht",
        "timestamp": 1712102654
    },
    {
        "content": "<p>OK, but how do I assign to a variable? How do I pass it around?</p>",
        "id": 430933875,
        "sender_full_name": "witoldsz",
        "timestamp": 1712128644
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"515922\">@witoldsz</span>, my understanding is that those are not intended to be passed around as named values.</p>\n<p>From the corresponding tutorial <a href=\"https://www.roc-lang.org/tutorial#optional-record-fields\">section</a> (which is quite helpful in its entirety, as it discusses example use-cases where such fields are applicable; I believe Brendan's example was an instance of one class of possible applications):</p>\n<blockquote>\n<p>Destructuring is the only way to implement a record with optional fields. For example, if you write the expression config.title and title is an optional field, you'll get a compile error.</p>\n<p>This means it's never possible to end up with an optional value that exists outside a record field. Optionality is a concept that exists only in record fields, and it's intended for the use case of config records like this. The ergonomics of destructuring mean this wouldn't be a good fit for data modeling, consider using a Result type instead.</p>\n</blockquote>",
        "id": 430947495,
        "sender_full_name": "Hristo",
        "timestamp": 1712133305
    },
    {
        "content": "<p>As I said, I got the message \"Destructuring is the only way to implement a record with optional fields\". I have literally studied that tutorial section before asking this question. I still do not understand how a value (I mean a record with an optional field) cannot be passed around. This seems very strange.</p>",
        "id": 430959022,
        "sender_full_name": "witoldsz",
        "timestamp": 1712136410
    },
    {
        "content": "<p>They're not optional in that they are either there or they arent. </p>\n<p>The field is always there. Just when you pass a record to a function that field is optional. So you can pass a record that doesn't have that field, and it will be given the default value.</p>",
        "id": 430967697,
        "sender_full_name": "Luke Boswell",
        "timestamp": 1712138941
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"515922\">@witoldsz</span>, first - my apologies, I definitely didn't mean to imply that you hadn't read the tutorial before asking your question <span aria-label=\"pray\" class=\"emoji emoji-1f64f\" role=\"img\" title=\"pray\">:pray:</span> </p>\n<p>If you're familiar with Python (or equivalent), perhaps this example might be of help, conceptually speaking only:</p>\n<div class=\"codehilite\" data-code-language=\"Python\"><pre><span></span><code><span class=\"k\">def</span> <span class=\"nf\">add3</span><span class=\"p\">(</span><span class=\"n\">a</span><span class=\"p\">,</span> <span class=\"n\">b</span><span class=\"p\">,</span> <span class=\"n\">c</span><span class=\"o\">=</span><span class=\"mi\">5</span><span class=\"p\">):</span>\n    <span class=\"k\">return</span> <span class=\"n\">a</span> <span class=\"o\">+</span> <span class=\"n\">b</span> <span class=\"o\">+</span> <span class=\"n\">c</span>\n\n<span class=\"n\">add3</span><span class=\"p\">(</span><span class=\"mi\">1</span><span class=\"p\">,</span> <span class=\"mi\">2</span><span class=\"p\">)</span> <span class=\"c1\"># ~&gt; 8</span>\n<span class=\"n\">add3</span><span class=\"p\">(</span><span class=\"mi\">1</span><span class=\"p\">,</span> <span class=\"mi\">2</span><span class=\"p\">,</span> <span class=\"mi\">15</span><span class=\"p\">)</span> <span class=\"c1\"># ~&gt; 18</span>\n<span class=\"n\">add3</span><span class=\"p\">(</span><span class=\"mi\">1</span><span class=\"p\">,</span> <span class=\"mi\">2</span><span class=\"p\">,</span> <span class=\"n\">c</span><span class=\"o\">=</span><span class=\"mi\">15</span><span class=\"p\">)</span> <span class=\"c1\"># ~&gt; 18</span>\n</code></pre></div>\n<p><code>a</code>, <code>b</code> and <code>c</code> are values that can be passed around and Roc's optional fields enable you to achieve similar functionality. But <code>c = 5</code> isn't a value in itself (it's an assignment; it's not something that signifies \"I'm giving you something that may optionally be equal to <code>5</code>, if you're to pass it to <code>add3</code> as a value which you'd previously stored; Python doesn't allow that either) and can't be passed around (of course, you can do <code>d = c = 5</code> but it has a completely different meaning). It's used in the signature to indicate a default value, which may be optionally overriden.</p>\n<p>Of course this isn't a perfect analogy in terms of language specifics, but - as mentioned above - this isn't the goal of the example.</p>\n<p>Perhaps record types with optional fields could be viewed as what are referred to as \"interfaces\" in some languages. And the corresponding records with non-optional fields, which are subset of the former, are concrete instances conforming to those \"interfaces\". The \"interfaces\" facilitate substituting in default values when the desired behaviour is being able to specify the corresponding fields optionally only.</p>\n<p>If your question is pertaining to the language-design level and programming language theory (e.g., why Roc doesn't implement this functionality) - then I'm afraid I cannot help at that kind of level of abstraction. I know that I couldn't think of any use-cases why I'd need this kind of language feature, but that's about it.</p>",
        "id": 430971092,
        "sender_full_name": "Hristo",
        "timestamp": 1712140125
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"693045\">@Hristo</span> no apologies needed, I do not feel offended in any way <span aria-label=\"smile\" class=\"emoji emoji-1f642\" role=\"img\" title=\"smile\">:smile:</span> <br>\nMy only problem is that I have no idea how can I use the type as in my example:</p>\n<div class=\"codehilite\"><pre><span></span><code>EventSystemAlertsCreate : {\n    submitId : Str,\n    refs ? Str,\n}\n\nevent1: EventSystemAlertsCreate\nevent1 = {\n    submitId: &quot;123&quot;,\n    refs: &quot;456&quot;, # &lt;----- error\n}\n\nevent2: EventSystemAlertsCreate\nevent2 = {\n    submitId: &quot;123&quot;, # &lt;----- error\n}\n\n# now I could use event1 or event2 to pass to a function.\n</code></pre></div>\n<p>Neither of that <span aria-label=\"point up\" class=\"emoji emoji-1f446\" role=\"img\" title=\"point up\">:point_up:</span> works. From  my perspective, whenever I use an optional field in record, there is no way to create an instance and pass it around.</p>\n<p>My only way out of it is to stop using optional fields in a record, but there is no a \"default\" <code>Option</code> type, so I have to either come up with a custom tag union or use something like <code>Result a {}</code>?</p>",
        "id": 430977836,
        "sender_full_name": "witoldsz",
        "timestamp": 1712142757
    },
    {
        "content": "<blockquote>\n<p>whenever I use an optional field in record, there is no way to create an instance and pass it around.</p>\n</blockquote>\n<p>Yes, indeed. That's expected behaviour, by design.</p>\n<blockquote>\n<p>so I have to either come up with a custom tag union </p>\n</blockquote>\n<p>Yes, my understanding is that was essentially Brendan's suggestion <a href=\"#narrow/stream/231634-beginners/topic/optional.20field.20problem/near/430862370\">above</a>:</p>\n<blockquote>\n<p>You probably want to directly represent an optional in the type system<br>\nSomething like <code>refs: Result Str [NoRefSpecified]</code></p>\n</blockquote>\n<p>That would be the idiomatic way to achieve the desired functionality in Roc.</p>",
        "id": 430978187,
        "sender_full_name": "Hristo",
        "timestamp": 1712142889
    },
    {
        "content": "<p>P.S.<br>\nI am looking hopefully at this thread: <a href=\"#narrow/stream/304641-ideas/topic/Builtin.20Option.20type.20for.20decoding\">https://roc.zulipchat.com/#narrow/stream/304641-ideas/topic/Builtin.20Option.20type.20for.20decoding</a></p>",
        "id": 430978220,
        "sender_full_name": "witoldsz",
        "timestamp": 1712142897
    },
    {
        "content": "<blockquote>\n<p>I am looking hopefully at this thread: <a href=\"#narrow/stream/304641-ideas/topic/Builtin.20Option.20type.20for.20decoding\">https://roc.zulipchat.com/#narrow/stream/304641-ideas/topic/Builtin.20Option.20type.20for.20decoding</a></p>\n</blockquote>\n<p>Good point - yes, I was meaning to reference that as a related as well.</p>",
        "id": 430978364,
        "sender_full_name": "Hristo",
        "timestamp": 1712142943
    },
    {
        "content": "<p>One little problem with <code>Result</code> is that it does not feel idiomatic. <em>Result</em> sounds like a… result of something. The upside though is there are ready-to-use functions to deal with results. Using custom tag union seems more idiomatic, but then I have to create all the map/join/etc functions just for this…</p>",
        "id": 430979359,
        "sender_full_name": "witoldsz",
        "timestamp": 1712143273
    },
    {
        "content": "<p>I have a feeling that everything is moving towards the solution of introducing <code>Option</code> anyway. Even if this is going to be an alias for <code>Result * {}</code>. I don't know…</p>",
        "id": 430979789,
        "sender_full_name": "witoldsz",
        "timestamp": 1712143461
    },
    {
        "content": "<p>So, I'll share a pattern that I've been using in my own Roc code and I'm not sure how relevant that might be to your use case, but it might potentially be of help.</p>\n<ul>\n<li>So, I've got models which, upon initialisation, take parameters (a record, containing optional fields), then I store the parameters in association with the models (I've got a parameters record field in a model record).</li>\n<li>Since I don't want to have to specify all parameters upon initialisation, and instead I want to be able to provide default values, I define one record type that contains optional fields and another record type that contains the same subset of fields, but none of them are optional. This way I'm passing in a subset of the parameters as a record (not explicitly typed), destructuring the input to utilise the defaults and storing this as an instance of the non-optional-field parameters type.</li>\n</ul>\n<p>There might be a better and/or more idiomatic Roc way to achieve the same, but in terms of API readability and associated experience, this has been working particularly well in my use-case.</p>",
        "id": 430980566,
        "sender_full_name": "Hristo",
        "timestamp": 1712143815
    },
    {
        "content": "<p>Could you provide a small example? Does it work well in a scenario where you have to deal with massive data structures with dozens of (possibly nested) fields?</p>",
        "id": 430981362,
        "sender_full_name": "witoldsz",
        "timestamp": 1712144131
    },
    {
        "content": "<p>My use-case doesn't involve yet more than 2-3 levels of nesting, so I'm yet to see how that might hold up eventually, if/when such necessity arises.</p>\n<p>I'll be able to share some minimal example later today after work, yes.</p>",
        "id": 430981664,
        "sender_full_name": "Hristo",
        "timestamp": 1712144238
    },
    {
        "content": "<p>I sway back and forth, <span class=\"user-mention\" data-user-id=\"515922\">@witoldsz</span>, but I do have some reasons to like using results for Options. So maybe as a fellow sceptic I can give you some food for thought  :<br>\nIn the thread you linked discussing Option as a builtin <span class=\"user-mention\" data-user-id=\"343810\">@Brendan Hansknecht</span> mentioned using a result and I was initially skeptical but after some consideration I came around to it.</p>\n<ol>\n<li>No duplication of functionality/more simplicity. This is obvious, if you can have less things you should, less choices, better interop, less complexity</li>\n<li>For decoding it's super convenient because of error accumulation. <br>\nUsually decoding looks like this:</li>\n</ol>\n<ul>\n<li>check if the field exists</li>\n<li>Perform some validation and maybe a transformation, eg: check if a filepath exists, if a string matches some regex etc</li>\n<li>output the final validated happy path object <br>\nBecause results accumulate Errors your final return for that field might be `Result val [Null, NotValidEmail] instead of Option (Result val [NotValidEmail])</li>\n</ul>",
        "id": 430982255,
        "sender_full_name": "Eli Dowling",
        "timestamp": 1712144418
    },
    {
        "content": "<p>Going back to the original example here:</p>\n<div class=\"codehilite\" data-code-language=\"Elm\"><pre><span></span><code><span class=\"kt\">EventSystemAlertsCreate</span><span class=\"w\"> </span><span class=\"nf\">:</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">    </span><span class=\"nv\">submitId</span><span class=\"w\"> </span><span class=\"nf\">:</span><span class=\"w\"> </span><span class=\"kt\">Str</span><span class=\"p\">,</span>\n<span class=\"w\">    </span><span class=\"nv\">refs</span><span class=\"w\"> </span><span class=\"err\">?</span><span class=\"w\"> </span><span class=\"kt\">Str</span><span class=\"p\">,</span>\n<span class=\"p\">}</span>\n\n<span class=\"nv\">event1</span><span class=\"nf\">:</span><span class=\"w\"> </span><span class=\"kt\">EventSystemAlertsCreate</span>\n<span class=\"nv\">event1</span><span class=\"w\"> </span><span class=\"nf\">=</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">    </span><span class=\"nv\">submitId</span><span class=\"nf\">:</span><span class=\"w\"> </span><span class=\"s\">\"123\"</span><span class=\"p\">,</span>\n<span class=\"w\">    </span><span class=\"nv\">refs</span><span class=\"nf\">:</span><span class=\"w\"> </span><span class=\"s\">\"456\"</span>\n<span class=\"p\">}</span>\n\n<span class=\"nv\">event2</span><span class=\"nf\">:</span><span class=\"w\"> </span><span class=\"kt\">EventSystemAlertsCreate</span>\n<span class=\"nv\">event2</span><span class=\"w\"> </span><span class=\"nf\">=</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">    </span><span class=\"nv\">submitId</span><span class=\"nf\">:</span><span class=\"w\"> </span><span class=\"s\">\"123\"</span><span class=\"p\">,</span>\n\n<span class=\"p\">}</span>\n</code></pre></div>\n<p><strong>I think this should compile as is. I think it not working is a bug.</strong></p>\n<p>Note: the <code>refs</code> field would not be useable until destructing happens to initialize the field with a default value:</p>\n<div class=\"codehilite\" data-code-language=\"Elm\"><pre><span></span><code><span class=\"p\">{</span><span class=\"w\"> </span><span class=\"nv\">submitId</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"nv\">refs</span><span class=\"w\"> </span><span class=\"err\">?</span><span class=\"w\"> </span><span class=\"s\">\"default\"</span><span class=\"w\"> </span><span class=\"p\">}</span><span class=\"w\"> </span><span class=\"nf\">=</span><span class=\"w\"> </span><span class=\"nv\">event1</span>\n</code></pre></div>\n<p>The reason why, both of these types are clearly fine to be <code>EventSystemAlertsCreate</code> because both of these compile just fine:</p>\n<div class=\"codehilite\" data-code-language=\"Elm\"><pre><span></span><code><span class=\"nv\">event1</span><span class=\"w\"> </span><span class=\"nf\">=</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">    </span><span class=\"nv\">submitId</span><span class=\"nf\">:</span><span class=\"w\"> </span><span class=\"s\">\"123\"</span><span class=\"p\">,</span>\n<span class=\"w\">    </span><span class=\"nv\">refs</span><span class=\"nf\">:</span><span class=\"w\"> </span><span class=\"s\">\"456\"</span>\n<span class=\"p\">}</span>\n\n<span class=\"nv\">eventFn</span><span class=\"w\"> </span><span class=\"nf\">:</span><span class=\"w\"> </span><span class=\"kt\">EventSystemAlertsCreate</span><span class=\"w\"> </span><span class=\"nf\">-&gt;</span><span class=\"w\"> </span><span class=\"kt\">Str</span>\n<span class=\"nv\">eventFn</span><span class=\"w\"> </span><span class=\"nf\">=</span><span class=\"w\"> </span><span class=\"nf\">\\</span><span class=\"p\">{</span><span class=\"nv\">submitId</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"nv\">refs</span><span class=\"err\">?</span><span class=\"w\"> </span><span class=\"s\">\"default\"</span><span class=\"p\">}</span><span class=\"w\"> </span><span class=\"nf\">-&gt;</span>\n<span class=\"w\">    </span><span class=\"kt\">Str</span><span class=\"nf\">.</span><span class=\"nv\">concat</span><span class=\"w\"> </span><span class=\"nv\">submitId</span><span class=\"w\"> </span><span class=\"nv\">refs</span>\n\n<span class=\"nv\">event1Str</span><span class=\"w\"> </span><span class=\"nf\">=</span><span class=\"w\"> </span><span class=\"nv\">eventFn</span><span class=\"w\"> </span><span class=\"nv\">event1</span>\n</code></pre></div>\n<p>and</p>\n<div class=\"codehilite\" data-code-language=\"Elm\"><pre><span></span><code><span class=\"nv\">event2</span><span class=\"w\"> </span><span class=\"nf\">=</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">    </span><span class=\"nv\">submitId</span><span class=\"nf\">:</span><span class=\"w\"> </span><span class=\"s\">\"123\"</span><span class=\"p\">,</span>\n<span class=\"p\">}</span>\n\n<span class=\"nv\">eventFn</span><span class=\"w\"> </span><span class=\"nf\">:</span><span class=\"w\"> </span><span class=\"kt\">EventSystemAlertsCreate</span><span class=\"w\"> </span><span class=\"nf\">-&gt;</span><span class=\"w\"> </span><span class=\"kt\">Str</span>\n<span class=\"nv\">eventFn</span><span class=\"w\"> </span><span class=\"nf\">=</span><span class=\"w\"> </span><span class=\"nf\">\\</span><span class=\"p\">{</span><span class=\"nv\">submitId</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"nv\">refs</span><span class=\"err\">?</span><span class=\"w\"> </span><span class=\"s\">\"default\"</span><span class=\"p\">}</span><span class=\"w\"> </span><span class=\"nf\">-&gt;</span>\n<span class=\"w\">    </span><span class=\"kt\">Str</span><span class=\"nf\">.</span><span class=\"nv\">concat</span><span class=\"w\"> </span><span class=\"nv\">submitId</span><span class=\"w\"> </span><span class=\"nv\">refs</span>\n\n<span class=\"nv\">event2Str</span><span class=\"w\"> </span><span class=\"nf\">=</span><span class=\"w\"> </span><span class=\"nv\">eventFn</span><span class=\"w\"> </span><span class=\"nv\">event2</span>\n</code></pre></div>\n<p>Note, we currently have another bug in specialization that breaks this:</p>\n<div class=\"codehilite\" data-code-language=\"Elm\"><pre><span></span><code><span class=\"nv\">event1</span><span class=\"w\"> </span><span class=\"nf\">=</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">    </span><span class=\"nv\">submitId</span><span class=\"nf\">:</span><span class=\"w\"> </span><span class=\"s\">\"123\"</span><span class=\"p\">,</span>\n<span class=\"w\">    </span><span class=\"nv\">refs</span><span class=\"nf\">:</span><span class=\"w\"> </span><span class=\"s\">\"456\"</span>\n<span class=\"p\">}</span>\n\n<span class=\"nv\">event2</span><span class=\"w\"> </span><span class=\"nf\">=</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">    </span><span class=\"nv\">submitId</span><span class=\"nf\">:</span><span class=\"w\"> </span><span class=\"s\">\"123\"</span><span class=\"p\">,</span>\n<span class=\"p\">}</span>\n\n<span class=\"nv\">eventFn</span><span class=\"w\"> </span><span class=\"nf\">:</span><span class=\"w\"> </span><span class=\"kt\">EventSystemAlertsCreate</span><span class=\"w\"> </span><span class=\"nf\">-&gt;</span><span class=\"w\"> </span><span class=\"kt\">Str</span>\n<span class=\"nv\">eventFn</span><span class=\"w\"> </span><span class=\"nf\">=</span><span class=\"w\"> </span><span class=\"nf\">\\</span><span class=\"p\">{</span><span class=\"nv\">submitId</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"nv\">refs</span><span class=\"err\">?</span><span class=\"w\"> </span><span class=\"s\">\"default\"</span><span class=\"p\">}</span><span class=\"w\"> </span><span class=\"nf\">-&gt;</span>\n<span class=\"w\">    </span><span class=\"kt\">Str</span><span class=\"nf\">.</span><span class=\"nv\">concat</span><span class=\"w\"> </span><span class=\"nv\">submitId</span><span class=\"w\"> </span><span class=\"nv\">refs</span>\n\n<span class=\"nv\">event1Str</span><span class=\"w\"> </span><span class=\"nf\">=</span><span class=\"w\"> </span><span class=\"nv\">eventFn</span><span class=\"w\"> </span><span class=\"nv\">event1</span>\n<span class=\"nv\">event2Str</span><span class=\"w\"> </span><span class=\"nf\">=</span><span class=\"w\"> </span><span class=\"nv\">eventFn</span><span class=\"w\"> </span><span class=\"nv\">event2</span>\n</code></pre></div>",
        "id": 431117893,
        "sender_full_name": "Brendan Hansknecht",
        "timestamp": 1712157564
    },
    {
        "content": "<p>Coincidentally, I've just run into what seems to be exactly the same issue (although, I thought I didn't expect it to fail in this new use-case of mine). The minimum reproducible example is as follows (please, note the difference between <code>OptionalFields1.roc</code> and <code>OptionalFields2.roc</code> and their corresponding compilation results):</p>\n<div class=\"codehilite\" data-code-language=\"Elm\"><pre><span></span><code><span class=\"nf\">&gt;</span><span class=\"w\"> </span><span class=\"nv\">cat</span><span class=\"w\"> </span><span class=\"kt\">OptionalFields2</span><span class=\"nf\">.</span><span class=\"nv\">roc</span>\n<span class=\"nv\">interface</span><span class=\"w\"> </span><span class=\"kt\">OptionalFields2</span>\n<span class=\"w\">    </span><span class=\"nv\">exposes</span><span class=\"w\"> </span><span class=\"p\">[]</span>\n<span class=\"w\">    </span><span class=\"nv\">imports</span><span class=\"w\"> </span><span class=\"p\">[]</span>\n\n<span class=\"kt\">RecordWithOptional</span><span class=\"w\"> </span><span class=\"nf\">:</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\"> </span><span class=\"nv\">abc</span><span class=\"w\"> </span><span class=\"nf\">:</span><span class=\"w\"> </span><span class=\"kt\">U64</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"nv\">def</span><span class=\"w\"> </span><span class=\"err\">?</span><span class=\"w\"> </span><span class=\"kt\">U64</span><span class=\"w\"> </span><span class=\"p\">}</span>\n\n<span class=\"nv\">sumRecord</span><span class=\"w\"> </span><span class=\"nf\">:</span><span class=\"w\"> </span><span class=\"kt\">RecordWithOptional</span><span class=\"w\"> </span><span class=\"nf\">-&gt;</span><span class=\"w\"> </span><span class=\"kt\">U64</span>\n<span class=\"nv\">sumRecord</span><span class=\"w\"> </span><span class=\"nf\">=</span><span class=\"w\"> </span><span class=\"nf\">\\</span><span class=\"p\">{</span><span class=\"w\"> </span><span class=\"nv\">abc</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"nv\">def</span><span class=\"w\"> </span><span class=\"err\">?</span><span class=\"w\"> </span><span class=\"mi\">5</span><span class=\"w\"> </span><span class=\"p\">}</span><span class=\"w\"> </span><span class=\"nf\">-&gt;</span><span class=\"w\"> </span><span class=\"nv\">abc</span><span class=\"w\"> </span><span class=\"nf\">+</span><span class=\"w\"> </span><span class=\"nv\">def</span>\n\n<span class=\"nv\">expect</span>\n<span class=\"w\">    </span><span class=\"nv\">sumRecord</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\"> </span><span class=\"nv\">abc</span><span class=\"w\"> </span><span class=\"nf\">:</span><span class=\"w\"> </span><span class=\"mi\">3</span><span class=\"w\"> </span><span class=\"p\">}</span><span class=\"w\"> </span><span class=\"nf\">==</span><span class=\"w\"> </span><span class=\"mi\">8</span>\n\n<span class=\"nv\">expect</span>\n<span class=\"w\">    </span><span class=\"nv\">sumRecord</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\"> </span><span class=\"nv\">abc</span><span class=\"w\"> </span><span class=\"nf\">:</span><span class=\"w\"> </span><span class=\"mi\">3</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"nv\">def</span><span class=\"w\"> </span><span class=\"nf\">:</span><span class=\"w\"> </span><span class=\"mi\">8</span><span class=\"w\"> </span><span class=\"p\">}</span><span class=\"w\"> </span><span class=\"nf\">==</span><span class=\"w\"> </span><span class=\"mi\">11</span><span class=\"w\"> </span><span class=\"err\">#</span><span class=\"w\"> </span><span class=\"nf\">&lt;-</span><span class=\"c1\">------ this is the only effective difference between the two files</span>\n\n<span class=\"nf\">&gt;</span><span class=\"w\"> </span><span class=\"nv\">roc</span><span class=\"w\"> </span><span class=\"nv\">test</span><span class=\"w\"> </span><span class=\"kt\">OptionalFields2</span><span class=\"nf\">.</span><span class=\"nv\">roc</span>\n\n<span class=\"err\">──</span><span class=\"w\"> </span><span class=\"kt\">TYPE</span><span class=\"w\"> </span><span class=\"kt\">MISMATCH</span><span class=\"w\"> </span><span class=\"kr\">in</span><span class=\"w\"> </span><span class=\"kt\">OptionalFields</span><span class=\"nf\">.</span><span class=\"nv\">roc</span><span class=\"w\"> </span><span class=\"err\">─────────────────────────────────────────</span>\n\n<span class=\"kt\">This</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"nv\">st</span><span class=\"w\"> </span><span class=\"nv\">argument</span><span class=\"w\"> </span><span class=\"nv\">to</span><span class=\"w\"> </span><span class=\"nv\">sumRecord</span><span class=\"w\"> </span><span class=\"nv\">has</span><span class=\"w\"> </span><span class=\"nv\">an</span><span class=\"w\"> </span><span class=\"nv\">unexpected</span><span class=\"w\"> </span><span class=\"kr\">type</span><span class=\"nf\">:</span>\n\n<span class=\"mi\">11</span><span class=\"err\">│</span><span class=\"w\">      </span><span class=\"nv\">sumRecord</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\"> </span><span class=\"nv\">abc</span><span class=\"w\"> </span><span class=\"nf\">:</span><span class=\"w\"> </span><span class=\"mi\">3</span><span class=\"w\"> </span><span class=\"p\">}</span><span class=\"w\"> </span><span class=\"nf\">==</span><span class=\"w\"> </span><span class=\"mi\">8</span>\n<span class=\"w\">                   </span><span class=\"nf\">^^^^^^^^^^^</span>\n\n<span class=\"kt\">The</span><span class=\"w\"> </span><span class=\"nv\">argument</span><span class=\"w\"> </span><span class=\"nv\">is</span><span class=\"w\"> </span><span class=\"nv\">a</span><span class=\"w\"> </span><span class=\"nv\">record</span><span class=\"w\"> </span><span class=\"kr\">of</span><span class=\"w\"> </span><span class=\"kr\">type</span><span class=\"nf\">:</span>\n\n<span class=\"w\">    </span><span class=\"p\">{</span><span class=\"w\"> </span><span class=\"err\">…</span><span class=\"w\"> </span><span class=\"p\">}</span>\n\n<span class=\"kt\">But</span><span class=\"w\"> </span><span class=\"nv\">sumRecord</span><span class=\"w\"> </span><span class=\"nv\">needs</span><span class=\"w\"> </span><span class=\"nv\">its</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"nv\">st</span><span class=\"w\"> </span><span class=\"nv\">argument</span><span class=\"w\"> </span><span class=\"nv\">to</span><span class=\"w\"> </span><span class=\"nv\">be</span><span class=\"nf\">:</span>\n\n<span class=\"w\">    </span><span class=\"p\">{</span><span class=\"w\"> </span><span class=\"nv\">def</span><span class=\"w\"> </span><span class=\"nf\">:</span><span class=\"w\"> </span><span class=\"kt\">Int</span><span class=\"w\"> </span><span class=\"kt\">Unsigned64</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"err\">…</span><span class=\"w\"> </span><span class=\"p\">}</span>\n\n<span class=\"kt\">Tip</span><span class=\"nf\">:</span><span class=\"w\"> </span><span class=\"kt\">Looks</span><span class=\"w\"> </span><span class=\"nv\">like</span><span class=\"w\"> </span><span class=\"nv\">the</span><span class=\"w\"> </span><span class=\"nv\">def</span><span class=\"w\"> </span><span class=\"nv\">field</span><span class=\"w\"> </span><span class=\"nv\">is</span><span class=\"w\"> </span><span class=\"nv\">missing</span><span class=\"nf\">.</span>\n<span class=\"err\">────────────────────────────────────────────────────────────────────────────────</span>\n\n<span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"nv\">error</span><span class=\"w\"> </span><span class=\"nv\">and</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"nv\">warnings</span><span class=\"w\"> </span><span class=\"nv\">found</span><span class=\"w\"> </span><span class=\"kr\">in</span><span class=\"w\"> </span><span class=\"mi\">34</span><span class=\"w\"> </span><span class=\"nv\">ms</span>\n</code></pre></div>\n<div class=\"codehilite\" data-code-language=\"Elm\"><pre><span></span><code><span class=\"nf\">&gt;</span><span class=\"w\"> </span><span class=\"nv\">cat</span><span class=\"w\"> </span><span class=\"kt\">OptionalFields1</span><span class=\"nf\">.</span><span class=\"nv\">roc</span>\n<span class=\"nv\">interface</span><span class=\"w\"> </span><span class=\"kt\">OptionalFields1</span>\n<span class=\"w\">    </span><span class=\"nv\">exposes</span><span class=\"w\"> </span><span class=\"p\">[]</span>\n<span class=\"w\">    </span><span class=\"nv\">imports</span><span class=\"w\"> </span><span class=\"p\">[]</span>\n\n<span class=\"kt\">RecordWithOptional</span><span class=\"w\"> </span><span class=\"nf\">:</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\"> </span><span class=\"nv\">abc</span><span class=\"w\"> </span><span class=\"nf\">:</span><span class=\"w\"> </span><span class=\"kt\">U64</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"nv\">def</span><span class=\"w\"> </span><span class=\"err\">?</span><span class=\"w\"> </span><span class=\"kt\">U64</span><span class=\"w\"> </span><span class=\"p\">}</span>\n\n<span class=\"nv\">sumRecord</span><span class=\"w\"> </span><span class=\"nf\">:</span><span class=\"w\"> </span><span class=\"kt\">RecordWithOptional</span><span class=\"w\"> </span><span class=\"nf\">-&gt;</span><span class=\"w\"> </span><span class=\"kt\">U64</span>\n<span class=\"nv\">sumRecord</span><span class=\"w\"> </span><span class=\"nf\">=</span><span class=\"w\"> </span><span class=\"nf\">\\</span><span class=\"p\">{</span><span class=\"w\"> </span><span class=\"nv\">abc</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"nv\">def</span><span class=\"w\"> </span><span class=\"err\">?</span><span class=\"w\"> </span><span class=\"mi\">5</span><span class=\"w\"> </span><span class=\"p\">}</span><span class=\"w\"> </span><span class=\"nf\">-&gt;</span><span class=\"w\"> </span><span class=\"nv\">abc</span><span class=\"w\"> </span><span class=\"nf\">+</span><span class=\"w\"> </span><span class=\"nv\">def</span>\n\n<span class=\"nv\">expect</span>\n<span class=\"w\">    </span><span class=\"nv\">sumRecord</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\"> </span><span class=\"nv\">abc</span><span class=\"w\"> </span><span class=\"nf\">:</span><span class=\"w\"> </span><span class=\"mi\">3</span><span class=\"w\"> </span><span class=\"p\">}</span><span class=\"w\"> </span><span class=\"nf\">==</span><span class=\"w\"> </span><span class=\"mi\">8</span>\n\n<span class=\"nf\">&gt;</span><span class=\"w\"> </span><span class=\"nv\">roc</span><span class=\"w\"> </span><span class=\"nv\">test</span><span class=\"w\"> </span><span class=\"kt\">OptionalFields1</span><span class=\"nf\">.</span><span class=\"nv\">roc</span>\n\n<span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"nv\">failed</span><span class=\"w\"> </span><span class=\"nv\">and</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"nv\">passed</span><span class=\"w\"> </span><span class=\"kr\">in</span><span class=\"w\"> </span><span class=\"mi\">147</span><span class=\"w\"> </span><span class=\"nv\">ms</span><span class=\"nf\">.</span>\n</code></pre></div>\n<p>Please, note that if we stick to records containing the same subset of non-optional fields, then the compiler is happy in such instances:</p>\n<div class=\"codehilite\" data-code-language=\"Elm\"><pre><span></span><code><span class=\"nf\">&gt;</span><span class=\"w\"> </span><span class=\"nv\">cat</span><span class=\"w\"> </span><span class=\"kt\">OptionalFields3</span><span class=\"nf\">.</span><span class=\"nv\">roc</span>\n<span class=\"nv\">interface</span><span class=\"w\"> </span><span class=\"kt\">OptionalFields3</span>\n<span class=\"w\">    </span><span class=\"nv\">exposes</span><span class=\"w\"> </span><span class=\"p\">[]</span>\n<span class=\"w\">    </span><span class=\"nv\">imports</span><span class=\"w\"> </span><span class=\"p\">[]</span>\n\n<span class=\"kt\">RecordWithOptional</span><span class=\"w\"> </span><span class=\"nf\">:</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\"> </span><span class=\"nv\">abc</span><span class=\"w\"> </span><span class=\"nf\">:</span><span class=\"w\"> </span><span class=\"kt\">U64</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"nv\">def</span><span class=\"w\"> </span><span class=\"err\">?</span><span class=\"w\"> </span><span class=\"kt\">U64</span><span class=\"w\"> </span><span class=\"p\">}</span>\n\n<span class=\"nv\">sumRecord</span><span class=\"w\"> </span><span class=\"nf\">:</span><span class=\"w\"> </span><span class=\"kt\">RecordWithOptional</span><span class=\"w\"> </span><span class=\"nf\">-&gt;</span><span class=\"w\"> </span><span class=\"kt\">U64</span>\n<span class=\"nv\">sumRecord</span><span class=\"w\"> </span><span class=\"nf\">=</span><span class=\"w\"> </span><span class=\"nf\">\\</span><span class=\"p\">{</span><span class=\"w\"> </span><span class=\"nv\">abc</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"nv\">def</span><span class=\"w\"> </span><span class=\"err\">?</span><span class=\"w\"> </span><span class=\"mi\">5</span><span class=\"w\"> </span><span class=\"p\">}</span><span class=\"w\"> </span><span class=\"nf\">-&gt;</span><span class=\"w\"> </span><span class=\"nv\">abc</span><span class=\"w\"> </span><span class=\"nf\">+</span><span class=\"w\"> </span><span class=\"nv\">def</span>\n\n<span class=\"nv\">expect</span>\n<span class=\"w\">    </span><span class=\"nv\">sumRecord</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\"> </span><span class=\"nv\">abc</span><span class=\"w\"> </span><span class=\"nf\">:</span><span class=\"w\"> </span><span class=\"mi\">3</span><span class=\"w\"> </span><span class=\"p\">}</span><span class=\"w\"> </span><span class=\"nf\">==</span><span class=\"w\"> </span><span class=\"mi\">8</span>\n\n<span class=\"nv\">expect</span>\n<span class=\"w\">    </span><span class=\"nv\">sumRecord</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\"> </span><span class=\"nv\">abc</span><span class=\"w\"> </span><span class=\"nf\">:</span><span class=\"w\"> </span><span class=\"mi\">5</span><span class=\"w\"> </span><span class=\"p\">}</span><span class=\"w\"> </span><span class=\"nf\">==</span><span class=\"w\"> </span><span class=\"mi\">10</span><span class=\"w\">  </span><span class=\"err\">#</span><span class=\"w\"> </span><span class=\"nf\">&lt;-</span><span class=\"c1\">--------- same subset of fields as in the first `expect` block</span>\n\n<span class=\"nf\">&gt;</span><span class=\"w\"> </span><span class=\"nv\">roc</span><span class=\"w\"> </span><span class=\"nv\">test</span><span class=\"w\"> </span><span class=\"kt\">OptionalFields3</span><span class=\"nf\">.</span><span class=\"nv\">roc</span>\n\n<span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"nv\">failed</span><span class=\"w\"> </span><span class=\"nv\">and</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"w\"> </span><span class=\"nv\">passed</span><span class=\"w\"> </span><span class=\"kr\">in</span><span class=\"w\"> </span><span class=\"mi\">143</span><span class=\"w\"> </span><span class=\"nv\">ms</span><span class=\"nf\">.</span>\n</code></pre></div>",
        "id": 431181945,
        "sender_full_name": "Hristo",
        "timestamp": 1712180738
    },
    {
        "content": "<p>Yep, that is the specialization bug.</p>",
        "id": 431184501,
        "sender_full_name": "Brendan Hansknecht",
        "timestamp": 1712181787
    }
]