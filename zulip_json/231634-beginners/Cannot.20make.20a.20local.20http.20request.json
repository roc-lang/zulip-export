[
    {
        "content": "<p>The following program that should send an HTTP request crashes with an error:</p>\n<div class=\"codehilite\"><pre><span></span><code>app &quot;hello&quot;\n  packages {\n      pf: &quot;https://github.com/roc-lang/basic-cli/releases/download/0.7.0/bkGby8jb0tmZYsy2hg1E_B2QrCgcSTxdUlHtETwm5m4.tar.br&quot;,\n  }\n  imports [pf.Task.{ Task, await }, pf.Http, pf.Stdout]\n  provides [main] to pf\n\nurl = &quot;http://localhost:8080&quot;\nmain =\n  _ &lt;-\n    { Http.defaultRequest &amp;\n        url: Str.concat url &quot;/config/authentication&quot;,\n        timeout: TimeoutMilliseconds 5000\n    }\n    |&gt; Http.send\n    |&gt; Task.attempt\n  Stdout.line &quot;Completed ping request.&quot;\n</code></pre></div>\n<div class=\"codehilite\"><pre><span></span><code>thread &#39;&lt;unnamed&gt;&#39; panicked at &#39;there is no reactor running, must be called from the context of a Tokio 1.x runtime&#39;, src/lib.rs:678:42\nnote: run with `RUST_BACKTRACE=1` environment variable to display a backtrace\nfatal runtime error: failed to initiate panic, error 5\nAborted (core dumped)\n</code></pre></div>\n<p>Running in Ubuntu 22, non-WSL, not inside Docker<br>\nstrace (trimmed beginning to fit into the message limit):</p>\n<div class=\"codehilite\"><pre><span></span><code>execve(&quot;/usr/bin/test&quot;, [&quot;test&quot;], 0x7ffdb1de0940 /* 91 vars */) = 0\n...\nread(3, &quot;# Locale name alias data base.\\n#&quot;..., 4096) = 2996\nread(3, &quot;&quot;, 4096)                       = 0\nclose(3)                                = 0\nopenat(AT_FDCWD, &quot;/snap/code/148/usr/lib/locale/en_GB.UTF-8/LC_IDENTIFICATION&quot;, O_RDONLY|O_CLOEXEC) = -1 ENOENT (No such file or directory)\nopenat(AT_FDCWD, &quot;/usr/lib/locale/en_GB.UTF-8/LC_IDENTIFICATION&quot;, O_RDONLY|O_CLOEXEC) = -1 ENOENT (No such file or directory)\nopenat(AT_FDCWD, &quot;/snap/code/148/usr/lib/locale/en_GB.utf8/LC_IDENTIFICATION&quot;, O_RDONLY|O_CLOEXEC) = 3\nnewfstatat(3, &quot;&quot;, {st_mode=S_IFREG|0644, st_size=373, ...}, AT_EMPTY_PATH) = 0\nmmap(NULL, 373, PROT_READ, MAP_PRIVATE, 3, 0) = 0x7f19ee62c000\nclose(3)                                = 0\nopenat(AT_FDCWD, &quot;/usr/lib/x86_64-linux-gnu/gconv/gconv-modules.cache&quot;, O_RDONLY) = 3\nnewfstatat(3, &quot;&quot;, {st_mode=S_IFREG|0644, st_size=27002, ...}, AT_EMPTY_PATH) = 0\nmmap(NULL, 27002, PROT_READ, MAP_SHARED, 3, 0) = 0x7f19ee5ec000\nclose(3)                                = 0\nfutex(0x7f19ee41aa6c, FUTEX_WAKE_PRIVATE, 2147483647) = 0\nopenat(AT_FDCWD, &quot;/snap/code/148/usr/lib/locale/en_GB.UTF-8/LC_MEASUREMENT&quot;, O_RDONLY|O_CLOEXEC) = -1 ENOENT (No such file or directory)\nopenat(AT_FDCWD, &quot;/usr/lib/locale/en_GB.UTF-8/LC_MEASUREMENT&quot;, O_RDONLY|O_CLOEXEC) = -1 ENOENT (No such file or directory)\nopenat(AT_FDCWD, &quot;/snap/code/148/usr/lib/locale/en_GB.utf8/LC_MEASUREMENT&quot;, O_RDONLY|O_CLOEXEC) = 3\nnewfstatat(3, &quot;&quot;, {st_mode=S_IFREG|0644, st_size=23, ...}, AT_EMPTY_PATH) = 0\nmmap(NULL, 23, PROT_READ, MAP_PRIVATE, 3, 0) = 0x7f19ee5eb000\nclose(3)                                = 0\nopenat(AT_FDCWD, &quot;/snap/code/148/usr/lib/locale/en_GB.UTF-8/LC_TELEPHONE&quot;, O_RDONLY|O_CLOEXEC) = -1 ENOENT (No such file or directory)\nopenat(AT_FDCWD, &quot;/usr/lib/locale/en_GB.UTF-8/LC_TELEPHONE&quot;, O_RDONLY|O_CLOEXEC) = -1 ENOENT (No such file or directory)\nopenat(AT_FDCWD, &quot;/snap/code/148/usr/lib/locale/en_GB.utf8/LC_TELEPHONE&quot;, O_RDONLY|O_CLOEXEC) = 3\nnewfstatat(3, &quot;&quot;, {st_mode=S_IFREG|0644, st_size=56, ...}, AT_EMPTY_PATH) = 0\nmmap(NULL, 56, PROT_READ, MAP_PRIVATE, 3, 0) = 0x7f19ee5ea000\nclose(3)                                = 0\nopenat(AT_FDCWD, &quot;/snap/code/148/usr/lib/locale/en_GB.UTF-8/LC_ADDRESS&quot;, O_RDONLY|O_CLOEXEC) = -1 ENOENT (No such file or directory)\nopenat(AT_FDCWD, &quot;/usr/lib/locale/en_GB.UTF-8/LC_ADDRESS&quot;, O_RDONLY|O_CLOEXEC) = -1 ENOENT (No such file or directory)\nopenat(AT_FDCWD, &quot;/snap/code/148/usr/lib/locale/en_GB.utf8/LC_ADDRESS&quot;, O_RDONLY|O_CLOEXEC) = 3\nnewfstatat(3, &quot;&quot;, {st_mode=S_IFREG|0644, st_size=158, ...}, AT_EMPTY_PATH) = 0\nmmap(NULL, 158, PROT_READ, MAP_PRIVATE, 3, 0) = 0x7f19ee5e9000\nclose(3)                                = 0\nopenat(AT_FDCWD, &quot;/snap/code/148/usr/lib/locale/en_GB.UTF-8/LC_NAME&quot;, O_RDONLY|O_CLOEXEC) = -1 ENOENT (No such file or directory)\nopenat(AT_FDCWD, &quot;/usr/lib/locale/en_GB.UTF-8/LC_NAME&quot;, O_RDONLY|O_CLOEXEC) = -1 ENOENT (No such file or directory)\nopenat(AT_FDCWD, &quot;/snap/code/148/usr/lib/locale/en_GB.utf8/LC_NAME&quot;, O_RDONLY|O_CLOEXEC) = 3\nnewfstatat(3, &quot;&quot;, {st_mode=S_IFREG|0644, st_size=77, ...}, AT_EMPTY_PATH) = 0\nmmap(NULL, 77, PROT_READ, MAP_PRIVATE, 3, 0) = 0x7f19ee5e8000\nclose(3)                                = 0\nopenat(AT_FDCWD, &quot;/snap/code/148/usr/lib/locale/en_GB.UTF-8/LC_PAPER&quot;, O_RDONLY|O_CLOEXEC) = -1 ENOENT (No such file or directory)\nopenat(AT_FDCWD, &quot;/usr/lib/locale/en_GB.UTF-8/LC_PAPER&quot;, O_RDONLY|O_CLOEXEC) = -1 ENOENT (No such file or directory)\nopenat(AT_FDCWD, &quot;/snap/code/148/usr/lib/locale/en_GB.utf8/LC_PAPER&quot;, O_RDONLY|O_CLOEXEC) = 3\nnewfstatat(3, &quot;&quot;, {st_mode=S_IFREG|0644, st_size=34, ...}, AT_EMPTY_PATH) = 0\nmmap(NULL, 34, PROT_READ, MAP_PRIVATE, 3, 0) = 0x7f19ee5e7000\nclose(3)                                = 0\nopenat(AT_FDCWD, &quot;/snap/code/148/usr/lib/locale/en_US.UTF-8/LC_MESSAGES&quot;, O_RDONLY|O_CLOEXEC) = -1 ENOENT (No such file or directory)\nopenat(AT_FDCWD, &quot;/usr/lib/locale/en_US.UTF-8/LC_MESSAGES&quot;, O_RDONLY|O_CLOEXEC) = -1 ENOENT (No such file or directory)\nopenat(AT_FDCWD, &quot;/snap/code/148/usr/lib/locale/en_US.utf8/LC_MESSAGES&quot;, O_RDONLY|O_CLOEXEC) = 3\nnewfstatat(3, &quot;&quot;, {st_mode=S_IFDIR|0755, st_size=38, ...}, AT_EMPTY_PATH) = 0\nclose(3)                                = 0\nopenat(AT_FDCWD, &quot;/snap/code/148/usr/lib/locale/en_US.utf8/LC_MESSAGES/SYS_LC_MESSAGES&quot;, O_RDONLY|O_CLOEXEC) = 3\nnewfstatat(3, &quot;&quot;, {st_mode=S_IFREG|0644, st_size=57, ...}, AT_EMPTY_PATH) = 0\nmmap(NULL, 57, PROT_READ, MAP_PRIVATE, 3, 0) = 0x7f19ee5e6000\nclose(3)                                = 0\nopenat(AT_FDCWD, &quot;/snap/code/148/usr/lib/locale/en_GB.UTF-8/LC_MONETARY&quot;, O_RDONLY|O_CLOEXEC) = -1 ENOENT (No such file or directory)\nopenat(AT_FDCWD, &quot;/usr/lib/locale/en_GB.UTF-8/LC_MONETARY&quot;, O_RDONLY|O_CLOEXEC) = -1 ENOENT (No such file or directory)\nopenat(AT_FDCWD, &quot;/snap/code/148/usr/lib/locale/en_GB.utf8/LC_MONETARY&quot;, O_RDONLY|O_CLOEXEC) = 3\nnewfstatat(3, &quot;&quot;, {st_mode=S_IFREG|0644, st_size=290, ...}, AT_EMPTY_PATH) = 0\nmmap(NULL, 290, PROT_READ, MAP_PRIVATE, 3, 0) = 0x7f19ee5e5000\nclose(3)                                = 0\nopenat(AT_FDCWD, &quot;/snap/code/148/usr/lib/locale/en_US.UTF-8/LC_COLLATE&quot;, O_RDONLY|O_CLOEXEC) = -1 ENOENT (No such file or directory)\nopenat(AT_FDCWD, &quot;/usr/lib/locale/en_US.UTF-8/LC_COLLATE&quot;, O_RDONLY|O_CLOEXEC) = -1 ENOENT (No such file or directory)\nopenat(AT_FDCWD, &quot;/snap/code/148/usr/lib/locale/en_US.utf8/LC_COLLATE&quot;, O_RDONLY|O_CLOEXEC) = 3\nnewfstatat(3, &quot;&quot;, {st_mode=S_IFREG|0644, st_size=2586930, ...}, AT_EMPTY_PATH) = 0\nmmap(NULL, 2586930, PROT_READ, MAP_PRIVATE, 3, 0) = 0x7f19edf88000\nclose(3)                                = 0\nopenat(AT_FDCWD, &quot;/snap/code/148/usr/lib/locale/en_GB.UTF-8/LC_TIME&quot;, O_RDONLY|O_CLOEXEC) = -1 ENOENT (No such file or directory)\nopenat(AT_FDCWD, &quot;/usr/lib/locale/en_GB.UTF-8/LC_TIME&quot;, O_RDONLY|O_CLOEXEC) = -1 ENOENT (No such file or directory)\nopenat(AT_FDCWD, &quot;/snap/code/148/usr/lib/locale/en_GB.utf8/LC_TIME&quot;, O_RDONLY|O_CLOEXEC) = 3\nnewfstatat(3, &quot;&quot;, {st_mode=S_IFREG|0644, st_size=3332, ...}, AT_EMPTY_PATH) = 0\nmmap(NULL, 3332, PROT_READ, MAP_PRIVATE, 3, 0) = 0x7f19ee5e4000\nclose(3)                                = 0\nopenat(AT_FDCWD, &quot;/snap/code/148/usr/lib/locale/en_GB.UTF-8/LC_NUMERIC&quot;, O_RDONLY|O_CLOEXEC) = -1 ENOENT (No such file or directory)\nopenat(AT_FDCWD, &quot;/usr/lib/locale/en_GB.UTF-8/LC_NUMERIC&quot;, O_RDONLY|O_CLOEXEC) = -1 ENOENT (No such file or directory)\nopenat(AT_FDCWD, &quot;/snap/code/148/usr/lib/locale/en_GB.utf8/LC_NUMERIC&quot;, O_RDONLY|O_CLOEXEC) = 3\nnewfstatat(3, &quot;&quot;, {st_mode=S_IFREG|0644, st_size=54, ...}, AT_EMPTY_PATH) = 0\nmmap(NULL, 54, PROT_READ, MAP_PRIVATE, 3, 0) = 0x7f19ee5e3000\nclose(3)                                = 0\nopenat(AT_FDCWD, &quot;/snap/code/148/usr/lib/locale/en_US.UTF-8/LC_CTYPE&quot;, O_RDONLY|O_CLOEXEC) = -1 ENOENT (No such file or directory)\nopenat(AT_FDCWD, &quot;/usr/lib/locale/en_US.UTF-8/LC_CTYPE&quot;, O_RDONLY|O_CLOEXEC) = -1 ENOENT (No such file or directory)\nopenat(AT_FDCWD, &quot;/snap/code/148/usr/lib/locale/en_US.utf8/LC_CTYPE&quot;, O_RDONLY|O_CLOEXEC) = 3\nnewfstatat(3, &quot;&quot;, {st_mode=S_IFREG|0644, st_size=340640, ...}, AT_EMPTY_PATH) = 0\nmmap(NULL, 340640, PROT_READ, MAP_PRIVATE, 3, 0) = 0x7f19ee58b000\nclose(3)                                = 0\nclose(1)                                = 0\nclose(2)                                = 0\nexit_group(1)                           = ?\n+++ exited with 1 +++\n</code></pre></div>\n<p>Does this have anything to do with a misconfigured system locale?</p>",
        "id": 410421735,
        "sender_full_name": "Karakatiza",
        "timestamp": 1703848726
    },
    {
        "content": "<p>I'll try to reproduce and investigate</p>",
        "id": 410429375,
        "sender_full_name": "Anton",
        "timestamp": 1703854220
    },
    {
        "content": "<p>The custom timeout is the trigger, <code>NoTimeout</code> works and <code>TimeoutMilliseconds 5000</code> does not. I'll get started on a fix.</p>",
        "id": 410432035,
        "sender_full_name": "Anton",
        "timestamp": 1703856042
    },
    {
        "content": "<p>Tracking in issue <a href=\"https://github.com/roc-lang/basic-cli/issues/146\">146</a>.</p>",
        "id": 410432280,
        "sender_full_name": "Anton",
        "timestamp": 1703856242
    },
    {
        "content": "<p>I have a fix on <a href=\"https://github.com/roc-lang/basic-cli/tree/fix_issue_146\">this branch</a>. I'll probably have a 0.7.2 pre-release up today.</p>",
        "id": 410449614,
        "sender_full_name": "Anton",
        "timestamp": 1703867242
    },
    {
        "content": "<p>Awesome!</p>",
        "id": 410449942,
        "sender_full_name": "Karakatiza",
        "timestamp": 1703867450
    },
    {
        "content": "<p>CI tests revealed segmentation faults in several other examples that are triggered by this fix. These segmentation faults most likely originate from a bug in the roc compiler and can take a while to fix unfortunately. So it may take a while until I can put up basic-cli 0.7.2 with this fix.</p>",
        "id": 410458304,
        "sender_full_name": "Anton",
        "timestamp": 1703871636
    },
    {
        "content": "<p>Is there a way to use basic-cli check if an endpoint is available? I hoped to use timeout for this</p>",
        "id": 411198265,
        "sender_full_name": "Karakatiza",
        "timestamp": 1704378488
    },
    {
        "content": "<p>You can use <code>curl -I --connect-timeout 5 YOUR_URL</code> with <a href=\"https://www.roc-lang.org/packages/basic-cli/0.7.1/Cmd#status\"><code>Cmd.status</code></a>. <code>Cmd.status</code> will return a successful Task (<code>{}</code>) if the exit code of the curl command was 0 and an <code>Error</code> if not.</p>",
        "id": 411343356,
        "sender_full_name": "Anton",
        "timestamp": 1704450265
    }
]