[
    {
        "content": "<p>Hi there! I was just dipping my toes back in for the first time in a while, trying out a combo of the <a href=\"https://github.com/roc-lang/roc/blob/main/docs/mini-tutorial-new-compiler.md\">roc mini tutorial</a> and the <a href=\"https://github.com/lukewilliamboswell/roc-platform-template-zig/blob/main/examples/all_roc_syntax.roc\">roc syntax in one file</a>. However, I seem to get a 'Secret does not implement unlock'. I've stripped it down to just the MRE:</p>\n<div class=\"codehilite\"><pre><span></span><code>app [main!] { pf: platform &quot;https://github.com/lukewilliamboswell/roc-platform-template-zig/releases/download/0.6/2BfGn4M9uWJNhDVeMghGeXNVDFijMfPsmmVeo6M4QjKX.tar.zst&quot; }\n\nimport pf.Stdout\n\nprint! = |something| {\n    Stdout.line!(Str.inspect(something))\n}\n\nSecret :: {\n    key : Str\n}.{\n    new : Str -&gt; Secret\n    new = |k| { key: k }\n\n    say_hi = |_| {\n        &quot;Hi!&quot;\n    }\n\n    unlock : Secret, Str -&gt; Str\n    unlock = |_secret, _password| {\n        &quot;Whatever!&quot;\n    }\n}\n\nmain! = |_args| {\n    secret = Secret.new(&quot;my_secret_key&quot;)\n    print!(secret.say_hi())\n    # &gt;&gt; Roc crashed: Secret does not implement say_hi\n    print!(secret.unlock(&quot;open sesame&quot;))\n    # &gt;&gt; Roc crashed: Secret does not implement unlock\n    Ok({})\n}\n</code></pre></div>\n<p>I'm on an m2 mac, <code>roc_nightly-macos_apple_silicon-2026-02-12-3bcd92c</code>, roc version <code>debug-3bcd92c5</code>. Not sure if I'm missing something obvious with syntax <span aria-label=\"sweat smile\" class=\"emoji emoji-1f605\" role=\"img\" title=\"sweat smile\">:sweat_smile:</span>  but this was straight from the syntax file.</p>",
        "id": 573611992,
        "sender_full_name": "Jonathan",
        "timestamp": 1770928100
    },
    {
        "content": "<p>Ah I think I know what this is. It's a bug <span aria-label=\"ladybug\" class=\"emoji emoji-1f41e\" role=\"img\" title=\"ladybug\">:ladybug:</span> </p>\n<p>If you move <code>Secret</code> into a type module <code>Secret.roc</code> I bet it would work properly... <span aria-label=\"sweat smile\" class=\"emoji emoji-1f605\" role=\"img\" title=\"sweat smile\">:sweat_smile:</span></p>",
        "id": 573612394,
        "sender_full_name": "Luke Boswell",
        "timestamp": 1770928274
    },
    {
        "content": "<p>Just a hunch</p>",
        "id": 573612418,
        "sender_full_name": "Luke Boswell",
        "timestamp": 1770928286
    },
    {
        "content": "<p>Yep, all good now</p>",
        "id": 573612556,
        "sender_full_name": "Jonathan",
        "timestamp": 1770928345
    },
    {
        "content": "<p>Just checking, is there any syntax/functionality etc for declaring modules or does roc just recursively discover and you can <code>import</code> at will?</p>",
        "id": 573612822,
        "sender_full_name": "Jonathan",
        "timestamp": 1770928463
    },
    {
        "content": "<p>This may help <a href=\"https://github.com/roc-lang/roc/blob/main/docs/langref/modules.md\">https://github.com/roc-lang/roc/blob/main/docs/langref/modules.md</a></p>",
        "id": 573612969,
        "sender_full_name": "Luke Boswell",
        "timestamp": 1770928541
    },
    {
        "content": "<p>A module == .roc file</p>",
        "id": 573613173,
        "sender_full_name": "Luke Boswell",
        "timestamp": 1770928632
    },
    {
        "content": "<p>You can group modules (files) using packages</p>",
        "id": 573613214,
        "sender_full_name": "Luke Boswell",
        "timestamp": 1770928651
    },
    {
        "content": "<p>So is it invalid to have types defined outside of a corresponding module?</p>",
        "id": 573613215,
        "sender_full_name": "Jonathan",
        "timestamp": 1770928651
    },
    {
        "content": "<p>I'm not sure about the question sorry... you define a type using <code>:=</code> or <code>::</code> syntax</p>",
        "id": 573613334,
        "sender_full_name": "Luke Boswell",
        "timestamp": 1770928712
    },
    {
        "content": "<p>Then you can use it anywhere in that same module, or in another module by <code>import</code> it</p>",
        "id": 573613393,
        "sender_full_name": "Luke Boswell",
        "timestamp": 1770928737
    },
    {
        "content": "<blockquote>\n<p>Ah I think I know what this is. It's a bug <span aria-label=\"ladybug\" class=\"emoji emoji-1f41e\" role=\"img\" title=\"ladybug\">:ladybug:</span></p>\n</blockquote>\n<p>I mean, is it the case that you can only define type X in a module/file called <code>X.roc</code>, and therefore the bug is that the error message should be more precise in telling me the cause of the error (there is no module with that type)?</p>",
        "id": 573613628,
        "sender_full_name": "Jonathan",
        "timestamp": 1770928854
    },
    {
        "content": "<p>Rather than I should be able to define that type in main.roc, and the bug you refer to that I can't <span aria-label=\"sweat smile\" class=\"emoji emoji-1f605\" role=\"img\" title=\"sweat smile\">:sweat_smile:</span></p>",
        "id": 573613780,
        "sender_full_name": "Jonathan",
        "timestamp": 1770928920
    },
    {
        "content": "<p>Oh, I think you should be able to do what you are, but the bug is that it's broken and doesn't let you</p>",
        "id": 573613921,
        "sender_full_name": "Luke Boswell",
        "timestamp": 1770929004
    },
    {
        "content": "<p>I suspect if you define a nominal type <code>:=</code> or <code>::</code> in the same module the static dispatch is broken</p>",
        "id": 573613978,
        "sender_full_name": "Luke Boswell",
        "timestamp": 1770929032
    },
    {
        "content": "<p>Ahh ok, got it, thanks</p>",
        "id": 573614038,
        "sender_full_name": "Jonathan",
        "timestamp": 1770929051
    },
    {
        "content": "<p>I can have a look soon and hopefully fix it. Just poking at another bug over my morning coffee <span aria-label=\"smiley\" class=\"emoji emoji-1f603\" role=\"img\" title=\"smiley\">:smiley:</span></p>",
        "id": 573614169,
        "sender_full_name": "Luke Boswell",
        "timestamp": 1770929104
    },
    {
        "content": "<p>I'm just trying to understand the implications of the module file naming - given that there are 4 types of module (type, platform, application, package) how would I go about defining some functions not necessarily associated with a type, e.g., some utils?</p>",
        "id": 573614769,
        "sender_full_name": "Jonathan",
        "timestamp": 1770929364
    },
    {
        "content": "<p>I'm having trouble reproducing the bug...</p>",
        "id": 573614786,
        "sender_full_name": "Luke Boswell",
        "timestamp": 1770929372
    },
    {
        "content": "<p>I had this same error earlier on x86 linux but I don't have access to that now</p>",
        "id": 573614970,
        "sender_full_name": "Jonathan",
        "timestamp": 1770929435
    },
    {
        "content": "<blockquote>\n<p>I go about defining some functions not necessarily associated with a type, e.g., some utils?</p>\n</blockquote>\n<p>You could make a <code>Utilities.roc</code> like</p>\n<div class=\"codehilite\"><pre><span></span><code>Utilities :: {}.{\n\n    SomeType :: ...\n\n    some_func = ...\n    some_other_func = ...\n}\n</code></pre></div>",
        "id": 573614982,
        "sender_full_name": "Luke Boswell",
        "timestamp": 1770929439
    },
    {
        "content": "<p>Does that also define a unit type <code>Utilities</code>?</p>",
        "id": 573615171,
        "sender_full_name": "Jonathan",
        "timestamp": 1770929527
    },
    {
        "content": "<blockquote>\n<p>I'm on an m2 mac,Â <code>roc_nightly-macos_apple_silicon-2026-02-12-3bcd92c</code>, roc versionÂ <code>debug-3bcd92c5</code>.</p>\n</blockquote>\n<p>I'm also on an M2 mac... not sure how to reproduce</p>\n<div class=\"codehilite\"><pre><span></span><code>7:51:16 ~/Documents/GitHub/roc heads/main $ roc version\nRoc compiler version debug-3bcd92c5\n7:51:50 ~/Documents/GitHub/roc heads/main $ roc broken.roc\n&quot;Hi!&quot;\n&quot;Whatever!&quot;\n</code></pre></div>",
        "id": 573615194,
        "sender_full_name": "Luke Boswell",
        "timestamp": 1770929535
    },
    {
        "content": "<p>This is the single file version? <span aria-label=\"thinking\" class=\"emoji emoji-1f914\" role=\"img\" title=\"thinking\">:thinking:</span></p>",
        "id": 573615293,
        "sender_full_name": "Jonathan",
        "timestamp": 1770929581
    },
    {
        "content": "<p>Ok, rather odd: if I run the whole syntax file (just copied from github with the platform set to yours) I get no error at all. But just running the MRE (removes everything not related to Secret) gives me the error</p>",
        "id": 573615999,
        "sender_full_name": "Jonathan",
        "timestamp": 1770929875
    },
    {
        "content": "<p>What's more is I was getting this error before but on the full file, and now only on the MRE. Is there some kind of cache I can clear?</p>",
        "id": 573616058,
        "sender_full_name": "Jonathan",
        "timestamp": 1770929903
    },
    {
        "content": "<p>You can use <code>--no-cache</code> flag with the cli</p>",
        "id": 573616186,
        "sender_full_name": "Luke Boswell",
        "timestamp": 1770929966
    },
    {
        "content": "<p>Still getting the error on MRE with --no-cache, and still _not_ getting the error on the full file <span aria-label=\"sweat smile\" class=\"emoji emoji-1f605\" role=\"img\" title=\"sweat smile\">:sweat_smile:</span></p>",
        "id": 573616404,
        "sender_full_name": "Jonathan",
        "timestamp": 1770930063
    },
    {
        "content": "<p>I don't particularly have the skills to debug this, sorry <span aria-label=\"sweat smile\" class=\"emoji emoji-1f605\" role=\"img\" title=\"sweat smile\">:sweat_smile:</span></p>",
        "id": 573616457,
        "sender_full_name": "Jonathan",
        "timestamp": 1770930083
    },
    {
        "content": "<p>So you're still getting the error with this <a class=\"message-link\" href=\"/#narrow/channel/231634-beginners/topic/Trying.20nightly.20-.20.20.27does.20not.20implement.27.20error/near/573611992\">#beginners &gt; Trying nightly -  'does not implement' error @ ðŸ’¬</a>  code snippet?</p>",
        "id": 573616563,
        "sender_full_name": "Luke Boswell",
        "timestamp": 1770930123
    },
    {
        "content": "<p>I'm not sure what you mean by MRE and full file -- are there two different things you are running?</p>",
        "id": 573616632,
        "sender_full_name": "Luke Boswell",
        "timestamp": 1770930151
    },
    {
        "content": "<p>Sorry I was trying to make it clearer but it isn't. By MRE I meant my Minimum Reproducible Example (or not!) and the 'full' file is <a href=\"https://github.com/lukewilliamboswell/roc-platform-template-zig/blob/main/examples/all_roc_syntax.roc\">this</a> and just changing the platform url</p>",
        "id": 573616828,
        "sender_full_name": "Jonathan",
        "timestamp": 1770930220
    },
    {
        "content": "<p>Thank you for clarifying</p>",
        "id": 573616968,
        "sender_full_name": "Luke Boswell",
        "timestamp": 1770930276
    },
    {
        "content": "<p>The process I went through was</p>\n<ul>\n<li>\n<p>linux x86 roc + 'full' syntax file -&gt; <code>Secret does not implement unlock</code><br>\nThen I had to leave that PC, so re-setup roc on my mac (clean start) and</p>\n</li>\n<li>\n<p>m2 arm64 roc + 'full' syntax file -&gt; <code>Secret does not implement unlock</code></p>\n</li>\n<li>m2 arm64 roc +minimal file -&gt; Same error again</li>\n</ul>\n<p>But now I've just tested the full file again on my mac and the error is gone <span aria-label=\"thinking\" class=\"emoji emoji-1f914\" role=\"img\" title=\"thinking\">:thinking:</span></p>",
        "id": 573617041,
        "sender_full_name": "Jonathan",
        "timestamp": 1770930299
    },
    {
        "content": "<p>oh wait... so the bug is happening on linux not mac?</p>\n<blockquote>\n<p>I'm on an m2 mac, <code>roc_nightly-macos_apple_silicon-2026-02-12-3bcd92c</code>, roc version <code>debug-3bcd92c5</code>.</p>\n</blockquote>",
        "id": 573617112,
        "sender_full_name": "Luke Boswell",
        "timestamp": 1770930330
    },
    {
        "content": "<p>I've only tried on my mac</p>",
        "id": 573617148,
        "sender_full_name": "Luke Boswell",
        "timestamp": 1770930341
    },
    {
        "content": "<p>That might be the issue... maybe we are doing something different on linux.</p>",
        "id": 573617405,
        "sender_full_name": "Luke Boswell",
        "timestamp": 1770930418
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"820027\">Jonathan</span> <a href=\"#narrow/channel/231634-beginners/topic/Trying.20nightly.20-.20.20'does.20not.20implement'.20error/near/573614970\">said</a>:</p>\n<blockquote>\n<p>I had this same error earlier on x86 linux but I don't have access to that now</p>\n</blockquote>\n<p>Sorry it's all a bit mixed up</p>",
        "id": 573617601,
        "sender_full_name": "Jonathan",
        "timestamp": 1770930488
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"820027\">Jonathan</span> <a href=\"#narrow/channel/231634-beginners/topic/Trying.20nightly.20-.20.20'does.20not.20implement'.20error/near/573617041\">said</a>:</p>\n<blockquote>\n<p>The process I went through was</p>\n<ul>\n<li>\n<p>linux x86 roc + 'full' syntax file -&gt; <code>Secret does not implement unlock</code><br>\nThen I had to leave that PC, so re-setup roc on my mac (clean start) and</p>\n</li>\n<li>\n<p>m2 arm64 roc + 'full' syntax file -&gt; <code>Secret does not implement unlock</code></p>\n</li>\n<li>m2 arm64 roc +minimal file -&gt; Same error again</li>\n</ul>\n<p>But now I've just tested the full file again on my mac and the error is gone <span aria-label=\"thinking\" class=\"emoji emoji-1f914\" role=\"img\" title=\"thinking\">:thinking:</span></p>\n</blockquote>\n<p>But this was the process</p>",
        "id": 573617638,
        "sender_full_name": "Jonathan",
        "timestamp": 1770930504
    },
    {
        "content": "<p>It may have been a stale cache from an older build of Roc</p>",
        "id": 573617707,
        "sender_full_name": "Luke Boswell",
        "timestamp": 1770930531
    },
    {
        "content": "<p>Looks like it - I just renamed the files and now I don't get any errors. (--no-cache wasn't helping however)</p>",
        "id": 573617856,
        "sender_full_name": "Jonathan",
        "timestamp": 1770930595
    },
    {
        "content": "<p>The last time I was trying roc was the rust compiler anyhow - would they overlap in the cache enough to cause this?</p>",
        "id": 573618049,
        "sender_full_name": "Jonathan",
        "timestamp": 1770930677
    },
    {
        "content": "<p>Yeah its a bit puzzling tbh -- there is no relation to the old rust compiler</p>",
        "id": 573618226,
        "sender_full_name": "Luke Boswell",
        "timestamp": 1770930765
    },
    {
        "content": "<p>I think we can lock this one in the memory bank and if it happens again we'll have another data point. Not sure how much more we can really get out of investigating this further now</p>",
        "id": 573618437,
        "sender_full_name": "Luke Boswell",
        "timestamp": 1770930856
    },
    {
        "content": "<p>I appreciate you taking the time to report it. It's the only way we will iron out all the issues</p>",
        "id": 573618511,
        "sender_full_name": "Luke Boswell",
        "timestamp": 1770930890
    },
    {
        "content": "<p>Yeh, not much can be done... <span aria-label=\"laughing\" class=\"emoji emoji-1f606\" role=\"img\" title=\"laughing\">:laughing:</span> Thank you! Enjoy your coffee</p>",
        "id": 573618592,
        "sender_full_name": "Jonathan",
        "timestamp": 1770930931
    },
    {
        "content": "<p><a href=\"https://github.com/roc-lang/roc/issues/9123\">https://github.com/roc-lang/roc/issues/9123</a></p>\n<p>This is related issue. What's funny - I could reproduce that only if the file is <code>main.roc</code> xddd</p>",
        "id": 573699364,
        "sender_full_name": "Hubert MaÅ‚kowski",
        "timestamp": 1770975069
    },
    {
        "content": "<p>Would you look at that... <code>main.roc</code> gives</p>\n<div class=\"codehilite\"><pre><span></span><code>20:58:38 ~/Documents/GitHub/roc heads/main $ roc version\nRoc compiler version release-safe-3bcd92c5\n20:59:01 ~/Documents/GitHub/roc heads/main $ roc main.roc\n\nRoc crashed: Secret does not implement say_hi\n</code></pre></div>",
        "id": 573704889,
        "sender_full_name": "Luke Boswell",
        "timestamp": 1770976748
    },
    {
        "content": "<p>Found the bug <span aria-label=\"tada\" class=\"emoji emoji-1f389\" role=\"img\" title=\"tada\">:tada:</span></p>",
        "id": 573706028,
        "sender_full_name": "Luke Boswell",
        "timestamp": 1770977121
    },
    {
        "content": "<p>What was the issue Luke?</p>",
        "id": 573709437,
        "sender_full_name": "Jonathan",
        "timestamp": 1770978287
    },
    {
        "content": "<p>The app and platform both have a module named <code>main.roc</code></p>",
        "id": 573710093,
        "sender_full_name": "Luke Boswell",
        "timestamp": 1770978509
    },
    {
        "content": "<p>That's an overly simplified explanation... <span aria-label=\"sweat smile\" class=\"emoji emoji-1f605\" role=\"img\" title=\"sweat smile\">:sweat_smile:</span></p>",
        "id": 573710180,
        "sender_full_name": "Luke Boswell",
        "timestamp": 1770978536
    },
    {
        "content": "<p>I'm just putting a PR together, I'll link it here</p>",
        "id": 573710234,
        "sender_full_name": "Luke Boswell",
        "timestamp": 1770978552
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"515757\">Luke Boswell</span> <a href=\"#narrow/channel/231634-beginners/topic/Trying.20nightly.20-.20.20'does.20not.20implement'.20error/near/573710180\">said</a>:</p>\n<blockquote>\n<p>That's an overly simplified explanation... <span aria-label=\"sweat smile\" class=\"emoji emoji-1f605\" role=\"img\" title=\"sweat smile\">:sweat_smile:</span></p>\n</blockquote>\n<p>Sufficiently simple for me <span aria-label=\"laughing\" class=\"emoji emoji-1f606\" role=\"img\" title=\"laughing\">:laughing:</span></p>",
        "id": 573710857,
        "sender_full_name": "Jonathan",
        "timestamp": 1770978758
    },
    {
        "content": "<p>The simple \"fix\" for just <code>main.roc</code> was easy... but I'm taking my time to think about the right fix for the broader issue this uncovers. </p>\n<p>We aren't properly handling module identifiers in a cross-package context. </p>\n<p>Currently if you had two <code>Color.roc</code> modules in two different packages the module identifiers would collide and cause issues.</p>",
        "id": 573845880,
        "sender_full_name": "Luke Boswell",
        "timestamp": 1771027608
    },
    {
        "content": "<p>PR <a href=\"https://github.com/roc-lang/roc/pull/9178\">https://github.com/roc-lang/roc/pull/9178</a></p>",
        "id": 573850979,
        "sender_full_name": "Luke Boswell",
        "timestamp": 1771032398
    }
]