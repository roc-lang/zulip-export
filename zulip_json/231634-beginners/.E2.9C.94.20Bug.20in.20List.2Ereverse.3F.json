[
    {
        "content": "<p>Here is my program:</p>\n<div class=\"codehilite\" data-code-language=\"Elm\"><pre><span></span><code><span class=\"nv\">app</span><span class=\"w\"> </span><span class=\"s\">\"automatons\"</span>\n<span class=\"w\">    </span><span class=\"nv\">packages</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\"> </span><span class=\"nv\">pf</span><span class=\"nf\">:</span><span class=\"w\"> </span><span class=\"s\">\"https://github.com/roc-lang/basic-cli/releases/download/0.7.1/Icc3xJoIixF3hCcfXrDwLCu4wQHtNdPyoJkEbkgIElA.tar.br\"</span><span class=\"w\"> </span><span class=\"p\">}</span>\n<span class=\"w\">    </span><span class=\"nv\">imports</span><span class=\"w\"> </span><span class=\"p\">[</span><span class=\"nv\">pf</span><span class=\"nf\">.</span><span class=\"kt\">Stdout</span><span class=\"p\">]</span>\n<span class=\"w\">    </span><span class=\"nv\">provides</span><span class=\"w\"> </span><span class=\"p\">[</span><span class=\"nv\">main</span><span class=\"p\">]</span><span class=\"w\"> </span><span class=\"nv\">to</span><span class=\"w\"> </span><span class=\"nv\">pf</span>\n\n<span class=\"kt\">Automaton</span><span class=\"w\"> </span><span class=\"nv\">i</span><span class=\"w\"> </span><span class=\"nv\">o</span><span class=\"w\"> </span><span class=\"nf\">:</span><span class=\"w\"> </span><span class=\"p\">[</span><span class=\"w\"> </span><span class=\"kt\">Arrow</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"nv\">i</span><span class=\"w\"> </span><span class=\"nf\">-&gt;</span><span class=\"w\"> </span><span class=\"nv\">o</span><span class=\"p\">),</span><span class=\"w\"> </span><span class=\"kt\">Step</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"nv\">i</span><span class=\"w\"> </span><span class=\"nf\">-&gt;</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"kt\">Automaton</span><span class=\"w\"> </span><span class=\"nv\">i</span><span class=\"w\"> </span><span class=\"nv\">o</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"nv\">o</span><span class=\"p\">))</span><span class=\"w\"> </span><span class=\"p\">]</span>\n\n<span class=\"err\">#</span><span class=\"w\"> </span><span class=\"kt\">Get</span><span class=\"w\"> </span><span class=\"nv\">the</span><span class=\"w\"> </span><span class=\"nv\">output</span><span class=\"w\"> </span><span class=\"nv\">and</span><span class=\"w\"> </span><span class=\"nv\">next</span><span class=\"w\"> </span><span class=\"kt\">Automaton</span><span class=\"w\"> </span><span class=\"nv\">for</span><span class=\"w\"> </span><span class=\"nv\">a</span><span class=\"w\"> </span><span class=\"nv\">given</span><span class=\"w\"> </span><span class=\"nv\">input</span>\n<span class=\"nv\">step</span><span class=\"w\"> </span><span class=\"nf\">:</span><span class=\"w\"> </span><span class=\"nv\">i</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"kt\">Automaton</span><span class=\"w\"> </span><span class=\"nv\">i</span><span class=\"w\"> </span><span class=\"nv\">o</span><span class=\"w\"> </span><span class=\"nf\">-&gt;</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"kt\">Automaton</span><span class=\"w\"> </span><span class=\"nv\">i</span><span class=\"w\"> </span><span class=\"nv\">o</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"nv\">o</span><span class=\"p\">)</span>\n<span class=\"nv\">step</span><span class=\"w\"> </span><span class=\"nf\">=</span><span class=\"w\"> </span><span class=\"nf\">\\</span><span class=\"nv\">input</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"nv\">automaton</span><span class=\"w\"> </span><span class=\"nf\">-&gt;</span>\n<span class=\"w\">    </span><span class=\"nv\">when</span><span class=\"w\"> </span><span class=\"nv\">automaton</span><span class=\"w\"> </span><span class=\"nv\">is</span>\n<span class=\"w\">        </span><span class=\"kt\">Arrow</span><span class=\"w\"> </span><span class=\"nv\">f</span><span class=\"w\"> </span><span class=\"nf\">-&gt;</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"nv\">automaton</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"nv\">f</span><span class=\"w\"> </span><span class=\"nv\">input</span><span class=\"p\">)</span>\n<span class=\"w\">        </span><span class=\"kt\">Step</span><span class=\"w\"> </span><span class=\"nv\">f</span><span class=\"w\"> </span><span class=\"nf\">-&gt;</span><span class=\"w\"> </span><span class=\"nv\">f</span><span class=\"w\"> </span><span class=\"nv\">input</span>\n\n<span class=\"err\">#</span><span class=\"w\"> </span><span class=\"kt\">Run</span><span class=\"w\"> </span><span class=\"nv\">an</span><span class=\"w\"> </span><span class=\"kt\">Automaton</span><span class=\"w\"> </span><span class=\"nv\">on</span><span class=\"w\"> </span><span class=\"nv\">a</span><span class=\"w\"> </span><span class=\"nv\">list</span><span class=\"w\"> </span><span class=\"kr\">of</span><span class=\"w\"> </span><span class=\"nv\">inputs</span><span class=\"w\"> </span><span class=\"nv\">till</span><span class=\"w\"> </span><span class=\"nv\">completion</span>\n<span class=\"nv\">run</span><span class=\"w\"> </span><span class=\"nf\">:</span><span class=\"w\"> </span><span class=\"kt\">List</span><span class=\"w\"> </span><span class=\"nv\">i</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"kt\">Automaton</span><span class=\"w\"> </span><span class=\"nv\">i</span><span class=\"w\"> </span><span class=\"nv\">o</span><span class=\"w\"> </span><span class=\"nf\">-&gt;</span><span class=\"w\"> </span><span class=\"kt\">List</span><span class=\"w\"> </span><span class=\"nv\">o</span>\n<span class=\"nv\">run</span><span class=\"w\"> </span><span class=\"nf\">=</span><span class=\"w\"> </span><span class=\"nf\">\\</span><span class=\"nv\">inputs</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"nv\">automaton</span><span class=\"w\"> </span><span class=\"nf\">-&gt;</span>\n<span class=\"w\">    </span><span class=\"nv\">loop</span><span class=\"w\"> </span><span class=\"nf\">=</span><span class=\"w\"> </span><span class=\"nf\">\\</span><span class=\"nv\">remaining</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"nv\">current</span><span class=\"w\"> </span><span class=\"nf\">-&gt;</span>\n<span class=\"w\">        </span><span class=\"nv\">when</span><span class=\"w\"> </span><span class=\"nv\">remaining</span><span class=\"w\"> </span><span class=\"nv\">is</span>\n<span class=\"w\">            </span><span class=\"p\">[]</span><span class=\"w\"> </span><span class=\"nf\">-&gt;</span><span class=\"w\"> </span><span class=\"p\">[]</span>\n<span class=\"w\">            </span><span class=\"p\">[</span><span class=\"nv\">x</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"nf\">..</span><span class=\"w\"> </span><span class=\"kr\">as</span><span class=\"w\"> </span><span class=\"nv\">xs</span><span class=\"p\">]</span><span class=\"w\"> </span><span class=\"nf\">-&gt;</span>\n<span class=\"w\">                </span><span class=\"p\">(</span><span class=\"nv\">next</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"nv\">output</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"nf\">=</span><span class=\"w\"> </span><span class=\"nv\">step</span><span class=\"w\"> </span><span class=\"nv\">x</span><span class=\"w\"> </span><span class=\"nv\">current</span>\n<span class=\"w\">                </span><span class=\"kt\">List</span><span class=\"nf\">.</span><span class=\"nv\">append</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"nv\">run</span><span class=\"w\"> </span><span class=\"nv\">xs</span><span class=\"w\"> </span><span class=\"nv\">next</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"nv\">output</span>\n\n<span class=\"w\">    </span><span class=\"err\">#</span><span class=\"w\"> </span><span class=\"nv\">loop</span><span class=\"w\"> </span><span class=\"nv\">inputs</span><span class=\"w\"> </span><span class=\"nv\">automaton</span>\n<span class=\"w\">    </span><span class=\"kt\">List</span><span class=\"nf\">.</span><span class=\"nv\">reverse</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"nv\">loop</span><span class=\"w\"> </span><span class=\"nv\">inputs</span><span class=\"w\"> </span><span class=\"nv\">automaton</span><span class=\"p\">)</span>\n\n\n<span class=\"err\">#</span><span class=\"w\"> </span><span class=\"kt\">Automaton</span><span class=\"w\"> </span><span class=\"nv\">that</span><span class=\"w\"> </span><span class=\"nv\">doubles</span><span class=\"w\"> </span><span class=\"nv\">the</span><span class=\"w\"> </span><span class=\"nv\">input</span>\n<span class=\"nv\">doubler</span><span class=\"w\"> </span><span class=\"nf\">=</span><span class=\"w\"> </span><span class=\"kt\">Arrow</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"nf\">\\</span><span class=\"nv\">x</span><span class=\"w\"> </span><span class=\"nf\">-&gt;</span><span class=\"w\"> </span><span class=\"nv\">x</span><span class=\"w\"> </span><span class=\"nf\">*</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"p\">)</span>\n\n<span class=\"kr\">main </span><span class=\"nf\">=</span>\n<span class=\"w\">    </span><span class=\"nv\">inputs</span><span class=\"w\"> </span><span class=\"nf\">=</span><span class=\"w\"> </span><span class=\"p\">[</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"mi\">3</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"mi\">4</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"mi\">5</span><span class=\"w\"> </span><span class=\"p\">]</span>\n<span class=\"w\">    </span><span class=\"nv\">output</span><span class=\"w\"> </span><span class=\"nf\">=</span><span class=\"w\"> </span><span class=\"nv\">run</span><span class=\"w\"> </span><span class=\"nv\">inputs</span><span class=\"w\"> </span><span class=\"nv\">doubler</span>\n<span class=\"w\">    </span><span class=\"nv\">outputStr</span><span class=\"w\"> </span><span class=\"nf\">=</span><span class=\"w\"> </span><span class=\"nv\">output</span><span class=\"w\"> </span><span class=\"nf\">|&gt;</span><span class=\"w\"> </span><span class=\"kt\">List</span><span class=\"nf\">.</span><span class=\"nv\">map</span><span class=\"w\"> </span><span class=\"kt\">Num</span><span class=\"nf\">.</span><span class=\"nv\">toStr</span><span class=\"w\"> </span><span class=\"nf\">|&gt;</span><span class=\"w\"> </span><span class=\"kt\">Str</span><span class=\"nf\">.</span><span class=\"nv\">joinWith</span><span class=\"w\"> </span><span class=\"s\">\", \"</span>\n<span class=\"w\">    </span><span class=\"kt\">Stdout</span><span class=\"nf\">.</span><span class=\"nv\">line</span><span class=\"w\"> </span><span class=\"nv\">outputStr</span>\n\n\n<span class=\"err\">#</span><span class=\"w\"> </span><span class=\"kt\">Without</span><span class=\"w\"> </span><span class=\"kt\">List</span><span class=\"nf\">.</span><span class=\"nv\">reverse</span>\n<span class=\"err\">#</span><span class=\"w\"> </span><span class=\"mi\">10</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"mi\">8</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"mi\">6</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"mi\">4</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"mi\">2</span>\n\n<span class=\"err\">#</span><span class=\"w\"> </span><span class=\"kt\">With</span><span class=\"w\"> </span><span class=\"kt\">List</span><span class=\"nf\">.</span><span class=\"nv\">reverse</span>\n<span class=\"err\">#</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"mi\">6</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"mi\">10</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"mi\">8</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"mi\">4</span>\n\n<span class=\"err\">#</span><span class=\"w\"> </span><span class=\"kt\">I</span><span class=\"w\"> </span><span class=\"nv\">would</span><span class=\"w\"> </span><span class=\"nv\">expect</span>\n<span class=\"err\">#</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"mi\">4</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"mi\">6</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"mi\">8</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"mi\">10</span>\n</code></pre></div>\n<p>Expected and actual in the comments at the end.<br>\nRemoving <code>List.reverse</code> gets rid of the weirdness, although is not correct implementation-wise.</p>",
        "id": 412616862,
        "sender_full_name": "njlr",
        "timestamp": 1705091933
    },
    {
        "content": "<p>Unless I'm missing something stupid I can file on GitHub</p>",
        "id": 412617047,
        "sender_full_name": "njlr",
        "timestamp": 1705092012
    },
    {
        "content": "<p>I think it is working correctly:</p>\n<div class=\"codehilite\"><pre><span></span><code>[/tmp/test.roc:50] list = []\n[/tmp/test.roc:52] out = []\n[/tmp/test.roc:50] list = [10]\n[/tmp/test.roc:52] out = [10]\n[/tmp/test.roc:50] list = [10, 8]\n[/tmp/test.roc:52] out = [8, 10]\n[/tmp/test.roc:50] list = [8, 10, 6]\n[/tmp/test.roc:52] out = [6, 10, 8]\n[/tmp/test.roc:50] list = [6, 10, 8, 4]\n[/tmp/test.roc:52] out = [4, 8, 10, 6]\n[/tmp/test.roc:50] list = [4, 8, 10, 6, 2]\n[/tmp/test.roc:52] out = [2, 6, 10, 8, 4]\n</code></pre></div>",
        "id": 412642590,
        "sender_full_name": "Brendan Hansknecht",
        "timestamp": 1705105406
    },
    {
        "content": "<p>looks like an impl bug for your code</p>",
        "id": 412642616,
        "sender_full_name": "Brendan Hansknecht",
        "timestamp": 1705105414
    },
    {
        "content": "<p>probably reversing more than you want</p>",
        "id": 412642630,
        "sender_full_name": "Brendan Hansknecht",
        "timestamp": 1705105421
    },
    {
        "content": "<p>In my code above, if I swap these two lines (in the <code>run</code> function):</p>\n<div class=\"codehilite\" data-code-language=\"Elm\"><pre><span></span><code><span class=\"kt\">List</span><span class=\"nf\">.</span><span class=\"nv\">reverse</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"nv\">loop</span><span class=\"w\"> </span><span class=\"nv\">inputs</span><span class=\"w\"> </span><span class=\"nv\">automaton</span><span class=\"p\">)</span>\n<span class=\"err\">#</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"mi\">6</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"mi\">10</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"mi\">8</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"mi\">4</span>\n</code></pre></div>\n<div class=\"codehilite\" data-code-language=\"Elm\"><pre><span></span><code><span class=\"nv\">loop</span><span class=\"w\"> </span><span class=\"nv\">inputs</span><span class=\"w\"> </span><span class=\"nv\">automaton</span>\n<span class=\"err\">#</span><span class=\"w\"> </span><span class=\"mi\">10</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"mi\">8</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"mi\">6</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"mi\">4</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"mi\">2</span>\n</code></pre></div>\n<p>Then the final output is <em>not</em> the reverse of the other, which I think is odd. <br>\nMaybe I'm missing something?</p>",
        "id": 412689571,
        "sender_full_name": "njlr",
        "timestamp": 1705135779
    },
    {
        "content": "<p>You are recursively calling your “run” function, so you are doing a lot of reversing. <br>\nNot just on the final list as I think you intended.</p>\n<p>Try putting the reverse inside <br>\n main instead.</p>",
        "id": 412695145,
        "sender_full_name": "Hannes Nevalainen",
        "timestamp": 1705140487
    },
    {
        "content": "<p>Ah yes! Thank you</p>\n<p>I was recursively calling <code>run</code> where I should have been calling <code>loop</code></p>\n<p>This works:</p>\n<div class=\"codehilite\" data-code-language=\"Elm\"><pre><span></span><code><span class=\"nv\">run</span><span class=\"w\"> </span><span class=\"nf\">:</span><span class=\"w\"> </span><span class=\"kt\">List</span><span class=\"w\"> </span><span class=\"nv\">i</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"kt\">Automaton</span><span class=\"w\"> </span><span class=\"nv\">i</span><span class=\"w\"> </span><span class=\"nv\">o</span><span class=\"w\"> </span><span class=\"nf\">-&gt;</span><span class=\"w\"> </span><span class=\"kt\">List</span><span class=\"w\"> </span><span class=\"nv\">o</span>\n<span class=\"nv\">run</span><span class=\"w\"> </span><span class=\"nf\">=</span><span class=\"w\"> </span><span class=\"nf\">\\</span><span class=\"nv\">inputs</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"nv\">automaton</span><span class=\"w\"> </span><span class=\"nf\">-&gt;</span>\n<span class=\"w\">    </span><span class=\"nv\">loop</span><span class=\"w\"> </span><span class=\"nf\">=</span><span class=\"w\"> </span><span class=\"nf\">\\</span><span class=\"nv\">remaining</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"nv\">current</span><span class=\"w\"> </span><span class=\"nf\">-&gt;</span>\n<span class=\"w\">        </span><span class=\"nv\">when</span><span class=\"w\"> </span><span class=\"nv\">remaining</span><span class=\"w\"> </span><span class=\"nv\">is</span>\n<span class=\"w\">            </span><span class=\"p\">[]</span><span class=\"w\"> </span><span class=\"nf\">-&gt;</span><span class=\"w\"> </span><span class=\"p\">[]</span>\n<span class=\"w\">            </span><span class=\"p\">[</span><span class=\"nv\">x</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"nf\">..</span><span class=\"w\"> </span><span class=\"kr\">as</span><span class=\"w\"> </span><span class=\"nv\">xs</span><span class=\"p\">]</span><span class=\"w\"> </span><span class=\"nf\">-&gt;</span>\n<span class=\"w\">                </span><span class=\"p\">(</span><span class=\"nv\">next</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"nv\">output</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"nf\">=</span><span class=\"w\"> </span><span class=\"nv\">step</span><span class=\"w\"> </span><span class=\"nv\">x</span><span class=\"w\"> </span><span class=\"nv\">current</span>\n<span class=\"w\">                </span><span class=\"kt\">List</span><span class=\"nf\">.</span><span class=\"nv\">append</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"nv\">loop</span><span class=\"w\"> </span><span class=\"nv\">xs</span><span class=\"w\"> </span><span class=\"nv\">next</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"nv\">output</span>\n\n<span class=\"w\">    </span><span class=\"nv\">loop</span><span class=\"w\"> </span><span class=\"nv\">inputs</span><span class=\"w\"> </span><span class=\"nv\">automaton</span>\n<span class=\"w\">    </span><span class=\"nf\">|&gt;</span><span class=\"w\"> </span><span class=\"kt\">List</span><span class=\"nf\">.</span><span class=\"nv\">reverse</span>\n</code></pre></div>",
        "id": 412695661,
        "sender_full_name": "njlr",
        "timestamp": 1705140960
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"680630\">njlr</span> has marked this topic as resolved.</p>",
        "id": 412695709,
        "sender_full_name": "Notification Bot",
        "timestamp": 1705140978
    }
]