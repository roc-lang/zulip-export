[
    {
        "content": "<p>Hello!</p>\n<p>I am writing a very simple tool which needs to walk a directory structure but I've hit a road block. I get this error :</p>\n<div class=\"codehilite\" data-code-language=\"Text only\"><pre><span></span><code>This 2nd argument to |&gt; has an unexpected type:\n\n27│                      Ok children -&gt; children |&gt; List.join_map(|child| walk_hierarchy!(child, depth + 1, hierarchy))\n                                                                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n\nThe argument is an anonymous function of type:\n\n    Path.Path =&gt; List Str\n\nBut |&gt; needs its 2nd argument to be:\n\n    InternalPath.InternalPath -&gt; List Str\n</code></pre></div>\n<p>and I suspect that the Path vs InternalPath isn't the issue but rather the fact that I should somehow make my \"walk_hierarchy!\" function non-effectful? </p>\n<p>And this is my little bit a code :</p>\n<div class=\"codehilite\" data-code-language=\"Text only\"><pre><span></span><code>app [main!] {\n    cli: platform \"https://github.com/roc-lang/basic-cli/releases/download/0.19.0/Hj-J_zxz7V9YurCSTFcFdu6cQJie4guzsPMUi5kBYUk.tar.br\",\n}\n\nimport cli.Arg\nimport cli.Stderr\nimport cli.Dir\nimport cli.Path\n\nmain! = |args|\n    when List.get(args, 1) is\n        Ok arg -&gt;\n            root_path = Arg.display(arg) |&gt; Path.from_str\n            _hierarchy = walk_hierarchy!(root_path, 0, [])\n            Ok {}\n        Err OutOfBounds -&gt;\n            _ = Stderr.line!(\"Usage: archiveux PATH\")\n            Ok {}\n\nwalk_hierarchy! : Path.Path, U64, List Str =&gt; List Str\nwalk_hierarchy! = |root, depth, hierarchy|\n    current_level = [Str.repeat(\"\\t\", depth) |&gt; Str.concat(Path.display(root))]\n    subs = when Path.is_dir!(root) is\n        Ok is_dir -&gt;\n            if is_dir then\n                when Path.list_dir!(root) is\n                    Ok children -&gt; children |&gt; List.join_map(|child| walk_hierarchy!(child, depth + 1, hierarchy))\n                    Err _ -&gt; []\n            else\n                current_level\n        Err _ -&gt; []\n    List.concat(hierarchy, subs)\n</code></pre></div>\n<p>Any hint would be welcome!</p>",
        "id": 547147988,
        "sender_full_name": "Claude Précourt",
        "timestamp": 1761500931
    },
    {
        "content": "<p>The issue is fundamentally that <code>join_map</code> does not accept effectful functions. It would need to be <code>join_map!</code> to do so.</p>\n<p>There likely should be an effectful version of that function</p>",
        "id": 547149138,
        "sender_full_name": "Brendan Hansknecht",
        "timestamp": 1761501855
    },
    {
        "content": "<p>Easiest solution is to write your own for now:</p>\n<div class=\"codehilite\" data-code-language=\"Ruby\"><pre><span></span><code><span class=\"n\">join_map!</span><span class=\"w\"> </span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"no\">List</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"o\">=&gt;</span><span class=\"w\"> </span><span class=\"no\">List</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"o\">=&gt;</span><span class=\"w\"> </span><span class=\"no\">List</span><span class=\"w\"> </span><span class=\"n\">b</span>\n<span class=\"n\">join_map!</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"o\">|</span><span class=\"n\">list</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">mapper</span><span class=\"o\">|</span>\n<span class=\"w\">    </span><span class=\"no\">List</span><span class=\"o\">.</span><span class=\"n\">walk!</span><span class=\"p\">(</span><span class=\"n\">list</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"o\">[]</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"o\">|</span><span class=\"n\">state</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">elem</span><span class=\"o\">|</span><span class=\"w\"> </span><span class=\"no\">List</span><span class=\"o\">.</span><span class=\"n\">concat</span><span class=\"p\">(</span><span class=\"n\">state</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">mapper</span><span class=\"p\">(</span><span class=\"n\">elem</span><span class=\"p\">)))</span>\n</code></pre></div>",
        "id": 547149261,
        "sender_full_name": "Brendan Hansknecht",
        "timestamp": 1761501925
    },
    {
        "content": "<p><del>Ha! Great, thanks! Or maybe to use <code>walk!</code> instead ?</del></p>",
        "id": 547149485,
        "sender_full_name": "Claude Précourt",
        "timestamp": 1761502092
    },
    {
        "content": "<p>Thank you so much! Worked like a charm. Just needed to add an exclamation point to the <code>mapper</code> arg to get rid of a warning.</p>",
        "id": 547149839,
        "sender_full_name": "Claude Précourt",
        "timestamp": 1761502424
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"928710\">Claude Précourt</span> has marked this topic as resolved.</p>",
        "id": 547150715,
        "sender_full_name": "Notification Bot",
        "timestamp": 1761503371
    },
    {
        "content": "<p>I added List.join_map! in <a href=\"https://github.com/roc-lang/roc/issues/8337\">#8337</a></p>",
        "id": 547256867,
        "sender_full_name": "Anton",
        "timestamp": 1761565880
    },
    {
        "content": "<p>As if I didn't love this language enough already! <span aria-label=\"face holding back tears\" class=\"emoji emoji-1f979\" role=\"img\" title=\"face holding back tears\">:face_holding_back_tears:</span></p>",
        "id": 547311311,
        "sender_full_name": "Claude Précourt",
        "timestamp": 1761579674
    },
    {
        "content": "<p>Thanks :)<br>\nThe new addition will be in tomorrow's <a href=\"https://github.com/roc-lang/roc/releases/tag/nightly\">nightly</a></p>",
        "id": 547311671,
        "sender_full_name": "Anton",
        "timestamp": 1761579762
    }
]