[
    {
        "content": "<p>Ok!  I'm back.  Booted up the ol' Ubuntu machine and after some classic shenanigans getting things up to date I'm now giving roc another go!</p>\n<p>Versions of stuff:</p>\n<ul>\n<li>cargo: 1.54</li>\n<li>zig 0.8.0</li>\n</ul>\n<p>But when running cargo run repl, I get </p>\n<div class=\"codehilite\"><pre><span></span><code>error: failed to run custom build command for `roc_builtins v0.1.0 (/home/matthias/Projects/roc/compiler/builtins)`\n\nCaused by:\n  process didn&#39;t exit successfully: `/home/matthias/Projects/roc/target/debug/build/roc_builtins-fc46a14962010627/build-script-build` (exit status: 101)\n  --- stdout\n  cargo:rerun-if-changed=build.rs\n  cargo:rustc-env=BUILTINS_O=/home/matthias/Projects/roc/target/debug/build/roc_builtins-2ac40a7585634db0/out/builtins.o\n  Compiling zig object to: /home/matthias/Projects/roc/compiler/builtins/bitcode/builtins-host.o\n  Compiling host ir to: /home/matthias/Projects/roc/compiler/builtins/bitcode/builtins-host.ll\n  Compiling 32-bit i386 ir to: /home/matthias/Projects/roc/compiler/builtins/bitcode/builtins-i386.ll\n  Compiling 32-bit wasm32 ir to: /home/matthias/Projects/roc/compiler/builtins/bitcode/builtins-wasm32.ll\n  Moving zig object to: /home/matthias/Projects/roc/target/debug/build/roc_builtins-2ac40a7585634db0/out/builtins.o\n  Compiling 32-bit bitcode to: /home/matthias/Projects/roc/compiler/builtins/bitcode/builtins-i386.bc\n\n  --- stderr\n  thread &#39;main&#39; panicked at &#39;llvm-as failed: No such file or directory (os error 2)&#39;, compiler/builtins/build.rs:127:24\n  note: run with `RUST_BACKTRACE=1` environment variable to display a backtrace\n</code></pre></div>\n<p>Ohh wait I might have missed a step setting up llvm <span aria-label=\"thinking\" class=\"emoji emoji-1f914\" role=\"img\" title=\"thinking\">:thinking:</span></p>\n<p>Hmm, maybe not.  I forgot to do the symlink step mentioned here: <a href=\"https://github.com/rtfeldman/roc/blob/trunk/BUILDING_FROM_SOURCE.md\">https://github.com/rtfeldman/roc/blob/trunk/BUILDING_FROM_SOURCE.md</a></p>\n<p>But after doing that I still get the above issue.</p>\n<p>Hmm, also looks like the referenced llvm installation script installs llvm 13.x as opposed to 12.x  mentioned in the guide.  That an issue?</p>\n<p>oooo, things are movin now.  switched the symlinks to refer to 13 instead of 12.</p>\n<p>Oh snap I'm in the repl!! <span aria-label=\"tada\" class=\"emoji emoji-1f389\" role=\"img\" title=\"tada\">:tada:</span> <span aria-label=\"tada\" class=\"emoji emoji-1f389\" role=\"img\" title=\"tada\">:tada:</span></p>",
        "id": 252097458,
        "sender_full_name": "Matthew Griffith",
        "timestamp": 1630871139
    },
    {
        "content": "<p>huh, llvm 13 is not even released ?! Are you using 12 or 13 now?</p>",
        "id": 252099490,
        "sender_full_name": "Folkert de Vries",
        "timestamp": 1630873225
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"432590\">@Matthew Griffith</span> congrats! <span aria-label=\"smiley\" class=\"emoji emoji-1f603\" role=\"img\" title=\"smiley\">:smiley:</span></p>\n<p>you should also be able to run the examples now! e.g. <code>cargo run examples/hello-world/Hello.roc</code></p>",
        "id": 252099926,
        "sender_full_name": "Richard Feldman",
        "timestamp": 1630873714
    },
    {
        "content": "<p>also <code>cargo run edit</code> to bring up the editor</p>",
        "id": 252099936,
        "sender_full_name": "Richard Feldman",
        "timestamp": 1630873740
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"281543\">Folkert de Vries</span> <a href=\"#narrow/stream/231634-beginners/topic/So.20close.2C.20Ubuntu/near/252099490\">said</a>:</p>\n<blockquote>\n<p>huh, llvm 13 is not even released ?! Are you using 12 or 13 now?</p>\n</blockquote>\n<p>13 I suppose.  I just switched the symlinks to point to <code>clang-13</code> and <code>llvm-as-13</code> and things worked.</p>\n<p><code>sudo bash -c \"$(wget -O - https://apt.llvm.org/llvm.sh)\"</code> installed 13</p>",
        "id": 252100039,
        "sender_full_name": "Matthew Griffith",
        "timestamp": 1630873839
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"281383\">Richard Feldman</span> <a href=\"#narrow/stream/231634-beginners/topic/So.20close.2C.20Ubuntu/near/252099936\">said</a>:</p>\n<blockquote>\n<p>also <code>cargo run edit</code> to bring up the editor</p>\n</blockquote>\n<p>Sweet!</p>",
        "id": 252100047,
        "sender_full_name": "Matthew Griffith",
        "timestamp": 1630873851
    },
    {
        "content": "<p>well I suppose the good news is that our llvm12 -&gt; 13 upgrade will be smooth if things just work already <span aria-label=\"smile\" class=\"emoji emoji-1f642\" role=\"img\" title=\"smile\">:smile:</span></p>",
        "id": 252101303,
        "sender_full_name": "Folkert de Vries",
        "timestamp": 1630875320
    },
    {
        "content": "<p>release is scheduled for end of september</p>",
        "id": 252101316,
        "sender_full_name": "Folkert de Vries",
        "timestamp": 1630875333
    },
    {
        "content": "<p>I have never tried to build anything from source <span aria-label=\"sweat smile\" class=\"emoji emoji-1f605\" role=\"img\" title=\"sweat smile\">:sweat_smile:</span> <br>\nJust installed LLVM default via sudo apt install llvm<br>\nAnd cargo test gives me the following error:</p>\n<div class=\"codehilite\"><pre><span></span><code>   ...\n   Compiling bytemuck v1.7.2\n   Compiling palette v0.5.0\n   Compiling futures-util v0.3.17\n   Compiling glyph_brush v0.7.2\n   Compiling zerocopy v0.3.0\nerror: could not find native static library `Polly`, perhaps an -L flag is missing?\n\nerror: could not compile `llvm-sys` due to previous error\nwarning: build failed, waiting for other jobs to finish...\nerror: build failed\n</code></pre></div>\n<p>Not seen this one anywhere mentioned. Unsure how to proceed</p>",
        "id": 258560732,
        "sender_full_name": "Oliver Schöning",
        "timestamp": 1634828242
    },
    {
        "content": "<p>LLVM version is 12. Perhaps that is the problem?</p>",
        "id": 258560975,
        "sender_full_name": "Oliver Schöning",
        "timestamp": 1634828308
    },
    {
        "content": "<p>The Polly issue was painful to deal with in Zig too. IIRC LLVM themselves fixed this in subsequent releases.</p>",
        "id": 258561478,
        "sender_full_name": "Shritesh Bhattarai",
        "timestamp": 1634828450
    },
    {
        "content": "<p>I think it only manifested in MacOS targets there tho.</p>",
        "id": 258561618,
        "sender_full_name": "Shritesh Bhattarai",
        "timestamp": 1634828504
    },
    {
        "content": "<p>I'm on Pop!_OS, Ubuntu based. Just trying to figure out one error at a time. Previous one, as far as I could tell, was that LLVM wasnt installed. </p>\n<p>I also installed zig via snapd if that helps</p>",
        "id": 258562125,
        "sender_full_name": "Oliver Schöning",
        "timestamp": 1634828643
    },
    {
        "content": "<p>So should I try and get a newer version of LLVM than 12 ? <span class=\"user-mention\" data-user-id=\"452038\">@Shritesh Bhattarai</span></p>",
        "id": 258562348,
        "sender_full_name": "Oliver Schöning",
        "timestamp": 1634828724
    },
    {
        "content": "<p>Honestly, I don't know. Reading <code>BUILDING_FROM_SOURCE.md</code>, it seems like it is recommended to use LLVM's apt remote to install.</p>",
        "id": 258562754,
        "sender_full_name": "Shritesh Bhattarai",
        "timestamp": 1634828839
    },
    {
        "content": "<p>Hmmm... I might be in trouble then:</p>\n<div class=\"codehilite\"><pre><span></span><code>oliverschoning@pop-os:~/Projects/roc$ sudo bash -c &quot;$(wget -O - https://apt.llvm.org/llvm.sh)&quot;\n--2021-10-21 17:09:16--  https://apt.llvm.org/llvm.sh\nResolving apt.llvm.org (apt.llvm.org)... 2a04:4e42:38::561, 151.101.238.49\nConnecting to apt.llvm.org (apt.llvm.org)|2a04:4e42:38::561|:443... connected.\nHTTP request sent, awaiting response... 200 OK\nLength: 3636 (3.6K) [application/octet-stream]\nSaving to: ‘STDOUT’\n\n-                       100%[============================&gt;]   3.55K  --.-KB/s    in 0s\n\n2021-10-21 17:09:17 (33.7 MB/s) - written to stdout [3636/3636]\n\n[sudo] password for oliverschoning:\n+ needed_binaries=(lsb_release wget add-apt-repository)\n+ missing_binaries=()\n+ for binary in &quot;${needed_binaries[@]}&quot;\n+ which lsb_release\n+ for binary in &quot;${needed_binaries[@]}&quot;\n+ which wget\n+ for binary in &quot;${needed_binaries[@]}&quot;\n+ which add-apt-repository\n+ [[ 0 -gt 0 ]]\n+ LLVM_VERSION=13\n+ &#39;[&#39; 0 -eq 1 &#39;]&#39;\n++ lsb_release -is\n+ DISTRO=Pop\n++ lsb_release -sr\n+ VERSION=21.04\n+ DIST_VERSION=Pop_21.04\n+ [[ 0 -ne 0 ]]\n+ declare -A LLVM_VERSION_PATTERNS\n+ LLVM_VERSION_PATTERNS[9]=-9\n+ LLVM_VERSION_PATTERNS[10]=-10\n+ LLVM_VERSION_PATTERNS[11]=-11\n+ LLVM_VERSION_PATTERNS[12]=-12\n+ LLVM_VERSION_PATTERNS[13]=-13\n+ LLVM_VERSION_PATTERNS[14]=\n+ &#39;[&#39; &#39;!&#39; _ &#39;]&#39;\n+ LLVM_VERSION_STRING=-13\n+ case &quot;$DIST_VERSION&quot; in\n+ echo &#39;Distribution &#39;\\&#39;&#39;Pop&#39;\\&#39;&#39; in version &#39;\\&#39;&#39;21.04&#39;\\&#39;&#39; is not supported by this script (Pop_21.04).&#39;\nDistribution &#39;Pop&#39; in version &#39;21.04&#39; is not supported by this script (Pop_21.04).\n+ exit 2\n</code></pre></div>",
        "id": 258563468,
        "sender_full_name": "Oliver Schöning",
        "timestamp": 1634829070
    },
    {
        "content": "<p>That just looks like the script doesn't realize pop is ubuntu</p>",
        "id": 258565504,
        "sender_full_name": "Brendan Hansknecht",
        "timestamp": 1634829743
    },
    {
        "content": "<p>You might need to slightly modify it to hardcode your distro as ubuntu.</p>",
        "id": 258565581,
        "sender_full_name": "Brendan Hansknecht",
        "timestamp": 1634829774
    },
    {
        "content": "<p>That is the output of the <code>sudo bash -c \"$(wget -O - https://apt.llvm.org/llvm.sh)\"</code><br>\nfrom <a href=\"https://github.com/rtfeldman/roc/blob/trunk/BUILDING_FROM_SOURCE.md\">https://github.com/rtfeldman/roc/blob/trunk/BUILDING_FROM_SOURCE.md</a></p>",
        "id": 258565763,
        "sender_full_name": "Oliver Schöning",
        "timestamp": 1634829840
    },
    {
        "content": "<p>Looking at <a href=\"http://apt.llvm.org\">apt.llvm.org</a> Default Packages section now. I wonder if I can just run:</p>\n<div class=\"codehilite\"><pre><span></span><code>apt-get install clang-format clang-tidy clang-tools clang clangd libc++-dev libc++1 libc++abi-dev libc++abi1 libclang-dev libclang1 liblldb-dev libllvm-ocaml-dev libomp-dev libomp5 lld lldb llvm-dev llvm-runtime llvm python-clang\n</code></pre></div>",
        "id": 258566175,
        "sender_full_name": "Oliver Schöning",
        "timestamp": 1634829971
    },
    {
        "content": "<p>This is very new territory for me hehe. I am used to <code>npm i</code> <span aria-label=\"smiley\" class=\"emoji emoji-1f603\" role=\"img\" title=\"smiley\">:smiley:</span></p>",
        "id": 258566450,
        "sender_full_name": "Oliver Schöning",
        "timestamp": 1634830076
    },
    {
        "content": "<p>First you need to add the llvm ppa, then that would work correctly</p>",
        "id": 258566642,
        "sender_full_name": "Brendan Hansknecht",
        "timestamp": 1634830149
    },
    {
        "content": "<p>So am I understanding it correctly that the <code>sudo bash -c \"$(wget -O - https://apt.llvm.org/llvm.sh)\"</code> is sugar for that longer sudo apt-get install ?</p>",
        "id": 258566845,
        "sender_full_name": "Oliver Schöning",
        "timestamp": 1634830216
    },
    {
        "content": "<p>These days I just download the llvm zip file</p>",
        "id": 258567065,
        "sender_full_name": "Folkert de Vries",
        "timestamp": 1634830313
    },
    {
        "content": "<p>On Linux mint</p>",
        "id": 258567122,
        "sender_full_name": "Folkert de Vries",
        "timestamp": 1634830325
    },
    {
        "content": "<p>Also, the script does a few more things than just an install command. This is the core:</p>\n<div class=\"codehilite\"><pre><span></span><code>wget -O - https://apt.llvm.org/llvm-snapshot.gpg.key | apt-key add -\nadd-apt-repository &quot;${REPO_NAME}&quot;\napt-get update\napt-get install -y clang-$LLVM_VERSION lldb-$LLVM_VERSION lld-$LLVM_VERSION clangd-$LLVM_VERSION\n</code></pre></div>",
        "id": 258567287,
        "sender_full_name": "Brendan Hansknecht",
        "timestamp": 1634830392
    },
    {
        "content": "<p>Which zip and what version <span class=\"user-mention\" data-user-id=\"281543\">@Folkert de Vries</span>  ?</p>",
        "id": 258567354,
        "sender_full_name": "Oliver Schöning",
        "timestamp": 1634830423
    },
    {
        "content": "<p>from this page</p>",
        "id": 258567563,
        "sender_full_name": "Folkert de Vries",
        "timestamp": 1634830496
    },
    {
        "content": "<p><a href=\"https://github.com/llvm/llvm-project/releases/tag/llvmorg-12.0.0\">https://github.com/llvm/llvm-project/releases/tag/llvmorg-12.0.0</a></p>",
        "id": 258567567,
        "sender_full_name": "Folkert de Vries",
        "timestamp": 1634830498
    },
    {
        "content": "<p>I think that should be <code>12.0.1</code> now</p>",
        "id": 258567655,
        "sender_full_name": "Brendan Hansknecht",
        "timestamp": 1634830533
    },
    {
        "content": "<p>then define your equvalent of this variable <code>set -x LLVM_SYS_120_PREFIX \"/home/folkertdev/Downloads/clang+llvm-12.0.0-x86_64-linux-gnu-ubuntu-20.04\"</code></p>",
        "id": 258567667,
        "sender_full_name": "Folkert de Vries",
        "timestamp": 1634830538
    },
    {
        "content": "<p>not with zig 0.8.0</p>",
        "id": 258567681,
        "sender_full_name": "Folkert de Vries",
        "timestamp": 1634830543
    },
    {
        "content": "<p>or at least, that is untested</p>",
        "id": 258567700,
        "sender_full_name": "Folkert de Vries",
        "timestamp": 1634830550
    },
    {
        "content": "<p>and then you may need to symlink some executables or add the <code>/bin</code> folder from the extracted archive to your PATH</p>",
        "id": 258567821,
        "sender_full_name": "Folkert de Vries",
        "timestamp": 1634830586
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"281543\">@Folkert de Vries</span>  hmm but I already have llvm 12 I think</p>\n<div class=\"codehilite\"><pre><span></span><code>oliverschoning@pop-os:~/Projects/roc$ llvm-config --version\n12.0.0\n</code></pre></div>",
        "id": 258572430,
        "sender_full_name": "Oliver Schöning",
        "timestamp": 1634832277
    },
    {
        "content": "<p>and zig 0.8.1</p>",
        "id": 258572512,
        "sender_full_name": "Oliver Schöning",
        "timestamp": 1634832313
    },
    {
        "content": "<p>Sorry what is failing then?</p>",
        "id": 258574474,
        "sender_full_name": "Folkert de Vries",
        "timestamp": 1634833035
    },
    {
        "content": "<p>I am running <code>cargo test</code> in the roc repo:</p>\n<div class=\"codehilite\"><pre><span></span><code>oliverschoning@pop-os:~/Projects/roc$ cargo test\n   Compiling serde v1.0.130\n   Compiling morphic_lib v0.1.0 (/home/oliverschoning/Projects/roc/vendor/morphic_lib)\n   Compiling rkyv v0.6.7\n   Compiling darling v0.13.0\n   Compiling minimp3 v0.5.1\n   Compiling futures-executor v0.3.17\n   Compiling roc_parse v0.1.0 (/home/oliverschoning/Projects/roc/compiler/parse)\n   Compiling roc_types v0.1.0 (/home/oliverschoning/Projects/roc/compiler/types)\n   Compiling darling v0.10.2\n   Compiling llvm-sys v120.2.1\n   Compiling clap_derive v3.0.0-beta.1 (https://github.com/rtfeldman/clap?branch=master#e1d83a78)\n   Compiling enumset_derive v0.5.5\n   Compiling test_mono_macros v0.1.0 (/home/oliverschoning/Projects/roc/compiler/test_mono_macros)\nerror: could not find native static library `Polly`, perhaps an -L flag is missing?\n\nerror: could not compile `llvm-sys` due to previous error\nwarning: build failed, waiting for other jobs to finish...\nerror: build failed\noliverschoning@pop-os:~/Projects/roc$\n</code></pre></div>\n<p>I installed llvm via <code> sudo apt install llvm</code></p>",
        "id": 258575272,
        "sender_full_name": "Oliver Schöning",
        "timestamp": 1634833314
    },
    {
        "content": "<p>can you define the shell variable like I showed, that might llvm-sys figure things out</p>",
        "id": 258576028,
        "sender_full_name": "Folkert de Vries",
        "timestamp": 1634833577
    },
    {
        "content": "<p>Sorry <span class=\"user-mention\" data-user-id=\"281543\">@Folkert de Vries</span>  but I am unfamilliar with setting a variable like this:<br>\n<code>set -x LLVM_SYS_120_PREFIX \"/home/folkertdev/Downloads/clang+llvm-12.0.0-x86_64-linux-gnu-ubuntu-20.04\"</code><br>\nI can set something in my .bashrc if that is the idea? But I also do not know the path like you specified since I did not download it into my home/username/Downloads folder. <br>\nDo you have some more hints so I can figure it out? <span aria-label=\"smile\" class=\"emoji emoji-1f642\" role=\"img\" title=\"smile\">:smile:</span></p>",
        "id": 258576925,
        "sender_full_name": "Oliver Schöning",
        "timestamp": 1634833914
    },
    {
        "content": "<p>allright first we need to figure out where llvm is actually installed</p>",
        "id": 258577180,
        "sender_full_name": "Folkert de Vries",
        "timestamp": 1634833995
    },
    {
        "content": "<p>first try <code>which llvm-as</code></p>",
        "id": 258577511,
        "sender_full_name": "Folkert de Vries",
        "timestamp": 1634834114
    },
    {
        "content": "<p><code>/usr/bin/llvm-as</code></p>",
        "id": 258577594,
        "sender_full_name": "Oliver Schöning",
        "timestamp": 1634834149
    },
    {
        "content": "<p>and then that should hopefully be a symlink</p>",
        "id": 258577685,
        "sender_full_name": "Folkert de Vries",
        "timestamp": 1634834169
    },
    {
        "content": "<p>maybe <code>ls -h /usr/bin/llvm-as</code> works?</p>",
        "id": 258577769,
        "sender_full_name": "Folkert de Vries",
        "timestamp": 1634834203
    },
    {
        "content": "<div class=\"codehilite\"><pre><span></span><code>oliverschoning@pop-os:~$ ls -h /usr/bin/llvm-as\n/usr/bin/llvm-as\n</code></pre></div>",
        "id": 258577844,
        "sender_full_name": "Oliver Schöning",
        "timestamp": 1634834241
    },
    {
        "content": "<p>actually try <code>readlink -f /usr/bin/llvm-as</code></p>",
        "id": 258577894,
        "sender_full_name": "Folkert de Vries",
        "timestamp": 1634834262
    },
    {
        "content": "<p>Look at us, pair programming without a video share or call <span aria-label=\"grinning face with smiling eyes\" class=\"emoji emoji-1f601\" role=\"img\" title=\"grinning face with smiling eyes\">:grinning_face_with_smiling_eyes:</span></p>",
        "id": 258577923,
        "sender_full_name": "Oliver Schöning",
        "timestamp": 1634834272
    },
    {
        "content": "<div class=\"codehilite\"><pre><span></span><code>oliverschoning@pop-os:~$ readlink -f /usr/bin/llvm-as\n/usr/lib/llvm-12/bin/llvm-as\n</code></pre></div>",
        "id": 258577981,
        "sender_full_name": "Oliver Schöning",
        "timestamp": 1634834285
    },
    {
        "content": "<p>cool, eh then in the .bashrc</p>",
        "id": 258578000,
        "sender_full_name": "Folkert de Vries",
        "timestamp": 1634834298
    },
    {
        "content": "<p><code>export LLVM_SYS_120_PREFIX=\"&lt;that path&gt;\"</code></p>",
        "id": 258578113,
        "sender_full_name": "Folkert de Vries",
        "timestamp": 1634834358
    },
    {
        "content": "<p>actually, just <code>/usr/lib/llvm-12</code></p>",
        "id": 258578197,
        "sender_full_name": "Folkert de Vries",
        "timestamp": 1634834397
    },
    {
        "content": "<p>and then I think <code>source ~/.bashrc</code> before you try running cargo again</p>",
        "id": 258578324,
        "sender_full_name": "Folkert de Vries",
        "timestamp": 1634834437
    },
    {
        "content": "<p>Just export /usr/... you mean?</p>",
        "id": 258578339,
        "sender_full_name": "Oliver Schöning",
        "timestamp": 1634834445
    },
    {
        "content": "<p><code>export LLVM_SYS_120_PREFIX=\"/usr/lib/llvm-12\"</code></p>",
        "id": 258578405,
        "sender_full_name": "Folkert de Vries",
        "timestamp": 1634834483
    },
    {
        "content": "<p>Ok I did the source command</p>",
        "id": 258578555,
        "sender_full_name": "Oliver Schöning",
        "timestamp": 1634834527
    },
    {
        "content": "<p>right so then you can try compiling again</p>",
        "id": 258578955,
        "sender_full_name": "Folkert de Vries",
        "timestamp": 1634834691
    },
    {
        "content": "<p>(in the shell where you did the source)</p>",
        "id": 258578970,
        "sender_full_name": "Folkert de Vries",
        "timestamp": 1634834700
    },
    {
        "content": "<p>Oh, adding to .bashrc does not make it permanent to all terminals?</p>",
        "id": 258579676,
        "sender_full_name": "Oliver Schöning",
        "timestamp": 1634835006
    },
    {
        "content": "<div class=\"codehilite\"><pre><span></span><code>oliverschoning@pop-os:~/Projects/roc$ source ~/.bashrc\noliverschoning@pop-os:~/Projects/roc$ cargo test\n   Compiling object v0.25.3\n   Compiling llvm-sys v120.2.1\n   Compiling object v0.24.0\n   Compiling petgraph v0.6.0\n   Compiling serde_yaml v0.8.20\n   Compiling typetag v0.1.7\n   Compiling csv v1.1.6\n   Compiling tinytemplate v1.2.1\n   Compiling backtrace v0.3.61\n   Compiling wasmer-types v2.0.0\n   Compiling cranelift-codegen v0.74.0\n   Compiling clap v3.0.0-beta.1 (https://github.com/rtfeldman/clap?branch=master#e1d83a78)\nerror: could not find native static library `Polly`, perhaps an -L flag is missing?\n\nerror: could not compile `llvm-sys` due to previous error\nwarning: build failed, waiting for other jobs to finish...\nerror: build failed\noliverschoning@pop-os:~/Projects/roc$\n</code></pre></div>",
        "id": 258579694,
        "sender_full_name": "Oliver Schöning",
        "timestamp": 1634835012
    },
    {
        "content": "<p>Same error unfortunately</p>",
        "id": 258579745,
        "sender_full_name": "Oliver Schöning",
        "timestamp": 1634835032
    },
    {
        "content": "<p>makes it permanent in all new terminals, but does not change existing ones you have open</p>",
        "id": 258580069,
        "sender_full_name": "Folkert de Vries",
        "timestamp": 1634835181
    },
    {
        "content": "<p>here </p>\n<p>I'm attempting to use LLVM bindings in Rust, the common bindings are the<br>\nllvm-sys crate. To link, they use</p>\n<p>llvm-config-10 --link-static --libnames</p>\n<p>to find all the libraries. That list includes libPolly.a which isn't <br>\ninstalled<br>\nas part of llvm-10 but is instead included in libclang-common-10-dev which<br>\nmay or may not be installed.</p>",
        "id": 258580291,
        "sender_full_name": "Folkert de Vries",
        "timestamp": 1634835264
    },
    {
        "content": "<p><a href=\"https://bugs.debian.org/cgi-bin/bugreport.cgi?bug=966574\">https://bugs.debian.org/cgi-bin/bugreport.cgi?bug=966574</a></p>",
        "id": 258580309,
        "sender_full_name": "Folkert de Vries",
        "timestamp": 1634835270
    },
    {
        "content": "<p>you also need to install libclang-common-dev-12-dev it seems</p>",
        "id": 258580355,
        "sender_full_name": "Folkert de Vries",
        "timestamp": 1634835286
    },
    {
        "content": "<div class=\"codehilite\"><pre><span></span><code>To make sure always the most recent versions of the packages are installed, we are providing some default packages.\nTo install all of them (currently version 14):\napt-get install clang-format clang-tidy clang-tools clang clangd libc++-dev libc++1 libc++abi-dev libc++abi1 libclang-dev libclang1 liblldb-dev libllvm-ocaml-dev libomp-dev libomp5 lld lldb llvm-dev llvm-runtime llvm python-clang\n</code></pre></div>\n<p><a href=\"https://apt.llvm.org/#default_pkg\">https://apt.llvm.org/#default_pkg</a></p>",
        "id": 258581166,
        "sender_full_name": "Oliver Schöning",
        "timestamp": 1634835602
    },
    {
        "content": "<p>Maybe I need to manually install these then?</p>",
        "id": 258581244,
        "sender_full_name": "Oliver Schöning",
        "timestamp": 1634835612
    },
    {
        "content": "<p>I downloaded the <a href=\"http://llvm.sh\">llvm.sh</a> file. Perhaps I can tweak it to accept my distro</p>",
        "id": 258582332,
        "sender_full_name": "Oliver Schöning",
        "timestamp": 1634836001
    },
    {
        "content": "<p>Its based on ubuntu 21.04. So just a wild guess that I can change the Ubuntu_21.04 to Pop_21.04</p>\n<div class=\"codehilite\"><pre><span></span><code># find the right repository name for the distro and version\ncase &quot;$DIST_VERSION&quot; in\n    Debian_9* )       REPO_NAME=&quot;deb http://apt.llvm.org/stretch/  llvm-toolchain-stretch$LLVM_VERSION_STRING main&quot; ;;\n    Debian_10* )      REPO_NAME=&quot;deb http://apt.llvm.org/buster/   llvm-toolchain-buster$LLVM_VERSION_STRING  main&quot; ;;\n    Debian_11* )      REPO_NAME=&quot;deb http://apt.llvm.org/bullseye/ llvm-toolchain-bullseye$LLVM_VERSION_STRING  main&quot; ;;\n    Debian_unstable ) REPO_NAME=&quot;deb http://apt.llvm.org/unstable/ llvm-toolchain$LLVM_VERSION_STRING         main&quot; ;;\n    Debian_testing )  REPO_NAME=&quot;deb http://apt.llvm.org/unstable/ llvm-toolchain$LLVM_VERSION_STRING         main&quot; ;;\n    Ubuntu_16.04 )    REPO_NAME=&quot;deb http://apt.llvm.org/xenial/   llvm-toolchain-xenial$LLVM_VERSION_STRING  main&quot; ;;\n    Ubuntu_18.04 )    REPO_NAME=&quot;deb http://apt.llvm.org/bionic/   llvm-toolchain-bionic$LLVM_VERSION_STRING  main&quot; ;;\n    Ubuntu_18.10 )    REPO_NAME=&quot;deb http://apt.llvm.org/cosmic/   llvm-toolchain-cosmic$LLVM_VERSION_STRING  main&quot; ;;\n    Ubuntu_19.04 )    REPO_NAME=&quot;deb http://apt.llvm.org/disco/    llvm-toolchain-disco$LLVM_VERSION_STRING   main&quot; ;;\n    Ubuntu_19.10 )   REPO_NAME=&quot;deb http://apt.llvm.org/eoan/      llvm-toolchain-eoan$LLVM_VERSION_STRING    main&quot; ;;\n    Ubuntu_20.04 )   REPO_NAME=&quot;deb http://apt.llvm.org/focal/     llvm-toolchain-focal$LLVM_VERSION_STRING   main&quot; ;;\n    Ubuntu_21.04 )   REPO_NAME=&quot;deb http://apt.llvm.org/groovy/    llvm-toolchain-groovy$LLVM_VERSION_STRING  main&quot; ;;\n    Ubuntu_21.10 )   REPO_NAME=&quot;deb http://apt.llvm.org/hirsute/   llvm-toolchain-hirsute$LLVM_VERSION_STRING main&quot; ;;\n    * )\n        echo &quot;Distribution &#39;$DISTRO&#39; in version &#39;$VERSION&#39; is not supported by this script (${DIST_VERSION}).&quot;\n        exit 2\nesac\n</code></pre></div>",
        "id": 258582946,
        "sender_full_name": "Oliver Schöning",
        "timestamp": 1634836264
    },
    {
        "content": "<p>Ohh<br>\nSomething is happening</p>",
        "id": 258583398,
        "sender_full_name": "Oliver Schöning",
        "timestamp": 1634836443
    },
    {
        "content": "<p>Hmm, progress perhaps?</p>\n<div class=\"codehilite\"><pre><span></span><code>Get:11 http://us.archive.ubuntu.com/ubuntu hirsute-updates InRelease [115 kB]\nGet:12 http://us.archive.ubuntu.com/ubuntu hirsute-backports InRelease [101 kB]\nHit:10 https://packagecloud.io/slacktechnologies/slack/debian jessie InRelease\nFetched 326 kB in 2s (170 kB/s)\nReading package lists... Done\n+ apt-get install -y clang-13 lldb-13 lld-13 clangd-13\nReading package lists... Done\nBuilding dependency tree... Done\nReading state information... Done\nSome packages could not be installed. This may mean that you have\nrequested an impossible situation or if you are using the unstable\ndistribution that some required packages have not yet been created\nor been moved out of Incoming.\nThe following information may help to resolve the situation:\n\nThe following packages have unmet dependencies.\n liblldb-13 : Depends: libpython3.8 (&gt;= 3.8.2) but it is not installable\nE: Unable to correct problems, you have held broken packages.\n</code></pre></div>",
        "id": 258583481,
        "sender_full_name": "Oliver Schöning",
        "timestamp": 1634836476
    },
    {
        "content": "<p>On Linux I’ve had a good time with llvmenv</p>",
        "id": 258590066,
        "sender_full_name": "Lucas Rosa",
        "timestamp": 1634839057
    },
    {
        "content": "<p>hmm llvm13 is definitely not what you want</p>",
        "id": 258590428,
        "sender_full_name": "Folkert de Vries",
        "timestamp": 1634839186
    },
    {
        "content": "<p>this is why I download that zip: it's a bit of work, but at least it's all simple stuff, no fighting with shell scripts or anything like that</p>",
        "id": 258590583,
        "sender_full_name": "Folkert de Vries",
        "timestamp": 1634839220
    },
    {
        "content": "<p>You can pass a number to the shell script for the version you want to install</p>",
        "id": 258593064,
        "sender_full_name": "Brendan Hansknecht",
        "timestamp": 1634840200
    },
    {
        "content": "<p>Just an FYI</p>",
        "id": 258593088,
        "sender_full_name": "Brendan Hansknecht",
        "timestamp": 1634840211
    },
    {
        "content": "<p>Ok a little update<br>\nI ran</p>\n<div class=\"codehilite\"><pre><span></span><code>apt-get install clang-format clang-tidy clang-tools clang clangd libc++-dev libc++1 libc++abi-dev libc++abi1 libclang-dev libclang1 liblldb-dev libllvm-ocaml-dev libomp-dev libomp5 lld lldb llvm-dev llvm-runtime llvm python-clang\n</code></pre></div>\n<p>And I think I am pretty close now?</p>",
        "id": 258600041,
        "sender_full_name": "Oliver Schöning",
        "timestamp": 1634843077
    },
    {
        "content": "<p>Output too long, here is a hastebin:<br>\n<a href=\"https://hastebin.com/uwoqebigep.rb\">https://hastebin.com/uwoqebigep.rb</a></p>",
        "id": 258600169,
        "sender_full_name": "Oliver Schöning",
        "timestamp": 1634843133
    },
    {
        "content": "<p>It seems to run the cargo test now, but a lot of failures:</p>\n<div class=\"codehilite\"><pre><span></span><code>failures:\n    cli_run::astar\n    cli_run::base64\n    cli_run::cfold\n    cli_run::cli\n    cli_run::closure\n    cli_run::deriv\n    cli_run::effect\n    cli_run::fib\n    cli_run::hello_rust\n    cli_run::hello_world\n    cli_run::hello_zig\n    cli_run::nqueens\n    cli_run::quicksort\n    cli_run::rbtree_ck\n    cli_run::rbtree_insert\n    cli_run::run_multi_dep_str_optimized\n    cli_run::run_multi_dep_str_unoptimized\n    cli_run::run_multi_dep_thunk_optimized\n    cli_run::run_multi_dep_thunk_unoptimized\n\ntest result: FAILED. 2 passed; 19 failed; 0 ignored; 0 measured; 0 filtered out; finished in 9.26s\n</code></pre></div>",
        "id": 258600293,
        "sender_full_name": "Oliver Schöning",
        "timestamp": 1634843169
    },
    {
        "content": "<p>Interesting. Some sort of linker argument error.</p>",
        "id": 258600545,
        "sender_full_name": "Brendan Hansknecht",
        "timestamp": 1634843268
    },
    {
        "content": "<p>Well, I am, for the first time, able to run the repl! I call that success :D</p>",
        "id": 258600678,
        "sender_full_name": "Oliver Schöning",
        "timestamp": 1634843314
    },
    {
        "content": "<p>Well.. babysteps <span aria-label=\"joy\" class=\"emoji emoji-1f602\" role=\"img\" title=\"joy\">:joy:</span> </p>\n<div class=\"codehilite\"><pre><span></span><code>  The rockin’ roc repl\n────────────────────────\n\nEnter an expression, or :help, or :exit/:q.\n\n» 1 +1\nld: Error: unable to disambiguate: -arch (did you mean --arch ?)\nthread &#39;main&#39; panicked at &#39;Error loading compiled dylib for test: DlOpen { desc: &quot;/tmp/.tmpYFlZpw/app.so.1.0: cannot open shared object file: No such file or directory&quot; }&#39;, cli/src/repl/gen.rs:227:14\nnote: run with `RUST_BACKTRACE=1` environment variable to display a backtrace\n</code></pre></div>",
        "id": 258600747,
        "sender_full_name": "Oliver Schöning",
        "timestamp": 1634843356
    },
    {
        "content": "<p>Hmm. I see some comments in the code related to this error, but not sure of the correct fix at the moment.</p>",
        "id": 258600935,
        "sender_full_name": "Brendan Hansknecht",
        "timestamp": 1634843450
    },
    {
        "content": "<div class=\"codehilite\"><pre><span></span><code>oliverschoning@pop-os:~/Projects/roc/examples$ cargo run hello-world/Hello.roc\n    Finished dev [unoptimized + debuginfo] target(s) in 0.17s\n     Running `/home/oliverschoning/Projects/roc/target/debug/roc hello-world/Hello.roc`\nld: Error: unable to disambiguate: -arch (did you mean --arch ?)\noliverschoning@pop-os:~/Projects/roc/examples$\n</code></pre></div>",
        "id": 258600956,
        "sender_full_name": "Oliver Schöning",
        "timestamp": 1634843463
    },
    {
        "content": "<p>I think the fix might be for me to go to my storage room and get my macbook 2012 <span aria-label=\"joy\" class=\"emoji emoji-1f602\" role=\"img\" title=\"joy\">:joy:</span></p>",
        "id": 258601049,
        "sender_full_name": "Oliver Schöning",
        "timestamp": 1634843519
    },
    {
        "content": "<p>What do you get when you run <code>ld --version</code></p>",
        "id": 258601114,
        "sender_full_name": "Brendan Hansknecht",
        "timestamp": 1634843541
    },
    {
        "content": "<div class=\"codehilite\"><pre><span></span><code>oliverschoning@pop-os:~/Projects/roc/examples$ ld --version\nGNU ld (GNU Binutils for Ubuntu) 2.36.1\nCopyright (C) 2021 Free Software Foundation, Inc.\nThis program is free software; you may redistribute it under the terms of\nthe GNU General Public Licence version 3 or (at your option) a later version.\nThis program has absolutely no warranty.\n</code></pre></div>",
        "id": 258601162,
        "sender_full_name": "Oliver Schöning",
        "timestamp": 1634843563
    },
    {
        "content": "<p>Also, roc should run on Ubuntu or pop just fine. I exclusively use Linux.</p>",
        "id": 258601179,
        "sender_full_name": "Brendan Hansknecht",
        "timestamp": 1634843574
    },
    {
        "content": "<p>I'm sure it will eventually work on my machine since it's ubuntu based. I am only mentioning osx coz a buddy tried roc today and had it working almost immediately hehe</p>",
        "id": 258601312,
        "sender_full_name": "Oliver Schöning",
        "timestamp": 1634843639
    },
    {
        "content": "<p>Fair enough</p>",
        "id": 258601383,
        "sender_full_name": "Brendan Hansknecht",
        "timestamp": 1634843655
    },
    {
        "content": "<p>But I would like to avoid having to run triple boot just to get this working. Id like to stay dual booted</p>",
        "id": 258601483,
        "sender_full_name": "Oliver Schöning",
        "timestamp": 1634843705
    },
    {
        "content": "<p>I get no hits on google for \" -arch (did you mean --arch ?)\"</p>",
        "id": 258601706,
        "sender_full_name": "Oliver Schöning",
        "timestamp": 1634843814
    },
    {
        "content": "<p>Can you try pulling and running the<code>update-arch</code> branch?</p>",
        "id": 258601856,
        "sender_full_name": "Brendan Hansknecht",
        "timestamp": 1634843884
    },
    {
        "content": "<p>See if that fixes it for you?</p>",
        "id": 258601876,
        "sender_full_name": "Brendan Hansknecht",
        "timestamp": 1634843895
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"343810\">Brendan Hansknecht</span> <a href=\"#narrow/stream/231634-beginners/topic/So.20close.2C.20Ubuntu/near/258566642\">said</a>:</p>\n<blockquote>\n<p>First you need to add the llvm ppa, then that would work correctly</p>\n</blockquote>\n<p>you mentioned this <span class=\"user-mention\" data-user-id=\"343810\">@Brendan Hansknecht</span> , I did not do this. Maybe that is why?</p>",
        "id": 258601896,
        "sender_full_name": "Oliver Schöning",
        "timestamp": 1634843902
    },
    {
        "content": "<p>That shouldn't be the cause of this issue cause it is caused by <code>ld</code> which is gnu, not llvm</p>",
        "id": 258601993,
        "sender_full_name": "Brendan Hansknecht",
        "timestamp": 1634843946
    },
    {
        "content": "<p>ok, so I'm gonna try switching to that branch</p>",
        "id": 258602022,
        "sender_full_name": "Oliver Schöning",
        "timestamp": 1634843966
    },
    {
        "content": "<p>I can only see a fix-arch-docs, that one?</p>",
        "id": 258602204,
        "sender_full_name": "Oliver Schöning",
        "timestamp": 1634844044
    },
    {
        "content": "<div class=\"codehilite\"><pre><span></span><code>oliverschoning@pop-os:~/Projects/roc$ git status\nOn branch fix-arch-docs\nYour branch is up-to-date with &#39;origin/fix-arch-docs&#39;.\n\nUntracked files:\n  (use &quot;git add &lt;file&gt;...&quot; to include in what will be committed)\n    cli/tests/\n    compiler/\n    examples/\n\nnothing added to commit but untracked files present (use &quot;git add&quot; to track)\noliverschoning@pop-os:~/Projects/roc$ cargo test\n    Updating git repository `https://github.com/TheDan64/inkwell`\nerror: failed to get `inkwell` as a dependency of package `roc v0.1.0 (/home/oliverschoning/Projects/roc)`\n\nCaused by:\n  failed to load source for dependency `inkwell`\n\nCaused by:\n  Unable to update https://github.com/TheDan64/inkwell?branch=llvm8-0#aeba58a7\n\nCaused by:\n  object not found - no match for id (aeba58a7c684b27416b55bc1e53e4d2bee15c5ec); class=Odb (9); code=NotFound (-3)\noliverschoning@pop-os:~/Projects/roc$\n</code></pre></div>",
        "id": 258602272,
        "sender_full_name": "Oliver Schöning",
        "timestamp": 1634844081
    },
    {
        "content": "<p>oh wait. I see it now</p>",
        "id": 258602583,
        "sender_full_name": "Oliver Schöning",
        "timestamp": 1634844206
    },
    {
        "content": "<p>make sure to <code>git pull</code> I just made the branch</p>",
        "id": 258602610,
        "sender_full_name": "Brendan Hansknecht",
        "timestamp": 1634844217
    },
    {
        "content": "<p>A unfortunately same issue. The cargo test hangs right now and a lot of failed. And Cargo run gives:</p>\n<div class=\"codehilite\"><pre><span></span><code>oliverschoning@pop-os:~/Projects/roc/examples$ cargo run hello-world/Hello.roc\n   Compiling rand_core v0.4.2\n   Compiling rand v0.8.4\n   Compiling wyhash v0.3.0\n   Compiling roc_collections v0.1.0 (/home/oliverschoning/Projects/roc/compiler/collections)\n   Compiling roc_module v0.1.0 (/home/oliverschoning/Projects/roc/compiler/module)\n   Compiling ven_graph v2.0.5-pre (/home/oliverschoning/Projects/roc/vendor/pathfinding)\n   Compiling tempfile v3.2.0\n   Compiling twox-hash v1.6.1\n   Compiling wasmer-engine-dylib v2.0.0\n   Compiling glyph_brush v0.7.2\n   Compiling wgpu_glyph v0.14.1\n   Compiling wasmer v2.0.0\n   Compiling wasmer-wasi v2.0.0\n   Compiling roc_types v0.1.0 (/home/oliverschoning/Projects/roc/compiler/types)\n   Compiling roc_parse v0.1.0 (/home/oliverschoning/Projects/roc/compiler/parse)\n   Compiling roc_builtins v0.1.0 (/home/oliverschoning/Projects/roc/compiler/builtins)\n   Compiling roc_unify v0.1.0 (/home/oliverschoning/Projects/roc/compiler/unify)\n   Compiling roc_problem v0.1.0 (/home/oliverschoning/Projects/roc/compiler/problem)\n   Compiling roc_fmt v0.1.0 (/home/oliverschoning/Projects/roc/compiler/fmt)\n   Compiling roc_can v0.1.0 (/home/oliverschoning/Projects/roc/compiler/can)\n   Compiling roc_solve v0.1.0 (/home/oliverschoning/Projects/roc/compiler/solve)\n   Compiling roc_constrain v0.1.0 (/home/oliverschoning/Projects/roc/compiler/constrain)\n   Compiling roc_mono v0.1.0 (/home/oliverschoning/Projects/roc/compiler/mono)\n   Compiling roc_reporting v0.1.0 (/home/oliverschoning/Projects/roc/compiler/reporting)\n   Compiling roc_gen_llvm v0.1.0 (/home/oliverschoning/Projects/roc/compiler/gen_llvm)\n   Compiling roc_gen_wasm v0.1.0 (/home/oliverschoning/Projects/roc/compiler/gen_wasm)\n   Compiling roc_load v0.1.0 (/home/oliverschoning/Projects/roc/compiler/load)\n   Compiling roc_ast v0.1.0 (/home/oliverschoning/Projects/roc/ast)\n   Compiling roc_gen_dev v0.1.0 (/home/oliverschoning/Projects/roc/compiler/gen_dev)\n   Compiling roc_build v0.1.0 (/home/oliverschoning/Projects/roc/compiler/build)\n   Compiling roc_linker v0.1.0 (/home/oliverschoning/Projects/roc/linker)\n   Compiling roc_code_markup v0.1.0 (/home/oliverschoning/Projects/roc/code_markup)\n   Compiling roc_docs v0.1.0 (/home/oliverschoning/Projects/roc/docs)\n   Compiling roc_editor v0.1.0 (/home/oliverschoning/Projects/roc/editor)\n   Compiling roc_cli v0.1.0 (/home/oliverschoning/Projects/roc/cli)\n    Finished dev [unoptimized + debuginfo] target(s) in 1m 02s\n     Running `/home/oliverschoning/Projects/roc/target/debug/roc hello-world/Hello.roc`\nld: Error: unable to disambiguate: --arch (did you mean ---arch ?)\n</code></pre></div>",
        "id": 258604010,
        "sender_full_name": "Oliver Schöning",
        "timestamp": 1634844815
    },
    {
        "content": "<div class=\"codehilite\"><pre><span></span><code>oliverschoning@pop-os:~/Projects/roc$ cargo run repl\n    Finished dev [unoptimized + debuginfo] target(s) in 0.18s\n     Running `target/debug/roc repl`\n\n  The rockin’ roc repl\n────────────────────────\n\nEnter an expression, or :help, or :exit/:q.\n\n» 1 + 1\nld: Error: unable to disambiguate: --arch (did you mean ---arch ?)\nthread &#39;main&#39; panicked at &#39;Error loading compiled dylib for test: DlOpen { desc: &quot;/tmp/.tmpmH53wB/app.so.1.0: cannot open shared object file: No such file or directory&quot; }&#39;, cli/src/repl/gen.rs:227:14\nnote: run with `RUST_BACKTRACE=1` environment variable to display a backtrace\noliverschoning@pop-os:~/Projects/roc$\n</code></pre></div>",
        "id": 258604142,
        "sender_full_name": "Oliver Schöning",
        "timestamp": 1634844852
    },
    {
        "content": "<p>I just pushed one more commit to temporarily disable the arch flag, can you pull and run one more time? I am really confused as to the issue your version of ld is having the the arch flag.</p>",
        "id": 258604626,
        "sender_full_name": "Brendan Hansknecht",
        "timestamp": 1634845061
    },
    {
        "content": "<p>Will do! Most likely I messed up the install I assume</p>",
        "id": 258605300,
        "sender_full_name": "Oliver Schöning",
        "timestamp": 1634845350
    },
    {
        "content": "<p><a href=\"https://hastebin.com/aziporewec.rust\">https://hastebin.com/aziporewec.rust</a> &lt;- cargo test</p>\n<div class=\"codehilite\"><pre><span></span><code>oliverschoning@pop-os:~/Projects/roc/examples$ cargo run hello-world/Hello.roc\n    Blocking waiting for file lock on build directory\nwarning: unused import: `crate::target::arch_str`\n --&gt; compiler/build/src/link.rs:1:5\n  |\n1 | use crate::target::arch_str;\n  |     ^^^^^^^^^^^^^^^^^^^^^^^\n  |\n  = note: `#[warn(unused_imports)]` on by default\n\nwarning: unused variable: `arch`\n   --&gt; compiler/build/src/link.rs:726:9\n    |\n726 |     let arch = match target.architecture {\n    |         ^^^^ help: if this is intentional, prefix it with an underscore: `_arch`\n    |\n    = note: `#[warn(unused_variables)]` on by default\n\nwarning: `roc_build` (lib) generated 2 warnings\n    Finished dev [unoptimized + debuginfo] target(s) in 15.37s\n     Running `/home/oliverschoning/Projects/roc/target/debug/roc hello-world/Hello.roc`\nError: Os { code: 26, kind: ExecutableFileBusy, message: &quot;Text file busy&quot; }\noliverschoning@pop-os:~/Projects/roc/examples$\n</code></pre></div>\n<p>I was hower able to write 1 + 1 in the repl this time!</p>",
        "id": 258606471,
        "sender_full_name": "Oliver Schöning",
        "timestamp": 1634845903
    },
    {
        "content": "<p>Oh, you need to install valgrind</p>",
        "id": 258606689,
        "sender_full_name": "Brendan Hansknecht",
        "timestamp": 1634845989
    },
    {
        "content": "<p>Should just be an <code>sudo apt install valgrind</code></p>",
        "id": 258606843,
        "sender_full_name": "Brendan Hansknecht",
        "timestamp": 1634846044
    },
    {
        "content": "<p>Omg it worked! <br>\nNow only one tests fails and I was able to run helloworld!<br>\n<code>test cli_run::astar ... FAILED</code> &lt;- this test</p>",
        "id": 258607294,
        "sender_full_name": "Oliver Schöning",
        "timestamp": 1634846247
    },
    {
        "content": "<p>Thank you very much <span class=\"user-mention\" data-user-id=\"343810\">@Brendan Hansknecht</span></p>",
        "id": 258607326,
        "sender_full_name": "Oliver Schöning",
        "timestamp": 1634846261
    },
    {
        "content": "<p>If you run the tests again or just that test alone, does it consistently fail. I think our tests have a minor filesystem race condition that hasn't been fixed yet.</p>",
        "id": 258607576,
        "sender_full_name": "Brendan Hansknecht",
        "timestamp": 1634846364
    },
    {
        "content": "<p>How can I run a single test?</p>",
        "id": 258608631,
        "sender_full_name": "Oliver Schöning",
        "timestamp": 1634846728
    },
    {
        "content": "<p><code>cargo test --test cli_run deriv</code> should run just the deriv cli test</p>",
        "id": 258609174,
        "sender_full_name": "Folkert de Vries",
        "timestamp": 1634846942
    },
    {
        "content": "<p>I have re-run the all tests a couple of times. Sometimes they hang:</p>\n<div class=\"codehilite\"><pre><span></span><code>test cli_run::cfold has been running for over 60 seconds\ntest cli_run::cli has been running for over 60 seconds\n</code></pre></div>\n<p>Sometimes a test fails, never the same, sometimes they all pass. </p>\n<p>Very confusing</p>",
        "id": 258610256,
        "sender_full_name": "Oliver Schöning",
        "timestamp": 1634847378
    },
    {
        "content": "<p>yea that happens, seems like you're hit hard by it though</p>",
        "id": 258610536,
        "sender_full_name": "Folkert de Vries",
        "timestamp": 1634847493
    },
    {
        "content": "<p>there is some race condition in there</p>",
        "id": 258610553,
        "sender_full_name": "Folkert de Vries",
        "timestamp": 1634847499
    },
    {
        "content": "<p>does <code>cargo test --test cli_run -- --test-threads 1</code> work?</p>",
        "id": 258610635,
        "sender_full_name": "Folkert de Vries",
        "timestamp": 1634847532
    },
    {
        "content": "<p>(it is going to be slow, but it should be correct)</p>",
        "id": 258610674,
        "sender_full_name": "Folkert de Vries",
        "timestamp": 1634847545
    },
    {
        "content": "<p>Running it now. Why are tests sometimes failing tho? That's not how I usually expect unit tests to work haha</p>",
        "id": 258611357,
        "sender_full_name": "Oliver Schöning",
        "timestamp": 1634847825
    },
    {
        "content": "<p>Those are integration tests and a number of them generate the same file. So sometimes they delete the file while another test is using it. I thought we set them to run sequentially but I guess it doesn't work.</p>",
        "id": 258611815,
        "sender_full_name": "Brendan Hansknecht",
        "timestamp": 1634848014
    },
    {
        "content": "<p>Result from:<br>\ncargo test --test cli_run -- --test-threads 1</p>\n<p><code>``oliverschoning@pop-os:~/Projects/roc$ cargo test --test cli_run -- --test-threads 1\nwarning: unused import: </code>crate::target::arch_str<code>\n --&gt; compiler/build/src/link.rs:1:5\n  |\n1 | use crate::target::arch_str;\n  |     ^^^^^^^^^^^^^^^^^^^^^^^\n  |\n  = note: </code>#[warn(unused_imports)]` on by default</p>\n<p>warning: unused variable: <code>arch</code><br>\n   --&gt; compiler/build/src/link.rs:726:9<br>\n    |<br>\n726 |     let arch = match target.architecture {<br>\n    |         ^^^^ help: if this is intentional, prefix it with an underscore: <code>_arch</code><br>\n    |<br>\n    = note: <code>#[warn(unused_variables)]</code> on by default</p>\n<p>warning: <code>roc_build</code> (lib) generated 2 warnings<br>\n    Finished test [unoptimized + debuginfo] target(s) in 0.18s<br>\n     Running tests/cli_run.rs (target/debug/deps/cli_run-42f9a13667c40034)</p>\n<p>running 21 tests<br>\ntest cli_run::astar ... ok<br>\ntest cli_run::base64 ... ok<br>\ntest cli_run::cfold ... ok<br>\ntest cli_run::cli ... ok<br>\ntest cli_run::closure ... ok<br>\ntest cli_run::deriv ... ok<br>\ntest cli_run::effect ... ok<br>\ntest cli_run::fib ... ok<br>\ntest cli_run::hello_rust ... ok<br>\ntest cli_run::hello_web ... ok<br>\ntest cli_run::hello_world ... ok<br>\ntest cli_run::hello_zig ... ok<br>\ntest cli_run::nqueens ... ok<br>\ntest cli_run::quicksort ... ok<br>\ntest cli_run::quicksort_app ... ok<br>\ntest cli_run::rbtree_ck ... ok<br>\ntest cli_run::rbtree_insert ... ok<br>\ntest cli_run::run_multi_dep_str_optimized ... ok<br>\ntest cli_run::run_multi_dep_str_unoptimized ... ok<br>\ntest cli_run::run_multi_dep_thunk_optimized ... ok<br>\ntest cli_run::run_multi_dep_thunk_unoptimized ... ok</p>\n<p>test result: ok. 21 passed; 0 failed; 0 ignored; 0 measured; 0 filtered out; finished in 49.42s</p>\n<div class=\"codehilite\"><pre><span></span><code>\n</code></pre></div>",
        "id": 258611871,
        "sender_full_name": "Oliver Schöning",
        "timestamp": 1634848045
    },
    {
        "content": "<p>Cool. You have a working compiler. The warning messages are due to my quick hacks to disable the <code>-arch</code></p>",
        "id": 258612025,
        "sender_full_name": "Brendan Hansknecht",
        "timestamp": 1634848109
    },
    {
        "content": "<p>Still need to figure out what exactly is going on there.</p>",
        "id": 258612059,
        "sender_full_name": "Brendan Hansknecht",
        "timestamp": 1634848126
    },
    {
        "content": "<p><span aria-label=\"tada\" class=\"emoji emoji-1f389\" role=\"img\" title=\"tada\">:tada:</span>  yay! thanks so much</p>",
        "id": 258612312,
        "sender_full_name": "Oliver Schöning",
        "timestamp": 1634848218
    },
    {
        "content": "<p>I can live with this, eventually there will be an installer I assume :D</p>",
        "id": 258612368,
        "sender_full_name": "Oliver Schöning",
        "timestamp": 1634848244
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"343810\">@Brendan Hansknecht</span>  those tests don't run sequentially normally</p>",
        "id": 258612391,
        "sender_full_name": "Folkert de Vries",
        "timestamp": 1634848252
    },
    {
        "content": "<p>it just seems that some machines are more likely to run into that race condition</p>",
        "id": 258612425,
        "sender_full_name": "Folkert de Vries",
        "timestamp": 1634848270
    },
    {
        "content": "<p>maybe based on processor speed or number of cores</p>",
        "id": 258612446,
        "sender_full_name": "Folkert de Vries",
        "timestamp": 1634848280
    },
    {
        "content": "<p>Oh, i didn't realize. We should maybe at least make the ones in the benchmarks folder run sequentially. Or first compile the host and then use the <code>--precompiled-host</code> flag.</p>",
        "id": 258612668,
        "sender_full_name": "Brendan Hansknecht",
        "timestamp": 1634848369
    },
    {
        "content": "<p>that flag exists?</p>",
        "id": 258612739,
        "sender_full_name": "Folkert de Vries",
        "timestamp": 1634848401
    },
    {
        "content": "<p>if so we can use it, on ci at least</p>",
        "id": 258612801,
        "sender_full_name": "Folkert de Vries",
        "timestamp": 1634848425
    },
    {
        "content": "<p>because there one of the tests is run to compile the host, effectively pre-compiling it for the rest</p>",
        "id": 258612876,
        "sender_full_name": "Folkert de Vries",
        "timestamp": 1634848444
    },
    {
        "content": "<p>I added the flag as part of linker changes</p>",
        "id": 258612920,
        "sender_full_name": "Brendan Hansknecht",
        "timestamp": 1634848467
    },
    {
        "content": "<p>oh, excellent</p>",
        "id": 258612947,
        "sender_full_name": "Folkert de Vries",
        "timestamp": 1634848477
    },
    {
        "content": "<p>Thanks for working through this with us <span class=\"user-mention\" data-user-id=\"431466\">@Oliver Schöning</span> ! I have improved the llvm installation instructions for Ubuntu/Debian, I'll also be working on a complete install script today.</p>",
        "id": 258679237,
        "sender_full_name": "Anton",
        "timestamp": 1634891256
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"361169\">@Anton</span> omg no problem! I’m just very grateful for all the help I’ve gotten! Clearly the Elm community spirit also lives in Roc ❤️</p>",
        "id": 258692948,
        "sender_full_name": "Oliver Schöning",
        "timestamp": 1634898955
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"343810\">@Brendan Hansknecht</span> and <span class=\"user-mention\" data-user-id=\"431466\">@Oliver Schöning</span> I think this PR will solve the <code>-arch</code> problem: <a href=\"https://github.com/rtfeldman/roc/pull/1851\">https://github.com/rtfeldman/roc/pull/1851</a></p>\n<p>Could you guys take a look? <span class=\"user-mention\" data-user-id=\"431466\">@Oliver Schöning</span> this change should make it work smooth.</p>",
        "id": 259746527,
        "sender_full_name": "Luiz de Oliveira",
        "timestamp": 1635621039
    }
]