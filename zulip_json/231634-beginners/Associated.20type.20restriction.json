[
    {
        "content": "<p>Hi all,<br>\nI couldn't find the syntax in the tutorial or in the compiler repo, or the right terms to search here: is there a way to add a restriction/where clause to type parameters of types? E.g. an association list needs comparable keys? Or is there a way to define this in roc's way to avoid the problem?</p>\n<p>(Invalid <code>where</code> clause below)</p>\n<div class=\"codehilite\"><pre><span></span><code>AssocList(key, value) ::  {\n    elements : List((key, value))\n} where [key.is_eq: key, key -&gt; Bool].{...}\n</code></pre></div>",
        "id": 574399818,
        "sender_full_name": "Jonathan",
        "timestamp": 1771368644
    },
    {
        "content": "<p>I suppose, being opaque, you could just put the restriction on the constructor (and every other func)? Although then there's nothing stopping me from doing </p>\n<div class=\"codehilite\"><pre><span></span><code>x : AssocList(MyTypeWithNoEq, Str)\nx = AssocList.empty()\n</code></pre></div>\n<p>(Of course, why I would do that I don't know)</p>",
        "id": 574400584,
        "sender_full_name": "Jonathan",
        "timestamp": 1771369102
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"820027\">Jonathan</span> <a href=\"#narrow/channel/231634-beginners/topic/Associated.20type.20restriction/near/574399818\">said</a>:</p>\n<blockquote>\n<p>Hi all,<br>\nI couldn't find the syntax in the tutorial or in the compiler repo, or the right terms to search here: is there a way to add a restriction/where clause to type parameters of types? E.g. an association list needs comparable keys? Or is there a way to define this in roc's way to avoid the problem?</p>\n<p>(Invalid <code>where</code> clause below)</p>\n<p><div class=\"codehilite\"><pre><span></span><code>AssocList(key, value) ::  {\n    elements : List((key, value))\n} where [key.is_eq: key, key -&gt; Bool].{...}\n</code></pre></div><br>\n</p>\n</blockquote>\n<p>I feel like that <code>where</code> clause should be valid</p>",
        "id": 574401478,
        "sender_full_name": "Luke Boswell",
        "timestamp": 1771369609
    },
    {
        "content": "<p>Oh yeah, maybe it goes on the constructors</p>",
        "id": 574401518,
        "sender_full_name": "Luke Boswell",
        "timestamp": 1771369629
    },
    {
        "content": "<p>This is what I'm getting on the current nightly</p>\n<div class=\"codehilite\"><pre><span></span><code>You cannot define a where clause inside a type declaration.\n\nYou&#39;re attempting do this here:\n  â”Œâ”€ ./AssocList.roc:1:1\n  â”‚\n1 â”‚ AssocList(key, value) ::  {\n2 â”‚     elements : List((key, value))\n3 â”‚ }where [key.is_eq: key, key -&gt; Bool].{\n4 â”‚ }\n</code></pre></div>",
        "id": 574401552,
        "sender_full_name": "Jonathan",
        "timestamp": 1771369646
    },
    {
        "content": "<blockquote>\n<p>Oh yeah, maybe it goes on the constructors</p>\n</blockquote>\n<p>I guess also on the <code>.empty()</code> too would stop that edge case <span aria-label=\"man facepalming\" class=\"emoji emoji-1f926-200d-2642\" role=\"img\" title=\"man facepalming\">:man_facepalming:</span></p>",
        "id": 574401683,
        "sender_full_name": "Jonathan",
        "timestamp": 1771369729
    },
    {
        "content": "<p>I think we talked about a way to alias a collection of <code>where</code> clauses into like an interface. </p>\n<p>Maybe it would be something like this then?</p>\n<div class=\"codehilite\"><pre><span></span><code>AssocList(key, value) ::  {  elements : List((HasEq(key), value)) } ...\n</code></pre></div>",
        "id": 574401697,
        "sender_full_name": "Luke Boswell",
        "timestamp": 1771369736
    },
    {
        "content": "<p>Is HasEq a type alias for \"something that implements is_eq\"? That's pretty cool</p>",
        "id": 574402043,
        "sender_full_name": "Jonathan",
        "timestamp": 1771369951
    },
    {
        "content": "<p>I <em>think</em> it would be something like but I don't know what the syntax would look like. I'm not sure we ever finished the conversation.</p>\n<div class=\"codehilite\"><pre><span></span><code>HasEq(a) : _ where a.is_eq: a, a -&gt; Bool\n</code></pre></div>",
        "id": 574402157,
        "sender_full_name": "Luke Boswell",
        "timestamp": 1771370020
    },
    {
        "content": "<p>That's quite an elegant solution tbh. So essentially you can put restrictions on aliases and record field annotations, and that bubbles up to the opaque type parameters?</p>",
        "id": 574402451,
        "sender_full_name": "Jonathan",
        "timestamp": 1771370183
    },
    {
        "content": "<blockquote>\n<p>I'm not sure we ever finished the conversation.</p>\n</blockquote>\n<p>Is that not valid syntax right now? Currently afk (but will testsoon!)</p>",
        "id": 574402720,
        "sender_full_name": "Jonathan",
        "timestamp": 1771370369
    },
    {
        "content": "<p>this is actually an anti pattern! putting constraints on the type level end up being hard to work with. youâ€™ll want to put only the constraints necessary on each individual function</p>",
        "id": 574403767,
        "sender_full_name": "Jared Ramirez",
        "timestamp": 1771371001
    },
    {
        "content": "<p>thereâ€™s another thread from a while ago that has a fuller explanation, i can try to find it later</p>",
        "id": 574403823,
        "sender_full_name": "Jared Ramirez",
        "timestamp": 1771371037
    },
    {
        "content": "<p>Even if it's core to the existence of the type? I would love to read that if you could find it thank you (off soon - no pressure).</p>",
        "id": 574406520,
        "sender_full_name": "Jonathan",
        "timestamp": 1771372550
    },
    {
        "content": "<p>Side note: I saw about the record builder suffix notation, eg</p>\n<div class=\"codehilite\"><pre><span></span><code>{ a: DoesNotImplEq }.MyType\n</code></pre></div>\n<p>Doesn't that allow bypassing smart constructor style type restrictions?</p>",
        "id": 574406677,
        "sender_full_name": "Jonathan",
        "timestamp": 1771372678
    },
    {
        "content": "<p>Thank you <span class=\"user-mention\" data-user-id=\"341568\">@Jared Ramirez</span></p>",
        "id": 574407472,
        "sender_full_name": "Luke Boswell",
        "timestamp": 1771373113
    },
    {
        "content": "<p>Bonus question: are there any cases where you would consider type level constraints? For instance, if I am a function that accepts <code>Container(a)</code>, and there are certain type restricted functions of <code>Container</code> that I don't necessarily use yet, it would be a breaking change in the future if I started using them.</p>",
        "id": 574407672,
        "sender_full_name": "Jonathan",
        "timestamp": 1771373241
    },
    {
        "content": "<p>previous discussion here: <a class=\"message-link\" href=\"/#narrow/channel/304641-ideas/topic/where.20clause.20changes/near/528167945\">#ideas &gt; where clause changes @ ðŸ’¬</a></p>",
        "id": 574416724,
        "sender_full_name": "Jared Ramirez",
        "timestamp": 1771379630
    },
    {
        "content": "<p>(old <code>where</code> syntax, but you get the idea)</p>",
        "id": 574416762,
        "sender_full_name": "Jared Ramirez",
        "timestamp": 1771379653
    },
    {
        "content": "<p>tldr; is if you put the constraint on the type, then you have to include that constraint in a bunch of type signatures everywhere, even if the function question doesn't need it (eg in <code>size : Dict(k, v)</code>, <code>k</code> would need <code>k.hash</code>, even though <code>size</code> doesn't do any hashing)</p>",
        "id": 574416866,
        "sender_full_name": "Jared Ramirez",
        "timestamp": 1771379722
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"341568\">Jared Ramirez</span> <a href=\"#narrow/channel/231634-beginners/topic/Associated.20type.20restriction/near/574416724\">said</a>:</p>\n<blockquote>\n<p>previous discussion here: <a class=\"message-link\" href=\"/#narrow/channel/304641-ideas/topic/where.20clause.20changes/near/528167945\">#ideas &gt; where clause changes @ ðŸ’¬</a></p>\n</blockquote>\n<p>Fair enough - thank you!</p>",
        "id": 574453912,
        "sender_full_name": "Jonathan",
        "timestamp": 1771404363
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"515757\">Luke Boswell</span> <a href=\"#narrow/channel/231634-beginners/topic/Associated.20type.20restriction/near/574402157\">said</a>:</p>\n<blockquote>\n<p><div class=\"codehilite\"><pre><span></span><code>HasEq(a) : _ where a.is_eq: a, a -&gt; Bool\n</code></pre></div><br>\n</p>\n</blockquote>\n<p><del>So is this a syntax that will not make it in to roc?</del> I see it's currently frozen at least:</p>\n<p><span class=\"user-mention silent\" data-user-id=\"341568\">Jared Ramirez</span> <a href=\"#narrow/channel/304641-ideas/topic/where.20clause.20changes/near/531882059\">said</a>:</p>\n<blockquote>\n<p>Based on this convo, i'm planning on disallowing <code>where</code> clauses in type declarations for now in my next PR. </p>\n</blockquote>\n<p><del>Putting type constraints on a type may be an antipattern, but here it looks like it allows you to define something interface-y that you can tag a type variable with as a shorthand for all the constituent required functions in the <code>where</code>. Not sure how you'd compose though (e.g., HasEq and HasCmp).</del></p>",
        "id": 574473248,
        "sender_full_name": "Jonathan",
        "timestamp": 1771410336
    },
    {
        "content": "<p>I also don't have a valid use case yet outside of type-foo so maybe don't mind me here <span aria-label=\"laughing\" class=\"emoji emoji-1f606\" role=\"img\" title=\"laughing\">:laughing:</span></p>",
        "id": 574473652,
        "sender_full_name": "Jonathan",
        "timestamp": 1771410478
    }
]