[
    {
        "content": "<p>Is it not possible to have multiple <code>roc.exe</code> versions concurrently on the same machine? I've pulled down the compiler source to tidy up some things I've noticed, and was trying to test my changes by running the downloaded nightly and then my local build. However, running the nightly causes a kernel panic. (Windows)</p>",
        "id": 576112931,
        "sender_full_name": "Daren",
        "timestamp": 1772136136
    },
    {
        "content": "<p>Which version do you have?</p>",
        "id": 576116002,
        "sender_full_name": "Luke Boswell",
        "timestamp": 1772137218
    },
    {
        "content": "<p>Are you building the Rust or Zig roc from source?</p>",
        "id": 576116084,
        "sender_full_name": "Luke Boswell",
        "timestamp": 1772137246
    },
    {
        "content": "<p>I'm building the new Zig-based compiler</p>",
        "id": 576116293,
        "sender_full_name": "Daren",
        "timestamp": 1772137303
    },
    {
        "content": "<p>I'd be curious to know why the nightly causes a panic... but it may be hard to track down</p>",
        "id": 576128240,
        "sender_full_name": "Luke Boswell",
        "timestamp": 1772142065
    },
    {
        "content": "<p>There shouldn't be any reason they interact -- different versions</p>",
        "id": 576128279,
        "sender_full_name": "Luke Boswell",
        "timestamp": 1772142082
    },
    {
        "content": "<p>I wonder if our CI that is building the nightlies on Windows has something goofy going on... you may just be the first person to have tried the nightly <span aria-label=\"sweat smile\" class=\"emoji emoji-1f605\" role=\"img\" title=\"sweat smile\">:sweat_smile:</span></p>",
        "id": 576128370,
        "sender_full_name": "Luke Boswell",
        "timestamp": 1772142133
    },
    {
        "content": "<p>They are different executables, but the same \"version\" if that should matter.  </p>\n<div class=\"codehilite\"><pre><span></span><code>❯ …\\Projects\\Roc\\test ❯  cat .\\main.roc\napp [main!] { pf: platform &quot;https://github.com/lukewilliamboswell/roc-platform-template-zig/releases/download/0.6/2BfGn4M9uWJNhDVeMghGeXNVDFijMfPsmmVeo6M4QjKX.tar.zst&quot; }\n\nimport pf.Stdout\n\nmain! = |_args| {\n    Stdout.line!(&quot;Hello, World!&quot;)\n    Ok({})\n}\n\n❯ …\\Projects\\Roc\\test ❯  D:\\Projects\\Roc-compiler\\roc\\zig-out\\bin\\roc\nHello, World!\n\n❯ …\\Projects\\Roc\\test ❯ E:\\Roc\\roc_nightly-windows_x86_64-2026-02-26-adbec1c\\roc.exe\nthread 7656 panic: integer does not fit in destination type\n???:?:?: 0x7ff7eb988e4a in ??? (???)\n???:?:?: 0x7ff7eb907a2b in ??? (???)\n???:?:?: 0x7ff7eb76def0 in ??? (???)\n???:?:?: 0x7ff7eb6c4357 in ??? (???)\n???:?:?: 0x7ff7eb68aa26 in ??? (???)\n???:?:?: 0x7ff7eb682098 in ??? (???)\n???:?:?: 0x7ff7eb68136e in ??? (???)\n???:?:?: 0x7ff7eb6810d5 in ??? (???)\n???:?:?: 0x7ff7eb681043 in ??? (???)\n???:?:?: 0x7ff7ebaa8448 in ??? (???)\n???:?:?: 0x7ff7ebaaf33f in ??? (???)\n???:?:?: 0x7ffc33ec7373 in ??? (KERNEL32.DLL)\n???:?:?: 0x7ffc3589cc90 in ??? (ntdll.dll)\n\n❯ …\\Projects\\Roc\\test ❯ E:\\Roc\\roc_nightly-windows_x86_64-2026-02-26-adbec1c\\roc.exe version\nRoc compiler version debug-adbec1c9\n\n❯ …\\Projects\\Roc\\test ❯ D:\\Projects\\Roc-compiler\\roc\\zig-out\\bin\\roc version\nRoc compiler version debug-adbec1c9\n</code></pre></div>\n<p>FWIW the nightly worked OK before I downloaded and built the source.</p>",
        "id": 576129031,
        "sender_full_name": "Daren",
        "timestamp": 1772142423
    },
    {
        "content": "<p>oh if they are the same \"version\" its conceivable they are messing with each other's Roc cache</p>",
        "id": 576129192,
        "sender_full_name": "Luke Boswell",
        "timestamp": 1772142497
    },
    {
        "content": "<p>You could try deleting the cache before running and see if that changes anything.</p>",
        "id": 576129265,
        "sender_full_name": "Luke Boswell",
        "timestamp": 1772142526
    },
    {
        "content": "<p>I'm not 100% on where that is on Windows... give me 1 sec</p>",
        "id": 576129297,
        "sender_full_name": "Luke Boswell",
        "timestamp": 1772142542
    },
    {
        "content": "<p>I did wonder about that, as I've noticed</p>\n<div class=\"codehilite\"><pre><span></span><code>❯  dir C:\\Users\\cobal\\AppData\\Roaming\\Roc\n\n        Directory: C:\\Users\\cobal\\AppData\\Roaming\\Roc\n\n\nMode                LastWriteTime         Length Name\n----                -------------         ------ ----\nd----        26/02/2026     20:12                  debug-adbec1c9\n</code></pre></div>",
        "id": 576129305,
        "sender_full_name": "Daren",
        "timestamp": 1772142545
    },
    {
        "content": "<p>You're right, it works fine when I delete that</p>",
        "id": 576129403,
        "sender_full_name": "Daren",
        "timestamp": 1772142589
    },
    {
        "content": "<p>And then the locally compiled one doesn't work, but it doesn't panic just errors out, So if I want to run different builds locally I need to fiddle with a version number somewhere I guess</p>",
        "id": 576129541,
        "sender_full_name": "Daren",
        "timestamp": 1772142647
    },
    {
        "content": "<p>The version comes from the git sha. But when you build from source it must be something like Debug verse ReleaseSafe or something like that maybe</p>",
        "id": 576129597,
        "sender_full_name": "Luke Boswell",
        "timestamp": 1772142669
    },
    {
        "content": "<p>Two different versions should use different cache's so that's fine... but if you are building from source and using a nightly I'm not sure we should worry about that too much, I would just recommend you pick one and stick with it</p>",
        "id": 576129727,
        "sender_full_name": "Luke Boswell",
        "timestamp": 1772142728
    },
    {
        "content": "<p>Yeah, that's fine. I was just trying to compare nightly to my local version as I was making some changes I wanted to test</p>",
        "id": 576129818,
        "sender_full_name": "Daren",
        "timestamp": 1772142762
    },
    {
        "content": "<p>This does suggest there is a deeper bug somewhere with our serialization of modules in the cache I think... but that's pretty deep into the compiler internals</p>",
        "id": 576129894,
        "sender_full_name": "Luke Boswell",
        "timestamp": 1772142797
    },
    {
        "content": "<p>If you commit you changes you will get a different version hash and use a different cache, so then you can compare ok I think</p>",
        "id": 576130005,
        "sender_full_name": "Luke Boswell",
        "timestamp": 1772142848
    },
    {
        "content": "<p>Ah good tip. I was trying to test before committing anything</p>",
        "id": 576130103,
        "sender_full_name": "Daren",
        "timestamp": 1772142905
    },
    {
        "content": "<p>I must say though, that the process of downloading and building Roc from source was buttery smooth compared to some things I've built myself in the past. Not in the least bit scary (all I had to do was work out why I kept getting the wrong version of Zig - turned out I'd installed it in three different places at various times, and completely forgot about the <code>winget</code> one that was first in my path)</p>",
        "id": 576130448,
        "sender_full_name": "Daren",
        "timestamp": 1772143036
    },
    {
        "content": "<p>Yeah it's really nice working with Zig. We learnt a lot from building the Rust version, and put a lot of lessons into making the Zig one a lot nicer.</p>",
        "id": 576130895,
        "sender_full_name": "Luke Boswell",
        "timestamp": 1772143213
    },
    {
        "content": "<p>I think the Zig guys have done an excellent job with their tooling</p>",
        "id": 576131087,
        "sender_full_name": "Luke Boswell",
        "timestamp": 1772143280
    }
]