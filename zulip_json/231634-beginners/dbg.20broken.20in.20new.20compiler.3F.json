[
    {
        "content": "<p>I'm trying out the new compiler on AoC and my dbg statement has no effect in the terminal.</p>\n<p>My code is this:</p>\n<div class=\"codehilite\"><pre><span></span><code>app [main!] { pf: platform &quot;https://github.com/lukewilliamboswell/roc-platform-template-zig/releases/download/0.4/6XA8JLWhmG1FSgb8GxPjBs9cGrtRqopohR3KAHYo722z.tar.zst&quot; }\n\nimport pf.Stdout\nimport pf.Stdin\n\nmain! = |_args| {\n    parsed = parse_input(input)\n    dbg &quot;dbg&quot;\n    dbg parsed\n    Stdout.line!(&quot;stdout&quot;)\n    Ok({})\n}\n\nparse_input = |_| {\n    [Left(21), Right(37)]\n}\n\ninput = &quot;R33\\nL22\\n...&quot;\n</code></pre></div>\n<p>Running <code>roc main.roc</code>, this is only printing \"stdout\", no \"dbg\" or other stuff...</p>\n<p>I want to report this just for the case that it is inadvertently broken. I will manage without it and it's fine if it is not yet implemented. :)</p>",
        "id": 562616789,
        "sender_full_name": "Johannes Maas",
        "timestamp": 1765266773
    },
    {
        "content": "<p>not sure about dbg, but since you are trying the new compiler, beware that there are still bugs that are not easy to circumvent to solve AoC puzzles. Currently, my AoC day 1 solution is still leaking memory, and my day2 is still facing panics or other crashes. There has been a lot of progress in bug fixing but still not there yet.</p>",
        "id": 562620046,
        "sender_full_name": "Matthieu Pizenberg",
        "timestamp": 1765268063
    },
    {
        "content": "<p>Yep, I'm aware that the compiler is fresh. Thanks for the heads up! :)</p>",
        "id": 562620262,
        "sender_full_name": "Johannes Maas",
        "timestamp": 1765268138
    },
    {
        "content": "<p>It was working... but I think we may have broken it recently.</p>",
        "id": 562620641,
        "sender_full_name": "Luke Boswell",
        "timestamp": 1765268291
    },
    {
        "content": "<p>If you make a GH Issue that would help track it. Do you know if it's all <code>dbg</code> statements?</p>",
        "id": 562620716,
        "sender_full_name": "Luke Boswell",
        "timestamp": 1765268319
    },
    {
        "content": "<p>I will make a GH issue with all information I have. :)</p>",
        "id": 562620891,
        "sender_full_name": "Johannes Maas",
        "timestamp": 1765268386
    },
    {
        "content": "<p>Oh I think I know what the issue here specifically is...</p>",
        "id": 562621219,
        "sender_full_name": "Luke Boswell",
        "timestamp": 1765268516
    },
    {
        "content": "<div class=\"codehilite\" data-code-language=\"Zig\"><pre><span></span><code><span class=\"c1\">/// Roc debug function</span>\n<span class=\"k\">fn</span><span class=\"w\"> </span><span class=\"n\">rocDbgFn</span><span class=\"p\">(</span><span class=\"n\">roc_dbg</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">*</span><span class=\"kr\">const</span><span class=\"w\"> </span><span class=\"n\">builtins</span><span class=\"p\">.</span><span class=\"n\">host_abi</span><span class=\"p\">.</span><span class=\"n\">RocDbg</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">env</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">*</span><span class=\"n\">anyopaque</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"n\">callconv</span><span class=\"p\">(.</span><span class=\"n\">c</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"kt\">void</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">    </span><span class=\"n\">_</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">env</span><span class=\"p\">;</span>\n<span class=\"w\">    </span><span class=\"kr\">const</span><span class=\"w\"> </span><span class=\"n\">message</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">roc_dbg</span><span class=\"p\">.</span><span class=\"n\">utf8_bytes</span><span class=\"p\">[</span><span class=\"mi\">0</span><span class=\"p\">..</span><span class=\"n\">roc_dbg</span><span class=\"p\">.</span><span class=\"n\">len</span><span class=\"p\">];</span>\n<span class=\"w\">    </span><span class=\"n\">std</span><span class=\"p\">.</span><span class=\"n\">log</span><span class=\"p\">.</span><span class=\"n\">debug</span><span class=\"p\">(</span><span class=\"s\">\"</span><span class=\"se\">\\x1b</span><span class=\"s\">[33mRoc dbg:</span><span class=\"se\">\\x1b</span><span class=\"s\">[0m {s}\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"p\">.{</span><span class=\"n\">message</span><span class=\"p\">});</span>\n<span class=\"p\">}</span>\n</code></pre></div>",
        "id": 562621248,
        "sender_full_name": "Luke Boswell",
        "timestamp": 1765268523
    },
    {
        "content": "<p>This is from the platform... and we print using <code>std.log.debug</code></p>",
        "id": 562621299,
        "sender_full_name": "Luke Boswell",
        "timestamp": 1765268541
    },
    {
        "content": "<p>When I built a release of the platform I used <code>-Doptimize=ReleaseSafe</code> so I bet that is a no-op when using that platform from a URL release</p>",
        "id": 562621380,
        "sender_full_name": "Luke Boswell",
        "timestamp": 1765268568
    },
    {
        "content": "<p>That should probably be using <code>stderr</code> instead, and have a global so it exits with a non-zero exit code I think.</p>",
        "id": 562621555,
        "sender_full_name": "Luke Boswell",
        "timestamp": 1765268623
    },
    {
        "content": "<p>So I don't think this is a \"bug\" in Roc but in my zig platform template.</p>",
        "id": 562621631,
        "sender_full_name": "Luke Boswell",
        "timestamp": 1765268654
    },
    {
        "content": "<p>Yeah so with this test program using the fx test platform</p>\n<div class=\"codehilite\"><pre><span></span><code>app [main!] { pf: platform &quot;./platform/main.roc&quot; }\n\nimport pf.Stdout\nimport pf.Stdin\n\nmain! = || {\n    parsed = parse_input(input)\n    dbg &quot;dbg&quot;\n    dbg parsed\n    Stdout.line!(&quot;stdout&quot;)\n}\n\nparse_input = |_| {\n    [Left(21), Right(37)]\n}\n\ninput = &quot;R33\\nL22\\n...&quot;\n</code></pre></div>\n<div class=\"codehilite\"><pre><span></span><code>$ roc test/fx/test_app.roc\nROC DBG: &quot;dbg&quot;\nROC DBG: [&lt;tag_union variant=0&gt;, &lt;tag_union variant=1&gt;]\nstdout\n</code></pre></div>",
        "id": 562621911,
        "sender_full_name": "Luke Boswell",
        "timestamp": 1765268744
    },
    {
        "content": "<p>Thanks! Do you want me to create an issue on your platform repo? (I have created one on the Roc repo which I will close.)</p>",
        "id": 562622044,
        "sender_full_name": "Johannes Maas",
        "timestamp": 1765268798
    },
    {
        "content": "<p>Interestingly though... that <code>&lt;tag_union variant=0&gt;</code> looks like a bug to me, that should print the tag I would assume</p>",
        "id": 562622049,
        "sender_full_name": "Luke Boswell",
        "timestamp": 1765268799
    },
    {
        "content": "<p>GH issue: <a href=\"https://github.com/lukewilliamboswell/roc-platform-template-zig/issues/18\">https://github.com/lukewilliamboswell/roc-platform-template-zig/issues/18</a></p>",
        "id": 562622311,
        "sender_full_name": "Johannes Maas",
        "timestamp": 1765268893
    },
    {
        "content": "<p>If I can fix my issues with the roc build PR I need to make a new release of the platform anyway as that is a breaking change for the platforms, they now require a <code>\"targets\"</code> section in the platform header</p>",
        "id": 562622666,
        "sender_full_name": "Luke Boswell",
        "timestamp": 1765269011
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"515757\">@Luke Boswell</span> so you know, you can now make a release of roc-platform-template-zig by clicking the \"Run workflow\" button <a href=\"https://github.com/lukewilliamboswell/roc-platform-template-zig/actions/workflows/release.yml\">here</a>.</p>",
        "id": 562635761,
        "sender_full_name": "Anton",
        "timestamp": 1765272962
    },
    {
        "content": "<p>Thank you Anton, I hadn't noticed that</p>",
        "id": 562650890,
        "sender_full_name": "Luke Boswell",
        "timestamp": 1765277197
    },
    {
        "content": "<p>The above issue is fixed in <code>commit f3bb846a74cbcbf4f80252e85252d0df79effcfb</code> should be in the next release</p>",
        "id": 562652091,
        "sender_full_name": "Luke Boswell",
        "timestamp": 1765277513
    }
]