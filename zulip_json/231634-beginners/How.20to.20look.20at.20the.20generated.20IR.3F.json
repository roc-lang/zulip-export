[
    {
        "content": "<p>What is currently the recommended approach to look at what IR is being generated by a particular Roc program or function?</p>",
        "id": 377553491,
        "sender_full_name": "Qqwy / Marten",
        "timestamp": 1690022447
    },
    {
        "content": "<p>with environment variables, like this </p>\n<div class=\"codehilite\"><pre><span></span><code>ROC_PRINT_IR_AFTER_RESET_REUSE=1 cargo test-gen-dev gen_primitives::nested_switch -- --nocapture\n</code></pre></div>",
        "id": 377555548,
        "sender_full_name": "Folkert de Vries",
        "timestamp": 1690022949
    },
    {
        "content": "<p>there are a couple other stages at which we can print the IR, search for <code>ROC_PRINT_IR</code></p>",
        "id": 377555701,
        "sender_full_name": "Folkert de Vries",
        "timestamp": 1690022978
    },
    {
        "content": "<p>do you mean llvm ir? Or other?</p>",
        "id": 377582157,
        "sender_full_name": "Richard Feldman",
        "timestamp": 1690028338
    },
    {
        "content": "<p>I was mainly asking for the Roc IR (for which Folkert's answer works nicely), but I'm definitely also interested in how to print the LLVM IR. <span aria-label=\"blush\" class=\"emoji emoji-1f60a\" role=\"img\" title=\"blush\">:blush:</span></p>",
        "id": 377594084,
        "sender_full_name": "Qqwy / Marten",
        "timestamp": 1690031373
    },
    {
        "content": "<p><code>--debug</code> flag</p>",
        "id": 377595053,
        "sender_full_name": "Folkert de Vries",
        "timestamp": 1690031559
    },
    {
        "content": "<p>I'm on an M1 mac. Passing the <code>--debug</code> flag creates a nice <code>.ll</code> file with LLVM IR. But it also creates the error message</p>\n<div class=\"codehilite\"><pre><span></span><code>An internal compiler expectation was broken.\nThis is definitely a compiler bug.\nPlease file an issue here: https://github.com/roc-lang/roc/issues/new/choose\nthread &#39;main&#39; panicked at &#39;I could not find the `debugir` tool on the PATH, install it from https://github.com/vaivaswatha/debugir&#39;, crates/compiler/build/src/program.rs:387:44\nnote: run with `RUST_BACKTRACE=1` environment variable to display a backtrace\n</code></pre></div>\n<p>I've tried installing <code>debugir</code> but it seems we're now on a different LLVM version than <code>debugir</code> expects or something?</p>",
        "id": 377606470,
        "sender_full_name": "Qqwy / Marten",
        "timestamp": 1690033878
    },
    {
        "content": "<p>hmm yeah you may need to build it from source and give it the llvm version that you want. although, if it works it works</p>",
        "id": 377607032,
        "sender_full_name": "Folkert de Vries",
        "timestamp": 1690033997
    },
    {
        "content": "<p>the error seems to be about something very different though?</p>",
        "id": 377607080,
        "sender_full_name": "Folkert de Vries",
        "timestamp": 1690034006
    },
    {
        "content": "<p>The error only appears when adding the <code>--debug</code> flag to a call to <code>roc build</code></p>",
        "id": 377617353,
        "sender_full_name": "Qqwy / Marten",
        "timestamp": 1690036500
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"281543\">Folkert de Vries</span> <a href=\"#narrow/stream/231634-beginners/topic/How.20to.20look.20at.20the.20generated.20IR.3F/near/377607032\">said</a>:</p>\n<blockquote>\n<p>hmm yeah you may need to build it from source and give it the llvm version that you want. although, if it works it works</p>\n</blockquote>\n<p>Ok, I'll try to do that</p>",
        "id": 377617406,
        "sender_full_name": "Qqwy / Marten",
        "timestamp": 1690036513
    },
    {
        "content": "<p>fwiw I use <code>nix develop</code> when working on Roc stuff, and it Just Works for me there</p>",
        "id": 377620969,
        "sender_full_name": "Richard Feldman",
        "timestamp": 1690037457
    },
    {
        "content": "<p>if you use nix you can load the flake in the compiler repo which should give you the right debugir. But if you only care about the llvm or without debugir on top you can ignore the error entirely. There is nothing meaningful that happens after we attempt to run debugir that differs from a normal build</p>",
        "id": 377621061,
        "sender_full_name": "Ayaz Hafiz",
        "timestamp": 1690037480
    },
    {
        "content": "<p>to use ROC_PRINT_IR_* you will need to build a debug version of the compiler anyway</p>",
        "id": 377621348,
        "sender_full_name": "Ayaz Hafiz",
        "timestamp": 1690037558
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"281383\">Richard Feldman</span> <a href=\"#narrow/stream/231634-beginners/topic/How.20to.20look.20at.20the.20generated.20IR.3F/near/377620969\">said</a>:</p>\n<blockquote>\n<p>fwiw I use <code>nix develop</code> when working on Roc stuff, and it Just Works for me there</p>\n</blockquote>\n<p>Aaah! Nice! Yes, that works! <span aria-label=\"happy\" class=\"emoji emoji-1f600\" role=\"img\" title=\"happy\">:happy:</span></p>",
        "id": 377621419,
        "sender_full_name": "Qqwy / Marten",
        "timestamp": 1690037583
    }
]