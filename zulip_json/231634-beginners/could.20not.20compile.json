[
    {
        "content": "<p>Hey there<br>\nI'm struggling to run the hello world example.</p>",
        "id": 283378496,
        "sender_full_name": "Jan Wirth",
        "timestamp": 1653341527
    },
    {
        "content": "<div class=\"codehilite\"><pre><span></span><code>error[E0425]: cannot find function `fexecve` in crate `libc`\n   --&gt; cli/src/lib.rs:609:26\n    |\n609 |                   if libc::fexecve(fd, argv.as_ptr(), envp.as_ptr()) != 0 {\n    |                            ^^^^^^^ help: a function with a similar name exists: `execve`\n    |\n   ::: /Users/janwirth/.cargo/registry/src/github.com-1ecc6299db9ec823/libc-0.2.125/src/unix/mod.rs:862:5\n    |\n862 | /     pub fn execve(\n863 | |         prog: *const c_char,\n864 | |         argv: *const *const c_char,\n865 | |         envp: *const *const c_char,\n866 | |     ) -&gt; ::c_int;\n    | |_________________- similarly named function `execve` defined here\n\nerror[E0425]: cannot find function `memfd_create` in crate `libc`\n   --&gt; cli/src/lib.rs:655:33\n    |\n655 |         let fd = unsafe { libc::memfd_create(anonymous_file_name.as_ptr().cast(), flags) };\n    |                                 ^^^^^^^^^^^^ not found in `libc`\n\nFor more information about this error, try `rustc --explain E0425`.\nerror: could not compile `roc_cli` due to 2 previous errors\nwarning: build failed, waiting for other jobs to finish...\nerror: build failed\n\n[nix-shell:~/roc]$\n</code></pre></div>",
        "id": 283378512,
        "sender_full_name": "Jan Wirth",
        "timestamp": 1653341540
    },
    {
        "content": "<p>I had it working before, but I pulled to get the latest updates from trunk and it seems broken since.</p>",
        "id": 283378541,
        "sender_full_name": "Jan Wirth",
        "timestamp": 1653341568
    },
    {
        "content": "<p>Is it posisble that I have to clear some nix cache or so?</p>",
        "id": 283378570,
        "sender_full_name": "Jan Wirth",
        "timestamp": 1653341589
    },
    {
        "content": "<p>ah, no</p>",
        "id": 283379461,
        "sender_full_name": "Folkert de Vries",
        "timestamp": 1653342128
    },
    {
        "content": "<p>we're missing some conditional compilation there</p>",
        "id": 283379471,
        "sender_full_name": "Folkert de Vries",
        "timestamp": 1653342139
    },
    {
        "content": "<p>that's annoying</p>",
        "id": 283379473,
        "sender_full_name": "Folkert de Vries",
        "timestamp": 1653342142
    },
    {
        "content": "<p>what OS are you on?</p>",
        "id": 283379510,
        "sender_full_name": "Folkert de Vries",
        "timestamp": 1653342174
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"281383\">@Richard Feldman</span> I'm assuming this is a macos issue where certain functions in libc are not there and we need to probably pull linux and macos apart in the code.</p>",
        "id": 283380323,
        "sender_full_name": "Folkert de Vries",
        "timestamp": 1653342680
    },
    {
        "content": "<p>it's hard for me to get right though because on linux everything just works</p>",
        "id": 283380341,
        "sender_full_name": "Folkert de Vries",
        "timestamp": 1653342693
    },
    {
        "content": "<p>yeah that's one of the functions that Linux libc has but Mac doesn't</p>",
        "id": 283682003,
        "sender_full_name": "Richard Feldman",
        "timestamp": 1653351784
    },
    {
        "content": "<p>I'll make a PR to fix</p>",
        "id": 283682028,
        "sender_full_name": "Richard Feldman",
        "timestamp": 1653351812
    },
    {
        "content": "<p>Yeah I'm on OSX M1<br>\n<a href=\"/user_uploads/22008/8Rob0fRBLLi-l60aqW9yEv73/image.png\">image.png</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/22008/8Rob0fRBLLi-l60aqW9yEv73/image.png\" title=\"image.png\"><img src=\"/user_uploads/22008/8Rob0fRBLLi-l60aqW9yEv73/image.png\"></a></div>",
        "id": 283714003,
        "sender_full_name": "Jan Wirth",
        "timestamp": 1653381961
    },
    {
        "content": "<p><a href=\"https://github.com/rtfeldman/roc/pull/3124/files\">https://github.com/rtfeldman/roc/pull/3124/files</a> should fix this!</p>",
        "id": 283746726,
        "sender_full_name": "Richard Feldman",
        "timestamp": 1653399759
    },
    {
        "content": "<p>I can't build <code>roc_load</code>the error was</p>\n<div class=\"codehilite\" data-code-language=\"Bash Session\"><pre><span></span><code><span class=\"go\">error: failed to run custom build command for `roc_load v0.1.0 (PATH/roc/compile/load)`</span>\n\n<span class=\"go\">Caused by:</span>\n<span class=\"go\">  process didn't exit successfully: `PATH/roc/target/debug/build/roc_load-152347a29c7becb0/build-script-build` (signal: 4, SIGILL: illegal instruction)</span>\n<span class=\"go\">  --- stdout</span>\n<span class=\"go\">  cargo:rerun-if-changed=../builtins/roc/Bool.roc</span>\n<span class=\"go\">  cargo:rerun-if-changed=../builtins/roc/Result.roc</span>\n</code></pre></div>",
        "id": 284944923,
        "sender_full_name": "Hashi364",
        "timestamp": 1654299918
    },
    {
        "content": "<p>What system are you on?</p>",
        "id": 284964157,
        "sender_full_name": "Folkert de Vries",
        "timestamp": 1654327254
    },
    {
        "content": "<p>Arch</p>",
        "id": 284978377,
        "sender_full_name": "Hashi364",
        "timestamp": 1654347235
    },
    {
        "content": "<p>Hi <span class=\"user-mention\" data-user-id=\"506120\">@Hashi364</span>, can you describe the steps you took? Did you download the repo and run <code>cargo build</code> from the root of the repo dir?</p>",
        "id": 285024825,
        "sender_full_name": "Anton",
        "timestamp": 1654417313
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"361169\">@Anton</span> I cloned the repo, installed the nix package manager and Flakes, created <code>~/.config/nix/nix.config</code> as a copy of <code>/etc/nix/nix.conf</code> and appended <code>experimental-fatures = nix-command flakes</code>, entered the repo_dir and ran <code>nix develop</code> and then <code>cargo build</code></p>",
        "id": 285040573,
        "sender_full_name": "Hashi364",
        "timestamp": 1654441682
    },
    {
        "content": "<p>Thanks <span class=\"user-mention\" data-user-id=\"506120\">@Hashi364</span>, could you also share the output of <code>lscpu</code>? Do you happen to be inside a virtual machine? Once I have this information I'll try to reproduce the error.</p>",
        "id": 285084973,
        "sender_full_name": "Anton",
        "timestamp": 1654502503
    },
    {
        "content": "<div class=\"codehilite\" data-code-language=\"Bash Session\"><pre><span></span><code><span class=\"go\">Arquitetura:                  x86_64</span>\n<span class=\"go\">  Modo(s) operacional da CPU: 32-bit, 64-bit</span>\n<span class=\"go\">  Tamanhos de endereço:       36 bits physical, 48 bits virtual</span>\n<span class=\"go\">  Ordem dos bytes:            Little Endian</span>\n<span class=\"go\">CPU(s):                       4</span>\n<span class=\"go\">  Lista de CPU(s) on-line:    0-3</span>\n<span class=\"go\">ID de fornecedor:             GenuineIntel</span>\n<span class=\"go\">  Nome do modelo:             Intel(R) Pentium(R) CPU  N3700  @ 1.60GHz</span>\n<span class=\"go\">    Família da CPU:           6</span>\n<span class=\"go\">    Modelo:                   76</span>\n<span class=\"go\">    Thread(s) per núcleo:     1</span>\n<span class=\"go\">    Núcleo(s) por soquete:    4</span>\n<span class=\"go\">    Soquete(s):               1</span>\n<span class=\"go\">    Step:                     3</span>\n<span class=\"go\">    CPU(s) scaling MHz:       36%</span>\n<span class=\"go\">    CPU MHz máx.:             2400,0000</span>\n<span class=\"go\">    CPU MHz mín.:             480,0000</span>\n<span class=\"go\">    BogoMIPS:                 3201.33</span>\n<span class=\"go\">    Opções:                   fpu vme de pse tsc msr pae mce cx8 apic sep mtrr pge mca cmov pat pse36 clflush dts acpi mmx fxsr sse sse2 ss ht tm pbe s</span>\n<span class=\"go\">                              yscall nx rdtscp lm constant_tsc arch_perfmon pebs bts rep_good nopl xtopology tsc_reliable nonstop_tsc cpuid aperfmperf</span>\n<span class=\"go\">                              tsc_known_freq pni pclmulqdq dtes64 monitor ds_cpl vmx est tm2 ssse3 cx16 xtpr pdcm sse4_1 sse4_2 movbe popcnt tsc_deadli</span>\n<span class=\"go\">                              ne_timer aes rdrand lahf_lm 3dnowprefetch epb pti tpr_shadow vnmi flexpriority ept vpid tsc_adjust smep erms dtherm ida a</span>\n<span class=\"go\">                              rat</span>\n<span class=\"go\">Recursos de virtualização:</span>\n<span class=\"go\">  Virtualização:              VT-x</span>\n<span class=\"go\">Caches (soma de todos):</span>\n<span class=\"go\">  L1d:                        96 KiB (4 instâncias)</span>\n<span class=\"go\">  L1i:                        128 KiB (4 instâncias)</span>\n<span class=\"go\">  L2:                         2 MiB (2 instâncias)</span>\n<span class=\"go\">NUMA:</span>\n<span class=\"go\">  Nó(s) de NUMA:              1</span>\n<span class=\"go\">  CPU(s) de nó0 NUMA:         0-3</span>\n<span class=\"go\">Vulnerabilidades:</span>\n<span class=\"go\">  Itlb multihit:              Not affected</span>\n<span class=\"go\">  L1tf:                       Not affected</span>\n<span class=\"go\">  Mds:                        Vulnerable: Clear CPU buffers attempted, no microcode; SMT disabled</span>\n<span class=\"go\">  Meltdown:                   Mitigation; PTI</span>\n<span class=\"go\">  Spec store bypass:          Not affected</span>\n<span class=\"go\">  Spectre v1:                 Mitigation; usercopy/swapgs barriers and __user pointer sanitization</span>\n<span class=\"go\">  Spectre v2:                 Mitigation; Retpolines, STIBP disabled, RSB filling</span>\n<span class=\"go\">  Srbds:                      Not affected</span>\n<span class=\"go\">  Tsx async abort:            Not affected</span>\n</code></pre></div>\n<p><span class=\"user-mention\" data-user-id=\"361169\">@Anton</span></p>",
        "id": 285187505,
        "sender_full_name": "Hashi364",
        "timestamp": 1654559279
    },
    {
        "content": "<p>I think <code>cargo build -vv</code> (\"very verbose\") may tell us more</p>",
        "id": 285214066,
        "sender_full_name": "Folkert de Vries",
        "timestamp": 1654587903
    },
    {
        "content": "<p>it looks like either a segfault or panic, would be good to know which</p>",
        "id": 285214084,
        "sender_full_name": "Folkert de Vries",
        "timestamp": 1654587917
    },
    {
        "content": "<p>I think the Pentium processor is the problem, those don't have the same instructions available as most modern CPUs. This also means I won't be able to reproduce the problem.  <span class=\"user-mention\" data-user-id=\"506120\">@Hashi364</span> ,  you can use <code>gdb</code> to find the instruction that causes the problem. I don't have any experience with <code>gdb</code>, but perhaps <span class=\"user-mention\" data-user-id=\"281543\">@Folkert de Vries</span> or <span class=\"user-mention\" data-user-id=\"343810\">@Brendan Hansknecht</span> can provide more detailed information on how to find the instruction as well as figure out which code generates that instruction.</p>",
        "id": 285246891,
        "sender_full_name": "Anton",
        "timestamp": 1654607070
    },
    {
        "content": "<p>that implies it's a problem with the rust compiler, which I find hard to believe</p>",
        "id": 285247099,
        "sender_full_name": "Folkert de Vries",
        "timestamp": 1654607159
    },
    {
        "content": "<p>much more likely I made something segfault when reading/writing subs to/from disk</p>",
        "id": 285247190,
        "sender_full_name": "Folkert de Vries",
        "timestamp": 1654607180
    },
    {
        "content": "<p>Couldn't some dependency create the illegal instruction error like in <a href=\"https://github.com/rust-lang/rust/issues/75612\">this issue</a>?</p>",
        "id": 285247579,
        "sender_full_name": "Anton",
        "timestamp": 1654607331
    },
    {
        "content": "<p>wouldn't simd instructions be illegal (due to not existing) on a pentium?</p>",
        "id": 285248166,
        "sender_full_name": "Richard Feldman",
        "timestamp": 1654607586
    },
    {
        "content": "<p>hmm, potentially</p>",
        "id": 285248631,
        "sender_full_name": "Folkert de Vries",
        "timestamp": 1654607770
    },
    {
        "content": "<p>we don't really check for feature availability in the simd code, just assume that these features are available on x86_64</p>",
        "id": 285248678,
        "sender_full_name": "Folkert de Vries",
        "timestamp": 1654607795
    },
    {
        "content": "<p>and they would be on most recent CPUs,</p>",
        "id": 285248719,
        "sender_full_name": "Folkert de Vries",
        "timestamp": 1654607817
    },
    {
        "content": "<p>hm, apparently N3700 is Braswell, which does support SIMD</p>",
        "id": 285248875,
        "sender_full_name": "Richard Feldman",
        "timestamp": 1654607903
    },
    {
        "content": "<p><a href=\"https://laptopmedia.com/review/intel-pentium-n3700-review-the-budget-braswell-family-is-here/\">https://laptopmedia.com/review/intel-pentium-n3700-review-the-budget-braswell-family-is-here/</a></p>",
        "id": 285248894,
        "sender_full_name": "Richard Feldman",
        "timestamp": 1654607913
    },
    {
        "content": "<p>Building with <code>cargo build -vv</code>shows this warning from C/C++ twice (which doesn't look usefull to me) and the same error at the end:</p>\n<div class=\"codehilite\" data-code-language=\"consolewarning\"><pre><span></span><code>warning:                  from /nix/store/j85inaz3mf0vy03c2jr835pqr0x5898b-llvm-13.0.0-dev/include/llvm-c/DataTypes.h:27,\nwarning:                  from /nix/store/j85inaz3mf0vy03c2jr835pqr0x5898b-llvm-13.0.0-dev/include/llvm-c/Types.h:17,\nwarning:                  from /nix/store/j85inaz3mf0vy03c2jr835pqr0x5898b-llvm-13.0.0-dev/include/llvm-c/Target.h:23,\nwarning:                  from wrappers/target.c:7:\nwarning: /nix/store/f8z3wraxrbziyf93lwh6adslm89zi6fw-glibc-2.33-123-dev/include/features.h:397:4: warning: #warning _FORTIFY_SOURCE requires compiling with optimization (-O) [-Wcpp]\nwarning:   397 | #  warning _FORTIFY_SOURCE requires compiling with optimization (-O)\nwarning:       |    ^~~~~~~```\n</code></pre></div>",
        "id": 285328762,
        "sender_full_name": "Hashi364",
        "timestamp": 1654645747
    },
    {
        "content": "<p>hmm, does <code>cargo check -vv</code> complete succesfully?</p>",
        "id": 285329562,
        "sender_full_name": "Folkert de Vries",
        "timestamp": 1654646450
    },
    {
        "content": "<p>It fails with the same error</p>",
        "id": 285330480,
        "sender_full_name": "Hashi364",
        "timestamp": 1654647309
    },
    {
        "content": "<p>hmm, do you happen to have <code>lldb</code> installed?</p>",
        "id": 285330900,
        "sender_full_name": "Folkert de Vries",
        "timestamp": 1654647753
    },
    {
        "content": "<p>it's part of llvm</p>",
        "id": 285330902,
        "sender_full_name": "Folkert de Vries",
        "timestamp": 1654647756
    },
    {
        "content": "<p>if so, <code>lldb cargo -- check -vv</code> might do something</p>",
        "id": 285330918,
        "sender_full_name": "Folkert de Vries",
        "timestamp": 1654647771
    },
    {
        "content": "<p>the tricky part is that we and cargo are spawning a bunch of threads</p>",
        "id": 285330931,
        "sender_full_name": "Folkert de Vries",
        "timestamp": 1654647786
    },
    {
        "content": "<p>I can't run <code>lldb</code> inside a <code>nix develop</code> shell.<br>\nI tried installing from <code>pacman -S lldb</code> looks like it works (but not on <code>nix develop</code> shell)<br>\nI tried installing from <code>nix-env -i lldb</code> but it can't find <code>libicuuc.so</code></p>",
        "id": 285473520,
        "sender_full_name": "Hashi364",
        "timestamp": 1654737092
    },
    {
        "content": "<p>When I try pacman's <code>lldb</code> yells that can't find some libraries' version information or something</p>\n<div class=\"codehilite\" data-code-language=\"Bash Session\"><pre><span></span><code><span class=\"go\">lldb: /nix/store/9s8s7snpms482zm3z68aq91d184ynqma-ncurses-6.2/lib/libpanelw.so.6: no version information available (required by /usr/lib/liblldb.so.13)</span>\n<span class=\"go\">lldb: /nix/store/9s8s7snpms482zm3z68aq91d184ynqma-ncurses-6.2/lib/libncursesw.so.6: no version information available (required by /usr/lib/liblldb.so.13)</span>\n<span class=\"go\">lldb: /nix/store/9s8s7snpms482zm3z68aq91d184ynqma-ncurses-6.2/lib/libncursesw.so.6: no version information available (required by /usr/lib/liblldb.so.13)</span>\n<span class=\"go\">lldb: /nix/store/lbccj93nnf77zxg3m9gmral5avbp64z2-gcc-10.3.0-lib/lib/libstdc++.so.6: version `GLIBCXX_3.4.29' not found (required by /usr/lib/liblldb.so.13)</span>\n<span class=\"go\">lldb: /nix/store/lbccj93nnf77zxg3m9gmral5avbp64z2-gcc-10.3.0-lib/lib/libstdc++.so.6: version `CXXABI_1.3.13' not found (required by /usr/lib/liblldb.so.13)</span>\n<span class=\"go\">lldb: /nix/store/9s8s7snpms482zm3z68aq91d184ynqma-ncurses-6.2/lib/libncursesw.so.6: no version information available (required by /usr/lib/libLLVM-13.so)</span>\n<span class=\"go\">lldb: /nix/store/lbccj93nnf77zxg3m9gmral5avbp64z2-gcc-10.3.0-lib/lib/libstdc++.so.6: version `GLIBCXX_3.4.29' not found (required by /usr/lib/libLLVM-13.so)</span>\n<span class=\"go\">lldb: /nix/store/lbccj93nnf77zxg3m9gmral5avbp64z2-gcc-10.3.0-lib/lib/libstdc++.so.6: version `CXXABI_1.3.13' not found (required by /usr/lib/libLLVM-13.so)</span>\n<span class=\"go\">lldb: /nix/store/lbccj93nnf77zxg3m9gmral5avbp64z2-gcc-10.3.0-lib/lib/libstdc++.so.6: version `GLIBCXX_3.4.30' not found (required by /usr/lib/libLLVM-13.so)</span>\n<span class=\"go\">lldb: /nix/store/lbccj93nnf77zxg3m9gmral5avbp64z2-gcc-10.3.0-lib/lib/libstdc++.so.6: version `GLIBCXX_3.4.29' not found (required by /usr/lib/libclang-cpp.so.13)</span>\n</code></pre></div>",
        "id": 285474300,
        "sender_full_name": "Hashi364",
        "timestamp": 1654737789
    },
    {
        "content": "<p>I can try making lldb work inside nix tomorrow.</p>",
        "id": 285501119,
        "sender_full_name": "Anton",
        "timestamp": 1654762933
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"506120\">@Hashi364</span> in flake.nix you can add <code>llvmPkgs.lldb</code> below <code>llvmPkgs.lld</code>. Then you can do <code>nix develop</code> followed by <code>lldb cargo -- check -vv</code>.</p>",
        "id": 285656013,
        "sender_full_name": "Anton",
        "timestamp": 1654856114
    },
    {
        "content": "<p>assuming that works, it puts you in something like an interpreter. <code>run</code> (followed by enter) should run the application and crash, then <code>bt</code> gives the backtrace. That's what I'd like to see</p>",
        "id": 285656196,
        "sender_full_name": "Folkert de Vries",
        "timestamp": 1654856226
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"361169\">@Anton</span> <span class=\"user-mention\" data-user-id=\"281543\">@Folkert de Vries</span> Only one error this time:</p>\n<div class=\"codehilite\" data-code-language=\"Bash Session\"><pre><span></span><code><span class=\"go\">/nix/store/bf05bf7znhygdpfxh2kdagmxwi1xfkis-lldb-13.0.0/bin/lldb: error while loading shared libraries: libicuuc.so.71: cannot open shared object file: No such file or directory</span>\n</code></pre></div>",
        "id": 285713867,
        "sender_full_name": "Hashi364",
        "timestamp": 1654885027
    },
    {
        "content": "<p>I think this is still a nix problem</p>",
        "id": 285713941,
        "sender_full_name": "Folkert de Vries",
        "timestamp": 1654885071
    },
    {
        "content": "<p>at least, I'm guessing just <code>lldb</code> would give the same thing?</p>",
        "id": 285714014,
        "sender_full_name": "Folkert de Vries",
        "timestamp": 1654885095
    },
    {
        "content": "<p>Yes, both <code>lldb</code> and <code>lldb cargo -- check -vv</code> say the same thing</p>",
        "id": 285717858,
        "sender_full_name": "Hashi364",
        "timestamp": 1654887069
    },
    {
        "content": "<p>From what I could find there appears to be something wrong with your archlinux mirror, to fix this:</p>\n<ul>\n<li>generate a new mirror list <a href=\"https://archlinux.org/mirrorlist/\">here</a></li>\n<li>back up the <code>/etc/pacman.d/mirrorlist</code> file</li>\n<li>delete the old mirrorlist in  <code>/etc/pacman.d/mirrorlist</code>and paste the new generated one</li>\n<li>run <code>pacman -Syu</code></li>\n</ul>\n<p>And then try lldb again in the roc dir:</p>\n<ul>\n<li><code>nix develop</code></li>\n<li><code>lldb cargo -- check -vv</code></li>\n</ul>",
        "id": 285768015,
        "sender_full_name": "Anton",
        "timestamp": 1654936901
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"361169\">@Anton</span> I did it, same error</p>",
        "id": 285843328,
        "sender_full_name": "Hashi364",
        "timestamp": 1655041294
    },
    {
        "content": "<p>Thanks for sticking with us @Hashi364, I'll try to test it on ArchLinux today or tomorrow.</p>",
        "id": 285897047,
        "sender_full_name": "Anton",
        "timestamp": 1655109608
    },
    {
        "content": "<p>Ok, don't feel rushed</p>",
        "id": 285962057,
        "sender_full_name": "Hashi364",
        "timestamp": 1655140865
    },
    {
        "content": "<p>I couldn't get lldb to work but;</p>\n<ol>\n<li>in flake.nix you can replace <code>llvmPkgs.lldb</code> with <code>gdb</code></li>\n<li>run <code>nix develop</code></li>\n<li>execute <code>gdb target/debug/build/roc_load-152347a29c7becb0/build-script-build</code></li>\n<li>step through the program until the failure</li>\n</ol>\n<p>I think that should reveal the instruction at which the program fails which may be an instruction your CPU does not support.</p>",
        "id": 286069204,
        "sender_full_name": "Anton",
        "timestamp": 1655212388
    },
    {
        "content": "<p>I \"full\" run:</p>\n<div class=\"codehilite\" data-code-language=\"Bash Session\"><pre><span></span><code><span class=\"gp gp-VirtualEnv\">(gdb)</span> <span class=\"go\">run</span>\n<span class=\"go\">Starting program: /home/shikiyo/selfinstalled/roc/target/debug/build/roc_load-152347a29c7becb0/build-script-build</span>\n<span class=\"go\">[Thread debugging using libthread_db enabled]</span>\n<span class=\"go\">Using host libthread_db library \"/nix/store/rir9pf0kz1mb84x5bd3yr0fx415yy423-glibc-2.33-123/lib/libthread_db.so.1\".</span>\n<span class=\"go\">cargo:rerun-if-changed=../builtins/roc/Bool.roc</span>\n<span class=\"go\">[New Thread 0x7ffff7ac1640 (LWP 6690)]</span>\n<span class=\"go\">[New Thread 0x7ffff72bd640 (LWP 6691)]</span>\n<span class=\"go\">[New Thread 0x7ffff6ab9640 (LWP 6692)]</span>\n<span class=\"go\">[Thread 0x7ffff72bd640 (LWP 6691) exited]</span>\n<span class=\"go\">[Thread 0x7ffff6ab9640 (LWP 6692) exited]</span>\n<span class=\"go\">[Thread 0x7ffff7ac1640 (LWP 6690) exited]</span>\n<span class=\"go\">thread 'main' panicked at 'called Result::unwrap() on an Err value: NotPresent', compiler/load/build.rs:50:66</span>\n<span class=\"go\">note: run with RUST_BACKTRACE=1 environment variable to display a backtrace</span>\n<span class=\"go\">[Inferior 1 (process 6686) exited with code 0145]</span>\n</code></pre></div>\n<p>A \"stepped run\":</p>\n<div class=\"codehilite\" data-code-language=\"Bash Session\"><pre><span></span><code><span class=\"gp gp-VirtualEnv\">(gdb)</span> <span class=\"go\">break main</span>\n<span class=\"go\">Breakpoint 1 at 0x555555646d64: main. (2 locations)</span>\n<span class=\"gp gp-VirtualEnv\">(gdb)</span> <span class=\"go\">run</span>\n<span class=\"go\">Starting program: /home/shikiyo/selfinstalled/roc/target/debug/build/roc_load-152347a29c7becb0/build-script-build</span>\n<span class=\"go\">[Thread debugging using libthread_db enabled]</span>\n<span class=\"go\">Using host libthread_db library \"/nix/store/rir9pf0kz1mb84x5bd3yr0fx415yy423-glibc-2.33-123/lib/libthread_db.so.1\".</span>\n\n<span class=\"go\">Breakpoint 1, 0x0000555555647a50 in main ()</span>\n<span class=\"gp gp-VirtualEnv\">(gdb)</span> <span class=\"go\">n</span>\n<span class=\"go\">Single stepping until exit from function main,</span>\n<span class=\"go\">which has no line number information.</span>\n\n<span class=\"go\">Breakpoint 1, build_script_build::main () at compiler/load/build.rs:21</span>\n<span class=\"go\">21      for (module_id, filename) in MODULES {</span>\n<span class=\"gp gp-VirtualEnv\">(gdb)</span> <span class=\"go\">n</span>\n<span class=\"go\">22          write_subs_for_module(*module_id, filename);</span>\n<span class=\"gp gp-VirtualEnv\">(gdb)</span> <span class=\"go\">n</span>\n<span class=\"go\">cargo:rerun-if-changed=../builtins/roc/Bool.roc</span>\n<span class=\"go\">[New Thread 0x7ffff7ac1640 (LWP 7234)]</span>\n<span class=\"go\">[New Thread 0x7ffff72bd640 (LWP 7235)]</span>\n<span class=\"go\">[New Thread 0x7ffff6ab9640 (LWP 7236)]</span>\n<span class=\"go\">[Thread 0x7ffff6ab9640 (LWP 7236) exited]</span>\n<span class=\"go\">[Thread 0x7ffff7ac1640 (LWP 7234) exited]</span>\n<span class=\"go\">[Thread 0x7ffff72bd640 (LWP 7235) exited]</span>\n<span class=\"go\">thread 'main' panicked at 'called Result::unwrap() on an Err value: NotPresent', compiler/load/build.rs:50:66</span>\n<span class=\"go\">note: run with RUST_BACKTRACE=1 environment variable to display a backtrace</span>\n<span class=\"go\">[Inferior 1 (process 7211) exited with code 0145]</span>\n</code></pre></div>",
        "id": 286153970,
        "sender_full_name": "Hashi364",
        "timestamp": 1655256553
    },
    {
        "content": "<p>Breaking on <code>write_subs_for_module</code>:</p>\n<div class=\"codehilite\" data-code-language=\"Bash Session\"><pre><span></span><code><span class=\"gp gp-VirtualEnv\">(gdb)</span> <span class=\"go\">b write_subs_for_module</span>\n<span class=\"go\">Breakpoint 1 at 0xf2e15: file compiler/load/build.rs, line 28.</span>\n<span class=\"gp gp-VirtualEnv\">(gdb)</span> <span class=\"go\">run</span>\n<span class=\"go\">Starting program: /home/shikiyo/selfinstalled/roc/target/debug/build/roc_load-152347a29c7becb0/build-script-build</span>\n<span class=\"go\">[Thread debugging using libthread_db enabled]</span>\n<span class=\"go\">Using host libthread_db library \"/nix/store/rir9pf0kz1mb84x5bd3yr0fx415yy423-glibc-2.33-123/lib/libthread_db.so.1\".</span>\n\n<span class=\"go\">Breakpoint 1, build_script_build::write_subs_for_module (module_id=..., filename=...) at compiler/load/build.rs:28</span>\n<span class=\"go\">28      println!(\"cargo:rerun-if-changed=../builtins/roc/{}\", filename);</span>\n<span class=\"gp gp-VirtualEnv\">(gdb)</span> <span class=\"go\">n</span>\n<span class=\"go\">cargo:rerun-if-changed=../builtins/roc/Bool.roc</span>\n<span class=\"go\">30      let arena = Bump::new();</span>\n<span class=\"gp gp-VirtualEnv\">(gdb)</span>\n<span class=\"go\">31      let src_dir = PathBuf::from(\".\");</span>\n<span class=\"gp gp-VirtualEnv\">(gdb)</span>\n<span class=\"go\">32      let source = roc_builtins::roc::module_source(module_id);</span>\n<span class=\"gp gp-VirtualEnv\">(gdb)</span>\n<span class=\"go\">32      let source = roc_builtins::roc::module_source(module_id);</span>\n<span class=\"gp gp-VirtualEnv\">(gdb)</span>\n<span class=\"go\">33      let target_info = roc_target::TargetInfo::default_x86_64();</span>\n<span class=\"gp gp-VirtualEnv\">(gdb)</span>\n<span class=\"go\">33      let target_info = roc_target::TargetInfo::default_x86_64();</span>\n<span class=\"gp gp-VirtualEnv\">(gdb)</span>\n<span class=\"go\">37          PathBuf::from(filename),</span>\n<span class=\"gp gp-VirtualEnv\">(gdb)</span>\n<span class=\"go\">39          &amp;src_dir,</span>\n<span class=\"gp gp-VirtualEnv\">(gdb)</span>\n<span class=\"go\">40          Default::default(),</span>\n<span class=\"gp gp-VirtualEnv\">(gdb)</span>\n<span class=\"go\">42          roc_reporting::report::RenderTarget::ColorTerminal,</span>\n<span class=\"gp gp-VirtualEnv\">(gdb)</span>\n<span class=\"go\">43          Threading::AllAvailable,</span>\n<span class=\"gp gp-VirtualEnv\">(gdb)</span>\n<span class=\"go\">35      let res_module = roc_load_internal::file::load_and_typecheck_str(</span>\n<span class=\"gp gp-VirtualEnv\">(gdb)</span>\n<span class=\"go\">[New Thread 0x7ffff7ac1640 (LWP 9490)]</span>\n<span class=\"go\">[New Thread 0x7ffff72bd640 (LWP 9491)]</span>\n<span class=\"go\">[New Thread 0x7ffff6ab9640 (LWP 9492)]</span>\n<span class=\"go\">[Thread 0x7ffff72bd640 (LWP 9491) exited]</span>\n<span class=\"go\">[Thread 0x7ffff7ac1640 (LWP 9490) exited]</span>\n<span class=\"go\">[Thread 0x7ffff6ab9640 (LWP 9492) exited]</span>\n<span class=\"go\">44      );</span>\n<span class=\"gp gp-VirtualEnv\">(gdb)</span>\n<span class=\"go\">46      let module = res_module.unwrap();</span>\n<span class=\"gp gp-VirtualEnv\">(gdb)</span>\n<span class=\"go\">47      let subs = module.solved.inner();</span>\n<span class=\"gp gp-VirtualEnv\">(gdb)</span>\n<span class=\"go\">48      let exposed_vars_by_symbol: Vec&lt;_&gt; = module.exposed_to_host.into_iter().collect();</span>\n<span class=\"gp gp-VirtualEnv\">(gdb)</span>\n<span class=\"go\">48      let exposed_vars_by_symbol: Vec&lt;_&gt; = module.exposed_to_host.into_iter().collect();</span>\n<span class=\"gp gp-VirtualEnv\">(gdb)</span>\n<span class=\"go\">50      let mut output_path = PathBuf::from(std::env::var(\"OUT_DIR\").unwrap());</span>\n<span class=\"gp gp-VirtualEnv\">(gdb)</span>\n<span class=\"go\">thread 'main' panicked at 'called Result::unwrap() on an Err value: NotPresent', compiler/load/build.rs:50:66</span>\n<span class=\"go\">note: run with RUST_BACKTRACE=1 environment variable to display a backtrace</span>\n<span class=\"go\">[Inferior 1 (process 9458) exited with code 0145]</span>\n</code></pre></div>",
        "id": 286154506,
        "sender_full_name": "Hashi364",
        "timestamp": 1655257114
    },
    {
        "content": "<p>Looks like I don't have a <code>OUT_DIR</code> system variable</p>",
        "id": 286154517,
        "sender_full_name": "Hashi364",
        "timestamp": 1655257144
    },
    {
        "content": "<p>I made a dir <code>mkdir build</code> and ran <code>OUT_DIR=build gdb target/debug/build/roc_load-152347a29c7becb0/build-script-build</code><br>\n(I may have pressed &lt;Enter&gt; too fast at the and):</p>\n<div class=\"codehilite\" data-code-language=\"Bash Session\"><pre><span></span><code><span class=\"gp gp-VirtualEnv\">(gdb)</span> <span class=\"go\">b write_subs_for_module</span>\n<span class=\"go\">Breakpoint 1 at 0xf2e15: file compiler/load/build.rs, line 28.</span>\n<span class=\"gp gp-VirtualEnv\">(gdb)</span> <span class=\"go\">run</span>\n<span class=\"go\">Starting program: /home/shikiyo/selfinstalled/roc/target/debug/build/roc_load-152347a29c7becb0/build-script-build</span>\n<span class=\"go\">[Thread debugging using libthread_db enabled]</span>\n<span class=\"go\">Using host libthread_db library \"/nix/store/rir9pf0kz1mb84x5bd3yr0fx415yy423-glibc-2.33-123/lib/libthread_db.so.1\".</span>\n<span class=\"go\">n</span>\n<span class=\"go\">Breakpoint 1, build_script_build::write_subs_for_module (module_id=..., filename=...) at compiler/load/build.rs:28</span>\n<span class=\"go\">28      println!(\"cargo:rerun-if-changed=../builtins/roc/{}\", filename);</span>\n<span class=\"gp gp-VirtualEnv\">(gdb)</span> <span class=\"go\">n</span>\n<span class=\"go\">cargo:rerun-if-changed=../builtins/roc/Bool.roc</span>\n<span class=\"go\">30      let arena = Bump::new();</span>\n<span class=\"gp gp-VirtualEnv\">(gdb)</span> <span class=\"go\">n</span>\n<span class=\"go\">31      let src_dir = PathBuf::from(\".\");</span>\n<span class=\"gp gp-VirtualEnv\">(gdb)</span>\n<span class=\"go\">32      let source = roc_builtins::roc::module_source(module_id);</span>\n<span class=\"gp gp-VirtualEnv\">(gdb)</span>\n<span class=\"go\">32      let source = roc_builtins::roc::module_source(module_id);</span>\n<span class=\"gp gp-VirtualEnv\">(gdb)</span>\n<span class=\"go\">33      let target_info = roc_target::TargetInfo::default_x86_64();</span>\n<span class=\"gp gp-VirtualEnv\">(gdb)</span>\n<span class=\"go\">33      let target_info = roc_target::TargetInfo::default_x86_64();</span>\n<span class=\"gp gp-VirtualEnv\">(gdb)</span>\n<span class=\"go\">37          PathBuf::from(filename),</span>\n<span class=\"gp gp-VirtualEnv\">(gdb)</span>\n<span class=\"go\">39          &amp;src_dir,</span>\n<span class=\"gp gp-VirtualEnv\">(gdb)</span>\n<span class=\"go\">40          Default::default(),</span>\n<span class=\"gp gp-VirtualEnv\">(gdb)</span>\n<span class=\"go\">42          roc_reporting::report::RenderTarget::ColorTerminal,</span>\n<span class=\"gp gp-VirtualEnv\">(gdb)</span>\n<span class=\"go\">43          Threading::AllAvailable,</span>\n<span class=\"gp gp-VirtualEnv\">(gdb)</span>\n<span class=\"go\">35      let res_module = roc_load_internal::file::load_and_typecheck_str(</span>\n<span class=\"gp gp-VirtualEnv\">(gdb)</span>\n<span class=\"go\">[New Thread 0x7ffff7ac1640 (LWP 10878)]</span>\n<span class=\"go\">[New Thread 0x7ffff72c0640 (LWP 10879)]</span>\n<span class=\"go\">[New Thread 0x7ffff6ab9640 (LWP 10880)]</span>\n<span class=\"go\">[Thread 0x7ffff6ab9640 (LWP 10880) exited]</span>\n<span class=\"go\">[Thread 0x7ffff72c0640 (LWP 10879) exited]</span>\n<span class=\"go\">[Thread 0x7ffff7ac1640 (LWP 10878) exited]</span>\n<span class=\"go\">44      );</span>\n<span class=\"gp gp-VirtualEnv\">(gdb)</span>\n<span class=\"go\">46      let module = res_module.unwrap();</span>\n<span class=\"gp gp-VirtualEnv\">(gdb)</span>\n<span class=\"go\">47      let subs = module.solved.inner();</span>\n<span class=\"gp gp-VirtualEnv\">(gdb)</span>\n<span class=\"go\">48      let exposed_vars_by_symbol: Vec&lt;_&gt; = module.exposed_to_host.into_iter().collect();</span>\n<span class=\"gp gp-VirtualEnv\">(gdb)</span>\n<span class=\"go\">48      let exposed_vars_by_symbol: Vec&lt;_&gt; = module.exposed_to_host.into_iter().collect();</span>\n<span class=\"gp gp-VirtualEnv\">(gdb)</span>\n<span class=\"go\">50      let mut output_path = PathBuf::from(std::env::var(\"OUT_DIR\").unwrap());</span>\n<span class=\"gp gp-VirtualEnv\">(gdb)</span>\n<span class=\"go\">50      let mut output_path = PathBuf::from(std::env::var(\"OUT_DIR\").unwrap());</span>\n<span class=\"gp gp-VirtualEnv\">(gdb)</span>\n<span class=\"go\">51      output_path.extend(&amp;[filename]);</span>\n<span class=\"gp gp-VirtualEnv\">(gdb)</span>\n<span class=\"go\">52      output_path.set_extension(\"dat\");</span>\n<span class=\"gp gp-VirtualEnv\">(gdb)</span>\n<span class=\"go\">53      let mut file = std::fs::File::create(&amp;output_path).unwrap();</span>\n<span class=\"gp gp-VirtualEnv\">(gdb)</span>\n<span class=\"go\">54      subs.serialize(&amp;exposed_vars_by_symbol, &amp;mut file).unwrap();</span>\n<span class=\"gp gp-VirtualEnv\">(gdb)</span>\n<span class=\"go\">54      subs.serialize(&amp;exposed_vars_by_symbol, &amp;mut file).unwrap();</span>\n<span class=\"gp gp-VirtualEnv\">(gdb)</span>\n<span class=\"go\">55  }</span>\n<span class=\"gp gp-VirtualEnv\">(gdb)</span>\n<span class=\"go\">build_script_build::main () at compiler/load/build.rs:21</span>\n<span class=\"go\">21      for (module_id, filename) in MODULES {</span>\n<span class=\"gp gp-VirtualEnv\">(gdb)</span>\n<span class=\"go\">22          write_subs_for_module(*module_id, filename);</span>\n<span class=\"gp gp-VirtualEnv\">(gdb)</span>\n\n<span class=\"go\">Thread 1 \"build-script-bu\" hit Breakpoint 1, build_script_build::write_subs_for_module (module_id=..., filename=...) at compiler/load/build.rs:28</span>\n<span class=\"go\">28      println!(\"cargo:rerun-if-changed=../builtins/roc/{}\", filename);</span>\n<span class=\"gp gp-VirtualEnv\">(gdb)</span>\n<span class=\"go\">cargo:rerun-if-changed=../builtins/roc/Result.roc</span>\n<span class=\"go\">30      let arena = Bump::new();</span>\n<span class=\"gp gp-VirtualEnv\">(gdb)</span>\n<span class=\"go\">31      let src_dir = PathBuf::from(\".\");</span>\n<span class=\"gp gp-VirtualEnv\">(gdb)</span>\n<span class=\"go\">32      let source = roc_builtins::roc::module_source(module_id);</span>\n<span class=\"gp gp-VirtualEnv\">(gdb)</span>\n<span class=\"go\">32      let source = roc_builtins::roc::module_source(module_id);</span>\n<span class=\"gp gp-VirtualEnv\">(gdb)</span>\n<span class=\"go\">33      let target_info = roc_target::TargetInfo::default_x86_64();</span>\n<span class=\"gp gp-VirtualEnv\">(gdb)</span>\n<span class=\"go\">33      let target_info = roc_target::TargetInfo::default_x86_64();</span>\n<span class=\"gp gp-VirtualEnv\">(gdb)</span>\n<span class=\"go\">37          PathBuf::from(filename),</span>\n<span class=\"gp gp-VirtualEnv\">(gdb)</span>\n<span class=\"go\">39          &amp;src_dir,</span>\n<span class=\"gp gp-VirtualEnv\">(gdb)</span>\n<span class=\"go\">40          Default::default(),</span>\n<span class=\"gp gp-VirtualEnv\">(gdb)</span>\n<span class=\"go\">42          roc_reporting::report::RenderTarget::ColorTerminal,</span>\n<span class=\"gp gp-VirtualEnv\">(gdb)</span>\n<span class=\"go\">43          Threading::AllAvailable,</span>\n<span class=\"gp gp-VirtualEnv\">(gdb)</span>\n<span class=\"go\">35      let res_module = roc_load_internal::file::load_and_typecheck_str(</span>\n<span class=\"gp gp-VirtualEnv\">(gdb)</span>\n<span class=\"go\">[New Thread 0x7ffff6ab9640 (LWP 10977)]</span>\n<span class=\"go\">[New Thread 0x7ffff72c0640 (LWP 10978)]</span>\n<span class=\"go\">[New Thread 0x7ffff7ac1640 (LWP 10979)]</span>\n\n<span class=\"go\">Thread 5 \"build-script-bu\" received signal SIGILL, Illegal instruction.</span>\n<span class=\"go\">[Switching to Thread 0x7ffff6ab9640 (LWP 10977)]</span>\n<span class=\"go\">core::core_arch::x86::avx::_mm256_setr_epi16 (e00=7, e01=7, e02=7, e03=7, e04=7, e05=7, e06=7, e07=7, e08=7, e09=7, e10=7, e11=7, e12=7, e13=7, e14=7, e15=7) at /rustc/7737e0b5c4103216d6fd8cf941b7ab9bdbaace7c/library/core/src/../../stdarch/crates/core_arch/src/x86/avx.rs:2368</span>\n<span class=\"go\">2368  /rustc/7737e0b5c4103216d6fd8cf941b7ab9bdbaace7c/library/core/src/../../stdarch/crates/core_arch/src/x86/avx.rs: No such file or directory.</span>\n<span class=\"gp gp-VirtualEnv\">(gdb)</span>\n<span class=\"go\">Couldn't get registers: No such process.</span>\n<span class=\"go\">Couldn't get registers: No such process.</span>\n<span class=\"gp gp-VirtualEnv\">(gdb)</span>\n<span class=\"go\">Couldn't get registers: No such process.</span>\n<span class=\"go\">Couldn't get registers: No such process.</span>\n<span class=\"gp gp-VirtualEnv\">(gdb)</span> <span class=\"go\">[Thread 0x7ffff72c0640 (LWP 10978) exited]</span>\n<span class=\"go\">[Thread 0x7ffff6ab9640 (LWP 10977) exited]</span>\n<span class=\"go\">[Thread 0x7ffff7c6a880 (LWP 10842) exited]</span>\n\n<span class=\"go\">Couldn't get registers: No such process.</span>\n<span class=\"go\">Couldn't get registers: No such process.</span>\n<span class=\"gp gp-VirtualEnv\">(gdb)</span>\n</code></pre></div>",
        "id": 286154953,
        "sender_full_name": "Hashi364",
        "timestamp": 1655257600
    },
    {
        "content": "<p>Try to save the reading, looks like this is important:</p>\n<div class=\"codehilite\"><pre><span></span><code>core::core_arch::x86::avx::_mm256_setr_epi16 (e00=7, e01=7, e02=7, e03=7, e04=7, e05=7, e06=7, e07=7, e08=7, e09=7, e10=7, e11=7, e12=7, e13=7, e14=7, e15=7) at /rustc/7737e0b5c4103216d6fd8cf941b7ab9bdbaace7c/library/core/src/../../stdarch/crates/core_arch/src/x86/avx.rs:2368\n2368  /rustc/7737e0b5c4103216d6fd8cf941b7ab9bdbaace7c/library/core/src/../../stdarch/crates/core_arch/src/x86/avx.rs: No such file or directory.\n</code></pre></div>",
        "id": 286155022,
        "sender_full_name": "Hashi364",
        "timestamp": 1655257701
    },
    {
        "content": "<p>Looks like it's trying to use avx instructions, which your CPU doesn't support. Now we have to figure out what rust code is generating that instruction.</p>",
        "id": 286181589,
        "sender_full_name": "Anton",
        "timestamp": 1655282488
    },
    {
        "content": "<p>Looking at the disassembly of my <code>roc_load-152347a29c7becb0/build-script-build</code>:<br>\n<code>callq  eb0cf0 &lt;_ZN4core9core_arch3x863avx17_mm256_set1_epi1617h486812b7e971ca88E&gt;</code> is called inside <code>roc_collections21small_string_interner21find_i16_slice_x86</code></p>",
        "id": 286182899,
        "sender_full_name": "Anton",
        "timestamp": 1655283322
    },
    {
        "content": "<p>bingo :)<br>\nIn <code>compiler/collections/src/small_string_interner.rs</code> in the function <code>find_i16_slice_x86_64</code>, we explicitly call <code>_mm256_set1_epi16</code>:</p>\n<div class=\"codehilite\"><pre><span></span><code>let keys = unsafe { _mm256_set1_epi16(key) };\n</code></pre></div>\n<p>And from the definition we can see that it is an avx instruction:</p>\n<div class=\"codehilite\"><pre><span></span><code>/// [Intel&#39;s documentation](https://software.intel.com/sites/landingpage/IntrinsicsGuide/#text=_mm256_set1_epi16)\n#[inline]\n#[target_feature(enable = &quot;avx&quot;)]\n//#[cfg_attr(test, assert_instr(vpshufb))]\n#[cfg_attr(test, assert_instr(vinsertf128))]\n// This intrinsic has no corresponding instruction.\n#[stable(feature = &quot;simd_x86&quot;, since = &quot;1.27.0&quot;)]\npub unsafe fn _mm256_set1_epi16(a: i16) -&gt; __m256i {\n    _mm256_setr_epi16(a, a, a, a, a, a, a, a, a, a, a, a, a, a, a, a)\n}\n</code></pre></div>",
        "id": 286183596,
        "sender_full_name": "Anton",
        "timestamp": 1655283714
    },
    {
        "content": "<p>Rust std has <code>is_x86_feature_detected!(\"avx\")</code> so we can change <code>#[cfg(target_arch = \"x86_64\")]</code> to also check that.<br>\nShould I apply the fix like that <span class=\"user-mention\" data-user-id=\"281543\">@Folkert de Vries</span>?</p>",
        "id": 286184127,
        "sender_full_name": "Anton",
        "timestamp": 1655284008
    },
    {
        "content": "<p>I ended up using <code>target-feature</code> instead. The fix is on the <code>illegal_instruction_PENTIUM_N3700</code> branch. Can you give it a try <span class=\"user-mention\" data-user-id=\"506120\">@Hashi364</span> (<code>nix develop</code> followed by <code>cargo build</code>)?</p>",
        "id": 286193773,
        "sender_full_name": "Anton",
        "timestamp": 1655289323
    },
    {
        "content": "<p><code>git switch illegal_instruction_PENTIUM_N3700</code>,  <code>nix develop</code>, <code>cargo build</code>:</p>\n<div class=\"codehilite\" data-code-language=\"Bash Session\"><pre><span></span><code><span class=\"go\">Compiling cfg-if v1.0.0</span>\n<span class=\"go\">   Compiling libc v0.2.125</span>\n<span class=\"go\">   Compiling proc-macro2 v1.0.38</span>\n<span class=\"go\">   Compiling unicode-xid v0.2.3</span>\n<span class=\"go\">error: unknown codegen option:  target-cpu</span>\n\n<span class=\"go\">error: could not compile cfg-if due to previous error</span>\n<span class=\"go\">warning: build failed, waiting for other jobs to finish...</span>\n<span class=\"go\">error: build failed</span>\n</code></pre></div>",
        "id": 286292984,
        "sender_full_name": "Hashi364",
        "timestamp": 1655339600
    },
    {
        "content": "<p>With <code>cargo build -vv</code> part 1</p>\n<div class=\"codehilite\" data-code-language=\"Bash Session\"><pre><span></span><code><span class=\"go\">Compiling cfg-if v1.0.0</span>\n<span class=\"go\">   Compiling libc v0.2.125</span>\n<span class=\"go\">   Compiling proc-macro2 v1.0.38</span>\n<span class=\"go\">   Compiling unicode-xid v0.2.3</span>\n<span class=\"go\">     Running `CARGO=/nix/store/mzckrnrszs2f1hrssb4cdqisjrrh87il-cargo-1.60.0-x86_64-unknown-linux-gnu/bin/cargo CARGO_CRATE_NAME=cfg_if CARGO_MANIFEST_DIR=/home/shikiyo/.cargo/registry/src/github.com-1ecc6299db9ec823/cfg-if-1.0.0 CARGO_PKG_AUTHORS='Alex Crichton &lt;alex@alexcrichton.com&gt;' CARGO_PKG_DESCRIPTION='A macro to ergonomically define an item depending on a large number of #[cfg]</span>\n<span class=\"go\">parameters. Structured like an if-else chain, the first matching branch is the</span>\n<span class=\"go\">item that gets emitted.</span>\n<span class=\"go\">' CARGO_PKG_HOMEPAGE='https://github.com/alexcrichton/cfg-if' CARGO_PKG_LICENSE=MIT/Apache-2.0 CARGO_PKG_LICENSE_FILE='' CARGO_PKG_NAME=cfg-if CARGO_PKG_REPOSITORY='https://github.com/alexcrichton/cfg-if' CARGO_PKG_VERSION=1.0.0 CARGO_PKG_VERSION_MAJOR=1 CARGO_PKG_VERSION_MINOR=0 CARGO_PKG_VERSION_PATCH=0 CARGO_PKG_VERSION_PRE='' LD_LIBRARY_PATH='/home/shikiyo/selfinstalled/roc/target/debug/deps:/nix/store/j3wy0pj7xcxdmj2sjlwsm825hynrbrmg-rust-default-1.60.0/lib:/nix/store/nk9n0g0gk856nnzcik0q7dwpqq49qjzz-pkg-config-wrapper-0.29.2/lib:/nix/store/lbccj93nnf77zxg3m9gmral5avbp64z2-gcc-10.3.0-lib/lib:/nix/store/5vqz6vp6cwlr94684583zzpwz5mvn9af-libffi-3.4.2/lib:/nix/store/9s8s7snpms482zm3z68aq91d184ynqma-ncurses-6.2/lib:/nix/store/p7syn79gwkjxcpqw2w79jw0qdlxr8s26-zlib-1.2.11/lib:/nix/store/9zb5qxnixld6bdvcp5isphi4qwscf6b7-valgrind-3.18.1/lib:/nix/store/xn34bjf4p7c4gcgxfsi8x09ikcsk55yh-vulkan-headers-1.2.189.1/lib:/nix/store/fjk8k473smpgxsqcs9lkdwayznlg6zgk-vulkan-loader-1.2.189.1/lib:/nix/store/qf6za190wgnq6i0k4yl75x84qcjlx05n-vulkan-tools-1.2.189.1/lib:/nix/store/qvifqgyfmq990sbgqn0blc6jx7429ypz-vulkan-validation-layers-1.2.189.1/lib:/nix/store/0pp8dys4m0j3d4idqjwzpk7xyapm0v8v-libX11-1.7.2/lib:/nix/store/bgilik8910381jk9vjmkkzmks00k271l-libXcursor-1.2.0/lib:/nix/store/n89p0dfm498v4zk1lv7pjrrfxqg26sqy-libXrandr-1.5.2/lib:/nix/store/17npsrav57vc90sn4034y51l0pndr1s5-libXi-1.8/lib:/nix/store/hc32k2zvhxmjg6280vs30kbqzgnfiwfd-libxcb-1.14/lib:/nix/store/ghj9i9xcadkrzlsfi1zr39pxwhgsqgrh-alsa-lib-1.2.5.1/lib' ROC_DEBUG_ALIAS_ANALYSIS=0 ROC_PRETTY_PRINT_ALIAS_CONTENTS=0 ROC_PRINT_IR_AFTER_REFCOUNT=0 ROC_PRINT_IR_AFTER_RESET_REUSE=0 ROC_PRINT_IR_AFTER_SPECIALIZATION=0 ROC_PRINT_LLVM_FN_VERIFICATION=0 ROC_PRINT_LOAD_LOG=0 ROC_PRINT_MISMATCHES=0 ROC_PRINT_UNIFICATIONS=0 ROC_VERIFY_RIGID_LET_GENERALIZED=0 ROC_WORKSPACE_DIR=/home/shikiyo/selfinstalled/roc/ rustc --crate-name cfg_if --edition=2018 /home/shikiyo/.cargo/registry/src/github.com-1ecc6299db9ec823/cfg-if-1.0.0/src/lib.rs --error-format=json --json=diagnostic-rendered-ansi,artifacts,future-incompat --crate-type lib --emit=dep-info,metadata,link -C embed-bitcode=no -C debuginfo=2 -C metadata=56df745b5175507b -C extra-filename=-56df745b5175507b --out-dir /home/shikiyo/selfinstalled/roc/target/debug/deps -L dependency=/home/shikiyo/selfinstalled/roc/target/debug/deps --cap-lints warn '-C target-cpu=native'`</span>\n<span class=\"go\">     Running `CARGO=/nix/store/mzckrnrszs2f1hrssb4cdqisjrrh87il-cargo-1.60.0-x86_64-unknown-linux-gnu/bin/cargo CARGO_CRATE_NAME=build_script_build CARGO_MANIFEST_DIR=/home/shikiyo/.cargo/registry/src/github.com-1ecc6299db9ec823/libc-0.2.125 CARGO_PKG_AUTHORS='The Rust Project Developers' CARGO_PKG_DESCRIPTION='Raw FFI bindings to platform libraries like libc.</span>\n<span class=\"go\">GitHub</span>\n</code></pre></div>",
        "id": 286293354,
        "sender_full_name": "Hashi364",
        "timestamp": 1655339961
    },
    {
        "content": "<p>Part 2:</p>\n<div class=\"codehilite\" data-code-language=\"Bash Session\"><pre><span></span><code><span class=\"go\">GitHub - alexcrichton/cfg-if: A if/elif-like macro for Rust #[cfg] statements</span>\n\n<span class=\"go\">A if/elif-like macro for Rust #[cfg] statements. Contribute to alexcrichton/cfg-if development by creating an account on GitHub.</span>\n\n<span class=\"go\">' CARGO_PKG_HOMEPAGE='https://github.com/rust-lang/libc' CARGO_PKG_LICENSE='MIT OR Apache-2.0' CARGO_PKG_LICENSE_FILE='' CARGO_PKG_NAME=libc CARGO_PKG_REPOSITORY='https://github.com/rust-lang/libc' CARGO_PKG_VERSION=0.2.125 CARGO_PKG_VERSION_MAJOR=0 CARGO_PKG_VERSION_MINOR=2 CARGO_PKG_VERSION_PATCH=125 CARGO_PKG_VERSION_PRE='' LD_LIBRARY_PATH='/home/shikiyo/selfinstalled/roc/target/debug/deps:/nix/store/j3wy0pj7xcxdmj2sjlwsm825hynrbrmg-rust-default-1.60.0/lib:/nix/store/nk9n0g0gk856nnzcik0q7dwpqq49qjzz-pkg-config-wrapper-0.29.2/lib:/nix/store/lbccj93nnf77zxg3m9gmral5avbp64z2-gcc-10.3.0-lib/lib:/nix/store/5vqz6vp6cwlr94684583zzpwz5mvn9af-libffi-3.4.2/lib:/nix/store/9s8s7snpms482zm3z68aq91d184ynqma-ncurses-6.2/lib:/nix/store/p7syn79gwkjxcpqw2w79jw0qdlxr8s26-zlib-1.2.11/lib:/nix/store/9zb5qxnixld6bdvcp5isphi4qwscf6b7-valgrind-3.18.1/lib:/nix/store/xn34bjf4p7c4gcgxfsi8x09ikcsk55yh-vulkan-headers-1.2.189.1/lib:/nix/store/fjk8k473smpgxsqcs9lkdwayznlg6zgk-vulkan-loader-1.2.189.1/lib:/nix/store/qf6za190wgnq6i0k4yl75x84qcjlx05n-vulkan-tools-1.2.189.1/lib:/nix/store/qvifqgyfmq990sbgqn0blc6jx7429ypz-vulkan-validation-layers-1.2.189.1/lib:/nix/store/0pp8dys4m0j3d4idqjwzpk7xyapm0v8v-libX11-1.7.2/lib:/nix/store/bgilik8910381jk9vjmkkzmks00k271l-libXcursor-1.2.0/lib:/nix/store/n89p0dfm498v4zk1lv7pjrrfxqg26sqy-libXrandr-1.5.2/lib:/nix/store/17npsrav57vc90sn4034y51l0pndr1s5-libXi-1.8/lib:/nix/store/hc32k2zvhxmjg6280vs30kbqzgnfiwfd-libxcb-1.14/lib:/nix/store/ghj9i9xcadkrzlsfi1zr39pxwhgsqgrh-alsa-lib-1.2.5.1/lib' ROC_DEBUG_ALIAS_ANALYSIS=0 ROC_PRETTY_PRINT_ALIAS_CONTENTS=0 ROC_PRINT_IR_AFTER_REFCOUNT=0 ROC_PRINT_IR_AFTER_RESET_REUSE=0 ROC_PRINT_IR_AFTER_SPECIALIZATION=0 ROC_PRINT_LLVM_FN_VERIFICATION=0 ROC_PRINT_LOAD_LOG=0 ROC_PRINT_MISMATCHES=0 ROC_PRINT_UNIFICATIONS=0 ROC_VERIFY_RIGID_LET_GENERALIZED=0 ROC_WORKSPACE_DIR=/home/shikiyo/selfinstalled/roc/ rustc --crate-name build_script_build /home/shikiyo/.cargo/registry/src/github.com-1ecc6299db9ec823/libc-0.2.125/build.rs --error-format=json --json=diagnostic-rendered-ansi,artifacts,future-incompat --crate-type bin --emit=dep-info,link -C embed-bitcode=no -C debuginfo=2 --cfg 'feature=\"default\"' --cfg 'feature=\"extra_traits\"' --cfg 'feature=\"std\"' -C metadata=e60b3e521702b755 -C extra-filename=-e60b3e521702b755 --out-dir /home/shikiyo/selfinstalled/roc/target/debug/build/libc-e60b3e521702b755 -L dependency=/home/shikiyo/selfinstalled/roc/target/debug/deps --cap-lints warn '-C target-cpu=native'`</span>\n<span class=\"go\">     Running CARGO=/nix/store/mzckrnrszs2f1hrssb4cdqisjrrh87il-cargo-1.60.0-x86_64-unknown-linux-gnu/bin/cargo CARGO_CRATE_NAME=build_script_build CARGO_MANIFEST_DIR=/home/shikiyo/.cargo/registry/src/github.com-1ecc6299db9ec823/proc-macro2-1.0.38 CARGO_PKG_AUTHORS='David Tolnay &lt;dtolnay@gmail.com&gt;:Alex Crichton &lt;alex@alexcrichton.com&gt;' CARGO_PKG_DESCRIPTION='A substitute implementation of the compiler'\\''s `proc_macro API to decouple</span>\n<span class=\"go\">token-based libraries from the procedural macro use case.</span>\n<span class=\"go\">GitHub</span>\n\n<span class=\"go\">GitHub - rust-lang/libc: Raw bindings to platform APIs for Rust</span>\n\n<span class=\"go\">Raw bindings to platform APIs for Rust. Contribute to rust-lang/libc development by creating an account on GitHub.</span>\n\n<span class=\"go\">' CARGO_PKG_HOMEPAGE='' CARGO_PKG_LICENSE='MIT OR Apache-2.0' CARGO_PKG_LICENSE_FILE='' CARGO_PKG_NAME=proc-macro2 CARGO_PKG_REPOSITORY='https://github.com/dtolnay/proc-macro2' CARGO_PKG_VERSION=1.0.38 CARGO_PKG_VERSION_MAJOR=1 CARGO_PKG_VERSION_MINOR=0 CARGO_PKG_VERSION_PATCH=38 CARGO_PKG_VERSION_PRE='' LD_LIBRARY_PATH='/home/shikiyo/selfinstalled/roc/target/debug/deps:/nix/store/j3wy0pj7xcxdmj2sjlwsm825hynrbrmg-rust-default-1.60.0/lib:/nix/store/nk9n0g0gk856nnzcik0q7dwpqq49qjzz-pkg-config-wrapper-0.29.2/lib:/nix/store/lbccj93nnf77zxg3m9gmral5avbp64z2-gcc-10.3.0-lib/lib:/nix/store/5vqz6vp6cwlr94684583zzpwz5mvn9af-libffi-3.4.2/lib:/nix/store/9s8s7snpms482zm3z68aq91d184ynqma-ncurses-6.2/lib:/nix/store/p7syn79gwkjxcpqw2w79jw0qdlxr8s26-zlib-1.2.11/lib:/nix/store/9zb5qxnixld6bdvcp5isphi4qwscf6b7-valgrind-3.18.1/lib:/nix/store/xn34bjf4p7c4gcgxfsi8x09ikcsk55yh-vulkan-headers-1.2.189.1/lib:/nix/store/fjk8k473smpgxsqcs9lkdwayznlg6zgk-vulkan-loader-1.2.189.1/lib:/nix/store/qf6za190wgnq6i0k4yl75x84qcjlx05n-vulkan-tools-1.2.189.1/lib:/nix/store/qvifqgyfmq990sbgqn0blc6jx7429ypz-vulkan-validation-layers-1.2.189.1/lib:/nix/store/0pp8dys4m0j3d4idqjwzpk7xyapm0v8v-libX11-1.7.2/lib:/nix/store/bgilik8910381jk9vjmkkzmks00k271l-libXcursor-1.2.0/lib:/nix/store/n89p0dfm498v4zk1lv7pjrrfxqg26sqy-libXrandr-1.5.2/lib:/nix/store/17npsrav57vc90sn4034y51l0pndr1s5-libXi-1.8/lib:/nix/store/hc32k2zvhxmjg6280vs30kbqzgnfiwfd-libxcb-1.14/lib:/nix/store/ghj9i9xcadkrzlsfi1zr39pxwhgsqgrh-alsa-lib-1.2.5.1/lib' ROC_DEBUG_ALIAS_ANALYSIS=0 ROC_PRETTY_PRINT_ALIAS_CONTENTS=0 ROC_PRINT_IR_AFTER_REFCOUNT=0 ROC_PRINT_IR_AFTER_RESET_REUSE=0 ROC_PRINT_IR_AFTER_SPECIALIZATION=0 ROC_PRINT_LLVM_FN_VERIFICATION=0 ROC_PRINT_LOAD_LOG=0 ROC_PRINT_MISMATCHES=0 ROC_PRINT_UNIFICATIONS=0 ROC_VERIFY_RIGID_LET_GENERALIZED=0 ROC_WORKSPACE_DIR=/home/shikiyo/selfinstalled/roc/ rustc --crate-name build_script_build --edition=2018 /home/shikiyo/.cargo/registry/src/github.com-1ecc6299db9ec823/proc-macro2-1.0.38/build.rs --error-format=json --json=diagnostic-rendered-ansi,artifacts,future-incompat --crate-type bin --emit=dep-info,link -C embed-bitcode=no -C debuginfo=2 --cfg 'feature=\"default\"' --cfg 'feature=\"proc-macro\"' -C metadata=8ed3c46b652f6dfc -C extra-filename=-8ed3c46b652f6dfc --out-dir /home/shikiyo/selfinstalled/roc/target/debug/build/proc-macro2-8ed3c46b652f6dfc -L dependency=/home/shikiyo/selfinstalled/roc/target/debug/deps --cap-lints warn '-C target-cpu=native'`</span>\n<span class=\"go\">     Running `CARGO=/nix/store/mzckrnrszs2f1hrssb4cdqisjrrh87il-cargo-1.60.0-x86_64-unknown-linux-gnu/bin/cargo CARGO_CRATE_NAME=unicode_xid CARGO_MANIFEST_DIR=/home/shikiyo/.cargo/registry/src/github.com-1ecc6299db9ec823/unicode-xid-0.2.3 CARGO_PKG_AUTHORS='erick.tryzelaar &lt;erick.tryzelaar@gmail.com&gt;:kwantam &lt;kwantam@gmail.com&gt;:Manish Goregaokar &lt;manishsmail@gmail.com&gt;' CARGO_PKG_DESCRIPTION='Determine whether characters have the XID_Start</span>\n<span class=\"go\">or XID_Continue properties according to</span>\n<span class=\"go\">Unicode Standard Annex #31.</span>\n\n<span class=\"go\">' CARGO_PKG_HOMEPAGE='https://github.com/unicode-rs/unicode-xid' CARGO_PKG_LICENSE='MIT OR Apache-2.0' CARGO_PKG_LICENSE_FILE='' CARGO_PKG_NAME=unicode-xid CARGO_PKG_REPOSITORY='https://github.com/unicode-rs/unicode-xid' CARGO_PKG_VERSION=0.2.3 CARGO_PKG_VERSION_MAJOR=0 CARGO_PKG_VERSION_MINOR=2 CARGO_PKG_VERSION_PATCH=3 CARGO_PKG_VERSION_PRE='' LD_LIBRARY_PATH='/home/shikiyo/selfinstalled/roc/target/debug/deps:/nix/store/j3wy0pj7xcxdmj2sjlwsm825hynrbrmg-rust-default-1.60.0/lib:/nix/store/nk9n0g0gk856nnzcik0q7dwpqq49qjzz-pkg-config-wrapper-0.29.2/lib:/nix/store/lbccj93nnf77zxg3m9gmral5avbp64z2-gcc-10.3.0-lib/lib:/nix/store/5vqz6vp6cwlr94684583zzpwz5mvn9af-libffi-3.4.2/lib:/nix/store/9s8s7snpms482zm3z68aq91d184ynqma-ncurses-6.2/lib:/nix/store/p7syn79gwkjxcpqw2w79jw0qdlxr8s26-zlib-1.2.11/lib:/nix/store/9zb5qxnixld6bdvcp5isphi4qwscf6b7-valgrind-3.18.1/lib:/nix/store/xn34bjf4p7c4gcgxfsi8x09ikcsk55yh-vulkan-headers-1.2.189.1/lib:/nix/store/fjk8k473smpgxsqcs9lkdwayznlg6zgk-vulkan-loader-1.2.189.1/lib:/nix/store/qf6za190wgnq6i0k4yl75x84qcjlx05n-vulkan-tools-1.2.189.1/lib:/nix/store/qvifqgyfmq990sbgqn0blc6jx7429ypz-vulkan-validation-layers-1.2.189.1/lib:/nix/store/0pp8dys4m0j3d4idqjwzpk7xyapm0v8v-libX11-1.7.2/lib:/nix/store/bgilik8910381jk9vjmkkzmks00k271l-libXcursor-1.2.0/lib:/nix/store/n89p0dfm498v4zk1lv7pjrrfxqg26sqy-libXrandr-1.5.2/lib:/nix/store/17npsrav57vc90sn4034y51l0pndr1s5-libXi-1.8/lib:/nix/store/hc32k2zvhxmjg6280vs30kbqzgnfiwfd-libxcb-1.14/lib:/nix/store/ghj9i9xcadkrzlsfi1zr39pxwhgsqgrh-alsa-lib-1.2.5.1/lib' ROC_DEBUG_ALIAS_ANALYSIS=0 ROC_PRETTY_PRINT_ALIAS_CONTENTS=0 ROC_PRINT_IR_AFTER_REFCOUNT=0 ROC_PRINT_IR_AFTER_RESET_REUSE=0 ROC_PRINT_IR_AFTER_SPECIALIZATION=0 ROC_PRINT_LLVM_FN_VERIFICATION=0 ROC_PRINT_LOAD_LOG=0 ROC_PRINT_MISMATCHES=0 ROC_PRINT_UNIFICATIONS=0 ROC_VERIFY_RIGID_LET_GENERALIZED=0 ROC_WORKSPACE_DIR=/home/shikiyo/selfinstalled/roc/ rustc --crate-name unicode_xid /home/shikiyo/.cargo/registry/src/github.com-1ecc6299db9ec823/unicode-xid-0.2.3/src/lib.rs --error-format=json --json=diagnostic-rendered-ansi,artifacts,future-incompat --crate-type lib --emit=dep-info,metadata,link -C embed-bitcode=no -C debuginfo=2 --cfg 'feature=\"default\"' -C metadata=5409942a6294a17e -C extra-filename=-5409942a6294a17e --out-dir /home/shikiyo/selfinstalled/roc/target/debug/deps -L dependency=/home/shikiyo/selfinstalled/roc/target/debug/deps --cap-lints warn '-C target-cpu=native'`</span>\n<span class=\"go\">error: unknown codegen option:  target-cpu</span>\n\n<span class=\"go\">error: could not compile cfg-if due to previous error</span>\n</code></pre></div>",
        "id": 286293448,
        "sender_full_name": "Hashi364",
        "timestamp": 1655340019
    },
    {
        "content": "<p>Part 3:</p>\n<div class=\"codehilite\" data-code-language=\"Bash Session\"><pre><span></span><code><span class=\"go\">Caused by:</span>\n<span class=\"go\">  process didn't exit successfully: `CARGO=/nix/store/mzckrnrszs2f1hrssb4cdqisjrrh87il-cargo-1.60.0-x86_64-unknown-linux-gnu/bin/cargo CARGO_CRATE_NAME=cfg_if CARGO_MANIFEST_DIR=/home/shikiyo/.cargo/registry/src/github.com-1ecc6299db9ec823/cfg-if-1.0.0 CARGO_PKG_AUTHORS='Alex Crichton &lt;alex@alexcrichton.com&gt;' CARGO_PKG_DESCRIPTION='A macro to ergonomically define an item depending on a large number of #[cfg]</span>\n<span class=\"go\">  parameters. Structured like an if-else chain, the first matching branch is the</span>\n<span class=\"go\">  item that gets emitted.</span>\n<span class=\"go\">  ' CARGO_PKG_HOMEPAGE='https://github.com/alexcrichton/cfg-if' CARGO_PKG_LICENSE=MIT/Apache-2.0 CARGO_PKG_LICENSE_FILE='' CARGO_PKG_NAME=cfg-if CARGO_PKG_REPOSITORY='https://github.com/alexcrichton/cfg-if' CARGO_PKG_VERSION=1.0.0 CARGO_PKG_VERSION_MAJOR=1 CARGO_PKG_VERSION_MINOR=0 CARGO_PKG_VERSION_PATCH=0 CARGO_PKG_VERSION_PRE='' LD_LIBRARY_PATH='/home/shikiyo/selfinstalled/roc/target/debug/deps:/nix/store/j3wy0pj7xcxdmj2sjlwsm825hynrbrmg-rust-default-1.60.0/lib:/nix/store/nk9n0g0gk856nnzcik0q7dwpqq49qjzz-pkg-config-wrapper-0.29.2/lib:/nix/store/lbccj93nnf77zxg3m9gmral5avbp64z2-gcc-10.3.0-lib/lib:/nix/store/5vqz6vp6cwlr94684583zzpwz5mvn9af-libffi-3.4.2/lib:/nix/store/9s8s7snpms482zm3z68aq91d184ynqma-ncurses-6.2/lib:/nix/store/p7syn79gwkjxcpqw2w79jw0qdlxr8s26-zlib-1.2.11/lib:/nix/store/9zb5qxnixld6bdvcp5isphi4qwscf6b7-valgrind-3.18.1/lib:/nix/store/xn34bjf4p7c4gcgxfsi8x09ikcsk55yh-vulkan-headers-1.2.189.1/lib:/nix/store/fjk8k473smpgxsqcs9lkdwayznlg6zgk-vulkan-loader-1.2.189.1/lib:/nix/store/qf6za190wgnq6i0k4yl75x84qcjlx05n-vulkan-tools-1.2.189.1/lib:/nix/store/qvifqgyfmq990sbgqn0blc6jx7429ypz-vulkan-validation-layers-1.2.189.1/lib:/nix/store/0pp8dys4m0j3d4idqjwzpk7xyapm0v8v-libX11-1.7.2/lib:/nix/store/bgilik8910381jk9vjmkkzmks00k271l-libXcursor-1.2.0/lib:/nix/store/n89p0dfm498v4zk1lv7pjrrfxqg26sqy-libXrandr-1.5.2/lib:/nix/store/17npsrav57vc90sn4034y51l0pndr1s5-libXi-1.8/lib:/nix/store/hc32k2zvhxmjg6280vs30kbqzgnfiwfd-libxcb-1.14/lib:/nix/store/ghj9i9xcadkrzlsfi1zr39pxwhgsqgrh-alsa-lib-1.2.5.1/lib' ROC_DEBUG_ALIAS_ANALYSIS=0 ROC_PRETTY_PRINT_ALIAS_CONTENTS=0 ROC_PRINT_IR_AFTER_REFCOUNT=0 ROC_PRINT_IR_AFTER_RESET_REUSE=0 ROC_PRINT_IR_AFTER_SPECIALIZATION=0 ROC_PRINT_LLVM_FN_VERIFICATION=0 ROC_PRINT_LOAD_LOG=0 ROC_PRINT_MISMATCHES=0 ROC_PRINT_UNIFICATIONS=0 ROC_VERIFY_RIGID_LET_GENERALIZED=0 ROC_WORKSPACE_DIR=/home/shikiyo/selfinstalled/roc/ rustc --crate-name cfg_if --edition=2018 /home/shikiyo/.cargo/registry/src/github.com-1ecc6299db9ec823/cfg-if-1.0.0/src/lib.rs --error-format=json --json=diagnostic-rendered-ansi,artifacts,future-incompat --crate-type lib --emit=dep-info,metadata,link -C embed-bitcode=no -C debuginfo=2 -C metadata=56df745b5175507b -C extra-filename=-56df745b5175507b --out-dir /home/shikiyo/selfinstalled/roc/target/debug/deps -L dependency=/home/shikiyo/selfinstalled/roc/target/debug/deps --cap-lints warn '-C target-cpu=native'` (exit status: 1)</span>\n<span class=\"go\">warning: build failed, waiting for other jobs to finish...</span>\n<span class=\"go\">error: build failed</span>\n</code></pre></div>",
        "id": 286293453,
        "sender_full_name": "Hashi364",
        "timestamp": 1655340026
    },
    {
        "content": "<p>I fixed the <code>unknown codegen option:  target-cpu</code> can you pull the latest version of the branch and try again?</p>",
        "id": 286333433,
        "sender_full_name": "Anton",
        "timestamp": 1655375782
    },
    {
        "content": "<p><code>cargo build</code> and <code>cargo check</code> ran ok, but <code>cargo test</code> fails, maybe I shouldn't worry about it, this is part of the output (I changed the input files and flags given to cc for ...):</p>\n<div class=\"codehilite\" data-code-language=\"Bash Session\"><pre><span></span><code><span class=\"go\">Compiling roc_cli v0.1.0 (/home/shikiyo/selfinstalled/roc/cli)</span>\n<span class=\"go\">   Compiling roc-bindgen v0.1.0 (/home/shikiyo/selfinstalled/roc/bindgen)</span>\n<span class=\"go\">error: linking with cc failed: exit status: 1</span>\n<span class=\"go\">  |</span>\n<span class=\"go\">  = note: \"cc\" \"-m64\" ...</span>\n<span class=\"go\">  = note: /nix/store/11szv8mf8ww7gv36kfgj56d68cx7chg3-gcc-wrapper-10.3.0/bin/ld: line 256: 36138 Killed                  /nix/store/wa59khxfvx6nf1wgdr5bjyyf9rdk23jc-binutils-2.35.2/bin/ld ${extraBefore+\"${extraBefore[@]}\"} ${params+\"${params[@]}\"} ${extraAfter+\"${extraAfter[@]}\"}</span>\n<span class=\"go\">          collect2: error: ld returned 137 exit status</span>\n\n\n<span class=\"go\">error: could not compile roc_cli due to previous error</span>\n<span class=\"go\">warning: build failed, waiting for other jobs to finish...</span>\n<span class=\"go\">error: build failed</span>\n</code></pre></div>",
        "id": 286341659,
        "sender_full_name": "Hashi364",
        "timestamp": 1655380480
    },
    {
        "content": "<p>Nice that build and check are working :)</p>\n<blockquote>\n<p>I changed the input files and flags given to cc for ...</p>\n</blockquote>\n<p>I'm not sure I follow completely, did you call something directly to recreate the error?</p>\n<p>To fix things step by step, I recommend starting with building all tests <code>cargo test --locked --release --no-run</code>. If that works we can then try running them with <code>cargo test --locked --release</code>.</p>",
        "id": 286345253,
        "sender_full_name": "Anton",
        "timestamp": 1655382571
    },
    {
        "content": "<p>I didn't change anything, I just didn't copied the full output (because it's too long). In the output there is something like <code>note : \"cc\" \"-m64\" ...</code> I put <code>... </code> instead of a bunch of files and flags</p>",
        "id": 286346529,
        "sender_full_name": "Hashi364",
        "timestamp": 1655383288
    },
    {
        "content": "<p>Trying to make things clear: I ran <code>cargo test</code> and I didn't paste the full output.<br>\nI'll try the step by step soon</p>",
        "id": 286346865,
        "sender_full_name": "Hashi364",
        "timestamp": 1655383452
    },
    {
        "content": "<p>random observation <code>/nix/store/11szv8mf8ww7gv36kfgj56d68cx7chg3-gcc-wrapper-10.3.0/bin/ld</code> seems odd. It's definitely slow, <code>lld</code> is probably the better choice</p>",
        "id": 286348401,
        "sender_full_name": "Folkert de Vries",
        "timestamp": 1655384282
    },
    {
        "content": "<p>I have this in my <code>~/.cargo/config.toml</code> </p>\n<div class=\"codehilite\"><pre><span></span><code># Link with lld, per https://github.com/rust-lang/rust/issues/39915#issuecomment-538049306\n# Use target-cpu=native, per https://deterministic.space/high-performance-rust.html\n# rustflags = [&quot;-C&quot;, &quot;link-arg=-fuse-ld=lld&quot;, &quot;-C&quot;, &quot;target-cpu=native&quot;]\n[target.x86_64-unknown-linux-gnu]\nrustflags = [&quot;-C&quot;, &quot;link-arg=-fuse-ld=lld&quot;, &quot;-C&quot;, &quot;target-cpu=native&quot;]\n``\n</code></pre></div>",
        "id": 286348510,
        "sender_full_name": "Folkert de Vries",
        "timestamp": 1655384318
    },
    {
        "content": "<p>not sure if nix has some different way to configure it</p>",
        "id": 286348532,
        "sender_full_name": "Folkert de Vries",
        "timestamp": 1655384330
    },
    {
        "content": "<p>we could also consider trying <code>mold</code>, which claims to <a href=\"https://github.com/rui314/mold\">outperform <code>lld</code></a> (and I think was created by the author of <code>lld</code> and/or <code>gold</code>?) and which <a href=\"https://search.nixos.org/packages?channel=22.05&amp;show=mold&amp;from=0&amp;size=50&amp;sort=relevance&amp;type=packages&amp;query=mold\">has a nix package</a></p>",
        "id": 286350037,
        "sender_full_name": "Richard Feldman",
        "timestamp": 1655385010
    },
    {
        "content": "<p>it <a href=\"https://github.com/rui314/mold/issues/189\">doesn't support macOS</a> yet, but mac support seems to be pretty far along and actively developed</p>",
        "id": 286350570,
        "sender_full_name": "Richard Feldman",
        "timestamp": 1655385251
    },
    {
        "content": "<p><a href=\"/user_uploads/22008/3perAORTPv7_LK_RdM27Ego4/Screen-Shot-2022-06-16-at-9.14.35-AM.png\">Screen-Shot-2022-06-16-at-9.14.35-AM.png</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/22008/3perAORTPv7_LK_RdM27Ego4/Screen-Shot-2022-06-16-at-9.14.35-AM.png\" title=\"Screen-Shot-2022-06-16-at-9.14.35-AM.png\"><img src=\"/user_uploads/22008/3perAORTPv7_LK_RdM27Ego4/Screen-Shot-2022-06-16-at-9.14.35-AM.png\"></a></div>",
        "id": 286350631,
        "sender_full_name": "Richard Feldman",
        "timestamp": 1655385284
    },
    {
        "content": "<p><span aria-label=\"point up\" class=\"emoji emoji-1f446\" role=\"img\" title=\"point up\">:point_up:</span> from the <a href=\"https://github.com/rui314/mold#how-to-use\"><code>mold</code> readme</a></p>",
        "id": 286350706,
        "sender_full_name": "Richard Feldman",
        "timestamp": 1655385322
    },
    {
        "content": "<p>I ran <code>cargo test --locked --release --no-run</code>, worked, but <code>cargo test --locked --release</code> failed in this test battery:</p>\n<div class=\"codehilite\" data-code-language=\"Bash Session\"><pre><span></span><code><span class=\"go\">Running tests/test_bindgen_cli.rs (target/release/deps/test_bindgen_cli-958923e56db382f9)</span>\n<span class=\"go\">Running cargo build --release on the cli crate before running the tests. This may take a bit!</span>\n\n<span class=\"go\">running 9 tests</span>\n<span class=\"go\">test bindgen_cli_run::all_fixtures_have_tests ... ok</span>\n<span class=\"go\">test bindgen_cli_run::enumeration ... ok</span>\n<span class=\"go\">test bindgen_cli_run::basic_record ... ok</span>\n<span class=\"go\">test bindgen_cli_run::basic_recursive_union ... ok</span>\n<span class=\"go\">test bindgen_cli_run::advanced_recursive_union ... ok</span>\n<span class=\"go\">test bindgen_cli_run::nested_record ... ok</span>\n<span class=\"go\">test bindgen_cli_run::union_without_padding ... ok</span>\n<span class=\"go\">test bindgen_cli_run::nullable_unwrapped ... ok</span>\n<span class=\"go\">test bindgen_cli_run::union_with_padding ... FAILED</span>\n\n<span class=\"go\">failures:</span>\n\n<span class=\"go\">---- bindgen_cli_run::union_with_padding stdout ----</span>\n<span class=\"go\">thread 'bindgen_cli_run::union_with_padding' panicked at 'bad status Out { stdout: \"🔨 Rebuilding host...\\n\", stderr: \"\", status: ExitStatus(unix_wait_status(139)) }', bindgen/tests/test_bindgen_cli.rs:235:9</span>\n<span class=\"go\">note: run with RUST_BACKTRACE=1 environment variable to display a backtrace</span>\n\n\n<span class=\"go\">failures:</span>\n<span class=\"go\">    bindgen_cli_run::union_with_padding</span>\n\n<span class=\"go\">test result: FAILED. 8 passed; 1 failed; 0 ignored; 0 measured; 0 filtered out; finished in 11.44s</span>\n\n<span class=\"go\">error: test failed, to rerun pass '-p roc-bindgen --test test_bindgen_cli'</span>\n</code></pre></div>",
        "id": 286403827,
        "sender_full_name": "Hashi364",
        "timestamp": 1655408888
    },
    {
        "content": "<p>is that the only test out of all of <code>cargo test</code> that fails?</p>",
        "id": 286403965,
        "sender_full_name": "Richard Feldman",
        "timestamp": 1655408975
    },
    {
        "content": "<p>e.g. if you do <code>cargo test --no-fail-fast</code> do you see other failures too?</p>",
        "id": 286403984,
        "sender_full_name": "Richard Feldman",
        "timestamp": 1655408985
    },
    {
        "content": "<p>This battery failed too:</p>\n<div class=\"codehilite\" data-code-language=\"Bash Session\"><pre><span></span><code><span class=\"go\">running 37 tests</span>\n<span class=\"go\">test cli_run::all_examples_have_tests ... ok</span>\n<span class=\"go\">test cli_run::all_benchmarks_have_tests ... ok</span>\n<span class=\"go\">test cli_run::base64 ... FAILED</span>\n<span class=\"go\">test cli_run::astar ... FAILED</span>\n<span class=\"go\">test cli_run::cfold ... FAILED</span>\n<span class=\"go\">test cli_run::deriv ... FAILED</span>\n<span class=\"go\">test cli_run::closure ... FAILED</span>\n<span class=\"go\">test cli_run::cli ... ok</span>\n<span class=\"go\">test cli_run::exposed_not_defined ... ok</span>\n<span class=\"go\">test cli_run::effects ... FAILED</span>\n<span class=\"go\">test cli_run::format_check_folders ... ok</span>\n<span class=\"go\">test cli_run::fib ... FAILED</span>\n<span class=\"go\">test cli_run::format_check_good ... ok</span>\n<span class=\"go\">test cli_run::format_check_reformatting_needed ... ok</span>\n<span class=\"go\">test cli_run::breakout ... ok</span>\n<span class=\"go\">test cli_run::helloC ... ok</span>\n<span class=\"go\">test cli_run::helloSwift ... ok</span>\n<span class=\"go\">test cli_run::helloWeb ... ok</span>\n<span class=\"go\">test cli_run::helloWorld ... ok</span>\n<span class=\"go\">test cli_run::helloZig ... FAILED</span>\n<span class=\"go\">test cli_run::issue2279 ... FAILED</span>\n<span class=\"go\">test cli_run::known_type_error ... ok</span>\n<span class=\"go\">test cli_run::nqueens ... FAILED</span>\n<span class=\"go\">test cli_run::quicksort ... FAILED</span>\n<span class=\"go\">test cli_run::quicksort_app ... ok</span>\n<span class=\"go\">test cli_run::rbtree_ck ... FAILED</span>\n<span class=\"go\">test cli_run::rbtree_insert ... FAILED</span>\n<span class=\"go\">test cli_run::run_multi_dep_str_optimized ... FAILED</span>\n<span class=\"go\">test cli_run::run_multi_dep_str_unoptimized ... FAILED</span>\n<span class=\"go\">test cli_run::helloRust ... ok</span>\n<span class=\"go\">test cli_run::run_multi_dep_thunk_optimized ... FAILED</span>\n<span class=\"go\">test cli_run::run_multi_dep_thunk_unoptimized ... FAILED</span>\n<span class=\"go\">test cli_run::unknown_generates_with ... ok</span>\n<span class=\"go\">test cli_run::unused_import ... ok</span>\n<span class=\"go\">test cli_run::tui ... FAILED</span>\n<span class=\"go\">test cli_run::false_interpreter has been running for over 60 seconds</span>\n<span class=\"go\">test cli_run::gui has been running for over 60 seconds</span>\n<span class=\"go\">test cli_run::false_interpreter ... ok</span>\n<span class=\"go\">test cli_run::gui ... ok</span>\n</code></pre></div>",
        "id": 286414850,
        "sender_full_name": "Hashi364",
        "timestamp": 1655414234
    },
    {
        "content": "<p>Valgrind said something similar in may fails</p>\n<div class=\"codehilite\" data-code-language=\"Bash Session\"><pre><span></span><code><span class=\"go\">valgrind stderr was: \"</span>\n<span class=\"go\">valgrind:  Fatal error at startup: a function redirection</span>\n<span class=\"go\">valgrind:  which is mandatory for this platform-tool combination</span>\n<span class=\"go\">valgrind:  cannot be set up.  Details of the redirection are:</span>\n<span class=\"go\">valgrind:</span>\n<span class=\"go\">valgrind:  A must-be-redirected function</span>\n<span class=\"go\">valgrind:  whose name matches the pattern:      strlen</span>\n<span class=\"go\">valgrind:  in an object with soname matching:   ld-linux-x86-64.so.2</span>\n<span class=\"go\">valgrind:  was not found whilst processing</span>\n<span class=\"go\">valgrind:  symbols from the object with soname: ld-linux-x86-64.so.2</span>\n<span class=\"go\">valgrind:</span>\n<span class=\"go\">valgrind:  Possible fixes: (1, short term): install glibc's debuginfo</span>\n<span class=\"go\">valgrind:  package on this machine.  (2, longer term): ask the packagers</span>\n<span class=\"go\">valgrind:  for your Linux distribution to please in future ship a non-</span>\n<span class=\"go\">valgrind:  stripped ld.so (or whatever the dynamic linker .so is called)</span>\n<span class=\"go\">valgrind:  that exports the above-named function using the standard</span>\n<span class=\"go\">valgrind:  calling conventions for this platform.  The package you need</span>\n<span class=\"go\">valgrind:  to install for fix (1) is called</span>\n<span class=\"go\">valgrind:</span>\n<span class=\"go\">valgrind:    On Debian, Ubuntu:                 libc6-dbg</span>\n<span class=\"go\">valgrind:    On SuSE, openSuSE, Fedora, RHEL:   glibc-debuginfo</span>\n<span class=\"go\">valgrind:</span>\n<span class=\"go\">valgrind:  Note that if you are debugging a 32 bit process on a</span>\n<span class=\"go\">valgrind:  64 bit system, you will need a corresponding 32 bit debuginfo</span>\n<span class=\"go\">valgrind:  package (e.g. libc6-dbg:i386).</span>\n<span class=\"go\">valgrind:</span>\n<span class=\"go\">valgrind:  Cannot continue -- exiting now.  Sorry.</span>\n\n<span class=\"go\">\"', cli/tests/cli_run.rs:200:29</span>\n</code></pre></div>",
        "id": 286415227,
        "sender_full_name": "Hashi364",
        "timestamp": 1655414438
    },
    {
        "content": "<p>I was able to reproduce these issues on my archlinux VM. I'll look into solving them in the coming days.</p>",
        "id": 286469407,
        "sender_full_name": "Anton",
        "timestamp": 1655460175
    },
    {
        "content": "<p>does the fix suggested by valgrind work?</p>",
        "id": 286477073,
        "sender_full_name": "Folkert de Vries",
        "timestamp": 1655465833
    },
    {
        "content": "<p>I haven't tried it yet</p>",
        "id": 286478092,
        "sender_full_name": "Anton",
        "timestamp": 1655466525
    },
    {
        "content": "<p>It's been a while since I've built Roc from source and after upgrading zig &amp; LLVM it seems to me that Roc should build, but I still get this error:</p>\n<div class=\"codehilite\"><pre><span></span><code> Compiling roc_alias_analysis v0.1.0 (/mnt/d/dev/roc-lang/compiler/alias_analysis)\n   Compiling roc_gen_dev v0.1.0 (/mnt/d/dev/roc-lang/compiler/gen_dev)\nerror[E0658]: use of unstable library feature &#39;available_parallelism&#39;\n    --&gt; compiler/load_internal/src/file.rs:1276:19\n     |\n1276 |             match std::thread::available_parallelism().map(|v| v.get()) {\n     |                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n     |\n     = note: see issue #74479 &lt;https://github.com/rust-lang/rust/issues/74479&gt; for more information\n\n   Compiling roc_gen_llvm v0.1.0 (/mnt/d/dev/roc-lang/compiler/gen_llvm)\nFor more information about this error, try `rustc --explain E0658`.\nerror: could not compile `roc_load_internal` due to previous error\nwarning: build failed, waiting for other jobs to finish...\nerror: build failed\n</code></pre></div>\n<p>Is this new or am I doing something wrong?</p>",
        "id": 286505697,
        "sender_full_name": "Maximilian E",
        "timestamp": 1655479961
    },
    {
        "content": "<p>You may not be in the right rust version, we're on 1.60. What is the output of <code>cargo --version</code>?</p>",
        "id": 286506528,
        "sender_full_name": "Anton",
        "timestamp": 1655480313
    },
    {
        "content": "<p>We have a file called <code>rust-toolchain.toml</code> to prevent this automatically, but the error really does make it look like you're using an older rust version.</p>",
        "id": 286507130,
        "sender_full_name": "Anton",
        "timestamp": 1655480554
    },
    {
        "content": "<p>I get this: <code>cargo --version\ncargo 1.58.0 (f01b232bc 2022-01-19)</code><br>\nYou're right, I'll need to upgrade rust too, thanks!</p>",
        "id": 286522070,
        "sender_full_name": "Maximilian E",
        "timestamp": 1655488153
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"506120\">@Hashi364</span> <code>sudo pacman -Syu debuginfod</code> should fix all the valgrind errors. I'll make an issue for the <code>union_without_padding</code> error, I'm probably not the best person to fix that one <span aria-label=\"sweat smile\" class=\"emoji emoji-1f605\" role=\"img\" title=\"sweat smile\">:sweat_smile:</span></p>",
        "id": 286950740,
        "sender_full_name": "Anton",
        "timestamp": 1655833711
    },
    {
        "content": "<p>Installing <code>debuginfod</code> didn't fix valgrind errors, shouldn't I put it in <code>flakes.nix</code> or something like it?</p>",
        "id": 286979151,
        "sender_full_name": "Hashi364",
        "timestamp": 1655848507
    },
    {
        "content": "<p>Hmm, no, it can't go in nix flakes, there is no nix package for debuginfod.<br>\nI executed <code>sudo pacman -Syu debuginfod</code> after <code>nix develop</code>, not sure if it would make a difference but can you try it like that?</p>",
        "id": 287019714,
        "sender_full_name": "Anton",
        "timestamp": 1655885966
    },
    {
        "content": "<p>If that does not work, I'd also try adding <code>DEBUGINFOD_URLS=\"https://debuginfod.archlinux.org/\"</code>below <code>LLVM_SYS_130_PREFIX = ...</code> in flake.nix (exit from the nix shell if you already did <code>nix develop</code>) and run <code>nix develop</code> again.</p>",
        "id": 287029554,
        "sender_full_name": "Anton",
        "timestamp": 1655891268
    },
    {
        "content": "<p>Oh, after <code>nix develop</code>, I'll try it</p>",
        "id": 287035326,
        "sender_full_name": "Hashi364",
        "timestamp": 1655894851
    },
    {
        "content": "<p>It worked, now only <code>bindgen_cli_run::union_with_padding</code></p>",
        "id": 287036980,
        "sender_full_name": "Hashi364",
        "timestamp": 1655895858
    },
    {
        "content": "<p>Awesome <span aria-label=\"tada\" class=\"emoji emoji-1f389\" role=\"img\" title=\"tada\">:tada:</span> thanks for your patience :)</p>",
        "id": 287038266,
        "sender_full_name": "Anton",
        "timestamp": 1655896754
    },
    {
        "content": "<p>interestingly, we recently got a CI failure that I can't explain for <code>union_without_padding</code> (so, similar but not quite the same test) after a code change that should be totally unrelated:</p>\n<p><a href=\"https://github.com/rtfeldman/roc/runs/6992258439?check_suite_focus=true\">https://github.com/rtfeldman/roc/runs/6992258439?check_suite_focus=true</a></p>",
        "id": 287042505,
        "sender_full_name": "Richard Feldman",
        "timestamp": 1655899151
    },
    {
        "content": "<p>I can't reproduce it locally on my M1, but I re-ran out on CI and it failed again</p>",
        "id": 287042536,
        "sender_full_name": "Richard Feldman",
        "timestamp": 1655899176
    }
]