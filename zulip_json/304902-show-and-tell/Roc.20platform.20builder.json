[
    {
        "content": "<p>I have been doing some experiments on how to make building roc platforms in rust easier: <a href=\"https://github.com/johanneshorner/roc-platform-builder\">https://github.com/johanneshorner/roc-platform-builder</a><br>\nThere are no docs, likely a lot of bugs and I'm not sure if the abstractions I have so far are actually useful, so caution is advised <span aria-label=\"smile\" class=\"emoji emoji-1f604\" role=\"img\" title=\"smile\">:smile:</span> .<br>\nSo far it tries to shield the user from writing unsafe code and automatically sorts the hosted functions by name.</p>\n<p><a href=\"https://github.com/johanneshorner/basic-cli-roc-platform-builder\">Here</a> I used the crate to port <a href=\"https://github.com/roc-lang/basic-cli/tree/migrate-zig-compiler\">basic-cli</a>.</p>",
        "id": 570420523,
        "sender_full_name": "lozzy",
        "timestamp": 1769547331
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"1001498\">@lozzy</span> have you heard about <code>roc glue</code> and the design for that? <span class=\"user-mention\" data-user-id=\"430894\">@Dan G Knutson</span> has just started implementing that in <a href=\"https://github.com/roc-lang/roc/pull/9083\">#9083</a> - but the general idea is you give the roc cli a plugin (a <code>RustGlue.roc</code> script) which it uses to codegen all the Roc types (e.g. in Rust).</p>",
        "id": 570420892,
        "sender_full_name": "Luke Boswell",
        "timestamp": 1769547450
    },
    {
        "content": "<p>Also there is a PR to migrate basic-cli if you are interested in contributing to that <a href=\"https://github.com/roc-lang/basic-cli/pull/413\">https://github.com/roc-lang/basic-cli/pull/413</a></p>",
        "id": 570421095,
        "sender_full_name": "Luke Boswell",
        "timestamp": 1769547498
    },
    {
        "content": "<p>roc-platform-builder looks really useful <span aria-label=\"smiley\" class=\"emoji emoji-1f603\" role=\"img\" title=\"smiley\">:smiley:</span></p>",
        "id": 570421818,
        "sender_full_name": "Luke Boswell",
        "timestamp": 1769547701
    },
    {
        "content": "<p>I haven't seen the <code>roc glue</code> PR. I'll check that out, thanks.</p>\n<p><span class=\"user-mention silent\" data-user-id=\"515757\">Luke Boswell</span> <a href=\"#narrow/channel/304902-show-and-tell/topic/Roc.20platform.20builder/near/570421095\">said</a>:</p>\n<blockquote>\n<p>Also there is a PR to migrate basic-cli if you are interested in contributing to that <a href=\"https://github.com/roc-lang/basic-cli/pull/413\">https://github.com/roc-lang/basic-cli/pull/413</a></p>\n</blockquote>\n<p>I was about to start on migrating the <code>Http</code> module yesterday but I got distracted <span aria-label=\"smile\" class=\"emoji emoji-1f604\" role=\"img\" title=\"smile\">:smile:</span> . I'll start a PR in the coming days if no one beats me to it.</p>",
        "id": 570422045,
        "sender_full_name": "lozzy",
        "timestamp": 1769547768
    },
    {
        "content": "<p>I'm trying to understand what the port is, as compared to that <code>migrate-zig-compiler</code> branch</p>",
        "id": 570422071,
        "sender_full_name": "Luke Boswell",
        "timestamp": 1769547777
    },
    {
        "content": "<p>Yeah if your happy to contribute, that'd be awesome. I'd recommend making another branch that merges into <code>migrate-zig-compiler</code> -- and then CI can do it's thing.</p>",
        "id": 570422240,
        "sender_full_name": "Luke Boswell",
        "timestamp": 1769547828
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"515757\">Luke Boswell</span> <a href=\"#narrow/channel/304902-show-and-tell/topic/Roc.20platform.20builder/near/570422071\">said</a>:</p>\n<blockquote>\n<p>I'm trying to understand what the port is, as compared to that <code>migrate-zig-compiler</code> branch</p>\n</blockquote>\n<p>I pretty much just replaced all of the manual unsafe ptr shenanigans with proc macro magic. So there isn't a lot of difference there.</p>",
        "id": 570422653,
        "sender_full_name": "lozzy",
        "timestamp": 1769547956
    },
    {
        "content": "<p>I think there's some R&amp;D or re-design work on that API that we probably need to think about. I've got an idea cooking this morning to post in an ideas thread on something I was exploring with roc-ray, but basically the current API worked with our older syntax but it may not be idiomatic Roc in a static dispatch world.</p>",
        "id": 570423050,
        "sender_full_name": "Luke Boswell",
        "timestamp": 1769548080
    },
    {
        "content": "<p>Yeah I already got the feeling that there might be some things to iterate on. Looking forward to reading your post.</p>",
        "id": 570423395,
        "sender_full_name": "lozzy",
        "timestamp": 1769548188
    },
    {
        "content": "<p>I don't know if we can really explore it though until we have a working platform and start porting all the examples over.</p>",
        "id": 570423443,
        "sender_full_name": "Luke Boswell",
        "timestamp": 1769548197
    },
    {
        "content": "<p>I ran out of steam and never got around to posting about the API idea I had... but you can see the latest design in this roc-ray example <a href=\"https://github.com/lukewilliamboswell/roc-ray/blob/new-compiler/examples/read_env.roc\">https://github.com/lukewilliamboswell/roc-ray/blob/new-compiler/examples/read_env.roc</a></p>\n<p>The idea is to pass in a \"host\" which has effectful methods on it</p>",
        "id": 570486300,
        "sender_full_name": "Luke Boswell",
        "timestamp": 1769585924
    },
    {
        "content": "<p>! Very limited knowledge of old and new compiler ahead !<br>\nWouldn't that break the pattern that roc packages used in the past to get access to effectful functions? For example in <a href=\"https://github.com/imclerran/roc-ai/blob/main/package/Toolkit/FileSystem.roc\">https://github.com/imclerran/roc-ai/blob/main/package/Toolkit/FileSystem.roc</a> the module takes some effectful functions as input and then provide something new wrapping these functions.<br>\nIf the effectful functions are now methods on an object you lose this paradigm as you cannot pass the <code>host</code> object at \"import time\"?!</p>",
        "id": 570635480,
        "sender_full_name": "lozzy",
        "timestamp": 1769625877
    },
    {
        "content": "<p>Ah the module params thing... we decided that that wasn't the right design for Roc. Instead the preference is to feed things through arguments. Like a <code>Ctx</code> object or similar</p>",
        "id": 570746106,
        "sender_full_name": "Luke Boswell",
        "timestamp": 1769679651
    },
    {
        "content": "<p>I guess a better example is similar to how Zig is now doing the Io thing and passing that in.</p>",
        "id": 570746184,
        "sender_full_name": "Luke Boswell",
        "timestamp": 1769679675
    },
    {
        "content": "<p>I see. So for a example a function exposed by a package could take some type (which represents the host and its effectful functions) as an argument and require it to implement <code>read_env</code> and <code>stdout_write</code> using a <code>where</code> clause?</p>",
        "id": 570748231,
        "sender_full_name": "lozzy",
        "timestamp": 1769680266
    },
    {
        "content": "<p>yes exactly!</p>",
        "id": 570748815,
        "sender_full_name": "Luke Boswell",
        "timestamp": 1769680427
    },
    {
        "content": "<p>It's all still so new I don't have any examples to point you to</p>",
        "id": 570748999,
        "sender_full_name": "Luke Boswell",
        "timestamp": 1769680471
    },
    {
        "content": "<p>But it's been on my todo list to make a package that does something as a demo with effectful functions</p>",
        "id": 570749113,
        "sender_full_name": "Luke Boswell",
        "timestamp": 1769680497
    },
    {
        "content": "<p>Like a cross-platform package that does S3 uploads or something like that.</p>",
        "id": 570749224,
        "sender_full_name": "Luke Boswell",
        "timestamp": 1769680536
    },
    {
        "content": "<p>I haven't thought very hard about what a good simple example might be</p>",
        "id": 570749286,
        "sender_full_name": "Luke Boswell",
        "timestamp": 1769680551
    }
]