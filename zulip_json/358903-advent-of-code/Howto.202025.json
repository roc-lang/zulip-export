[
    {
        "content": "<p>Hi,</p>\n<p>I would like to do AoC with Roc again. What is the story this year? Is the new compiler ready enough? I found the <a href=\"https://github.com/roc-lang/nightlies\">neightly</a>, but I was not sure what to do with it. When I use the <a href=\"https://github.com/roc-lang/basic-cli/releases/tag/0.20.0\">last release</a> of basic-cli, I get <code>error.PlatformNotSupported</code>.</p>\n<p>Is it possible, to use the new compiler for simple stuff like AoC?</p>\n<p>Is it correct, that the new syntax is only implemented in the new compiler? I don't want do to AoC with the old syntax.</p>",
        "id": 554516544,
        "sender_full_name": "Oskar Hahn",
        "timestamp": 1762642301
    },
    {
        "content": "<p>The hope is that the new compiler will be ready of AOC this year. Though I guess time is getting pretty tight now.</p>",
        "id": 554525580,
        "sender_full_name": "Brendan Hansknecht",
        "timestamp": 1762651955
    },
    {
        "content": "<p>We should have nearly all the pieces to make a minimal AOC platform and use it with the interpreter (which will hopefully fill out with enough buiiltins shortly). Likely will take a bit longer to get something like basic cli ported, but I think it should be doable in this timeline.</p>",
        "id": 554525643,
        "sender_full_name": "Brendan Hansknecht",
        "timestamp": 1762652036
    },
    {
        "content": "<p>But right now, we just have some really basic and simple platforms working and a solid amount of missing buiiltins and such.</p>",
        "id": 554525665,
        "sender_full_name": "Brendan Hansknecht",
        "timestamp": 1762652068
    },
    {
        "content": "<p>From my perspective the „easiest“ access point for most curious people would be the web playground. If that’s utilizing the new syntax + some way to import the individualized inputs it would likely enable the furthest reach</p>",
        "id": 554546866,
        "sender_full_name": "Tobias Steckenborn",
        "timestamp": 1762678000
    },
    {
        "content": "<p>yeah I'm working on getting a basic platform working - getting close!</p>",
        "id": 554561290,
        "sender_full_name": "Richard Feldman",
        "timestamp": 1762693820
    },
    {
        "content": "<p>I would also love to have something in the playground that we can use for AoC <span aria-label=\"smiley\" class=\"emoji emoji-1f603\" role=\"img\" title=\"smiley\">:smiley:</span></p>",
        "id": 554596516,
        "sender_full_name": "Luke Boswell",
        "timestamp": 1762727357
    },
    {
        "content": "<p>Is there any update on whether the new compiler will be ready for AoC this year?</p>",
        "id": 558706658,
        "sender_full_name": "Kat",
        "timestamp": 1763743524
    },
    {
        "content": "<p>If we make it, it will be tight</p>",
        "id": 558999528,
        "sender_full_name": "Anton",
        "timestamp": 1763979133
    },
    {
        "content": "<p>I was also hoping to use Roc for this year's AoC after I heard Richard talking about a first version hopefully being available in time for it. Fingers crossed I guess. <span aria-label=\"blush\" class=\"emoji emoji-1f60a\" role=\"img\" title=\"blush\">:blush:</span></p>",
        "id": 560467418,
        "sender_full_name": "Kevin Hovsäter",
        "timestamp": 1764187397
    },
    {
        "content": "<p>We are several lurkers that feel the same! <span aria-label=\"fingers crossed\" class=\"emoji emoji-1f91e\" role=\"img\" title=\"fingers crossed\">:fingers_crossed:</span>, but don't stress it, it's better to not force something out</p>",
        "id": 560666383,
        "sender_full_name": "Jamie Neubert Pedersen",
        "timestamp": 1764274677
    },
    {
        "content": "<p>Here's a solution to 2024 Day 1 -- with a few workarounds (running from a PR branch) </p>\n<div class=\"codehilite\"><pre><span></span><code>app [main!] { pf: platform &quot;./platform/main.roc&quot; }\n\nimport pf.Stdout\n\n# AoC 2024 Day 1 Solution\n#\n# Current Roc limitations prevent full automation:\n# - Records in fold accumulators cause compiler panic\n# - Platform doesn&#39;t implement realloc (can&#39;t grow lists dynamically)\n# - to_utf8 has type issues\n#\n# So we pre-sort the input manually and create pairs\n\n# Original input:\n# 3   4\n# 4   3\n# 2   5\n# 1   3\n# 3   9\n# 3   3\n#\n# Left list sorted:  [1, 2, 3, 3, 3, 4]\n# Right list sorted: [3, 3, 3, 4, 5, 9]\n\n# Pre-computed pairs from sorted lists\npairs = [(1, 3), (2, 3), (3, 3), (3, 4), (3, 5), (4, 9)]\n\n# Absolute difference\nabs_diff : Dec, Dec -&gt; Dec\nabs_diff = |a, b| if a &gt; b { a - b } else { b - a }\n\nmain! = || {\n    # Sum the distances using fold\n    total = pairs.fold(0, |acc, pair| {\n        (left, right) = pair\n        acc + abs_diff(left, right)\n    })\n\n    Stdout.line!(&quot;Total distance: ${total.to_str()}&quot;)\n}\n</code></pre></div>\n<div class=\"codehilite\"><pre><span></span><code>$ roc version\nRoc compiler version debug-056b5e2a\n$ roc test/fx/app_test5.roc\nTotal distance: 11.0\n</code></pre></div>",
        "id": 560691836,
        "sender_full_name": "Luke Boswell",
        "timestamp": 1764292612
    },
    {
        "content": "<p>we're getting closer - it's a start! <span aria-label=\"smiley\" class=\"emoji emoji-1f603\" role=\"img\" title=\"smiley\">:smiley:</span></p>",
        "id": 560691927,
        "sender_full_name": "Richard Feldman",
        "timestamp": 1764292734
    },
    {
        "content": "<p>I removed the ListWasEmpty post, because it has been handled in <a class=\"stream-topic\" data-stream-id=\"463736\" href=\"/#narrow/channel/463736-bugs/topic/List.20builtins.20crash.20roc.20when.20returning.20tag/with/560871752\">#bugs &gt; List builtins crash roc when returning tag</a></p>",
        "id": 560900322,
        "sender_full_name": "Anton",
        "timestamp": 1764409520
    },
    {
        "content": "<p>has anyone tried doing any of the 2024 stuff? we have a bunch more bugfixes and stdlib additions, and I'm curious what remaining bugs/missing things there are</p>",
        "id": 560945461,
        "sender_full_name": "Richard Feldman",
        "timestamp": 1764450830
    },
    {
        "content": "<p>I just took a quick pass at 2024 day one, like Luke did before, but ran into some issues.</p>\n<p>(I haven't debugged at all yet, figured I'd post for viz before looking diving in)</p>\n<p>The first error:</p>\n<div class=\"codehilite\"><pre><span></span><code>app [main!] { pf: platform &quot;./platform/main.roc&quot; }\n\nimport pf.Stdout\n\ntest_input =\n    &quot;&quot;&quot;3   4\n    &quot;&quot;&quot;4   3\n    &quot;&quot;&quot;2   5\n    &quot;&quot;&quot;1   3\n    &quot;&quot;&quot;3   9\n    &quot;&quot;&quot;3   3\n\nrun = |input| {\n    _input_lines = input.split_on(&quot;\\n&quot;)\n}\n\nmain! = || {\n    run(test_input)\n}\n</code></pre></div>\n<p>Errors with:</p>\n<div class=\"codehilite\"><pre><span></span><code>Roc crashed: Builtin.Num.Dec does not implement split_on\n</code></pre></div>\n<p>I put the same code into a snapshot and the inferred types are:</p>\n<div class=\"codehilite\"><pre><span></span><code>    (defs\n        (patt (type &quot;Str&quot;))\n        (patt (type &quot;a -&gt; {} where [a.split_on : a, Str -&gt; _ret]&quot;))\n        (patt (type &quot;({}) -&gt; {}&quot;)))\n</code></pre></div>\n<p>Which look correct, so not sure where the <code>Dec</code> is coming from</p>",
        "id": 560960197,
        "sender_full_name": "Jared Ramirez",
        "timestamp": 1764467266
    },
    {
        "content": "<p>I also tried a simpler version of just splitting the puzzle text and printing in a for loop:</p>\n<div class=\"codehilite\"><pre><span></span><code>app [main!] { pf: platform &quot;./platform/main.roc&quot; }\n\nimport pf.Stdout\n\ntest_input =\n    &quot;&quot;&quot;3   4\n    &quot;&quot;&quot;4   3\n    &quot;&quot;&quot;2   5\n    &quot;&quot;&quot;1   3\n    &quot;&quot;&quot;3   9\n    &quot;&quot;&quot;3   3\n\nmain! = || {\n    for line in test_input.split_on(&quot;\\n&quot;) {\n        Stdout.line!(line)\n    }\n}\n</code></pre></div>\n<p>And this errors with:</p>\n<div class=\"codehilite\"><pre><span></span><code>└─ ❯ ./zig-out/bin/roc test/aoc2024/one.roc\n3   4\nthread 143170 panic: Host allocation failed\n???:?:?: 0x100494a6f in ??? (roc_run_883903227)\n???:?:?: 0x1005d236b in ??? (roc_run_883903227)\n???:?:?: 0x10056dc73 in ??? (roc_run_883903227)\n???:?:?: 0x100537c3f in ??? (roc_run_883903227)\n???:?:?: 0x10053669f in ??? (roc_run_883903227)\n???:?:?: 0x10053982f in ??? (roc_run_883903227)\n???:?:?: 0x10053dfcf in ??? (roc_run_883903227)\n???:?:?: 0x10059559b in ??? (roc_run_883903227)\n???:?:?: 0x100549267 in ??? (roc_run_883903227)\n???:?:?: 0x1005258e3 in ??? (roc_run_883903227)\n???:?:?: 0x1005232ab in ??? (roc_run_883903227)\n???:?:?: 0x100522d0f in ??? (roc_run_883903227)\n???:?:?: 0x1004947f7 in ??? (roc_run_883903227)\n???:?:?: 0x100495103 in ??? (roc_run_883903227)\n???:?:?: 0x196425d53 in ??? (???)\n???:?:?: 0x0 in ??? (???)\nerror: Child process /Users/jaredramirez/Library/Caches/roc/080b753687f4b2c24027986b2e400969/temp/roc-tmp-XSwGdYZ8MR0wOSCaEKMX41QAAVAWys37/roc_run_883903227 killed by signal: 6\nerror: Child process aborted (SIGABRT)\n</code></pre></div>",
        "id": 560960337,
        "sender_full_name": "Jared Ramirez",
        "timestamp": 1764467464
    },
    {
        "content": "<p>Multi line string syntax is double backslash</p>",
        "id": 560960354,
        "sender_full_name": "Luke Boswell",
        "timestamp": 1764467500
    },
    {
        "content": "<p>(these are with the platform in <code>fx</code> also)</p>",
        "id": 560960378,
        "sender_full_name": "Jared Ramirez",
        "timestamp": 1764467537
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"515757\">Luke Boswell</span> <a href=\"#narrow/channel/358903-advent-of-code/topic/Howto.202025/near/560960354\">said</a>:</p>\n<blockquote>\n<p>Multi line string syntax is double backslash</p>\n</blockquote>\n<p>oh oops! lemme fix that and try again</p>",
        "id": 560960390,
        "sender_full_name": "Jared Ramirez",
        "timestamp": 1764467558
    },
    {
        "content": "<p>Can you try on my PR branch please?</p>",
        "id": 560960398,
        "sender_full_name": "Luke Boswell",
        "timestamp": 1764467568
    },
    {
        "content": "<p><a href=\"https://github.com/roc-lang/roc/pull/8505\">https://github.com/roc-lang/roc/pull/8505</a></p>",
        "id": 560960409,
        "sender_full_name": "Luke Boswell",
        "timestamp": 1764467594
    },
    {
        "content": "<p>I've upgraded the fx platform and added lots more instrumentation around allocations</p>",
        "id": 560960427,
        "sender_full_name": "Luke Boswell",
        "timestamp": 1764467637
    },
    {
        "content": "<p>I'm looking at this issue now</p>",
        "id": 560960674,
        "sender_full_name": "Luke Boswell",
        "timestamp": 1764468019
    },
    {
        "content": "<p>I noticed a similar issue before, but this is a nice repro I think where we try to make an infinite sized allocation</p>",
        "id": 560960736,
        "sender_full_name": "Luke Boswell",
        "timestamp": 1764468075
    },
    {
        "content": "<p>i get the same error on that branch, but it seems that it may have to do with the size of the string being split. </p>\n<p>with this input string, it prints each line &amp; exits</p>\n<div class=\"codehilite\"><pre><span></span><code>input =\n    \\\\a   x\n    \\\\b   x\n    \\\\c   x\n    \\\\d   x\n</code></pre></div>\n<p>but with one more row, it fails with <code>Host error: allocation failed, out of memory</code></p>\n<div class=\"codehilite\"><pre><span></span><code>input =\n    \\\\a   x\n    \\\\b   x\n    \\\\c   x\n    \\\\d   x\n    \\\\e   x\n</code></pre></div>",
        "id": 560960807,
        "sender_full_name": "Jared Ramirez",
        "timestamp": 1764468190
    },
    {
        "content": "<p>Same error without multiline:</p>\n<div class=\"codehilite\"><pre><span></span><code>input = &quot;a   x \\nb   x \\nc   x \\nd   x&quot;\n</code></pre></div>\n<p>but interestingly, this version is the shorter string, but it still fails</p>",
        "id": 560960892,
        "sender_full_name": "Jared Ramirez",
        "timestamp": 1764468328
    },
    {
        "content": "<p>Then, possibly related, but maybe not, the program runs no problem with this string:</p>\n<div class=\"codehilite\"><pre><span></span><code>input = &quot;aaaaaaaaaaaaaaaaaaaaaaa&quot; # there are 23 &quot;a&quot;s\n</code></pre></div>\n<p>But with this one</p>\n<div class=\"codehilite\"><pre><span></span><code>input = &quot;aaaaaaaaaaaaaaaaaaaaaaaa&quot; # there are 24 &quot;a&quot;s\n</code></pre></div>\n<p>It prints then segfaults:</p>\n<div class=\"codehilite\"><pre><span></span><code>aaaaaaaaaaaaaaaaaaaaaaaa\nerror: Child process /Users/jaredramirez/Library/Caches/roc/70dead706a5693ea80a872968b332d57/temp/roc-tmp-vkBVgcVhBIIO8OnLfRmSafE27WMwYoRp/roc_run_3325363814 killed by signal: 11\nerror: Child process crashed with segmentation fault (SIGSEGV)\n</code></pre></div>",
        "id": 560961142,
        "sender_full_name": "Jared Ramirez",
        "timestamp": 1764468666
    },
    {
        "content": "<p>From Claude</p>\n<blockquote>\n<p>I see the issue! Looking at the trace:<br>\n  1. DECREF str ptr=0x105660010 len=35 cap=35 - The original test_input string gets decremented<br>\n  2. Later INCREF str ptr=0x105660010 len=5 cap=35 - Trying to incref the same string (as a seamless slice)<br>\n  3. Finally INCREF str ptr=0x105660010 len=5 cap=5 - cap changed from 35 to 5, indicating memory corruption<br>\n  The original string is being DECREF'd before the seamless slices (from split_on) are done using it.</p>\n</blockquote>",
        "id": 560961215,
        "sender_full_name": "Luke Boswell",
        "timestamp": 1764468759
    },
    {
        "content": "<p>I can look at the long string segfault next</p>",
        "id": 560961260,
        "sender_full_name": "Luke Boswell",
        "timestamp": 1764468835
    },
    {
        "content": "<blockquote>\n<p><strong>Found the bug!</strong> The allocation is trying to allocate size=9223372036854775829 bytes, which is 0x8000000000000015 - that's 21 | SEAMLESS_SLICE_BIT!<br>\nThe issue is in RocStr.clone() - it uses str.length directly instead of str.len(), so for seamless slices it includes the SEAMLESS_SLICE_BIT in the allocation size!</p>\n</blockquote>",
        "id": 560961814,
        "sender_full_name": "Luke Boswell",
        "timestamp": 1764469657
    },
    {
        "content": "<p>That bug was masking another bug too, there's another double decref with the test_input binding</p>",
        "id": 560961948,
        "sender_full_name": "Luke Boswell",
        "timestamp": 1764469875
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"343810\">@Brendan Hansknecht</span> <span class=\"user-mention\" data-user-id=\"281383\">@Richard Feldman</span>     in a method call like <code>test_input.split_on(...)</code> we should just be incrementing the refcount on the string right?</p>",
        "id": 560962011,
        "sender_full_name": "Luke Boswell",
        "timestamp": 1764470016
    },
    {
        "content": "<p>Anyway, I've got a solid fix for these issues now</p>",
        "id": 560962055,
        "sender_full_name": "Luke Boswell",
        "timestamp": 1764470074
    },
    {
        "content": "<p>I'm a little concerned we might be cloning unnecessarily though so just investigating a little more.</p>",
        "id": 560962165,
        "sender_full_name": "Luke Boswell",
        "timestamp": 1764470217
    },
    {
        "content": "<p>Ok, all fixed without any cloning in <a href=\"https://github.com/roc-lang/roc/pull/8505\">https://github.com/roc-lang/roc/pull/8505</a></p>",
        "id": 560962445,
        "sender_full_name": "Luke Boswell",
        "timestamp": 1764470626
    },
    {
        "content": "<p>For split_on, I would expect to:</p>\n<ol>\n<li>Count the number of splits (n)</li>\n<li>Incref the main string n time</li>\n<li>Create a list of size n</li>\n<li>Put n seamless slices in the list</li>\n</ol>",
        "id": 560963890,
        "sender_full_name": "Brendan Hansknecht",
        "timestamp": 1764472815
    },
    {
        "content": "<p>Oh wait, does split on only split once or many times?</p>",
        "id": 560963899,
        "sender_full_name": "Brendan Hansknecht",
        "timestamp": 1764472833
    },
    {
        "content": "<p>I think many times</p>",
        "id": 560963979,
        "sender_full_name": "Luke Boswell",
        "timestamp": 1764472946
    },
    {
        "content": "<p>Hello, I don't have the time to make a minimal repro until this evening (european) but here's a small working program (Robot Simulator from Exercism : <a href=\"https://exercism.org/tracks/roc/exercises/robot-simulator\">https://exercism.org/tracks/roc/exercises/robot-simulator</a>) with a list of problems I ran into :</p>\n<div class=\"codehilite\" data-code-language=\"Ruby\"><pre><span></span><code><span class=\"n\">app</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">main!</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\"> </span><span class=\"ss\">pf</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"n\">platform</span><span class=\"w\"> </span><span class=\"s2\">\"./platform/main.roc\"</span><span class=\"w\"> </span><span class=\"p\">}</span>\n\n<span class=\"n\">import</span><span class=\"w\"> </span><span class=\"n\">pf</span><span class=\"o\">.</span><span class=\"n\">Stdout</span>\n<span class=\"n\">import</span><span class=\"w\"> </span><span class=\"n\">pf</span><span class=\"o\">.</span><span class=\"n\">Stderr</span>\n\n<span class=\"no\">Direction</span><span class=\"w\"> </span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"no\">North</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"no\">East</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"no\">South</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"no\">West</span><span class=\"o\">]</span>\n<span class=\"no\">Robot</span><span class=\"w\"> </span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"no\">Dec</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"no\">Dec</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">direction</span><span class=\"w\"> </span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"no\">Direction</span><span class=\"w\"> </span><span class=\"p\">}</span>\n\n<span class=\"n\">move</span><span class=\"w\"> </span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"no\">Robot</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"no\">Str</span><span class=\"w\"> </span><span class=\"o\">-&gt;</span><span class=\"w\"> </span><span class=\"no\">Robot</span>\n<span class=\"n\">move</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"o\">|</span><span class=\"n\">robot</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">instructions</span><span class=\"o\">|</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">    </span><span class=\"no\">Str</span><span class=\"o\">.</span><span class=\"n\">to_utf8</span><span class=\"p\">(</span><span class=\"n\">instructions</span><span class=\"p\">)</span>\n<span class=\"w\">        </span><span class=\"o\">.</span><span class=\"n\">fold</span><span class=\"p\">(</span>\n<span class=\"w\">            </span><span class=\"n\">robot</span><span class=\"p\">,</span>\n<span class=\"w\">            </span><span class=\"o\">|</span><span class=\"n\">robot_state</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">robot_move</span><span class=\"o\">|</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">                </span><span class=\"n\">match</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">robot_move</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">                    </span><span class=\"s1\">'A'</span><span class=\"w\"> </span><span class=\"o\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">robot_state</span><span class=\"o\">-&gt;</span><span class=\"n\">advance</span><span class=\"p\">()</span>\n<span class=\"w\">                    </span><span class=\"s1\">'L'</span><span class=\"w\"> </span><span class=\"o\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">robot_state</span><span class=\"o\">-&gt;</span><span class=\"n\">turn</span><span class=\"p\">(</span><span class=\"no\">Left</span><span class=\"p\">)</span>\n<span class=\"w\">                    </span><span class=\"s1\">'R'</span><span class=\"w\"> </span><span class=\"o\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">robot_state</span><span class=\"o\">-&gt;</span><span class=\"n\">turn</span><span class=\"p\">(</span><span class=\"no\">Right</span><span class=\"p\">)</span>\n<span class=\"w\">                </span><span class=\"p\">}</span>\n<span class=\"w\">            </span><span class=\"p\">},</span>\n<span class=\"w\">        </span><span class=\"p\">)</span>\n<span class=\"p\">}</span>\n\n<span class=\"n\">advance</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"o\">|</span><span class=\"n\">robot</span><span class=\"o\">|</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">    </span><span class=\"n\">match</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">robot</span><span class=\"o\">.</span><span class=\"n\">direction</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">        </span><span class=\"no\">North</span><span class=\"w\"> </span><span class=\"o\">=&gt;</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\"> </span><span class=\"o\">..</span><span class=\"n\">robot</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"ss\">y</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"n\">robot</span><span class=\"o\">.</span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"o\">+</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"p\">}</span>\n<span class=\"w\">        </span><span class=\"no\">South</span><span class=\"w\"> </span><span class=\"o\">=&gt;</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\"> </span><span class=\"o\">..</span><span class=\"n\">robot</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"ss\">y</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"n\">robot</span><span class=\"o\">.</span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"p\">}</span>\n<span class=\"w\">        </span><span class=\"no\">East</span><span class=\"w\"> </span><span class=\"o\">=&gt;</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\"> </span><span class=\"o\">..</span><span class=\"n\">robot</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"ss\">x</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"n\">robot</span><span class=\"o\">.</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">+</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"p\">}</span>\n<span class=\"w\">        </span><span class=\"no\">West</span><span class=\"w\"> </span><span class=\"o\">=&gt;</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\"> </span><span class=\"o\">..</span><span class=\"n\">robot</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"ss\">x</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"n\">robot</span><span class=\"o\">.</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"p\">}</span>\n<span class=\"w\">    </span><span class=\"p\">}</span>\n<span class=\"p\">}</span>\n\n<span class=\"n\">turn</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"o\">|</span><span class=\"n\">robot</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">left_or_right</span><span class=\"o\">|</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">    </span><span class=\"n\">match</span><span class=\"w\"> </span><span class=\"p\">((</span><span class=\"n\">robot</span><span class=\"o\">.</span><span class=\"n\">direction</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">left_or_right</span><span class=\"p\">))</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">        </span><span class=\"p\">(</span><span class=\"no\">North</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"no\">Left</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"o\">=&gt;</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\"> </span><span class=\"o\">..</span><span class=\"n\">robot</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"ss\">direction</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"no\">West</span><span class=\"w\"> </span><span class=\"p\">}</span>\n<span class=\"w\">        </span><span class=\"p\">(</span><span class=\"no\">North</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"no\">Right</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"o\">=&gt;</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\"> </span><span class=\"o\">..</span><span class=\"n\">robot</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"ss\">direction</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"no\">East</span><span class=\"w\"> </span><span class=\"p\">}</span>\n\n<span class=\"w\">        </span><span class=\"p\">(</span><span class=\"no\">East</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"no\">Left</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"o\">=&gt;</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\"> </span><span class=\"o\">..</span><span class=\"n\">robot</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"ss\">direction</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"no\">North</span><span class=\"w\"> </span><span class=\"p\">}</span>\n<span class=\"w\">        </span><span class=\"p\">(</span><span class=\"no\">East</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"no\">Right</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"o\">=&gt;</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\"> </span><span class=\"o\">..</span><span class=\"n\">robot</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"ss\">direction</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"no\">South</span><span class=\"w\"> </span><span class=\"p\">}</span>\n\n<span class=\"w\">        </span><span class=\"p\">(</span><span class=\"no\">South</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"no\">Left</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"o\">=&gt;</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\"> </span><span class=\"o\">..</span><span class=\"n\">robot</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"ss\">direction</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"no\">East</span><span class=\"w\"> </span><span class=\"p\">}</span>\n<span class=\"w\">        </span><span class=\"p\">(</span><span class=\"no\">South</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"no\">Right</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"o\">=&gt;</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\"> </span><span class=\"o\">..</span><span class=\"n\">robot</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"ss\">direction</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"no\">West</span><span class=\"w\"> </span><span class=\"p\">}</span>\n\n<span class=\"w\">        </span><span class=\"p\">(</span><span class=\"no\">West</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"no\">Left</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"o\">=&gt;</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\"> </span><span class=\"o\">..</span><span class=\"n\">robot</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"ss\">direction</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"no\">South</span><span class=\"w\"> </span><span class=\"p\">}</span>\n<span class=\"w\">        </span><span class=\"p\">(</span><span class=\"no\">West</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"no\">Right</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"o\">=&gt;</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\"> </span><span class=\"o\">..</span><span class=\"n\">robot</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"ss\">direction</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"no\">North</span><span class=\"w\"> </span><span class=\"p\">}</span>\n<span class=\"w\">    </span><span class=\"p\">}</span>\n<span class=\"p\">}</span>\n\n<span class=\"n\">main!</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"o\">||</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">    </span><span class=\"n\">dbg</span><span class=\"w\"> </span><span class=\"n\">move</span><span class=\"p\">({</span><span class=\"w\"> </span><span class=\"ss\">x</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"mi\">7</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"ss\">y</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"mi\">3</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"ss\">direction</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"no\">North</span><span class=\"w\"> </span><span class=\"p\">},</span><span class=\"w\"> </span><span class=\"s2\">\"RAALAL\"</span><span class=\"p\">)</span>\n<span class=\"p\">}</span>\n</code></pre></div>\n<p>Well first, I'm not parsing the instructions string : so I should get an unexhaustive match error. But I don't.</p>\n<p>If you replace <code>Str.to_utf8(instructions)</code> by <code>instructions.to_utf8()</code> : you get an error =&gt; <code>Roc crashed: str_to_utf8 requires return type info</code></p>\n<p>If you replace <code>Dec</code> by <code>I64</code>, you get an error =&gt;</p>\n<div class=\"codehilite\"><pre><span></span><code>thread 111198 panic: access of union field &#39;int&#39; while field &#39;dec&#39; is active\n/home/user/roc/src/eval/interpreter.zig:1992:55: 0x5c9ae8 in callLowLevelBuiltin (mod.zig)\n                    .int =&gt; |l| try out.setInt(l + rhs.int),\n                                                      ^\n/home/user/roc/src/eval/interpreter.zig:10153:62: 0x621767 in applyContinuation (mod.zig)\n                    var result = try self.callLowLevelBuiltin(low_level.op, &amp;args, roc_ops, null);\n                                                             ^\n/home/user/roc/src/eval/interpreter.zig:6769:71: 0x418440 in evalWithExpectedType (mod.zig)\n                    const should_continue = try self.applyContinuation(&amp;work_stack, &amp;value_stack, cont, roc_ops);\n                                                                      ^\n/home/user/roc/src/eval/interpreter.zig:464:59: 0x3bf1f7 in evaluateExpression (mod.zig)\n            const result_value = self.evalWithExpectedType(header.body_idx, roc_ops, null) catch |err| {\n                                                          ^\n/home/user/roc/src/interpreter_shim/main.zig:169:39: 0x3a0c55 in evaluateFromSharedMemory (main.zig)\n    try interpreter.evaluateExpression(expr_idx, ret_ptr, roc_ops, arg_ptr);\n                                      ^\n/home/user/roc/src/interpreter_shim/main.zig:68:29: 0x3a000e in roc_entrypoint (main.zig)\n    evaluateFromSharedMemory(entry_idx, ops, ret_ptr, arg_ptr) catch |err| {\n                            ^\n/home/user/roc/test/fx/platform/host.zig:202:23: 0x27c57f in platform_main (host.zig)\n    roc__main_for_host(&amp;roc_ops, @as(*anyopaque, @ptrCast(&amp;ret)), @as(*anyopaque, @ptrCast(&amp;args)));\n                      ^\n/home/user/roc/test/fx/platform/host.zig:85:18: 0x27c708 in main (host.zig)\n    platform_main() catch |err| {\n                 ^\nsrc/env/__libc_start_main.c:95:2: 0x95907c in libc_start_main_stage2 (src/env/__libc_start_main.c)\nUnwind error at address `exe:0x95907c` (error.MissingFDE), trace may be incomplete\n\n???:?:?: 0x0 in ??? (???)\nerror: Child process /home/user/.cache/roc/f5270dd847a7a6c61bb1e95f0925684e/temp/roc-tmp-gWEfXWyUa3joiowSwIiGq8mgzL880aKs/roc_run_3406543992 killed by signal: 6\nerror: Child process aborted (SIGABRT)\n</code></pre></div>\n<p>Also, not an error but a question : what's the replacement of record optional fields, I forgot ?</p>\n<p>Thanks, amazing work !</p>",
        "id": 560978085,
        "sender_full_name": "Astating",
        "timestamp": 1764488734
    },
    {
        "content": "<p>I can address part of this, although we don't yet have exhaustiveness checking implemented yet, and realistically won't have it in time for Advent of Code <span aria-label=\"smile\" class=\"emoji emoji-1f604\" role=\"img\" title=\"smile\">:smile:</span></p>",
        "id": 561019906,
        "sender_full_name": "Richard Feldman",
        "timestamp": 1764526205
    },
    {
        "content": "<p>fix for the <code>instructions.to_utf8()</code> part: <a href=\"https://github.com/roc-lang/roc/pull/8514\">https://github.com/roc-lang/roc/pull/8514</a></p>",
        "id": 561021253,
        "sender_full_name": "Richard Feldman",
        "timestamp": 1764527437
    },
    {
        "content": "<p>Hello !</p>\n<p>I stumbled upon <a href=\"https://gist.github.com/rtfeldman/f46bcbfe5132d62c4095dfa687bb9aa4\">Roc's New Compiler for Advent of Code 2025</a> today but  I cannot get the hello world snippet to compile because of a segfault.</p>\n<p>I'm using Ubuntu 24.04.3 (x86_64), I downloaded <a href=\"https://github.com/roc-lang/nightlies/releases/tag/nightly-2025-November-30-77e8bbc\">the nightly build of today</a> and here is the output:</p>\n<div class=\"codehilite\"><pre><span></span><code>❯ ./roc version\nRoc compiler version release-fast-77e8bbc1\n\n❯ ./roc app.roc\nerror: Child process /home/.cache/roc/eeb72bc7915352738b41dafe7bc88401/temp/roc-tmp-2ec6QLmttmiRNiAvuG7tvzbfwtzEQqBA/roc_run_1662736024 killed by signal: 11\nerror: Child process crashed with segmentation fault (SIGSEGV)\n\n❯ cat /home/.cache/roc/eeb72bc7915352738b41dafe7bc88401/temp/roc-tmp-2ec6QLmttmiRNiAvuG7tvzbfwtzEQqBA/roc_run_1662736024\nELF&gt;@8@8@@@ @ �  Q�tdzRx\n                       Linker: LLD 20.1.2 (https://github.com/roc-lang/roc-bootstrap fe08b059a848f15dc43b2f23e2c0a500360356c9)����(��.eh_frame.comment.symtab.shstrtab.strtabroc_platform_shimroc_interpreter_shimcompiler_rt� �\n                                                               0hp�.&amp;�4\n</code></pre></div>\n<p>I would love to give more detail about the error but I don't know how to right now ^^</p>\n<p>Any ideas ?</p>\n<p>Have a nice day !</p>",
        "id": 561021537,
        "sender_full_name": "ducdetronquitp",
        "timestamp": 1764527678
    },
    {
        "content": "<p>Can you try again with latest main? I think that error is fixed now. So <code>zig build roc</code>, <code>./zig-out/bin/roc app.roc</code></p>",
        "id": 561023210,
        "sender_full_name": "Anton",
        "timestamp": 1764529256
    },
    {
        "content": "<p>I tried the same on latest <code>main</code> (<code>6a1585d9132bd14360f0475eabe0d6e99a03157f</code>) and get:</p>\n<div class=\"codehilite\"><pre><span></span><code>./zig-out/bin/roc test/fx/appc.roc\nerror: Child process /home/niclas/.cache/roc/8c41db55289d8fdb9fc8557b96c7b123/temp/roc-tmp-ufrkqUSBk3CqRzmIeoPi7r1rrr5sFltU/roc_run_349899816 killed by signal: 11\nerror: Child process crashed with segmentation fault (SIGSEGV)\n</code></pre></div>\n<p>The Hello World is from here: <a href=\"https://gist.github.com/rtfeldman/f46bcbfe5132d62c4095dfa687bb9aa4\">https://gist.github.com/rtfeldman/f46bcbfe5132d62c4095dfa687bb9aa4</a></p>\n<div class=\"codehilite\" data-code-language=\"Ruby\"><pre><span></span><code><span class=\"n\">app</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">main!</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\"> </span><span class=\"ss\">pf</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"n\">platform</span><span class=\"w\"> </span><span class=\"s2\">\"https://github.com/lukewilliamboswell/roc-platform-template-zig/releases/download/0.1-test/7iDKk44no3gF9Nrh2VyF8Y5yvy1jUBhrbhHURN1WQptB.tar.zst\"</span><span class=\"w\"> </span><span class=\"p\">}</span>\n\n<span class=\"n\">import</span><span class=\"w\"> </span><span class=\"n\">pf</span><span class=\"o\">.</span><span class=\"n\">Stdout</span>\n\n<span class=\"n\">main!</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"o\">|</span><span class=\"n\">_args</span><span class=\"o\">|</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">    </span><span class=\"no\">Stdout</span><span class=\"o\">.</span><span class=\"n\">line!</span><span class=\"p\">(</span><span class=\"s2\">\"Hello, World!\"</span><span class=\"p\">)</span>\n<span class=\"w\">    </span><span class=\"no\">Ok</span><span class=\"p\">({})</span>\n<span class=\"p\">}</span>\n</code></pre></div>\n<p><del>It's not just that snippet though, I get the same result with <code>test/fx/app.roc</code>.</del></p>\n<p>NixOS x86, ran <code>git clean -dfx</code> before building.</p>",
        "id": 561023828,
        "sender_full_name": "Niclas Ahden",
        "timestamp": 1764529538
    },
    {
        "content": "<p>Might be worth clearing the cached app as well in case it is bugged: <code>rm -rf /home/niclas/.cache/roc/8c41db55289d8fdb9fc8557b96c7b123</code></p>",
        "id": 561025123,
        "sender_full_name": "Brendan Hansknecht",
        "timestamp": 1764530641
    },
    {
        "content": "<p>I deleted the whole cache (<code>rm -rf /home/niclas/.cache/roc</code>) and re-ran with the same result</p>",
        "id": 561025175,
        "sender_full_name": "Niclas Ahden",
        "timestamp": 1764530679
    },
    {
        "content": "<p>After clearing the Roc cache (and <code>git clean -dfx</code> again for good measure) I no longer segfault when running the built-in example, <code>./zig-out/bin/roc test/fx/app.roc </code>. Now I get:</p>\n<div class=\"codehilite\"><pre><span></span><code>error: Failed to resolve platform spec &#39;./platform/main.roc&#39;: error.PlatformNotSupported\n</code></pre></div>\n<p>But the hello world snippet still gives:</p>\n<div class=\"codehilite\"><pre><span></span><code>./zig-out/bin/roc test/fx/appc.roc\nerror: Child process /home/niclas/.cache/roc/8c41db55289d8fdb9fc8557b96c7b123/temp/roc-tmp-8ME9qm3IFOEZKp2Fc77x6gEUOLIe31E5/roc_run_349899816 killed by signal: 11\nerror: Child process crashed with segmentation fault (SIGSEGV)\n</code></pre></div>",
        "id": 561025634,
        "sender_full_name": "Niclas Ahden",
        "timestamp": 1764531107
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"361169\">Anton</span> <a href=\"#narrow/channel/358903-advent-of-code/topic/Howto.202025/near/561023210\">said</a>:</p>\n<blockquote>\n<p>Can you try again with latest main? I think that error is fixed now. So <code>zig build roc</code>, <code>./zig-out/bin/roc app.roc</code></p>\n</blockquote>\n<p>Hey Anton,</p>\n<p>Thanks for the answer !</p>\n<p>I built the main branch of roc with zig 0.15.2 and the hello world snippet still segfault:</p>\n<div class=\"codehilite\"><pre><span></span><code>❯ ./roc/zig-out/bin/roc version\nRoc compiler version debug-6a1585d9\n\n~/tools\n❯ ./roc/zig-out/bin/roc app.roc\nerror: Child process /home/.cache/roc/8c41db55289d8fdb9fc8557b96c7b123/temp/roc-tmp-VSWr14wnLgGfgOewpkXp506M6pHXJBSu/roc_run_1662736024 killed by signal: 11\nerror: Child process crashed with segmentation fault (SIGSEGV)\n</code></pre></div>\n<p>If it helps, I send the resulting executable as attachment: it's way larger than my previous attempt.<br>\n<a href=\"/user_uploads/22008/UOGOVxEx0kFwkQOSsUbMgbbw/roc_run_1662736024\">roc_run_1662736024</a></p>",
        "id": 561029643,
        "sender_full_name": "ducdetronquitp",
        "timestamp": 1764534587
    },
    {
        "content": "<p>I'm on linux x86_64 and getting a segfault also with the hello world snippet from the gist</p>\n<ul>\n<li>using the zig template platform</li>\n<li>built compiler from src, <code>Roc compiler version debug-5e229e20</code></li>\n</ul>\n<p>I believe I also tried using the fx platform at some time in the past and got a similar </p>\n<div class=\"codehilite\"><pre><span></span><code>error: Failed to resolve platform spec &#39;./platform/main.roc&#39;: error.PlatformNotSupported\n</code></pre></div>\n<p>as above, also.</p>",
        "id": 561154908,
        "sender_full_name": "walther",
        "timestamp": 1764594736
    },
    {
        "content": "<p>I've done some mucking around with the zig template platform, but was unable to get it to work (still sigsev). But, I was able to get the fx platform to work. Which I think is enough to do the experimenting I want to do right now.</p>",
        "id": 561182261,
        "sender_full_name": "walther",
        "timestamp": 1764600722
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"524503\">Niclas Ahden</span> <a href=\"#narrow/channel/358903-advent-of-code/topic/Howto.202025/near/561023828\">said</a>:</p>\n<blockquote>\n<p>I tried the same on latest <code>main</code> (<code>6a1585d9132bd14360f0475eabe0d6e99a03157f</code>) and get:</p>\n<div class=\"codehilite\"><pre><span></span><code>./zig-out/bin/roc test/fx/appc.roc\nerror: Child process /home/niclas/.cache/roc/8c41db55289d8fdb9fc8557b96c7b123/temp/roc-tmp-ufrkqUSBk3CqRzmIeoPi7r1rrr5sFltU/roc_run_349899816 killed by signal: 11\nerror: Child process crashed with segmentation fault (SIGSEGV)\n</code></pre></div>\n<p>The Hello World is from here: <a href=\"https://gist.github.com/rtfeldman/f46bcbfe5132d62c4095dfa687bb9aa4\">https://gist.github.com/rtfeldman/f46bcbfe5132d62c4095dfa687bb9aa4</a></p>\n<div class=\"codehilite\" data-code-language=\"Ruby\"><pre><span></span><code><span class=\"n\">app</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">main!</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\"> </span><span class=\"ss\">pf</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"n\">platform</span><span class=\"w\"> </span><span class=\"s2\">\"https://github.com/lukewilliamboswell/roc-platform-template-zig/releases/download/0.1-test/7iDKk44no3gF9Nrh2VyF8Y5yvy1jUBhrbhHURN1WQptB.tar.zst\"</span><span class=\"w\"> </span><span class=\"p\">}</span>\n\n<span class=\"n\">import</span><span class=\"w\"> </span><span class=\"n\">pf</span><span class=\"o\">.</span><span class=\"n\">Stdout</span>\n\n<span class=\"n\">main!</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"o\">|</span><span class=\"n\">_args</span><span class=\"o\">|</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">    </span><span class=\"no\">Stdout</span><span class=\"o\">.</span><span class=\"n\">line!</span><span class=\"p\">(</span><span class=\"s2\">\"Hello, World!\"</span><span class=\"p\">)</span>\n<span class=\"w\">    </span><span class=\"no\">Ok</span><span class=\"p\">({})</span>\n<span class=\"p\">}</span>\n</code></pre></div>\n<p><del>It's not just that snippet though, I get the same result with <code>test/fx/app.roc</code>.</del></p>\n<p>NixOS x86, ran <code>git clean -dfx</code> before building.</p>\n</blockquote>\n<p>I was able to reproduce this</p>",
        "id": 561206660,
        "sender_full_name": "Anton",
        "timestamp": 1764605671
    },
    {
        "content": "<p>I reproduced both issues on the latest commit (<code>2ac12ee62127e86e54efba4942b063719add7585</code>):</p>\n<div class=\"codehilite\"><pre><span></span><code>$ zig build roc\nCleared roc cache at /home/niclas/.cache/roc\n$ ./zig-out/bin/roc test/fx/app.roc\nerror: Failed to resolve platform spec &#39;./platform/main.roc&#39;: error.PlatformNotSupported\n\n# Paste the Hello World snippet into appc.roc\n$ v test/fx/appc.roc\n$ ./zig-out/bin/roc test/fx/appc.roc\nerror: Child process /home/niclas/.cache/roc/098d65273b3e7fea486849c277601edd/temp/roc-tmp-ed0z1y0nLSGpmXqLhaHQ1DDSLnhYbU8R/roc_run_349899816 killed by signal: 11\nerror: Child process crashed with segmentation fault (SIGSEGV)\n</code></pre></div>",
        "id": 561209118,
        "sender_full_name": "Niclas Ahden",
        "timestamp": 1764606192
    },
    {
        "content": "<p>it would be great to get some ci around this, since we seem to have had it working and then redressed it without a CI failure letting us know <span aria-label=\"smile\" class=\"emoji emoji-1f604\" role=\"img\" title=\"smile\">:smile:</span></p>",
        "id": 561211145,
        "sender_full_name": "Richard Feldman",
        "timestamp": 1764606516
    },
    {
        "content": "<p>Yeah, I'll get on that</p>",
        "id": 561211653,
        "sender_full_name": "Anton",
        "timestamp": 1764606623
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"524503\">@Niclas Ahden</span>, does your appc.roc still contain the platform url?</p>",
        "id": 561211744,
        "sender_full_name": "Anton",
        "timestamp": 1764606644
    },
    {
        "content": "<p>Yes, exactly the text in the reply you quoted</p>",
        "id": 561211965,
        "sender_full_name": "Niclas Ahden",
        "timestamp": 1764606694
    },
    {
        "content": "<p>As a temporary workaround; please work inside the repo with the test/fx platform there, but run <code>zig build test</code> first.<br>\nYou can modify the app.roc here and then run it with ./zig-out/bin/roc app.roc<br>\n<a href=\"https://github.com/roc-lang/roc/blob/2ac12ee62127e86e54efba4942b063719add7585/test/fx/app.roc#L1\">https://github.com/roc-lang/roc/blob/2ac12ee62127e86e54efba4942b063719add7585/test/fx/app.roc#L1</a></p>",
        "id": 561213484,
        "sender_full_name": "Anton",
        "timestamp": 1764607001
    },
    {
        "content": "<p>Confirming that running <code>zig build test</code> did solve the <code>PlatformNotSupported</code> issue. I can now:</p>\n<div class=\"codehilite\"><pre><span></span><code>./zig-out/bin/roc test/fx/app.roc\nHello from stdout!\nLine 1 to stdout\nLine 2 to stderr\nLine 3 to stdout\nError from stderr!\n</code></pre></div>\n<p>(the Hello World example (<code>appc.roc</code>) still segfaults)</p>",
        "id": 561214232,
        "sender_full_name": "Niclas Ahden",
        "timestamp": 1764607147
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"524503\">Niclas Ahden</span> <a href=\"#narrow/channel/358903-advent-of-code/topic/Howto.202025/near/561209118\">said</a>:</p>\n<blockquote>\n<p>I reproduced both issues on the latest commit (<code>2ac12ee62127e86e54efba4942b063719add7585</code>):</p>\n<p><div class=\"codehilite\"><pre><span></span><code>$ zig build roc\nCleared roc cache at /home/niclas/.cache/roc\n$ ./zig-out/bin/roc test/fx/app.roc\nerror: Failed to resolve platform spec &#39;./platform/main.roc&#39;: error.PlatformNotSupported\n\n# Paste the Hello World snippet into appc.roc\n$ v test/fx/appc.roc\n$ ./zig-out/bin/roc test/fx/appc.roc\nerror: Child process /home/niclas/.cache/roc/098d65273b3e7fea486849c277601edd/temp/roc-tmp-ed0z1y0nLSGpmXqLhaHQ1DDSLnhYbU8R/roc_run_349899816 killed by signal: 11\nerror: Child process crashed with segmentation fault (SIGSEGV)\n</code></pre></div><br>\n</p>\n</blockquote>\n<p>This is a hard one, I have a good guess what's going wrong, will continue tomorrow...</p>",
        "id": 561283244,
        "sender_full_name": "Anton",
        "timestamp": 1764626201
    },
    {
        "content": "<p>I solved the core issue in <a href=\"https://github.com/lukewilliamboswell/roc-platform-template-zig/pull/13\">https://github.com/lukewilliamboswell/roc-platform-template-zig/pull/13</a>, still trying to fix a memory leak in examples/echo.roc</p>",
        "id": 561450269,
        "sender_full_name": "Anton",
        "timestamp": 1764690312
    }
]