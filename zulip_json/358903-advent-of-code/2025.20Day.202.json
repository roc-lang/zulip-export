[
    {
        "content": "<p>With the recent fixes, and the incoming one in <a href=\"https://github.com/roc-lang/roc/pull/8573\">https://github.com/roc-lang/roc/pull/8573</a>, I now have a correct AoC day 2!<br>\nWell almost ^^. Actually it’s correct with the demo short inputs, but I’m getting a stack overflow with the real inputs. But I’m pretty confident that it would be correct without the stack overflow because I’m getting the correct results for the demo values and the code is essentially the same as my valid Julia solution.</p>\n<div class=\"codehilite\" data-code-language=\"Bash\"><pre><span></span><code>❯<span class=\"w\"> </span>roc<span class=\"w\"> </span>day02.roc\nPart<span class=\"w\"> </span><span class=\"m\">1</span><span class=\"w\"> </span><span class=\"o\">(</span>demo<span class=\"o\">)</span>:<span class=\"w\"> </span><span class=\"m\">1227775554</span>\nPart<span class=\"w\"> </span><span class=\"m\">2</span><span class=\"w\"> </span><span class=\"o\">(</span>demo<span class=\"o\">)</span>:<span class=\"w\"> </span><span class=\"m\">4174379265</span>\n</code></pre></div>\n<p>The code is here for those interested:</p>\n<div class=\"spoiler-block\"><div class=\"spoiler-header\">\n<p>AoC 2025 day 2</p>\n</div><div class=\"spoiler-content\" aria-hidden=\"true\">\n<div class=\"codehilite\" data-code-language=\"Ruby\"><pre><span></span><code><span class=\"n\">app</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">main!</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\"> </span><span class=\"ss\">pf</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"n\">platform</span><span class=\"w\"> </span><span class=\"s2\">\"https://github.com/lukewilliamboswell/roc-platform-template-zig/releases/download/0.1-test/7iDKk44no3gF9Nrh2VyF8Y5yvy1jUBhrbhHURN1WQptB.tar.zst\"</span><span class=\"w\"> </span><span class=\"p\">}</span>\n\n<span class=\"n\">import</span><span class=\"w\"> </span><span class=\"n\">pf</span><span class=\"o\">.</span><span class=\"n\">Stdout</span>\n<span class=\"n\">import</span><span class=\"w\"> </span><span class=\"n\">pf</span><span class=\"o\">.</span><span class=\"n\">Stderr</span>\n\n<span class=\"n\">demo_input</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"s2\">\"11-22,95-115,998-1012,1188511880-1188511890,222220-222224,1698522-1698528,446443-446449,38593856-38593862,565653-565659,824824821-824824827,2121212118-2121212124\"</span>\n\n<span class=\"n\">day_input</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">demo_input</span><span class=\"w\"> </span><span class=\"c1\"># TODO: copy actual input here</span>\n\n<span class=\"nb\">print</span><span class=\"o\">!</span><span class=\"w\"> </span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"no\">Str</span><span class=\"w\"> </span><span class=\"o\">=&gt;</span><span class=\"w\"> </span><span class=\"p\">{}</span>\n<span class=\"nb\">print</span><span class=\"o\">!</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"o\">|</span><span class=\"n\">msg</span><span class=\"o\">|</span><span class=\"w\"> </span><span class=\"n\">msg</span><span class=\"o\">.</span><span class=\"n\">split_on</span><span class=\"p\">(</span><span class=\"s2\">\"</span><span class=\"se\">\\n</span><span class=\"s2\">\"</span><span class=\"p\">)</span><span class=\"o\">.</span><span class=\"n\">for_each!</span><span class=\"p\">(</span><span class=\"no\">Stdout</span><span class=\"o\">.</span><span class=\"n\">line!</span><span class=\"p\">)</span>\n\n\n<span class=\"n\">parse_range</span><span class=\"w\"> </span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"no\">Str</span><span class=\"w\"> </span><span class=\"o\">-&gt;</span><span class=\"w\"> </span><span class=\"no\">Try</span><span class=\"p\">((</span><span class=\"no\">I64</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"no\">I64</span><span class=\"p\">),</span><span class=\"w\"> </span><span class=\"n\">_</span><span class=\"p\">)</span>\n<span class=\"n\">parse_range</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"o\">|</span><span class=\"n\">range_str</span><span class=\"o\">|</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">    </span><span class=\"n\">match</span><span class=\"w\"> </span><span class=\"n\">range_str</span><span class=\"o\">.</span><span class=\"n\">split_on</span><span class=\"p\">(</span><span class=\"s2\">\"-\"</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">        </span><span class=\"o\">[</span><span class=\"n\">a</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">=&gt;</span><span class=\"w\"> </span><span class=\"no\">Ok</span><span class=\"p\">((</span><span class=\"no\">I64</span><span class=\"o\">.</span><span class=\"n\">from_str</span><span class=\"p\">(</span><span class=\"n\">a</span><span class=\"p\">)</span><span class=\"sc\">?,</span><span class=\"w\"> </span><span class=\"no\">I64</span><span class=\"o\">.</span><span class=\"n\">from_str</span><span class=\"p\">(</span><span class=\"n\">b</span><span class=\"p\">)</span><span class=\"sc\">?)</span><span class=\"p\">)</span>\n<span class=\"w\">        </span><span class=\"n\">_</span><span class=\"w\"> </span><span class=\"o\">=&gt;</span><span class=\"w\"> </span><span class=\"no\">Err</span><span class=\"p\">(</span><span class=\"no\">InvalidRangeFormat</span><span class=\"p\">)</span>\n<span class=\"w\">    </span><span class=\"p\">}</span>\n<span class=\"p\">}</span>\n\n\n<span class=\"n\">is_invalid</span><span class=\"w\"> </span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"no\">I64</span><span class=\"w\"> </span><span class=\"o\">-&gt;</span><span class=\"w\"> </span><span class=\"no\">Bool</span>\n<span class=\"n\">is_invalid</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"o\">|</span><span class=\"n\">x</span><span class=\"o\">|</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">    </span><span class=\"n\">s</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"o\">.</span><span class=\"n\">to_str</span><span class=\"p\">()</span><span class=\"o\">.</span><span class=\"n\">to_utf8</span><span class=\"p\">()</span>\n<span class=\"w\">    </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">s</span><span class=\"o\">.</span><span class=\"n\">len</span><span class=\"p\">()</span>\n<span class=\"w\">    </span><span class=\"n\">mid</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"sr\">//</span><span class=\"w\"> </span><span class=\"mi\">2</span>\n\n<span class=\"w\">    </span><span class=\"n\">left</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">s</span><span class=\"o\">.</span><span class=\"n\">sublist</span><span class=\"p\">({</span><span class=\"w\"> </span><span class=\"ss\">start</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"ss\">len</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"n\">mid</span><span class=\"w\"> </span><span class=\"p\">})</span>\n<span class=\"w\">    </span><span class=\"n\">right</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">s</span><span class=\"o\">.</span><span class=\"n\">sublist</span><span class=\"p\">({</span><span class=\"w\"> </span><span class=\"ss\">start</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"n\">mid</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"ss\">len</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"w\"> </span><span class=\"n\">mid</span><span class=\"w\"> </span><span class=\"p\">})</span>\n\n<span class=\"w\">    </span><span class=\"n\">left</span><span class=\"w\"> </span><span class=\"o\">==</span><span class=\"w\"> </span><span class=\"n\">right</span>\n<span class=\"p\">}</span>\n\n\n<span class=\"n\">part1!</span><span class=\"w\"> </span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"no\">Str</span><span class=\"w\"> </span><span class=\"o\">=&gt;</span><span class=\"w\"> </span><span class=\"no\">Try</span><span class=\"p\">(</span><span class=\"no\">I64</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">_</span><span class=\"p\">)</span>\n<span class=\"n\">part1!</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"o\">|</span><span class=\"n\">input</span><span class=\"o\">|</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">    </span><span class=\"n\">var</span><span class=\"w\"> </span><span class=\"vg\">$sum</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mi\">0</span>\n\n<span class=\"w\">    </span><span class=\"k\">for</span><span class=\"w\"> </span><span class=\"n\">range_str</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"n\">input</span><span class=\"o\">.</span><span class=\"n\">trim</span><span class=\"p\">()</span><span class=\"o\">.</span><span class=\"n\">split_on</span><span class=\"p\">(</span><span class=\"s2\">\",\"</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">        </span><span class=\"p\">(</span><span class=\"n\">start</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"k\">end</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">parse_range</span><span class=\"p\">(</span><span class=\"n\">range_str</span><span class=\"p\">)?</span>\n\n<span class=\"w\">        </span><span class=\"n\">var</span><span class=\"w\"> </span><span class=\"vg\">$x</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">start</span>\n<span class=\"w\">        </span><span class=\"k\">while</span><span class=\"w\"> </span><span class=\"vg\">$x</span><span class=\"w\"> </span><span class=\"o\">&lt;=</span><span class=\"w\"> </span><span class=\"k\">end</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">            </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"n\">is_invalid</span><span class=\"p\">(</span><span class=\"vg\">$x</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">                </span><span class=\"vg\">$sum</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"vg\">$sum</span><span class=\"w\"> </span><span class=\"o\">+</span><span class=\"w\"> </span><span class=\"vg\">$x</span>\n<span class=\"w\">            </span><span class=\"p\">}</span>\n<span class=\"w\">            </span><span class=\"vg\">$x</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"vg\">$x</span><span class=\"w\"> </span><span class=\"o\">+</span><span class=\"w\"> </span><span class=\"mi\">1</span>\n<span class=\"w\">        </span><span class=\"p\">}</span>\n<span class=\"w\">    </span><span class=\"p\">}</span>\n\n<span class=\"w\">    </span><span class=\"no\">Ok</span><span class=\"p\">(</span><span class=\"vg\">$sum</span><span class=\"p\">)</span>\n<span class=\"p\">}</span>\n\n\n<span class=\"n\">repeat</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"o\">|</span><span class=\"n\">list</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"o\">|</span><span class=\"w\"> </span><span class=\"n\">repeat_helper</span><span class=\"p\">(</span><span class=\"o\">[]</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">list</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"p\">)</span>\n\n<span class=\"n\">repeat_helper</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"o\">|</span><span class=\"n\">acc</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">list</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"o\">|</span><span class=\"w\"> </span><span class=\"n\">match</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">    </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"o\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">acc</span>\n<span class=\"w\">    </span><span class=\"n\">_</span><span class=\"w\"> </span><span class=\"o\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">repeat_helper</span><span class=\"p\">(</span><span class=\"n\">acc</span><span class=\"o\">.</span><span class=\"n\">concat</span><span class=\"p\">(</span><span class=\"n\">list</span><span class=\"p\">),</span><span class=\"w\"> </span><span class=\"n\">list</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"p\">)</span>\n<span class=\"p\">}</span>\n\n<span class=\"n\">has_repeating_pattern</span><span class=\"w\"> </span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"no\">I64</span><span class=\"w\"> </span><span class=\"o\">=&gt;</span><span class=\"w\"> </span><span class=\"no\">Bool</span>\n<span class=\"n\">has_repeating_pattern</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"o\">|</span><span class=\"n\">x</span><span class=\"o\">|</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">    </span><span class=\"n\">s</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"o\">.</span><span class=\"n\">to_str</span><span class=\"p\">()</span><span class=\"o\">.</span><span class=\"n\">to_utf8</span><span class=\"p\">()</span>\n<span class=\"w\">    </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">s</span><span class=\"o\">.</span><span class=\"n\">len</span><span class=\"p\">()</span>\n\n<span class=\"w\">    </span><span class=\"c1\"># Check all divisors of n</span>\n<span class=\"w\">    </span><span class=\"n\">var</span><span class=\"w\"> </span><span class=\"vg\">$d</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mi\">1</span>\n<span class=\"w\">    </span><span class=\"k\">while</span><span class=\"w\"> </span><span class=\"vg\">$d</span><span class=\"w\"> </span><span class=\"o\">&lt;=</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"sr\">//</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">        </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">%</span><span class=\"w\"> </span><span class=\"vg\">$d</span><span class=\"w\"> </span><span class=\"o\">==</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">            </span><span class=\"c1\"># Check if repeating the first d characters n/d times equals s</span>\n<span class=\"w\">            </span><span class=\"n\">slice</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">s</span><span class=\"o\">.</span><span class=\"n\">sublist</span><span class=\"p\">({</span><span class=\"w\"> </span><span class=\"ss\">start</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"ss\">len</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"vg\">$d</span><span class=\"w\"> </span><span class=\"p\">})</span>\n<span class=\"w\">            </span><span class=\"n\">repeated</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">slice</span><span class=\"o\">-&gt;</span><span class=\"n\">repeat</span><span class=\"p\">(</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"sr\">//</span><span class=\"w\"> </span><span class=\"vg\">$d</span><span class=\"p\">)</span>\n<span class=\"w\">            </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"n\">repeated</span><span class=\"w\"> </span><span class=\"o\">==</span><span class=\"w\"> </span><span class=\"n\">s</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\"> </span><span class=\"k\">return</span><span class=\"w\"> </span><span class=\"no\">True</span><span class=\"w\"> </span><span class=\"p\">}</span>\n<span class=\"w\">        </span><span class=\"p\">}</span>\n<span class=\"w\">        </span><span class=\"vg\">$d</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"vg\">$d</span><span class=\"w\"> </span><span class=\"o\">+</span><span class=\"w\"> </span><span class=\"mi\">1</span>\n<span class=\"w\">    </span><span class=\"p\">}</span>\n\n<span class=\"w\">    </span><span class=\"no\">False</span>\n<span class=\"p\">}</span>\n\n\n<span class=\"n\">part2!</span><span class=\"w\"> </span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"no\">Str</span><span class=\"w\"> </span><span class=\"o\">=&gt;</span><span class=\"w\"> </span><span class=\"no\">Try</span><span class=\"p\">(</span><span class=\"no\">I64</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">_</span><span class=\"p\">)</span>\n<span class=\"n\">part2!</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"o\">|</span><span class=\"n\">input</span><span class=\"o\">|</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">    </span><span class=\"n\">var</span><span class=\"w\"> </span><span class=\"vg\">$sum</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mi\">0</span>\n\n<span class=\"w\">    </span><span class=\"k\">for</span><span class=\"w\"> </span><span class=\"n\">range_str</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"n\">input</span><span class=\"o\">.</span><span class=\"n\">trim</span><span class=\"p\">()</span><span class=\"o\">.</span><span class=\"n\">split_on</span><span class=\"p\">(</span><span class=\"s2\">\",\"</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">        </span><span class=\"p\">(</span><span class=\"n\">start</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"k\">end</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">parse_range</span><span class=\"p\">(</span><span class=\"n\">range_str</span><span class=\"p\">)?</span>\n\n<span class=\"w\">        </span><span class=\"n\">var</span><span class=\"w\"> </span><span class=\"vg\">$x</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">start</span>\n<span class=\"w\">        </span><span class=\"k\">while</span><span class=\"w\"> </span><span class=\"vg\">$x</span><span class=\"w\"> </span><span class=\"o\">&lt;=</span><span class=\"w\"> </span><span class=\"k\">end</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">            </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"n\">has_repeating_pattern</span><span class=\"p\">(</span><span class=\"vg\">$x</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">                </span><span class=\"vg\">$sum</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"vg\">$sum</span><span class=\"w\"> </span><span class=\"o\">+</span><span class=\"w\"> </span><span class=\"vg\">$x</span>\n<span class=\"w\">            </span><span class=\"p\">}</span>\n<span class=\"w\">            </span><span class=\"vg\">$x</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"vg\">$x</span><span class=\"w\"> </span><span class=\"o\">+</span><span class=\"w\"> </span><span class=\"mi\">1</span>\n<span class=\"w\">        </span><span class=\"p\">}</span>\n<span class=\"w\">    </span><span class=\"p\">}</span>\n\n<span class=\"w\">    </span><span class=\"no\">Ok</span><span class=\"p\">(</span><span class=\"vg\">$sum</span><span class=\"p\">)</span>\n<span class=\"p\">}</span>\n\n\n<span class=\"n\">run!</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"o\">||</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">    </span><span class=\"nb\">print</span><span class=\"o\">!</span><span class=\"p\">(</span><span class=\"s2\">\"Part 1 (demo): ${part1!(demo_input.trim())?.to_str()}\"</span><span class=\"p\">)</span>\n<span class=\"w\">    </span><span class=\"c1\">#print!(\"Part 1: ${part1!(day_input.trim())?.to_str()}\")</span>\n<span class=\"w\">    </span><span class=\"nb\">print</span><span class=\"o\">!</span><span class=\"p\">(</span><span class=\"s2\">\"Part 2 (demo): ${part2!(demo_input.trim())?.to_str()}\"</span><span class=\"p\">)</span>\n<span class=\"w\">    </span><span class=\"c1\">#print!(\"Part 2: ${part2!(day_input.trim())?.to_str()}\")</span>\n<span class=\"w\">    </span><span class=\"no\">Ok</span><span class=\"p\">({})</span>\n<span class=\"p\">}</span>\n\n\n<span class=\"n\">main!</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"o\">|</span><span class=\"n\">_args</span><span class=\"o\">|</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">    </span><span class=\"n\">match</span><span class=\"w\"> </span><span class=\"n\">run!</span><span class=\"p\">()</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">        </span><span class=\"no\">Ok</span><span class=\"p\">(</span><span class=\"n\">_</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"o\">=&gt;</span><span class=\"w\"> </span><span class=\"no\">Ok</span><span class=\"p\">({})</span>\n<span class=\"w\">        </span><span class=\"no\">Err</span><span class=\"p\">(</span><span class=\"n\">_</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"o\">=&gt;</span><span class=\"w\"> </span><span class=\"no\">Err</span><span class=\"p\">(</span><span class=\"mi\">1</span><span class=\"p\">)</span>\n<span class=\"w\">    </span><span class=\"p\">}</span>\n<span class=\"p\">}</span>\n</code></pre></div>\n</div></div>",
        "id": 561987350,
        "sender_full_name": "Matthieu Pizenberg",
        "timestamp": 1764888177
    },
    {
        "content": "<p>yeah I'm bumping the default stack size in a PR that should be landing soon</p>",
        "id": 561989410,
        "sender_full_name": "Richard Feldman",
        "timestamp": 1764889300
    },
    {
        "content": "<p>aaaaaaaah<br>\nIt was so close. Now that all the bugs I’ve encountered were fixed on main and day01 was running smoothly with no memory leak, I was praying to the insect gods and ...  it wasn’t enough XD</p>\n<div class=\"codehilite\" data-code-language=\"Bash\"><pre><span></span><code>❯<span class=\"w\"> </span>roc<span class=\"w\"> </span>--no-cache<span class=\"w\"> </span>day02.roc\nthread<span class=\"w\"> </span><span class=\"m\">586390</span><span class=\"w\"> </span>panic:<span class=\"w\"> </span>index<span class=\"w\"> </span>out<span class=\"w\"> </span>of<span class=\"w\"> </span>bounds:<span class=\"w\"> </span>index<span class=\"w\"> </span><span class=\"m\">2863311530</span>,<span class=\"w\"> </span>len<span class=\"w\"> </span><span class=\"m\">1049</span>\n???:?:?:<span class=\"w\"> </span>0x104a7476f<span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span>_instantiate.Instantiator.instantiateTagUnion<span class=\"w\"> </span><span class=\"o\">(</span>???<span class=\"o\">)</span>\n???:?:?:<span class=\"w\"> </span>0x104a02f4f<span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span>_instantiate.Instantiator.instantiateFlatType<span class=\"w\"> </span><span class=\"o\">(</span>???<span class=\"o\">)</span>\n???:?:?:<span class=\"w\"> </span>0x10495c1d3<span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span>_instantiate.Instantiator.instantiateContent<span class=\"w\"> </span><span class=\"o\">(</span>???<span class=\"o\">)</span>\n...\n</code></pre></div>\n<p>Tomorrow I’ll try to minimize it.</p>",
        "id": 562802942,
        "sender_full_name": "Matthieu Pizenberg",
        "timestamp": 1765315834
    },
    {
        "content": "<p>if you want to just paste the non minimized version I can take care of it!</p>",
        "id": 562811139,
        "sender_full_name": "Richard Feldman",
        "timestamp": 1765318581
    },
    {
        "content": "<p>Here is the file in full. It’s using Luke’s latest platform version 0.5</p>\n<p><a href=\"/user_uploads/22008/DXl5Xf48w0Fo1kl7CGNxftGf/day02.roc\">day02.roc</a></p>",
        "id": 562812319,
        "sender_full_name": "Matthieu Pizenberg",
        "timestamp": 1765319029
    },
    {
        "content": "<p>It’s a weird one again. If I change almost anything, the panic goes away. Even removing dead code.</p>",
        "id": 562895393,
        "sender_full_name": "Matthieu Pizenberg",
        "timestamp": 1765355475
    },
    {
        "content": "<p>So in a way, the good news is that for example just using <code>Stdout.line!</code> instead of my <code>print!</code> makes the program run. The bad news is that even in <code>ReleaseFast</code>, interpreter seems way to slow to be able to compute day02 with the naive implementation I came up with while trying to solve it in Julia.</p>",
        "id": 562899116,
        "sender_full_name": "Matthieu Pizenberg",
        "timestamp": 1765356492
    },
    {
        "content": "<p><a href=\"https://github.com/roc-lang/roc/pull/8617\">https://github.com/roc-lang/roc/pull/8617</a> should fix this!</p>",
        "id": 562974408,
        "sender_full_name": "Richard Feldman",
        "timestamp": 1765378486
    },
    {
        "content": "<blockquote>\n<p>even in <code>ReleaseFast</code>, interpreter seems way to slow to be able to compute day02 with the naive implementation I came up with while trying to solve it in Julia.</p>\n</blockquote>\n<p>this is a good data point to have! one of the open questions with the interpreter is \"will it be fast enough compared to our previous compiler's strategy of doing monomorphization and then direct-to-machine-code code gen?\" and it sounds like in this case the answer is that it wasn't fast enough</p>",
        "id": 562974739,
        "sender_full_name": "Richard Feldman",
        "timestamp": 1765378575
    },
    {
        "content": "<p>if Julia is fast enough, then our direct-to-machine-code backend should definitely be fast enough</p>",
        "id": 562974816,
        "sender_full_name": "Richard Feldman",
        "timestamp": 1765378593
    },
    {
        "content": "<p>Julia takes roughly 2s, and the roc interpreter I’ve stopped after 1h not finishing for the same puzzle range.</p>",
        "id": 562975072,
        "sender_full_name": "Matthieu Pizenberg",
        "timestamp": 1765378664
    },
    {
        "content": "<p>of note, even trying out a direct-to-machine-code backend is blocked on monomorphization and lambda set specialization being implemented (one of the other benefits of trying out an interpreter approach is that it has fewer prerequisites) so it'll be awhile before we can even consider trying that as an alternative</p>",
        "id": 562975233,
        "sender_full_name": "Richard Feldman",
        "timestamp": 1765378707
    },
    {
        "content": "<p>although since we've already done it once in Rust, I bet a LLM can port a bunch of that over to Zig for us; it wouldn't be like we'd have to start over from scratch</p>",
        "id": 562975371,
        "sender_full_name": "Richard Feldman",
        "timestamp": 1765378739
    },
    {
        "content": "<p>but I think for now we should continue with the interpreter and reconsider the direct-to-machine-code backend option once we have the LLVM backend in place, since at that point we'll have all the prerequisites for both - as well as more data points on how long the interpreter takes to run</p>",
        "id": 562975733,
        "sender_full_name": "Richard Feldman",
        "timestamp": 1765378814
    },
    {
        "content": "<p>Yeah, for that puzzle I’ll just have to write a less trivial solution.</p>",
        "id": 562975943,
        "sender_full_name": "Matthieu Pizenberg",
        "timestamp": 1765378858
    },
    {
        "content": "<p>can you post the one that reproduces the slowness somewhere?</p>",
        "id": 562976029,
        "sender_full_name": "Richard Feldman",
        "timestamp": 1765378878
    },
    {
        "content": "<p>ideally that and the julia one - would be great to have both of those for future comparison when revisiting this question</p>",
        "id": 562976107,
        "sender_full_name": "Richard Feldman",
        "timestamp": 1765378895
    },
    {
        "content": "<p>I’ll do a little bit of cleanup tonight and post both ok</p>",
        "id": 562976196,
        "sender_full_name": "Matthieu Pizenberg",
        "timestamp": 1765378917
    },
    {
        "content": "<p>awesome, thanks!</p>",
        "id": 563016422,
        "sender_full_name": "Richard Feldman",
        "timestamp": 1765389205
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"281383\">@Richard Feldman</span> <br>\nHere: <a href=\"https://github.com/roc-lang/roc/issues/8621\">https://github.com/roc-lang/roc/issues/8621</a></p>",
        "id": 563021494,
        "sender_full_name": "Matthieu Pizenberg",
        "timestamp": 1765390869
    },
    {
        "content": "<p>I’ve rewritten day 2 in a completely different approach which is less trivial but also much more efficient, and now I got a valid response in Roc for both part 1 and part 2, in a not-too-long amount of time :)</p>\n<p>Here is the implementation for those interested. <br>\n<a href=\"/user_uploads/22008/4MYBgoibNf2K7XP5hkZ26khK/day02_gen.roc\">day02_gen.roc</a></p>\n<div class=\"codehilite\" data-code-language=\"Bash\"><pre><span></span><code>❯<span class=\"w\"> </span>roc<span class=\"w\"> </span>day02_gen.roc\nerror<span class=\"o\">(</span>gpa<span class=\"o\">)</span>:<span class=\"w\"> </span>Allocation<span class=\"w\"> </span>alignment<span class=\"w\"> </span><span class=\"m\">8</span><span class=\"w\"> </span>does<span class=\"w\"> </span>not<span class=\"w\"> </span>match<span class=\"w\"> </span>free<span class=\"w\"> </span>alignment<span class=\"w\"> </span><span class=\"m\">1</span>.<span class=\"w\"> </span>Allocation:\nUnable<span class=\"w\"> </span>to<span class=\"w\"> </span>print<span class=\"w\"> </span>stack<span class=\"w\"> </span>trace:<span class=\"w\"> </span>Unable<span class=\"w\"> </span>to<span class=\"w\"> </span>open<span class=\"w\"> </span>debug<span class=\"w\"> </span>info:<span class=\"w\"> </span>MissingDebugInfo\n<span class=\"w\"> </span>Free:\nUnable<span class=\"w\"> </span>to<span class=\"w\"> </span>print<span class=\"w\"> </span>stack<span class=\"w\"> </span>trace:<span class=\"w\"> </span>Unable<span class=\"w\"> </span>to<span class=\"w\"> </span>open<span class=\"w\"> </span>debug<span class=\"w\"> </span>info:<span class=\"w\"> </span>MissingDebugInfo\n...\n...<span class=\"w\"> </span>tons<span class=\"w\"> </span>more<span class=\"w\"> </span>error<span class=\"o\">(</span>gpa<span class=\"o\">)</span><span class=\"w\"> </span>alignment<span class=\"w\"> </span>issues\n...\n-----------\nPart<span class=\"w\"> </span><span class=\"m\">1</span><span class=\"w\"> </span><span class=\"o\">(</span>demo<span class=\"o\">)</span>:<span class=\"w\"> </span><span class=\"m\">1227775554</span>\nPart<span class=\"w\"> </span><span class=\"m\">1</span>:<span class=\"w\"> </span><span class=\"m\">54641809925</span>\nPart<span class=\"w\"> </span><span class=\"m\">2</span><span class=\"w\"> </span><span class=\"o\">(</span>demo<span class=\"o\">)</span>:<span class=\"w\"> </span><span class=\"m\">4174379265</span>\nPart<span class=\"w\"> </span><span class=\"m\">2</span>:<span class=\"w\"> </span><span class=\"m\">73694270688</span>\n</code></pre></div>\n<p>As you can see, there are still memory alignment issues, meaning sometimes I have to add a stdout line here and there to prevent a crash (no idea why). But when it goes to the end, it gives the correct answer!</p>",
        "id": 563084243,
        "sender_full_name": "Matthieu Pizenberg",
        "timestamp": 1765412536
    },
    {
        "content": "<p>PS this solution is now panicking on the latest main b60aa9a3</p>",
        "id": 563085453,
        "sender_full_name": "Matthieu Pizenberg",
        "timestamp": 1765413443
    },
    {
        "content": "<p>I'll look into that tonight!</p>",
        "id": 563086456,
        "sender_full_name": "Richard Feldman",
        "timestamp": 1765414007
    },
    {
        "content": "<p>Thanks for the fix!</p>\n<blockquote>\n<p>There's a separate memory leak issue but that happens on the host side, not in the compiler!</p>\n</blockquote>\n<p>By \"memory leak\", do you mean the lines I see with \"Allocation alignment 8 ...\"?<br>\nBy \"on the host side\", do you mean it’s in the v0.5 platform template?</p>",
        "id": 563128433,
        "sender_full_name": "Matthieu Pizenberg",
        "timestamp": 1765442142
    },
    {
        "content": "<p>Should be fixed in <a href=\"https://github.com/lukewilliamboswell/roc-platform-template-zig/releases/tag/0.6\">https://github.com/lukewilliamboswell/roc-platform-template-zig/releases/tag/0.6</a></p>",
        "id": 563136002,
        "sender_full_name": "Luke Boswell",
        "timestamp": 1765444710
    },
    {
        "content": "<p>The host memory leak that is</p>",
        "id": 563136243,
        "sender_full_name": "Luke Boswell",
        "timestamp": 1765444785
    },
    {
        "content": "<p>I can confirm. Day 2 is now officially cleanly returning the correct result</p>\n<div class=\"codehilite\" data-code-language=\"Bash Session\"><pre><span></span><code><span class=\"go\">❯ roc day02.roc</span>\n<span class=\"go\">Part 1 (demo): 1227775554</span>\n<span class=\"go\">Part 1: 54641809925</span>\n<span class=\"go\">Part 2 (demo): 4174379265</span>\n<span class=\"go\">Part 2: 73694270688</span>\n</code></pre></div>",
        "id": 563139830,
        "sender_full_name": "Matthieu Pizenberg",
        "timestamp": 1765445840
    },
    {
        "content": "<p>tonight is for day 3 :)</p>",
        "id": 563140827,
        "sender_full_name": "Matthieu Pizenberg",
        "timestamp": 1765446101
    },
    {
        "content": "<p>Awesome, looking forward to smashing any more bugs we find <span aria-label=\"bug\" class=\"emoji emoji-1f41b\" role=\"img\" title=\"bug\">:bug:</span> <span aria-label=\"hammer\" class=\"emoji emoji-1f528\" role=\"img\" title=\"hammer\">:hammer:</span></p>",
        "id": 563141685,
        "sender_full_name": "Luke Boswell",
        "timestamp": 1765446303
    },
    {
        "content": "<p>yeah this has been <em>extremely</em> helpful - thank you so much for all the bug reports <span class=\"user-mention\" data-user-id=\"479073\">@Matthieu Pizenberg</span>!</p>",
        "id": 563193073,
        "sender_full_name": "Richard Feldman",
        "timestamp": 1765461553
    }
]