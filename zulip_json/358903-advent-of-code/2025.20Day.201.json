[
    {
        "content": "<div class=\"codehilite\" data-code-language=\"Ruby\"><pre><span></span><code><span class=\"n\">app</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">main!</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\"> </span><span class=\"ss\">pf</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"n\">platform</span><span class=\"w\"> </span><span class=\"s2\">\"../test/fx/platform/main.roc\"</span><span class=\"w\"> </span><span class=\"p\">}</span>\n\n<span class=\"n\">import</span><span class=\"w\"> </span><span class=\"n\">pf</span><span class=\"o\">.</span><span class=\"n\">Stdout</span>\n\n<span class=\"n\">input</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"p\">\\\\</span><span class=\"no\">L68</span>\n<span class=\"w\">        </span><span class=\"p\">\\\\</span><span class=\"no\">L30</span>\n<span class=\"w\">        </span><span class=\"p\">\\\\</span><span class=\"no\">R48</span>\n<span class=\"w\">        </span><span class=\"p\">\\\\</span><span class=\"no\">L5</span>\n<span class=\"w\">        </span><span class=\"p\">\\\\</span><span class=\"no\">R60</span>\n<span class=\"w\">        </span><span class=\"p\">\\\\</span><span class=\"no\">L55</span>\n<span class=\"w\">        </span><span class=\"p\">\\\\</span><span class=\"no\">L1</span>\n<span class=\"w\">        </span><span class=\"p\">\\\\</span><span class=\"no\">L99</span>\n<span class=\"w\">        </span><span class=\"p\">\\\\</span><span class=\"no\">R14</span>\n<span class=\"w\">        </span><span class=\"p\">\\\\</span><span class=\"no\">L82</span>\n\n<span class=\"n\">main!</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"o\">||</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">    </span><span class=\"n\">lines</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">input</span><span class=\"o\">.</span><span class=\"n\">split_on</span><span class=\"p\">(</span><span class=\"s2\">\"</span><span class=\"se\">\\n</span><span class=\"s2\">\"</span><span class=\"p\">)</span>\n\n<span class=\"w\">    </span><span class=\"n\">count</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">part1</span><span class=\"p\">(</span><span class=\"n\">lines</span><span class=\"p\">)</span>\n\n<span class=\"w\">    </span><span class=\"no\">Stdout</span><span class=\"o\">.</span><span class=\"n\">line!</span><span class=\"p\">(</span><span class=\"n\">count</span><span class=\"o\">.</span><span class=\"n\">to_str</span><span class=\"p\">())</span>\n<span class=\"p\">}</span>\n\n<span class=\"c1\"># not sure why =&gt; is required</span>\n<span class=\"n\">part1</span><span class=\"w\"> </span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"no\">List</span><span class=\"p\">(</span><span class=\"no\">Str</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"o\">=&gt;</span><span class=\"w\"> </span><span class=\"no\">U64</span>\n<span class=\"n\">part1</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"o\">|</span><span class=\"n\">lines</span><span class=\"o\">|</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">    </span><span class=\"n\">var</span><span class=\"w\"> </span><span class=\"vg\">$pos</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mi\">50</span>\n<span class=\"w\">    </span><span class=\"n\">var</span><span class=\"w\"> </span><span class=\"vg\">$count</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mi\">0</span>\n<span class=\"w\">    </span><span class=\"k\">for</span><span class=\"w\"> </span><span class=\"n\">line</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"n\">lines</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">        </span><span class=\"n\">u8_line</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">line</span><span class=\"o\">.</span><span class=\"n\">to_utf8</span><span class=\"p\">()</span>\n<span class=\"w\">        </span><span class=\"n\">match</span><span class=\"w\"> </span><span class=\"n\">u8_line</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">            </span><span class=\"o\">[</span><span class=\"s1\">'L'</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"o\">..</span><span class=\"n\">a</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">=&gt;</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">                </span><span class=\"n\">amount</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">i64_from_ascii_digits</span><span class=\"p\">(</span><span class=\"n\">a</span><span class=\"p\">)</span>\n<span class=\"w\">                </span><span class=\"vg\">$pos</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"vg\">$pos</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"w\"> </span><span class=\"n\">amount</span><span class=\"p\">)</span><span class=\"o\">.</span><span class=\"n\">mod_by</span><span class=\"p\">(</span><span class=\"mi\">100</span><span class=\"p\">)</span>\n<span class=\"w\">                </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"vg\">$pos</span><span class=\"w\"> </span><span class=\"o\">==</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">                    </span><span class=\"vg\">$count</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"vg\">$count</span><span class=\"w\"> </span><span class=\"o\">+</span><span class=\"w\"> </span><span class=\"mi\">1</span>\n<span class=\"w\">                </span><span class=\"p\">}</span>\n<span class=\"w\">            </span><span class=\"p\">}</span>\n<span class=\"w\">            </span><span class=\"o\">[</span><span class=\"s1\">'R'</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"o\">..</span><span class=\"n\">a</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">=&gt;</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">                </span><span class=\"n\">amount</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">i64_from_ascii_digits</span><span class=\"p\">(</span><span class=\"n\">a</span><span class=\"p\">)</span>\n<span class=\"w\">                </span><span class=\"vg\">$pos</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"vg\">$pos</span><span class=\"w\"> </span><span class=\"o\">+</span><span class=\"w\"> </span><span class=\"n\">amount</span><span class=\"p\">)</span><span class=\"o\">.</span><span class=\"n\">mod_by</span><span class=\"p\">(</span><span class=\"mi\">100</span><span class=\"p\">)</span>\n<span class=\"w\">                </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"vg\">$pos</span><span class=\"w\"> </span><span class=\"o\">==</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">                    </span><span class=\"vg\">$count</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"vg\">$count</span><span class=\"w\"> </span><span class=\"o\">+</span><span class=\"w\"> </span><span class=\"mi\">1</span>\n<span class=\"w\">                </span><span class=\"p\">}</span>\n<span class=\"w\">            </span><span class=\"p\">}</span>\n<span class=\"w\">            </span><span class=\"n\">_</span><span class=\"w\"> </span><span class=\"o\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">dbg</span><span class=\"w\"> </span><span class=\"s2\">\"Error\"</span>\n<span class=\"w\">        </span><span class=\"p\">}</span>\n<span class=\"w\">    </span><span class=\"p\">}</span>\n<span class=\"w\">    </span><span class=\"vg\">$count</span>\n<span class=\"p\">}</span>\n\n<span class=\"n\">i64_from_ascii_digits</span><span class=\"w\"> </span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"no\">List</span><span class=\"p\">(</span><span class=\"no\">U8</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"o\">-&gt;</span><span class=\"w\"> </span><span class=\"no\">I64</span>\n<span class=\"n\">i64_from_ascii_digits</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"o\">|</span><span class=\"n\">ascii</span><span class=\"o\">|</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">    </span><span class=\"n\">ascii</span><span class=\"o\">.</span><span class=\"n\">map</span><span class=\"p\">(</span><span class=\"o\">|</span><span class=\"n\">b</span><span class=\"o\">|</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"w\"> </span><span class=\"s1\">'0'</span><span class=\"p\">)</span><span class=\"o\">.</span><span class=\"n\">to_i64</span><span class=\"p\">())</span><span class=\"o\">.</span><span class=\"n\">fold</span><span class=\"p\">(</span><span class=\"mi\">0</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"o\">|</span><span class=\"n\">n</span><span class=\"p\">,</span><span class=\"n\">b</span><span class=\"o\">|</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">*</span><span class=\"w\"> </span><span class=\"mi\">10</span><span class=\"w\"> </span><span class=\"o\">+</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"p\">)</span>\n<span class=\"p\">}</span>\n</code></pre></div>\n<p>This runs with the example input <span aria-label=\"tada\" class=\"emoji emoji-1f389\" role=\"img\" title=\"tada\">:tada:</span>.<br>\nBut for the actual puzzle input I get a <code>Roc crashed: Error evaluating from shared memory: StackOverflow</code> after about 15 seconds (current main, compiled with -Doptimize=ReleaseFast)</p>",
        "id": 561910719,
        "sender_full_name": "Fabian Schmalzried",
        "timestamp": 1764862641
    },
    {
        "content": "<p>I'll try bumping the default stack size <span aria-label=\"smile\" class=\"emoji emoji-1f604\" role=\"img\" title=\"smile\">:smile:</span></p>",
        "id": 561911253,
        "sender_full_name": "Richard Feldman",
        "timestamp": 1764862767
    },
    {
        "content": "<p>Small optimization, and now it runs with the puzzle input, I will have a look at part 2 now </p>\n<div class=\"codehilite\" data-code-language=\"Ruby\"><pre><span></span><code><span class=\"n\">i64_from_ascii_digits</span><span class=\"w\"> </span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"no\">List</span><span class=\"p\">(</span><span class=\"no\">U8</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"o\">-&gt;</span><span class=\"w\"> </span><span class=\"no\">I64</span>\n<span class=\"n\">i64_from_ascii_digits</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"o\">|</span><span class=\"n\">ascii</span><span class=\"o\">|</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">    </span><span class=\"n\">ascii</span><span class=\"o\">.</span><span class=\"n\">fold</span><span class=\"p\">(</span><span class=\"mi\">0</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"o\">|</span><span class=\"n\">n</span><span class=\"p\">,</span><span class=\"n\">b</span><span class=\"o\">|</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">*</span><span class=\"w\"> </span><span class=\"mi\">10</span><span class=\"w\"> </span><span class=\"o\">+</span><span class=\"w\"> </span><span class=\"p\">((</span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"w\"> </span><span class=\"s1\">'0'</span><span class=\"p\">)</span><span class=\"o\">.</span><span class=\"n\">to_i64</span><span class=\"p\">()))</span>\n<span class=\"p\">}</span>\n</code></pre></div>",
        "id": 561911959,
        "sender_full_name": "Fabian Schmalzried",
        "timestamp": 1764862918
    },
    {
        "content": "<p>I saw that map is currently doing a fold an creating a new list, so just one fold is much better :-)</p>",
        "id": 561912213,
        "sender_full_name": "Fabian Schmalzried",
        "timestamp": 1764862979
    },
    {
        "content": "<p>nice! I have a PR which (among other things) bumps default stack size from 8MB to 64MB. We can certainly go higher than that if necessary.</p>",
        "id": 561914983,
        "sender_full_name": "Richard Feldman",
        "timestamp": 1764863642
    },
    {
        "content": "<p>Does Roc have while loop? I wonder if I can read lines from Stdin until the line is empty without using recursion?</p>",
        "id": 561921694,
        "sender_full_name": "Micha≈Ç Kowieski",
        "timestamp": 1764865209
    },
    {
        "content": "<p>Yes you can do <code>while (True)</code>. But there is a bug in the <code>Stdin.line!</code>that discards the rest of it's internal buffer after the first newline if you pipe in a file, that I wanted to report but forgot.</p>",
        "id": 561922480,
        "sender_full_name": "Fabian Schmalzried",
        "timestamp": 1764865400
    },
    {
        "content": "<p>I'm starting a list of things that I'm missing so we can check whether they are accidentally broken, known issues or not yet implemented:</p>\n<ul>\n<li>(being fixed) <a href=\"#narrow/channel/231634-beginners/topic/dbg.20broken.20in.20new.20compiler.3F/with/562616789\"><code>dbg</code> not working</a> [It's a platform bug.]</li>\n<li>(solved) <code>Str.to_u32()</code> is not found. (<code>Str.to_u32 does not exist. Str is in scope, but it has no associated to_u32.</code>) [It's U32.from_str() instead.]</li>\n<li>(?) <code>List.keep_oks()</code> or <code>List.filter_map()</code> missing in new compiler.</li>\n</ul>",
        "id": 562620038,
        "sender_full_name": "Johannes Maas",
        "timestamp": 1765268057
    },
    {
        "content": "<p>I guess <code>Str.to_u32()</code> missing means it does not really make sense for me to proceed right now, but I can already see the language and like it very much!</p>",
        "id": 562620398,
        "sender_full_name": "Johannes Maas",
        "timestamp": 1765268203
    },
    {
        "content": "<p>You have <code>U32.from_str</code>. The list of available builtins are in that file <a href=\"https://github.com/roc-lang/roc/blob/main/src/build/roc/Builtin.roc\">https://github.com/roc-lang/roc/blob/main/src/build/roc/Builtin.roc</a></p>",
        "id": 562620617,
        "sender_full_name": "Matthieu Pizenberg",
        "timestamp": 1765268282
    },
    {
        "content": "<p>I made <a href=\"https://github.com/roc-lang/roc/issues/8596\">#8596</a> to provide a useful tip when using <code>Str.to_u32()</code>.</p>",
        "id": 562635153,
        "sender_full_name": "Anton",
        "timestamp": 1765272772
    },
    {
        "content": "<p>Oh, thanks! So I'm probably looking at the old docs on the website when I thought those were the new. I'll look for where to find the new docs.</p>",
        "id": 562636093,
        "sender_full_name": "Johannes Maas",
        "timestamp": 1765273070
    },
    {
        "content": "<p>We don't have new docs yet <span aria-label=\"sweat smile\" class=\"emoji emoji-1f605\" role=\"img\" title=\"sweat smile\">:sweat_smile:</span> but you can check this file for now: <a href=\"https://github.com/roc-lang/roc/blob/main/src/build/roc/Builtin.roc\">https://github.com/roc-lang/roc/blob/main/src/build/roc/Builtin.roc</a></p>",
        "id": 562636439,
        "sender_full_name": "Anton",
        "timestamp": 1765273183
    },
    {
        "content": "<p>That's fine and what I would have looked for, thanks!</p>",
        "id": 562636922,
        "sender_full_name": "Johannes Maas",
        "timestamp": 1765273300
    },
    {
        "content": "<p>Ok, it's rough, just as I was warned. Hopefully this helps somehow:</p>\n<div class=\"codehilite\"><pre><span></span><code>app [main!] { pf: platform &quot;https://github.com/lukewilliamboswell/roc-platform-template-zig/releases/download/0.4/6XA8JLWhmG1FSgb8GxPjBs9cGrtRqopohR3KAHYo722z.tar.zst&quot; }\n\nimport pf.Stdout\nimport pf.Stdin\n\nmain! = |_args| {\n    parsed = parse_input(puzzle_input)\n    output_n = parsed\n        #.map(|instruction| instruction.ok_or(0).to_str())\n        #.map(|n| n.to_str())\n    #Stdout.line!(output)\n\n    # The first `map` above fails with `Roc crashed: Builtin.Str does not implement ok_or`, but the following works, proving that the elements are actually Try, not Str.\n    for n in output_n {\n        Stdout.line!(n.ok_or(0).to_str())\n    }\n\n\n    Stdout.line!(&quot;stdout&quot;)\n    Ok({})\n}\n\nparse_input = |input| {\n    input\n        .split_on(&quot;\\n&quot;)\n        .drop_if(|line| line.is_empty())\n        .map(|line| {\n            if line.starts_with(&quot;R&quot;) {\n                U32.from_str(line.drop_prefix(&quot;R&quot;))\n            } else if line.starts_with(&quot;L&quot;) {\n                U32.from_str(line.drop_prefix(&quot;L&quot;))\n            } else {\n                Err(InvalidLine(line))\n            }\n        })\n        # If I uncomment the following line, I get a `Roc crashed: Error evaluating from shared memory: InvalidMethodReceiver`.\n        #.keep_if(|result| result.is_ok())\n        #.map(|result| result.ok_or(0)\n}\n\npuzzle_input = &quot;R21\\nR37\\nL39\\nL11&quot;\n</code></pre></div>\n<p>There are two places where I've added comments indicating the errors I'm running into. Hopefully, it makes sense. Otherwise, please ask. :)</p>",
        "id": 562650211,
        "sender_full_name": "Johannes Maas",
        "timestamp": 1765277012
    },
    {
        "content": "<p>A message was moved from this topic to <a class=\"stream-topic\" data-stream-id=\"304641\" href=\"/#narrow/channel/304641-ideas/topic/streams.20API/with/562668281\">#ideas &gt; streams API</a> by <span class=\"user-mention silent\" data-user-id=\"361169\">Anton</span>.</p>",
        "id": 562668283,
        "sender_full_name": "Notification Bot",
        "timestamp": 1765282428
    }
]