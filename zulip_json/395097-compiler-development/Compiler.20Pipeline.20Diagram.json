[
    {
        "content": "<p>I've been reading the commits from <span class=\"user-mention\" data-user-id=\"281383\">@Richard Feldman</span> roll in with the new MIR and LIR stages... and thought I'd put together an updated diagram for the Roc pipeline. I like having high level diagrams to help me understand how it works, and why etc. </p>\n<p>I haven't included much here, it's just the high level flow -- but maybe it helps anyone interested in following along.</p>\n<p><a href=\"/user_uploads/22008/Eh8Pw8s6xOr_dtg05GRcT1wK/Roc-Compiler-Pipeline-2026-02-16-225823.png\">Roc Compiler Pipeline-2026-02-16-225823.png</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/22008/Eh8Pw8s6xOr_dtg05GRcT1wK/Roc-Compiler-Pipeline-2026-02-16-225823.png\" title=\"Roc Compiler Pipeline-2026-02-16-225823.png\"><img data-original-content-type=\"image/png\" data-original-dimensions=\"3609x4852\" src=\"/user_uploads/thumbnail/22008/Eh8Pw8s6xOr_dtg05GRcT1wK/Roc-Compiler-Pipeline-2026-02-16-225823.png/840x560.webp\"></a></div><div class=\"codehilite\"><pre><span></span><code># Roc Compiler Pipeline\n\nThe Coordinator drives the compilation pipeline         @src/compile/coordinator.zig\n\n## Input\n\n0. Roc Source Code\n\n## Intermediate Representations\n\n1. Abstract Syntax Tree (AST)                           @src/parse/AST.zig\n2. Canonical Intermediate Representation (CIR)          @src/canonicalize/CIR.zig\n3. Monomorphic Intermediate Representation (MIR)        @src/mir/MIR.zig\n4. Layout Intermediate Representation (LIR)             @src/lir/LIR.zig\n\n## Output\n\n5.1. LLVM bitcode\n5.2. x86-64 machine code\n5.3. aarch64 machine code\n5.4. WASM bytecode\n\n## Transformations\n\n6.1. Syntax Analysis (Source -&gt; AST)\n6.1.1. Tokenize                                         @src/parse/tokenize.zig\n6.1.2. Parse                                            @src/parse/Parser.zig\n6.2. Semantic Analysis (AST -&gt; CIR)                     @src/canonicalize/Can.zig\n6.3. Type Checking (CIR -&gt; CIR)                         @src/check/Check.zig\n6.4. Monomorphization (CIR -&gt; MIR)                      @src/mir/Lower.zig\n6.5. Lowering (MIR -&gt; LIR)                              @src/lir/MirToLir.zig\n6.6. Code Generation (LIR -&gt; Output)                    @src/backend/mod.zig\n</code></pre></div>",
        "id": 574200452,
        "sender_full_name": "Luke Boswell",
        "timestamp": 1771288075
    },
    {
        "content": "<p>personally I'd draw Type Checking as producing a separate box to the side of CIR, something like \"Types\" maybe, and then similarly there would be a box called Monotypes next to MIR.</p>\n<p>then an arrow from Types to Monotypes next to the arrow from CIR to MIR, and then finally an arrow from Monotypes to LIR - because LIR is created using a combination of MIR and Monotypes</p>",
        "id": 574215218,
        "sender_full_name": "Richard Feldman",
        "timestamp": 1771301350
    },
    {
        "content": "<p>this is also missing the lambda set steps, which I personally think would be good to include!</p>",
        "id": 574215236,
        "sender_full_name": "Richard Feldman",
        "timestamp": 1771301364
    },
    {
        "content": "<p>Excellent ... I'll look into it</p>",
        "id": 574215297,
        "sender_full_name": "Luke Boswell",
        "timestamp": 1771301417
    },
    {
        "content": "<p>It might be easier to use the convention where boxes are actions/functions and arrows are data. Then functions can naturally accept have multiple inputs/outputs.</p>",
        "id": 574228789,
        "sender_full_name": "Romain Lepert",
        "timestamp": 1771312593
    }
]