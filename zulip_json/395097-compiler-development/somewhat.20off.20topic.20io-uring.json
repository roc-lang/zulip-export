[
    {
        "content": "<p>does anyone here have experience with io-uring?</p>\n<p>I am trying to write a program that scans all files recursively in a directory and spits out some metadata about them, including a hash of their contents (here i am using blake3). I'm testing it on a pretty underpowered 2cpu machine with a 5.15 kernel.</p>\n<p>I ended up writing a lot of versions but here are 3 that work okay (for a directory with 36K nested files):</p>\n<ul>\n<li><a href=\"https://gist.github.com/ayazhafiz/1134e270ff045271e6398abf5d698728#file-walker_rayon-rs\">synchronous IO on a threadpool with rayon</a>: 400ms</li>\n<li><a href=\"https://gist.github.com/ayazhafiz/1134e270ff045271e6398abf5d698728#file-io_uring_direct-rs\">async IO with io_uring with a threadpool, each thread sending one IO request to the kernel at a time</a>: 450ms</li>\n<li><a href=\"https://gist.github.com/ayazhafiz/1134e270ff045271e6398abf5d698728#file-io_uring_direct_multi-rs\">async IO with io_uring with a threadpool, each thread send multiple IO requests to the kernel at a time</a>: 400-450ms</li>\n</ul>\n<p>I'm really surprised the third version isn't so much better.. does anyone know if I'm doing something obviously wrong?</p>\n<p>I am asking elsewhere too but linking here since I know this is something we care about and may want to reference later.</p>",
        "id": 379928256,
        "sender_full_name": "Ayaz Hafiz",
        "timestamp": 1690686931
    }
]