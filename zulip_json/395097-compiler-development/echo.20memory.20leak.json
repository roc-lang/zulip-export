[
    {
        "content": "<p>This \"fixes\" the memory leak in the echo example of Luke's zig platform but I think it may be a bad idea <span class=\"user-mention\" data-user-id=\"281383\">@Richard Feldman</span> <span class=\"user-mention\" data-user-id=\"515757\">@Luke Boswell</span> </p>\n<div class=\"codehilite\" data-code-language=\"Diff\"><pre><span></span><code><span class=\"gh\">diff --git a/platform/host.zig b/platform/host.zig</span>\n<span class=\"gh\">index fa18c29..502236a 100644</span>\n<span class=\"gd\">--- a/platform/host.zig</span>\n<span class=\"gi\">+++ b/platform/host.zig</span>\n<span class=\"gu\">@@ -206,21 +206,9 @@ fn hostedStdinLine(ops: *builtins.host_abi.RocOps, ret_ptr: *anyopaque, args_ptr</span>\n<span class=\"w\"> </span>        line = line[0 .. line.len - 1];\n<span class=\"w\"> </span>    }\n\n<span class=\"gd\">-    // Allocate through Roc's allocation system to ensure proper size-tracking metadata</span>\n<span class=\"gd\">-    var roc_alloc_args = builtins.host_abi.RocAlloc{</span>\n<span class=\"gd\">-        .alignment = 1,</span>\n<span class=\"gd\">-        .length = line.len,</span>\n<span class=\"gd\">-        .answer = undefined,</span>\n<span class=\"gd\">-    };</span>\n<span class=\"gd\">-    ops.roc_alloc(&amp;roc_alloc_args, ops.env);</span>\n<span class=\"gd\">-</span>\n<span class=\"gd\">-    // Copy line data to the Roc-allocated memory</span>\n<span class=\"gd\">-    const line_copy: [*]u8 = @ptrCast(roc_alloc_args.answer);</span>\n<span class=\"gd\">-    @memcpy(line_copy[0..line.len], line);</span>\n<span class=\"gd\">-</span>\n<span class=\"w\"> </span>    // Create RocStr from the read line and return it\n<span class=\"w\"> </span>    const result: *RocStr = @ptrCast(@alignCast(ret_ptr));\n<span class=\"gd\">-    result.* = RocStr.init(line_copy, line.len, ops);</span>\n<span class=\"gi\">+    result.* = RocStr.fromSlice(line, ops);</span>\n<span class=\"w\"> </span>}\n\n<span class=\"w\"> </span>/// Hosted function: Stdout.line! (index 2 - sorted alphabetically)\n</code></pre></div>\n<p>From <a href=\"https://github.com/Anton-4/roc-platform-template-zig/pull/2\">https://github.com/Anton-4/roc-platform-template-zig/pull/2</a></p>",
        "id": 561491661,
        "sender_full_name": "Anton",
        "timestamp": 1764700381
    },
    {
        "content": "<p>oh yeah that sounds scary <span aria-label=\"joy\" class=\"emoji emoji-1f602\" role=\"img\" title=\"joy\">:joy:</span></p>",
        "id": 561492224,
        "sender_full_name": "Richard Feldman",
        "timestamp": 1764700572
    },
    {
        "content": "<p>pretty sure there's UB there haha</p>",
        "id": 561492252,
        "sender_full_name": "Richard Feldman",
        "timestamp": 1764700585
    },
    {
        "content": "<p>I wonder if the bug there is that we're not decref-ing tag union payloads correctly</p>",
        "id": 561496372,
        "sender_full_name": "Richard Feldman",
        "timestamp": 1764701896
    },
    {
        "content": "<p>like because the <code>Str</code> is inside a <code>Try</code>, when we decref the <code>Try</code> it doesn't go in and decref (and free) the <code>Str</code> inside the <code>Ok</code>?</p>",
        "id": 561496497,
        "sender_full_name": "Richard Feldman",
        "timestamp": 1764701928
    },
    {
        "content": "<p>Luke fixed it: <a href=\"https://github.com/lukewilliamboswell/roc-platform-template-zig/commit/b68e3f427d51acb5d2e76425f6e0fb8b21bdedfc\">https://github.com/lukewilliamboswell/roc-platform-template-zig/commit/b68e3f427d51acb5d2e76425f6e0fb8b21bdedfc</a></p>",
        "id": 561604920,
        "sender_full_name": "Anton",
        "timestamp": 1764756347
    }
]