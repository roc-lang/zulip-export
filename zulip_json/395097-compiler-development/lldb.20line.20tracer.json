[
    {
        "content": "<p>Output of uftrace wasn't exactly what I needed for debugging <a href=\"#narrow/channel/395097-compiler-development/topic/slow.20build.20with.20lots.20of.20.60.3F.60\">#compiler development &gt; slow build with lots of &#96;?&#96;</a>  so I made an lldb script to log every executed line of code in a specific file like  <a href=\"https://github.com/roc-lang/roc/blob/main/crates/compiler/mono/src/inc_dec.rs\">inc_dec.rs</a>. The output looks like this:</p>\n<div class=\"codehilite\" data-code-language=\"Bash\"><pre><span></span><code><span class=\"o\">(</span>lldb<span class=\"o\">)</span><span class=\"w\"> </span>process<span class=\"w\"> </span>launch<span class=\"w\"> </span>--<span class=\"w\"> </span>check<span class=\"w\"> </span>hello.roc\n<span class=\"o\">=</span>&gt;<span class=\"w\"> </span><span class=\"k\">function</span>:<span class=\"w\"> </span>check_file\n*<span class=\"w\">  </span><span class=\"m\">1339</span><span class=\"w\">     </span><span class=\"nb\">let</span><span class=\"w\"> </span><span class=\"nv\">compilation_start</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span>Instant::now<span class=\"o\">()</span><span class=\"p\">;</span>\n*<span class=\"w\">  </span><span class=\"m\">1343</span><span class=\"w\">     </span><span class=\"nb\">let</span><span class=\"w\"> </span><span class=\"nv\">target</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span>Target::LinuxX64<span class=\"p\">;</span>\n*<span class=\"w\">  </span><span class=\"m\">1349</span><span class=\"w\">         </span>function_kind:<span class=\"w\"> </span>FunctionKind::from_env<span class=\"o\">()</span>,\n*<span class=\"w\">  </span><span class=\"m\">1351</span><span class=\"w\">         </span>render:<span class=\"w\"> </span>RenderTarget::ColorTerminal,\n*<span class=\"w\">  </span><span class=\"m\">1354</span><span class=\"w\">         </span>exec_mode:<span class=\"w\"> </span>ExecutionMode::Check,\n*<span class=\"w\">  </span><span class=\"m\">1347</span><span class=\"w\">     </span><span class=\"nb\">let</span><span class=\"w\"> </span><span class=\"nv\">load_config</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span>LoadConfig<span class=\"w\"> </span><span class=\"o\">{</span>\n*<span class=\"w\">  </span><span class=\"m\">1358</span><span class=\"w\">         </span>roc_file_path,\n*<span class=\"w\">  </span><span class=\"m\">1359</span><span class=\"w\">         </span>opt_main_path,\n*<span class=\"w\">  </span><span class=\"m\">1356</span><span class=\"w\">     </span><span class=\"nb\">let</span><span class=\"w\"> </span>mut<span class=\"w\"> </span><span class=\"nv\">loaded</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span>roc_load::load_and_typecheck<span class=\"o\">(</span>\n*<span class=\"w\">  </span><span class=\"m\">1364</span><span class=\"w\">     </span><span class=\"nb\">let</span><span class=\"w\"> </span><span class=\"nv\">buf</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"p\">&amp;</span>mut<span class=\"w\"> </span>String::with_capacity<span class=\"o\">(</span><span class=\"m\">1024</span><span class=\"o\">)</span><span class=\"p\">;</span>\n*<span class=\"w\">  </span><span class=\"m\">1366</span><span class=\"w\">     </span><span class=\"nb\">let</span><span class=\"w\"> </span>mut<span class=\"w\"> </span><span class=\"nv\">it</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span>loaded.timings.iter<span class=\"o\">()</span>.peekable<span class=\"o\">()</span><span class=\"p\">;</span>\n*<span class=\"w\">  </span><span class=\"m\">1367</span><span class=\"w\">     </span><span class=\"k\">while</span><span class=\"w\"> </span><span class=\"nb\">let</span><span class=\"w\"> </span>Some<span class=\"o\">((</span>module_id,<span class=\"w\"> </span>module_timing<span class=\"o\">))</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span>it.next<span class=\"o\">()</span><span class=\"w\"> </span><span class=\"o\">{</span>\n*<span class=\"w\">  </span><span class=\"m\">1368</span><span class=\"w\">         </span><span class=\"nb\">let</span><span class=\"w\"> </span><span class=\"nv\">module_name</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span>loaded.interns.module_name<span class=\"o\">(</span>*module_id<span class=\"o\">)</span><span class=\"p\">;</span>\n*<span class=\"w\">  </span><span class=\"m\">1370</span><span class=\"w\">         </span>buf.push_str<span class=\"o\">(</span><span class=\"s2\">\"    \"</span><span class=\"o\">)</span><span class=\"p\">;</span>\n*<span class=\"w\">  </span><span class=\"m\">1372</span><span class=\"w\">         </span><span class=\"k\">if</span><span class=\"w\"> </span>module_name.is_empty<span class=\"o\">()</span><span class=\"w\"> </span><span class=\"o\">{</span>\n*<span class=\"w\">  </span><span class=\"m\">1376</span><span class=\"w\">             </span>buf.push_str<span class=\"o\">(</span>module_name<span class=\"o\">)</span><span class=\"p\">;</span>\n*<span class=\"w\">  </span><span class=\"m\">1379</span><span class=\"w\">         </span>buf.push<span class=\"o\">(</span><span class=\"s1\">'\\n'</span><span class=\"o\">)</span><span class=\"p\">;</span>\n*<span class=\"w\">  </span><span class=\"m\">1381</span><span class=\"w\">         </span>report_timing<span class=\"o\">(</span>buf,<span class=\"w\"> </span><span class=\"s2\">\"Read .roc file from disk\"</span>,<span class=\"w\"> </span>module_timing.read_roc_file<span class=\"o\">)</span><span class=\"p\">;</span>\n<span class=\"o\">=</span>&gt;<span class=\"w\"> </span><span class=\"k\">function</span>:<span class=\"w\"> </span>report_timing\n*<span class=\"w\">   </span><span class=\"m\">606</span><span class=\"w\">         </span>duration.as_secs_f64<span class=\"o\">()</span><span class=\"w\"> </span>*<span class=\"w\"> </span><span class=\"m\">1000</span>.0,\n*<span class=\"w\">   </span><span class=\"m\">603</span><span class=\"w\">     </span>writeln!<span class=\"o\">(</span>\n*<span class=\"w\">   </span><span class=\"m\">610</span><span class=\"w\"> </span><span class=\"o\">}</span>\n<span class=\"o\">[</span>...<span class=\"o\">]</span>\n</code></pre></div>\n<p>(Code line numbers are on the left)<br>\nIt's what you need when there is too much code to step through with the debugger :)</p>\n<p>It works with zig too!</p>",
        "id": 525171536,
        "sender_full_name": "Anton",
        "timestamp": 1750528064
    }
]