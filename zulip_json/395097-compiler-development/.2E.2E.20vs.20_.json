[
    {
        "content": "<p>The unification of the error union is not the same here; the new <code>Try({}, [Exit(I32), ..])</code> behavior differs from the old <code>Result {} [Exit I32]_</code>. Do we currently have a way to achieve the old unification behavior? This is similar to the situation described in <a href=\"https://github.com/roc-lang/roc/issues/9010\">#9010</a>.</p>",
        "id": 573348570,
        "sender_full_name": "Anton",
        "timestamp": 1770831146
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"341568\">@Jared Ramirez</span></p>",
        "id": 573359584,
        "sender_full_name": "Anton",
        "timestamp": 1770834304
    },
    {
        "content": "<p>can you provide a repro?</p>",
        "id": 573555553,
        "sender_full_name": "Jared Ramirez",
        "timestamp": 1770911056
    },
    {
        "content": "<p>Here it is:</p>\n<ul>\n<li>new Roc:</li>\n</ul>\n<div class=\"codehilite\"><pre><span></span><code>app [main!] { pf: platform &quot;./platform/main.roc&quot; }\n\nimport pf.Stdout\n\nline : Str -&gt; Try({}, [EmptyStrErr])\nline = |str| {\n    if str.is_empty() {\n        Err(EmptyStrErr)\n    } else {\n        Ok({})\n    }\n}\n\nmy_func : {} -&gt; Try({}, [Exit(I32), ..])\nmy_func = |_| {\n    line(&quot;hey&quot;)?\n    Err(Exit(1))\n}\n\nmain! = || {\n    match my_func({}) {\n        Ok({}) =&gt; Stdout.line!(&quot;Ok&quot;)\n        Err(_) =&gt; Stdout.line!(&quot;Err&quot;)\n    }\n}\n</code></pre></div>\n<p>output:</p>\n<div class=\"codehilite\"><pre><span></span><code>❯ ./zig-out/bin/roc test/fx/repro.roc\n-- TYPE MISMATCH ---------------------------------\n\nThis ? may return early with a type that doesn&#39;t match the function body:\n   ┌─ test/fx/repro.roc:16:5\n   │\n16 │     line(&quot;hey&quot;)?\n   │     ^^^^^^^^^^^^\n\nOn error, this would return:\n\n    Try({  }, [EmptyStrErr])\n\nBut the function body evaluates to:\n\n    Try({  }, [Exit(I32), ..])\n\nHint: The error types from all ? operators and the function body must be compatible since any of them could be the actual return value.\n\nFound 1 error(s) and 0 warning(s) for test/fx/repro.roc.\n</code></pre></div>\n<ul>\n<li>old Roc:</li>\n</ul>\n<div class=\"codehilite\"><pre><span></span><code>app [main!] { cli: platform &quot;https://github.com/roc-lang/basic-cli/releases/download/0.20.0/X73hGh05nNTkDHU06FHC0YfFaQB1pimX7gncRcao5mU.tar.br&quot; }\n\nimport cli.Stdout\n\nline : Str -&gt; Result {} [EmptyStrErr]\nline = |str|\n    if Str.is_empty(str) then\n        Err(EmptyStrErr)\n    else\n        Ok({})\n\nmy_func : {} -&gt; Result {} [Exit(I32)]_\nmy_func = |_|\n    line(&quot;hey&quot;)?\n    Err(Exit(1))\n\nmain! = |_args|\n    when my_func({}) is\n        Ok({}) -&gt; Stdout.line!(&quot;Ok&quot;)\n        Err(_) -&gt; Stdout.line!(&quot;Err&quot;)\n</code></pre></div>\n<p>output:</p>\n<div class=\"codehilite\"><pre><span></span><code>❯ ./roc main.roc\nErr\n</code></pre></div>",
        "id": 574269170,
        "sender_full_name": "Anton",
        "timestamp": 1771327781
    },
    {
        "content": "<p>I would love to hear your (initial) thoughts on this <span class=\"user-mention\" data-user-id=\"341568\">@Jared Ramirez</span>, this is a blocker for the <a href=\"https://github.com/roc-lang/basic-cli/pull/413\">new basic-cli</a>.</p>",
        "id": 574459206,
        "sender_full_name": "Anton",
        "timestamp": 1771406095
    },
    {
        "content": "<p>Been pretty swamped at work and I have not had the time to look into this yet. Hopefully for Friday/this weekend I should be a little more free to take a look</p>",
        "id": 574632034,
        "sender_full_name": "Jared Ramirez",
        "timestamp": 1771463499
    },
    {
        "content": "<p>i believe the issue here is in the rust compiler, this type signature:</p>\n<div class=\"codehilite\"><pre><span></span><code>line : Str -&gt; Result {} [EmptyStrErr]\n</code></pre></div>\n<p>is silently upgraded to:</p>\n<div class=\"codehilite\"><pre><span></span><code>line : Str -&gt; Result {} [EmptyStrErr]_\n</code></pre></div>\n<p>which makes the <code>Err</code> payloads mergable when you call <code>line(\"hey\")?</code>.</p>\n<p>this is called \"polarity\", and it's not yet implemented in the new compiler. the good new for now though is that by this can be fixed by adding a <code>..</code> to the type definition of <code>line</code>:</p>\n<div class=\"codehilite\"><pre><span></span><code>line : Str -&gt; Try({}, [EmptyStrErr, ..])\n</code></pre></div>\n<p>this is semantically the same as what the rust compiler is doing, so it should unblock!</p>",
        "id": 574771634,
        "sender_full_name": "Jared Ramirez",
        "timestamp": 1771518697
    },
    {
        "content": "<p>Amazing, thanks <span class=\"user-mention\" data-user-id=\"341568\">@Jared Ramirez</span> <span aria-label=\"heart\" class=\"emoji emoji-2764\" role=\"img\" title=\"heart\">:heart:</span></p>",
        "id": 574903223,
        "sender_full_name": "Anton",
        "timestamp": 1771581518
    }
]