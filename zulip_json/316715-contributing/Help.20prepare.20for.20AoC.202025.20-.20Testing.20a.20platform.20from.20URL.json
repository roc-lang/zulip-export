[
    {
        "content": "<p>Is there anyone online who could help me test running roc with a platform from URL?</p>",
        "id": 560520293,
        "sender_full_name": "Luke Boswell",
        "timestamp": 1764222680
    },
    {
        "content": "<p>Sure thing. <span aria-label=\"blush\" class=\"emoji emoji-1f60a\" role=\"img\" title=\"blush\">:blush:</span></p>",
        "id": 560520322,
        "sender_full_name": "Kevin Hovsäter",
        "timestamp": 1764222704
    },
    {
        "content": "<p>Can you build roc from source off this branch <a href=\"https://github.com/roc-lang/roc/pull/8464\">https://github.com/roc-lang/roc/pull/8464</a></p>",
        "id": 560520332,
        "sender_full_name": "Luke Boswell",
        "timestamp": 1764222716
    },
    {
        "content": "<p><code>zig build roc</code></p>",
        "id": 560520341,
        "sender_full_name": "Luke Boswell",
        "timestamp": 1764222722
    },
    {
        "content": "<p>And then run this app </p>\n<div class=\"codehilite\"><pre><span></span><code>app [main!] { pf: platform &quot;https://github.com/lukewilliamboswell/roc-platform-template-zig/releases/download/0.1-test/LKroJZnzRzHS2JPYcWa6bEdFN129zawLf5ub8CrYgcH.tar.zst&quot; }\n\nimport pf.Stdout\n\nmain! = || {\n    Stdout.line!(&quot;Hello World&quot;)\n}\n</code></pre></div>",
        "id": 560520382,
        "sender_full_name": "Luke Boswell",
        "timestamp": 1764222762
    },
    {
        "content": "<p>Let me know what machine / os / arch your on if you run it please -- it's working for me on my arm64 Mac</p>",
        "id": 560520473,
        "sender_full_name": "Luke Boswell",
        "timestamp": 1764222861
    },
    {
        "content": "<p>Seems to be working nicely. I'm running on a M1 MBP (macOS 15.6.1).</p>",
        "id": 560520572,
        "sender_full_name": "Kevin Hovsäter",
        "timestamp": 1764222954
    },
    {
        "content": "<p>For anyone interested here is the zig platform template I used to generate that package <a href=\"https://github.com/lukewilliamboswell/roc-platform-template-zig/tree/0.1\">https://github.com/lukewilliamboswell/roc-platform-template-zig/tree/0.1</a></p>",
        "id": 560520913,
        "sender_full_name": "Luke Boswell",
        "timestamp": 1764223245
    },
    {
        "content": "<p>8 messages were moved here from <a class=\"stream-topic\" data-stream-id=\"397893\" href=\"/#narrow/channel/397893-announcements/topic/Help.20prepare.20for.20AoC.202025/with/560485589\">#announcements &gt; Help prepare for AoC 2025</a> by <span class=\"user-mention silent\" data-user-id=\"515757\">Luke Boswell</span>.</p>",
        "id": 560521034,
        "sender_full_name": "Notification Bot",
        "timestamp": 1764223331
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"515757\">@Luke Boswell</span> would it make sense to have a way to read the entirely of Stdin or are we imagining people just looping over <code>Stdin.line!</code> until <code>\"\"</code> is reached?</p>",
        "id": 560522052,
        "sender_full_name": "Kevin Hovsäter",
        "timestamp": 1764224080
    },
    {
        "content": "<p>This is just a template to show how to create a simple platform... I copied the Fx test platform verbatim.</p>",
        "id": 560522146,
        "sender_full_name": "Luke Boswell",
        "timestamp": 1764224152
    },
    {
        "content": "<p>I would love to see people experiment with different ideas for platform API's and capabilities</p>",
        "id": 560522167,
        "sender_full_name": "Luke Boswell",
        "timestamp": 1764224175
    },
    {
        "content": "<p>My immediate goal is to get something working for AoC</p>",
        "id": 560522180,
        "sender_full_name": "Luke Boswell",
        "timestamp": 1764224187
    },
    {
        "content": "<p>I see, that makes sense. <span aria-label=\"slight smile\" class=\"emoji emoji-1f642\" role=\"img\" title=\"slight smile\">:slight_smile:</span></p>",
        "id": 560522202,
        "sender_full_name": "Kevin Hovsäter",
        "timestamp": 1764224206
    },
    {
        "content": "<p>Pushed some fixes to that branch... and now we have x64 Windows running from a URL too! <span aria-label=\"smiley\" class=\"emoji emoji-1f603\" role=\"img\" title=\"smiley\">:smiley:</span> </p>\n<div class=\"codehilite\"><pre><span></span><code>C:\\Users\\bosyl\\Documents\\Github\\roc&gt;zig build roc\n\nC:\\Users\\bosyl\\Documents\\Github\\roc&gt;roc test.roc\nHello World\n</code></pre></div>",
        "id": 560522399,
        "sender_full_name": "Luke Boswell",
        "timestamp": 1764224379
    },
    {
        "content": "<p>And ... I get a segfault on x64 linux <span aria-label=\"tear\" class=\"emoji emoji-1f972\" role=\"img\" title=\"tear\">:tear:</span></p>",
        "id": 560523801,
        "sender_full_name": "Luke Boswell",
        "timestamp": 1764225287
    },
    {
        "content": "<p>I just tried to build the Roc compiler using <code>zig build test</code> and now my \"hello, world\" program isn't running anymore. I just get <code>error: Failed to set up shared memory with ModuleEnv: error.InvalidAppPath</code> when trying to run the program.</p>\n<p>This is on <code>d28a978d8b957f3b88dbc92dcbbc6a87ffb0e8f4</code> on a M1 MBP on macOS 15.16.1.</p>",
        "id": 560541722,
        "sender_full_name": "Kevin Hovsäter",
        "timestamp": 1764233224
    },
    {
        "content": "<p>Interesting... I'll have a closer look tomorrow</p>",
        "id": 560542743,
        "sender_full_name": "Luke Boswell",
        "timestamp": 1764233569
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"452574\">@Kevin Hovsäter</span> just to make sure we're on the same page, these details would be helpful:</p>\n<ul>\n<li>what's the source code of the .roc file?</li>\n<li>what directory is the .roc file in?</li>\n<li>what command are you using to run the program?</li>\n<li>what directory are you in when you run the command?</li>\n</ul>",
        "id": 560588357,
        "sender_full_name": "Richard Feldman",
        "timestamp": 1764247508
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"281383\">@Richard Feldman</span> </p>\n<blockquote>\n<p>what's the source code of the .roc file?</p>\n</blockquote>\n<div class=\"codehilite\" data-code-language=\"Bash Session\"><pre><span></span><code><span class=\"go\">~/prj/advent-of-code $ cat hello.roc</span>\n<span class=\"go\">app [main!] { pf: platform \"./platform/main.roc\" }</span>\n\n<span class=\"go\">import pf.Stdout</span>\n\n<span class=\"go\">main! = || {</span>\n<span class=\"go\">    Stdout.line!(\"Hello, world!\")</span>\n<span class=\"go\">}</span>\n</code></pre></div>\n<blockquote>\n<p>what directory is the .roc file in?</p>\n</blockquote>\n<div class=\"codehilite\" data-code-language=\"Bash Session\"><pre><span></span><code><span class=\"go\">~/prj/advent-of-code $ tree</span>\n<span class=\"go\">.</span>\n<span class=\"go\">├── hello.roc</span>\n<span class=\"go\">└── platform</span>\n<span class=\"go\">    ├── host.zig</span>\n<span class=\"go\">    ├── libhost.a</span>\n<span class=\"go\">    ├── main.roc</span>\n<span class=\"go\">    ├── Stderr.roc</span>\n<span class=\"go\">    ├── Stdin.roc</span>\n<span class=\"go\">    └── Stdout.roc</span>\n\n<span class=\"go\">2 directories, 7 files</span>\n</code></pre></div>\n<blockquote>\n<ul>\n<li>what command are you using to run the program?</li>\n<li>what directory are you in when you run the command?</li>\n</ul>\n</blockquote>\n<div class=\"codehilite\" data-code-language=\"Bash Session\"><pre><span></span><code><span class=\"go\">~/prj/advent-of-code $ roc hello.roc</span>\n<span class=\"go\">error: Failed to set up shared memory with ModuleEnv: error.InvalidAppPath</span>\n<span class=\"go\">~/prj/advent-of-code $ which roc</span>\n<span class=\"go\">/Users/kevin/src/roc/zig-out/bin/roc</span>\n</code></pre></div>\n<p>Roc was built using <code>zig build test</code> and I copied the platform from <code>test/fx/platform</code> into <code>~/prj/advent-of-code</code>.</p>",
        "id": 560590130,
        "sender_full_name": "Kevin Hovsäter",
        "timestamp": 1764248015
    },
    {
        "content": "<p>excellent, thank you!</p>",
        "id": 560590175,
        "sender_full_name": "Richard Feldman",
        "timestamp": 1764248031
    },
    {
        "content": "<p>fix for this: <a href=\"https://github.com/roc-lang/roc/pull/8471\">https://github.com/roc-lang/roc/pull/8471</a></p>",
        "id": 560597463,
        "sender_full_name": "Richard Feldman",
        "timestamp": 1764250148
    },
    {
        "content": "<p>Tried to build your branch but got the following errors:</p>\n<div class=\"codehilite\" data-code-language=\"Bash Session\"><pre><span></span><code><span class=\"go\">~/src/roc (fix-dir-bug) $ zig build test</span>\n<span class=\"go\">test</span>\n<span class=\"go\">└─ tests_summary</span>\n<span class=\"go\">   └─ run test fx_platform_test 14/16 passed, 2 failed</span>\n<span class=\"go\">error: 'fx_platform_test.test.fx platform opaque type with method' failed: Run failed with exit code 1</span>\n<span class=\"go\">STDOUT:</span>\n<span class=\"go\">STDERR: error: Child process /Users/kevin/Library/Caches/roc/3db62731d7e536d5d9c27137f68b7c5a/temp/roc-tmp-knVzb0gLfOcUKmevHkXrzfZb8Q6PxsNs/roc_run_1170380953 killed by signal: 11</span>\n<span class=\"go\">error: Child process crashed with segmentation fault (SIGSEGV)</span>\n\n<span class=\"go\">/Users/kevin/src/roc/src/cli/test/fx_platform_test.zig:585:17: 0x102489d67 in test.fx platform opaque type with method (fx_platform_test)</span>\n<span class=\"go\">                return error.RunFailed;</span>\n<span class=\"go\">                ^</span>\n<span class=\"go\">error: 'fx_platform_test.test.fx platform run from different cwd' failed: Run failed with exit code 1</span>\n<span class=\"go\">STDOUT:</span>\n<span class=\"go\">STDERR: error: Failed to set up shared memory with ModuleEnv: error.InvalidAppPath</span>\n\n<span class=\"go\">/Users/kevin/src/roc/src/cli/test/fx_platform_test.zig:672:17: 0x10248ad37 in test.fx platform run from different cwd (fx_platform_test)</span>\n<span class=\"go\">                return error.RunFailed;</span>\n<span class=\"go\">                ^</span>\n<span class=\"go\">error: while executing test 'fx_platform_test.test.fx platform run from different cwd', the following test command failed:</span>\n<span class=\"go\">./.zig-cache/o/a3568d4bddc2e60f4e000977a4db93f6/fx_platform_test --cache-dir=./.zig-cache --seed=0x75600522 --listen=-</span>\n\n<span class=\"go\">Build Summary: 54/57 steps succeeded; 1 failed; 1615/1617 tests passed; 2 failed</span>\n<span class=\"go\">test transitive failure</span>\n<span class=\"go\">└─ tests_summary transitive failure</span>\n<span class=\"go\">   └─ run test fx_platform_test 14/16 passed, 2 failed</span>\n\n<span class=\"go\">error: the following build command failed with exit code 1:</span>\n<span class=\"go\">.zig-cache/o/e6d6ec7fb8dbc0a4bd0962fb69f26247/build /Users/kevin/.asdf/installs/zig/0.15.2/zig /Users/kevin/.asdf/installs/zig/0.15.2/lib /Users/kevin/src/roc .zig-cache /Users/kevin/.cache/zig --seed 0x75600522 -Zf8f5c3ff46d8dde4 test</span>\n</code></pre></div>",
        "id": 560598417,
        "sender_full_name": "Kevin Hovsäter",
        "timestamp": 1764250427
    },
    {
        "content": "<p>ah it's a stale <code>roc</code> binary - I just pushed something to that branch to force rebuilding it for the tests</p>",
        "id": 560599437,
        "sender_full_name": "Richard Feldman",
        "timestamp": 1764250683
    },
    {
        "content": "<p>That did indeed work! And now both absolute and relative paths seem to work as expected! <span aria-label=\"tada\" class=\"emoji emoji-1f389\" role=\"img\" title=\"tada\">:tada:</span></p>",
        "id": 560600745,
        "sender_full_name": "Kevin Hovsäter",
        "timestamp": 1764251044
    },
    {
        "content": "<p>Can I get more folks to help me test this?</p>",
        "id": 560679900,
        "sender_full_name": "Luke Boswell",
        "timestamp": 1764283388
    },
    {
        "content": "<div class=\"codehilite\"><pre><span></span><code>app [main!] { pf: platform &quot;https://github.com/lukewilliamboswell/roc-platform-template-zig/releases/download/0.1-test/LKroJZnzRzHS2JPYcWa6bEdFN129zawLf5ub8CrYgcH.tar.zst&quot; }\n\nimport pf.Stdout\n\nmain! = || {\n    Stdout.line!(&quot;Hello World&quot;)\n}\n</code></pre></div>",
        "id": 560679918,
        "sender_full_name": "Luke Boswell",
        "timestamp": 1764283397
    },
    {
        "content": "<p>Build roc from source on the <code>bundle-changes</code> branch</p>",
        "id": 560679941,
        "sender_full_name": "Luke Boswell",
        "timestamp": 1764283415
    },
    {
        "content": "<div class=\"codehilite\"><pre><span></span><code>9:33:19 ~/Documents/GitHub/roc bundle-changes $ zig build roc\n9:42:28 ~/Documents/GitHub/roc bundle-changes $ roc test.roc\nHello World\n</code></pre></div>",
        "id": 560679946,
        "sender_full_name": "Luke Boswell",
        "timestamp": 1764283426
    },
    {
        "content": "<p>Specifically any linux users</p>",
        "id": 560680037,
        "sender_full_name": "Luke Boswell",
        "timestamp": 1764283498
    },
    {
        "content": "<p>I've got it working on all three OS's now -- if <a href=\"https://github.com/roc-lang/roc/pull/8464\">https://github.com/roc-lang/roc/pull/8464</a> passes we should be good for supporting basic platforms from URL's</p>",
        "id": 560686322,
        "sender_full_name": "Luke Boswell",
        "timestamp": 1764288491
    },
    {
        "content": "<p>I hate to say it, but on x86_64 linux I get</p>\n<div class=\"codehilite\"><pre><span></span><code>$ zig-out/bin/roc main.roc\nerror: Child process /home/timob/.cache/roc/c17e6c1672ab85bbfeb20617f7710e69/temp/roc-tmp-Rj9qhjzcZYcolwSXZm4NfPCDD31RecAU/roc_run_733124949 killed by signal: 11\nerror: Child process crashed with segmentation fault (SIGSEGV)\n</code></pre></div>\n<p>with</p>\n<div class=\"codehilite\"><pre><span></span><code>$ cat main.roc\n\napp [main!] { pf: platform &quot;https://github.com/lukewilliamboswell/roc-platform-template-zig/releases/download/0.1-test/LKroJZnzRzHS2JPYcWa6bEdFN129zawLf5ub8CrYgcH.tar.zst&quot; }\n\nimport pf.Stdout\n\nmain! = || {\n    Stdout.line!(&quot;Hello World&quot;)\n}\n</code></pre></div>\n<p>and</p>\n<div class=\"codehilite\"><pre><span></span><code>$ zig-out/bin/roc version\nRoc compiler version debug-c4550425\n\n$ git show --oneline\nc455042522 (HEAD) Merge pull request #8464 from roc-lang/bundle-changes\n</code></pre></div>\n<p><code>main</code> doesn't build for me right now and <code>bundle-changes</code> seems to  have been deleted, so I checked out the merge commit directly.</p>",
        "id": 560717531,
        "sender_full_name": "isaactfa",
        "timestamp": 1764313450
    },
    {
        "content": "<blockquote>\n<p><code>main</code> doesn't build for me right now</p>\n</blockquote>\n<p>I'm looking into this.</p>",
        "id": 560751611,
        "sender_full_name": "Anton",
        "timestamp": 1764325681
    },
    {
        "content": "<p>I've been updating the release URL as I fix things, maybe that is related?</p>",
        "id": 560755157,
        "sender_full_name": "Luke Boswell",
        "timestamp": 1764326745
    },
    {
        "content": "<p>Building from latest main (<code>7ac22c8134</code>) and updating the platform URL, I now get</p>\n<div class=\"codehilite\" data-code-language=\"Bash Session\"><pre><span></span><code><span class=\"gp\">$ </span>zig-out/bin/roc<span class=\"w\"> </span>--no-cache<span class=\"w\"> </span>app.roc\n<span class=\"go\">-- TYPE MISMATCH ---------------------------------</span>\n\n<span class=\"go\">This expression is used in an unexpected way:</span>\n<span class=\"go\">  ┌─ app.roc:1:31</span>\n<span class=\"go\">  │</span>\n<span class=\"go\">1 │ app [main!] { pf: platform \"https://github.com/lukewilliamboswell/roc-platform-template-zig/releases/download/0.1-test/AvzUEjKDoDpEYCFLXbNRKE2KhsLKL7qze3MSjPRJeF6r.tar.zst\" }</span>\n<span class=\"go\">  │                               ^^^^^^^^^^^^^^^^^^^^^^^^</span>\n\n<span class=\"go\">It has the type:</span>\n<span class=\"go\">    ({}) =&gt; {  }</span>\n\n<span class=\"go\">But the type annotation says it should have the type:</span>\n<span class=\"go\">    List(Str) =&gt; I32</span>\n\n<span class=\"go\">Found 1 error(s) and 0 warning(s) for app.roc.</span>\n<span class=\"go\">error: Child process /home/timob/.cache/roc/0d5608741eabdb649e1715914204021a/temp/roc-tmp-i8XQnMLWvAe7moTQCnV5r9wzAxm2NkYN/roc_run_1662736024 killed by signal: 11</span>\n<span class=\"go\">error: Child process crashed with segmentation fault (SIGSEGV)</span>\n</code></pre></div>\n<p><code>objdump</code>ing that binary (~/.cache/roc/0d5608741eabdb649e1715914204021a/temp/roc-tmp-i8XQnMLWvAe7moTQCnV5r9wzAxm2NkYN/roc_run_1662736024) shows that it's just full of debug information... there's no entry point, no nothing. The only section that doesn't have \".debug\" in the name is \".eh_frame\". I'm unfortunately no linker expert, I'm not sure what's going on, but the interpreter shim doesn't seem to be getting linked in properly....?</p>\n<div class=\"codehilite\" data-code-language=\"Bash Session\"><pre><span></span><code><span class=\"gp\">$ </span>zig-out/bin/roc<span class=\"w\"> </span>version\n<span class=\"go\">Roc compiler version debug-7ac22c81</span>\n\n<span class=\"gp\">$ </span>cat<span class=\"w\"> </span>app.roc\n<span class=\"go\">app [main!] { pf: platform \"https://github.com/lukewilliamboswell/roc-platform-template-zig/releases/download/0.1-test/AvzUEjKDoDpEYCFLXbNRKE2KhsLKL7qze3MSjPRJeF6r.tar.zst\" }</span>\n\n<span class=\"go\">import pf.Stdout</span>\n\n<span class=\"go\">main! = || {</span>\n<span class=\"go\">    Stdout.line!(\"Hello World\")</span>\n<span class=\"go\">}</span>\n</code></pre></div>",
        "id": 560812624,
        "sender_full_name": "isaactfa",
        "timestamp": 1764344273
    },
    {
        "content": "<p>The issue here is that I changed the platform API to take cli args as a <code>List(Str)</code> in main. Sorry I didn't really let anyone know, I was in the middle of trying to get it all working properly when I had to log off for a xmas function.</p>",
        "id": 560853927,
        "sender_full_name": "Luke Boswell",
        "timestamp": 1764363617
    },
    {
        "content": "<p>I'm not loving the current api I've been testing,<code>main! : List(Str) =&gt; I32</code> -- it just feels weird to end the block expression with a number.</p>",
        "id": 560855141,
        "sender_full_name": "Luke Boswell",
        "timestamp": 1764364474
    },
    {
        "content": "<div class=\"codehilite\"><pre><span></span><code>main! : List(Str) =&gt; I32\nmain! = |args| {\n    count = List.len(args)\n    Stdout.line!(&quot;Hello World! Got ${count.to_str()} args&quot;)\n\n\n    exit_code : I32\n    exit_code = 0\n\n    exit_code\n}\n</code></pre></div>",
        "id": 560855177,
        "sender_full_name": "Luke Boswell",
        "timestamp": 1764364488
    },
    {
        "content": "<p>You can always default to success and add an explicit \"exit!\" functions that takes an exit code and leads to early exist.</p>",
        "id": 560856098,
        "sender_full_name": "Brendan Hansknecht",
        "timestamp": 1764365231
    },
    {
        "content": "<p>Yeah I think something like that will be much nicer</p>",
        "id": 560856133,
        "sender_full_name": "Luke Boswell",
        "timestamp": 1764365260
    },
    {
        "content": "<p>I like having <code>main!</code> take <code>Try({}, [Exit code(I32), .._others]</code></p>",
        "id": 560856187,
        "sender_full_name": "Richard Feldman",
        "timestamp": 1764365313
    },
    {
        "content": "<p>although that's nicest if <code>Stdout.line!</code> returns <code>Try</code> so maybe not ideal for Advent of Code</p>",
        "id": 560856247,
        "sender_full_name": "Richard Feldman",
        "timestamp": 1764365368
    },
    {
        "content": "<p>I have been having trouble getting <code>Try</code> to typecheck in the return position, and also couldn't figure out how to get an open union to work</p>",
        "id": 560856274,
        "sender_full_name": "Luke Boswell",
        "timestamp": 1764365386
    },
    {
        "content": "<p>I figured I'd strip it back and make one change at a time to the API, started with the args and that has opened a can of worms</p>",
        "id": 560856342,
        "sender_full_name": "Luke Boswell",
        "timestamp": 1764365439
    }
]