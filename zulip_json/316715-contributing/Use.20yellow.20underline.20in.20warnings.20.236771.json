[
    {
        "content": "<p>For issue <a href=\"https://github.com/roc-lang/roc/issues/6771\">6771</a>, the function <code>region_with_subregion</code> in <code>crates/reporting/src/report.rs</code> seems  to be responsible for determining the color of the text. I was thinking about adding the<code>Severity</code> enum in <code>crates/compiler/problem/src/lib.rs</code>, but since so many functions have both direct and indirect dependencies on <code>region_with_subregion</code> it is turning into a massive change. Is there a better way to do this or is there only pain when it comes to making this change? <span aria-label=\"laughing\" class=\"emoji emoji-1f606\" role=\"img\" title=\"laughing\">:laughing:</span> </p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"w\">    </span><span class=\"k\">pub</span><span class=\"w\"> </span><span class=\"k\">fn</span><span class=\"w\"> </span><span class=\"nf\">region_with_subregion</span><span class=\"p\">(</span>\n<span class=\"w\">        </span><span class=\"o\">&amp;'</span><span class=\"na\">a</span><span class=\"w\"> </span><span class=\"bp\">self</span><span class=\"p\">,</span>\n<span class=\"w\">        </span><span class=\"n\">region</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">LineColumnRegion</span><span class=\"p\">,</span>\n<span class=\"w\">        </span><span class=\"n\">sub_region</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">LineColumnRegion</span><span class=\"p\">,</span>\n<span class=\"w\">    </span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"p\">-&gt;</span><span class=\"w\"> </span><span class=\"nc\">DocBuilder</span><span class=\"o\">&lt;'</span><span class=\"na\">a</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"bp\">Self</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">Annotation</span><span class=\"o\">&gt;</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"o\">..</span><span class=\"p\">.</span>\n<span class=\"w\">        </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"n\">error_highlight_line</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">            </span><span class=\"kd\">let</span><span class=\"w\"> </span><span class=\"n\">highlight_text</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">ERROR_UNDERLINE</span>\n<span class=\"w\">                </span><span class=\"p\">.</span><span class=\"n\">repeat</span><span class=\"p\">((</span><span class=\"n\">sub_region</span><span class=\"p\">.</span><span class=\"n\">end</span><span class=\"p\">().</span><span class=\"n\">column</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"w\"> </span><span class=\"n\">sub_region</span><span class=\"p\">.</span><span class=\"n\">start</span><span class=\"p\">().</span><span class=\"n\">column</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"k\">as</span><span class=\"w\"> </span><span class=\"kt\">usize</span><span class=\"p\">);</span>\n\n<span class=\"w\">            </span><span class=\"kd\">let</span><span class=\"w\"> </span><span class=\"n\">highlight_line</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"bp\">self</span>\n<span class=\"w\">                </span><span class=\"p\">.</span><span class=\"n\">line</span><span class=\"p\">()</span>\n<span class=\"w\">                </span><span class=\"c1\">// Omit the gutter bar when we know there are no further</span>\n<span class=\"w\">                </span><span class=\"c1\">// line numbers to be printed after this!</span>\n<span class=\"w\">                </span><span class=\"p\">.</span><span class=\"n\">append</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">.</span><span class=\"n\">text</span><span class=\"p\">(</span><span class=\"s\">\" \"</span><span class=\"p\">.</span><span class=\"n\">repeat</span><span class=\"p\">(</span><span class=\"n\">max_line_number_length</span><span class=\"w\"> </span><span class=\"o\">+</span><span class=\"w\"> </span><span class=\"n\">GUTTER_BAR_WIDTH</span><span class=\"p\">)))</span>\n<span class=\"w\">                </span><span class=\"p\">.</span><span class=\"n\">append</span><span class=\"p\">(</span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"n\">highlight_text</span><span class=\"p\">.</span><span class=\"n\">is_empty</span><span class=\"p\">()</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">                    </span><span class=\"bp\">self</span><span class=\"p\">.</span><span class=\"n\">nil</span><span class=\"p\">()</span>\n<span class=\"w\">                </span><span class=\"p\">}</span><span class=\"w\"> </span><span class=\"k\">else</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">                    </span><span class=\"bp\">self</span><span class=\"p\">.</span><span class=\"n\">text</span><span class=\"p\">(</span><span class=\"s\">\" \"</span><span class=\"p\">.</span><span class=\"n\">repeat</span><span class=\"p\">(</span><span class=\"n\">sub_region</span><span class=\"p\">.</span><span class=\"n\">start</span><span class=\"p\">().</span><span class=\"n\">column</span><span class=\"w\"> </span><span class=\"k\">as</span><span class=\"w\"> </span><span class=\"kt\">usize</span><span class=\"p\">))</span>\n<span class=\"w\">                        </span><span class=\"p\">.</span><span class=\"n\">indent</span><span class=\"p\">(</span><span class=\"n\">indent</span><span class=\"p\">)</span>\n<span class=\"w\">                        </span><span class=\"p\">.</span><span class=\"n\">append</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">.</span><span class=\"n\">text</span><span class=\"p\">(</span><span class=\"n\">highlight_text</span><span class=\"p\">).</span><span class=\"n\">annotate</span><span class=\"p\">(</span><span class=\"n\">Annotation</span><span class=\"p\">::</span><span class=\"n\">Error</span><span class=\"p\">))</span>\n<span class=\"w\">                </span><span class=\"p\">});</span>\n\n<span class=\"w\">            </span><span class=\"n\">result</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">result</span><span class=\"p\">.</span><span class=\"n\">append</span><span class=\"p\">(</span><span class=\"n\">highlight_line</span><span class=\"p\">);</span>\n<span class=\"w\">        </span><span class=\"p\">}</span>\n<span class=\"o\">..</span><span class=\"p\">.</span>\n<span class=\"p\">}</span>\n</code></pre></div>",
        "id": 442066162,
        "sender_full_name": "John Konecny",
        "timestamp": 1717343021
    },
    {
        "content": "<p>Thanks for looking into this <span class=\"user-mention\" data-user-id=\"725528\">@John Konecny</span>, I do indeed believe a large amount of changes is necessary.</p>",
        "id": 443119992,
        "sender_full_name": "Anton",
        "timestamp": 1717695345
    },
    {
        "content": "<p>Thanks for the clarification! By the way itâ€™s all good if someone beats me to this fix.</p>",
        "id": 443451545,
        "sender_full_name": "John Konecny",
        "timestamp": 1717842435
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"361169\">@Anton</span> <br>\n<a href=\"https://github.com/roc-lang/roc/pull/6794\">https://github.com/roc-lang/roc/pull/6794</a></p>",
        "id": 443629690,
        "sender_full_name": "John Konecny",
        "timestamp": 1717961428
    },
    {
        "content": "<p>I kicked off CI for this</p>",
        "id": 443660958,
        "sender_full_name": "Luke Boswell",
        "timestamp": 1717979184
    }
]