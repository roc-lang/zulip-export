[
    {
        "content": "<p>Hey, I'd like to contribute more over the next few weeks. What would be the best way to do that so that we have a working interpreter for AoC?</p>",
        "id": 541981808,
        "sender_full_name": "Fabian Schmalzried",
        "timestamp": 1759137317
    },
    {
        "content": "<p>Thanks Fabian, how familiar are you with zig?</p>",
        "id": 541982024,
        "sender_full_name": "Anton",
        "timestamp": 1759137376
    },
    {
        "content": "<p>I did ziglings and a few small changes in the compiler. So enough to be dangerous? But I also want to use this as a learning opportunity.</p>",
        "id": 541982963,
        "sender_full_name": "Fabian Schmalzried",
        "timestamp": 1759137604
    },
    {
        "content": "<p>How do you feel about helping out investigating this general protection fault on the branch upgrade-to-zig-0.15.1:<br>\n<a href=\"/user_uploads/22008/Xf32ofXEKblj8MNLAhGncLkJ/GeneralProtectionFault.txt\">GeneralProtectionFault.txt</a></p>",
        "id": 541983867,
        "sender_full_name": "Anton",
        "timestamp": 1759137848
    },
    {
        "content": "<p>Looks challenging, I like it. But no promises I manage to find anything.</p>",
        "id": 541985909,
        "sender_full_name": "Fabian Schmalzried",
        "timestamp": 1759138339
    },
    {
        "content": "<p><span aria-label=\"+1\" class=\"emoji emoji-1f44d\" role=\"img\" title=\"+1\">:+1:</span> No promises expected :p</p>",
        "id": 541986297,
        "sender_full_name": "Anton",
        "timestamp": 1759138433
    },
    {
        "content": "<p>I had a quick look at this, but I'm not 100% sure what the problem is exactly. Something with the changes to the Reader and Writer in 0.15.1. Maybe it would make sense to completely move the new ones? Would be a bit of work, but I think it should be done anyway? I will try it out if that fixes it.</p>",
        "id": 542218924,
        "sender_full_name": "Fabian Schmalzried",
        "timestamp": 1759222555
    },
    {
        "content": "<blockquote>\n<p>to completely move the new ones</p>\n</blockquote>\n<p>What do you mean exactly?</p>",
        "id": 542221715,
        "sender_full_name": "Anton",
        "timestamp": 1759223307
    },
    {
        "content": "<p>I assume typo - \"completely move <strong>to</strong> the new ones?\" <span aria-label=\"smiley\" class=\"emoji emoji-1f603\" role=\"img\" title=\"smiley\">:smiley:</span></p>",
        "id": 542248564,
        "sender_full_name": "Richard Feldman",
        "timestamp": 1759231437
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"281383\">Richard Feldman</span> <a href=\"#narrow/channel/316715-contributing/topic/where.20to.20contribute.20next.3F/near/542248564\">said</a>:</p>\n<blockquote>\n<p>I assume typo - \"completely move <strong>to</strong> the new ones?\" <span aria-label=\"smiley\" class=\"emoji emoji-1f603\" role=\"img\" title=\"smiley\">:smiley:</span></p>\n</blockquote>\n<p>Yes typo. I thought maybe removing std.io.AnyWriter in favor of std.Io.Writer might help. But I'm not sure anymore. Now I think it's something with zstd.</p>",
        "id": 542249348,
        "sender_full_name": "Fabian Schmalzried",
        "timestamp": 1759231670
    },
    {
        "content": "<blockquote>\n<p>I thought maybe removing std.io.AnyWriter in favor of std.Io.Writer might help.</p>\n</blockquote>\n<p>Yeah that may be a good idea to clean things up.</p>",
        "id": 542255328,
        "sender_full_name": "Anton",
        "timestamp": 1759233490
    },
    {
        "content": "<blockquote>\n<p>removing std.io.AnyWriter in favor of std.Io.Writer</p>\n</blockquote>\n<p>I'm going to take care of the merge conflicts on that branch and update to std.Io.Writer after.</p>",
        "id": 542278508,
        "sender_full_name": "Anton",
        "timestamp": 1759239417
    },
    {
        "content": "<p>The merge is done (and pushed), I will get on std.io.AnyWriter tomorrow.<br>\nThe merged code still shows the \"General protection exception\" by the way.</p>",
        "id": 542335025,
        "sender_full_name": "Anton",
        "timestamp": 1759254483
    },
    {
        "content": "<p>The <a href=\"https://ziglang.org/download/0.15.1/release-notes.html#toc-Writergate\">writergate</a> struggle is real :p</p>",
        "id": 542335412,
        "sender_full_name": "Anton",
        "timestamp": 1759254590
    },
    {
        "content": "<p>yeah it's a big change in 0.15.1. I think the <code>CompressingHashWriter</code> will be the biggest rework to support the new API. But there is <code>std.io.Hashed</code>, which could be used together with an <code>CompressingWriter</code> to get an <code>CompressingHashWriter</code> again.</p>",
        "id": 542373882,
        "sender_full_name": "Fabian Schmalzried",
        "timestamp": 1759269417
    },
    {
        "content": "<p>I appreciate all the work <span class=\"user-mention\" data-user-id=\"611722\">@Isaac Van Doren</span> and <span class=\"user-mention\" data-user-id=\"361169\">@Anton</span> have been doing getting us up to 0.15 -- looking forward to using the dev backend for x64 <span aria-label=\"smiley\" class=\"emoji emoji-1f603\" role=\"img\" title=\"smiley\">:smiley:</span></p>",
        "id": 542383418,
        "sender_full_name": "Luke Boswell",
        "timestamp": 1759275307
    },
    {
        "content": "<p>I updated all the deprecated writer/reader things and eventually got all of <code>zig build test</code> to pass on my machine <span aria-label=\"tada\" class=\"emoji emoji-1f389\" role=\"img\" title=\"tada\">:tada:</span></p>",
        "id": 542557504,
        "sender_full_name": "Anton",
        "timestamp": 1759342724
    },
    {
        "content": "<p>Let's see what CI says...</p>",
        "id": 542557564,
        "sender_full_name": "Anton",
        "timestamp": 1759342749
    },
    {
        "content": "<p>Ok, cross-compiling and playground tests don't work but progress was made :p</p>",
        "id": 542557930,
        "sender_full_name": "Anton",
        "timestamp": 1759342908
    },
    {
        "content": "<p>I see that the playground wasm is broken now. I can go and try to fix that.</p>",
        "id": 542755513,
        "sender_full_name": "Fabian Schmalzried",
        "timestamp": 1759415074
    },
    {
        "content": "<p>I fixed the playground on my fork. <a href=\"https://github.com/FabHof/roc/tree/upgrade-to-zig-0.15.1\">https://github.com/FabHof/roc/tree/upgrade-to-zig-0.15.1</a><br>\nFeel free to pull this in, or I create a PR</p>",
        "id": 542836620,
        "sender_full_name": "Fabian Schmalzried",
        "timestamp": 1759442403
    },
    {
        "content": "<p>PR would be great, thank you! <span aria-label=\"smiley\" class=\"emoji emoji-1f603\" role=\"img\" title=\"smiley\">:smiley:</span></p>",
        "id": 542837651,
        "sender_full_name": "Richard Feldman",
        "timestamp": 1759443021
    },
    {
        "content": "<p><a href=\"https://github.com/roc-lang/roc/issues/8260\">#8260</a></p>",
        "id": 542837818,
        "sender_full_name": "Fabian Schmalzried",
        "timestamp": 1759443158
    },
    {
        "content": "<p>but <code>roc build</code> still does not work. But it looks like there is a mismatch between the zig_llvm.h and the builder.zig.</p>",
        "id": 542838116,
        "sender_full_name": "Fabian Schmalzried",
        "timestamp": 1759443359
    },
    {
        "content": "<p>I wonder what roc will see for compilation speed improvements with 0.15.1:<br>\n<a href=\"https://x.com/mitchellh/status/1974240007193047063?t=CTLqDlNDaQGhG1DJVMuELA&amp;s=19\">https://x.com/mitchellh/status/1974240007193047063?t=CTLqDlNDaQGhG1DJVMuELA&amp;s=19</a></p>",
        "id": 543114932,
        "sender_full_name": "Brendan Hansknecht",
        "timestamp": 1759609916
    },
    {
        "content": "<p>Very nice, I'm a little busy now but I can check later, <code>zig build roc</code> and <code>zig build</code> work on upgrade-to-zig-0.15.1 . I have not checked the last merged commit, but 0b1fdb5c82008695bacc3c89c6b3e3cfb44b6824 should work.</p>",
        "id": 543136120,
        "sender_full_name": "Anton",
        "timestamp": 1759638828
    },
    {
        "content": "<p>Simple time <code>time zig build roc</code> on my slow machine:<br>\nmain:</p>\n<div class=\"codehilite\"><pre><span></span><code>real    1m5,361s\nuser    1m21,896s\nsys     0m8,542s\n</code></pre></div>\n<p>upgrade-to-zig-0.15.1:</p>\n<div class=\"codehilite\"><pre><span></span><code>real    0m24,207s\nuser    0m50,877s\nsys     0m7,206s\n</code></pre></div>",
        "id": 543163626,
        "sender_full_name": "Fabian Schmalzried",
        "timestamp": 1759671678
    },
    {
        "content": "<p>is that an x86-64 machine?</p>",
        "id": 543166094,
        "sender_full_name": "Richard Feldman",
        "timestamp": 1759674262
    },
    {
        "content": "<p>yes: Intel(R) Core(TM) i7-10510U CPU @ 1.80GHz</p>",
        "id": 543169090,
        "sender_full_name": "Fabian Schmalzried",
        "timestamp": 1759677255
    },
    {
        "content": "<p>Nice. More than 2x</p>",
        "id": 543189133,
        "sender_full_name": "Brendan Hansknecht",
        "timestamp": 1759694130
    },
    {
        "content": "<p>what's still needed before we can land the 0.15.1 upgrade?</p>",
        "id": 543943548,
        "sender_full_name": "Richard Feldman",
        "timestamp": 1760012132
    },
    {
        "content": "<p>Looks like nothing changes sind ny PR, so <code>roc build</code> probably still fails with an error, that is connected to changes in the zig_llvm.h, if I remember correctly. But I don't understand what those changes are supposed to do, so I didn't feel qualified to fix it.</p>",
        "id": 543944176,
        "sender_full_name": "Fabian Schmalzried",
        "timestamp": 1760012335
    },
    {
        "content": "<p>I can get back on that next week</p>",
        "id": 544107942,
        "sender_full_name": "Anton",
        "timestamp": 1760083034
    },
    {
        "content": "<p>We are on zig 0.15.2 now, I did not wait for someone else to review, because this branch was accumulating merge conflicts all the time. Shoutouts to <span class=\"user-mention\" data-user-id=\"611722\">@Isaac Van Doren</span>, <span class=\"user-mention\" data-user-id=\"559412\">@Fabian Schmalzried</span> and gpt5-codex-high <span aria-label=\"robot\" class=\"emoji emoji-1f916\" role=\"img\" title=\"robot\">:robot:</span></p>",
        "id": 545824772,
        "sender_full_name": "Anton",
        "timestamp": 1760874936
    },
    {
        "content": "<p>Just updated the fuzz repo to 0.15.2. Running now, but I think it should all be good and fuzzing should keep running!</p>",
        "id": 545873968,
        "sender_full_name": "Brendan Hansknecht",
        "timestamp": 1760927450
    },
    {
        "content": "<p>I'm working on that <code>where</code> clause fuzz crash rn</p>",
        "id": 545874471,
        "sender_full_name": "Luke Boswell",
        "timestamp": 1760928063
    },
    {
        "content": "<blockquote>\n<p>We are on zig 0.15.2 now</p>\n</blockquote>\n<p>Some common changes to the codebase with zig 15:</p>\n<ul>\n<li><code>std.ArrayList</code> -&gt; <code>std.array_list.Managed</code></li>\n<li><code>gpa.alignedAlloc(u8, 16, ...);</code> -&gt; <code>gpa.alignedAlloc(u8, std.mem.Alignment.@\"16\", ...);</code></li>\n<li><code>callconv(.C)</code> -&gt; <code>callconv(.c)</code></li>\n<li><code>writer: std.io.AnyWriter,</code> -&gt; <code>writer: *std.Io.Writer,</code><br>\nBefore:</li>\n</ul>\n<div class=\"codehilite\" data-code-language=\"Zig\"><pre><span></span><code><span class=\"kr\">const</span><span class=\"w\"> </span><span class=\"n\">stderr</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">std</span><span class=\"p\">.</span><span class=\"n\">io</span><span class=\"p\">.</span><span class=\"n\">getStdErr</span><span class=\"p\">().</span><span class=\"n\">writer</span><span class=\"p\">();</span>\n<span class=\"k\">try</span><span class=\"w\"> </span><span class=\"n\">stderr</span><span class=\"p\">.</span><span class=\"n\">print</span><span class=\"p\">(</span><span class=\"s\">\"...</span><span class=\"se\">\\n</span><span class=\"s\">\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"p\">.{</span><span class=\"n\">bool_type_idx</span><span class=\"p\">});</span>\n</code></pre></div>\n<p>After:</p>\n<div class=\"codehilite\" data-code-language=\"Zig\"><pre><span></span><code><span class=\"kr\">var</span><span class=\"w\"> </span><span class=\"n\">stderr_buffer</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"p\">[</span><span class=\"mi\">256</span><span class=\"p\">]</span><span class=\"kt\">u8</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"kc\">undefined</span><span class=\"p\">;</span>\n<span class=\"kr\">var</span><span class=\"w\"> </span><span class=\"n\">stderr_writer</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">std</span><span class=\"p\">.</span><span class=\"n\">fs</span><span class=\"p\">.</span><span class=\"n\">File</span><span class=\"p\">.</span><span class=\"n\">stderr</span><span class=\"p\">().</span><span class=\"n\">writer</span><span class=\"p\">(</span><span class=\"o\">&amp;</span><span class=\"n\">stderr_buffer</span><span class=\"p\">);</span>\n<span class=\"kr\">const</span><span class=\"w\"> </span><span class=\"n\">stderr</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"o\">&amp;</span><span class=\"n\">stderr_writer</span><span class=\"p\">.</span><span class=\"n\">interface</span><span class=\"p\">;</span>\n<span class=\"k\">try</span><span class=\"w\"> </span><span class=\"n\">stderr</span><span class=\"p\">.</span><span class=\"n\">print</span><span class=\"p\">(</span><span class=\"s\">\"...</span><span class=\"se\">\\n</span><span class=\"s\">\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"p\">.{</span><span class=\"n\">bool_type_idx</span><span class=\"p\">});</span>\n<span class=\"k\">try</span><span class=\"w\"> </span><span class=\"n\">stderr</span><span class=\"p\">.</span><span class=\"n\">flush</span><span class=\"p\">();</span>\n</code></pre></div>\n<ul>\n<li>Please do not use any of the deprecated <code>AnyReader</code>, <code>AnyWriter</code>, <code>adaptToNewApi()</code>, <code>GenericReader</code>, <code>GenericWriter</code>. These do not mix well with the new way of doing things.</li>\n<li>Search through <a href=\"https://github.com/roc-lang/roc/pull/8238/files\">https://github.com/roc-lang/roc/pull/8238/files</a> for all examples of upgrading code to zig 15.</li>\n</ul>",
        "id": 545919493,
        "sender_full_name": "Anton",
        "timestamp": 1760951533
    },
    {
        "content": "<p><code>build.zig.zon</code> has still <code>.minimum_zig_version = \"0.15.1\",</code>. Is that on purpose?</p>",
        "id": 545942571,
        "sender_full_name": "Fabian Schmalzried",
        "timestamp": 1760957830
    },
    {
        "content": "<p>No it was not, feel free to change it if you'd like to get in the commit under your name.</p>",
        "id": 545945718,
        "sender_full_name": "Anton",
        "timestamp": 1760958707
    },
    {
        "content": "<p>On CI you may see <code>error(gpa): memory address 0x103280000 leaked:</code> even though the build succeeded. I think this is <a href=\"http://github.com/ziglang/zig/issues/22984\">github.com/ziglang/zig/issues/22984</a> . I think it's safe to ignore for us.</p>",
        "id": 545970813,
        "sender_full_name": "Anton",
        "timestamp": 1760965133
    },
    {
        "content": "<p>I think the sreaming_reader could now also use some simplification, I will do that.</p>",
        "id": 546214014,
        "sender_full_name": "Fabian Schmalzried",
        "timestamp": 1761047574
    }
]