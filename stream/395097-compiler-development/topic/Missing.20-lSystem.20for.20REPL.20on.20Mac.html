<html>
<head><meta charset="utf-8"><title>Missing -lSystem for REPL on Mac · compiler development · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/index.html">compiler development</a></h2>
<h3>Topic: <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/Missing.20-lSystem.20for.20REPL.20on.20Mac.html">Missing -lSystem for REPL on Mac</a></h3>

<hr>

<base href="https://roc.zulipchat.com">

<head><link href="https://roc-lang.github.io/zulip-export/style.css" rel="stylesheet"></head>

<a name="390011771"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/Missing%20-lSystem%20for%20REPL%20on%20Mac/near/390011771" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Carroll <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/Missing.20-lSystem.20for.20REPL.20on.20Mac.html#390011771">(Sep 09 2023 at 08:52)</a>:</h4>
<p>Hey I am trying to run <code>roc repl</code> on my M1 Mac and I'm getting a linking error.<br>
I'm on the latest <code>main</code> branch and I'm in a shell with <code>nix develop</code></p>
<div class="codehilite"><pre><span></span><code>roc git:main
❯ RUST_BACKTRACE=1 cargo run repl
    Finished dev [unoptimized + debuginfo] target(s) in 0.54s
     Running `target/debug/roc repl`

  The rockin’ roc repl
────────────────────────

Enter an expression, or :help, or :q to quit.

» 123
ld: library not found for -lSystem
/tmp/nix-shell.7EFLj3/.tmpuOXr3x/app.dylib: No such file or directory
thread &#39;main&#39; panicked at &#39;
___________
Linking command failed with status ExitStatus(unix_wait_status(256)):

  Child { stdin: None, stdout: None, stderr: None, .. }
___________
&#39;, crates/compiler/build/src/link.rs:1305:5
stack backtrace:
   0: rust_begin_unwind
             at /rustc/90c541806f23a127002de5b4038be731ba1458ca/library/std/src/panicking.rs:578:5
   1: core::panicking::panic_fmt
             at /rustc/90c541806f23a127002de5b4038be731ba1458ca/library/core/src/panicking.rs:67:14
   2: roc_build::link::llvm_module_to_dylib
             at ./crates/compiler/build/src/link.rs:1305:5
   3: roc_repl_cli::cli_gen::mono_module_to_dylib
             at ./crates/repl_cli/src/cli_gen.rs:290:5
   4: roc_repl_cli::cli_gen::gen_and_eval_llvm
             at ./crates/repl_cli/src/cli_gen.rs:86:9
   5: roc_repl_cli::repl_state::ReplState::eval_and_format
             at ./crates/repl_cli/src/repl_state.rs:242:46
   6: roc_repl_cli::repl_state::ReplState::step
             at ./crates/repl_cli/src/repl_state.rs:104:46
   7: roc_repl_cli::main
             at ./crates/repl_cli/src/lib.rs:49:23
   8: roc::main
             at ./crates/cli/src/main.rs:215:35
   9: core::ops::function::FnOnce::call_once
             at /rustc/90c541806f23a127002de5b4038be731ba1458ca/library/core/src/ops/function.rs:250:5
note: Some details are omitted, run with `RUST_BACKTRACE=full` for a verbose backtrace.
</code></pre></div>



<a name="390014754"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/Missing%20-lSystem%20for%20REPL%20on%20Mac/near/390014754" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anton <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/Missing.20-lSystem.20for.20REPL.20on.20Mac.html#390014754">(Sep 09 2023 at 09:30)</a>:</h4>
<p>I'll take a look in a bit</p>



<a name="390018812"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/Missing%20-lSystem%20for%20REPL%20on%20Mac/near/390018812" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anton <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/Missing.20-lSystem.20for.20REPL.20on.20Mac.html#390018812">(Sep 09 2023 at 10:20)</a>:</h4>
<p>Hmm, I could not reproduce this with the latest main on my m1 mac mini with:</p>
<div class="codehilite"><pre><span></span><code>nix develop
cargo run repl
123
</code></pre></div>
<p>What macos version are you on?</p>



<a name="390022455"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/Missing%20-lSystem%20for%20REPL%20on%20Mac/near/390022455" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Carroll <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/Missing.20-lSystem.20for.20REPL.20on.20Mac.html#390022455">(Sep 09 2023 at 11:02)</a>:</h4>
<p>13.5</p>



<a name="390027883"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/Missing%20-lSystem%20for%20REPL%20on%20Mac/near/390027883" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anton <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/Missing.20-lSystem.20for.20REPL.20on.20Mac.html#390027883">(Sep 09 2023 at 11:50)</a>:</h4>
<p>I'm on macOS 12, so I would expect this to be a macOS 13 issue.</p>



<a name="390060511"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/Missing%20-lSystem%20for%20REPL%20on%20Mac/near/390060511" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/Missing.20-lSystem.20for.20REPL.20on.20Mac.html#390060511">(Sep 09 2023 at 19:54)</a>:</h4>
<p>I'm on macOS 13.5.1 and it just worked for me when I ran:</p>
<div class="codehilite"><pre><span></span><code>nix develop
cargo run repl
123
</code></pre></div>



<a name="390060550"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/Missing%20-lSystem%20for%20REPL%20on%20Mac/near/390060550" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/Missing.20-lSystem.20for.20REPL.20on.20Mac.html#390060550">(Sep 09 2023 at 19:55)</a>:</h4>
<p>sometimes I've found things work better if I do <code>rm -f flake.lock</code> on <code>main</code> - takes awhile to re-download things though</p>



<a name="390145232"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/Missing%20-lSystem%20for%20REPL%20on%20Mac/near/390145232" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Carroll <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/Missing.20-lSystem.20for.20REPL.20on.20Mac.html#390145232">(Sep 10 2023 at 13:23)</a>:</h4>
<p>Ah ok, I'll try that</p>



<a name="390145362"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/Missing%20-lSystem%20for%20REPL%20on%20Mac/near/390145362" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Carroll <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/Missing.20-lSystem.20for.20REPL.20on.20Mac.html#390145362">(Sep 10 2023 at 13:24)</a>:</h4>
<p>When I'm back at my computer</p>



<a name="390165089"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/Missing%20-lSystem%20for%20REPL%20on%20Mac/near/390165089" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Carroll <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/Missing.20-lSystem.20for.20REPL.20on.20Mac.html#390165089">(Sep 10 2023 at 17:15)</a>:</h4>
<p>Nope, I'm still getting the same error <span aria-label="disappointed" class="emoji emoji-1f61e" role="img" title="disappointed">:disappointed:</span></p>



<a name="390165507"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/Missing%20-lSystem%20for%20REPL%20on%20Mac/near/390165507" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Carroll <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/Missing.20-lSystem.20for.20REPL.20on.20Mac.html#390165507">(Sep 10 2023 at 17:22)</a>:</h4>
<p>Also tried <code>cargo clean</code> - no joy</p>



<a name="390265625"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/Missing%20-lSystem%20for%20REPL%20on%20Mac/near/390265625" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anton <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/Missing.20-lSystem.20for.20REPL.20on.20Mac.html#390265625">(Sep 11 2023 at 09:04)</a>:</h4>
<p>Strange <span aria-label="thinking" class="emoji emoji-1f914" role="img" title="thinking">:thinking:</span></p>



<a name="390484757"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/Missing%20-lSystem%20for%20REPL%20on%20Mac/near/390484757" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anton <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/Missing.20-lSystem.20for.20REPL.20on.20Mac.html#390484757">(Sep 12 2023 at 09:56)</a>:</h4>
<p>I think I may have found a workaround <span class="user-mention" data-user-id="431893">@Brian Carroll</span> , can you try the following commands in the same terminal:</p>
<div class="codehilite"><pre><span></span><code>&gt; export SDKROOT=$(xcrun --sdk macosx --show-sdk-path)
&gt; export LIBRARY_PATH=&quot;$LIBRARY_PATH:$SDKROOT/usr/lib&quot;
&gt; roc repl
</code></pre></div>



<a name="390567882"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/Missing%20-lSystem%20for%20REPL%20on%20Mac/near/390567882" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Carroll <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/Missing.20-lSystem.20for.20REPL.20on.20Mac.html#390567882">(Sep 12 2023 at 17:44)</a>:</h4>
<p>Thanks so much for digging into this!<br>
I tried those commands and they didn't work, unfortunately.</p>



<a name="390567896"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/Missing%20-lSystem%20for%20REPL%20on%20Mac/near/390567896" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Carroll <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/Missing.20-lSystem.20for.20REPL.20on.20Mac.html#390567896">(Sep 12 2023 at 17:44)</a>:</h4>
<p>That directory does have a <code>libSystem.tbd</code> file in it<br>
Apparently that means "text based description".</p>



<a name="390567910"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/Missing%20-lSystem%20for%20REPL%20on%20Mac/near/390567910" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Carroll <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/Missing.20-lSystem.20for.20REPL.20on.20Mac.html#390567910">(Sep 12 2023 at 17:44)</a>:</h4>
<p>The other day while researching this, I found out that Apple no longer put their system libraries in the actual filesystem, since a few versions ago. They are in some other hidden cache. I guess still on disk but not in the filesystem.<br>
So you can't find it with <code>ls</code> but if you call <code>dlopen</code> on it, the linker knows how to get it.<br>
Apparently it was to help you use your Mac to develop iOS apps with a different libc or something.</p>



<a name="390567966"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/Missing%20-lSystem%20for%20REPL%20on%20Mac/near/390567966" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Carroll <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/Missing.20-lSystem.20for.20REPL.20on.20Mac.html#390567966">(Sep 12 2023 at 17:45)</a>:</h4>
<p>They put these .tbd files in the filesystem though.</p>



<a name="390567981"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/Missing%20-lSystem%20for%20REPL%20on%20Mac/near/390567981" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Carroll <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/Missing.20-lSystem.20for.20REPL.20on.20Mac.html#390567981">(Sep 12 2023 at 17:45)</a>:</h4>
<p>Anyway I'm not sure where that gets us exactly</p>



<a name="390568155"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/Missing%20-lSystem%20for%20REPL%20on%20Mac/near/390568155" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Carroll <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/Missing.20-lSystem.20for.20REPL.20on.20Mac.html#390568155">(Sep 12 2023 at 17:46)</a>:</h4>
<p>It just makes it more confusing how something could possibly not find <code>libSystem</code>. I guess somebody somewhere wrote some code that is not looking it up the way Apple think you should, and it's not working. But why so specific to the OS version?</p>



<a name="390568183"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/Missing%20-lSystem%20for%20REPL%20on%20Mac/near/390568183" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Carroll <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/Missing.20-lSystem.20for.20REPL.20on.20Mac.html#390568183">(Sep 12 2023 at 17:46)</a>:</h4>
<p>It's a weird one.</p>



<a name="390568302"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/Missing%20-lSystem%20for%20REPL%20on%20Mac/near/390568302" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Carroll <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/Missing.20-lSystem.20for.20REPL.20on.20Mac.html#390568302">(Sep 12 2023 at 17:47)</a>:</h4>
<p>I have finished the PR I was working on where I made changes to the CLI REPL so this isn't holding me up.</p>



<a name="390568355"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/Missing%20-lSystem%20for%20REPL%20on%20Mac/near/390568355" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Carroll <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/Missing.20-lSystem.20for.20REPL.20on.20Mac.html#390568355">(Sep 12 2023 at 17:47)</a>:</h4>
<p>I can live with it for now. Maybe best to see if anyone else runs into it.</p>



<a name="390575005"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/Missing%20-lSystem%20for%20REPL%20on%20Mac/near/390575005" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anton <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/Missing.20-lSystem.20for.20REPL.20on.20Mac.html#390575005">(Sep 12 2023 at 18:30)</a>:</h4>
<p>Someone already has :p <a href="https://github.com/roc-lang/roc/issues/5797">#5797</a></p>



<a name="390575097"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/Missing%20-lSystem%20for%20REPL%20on%20Mac/near/390575097" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anton <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/Missing.20-lSystem.20for.20REPL.20on.20Mac.html#390575097">(Sep 12 2023 at 18:30)</a>:</h4>
<p>I'm working on setting up some tests to check if it reproduces on github's CI machines.</p>



<a name="391925471"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/Missing%20-lSystem%20for%20REPL%20on%20Mac/near/391925471" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anton <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/Missing.20-lSystem.20for.20REPL.20on.20Mac.html#391925471">(Sep 19 2023 at 14:30)</a>:</h4>
<p>It did not reproduce on githubs's CI machines...</p>



<a name="391925588"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/Missing%20-lSystem%20for%20REPL%20on%20Mac/near/391925588" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anton <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/Missing.20-lSystem.20for.20REPL.20on.20Mac.html#391925588">(Sep 19 2023 at 14:31)</a>:</h4>
<p>I guess I could try it on my sister's laptop</p>



<a name="419707754"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/Missing%20-lSystem%20for%20REPL%20on%20Mac/near/419707754" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Carroll <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/Missing.20-lSystem.20for.20REPL.20on.20Mac.html#419707754">(Feb 04 2024 at 15:43)</a>:</h4>
<p>Hey I haven't done any code contributions for quite a long time but today I tried to start working on something again.</p>



<a name="419707766"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/Missing%20-lSystem%20for%20REPL%20on%20Mac/near/419707766" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Carroll <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/Missing.20-lSystem.20for.20REPL.20on.20Mac.html#419707766">(Feb 04 2024 at 15:43)</a>:</h4>
<p>But I came up against this issue again!</p>



<a name="419707777"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/Missing%20-lSystem%20for%20REPL%20on%20Mac/near/419707777" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Carroll <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/Missing.20-lSystem.20for.20REPL.20on.20Mac.html#419707777">(Feb 04 2024 at 15:43)</a>:</h4>
<p>I can't run any Roc program natively on my M1</p>



<a name="419707855"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/Missing%20-lSystem%20for%20REPL%20on%20Mac/near/419707855" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Carroll <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/Missing.20-lSystem.20for.20REPL.20on.20Mac.html#419707855">(Feb 04 2024 at 15:44)</a>:</h4>
<div class="codehilite"><pre><span></span><code>❯ roc examples/helloWorld.roc
Downloading https://github.com/roc-lang/basic-cli/releases/download/0.8.1/x8URkvfyi9I0QhmVG98roKBUs_AZRkLFwFJVJ3942YA.tar.br
    into /Users/briancarroll/.cache/roc/packages

[24.0 / 24.0 MB]
ld: library &#39;System&#39; not found
examples/helloWorld: No such file or directory
thread &#39;main&#39; panicked at &#39;not yet implemented: gracefully handle `ld` (or `zig` in the case of wasm with --optimize) returning exit code Some(1)&#39;, crates/compiler/build/src/program.rs:1044:17
note: run with `RUST_BACKTRACE=1` environment variable to display a backtrace
</code></pre></div>



<a name="419708225"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/Missing%20-lSystem%20for%20REPL%20on%20Mac/near/419708225" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Carroll <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/Missing.20-lSystem.20for.20REPL.20on.20Mac.html#419708225">(Feb 04 2024 at 15:50)</a>:</h4>
<p>I wonder if there's a way of rebuilding all the Roc related Nix stuff from scratch. I know Nix is not meant to need things like that, but it is not meant to have errors like this either.<br>
One problem with that is I might have to redo it for my work stuff too.</p>



<a name="419708272"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/Missing%20-lSystem%20for%20REPL%20on%20Mac/near/419708272" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Carroll <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/Missing.20-lSystem.20for.20REPL.20on.20Mac.html#419708272">(Feb 04 2024 at 15:51)</a>:</h4>
<p>I can run Wasm tests and that might actually be enough for what I want to do anyway.<br>
But I am blocked from doing any natively built stuff with Roc.</p>



<a name="419714328"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/Missing%20-lSystem%20for%20REPL%20on%20Mac/near/419714328" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/Missing.20-lSystem.20for.20REPL.20on.20Mac.html#419714328">(Feb 04 2024 at 17:16)</a>:</h4>
<p>Might mean you need to update xcode or something else on your mac.</p>



<a name="419714366"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/Missing%20-lSystem%20for%20REPL%20on%20Mac/near/419714366" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/Missing.20-lSystem.20for.20REPL.20on.20Mac.html#419714366">(Feb 04 2024 at 17:17)</a>:</h4>
<p>I think system is part of what xcode installs, but that could be wrong/me misremembering</p>



<a name="419715778"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/Missing%20-lSystem%20for%20REPL%20on%20Mac/near/419715778" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Carroll <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/Missing.20-lSystem.20for.20REPL.20on.20Mac.html#419715778">(Feb 04 2024 at 17:34)</a>:</h4>
<p>Hmm. I checked Xcode on the App Store as it shows updates when they're available. But nothing showing.</p>



<a name="419724628"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/Missing%20-lSystem%20for%20REPL%20on%20Mac/near/419724628" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Carroll <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/Missing.20-lSystem.20for.20REPL.20on.20Mac.html#419724628">(Feb 04 2024 at 19:29)</a>:</h4>
<p>I started thinking about whether I could try using a different linker. I figured the first step was to find out which one I'm currently running.<br>
In my Nix shell for Roc, I get</p>
<div class="codehilite"><pre><span></span><code>❯ which ld
/nix/store/vwh2qqal1q101wv4jy40giavp73q0msd-clang-wrapper-16.0.6/bin/ld
</code></pre></div>
<p>But in a "normal" shell, I get <code>/usr/bin/ld</code><br>
Can I convince Roc to use a different one?</p>



<a name="419724696"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/Missing%20-lSystem%20for%20REPL%20on%20Mac/near/419724696" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Carroll <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/Missing.20-lSystem.20for.20REPL.20on.20Mac.html#419724696">(Feb 04 2024 at 19:30)</a>:</h4>
<p>I guess I could hack the source but that rabbit hole always goes pretty deep</p>



<a name="419724741"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/Missing%20-lSystem%20for%20REPL%20on%20Mac/near/419724741" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Carroll <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/Missing.20-lSystem.20for.20REPL.20on.20Mac.html#419724741">(Feb 04 2024 at 19:31)</a>:</h4>
<p>Or can I get it to print what commands it's using? Then I could play around with command options.</p>



<a name="419724936"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/Missing%20-lSystem%20for%20REPL%20on%20Mac/near/419724936" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/Missing.20-lSystem.20for.20REPL.20on.20Mac.html#419724936">(Feb 04 2024 at 19:34)</a>:</h4>
<p>We don't expose any of that currently, but <a href="http://link.rs">link.rs</a> has the command</p>



<a name="419724953"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/Missing%20-lSystem%20for%20REPL%20on%20Mac/near/419724953" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/Missing.20-lSystem.20for.20REPL.20on.20Mac.html#419724953">(Feb 04 2024 at 19:34)</a>:</h4>
<p>In link_macos I think</p>



<a name="419726919"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/Missing%20-lSystem%20for%20REPL%20on%20Mac/near/419726919" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Carroll <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/Missing.20-lSystem.20for.20REPL.20on.20Mac.html#419726919">(Feb 04 2024 at 20:04)</a>:</h4>
<p>Right, I'll have a look. Might be good to have a debug env var for this</p>



<a name="419991321"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/Missing%20-lSystem%20for%20REPL%20on%20Mac/near/419991321" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Carroll <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/Missing.20-lSystem.20for.20REPL.20on.20Mac.html#419991321">(Feb 06 2024 at 07:45)</a>:</h4>
<p><a href="https://github.com/roc-lang/roc/pull/6508">https://github.com/roc-lang/roc/pull/6508</a></p>



<a name="419991368"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/Missing%20-lSystem%20for%20REPL%20on%20Mac/near/419991368" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Carroll <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/Missing.20-lSystem.20for.20REPL.20on.20Mac.html#419991368">(Feb 06 2024 at 07:45)</a>:</h4>
<p><span aria-label="point up" class="emoji emoji-1f446" role="img" title="point up">:point_up:</span>  Add a debug flag for build commands</p>



<a name="429347362"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/Missing%20-lSystem%20for%20REPL%20on%20Mac/near/429347362" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anton <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/Missing.20-lSystem.20for.20REPL.20on.20Mac.html#429347362">(Mar 25 2024 at 10:33)</a>:</h4>
<p>Were you able to solve <a href="#narrow/stream/395097-compiler-development/topic/Missing.20-lSystem.20for.20REPL.20on.20Mac/near/419707855">this issue</a> <span class="user-mention" data-user-id="431893">@Brian Carroll</span>?</p>



<a name="429347772"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/Missing%20-lSystem%20for%20REPL%20on%20Mac/near/429347772" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Carroll <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/Missing.20-lSystem.20for.20REPL.20on.20Mac.html#429347772">(Mar 25 2024 at 10:35)</a>:</h4>
<p>No!</p>



<a name="429480077"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/Missing%20-lSystem%20for%20REPL%20on%20Mac/near/429480077" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jonathan Schear <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/Missing.20-lSystem.20for.20REPL.20on.20Mac.html#429480077">(Mar 25 2024 at 18:04)</a>:</h4>
<p>Is this error happening when the roc binary is invoking the linker to build a platform? (Not when building the roc binary itself?)</p>



<a name="429481508"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/Missing%20-lSystem%20for%20REPL%20on%20Mac/near/429481508" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Carroll <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/Missing.20-lSystem.20for.20REPL.20on.20Mac.html#429481508">(Mar 25 2024 at 18:13)</a>:</h4>
<p>No I think it's when it links platform to app. The repl uses a precompiled platform. I posted repro commands at the top of the thread.</p>



<a name="429485852"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/Missing%20-lSystem%20for%20REPL%20on%20Mac/near/429485852" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jonathan Schear <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/Missing.20-lSystem.20for.20REPL.20on.20Mac.html#429485852">(Mar 25 2024 at 18:41)</a>:</h4>
<p>Huh, I'm curious how <code>ld</code> is being found when the command is having its environment cleared (&amp; doesn't inherit from the spawning process): <a href="https://github.com/roc-lang/roc/blob/main/crates/compiler/build/src/link.rs#L1114">https://github.com/roc-lang/roc/blob/main/crates/compiler/build/src/link.rs#L1114</a></p>



<a name="429486895"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/Missing%20-lSystem%20for%20REPL%20on%20Mac/near/429486895" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jonathan Schear <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/Missing.20-lSystem.20for.20REPL.20on.20Mac.html#429486895">(Mar 25 2024 at 18:48)</a>:</h4>
<p>Does <code>/Library/Developer/CommandLineTools/SDKs/MacOSX.sdk/usr/lib/libSystem.tbd</code> exist on your machine Brian?</p>



<a name="429487429"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/Missing%20-lSystem%20for%20REPL%20on%20Mac/near/429487429" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jonathan Schear <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/Missing.20-lSystem.20for.20REPL.20on.20Mac.html#429487429">(Mar 25 2024 at 18:51)</a>:</h4>
<p><code>xcode-select --install</code> to get the "command line tools" might be the solution here. (Though it sounds like you may have already tried that. :shakes-fist-at-macos:)</p>



<a name="429487932"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/Missing%20-lSystem%20for%20REPL%20on%20Mac/near/429487932" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Carroll <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/Missing.20-lSystem.20for.20REPL.20on.20Mac.html#429487932">(Mar 25 2024 at 18:54)</a>:</h4>
<p>I'm not home right now, will check when I can. I looked up various paths like that before, not sure if this one specifically. Thanks for looking into this!</p>
<p>Also I noticed in the Rust docs<br>
<a href="https://doc.rust-lang.org/std/process/struct.Command.html#method.env_clear">https://doc.rust-lang.org/std/process/struct.Command.html#method.env_clear</a></p>
<blockquote>
<p>Clears all explicitly set environment variables and prevents inheriting any parent process environment variables.</p>
</blockquote>
<p>So maybe this doesn't clear the default PATH.</p>



<a name="443395363"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/Missing%20-lSystem%20for%20REPL%20on%20Mac/near/443395363" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bromanko <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/Missing.20-lSystem.20for.20REPL.20on.20Mac.html#443395363">(Jun 07 2024 at 23:16)</a>:</h4>
<p>Hi there. I am new to roc and also encountered this issue. I'm trying to get a hello world program running on an M2 mac using nix. Here's a repo with my flake.nix and single roc module. <a href="https://github.com/bromanko/roc">https://github.com/bromanko/roc</a></p>
<p>I tried adding the same set of libraries in the roc-lang repo's nix build as buildInputs but it didn't help.</p>



<a name="443443086"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/Missing%20-lSystem%20for%20REPL%20on%20Mac/near/443443086" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anton <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/Missing.20-lSystem.20for.20REPL.20on.20Mac.html#443443086">(Jun 08 2024 at 08:45)</a>:</h4>
<p>Hi <span class="user-mention" data-user-id="727213">@bromanko</span>,<br>
I believe your repo is set to private visibility</p>



<a name="443472989"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/Missing%20-lSystem%20for%20REPL%20on%20Mac/near/443472989" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bromanko <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/Missing.20-lSystem.20for.20REPL.20on.20Mac.html#443472989">(Jun 08 2024 at 14:02)</a>:</h4>
<p>Doh. Fixed.</p>



<a name="443826642"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/Missing%20-lSystem%20for%20REPL%20on%20Mac/near/443826642" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anton <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/Missing.20-lSystem.20for.20REPL.20on.20Mac.html#443826642">(Jun 10 2024 at 17:43)</a>:</h4>
<p>Sorry <span class="user-mention" data-user-id="727213">@bromanko</span>, I tried your flake on my arm64 mac (macos 14) and I could not reproduce the issue.</p>



<a name="443908520"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/Missing%20-lSystem%20for%20REPL%20on%20Mac/near/443908520" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bromanko <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/Missing.20-lSystem.20for.20REPL.20on.20Mac.html#443908520">(Jun 11 2024 at 03:47)</a>:</h4>
<p>Thanks for that confirmation. I checked software update and I had a pending Command Line utilities update. Updating it would complete then show I still had a Command Line update pending. After repeating the process three times I restarted. The update is gone along with the error. Not sure what was going on but hopefully this helps if anyone else has the same problem.</p>



<hr><p>Last updated: Nov 01 2025 at 12:13 UTC</p>
</html>