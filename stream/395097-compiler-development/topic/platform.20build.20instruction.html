<html>
<head><meta charset="utf-8"><title>platform build instruction · compiler development · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/index.html">compiler development</a></h2>
<h3>Topic: <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/platform.20build.20instruction.html">platform build instruction</a></h3>

<hr>

<base href="https://roc.zulipchat.com">

<head><link href="https://roc-lang.github.io/zulip-export/style.css" rel="stylesheet"></head>

<a name="397795316"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/platform%20build%20instruction/near/397795316" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/platform.20build.20instruction.html#397795316">(Oct 21 2023 at 00:59)</a>:</h4>
<p>I think we have a design for the platform to provide an instruction to roc so that it can build itself (all the object files etc) with the new module changes. However, until then we have hardcoded how to build zig platforms, and I wonder if we can find a quick and easy way to modify that to unlock some more functionality?</p>
<p>I was thinking about how we don't need that app module name any longer and wondered if we could in a similar vein, use the string in the platform name as the instruction to roc cli? </p>
<div class="codehilite" data-code-language="CoffeeScript"><pre><span></span><code><span class="nx">platform</span><span class="w"> </span><span class="s">"zig build all"</span><span class="w"> </span><span class="c1"># use this as an intermediate solution until module changes??</span>
<span class="w">    </span><span class="nx">requires</span><span class="w"> </span><span class="p">{}</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nv">main</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="nx">_</span><span class="w"> </span><span class="p">}</span>
</code></pre></div>
<p>This would mean I could write a zig platform using <code>build.zig</code> today that generated the pre-built platform objects for linux/mac/windows etc and I am hoping <code>--bundle</code> can then package to make a URL file.</p>



<a name="397796658"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/platform%20build%20instruction/near/397796658" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/platform.20build.20instruction.html#397796658">(Oct 21 2023 at 01:12)</a>:</h4>
<p>If you want something quick and super simple, I would just have roc check for a build.zig like we do with cargo.toml</p>



<a name="397798548"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/platform%20build%20instruction/near/397798548" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/platform.20build.20instruction.html#397798548">(Oct 21 2023 at 01:31)</a>:</h4>
<p>I actually want to go in the other direction - I want to have <code>roc</code> no longer know about other programming languages</p>



<a name="397798604"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/platform%20build%20instruction/near/397798604" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/platform.20build.20instruction.html#397798604">(Oct 21 2023 at 01:32)</a>:</h4>
<p>that was always intended to be a temporary let's-get-up-ad-running thing</p>



<a name="397798637"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/platform%20build%20instruction/near/397798637" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/platform.20build.20instruction.html#397798637">(Oct 21 2023 at 01:32)</a>:</h4>
<p>so instead I'd prefer if the <code>build.zig</code> became the way to build</p>



<a name="403283348"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/platform%20build%20instruction/near/403283348" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/platform.20build.20instruction.html#403283348">(Nov 21 2023 at 02:09)</a>:</h4>
<p>I think I may want to work on this cause it is one of those old issues that is now starting to annoy me quite a bit.</p>
<p>fundamentally, we don't really want roc to control the full build process. We want it to really just point to a directory that has all the precompiled stuff we need. This is a package, just in an already extracted folder.</p>
<p>My thought on changes. I see two main options. One that is more convenient from a user perspective and another that is cleaner overall.</p>
<p>Option 1, more convenient for users:</p>
<ol>
<li>Roc no longer compiles a platform with some bespoke intern magical command.</li>
<li>Roc will still be allowed to build local platforms for convenience, but it will always just be verbatim calling out to a platform specified command.</li>
<li>The platform also specifies a relative local folder for its output.</li>
<li>This output folder most look exactly like an extracted roc package.</li>
<li>Roc will call the specified command verbatim and then use that folder as if it was an extracted downloaded package.</li>
</ol>
<p>Option 2, cleaner but less convenient:</p>
<ol>
<li>Roc will never build a platform, ever.</li>
<li>The platform build must be run as a separate command.</li>
<li>This will output a local folder that looks just like an extracted downloaded package.</li>
<li>A roc platform can specify a local folder as it's platform path. If it does, that path will be used the same way a downloaded package would be used.</li>
</ol>
<p>Option 2 is cleaner and simpler in the compiler, but it means that new users who want to run examples in the <code>examples</code> folder will need to manually compile the platform. So more readme docs and things won't just work with <code>roc example/....roc</code></p>
<p>Either of these options remove all of our special platform building code and give platforms direct control over their build script. We still would keep the legacy linker and it hacky library includes. (note: we could maybe let the platforms specify extra linker flags that are required for the legacy linker to work)</p>
<p>Thoughts?</p>



<a name="403284044"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/platform%20build%20instruction/near/403284044" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/platform.20build.20instruction.html#403284044">(Nov 21 2023 at 02:14)</a>:</h4>
<p>With option 2, we probably also want to improve error messages to mention that a user needs to build the local platforms. Then give a readme in each local platform and probably a <code>build.sh</code></p>



<a name="403284890"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/platform%20build%20instruction/near/403284890" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/platform.20build.20instruction.html#403284890">(Nov 21 2023 at 02:21)</a>:</h4>
<p>I think Richard mentioned he thought a <code>build.roc</code> script might be a good default way to do this. </p>
<p>I think it is useful for roc to call this script, maybe we change <code>--prebuilt-platform</code> to be <code>--rebuild-platform</code> or something which just runs that roc script first to re-build the platform and then builds the app. </p>
<p>Is there a reason we need a special folder? </p>
<p>Can we have all the build artifects alongside platform/main.roc like we currently do? I imagine most build scripts could manage this.</p>



<a name="403285930"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/platform%20build%20instruction/near/403285930" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/platform.20build.20instruction.html#403285930">(Nov 21 2023 at 02:29)</a>:</h4>
<p>I'm against a <code>build.roc</code> script, it is extra complexity of no gain. No need for an extra platform. We have bash and other compilers build systems. They can manage this.</p>
<p>As for the special folder. I'm tired of everything being dumped in the platform folder. Build directories and caches are standard because they avoid filling source folders with arbitrary files that need to be gitignored. I want to enable output to be in <code>zig_out</code> for a zig platform. I think everything being dumped in the platform folder is legacy convenience and it should go away.</p>



<a name="403286775"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/platform%20build%20instruction/near/403286775" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/platform.20build.20instruction.html#403286775">(Nov 21 2023 at 02:36)</a>:</h4>
<p>I think option 2 is the way to go</p>



<a name="403286961"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/platform%20build%20instruction/near/403286961" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/platform.20build.20instruction.html#403286961">(Nov 21 2023 at 02:38)</a>:</h4>
<p>part of the reason for that is that if we try option 2 and it turns out to be a major pain point, then we can always reconsider incorporating additional functionality into <code>roc</code></p>



<a name="403287016"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/platform%20build%20instruction/near/403287016" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/platform.20build.20instruction.html#403287016">(Nov 21 2023 at 02:38)</a>:</h4>
<p>but if we try the other way around, we'll never know if we could have gone with the simpler design</p>



<a name="403287107"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/platform%20build%20instruction/near/403287107" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/platform.20build.20instruction.html#403287107">(Nov 21 2023 at 02:38)</a>:</h4>
<p>another reason is that I think it makes it clearer for end users where errors and/or build slowness are coming from</p>



<a name="403287188"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/platform%20build%20instruction/near/403287188" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/platform.20build.20instruction.html#403287188">(Nov 21 2023 at 02:39)</a>:</h4>
<p>one more reason is that it can be faster end to end; if you want to rebuild the platform every single time, then the extra step is slightly annoying (although not much if you do like <code>cargo build &amp;&amp; roc run</code> at the command line)</p>



<a name="403287210"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/platform%20build%20instruction/near/403287210" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/platform.20build.20instruction.html#403287210">(Nov 21 2023 at 02:39)</a>:</h4>
<p>but if you only want to rebuild the local platform once and then run the app on it a bunch of times, then it's definitely faster end to end to have them split up</p>



<a name="403287227"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/platform%20build%20instruction/near/403287227" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/platform.20build.20instruction.html#403287227">(Nov 21 2023 at 02:40)</a>:</h4>
<p>and not have <code>roc</code> even attempt to run anything, like it does today</p>



<a name="403287362"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/platform%20build%20instruction/near/403287362" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/platform.20build.20instruction.html#403287362">(Nov 21 2023 at 02:41)</a>:</h4>
<p><span class="user-mention silent" data-user-id="343810">Brendan Hansknecht</span> <a href="#narrow/stream/395097-compiler-development/topic/platform.20build.20instruction/near/403285930">said</a>:</p>
<blockquote>
<p>I'm tired of everything being dumped in the platform folder. Build directories and caches are standard because they avoid filling source folders with arbitrary files that need to be gitignored. I want to enable output to be in <code>zig_out</code> for a zig platform. I think everything being dumped in the platform folder is legacy convenience and it should go away.</p>
</blockquote>
<p>oh yeah 100% agree, that was never supposed to be the long-term design <span aria-label="big smile" class="emoji emoji-1f604" role="img" title="big smile">:big_smile:</span></p>



<a name="403287420"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/platform%20build%20instruction/near/403287420" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/platform.20build.20instruction.html#403287420">(Nov 21 2023 at 02:41)</a>:</h4>
<p>and we have an <code>--output</code> flag now, so it would be natural to respect that when doing <code>roc build</code> on a platform</p>



<a name="403287508"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/platform%20build%20instruction/near/403287508" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/platform.20build.20instruction.html#403287508">(Nov 21 2023 at 02:42)</a>:</h4>
<p>this is really exciting! I'm pumped to see this happen <span aria-label="smiley" class="emoji emoji-1f603" role="img" title="smiley">:smiley:</span></p>



<a name="403287527"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/platform%20build%20instruction/near/403287527" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/platform.20build.20instruction.html#403287527">(Nov 21 2023 at 02:42)</a>:</h4>
<p>the status quo design is a hack from like...2019?</p>



<a name="403287753"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/platform%20build%20instruction/near/403287753" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/platform.20build.20instruction.html#403287753">(Nov 21 2023 at 02:44)</a>:</h4>
<p>also I agree that the <code>examples/</code> folder should use <code>basic-cli</code> instead of locally built platforms, with the exception of the one set of examples dedicated to showing how building platforms locally works (and those should have instructions in the README for how in order to build those platforms, you need to use <code>cargo</code> or <code>zig</code> or perhaps even <code>make</code> for C ones)</p>



<a name="403287816"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/platform%20build%20instruction/near/403287816" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/platform.20build.20instruction.html#403287816">(Nov 21 2023 at 02:45)</a>:</h4>
<p>Cool I think I am fully on the same page. Sounds nice!</p>



<a name="403299342"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/platform%20build%20instruction/near/403299342" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/platform.20build.20instruction.html#403299342">(Nov 21 2023 at 04:20)</a>:</h4>
<p>For local package dependencies, would it be preferable to just take a path to a folder or to have the platform main.roc specify the folder location? I currently assume path to folder.</p>
<p>Also, do we want a <code>file://</code> prefix? I assume not, but just curious.</p>



<a name="403299481"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/platform%20build%20instruction/near/403299481" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/platform.20build.20instruction.html#403299481">(Nov 21 2023 at 04:22)</a>:</h4>
<p>I think for local package dependencies it should be a path to <code>main.roc</code></p>



<a name="403299491"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/platform%20build%20instruction/near/403299491" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/platform.20build.20instruction.html#403299491">(Nov 21 2023 at 04:22)</a>:</h4>
<p>no <code>file://</code> prefix</p>



<a name="403299540"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/platform%20build%20instruction/near/403299540" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/platform.20build.20instruction.html#403299540">(Nov 21 2023 at 04:22)</a>:</h4>
<p>or rather, a path to whatever the <code>.roc</code> file is (whether it's named <code>main.roc</code> or not) that's the actual <code>platform</code> module in question</p>



<a name="403299725"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/platform%20build%20instruction/near/403299725" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/platform.20build.20instruction.html#403299725">(Nov 21 2023 at 04:24)</a>:</h4>
<p>Ok. so then we would need the platform to specify where it stores the output <code>linux_x64.o</code> and friends if we want to avoid them still all needing to be in the platform folder. That or we hardcode some other subfolder.</p>



<a name="403299805"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/platform%20build%20instruction/near/403299805" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/platform.20build.20instruction.html#403299805">(Nov 21 2023 at 04:25)</a>:</h4>
<p>So I guess this would still require a change like:</p>
<div class="codehilite" data-code-language="CoffeeScript"><pre><span></span><code><span class="nx">platform</span><span class="w"> </span><span class="s">"zig_out/"</span>
<span class="w">    </span><span class="nx">requires</span><span class="w"> </span><span class="p">{}</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nv">main</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="nx">_</span><span class="w"> </span><span class="p">}</span>
</code></pre></div>



<a name="403300031"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/platform%20build%20instruction/near/403300031" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/platform.20build.20instruction.html#403300031">(Nov 21 2023 at 04:27)</a>:</h4>
<p><span aria-label="thinking" class="emoji emoji-1f914" role="img" title="thinking">:thinking:</span> actually, what if we used caching for this?</p>



<a name="403300082"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/platform%20build%20instruction/near/403300082" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/platform.20build.20instruction.html#403300082">(Nov 21 2023 at 04:27)</a>:</h4>
<p>like we want to be taking the BLAKE3 hash of source files anyway, and then storing intermediate compiled values in a <code>~/.cache/roc</code> (or similar) directory</p>



<a name="403300096"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/platform%20build%20instruction/near/403300096" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/platform.20build.20instruction.html#403300096">(Nov 21 2023 at 04:27)</a>:</h4>
<p>wouldn't that be the natural place to put these?</p>



<a name="403300158"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/platform%20build%20instruction/near/403300158" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/platform.20build.20instruction.html#403300158">(Nov 21 2023 at 04:28)</a>:</h4>
<p>Not if <code>zig</code> or <code>cmake</code> or etc is controlling the build</p>



<a name="403300165"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/platform%20build%20instruction/near/403300165" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/platform.20build.20instruction.html#403300165">(Nov 21 2023 at 04:28)</a>:</h4>
<p>ah true</p>



<a name="403300197"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/platform%20build%20instruction/near/403300197" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/platform.20build.20instruction.html#403300197">(Nov 21 2023 at 04:28)</a>:</h4>
<p>Also, I was assuming for local build we would just ignore the hash part</p>



<a name="403300243"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/platform%20build%20instruction/near/403300243" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/platform.20build.20instruction.html#403300243">(Nov 21 2023 at 04:29)</a>:</h4>
<p>ok then yeah I think we should specify it in the <code>platform</code> module header</p>



<a name="403300289"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/platform%20build%20instruction/near/403300289" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/platform.20build.20instruction.html#403300289">(Nov 21 2023 at 04:29)</a>:</h4>
<p>if desired, we could go straight to the design I think we want to eventually have, which is that the <code>platform</code> module header specifies on a per-target basis where to find its precompiled files</p>



<a name="403300318"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/platform%20build%20instruction/near/403300318" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/platform.20build.20instruction.html#403300318">(Nov 21 2023 at 04:29)</a>:</h4>
<p>which specifies not only output directory, but also filename, and then also (perhaps most importantly) which targets it actually supports</p>



<a name="403300415"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/platform%20build%20instruction/near/403300415" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/platform.20build.20instruction.html#403300415">(Nov 21 2023 at 04:30)</a>:</h4>
<p>which would address current problems like <code>basic-cli</code> doesn't support wasm, but there's no way to know that - let alone to get a helpful compiler error if you try to build it with <code>--target wasm32</code></p>



<a name="403300468"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/platform%20build%20instruction/near/403300468" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/platform.20build.20instruction.html#403300468">(Nov 21 2023 at 04:31)</a>:</h4>
<p>Yeah, I guess it depends if we want to make that explicit or implicit. My thought was that it would specify an artifact folder. We would then check that folder for our expected files like <code>linux_x86.o</code>. If our expected file doesn't exist, we would print an error about needing to read the platform readme and compile it for linux x86.</p>



<a name="403300484"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/platform%20build%20instruction/near/403300484" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/platform.20build.20instruction.html#403300484">(Nov 21 2023 at 04:31)</a>:</h4>
<p>concretely, I'm talking about something like</p>
<div class="codehilite"><pre><span></span><code>platform …
    targets {
        linux-x64 =&gt; &quot;zig_out/linux-x64.rh&quot;,
        wasm32 =&gt; &quot;zig_out/wasm32.rh&quot;,
    }
</code></pre></div>



<a name="403300602"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/platform%20build%20instruction/near/403300602" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/platform.20build.20instruction.html#403300602">(Nov 21 2023 at 04:32)</a>:</h4>
<p>I think it's nicer for this to be explicit</p>



<a name="403300617"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/platform%20build%20instruction/near/403300617" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/platform.20build.20instruction.html#403300617">(Nov 21 2023 at 04:32)</a>:</h4>
<p>Fair.</p>



<a name="403300640"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/platform%20build%20instruction/near/403300640" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/platform.20build.20instruction.html#403300640">(Nov 21 2023 at 04:32)</a>:</h4>
<p>though what if the platform supports both legacy and surgical linker</p>



<a name="403300667"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/platform%20build%20instruction/near/403300667" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/platform.20build.20instruction.html#403300667">(Nov 21 2023 at 04:33)</a>:</h4>
<p>Like legacy as fallback or to get better debug info.</p>



<a name="403300869"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/platform%20build%20instruction/near/403300869" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/platform.20build.20instruction.html#403300869">(Nov 21 2023 at 04:35)</a>:</h4>
<p>I guess we could also just make that explicit:<br>
<code>linux-x64-legacy</code> or something.</p>



<a name="403300978"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/platform%20build%20instruction/near/403300978" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/platform.20build.20instruction.html#403300978">(Nov 21 2023 at 04:36)</a>:</h4>
<p>hm, what would the distinction be there? <span aria-label="thinking" class="emoji emoji-1f914" role="img" title="thinking">:thinking:</span></p>



<a name="403301007"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/platform%20build%20instruction/near/403301007" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/platform.20build.20instruction.html#403301007">(Nov 21 2023 at 04:36)</a>:</h4>
<p>like you mean they'd build two different <code>.rh</code> files?</p>



<a name="403301028"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/platform%20build%20instruction/near/403301028" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/platform.20build.20instruction.html#403301028">(Nov 21 2023 at 04:37)</a>:</h4>
<p>for the same target</p>



<a name="403301039"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/platform%20build%20instruction/near/403301039" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/platform.20build.20instruction.html#403301039">(Nov 21 2023 at 04:37)</a>:</h4>
<p>one <code>.rh</code> and one <code>.a</code> or <code>.o</code></p>



<a name="403301069"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/platform%20build%20instruction/near/403301069" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/platform.20build.20instruction.html#403301069">(Nov 21 2023 at 04:37)</a>:</h4>
<p>That is what you will see in basic cli for linux_x64 currently for example.</p>



<a name="403301096"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/platform%20build%20instruction/near/403301096" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/platform.20build.20instruction.html#403301096">(Nov 21 2023 at 04:37)</a>:</h4>
<p>hm but why would they need to build different ones?</p>



<a name="403301111"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/platform%20build%20instruction/near/403301111" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/platform.20build.20instruction.html#403301111">(Nov 21 2023 at 04:37)</a>:</h4>
<p>because it would have something that breaks the surgical linker but works for the legacy linker?</p>



<a name="403301270"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/platform%20build%20instruction/near/403301270" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/platform.20build.20instruction.html#403301270">(Nov 21 2023 at 04:39)</a>:</h4>
<p>two main reasons currently:</p>
<ol>
<li>just in case some specific use of the platform breaks the surgical linker</li>
<li>to get debug info for the platform and roc app (surgical linker doesn't support that currently).</li>
</ol>
<p>Long term, everything should be fine to only be the surgical linker version, but I don't think were fully there yet.</p>



<a name="403301436"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/platform%20build%20instruction/near/403301436" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/platform.20build.20instruction.html#403301436">(Nov 21 2023 at 04:40)</a>:</h4>
<p>hm I'd say let's not introduce the complexity and revisit if it actually comes up in practice</p>



<a name="403301472"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/platform%20build%20instruction/near/403301472" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/platform.20build.20instruction.html#403301472">(Nov 21 2023 at 04:41)</a>:</h4>
<p>like if it's a problem they can (for example) always build for legacy linker and tell people to use that</p>



<a name="403301496"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/platform%20build%20instruction/near/403301496" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/platform.20build.20instruction.html#403301496">(Nov 21 2023 at 04:41)</a>:</h4>
<p>but I really would like 2023 to be the last year we have <code>--linker=legacy</code> if possible <span aria-label="big smile" class="emoji emoji-1f604" role="img" title="big smile">:big_smile:</span></p>



<a name="403301498"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/platform%20build%20instruction/near/403301498" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/platform.20build.20instruction.html#403301498">(Nov 21 2023 at 04:41)</a>:</h4>
<p>It does. I use <code>--linker=legacy</code> all the time with <code>gdb</code> when debugging platform glue issues and similar.</p>



<a name="403301579"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/platform%20build%20instruction/near/403301579" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/platform.20build.20instruction.html#403301579">(Nov 21 2023 at 04:42)</a>:</h4>
<p>oh sure, but if you're the platform author you can just build for that locally right?</p>



<a name="403301626"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/platform%20build%20instruction/near/403301626" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/platform.20build.20instruction.html#403301626">(Nov 21 2023 at 04:42)</a>:</h4>
<p>I'd think the inconvenience of only having one would mainly apply to people getting the platform from a URL</p>



<a name="403301649"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/platform%20build%20instruction/near/403301649" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/platform.20build.20instruction.html#403301649">(Nov 21 2023 at 04:42)</a>:</h4>
<p>I guess, just have to update a single line from <code>linux-x64 =&gt; "zig_out/linux-x64.rh"</code> to <code>linux-x64 =&gt; "zig_out/linux-x64.o"</code></p>



<a name="403301785"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/platform%20build%20instruction/near/403301785" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/platform.20build.20instruction.html#403301785">(Nov 21 2023 at 04:44)</a>:</h4>
<p>That or compile the roc app to a lib and just avoid the roc linking step all together instead letting the host compiler deal with that linking as well.</p>



<a name="403301894"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/platform%20build%20instruction/near/403301894" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/platform.20build.20instruction.html#403301894">(Nov 21 2023 at 04:45)</a>:</h4>
<p>yeah, either seems fine!</p>



<a name="403301983"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/platform%20build%20instruction/near/403301983" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/platform.20build.20instruction.html#403301983">(Nov 21 2023 at 04:46)</a>:</h4>
<p>Ok. Sounds good.</p>



<a name="403302004"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/platform%20build%20instruction/near/403302004" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/platform.20build.20instruction.html#403302004">(Nov 21 2023 at 04:46)</a>:</h4>
<p>as an aside, we should really spec out what adding debug info would look like - seems like maybe something where if we got it started, could be a cool first contribution to that part of the code base for someone looking to get involved!</p>



<a name="403302075"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/platform%20build%20instruction/near/403302075" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/platform.20build.20instruction.html#403302075">(Nov 21 2023 at 04:47)</a>:</h4>
<p>For sure. If debug info is concatenative, it may be possible that the surgical linker just needs to also copy it over and then update some offsets. No idea.</p>



<a name="403302141"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/platform%20build%20instruction/near/403302141" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/platform.20build.20instruction.html#403302141">(Nov 21 2023 at 04:48)</a>:</h4>
<p>that would be sweet if so!</p>



<a name="403302305"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/platform%20build%20instruction/near/403302305" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/platform.20build.20instruction.html#403302305">(Nov 21 2023 at 04:50)</a>:</h4>
<p>One more question on the targets syntax, should it support <code>host</code> or <code>current-system</code> or whatever we want to name it?</p>
<p>I assume that would be useful in platforms that don't know how to cross compile. Instead they just build for the host system when built locally.</p>



<a name="403302662"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/platform%20build%20instruction/near/403302662" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/platform.20build.20instruction.html#403302662">(Nov 21 2023 at 04:55)</a>:</h4>
<p>Oh, another question I just realized, should packages now be expected to also follow the structure specified in the <code>targets</code> syntax? Should a zig platform potentially extract to be <code>zig-out/linux-x64.o</code>? That way we can still read the <code>main.roc</code> file to understand where to find these files? No concerns of the platform following our exact naming conventions.</p>
<p>Actually as I am thinking about this, I guess that <code>roc build --bundle</code> (probably should change to <code>roc bundle</code> cause it won't build anymore) can read the <code>platform/main.roc</code> and just copy all of the platform specified files to exactly where we want them in the final bundle.</p>



<a name="403302956"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/platform%20build%20instruction/near/403302956" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/platform.20build.20instruction.html#403302956">(Nov 21 2023 at 04:59)</a>:</h4>
<p>yeah that makes sense!</p>



<a name="403302958"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/platform%20build%20instruction/near/403302958" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/platform.20build.20instruction.html#403302958">(Nov 21 2023 at 04:59)</a>:</h4>
<p>(regarding <code>roc bundle</code>)</p>



<a name="403302975"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/platform%20build%20instruction/near/403302975" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/platform.20build.20instruction.html#403302975">(Nov 21 2023 at 04:59)</a>:</h4>
<p>I think the keys to the mapping should follow our <code>--target</code> syntax, but the values can be whatever the author wants</p>



<a name="403303076"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/platform%20build%20instruction/near/403303076" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/platform.20build.20instruction.html#403303076">(Nov 21 2023 at 05:00)</a>:</h4>
<p>like I could do <code>linux-x64 =&gt; zig_out/x86_64-musl-linux.rh</code> if I wanted to</p>



<a name="403303202"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/platform%20build%20instruction/near/403303202" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/platform.20build.20instruction.html#403303202">(Nov 21 2023 at 05:01)</a>:</h4>
<p>Ok. So I guess the scope of this work is:</p>
<p>1) Update all platforms in the roc repo to have their own build scripts and readme (later update basic-cli and basic-webserver)<br>
2) Add the target syntax to enable platforms to specify where they store artifacts</p>
<div class="codehilite"><pre><span></span><code>    targets {
        linux-x64 =&gt; &quot;zig_out/linux-x64.rh&quot;,
        wasm32 =&gt; &quot;zig_out/wasm32.rh&quot;,
    }
</code></pre></div>
<p>3) update <code>roc build</code> with a local platform to just grab the specified file instead of rebuilding the platform.<br>
4) update <code>roc build --bundle</code> to grab the specified file for each target instead of just assuming they will be in the platform directly as <code>linux_x64.o</code>, etc. It can build the exact expected directly in <code>~/.cache/roc</code> if it doesn't already.<br>
5) extract <code>roc build --bundle</code> into a standalone <code>roc bundle</code><br>
6) add nicer error messages about unsupported targets for platforms and unbuilt targets for platforms.</p>



<a name="403303507"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/platform%20build%20instruction/near/403303507" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/platform.20build.20instruction.html#403303507">(Nov 21 2023 at 05:03)</a>:</h4>
<p><span class="user-mention silent" data-user-id="343810">Brendan Hansknecht</span> <a href="#narrow/stream/395097-compiler-development/topic/platform.20build.20instruction/near/403302305">said</a>:</p>
<blockquote>
<p>One more question on the targets syntax, should it support <code>host</code> or <code>current-system</code> or whatever we want to name it?</p>
<p>I assume that would be useful in platforms that don't know how to cross compile. Instead they just build for the host system when built locally.</p>
</blockquote>
<p>hm, I'm not sure if it would matter in practice, because:</p>
<ul>
<li>if I'm an application author, I get to cross-compile regardless, because all that matters is whether the target I specified has a precompiled host</li>
<li>if I'm a platform author, it's my responsibility to generate a <code>.rh</code> file for each of those targets one way or another, and from <code>roc</code>'s perspective, it doesn't really matter whether I need to use multiple operating systems to generate them</li>
</ul>



<a name="403303620"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/platform%20build%20instruction/near/403303620" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/platform.20build.20instruction.html#403303620">(Nov 21 2023 at 05:04)</a>:</h4>
<p>that plan sounds great! <span aria-label="heart eyes" class="emoji emoji-1f60d" role="img" title="heart eyes">:heart_eyes:</span></p>



<a name="403303688"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/platform%20build%20instruction/near/403303688" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/platform.20build.20instruction.html#403303688">(Nov 21 2023 at 05:05)</a>:</h4>
<p>Aside, we may eventually want a <code>roc bundle --merge</code> command that would enable a platform author to generate bundles for each os (if they can't cross compile) then merge all of the os specific bundles into one generic os bundle.</p>



<a name="403304001"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/platform%20build%20instruction/near/403304001" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/platform.20build.20instruction.html#403304001">(Nov 21 2023 at 05:09)</a>:</h4>
<p>interesting!</p>



<a name="403304197"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/platform%20build%20instruction/near/403304197" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/platform.20build.20instruction.html#403304197">(Nov 21 2023 at 05:11)</a>:</h4>
<p>just sounds more convenient than wrangling all of the <code>.rh</code> and <code>.rm</code> and <code>.o</code> etc files and dumping them into the same directory on a single machine. Instead, I just run github ci on all of my target systems. They all generate a bundle. I have a follow up step that runs merge and publishes.</p>



<a name="403304398"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/platform%20build%20instruction/near/403304398" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/platform.20build.20instruction.html#403304398">(Nov 21 2023 at 05:13)</a>:</h4>
<p>hm, but a bundle is just a compressed tarball plus hashing the final thing</p>



<a name="403304427"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/platform%20build%20instruction/near/403304427" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/platform.20build.20instruction.html#403304427">(Nov 21 2023 at 05:14)</a>:</h4>
<p>so I'm not sure if that saves any effort compare to just gathering all the binaries and running <code>bundle</code> afterwards <span aria-label="big smile" class="emoji emoji-1f604" role="img" title="big smile">:big_smile:</span></p>



<a name="403304480"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/platform%20build%20instruction/near/403304480" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/platform.20build.20instruction.html#403304480">(Nov 21 2023 at 05:14)</a>:</h4>
<p>as in, gathering bundles and gathering binaries seems like the same amount of effort</p>



<a name="403304547"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/platform%20build%20instruction/near/403304547" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/platform.20build.20instruction.html#403304547">(Nov 21 2023 at 05:15)</a>:</h4>
<p>Hmm, yeah probably. I guess it just is a little more folder structure and maybe two files instead of one. Yeah, probably pretty minor work. nvm</p>



<a name="403304981"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/platform%20build%20instruction/near/403304981" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/platform.20build.20instruction.html#403304981">(Nov 21 2023 at 05:20)</a>:</h4>
<p>Filed tracking issue <a href="https://github.com/roc-lang/roc/issues/6037">#6037</a></p>



<a name="403312648"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/platform%20build%20instruction/near/403312648" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/platform.20build.20instruction.html#403312648">(Nov 21 2023 at 06:34)</a>:</h4>
<p>what are thoughts on using <code>zig</code> as the compiler for the example c platform such that it gets super simple cross compilation?</p>
<p>Though, in general, I guess that example platforms don't really need to be able to cross compile. They can just be compiled for the current host machine cause they will never be distributed.</p>



<a name="403320196"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/platform%20build%20instruction/near/403320196" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Carroll <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/platform.20build.20instruction.html#403320196">(Nov 21 2023 at 07:36)</a>:</h4>
<p>There's some benefit in having a C platform with a Make or CMake build, because it shows Roc can be embedded into your current project that uses that build system.</p>



<a name="403399437"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/platform%20build%20instruction/near/403399437" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/platform.20build.20instruction.html#403399437">(Nov 21 2023 at 15:02)</a>:</h4>
<p>That's fair. Though I'm not sure I want to go through the hassle of cmake instead of just having a <a href="http://build.sh">build.sh</a>. though cmake also deals with windows, so maybe that is better.</p>



<hr><p>Last updated: Mar 01 2026 at 12:20 UTC</p>
</html>