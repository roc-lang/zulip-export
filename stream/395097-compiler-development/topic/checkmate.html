<html>
<head><meta charset="utf-8"><title>checkmate · compiler development · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/index.html">compiler development</a></h2>
<h3>Topic: <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/checkmate.html">checkmate</a></h3>

<hr>

<base href="https://roc.zulipchat.com">

<head><link href="https://roc-lang.github.io/zulip-export/style.css" rel="stylesheet"></head>

<a name="377617739"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/checkmate/near/377617739" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Kiryl Dziamura <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/checkmate.html#377617739">(Jul 22 2023 at 14:36)</a>:</h4>
<p>I'm looking into this issue, but can't figure out how to run the current version of <code>checkmate</code> <span aria-label="thinking" class="emoji emoji-1f914" role="img" title="thinking">:thinking:</span><br>
<a href="https://github.com/roc-lang/roc/issues/5678">https://github.com/roc-lang/roc/issues/5678</a></p>



<a name="377618555"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/checkmate/near/377618555" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anton <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/checkmate.html#377618555">(Jul 22 2023 at 14:39)</a>:</h4>
<p>I think you need to use the latest version, on this branch <a href="https://github.com/roc-lang/roc/tree/checkmate-ui-scaffold">https://github.com/roc-lang/roc/tree/checkmate-ui-scaffold</a></p>



<a name="377618654"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/checkmate/near/377618654" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anton <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/checkmate.html#377618654">(Jul 22 2023 at 14:40)</a>:</h4>
<p>Thanks for looking into the issue btw :)</p>



<a name="380910750"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/checkmate/near/380910750" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ayaz Hafiz <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/checkmate.html#380910750">(Aug 02 2023 at 05:42)</a>:</h4>
<p>For now, I am serving the checkmate UI (built once a day) at <a href="https://ayazhafiz.com/checkmate/">https://ayazhafiz.com/checkmate/</a></p>
<p>There are a bunch of missing pieces I want to clean up this week, but it should already be pretty usable (and hopefully much more useful for debugging types than anything we had before).</p>
<p>If you run into a typechecking bug and want to try to diagnose it, after minimizing, you can run a debug version of the compiler with <code>ROC_CHECKMATE=1</code> set. That will spit out a JSON file of the form <code>checkmate_&lt;timestamp&gt;.json</code> (maybe worth making the filename more customizable if someone wants an easy PR). You can then load them into the UI and investigate the unifications. Later this week I'm planning to add support for constraints, so you can see where in the source code a unification comes from.</p>



<a name="383848743"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/checkmate/near/383848743" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/checkmate.html#383848743">(Aug 11 2023 at 07:19)</a>:</h4>
<p><span class="user-mention" data-user-id="454654">@Ayaz Hafiz</span> I've got another one for checkmate, <span aria-label="smiley" class="emoji emoji-1f603" role="img" title="smiley">:smiley:</span> <a href="https://github.com/roc-lang/roc/issues/5749">this issue</a> is a minimal repro of the virtual dom issue</p>



<a name="384092837"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/checkmate/near/384092837" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ayaz Hafiz <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/checkmate.html#384092837">(Aug 11 2023 at 21:04)</a>:</h4>
<p>woo!</p>



<a name="391447039"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/checkmate/near/391447039" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ayaz Hafiz <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/checkmate.html#391447039">(Sep 17 2023 at 03:11)</a>:</h4>
<p>Btw <span class="user-mention" data-user-id="515757">@Luke Boswell</span> Ive figured out the bug here, but fixing it requires a somewhat involved refactor so I hope to have a patch out tomorrow or after</p>



<a name="391449633"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/checkmate/near/391449633" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/checkmate.html#391449633">(Sep 17 2023 at 03:48)</a>:</h4>
<p>Interested to know how you have found checkmate for debugging?</p>



<a name="391458755"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/checkmate/near/391458755" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ayaz Hafiz <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/checkmate.html#391458755">(Sep 17 2023 at 05:26)</a>:</h4>
<p>oh so huge</p>



<a name="391458877"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/checkmate/near/391458877" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ayaz Hafiz <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/checkmate.html#391458877">(Sep 17 2023 at 05:27)</a>:</h4>
<p>There's still some bugs (for example in the screenshot below the types at the top are missing), but scanning for "obvious" issues is very easy</p>



<a name="391458883"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/checkmate/near/391458883" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ayaz Hafiz <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/checkmate.html#391458883">(Sep 17 2023 at 05:27)</a>:</h4>
<p><a href="/user_uploads/22008/PJsYkOUD1chSv7FEpPhac8X7/image.png">image.png</a></p>
<div class="message_inline_image"><a href="/user_uploads/22008/PJsYkOUD1chSv7FEpPhac8X7/image.png" title="image.png"><img src="/user_uploads/22008/PJsYkOUD1chSv7FEpPhac8X7/image.png"></a></div>



<a name="391458969"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/checkmate/near/391458969" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ayaz Hafiz <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/checkmate.html#391458969">(Sep 17 2023 at 05:28)</a>:</h4>
<p>For example, here it is clear to see that there is a function that after unification winds up with an empty lambda set - which should never happen! So that was the immediate give away of where to look for the problem.</p>



<a name="392574737"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/checkmate/near/392574737" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ayaz Hafiz <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/checkmate.html#392574737">(Sep 22 2023 at 17:56)</a>:</h4>
<p>Wow. This is pretty crazy. I'm realizing now we will have to lift canonicalization of annotations to happen after can of definitions, because canonicalized annotations need captures information</p>



<a name="392614779"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/checkmate/near/392614779" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/checkmate.html#392614779">(Sep 22 2023 at 23:15)</a>:</h4>
<p>oh for lambda sets?</p>



<a name="392646771"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/checkmate/near/392646771" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ayaz Hafiz <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/checkmate.html#392646771">(Sep 23 2023 at 05:20)</a>:</h4>
<p>yeah</p>



<a name="392688258"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/checkmate/near/392688258" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/checkmate.html#392688258">(Sep 23 2023 at 12:01)</a>:</h4>
<p>yeah now that you say it, it seems obvious in retrospect <span aria-label="sweat smile" class="emoji emoji-1f605" role="img" title="sweat smile">:sweat_smile:</span></p>



<a name="395423545"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/checkmate/near/395423545" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ayaz Hafiz <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/checkmate.html#395423545">(Oct 07 2023 at 14:10)</a>:</h4>
<p>Moreover we need to lift this to happen (or at least the injection of a lambda set into a type annotation) until after we have fixed the capture sets across all definitions, which we currently only do after all other canonicalization in one pass (to handle recursive defs, etc)</p>



<a name="395423743"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/checkmate/near/395423743" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ayaz Hafiz <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/checkmate.html#395423743">(Oct 07 2023 at 14:13)</a>:</h4>
<p>I think we need to figure out a plan here. As I see it, we have two options: (1) we can use a mutable cell to store the captures info in the type annotation, and expect that later the mutable cell will be fixed-up, or (2) we can move canonicalization of annotations to happen after all value canonicalization, including the captures fixing. I prefer (2) because this code is already not the easiest to reason about, and though two passes is annoying, it's likely not going to matter once we have a full SoA impl.</p>



<a name="395427378"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/checkmate/near/395427378" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/checkmate.html#395427378">(Oct 07 2023 at 14:54)</a>:</h4>
<p>yeah I agree with (2) being the way to go</p>



<a name="395427445"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/checkmate/near/395427445" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/checkmate.html#395427445">(Oct 07 2023 at 14:55)</a>:</h4>
<p>especially because we can incorporate this design constraint into the revamped design and minimize the cost then</p>



<a name="395427564"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/checkmate/near/395427564" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/checkmate.html#395427564">(Oct 07 2023 at 14:57)</a>:</h4>
<p><span aria-label="thinking" class="emoji emoji-1f914" role="img" title="thinking">:thinking:</span> does it matter for constraint gen if we generate a constraint for the annotation first or the body first?</p>



<a name="395427656"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/checkmate/near/395427656" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/checkmate.html#395427656">(Oct 07 2023 at 14:58)</a>:</h4>
<p>if not, we could potentially adjust the canonical IR to store the body first and then the annotation afterwards, right?</p>



<a name="395427728"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/checkmate/near/395427728" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/checkmate.html#395427728">(Oct 07 2023 at 14:59)</a>:</h4>
<p>oh nm that wouldn't help because of the "must do a pass over all the bodies before starting on the annotations" need</p>



<a name="395427879"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/checkmate/near/395427879" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/checkmate.html#395427879">(Oct 07 2023 at 15:01)</a>:</h4>
<p>I guess another idea would be to store captures in a side table and give them an ID, and then give the annotation and the body the same ID, then have the body actually populate it</p>



<a name="395427904"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/checkmate/near/395427904" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/checkmate.html#395427904">(Oct 07 2023 at 15:01)</a>:</h4>
<p>which is similar to the Cell idea except you don't have to go back and fix it up later</p>



<a name="395431309"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/checkmate/near/395431309" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ayaz Hafiz <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/checkmate.html#395431309">(Oct 07 2023 at 15:40)</a>:</h4>
<p>constraint always happens after canonicalization</p>



<a name="395431329"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/checkmate/near/395431329" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ayaz Hafiz <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/checkmate.html#395431329">(Oct 07 2023 at 15:40)</a>:</h4>
<p>yeah that's the same as the mutable cell idea. which is only one pass but makes debugging harder :D</p>



<a name="395432181"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/checkmate/near/395432181" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/checkmate.html#395432181">(Oct 07 2023 at 15:52)</a>:</h4>
<p>yeah maybe worth considering down the line, but not right now</p>



<a name="397863586"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/checkmate/near/397863586" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ayaz Hafiz <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/checkmate.html#397863586">(Oct 21 2023 at 16:58)</a>:</h4>
<p>This is a really frustrating change to make. I had to give up on the approach I was currently taking, I think part of the inconvenience is we have two separate IRs in the canonicalizer right now (SoA + classic AST). <span class="user-mention" data-user-id="281543">@Folkert de Vries</span>  do you have any existing plans to go full SoA in the can AST? If not I will do it. I really think we need to unify and simply the data structures significantly ASAP before fixing the more general issue here though.</p>



<a name="398137416"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/checkmate/near/398137416" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/checkmate.html#398137416">(Oct 23 2023 at 18:32)</a>:</h4>
<p>I don't have plans (and probably would not get to it this year anyway). I think Richard has thoughts on this because it also has to integrate with the parser.</p>



<a name="398145846"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/checkmate/near/398145846" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/checkmate.html#398145846">(Oct 23 2023 at 19:42)</a>:</h4>
<p>can we let the other one drift then? just come back and revisit it later?</p>



<a name="398146233"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/checkmate/near/398146233" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ayaz Hafiz <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/checkmate.html#398146233">(Oct 23 2023 at 19:46)</a>:</h4>
<p>We could but it's hard to do anything because half of the AST is in one, and half is in the other. we should consolidate them asap, I think</p>



<a name="398147939"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/checkmate/near/398147939" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/checkmate.html#398147939">(Oct 23 2023 at 20:01)</a>:</h4>
<p>oh hm</p>



<a name="398147949"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/checkmate/near/398147949" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/checkmate.html#398147949">(Oct 23 2023 at 20:01)</a>:</h4>
<p>I can work on that</p>



<a name="398148616"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/checkmate/near/398148616" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/checkmate.html#398148616">(Oct 23 2023 at 20:07)</a>:</h4>
<p>or if you want to, go for it</p>



<a name="398148669"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/checkmate/near/398148669" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/checkmate.html#398148669">(Oct 23 2023 at 20:08)</a>:</h4>
<p>I don't actually know what the current state of them is <span aria-label="sweat smile" class="emoji emoji-1f605" role="img" title="sweat smile">:sweat_smile:</span></p>



<hr><p>Last updated: Mar 01 2026 at 12:20 UTC</p>
</html>