<html>
<head><meta charset="utf-8"><title>number type inference · compiler development · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/index.html">compiler development</a></h2>
<h3>Topic: <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/number.20type.20inference.html">number type inference</a></h3>

<hr>

<base href="https://roc.zulipchat.com">

<head><link href="https://roc-lang.github.io/zulip-export/style.css" rel="stylesheet"></head>

<a name="556711255"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/number%20type%20inference/near/556711255" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/number.20type.20inference.html#556711255">(Nov 16 2025 at 20:04)</a>:</h4>
<p>ok, while working on the epic <a href="https://github.com/roc-lang/roc/pull/8368">https://github.com/roc-lang/roc/pull/8368</a> I have learned some things - I want to do a quick note of them here:</p>



<a name="556711482"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/number%20type%20inference/near/556711482" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/number.20type.20inference.html#556711482">(Nov 16 2025 at 20:08)</a>:</h4>
<h1>number primitive types</h1>
<p>we have the <code>num_compact</code>, <code>num_unbound</code> etc. behind-the-scenes types, which were a nice performance optimization for the old <code>Num</code> system (while also being a shortcut to getting <em>something</em> working for number literals and basic arithmetic ops), but which are now mostly in the way now that we have actual nominal types and no longer want to represent numbers as opaque <code>Num</code> types with nested phantom types.</p>
<p>I think we can do something similar in the static dispatch world, but trying to transition it at the same time as transitioning number literals over to the new design has made it extremely difficult. I think based on my experience so far, it will be better to just take out the number primitves from the type system, use only the actual nominal types we now have in <code>Builtin.roc</code>, and then revisit the primitives (strictly as a performance optimization) in the future once we have all of this working.</p>



<a name="556711719"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/number%20type%20inference/near/556711719" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/number.20type.20inference.html#556711719">(Nov 16 2025 at 20:12)</a>:</h4>
<h2>methods for converting literals</h2>
<p>the way to make numbers be ordinary opaque types is to have the type of number literals be polymorphic:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">my_integer</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="nc">num</span>
<span class="w">    </span><span class="k">where</span><span class="w"> </span><span class="n">from_int_digits</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="nc">List</span><span class="p">(</span><span class="n">U8</span><span class="p">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">Try</span><span class="p">(</span><span class="n">num</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="n">OutOfRange</span><span class="p">])</span>
<span class="n">my_integer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">5</span>

<span class="n">my_fraction</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="nc">num</span>
<span class="w">    </span><span class="k">where</span><span class="w"> </span><span class="n">from_dec_digits</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">(</span><span class="n">List</span><span class="p">(</span><span class="n">U8</span><span class="p">),</span><span class="w"> </span><span class="n">List</span><span class="p">(</span><span class="n">U8</span><span class="p">))</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">Try</span><span class="p">(</span><span class="n">num</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="n">OutOfRange</span><span class="p">])</span>
<span class="n">my_fraction</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">4.2</span>
</code></pre></div>



<a name="556711811"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/number%20type%20inference/near/556711811" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/number.20type.20inference.html#556711811">(Nov 16 2025 at 20:14)</a>:</h4>
<p>so basically, if you make a custom type which defines <code>from_int_digits</code> then you can define it using integer literals like <code>5</code>, and if you make a custom type which defines <code>from_dec_digits</code> then you can define it using decimal literals like <code>4.2</code></p>



<a name="556711846"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/number%20type%20inference/near/556711846" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/number.20type.20inference.html#556711846">(Nov 16 2025 at 20:14)</a>:</h4>
<p>this creates a slightly weird situation where you can define a custom number type that defines <code>from_dec_digits</code> but not <code>from_int_digits</code>, and then you can create one using <code>3.0</code> but not <code>3</code>.</p>



<a name="556711878"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/number%20type%20inference/near/556711878" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/number.20type.20inference.html#556711878">(Nov 16 2025 at 20:15)</a>:</h4>
<p>I'd prefer if the API were such that you essentially had to specify which you wanted</p>



<a name="556711883"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/number%20type%20inference/near/556711883" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/number.20type.20inference.html#556711883">(Nov 16 2025 at 20:15)</a>:</h4>
<p>instead of being able to forget to handle one case</p>



<a name="556711926"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/number%20type%20inference/near/556711926" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/number.20type.20inference.html#556711926">(Nov 16 2025 at 20:16)</a>:</h4>
<p>there's another problem, which is that in the future I'd like to do the same thing with string literals, which will mean that we can still have stuff like <code>File.read! : Path =&gt; ...</code> and yet you can give it a string literal like <code>File.read!("foo.txt")</code> because <code>Path</code> has a <code>from_str_literal</code> method (or similar) that does the same thing as <code>from_int_digits</code> etc.</p>



<a name="556711999"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/number%20type%20inference/near/556711999" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/number.20type.20inference.html#556711999">(Nov 16 2025 at 20:18)</a>:</h4>
<p>the reason this is a problem is that if these are all just polymorphic method constraints, then this code...</p>
<div class="codehilite"><pre><span></span><code>x = 4.7 / &quot;cheese&quot;
</code></pre></div>
<p>...will type-check, and in fact if <code>x</code> is a custom type which (for whatever reason) defines all of <code>from_dec_digits</code> and <code>from_str_literal</code> and <code>div</code> then it will do...something <span aria-label="sweat smile" class="emoji emoji-1f605" role="img" title="sweat smile">:sweat_smile:</span></p>



<a name="556712324"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/number%20type%20inference/near/556712324" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/number.20type.20inference.html#556712324">(Nov 16 2025 at 20:25)</a>:</h4>
<p>you could look at it as a feature that this can work, but there's a nonobvious downside: if <code>4.7 / "cheese"</code> happily type-checks, then the same is true if you are giving them names in a quick script where you're not annotating types because it's a quick script:</p>
<div class="codehilite" data-code-language="Ruby"><pre><span></span><code><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">4</span><span class="o">.</span><span class="mi">7</span>
<span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"cheese"</span>

<span class="c1"># ...somewhere later in the code</span>

<span class="k">if</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="o">...</span><span class="w"> </span><span class="p">}</span>
</code></pre></div>
<p>this will give a compile-time error, but I don't think it'll be a nice one - because according to these rules, everything in that code type-checks!</p>



<a name="556712328"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/number%20type%20inference/near/556712328" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jared Ramirez <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/number.20type.20inference.html#556712328">(Nov 16 2025 at 20:25)</a>:</h4>
<p>i really like removing the number types from the type system. it made sense for the polymorphic types, but agree they felt error proned with a less clear perf gain in the static dispatch world</p>



<a name="556712497"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/number%20type%20inference/near/556712497" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/number.20type.20inference.html#556712497">(Nov 16 2025 at 20:28)</a>:</h4>
<p>the type of <code>x / y &gt; 0</code> here is totally valid and internally consistent; it's something like:</p>
<ul>
<li><code>y</code> has <code>from_str_literal</code></li>
<li><code>x</code> has <code>from_dec_digits</code> and <code>div</code></li>
<li><code>x</code>'s <code>div</code> takes something compatible with <code>y</code> and returns something with <code>is_gt</code></li>
<li>that <code>is_gt</code> takes something that has <code>from_int_digits</code> (from the <code>0</code>) and returns <code>Bool</code> (because <code>if</code> requires <code>Bool</code>)</li>
</ul>



<a name="556712644"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/number%20type%20inference/near/556712644" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jared Ramirez <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/number.20type.20inference.html#556712644">(Nov 16 2025 at 20:31)</a>:</h4>
<p>yeah that is throrny, on the one hand that flexibility is really cool. on the other, it hurts the beginner experience and error message quality</p>



<a name="556712662"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/number%20type%20inference/near/556712662" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/number.20type.20inference.html#556712662">(Nov 16 2025 at 20:31)</a>:</h4>
<p>potentially, the latest point at which you'd actually get a compiler error would be that we make it to compile-time evaluation of constants, resolve <code>x = 4.7</code> to be an <code>I128</code> by default (because it didn't get a more specific number type by the end of type-checking), and similarly <code>y</code> becomes a concrete <code>Str</code>) - so then at that point when we go to evaluate <code>x / y</code>we get an error saying that <code>x</code> defaulted to <code>I128</code> and <code>y</code> defaulted to <code>Str</code> and <code>I128.div</code> only accepts another <code>I128</code>, not a <code>Str</code></p>



<a name="556712698"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/number%20type%20inference/near/556712698" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/number.20type.20inference.html#556712698">(Nov 16 2025 at 20:32)</a>:</h4>
<p>an idea for how to catch this earlier during type-checking: change all of them to have a <code>from_literal</code> method, which takes a different nominal type for its first argument so that the incompatibility comes up right away</p>



<a name="556712745"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/number%20type%20inference/near/556712745" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/number.20type.20inference.html#556712745">(Nov 16 2025 at 20:32)</a>:</h4>
<p>so we'd have:</p>
<div class="codehilite" data-code-language="Ruby"><pre><span></span><code><span class="no">I128</span><span class="o">.</span><span class="n">from_literal</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="no">Num</span><span class="o">.</span><span class="n">Literal</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="no">Try</span><span class="p">(</span><span class="no">I128</span><span class="p">,</span><span class="w"> </span><span class="o">[</span><span class="no">Unsupported</span><span class="o">]</span><span class="p">)</span>
</code></pre></div>
<div class="codehilite" data-code-language="Ruby"><pre><span></span><code><span class="no">Str</span><span class="o">.</span><span class="n">from_literal</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="no">Str</span><span class="o">.</span><span class="n">Literal</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="no">Try</span><span class="p">(</span><span class="no">Str</span><span class="p">,</span><span class="w"> </span><span class="o">[</span><span class="no">Unsupported</span><span class="o">]</span><span class="p">)</span>
</code></pre></div>



<a name="556712807"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/number%20type%20inference/near/556712807" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/number.20type.20inference.html#556712807">(Nov 16 2025 at 20:33)</a>:</h4>
<p>then:</p>
<div class="codehilite" data-code-language="Ruby"><pre><span></span><code><span class="n">x</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">num</span><span class="w"> </span><span class="n">where</span><span class="w"> </span><span class="o">[</span><span class="n">num</span><span class="o">.</span><span class="n">from_literal</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="no">Num</span><span class="o">.</span><span class="n">Literal</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="no">Try</span><span class="p">(</span><span class="n">num</span><span class="p">,</span><span class="w"> </span><span class="o">[</span><span class="no">Unsupported</span><span class="o">]</span><span class="p">)</span>
<span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">4</span><span class="o">.</span><span class="mi">7</span>

<span class="n">y</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">str</span><span class="w"> </span><span class="n">where</span><span class="w"> </span><span class="o">[</span><span class="n">str</span><span class="o">.</span><span class="n">from_literal</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="no">Str</span><span class="o">.</span><span class="n">Literal</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="no">Try</span><span class="p">(</span><span class="n">str</span><span class="p">,</span><span class="w"> </span><span class="o">[</span><span class="no">Unsupported</span><span class="o">]</span><span class="p">)</span>
<span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"cheese"</span>
</code></pre></div>



<a name="556712873"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/number%20type%20inference/near/556712873" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/number.20type.20inference.html#556712873">(Nov 16 2025 at 20:34)</a>:</h4>
<p>so now it's impossible to have a custom type that can be represented as both a string literal and as a number literal</p>



<a name="556712908"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/number%20type%20inference/near/556712908" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/number.20type.20inference.html#556712908">(Nov 16 2025 at 20:35)</a>:</h4>
<p>because you have to pick one to use with your <code>from_literal</code> method; <code>Num.Literal</code> and <code>Str.Literal</code> would be different nominal types</p>



<a name="556713094"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/number%20type%20inference/near/556713094" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/number.20type.20inference.html#556713094">(Nov 16 2025 at 20:38)</a>:</h4>
<p>then <code>Num.Literal</code> would have both integer and decimal digits, and for integer types (like <code>I128</code>) you'd just return <code>Err</code> if given a nonzero decimal - basically the same as if you give an <code>U8</code> something over 255</p>



<a name="556713244"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/number%20type%20inference/near/556713244" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/number.20type.20inference.html#556713244">(Nov 16 2025 at 20:39)</a>:</h4>
<p>all that said, I don't have much intuition for how much this will come up in practice. It might turn out that it's fine, and maybe even nice, to support that level of flexibility</p>



<a name="556713265"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/number%20type%20inference/near/556713265" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/number.20type.20inference.html#556713265">(Nov 16 2025 at 20:40)</a>:</h4>
<p>one concrete example I just thought of is UI elements</p>



<a name="556713351"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/number%20type%20inference/near/556713351" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/number.20type.20inference.html#556713351">(Nov 16 2025 at 20:41)</a>:</h4>
<p>e.g. in Elm, when you look at the classic UI example of a <a href="https://guide.elm-lang.org/architecture/buttons">counter that increases or decreases a number example</a>, part of it is:</p>
<div class="codehilite"><pre><span></span><code>div [] [ text (String.fromInt model) ]
</code></pre></div>
<p>so you need to take a number and convert it to a string and then pass that string to a <code>text</code> to display it</p>



<a name="556713396"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/number%20type%20inference/near/556713396" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/number.20type.20inference.html#556713396">(Nov 16 2025 at 20:41)</a>:</h4>
<p>but with the string literal design mentioned above, you could give your UI element type a <code>from_str_literal</code> method, allowing you to just go <code>[button1, button2, "some text!"]</code> without having to call <code>text</code> on it to convert it to a UI element type</p>



<a name="556713440"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/number%20type%20inference/near/556713440" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/number.20type.20inference.html#556713440">(Nov 16 2025 at 20:42)</a>:</h4>
<p>and then if we supported converting from numbers too, then you could also display numbers in the same way without having to convert them to strings first, e.g. <code>[button1, button2, current_count]</code> could Just Work too</p>



<a name="556713473"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/number%20type%20inference/near/556713473" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/number.20type.20inference.html#556713473">(Nov 16 2025 at 20:42)</a>:</h4>
<p>but that would require UI elements being able to define both <code>from_str_literal</code> and <code>from_num_literal</code> at the same time</p>



<a name="556713516"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/number%20type%20inference/near/556713516" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/number.20type.20inference.html#556713516">(Nov 16 2025 at 20:43)</a>:</h4>
<p>so it's probably worth doing the experiment and seeing what actual concrete error messages turn out to be annoying in the wild (or not - maybe they're all fine in practice!)</p>



<a name="556713537"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/number%20type%20inference/near/556713537" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/number.20type.20inference.html#556713537">(Nov 16 2025 at 20:43)</a>:</h4>
<p>rather than ruling that out before we've even tried it</p>



<a name="556713573"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/number%20type%20inference/near/556713573" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/number.20type.20inference.html#556713573">(Nov 16 2025 at 20:44)</a>:</h4>
<p>so my conclusion here is mostly that I want to note all of this, as something I've learned while working on that PR, in case we encounter a problem in practice and need to revisit potential solutions later <span aria-label="smile" class="emoji emoji-1f604" role="img" title="smile">:smile:</span></p>



<a name="556713623"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/number%20type%20inference/near/556713623" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/number.20type.20inference.html#556713623">(Nov 16 2025 at 20:45)</a>:</h4>
<h2>evaluating default numbers</h2>
<p><code>1 + 2</code> desugars into <code>1.plus(2)</code>, which currently has this type:</p>
<div class="codehilite" data-code-language="Ruby"><pre><span></span><code><span class="n">ret</span><span class="w"> </span><span class="n">where</span><span class="w"> </span><span class="o">[</span>
<span class="w">    </span><span class="n">a</span><span class="o">.</span><span class="n">plus</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">ret</span><span class="p">,</span>
<span class="w">    </span><span class="n">a</span><span class="o">.</span><span class="n">from_int_digits</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="no">List</span><span class="p">(</span><span class="no">U8</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="no">Try</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="o">[</span><span class="no">OutOfBounds</span><span class="o">]</span><span class="p">),</span>
<span class="w">    </span><span class="n">b</span><span class="o">.</span><span class="n">from_int_digits</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="no">List</span><span class="p">(</span><span class="no">U8</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="no">Try</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="o">[</span><span class="no">OutOfBounds</span><span class="o">]</span><span class="p">),</span>
<span class="o">]</span>
</code></pre></div>



<a name="556713701"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/number%20type%20inference/near/556713701" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/number.20type.20inference.html#556713701">(Nov 16 2025 at 20:46)</a>:</h4>
<p>we have the rule that integers default to <code>I128</code> if not otherwise specified, so that for example beginners can put <code>1 + 1</code> into the repl and get an answer instead of an error saying in this language you need to be more specific about what type of number you want <span aria-label="stuck out tongue" class="emoji emoji-1f61b" role="img" title="stuck out tongue">:stuck_out_tongue:</span></p>



<a name="556713707"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/number%20type%20inference/near/556713707" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/number.20type.20inference.html#556713707">(Nov 16 2025 at 20:46)</a>:</h4>
<p>(and similar for decimal literals and <code>Dec</code>)</p>



<a name="556713778"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/number%20type%20inference/near/556713778" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/number.20type.20inference.html#556713778">(Nov 16 2025 at 20:47)</a>:</h4>
<p>now, the trouble is - both the interpreter and the future optimizing compiler need to know <em>at compile time</em> the size in bytes of return types <em>before</em> they call a function</p>



<a name="556713799"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/number%20type%20inference/near/556713799" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/number.20type.20inference.html#556713799">(Nov 16 2025 at 20:47)</a>:</h4>
<p>this is necessary so they can know how much space to allocate in the caller for the return type</p>



<a name="556713826"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/number%20type%20inference/near/556713826" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/number.20type.20inference.html#556713826">(Nov 16 2025 at 20:48)</a>:</h4>
<p>(note that even if we somehow changed the interpreter to not need this, which I don't think would be the right choice for reasons that are out of scope here, the optimizing compiler would still need it - so we should assume that we need to preserve this property)</p>



<a name="556713858"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/number%20type%20inference/near/556713858" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/number.20type.20inference.html#556713858">(Nov 16 2025 at 20:48)</a>:</h4>
<p>the problem here is that the inferred type (<code>ret where ...</code>) doesn't actually capture that this is "a number"</p>



<a name="556713944"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/number%20type%20inference/near/556713944" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/number.20type.20inference.html#556713944">(Nov 16 2025 at 20:50)</a>:</h4>
<p>so even if we know that "numbers default to <code>I128</code>", when we try to evaluate the expression <code>1 + 2</code>, we don't know after type checking that the return type is a number - and therefore we don't know how much space to allocate</p>



<a name="556714006"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/number%20type%20inference/near/556714006" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/number.20type.20inference.html#556714006">(Nov 16 2025 at 20:51)</a>:</h4>
<p>now one thing we could theoretically do here is to try to unify <code>I128</code> with <code>ret where [...]</code> and see that it succeeds, and therefore conclude that this is <em>compatible</em> with <code>I128</code>, and so <code>I128</code> is a reasonable default, and therefore we should use it</p>



<a name="556714031"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/number%20type%20inference/near/556714031" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/number.20type.20inference.html#556714031">(Nov 16 2025 at 20:51)</a>:</h4>
<p>however, even if that did seem like a good approach for this scenario, it falls apart in this example:</p>
<div class="codehilite"><pre><span></span><code>(|a, b| a + b)(1, 2)
</code></pre></div>



<a name="556714050"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/number%20type%20inference/near/556714050" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/number.20type.20inference.html#556714050">(Nov 16 2025 at 20:52)</a>:</h4>
<p>this should, of course, do the same thing as just running <code>1 + 2</code></p>



<a name="556714070"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/number%20type%20inference/near/556714070" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/number.20type.20inference.html#556714070">(Nov 16 2025 at 20:52)</a>:</h4>
<p>it would be very strange if <code>1 + 2</code> worked but <code>(|a, b| a + b)(1, 2)</code> didn't, or if they got different answers!</p>



<a name="556714146"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/number%20type%20inference/near/556714146" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/number.20type.20inference.html#556714146">(Nov 16 2025 at 20:53)</a>:</h4>
<p>the problem is that the type of <code>1 + 2</code> is:</p>
<div class="codehilite"><pre><span></span><code>ret where [
    a.plus : a, b -&gt; ret,
    a.from_int_digits : List(U8) -&gt; Try(a, [OutOfBounds]),
    b.from_int_digits : List(U8) -&gt; Try(a, [OutOfBounds]),
]
</code></pre></div>



<a name="556714196"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/number%20type%20inference/near/556714196" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/number.20type.20inference.html#556714196">(Nov 16 2025 at 20:54)</a>:</h4>
<p>...and the type of <code>(|a, b| a + b)</code> is the same, but instead of <code>ret</code> at the start it's <code>a, b -&gt; ret</code></p>
<div class="codehilite"><pre><span></span><code>a, b -&gt; ret where [
    a.plus : a, b -&gt; ret,
    a.from_int_digits : List(U8) -&gt; Try(a, [OutOfBounds]),
    b.from_int_digits : List(U8) -&gt; Try(a, [OutOfBounds]),
]
</code></pre></div>



<a name="556714436"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/number%20type%20inference/near/556714436" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/number.20type.20inference.html#556714436">(Nov 16 2025 at 20:58)</a>:</h4>
<p>so if we try to call this with <code>1</code> - which has the type <code>a where a.from_int_digits : List(U8) -&gt; Try(a, [OutOfBounds])</code> - then what we'd like to have happen is that the literal <code>1</code> would pick up the <code>plus</code> constraint too, and now be required to have both <code>from_int_digits</code> (which it has by default because it's a number literal) as well as <code>plus</code> (because it unified with <code>a</code> in <code>a, b -&gt; ret</code> and <code>a</code> is required to have <code>plus</code>)</p>



<a name="556714464"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/number%20type%20inference/near/556714464" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/number.20type.20inference.html#556714464">(Nov 16 2025 at 20:58)</a>:</h4>
<p>I'm pretty sure this is what should already happen, although I haven't tried it</p>



<a name="556714582"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/number%20type%20inference/near/556714582" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/number.20type.20inference.html#556714582">(Nov 16 2025 at 21:00)</a>:</h4>
<p>anyway, despite being more convoluted than the non-lambda version, I think this example should work out just like <code>1 + 2</code> in that if we were to try unifying <code>I128</code> with the unbound value, it should work</p>



<a name="556714725"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/number%20type%20inference/near/556714725" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/number.20type.20inference.html#556714725">(Nov 16 2025 at 21:03)</a>:</h4>
<p>but there's something that does feel concerning about all of those examples, namely that it basically means anytime we try to eval an unresolved polymorphic type, or a function that's returning one, we have to basically assume it's a number (and try to unify it accordingly) even though we don't really have a reason to assume that <span aria-label="sweat smile" class="emoji emoji-1f605" role="img" title="sweat smile">:sweat_smile:</span></p>



<a name="556714810"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/number%20type%20inference/near/556714810" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/number.20type.20inference.html#556714810">(Nov 16 2025 at 21:04)</a>:</h4>
<p>and in the world where we're doing it with strings too, we'd probably have to just try both (perhaps after looking for the obvious <code>form_num_literal</code>/<code>from_str_literal</code> in the constraints as a heuristic for which to try first) - probably not a big deal in practice, given that these defaults basically only ever come up in practice in the repl, or maybe in very quick scripts</p>



<a name="556714904"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/number%20type%20inference/near/556714904" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/number.20type.20inference.html#556714904">(Nov 16 2025 at 21:06)</a>:</h4>
<p>anyway, my conclusion from all of this is that:</p>
<ul>
<li>when the interpreter (or in the future the optimizing compiler) encounters an unbound polymorphic type whose layout must be known, it should try to <em>unify</em> that type with the default number type, and not just "assume" it like before (because we don't have any information to go on as to whether that's a safe assumption or not)</li>
<li>in the future where we're doing this for strings too, we can try unifying both, and use the presence of a <code>from_whichever_literal</code> as a heuristic to only bother unifying with the one that's more likely to succeed</li>
</ul>



<a name="556714923"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/number%20type%20inference/near/556714923" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/number.20type.20inference.html#556714923">(Nov 16 2025 at 21:06)</a>:</h4>
<h2>one default number type</h2>
<p>based on all of the above, I think we actually want to just have one default number type: <code>Dec</code></p>



<a name="556714932"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/number%20type%20inference/near/556714932" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/number.20type.20inference.html#556714932">(Nov 16 2025 at 21:06)</a>:</h4>
<p>like, no more "integers default to <code>I128</code> and non-integers default to <code>Dec</code>"</p>



<a name="556714956"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/number%20type%20inference/near/556714956" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/number.20type.20inference.html#556714956">(Nov 16 2025 at 21:07)</a>:</h4>
<p>it's just "if you have a number literal, regardless of whether there's a decimal point in it, if it doesn't resolve to any other type, we just resolve it to <code>Dec</code>"</p>



<a name="556715010"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/number%20type%20inference/near/556715010" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/number.20type.20inference.html#556715010">(Nov 16 2025 at 21:08)</a>:</h4>
<p>this obviously works fine from a runtime perspective, since <code>Dec</code> (unlike floats) is perfectly capable of performing both precise base-10 integer arithmetic as well as precise base-10 decimal arithmetic</p>



<a name="556715048"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/number%20type%20inference/near/556715048" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/number.20type.20inference.html#556715048">(Nov 16 2025 at 21:09)</a>:</h4>
<p>but it means that we can have just one <code>from_num_literal</code> method which uses the returned value being either <code>Ok</code> or <code>Err</code> (when being evaluated at compile time) to handle <em>both</em> the error case of the literal being out of bounds (e.g. negative number literals being used with unsigned integers, or the number literal being too big to fit in the number - and now additionally, integers being given decimals would be reported the same way)</p>



<a name="556715084"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/number%20type%20inference/near/556715084" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/number.20type.20inference.html#556715084">(Nov 16 2025 at 21:10)</a>:</h4>
<p>and then at that point, when trying to figure out the runtime type of an unbound number literal, we just unify it with <code>Dec</code> and we're all set</p>



<a name="556715492"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/number%20type%20inference/near/556715492" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/number.20type.20inference.html#556715492">(Nov 16 2025 at 21:17)</a>:</h4>
<h2>summary</h2>
<p>I think based on all these learnings, I want to:</p>
<ul>
<li>get rid of the <code>num_compact</code>, <code>num_unbound</code>, <code>num_poly</code> etc. system and revisit it after we get all the new stuff working</li>
<li>change the type of all number literals (whether they have a decimal component or not) to: <code>from_num_literal : NumLiteral -&gt; Try(MyNumberType, [Unsupported(Str)])</code></li>
<li>define <code>Num.NumLiteral</code> to have methods like <code>is_negative</code>, <code>digits_before_decimal</code>, <code>digits_after_decimal</code>, etc.</li>
<li>plan to do a similar <code>from_str_literal</code> in the future for strings</li>
<li>change the default number type to always be <code>Dec</code>, never <code>I128</code></li>
<li>when the interpreter needs to get the runtime layout of an unresolved polymorphic type, it should first unify it with <code>Dec</code> (and if that unification fails, then evaluate it to a <code>crash</code>)</li>
</ul>



<a name="556716070"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/number%20type%20inference/near/556716070" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/number.20type.20inference.html#556716070">(Nov 16 2025 at 21:27)</a>:</h4>
<p>any thoughts on all of that welcome!</p>



<a name="556717685"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/number%20type%20inference/near/556717685" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/number.20type.20inference.html#556717685">(Nov 16 2025 at 21:54)</a>:</h4>
<p>This sounds like great progress. I like the simplification to just use Dec as default, and it sounds like the type system implementation will be simpler and easier to get right.</p>



<a name="556718635"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/number%20type%20inference/near/556718635" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/number.20type.20inference.html#556718635">(Nov 16 2025 at 22:07)</a>:</h4>
<p>yeah, these are all things I wish I'd known earlier, but as usual, actually implementing things is often the fastest way to learn them <span aria-label="joy" class="emoji emoji-1f602" role="img" title="joy">:joy:</span></p>



<a name="556718991"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/number%20type%20inference/near/556718991" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jared Ramirez <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/number.20type.20inference.html#556718991">(Nov 16 2025 at 22:14)</a>:</h4>
<p>all sounds good to me! the simpler type system, the easier to ensure correctness — so big fan of removing hardcoded variants!</p>



<a name="556719645"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/number%20type%20inference/near/556719645" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/number.20type.20inference.html#556719645">(Nov 16 2025 at 22:29)</a>:</h4>
<p>ok cool! Unfortunately this means we can't do more number builtin stuff until all of this lands <span aria-label="sweat smile" class="emoji emoji-1f605" role="img" title="sweat smile">:sweat_smile:</span></p>



<a name="556872994"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/number%20type%20inference/near/556872994" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mike <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/number.20type.20inference.html#556872994">(Nov 17 2025 at 16:13)</a>:</h4>
<p><span class="user-mention silent" data-user-id="281383">Richard Feldman</span> <a href="#narrow/channel/395097-compiler-development/topic/number.20type.20inference/near/556712873">said</a>:</p>
<blockquote>
<p>so now it's impossible to have a custom type that can be represented as both a string literal and as a number literal</p>
</blockquote>
<p>Not sure if completely related but this reminded me of your convo with Chris Lattner re: swift's type checker and how a lot of complexity/combinatorial explosions came from all the <code>ExpressibleBy...Literal</code> protocols (traits)</p>



<a name="556888530"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/number%20type%20inference/near/556888530" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/number.20type.20inference.html#556888530">(Nov 17 2025 at 17:14)</a>:</h4>
<p>I don't think this is related</p>



<a name="556888591"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/number%20type%20inference/near/556888591" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/number.20type.20inference.html#556888591">(Nov 17 2025 at 17:15)</a>:</h4>
<p>we don't try multiple options the way Swift does</p>



<a name="556888681"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/number%20type%20inference/near/556888681" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/number.20type.20inference.html#556888681">(Nov 17 2025 at 17:15)</a>:</h4>
<p>merging method constraints is basically the same as merging record field constraints</p>



<hr><p>Last updated: Mar 01 2026 at 12:20 UTC</p>
</html>