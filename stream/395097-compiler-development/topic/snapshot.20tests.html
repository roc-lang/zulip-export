<html>
<head><meta charset="utf-8"><title>snapshot tests · compiler development · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/index.html">compiler development</a></h2>
<h3>Topic: <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/snapshot.20tests.html">snapshot tests</a></h3>

<hr>

<base href="https://roc.zulipchat.com">

<head><link href="https://roc-lang.github.io/zulip-export/style.css" rel="stylesheet"></head>

<a name="475682204"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/snapshot%20tests/near/475682204" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/snapshot.20tests.html#475682204">(Oct 08 2024 at 22:02)</a>:</h4>
<p>I'd like to upgrade the roc_cli tests to use snapshots... because I'm going a bit crazy chasing minor changes. Is it ok to use <a href="https://rust-exercises.com/advanced-testing/02_snapshots/00_intro">https://rust-exercises.com/advanced-testing/02_snapshots/00_intro</a> which describes the use of the <a href="https://docs.rs/insta/latest/insta/">insta</a> library?</p>



<a name="475682335"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/snapshot%20tests/near/475682335" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/snapshot.20tests.html#475682335">(Oct 08 2024 at 22:03)</a>:</h4>
<p>Ah, actually it looks like we are already using it elsewhere... I'm going to give it a go</p>



<a name="475682767"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/snapshot%20tests/near/475682767" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/snapshot.20tests.html#475682767">(Oct 08 2024 at 22:05)</a>:</h4>
<p>sounds good to me! I've liked <code>insta</code> in the places we've used it <span aria-label="thumbs up" class="emoji emoji-1f44d" role="img" title="thumbs up">:thumbs_up:</span></p>



<a name="475684082"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/snapshot%20tests/near/475684082" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/snapshot.20tests.html#475684082">(Oct 08 2024 at 22:12)</a>:</h4>
<p>I think it's going to dramatically simplify that test module too which is super nice</p>



<a name="526494031"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/snapshot%20tests/near/526494031" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/snapshot.20tests.html#526494031">(Jun 30 2025 at 22:14)</a>:</h4>
<p>Should the snapshots be getting checked for diffs in CI?</p>



<a name="526494071"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/snapshot%20tests/near/526494071" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/snapshot.20tests.html#526494071">(Jun 30 2025 at 22:15)</a>:</h4>
<p>It seems to be a common source of merge conflicts</p>



<a name="526494089"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/snapshot%20tests/near/526494089" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/snapshot.20tests.html#526494089">(Jun 30 2025 at 22:15)</a>:</h4>
<p>We should be checking these in the PR review</p>



<a name="526494161"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/snapshot%20tests/near/526494161" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Kiryl Dziamura <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/snapshot.20tests.html#526494161">(Jun 30 2025 at 22:16)</a>:</h4>
<p>aren't they already checked for diffs? or what do you mean?</p>



<a name="526494192"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/snapshot%20tests/near/526494192" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/snapshot.20tests.html#526494192">(Jun 30 2025 at 22:16)</a>:</h4>
<p>They are checked for any diffs in CI</p>



<a name="526494219"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/snapshot%20tests/near/526494219" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/snapshot.20tests.html#526494219">(Jun 30 2025 at 22:17)</a>:</h4>
<p>And they are also easy to get merge conflicts</p>



<a name="526494274"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/snapshot%20tests/near/526494274" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/snapshot.20tests.html#526494274">(Jun 30 2025 at 22:17)</a>:</h4>
<p>I'm not sure it's a big problem or anything... just fishing for ideas/opinions</p>



<a name="526495776"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/snapshot%20tests/near/526495776" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/snapshot.20tests.html#526495776">(Jun 30 2025 at 22:34)</a>:</h4>
<p>I actually would love to just give them a naming convention that's enforced, like "if the snapshot's name ends with <code>_err2</code> then it should report 2 errors , and similar with like <code>_warn2err5</code> etc." and we enforce that in ci</p>



<a name="526495873"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/snapshot%20tests/near/526495873" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/snapshot.20tests.html#526495873">(Jun 30 2025 at 22:35)</a>:</h4>
<p>basically so if you make a change that causes snapshots to change the number of errors or warnings being reported, that's a CI failure</p>



<a name="526495887"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/snapshot%20tests/near/526495887" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/snapshot.20tests.html#526495887">(Jun 30 2025 at 22:35)</a>:</h4>
<p>Do we want fuzz crashes and the like in snapshot tests?</p>



<a name="526496035"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/snapshot%20tests/near/526496035" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/snapshot.20tests.html#526496035">(Jun 30 2025 at 22:36)</a>:</h4>
<p>I'm wondering if we should be maintaining a smaller number of higher quality snapshots, as opposed to the shotgun we currently have</p>



<a name="526496428"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/snapshot%20tests/near/526496428" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/snapshot.20tests.html#526496428">(Jun 30 2025 at 22:40)</a>:</h4>
<p><span class="user-mention silent" data-user-id="281383">Richard Feldman</span> <a href="#narrow/channel/395097-compiler-development/topic/snapshot.20tests/near/526495776">said</a>:</p>
<blockquote>
<p>I actually would love to just give them a naming convention that's enforced, like "if the snapshot's name ends with <code>_err2</code> then it should report 2 errors , and similar with like <code>_warn2err5</code> etc." and we enforce that in ci</p>
</blockquote>
<p>I'm thinking of taking this idea a little further... adding "tags" or similar flags we can use in the <code>META</code> section to express the intent for the snapshot.</p>



<a name="526496971"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/snapshot%20tests/near/526496971" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/snapshot.20tests.html#526496971">(Jun 30 2025 at 22:46)</a>:</h4>
<p>One issue I know I want to fix is we print the Idx for patterns and type vars etc... except this isnt stable. If we change the number of nodes etc we get a really noisy diff. </p>
<p>I want to change the s-expressions to use Regions I think as the unifying thing as that is stable. So the type vars etc still use idx's under the hood but when displaying they lookup the region for the referenced node and use that.</p>



<a name="526500454"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/snapshot%20tests/near/526500454" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/snapshot.20tests.html#526500454">(Jun 30 2025 at 23:27)</a>:</h4>
<p>I think those will still change quite a bit when the node structure changes</p>



<a name="526500836"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/snapshot%20tests/near/526500836" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/snapshot.20tests.html#526500836">(Jun 30 2025 at 23:32)</a>:</h4>
<p>Maybe I didn't explain it very well. I've made the change and I think it looks much nicer.</p>
<h1>SOURCE</h1>
<div class="codehilite" data-code-language="roc"><pre><span></span><code>module [foo]

foo : Str
foo = "one"
</code></pre></div>
<h1>CANONICALIZE</h1>
<div class="codehilite" data-code-language="Clojure"><pre><span></span><code><span class="p">(</span><span class="nf">can-ir</span>
<span class="w">    </span><span class="p">(</span><span class="nf">d-let</span>
<span class="w">        </span><span class="p">(</span><span class="nf">p-assign</span><span class="w"> </span><span class="o">@</span><span class="mf">4.1-4.4</span><span class="w"> </span><span class="p">(</span><span class="nf">ident</span><span class="w"> </span><span class="s">"foo"</span><span class="p">))</span>
<span class="w">        </span><span class="p">(</span><span class="nf">e-string</span><span class="w"> </span><span class="o">@</span><span class="mf">4.7-4.12</span>
<span class="w">            </span><span class="p">(</span><span class="nf">e-literal</span><span class="w"> </span><span class="o">@</span><span class="mf">4.8-4.11</span><span class="w"> </span><span class="p">(</span><span class="nf">string</span><span class="w"> </span><span class="s">"one"</span><span class="p">)))</span>
<span class="w">        </span><span class="p">(</span><span class="nf">annotation</span><span class="w"> </span><span class="o">@</span><span class="mf">4.1-4.4</span>
<span class="w">            </span><span class="p">(</span><span class="nf">declared-type</span>
<span class="w">                </span><span class="p">(</span><span class="nf">ty</span><span class="w"> </span><span class="o">@</span><span class="mf">3.7-3.10</span><span class="w"> </span><span class="p">(</span><span class="nb">name </span><span class="s">"Str"</span><span class="p">))))))</span>
</code></pre></div>
<h1>TYPES</h1>
<div class="codehilite" data-code-language="Clojure"><pre><span></span><code><span class="p">(</span><span class="nf">inferred-types</span>
<span class="w">    </span><span class="p">(</span><span class="nf">defs</span>
<span class="w">        </span><span class="p">(</span><span class="nf">d-assign</span><span class="w"> </span><span class="o">@</span><span class="mf">4.1-4.4</span><span class="w"> </span><span class="p">(</span><span class="nf">type</span><span class="w"> </span><span class="s">"Str"</span><span class="p">)))</span>
<span class="w">    </span><span class="p">(</span><span class="nf">expressions</span>
<span class="w">        </span><span class="p">(</span><span class="nf">expr</span><span class="w"> </span><span class="o">@</span><span class="mf">4.7-4.12</span><span class="w"> </span><span class="p">(</span><span class="nf">type</span><span class="w"> </span><span class="s">"Str"</span><span class="p">))))</span>
</code></pre></div>



<a name="526500945"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/snapshot%20tests/near/526500945" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/snapshot.20tests.html#526500945">(Jun 30 2025 at 23:33)</a>:</h4>
<p>Now we don't have any node id's. I think this will reduce the noise a lot.</p>



<a name="526501599"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/snapshot%20tests/near/526501599" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/snapshot.20tests.html#526501599">(Jun 30 2025 at 23:42)</a>:</h4>
<p><span class="user-mention" data-user-id="341568">@Jared Ramirez</span> in the TYPES section above, would <code>d-assign</code> be clearer as <code>pattern</code>?</p>



<a name="526501625"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/snapshot%20tests/near/526501625" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/snapshot.20tests.html#526501625">(Jun 30 2025 at 23:42)</a>:</h4>
<p>Or even <code>patt</code></p>



<a name="526501693"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/snapshot%20tests/near/526501693" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jared Ramirez <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/snapshot.20tests.html#526501693">(Jun 30 2025 at 23:43)</a>:</h4>
<p>Imo pattern of or d-pat is clearer</p>



<a name="526501759"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/snapshot%20tests/near/526501759" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/snapshot.20tests.html#526501759">(Jun 30 2025 at 23:44)</a>:</h4>
<p>I like <code>patt</code> it's the same length as <code>expr</code> so everything lines up.</p>



<a name="526501789"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/snapshot%20tests/near/526501789" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jared Ramirez <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/snapshot.20tests.html#526501789">(Jun 30 2025 at 23:45)</a>:</h4>
<p>I also have a todo in there for this: sometimes it's nice to print out the type var IDs and the entire type store when debugging. This definitely should not be committed but it would be cool if there was a way to easily enable that with a flag.</p>



<a name="526501794"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/snapshot%20tests/near/526501794" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/snapshot.20tests.html#526501794">(Jun 30 2025 at 23:45)</a>:</h4>
<p><code>d-pat</code> would be similar, but we already have <code>defs</code> as the parent, so maybe we don't need the <code>d-</code> prefix</p>



<a name="526501859"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/snapshot%20tests/near/526501859" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/snapshot.20tests.html#526501859">(Jun 30 2025 at 23:45)</a>:</h4>
<p>Should be trivial to add a flag to debug print the type store. We have <code>--verbose</code> on the snapshot tool already.</p>



<a name="526501889"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/snapshot%20tests/near/526501889" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jared Ramirez <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/snapshot.20tests.html#526501889">(Jun 30 2025 at 23:46)</a>:</h4>
<p>ptrn? patt is fine tho</p>



<a name="526502001"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/snapshot%20tests/near/526502001" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/snapshot.20tests.html#526502001">(Jun 30 2025 at 23:47)</a>:</h4>
<p>Also what do you think of flattening it out and removing the <code>type</code> as well?</p>



<a name="526502021"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/snapshot%20tests/near/526502021" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/snapshot.20tests.html#526502021">(Jun 30 2025 at 23:48)</a>:</h4>
<div class="codehilite" data-code-language="Clojure"><pre><span></span><code><span class="p">(</span><span class="nf">inferred-types</span>
<span class="w">    </span><span class="p">(</span><span class="nf">defs</span>
<span class="w">        </span><span class="p">(</span><span class="nf">d-assign</span><span class="w"> </span><span class="o">@</span><span class="mf">4.1-4.4</span><span class="w"> </span><span class="s">"Str"</span><span class="p">))</span>
<span class="w">    </span><span class="p">(</span><span class="nf">expressions</span>
<span class="w">        </span><span class="p">(</span><span class="nf">expr</span><span class="w"> </span><span class="o">@</span><span class="mf">4.7-4.12</span><span class="w"> </span><span class="s">"Str"</span><span class="p">)))</span>
</code></pre></div>



<a name="526502255"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/snapshot%20tests/near/526502255" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/snapshot.20tests.html#526502255">(Jun 30 2025 at 23:51)</a>:</h4>
<p>Nvm I remembered we are using the parens for attributes, only region info is displayed without enclosing  parens because it's so obvious.</p>



<a name="526502629"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/snapshot%20tests/near/526502629" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/snapshot.20tests.html#526502629">(Jun 30 2025 at 23:56)</a>:</h4>
<p><span class="user-mention" data-user-id="453336">@Joshua Warner</span> this should also make the side-by-side HTML version your working on much easier I think.</p>



<a name="526504208"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/snapshot%20tests/near/526504208" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/snapshot.20tests.html#526504208">(Jul 01 2025 at 00:13)</a>:</h4>
<p>And it's magical... we're back to diffs in PR's that are related to the changes <span aria-label="clap" class="emoji emoji-1f44f" role="img" title="clap">:clap:</span> <span aria-label="smiley" class="emoji emoji-1f603" role="img" title="smiley">:smiley:</span></p>



<a name="526517229"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/snapshot%20tests/near/526517229" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/snapshot.20tests.html#526517229">(Jul 01 2025 at 03:19)</a>:</h4>
<p><span class="user-mention silent" data-user-id="515757">Luke Boswell</span> <a href="#narrow/stream/395097-compiler-development/topic/snapshot.20tests/near/526495887">said</a>:</p>
<blockquote>
<p>Do we want fuzz crashes and the like in snapshot tests?</p>
</blockquote>
<p>I think we definitely should keep them. They are minimal repros for bugs that were not caught elsewhere.</p>



<a name="526517319"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/snapshot%20tests/near/526517319" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/snapshot.20tests.html#526517319">(Jul 01 2025 at 03:20)</a>:</h4>
<p>Unless snapshot tests take too long (which I don't think should ever happen), we should keep as many as possible, especially small ones that reproduce issues we find</p>



<a name="526517381"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/snapshot%20tests/near/526517381" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/snapshot.20tests.html#526517381">(Jul 01 2025 at 03:21)</a>:</h4>
<p><span class="user-mention" data-user-id="343810">@Brendan Hansknecht</span> did you have any thoughts on my upper bound perf idea? I mentioned you in the snapshot summary PR</p>



<a name="526517398"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/snapshot%20tests/near/526517398" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/snapshot.20tests.html#526517398">(Jul 01 2025 at 03:21)</a>:</h4>
<p><span class="user-mention silent" data-user-id="515757">Luke Boswell</span> <a href="#narrow/stream/395097-compiler-development/topic/snapshot.20tests/near/526496428">said</a>:</p>
<blockquote>
<p><span class="user-mention silent" data-user-id="281383">Richard Feldman</span> <a href="#narrow/channel/395097-compiler-development/topic/snapshot.20tests/near/526495776">said</a>:</p>
<blockquote>
<p>I actually would love to just give them a naming convention that's enforced, like "if the snapshot's name ends with <code>_err2</code> then it should report 2 errors , and similar with like <code>_warn2err5</code> etc." and we enforce that in ci</p>
</blockquote>
<p>I'm thinking of taking this idea a little further... adding "tags" or similar flags we can use in the <code>META</code> section to express the intent for the snapshot.</p>
</blockquote>
<p>That's a good idea.</p>



<a name="526574305"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/snapshot%20tests/near/526574305" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anton <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/snapshot.20tests.html#526574305">(Jul 01 2025 at 10:18)</a>:</h4>
<p>Once the reference counting pass gets added to the snapshots, the exact position of the incs and decs is definitely important. <a href="https://github.com/roc-lang/roc/blob/main/crates/compiler/test_mono/generated/closure_in_list.txt">Example</a></p>



<a name="526631427"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/snapshot%20tests/near/526631427" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/snapshot.20tests.html#526631427">(Jul 01 2025 at 15:13)</a>:</h4>
<p>Yes, though those are maybe better tested with valgrind and running code.... That said, having both is totally reasonable</p>



<a name="527509063"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/snapshot%20tests/near/527509063" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anton <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/snapshot.20tests.html#527509063">(Jul 07 2025 at 15:50)</a>:</h4>
<p>Can you explain how the newly introduced (<a href="https://github.com/roc-lang/roc/issues/7949">#7949</a>) EXPECTED sections work in the snapshots <span class="user-mention" data-user-id="281383">@Richard Feldman</span>? I've been unable to make <code>zig build snapshot</code> fail by modifying the EXPECTED sections in .md snapshot files, which is unexpected :p</p>



<a name="527522668"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/snapshot%20tests/near/527522668" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/snapshot.20tests.html#527522668">(Jul 07 2025 at 17:08)</a>:</h4>
<p><code>zig build test</code> verifies them</p>



<a name="527522770"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/snapshot%20tests/near/527522770" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/snapshot.20tests.html#527522770">(Jul 07 2025 at 17:09)</a>:</h4>
<p><code>zig build snapshot</code> still just regenerates all the stuff under them; my thinking was that <code>zig build snapshot</code> should always succeed, and then <code>zig build test</code> is responsible for detecting and reporting failures</p>



<a name="527523561"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/snapshot%20tests/near/527523561" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anton <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/snapshot.20tests.html#527523561">(Jul 07 2025 at 17:14)</a>:</h4>
<p>Alright, sounds good</p>



<hr><p>Last updated: Nov 01 2025 at 12:13 UTC</p>
</html>