<html>
<head><meta charset="utf-8"><title>remove morphic? · compiler development · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/index.html">compiler development</a></h2>
<h3>Topic: <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/remove.20morphic.3F.html">remove morphic?</a></h3>

<hr>

<base href="https://roc.zulipchat.com">

<head><link href="https://roc-lang.github.io/zulip-export/style.css" rel="stylesheet"></head>

<a name="495624055"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/remove%20morphic%3F/near/495624055" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/remove.20morphic.3F.html#495624055">(Jan 24 2025 at 03:03)</a>:</h4>
<p>Yeah, thinks like morphic will remain slow for non allocation related reasons (though morphic also doesn't do arena allocation which maybe could help its perf a bit).</p>



<a name="495624108"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/remove%20morphic%3F/near/495624108" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/remove.20morphic.3F.html#495624108">(Jan 24 2025 at 03:04)</a>:</h4>
<p>Is morphic just alias analysis?</p>



<a name="495624315"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/remove%20morphic%3F/near/495624315" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/remove.20morphic.3F.html#495624315">(Jan 24 2025 at 03:06)</a>:</h4>
<p>I think morphic does analysis on uniqueness to enable inplace mutation without checking the refcount. It might also enable removing some refcount increments/decrements. That said, I don't think it currently works. I had to disable a chunk of its analysis due to causing bugs and it basically had no impact on perf for most benchmarks.</p>



<a name="495624340"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/remove%20morphic%3F/near/495624340" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/remove.20morphic.3F.html#495624340">(Jan 24 2025 at 03:06)</a>:</h4>
<p>Cool, that would allow us to remove a dependency <span aria-label="smile" class="emoji emoji-1f642" role="img" title="smile">:smile:</span></p>



<a name="495624369"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/remove%20morphic%3F/near/495624369" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/remove.20morphic.3F.html#495624369">(Jan 24 2025 at 03:07)</a>:</h4>
<p>Once Roc works consistently, we can re-enable it</p>



<a name="495624378"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/remove%20morphic%3F/near/495624378" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/remove.20morphic.3F.html#495624378">(Jan 24 2025 at 03:07)</a>:</h4>
<p>But we are definitely not there right now</p>



<a name="495624471"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/remove%20morphic%3F/near/495624471" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/remove.20morphic.3F.html#495624471">(Jan 24 2025 at 03:08)</a>:</h4>
<p>This is probably the biggest roc app I know of <a href="https://github.com/lukewilliamboswell/roc-htmx-tailwindcss-demo">https://github.com/lukewilliamboswell/roc-htmx-tailwindcss-demo</a></p>



<a name="495624610"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/remove%20morphic%3F/near/495624610" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/remove.20morphic.3F.html#495624610">(Jan 24 2025 at 03:10)</a>:</h4>
<p>I had one more advanced that this I was messing around with for a work project/prototype... I should probably back-port features from that into this demo.</p>



<a name="495624628"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/remove%20morphic%3F/near/495624628" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/remove.20morphic.3F.html#495624628">(Jan 24 2025 at 03:10)</a>:</h4>
<p>I think it would be great to double check with someone who understands what it is supposed to do better before just removing it.</p>
<p>To be fair, it may be the case they we aren't leaning on it enough. Potentially more zig biultins could be using it's inplace vs not indicator at comptime. On top of that, it may not show huge gains until hit in a hot loop where removing the refcounting completely could be huge....but I don't know enough about it to be sure.</p>
<p>From what I know of it currently, it is bugged, it really slows down compile time (all the worst compile times I have ever seen have been due to morphic), and it doesn't generally affect perf much.</p>
<p>So that does push towards removing it assuming we can't easily fix it and make it algorithmically sound.</p>
<p>EDIT: all that said, not trying to be mean to the morphic folks. It might be a great piece of tech we are holding wrong or that has some minor bugs that happen to lead to scary roc issues.</p>



<a name="495624653"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/remove%20morphic%3F/near/495624653" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/remove.20morphic.3F.html#495624653">(Jan 24 2025 at 03:10)</a>:</h4>
<p>If you did a <code>wc -l  **/*.roc</code>, what do you get?</p>



<a name="495624690"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/remove%20morphic%3F/near/495624690" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/remove.20morphic.3F.html#495624690">(Jan 24 2025 at 03:11)</a>:</h4>
<div class="codehilite"><pre><span></span><code>$ wc -l  **/*.roc
      49 src/Controllers/Product.roc
      50 src/Controllers/User.roc
     130 src/Helpers.roc
      14 src/Models/Product.roc
      16 src/Models/Session.roc
      12 src/Models/User.roc
      51 src/Sql/Product.roc
      67 src/Sql/Session.roc
      53 src/Sql/User.roc
      49 src/Views/Layout.roc
    3343 src/Views/Pages.roc
     234 src/main.roc
    4068 total
</code></pre></div>



<a name="495624738"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/remove%20morphic%3F/near/495624738" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/remove.20morphic.3F.html#495624738">(Jan 24 2025 at 03:11)</a>:</h4>
<p>Yeah, that's big-ish.  But I have Go lang apps that are 10k+ (and still compile in the low 100s of ms)</p>



<a name="495624790"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/remove%20morphic%3F/near/495624790" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/remove.20morphic.3F.html#495624790">(Jan 24 2025 at 03:12)</a>:</h4>
<p>My other one is <code>5908 total</code></p>



<a name="495624805"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/remove%20morphic%3F/near/495624805" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/remove.20morphic.3F.html#495624805">(Jan 24 2025 at 03:12)</a>:</h4>
<p>I don't know who understands Morphic...</p>



<a name="495624854"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/remove%20morphic%3F/near/495624854" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/remove.20morphic.3F.html#495624854">(Jan 24 2025 at 03:12)</a>:</h4>
<p>I'm assuming you haven't migrated this app</p>



<a name="495624873"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/remove%20morphic%3F/near/495624873" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/remove.20morphic.3F.html#495624873">(Jan 24 2025 at 03:13)</a>:</h4>
<p>I'd love to see a <code>time roc build</code> on it after you do</p>



<a name="495624874"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/remove%20morphic%3F/near/495624874" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/remove.20morphic.3F.html#495624874">(Jan 24 2025 at 03:13)</a>:</h4>
<p><span class="user-mention" data-user-id="334092">@William Brandon</span> I think is one of the morphic authors</p>



<a name="495624907"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/remove%20morphic%3F/near/495624907" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/remove.20morphic.3F.html#495624907">(Jan 24 2025 at 03:13)</a>:</h4>
<p>And I think <span class="user-mention" data-user-id="281543">@Folkert de Vries</span> had solid understanding of morphic at a high level at least.</p>



<a name="495625059"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/remove%20morphic%3F/near/495625059" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/remove.20morphic.3F.html#495625059">(Jan 24 2025 at 03:15)</a>:</h4>
<p>They also have a <a href="https://dl.acm.org/doi/10.1145/3591260">published paper</a> and <a href="https://www.youtube.com/watch?v=F3z39M0gdJU&amp;t=3540s">talk</a>, but I think it is mostly on lambasets and not on the smarter inplace mutation without checking refcounts.</p>
<div class="youtube-video message_inline_image"><a data-id="F3z39M0gdJU" href="https://www.youtube.com/watch?v=F3z39M0gdJU&amp;t=3540s"><img src="https://uploads.zulipusercontent.net/53e2c89e7810ddaa2c8af79c1add4c72035f97e8/68747470733a2f2f692e7974696d672e636f6d2f76692f46337a33394d3067644a552f64656661756c742e6a7067"></a></div>



<a name="495625113"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/remove%20morphic%3F/near/495625113" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/remove.20morphic.3F.html#495625113">(Jan 24 2025 at 03:15)</a>:</h4>
<p>With the new pipeline design, lambda sets won't exist at that part of the compiler</p>



<a name="495625148"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/remove%20morphic%3F/near/495625148" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/remove.20morphic.3F.html#495625148">(Jan 24 2025 at 03:16)</a>:</h4>
<p>Just concretely-typed first-order functions and values</p>



<a name="495625169"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/remove%20morphic%3F/near/495625169" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/remove.20morphic.3F.html#495625169">(Jan 24 2025 at 03:16)</a>:</h4>
<p>Given checking a refcount is 1 is generally pretty cheap, the inplace smarts may not really ever give us gains (except in really hot mutate in place loops maybe). As opposed to lambasets which hugely help llvm understand and optimize our code.</p>



<a name="495625189"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/remove%20morphic%3F/near/495625189" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/remove.20morphic.3F.html#495625189">(Jan 24 2025 at 03:16)</a>:</h4>
<p><span class="user-mention silent" data-user-id="461444">Sam Mohr</span> <a href="#narrow/channel/306878-off-topic/topic/Bootstrapping.20Roc.3F/near/495625148">said</a>:</p>
<blockquote>
<p>Just concretely-typed first-order functions and values</p>
</blockquote>
<p>So happy for this.</p>



<a name="495625213"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/remove%20morphic%3F/near/495625213" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/remove.20morphic.3F.html#495625213">(Jan 24 2025 at 03:16)</a>:</h4>
<p>It's more important than any other work we're doing in the next 6 months IMO</p>



<a name="495632643"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/remove%20morphic%3F/near/495632643" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Notification Bot <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/remove.20morphic.3F.html#495632643">(Jan 24 2025 at 04:43)</a>:</h4>
<p>24 messages were moved here from <a class="stream-topic" data-stream-id="306878" href="/#narrow/channel/306878-off-topic/topic/Bootstrapping.20Roc.3F">#off topic &gt; Bootstrapping Roc?</a> by <span class="user-mention silent" data-user-id="281383">Richard Feldman</span>.</p>



<a name="495632698"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/remove%20morphic%3F/near/495632698" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/remove.20morphic.3F.html#495632698">(Jan 24 2025 at 04:44)</a>:</h4>
<p>I like the idea of disabling (or even removing) Morphic before 0.1.0</p>



<a name="495632759"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/remove%20morphic%3F/near/495632759" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/remove.20morphic.3F.html#495632759">(Jan 24 2025 at 04:45)</a>:</h4>
<p>I think it is already set to trivial analysis due to bugs. So it does the same amount of work for both debug and release builds (which is pretty minimal)</p>



<a name="495632781"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/remove%20morphic%3F/near/495632781" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/remove.20morphic.3F.html#495632781">(Jan 24 2025 at 04:45)</a>:</h4>
<p>So it is kinda already disabled</p>



<a name="495632798"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/remove%20morphic%3F/near/495632798" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/remove.20morphic.3F.html#495632798">(Jan 24 2025 at 04:45)</a>:</h4>
<p>right, but even in that mode it's been a source of bugs, right?</p>



<a name="495632840"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/remove%20morphic%3F/near/495632840" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/remove.20morphic.3F.html#495632840">(Jan 24 2025 at 04:45)</a>:</h4>
<p>Not to my knowledge, but I'm not sure</p>



<a name="495632895"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/remove%20morphic%3F/near/495632895" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/remove.20morphic.3F.html#495632895">(Jan 24 2025 at 04:46)</a>:</h4>
<p>hm, I could be misremembering then</p>



<a name="495632919"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/remove%20morphic%3F/near/495632919" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/remove.20morphic.3F.html#495632919">(Jan 24 2025 at 04:46)</a>:</h4>
<p>This is all the context I have:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="w">        </span><span class="c1">// TODO(#7367): Change this back to `morphic_lib::solve`.</span>
<span class="w">        </span><span class="c1">// For now, using solve_trivial to avoid bug with loops.</span>
<span class="w">        </span><span class="c1">// Note: when disabling this, there was not much of a change in performance.</span>
<span class="w">        </span><span class="c1">// Notably, NQueens was about 5% slower. False interpreter was 0-5% faster (depending on input).</span>
<span class="w">        </span><span class="c1">// cFold and derive saw minor gains ~1.5%. rBTreeCk saw a big gain of ~4%.</span>
<span class="w">        </span><span class="c1">// This feels wrong, morphic should not really be able to slow down code.</span>
<span class="w">        </span><span class="c1">// Likely, noise or the bug and wrong inplace mutation lead to these perf changes.</span>
<span class="w">        </span><span class="c1">// When re-enabling this, we should analysis the perf and inplace mutations of a few apps.</span>
<span class="w">        </span><span class="c1">// It might be the case that our current benchmarks just aren't affected by morphic much.</span>
</code></pre></div>



<a name="495632943"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/remove%20morphic%3F/near/495632943" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/remove.20morphic.3F.html#495632943">(Jan 24 2025 at 04:47)</a>:</h4>
<p>gotcha</p>



<a name="495632973"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/remove%20morphic%3F/near/495632973" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/remove.20morphic.3F.html#495632973">(Jan 24 2025 at 04:47)</a>:</h4>
<p>I don't know of any bugs since we changed it to solve_trivial</p>



<a name="495632979"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/remove%20morphic%3F/near/495632979" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/remove.20morphic.3F.html#495632979">(Jan 24 2025 at 04:47)</a>:</h4>
<p>I forget, does it operate on traits?</p>



<a name="495632987"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/remove%20morphic%3F/near/495632987" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/remove.20morphic.3F.html#495632987">(Jan 24 2025 at 04:47)</a>:</h4>
<p>or do we actually build an IR for it</p>



<a name="495632996"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/remove%20morphic%3F/near/495632996" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/remove.20morphic.3F.html#495632996">(Jan 24 2025 at 04:47)</a>:</h4>
<p>build an ir for it</p>



<a name="495633061"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/remove%20morphic%3F/near/495633061" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/remove.20morphic.3F.html#495633061">(Jan 24 2025 at 04:48)</a>:</h4>
<p>and that happens after specialization, so that's definitely a compiler perf downside <span aria-label="sweat smile" class="emoji emoji-1f605" role="img" title="sweat smile">:sweat_smile:</span></p>



<a name="495633067"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/remove%20morphic%3F/near/495633067" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/remove.20morphic.3F.html#495633067">(Jan 24 2025 at 04:48)</a>:</h4>
<p>but yeah maybe it's not urgent to actually skip that work</p>



<a name="495633072"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/remove%20morphic%3F/near/495633072" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/remove.20morphic.3F.html#495633072">(Jan 24 2025 at 04:48)</a>:</h4>
<p>if there aren't bugs in the trivial solver</p>



<a name="495633213"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/remove%20morphic%3F/near/495633213" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/remove.20morphic.3F.html#495633213">(Jan 24 2025 at 04:50)</a>:</h4>
<p>Given we haven't noticed any measurable perf gains from the alias analysis, I am for just ripping it out. Might be worth trying to figure out a worst case example first just to see if it every makes a meaningful difference.</p>



<a name="495633366"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/remove%20morphic%3F/near/495633366" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/remove.20morphic.3F.html#495633366">(Jan 24 2025 at 04:52)</a>:</h4>
<p>Theoretically, that would be some sort of hot loop with inplace updates. One version where morphic leads to inplace mutation without checking the refcount and one that just checks the refcount. Maybe I can just recursively loop a list calling <code>List.set</code>?</p>
<p>Even without morphic, I can probably force the inplace flag just to make sure it is getting set ignoring any potential morphic bugs.</p>



<a name="495633480"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/remove%20morphic%3F/near/495633480" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/remove.20morphic.3F.html#495633480">(Jan 24 2025 at 04:53)</a>:</h4>
<p>the thing is, I just don't think we're in a position to make it reliable anytime soon</p>



<a name="495633526"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/remove%20morphic%3F/near/495633526" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/remove.20morphic.3F.html#495633526">(Jan 24 2025 at 04:53)</a>:</h4>
<p>Yeah, but if it could lead to large gains, may be worth just leaving it wired up in trivial mode. If not, probably worth ripping out.</p>



<a name="495633636"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/remove%20morphic%3F/near/495633636" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/remove.20morphic.3F.html#495633636">(Jan 24 2025 at 04:54)</a>:</h4>
<p>I'm just not sure it's worth the dependency, the extra IR generation, the concerns about bugs, the build time, etc.</p>



<a name="495633648"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/remove%20morphic%3F/near/495633648" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/remove.20morphic.3F.html#495633648">(Jan 24 2025 at 04:54)</a>:</h4>
<p>to be able to experiment with it cheaply</p>



<a name="495633678"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/remove%20morphic%3F/near/495633678" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/remove.20morphic.3F.html#495633678">(Jan 24 2025 at 04:55)</a>:</h4>
<p>because in my mind, the real question is "can we someday have a version of it that runs reliably and quickly?"</p>



<a name="495633700"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/remove%20morphic%3F/near/495633700" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/remove.20morphic.3F.html#495633700">(Jan 24 2025 at 04:55)</a>:</h4>
<p>if we can, then sure we might as well enable that because we already know we're set up for it</p>



<a name="495633768"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/remove%20morphic%3F/near/495633768" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/remove.20morphic.3F.html#495633768">(Jan 24 2025 at 04:56)</a>:</h4>
<p>but that version of it has to exist first, and right now that is a completely hypothetical future thing <span aria-label="sweat smile" class="emoji emoji-1f605" role="img" title="sweat smile">:sweat_smile:</span></p>



<a name="495633808"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/remove%20morphic%3F/near/495633808" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/remove.20morphic.3F.html#495633808">(Jan 24 2025 at 04:56)</a>:</h4>
<p>because the original authors haven't touched it in years, and none of us know how it works well enough to fix or rewrite it</p>



<a name="495633869"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/remove%20morphic%3F/near/495633869" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/remove.20morphic.3F.html#495633869">(Jan 24 2025 at 04:57)</a>:</h4>
<p>so it's not like even if we were able to experimentally confirm that it was really great in some scenario, that we'd want to enable it in the compiler in general - because we know it'd just start causing bugs again</p>



<a name="495633900"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/remove%20morphic%3F/near/495633900" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/remove.20morphic.3F.html#495633900">(Jan 24 2025 at 04:57)</a>:</h4>
<p>in other words, knowing that it has big benefits isn't actionable for us until we have a version that we can actually use long-term</p>



<a name="495633994"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/remove%20morphic%3F/near/495633994" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/remove.20morphic.3F.html#495633994">(Jan 24 2025 at 04:58)</a>:</h4>
<p>so being able to experiment on it is almost closer to a curiosity - like "hey, cool, someday a hypothetical future version of Morphic that we could use for real will get some benefits in this one scenario!"</p>



<a name="495634124"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/remove%20morphic%3F/near/495634124" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/remove.20morphic.3F.html#495634124">(Jan 24 2025 at 05:00)</a>:</h4>
<p>I guess if we started discovering some really big benefits it might be motivating to try to learn how it works in order to build out a real version, but that also seems like a very hypothetical scenario right now haha</p>



<a name="495634364"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/remove%20morphic%3F/near/495634364" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/remove.20morphic.3F.html#495634364">(Jan 24 2025 at 05:01)</a>:</h4>
<p>Lambdasets are also from morphic, but we definitely want to keep those despite not 100% being sure we can make the compile in a reasonable about of time. Only recently with some of Ayaz's work did we feel we could compile them without bugs after a rewrite. I don't see how the rest of morphic is any different (assuming it can show similar perf gains)</p>



<a name="495634610"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/remove%20morphic%3F/near/495634610" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/remove.20morphic.3F.html#495634610">(Jan 24 2025 at 05:02)</a>:</h4>
<p>oh for sure</p>



<a name="495634632"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/remove%20morphic%3F/near/495634632" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/remove.20morphic.3F.html#495634632">(Jan 24 2025 at 05:02)</a>:</h4>
<p>I mean the Morphic solver specifically</p>



<a name="495634670"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/remove%20morphic%3F/near/495634670" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/remove.20morphic.3F.html#495634670">(Jan 24 2025 at 05:03)</a>:</h4>
<p>the difference is that we actually understand how to do lambda sets</p>



<a name="495634674"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/remove%20morphic%3F/near/495634674" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/remove.20morphic.3F.html#495634674">(Jan 24 2025 at 05:03)</a>:</h4>
<p>and we don't understand the rest of the solver</p>



<a name="495634829"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/remove%20morphic%3F/near/495634829" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/remove.20morphic.3F.html#495634829">(Jan 24 2025 at 05:04)</a>:</h4>
<p>so we have problems but no way to fix them, and also no way in sight for getting to a point where we can fix them</p>



<a name="495634875"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/remove%20morphic%3F/near/495634875" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/remove.20morphic.3F.html#495634875">(Jan 24 2025 at 05:05)</a>:</h4>
<p>(and also a payoff of unclear magnitude for what would definitely be a big project no matter what)</p>



<a name="495634900"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/remove%20morphic%3F/near/495634900" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/remove.20morphic.3F.html#495634900">(Jan 24 2025 at 05:05)</a>:</h4>
<p>(big project being getting it to run fast and without bugs)</p>



<a name="495635053"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/remove%20morphic%3F/near/495635053" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ayaz Hafiz <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/remove.20morphic.3F.html#495635053">(Jan 24 2025 at 05:06)</a>:</h4>
<p>morphic and lambda sets are two different things</p>



<a name="495635066"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/remove%20morphic%3F/near/495635066" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ayaz Hafiz <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/remove.20morphic.3F.html#495635066">(Jan 24 2025 at 05:06)</a>:</h4>
<p>morphic is about specializing borrows</p>



<a name="495635070"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/remove%20morphic%3F/near/495635070" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/remove.20morphic.3F.html#495635070">(Jan 24 2025 at 05:06)</a>:</h4>
<p>I'm not saying we should never revisit it or anything—there's a paper and a reference implementation, so it's certainly possible that we could figure out how it works someday—just that I think if we didn't have it in the compiler right now, I don't think we'd add it</p>



<a name="495635103"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/remove%20morphic%3F/near/495635103" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ayaz Hafiz <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/remove.20morphic.3F.html#495635103">(Jan 24 2025 at 05:07)</a>:</h4>
<p>lambda sets are about specializing indirect jumps</p>



<a name="495635130"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/remove%20morphic%3F/near/495635130" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/remove.20morphic.3F.html#495635130">(Jan 24 2025 at 05:07)</a>:</h4>
<p>that's a cool way of putting it! <span aria-label="smiley" class="emoji emoji-1f603" role="img" title="smiley">:smiley:</span></p>



<a name="495635231"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/remove%20morphic%3F/near/495635231" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/remove.20morphic.3F.html#495635231">(Jan 24 2025 at 05:08)</a>:</h4>
<p>I thought both came from the morphic research?</p>



<a name="495635250"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/remove%20morphic%3F/near/495635250" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ayaz Hafiz <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/remove.20morphic.3F.html#495635250">(Jan 24 2025 at 05:08)</a>:</h4>
<p>yes but the technologies are distinct</p>



<a name="495635262"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/remove%20morphic%3F/near/495635262" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ayaz Hafiz <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/remove.20morphic.3F.html#495635262">(Jan 24 2025 at 05:08)</a>:</h4>
<p>they implemented both in the language</p>



<a name="495635266"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/remove%20morphic%3F/near/495635266" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/remove.20morphic.3F.html#495635266">(Jan 24 2025 at 05:08)</a>:</h4>
<p>yes</p>



<a name="495635300"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/remove%20morphic%3F/near/495635300" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ayaz Hafiz <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/remove.20morphic.3F.html#495635300">(Jan 24 2025 at 05:09)</a>:</h4>
<p>the morphic pass in roc does nothing wrt lambda sets</p>



<a name="495635359"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/remove%20morphic%3F/near/495635359" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ayaz Hafiz <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/remove.20morphic.3F.html#495635359">(Jan 24 2025 at 05:09)</a>:</h4>
<p>it could but it doesn't</p>



<a name="495635435"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/remove%20morphic%3F/near/495635435" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/remove.20morphic.3F.html#495635435">(Jan 24 2025 at 05:10)</a>:</h4>
<p>Morphic does need all functions to be first-order, and lambda sets are a way to get that</p>



<a name="495635460"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/remove%20morphic%3F/near/495635460" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/remove.20morphic.3F.html#495635460">(Jan 24 2025 at 05:10)</a>:</h4>
<p>which I believe was what led the authors of Morphic to come up with the idea of lambda sets</p>



<a name="495635470"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/remove%20morphic%3F/near/495635470" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/remove.20morphic.3F.html#495635470">(Jan 24 2025 at 05:10)</a>:</h4>
<p>(which turned out to be valuable on their own to us)</p>



<a name="495635484"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/remove%20morphic%3F/near/495635484" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/remove.20morphic.3F.html#495635484">(Jan 24 2025 at 05:10)</a>:</h4>
<p>because of LLVM etc.</p>



<a name="495635530"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/remove%20morphic%3F/near/495635530" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ayaz Hafiz <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/remove.20morphic.3F.html#495635530">(Jan 24 2025 at 05:11)</a>:</h4>
<p>well, it doesn't need first order functions. it just guarantees full borrow specialization if you have first order functions</p>



<a name="495635591"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/remove%20morphic%3F/near/495635591" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ayaz Hafiz <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/remove.20morphic.3F.html#495635591">(Jan 24 2025 at 05:11)</a>:</h4>
<p>you can run morphic over programs with indirect jumps, that's not a problem</p>



<a name="495635644"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/remove%20morphic%3F/near/495635644" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ayaz Hafiz <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/remove.20morphic.3F.html#495635644">(Jan 24 2025 at 05:12)</a>:</h4>
<p>i would think of them as fully orthogonal</p>



<a name="495635749"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/remove%20morphic%3F/near/495635749" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/remove.20morphic.3F.html#495635749">(Jan 24 2025 at 05:13)</a>:</h4>
<p>cool</p>



<a name="495635783"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/remove%20morphic%3F/near/495635783" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/remove.20morphic.3F.html#495635783">(Jan 24 2025 at 05:13)</a>:</h4>
<p>Ayaz, what are your thoughts about keeping it in the code base in its current state?</p>



<a name="495635839"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/remove%20morphic%3F/near/495635839" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ayaz Hafiz <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/remove.20morphic.3F.html#495635839">(Jan 24 2025 at 05:14)</a>:</h4>
<p>i would remove it if it's possible</p>



<a name="495635842"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/remove%20morphic%3F/near/495635842" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ayaz Hafiz <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/remove.20morphic.3F.html#495635842">(Jan 24 2025 at 05:14)</a>:</h4>
<p>idk if stuff breaks</p>



<a name="495635851"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/remove%20morphic%3F/near/495635851" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ayaz Hafiz <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/remove.20morphic.3F.html#495635851">(Jan 24 2025 at 05:14)</a>:</h4>
<p>but you know my stance on simplification haha</p>



<a name="495635913"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/remove%20morphic%3F/near/495635913" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/remove.20morphic.3F.html#495635913">(Jan 24 2025 at 05:15)</a>:</h4>
<p>So this is a benchmark trying to trigger morphic. So this is probably about the best possible gain from morphic in general:</p>
<div class="codehilite"><pre><span></span><code>Benchmark 1: ./check-refcount
  Time (mean ± σ):      68.6 ms ±   0.3 ms    [User: 65.6 ms, System: 2.2 ms]
  Range (min … max):    67.9 ms …  69.6 ms    100 runs

Benchmark 2: ./no-check-refcount
  Time (mean ± σ):      21.9 ms ±   0.6 ms    [User: 19.0 ms, System: 2.2 ms]
  Range (min … max):    20.8 ms …  23.2 ms    100 runs

Summary
  ./no-check-refcount ran
    3.13 ± 0.08 times faster than ./check-refcount
</code></pre></div>
<p>So morphic can be a big win.</p>



<a name="495635956"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/remove%20morphic%3F/near/495635956" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/remove.20morphic.3F.html#495635956">(Jan 24 2025 at 05:15)</a>:</h4>
<p>Not sure what numbers could realistically come up in practice though.</p>



<a name="495636054"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/remove%20morphic%3F/near/495636054" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/remove.20morphic.3F.html#495636054">(Jan 24 2025 at 05:16)</a>:</h4>
<p>The above code is from a hot loop that only calls <code>List.set</code>. One version uses morphic to be statically inplace. The other is doing refcount checks for uniqueness.</p>



<a name="495636107"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/remove%20morphic%3F/near/495636107" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/remove.20morphic.3F.html#495636107">(Jan 24 2025 at 05:17)</a>:</h4>
<p>Not saying this makes morphic worth keeping, might be too slow or buggy in practice (or simply have no one to actually own and fix it up eventually).</p>



<a name="495636303"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/remove%20morphic%3F/near/495636303" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/remove.20morphic.3F.html#495636303">(Jan 24 2025 at 05:19)</a>:</h4>
<p>I always just worry that ripping something like this out will make it exceptionally unlike to ever be re-added. Leaving it (even in the trivial only state), may lead to us eventually looping back to it when the language has otherwise settled, fix it up, and see nice perf gains.</p>



<a name="495636447"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/remove%20morphic%3F/near/495636447" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/remove.20morphic.3F.html#495636447">(Jan 24 2025 at 05:21)</a>:</h4>
<p>But I'm a sucker for things that go fast... <span aria-label="shrug" class="emoji emoji-1f937" role="img" title="shrug">:shrug:</span></p>



<a name="495636502"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/remove%20morphic%3F/near/495636502" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ayaz Hafiz <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/remove.20morphic.3F.html#495636502">(Jan 24 2025 at 05:21)</a>:</h4>
<p>i think a helpful thing to think about would be what performance ceiling are you all comfortable for a 0.1 release</p>



<a name="495636578"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/remove%20morphic%3F/near/495636578" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ayaz Hafiz <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/remove.20morphic.3F.html#495636578">(Jan 24 2025 at 05:22)</a>:</h4>
<p>if it is a hard requirement that it is the fastest thing out there sans ref counting that is one thing</p>



<a name="495636619"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/remove%20morphic%3F/near/495636619" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ayaz Hafiz <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/remove.20morphic.3F.html#495636619">(Jan 24 2025 at 05:22)</a>:</h4>
<p>if it needs to be comparable to existing functional languages/python/other web server players/etc maybe a different story</p>



<a name="495636647"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/remove%20morphic%3F/near/495636647" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/remove.20morphic.3F.html#495636647">(Jan 24 2025 at 05:23)</a>:</h4>
<p>yeah I'm definitely comfortable with our current performance for 0.1</p>



<a name="495636659"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/remove%20morphic%3F/near/495636659" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ayaz Hafiz <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/remove.20morphic.3F.html#495636659">(Jan 24 2025 at 05:23)</a>:</h4>
<p>and how important is performance relative to stability</p>



<a name="495636790"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/remove%20morphic%3F/near/495636790" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/remove.20morphic.3F.html#495636790">(Jan 24 2025 at 05:24)</a>:</h4>
<p>Part of the wierd reality that we live in is that ocaml exists and is reasonably performant yet essentially no one uses it. So perf likely isn't the big selling point to most people.</p>



<a name="495636807"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/remove%20morphic%3F/near/495636807" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/remove.20morphic.3F.html#495636807">(Jan 24 2025 at 05:24)</a>:</h4>
<p>I'm very not comfortable with our current stability other than the parser (thanks to its fuzzing giving a lot of confidence, and setting aside the fact that we know it's temporarily in a more volatile state at this exact moment than it had been for a long time prior)</p>



<a name="495636975"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/remove%20morphic%3F/near/495636975" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ayaz Hafiz <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/remove.20morphic.3F.html#495636975">(Jan 24 2025 at 05:26)</a>:</h4>
<p><span class="user-mention silent" data-user-id="343810">Brendan Hansknecht</span> <a href="#narrow/channel/395097-compiler-development/topic/remove.20morphic.3F/near/495636790">said</a>:</p>
<blockquote>
<p>Part of the wierd reality that we live in is that ocaml exists and is reasonably performant yet essentially no one uses it. So perf likely isn't the big selling point to most people.</p>
</blockquote>
<p>well, 10% of the equities market relies on ocaml ;)</p>



<a name="495637063"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/remove%20morphic%3F/near/495637063" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/remove.20morphic.3F.html#495637063">(Jan 24 2025 at 05:27)</a>:</h4>
<p>Another simple fact is that essentially no one who will use roc v0.1.0 will be using it for perf. They will be using it for the rest of roc with perf maybe being a nice afterthought.</p>
<p>So yeah, always compiling without crashes/segfaults, not having cffi bugs, having good errors almost all the time, having robust features will be much much more important for v0.1.0 and likely for many releases after that.</p>



<a name="495637195"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/remove%20morphic%3F/near/495637195" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/remove.20morphic.3F.html#495637195">(Jan 24 2025 at 05:28)</a>:</h4>
<p>I personally care a ton about perf, but I am the exception who would be using rust or c++ instead of roc. Most folks will come from the other side (js, python, maybe go or ocaml) instead of roc.</p>



<a name="495637207"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/remove%20morphic%3F/near/495637207" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/remove.20morphic.3F.html#495637207">(Jan 24 2025 at 05:28)</a>:</h4>
<p>I don't use Ocaml because it feels like a kitchen sink language. Most of the code I read for it is a different flavor than every other example I see. It's nice, but it's somewhat C++-y in that way. Not much experience, tho</p>



<a name="495637231"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/remove%20morphic%3F/near/495637231" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/remove.20morphic.3F.html#495637231">(Jan 24 2025 at 05:28)</a>:</h4>
<p>I also personally care a ton about Roc's performance <span aria-label="grinning face with smiling eyes" class="emoji emoji-1f601" role="img" title="grinning face with smiling eyes">:grinning_face_with_smiling_eyes:</span></p>



<a name="495637282"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/remove%20morphic%3F/near/495637282" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/remove.20morphic.3F.html#495637282">(Jan 24 2025 at 05:29)</a>:</h4>
<p>Aside how is ocamls perf in practice? Roughly in the same grouping as go?</p>



<a name="495637306"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/remove%20morphic%3F/near/495637306" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ayaz Hafiz <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/remove.20morphic.3F.html#495637306">(Jan 24 2025 at 05:29)</a>:</h4>
<p>yes ocaml is similar to go ime</p>



<a name="495637315"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/remove%20morphic%3F/near/495637315" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ayaz Hafiz <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/remove.20morphic.3F.html#495637315">(Jan 24 2025 at 05:29)</a>:</h4>
<p>compiler perf and runtime</p>



<a name="495637459"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/remove%20morphic%3F/near/495637459" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ayaz Hafiz <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/remove.20morphic.3F.html#495637459">(Jan 24 2025 at 05:31)</a>:</h4>
<p>i will also say ime performance doesn't really matter until you are at some scale. even then, most often performance is due to IO (can be solved separately), load (can be solved separately, horizontal or vertical scaling), or algorithmically (fix it, or if you need compute, easy hack is shell out). I love that Roc keeps in mind as a priority, but at the same time I have used many python webservers and CLI apps that were fine - and I'm sure Roc will be a better experience than that from day one</p>



<a name="495637727"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/remove%20morphic%3F/near/495637727" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/remove.20morphic.3F.html#495637727">(Jan 24 2025 at 05:34)</a>:</h4>
<p>Yeah, perf is normally more about how much you have to scale (so cost, but servers are cheap) rather than language implementation. That and saving energy/battery life (kinda the reverse of scale: phone, embedded).</p>



<a name="495637745"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/remove%20morphic%3F/near/495637745" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ayaz Hafiz <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/remove.20morphic.3F.html#495637745">(Jan 24 2025 at 05:34)</a>:</h4>
<p>embedded is a good point</p>



<a name="495637803"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/remove%20morphic%3F/near/495637803" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ayaz Hafiz <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/remove.20morphic.3F.html#495637803">(Jan 24 2025 at 05:35)</a>:</h4>
<p>i don't know the distribution of realtime constraints in embedded, but if you need hard realtime roc probably isn't the language</p>



<a name="495637893"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/remove%20morphic%3F/near/495637893" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/remove.20morphic.3F.html#495637893">(Jan 24 2025 at 05:36)</a>:</h4>
<p>Otherwise, it is mostly design rather than language (good io scheme, good algorithm).</p>
<p>Unless you need/want to be scrappy for some reason (like rewriting games from python to c++ so that they can simulate faster for alphazero implementation that can be trained on a single laptop). Most of the time perf is kinda optional, but nice to have a reasonable baseline for.</p>



<a name="495637965"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/remove%20morphic%3F/near/495637965" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/remove.20morphic.3F.html#495637965">(Jan 24 2025 at 05:37)</a>:</h4>
<blockquote>
<p>but if you need hard realtime roc probably isn't the language</p>
</blockquote>
<p>Yeah, though I guess you could theoretically make guarantees about timing due to refcounting instead of gc.</p>



<a name="495638013"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/remove%20morphic%3F/near/495638013" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/remove.20morphic.3F.html#495638013">(Jan 24 2025 at 05:37)</a>:</h4>
<p>That said, a lot of embedded is not true hard realtime. I mean a lot of embedded is running linux which even in real time mode really stretches the definition of real time.</p>



<a name="495638048"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/remove%20morphic%3F/near/495638048" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ayaz Hafiz <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/remove.20morphic.3F.html#495638048">(Jan 24 2025 at 05:38)</a>:</h4>
<p>fair</p>



<a name="495638242"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/remove%20morphic%3F/near/495638242" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/remove.20morphic.3F.html#495638242">(Jan 24 2025 at 05:40)</a>:</h4>
<p>As a note, morphic is still being maintained. So there is a chance we could get someone interested from their team to help us.</p>
<p>Otherwise, yeah, probably should just rip out morphic. We don't have any idea why it is broke (could litterally just be a silly mistake in the ir we generate) and even when it does work, the core algorithm can get way too slow to be worth running during a roc build.</p>



<a name="495639598"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/remove%20morphic%3F/near/495639598" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ayaz Hafiz <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/remove.20morphic.3F.html#495639598">(Jan 24 2025 at 05:54)</a>:</h4>
<p>there are definitely bugs in the ir generation</p>



<a name="495639609"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/remove%20morphic%3F/near/495639609" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ayaz Hafiz <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/remove.20morphic.3F.html#495639609">(Jan 24 2025 at 05:54)</a>:</h4>
<p>there is at least one i remember</p>



<a name="495821200"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/remove%20morphic%3F/near/495821200" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/remove.20morphic.3F.html#495821200">(Jan 25 2025 at 01:38)</a>:</h4>
<p>I am lightly looking into what it would take to remove this. I think it is only tangled into the llvm backend</p>



<a name="495821247"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/remove%20morphic%3F/near/495821247" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/remove.20morphic.3F.html#495821247">(Jan 25 2025 at 01:39)</a>:</h4>
<p>That said, due to generating lots of extra specializations, it is tangled in reasonably deep. So it won't be simple to remove. That said, I would expect most of it to just be pretty manual, not necessarily hard.</p>



<a name="495821337"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/remove%20morphic%3F/near/495821337" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/remove.20morphic.3F.html#495821337">(Jan 25 2025 at 01:40)</a>:</h4>
<p>I do think a solid amount of mapping exist that would be best to cleanup, but that will be harder to untangle than just removing morphic.</p>



<hr><p>Last updated: Mar 01 2026 at 12:20 UTC</p>
</html>