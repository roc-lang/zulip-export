<html>
<head><meta charset="utf-8"><title>.. vs _ · compiler development · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/index.html">compiler development</a></h2>
<h3>Topic: <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/.2E.2E.20vs.20_.html">.. vs _</a></h3>

<hr>

<base href="https://roc.zulipchat.com">

<head><link href="https://roc-lang.github.io/zulip-export/style.css" rel="stylesheet"></head>

<a name="573348570"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/..%20vs%20_/near/573348570" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anton <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/.2E.2E.20vs.20_.html#573348570">(Feb 11 2026 at 17:32)</a>:</h4>
<p>The unification of the error union is not the same here; the new <code>Try({}, [Exit(I32), ..])</code> behavior differs from the old <code>Result {} [Exit I32]_</code>. Do we currently have a way to achieve the old unification behavior? This is similar to the situation described in <a href="https://github.com/roc-lang/roc/issues/9010">#9010</a>.</p>



<a name="573359584"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/..%20vs%20_/near/573359584" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anton <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/.2E.2E.20vs.20_.html#573359584">(Feb 11 2026 at 18:25)</a>:</h4>
<p><span class="user-mention" data-user-id="341568">@Jared Ramirez</span></p>



<a name="573555553"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/..%20vs%20_/near/573555553" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jared Ramirez <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/.2E.2E.20vs.20_.html#573555553">(Feb 12 2026 at 15:44)</a>:</h4>
<p>can you provide a repro?</p>



<a name="574269170"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/..%20vs%20_/near/574269170" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anton <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/.2E.2E.20vs.20_.html#574269170">(Feb 17 2026 at 11:29)</a>:</h4>
<p>Here it is:</p>
<ul>
<li>new Roc:</li>
</ul>
<div class="codehilite"><pre><span></span><code>app [main!] { pf: platform &quot;./platform/main.roc&quot; }

import pf.Stdout

line : Str -&gt; Try({}, [EmptyStrErr])
line = |str| {
    if str.is_empty() {
        Err(EmptyStrErr)
    } else {
        Ok({})
    }
}

my_func : {} -&gt; Try({}, [Exit(I32), ..])
my_func = |_| {
    line(&quot;hey&quot;)?
    Err(Exit(1))
}

main! = || {
    match my_func({}) {
        Ok({}) =&gt; Stdout.line!(&quot;Ok&quot;)
        Err(_) =&gt; Stdout.line!(&quot;Err&quot;)
    }
}
</code></pre></div>
<p>output:</p>
<div class="codehilite"><pre><span></span><code>❯ ./zig-out/bin/roc test/fx/repro.roc
-- TYPE MISMATCH ---------------------------------

This ? may return early with a type that doesn&#39;t match the function body:
   ┌─ test/fx/repro.roc:16:5
   │
16 │     line(&quot;hey&quot;)?
   │     ^^^^^^^^^^^^

On error, this would return:

    Try({  }, [EmptyStrErr])

But the function body evaluates to:

    Try({  }, [Exit(I32), ..])

Hint: The error types from all ? operators and the function body must be compatible since any of them could be the actual return value.

Found 1 error(s) and 0 warning(s) for test/fx/repro.roc.
</code></pre></div>
<ul>
<li>old Roc:</li>
</ul>
<div class="codehilite"><pre><span></span><code>app [main!] { cli: platform &quot;https://github.com/roc-lang/basic-cli/releases/download/0.20.0/X73hGh05nNTkDHU06FHC0YfFaQB1pimX7gncRcao5mU.tar.br&quot; }

import cli.Stdout

line : Str -&gt; Result {} [EmptyStrErr]
line = |str|
    if Str.is_empty(str) then
        Err(EmptyStrErr)
    else
        Ok({})

my_func : {} -&gt; Result {} [Exit(I32)]_
my_func = |_|
    line(&quot;hey&quot;)?
    Err(Exit(1))

main! = |_args|
    when my_func({}) is
        Ok({}) -&gt; Stdout.line!(&quot;Ok&quot;)
        Err(_) -&gt; Stdout.line!(&quot;Err&quot;)
</code></pre></div>
<p>output:</p>
<div class="codehilite"><pre><span></span><code>❯ ./roc main.roc
Err
</code></pre></div>



<a name="574459206"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/..%20vs%20_/near/574459206" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anton <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/.2E.2E.20vs.20_.html#574459206">(Feb 18 2026 at 09:14)</a>:</h4>
<p>I would love to hear your (initial) thoughts on this <span class="user-mention" data-user-id="341568">@Jared Ramirez</span>, this is a blocker for the <a href="https://github.com/roc-lang/basic-cli/pull/413">new basic-cli</a>.</p>



<a name="574632034"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/..%20vs%20_/near/574632034" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jared Ramirez <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/.2E.2E.20vs.20_.html#574632034">(Feb 19 2026 at 01:11)</a>:</h4>
<p>Been pretty swamped at work and I have not had the time to look into this yet. Hopefully for Friday/this weekend I should be a little more free to take a look</p>



<a name="574771634"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/..%20vs%20_/near/574771634" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jared Ramirez <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/.2E.2E.20vs.20_.html#574771634">(Feb 19 2026 at 16:31)</a>:</h4>
<p>i believe the issue here is in the rust compiler, this type signature:</p>
<div class="codehilite"><pre><span></span><code>line : Str -&gt; Result {} [EmptyStrErr]
</code></pre></div>
<p>is silently upgraded to:</p>
<div class="codehilite"><pre><span></span><code>line : Str -&gt; Result {} [EmptyStrErr]_
</code></pre></div>
<p>which makes the <code>Err</code> payloads mergable when you call <code>line("hey")?</code>.</p>
<p>this is called "polarity", and it's not yet implemented in the new compiler. the good new for now though is that by this can be fixed by adding a <code>..</code> to the type definition of <code>line</code>:</p>
<div class="codehilite"><pre><span></span><code>line : Str -&gt; Try({}, [EmptyStrErr, ..])
</code></pre></div>
<p>this is semantically the same as what the rust compiler is doing, so it should unblock!</p>



<a name="574903223"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/..%20vs%20_/near/574903223" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anton <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/.2E.2E.20vs.20_.html#574903223">(Feb 20 2026 at 09:58)</a>:</h4>
<p>Amazing, thanks <span class="user-mention" data-user-id="341568">@Jared Ramirez</span> <span aria-label="heart" class="emoji emoji-2764" role="img" title="heart">:heart:</span></p>



<hr><p>Last updated: Mar 01 2026 at 12:20 UTC</p>
</html>