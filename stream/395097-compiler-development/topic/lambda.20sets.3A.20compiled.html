<html>
<head><meta charset="utf-8"><title>lambda sets: compiled · compiler development · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/index.html">compiler development</a></h2>
<h3>Topic: <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/lambda.20sets.3A.20compiled.html">lambda sets: compiled</a></h3>

<hr>

<base href="https://roc.zulipchat.com">

<head><link href="https://roc-lang.github.io/zulip-export/style.css" rel="stylesheet"></head>

<a name="462455100"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/lambda%20sets%3A%20compiled/near/462455100" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ayaz Hafiz <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/lambda.20sets.3A.20compiled.html#462455100">(Aug 15 2024 at 02:48)</a>:</h4>
<p>Alright I have a present for you all<br>
I built a compiler that properly compiles lambda sets. The key insight is making sure to solve the type of lambda captures, transitively</p>
<p><a href="https://ayazhafiz.com/plts/playground/cor/lss/?state=N4IglgdgDgrgLiAXCAxAAgBZzlAzogegIHMw4MYAjAOgGMB7AWwICd7aBaAGwEMJjW7AmFy4YAU1wEArABYAbLIA6EAPJQ0PNIjQBtFWkNoAynAAm9eABlI4k3BZoAFMAC%2BaDgD406zQEoAGgMjUzNIGwg7J1NHLx8NHkDgwwARekjNIIgAXRUVABUeXABrNHpS8RZHeg0dJ10fUvKAtABRKrRKx2yPbxq-XrKoPIhcMGI0MVpacXEzbTLSuMKSxbQAKg2VLnE4SZhp2fmAXjQlJXLB87h6ADlxAA89uJv7p%2BdVJuK-AG4fkbGEwAZjwwFwFl1BitSptIettrs0CCwWhTucunFrndHs9vK8cc52o4ur9-hAVIDNAB3UF7HTQxYARk6HRqgyc5WZyyKXwATCzqlABtzVuV%2BZCagi9jwaWRUWclEC2IwAEqSGBcXEKyLvLzJBUMCBwSASQZKphqsSa5znFjq616iBGZ1oHZ7SCRRynKkYcROu1W924fUuowAH0aaAAboMdXsoyHQ2gI0TOmbQeDxInDH6zNm0JB8x7KmhDcaIBI-Co-iMKeMytZbAsYlCeWg3BsPhp1lWIG6G3AInY0UpcOysW8taFLIOm2OnOcHoN8e8nJ80A8-Fua%2BTRvXwk36W2W5s193e-2DxkRyup%2BYr1FzmOXtjV%2BvcNuyXWJoxQU6j6sHanr4PZSmgv6QKi%2BoyrSzgzkOZwgAA6hgPBwAA5GOACeliOECYAsLgewQDwjDiAA-EoIC9kmNpKEucQwXKTgPjRtFGAuioEURtykXYjGynsHKNhkVEoWhmFoDhMCOLwRFoCRZGUdR%2Ba0ZxWGDExQmsap7GGJxclwLxZGDPBTZOAAfkRLAAPqGrQaGIQAEuIXBcPQiFItxRl8Z5VGukUPkmVRACEVFbhF1ZfhALAwE6EEQDZqEQGYOxeio6CGAAejluV5Tl%2Br9mypwJXRDHeGkGSbgWu6ZS6BVOkY-bJalw4KmymJKGAVxKFqPp%2BkMBbBhAdXOvlWX5hGoQPkigwtTszhAs4VkOHZ6QOXsVFEWE5IgMtZD0GOYARctPBmPM3WMgM0T3k6cBsaGU3mGZGRjktcTzVES1uNdFlnRdaBXc407wJMaD3ZNaCVXY5VQ%2BkMPg-qub6oWjWGJ9g0AAxtEaLBYQACvQkBwFFIABCAlA8LQxS5rgSC6KAlPU7mSDgCwZMgOIjBkKzUAsMTICuAEjNUzTKWs%2BIUY8FwHNczzyB8wLrjZK4QA">See this example</a> that solves a long-standing lambda set bug and enables effect interpreters in my compiler<br>
The issue it solves is <a href="https://github.com/roc-lang/roc/issues/5464">https://github.com/roc-lang/roc/issues/5464</a><br>
If you want to study the source code, which is quite small but many passes, it is here <a href="https://github.com/ayazhafiz/cor/tree/base/experiments/lss">https://github.com/ayazhafiz/cor/tree/base/experiments/lss</a></p>
<p>This is a proper monomorphizing compiler. I don't emit machine code or anything like that but the low-level IR pass is first-order and is trivial to compile to C or asm</p>



<a name="462455350"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/lambda%20sets%3A%20compiled/near/462455350" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/lambda.20sets.3A.20compiled.html#462455350">(Aug 15 2024 at 02:51)</a>:</h4>
<p>Holy shit</p>



<a name="462455368"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/lambda%20sets%3A%20compiled/near/462455368" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/lambda.20sets.3A.20compiled.html#462455368">(Aug 15 2024 at 02:51)</a>:</h4>
<p><span class="user-mention silent" data-user-id="461444">Sam Mohr</span> <a href="#narrow/stream/395097-compiler-development/topic/lambda.20sets.3A.20compiled/near/462455350">said</a>:</p>
<blockquote>
<p>Holy shit</p>
</blockquote>
<p>Well said</p>



<a name="462455369"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/lambda%20sets%3A%20compiled/near/462455369" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/lambda.20sets.3A.20compiled.html#462455369">(Aug 15 2024 at 02:51)</a>:</h4>
<p>Wait, so we don't need type erasure, do we??</p>



<a name="462455750"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/lambda%20sets%3A%20compiled/near/462455750" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/lambda.20sets.3A.20compiled.html#462455750">(Aug 15 2024 at 02:55)</a>:</h4>
<p>If that's the case, I'd be happy to help with the translation of this work to the Roc compiler! Super exciting</p>



<a name="462457469"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/lambda%20sets%3A%20compiled/near/462457469" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/lambda.20sets.3A.20compiled.html#462457469">(Aug 15 2024 at 03:12)</a>:</h4>
<p>Likewise, if there is anything we need on the platform side, like updating Brendan's POC I'm happy to help too.</p>



<a name="462539317"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/lambda%20sets%3A%20compiled/near/462539317" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/lambda.20sets.3A.20compiled.html#462539317">(Aug 15 2024 at 12:22)</a>:</h4>
<p>omg omg omg</p>



<a name="462539368"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/lambda%20sets%3A%20compiled/near/462539368" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/lambda.20sets.3A.20compiled.html#462539368">(Aug 15 2024 at 12:23)</a>:</h4>
<p>THIS IS THE BEST NEWS!!!!!!!</p>



<a name="462539958"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/lambda%20sets%3A%20compiled/near/462539958" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/lambda.20sets.3A.20compiled.html#462539958">(Aug 15 2024 at 12:24)</a>:</h4>
<p><span aria-label="star struck" class="emoji emoji-1f929" role="img" title="star struck">:star_struck:</span><span aria-label="star struck" class="emoji emoji-1f929" role="img" title="star struck">:star_struck:</span><span aria-label="star struck" class="emoji emoji-1f929" role="img" title="star struck">:star_struck:</span><span aria-label="star struck" class="emoji emoji-1f929" role="img" title="star struck">:star_struck:</span><span aria-label="star struck" class="emoji emoji-1f929" role="img" title="star struck">:star_struck:</span><span aria-label="star struck" class="emoji emoji-1f929" role="img" title="star struck">:star_struck:</span><span aria-label="star struck" class="emoji emoji-1f929" role="img" title="star struck">:star_struck:</span><span aria-label="star struck" class="emoji emoji-1f929" role="img" title="star struck">:star_struck:</span><span aria-label="star struck" class="emoji emoji-1f929" role="img" title="star struck">:star_struck:</span><span aria-label="star struck" class="emoji emoji-1f929" role="img" title="star struck">:star_struck:</span><span aria-label="star struck" class="emoji emoji-1f929" role="img" title="star struck">:star_struck:</span></p>



<a name="462648531"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/lambda%20sets%3A%20compiled/near/462648531" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/lambda.20sets.3A.20compiled.html#462648531">(Aug 15 2024 at 21:59)</a>:</h4>
<p>I can't wait for when this lands in Roc! Will unlock so much stuff!!!</p>



<a name="462648571"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/lambda%20sets%3A%20compiled/near/462648571" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/lambda.20sets.3A.20compiled.html#462648571">(Aug 15 2024 at 21:59)</a>:</h4>
<p>I can't wait for true async effect interpreters</p>



<a name="462648692"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/lambda%20sets%3A%20compiled/near/462648692" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/lambda.20sets.3A.20compiled.html#462648692">(Aug 15 2024 at 22:00)</a>:</h4>
<p>Also should unblocks some random complex  code like my sqlite improvements for basic-webserver and the better version of encode and decode.</p>



<a name="462656668"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/lambda%20sets%3A%20compiled/near/462656668" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/lambda.20sets.3A.20compiled.html#462656668">(Aug 15 2024 at 23:12)</a>:</h4>
<p>There's a nice long list of really awesome things this should enable. I'm so excited to hear this news. Thank you Ayaz for sharing <span aria-label="grinning face with smiling eyes" class="emoji emoji-1f601" role="img" title="grinning face with smiling eyes">:grinning_face_with_smiling_eyes:</span></p>



<a name="463089203"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/lambda%20sets%3A%20compiled/near/463089203" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ayaz Hafiz <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/lambda.20sets.3A.20compiled.html#463089203">(Aug 18 2024 at 03:23)</a>:</h4>
<p>I've also partially implemented type erasure, as needed for Map2 - <a href="https://ayazhafiz.com/plts/playground/cor/lss/?state=N4IglgdgDgrgLiAXCAsgQygJgARu47AbQB0Jtt0tthTzyAzAewCcBjAUwH00DgBfbAFoAfNgCizNAGd2AEwA0tOkzZcARrwEjxkmQqXkAthkwEJ0uUNHm9V3IrLY%2BpALqlSUsAHNsamGAAbWU5jLAI8bTU7AAoI0SjtVgBKO0ocVlIA9jhffyCQk2wAXmxiYjjS4gTRMvorJTTqA2wVDm4CMuY7AD92XXZ7Ztb1DuIu7V7%2B3wc6bFDTSoqy6pbsaO6YCD6LXBT1ze2ZXySZp1IAbnP3CE8fdgA3NACCsIpCirRM7OwHp5ecEplQz1RwAdwAFuwyMCwFIlAAfN5UQwARhBsyyOTwJVRADphtxqAJIM1Mb5inMUfiWG0ovxsCTHEYqfNcL4lFDZBcrhBSMxNnM0JA0UVSd9sdgUQAGBm8pnYMlRQEgVhoOBwkCysU5OqA4gADzsZQAnj0pHBmJxWIwIKqcuswHBGFJsPqUsRNR7sKbGRjvqEoH0KX5AsFWXgonVfXRfs9WQG%2BtyQPIQGo0KwANacqRIQigNOZzlIEABNCGNSyMs2xjJkDsQyO4tQZiQBB8eT59NZiCyYux2v1xvIZutkB8Fx8IA">Map2 example here</a></p>



<a name="471844576"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/lambda%20sets%3A%20compiled/near/471844576" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/lambda.20sets.3A.20compiled.html#471844576">(Sep 20 2024 at 22:33)</a>:</h4>
<p>quick note - I'm gonna take on the implementation of this!</p>



<a name="471860682"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/lambda%20sets%3A%20compiled/near/471860682" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/lambda.20sets.3A.20compiled.html#471860682">(Sep 21 2024 at 01:25)</a>:</h4>
<p>Infinitely excited <span aria-label="laughing" class="emoji emoji-1f606" role="img" title="laughing">:laughing:</span></p>



<a name="471870827"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/lambda%20sets%3A%20compiled/near/471870827" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Agus Zubiaga <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/lambda.20sets.3A.20compiled.html#471870827">(Sep 21 2024 at 02:56)</a>:</h4>
<p>Let’s gooo</p>



<a name="491131208"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/lambda%20sets%3A%20compiled/near/491131208" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ayaz Hafiz <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/lambda.20sets.3A.20compiled.html#491131208">(Dec 29 2024 at 00:24)</a>:</h4>
<p>I was going to implement part of this in the Roc codebase the past couple days but I figured it would probably be a better use of my time to describe the implementation in significant detail, so that it can be discussed and hopefully easy for anyone to contribute to.</p>
<p>Here's a doc with the compilation process in significant detail - it's the same code as I shared before, but this time well-annotated (<a href="https://github.com/roc-lang/rfcs/pull/5">PR</a>, <a href="https://github.com/roc-lang/rfcs/blob/ayaz/compile-with-lambda-sets/0102-compiling-lambda-sets.md">doc</a>). Please let comments/critiques/let me know where I'm using confusing language/what could be more clear/etc, I will address them.</p>
<p>I'll get to the remaining detailed sections on function lifting, function solving, and function specialization tonight and in the next few days.</p>
<p>Of note, I still think that switching to have all recursive types required to be nominal would make much of this simpler and more efficient in the long term. See <a href="https://github.com/roc-lang/rfcs/blob/ayaz/compile-with-lambda-sets/0102-compiling-lambda-sets.md">https://github.com/roc-lang/rfcs/blob/ayaz/compile-with-lambda-sets/0102-compiling-lambda-sets.md</a></p>



<hr><p>Last updated: Mar 01 2026 at 12:20 UTC</p>
</html>