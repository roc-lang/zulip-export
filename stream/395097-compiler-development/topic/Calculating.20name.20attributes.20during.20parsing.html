<html>
<head><meta charset="utf-8"><title>Calculating name attributes during parsing · compiler development · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/index.html">compiler development</a></h2>
<h3>Topic: <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/Calculating.20name.20attributes.20during.20parsing.html">Calculating name attributes during parsing</a></h3>

<hr>

<base href="https://roc.zulipchat.com">

<head><link href="https://roc-lang.github.io/zulip-export/style.css" rel="stylesheet"></head>

<a name="492980688"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/Calculating%20name%20attributes%20during%20parsing/near/492980688" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/Calculating.20name.20attributes.20during.20parsing.html#492980688">(Jan 10 2025 at 16:08)</a>:</h4>
<p>I've been working on efficiently calculating attributes for idents, including legal attributes like ! suffix, _ suffix, etc. as well as problems like double underscores. I think this information is useful throughout the rest of the compiler, so it feels appropriate to store these in a byte as bitflags and pass them around the parsing code that way. It would require slightly more space for every string we keep in the AST, but it would ensure we don't have to repeat parsing work for every single ident in the compiler.</p>
<p>Does anyone think this is a bad idea? I'm gonna try this out post implementing string interpolation, but will avoid that work if people think it's better to duplicate work rather than store more info in the AST</p>



<a name="492981001"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/Calculating%20name%20attributes%20during%20parsing/near/492981001" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/Calculating.20name.20attributes.20during.20parsing.html#492981001">(Jan 10 2025 at 16:10)</a>:</h4>
<p>The reason why this is tempting to me is because I'm trying to report all problems with an ident in a single message for every string we see in Roc</p>



<a name="492981317"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/Calculating%20name%20attributes%20during%20parsing/near/492981317" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/Calculating.20name.20attributes.20during.20parsing.html#492981317">(Jan 10 2025 at 16:12)</a>:</h4>
<p>And it seems like we calculate a lot of these attributes later during canonicalization, but we can actually just do it while chomping characters. That way, we don't have to worry about handling non-ASCII or whatever in calculating in <code>roc_can</code> because we know exactly what we parsed earlier.</p>



<a name="492981433"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/Calculating%20name%20attributes%20during%20parsing/near/492981433" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/Calculating.20name.20attributes.20during.20parsing.html#492981433">(Jan 10 2025 at 16:13)</a>:</h4>
<p>This aligns better with "always inform, never block"</p>



<a name="492981504"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/Calculating%20name%20attributes%20during%20parsing/near/492981504" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/Calculating.20name.20attributes.20during.20parsing.html#492981504">(Jan 10 2025 at 16:13)</a>:</h4>
<p>Currently, we give a runtime error if a function has two underscores. I think we should just parse it, give a warning, and run anyway</p>



<a name="492983014"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/Calculating%20name%20attributes%20during%20parsing/near/492983014" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ayaz Hafiz <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/Calculating.20name.20attributes.20during.20parsing.html#492983014">(Jan 10 2025 at 16:22)</a>:</h4>
<p>i don't have a preference for the specific mechanism but I think these should definitely be consolidated behind an API and the specific API implementation should be opaque to the caller. Ideally these are methods <code>is_effectful</code> etc on the ident or symbol itself. If that's not possible, they should be methods on whatever object manages the symbol.</p>



<a name="492983075"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/Calculating%20name%20attributes%20during%20parsing/near/492983075" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/Calculating.20name.20attributes.20during.20parsing.html#492983075">(Jan 10 2025 at 16:22)</a>:</h4>
<p>That's what I was thinking.</p>



<a name="492983234"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/Calculating%20name%20attributes%20during%20parsing/near/492983234" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/Calculating.20name.20attributes.20during.20parsing.html#492983234">(Jan 10 2025 at 16:23)</a>:</h4>
<p>After simultaneously parsing an ident and its attributes, we'd return a</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">struct</span><span class="w"> </span><span class="nc">Ident</span><span class="o">&lt;'</span><span class="na">a</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">text</span><span class="p">:</span><span class="w"> </span><span class="kp">&amp;</span><span class="o">'</span><span class="na">a</span><span class="w"> </span><span class="kt">str</span><span class="p">,</span>
<span class="w">    </span><span class="n">attributes</span><span class="p">:</span><span class="w"> </span><span class="kt">u8</span><span class="p">,</span>
<span class="w">    </span><span class="n">problems</span><span class="p">:</span><span class="w"> </span><span class="kt">u8</span><span class="p">,</span>
<span class="p">}</span>
</code></pre></div>



<a name="492983278"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/Calculating%20name%20attributes%20during%20parsing/near/492983278" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/Calculating.20name.20attributes.20during.20parsing.html#492983278">(Jan 10 2025 at 16:23)</a>:</h4>
<p>And you'd access those values via methods</p>



<a name="492983327"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/Calculating%20name%20attributes%20during%20parsing/near/492983327" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/Calculating.20name.20attributes.20during.20parsing.html#492983327">(Jan 10 2025 at 16:23)</a>:</h4>
<p>I've already written these methods for a post-parsing <code>IdentAttributes</code></p>



<a name="492983359"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/Calculating%20name%20attributes%20during%20parsing/near/492983359" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/Calculating.20name.20attributes.20during.20parsing.html#492983359">(Jan 10 2025 at 16:24)</a>:</h4>
<p>But I think they belong at parsing and later instead</p>



<a name="492983363"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/Calculating%20name%20attributes%20during%20parsing/near/492983363" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ayaz Hafiz <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/Calculating.20name.20attributes.20during.20parsing.html#492983363">(Jan 10 2025 at 16:24)</a>:</h4>
<p>seems fine. as long as the fields are always private and immutable</p>



<a name="492983424"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/Calculating%20name%20attributes%20during%20parsing/near/492983424" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/Calculating.20name.20attributes.20during.20parsing.html#492983424">(Jan 10 2025 at 16:24)</a>:</h4>
<p>Yep, sounds good</p>



<a name="493004446"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/Calculating%20name%20attributes%20during%20parsing/near/493004446" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/Calculating.20name.20attributes.20during.20parsing.html#493004446">(Jan 10 2025 at 18:31)</a>:</h4>
<p>what attributes specifically did you have in mind?</p>



<a name="493004460"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/Calculating%20name%20attributes%20during%20parsing/near/493004460" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/Calculating.20name.20attributes.20during.20parsing.html#493004460">(Jan 10 2025 at 18:31)</a>:</h4>
<p>(out of curiosity)</p>



<a name="493010954"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/Calculating%20name%20attributes%20during%20parsing/near/493010954" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/Calculating.20name.20attributes.20during.20parsing.html#493010954">(Jan 10 2025 at 19:15)</a>:</h4>
<p>These are the current valid flags I'm parsing:</p>
<ul>
<li>Is the first character uppercase?</li>
<li>Is there an exclam at the end?</li>
<li>Is there an underscore at the end?</li>
<li>Is there an underscore at the start?</li>
</ul>
<p>And these are the current ident errors, (though some may go away without needing to verify the ident parsed):</p>
<ul>
<li>Is it an empty ident?</li>
<li>Are there multiple underscores in a row?</li>
<li>Did they type <code>_!</code> at the end instead of <code>!_</code>?</li>
<li>Is there an exclam in the middle?</li>
<li>Are there any invalid chars, e.g. %, or ! a tag name?</li>
<li>Are there any uppercase letters in a lowercase ident?</li>
<li>Is there a number at the start? (we have a lot of fuzzer test cases with these parsed)</li>
</ul>
<p>My plan for these errors is to combine them into a single warning per ident with a list of errors to maximize info without clustering multiple warnings on the same ident</p>



<a name="493011022"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/Calculating%20name%20attributes%20during%20parsing/near/493011022" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/Calculating.20name.20attributes.20during.20parsing.html#493011022">(Jan 10 2025 at 19:15)</a>:</h4>
<p>For the flags, not all of them are needed the whole time. The uppercase thing isn't needed once we figure out if a thing is a tag/alias or a var/function/value/typevar</p>



<a name="493011365"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/Calculating%20name%20attributes%20during%20parsing/near/493011365" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/Calculating.20name.20attributes.20during.20parsing.html#493011365">(Jan 10 2025 at 19:18)</a>:</h4>
<p>Underscore at the start gets the ident ignored, but we probably still want to track the ident in case someone tries to run code that looks like</p>
<div class="codehilite" data-code-language="Elm"><pre><span></span><code><span class="nv">_val</span><span class="w"> </span><span class="nf">=</span><span class="w"> </span><span class="mi">123</span>
<span class="nv">do_something_else</span><span class="err">!</span><span class="p">()</span><span class="err">?</span>
<span class="nv">_val</span><span class="w"> </span><span class="nf">=</span><span class="w"> </span><span class="mi">456</span>
</code></pre></div>



<a name="493011477"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/Calculating%20name%20attributes%20during%20parsing/near/493011477" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/Calculating.20name.20attributes.20during.20parsing.html#493011477">(Jan 10 2025 at 19:18)</a>:</h4>
<p>The current technique that Agus is employing is using the first bit of the 32bit ident ID as a bitflag for whether the var is ! suffixed</p>



<a name="493011519"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/Calculating%20name%20attributes%20during%20parsing/near/493011519" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/Calculating.20name.20attributes.20during.20parsing.html#493011519">(Jan 10 2025 at 19:19)</a>:</h4>
<p>That gives us about 2 billion idents available instead of 4 billion per module</p>



<a name="493011550"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/Calculating%20name%20attributes%20during%20parsing/near/493011550" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/Calculating.20name.20attributes.20during.20parsing.html#493011550">(Jan 10 2025 at 19:19)</a>:</h4>
<p>Using 4 bits brings us down to a quarter of a billion</p>



<a name="493011670"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/Calculating%20name%20attributes%20during%20parsing/near/493011670" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/Calculating.20name.20attributes.20during.20parsing.html#493011670">(Jan 10 2025 at 19:20)</a>:</h4>
<p>We may not even need 4 bits, but if we use 4 bits that doesn't feel like much of a cost</p>



<a name="493012046"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/Calculating%20name%20attributes%20during%20parsing/near/493012046" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/Calculating.20name.20attributes.20during.20parsing.html#493012046">(Jan 10 2025 at 19:22)</a>:</h4>
<p>This change also means that we probably can get away with not storing string values during parsing. We can just store a 64-bit rolling hash for each string and check for equality based on that value.</p>



<a name="493012120"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/Calculating%20name%20attributes%20during%20parsing/near/493012120" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/Calculating.20name.20attributes.20during.20parsing.html#493012120">(Jan 10 2025 at 19:23)</a>:</h4>
<p>If you need the original string, you use the region of the string to get it back</p>



<a name="493012677"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/Calculating%20name%20attributes%20during%20parsing/near/493012677" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ayaz Hafiz <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/Calculating.20name.20attributes.20during.20parsing.html#493012677">(Jan 10 2025 at 19:27)</a>:</h4>
<p>the string is just a pointer right? so there should be no size difference</p>



<a name="493012739"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/Calculating%20name%20attributes%20during%20parsing/near/493012739" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/Calculating.20name.20attributes.20during.20parsing.html#493012739">(Jan 10 2025 at 19:27)</a>:</h4>
<p>If it's always a pointer, then yes</p>



<a name="493012796"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/Calculating%20name%20attributes%20during%20parsing/near/493012796" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/Calculating.20name.20attributes.20during.20parsing.html#493012796">(Jan 10 2025 at 19:27)</a>:</h4>
<p>But string equality checking in can right now is O(n)</p>



<a name="493012966"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/Calculating%20name%20attributes%20during%20parsing/near/493012966" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ayaz Hafiz <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/Calculating.20name.20attributes.20during.20parsing.html#493012966">(Jan 10 2025 at 19:28)</a>:</h4>
<p>yeah but the strings are small and that only matters before you turn the string into a symbol. it should be benchmarked but i would be a lot of money that is very low on the flamegraph</p>



<a name="493013016"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/Calculating%20name%20attributes%20during%20parsing/near/493013016" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/Calculating.20name.20attributes.20during.20parsing.html#493013016">(Jan 10 2025 at 19:29)</a>:</h4>
<p>Yeah, fair</p>



<a name="493013059"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/Calculating%20name%20attributes%20during%20parsing/near/493013059" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/Calculating.20name.20attributes.20during.20parsing.html#493013059">(Jan 10 2025 at 19:29)</a>:</h4>
<p>My thought is that we use a lot of <code>VecMap</code>s</p>



<a name="493013077"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/Calculating%20name%20attributes%20during%20parsing/near/493013077" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/Calculating.20name.20attributes.20during.20parsing.html#493013077">(Jan 10 2025 at 19:29)</a>:</h4>
<p>And that's because we want to avoid the cost of hashing</p>



<a name="493013109"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/Calculating%20name%20attributes%20during%20parsing/near/493013109" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ayaz Hafiz <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/Calculating.20name.20attributes.20during.20parsing.html#493013109">(Jan 10 2025 at 19:29)</a>:</h4>
<p>for small collections yes</p>



<a name="493013201"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/Calculating%20name%20attributes%20during%20parsing/near/493013201" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ayaz Hafiz <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/Calculating.20name.20attributes.20during.20parsing.html#493013201">(Jan 10 2025 at 19:30)</a>:</h4>
<p>debugability is probably more important than perf in the current implementation though</p>



<a name="493013209"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/Calculating%20name%20attributes%20during%20parsing/near/493013209" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/Calculating.20name.20attributes.20during.20parsing.html#493013209">(Jan 10 2025 at 19:30)</a>:</h4>
<p>But if strings are always hashed already, then you can use them as keys in a proper hashmap</p>



<a name="493013252"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/Calculating%20name%20attributes%20during%20parsing/near/493013252" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/Calculating.20name.20attributes.20during.20parsing.html#493013252">(Jan 10 2025 at 19:30)</a>:</h4>
<p>Okay, for now I'll keep strings as strings</p>



<a name="493013261"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/Calculating%20name%20attributes%20during%20parsing/near/493013261" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ayaz Hafiz <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/Calculating.20name.20attributes.20during.20parsing.html#493013261">(Jan 10 2025 at 19:30)</a>:</h4>
<p>you still have to deal with collisions right? or write your own string hasher</p>



<a name="493013352"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/Calculating%20name%20attributes%20during%20parsing/near/493013352" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/Calculating.20name.20attributes.20during.20parsing.html#493013352">(Jan 10 2025 at 19:31)</a>:</h4>
<p>You'd make your object a <code>Vec&lt;(string hash, Vec&lt;item&gt;)&gt;</code></p>



<a name="493013409"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/Calculating%20name%20attributes%20during%20parsing/near/493013409" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/Calculating.20name.20attributes.20during.20parsing.html#493013409">(Jan 10 2025 at 19:31)</a>:</h4>
<p>Write your own string hasher would just mean a rolling hash</p>



<a name="493013579"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/Calculating%20name%20attributes%20during%20parsing/near/493013579" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ayaz Hafiz <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/Calculating.20name.20attributes.20during.20parsing.html#493013579">(Jan 10 2025 at 19:32)</a>:</h4>
<p>you would have to do something to ensure there are no hash conflicts right?</p>



<a name="493013603"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/Calculating%20name%20attributes%20during%20parsing/near/493013603" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ayaz Hafiz <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/Calculating.20name.20attributes.20during.20parsing.html#493013603">(Jan 10 2025 at 19:33)</a>:</h4>
<p>at which point it's an interner b/c 1-to-1 mapping</p>



<a name="493013618"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/Calculating%20name%20attributes%20during%20parsing/near/493013618" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/Calculating.20name.20attributes.20during.20parsing.html#493013618">(Jan 10 2025 at 19:33)</a>:</h4>
<p>Yeah, true</p>



<a name="493013799"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/Calculating%20name%20attributes%20during%20parsing/near/493013799" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/Calculating.20name.20attributes.20during.20parsing.html#493013799">(Jan 10 2025 at 19:33)</a>:</h4>
<p><a href="https://github.com/roc-lang/roc/blob/a69a326161a49c19186b8bf07b50c625d3b95686/crates/compiler/collections/src/small_string_interner.rs#L185">https://github.com/roc-lang/roc/blob/a69a326161a49c19186b8bf07b50c625d3b95686/crates/compiler/collections/src/small_string_interner.rs#L185</a></p>



<a name="493013882"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/Calculating%20name%20attributes%20during%20parsing/near/493013882" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/Calculating.20name.20attributes.20during.20parsing.html#493013882">(Jan 10 2025 at 19:34)</a>:</h4>
<p>This is where we walk the entire string interner every time we look for a symbol that matches what we have in scope</p>



<a name="493013945"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/Calculating%20name%20attributes%20during%20parsing/near/493013945" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/Calculating.20name.20attributes.20during.20parsing.html#493013945">(Jan 10 2025 at 19:34)</a>:</h4>
<p>It'd be nice for the interner to get closer to O(1) than O(n) by hashing the strings for insert</p>



<a name="493014034"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/Calculating%20name%20attributes%20during%20parsing/near/493014034" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/Calculating.20name.20attributes.20during.20parsing.html#493014034">(Jan 10 2025 at 19:35)</a>:</h4>
<p>The way to avoid that is to have your string interners keys be the hashes of the strings, and the values be <code>Vec&lt;(&amp;'a str, other, data)&gt;</code></p>



<a name="493014163"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/Calculating%20name%20attributes%20during%20parsing/near/493014163" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/Calculating.20name.20attributes.20during.20parsing.html#493014163">(Jan 10 2025 at 19:36)</a>:</h4>
<p>I'll be improving this performance by maintaining a separate data structure in the can rewrite for tracking ident IDs in scope</p>



<a name="493014199"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/Calculating%20name%20attributes%20during%20parsing/near/493014199" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/Calculating.20name.20attributes.20during.20parsing.html#493014199">(Jan 10 2025 at 19:36)</a>:</h4>
<p>But I'm very conscious of the time we put into interning strings</p>



<a name="493014290"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/Calculating%20name%20attributes%20during%20parsing/near/493014290" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/Calculating.20name.20attributes.20during.20parsing.html#493014290">(Jan 10 2025 at 19:37)</a>:</h4>
<p>As you point out, this doesn't matter right now</p>



<a name="493014387"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/Calculating%20name%20attributes%20during%20parsing/near/493014387" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/Calculating.20name.20attributes.20during.20parsing.html#493014387">(Jan 10 2025 at 19:38)</a>:</h4>
<p>But O(n) searches of all idents interned so far every time we want to deduplicate ident IDs by string search seems pretty sus</p>



<a name="493014578"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/Calculating%20name%20attributes%20during%20parsing/near/493014578" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ayaz Hafiz <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/Calculating.20name.20attributes.20during.20parsing.html#493014578">(Jan 10 2025 at 19:39)</a>:</h4>
<p>the way i would do it is to keep a hash map instead. then look up by hash and check for any collisions. if there are no collisions insert</p>



<a name="493014749"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/Calculating%20name%20attributes%20during%20parsing/near/493014749" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ayaz Hafiz <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/Calculating.20name.20attributes.20during.20parsing.html#493014749">(Jan 10 2025 at 19:40)</a>:</h4>
<p>i wouldn't get too nerdsniped by this though. the really expensive parts are typechecking and monomorphization. everything else is kind of a drop in the bucket comparatively</p>



<a name="493014886"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/Calculating%20name%20attributes%20during%20parsing/near/493014886" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/Calculating.20name.20attributes.20during.20parsing.html#493014886">(Jan 10 2025 at 19:42)</a>:</h4>
<p>yeah and +1 on "correctness first"</p>



<a name="493014906"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/Calculating%20name%20attributes%20during%20parsing/near/493014906" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/Calculating.20name.20attributes.20during.20parsing.html#493014906">(Jan 10 2025 at 19:42)</a>:</h4>
<p>Ok. An aside: is just <code>mono</code> that expensive?</p>



<a name="493014908"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/Calculating%20name%20attributes%20during%20parsing/near/493014908" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/Calculating.20name.20attributes.20during.20parsing.html#493014908">(Jan 10 2025 at 19:42)</a>:</h4>
<p>like architecturally we want to be set up for caching</p>



<a name="493014945"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/Calculating%20name%20attributes%20during%20parsing/near/493014945" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/Calculating.20name.20attributes.20during.20parsing.html#493014945">(Jan 10 2025 at 19:42)</a>:</h4>
<p>but on the level of an individual data structure, we can optimize those later as desired</p>



<a name="493023035"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/Calculating%20name%20attributes%20during%20parsing/near/493023035" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ayaz Hafiz <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/Calculating.20name.20attributes.20during.20parsing.html#493023035">(Jan 10 2025 at 20:45)</a>:</h4>
<p>yes</p>



<a name="493023102"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/Calculating%20name%20attributes%20during%20parsing/near/493023102" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ayaz Hafiz <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/Calculating.20name.20attributes.20during.20parsing.html#493023102">(Jan 10 2025 at 20:46)</a>:</h4>
<p>the reason c++/rust style languages have slow compilers is because of specialization</p>



<a name="493023146"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/Calculating%20name%20attributes%20during%20parsing/near/493023146" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ayaz Hafiz <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/Calculating.20name.20attributes.20during.20parsing.html#493023146">(Jan 10 2025 at 20:46)</a>:</h4>
<p>specialization is the <a href="https://github.com/roc-lang/roc/issues/1">#1</a> cost in any compiler</p>



<a name="493023226"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/Calculating%20name%20attributes%20during%20parsing/near/493023226" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ayaz Hafiz <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/Calculating.20name.20attributes.20during.20parsing.html#493023226">(Jan 10 2025 at 20:47)</a>:</h4>
<p>everything else doesn't matter (comparatively). specialization forces a potentially-exponential growth in program size, and hence compute during compilation</p>



<a name="493023761"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/Calculating%20name%20attributes%20during%20parsing/near/493023761" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/Calculating.20name.20attributes.20during.20parsing.html#493023761">(Jan 10 2025 at 20:51)</a>:</h4>
<p>Wow, good to know</p>



<a name="493023930"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/Calculating%20name%20attributes%20during%20parsing/near/493023930" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/Calculating.20name.20attributes.20during.20parsing.html#493023930">(Jan 10 2025 at 20:53)</a>:</h4>
<p>That makes me wonder if long-term, Roc would have a faster dev backend startup time if we did dynamic dispatch for everything</p>



<a name="493023949"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/Calculating%20name%20attributes%20during%20parsing/near/493023949" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/Calculating.20name.20attributes.20during.20parsing.html#493023949">(Jan 10 2025 at 20:53)</a>:</h4>
<p>That would be <em>very</em> long-term, though</p>



<a name="493024003"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/Calculating%20name%20attributes%20during%20parsing/near/493024003" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/Calculating.20name.20attributes.20during.20parsing.html#493024003">(Jan 10 2025 at 20:53)</a>:</h4>
<p>I'm not sure about that...seems like Zig and JAI are way faster than Rust or C++ even though they both specialize, and they specialize via compile-time interpreting of source code, which is likely to be slower than parametric polymorphism type inference</p>



<a name="493024126"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/Calculating%20name%20attributes%20during%20parsing/near/493024126" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/Calculating.20name.20attributes.20during.20parsing.html#493024126">(Jan 10 2025 at 20:54)</a>:</h4>
<p>"specialization is costly" is definitely true, but "specializing compilers are all slow" is empirically false thanks to those counterexamples, so there is obviously more to the story</p>



<a name="493024337"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/Calculating%20name%20attributes%20during%20parsing/near/493024337" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ayaz Hafiz <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/Calculating.20name.20attributes.20during.20parsing.html#493024337">(Jan 10 2025 at 20:56)</a>:</h4>
<p>i'm talking about relative speeds, not in absolute terms. zig is faster than c++ and rust but that doesn't mean that zig without specialization would be just as fast as zig with specialization. it would certainly be faster</p>



<a name="493024364"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/Calculating%20name%20attributes%20during%20parsing/near/493024364" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/Calculating.20name.20attributes.20during.20parsing.html#493024364">(Jan 10 2025 at 20:56)</a>:</h4>
<p>oh yeah for sure!</p>



<a name="493024377"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/Calculating%20name%20attributes%20during%20parsing/near/493024377" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ayaz Hafiz <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/Calculating.20name.20attributes.20during.20parsing.html#493024377">(Jan 10 2025 at 20:56)</a>:</h4>
<p>c++ and rust have a lot of other stuff that doesn't help. auto derefs are a good example</p>



<a name="493024389"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/Calculating%20name%20attributes%20during%20parsing/near/493024389" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/Calculating.20name.20attributes.20during.20parsing.html#493024389">(Jan 10 2025 at 20:56)</a>:</h4>
<p>yep haha</p>



<a name="493024419"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/Calculating%20name%20attributes%20during%20parsing/near/493024419" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ayaz Hafiz <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/Calculating.20name.20attributes.20during.20parsing.html#493024419">(Jan 10 2025 at 20:57)</a>:</h4>
<p>but what i mean is, in terms what is the bottleneck for any given compiler, specialization is definitely at the top</p>



<a name="493024433"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/Calculating%20name%20attributes%20during%20parsing/near/493024433" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/Calculating.20name.20attributes.20during.20parsing.html#493024433">(Jan 10 2025 at 20:57)</a>:</h4>
<p>totally</p>



<a name="493024441"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/Calculating%20name%20attributes%20during%20parsing/near/493024441" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ayaz Hafiz <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/Calculating.20name.20attributes.20during.20parsing.html#493024441">(Jan 10 2025 at 20:57)</a>:</h4>
<p>specialization is the only thing that cannot be O(N) where N is program size</p>



<a name="493024550"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/Calculating%20name%20attributes%20during%20parsing/near/493024550" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/Calculating.20name.20attributes.20during.20parsing.html#493024550">(Jan 10 2025 at 20:58)</a>:</h4>
<p>well, after linking and code gen in the case of LLVM - although specialization does create more work for both of those steps</p>



<a name="493024564"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/Calculating%20name%20attributes%20during%20parsing/near/493024564" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/Calculating.20name.20attributes.20during.20parsing.html#493024564">(Jan 10 2025 at 20:58)</a>:</h4>
<p>Can typechecking be O(N)-ish with our type system?</p>



<a name="493024584"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/Calculating%20name%20attributes%20during%20parsing/near/493024584" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/Calculating.20name.20attributes.20during.20parsing.html#493024584">(Jan 10 2025 at 20:58)</a>:</h4>
<p>It feels very graph traversal-y at the moment</p>



<a name="493024586"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/Calculating%20name%20attributes%20during%20parsing/near/493024586" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ayaz Hafiz <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/Calculating.20name.20attributes.20during.20parsing.html#493024586">(Jan 10 2025 at 20:58)</a>:</h4>
<p>yes typechecking is o(n)</p>



<a name="493024610"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/Calculating%20name%20attributes%20during%20parsing/near/493024610" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/Calculating.20name.20attributes.20during.20parsing.html#493024610">(Jan 10 2025 at 20:58)</a>:</h4>
<p>in practice</p>



<a name="493024624"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/Calculating%20name%20attributes%20during%20parsing/near/493024624" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/Calculating.20name.20attributes.20during.20parsing.html#493024624">(Jan 10 2025 at 20:58)</a>:</h4>
<p>Ah</p>



<a name="493024634"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/Calculating%20name%20attributes%20during%20parsing/near/493024634" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/Calculating.20name.20attributes.20during.20parsing.html#493024634">(Jan 10 2025 at 20:58)</a>:</h4>
<p>just don't write a giant pyramid of nested defs please <span aria-label="stuck out tongue" class="emoji emoji-1f61b" role="img" title="stuck out tongue">:stuck_out_tongue:</span></p>



<a name="493024643"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/Calculating%20name%20attributes%20during%20parsing/near/493024643" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/Calculating.20name.20attributes.20during.20parsing.html#493024643">(Jan 10 2025 at 20:58)</a>:</h4>
<p>I can see in practice</p>



<a name="493024644"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/Calculating%20name%20attributes%20during%20parsing/near/493024644" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ayaz Hafiz <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/Calculating.20name.20attributes.20during.20parsing.html#493024644">(Jan 10 2025 at 20:58)</a>:</h4>
<p>even just for generating the specializations, it's bigger than o(n)</p>



<a name="493024691"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/Calculating%20name%20attributes%20during%20parsing/near/493024691" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ayaz Hafiz <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/Calculating.20name.20attributes.20during.20parsing.html#493024691">(Jan 10 2025 at 20:59)</a>:</h4>
<p>because you emit equal or more code than is fed in</p>



<a name="493024705"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/Calculating%20name%20attributes%20during%20parsing/near/493024705" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ayaz Hafiz <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/Calculating.20name.20attributes.20during.20parsing.html#493024705">(Jan 10 2025 at 20:59)</a>:</h4>
<p>so just producing the specializations is expensive</p>



<a name="493024722"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/Calculating%20name%20attributes%20during%20parsing/near/493024722" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/Calculating.20name.20attributes.20during.20parsing.html#493024722">(Jan 10 2025 at 20:59)</a>:</h4>
<p>I get that specialization gen is bigger than O(n), but <em>just</em> making concretely-typed copies seems cheap even if you do a lot of it</p>



<a name="493024744"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/Calculating%20name%20attributes%20during%20parsing/near/493024744" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ayaz Hafiz <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/Calculating.20name.20attributes.20during.20parsing.html#493024744">(Jan 10 2025 at 20:59)</a>:</h4>
<p>and it's compounded by the fact that you have to duplicate data, etc (and there is little getting around that)</p>



<a name="493024752"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/Calculating%20name%20attributes%20during%20parsing/near/493024752" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/Calculating.20name.20attributes.20during.20parsing.html#493024752">(Jan 10 2025 at 20:59)</a>:</h4>
<p>But the part that would suck is everything after it working on more than the original N functions/values</p>



<a name="493025063"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/Calculating%20name%20attributes%20during%20parsing/near/493025063" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ayaz Hafiz <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/Calculating.20name.20attributes.20during.20parsing.html#493025063">(Jan 10 2025 at 21:02)</a>:</h4>
<p>yeah the reason is that specialization is more than making trivial copies</p>



<a name="493025091"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/Calculating%20name%20attributes%20during%20parsing/near/493025091" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ayaz Hafiz <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/Calculating.20name.20attributes.20during.20parsing.html#493025091">(Jan 10 2025 at 21:02)</a>:</h4>
<p>you are basically chopping up graphs of the program and rewriting them</p>



<a name="493025095"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/Calculating%20name%20attributes%20during%20parsing/near/493025095" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/Calculating.20name.20attributes.20during.20parsing.html#493025095">(Jan 10 2025 at 21:02)</a>:</h4>
<p>I figured</p>



<a name="493025197"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/Calculating%20name%20attributes%20during%20parsing/near/493025197" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/Calculating.20name.20attributes.20during.20parsing.html#493025197">(Jan 10 2025 at 21:03)</a>:</h4>
<p>Oh, even <em>just</em> the naive graph expansion is bottleneck number one for relative time spent by compiler passes??</p>



<a name="493025276"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/Calculating%20name%20attributes%20during%20parsing/near/493025276" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ayaz Hafiz <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/Calculating.20name.20attributes.20during.20parsing.html#493025276">(Jan 10 2025 at 21:04)</a>:</h4>
<p>there are things that you can do to make the constant cost better, eg avoid over allocating, have a dense union/find representation of types, compiling to a good representation (e.g. passing large objects by pointer instead of by value everywhere). but the non-constant cost can't change</p>



<a name="493025653"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/Calculating%20name%20attributes%20during%20parsing/near/493025653" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ayaz Hafiz <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/Calculating.20name.20attributes.20during.20parsing.html#493025653">(Jan 10 2025 at 21:06)</a>:</h4>
<p>maybe a better way to put it is anything that is rewriting the program to a non-constant equivalent is going to be an expensive part. optimizations are another good example of this</p>



<a name="493025928"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/Calculating%20name%20attributes%20during%20parsing/near/493025928" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ayaz Hafiz <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/Calculating.20name.20attributes.20during.20parsing.html#493025928">(Jan 10 2025 at 21:09)</a>:</h4>
<p>another kind of interesting thing about specialization is that it is inherently at odds with separate compilation</p>



<a name="493025988"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/Calculating%20name%20attributes%20during%20parsing/near/493025988" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ayaz Hafiz <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/Calculating.20name.20attributes.20during.20parsing.html#493025988">(Jan 10 2025 at 21:09)</a>:</h4>
<p>this is why you don't really have separate compilation in Rust and in C++ you have to include generic functions in header files (so you have separate compilation until you need a generic function)</p>



<a name="493026007"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/Calculating%20name%20attributes%20during%20parsing/near/493026007" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ayaz Hafiz <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/Calculating.20name.20attributes.20during.20parsing.html#493026007">(Jan 10 2025 at 21:09)</a>:</h4>
<p>which adds to the feeling of compilation time overall</p>



<a name="493026127"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/Calculating%20name%20attributes%20during%20parsing/near/493026127" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ayaz Hafiz <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/Calculating.20name.20attributes.20during.20parsing.html#493026127">(Jan 10 2025 at 21:10)</a>:</h4>
<p>there are ways to get around this though. for example boxing values at compilation unit boundaries so there is a uniform representation. This is what Swift to separate comp/dynamic linking with generics IIRC</p>



<a name="493026521"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/Calculating%20name%20attributes%20during%20parsing/near/493026521" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/Calculating.20name.20attributes.20during.20parsing.html#493026521">(Jan 10 2025 at 21:14)</a>:</h4>
<p>yeah that route is tricky for us because of host ABIs unfortunately</p>



<a name="493026597"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/Calculating%20name%20attributes%20during%20parsing/near/493026597" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/Calculating.20name.20attributes.20during.20parsing.html#493026597">(Jan 10 2025 at 21:15)</a>:</h4>
<p>like if we give a <code>List Str</code> to the host, it needs to look the same way in memory with or without optimizations, and we definitely want specialization in optimized builds even if we wanted dev builds to do something else</p>



<a name="493026790"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/Calculating%20name%20attributes%20during%20parsing/near/493026790" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ayaz Hafiz <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/Calculating.20name.20attributes.20during.20parsing.html#493026790">(Jan 10 2025 at 21:16)</a>:</h4>
<p>i honestly think the long term answer for dev builds if you care about compiler perf (for any specializing compiler) is an interpreter</p>



<a name="493026827"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/Calculating%20name%20attributes%20during%20parsing/near/493026827" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ayaz Hafiz <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/Calculating.20name.20attributes.20during.20parsing.html#493026827">(Jan 10 2025 at 21:17)</a>:</h4>
<p>in roc's case the interpreter would have some c ffi and the rest is just interpreted, no specialization</p>



<a name="493027032"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/Calculating%20name%20attributes%20during%20parsing/near/493027032" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ayaz Hafiz <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/Calculating.20name.20attributes.20during.20parsing.html#493027032">(Jan 10 2025 at 21:18)</a>:</h4>
<p>you also don't need to worry about it for the host ABI because the host ABI has to be concretized - there is no polymorphism over it</p>



<a name="493027086"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/Calculating%20name%20attributes%20during%20parsing/near/493027086" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ayaz Hafiz <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/Calculating.20name.20attributes.20during.20parsing.html#493027086">(Jan 10 2025 at 21:19)</a>:</h4>
<p>it only matters within same-language (Roc&lt;&gt;Roc in this case) calls</p>



<a name="493028442"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/Calculating%20name%20attributes%20during%20parsing/near/493028442" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/Calculating.20name.20attributes.20during.20parsing.html#493028442">(Jan 10 2025 at 21:30)</a>:</h4>
<p>so like convert at runtime right at the boundary?</p>



<a name="493028824"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/Calculating%20name%20attributes%20during%20parsing/near/493028824" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/Calculating.20name.20attributes.20during.20parsing.html#493028824">(Jan 10 2025 at 21:33)</a>:</h4>
<blockquote>
<p>long term answer for dev builds if you care about compiler perf (for any specializing compiler) is an interpreter</p>
</blockquote>
<p>Yeah, this is probably correct. Probably a bytecode interpreter like python. (Though this does leave weird holes where dev and optimized differ even more).</p>



<a name="493029104"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/Calculating%20name%20attributes%20during%20parsing/near/493029104" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/Calculating.20name.20attributes.20during.20parsing.html#493029104">(Jan 10 2025 at 21:35)</a>:</h4>
<p>Like host calls into roc (which just launches an interpreter over the roc bytecode). When calling back into the host, just use libffi to deal with all the types and calling the host pointers.</p>



<a name="493029199"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/Calculating%20name%20attributes%20during%20parsing/near/493029199" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/Calculating.20name.20attributes.20during.20parsing.html#493029199">(Jan 10 2025 at 21:36)</a>:</h4>
<p>This should be very doable with lots of gains.</p>



<a name="493029253"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/Calculating%20name%20attributes%20during%20parsing/near/493029253" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/Calculating.20name.20attributes.20during.20parsing.html#493029253">(Jan 10 2025 at 21:36)</a>:</h4>
<p>Likely still want to do at a minimum tail call optimization, but most things could remain boxed and etc to run faster.</p>



<a name="493029349"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/Calculating%20name%20attributes%20during%20parsing/near/493029349" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/Calculating.20name.20attributes.20during.20parsing.html#493029349">(Jan 10 2025 at 21:37)</a>:</h4>
<p>The problem with the dev backend compilation time long term, isn't the dev backend. It is all the parts above the dev backend to deal with type checking and specialization.</p>



<a name="493029454"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/Calculating%20name%20attributes%20during%20parsing/near/493029454" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/Calculating.20name.20attributes.20during.20parsing.html#493029454">(Jan 10 2025 at 21:38)</a>:</h4>
<p>Those are the slow parts that benefit signifcantally from a boxed representation and such.</p>



<a name="493029756"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/Calculating%20name%20attributes%20during%20parsing/near/493029756" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/Calculating.20name.20attributes.20during.20parsing.html#493029756">(Jan 10 2025 at 21:40)</a>:</h4>
<p>Also, I'm not sure which would be faster, dev assembly or a bytecode interpreter. Probably still the dev assembly, but less clear especially if you do some smart bytecode assembler tricks (not to mention some lambda chaining tricks that get pretty optimized code without writing any assembly).</p>



<a name="493029907"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/Calculating%20name%20attributes%20during%20parsing/near/493029907" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/Calculating.20name.20attributes.20during.20parsing.html#493029907">(Jan 10 2025 at 21:41)</a>:</h4>
<p>Obviously, we could box everything and do assembly gen fast just change the assembly to understand boxed types.</p>



<a name="493031370"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/Calculating%20name%20attributes%20during%20parsing/near/493031370" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ayaz Hafiz <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/Calculating.20name.20attributes.20during.20parsing.html#493031370">(Jan 10 2025 at 21:55)</a>:</h4>
<blockquote>
<p>so like convert at runtime right at the boundary?<br>
yes</p>
</blockquote>



<a name="493031546"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/Calculating%20name%20attributes%20during%20parsing/near/493031546" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/Calculating.20name.20attributes.20during.20parsing.html#493031546">(Jan 10 2025 at 21:56)</a>:</h4>
<p>yeah to Brendan's point, interpreter vs fast machine code generator is orthogonal to specialization</p>



<a name="493031598"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/Calculating%20name%20attributes%20during%20parsing/near/493031598" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/Calculating.20name.20attributes.20during.20parsing.html#493031598">(Jan 10 2025 at 21:57)</a>:</h4>
<p>the real benefit would be if we could have the dev backend do something other than specialization at the cost of (much) more boxing at runtime</p>



<a name="493031620"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/Calculating%20name%20attributes%20during%20parsing/near/493031620" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/Calculating.20name.20attributes.20during.20parsing.html#493031620">(Jan 10 2025 at 21:57)</a>:</h4>
<p>and yet at the boundary convert things over to the representation the host needs</p>



<a name="493031634"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/Calculating%20name%20attributes%20during%20parsing/near/493031634" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/Calculating.20name.20attributes.20during.20parsing.html#493031634">(Jan 10 2025 at 21:57)</a>:</h4>
<p>which in some cases might be very expensive, unfortunately <span aria-label="sweat smile" class="emoji emoji-1f605" role="img" title="sweat smile">:sweat_smile:</span></p>



<a name="493031801"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/Calculating%20name%20attributes%20during%20parsing/near/493031801" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ayaz Hafiz <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/Calculating.20name.20attributes.20during.20parsing.html#493031801">(Jan 10 2025 at 21:58)</a>:</h4>
<p>well the great thing is you don't need the boundary conversion at the host, that's what im saying</p>



<a name="493031866"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/Calculating%20name%20attributes%20during%20parsing/near/493031866" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/Calculating.20name.20attributes.20during.20parsing.html#493031866">(Jan 10 2025 at 21:59)</a>:</h4>
<p>What about something like <code>List Str</code>? in the boxed non-specialized world, wouldn't it be <code>List GenericRocType</code></p>



<a name="493031868"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/Calculating%20name%20attributes%20during%20parsing/near/493031868" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/Calculating.20name.20attributes.20during.20parsing.html#493031868">(Jan 10 2025 at 21:59)</a>:</h4>
<p>hm, but unless I'm missing something, <code>List Str</code> would be different in memory depending on whether it's been monomorphized or not</p>



<a name="493031869"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/Calculating%20name%20attributes%20during%20parsing/near/493031869" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ayaz Hafiz <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/Calculating.20name.20attributes.20during.20parsing.html#493031869">(Jan 10 2025 at 21:59)</a>:</h4>
<p>i don't think it's that expensive. it's only a pointer dereference and indirect jumps for abilities</p>



<a name="493031877"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/Calculating%20name%20attributes%20during%20parsing/near/493031877" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/Calculating.20name.20attributes.20during.20parsing.html#493031877">(Jan 10 2025 at 21:59)</a>:</h4>
<p>right, there would be some runtime metadata there I'd think</p>



<a name="493031895"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/Calculating%20name%20attributes%20during%20parsing/near/493031895" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ayaz Hafiz <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/Calculating.20name.20attributes.20during.20parsing.html#493031895">(Jan 10 2025 at 21:59)</a>:</h4>
<p>at the host there's no polymorphism</p>



<a name="493031913"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/Calculating%20name%20attributes%20during%20parsing/near/493031913" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ayaz Hafiz <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/Calculating.20name.20attributes.20during.20parsing.html#493031913">(Jan 10 2025 at 21:59)</a>:</h4>
<p>at the host boundary*</p>



<a name="493031914"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/Calculating%20name%20attributes%20during%20parsing/near/493031914" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/Calculating.20name.20attributes.20during.20parsing.html#493031914">(Jan 10 2025 at 21:59)</a>:</h4>
<p>but you can give a <code>List Str</code> to a host</p>



<a name="493031994"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/Calculating%20name%20attributes%20during%20parsing/near/493031994" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/Calculating.20name.20attributes.20during.20parsing.html#493031994">(Jan 10 2025 at 22:00)</a>:</h4>
<p>there are no polymorphic variables</p>



<a name="493032003"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/Calculating%20name%20attributes%20during%20parsing/near/493032003" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/Calculating.20name.20attributes.20during.20parsing.html#493032003">(Jan 10 2025 at 22:00)</a>:</h4>
<p>they're all concrete</p>



<a name="493032030"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/Calculating%20name%20attributes%20during%20parsing/near/493032030" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ayaz Hafiz <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/Calculating.20name.20attributes.20during.20parsing.html#493032030">(Jan 10 2025 at 22:00)</a>:</h4>
<p>sure, but you don't need to box it because you know that the function will always have the same concrete inputs and outputs</p>



<a name="493032034"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/Calculating%20name%20attributes%20during%20parsing/near/493032034" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/Calculating.20name.20attributes.20during.20parsing.html#493032034">(Jan 10 2025 at 22:00)</a>:</h4>
<p>but <code>List Str</code> and <code>List U8</code> have different memory layouts if they've been specialized</p>



<a name="493032129"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/Calculating%20name%20attributes%20during%20parsing/near/493032129" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ayaz Hafiz <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/Calculating.20name.20attributes.20during.20parsing.html#493032129">(Jan 10 2025 at 22:01)</a>:</h4>
<p>right, but no host-exposed function has more than one specialization</p>



<a name="493032132"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/Calculating%20name%20attributes%20during%20parsing/near/493032132" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/Calculating.20name.20attributes.20during.20parsing.html#493032132">(Jan 10 2025 at 22:01)</a>:</h4>
<p>Other languages are more free to do this because the language runtime and the "platform" are not separated and are cohesive</p>



<a name="493032153"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/Calculating%20name%20attributes%20during%20parsing/near/493032153" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/Calculating.20name.20attributes.20during.20parsing.html#493032153">(Jan 10 2025 at 22:01)</a>:</h4>
<p>but let's say I have a call to <code>List.map</code> which returns a <code>List Str</code> which I hand off to the platform</p>



<a name="493032244"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/Calculating%20name%20attributes%20during%20parsing/near/493032244" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/Calculating.20name.20attributes.20during.20parsing.html#493032244">(Jan 10 2025 at 22:02)</a>:</h4>
<p>how can <code>List.map</code> return a <code>List Str</code> sometimes and a <code>List U8</code> other times I call it, without either specializtion or some runtime metadata on <code>List</code>?</p>



<a name="493032324"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/Calculating%20name%20attributes%20during%20parsing/near/493032324" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ayaz Hafiz <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/Calculating.20name.20attributes.20during.20parsing.html#493032324">(Jan 10 2025 at 22:02)</a>:</h4>
<p>okay, i see what you're getting at now</p>



<a name="493032333"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/Calculating%20name%20attributes%20during%20parsing/near/493032333" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ayaz Hafiz <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/Calculating.20name.20attributes.20during.20parsing.html#493032333">(Jan 10 2025 at 22:02)</a>:</h4>
<p>I'm not sure that is supported though</p>



<a name="493032346"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/Calculating%20name%20attributes%20during%20parsing/near/493032346" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/Calculating.20name.20attributes.20during.20parsing.html#493032346">(Jan 10 2025 at 22:03)</a>:</h4>
<blockquote>
<p>but you don't need to box it because you know that the function will always have the same concrete inputs and outputs</p>
</blockquote>
<p>Wait, your suggestion is more meta than I realized. You don't want to box everything, You just want to box anything that has more than one specialization. That said, you want to box only over the possible specializations. So for a function that in practice has two specializations <code>List Str -&gt; ...</code> or <code>List U8 -&gt; ...</code>, you would essentially convert it into a <code>[ ListStr (List Str), ListU8 (List U8) ] -&gt; ...</code></p>



<a name="493032384"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/Calculating%20name%20attributes%20during%20parsing/near/493032384" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/Calculating.20name.20attributes.20during.20parsing.html#493032384">(Jan 10 2025 at 22:03)</a>:</h4>
<p>So very different from the standard interpreter that boxes everything and does so in a recursive manner.</p>



<a name="493032467"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/Calculating%20name%20attributes%20during%20parsing/near/493032467" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ayaz Hafiz <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/Calculating.20name.20attributes.20during.20parsing.html#493032467">(Jan 10 2025 at 22:04)</a>:</h4>
<p>i don't think you can pass a function to the host that is polymorphic for exactly that reason - the host has to have a concrete (non-generic) interface so i'm not sure how you would pass such a function through?</p>



<a name="493032515"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/Calculating%20name%20attributes%20during%20parsing/near/493032515" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ayaz Hafiz <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/Calculating.20name.20attributes.20during.20parsing.html#493032515">(Jan 10 2025 at 22:04)</a>:</h4>
<p>like I can't say on the host side "i expose an effect <code>f: Str -&gt; (a -&gt; a) -&gt; Str</code>"</p>



<a name="493032567"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/Calculating%20name%20attributes%20during%20parsing/near/493032567" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ayaz Hafiz <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/Calculating.20name.20attributes.20during.20parsing.html#493032567">(Jan 10 2025 at 22:05)</a>:</h4>
<p>you have to say <code>f: Str -&gt; (Str -&gt; Str) -&gt; Str</code> at which point you know exactly what specialization you need and you don't need anything more</p>



<a name="493032792"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/Calculating%20name%20attributes%20during%20parsing/near/493032792" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ayaz Hafiz <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/Calculating.20name.20attributes.20during.20parsing.html#493032792">(Jan 10 2025 at 22:07)</a>:</h4>
<blockquote>
<p>Wait, your suggestion is more meta than I realized. You don't want to box everything, You just want to box anything that has more than one specialization. That said, you want to box only over the possible specializations. So for a function that in practice has two specializations <code>List Str -&gt; ...</code> or <code>List U8 -&gt; ...</code>, you would essentially convert it into a <code>[ ListStr (List Str), ListU8 (List U8) ] -&gt; ...</code></p>
</blockquote>
<p>Yes, that could work too. But i'm not quite following how the host can take any function that is generic. I don't think it's possible but maybe i'm missing something</p>



<a name="493032915"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/Calculating%20name%20attributes%20during%20parsing/near/493032915" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/Calculating.20name.20attributes.20during.20parsing.html#493032915">(Jan 10 2025 at 22:08)</a>:</h4>
<p>I'm not worried about directly interacting with the host. I am worried about indirectly interacting with the host.</p>



<a name="493032934"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/Calculating%20name%20attributes%20during%20parsing/near/493032934" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ayaz Hafiz <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/Calculating.20name.20attributes.20during.20parsing.html#493032934">(Jan 10 2025 at 22:08)</a>:</h4>
<p>what is the difference?</p>



<a name="493033022"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/Calculating%20name%20attributes%20during%20parsing/near/493033022" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/Calculating.20name.20attributes.20during.20parsing.html#493033022">(Jan 10 2025 at 22:09)</a>:</h4>
<p>I thought part of the goal of this work was to avoid specialization. As such, even though the host has concrete types, it has to be able to call functions that have multiple specializations and thus take generic boxed types. As such, there has to be a way to convert concrete types to/from generic types.</p>



<a name="493033158"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/Calculating%20name%20attributes%20during%20parsing/near/493033158" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/Calculating.20name.20attributes.20during.20parsing.html#493033158">(Jan 10 2025 at 22:10)</a>:</h4>
<p>Aside, I think an interpreter could theoretically avoid boxing and lazily specialize when a function with a specific specialization is called.</p>



<a name="493033231"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/Calculating%20name%20attributes%20during%20parsing/near/493033231" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ayaz Hafiz <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/Calculating.20name.20attributes.20during.20parsing.html#493033231">(Jan 10 2025 at 22:11)</a>:</h4>
<p>My argument is that the host can never interact with any Roc function that is polymorphic, hence you don't need to worry about generics over the host boundary. Because how could that work if it did? You would need to re-compile the host every time the app uses another specialization</p>



<a name="493033316"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/Calculating%20name%20attributes%20during%20parsing/near/493033316" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ayaz Hafiz <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/Calculating.20name.20attributes.20during.20parsing.html#493033316">(Jan 10 2025 at 22:12)</a>:</h4>
<p>yes, i think you're right</p>



<a name="493033481"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/Calculating%20name%20attributes%20during%20parsing/near/493033481" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ayaz Hafiz <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/Calculating.20name.20attributes.20during.20parsing.html#493033481">(Jan 10 2025 at 22:14)</a>:</h4>
<p>sorry for devolving your thread Sam lmao</p>



<a name="493034090"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/Calculating%20name%20attributes%20during%20parsing/near/493034090" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/Calculating.20name.20attributes.20during.20parsing.html#493034090">(Jan 10 2025 at 22:20)</a>:</h4>
<p>This was educational</p>



<a name="493034114"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/Calculating%20name%20attributes%20during%20parsing/near/493034114" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/Calculating.20name.20attributes.20during.20parsing.html#493034114">(Jan 10 2025 at 22:20)</a>:</h4>
<p>I got what I wanted, which was approval for me doing code cleanup</p>



<a name="493038423"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/Calculating%20name%20attributes%20during%20parsing/near/493038423" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ayaz Hafiz <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/Calculating.20name.20attributes.20during.20parsing.html#493038423">(Jan 10 2025 at 23:03)</a>:</h4>
<p>i'm still confused on if i'm missing something about the app&lt;&gt;host boundary. am i? or is it correct that the host actually has no way to call a polymorphic function</p>



<a name="493040811"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/Calculating%20name%20attributes%20during%20parsing/near/493040811" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/Calculating.20name.20attributes.20during.20parsing.html#493040811">(Jan 10 2025 at 23:28)</a>:</h4>
<p>Host could call something with a <code>Box model</code></p>



<a name="493040822"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/Calculating%20name%20attributes%20during%20parsing/near/493040822" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/Calculating.20name.20attributes.20during.20parsing.html#493040822">(Jan 10 2025 at 23:29)</a>:</h4>
<p>But that is kinda different</p>



<a name="493040846"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/Calculating%20name%20attributes%20during%20parsing/near/493040846" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ayaz Hafiz <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/Calculating.20name.20attributes.20during.20parsing.html#493040846">(Jan 10 2025 at 23:29)</a>:</h4>
<p>but that has to be equivalent to a single function, it can't dispatch to one of N functions right</p>



<a name="493040848"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/Calculating%20name%20attributes%20during%20parsing/near/493040848" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ayaz Hafiz <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/Calculating.20name.20attributes.20during.20parsing.html#493040848">(Jan 10 2025 at 23:29)</a>:</h4>
<p>yeah</p>



<a name="493040876"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/Calculating%20name%20attributes%20during%20parsing/near/493040876" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/Calculating.20name.20attributes.20during.20parsing.html#493040876">(Jan 10 2025 at 23:29)</a>:</h4>
<p>Yeah</p>



<a name="493040880"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/Calculating%20name%20attributes%20during%20parsing/near/493040880" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ayaz Hafiz <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/Calculating.20name.20attributes.20during.20parsing.html#493040880">(Jan 10 2025 at 23:29)</a>:</h4>
<p>but the host can't actually call <code>List.map</code> polymorphically</p>



<a name="493040947"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/Calculating%20name%20attributes%20during%20parsing/near/493040947" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ayaz Hafiz <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/Calculating.20name.20attributes.20during.20parsing.html#493040947">(Jan 10 2025 at 23:30)</a>:</h4>
<p>theres no way to do that and be able to compile the host separately i think</p>



<a name="493040978"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/Calculating%20name%20attributes%20during%20parsing/near/493040978" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ayaz Hafiz <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/Calculating.20name.20attributes.20during.20parsing.html#493040978">(Jan 10 2025 at 23:30)</a>:</h4>
<p>without boxed polymorphic types obviously</p>



<a name="493040986"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/Calculating%20name%20attributes%20during%20parsing/near/493040986" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/Calculating.20name.20attributes.20during.20parsing.html#493040986">(Jan 10 2025 at 23:30)</a>:</h4>
<p>Yeah</p>



<a name="493041020"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/Calculating%20name%20attributes%20during%20parsing/near/493041020" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ayaz Hafiz <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/Calculating.20name.20attributes.20during.20parsing.html#493041020">(Jan 10 2025 at 23:30)</a>:</h4>
<p>okay, so then this works just fine at host boundaries. you don't need any boxing at all.</p>



<a name="493041083"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/Calculating%20name%20attributes%20during%20parsing/near/493041083" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/Calculating.20name.20attributes.20during.20parsing.html#493041083">(Jan 10 2025 at 23:31)</a>:</h4>
<p>I just don't understand how without specializing <a href="http://list.map">list.map</a>, we go from the concrete list passed in from the host to calling a polymorphic function.</p>



<a name="493041259"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/Calculating%20name%20attributes%20during%20parsing/near/493041259" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/Calculating.20name.20attributes.20during.20parsing.html#493041259">(Jan 10 2025 at 23:33)</a>:</h4>
<p>Like if main is simply:</p>
<div class="codehilite"><pre><span></span><code>main : List Str -&gt; List U64
main =
    if #some arbitrary conditional then
        List.map Str.toU64
    else
        List.map Str.toI64
        |&gt; List.map Num.abs
</code></pre></div>



<a name="493041438"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/Calculating%20name%20attributes%20during%20parsing/near/493041438" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ayaz Hafiz <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/Calculating.20name.20attributes.20during.20parsing.html#493041438">(Jan 10 2025 at 23:35)</a>:</h4>
<p>sorry i think i wasn't clear</p>



<a name="493041442"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/Calculating%20name%20attributes%20during%20parsing/near/493041442" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ayaz Hafiz <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/Calculating.20name.20attributes.20during.20parsing.html#493041442">(Jan 10 2025 at 23:35)</a>:</h4>
<p><a href="http://List.map">List.map</a> would be specialized</p>



<a name="493041521"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/Calculating%20name%20attributes%20during%20parsing/near/493041521" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ayaz Hafiz <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/Calculating.20name.20attributes.20during.20parsing.html#493041521">(Jan 10 2025 at 23:36)</a>:</h4>
<p>I was talking about 3p functions at compilation boundaries (let's say libraries for now)</p>



<a name="493041582"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/Calculating%20name%20attributes%20during%20parsing/near/493041582" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ayaz Hafiz <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/Calculating.20name.20attributes.20during.20parsing.html#493041582">(Jan 10 2025 at 23:37)</a>:</h4>
<p>but the case is similar. in this example you would simply unwrap the boxed type at the end and return that.</p>



<a name="493041641"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/Calculating%20name%20attributes%20during%20parsing/near/493041641" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/Calculating.20name.20attributes.20during.20parsing.html#493041641">(Jan 10 2025 at 23:37)</a>:</h4>
<p>yeah the problem with that is what if you have like <code>List (List Str)</code> or something</p>



<a name="493041657"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/Calculating%20name%20attributes%20during%20parsing/near/493041657" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ayaz Hafiz <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/Calculating.20name.20attributes.20during.20parsing.html#493041657">(Jan 10 2025 at 23:37)</a>:</h4>
<p>why is that a problem?</p>



<a name="493041719"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/Calculating%20name%20attributes%20during%20parsing/near/493041719" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/Calculating.20name.20attributes.20during.20parsing.html#493041719">(Jan 10 2025 at 23:38)</a>:</h4>
<p>now you gotta traverse the whole thing and unbox all the inner lists</p>



<a name="493041857"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/Calculating%20name%20attributes%20during%20parsing/near/493041857" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ayaz Hafiz <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/Calculating.20name.20attributes.20during.20parsing.html#493041857">(Jan 10 2025 at 23:39)</a>:</h4>
<p>i don't think that's necessarily true. you only need to do the wrap/unwrap if you definitely know you are calling a polymorphic-but-unspecialized function. which in practice is going to be a small amount of the functions in your program (since it's only at 3p library API boundaries)</p>



<a name="493041948"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/Calculating%20name%20attributes%20during%20parsing/near/493041948" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ayaz Hafiz <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/Calculating.20name.20attributes.20during.20parsing.html#493041948">(Jan 10 2025 at 23:40)</a>:</h4>
<p>Also, it doesn't need to be nested unwrap. If you pass <code>List (List Str)</code> to a function like that, you only need to wrap the whole structure, not the nested ones</p>



<a name="493113185"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/Calculating%20name%20attributes%20during%20parsing/near/493113185" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ayaz Hafiz <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/Calculating.20name.20attributes.20during.20parsing.html#493113185">(Jan 11 2025 at 17:31)</a>:</h4>
<p>this is succinct explanation of what i was saying: <a href="https://lobste.rs/s/ei5bp4/apple_is_killing_swift#c_zwjc1i">https://lobste.rs/s/ei5bp4/apple_is_killing_swift#c_zwjc1i</a>. very coincidental</p>



<hr><p>Last updated: Mar 01 2026 at 12:20 UTC</p>
</html>