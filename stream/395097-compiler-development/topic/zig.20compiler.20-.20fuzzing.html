<html>
<head><meta charset="utf-8"><title>zig compiler - fuzzing · compiler development · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/index.html">compiler development</a></h2>
<h3>Topic: <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20fuzzing.html">zig compiler - fuzzing</a></h3>

<hr>

<base href="https://roc.zulipchat.com">

<head><link href="https://roc-lang.github.io/zulip-export/style.css" rel="stylesheet"></head>

<a name="498271128"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20fuzzing/near/498271128" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20fuzzing.html#498271128">(Feb 07 2025 at 06:50)</a>:</h4>
<p>I wanted to spin up a discussion on fuzzing the new compiler specifically.</p>



<a name="498271196"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20fuzzing/near/498271196" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20fuzzing.html#498271196">(Feb 07 2025 at 06:51)</a>:</h4>
<p>It sounds like for a while, we will be using afl++ as our fuzzer and eventually we will get to swap to the zig integrated fuzzer (but probably not until at least 0.15.0).</p>



<a name="498271262"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20fuzzing/near/498271262" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20fuzzing.html#498271262">(Feb 07 2025 at 06:52)</a>:</h4>
<p>I'm trying to figure out what tooling will make fuzzing as seamless as possible. I know that it can be quite painful to manage corpus's and enable anyone to fuzz.</p>



<a name="498271384"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20fuzzing/near/498271384" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20fuzzing.html#498271384">(Feb 07 2025 at 06:53)</a>:</h4>
<p>I think it is really useful to keep around at least a minimized corpus to help exploration, but we probably want to keep that out of the repo to avoid eating up tons of space with random garbage files. So I'm thinking that we may just need to cache the corpus for CI.</p>



<a name="498271723"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20fuzzing/near/498271723" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20fuzzing.html#498271723">(Feb 07 2025 at 06:56)</a>:</h4>
<p>Generally speaking, for each fuzzer, we need an input corpus (just basic starter examples). We can optionally add a dictionary (like a bunch of roc keywords and symbols or ast node names depending on the layer being fuzzed). It is probably good to take found crashes/regressions and add them to the input corpus such that they can be used as unit tests. I'm thinking that by default, CI would just run through the input corpus once to ensure there are no regressions.</p>
<p>Also, there is a chance that we can overlap the fuzzing input corpus with snapshot tests. Like we might be able to preprocess all the snapshot tests to turn them into the input corpus for the various fuzzers.</p>



<a name="498271779"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20fuzzing/near/498271779" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20fuzzing.html#498271779">(Feb 07 2025 at 06:57)</a>:</h4>
<p>This is all just open preliminary thinking, but overall, I fell that we will likely want some scripts to manage AFL such that fuzzing is easy for anyone to run.</p>



<a name="498271873"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20fuzzing/near/498271873" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20fuzzing.html#498271873">(Feb 07 2025 at 06:58)</a>:</h4>
<p>Currently fuzzing has a few different dependencies (like llvm). I think with the release of 0.14.0 there may be less required dependencies, but not completely sure. So we probably will want to use nix to manage the dependencies.</p>



<a name="498271921"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20fuzzing/near/498271921" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20fuzzing.html#498271921">(Feb 07 2025 at 06:58)</a>:</h4>
<p>Almost certainly the first really useful fuzzer will be the parser to formatter loop.</p>



<a name="498272072"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20fuzzing/near/498272072" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20fuzzing.html#498272072">(Feb 07 2025 at 07:00)</a>:</h4>
<p>Anyway, I'm totally open to any and all ideas. I'm sure <span class="user-mention" data-user-id="453336">@Joshua Warner</span> has some thoughts.</p>
<p>Oh also, when fuzzing, definitely should use the gpa with leak checks enabled.</p>



<a name="498272326"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20fuzzing/near/498272326" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20fuzzing.html#498272326">(Feb 07 2025 at 07:02)</a>:</h4>
<p>I think fuzzing would want to at least guarantee we have none of these:</p>
<ul>
<li>crashes</li>
<li>early exits</li>
<li>memory leaks</li>
<li><code>Problem.CompilerProblem</code></li>
</ul>



<a name="498272723"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20fuzzing/near/498272723" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20fuzzing.html#498272723">(Feb 07 2025 at 07:06)</a>:</h4>
<p>Yeah, for many cases, we can only check those limited things. For some cases, like parse -&gt; format -&gt; parse -&gt; format, we can check for equivalent formatted outputs both times.</p>



<a name="498272773"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20fuzzing/near/498272773" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20fuzzing.html#498272773">(Feb 07 2025 at 07:07)</a>:</h4>
<p>Also, if we add any verifiers to IR (like the old compIler has check mono ir), we can use that as well. I'm hoping we add a number of these verifiers.</p>



<a name="498276089"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20fuzzing/near/498276089" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20fuzzing.html#498276089">(Feb 07 2025 at 07:36)</a>:</h4>
<p>Oh, an if fuzzing is good enough at exploring (which it may not be), we could theoretically give it access to essentially a repl and have it fuzz the interpreter vs the llvm backend</p>



<a name="498416910"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20fuzzing/near/498416910" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Warner <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20fuzzing.html#498416910">(Feb 07 2025 at 19:59)</a>:</h4>
<p>I would also like to do things like run the compiled code, grab the output and also run the interpreter and assert the output is the same</p>



<a name="498424114"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20fuzzing/near/498424114" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20fuzzing.html#498424114">(Feb 07 2025 at 20:48)</a>:</h4>
<p>Yeah, that is what I was suggesting with my last comment. Probably would run the interpreter first. If the code is valid in the interpreter, run the backend (should always pass). Then run the code and assert equivalent output.</p>



<a name="498443450"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20fuzzing/near/498443450" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Loris Cro <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20fuzzing.html#498443450">(Feb 07 2025 at 23:27)</a>:</h4>
<p>When fuzzing my  languages (a json replacement, a one-liner expression language, a html templating language),  by making sure to turn off  <code>std.mem.eqlBytes_allowed</code> (Zig 0.14.0-dev, named <code>std.mem.backend_can_use_eql_bytes</code> in 0.13.0), I got amazing performance from the fuzzer even without any corpus or dictionary.</p>
<p>Once my tokenizer(s) had been tested enough, I then worked on a simple valid-syntax generator in order to make sure the fuzzer would generate only valid HTML ASTs when flipping bytes, in order to reliably target the parser.</p>
<p>Here's what that looks like: <a href="https://github.com/kristoff-it/superhtml/blob/main/src/fuzz/astgen.zig">https://github.com/kristoff-it/superhtml/blob/main/src/fuzz/astgen.zig</a></p>
<p>So the fuzzer writes <code>ccuc</code> and the executable turns that into:</p>
<div class="codehilite" data-code-language="HTML"><pre><span></span><code><span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>
   <span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
</code></pre></div>
<p>For a full blown programming language getting a valid source code generator up and running is a bit more involved, but Matthew Lugg has been working on one for Zig, you might take inspiration from his work once you want to start fuzzing deeper layers of the compiler.</p>



<a name="498444527"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20fuzzing/near/498444527" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20fuzzing.html#498444527">(Feb 07 2025 at 23:38)</a>:</h4>
<p>Awesome to know!</p>



<a name="499665494"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20fuzzing/near/499665494" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20fuzzing.html#499665494">(Feb 14 2025 at 08:01)</a>:</h4>
<p>Why does tokenization have <code>StringBegin</code> but not <code>StringEnd</code>? Seems strange to generate: <code>[StringBegin, OpenCurly, Expr, CloseCurly, String]</code>. Also, Is there a reason we don't encode the <code>$</code> in tokeniziation? Why is it <code>OpenCurly</code> and not <code>DollarCurly</code> or similar?</p>
<p>Context: trying to write a fuzzer for tokenization that tokenizes, prints in a bare bones form, then tokenizers again and asserts they are the same.</p>
<p>Intermediate looks something like:</p>
<div class="codehilite" data-code-language="Ruby"><pre><span></span><code><span class="n">zzz</span><span class="w"> </span><span class="o">[</span><span class="n">zzzz!</span><span class="o">]</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="ss">zzz</span><span class="p">:</span><span class="w"> </span><span class="n">zzzzzzzz</span><span class="w"> </span><span class="s2">"~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~"</span><span class="w"> </span><span class="p">}</span>
<span class="n">zzzzzz</span><span class="w"> </span><span class="n">zzz</span><span class="o">.</span><span class="n">Zzzzzz</span>
<span class="n">zzzz!</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">|</span><span class="n">_zzzz</span><span class="o">|</span>
<span class="w">    </span><span class="n">z</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"~~~~~"</span>
<span class="w">    </span><span class="no">Zzzzzz</span><span class="o">.</span><span class="n">zzzz!</span><span class="p">(</span><span class="s2">"~~~~~~~${z}"")</span>
</code></pre></div>



<a name="499665522"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20fuzzing/near/499665522" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20fuzzing.html#499665522">(Feb 14 2025 at 08:01)</a>:</h4>
<p>cc <span class="user-mention" data-user-id="453336">@Joshua Warner</span></p>



<a name="499779213"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20fuzzing/near/499779213" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Warner <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20fuzzing.html#499779213">(Feb 14 2025 at 16:14)</a>:</h4>
<p><span class="user-mention" data-user-id="343810">@Brendan Hansknecht</span> yes, that does need to be changed a bit before it's unambiguous</p>
<p>The _intent_ is to generate a sequence of <code>StringBegin, &lt;interpolation&gt;, StringPart, &lt;interpolation&gt;, StringPart</code> (for example)</p>
<p>The ambiguity right now is the OpenCurly/CloseCurly delimiters need to be specific to interpolations - otherwise that's ambiguous with having a string followed by a curly brace (for whatever reason).</p>
<p>In terms of not having StringEnd, that's not needed for disambiguation (at least, as long as I fix up the interpolation thing above). You can have StringBegin, &lt;interpolation&gt;, StringPart, StringBegin - and that's unambiguously a string with an interpolation, followed by a second string without.</p>



<a name="499792491"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20fuzzing/near/499792491" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20fuzzing.html#499792491">(Feb 14 2025 at 17:26)</a>:</h4>
<p><span class="user-mention silent" data-user-id="453336">Joshua Warner</span> <a href="#narrow/channel/395097-compiler-development/topic/zig.20compiler.20-.20spike/near/499779213">said</a>:</p>
<blockquote>
<p>The _intent_ is to generate a sequence of <code>StringBegin, &lt;interpolation&gt;, StringPart, &lt;interpolation&gt;, StringPart</code> (for example)</p>
</blockquote>
<p>I guess I found the first bug (though not via fuzzing, was found well setting up fuzzing)</p>
<p>It curently generates <code>StringBegin, &lt;interpolation&gt;, StringPart, &lt;interpolation&gt;, String</code></p>



<a name="499795928"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20fuzzing/near/499795928" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20fuzzing.html#499795928">(Feb 14 2025 at 17:45)</a>:</h4>
<p>have a fix on my branch</p>



<a name="499814278"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20fuzzing/near/499814278" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20fuzzing.html#499814278">(Feb 14 2025 at 19:38)</a>:</h4>
<p>Ok, first real fuzz bug of the new compiler:<br>
<a href="/user_uploads/22008/6OJoYo0A3vU1ZbptjZmVMvX1/id000000sig06src000000time423execs751opquickpos224">id:000000,sig:06,src:000000,time:423,execs:751,op:quick,pos:224</a></p>
<div class="codehilite"><pre><span></span><code>thread 36762112 panic: index out of bounds: index 226, len 225
/Users/bren077s/Projects/roc/src/check/parse/tokenize.zig:406:58: 0x1023efff3 in decodeUnicode (repro-tokenize)
        const utf8_char = std.unicode.utf8Decode(self.buf[self.pos .. self.pos + len]) catch {
                                                         ^
/Users/bren077s/Projects/roc/src/check/parse/tokenize.zig:1050:59: 0x1023ef4ef in tokenize (repro-tokenize)
                    const info = self.cursor.decodeUnicode(b);
                                                          ^
</code></pre></div>
<p>Looks to be a buffer overflow due to assuming we have enough characters for a full unicode character</p>



<a name="499815524"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20fuzzing/near/499815524" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Warner <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20fuzzing.html#499815524">(Feb 14 2025 at 19:48)</a>:</h4>
<p>Yep, I have some pending tokenizer updates that I'm waiting on Anthony's PR to land prior to posting</p>



<a name="499815554"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20fuzzing/near/499815554" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Warner <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20fuzzing.html#499815554">(Feb 14 2025 at 19:48)</a>:</h4>
<p>Good find on the unicode thing (that one's new to me)!</p>



<a name="499818361"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20fuzzing/near/499818361" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20fuzzing.html#499818361">(Feb 14 2025 at 20:08)</a>:</h4>
<p>Ah, and a second unicode bug the call to <code>decodeUnicode</code> on line 754 will always fail. It's position is 1 past the current position of the byte buffer. Cause it is <code>.</code> followed by unicode instead of just unicode.</p>



<a name="499819925"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20fuzzing/near/499819925" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20fuzzing.html#499819925">(Feb 14 2025 at 20:17)</a>:</h4>
<p>Also, PR for tokenizer fuzzer: <a href="https://github.com/roc-lang/roc/pull/7607">https://github.com/roc-lang/roc/pull/7607</a></p>
<p>Fuzzer essentially instantly finds bugs, but that is fine for merging. The merge will just make sure the fuzzers keep compiling and don't bitrot. And we can use it to slowly burn down bugs.</p>



<a name="499828388"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20fuzzing/near/499828388" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Andrew Kelley <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20fuzzing.html#499828388">(Feb 14 2025 at 20:57)</a>:</h4>
<p><span class="user-mention silent" data-user-id="343810">Brendan Hansknecht</span> <a href="#narrow/channel/395097-compiler-development/topic/zig.20compiler.20-.20fuzzing/near/499814278">said</a>:</p>
<blockquote>
<p><code>self.buf[self.pos .. self.pos + len</code></p>
</blockquote>
<p><code>self.buf[self.pos..][0..len]</code> <a href="https://ziglang.org/download/0.11.0/release-notes.html#Slicing-By-Length">slicing by length</a></p>



<a name="499839197"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20fuzzing/near/499839197" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20fuzzing.html#499839197">(Feb 14 2025 at 22:04)</a>:</h4>
<p>Ok, folded a few fixes into the PR</p>



<a name="499839293"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20fuzzing/near/499839293" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20fuzzing.html#499839293">(Feb 14 2025 at 22:04)</a>:</h4>
<p>Still crashes really quick (likely the mock module I am generating from the tokens does not quite match what the tokenizer expects)</p>



<a name="499841546"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20fuzzing/near/499841546" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20fuzzing.html#499841546">(Feb 14 2025 at 22:20)</a>:</h4>
<p>Looks like your having a lot of fun Brendan <span aria-label="grinning face with smiling eyes" class="emoji emoji-1f601" role="img" title="grinning face with smiling eyes">:grinning_face_with_smiling_eyes:</span></p>



<a name="499842190"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20fuzzing/near/499842190" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20fuzzing.html#499842190">(Feb 14 2025 at 22:25)</a>:</h4>
<p>I mean it is kinda fun seeing weird tokenizer edge cases that fail fuzzing. That said, my print and then retokenize definitely has some bugs (that or the tokenizer has some assumptions and lost state info, maybe both)</p>



<a name="499881300"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20fuzzing/near/499881300" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Warner <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20fuzzing.html#499881300">(Feb 15 2025 at 04:46)</a>:</h4>
<p>What command should I be running to kick off fuzzing?</p>



<a name="499881342"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20fuzzing/near/499881342" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Warner <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20fuzzing.html#499881342">(Feb 15 2025 at 04:47)</a>:</h4>
<div class="codehilite"><pre><span></span><code>joshw@Joshuas-MacBook-Air-3 ~/s/g/r/roc (parser-zig-rewrite)&gt; zig build -Dllvm -Dfuzz
joshw@Joshuas-MacBook-Air-3 ~/s/g/r/roc (parser-zig-rewrite)&gt; ./zig-out/bin/fuzz-cli
[-] FATAL: forkserver is already up, but an instrumented dlopen() library loaded afterwards. You must AFL_PRELOAD such libraries to be able to fuzz them or LD_PRELOAD to run outside of afl-fuzz.
To ignore this set AFL_IGNORE_PROBLEMS=1 but this will lead to ambiguous coverage data.
In addition, you can set AFL_IGNORE_PROBLEMS_COVERAGE=1 to ignore the additional coverage instead (use with caution!).
fish: Job 1, &#39;./zig-out/bin/fuzz-cli&#39; terminated by signal SIGABRT (Abort)
</code></pre></div>



<a name="499881451"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20fuzzing/near/499881451" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20fuzzing.html#499881451">(Feb 15 2025 at 04:49)</a>:</h4>
<p><code>./zig-out/AFLplusplus/bin/afl-fuzz -i src/fuzz/tokenize-corpus/ -o /tmp/tokenize-out/ zig-out/bin/fuzz-tokenize </code></p>



<a name="499881537"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20fuzzing/near/499881537" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20fuzzing.html#499881537">(Feb 15 2025 at 04:50)</a>:</h4>
<p>also, you don't need <code>-Dllvm</code>, but you do need a system install version of llvm for afl++ to compile. Sadly, I was unable to get afl++ to compile with static llvm (might have to loop back to that at another point)</p>



<a name="499882069"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20fuzzing/near/499882069" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20fuzzing.html#499882069">(Feb 15 2025 at 04:59)</a>:</h4>
<p>Oh also, even without afl and all that hassle, you can <code>zig build test -Dfuzz</code> and it will build a <code>repro-tokenize</code> file.  That file can take data from stdin, or a file arg and use it to reproduce directly. It also prints out a lot more info</p>



<a name="499882456"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20fuzzing/near/499882456" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Warner <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20fuzzing.html#499882456">(Feb 15 2025 at 05:05)</a>:</h4>
<p>Hmm, having a little trouble adapting this to Anthony's changes.</p>
<p><code>zig build test</code> works, but not <code>zig build fuzz-tokenize</code>.</p>
<p>Does this make sense to you?</p>
<div class="codehilite"><pre><span></span><code>fuzz-tokenize
└─ install generated to repro-tokenize
   └─ zig build-exe repro-tokenize Debug native 1 errors
tokenize.zig:3:27: error: import of file outside module path: &#39;../../collections/utils.zig&#39;
const exitOnOom = @import(&quot;../../collections/utils.zig&quot;).exitOnOom;
                          ^~~~~~~~~~~~~~~~~~~~~~~~~~~~~
referenced by:
    tokenize: tokenize.zig:981:53
    zig_fuzz_test_inner: /Users/joshw/src/github.com/roc-lang/roc/src/fuzz/tokenize.zig:500:14
    remaining reference traces hidden; use &#39;-freference-trace&#39; to see all reference traces
</code></pre></div>



<a name="499882552"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20fuzzing/near/499882552" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20fuzzing.html#499882552">(Feb 15 2025 at 05:06)</a>:</h4>
<p>Ah, yeah. It's this todo: <a href="https://github.com/roc-lang/roc/blob/33a2c663e00c9309624978913a4f9ade3e66113f/build.zig#L111-L113">https://github.com/roc-lang/roc/blob/33a2c663e00c9309624978913a4f9ade3e66113f/build.zig#L111-L113</a></p>



<a name="499882564"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20fuzzing/near/499882564" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20fuzzing.html#499882564">(Feb 15 2025 at 05:06)</a>:</h4>
<p>Feel free to comment out the tokenizer test for now.</p>



<a name="499882613"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20fuzzing/near/499882613" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20fuzzing.html#499882613">(Feb 15 2025 at 05:07)</a>:</h4>
<p>I'll fix it up in a bit</p>



<a name="499882712"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20fuzzing/near/499882712" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20fuzzing.html#499882712">(Feb 15 2025 at 05:09)</a>:</h4>
<p>technically, moving all fuzz executables to <code>src/fuzz-tokenize.zig</code> and using relative imports would fix this. Otherwise, we need something like<code>src/lib.zig</code> and have all the fuzz executables go through that.</p>



<a name="499882800"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20fuzzing/near/499882800" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20fuzzing.html#499882800">(Feb 15 2025 at 05:10)</a>:</h4>
<p>The issues is that if you directly import <code>src/check/parse/tokenize.zig</code> as your root module file, it is only allowed to import things form <code>src/check/parse/...</code></p>



<a name="499882847"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20fuzzing/near/499882847" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Warner <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20fuzzing.html#499882847">(Feb 15 2025 at 05:11)</a>:</h4>
<p>Interesting. Confusingly, that isn't the first such import in that file. But I guess it must be processing things out of order or something</p>



<a name="499882858"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20fuzzing/near/499882858" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Warner <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20fuzzing.html#499882858">(Feb 15 2025 at 05:12)</a>:</h4>
<p>And here I was looking forward to fuzzing the tokenizer :P</p>



<a name="499882897"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20fuzzing/near/499882897" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20fuzzing.html#499882897">(Feb 15 2025 at 05:12)</a>:</h4>
<p>Anyway, feel free to just disable, not exactly sure when I will next have time to look at it, but I'll fix it up if no one else does first. Just gonna be flying tomorrow, so not sure timing.</p>



<a name="499882907"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20fuzzing/near/499882907" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Warner <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20fuzzing.html#499882907">(Feb 15 2025 at 05:12)</a>:</h4>
<p>Which test should I be commenting out?</p>



<a name="499882918"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20fuzzing/near/499882918" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20fuzzing.html#499882918">(Feb 15 2025 at 05:12)</a>:</h4>
<p><a href="https://github.com/roc-lang/roc/blob/33a2c663e00c9309624978913a4f9ade3e66113f/build.zig#L125-L138">https://github.com/roc-lang/roc/blob/33a2c663e00c9309624978913a4f9ade3e66113f/build.zig#L125-L138</a></p>



<a name="499973152"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20fuzzing/near/499973152" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20fuzzing.html#499973152">(Feb 16 2025 at 03:14)</a>:</h4>
<p>Fix the fuzz tests: <a href="https://github.com/roc-lang/roc/pull/7612">https://github.com/roc-lang/roc/pull/7612</a></p>



<a name="499973297"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20fuzzing/near/499973297" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20fuzzing.html#499973297">(Feb 16 2025 at 03:16)</a>:</h4>
<p>Also adds a readme!</p>



<a name="500025322"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20fuzzing/near/500025322" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20fuzzing.html#500025322">(Feb 16 2025 at 16:53)</a>:</h4>
<p>Looks like we had our first merge conflict. Something simple, tokenize fuzzer got fixed and merged at the same time the tokenize function got updated to have malformed nodes. So now the fuzzer doesn't handle reprinting any of the malformed nodes.</p>
<p>I don't currently have time to work on this. cc <span class="user-mention" data-user-id="453336">@Joshua Warner</span> in case he has time. He probably can add printing for the malformed nodes quicker than anyone else cause he knows what they are all.</p>
<p>Otherwise, anyone can fix my just handing a few extra cases in a switch statement. That or for now, giving them empty handling just to unblock merging a PR.</p>



<a name="500029576"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20fuzzing/near/500029576" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Warner <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20fuzzing.html#500029576">(Feb 16 2025 at 17:44)</a>:</h4>
<p><a href="https://github.com/roc-lang/roc/pull/7617">https://github.com/roc-lang/roc/pull/7617</a></p>



<a name="500029887"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20fuzzing/near/500029887" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Warner <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20fuzzing.html#500029887">(Feb 16 2025 at 17:48)</a>:</h4>
<p>Right now this just bails out. The slightly better approach would be to copy the corresponding range in the input, and even better would be making sure we have enough information to trigger the same issue.</p>



<a name="500030517"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20fuzzing/near/500030517" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20fuzzing.html#500030517">(Feb 16 2025 at 17:57)</a>:</h4>
<p>Yep. Sounds totally good</p>



<a name="500045397"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20fuzzing/near/500045397" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20fuzzing.html#500045397">(Feb 16 2025 at 21:10)</a>:</h4>
<p>Also, <span class="user-mention" data-user-id="453336">@Joshua Warner</span>, not sure it is the best use of time, but I think the fuzzer is now at the state where it finds reasonable tokenizer bugs. Some may be in the reprint, but I think a lot are due to minor mistakes around exact token type such that when reprinted in basic form it leads to bugs.</p>



<a name="500047968"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20fuzzing/near/500047968" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Warner <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20fuzzing.html#500047968">(Feb 16 2025 at 21:48)</a>:</h4>
<p>Cool, will take a look in a bit</p>



<a name="502639157"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20fuzzing/near/502639157" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Isaac Van Doren <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20fuzzing.html#502639157">(Feb 28 2025 at 18:17)</a>:</h4>
<p>Great talk about Tigerbeetle's fuzzing setup. Maybe there are some aspects we could adopt for Roc. <a href="https://www.hytradboi.com/2025/c222d11a-6f4d-4211-a243-f5b7fafc8d79-rocket-science-of-simulation-testing">https://www.hytradboi.com/2025/c222d11a-6f4d-4211-a243-f5b7fafc8d79-rocket-science-of-simulation-testing</a></p>



<a name="502649756"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20fuzzing/near/502649756" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20fuzzing.html#502649756">(Feb 28 2025 at 19:16)</a>:</h4>
<p>Yep</p>



<a name="502649843"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20fuzzing/near/502649843" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20fuzzing.html#502649843">(Feb 28 2025 at 19:17)</a>:</h4>
<p>Sounds like they are mostly solving the continuous fuzzing case.</p>



<a name="502649889"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20fuzzing/near/502649889" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20fuzzing.html#502649889">(Feb 28 2025 at 19:17)</a>:</h4>
<p>Which may be less important for roc, but still useful to gleam from</p>



<a name="502683106"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20fuzzing/near/502683106" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Andrew Kelley <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20fuzzing.html#502683106">(Feb 28 2025 at 23:15)</a>:</h4>
<p>that was a great talk, it finally clicked for me the "level triggered" vs "edge triggered" thing. based on your comment Brendan I think that point might not have sunk in for you yet</p>



<a name="502686226"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20fuzzing/near/502686226" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20fuzzing.html#502686226">(Feb 28 2025 at 23:48)</a>:</h4>
<p>I only quickly skimmed it cause today has been busy, need to give it a proper watch still.</p>



<a name="502692201"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20fuzzing/near/502692201" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20fuzzing.html#502692201">(Mar 01 2025 at 00:51)</a>:</h4>
<p>I think most initial statement still mostly stands. It isn't that async level triggered setup wouldn't be great. It is more that roc is still super early on with limited resources and fuzzing only run on local machines. Long term, I would love to have a similar setup, but currently fuzzing is local only for roc and not tied to CI at all. That said, maybe grabbing a single machine and setting up what tigerbeetled did wouldn't be as much work as I expect. Just feels like a large investment in infra than roc is ready for. Especially given somehow you would prefer to notify folks asyncronously on fuzzing failures and don't want too much of a backlog to build up.</p>
<p>But I definitely might be making a mountain out of a mole hill, they made it look relatively simply to orchestrate all of this.</p>



<a name="502696147"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20fuzzing/near/502696147" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20fuzzing.html#502696147">(Mar 01 2025 at 01:37)</a>:</h4>
<blockquote>
<p>Just feels like a large investment in infra than roc is ready for</p>
</blockquote>
<p>I have a linux "server" sitting at home that I'm happy to leave running a fuzzer full-time</p>



<a name="502696208"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20fuzzing/near/502696208" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20fuzzing.html#502696208">(Mar 01 2025 at 01:38)</a>:</h4>
<p>Not sure if that is the kind of infra you're referring to, but happy to offer that if it helps</p>



<a name="502696349"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20fuzzing/near/502696349" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20fuzzing.html#502696349">(Mar 01 2025 at 01:40)</a>:</h4>
<p>Yeah, that is part of it</p>



<a name="502696384"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20fuzzing/near/502696384" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20fuzzing.html#502696384">(Mar 01 2025 at 01:40)</a>:</h4>
<p>Then it is just extra ci flows, website or notifications for failures, and orchestration code.</p>



<a name="502703931"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20fuzzing/near/502703931" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Isaac Van Doren <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20fuzzing.html#502703931">(Mar 01 2025 at 03:15)</a>:</h4>
<blockquote>
<p>and don't want too much of a backlog to build up.</p>
</blockquote>
<p>One of the suggestions of the talk was to not worry about keeping old failing seeds around indefinitely but only keep the N most recent seeds and rely on the fact that unresolved issues will be found again.</p>



<a name="502705077"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20fuzzing/near/502705077" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20fuzzing.html#502705077">(Mar 01 2025 at 03:29)</a>:</h4>
<p>Yeah, sounds like most of the work is a minor database and a web frontend for that (along with a CI machine to run things)</p>



<a name="502705127"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20fuzzing/near/502705127" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20fuzzing.html#502705127">(Mar 01 2025 at 03:30)</a>:</h4>
<p>So not too bad</p>



<a name="502705191"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20fuzzing/near/502705191" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20fuzzing.html#502705191">(Mar 01 2025 at 03:31)</a>:</h4>
<p>Also, we use a corpus based method which has implications for multi machine setups, but I think roc can just do a single machine setup which would avoid much of that hassle.</p>



<a name="502705666"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20fuzzing/near/502705666" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20fuzzing.html#502705666">(Mar 01 2025 at 03:37)</a>:</h4>
<p>Given we do coverage guide fuzzing, I don't think we can have a single integer seed. I think our inputs will remain a blob of text. So not as portable. I guess we could minimize and base64 encode them to at least make them trivial to copy.</p>



<a name="502707054"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20fuzzing/near/502707054" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20fuzzing.html#502707054">(Mar 01 2025 at 03:57)</a>:</h4>
<p>Yeah, maybe this is less work than I initially thought, maybe I'll try to hack something crazy simple together.</p>



<a name="502811904"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20fuzzing/near/502811904" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20fuzzing.html#502811904">(Mar 02 2025 at 02:38)</a>:</h4>
<p>Has anyone managed to run our fuzzer on linux? I am trying to but keep hitting linking issues. Wondering if it may be distro/config specific.</p>



<a name="502826131"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20fuzzing/near/502826131" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20fuzzing.html#502826131">(Mar 02 2025 at 05:57)</a>:</h4>
<p>I haven't tried tbh</p>



<a name="502826148"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20fuzzing/near/502826148" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20fuzzing.html#502826148">(Mar 02 2025 at 05:57)</a>:</h4>
<p>Actually I did early on, but could get it working either</p>



<a name="502933019"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20fuzzing/near/502933019" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20fuzzing.html#502933019">(Mar 03 2025 at 03:38)</a>:</h4>
<p>Small PR that enabled me to get fuzzing working on linux (though sadly with system install AFL instead of zig compiled AFL): <a href="https://github.com/roc-lang/roc/pull/7651">https://github.com/roc-lang/roc/pull/7651</a></p>



<a name="503443462"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20fuzzing/near/503443462" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20fuzzing.html#503443462">(Mar 05 2025 at 07:48)</a>:</h4>
<p>Please ignore the absolute ugliness of this site: <a href="https://roc-lang.github.io/roc-compiler-fuzz/">https://roc-lang.github.io/roc-compiler-fuzz/</a></p>



<a name="503447687"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20fuzzing/near/503447687" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20fuzzing.html#503447687">(Mar 05 2025 at 08:14)</a>:</h4>
<p>This will be really nice, looking forward to building fuzzers and getting some high scores <span aria-label="grinning face with smiling eyes" class="emoji emoji-1f601" role="img" title="grinning face with smiling eyes">:grinning_face_with_smiling_eyes:</span></p>



<a name="503520977"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20fuzzing/near/503520977" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Isaac Van Doren <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20fuzzing.html#503520977">(Mar 05 2025 at 13:51)</a>:</h4>
<p>Wow awesome!</p>



<a name="503526989"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20fuzzing/near/503526989" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20fuzzing.html#503526989">(Mar 05 2025 at 14:12)</a>:</h4>
<p>yooooo this is sweet!!!</p>



<a name="503642950"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20fuzzing/near/503642950" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20fuzzing.html#503642950">(Mar 05 2025 at 22:01)</a>:</h4>
<p>Also, that site is happily taking contributions if anyone wants to make it pretty.</p>



<a name="503643738"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20fuzzing/near/503643738" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20fuzzing.html#503643738">(Mar 05 2025 at 22:05)</a>:</h4>
<p>Aside, I really love minimized repros:</p>
<div class="codehilite"><pre><span></span><code>zig build repro-tokenize -- -b YW5k -v
</code></pre></div>
<p>This is just passing <code>and</code> to our tokenizer. Which breaks cause we assume that <code>and</code> is <code>&amp;&amp;</code>.</p>
<p>CC: <span class="user-mention" data-user-id="453336">@Joshua Warner</span> real tokenizer bugs likely will pop up at that site (though some are with the fuzz harness as well).</p>
<p>Now we just need more fuzzers to start exploring more of the code.</p>



<a name="503686578"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20fuzzing/near/503686578" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20fuzzing.html#503686578">(Mar 06 2025 at 03:55)</a>:</h4>
<p><span class="user-mention" data-user-id="343810">@Brendan Hansknecht</span> -- how does the <code>src/fuzz-corpus/parse/grab_bag.roc</code> work?</p>



<a name="503686654"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20fuzzing/near/503686654" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20fuzzing.html#503686654">(Mar 06 2025 at 03:56)</a>:</h4>
<p>Is that something that the fuzzer will use to start with... and then randomly modify?</p>



<a name="503686678"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20fuzzing/near/503686678" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20fuzzing.html#503686678">(Mar 06 2025 at 03:56)</a>:</h4>
<p>Yeah, we are required to give the fuzzer at least one seed</p>



<a name="503686699"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20fuzzing/near/503686699" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20fuzzing.html#503686699">(Mar 06 2025 at 03:56)</a>:</h4>
<p>That test case seemed reasonable to me</p>



<a name="503686756"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20fuzzing/near/503686756" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20fuzzing.html#503686756">(Mar 06 2025 at 03:57)</a>:</h4>
<p>Also, currently parsing helloworld hangs and I didn't want to figure out fixing it. So I just used something different</p>



<a name="503686776"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20fuzzing/near/503686776" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20fuzzing.html#503686776">(Mar 06 2025 at 03:57)</a>:</h4>
<p>Nice. Does it help being large with everything in there together? I wonder if it would be better to have multiple files with simpler syntax?</p>



<a name="503686910"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20fuzzing/near/503686910" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20fuzzing.html#503686910">(Mar 06 2025 at 03:58)</a>:</h4>
<p>I was also wanting something similar for the snapshot tests... so I'm wondering if these things could/should be combined somehow. </p>
<p>But they are also quite different use cases so probably should be kept different.</p>



<a name="503686936"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20fuzzing/near/503686936" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20fuzzing.html#503686936">(Mar 06 2025 at 03:59)</a>:</h4>
<p>The fuzzer does a really good job at exploring especially cause I enabled <code>cmplog</code> in ci. It leads to llvm telling the fuzzer all values that are used in comparisons (strings, ints, etc). So starting corpus isn't too imporant.</p>
<p>In CI, the fuzzer with cache the corpus and keep growing it.</p>



<a name="503687145"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20fuzzing/near/503687145" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20fuzzing.html#503687145">(Mar 06 2025 at 04:01)</a>:</h4>
<p>Yeah, fuzzers theoretically could share with snapshot tests (probably a good idea to ensure valid inputs). Would just need a tool to generate a corpus from the snapshots. For example, the tokenizer and parser fuzzers both use <code>.roc</code> files as input. So a script to extract all the original source from the snapshot test cases would create an amazing starting corpus for those fuzzers.</p>



<a name="503687292"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20fuzzing/near/503687292" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20fuzzing.html#503687292">(Mar 06 2025 at 04:02)</a>:</h4>
<p>If later fuzzers start with sexpr IR, sharing would also be nice, but likely more complex.</p>



<a name="503687330"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20fuzzing/near/503687330" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20fuzzing.html#503687330">(Mar 06 2025 at 04:02)</a>:</h4>
<p>Nice. I looks like we've already got a fairly solid testing framework emerging...</p>
<ul>
<li>zig unit tests</li>
<li>snapshots for integration tests </li>
<li>fuzzers for simulation testing</li>
</ul>



<a name="503687341"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20fuzzing/near/503687341" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20fuzzing.html#503687341">(Mar 06 2025 at 04:02)</a>:</h4>
<p>(depending if the fuzzers parse the sexpr or programmatically generate it)</p>



<a name="503687405"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20fuzzing/near/503687405" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20fuzzing.html#503687405">(Mar 06 2025 at 04:03)</a>:</h4>
<p>I could definitely have the snapshot tool extract the roc source from each snapshot and dump it into a fuzzer corpus folder somewhere</p>



<a name="503687572"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20fuzzing/near/503687572" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20fuzzing.html#503687572">(Mar 06 2025 at 04:05)</a>:</h4>
<blockquote>
<p>for simulation testing</p>
</blockquote>
<p>I'm not sure our fuzzing is simulation testing cause nothing is simulated, but none the less is great automatic bug finding.</p>



<a name="503687702"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20fuzzing/near/503687702" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20fuzzing.html#503687702">(Mar 06 2025 at 04:06)</a>:</h4>
<blockquote>
<p>I could definitely have the snapshot tool extract the roc source from each snapshot and dump it into a fuzzer corpus folder somewhere</p>
</blockquote>
<p>That would be great. If you just add a flag to the snapshot tool to dump all the <code>.roc</code> files into a folder, I'll integrate that into the fuzz CI.</p>



<a name="503688942"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20fuzzing/near/503688942" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20fuzzing.html#503688942">(Mar 06 2025 at 04:16)</a>:</h4>
<p>I'll do that in my next PR</p>



<a name="503688987"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20fuzzing/near/503688987" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20fuzzing.html#503688987">(Mar 06 2025 at 04:17)</a>:</h4>
<blockquote>
<p>nothing is simulated</p>
</blockquote>
<p>We're simulating the source file that is being parsed...</p>



<a name="503689575"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20fuzzing/near/503689575" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20fuzzing.html#503689575">(Mar 06 2025 at 04:21)</a>:</h4>
<p>haha, I guess. I've always associated simulation testing with fake networks and databases and disks and what not.</p>



<a name="503690297"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20fuzzing/near/503690297" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20fuzzing.html#503690297">(Mar 06 2025 at 04:27)</a>:</h4>
<p>Hopefully we can move up the stack someday, and simulate more interesting things... like here's a (generated) expression that should evaluate to some expected value.</p>



<a name="503691439"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20fuzzing/near/503691439" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20fuzzing.html#503691439">(Mar 06 2025 at 04:34)</a>:</h4>
<p>Will be interesting to see how far we can take it and what still explores well. At a minimum, we should be able to do repl style expressions.</p>



<a name="503691474"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20fuzzing/near/503691474" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20fuzzing.html#503691474">(Mar 06 2025 at 04:35)</a>:</h4>
<p>but not sure how well the fuzzer will explore that (and also have to be careful about infinite loops)</p>



<a name="503698553"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20fuzzing/near/503698553" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20fuzzing.html#503698553">(Mar 06 2025 at 05:21)</a>:</h4>
<p>Do you think it's ok for the snapshots to be copied in all at the same level... or would you want them to maintain whatever folder structure they had from the <code>snapshots/</code> folder?</p>



<a name="503698601"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20fuzzing/near/503698601" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20fuzzing.html#503698601">(Mar 06 2025 at 05:22)</a>:</h4>
<p>When copying them into the corpus folder given as an argument to the snapshot tool</p>



<a name="503698947"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20fuzzing/near/503698947" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20fuzzing.html#503698947">(Mar 06 2025 at 05:24)</a>:</h4>
<p>Same level is preferred</p>



<a name="503699062"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20fuzzing/near/503699062" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20fuzzing.html#503699062">(Mar 06 2025 at 05:25)</a>:</h4>
<p>Should I give them a psuedo random name... or basically keep whatever they came with</p>



<a name="503699273"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20fuzzing/near/503699273" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Warner <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20fuzzing.html#503699273">(Mar 06 2025 at 05:26)</a>:</h4>
<p>We should probably keep the name; otherwise as we modify the snapshots we won't know which one they match up to (and thus which one to edit).</p>



<a name="503699434"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20fuzzing/near/503699434" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Warner <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20fuzzing.html#503699434">(Mar 06 2025 at 05:27)</a>:</h4>
<p>If we used something like the hash of the content, then it'd be hard to know which fuzz corpus we should _remove_ because it's the old version of that input. Otherwise old inputs would keep piling up as fuzz corpus entries, and that's probably not super valuable.</p>



<a name="503699708"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20fuzzing/near/503699708" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20fuzzing.html#503699708">(Mar 06 2025 at 05:29)</a>:</h4>
<p>I don't want to check these into the repo</p>



<a name="503699731"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20fuzzing/near/503699731" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20fuzzing.html#503699731">(Mar 06 2025 at 05:29)</a>:</h4>
<p>Let's keep just the snapshots as the source of truth</p>



<a name="503699741"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20fuzzing/near/503699741" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20fuzzing.html#503699741">(Mar 06 2025 at 05:29)</a>:</h4>
<p>For fuzzer, hash or random name is fine</p>



<a name="503699833"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20fuzzing/near/503699833" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20fuzzing.html#503699833">(Mar 06 2025 at 05:30)</a>:</h4>
<p>That's at least my default opinion for this</p>



<a name="503700058"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20fuzzing/near/503700058" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Warner <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20fuzzing.html#503700058">(Mar 06 2025 at 05:31)</a>:</h4>
<p>Ahhh got it</p>



<a name="503700105"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20fuzzing/near/503700105" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Warner <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20fuzzing.html#503700105">(Mar 06 2025 at 05:32)</a>:</h4>
<p>In that case I'd do hash, but whatever is fine.</p>



<a name="503860583"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20fuzzing/near/503860583" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20fuzzing.html#503860583">(Mar 06 2025 at 18:18)</a>:</h4>
<p>Hardcore test case: <code>zig build repro-parse -- -b ''</code></p>
<p>Break the parser with an empty string (we just have an incorrect assert that assumes parsing will generate something).</p>



<a name="503869322"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20fuzzing/near/503869322" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20fuzzing.html#503869322">(Mar 06 2025 at 19:04)</a>:</h4>
<p>As a general note, we have the ability to trigger the fuzzer targetting any branch/commit. So if you ever want a PR to get fuzzed, we can do that.</p>



<a name="503905890"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20fuzzing/near/503905890" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20fuzzing.html#503905890">(Mar 06 2025 at 22:45)</a>:</h4>
<p>Looking at the snapshot tool, with the flag to copy source into our fuzz corpus. <br>
One issue is giving the files a <code>.roc</code> extension is that now git wants to commit them to our repo...</p>
<div class="codehilite"><pre><span></span><code>Untracked files:
  (use &quot;git add &lt;file&gt;...&quot; to include in what will be committed)
    src/fuzz-corpus/cupgstzv.roc
    src/fuzz-corpus/hdddlnro.roc
    src/fuzz-corpus/kbdtxaol.roc
    src/fuzz-corpus/tmtpdcnw.roc
    src/fuzz-corpus/ufzxxvfu.roc
</code></pre></div>
<p>Do you think we should;</p>
<ol>
<li>leave these files without an extension</li>
<li>give them some made up ext like <code>.snap</code> or something</li>
<li>gitignore all files in <code>/src/fuzz-corpus/</code>, and if we want to add something there we need to <code>git add</code> it manually</li>
</ol>



<a name="503906039"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20fuzzing/near/503906039" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20fuzzing.html#503906039">(Mar 06 2025 at 22:46)</a>:</h4>
<p>I'm leaning towards (3) -- so I'll run with that for now in my draft PR</p>



<a name="503916821"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20fuzzing/near/503916821" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20fuzzing.html#503916821">(Mar 07 2025 at 00:03)</a>:</h4>
<p>Yeah, 3 sounds good</p>



<a name="503938533"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20fuzzing/near/503938533" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20fuzzing.html#503938533">(Mar 07 2025 at 03:19)</a>:</h4>
<p>So it runs all the different fuzzers every 4 hours, but only if theres a new commit?</p>



<a name="503938719"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20fuzzing/near/503938719" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20fuzzing.html#503938719">(Mar 07 2025 at 03:21)</a>:</h4>
<p>I've just noticed the scheduled runs have skipped the actual fuzz run.</p>



<a name="503938944"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20fuzzing/near/503938944" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20fuzzing.html#503938944">(Mar 07 2025 at 03:23)</a>:</h4>
<p>Yeah, I messed something up. Should be fixed already</p>



<a name="503939036"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20fuzzing/near/503939036" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20fuzzing.html#503939036">(Mar 07 2025 at 03:24)</a>:</h4>
<p>And yeah, runs every 4 hours for 30 minutes. Seemed like a reasonable cadence for now. Will keep fuzzing the same commit and expanding the corpus if no new commits exist.</p>



<a name="503944961"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20fuzzing/near/503944961" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20fuzzing.html#503944961">(Mar 07 2025 at 04:23)</a>:</h4>
<p><span class="user-mention silent" data-user-id="343810">Brendan Hansknecht</span> <a href="#narrow/channel/395097-compiler-development/topic/zig.20compiler.20-.20fuzzing/near/503860583">said</a>:</p>
<blockquote>
<p>Hardcore test case: <code>zig build repro-parse -- -b ''</code></p>
<p>Break the parser with an empty string (we just have an incorrect assert that assumes parsing will generate something).</p>
</blockquote>
<p>Does it count as a real bugfix if I resolve this one? <span aria-label="sweat smile" class="emoji emoji-1f605" role="img" title="sweat smile">:sweat_smile:</span></p>



<a name="503945785"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20fuzzing/near/503945785" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20fuzzing.html#503945785">(Mar 07 2025 at 04:31)</a>:</h4>
<p>As we say in the smash bros community, "we take those"</p>



<a name="503953314"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20fuzzing/near/503953314" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20fuzzing.html#503953314">(Mar 07 2025 at 05:41)</a>:</h4>
<p><span class="user-mention" data-user-id="343810">@Brendan Hansknecht</span> -- how did you install LLVM on your mac?</p>



<a name="503953331"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20fuzzing/near/503953331" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20fuzzing.html#503953331">(Mar 07 2025 at 05:41)</a>:</h4>
<p>Did you use brew?</p>



<a name="503953689"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20fuzzing/near/503953689" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20fuzzing.html#503953689">(Mar 07 2025 at 05:45)</a>:</h4>
<p>I'm going to try the release from LLVM's github instead and see if I can get fuzzing working on my macos</p>



<a name="503954091"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20fuzzing/near/503954091" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20fuzzing.html#503954091">(Mar 07 2025 at 05:49)</a>:</h4>
<p>I just used brew</p>



<a name="503954108"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20fuzzing/near/503954108" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20fuzzing.html#503954108">(Mar 07 2025 at 05:49)</a>:</h4>
<p>Also, you don't need llvm and afl to run the repro</p>



<a name="503954121"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20fuzzing/near/503954121" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20fuzzing.html#503954121">(Mar 07 2025 at 05:49)</a>:</h4>
<p>That repro should work for everyone with only zig as a dep</p>



<a name="503954789"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20fuzzing/near/503954789" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20fuzzing.html#503954789">(Mar 07 2025 at 05:56)</a>:</h4>
<p>Yeah repro is fine... I was wanting to run the fuzzer</p>



<a name="503954797"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20fuzzing/near/503954797" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20fuzzing.html#503954797">(Mar 07 2025 at 05:57)</a>:</h4>
<p>I couldn't get the brew version working.</p>



<a name="503954827"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20fuzzing/near/503954827" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20fuzzing.html#503954827">(Mar 07 2025 at 05:57)</a>:</h4>
<p>I've tried with a downloaded LLVM... and providing the path but having trouble with that too</p>



<a name="503957386"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20fuzzing/near/503957386" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20fuzzing.html#503957386">(Mar 07 2025 at 06:19)</a>:</h4>
<p>Hey got it working using brew... <span aria-label="tada" class="emoji emoji-1f389" role="img" title="tada">:tada:</span></p>



<a name="503957425"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20fuzzing/near/503957425" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20fuzzing.html#503957425">(Mar 07 2025 at 06:19)</a>:</h4>
<p>Needed to add <code>export PATH=$PATH:/opt/homebrew/opt/llvm@18/bin</code> to my zshrc so it could find brew's <code>llvm-config</code></p>



<a name="503957838"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20fuzzing/near/503957838" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20fuzzing.html#503957838">(Mar 07 2025 at 06:23)</a>:</h4>
<p>Got it running with </p>
<div class="codehilite"><pre><span></span><code>$ ./zig-out/AFLplusplus/bin/afl-fuzz -i src/fuzz-corpus/parse -o /tmp/fuzz-parse-out zig-out/bin/fuzz-parse
</code></pre></div>



<a name="503957898"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20fuzzing/near/503957898" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20fuzzing.html#503957898">(Mar 07 2025 at 06:24)</a>:</h4>
<p><a href="/user_uploads/22008/_3Tnud5Ot4Huq0zYh8jf_pMD/Screenshot-2025-03-07-at-17.23.53.png">Screenshot 2025-03-07 at 17.23.53.png</a></p>
<div class="message_inline_image"><a href="/user_uploads/22008/_3Tnud5Ot4Huq0zYh8jf_pMD/Screenshot-2025-03-07-at-17.23.53.png" title="Screenshot 2025-03-07 at 17.23.53.png"><img data-original-content-type="image/png" data-original-dimensions="1476x1044" src="/user_uploads/thumbnail/22008/_3Tnud5Ot4Huq0zYh8jf_pMD/Screenshot-2025-03-07-at-17.23.53.png/840x560.webp"></a></div>



<a name="504326041"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20fuzzing/near/504326041" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20fuzzing.html#504326041">(Mar 08 2025 at 22:58)</a>:</h4>
<p>My new commands to use the fuzzer with zig 0.14.0, thank you <span class="user-mention" data-user-id="343810">@Brendan Hansknecht</span> for helping me workaround my issues to get back online fuzzing again</p>
<div class="codehilite"><pre><span></span><code>// for some reason homebrew llvm isn&#39;t working, but system -afl is...
brew install afl++

zig build -Dfuzz -Dsystem-afl
zig build snapshot -- --fuzz-corpus ./src/fuzz-corpus/
afl-fuzz -i ./src/fuzz-corpus/ -o /tmp/corpus zig-out/bin/fuzz-parse
</code></pre></div>



<a name="504327085"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20fuzzing/near/504327085" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20fuzzing.html#504327085">(Mar 08 2025 at 23:09)</a>:</h4>
<p>My best guess is that there is a bug with this build script: <a href="https://github.com/allyourcodebase/AFLplusplus">https://github.com/allyourcodebase/AFLplusplus</a></p>
<p>As such, system afl is required instead of using zig built afl. Might just be some form of version overlap issue and not an issue with the actual build script. Need to do more testing at some point.</p>



<a name="504327351"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20fuzzing/near/504327351" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20fuzzing.html#504327351">(Mar 08 2025 at 23:13)</a>:</h4>
<p>how, might just be that we need to wait for aflplusplus to update to <a href="https://github.com/allyourcodebase/AFLplusplus/tree/zig-0.14_afl_4.31c">zig-0.14_afl_4.31c</a></p>



<a name="504327362"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20fuzzing/near/504327362" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20fuzzing.html#504327362">(Mar 08 2025 at 23:13)</a>:</h4>
<p>maybe afl 21c doesn't work with newer zig</p>



<a name="504442155"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20fuzzing/near/504442155" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20fuzzing.html#504442155">(Mar 09 2025 at 23:17)</a>:</h4>
<p>I've got it down to a couple of seconds before we get a crash now... <span aria-label="tada" class="emoji emoji-1f389" role="img" title="tada">:tada:</span> (on the parser)</p>



<a name="504793430"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20fuzzing/near/504793430" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20fuzzing.html#504793430">(Mar 11 2025 at 10:07)</a>:</h4>
<p>New record for fuzz-parser - 2min, 23 sec before my first crash</p>



<a name="504797917"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20fuzzing/near/504797917" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20fuzzing.html#504797917">(Mar 11 2025 at 10:25)</a>:</h4>
<p>Let me get these headers done and hopefully that goes up</p>



<a name="504798009"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20fuzzing/near/504798009" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20fuzzing.html#504798009">(Mar 11 2025 at 10:26)</a>:</h4>
<p>Have you been posting the all of the crashing input?</p>



<a name="504803178"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20fuzzing/near/504803178" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20fuzzing.html#504803178">(Mar 11 2025 at 10:48)</a>:</h4>
<p>I've been making a new snapshot for each failure, which I think will help prevent against regressions and seed future fuzzing efforts.</p>



<a name="504803298"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20fuzzing/near/504803298" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20fuzzing.html#504803298">(Mar 11 2025 at 10:48)</a>:</h4>
<p>You can see all the ones I have so far in my PR <a href="https://github.com/roc-lang/roc/pull/7672">https://github.com/roc-lang/roc/pull/7672</a></p>



<a name="517381237"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20fuzzing/near/517381237" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20fuzzing.html#517381237">(May 11 2025 at 17:39)</a>:</h4>
<p>One fuzzing hang that comes up semi often is having a ton of <code>{</code> brackets. When Roc reformats that, it adds essentially infinite spaces due to indentation. This fails fuzzing due to the fuzzer thinking it is a hang.</p>
<p>For example, one fuzz failure I saw recently had ~7k <code>{</code> brackets. When formatted, that led to 92,910,578 spaces being printed. It is unsurprising that is too slow.</p>
<p>This leads me to a few questions:</p>
<ol>
<li>Should we have a limit to how nested of an expression can parse? Is allowing 7k+ levels of nesting ok?</li>
<li>Is the correct solution to tons of <code>{</code> brakects to just nest infinitely deep and have ridiculously long lines?</li>
<li>How can I avoid this hang in the fuzzer (hangs in general mean slower execution and worse fuzzing)?</li>
</ol>
<hr>
<p>I get that metric tons of <code>{</code> is contrived, but I think it is still best practice to consider and handle so we can maintain robust fuzzing.</p>



<a name="517382947"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20fuzzing/near/517382947" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20fuzzing.html#517382947">(May 11 2025 at 18:02)</a>:</h4>
<p>i think more than 100 levels of indentation is overkill</p>



<a name="517382974"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20fuzzing/near/517382974" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20fuzzing.html#517382974">(May 11 2025 at 18:02)</a>:</h4>
<p>let alone 7k+</p>



<a name="517383074"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20fuzzing/near/517383074" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20fuzzing.html#517383074">(May 11 2025 at 18:04)</a>:</h4>
<p>i would just just move indenting to a function that panics if it exceeds some limit</p>



<a name="517383096"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20fuzzing/near/517383096" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20fuzzing.html#517383096">(May 11 2025 at 18:04)</a>:</h4>
<p>or to be more graceful, returns a parse error and a malformed node</p>



<a name="517384534"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20fuzzing/near/517384534" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20fuzzing.html#517384534">(May 11 2025 at 18:24)</a>:</h4>
<p>Yeah, that is my thought, maybe after a certain level of nesting, we should just bail and return a parse error</p>



<a name="517388389"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20fuzzing/near/517388389" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20fuzzing.html#517388389">(May 11 2025 at 19:13)</a>:</h4>
<p>i could add that to my current PR unless it was already merged</p>



<a name="517559828"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20fuzzing/near/517559828" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20fuzzing.html#517559828">(May 12 2025 at 14:09)</a>:</h4>
<p>I would actually rather we handled this with a fuzzer change</p>



<a name="517559910"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20fuzzing/near/517559910" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20fuzzing.html#517559910">(May 12 2025 at 14:09)</a>:</h4>
<p>pathological parsing cases like this can come up irl in generated code</p>



<a name="517560074"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20fuzzing/near/517560074" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20fuzzing.html#517560074">(May 12 2025 at 14:09)</a>:</h4>
<p>where almost nobody notices, but then one person is totally blocked by it and has to try to make some complex workaround</p>



<a name="517560597"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20fuzzing/near/517560597" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20fuzzing.html#517560597">(May 12 2025 at 14:11)</a>:</h4>
<p>what kind of change would you like to see?  some sort of filter on the fuzz inputs?</p>



<a name="517560690"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20fuzzing/near/517560690" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20fuzzing.html#517560690">(May 12 2025 at 14:11)</a>:</h4>
<p>so if the payoff is something like "everyone gets faster builds" (e.g. u16 line counts instead of u32) I'm ok with that, but if the only problem is the fuzzer itself, I'd rather address this by changing the fuzzer than by changing the parser</p>



<a name="517560854"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20fuzzing/near/517560854" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20fuzzing.html#517560854">(May 12 2025 at 14:11)</a>:</h4>
<p>yeah something like that - I'm not sure what options would be best there!</p>



<a name="517561590"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20fuzzing/near/517561590" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20fuzzing.html#517561590">(May 12 2025 at 14:13)</a>:</h4>
<p>Fair enough. Though if we format exceptionally nested code to be deeply indented, it won't be readable either.</p>



<a name="517561721"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20fuzzing/near/517561721" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20fuzzing.html#517561721">(May 12 2025 at 14:14)</a>:</h4>
<p>a good thing to note is that if it's taking this level of complexity to crash the fuzzer we must be doing <em>something</em> pretty good</p>



<a name="517561896"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20fuzzing/near/517561896" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20fuzzing.html#517561896">(May 12 2025 at 14:14)</a>:</h4>
<p>We have some basic crashes too, but I think we are overall doing well.</p>



<a name="517562000"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20fuzzing/near/517562000" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20fuzzing.html#517562000">(May 12 2025 at 14:15)</a>:</h4>
<p>feel free to send basic crashes to me if they seem legit</p>



<a name="517564440"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20fuzzing/near/517564440" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20fuzzing.html#517564440">(May 12 2025 at 14:22)</a>:</h4>
<p><span class="user-mention silent" data-user-id="343810">Brendan Hansknecht</span> <a href="#narrow/stream/395097-compiler-development/topic/zig.20compiler.20-.20fuzzing/near/517561590">said</a>:</p>
<blockquote>
<p>Fair enough. Though if we format exceptionally nested code to be deeply indented, it won't be readable either.</p>
</blockquote>
<p>To be more concrete here. Formating this code to ident just slows down parsing. So if this would be coming from generated code that no one is expected to read, we would just be making the experience worse by making the file way latger and way slower to parse.</p>
<p>That said, I do agree that given this is a contrived example, limiting the fuzzer is reasonable too. In the fuzzer, I could pre scan for nesting depth and limit.</p>



<a name="517565136"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20fuzzing/near/517565136" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20fuzzing.html#517565136">(May 12 2025 at 14:24)</a>:</h4>
<p>Aside, we decided on tabs as the canonical form, right? So the formatter should be changed to use tabs for indentation instead of spaces?</p>



<a name="517567225"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20fuzzing/near/517567225" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20fuzzing.html#517567225">(May 12 2025 at 14:31)</a>:</h4>
<p>i didn't know that we made that decision but that should be easier</p>



<a name="517567343"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20fuzzing/near/517567343" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20fuzzing.html#517567343">(May 12 2025 at 14:31)</a>:</h4>
<p>that cuts the number of characters per indented line by on average 4</p>



<a name="517567568"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20fuzzing/near/517567568" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20fuzzing.html#517567568">(May 12 2025 at 14:32)</a>:</h4>
<p>so in that worst case example that's 7k tabs instead of 28k soaxes</p>



<a name="517567680"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20fuzzing/near/517567680" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20fuzzing.html#517567680">(May 12 2025 at 14:32)</a>:</h4>
<p>That might actually be longer than max fuzzer input length.</p>



<a name="517567721"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20fuzzing/near/517567721" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20fuzzing.html#517567721">(May 12 2025 at 14:32)</a>:</h4>
<p>So changing to tabs might actually remove the hangs</p>



<a name="517567779"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20fuzzing/near/517567779" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20fuzzing.html#517567779">(May 12 2025 at 14:32)</a>:</h4>
<p>sweet</p>



<a name="517567800"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20fuzzing/near/517567800" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20fuzzing.html#517567800">(May 12 2025 at 14:32)</a>:</h4>
<p>I think make is 8 or 16k</p>



<a name="517567840"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20fuzzing/near/517567840" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20fuzzing.html#517567840">(May 12 2025 at 14:33)</a>:</h4>
<p>i can make that change tomorrow</p>



<a name="517568043"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20fuzzing/near/517568043" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20fuzzing.html#517568043">(May 12 2025 at 14:33)</a>:</h4>
<p>should be just a few loc change</p>



<a name="517625082"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20fuzzing/near/517625082" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20fuzzing.html#517625082">(May 12 2025 at 18:10)</a>:</h4>
<p>Looks like this is a wee bit harder than I expected. Zig multiline string literals don't allow literal tabs - they recommend a (IMHO) pretty insane system of postprocessing strings at comptime to replace some other sigil in the string with a tab</p>



<a name="517625179"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20fuzzing/near/517625179" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20fuzzing.html#517625179">(May 12 2025 at 18:11)</a>:</h4>
<p><del>Also, there might be a tokenization error with tabs currently, but I'm not sure</del>  There is not.  Just an issue with Zig</p>



<a name="517629801"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20fuzzing/near/517629801" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20fuzzing.html#517629801">(May 12 2025 at 18:31)</a>:</h4>
<p>I'm pretty much going to need to move all parser tests that contain indentation out to snapshot files and make running snapshots more ergonomic during my development workflow</p>



<a name="517644689"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20fuzzing/near/517644689" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20fuzzing.html#517644689">(May 12 2025 at 19:38)</a>:</h4>
<p><img alt=":thinkies:" class="emoji" src="https://avatars.zulip.com/22008/emoji/images/9055c9eb.png" title="thinkies"> yikes</p>



<a name="517820995"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20fuzzing/near/517820995" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Fábio Beirão <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20fuzzing.html#517820995">(May 13 2025 at 12:45)</a>:</h4>
<p><span class="user-mention silent" data-user-id="781658">Anthony Bullard</span> <a href="#narrow/channel/395097-compiler-development/topic/zig.20compiler.20-.20fuzzing/near/517382947">said</a>:</p>
<blockquote>
<p>i think more than 100 levels of indentation is overkill</p>
</blockquote>
<p>To me this makes me think of the way that Elm's compiler refuses to have tuples with more than 3 elements, and gracefully explains the rationale to the user. <br>
It could probably be a selling point if Roc didn't allow for .. 10? 20? levels of nesting. I think nesting can always be managed with some refactoring. If the language itself would encourage this behavior from the early days, I think the global quality of Roc code would just increase. <br>
I can also see some "management selling points" when you can say that a language has built-in mandatory opinions about code complexity <span aria-label="sweat smile" class="emoji emoji-1f605" role="img" title="sweat smile">:sweat_smile:</span></p>



<a name="518320560"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20fuzzing/near/518320560" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20fuzzing.html#518320560">(May 15 2025 at 14:29)</a>:</h4>
<p><span class="user-mention" data-user-id="343810">@Brendan Hansknecht</span> Here's my PR on this <a href="https://github.com/roc-lang/roc/pull/7786">https://github.com/roc-lang/roc/pull/7786</a></p>



<a name="518424762"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20fuzzing/near/518424762" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20fuzzing.html#518424762">(May 16 2025 at 00:44)</a>:</h4>
<p>Addressed all review feedback</p>



<a name="518841712"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20fuzzing/near/518841712" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20fuzzing.html#518841712">(May 17 2025 at 18:21)</a>:</h4>
<p><span class="user-mention" data-user-id="781658">@Anthony Bullard</span> just to show you the most commonly found fuzz failure. It is a variant of:<br>
<code>zig build repro-parse -- -b MApmb3I= -v</code></p>
<p>Which in this case is:</p>
<div class="codehilite" data-code-language="CoffeeScript"><pre><span></span><code><span class="mi">0</span>
<span class="k">for</span>
</code></pre></div>
<p>Most of the failures hit this panic:</p>
<div class="codehilite"><pre><span></span><code>thread 26416288 panic: Should have gotten a valid pattern, pos=3 peek=EndOfFile

/Users/bren077s/Projects/roc/src/check/parse/Parser.zig:1266:24: 0x1050855c7 in parsePattern (repro-parse)
        std.debug.panic(&quot;Should have gotten a valid pattern, pos={d} peek={s}\n&quot;, .{ self.pos, @tagName(self.peek()) });
</code></pre></div>
<p>Probably an easy fix around EOF handling</p>



<a name="518842200"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20fuzzing/near/518842200" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20fuzzing.html#518842200">(May 17 2025 at 18:26)</a>:</h4>
<p>cool i can find a fix for this rep quick</p>



<a name="518842246"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20fuzzing/near/518842246" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20fuzzing.html#518842246">(May 17 2025 at 18:26)</a>:</h4>
<p>are we parsing this as a statement? expr? module?</p>



<a name="518842301"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20fuzzing/near/518842301" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20fuzzing.html#518842301">(May 17 2025 at 18:27)</a>:</h4>
<p>NVM i can just read the code <span aria-label="wink" class="emoji emoji-1f609" role="img" title="wink">:wink:</span></p>



<a name="518844129"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20fuzzing/near/518844129" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20fuzzing.html#518844129">(May 17 2025 at 18:47)</a>:</h4>
<p><a href="https://github.com/roc-lang/roc/pull/7792">https://github.com/roc-lang/roc/pull/7792</a> <span class="user-mention" data-user-id="343810">@Brendan Hansknecht</span></p>



<a name="526182121"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20fuzzing/near/526182121" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20fuzzing.html#526182121">(Jun 28 2025 at 06:21)</a>:</h4>
<p>I realised I could wire up our coordinate into the fuzzer really easily. </p>
<p>So I've been fuzzing the whole compiler pipeline (at least everything we have so far up to type checking)... and it's been really great so far.</p>



<a name="526186655"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20fuzzing/near/526186655" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20fuzzing.html#526186655">(Jun 28 2025 at 07:47)</a>:</h4>
<p>In case this helps anyone... here is how I'm running the fuzzer for the <code>roc check</code> zig compiler pipeline.</p>
<div class="codehilite"><pre><span></span><code>brew install afl++

rm -rf /tmp/corpus/default/crashes

zig build -Dfuzz -Dsystem-afl

afl-fuzz -i ./src/fuzz-corpus/ -o /tmp/corpus zig-out/bin/fuzz-canonicalize
</code></pre></div>



<a name="526186708"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20fuzzing/near/526186708" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20fuzzing.html#526186708">(Jun 28 2025 at 07:48)</a>:</h4>
<p>And this is what it looks like in my terminal...<br>
<a href="/user_uploads/22008/oGstBBXZee_5lgN9M3zGCoeD/Screenshot-2025-06-28-at-17.48.10.png">Screenshot 2025-06-28 at 17.48.10.png</a></p>
<div class="message_inline_image"><a href="/user_uploads/22008/oGstBBXZee_5lgN9M3zGCoeD/Screenshot-2025-06-28-at-17.48.10.png" title="Screenshot 2025-06-28 at 17.48.10.png"><img data-original-content-type="image/png" data-original-dimensions="1460x918" src="/user_uploads/thumbnail/22008/oGstBBXZee_5lgN9M3zGCoeD/Screenshot-2025-06-28-at-17.48.10.png/840x560.webp"></a></div>



<a name="526199287"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20fuzzing/near/526199287" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20fuzzing.html#526199287">(Jun 28 2025 at 11:57)</a>:</h4>
<p>where do the crashes end up?</p>



<a name="526208414"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20fuzzing/near/526208414" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20fuzzing.html#526208414">(Jun 28 2025 at 14:47)</a>:</h4>
<p><a href="http://roc-lang.github.io/roc-compiler-fuzz">roc-lang.github.io/roc-compiler-fuzz</a></p>



<a name="526208755"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20fuzzing/near/526208755" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20fuzzing.html#526208755">(Jun 28 2025 at 14:54)</a>:</h4>
<p>what I mean is like if I run it locally and it reports a number of crashes, how do I reproduce an individual crash so I can try to fix it?</p>



<a name="526209604"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20fuzzing/near/526209604" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20fuzzing.html#526209604">(Jun 28 2025 at 15:09)</a>:</h4>
<p>I think you just have to run it passing in a file as the first arg. <code>zig run fuzz-canonicalize -- /tm/corpus/default/crashes/...</code> I think</p>



<a name="526283897"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20fuzzing/near/526283897" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20fuzzing.html#526283897">(Jun 29 2025 at 17:40)</a>:</h4>
<p>Fuzzing can make such curious crashes at times:</p>
<div class="codehilite"><pre><span></span><code>0
pr000000e:{e:0}pr000000e={p:0r}
</code></pre></div>
<p>This leads to (either an infinite or near infinite loop) in <code>check.check_types.unify.Unifier.gatherRecordFields</code>. I'm quite surprised this even makes it past parsing and to canonicalization.</p>



<a name="526283959"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20fuzzing/near/526283959" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20fuzzing.html#526283959">(Jun 29 2025 at 17:41)</a>:</h4>
<p><code>zig build repro-canonicalize -- -b MApwcjAwMDAwMGU6e2U6MH1wcjAwMDAwMGU9e3A6MHJ9 -v</code></p>



<a name="526285669"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20fuzzing/near/526285669" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20fuzzing.html#526285669">(Jun 29 2025 at 18:10)</a>:</h4>
<p>would like to see the snapshot for that failure</p>



<a name="526285707"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20fuzzing/near/526285707" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20fuzzing.html#526285707">(Jun 29 2025 at 18:11)</a>:</h4>
<p>this reminds me i would like to have a META option to limit the stages run on a snapshot</p>



<a name="526285821"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20fuzzing/near/526285821" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20fuzzing.html#526285821">(Jun 29 2025 at 18:13)</a>:</h4>
<p>that one looks like:</p>
<div class="codehilite" data-code-language="Elixir"><pre><span></span><code><span class="n">rec</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">e</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">}</span>
<span class="n">rec</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="ss">p</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="n">r</span><span class="w"> </span><span class="p">}</span>
</code></pre></div>
<p>so I suspect it's getting typed as an error, and something about trying to gather up all the record fields in an erroneous record is the problem</p>



<a name="526286287"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20fuzzing/near/526286287" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20fuzzing.html#526286287">(Jun 29 2025 at 18:24)</a>:</h4>
<p>in this case both the type annotation and the record expression are invalid, but not sure if that's required to repro</p>



<a name="526286346"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20fuzzing/near/526286346" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20fuzzing.html#526286346">(Jun 29 2025 at 18:25)</a>:</h4>
<p>this is probably the sort of situation that breaks the old compiler when you try to do the "run anyway despite errors" thing, so it's pretty great to see the fuzzer turning it up! <span aria-label="grinning face with smiling eyes" class="emoji emoji-1f601" role="img" title="grinning face with smiling eyes">:grinning_face_with_smiling_eyes:</span></p>



<a name="526286525"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20fuzzing/near/526286525" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20fuzzing.html#526286525">(Jun 29 2025 at 18:28)</a>:</h4>
<p>I'd love to see a count of how many runs of the fuzzer it takes to generate a file / statement (not expr) that is actually completely valid with no reports</p>



<a name="526287070"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20fuzzing/near/526287070" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20fuzzing.html#526287070">(Jun 29 2025 at 18:38)</a>:</h4>
<p><span class="user-mention silent" data-user-id="781658">Anthony Bullard</span> <a href="#narrow/stream/395097-compiler-development/topic/zig.20compiler.20-.20fuzzing/near/526286525">said</a>:</p>
<blockquote>
<p>I'd love to see a count of how many runs of the fuzzer it takes to generate a file / statement (not expr) that is actually completely valid with no reports</p>
</blockquote>
<p>Just need to make an inverted fuzzer that only fails if everything goes successful though the complete compiler stack</p>



<a name="526287939"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20fuzzing/near/526287939" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Kiryl Dziamura <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20fuzzing.html#526287939">(Jun 29 2025 at 18:55)</a>:</h4>
<p>Regression tests generator lol</p>



<a name="527224747"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20fuzzing/near/527224747" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20fuzzing.html#527224747">(Jul 04 2025 at 19:10)</a>:</h4>
<p>First tokenizer fuzz failure in a long long time: <code>zig build repro-tokenize -- -b Jyc= -v</code></p>



<a name="527224791"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20fuzzing/near/527224791" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20fuzzing.html#527224791">(Jul 04 2025 at 19:11)</a>:</h4>
<p>Seems to be related to new single quote changes. I think it is a bug on the formatting side technically rather than truly a tokenizer bug.</p>



<a name="527224818"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20fuzzing/near/527224818" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20fuzzing.html#527224818">(Jul 04 2025 at 19:11)</a>:</h4>
<p>We now allow for empty single quote literals, which was not allowed before.</p>



<a name="527224901"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20fuzzing/near/527224901" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Kiryl Dziamura <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20fuzzing.html#527224901">(Jul 04 2025 at 19:13)</a>:</h4>
<p>I'll take a look</p>



<a name="527225010"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20fuzzing/near/527225010" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20fuzzing.html#527225010">(Jul 04 2025 at 19:14)</a>:</h4>
<p>Also, we are getting some fun canonicalize failures now like: <code>zig build repro-canonicalize -- -b IiJ1PSc= -v</code></p>
<p>It leads to a zig slice that is invalid:</p>
<div class="codehilite"><pre><span></span><code>thread 219880510 panic: start index 1 is larger than end index 0
/Users/bren077s/Projects/roc/src/check/canonicalize.zig:1269:42: 0x104a227af in canonicalize_expr (repro-canonicalize)
            const inner_text = token_text[1 .. token_text.len - 1];
</code></pre></div>



<a name="527225282"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20fuzzing/near/527225282" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Kiryl Dziamura <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20fuzzing.html#527225282">(Jul 04 2025 at 19:18)</a>:</h4>
<p>Interesting, because there's a snapshot with an empty single quote. In such a case, <code>''</code> is of length 2 so the slice is <code>[1..1]</code>. Looks like a problem in the tokenizer. Likely it creates the token  too son</p>



<a name="527225492"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20fuzzing/near/527225492" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20fuzzing.html#527225492">(Jul 04 2025 at 19:21)</a>:</h4>
<p>Of note, for the tokenizer fuzzer, we try to generate a "canonical" version of each token. Then retokenize a second time</p>



<a name="527225516"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20fuzzing/near/527225516" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20fuzzing.html#527225516">(Jul 04 2025 at 19:21)</a>:</h4>
<p>So that "canonical" version is probably wrong for single quotes now. It probably needs to be allowed to be empty</p>



<a name="527225569"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20fuzzing/near/527225569" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20fuzzing.html#527225569">(Jul 04 2025 at 19:22)</a>:</h4>
<p>Oh, I think the for loop here just needs to be from 0..length:<br>
<a href="https://github.com/roc-lang/roc/blob/9a32c422f290713a312e18a96cb6f43c850aa4d0/src/check/parse/tokenize.zig#L1662-L1667">https://github.com/roc-lang/roc/blob/9a32c422f290713a312e18a96cb6f43c850aa4d0/src/check/parse/tokenize.zig#L1662-L1667</a></p>



<a name="527225599"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20fuzzing/near/527225599" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20fuzzing.html#527225599">(Jul 04 2025 at 19:22)</a>:</h4>
<p>Or maybe <code>1..length-1</code>?</p>



<a name="527226169"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20fuzzing/near/527226169" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Kiryl Dziamura <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20fuzzing.html#527226169">(Jul 04 2025 at 19:32)</a>:</h4>
<p>It should be length-1, right</p>



<a name="527226473"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20fuzzing/near/527226473" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Kiryl Dziamura <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20fuzzing.html#527226473">(Jul 04 2025 at 19:38)</a>:</h4>
<p>Looks like this code generated only open single quote, truncating the closing one. So <code>''</code> becomes <code>'</code> thus the slice <code>[1..(1 - 1)]</code></p>



<a name="527227234"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20fuzzing/near/527227234" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Kiryl Dziamura <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20fuzzing.html#527227234">(Jul 04 2025 at 19:52)</a>:</h4>
<p><a href="https://github.com/roc-lang/roc/pull/7941">https://github.com/roc-lang/roc/pull/7941</a></p>



<a name="527309624"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20fuzzing/near/527309624" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20fuzzing.html#527309624">(Jul 05 2025 at 23:10)</a>:</h4>
<p>General question, it is fair to say that all files under 16KB should definitely complete roc check in under a second, right?</p>
<p>16KB is just an arbitrary number I set for fuzzing and I bet the true number should be higher, but compiler perf wise, I assume we want be able to roc check much much faster than that.</p>
<p>For reference, Dict.roc is 60KB and is only 1776 lines.</p>
<p>Of course in the worst case fuzzing experience, it will find code that takes maximal time and generates a metric ton of errors. So it isn't truly representative.</p>
<p>Just thinking about fuzzer hangs and settings.</p>



<a name="527309828"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20fuzzing/near/527309828" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20fuzzing.html#527309828">(Jul 05 2025 at 23:16)</a>:</h4>
<p>Also, how the heck does an input like this pass parsing and get to canonicalization? This feels pretty deeply wrong to me:</p>
<div class="codehilite"><pre><span></span><code>0]r={s=||{r={s=||{s={r=||{l={s=||{s={s={v={r={s={v=||{c00st=0t=c00st(0)c00st(0)t=c00st(0)
</code></pre></div>
<p>I get we want the compiler to be able to run as much as possible, but this has to fail parsing, right?</p>



<a name="527309860"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20fuzzing/near/527309860" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20fuzzing.html#527309860">(Jul 05 2025 at 23:17)</a>:</h4>
<p>Hmm... I guess it does fail parsing, but we just keep going anyway:</p>
<div class="codehilite"><pre><span></span><code>[0]: check.parse.AST.Diagnostic{ .tag = check.parse.AST.Diagnostic.Tag.missing_header, .region = check.parse.AST.TokenizedRegion{ .start = 0, .end = 1 } }
[1]: check.parse.AST.Diagnostic{ .tag = check.parse.AST.Diagnostic.Tag.expr_unexpected_token, .region = check.parse.AST.TokenizedRegion{ .start = 55, .end = 56 } }
[2]: check.parse.AST.Diagnostic{ .tag = check.parse.AST.Diagnostic.Tag.expr_unexpected_token, .region = check.parse.AST.TokenizedRegion{ .start = 56, .end = 57 } }
</code></pre></div>



<a name="527310561"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20fuzzing/near/527310561" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20fuzzing.html#527310561">(Jul 05 2025 at 23:38)</a>:</h4>
<p><span class="user-mention silent" data-user-id="343810">Brendan Hansknecht</span> <a href="#narrow/channel/395097-compiler-development/topic/zig.20compiler.20-.20fuzzing/near/527309828">said</a>:</p>
<blockquote>
<p>Also, how the heck does an input like this pass parsing and get to canonicalization? This feels pretty deeply wrong to me:</p>
<div class="codehilite"><pre><span></span><code>0]r={s=||{r={s=||{s={r=||{l={s=||{s={s={v={r={s={v=||{c00st=0t=c00st(0)c00st(0)t=c00st(0)
</code></pre></div>
<p>I get we want the compiler to be able to run as much as possible, but this has to fail parsing, right?</p>
</blockquote>
<p>Maybe we want to support droid mode. The robots can plug and and skip all the human whitespace nonsense.</p>



<a name="527313888"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20fuzzing/near/527313888" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20fuzzing.html#527313888">(Jul 06 2025 at 01:05)</a>:</h4>
<p><span class="user-mention silent" data-user-id="343810">Brendan Hansknecht</span> <a href="#narrow/channel/395097-compiler-development/topic/zig.20compiler.20-.20fuzzing/near/527309624">said</a>:</p>
<blockquote>
<p>General question, it is fair to say that all files under 16KB should definitely complete roc check in under a second, right?</p>
</blockquote>
<p>Hindley-Milner type inference has pathological asymptotic time complexity if you just keep nesting <code>let</code>s (or defs in our case), and relies on the fact that in practice people don't actually do that</p>



<a name="527313895"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20fuzzing/near/527313895" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20fuzzing.html#527313895">(Jul 06 2025 at 01:05)</a>:</h4>
<p>but if a fuzzer did that, it would presumably get bad <span aria-label="smile" class="emoji emoji-1f604" role="img" title="smile">:smile:</span></p>



<a name="527313962"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20fuzzing/near/527313962" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20fuzzing.html#527313962">(Jul 06 2025 at 01:06)</a>:</h4>
<p><span class="user-mention silent" data-user-id="343810">Brendan Hansknecht</span> <a href="#narrow/channel/395097-compiler-development/topic/zig.20compiler.20-.20fuzzing/near/527309828">said</a>:</p>
<blockquote>
<p>Also, how the heck does an input like this pass parsing and get to canonicalization? This feels pretty deeply wrong to me:</p>
<div class="codehilite"><pre><span></span><code>0]r={s=||{r={s=||{s={r=||{l={s=||{s={s={v={r={s={v=||{c00st=0t=c00st(0)c00st(0)t=c00st(0)
</code></pre></div>
<p>I get we want the compiler to be able to run as much as possible, but this has to fail parsing, right?</p>
</blockquote>
<p>I think the right answer here is that parsing should generate a ton of error nodes, but then when we proceed to canonicalization, it finds essentially no work to do because it's all error nodes, so canonicalization and type-checking end up being no-ops</p>



<a name="527313998"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20fuzzing/near/527313998" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20fuzzing.html#527313998">(Jul 06 2025 at 01:07)</a>:</h4>
<p>so you get the same outcome as if we "stopped at parsing" except:</p>
<ul>
<li>the CPU did more work than if we stopped</li>
<li>we maintain the ability to actually do useful things in cases where the programmer actually made a mistake or two</li>
</ul>



<a name="527314533"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20fuzzing/near/527314533" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20fuzzing.html#527314533">(Jul 06 2025 at 01:22)</a>:</h4>
<blockquote>
<p>but if a fuzzer did that, it would presumably get bad</p>
</blockquote>
<p>Makes senses, we'll see. The fuzzer just optimizes for new exploration so may be unlikely, but not really sure.</p>



<a name="527314590"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20fuzzing/near/527314590" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20fuzzing.html#527314590">(Jul 06 2025 at 01:24)</a>:</h4>
<blockquote>
<p>I think the right answer here is that parsing should generate a ton of error nodes, but then when we proceed to canonicalization, it finds essentially no work to do because it's all error nodes, so canonicalization and type-checking end up being no-ops</p>
</blockquote>
<p>If I understand what is happening, the parser generates a mostly valid tree by automatically adding a bunch of <code>}</code>s at the end. Can then runs with tons of recursive lambda and expression checks. Can is very slow. The end result of Can is mostly a bunch of unused variable and duplicate definition complaints.</p>



<a name="527314592"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20fuzzing/near/527314592" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Warner <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20fuzzing.html#527314592">(Jul 06 2025 at 01:24)</a>:</h4>
<p>One thing that a lot of fuzzers count as new coverage is loop counts (maybe recursion counts?) going over some threshold</p>



<a name="527314602"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20fuzzing/near/527314602" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20fuzzing.html#527314602">(Jul 06 2025 at 01:25)</a>:</h4>
<p>Yeah, bucketed loop counts is new coverage</p>



<a name="527314613"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20fuzzing/near/527314613" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20fuzzing.html#527314613">(Jul 06 2025 at 01:25)</a>:</h4>
<p>so it isn't down to the individual iteration, but it does count overall</p>



<a name="527314623"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20fuzzing/near/527314623" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Warner <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20fuzzing.html#527314623">(Jul 06 2025 at 01:25)</a>:</h4>
<p>I predict as soon as any low hanging fruit is cleared out, it'll start finding things like that (unless we dissuade it somehow!)</p>



<a name="527314651"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20fuzzing/near/527314651" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Warner <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20fuzzing.html#527314651">(Jul 06 2025 at 01:26)</a>:</h4>
<p>Would it be reasonable to put some limit on that let recursion and start erroring after that?</p>



<a name="527314744"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20fuzzing/near/527314744" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20fuzzing.html#527314744">(Jul 06 2025 at 01:29)</a>:</h4>
<p>Yeah, I'm sure when it comes up we can work around it. That said, right now there are lots of hangs with can in general (though hang is a pretty loose definition. Like the example above is considered a hang on the CI machine (old/weak cpu), but only takes 250ms on my M1 mac. That said, something that short taking 250ms is almost certainly a perf bug.</p>



<a name="527314751"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20fuzzing/near/527314751" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20fuzzing.html#527314751">(Jul 06 2025 at 01:29)</a>:</h4>
<p>So probably worthwhile currently to consider a failure.</p>



<a name="527314752"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20fuzzing/near/527314752" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20fuzzing.html#527314752">(Jul 06 2025 at 01:29)</a>:</h4>
<p>agreed!</p>



<a name="527314753"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20fuzzing/near/527314753" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20fuzzing.html#527314753">(Jul 06 2025 at 01:29)</a>:</h4>
<p>At least that is my thought</p>



<a name="527314769"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20fuzzing/near/527314769" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20fuzzing.html#527314769">(Jul 06 2025 at 01:29)</a>:</h4>
<p>Just want to make sure that what we get currently that is considered a hang is useful. I think it is, but thought it would be worth double checking.</p>



<a name="527314783"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20fuzzing/near/527314783" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20fuzzing.html#527314783">(Jul 06 2025 at 01:30)</a>:</h4>
<p>And yeah, we still have tons of low hanging crashes in both parse and can</p>



<a name="531233007"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20fuzzing/near/531233007" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20fuzzing.html#531233007">(Jul 27 2025 at 23:29)</a>:</h4>
<p>Took me way too long to debug the fuzz job failing...turns out it was just OOMing and github was killing it. Set afl to limit memory use and I think it is all good now.</p>



<a name="531233064"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20fuzzing/near/531233064" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20fuzzing.html#531233064">(Jul 27 2025 at 23:29)</a>:</h4>
<p>Have been very slowly poking at this for probably a few weeks now.</p>



<a name="535786913"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20fuzzing/near/535786913" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> JRI98 <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20fuzzing.html#535786913">(Aug 23 2025 at 06:46)</a>:</h4>
<p><span aria-label="eyes" class="emoji emoji-1f440" role="img" title="eyes">:eyes:</span> <br>
<a href="/user_uploads/22008/BzqSBff4xV7fiaQuW7RqlOlz/Screenshot-2025-08-23-at-07.45.27.png">Screenshot 2025-08-23 at 07.45.27.png</a></p>
<div class="message_inline_image"><a href="/user_uploads/22008/BzqSBff4xV7fiaQuW7RqlOlz/Screenshot-2025-08-23-at-07.45.27.png" title="Screenshot 2025-08-23 at 07.45.27.png"><img data-original-content-type="image/png" data-original-dimensions="1190x61" src="/user_uploads/thumbnail/22008/BzqSBff4xV7fiaQuW7RqlOlz/Screenshot-2025-08-23-at-07.45.27.png/840x560.webp"></a></div>



<a name="536295914"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20fuzzing/near/536295914" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> JRI98 <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20fuzzing.html#536295914">(Aug 26 2025 at 18:58)</a>:</h4>
<p>It's finally green <span aria-label="tada" class="emoji emoji-1f389" role="img" title="tada">:tada:</span><br>
<a href="/user_uploads/22008/zUBim88xgZbWO-kgXoZ7NOO0/Screenshot-2025-08-26-at-19.57.34.png">Screenshot 2025-08-26 at 19.57.34.png</a></p>
<div class="message_inline_image"><a href="/user_uploads/22008/zUBim88xgZbWO-kgXoZ7NOO0/Screenshot-2025-08-26-at-19.57.34.png" title="Screenshot 2025-08-26 at 19.57.34.png"><img data-original-content-type="image/png" data-original-dimensions="1197x214" src="/user_uploads/thumbnail/22008/zUBim88xgZbWO-kgXoZ7NOO0/Screenshot-2025-08-26-at-19.57.34.png/840x560.webp"></a></div>



<a name="536929776"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20fuzzing/near/536929776" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20fuzzing.html#536929776">(Aug 30 2025 at 17:44)</a>:</h4>
<p>an idea for how to make formatter fuzzing maximally robust: (I'm not sure how much of this we're currently fuzzing but I don't think all of it!)</p>
<ul>
<li>start with the random source code</li>
<li>parse it into an AST and save that AST for later</li>
<li>format it and save the resulting output source code for later</li>
<li>format the already-formatted source code again</li>
<li>verify that the formatting was stable (the second format was a no-op)</li>
<li>parse the already-formatted source code into a new AST</li>
<li>verify that the new AST was the same as the original saved AST</li>
<li>re-tokenize both the original source code and the new one, considering only the comments, and verify that all comments from the original are encountered in the formatted one, and in the same order (meaning we neither dropped comments nor reordered them relative to one another, even though we may have changed what line they're on etc.)</li>
</ul>



<a name="536929880"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20fuzzing/near/536929880" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20fuzzing.html#536929880">(Aug 30 2025 at 17:46)</a>:</h4>
<p>anyone know how much of that we're already doing? <span aria-label="smiley" class="emoji emoji-1f603" role="img" title="smiley">:smiley:</span></p>



<a name="536938031"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20fuzzing/near/536938031" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20fuzzing.html#536938031">(Aug 30 2025 at 20:21)</a>:</h4>
<p>I think we current do:<br>
src -&gt; parse -&gt; format -&gt; src2 -&gt; parse -&gt; format -&gt; src3</p>
<p>Assert src2 == src3.</p>



<a name="536938064"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20fuzzing/near/536938064" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20fuzzing.html#536938064">(Aug 30 2025 at 20:22)</a>:</h4>
<p>So I think you could lose comments and that would not be caught</p>



<a name="536938076"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20fuzzing/near/536938076" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20fuzzing.html#536938076">(Aug 30 2025 at 20:22)</a>:</h4>
<p>I also think we don't check ast equivalency, but not fully sure</p>



<a name="536938898"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20fuzzing/near/536938898" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20fuzzing.html#536938898">(Aug 30 2025 at 20:41)</a>:</h4>
<p>Yeah, it is the first thing I commented.</p>
<p>So we have double formatting with stablility</p>
<p>We don't have:</p>
<ul>
<li>AST verification</li>
<li>comment verification</li>
</ul>



<a name="536940399"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20fuzzing/near/536940399" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20fuzzing.html#536940399">(Aug 30 2025 at 21:17)</a>:</h4>
<p>Oh, also, if the first parse has any issues, it just fully bails.</p>



<a name="543187585"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20fuzzing/near/543187585" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20fuzzing.html#543187585">(Oct 05 2025 at 19:30)</a>:</h4>
<p>Seems our can fuzzer is broken. Not sure if it is an innate tool chain issue or if it is something we can easily fix:</p>
<blockquote>
<p>ld.lld: error: undefined symbol: exp<br>
89</p>
<blockquote>
<blockquote>
<blockquote>
<p>referenced by pow.zig:140 (/home/runner/work/_temp/81f1e437-3d6b-4bc5-a459-32de5609b04b/zig-x86_64-linux-0.14.1/lib/std/math/pow.zig:140)<br>
90<br>
              lto.tmp:(CIR.SmallDecValue.toFracRequirements)<br>
91<br>
clang: error: linker command failed with exit code 1 (use -v to see invocation)<br>
92<br>
error: the following command exited with error code 1:<br>
93<br>
/usr/bin/afl-cc -O3 -o /home/runner/.cache/zig/o/88680f28f115b97e56cfab0f8f6281de/canonicalize_obj /home/runner/.cache/zig/p/afl_kit-0.1.0-uhOgGEEbAADSSVtFLWc0eoZFxVLiELWLNldB9K_f9x5L/afl.c /home/runner/.cache/zig/o/26ab65f70269c251a2c7d8de690dfc8e/canonicalize_obj.bc</p>
</blockquote>
</blockquote>
</blockquote>
</blockquote>
<p><a href="https://github.com/roc-lang/roc-compiler-fuzz/actions/runs/18261456695/job/51989932652">https://github.com/roc-lang/roc-compiler-fuzz/actions/runs/18261456695/job/51989932652</a></p>



<a name="543187622"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20fuzzing/near/543187622" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20fuzzing.html#543187622">(Oct 05 2025 at 19:30)</a>:</h4>
<p>The fun of using special afl tooling with zig.</p>



<a name="543187641"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20fuzzing/near/543187641" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20fuzzing.html#543187641">(Oct 05 2025 at 19:31)</a>:</h4>
<p>Can't wait for high quality builtin zig fuzzing. I think it is at least farther along now.</p>



<hr><p>Last updated: Mar 01 2026 at 12:20 UTC</p>
</html>