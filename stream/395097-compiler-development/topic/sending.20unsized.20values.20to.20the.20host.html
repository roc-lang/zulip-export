<html>
<head><meta charset="utf-8"><title>sending unsized values to the host · compiler development · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/index.html">compiler development</a></h2>
<h3>Topic: <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/sending.20unsized.20values.20to.20the.20host.html">sending unsized values to the host</a></h3>

<hr>

<base href="https://roc.zulipchat.com">

<head><link href="https://roc-lang.github.io/zulip-export/style.css" rel="stylesheet"></head>

<a name="464911616"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/sending%20unsized%20values%20to%20the%20host/near/464911616" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/sending.20unsized.20values.20to.20the.20host.html#464911616">(Aug 24 2024 at 23:31)</a>:</h4>
<p>building on the discussion with <span class="user-mention" data-user-id="454654">@Ayaz Hafiz</span> <span class="user-mention" data-user-id="281543">@Folkert de Vries</span> from the meetup today - I think probably the way forward is the thing we talked about earlier, namely:</p>
<ul>
<li>require that anything sent to the host has a size that the host can know statically</li>
<li>this means if you want to send a closure or type variable, the platform module has to explicitly <code>Box</code> it (and we just pay the perf penalty for now, since obviously boxing needs to be supported regardless)</li>
<li>you get a compile-time error if you're trying to send anything with statically unknown size (statically unknown to the host, that is - e.g. a closure or type variable, or a data structure that contains either of those)</li>
</ul>



<a name="464911706"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/sending%20unsized%20values%20to%20the%20host/near/464911706" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/sending.20unsized.20values.20to.20the.20host.html#464911706">(Aug 24 2024 at 23:33)</a>:</h4>
<p>assuming that's the design, then I <em>think</em> it should be possible for the platform to say to the application that the application needs to provide something that looks like this:</p>
<div class="codehilite" data-code-language="Haskell"><pre><span></span><code><span class="p">{</span>
<span class="w">    </span><span class="n">init</span><span class="w"> </span><span class="kt">:</span><span class="w"> </span><span class="kt">Task</span><span class="w"> </span><span class="n">state</span><span class="w"> </span><span class="kt">[]</span><span class="p">,</span>
<span class="w">    </span><span class="n">handleRequest</span><span class="w"> </span><span class="kt">:</span><span class="w"> </span><span class="n">state</span><span class="p">,</span><span class="w"> </span><span class="kt">Request</span><span class="w"> </span><span class="ow">-&gt;</span><span class="w"> </span><span class="kt">Task</span><span class="w"> </span><span class="kt">Response</span><span class="w"> </span><span class="kt">[]</span><span class="p">,</span>
<span class="p">}</span>
</code></pre></div>



<a name="464911718"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/sending%20unsized%20values%20to%20the%20host/near/464911718" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/sending.20unsized.20values.20to.20the.20host.html#464911718">(Aug 24 2024 at 23:33)</a>:</h4>
<p>and I thought about how unification could work and I think it might actually be kinda straightforward</p>



<a name="464911769"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/sending%20unsized%20values%20to%20the%20host/near/464911769" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/sending.20unsized.20values.20to.20the.20host.html#464911769">(Aug 24 2024 at 23:34)</a>:</h4>
<p>basically in constraint gen, create a Function constraint where <span aria-label="point up" class="emoji emoji-1f446" role="img" title="point up">:point_up:</span> is the argument type - e.g. pretend the function has this type:</p>
<div class="codehilite" data-code-language="Haskell"><pre><span></span><code><span class="p">{</span>
<span class="w">    </span><span class="n">init</span><span class="w"> </span><span class="kt">:</span><span class="w"> </span><span class="kt">Task</span><span class="w"> </span><span class="n">state</span><span class="w"> </span><span class="kt">[]</span><span class="p">,</span>
<span class="w">    </span><span class="n">handleRequest</span><span class="w"> </span><span class="kt">:</span><span class="w"> </span><span class="n">state</span><span class="p">,</span><span class="w"> </span><span class="kt">Request</span><span class="w"> </span><span class="ow">-&gt;</span><span class="w"> </span><span class="kt">Task</span><span class="w"> </span><span class="kt">Response</span><span class="w"> </span><span class="kt">[]</span><span class="p">,</span>
<span class="p">}</span><span class="w"> </span><span class="ow">-&gt;</span><span class="w"> </span><span class="p">{}</span>
</code></pre></div>



<a name="464911775"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/sending%20unsized%20values%20to%20the%20host/near/464911775" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/sending.20unsized.20values.20to.20the.20host.html#464911775">(Aug 24 2024 at 23:34)</a>:</h4>
<p>and then create another constraint as if we're calling the function passing <code>main</code> as the argument</p>



<a name="464911799"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/sending%20unsized%20values%20to%20the%20host/near/464911799" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/sending.20unsized.20values.20to.20the.20host.html#464911799">(Aug 24 2024 at 23:35)</a>:</h4>
<p>so if I have a <code>main</code> with this type:</p>
<div class="codehilite" data-code-language="Haskell"><pre><span></span><code><span class="p">{</span>
<span class="w">    </span><span class="n">init</span><span class="w"> </span><span class="kt">:</span><span class="w"> </span><span class="kt">Task</span><span class="w"> </span><span class="kt">MySharedServerState</span><span class="w"> </span><span class="kt">[]</span><span class="p">,</span>
<span class="w">    </span><span class="n">handleRequest</span><span class="w"> </span><span class="kt">:</span><span class="w"> </span><span class="kt">MySharedServerState</span><span class="p">,</span><span class="w"> </span><span class="kt">Request</span><span class="w"> </span><span class="ow">-&gt;</span><span class="w"> </span><span class="kt">Task</span><span class="w"> </span><span class="kt">Response</span><span class="w"> </span><span class="kt">[]</span><span class="p">,</span>
<span class="p">}</span>
</code></pre></div>
<p>...it should successfully unify with that "argument"</p>



<a name="464911906"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/sending%20unsized%20values%20to%20the%20host/near/464911906" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/sending.20unsized.20values.20to.20the.20host.html#464911906">(Aug 24 2024 at 23:38)</a>:</h4>
<p>then from there we could add constraints similar to the ones we have today for the app-defined concrete types (e.g. <code>Model</code>) except that they're set to be Equal to the type variables in this "function"</p>



<a name="464911954"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/sending%20unsized%20values%20to%20the%20host/near/464911954" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/sending.20unsized.20values.20to.20the.20host.html#464911954">(Aug 24 2024 at 23:38)</a>:</h4>
<p>so then after solving finishes, we have resolved <code>Variable</code>s for the type variables, just like we do today</p>



<a name="464911958"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/sending%20unsized%20values%20to%20the%20host/near/464911958" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/sending.20unsized.20values.20to.20the.20host.html#464911958">(Aug 24 2024 at 23:38)</a>:</h4>
<p>but without the application author having to declare them in a special way</p>



<a name="464911962"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/sending%20unsized%20values%20to%20the%20host/near/464911962" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/sending.20unsized.20values.20to.20the.20host.html#464911962">(Aug 24 2024 at 23:38)</a>:</h4>
<p>and then from there everything can proceed the same way it does today</p>



<a name="464911972"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/sending%20unsized%20values%20to%20the%20host/near/464911972" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/sending.20unsized.20values.20to.20the.20host.html#464911972">(Aug 24 2024 at 23:39)</a>:</h4>
<p>unless I'm missing something, it seems like that should work - but of course I could always be missing something! <span aria-label="big smile" class="emoji emoji-1f604" role="img" title="big smile">:big_smile:</span></p>



<a name="464914143"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/sending%20unsized%20values%20to%20the%20host/near/464914143" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/sending.20unsized.20values.20to.20the.20host.html#464914143">(Aug 25 2024 at 00:01)</a>:</h4>
<p>I don't follow the type checking part. What is the the function solving? Type checking for basic webserver works today and it uses those types.</p>



<a name="464914500"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/sending%20unsized%20values%20to%20the%20host/near/464914500" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/sending.20unsized.20values.20to.20the.20host.html#464914500">(Aug 25 2024 at 00:03)</a>:</h4>
<p>It has an explicit function to go from <code>state</code> to <code>Box state</code> for sending to the platform.</p>



<a name="464914664"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/sending%20unsized%20values%20to%20the%20host/near/464914664" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/sending.20unsized.20values.20to.20the.20host.html#464914664">(Aug 25 2024 at 00:04)</a>:</h4>
<p>Also, boxing is fine, but I prefer the current system of telling the platform the size of things (sadly doesn't really work with nested data).... So boxing is probably more reasonable I guess.</p>



<a name="464915218"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/sending%20unsized%20values%20to%20the%20host/near/464915218" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ayaz Hafiz <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/sending.20unsized.20values.20to.20the.20host.html#464915218">(Aug 25 2024 at 00:09)</a>:</h4>
<p>this all sounds good but i don’t follow how it solves the problem of different value locations in structs? unless you’re not intending to solve that here</p>



<a name="464915591"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/sending%20unsized%20values%20to%20the%20host/near/464915591" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/sending.20unsized.20values.20to.20the.20host.html#464915591">(Aug 25 2024 at 00:12)</a>:</h4>
<p><span class="user-mention silent" data-user-id="454654">Ayaz Hafiz</span> <a href="#narrow/stream/395097-compiler-development/topic/sending.20unsized.20values.20to.20the.20host/near/464915218">said</a>:</p>
<blockquote>
<p>this all sounds good but i don’t follow how it solves the problem of different value locations in structs? unless you’re not intending to solve that here</p>
</blockquote>
<p>basically disallow anything that would move around (so, unboxed closures and unboxed type variables)</p>



<a name="464915722"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/sending%20unsized%20values%20to%20the%20host/near/464915722" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/sending.20unsized.20values.20to.20the.20host.html#464915722">(Aug 25 2024 at 00:13)</a>:</h4>
<p>if they have to be in a <code>Box</code>, then the host statically knows how big that is</p>



<a name="464915738"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/sending%20unsized%20values%20to%20the%20host/near/464915738" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/sending.20unsized.20values.20to.20the.20host.html#464915738">(Aug 25 2024 at 00:13)</a>:</h4>
<p>and that's recursively true, e.g. you can't send anything that contains an unboxed closure or type variable</p>



<a name="464915786"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/sending%20unsized%20values%20to%20the%20host/near/464915786" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/sending.20unsized.20values.20to.20the.20host.html#464915786">(Aug 25 2024 at 00:14)</a>:</h4>
<p>so unless I'm missing something, that means any struct that goes to the host will have a fixed field order that never varies by application</p>



<a name="464915788"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/sending%20unsized%20values%20to%20the%20host/near/464915788" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/sending.20unsized.20values.20to.20the.20host.html#464915788">(Aug 25 2024 at 00:14)</a>:</h4>
<p>and it's up to the platform to figure out how to make that happen</p>



<a name="464915797"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/sending%20unsized%20values%20to%20the%20host/near/464915797" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/sending.20unsized.20values.20to.20the.20host.html#464915797">(Aug 25 2024 at 00:14)</a>:</h4>
<p>the idea being that long-term we <em>at least</em> need this to work, so for now we can make it a restriction and make it work</p>



<a name="464915803"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/sending%20unsized%20values%20to%20the%20host/near/464915803" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/sending.20unsized.20values.20to.20the.20host.html#464915803">(Aug 25 2024 at 00:14)</a>:</h4>
<p>and then in the future if we find a way to relax the restriction, then cool</p>



<a name="464915831"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/sending%20unsized%20values%20to%20the%20host/near/464915831" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/sending.20unsized.20values.20to.20the.20host.html#464915831">(Aug 25 2024 at 00:15)</a>:</h4>
<p>maybe it ends up being important, maybe this restriction is fine indefinitely, but either way it's a path forward that unblocks effect interpreters among other things <span aria-label="big smile" class="emoji emoji-1f604" role="img" title="big smile">:big_smile:</span></p>



<a name="464915988"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/sending%20unsized%20values%20to%20the%20host/near/464915988" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/sending.20unsized.20values.20to.20the.20host.html#464915988">(Aug 25 2024 at 00:18)</a>:</h4>
<p><span class="user-mention silent" data-user-id="343810">Brendan Hansknecht</span> <a href="#narrow/stream/395097-compiler-development/topic/sending.20unsized.20values.20to.20the.20host/near/464914143">said</a>:</p>
<blockquote>
<p>I don't follow the type checking part. What is the the function solving? Type checking for basic webserver works today and it uses those types.<br>
It has an explicit function to go from <code>state</code> to <code>Box state</code> for sending to the platform.</p>
</blockquote>
<p>sorry, relevant distinction from the conversation that I didn't say explicitly here - the idea is that instead of having this concept of <a href="https://github.com/roc-lang/basic-webserver/blob/1518c411d298b2c523212a92bcc3e98a753099da/platform/main.roc#L2"><code>Model</code></a> - that is, a special concrete type that the platform specifies which the application has to provide - instead the platform asks the application for <em>literally</em> a record with lowercase type variables like <code>state</code> in it</p>



<a name="464916122"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/sending%20unsized%20values%20to%20the%20host/near/464916122" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/sending.20unsized.20values.20to.20the.20host.html#464916122">(Aug 25 2024 at 00:21)</a>:</h4>
<p>the <code>Model</code> design is more learning curve for application authors (compared to the docs being literally "application author, give me a normal record of this type and we're all set") and it blocks a future design where we just have one entrypoint and the app doesn't have to specify what it's sending the platform (which currently <a href="https://github.com/roc-lang/basic-webserver/blob/1518c411d298b2c523212a92bcc3e98a753099da/examples/sqlite3.roc#L1">is needed to tell the platform about the app's <code>Model</code> type</a>)</p>



<a name="464916551"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/sending%20unsized%20values%20to%20the%20host/near/464916551" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/sending.20unsized.20values.20to.20the.20host.html#464916551">(Aug 25 2024 at 00:29)</a>:</h4>
<p>I know it's a little off topic, but is this a big change? Any chance we could roll it into Builtin Task change? that would save another round of releases and that's the only change that requires coordination with the platforms I'm tracking for a while.</p>



<a name="464916659"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/sending%20unsized%20values%20to%20the%20host/near/464916659" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/sending.20unsized.20values.20to.20the.20host.html#464916659">(Aug 25 2024 at 00:31)</a>:</h4>
<p>I think this should be separate</p>



<a name="464916748"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/sending%20unsized%20values%20to%20the%20host/near/464916748" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/sending.20unsized.20values.20to.20the.20host.html#464916748">(Aug 25 2024 at 00:32)</a>:</h4>
<p>it might not end up being a big code change, but the design space is a minefield and we've had plenty of "go partway down the road before realizing it's not going to work out...and then start over" in this area <span aria-label="big smile" class="emoji emoji-1f604" role="img" title="big smile">:big_smile:</span></p>



<a name="464916762"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/sending%20unsized%20values%20to%20the%20host/near/464916762" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/sending.20unsized.20values.20to.20the.20host.html#464916762">(Aug 25 2024 at 00:32)</a>:</h4>
<p>Oh, got it... Ok</p>



<a name="464916846"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/sending%20unsized%20values%20to%20the%20host/near/464916846" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/sending.20unsized.20values.20to.20the.20host.html#464916846">(Aug 25 2024 at 00:34)</a>:</h4>
<p>No worries, I'm just thinking about the work to coordinate releases and upgrade platforms. It's not a problem, just thought it might be easy to include it while we are at it.</p>



<a name="464916850"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/sending%20unsized%20values%20to%20the%20host/near/464916850" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/sending.20unsized.20values.20to.20the.20host.html#464916850">(Aug 25 2024 at 00:34)</a>:</h4>
<p>Aside, I was originally thinking this was related to the bug in contributing with tags passed to the host expanding</p>



<a name="464916962"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/sending%20unsized%20values%20to%20the%20host/near/464916962" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/sending.20unsized.20values.20to.20the.20host.html#464916962">(Aug 25 2024 at 00:37)</a>:</h4>
<p>ah no, unrelated!</p>



<a name="464945510"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/sending%20unsized%20values%20to%20the%20host/near/464945510" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ayaz Hafiz <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/sending.20unsized.20values.20to.20the.20host.html#464945510">(Aug 25 2024 at 05:36)</a>:</h4>
<p>I think there are still a couple unresolved things here. One is that the <code>state</code> type is unsized until the application is compiled, right? So unless that is boxed as well, you need to somehow manage potential field reorders. Another is that in order to do this, you must make sure that any reachable values (closures, etc) are boxed - and so you need to perform an analysis somehow to determine how "far" in the program you must box values accordingly.</p>



<a name="464991347"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/sending%20unsized%20values%20to%20the%20host/near/464991347" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/sending.20unsized.20values.20to.20the.20host.html#464991347">(Aug 25 2024 at 10:53)</a>:</h4>
<p>yeah I agree with both points: <code>state</code> would have to be boxed, and we'd need to do some special pass over the final type of the platform-host boundary to generate that error - but since it would just be for one type signature in the entire program, I think it should be pretty quick?</p>



<a name="465024880"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/sending%20unsized%20values%20to%20the%20host/near/465024880" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ayaz Hafiz <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/sending.20unsized.20values.20to.20the.20host.html#465024880">(Aug 25 2024 at 15:51)</a>:</h4>
<p>well it's not just one final pass, you must make sure that everything in the program that can reach a value exposed to the host is correctly boxed, right?</p>



<a name="465024928"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/sending%20unsized%20values%20to%20the%20host/near/465024928" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ayaz Hafiz <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/sending.20unsized.20values.20to.20the.20host.html#465024928">(Aug 25 2024 at 15:52)</a>:</h4>
<p>or else have some layer between the app and the host that walks the type and boxes it appropriately</p>



<a name="465031317"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/sending%20unsized%20values%20to%20the%20host/near/465031317" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/sending.20unsized.20values.20to.20the.20host.html#465031317">(Aug 25 2024 at 17:47)</a>:</h4>
<p>I feel like we can just ban the dynamically sized types in the platform api and force the platform author to deal with it as they see fit. Avoid requiring some sort of automatic boxing pass and either have the platform author expose the <code>Box</code> to the end users or box it themselves</p>



<a name="465031372"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/sending%20unsized%20values%20to%20the%20host/near/465031372" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/sending.20unsized.20values.20to.20the.20host.html#465031372">(Aug 25 2024 at 17:48)</a>:</h4>
<p>In most cases, it will just be shallow boxing of a single type</p>



<a name="465031601"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/sending%20unsized%20values%20to%20the%20host/near/465031601" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/sending.20unsized.20values.20to.20the.20host.html#465031601">(Aug 25 2024 at 17:52)</a>:</h4>
<p>For:</p>
<div class="codehilite" data-code-language="Elm"><pre><span></span><code><span class="p">{</span>
<span class="w">    </span><span class="nv">init</span><span class="w"> </span><span class="nf">:</span><span class="w"> </span><span class="kt">Task</span><span class="w"> </span><span class="nv">state</span><span class="w"> </span><span class="p">[],</span>
<span class="w">    </span><span class="nv">handleRequest</span><span class="w"> </span><span class="nf">:</span><span class="w"> </span><span class="nv">state</span><span class="p">,</span><span class="w"> </span><span class="kt">Request</span><span class="w"> </span><span class="nf">-&gt;</span><span class="w"> </span><span class="kt">Task</span><span class="w"> </span><span class="kt">Response</span><span class="w"> </span><span class="p">[],</span>
<span class="p">}</span>
</code></pre></div>
<p>If we allow exposing more than one value to the platform, the final api would be:</p>
<div class="codehilite" data-code-language="Elm"><pre><span></span><code><span class="nv">init</span><span class="w"> </span><span class="nf">:</span><span class="w"> </span><span class="kt">Task</span><span class="w"> </span><span class="p">(</span><span class="kt">Box</span><span class="w"> </span><span class="nv">state</span><span class="p">)</span><span class="w"> </span><span class="p">[]</span>

<span class="nv">handleRequest</span><span class="w"> </span><span class="nf">:</span><span class="w"> </span><span class="p">(</span><span class="kt">Box</span><span class="w"> </span><span class="nv">state</span><span class="p">),</span><span class="w"> </span><span class="kt">Request</span><span class="w"> </span><span class="nf">-&gt;</span><span class="w"> </span><span class="kt">Task</span><span class="w"> </span><span class="kt">Response</span><span class="w"> </span><span class="p">[]</span>
</code></pre></div>
<p><span aria-label="point up" class="emoji emoji-1f446" role="img" title="point up">:point_up:</span> requires being able to expose multiple values to the host, but it is by far the simplest host api and we should definitely support it in the long term.</p>
<p>Sadly, today, we can only expose a single value to the host.<br>
So today, that api would need to be:</p>
<div class="codehilite" data-code-language="Elm"><pre><span></span><code><span class="p">{</span>
<span class="w">    </span><span class="nv">init</span><span class="w"> </span><span class="nf">:</span><span class="w"> </span><span class="kt">Task</span><span class="w"> </span><span class="p">(</span><span class="kt">Box</span><span class="w"> </span><span class="nv">state</span><span class="p">)</span><span class="w"> </span><span class="p">[],</span>
<span class="w">    </span><span class="nv">handleRequest</span><span class="w"> </span><span class="nf">:</span><span class="w"> </span><span class="kt">Box</span><span class="w"> </span><span class="p">(</span><span class="kt">Box</span><span class="w"> </span><span class="nv">state</span><span class="p">,</span><span class="w"> </span><span class="kt">Request</span><span class="w"> </span><span class="nf">-&gt;</span><span class="w"> </span><span class="kt">Task</span><span class="w"> </span><span class="kt">Response</span><span class="w"> </span><span class="p">[]),</span>
<span class="p">}</span>
</code></pre></div>



<a name="465031746"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/sending%20unsized%20values%20to%20the%20host/near/465031746" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/sending.20unsized.20values.20to.20the.20host.html#465031746">(Aug 25 2024 at 17:54)</a>:</h4>
<p>Oh, though, I think we also need to box all of the tasks cause they are technically functions:</p>
<p>So the required api today to avoid all unsized types going to the platform would be</p>
<div class="codehilite" data-code-language="Elm"><pre><span></span><code><span class="p">{</span>
<span class="w">    </span><span class="nv">init</span><span class="w"> </span><span class="nf">:</span><span class="w"> </span><span class="kt">Box</span><span class="w"> </span><span class="p">(</span><span class="kt">Task</span><span class="w"> </span><span class="p">(</span><span class="kt">Box</span><span class="w"> </span><span class="nv">state</span><span class="p">)</span><span class="w"> </span><span class="p">[]),</span>
<span class="w">    </span><span class="nv">handleRequest</span><span class="w"> </span><span class="nf">:</span><span class="w"> </span><span class="kt">Box</span><span class="w"> </span><span class="p">(</span><span class="kt">Box</span><span class="w"> </span><span class="nv">state</span><span class="p">,</span><span class="w"> </span><span class="kt">Request</span><span class="w"> </span><span class="nf">-&gt;</span><span class="w"> </span><span class="kt">Box</span><span class="w"> </span><span class="p">(</span><span class="kt">Task</span><span class="w"> </span><span class="kt">Response</span><span class="w"> </span><span class="p">[])),</span>
<span class="p">}</span>
</code></pre></div>
<p>To get this api, we would just ban unboxed functions and unboxed type variables from being passed to the platform api.</p>



<a name="465033111"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/sending%20unsized%20values%20to%20the%20host/near/465033111" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ayaz Hafiz <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/sending.20unsized.20values.20to.20the.20host.html#465033111">(Aug 25 2024 at 18:17)</a>:</h4>
<p>sure, but that’s not a trivial task</p>



<a name="465033136"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/sending%20unsized%20values%20to%20the%20host/near/465033136" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ayaz Hafiz <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/sending.20unsized.20values.20to.20the.20host.html#465033136">(Aug 25 2024 at 18:17)</a>:</h4>
<p>like you need to make sure that every value that is potentially reachable is boxed</p>



<a name="465033559"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/sending%20unsized%20values%20to%20the%20host/near/465033559" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/sending.20unsized.20values.20to.20the.20host.html#465033559">(Aug 25 2024 at 18:22)</a>:</h4>
<p>Is this only a hard problem cause types aren't required to be specified? Like if we require a type for the platform api, doesn't this just become a single traversal of the type?</p>



<a name="465033643"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/sending%20unsized%20values%20to%20the%20host/near/465033643" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/sending.20unsized.20values.20to.20the.20host.html#465033643">(Aug 25 2024 at 18:24)</a>:</h4>
<p>I'm probably thinking too naively, but I think we could require that the platform api is type in a way such that this becomes relatively easy to deal with.</p>



<a name="465044694"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/sending%20unsized%20values%20to%20the%20host/near/465044694" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ayaz Hafiz <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/sending.20unsized.20values.20to.20the.20host.html#465044694">(Aug 25 2024 at 21:37)</a>:</h4>
<p>if you have some closure <code>f</code> deep down in your call stack that makes its way into a data structure given to the host, you need to know to somehow box that closure. for example</p>
<div class="codehilite"><pre><span></span><code>hostExposed = { value: 1, f: makeF {} }

makeF = if Bool.true then make1 {} else make2 {}

make1 = \{} -&gt;
  v = 1
  \u -&gt; u + v

make2 = \u -&gt; u
</code></pre></div>
<p>here you have to know that make1 needs to be boxed, or somehow box it before you give it to the host</p>



<a name="465046986"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/sending%20unsized%20values%20to%20the%20host/near/465046986" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/sending.20unsized.20values.20to.20the.20host.html#465046986">(Aug 25 2024 at 22:24)</a>:</h4>
<p>so the algorithm I was thinking of wouldn't allow functions passed to the host to return unboxed functions.</p>
<p>specifically, the idea would be that in this design the platform sends a total of exactly 1 value to the host (so, "one entrypoint") but of course it can be a record, tuple, etc. That 1 value's type may contain only the following (after expanding type aliases):</p>
<ul>
<li>Builtin opaque types (<code>Str</code>, <code>List</code>, <code>Box</code>, numbers, etc.) - if any userspace opaque type is encountered, it's an error.</li>
<li>Collections of any of these allowed types (e.g. records, tuples, lists, etc.) with the exception of <code>[]</code>, which is disallowed based on other discussions</li>
<li>Lowercase type variables if and only if they are inside a <code>Box</code></li>
<li>Functions, with the following additional restrictions:<ul>
<li>the function may only accept and return one of these allowed types</li>
<li>each of its arguments and return types is checked to make sure that if it contains a function anywhere inside its type, that function is inside a <code>Box</code></li>
</ul>
</li>
</ul>



<a name="465047017"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/sending%20unsized%20values%20to%20the%20host/near/465047017" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/sending.20unsized.20values.20to.20the.20host.html#465047017">(Aug 25 2024 at 22:25)</a>:</h4>
<p>so in this design, the above example would give an error because <code>makeF</code> returns an unboxed function</p>



<a name="465047097"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/sending%20unsized%20values%20to%20the%20host/near/465047097" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/sending.20unsized.20values.20to.20the.20host.html#465047097">(Aug 25 2024 at 22:27)</a>:</h4>
<p>edit: the following is incorrect; I missed something, which Brendan pointed out below</p>
<p>note that it's drawing a distinction between whether a function <em>happens</em> to close over anything (since that can only be knowable after the application has been compiled, and the whole point of this is to get a layout that's statically knowable regardless of what the application's code is), but rather it's crudely assuming that:</p>
<ul>
<li>if it's a top-level function (that is, provided directly in the record or something; not returned by another function) then of course it wouldn't have been able to capture anything</li>
<li>all other functions might capture, so require that they are boxed</li>
</ul>



<a name="465047155"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/sending%20unsized%20values%20to%20the%20host/near/465047155" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/sending.20unsized.20values.20to.20the.20host.html#465047155">(Aug 25 2024 at 22:28)</a>:</h4>
<p>I think this could be done in one pass because the recursive "verify that this type is allowed" function can take one argument for whether any encountered functions must be boxed, and then when you recurse on function args and return value, you just set that to true</p>



<a name="465047370"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/sending%20unsized%20values%20to%20the%20host/near/465047370" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/sending.20unsized.20values.20to.20the.20host.html#465047370">(Aug 25 2024 at 22:33)</a>:</h4>
<p>Top level can still capture in roc:</p>
<div class="codehilite" data-code-language="Elm"><pre><span></span><code><span class="nv">x</span><span class="w"> </span><span class="nf">=</span>
<span class="w">  </span><span class="nv">myCapture</span><span class="w"> </span><span class="nf">=</span><span class="w"> </span><span class="nv">callSomething</span><span class="w"> </span><span class="mi">123</span>
<span class="w">  </span><span class="nf">\</span><span class="nv">abc</span><span class="w"> </span><span class="nf">-&gt;</span>
<span class="w">       </span><span class="nf">...</span>
</code></pre></div>



<a name="465047377"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/sending%20unsized%20values%20to%20the%20host/near/465047377" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/sending.20unsized.20values.20to.20the.20host.html#465047377">(Aug 25 2024 at 22:33)</a>:</h4>
<p>x is a top level function with a capture. Thus needs to be boxed</p>



<a name="465047428"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/sending%20unsized%20values%20to%20the%20host/near/465047428" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/sending.20unsized.20values.20to.20the.20host.html#465047428">(Aug 25 2024 at 22:34)</a>:</h4>
<p>ahh good point, I forgot about that</p>



<a name="465047457"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/sending%20unsized%20values%20to%20the%20host/near/465047457" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/sending.20unsized.20values.20to.20the.20host.html#465047457">(Aug 25 2024 at 22:35)</a>:</h4>
<p>I guess it's fine if all functions have to be boxed since the host will just hold onto those forever anyway</p>



<a name="465054004"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/sending%20unsized%20values%20to%20the%20host/near/465054004" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ayaz Hafiz <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/sending.20unsized.20values.20to.20the.20host.html#465054004">(Aug 26 2024 at 00:05)</a>:</h4>
<p>so you have to annotate makeF as returning a box explicitly?</p>



<a name="465054626"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/sending%20unsized%20values%20to%20the%20host/near/465054626" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/sending.20unsized.20values.20to.20the.20host.html#465054626">(Aug 26 2024 at 00:10)</a>:</h4>
<p>not just annotate it, literally use the <code>Box</code> builtin to wrap it! <span aria-label="big smile" class="emoji emoji-1f604" role="img" title="big smile">:big_smile:</span></p>



<a name="465055684"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/sending%20unsized%20values%20to%20the%20host/near/465055684" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/sending.20unsized.20values.20to.20the.20host.html#465055684">(Aug 26 2024 at 00:21)</a>:</h4>
<p>Basically, roc enforces the types, but the platform author has to actually ensure things are boxed explicitly.</p>
<p>So like the platform might accept a <code>makeF</code> from the app, but it would expose a wrapped version to the underlying host:</p>
<div class="codehilite" data-code-language="Elm"><pre><span></span><code><span class="nv">hostExposed</span><span class="w"> </span><span class="nf">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nv">value</span><span class="nf">:</span><span class="w"> </span><span class="kt">I64</span><span class="p">,</span><span class="w"> </span><span class="nv">f</span><span class="nf">:</span><span class="w"> </span><span class="kt">Box</span><span class="w"> </span><span class="p">(</span><span class="kt">I64</span><span class="w"> </span><span class="nf">-&gt;</span><span class="w"> </span><span class="kt">I64</span><span class="p">)</span><span class="w"> </span><span class="p">}</span>
<span class="nv">hostExposed</span><span class="w"> </span><span class="nf">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nv">value</span><span class="nf">:</span><span class="w"> </span><span class="nv">appExposed</span><span class="nf">.</span><span class="nv">value</span><span class="p">,</span><span class="w"> </span><span class="nv">f</span><span class="nf">:</span><span class="w"> </span><span class="kt">Box</span><span class="nf">.</span><span class="nv">box</span><span class="w"> </span><span class="nv">appExposed</span><span class="nf">.</span><span class="nv">f</span><span class="w"> </span><span class="p">}</span>

<span class="nv">appExposed</span><span class="w"> </span><span class="nf">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nv">value</span><span class="nf">:</span><span class="w"> </span><span class="kt">I64</span><span class="p">,</span><span class="w"> </span><span class="nv">f</span><span class="nf">:</span><span class="w"> </span><span class="kt">I64</span><span class="w"> </span><span class="nf">-&gt;</span><span class="w"> </span><span class="kt">I64</span><span class="w"> </span><span class="p">}</span>
<span class="nv">appExposed</span><span class="w"> </span><span class="nf">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nv">value</span><span class="nf">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="nv">f</span><span class="nf">:</span><span class="w"> </span><span class="nv">makeF</span><span class="w"> </span><span class="p">{}</span><span class="w"> </span><span class="p">}</span>

<span class="nv">makeF</span><span class="w"> </span><span class="nf">:</span><span class="w"> </span><span class="p">{}</span><span class="w"> </span><span class="nf">-&gt;</span><span class="w"> </span><span class="p">(</span><span class="kt">I64</span><span class="w"> </span><span class="nf">-&gt;</span><span class="w"> </span><span class="kt">I64</span><span class="p">)</span>
<span class="nv">makeF</span><span class="w"> </span><span class="nf">=</span><span class="w"> </span><span class="nf">\</span><span class="p">{}</span><span class="w"> </span><span class="nf">-&gt;</span><span class="w"> </span><span class="kr">if</span><span class="w"> </span><span class="kt">Bool</span><span class="nf">.</span><span class="nv">true</span><span class="w"> </span><span class="kr">then</span><span class="w"> </span><span class="nv">make1</span><span class="w"> </span><span class="p">{}</span><span class="w"> </span><span class="kr">else</span><span class="w"> </span><span class="nv">make2</span>

<span class="nv">make1</span><span class="w"> </span><span class="nf">:</span><span class="w"> </span><span class="p">{}</span><span class="w"> </span><span class="nf">-&gt;</span><span class="w"> </span><span class="p">(</span><span class="kt">I64</span><span class="w"> </span><span class="nf">-&gt;</span><span class="w"> </span><span class="kt">I64</span><span class="p">)</span>
<span class="nv">make1</span><span class="w"> </span><span class="nf">=</span><span class="w"> </span><span class="nf">\</span><span class="p">{}</span><span class="w"> </span><span class="nf">-&gt;</span>
<span class="w">  </span><span class="nv">v</span><span class="w"> </span><span class="nf">=</span><span class="w"> </span><span class="mi">1</span>
<span class="w">  </span><span class="nf">\</span><span class="nv">u</span><span class="w"> </span><span class="nf">-&gt;</span><span class="w"> </span><span class="nv">u</span><span class="w"> </span><span class="nf">+</span><span class="w"> </span><span class="nv">v</span>

<span class="nv">make2</span><span class="w"> </span><span class="nf">:</span><span class="w"> </span><span class="kt">I64</span><span class="w"> </span><span class="nf">-&gt;</span><span class="w"> </span><span class="kt">I64</span>
<span class="nv">make2</span><span class="w"> </span><span class="nf">=</span><span class="w"> </span><span class="nf">\</span><span class="nv">u</span><span class="w"> </span><span class="nf">-&gt;</span><span class="w"> </span><span class="nv">u</span>
</code></pre></div>



<a name="465056329"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/sending%20unsized%20values%20to%20the%20host/near/465056329" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ayaz Hafiz <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/sending.20unsized.20values.20to.20the.20host.html#465056329">(Aug 26 2024 at 00:31)</a>:</h4>
<p>i wonder if there’s a simpler solution for the developer than making them write a function that walks the data structure and maps the values to boxed values. if the app has a host-opaque type then you have to always box that on the app side somehow</p>



<a name="465056720"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/sending%20unsized%20values%20to%20the%20host/near/465056720" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/sending.20unsized.20values.20to.20the.20host.html#465056720">(Aug 26 2024 at 00:38)</a>:</h4>
<p>I think for most constructions the amount of nesting here will be pretty shallow. So the required boxing will be minimal and easy to do in the platform. No need to do it on the app side I think.</p>



<a name="465056757"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/sending%20unsized%20values%20to%20the%20host/near/465056757" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/sending.20unsized.20values.20to.20the.20host.html#465056757">(Aug 26 2024 at 00:39)</a>:</h4>
<p>Like going from this app api:</p>
<div class="codehilite" data-code-language="Elm"><pre><span></span><code><span class="p">{</span>
<span class="w">    </span><span class="nv">init</span><span class="w"> </span><span class="nf">:</span><span class="w"> </span><span class="kt">Task</span><span class="w"> </span><span class="nv">state</span><span class="w"> </span><span class="p">[],</span>
<span class="w">    </span><span class="nv">handleRequest</span><span class="w"> </span><span class="nf">:</span><span class="w"> </span><span class="nv">state</span><span class="p">,</span><span class="w"> </span><span class="kt">Request</span><span class="w"> </span><span class="nf">-&gt;</span><span class="w"> </span><span class="kt">Task</span><span class="w"> </span><span class="kt">Response</span><span class="w"> </span><span class="p">[],</span>
<span class="p">}</span>
</code></pre></div>
<p>To this platform host api:</p>
<div class="codehilite" data-code-language="Elm"><pre><span></span><code><span class="p">{</span>
<span class="w">    </span><span class="nv">init</span><span class="w"> </span><span class="nf">:</span><span class="w"> </span><span class="kt">Box</span><span class="w"> </span><span class="p">(</span><span class="kt">Task</span><span class="w"> </span><span class="p">(</span><span class="kt">Box</span><span class="w"> </span><span class="nv">state</span><span class="p">)</span><span class="w"> </span><span class="p">[]),</span>
<span class="w">    </span><span class="nv">handleRequest</span><span class="w"> </span><span class="nf">:</span><span class="w"> </span><span class="kt">Box</span><span class="w"> </span><span class="p">(</span><span class="kt">Box</span><span class="w"> </span><span class="nv">state</span><span class="p">,</span><span class="w"> </span><span class="kt">Request</span><span class="w"> </span><span class="nf">-&gt;</span><span class="w"> </span><span class="kt">Box</span><span class="w"> </span><span class="p">(</span><span class="kt">Task</span><span class="w"> </span><span class="kt">Response</span><span class="w"> </span><span class="p">[])),</span>
<span class="p">}</span>
</code></pre></div>
<p>is not too bad.</p>



<a name="465056769"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/sending%20unsized%20values%20to%20the%20host/near/465056769" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/sending.20unsized.20values.20to.20the.20host.html#465056769">(Aug 26 2024 at 00:39)</a>:</h4>
<div class="codehilite" data-code-language="Elm"><pre><span></span><code><span class="nv">hostExposed</span><span class="w"> </span><span class="nf">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nv">init</span><span class="nf">:</span><span class="w"> </span><span class="kt">Box</span><span class="nf">.</span><span class="nv">box</span><span class="w"> </span><span class="p">(</span><span class="nv">app</span><span class="nf">.</span><span class="nv">init</span><span class="w"> </span><span class="nf">|&gt;</span><span class="w"> </span><span class="kt">Task</span><span class="nf">.</span><span class="nv">map</span><span class="w"> </span><span class="kt">Box</span><span class="nf">.</span><span class="nv">box</span><span class="p">),</span>
<span class="w">    </span><span class="nv">handleRequest</span><span class="nf">:</span>
<span class="w">        </span><span class="kt">Box</span><span class="nf">.</span><span class="nv">box</span><span class="w"> </span><span class="nf">\</span><span class="nv">boxedState</span><span class="p">,</span><span class="w"> </span><span class="nv">request</span><span class="w"> </span><span class="nf">-&gt;</span>
<span class="w">            </span><span class="kt">Box</span><span class="nf">.</span><span class="nv">unbox</span><span class="w"> </span><span class="nv">boxedState</span>
<span class="w">            </span><span class="nf">|&gt;</span><span class="w"> </span><span class="nv">app</span><span class="nf">.</span><span class="nv">handleRequest</span><span class="w"> </span><span class="nv">request</span>
<span class="w">            </span><span class="nf">|&gt;</span><span class="w"> </span><span class="kt">Box</span><span class="nf">.</span><span class="nv">box</span>
<span class="p">}</span>
</code></pre></div>



<a name="465056993"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/sending%20unsized%20values%20to%20the%20host/near/465056993" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/sending.20unsized.20values.20to.20the.20host.html#465056993">(Aug 26 2024 at 00:43)</a>:</h4>
<p>So none of the boxing is exposed to the app author at all.</p>



<a name="465057078"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/sending%20unsized%20values%20to%20the%20host/near/465057078" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/sending.20unsized.20values.20to.20the.20host.html#465057078">(Aug 26 2024 at 00:44)</a>:</h4>
<p>That said, for some complex tree based apis like an action state setup, probably would want to expose boxing to the application author. Otherwise, the entire data structure before being passed to the platform has to be walked with many pieces getting boxed.</p>



<a name="465057325"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/sending%20unsized%20values%20to%20the%20host/near/465057325" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/sending.20unsized.20values.20to.20the.20host.html#465057325">(Aug 26 2024 at 00:48)</a>:</h4>
<p>so my reason for liking this proposed design - for now, at least - is that:</p>
<ul>
<li>no matter what we do in the future, all of this has to work at a minimum - e.g. there isn't a conceivable design where you <em>couldn't</em> send boxed functions to the host - so there's no wasted effort in getting it working in this way</li>
<li>assuming my proposed algorithm is as straightforward to implement as it seems to be, it doesn't seem to be too much effort to get working</li>
<li>it would unblock effect interpreters as well as letting us remove the <code>Model</code> concept (which would unblock other things)</li>
<li>in the future, we can always relax the restrictions as nonbreaking changes</li>
</ul>



<a name="465057665"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/sending%20unsized%20values%20to%20the%20host/near/465057665" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/sending.20unsized.20values.20to.20the.20host.html#465057665">(Aug 26 2024 at 00:52)</a>:</h4>
<blockquote>
<p>it would unblock effect interpreters</p>
</blockquote>
<p>That's awesome! Is this something that could be tested today?</p>



<a name="465059384"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/sending%20unsized%20values%20to%20the%20host/near/465059384" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/sending.20unsized.20values.20to.20the.20host.html#465059384">(Aug 26 2024 at 01:16)</a>:</h4>
<p>Folkert and I tried to get it working, but ran into errors related to lambda sets - which Ayaz's proof-of-concept (which I believe Sam has either started implementing in the compiler or is planning to soon!) should solve</p>



<a name="465093143"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/sending%20unsized%20values%20to%20the%20host/near/465093143" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/sending.20unsized.20values.20to.20the.20host.html#465093143">(Aug 26 2024 at 06:23)</a>:</h4>
<p><span class="user-mention silent" data-user-id="281383">Richard Feldman</span> <a href="#narrow/stream/395097-compiler-development/topic/sending.20unsized.20values.20to.20the.20host/near/465059384">said</a>:</p>
<blockquote>
<p>Folkert and I tried to get it working, but ran into errors related to lambda sets - which Ayaz's proof-of-concept (which I believe Sam has either started implementing in the compiler or is planning to soon!) should solve</p>
</blockquote>
<p>I'm still reading through our current impl and comparing to Ayaz's new proof of concept. I'll be making a big push over labor day weekend since I have no plans the whole weekend!</p>



<a name="467911730"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/sending%20unsized%20values%20to%20the%20host/near/467911730" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Oskar Hahn <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/sending.20unsized.20values.20to.20the.20host.html#467911730">(Sep 05 2024 at 16:16)</a>:</h4>
<p>I am not sure, if I understand this new concept. <span class="user-mention" data-user-id="489294">@Agus Zubiaga</span> <a href="#narrow/stream/302903-platform-development/topic/Tasks.2FEffects.20with.20.60Model.60/near/467899424">explained  here</a> that a <code>Model</code> would be a <code>type variable</code>. It would be possible to write something like <code>updateModel : model -&gt; Task model []</code>.</p>
<p>Is this correct?</p>
<p>How would this typecheck? For example if you have something like:</p>
<div class="codehilite" data-code-language="roc"><pre><span></span><code>Model : U64
updateModel : model -&gt; Task model []
</code></pre></div>
<p>How would it be possible, that <code>updateModel "foo"</code> would throw a type error?</p>
<p>My current problem is, that I want to do something like</p>
<div class="codehilite" data-code-language="roc"><pre><span></span><code>Model: a
updateModel : Model-&gt; Task {} []
</code></pre></div>
<p>There is currently no syntax in roc to express that. Will that be possible with this change? (It does not matter for me, if I have to use a Box).</p>



<a name="467949428"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/sending%20unsized%20values%20to%20the%20host/near/467949428" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/sending.20unsized.20values.20to.20the.20host.html#467949428">(Sep 05 2024 at 18:41)</a>:</h4>
<p>To my understanding, the goal is to allow this in the platform api with the host:</p>
<div class="codehilite" data-code-language="Elm"><pre><span></span><code><span class="nv">updateModel</span><span class="w"> </span><span class="nf">:</span><span class="w"> </span><span class="kt">Box</span><span class="w"> </span><span class="nv">model</span><span class="w"> </span><span class="nf">-&gt;</span><span class="w"> </span><span class="kt">Task</span><span class="w"> </span><span class="p">(</span><span class="kt">Box</span><span class="w"> </span><span class="nv">model</span><span class="p">)</span><span class="w"> </span><span class="p">[]</span>
</code></pre></div>
<p>Both type variables and functions will be allowed to be passed to the host as along as they are boxed.</p>



<a name="467949941"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/sending%20unsized%20values%20to%20the%20host/near/467949941" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/sending.20unsized.20values.20to.20the.20host.html#467949941">(Sep 05 2024 at 18:42)</a>:</h4>
<p>You then could expose something like this to the app:</p>
<div class="codehilite" data-code-language="Elm"><pre><span></span><code><span class="nv">update</span><span class="w"> </span><span class="nf">:</span><span class="w"> </span><span class="nv">model</span><span class="w"> </span><span class="nf">-&gt;</span><span class="w"> </span><span class="kt">Task</span><span class="w"> </span><span class="nv">model</span><span class="w"> </span><span class="p">[]</span>
</code></pre></div>
<p>Your platform <code>updateModel</code> function would just deal with all of the boxing.</p>



<a name="467950009"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/sending%20unsized%20values%20to%20the%20host/near/467950009" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/sending.20unsized.20values.20to.20the.20host.html#467950009">(Sep 05 2024 at 18:43)</a>:</h4>
<p>Whatever the user picks for the model would just work in this case.</p>



<a name="467950141"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/sending%20unsized%20values%20to%20the%20host/near/467950141" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/sending.20unsized.20values.20to.20the.20host.html#467950141">(Sep 05 2024 at 18:43)</a>:</h4>
<p>If you need multiple functions with the same <code>model</code> type variable, you would need to use a tuple or record to link the type variables together.</p>



<a name="467950376"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/sending%20unsized%20values%20to%20the%20host/near/467950376" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/sending.20unsized.20values.20to.20the.20host.html#467950376">(Sep 05 2024 at 18:44)</a>:</h4>
<p>For example. You might expose this to the app:</p>
<div class="codehilite" data-code-language="Elm"><pre><span></span><code><span class="kt">Funcs</span><span class="w"> </span><span class="nv">model</span><span class="nf">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nv">init</span><span class="nf">:</span><span class="w"> </span><span class="p">{}</span><span class="w"> </span><span class="nf">-&gt;</span><span class="w"> </span><span class="kt">Task</span><span class="w"> </span><span class="nv">model</span><span class="w"> </span><span class="p">[]</span>
<span class="w">    </span><span class="nv">update</span><span class="w"> </span><span class="nf">:</span><span class="w"> </span><span class="nv">model</span><span class="w"> </span><span class="nf">-&gt;</span><span class="w"> </span><span class="kt">Task</span><span class="w"> </span><span class="nv">model</span><span class="w"> </span><span class="p">[]</span>
<span class="p">}</span>
</code></pre></div>



<a name="467950679"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/sending%20unsized%20values%20to%20the%20host/near/467950679" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/sending.20unsized.20values.20to.20the.20host.html#467950679">(Sep 05 2024 at 18:45)</a>:</h4>
<p>The paired host type with boxing would be:</p>
<div class="codehilite" data-code-language="Elm"><pre><span></span><code><span class="kt">Funcs</span><span class="w"> </span><span class="nv">model</span><span class="nf">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nv">init</span><span class="nf">:</span><span class="w"> </span><span class="kt">Box</span><span class="w"> </span><span class="p">({}</span><span class="w"> </span><span class="nf">-&gt;</span><span class="w"> </span><span class="kt">Task</span><span class="w"> </span><span class="p">(</span><span class="kt">Box</span><span class="w"> </span><span class="nv">model</span><span class="p">)</span><span class="w"> </span><span class="p">[])</span>
<span class="w">    </span><span class="nv">update</span><span class="w"> </span><span class="nf">:</span><span class="w"> </span><span class="kt">Box</span><span class="w"> </span><span class="p">(</span><span class="kt">Box</span><span class="w"> </span><span class="nv">model</span><span class="w"> </span><span class="nf">-&gt;</span><span class="w"> </span><span class="kt">Task</span><span class="w"> </span><span class="p">(</span><span class="kt">Box</span><span class="w"> </span><span class="nv">model</span><span class="p">)</span><span class="w"> </span><span class="p">[])</span>
<span class="p">}</span>
</code></pre></div>
<p>All the boxing avoids the host dealing with any unsized types.</p>



<a name="467950830"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/sending%20unsized%20values%20to%20the%20host/near/467950830" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/sending.20unsized.20values.20to.20the.20host.html#467950830">(Sep 05 2024 at 18:45)</a>:</h4>
<p>Does that make sense <span class="user-mention" data-user-id="496321">@Oskar Hahn</span>?</p>



<a name="467961061"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/sending%20unsized%20values%20to%20the%20host/near/467961061" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Oskar Hahn <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/sending.20unsized.20values.20to.20the.20host.html#467961061">(Sep 05 2024 at 19:25)</a>:</h4>
<p>Ahh. Thank you. That makes sens. I think I missed the part, that this is only possible in the platform. (Of cause it is)</p>
<p>Is it correct, that with this change, Tasks can be defined anywhere in the platform, not only in the <code>hosted module</code>? So the <code>hosted modules</code> will not be needed anymore?</p>
<p>And what do you think is the timeframe? More like builtin tasks (around halve a year) or more like effect interpreter (around two years).</p>



<a name="467984987"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/sending%20unsized%20values%20to%20the%20host/near/467984987" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/sending.20unsized.20values.20to.20the.20host.html#467984987">(Sep 05 2024 at 21:11)</a>:</h4>
<blockquote>
<p>Tasks can be defined anywhere in the platform, not only in the <code>hosted module</code>?</p>
</blockquote>
<p>I think hosted will still be needed. I think removing it would be an orthogonal problem to this.</p>
<blockquote>
<p>And what do you think is the timeframe? More like builtin tasks (around halve a year) or more like effect interpreter (around two years).</p>
</blockquote>
<p>I would assume more like builtin task, but I'm really not sure.</p>



<hr><p>Last updated: Mar 01 2026 at 12:20 UTC</p>
</html>