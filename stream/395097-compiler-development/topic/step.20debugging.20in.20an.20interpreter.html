<html>
<head><meta charset="utf-8"><title>step debugging in an interpreter · compiler development · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/index.html">compiler development</a></h2>
<h3>Topic: <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/step.20debugging.20in.20an.20interpreter.html">step debugging in an interpreter</a></h3>

<hr>

<base href="https://roc.zulipchat.com">

<head><link href="https://roc-lang.github.io/zulip-export/style.css" rel="stylesheet"></head>

<a name="499959566"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/step%20debugging%20in%20an%20interpreter/near/499959566" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/step.20debugging.20in.20an.20interpreter.html#499959566">(Feb 15 2025 at 23:33)</a>:</h4>
<p>one of the things that's cool about interpreters like Ruby's (which I'll use as an example because I'm the most familiar with it) is that you can do things like:</p>
<ul>
<li>when there's a <code>crash</code>, immediately halt the program and drop into a step debugger on the command line (assuming the process was spawned from the command line)</li>
<li>alternatively, allow setting breakpoints in advance (by various means; I want to leave out of scope of this thread exactly what the interface should be for setting breakpoints)</li>
<li>once you're in debugging mode, you can change source files on the fly - even including changing the next line right after where the program is currently paused - and when you continue running the program, these changes have magically been applied</li>
</ul>



<a name="499959631"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/step%20debugging%20in%20an%20interpreter/near/499959631" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/step.20debugging.20in.20an.20interpreter.html#499959631">(Feb 15 2025 at 23:34)</a>:</h4>
<p>this seems both awesome and also feasible with our planned interpreter backend, such that when you do <code>roc foo.roc</code> it just supports all of this right away, as long as you didn't pass <code>--optimize</code> to <code>roc</code></p>



<a name="499959652"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/step%20debugging%20in%20an%20interpreter/near/499959652" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/step.20debugging.20in.20an.20interpreter.html#499959652">(Feb 15 2025 at 23:34)</a>:</h4>
<p>however, it's still nontrivial!</p>



<a name="499959677"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/step%20debugging%20in%20an%20interpreter/near/499959677" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/step.20debugging.20in.20an.20interpreter.html#499959677">(Feb 15 2025 at 23:35)</a>:</h4>
<p>for reasons I'd also prefer to keep out of scope of this thread, let's assume that we are interpreting canonicalized IR</p>



<a name="499959786"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/step%20debugging%20in%20an%20interpreter/near/499959786" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/step.20debugging.20in.20an.20interpreter.html#499959786">(Feb 15 2025 at 23:36)</a>:</h4>
<p>if the debugger pauses the interpreter on a particular IR node, and you change the source file on disk...when you resume the interpreter, how does it know that the source file changed? And how can it modify the upcoming instructions, including the very next line of the program, when it's in the middle of interpreting a canonical IR in memory?</p>



<a name="499959937"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/step%20debugging%20in%20an%20interpreter/near/499959937" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/step.20debugging.20in.20an.20interpreter.html#499959937">(Feb 15 2025 at 23:39)</a>:</h4>
<p>regarding how we know the source file changed, at first I thought we could just diff the current source file after you hit resume (or step, etc.) to see if it changed, but then I realized you might have edited another module - possibly one that's not even directly imported by this one, but rather indirectly imported</p>



<a name="499959944"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/step%20debugging%20in%20an%20interpreter/near/499959944" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/step.20debugging.20in.20an.20interpreter.html#499959944">(Feb 15 2025 at 23:39)</a>:</h4>
<p>in that scenario, are we really going to re-check the disk every single time we call a function from another module? That would be way too slow.</p>



<a name="499960022"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/step%20debugging%20in%20an%20interpreter/near/499960022" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/step.20debugging.20in.20an.20interpreter.html#499960022">(Feb 15 2025 at 23:40)</a>:</h4>
<p>instead, the fast way to do this would be that, whenever <code>roc</code> is running a program with debugging enabled, it sets up a watch on every file that gets imported, and whenever that file changes, we know it's time to rebuild the canonical IR (and potentially report new compilation errors)</p>



<a name="499960034"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/step%20debugging%20in%20an%20interpreter/near/499960034" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/step.20debugging.20in.20an.20interpreter.html#499960034">(Feb 15 2025 at 23:40)</a>:</h4>
<p>at this point I realized if we have that, then we have realtime hot code loading <span aria-label="sweat smile" class="emoji emoji-1f605" role="img" title="sweat smile">:sweat_smile:</span></p>



<a name="499960219"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/step%20debugging%20in%20an%20interpreter/near/499960219" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/step.20debugging.20in.20an.20interpreter.html#499960219">(Feb 15 2025 at 23:43)</a>:</h4>
<p>so really, I think the experience I mentioned at the start the thread can be broken down into two projects:</p>
<ul>
<li>realtime hot code loading for the interpreter based on file watching</li>
<li>the debugger being able to halt the program, step, etc.</li>
</ul>



<a name="499960281"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/step%20debugging%20in%20an%20interpreter/near/499960281" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/step.20debugging.20in.20an.20interpreter.html#499960281">(Feb 15 2025 at 23:44)</a>:</h4>
<p>there might be a bit of coordination between the two, but I think the vast majority of each of those projects seem totally independent of one another</p>



<a name="499960326"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/step%20debugging%20in%20an%20interpreter/near/499960326" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/step.20debugging.20in.20an.20interpreter.html#499960326">(Feb 15 2025 at 23:45)</a>:</h4>
<p>e.g. the hot code loading needs to (I think) keep around the source file hashes in memory, along with the dependency graph, so it can efficiently tell which IRs need to be rebuilt in memory when source files change on disk</p>



<a name="499960362"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/step%20debugging%20in%20an%20interpreter/near/499960362" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/step.20debugging.20in.20an.20interpreter.html#499960362">(Feb 15 2025 at 23:45)</a>:</h4>
<p>I think it also needs to have a string-based translation step for "upgrading" all the interned IDs and such when a source file changes</p>



<a name="499960418"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/step%20debugging%20in%20an%20interpreter/near/499960418" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Warner <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/step.20debugging.20in.20an.20interpreter.html#499960418">(Feb 15 2025 at 23:46)</a>:</h4>
<p>Rather than keeping around hashes in memory, I would instead (or in addition) keep around the stat - mtime, ctime, inode, size - and if none of those have changed, assume the hash hasn't changed either</p>



<a name="499960448"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/step%20debugging%20in%20an%20interpreter/near/499960448" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/step.20debugging.20in.20an.20interpreter.html#499960448">(Feb 15 2025 at 23:47)</a>:</h4>
<p>yep, we can do both! Related: <a href="https://apenwarr.ca/log/20181113">https://apenwarr.ca/log/20181113</a></p>



<a name="499960468"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/step%20debugging%20in%20an%20interpreter/near/499960468" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/step.20debugging.20in.20an.20interpreter.html#499960468">(Feb 15 2025 at 23:47)</a>:</h4>
<p>although that's more about rebuilds</p>



<a name="499960483"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/step%20debugging%20in%20an%20interpreter/near/499960483" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/step.20debugging.20in.20an.20interpreter.html#499960483">(Feb 15 2025 at 23:47)</a>:</h4>
<p>if we're running and have OS file watches set up, then we get events whenever things change (and if they changed, then certainly mtime changed)</p>



<a name="499960545"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/step%20debugging%20in%20an%20interpreter/near/499960545" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Warner <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/step.20debugging.20in.20an.20interpreter.html#499960545">(Feb 15 2025 at 23:48)</a>:</h4>
<p>OS file watches are not completely reliable, FWIW</p>



<a name="499960554"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/step%20debugging%20in%20an%20interpreter/near/499960554" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Warner <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/step.20debugging.20in.20an.20interpreter.html#499960554">(Feb 15 2025 at 23:48)</a>:</h4>
<blockquote>
<p>(and if they changed, then certainly mtime changed)</p>
</blockquote>
<p>This is very much not true</p>



<a name="499960562"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/step%20debugging%20in%20an%20interpreter/near/499960562" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/step.20debugging.20in.20an.20interpreter.html#499960562">(Feb 15 2025 at 23:48)</a>:</h4>
<p>oh, true</p>



<a name="499960566"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/step%20debugging%20in%20an%20interpreter/near/499960566" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/step.20debugging.20in.20an.20interpreter.html#499960566">(Feb 15 2025 at 23:48)</a>:</h4>
<p>given second resolution etc.</p>



<a name="499960593"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/step%20debugging%20in%20an%20interpreter/near/499960593" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Warner <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/step.20debugging.20in.20an.20interpreter.html#499960593">(Feb 15 2025 at 23:49)</a>:</h4>
<p>Yeah, also some apps have the annoying proclivity to modify a file and then set the mtime to some earlier time (perhaps the exact same time)</p>



<a name="499960647"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/step%20debugging%20in%20an%20interpreter/near/499960647" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Warner <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/step.20debugging.20in.20an.20interpreter.html#499960647">(Feb 15 2025 at 23:50)</a>:</h4>
<p>The particular such apps I know of are not text editors tho. Text editors are probably not being that sneaky.</p>



<a name="499960663"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/step%20debugging%20in%20an%20interpreter/near/499960663" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/step.20debugging.20in.20an.20interpreter.html#499960663">(Feb 15 2025 at 23:50)</a>:</h4>
<p>hopefully haha</p>



<a name="499960668"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/step%20debugging%20in%20an%20interpreter/near/499960668" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/step.20debugging.20in.20an.20interpreter.html#499960668">(Feb 15 2025 at 23:50)</a>:</h4>
<p>regardless, I haven't heard of OS file watching APIs being unreliable</p>



<a name="499960678"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/step%20debugging%20in%20an%20interpreter/near/499960678" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/step.20debugging.20in.20an.20interpreter.html#499960678">(Feb 15 2025 at 23:50)</a>:</h4>
<p>do you have any links I could read to learn more?</p>



<a name="499960928"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/step%20debugging%20in%20an%20interpreter/near/499960928" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Warner <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/step.20debugging.20in.20an.20interpreter.html#499960928">(Feb 15 2025 at 23:55)</a>:</h4>
<p>See <a href="https://developer.apple.com/documentation/coreservices/kfseventstreameventflaguserdropped">https://developer.apple.com/documentation/coreservices/kfseventstreameventflaguserdropped</a> for example</p>



<a name="499960992"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/step%20debugging%20in%20an%20interpreter/near/499960992" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Warner <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/step.20debugging.20in.20an.20interpreter.html#499960992">(Feb 15 2025 at 23:56)</a>:</h4>
<p><code>watchman</code> handles that sort of thing for you</p>



<a name="499960999"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/step%20debugging%20in%20an%20interpreter/near/499960999" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Warner <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/step.20debugging.20in.20an.20interpreter.html#499960999">(Feb 15 2025 at 23:56)</a>:</h4>
<p>(as probably do many libraries that abstract over file events)</p>



<a name="499961097"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/step%20debugging%20in%20an%20interpreter/near/499961097" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Warner <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/step.20debugging.20in.20an.20interpreter.html#499961097">(Feb 15 2025 at 23:58)</a>:</h4>
<p>That sort of thing can happen if the system is under heavy filesystem load, for instance</p>



<a name="499961102"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/step%20debugging%20in%20an%20interpreter/near/499961102" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Warner <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/step.20debugging.20in.20an.20interpreter.html#499961102">(Feb 15 2025 at 23:58)</a>:</h4>
<p>OSes generally prioritize availability over delivering all file events</p>



<a name="499961126"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/step%20debugging%20in%20an%20interpreter/near/499961126" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Warner <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/step.20debugging.20in.20an.20interpreter.html#499961126">(Feb 15 2025 at 23:59)</a>:</h4>
<p>Switching branches in a large repo can trigger that sort of behavior quite frequently</p>



<a name="499961479"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/step%20debugging%20in%20an%20interpreter/near/499961479" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/step.20debugging.20in.20an.20interpreter.html#499961479">(Feb 16 2025 at 00:03)</a>:</h4>
<p>oh I see</p>



<a name="499961484"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/step%20debugging%20in%20an%20interpreter/near/499961484" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/step.20debugging.20in.20an.20interpreter.html#499961484">(Feb 16 2025 at 00:03)</a>:</h4>
<p>well that's just normal error handling though right?</p>



<a name="499961496"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/step%20debugging%20in%20an%20interpreter/near/499961496" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/step.20debugging.20in.20an.20interpreter.html#499961496">(Feb 16 2025 at 00:04)</a>:</h4>
<p>like the OS still informs us that a full file scan is necessary, it's not like we just silently don't get any info</p>



<a name="499961546"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/step%20debugging%20in%20an%20interpreter/near/499961546" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Warner <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/step.20debugging.20in.20an.20interpreter.html#499961546">(Feb 16 2025 at 00:04)</a>:</h4>
<p>I believe so, yes</p>



<a name="499961552"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/step%20debugging%20in%20an%20interpreter/near/499961552" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Warner <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/step.20debugging.20in.20an.20interpreter.html#499961552">(Feb 16 2025 at 00:04)</a>:</h4>
<p>Of course the same caveats for mtime often apply to file events</p>



<a name="499961577"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/step%20debugging%20in%20an%20interpreter/near/499961577" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Warner <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/step.20debugging.20in.20an.20interpreter.html#499961577">(Feb 16 2025 at 00:05)</a>:</h4>
<p>e.g. memory mapped files can delay file events (and maybe suppress them altogether?)</p>



<a name="499961658"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/step%20debugging%20in%20an%20interpreter/near/499961658" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Warner <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/step.20debugging.20in.20an.20interpreter.html#499961658">(Feb 16 2025 at 00:06)</a>:</h4>
<p>That said, I would be very much not shocked to learn that there are OSes and configurations thereof that can legitimately drop file events with no notice.</p>



<a name="499961681"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/step%20debugging%20in%20an%20interpreter/near/499961681" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Warner <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/step.20debugging.20in.20an.20interpreter.html#499961681">(Feb 16 2025 at 00:06)</a>:</h4>
<p>File events are generally not treated with the same level of care as other file system operations</p>



<a name="499961832"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/step%20debugging%20in%20an%20interpreter/near/499961832" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Warner <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/step.20debugging.20in.20an.20interpreter.html#499961832">(Feb 16 2025 at 00:08)</a>:</h4>
<p>Anyway, popping back up a level, I'd recommend looking at how the git index works</p>



<a name="499961843"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/step%20debugging%20in%20an%20interpreter/near/499961843" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Warner <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/step.20debugging.20in.20an.20interpreter.html#499961843">(Feb 16 2025 at 00:08)</a>:</h4>
<p>That's the sort of state we'd want to keep in memory</p>



<a name="499962516"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/step%20debugging%20in%20an%20interpreter/near/499962516" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Warner <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/step.20debugging.20in.20an.20interpreter.html#499962516">(Feb 16 2025 at 00:18)</a>:</h4>
<p>And, popping back to the original discussion, debuggers / hot reloading is very cool! (and complicated)</p>



<a name="499962520"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/step%20debugging%20in%20an%20interpreter/near/499962520" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Warner <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/step.20debugging.20in.20an.20interpreter.html#499962520">(Feb 16 2025 at 00:18)</a>:</h4>
<p>I'm reminded about <a href="https://mun-lang.org/">https://mun-lang.org/</a></p>



<a name="499962787"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/step%20debugging%20in%20an%20interpreter/near/499962787" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/step.20debugging.20in.20an.20interpreter.html#499962787">(Feb 16 2025 at 00:22)</a>:</h4>
<p>I think there's going to be some overlap between what we'll want for caching, what we'll want for editor tooling, and what we'll want for hot code loading</p>



<a name="499966133"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/step%20debugging%20in%20an%20interpreter/near/499966133" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/step.20debugging.20in.20an.20interpreter.html#499966133">(Feb 16 2025 at 01:16)</a>:</h4>
<p>This sounds fun. I'm for it</p>



<a name="499966212"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/step%20debugging%20in%20an%20interpreter/near/499966212" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/step.20debugging.20in.20an.20interpreter.html#499966212">(Feb 16 2025 at 01:16)</a>:</h4>
<p>Also, I think general hot code reloading would be much  easier than patching mid function</p>



<a name="499966603"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/step%20debugging%20in%20an%20interpreter/near/499966603" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/step.20debugging.20in.20an.20interpreter.html#499966603">(Feb 16 2025 at 01:22)</a>:</h4>
<p>Also, I'm more used to seeing a repl from debugger mid function than patching. I think that also is an easier problem to solve than full mid function patching</p>



<a name="499967955"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/step%20debugging%20in%20an%20interpreter/near/499967955" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/step.20debugging.20in.20an.20interpreter.html#499967955">(Feb 16 2025 at 01:44)</a>:</h4>
<p>I actually suspect it's not as hard as it sounds</p>



<a name="499967982"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/step%20debugging%20in%20an%20interpreter/near/499967982" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/step.20debugging.20in.20an.20interpreter.html#499967982">(Feb 16 2025 at 01:45)</a>:</h4>
<p>basically you do a diff and it's just very conservative</p>



<a name="499968070"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/step%20debugging%20in%20an%20interpreter/near/499968070" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/step.20debugging.20in.20an.20interpreter.html#499968070">(Feb 16 2025 at 01:46)</a>:</h4>
<p>if anything changed about the function you're in the middle of executing while the debugger is stopped, you verify that absolutely nothing changed prior to the current line where you're paused</p>



<a name="499968172"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/step%20debugging%20in%20an%20interpreter/near/499968172" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/step.20debugging.20in.20an.20interpreter.html#499968172">(Feb 16 2025 at 01:48)</a>:</h4>
<p>bc if it did, then you can no longer be confident that the state you're currently in at runtime even exists in the new source file</p>



<a name="499968223"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/step%20debugging%20in%20an%20interpreter/near/499968223" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/step.20debugging.20in.20an.20interpreter.html#499968223">(Feb 16 2025 at 01:49)</a>:</h4>
<p>whereas if the entire function up to the current place where you're paused is unchanged, then you can re-canonicalize, use source regions to find the place in the new canonical iR where you need to pick up, and go from there</p>



<a name="499968285"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/step%20debugging%20in%20an%20interpreter/near/499968285" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/step.20debugging.20in.20an.20interpreter.html#499968285">(Feb 16 2025 at 01:50)</a>:</h4>
<p>and if anything changed in the function after where you paused, it's fine</p>



<a name="499968605"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/step%20debugging%20in%20an%20interpreter/near/499968605" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Warner <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/step.20debugging.20in.20an.20interpreter.html#499968605">(Feb 16 2025 at 01:56)</a>:</h4>
<p>You also need to know that the parts of the function that have changed either haven't been run, or wouldn't have contributed to the current state of the program - i.e. you need to keep track of code coverage</p>



<a name="499968611"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/step%20debugging%20in%20an%20interpreter/near/499968611" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Warner <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/step.20debugging.20in.20an.20interpreter.html#499968611">(Feb 16 2025 at 01:56)</a>:</h4>
<p>(maybe that's what you meant)</p>



<a name="499969939"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/step%20debugging%20in%20an%20interpreter/near/499969939" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/step.20debugging.20in.20an.20interpreter.html#499969939">(Feb 16 2025 at 02:19)</a>:</h4>
<p>yeah a crude form of that - just source diff basically</p>



<a name="499969994"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/step%20debugging%20in%20an%20interpreter/near/499969994" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/step.20debugging.20in.20an.20interpreter.html#499969994">(Feb 16 2025 at 02:20)</a>:</h4>
<p>I guess a fancier version could do an IR diff</p>



<a name="499970005"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/step%20debugging%20in%20an%20interpreter/near/499970005" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/step.20debugging.20in.20an.20interpreter.html#499970005">(Feb 16 2025 at 02:20)</a>:</h4>
<p>in case you only added a comment or something</p>



<a name="499973283"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/step%20debugging%20in%20an%20interpreter/near/499973283" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/step.20debugging.20in.20an.20interpreter.html#499973283">(Feb 16 2025 at 03:16)</a>:</h4>
<blockquote>
<p>if anything changed about the function you're in the middle of executing while the debugger is stopped, you verify that absolutely nothing changed prior to the current line where you're paused</p>
</blockquote>
<p>This sounds less nice than just getting an a REPL, but I guess we can support both</p>



<a name="499973940"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/step%20debugging%20in%20an%20interpreter/near/499973940" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/step.20debugging.20in.20an.20interpreter.html#499973940">(Feb 16 2025 at 03:29)</a>:</h4>
<p>oh sorry, I do actually mean both <span aria-label="big smile" class="emoji emoji-1f604" role="img" title="big smile">:big_smile:</span></p>



<a name="499973944"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/step%20debugging%20in%20an%20interpreter/near/499973944" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/step.20debugging.20in.20an.20interpreter.html#499973944">(Feb 16 2025 at 03:29)</a>:</h4>
<p>like in Ruby you get a repl + debugger at the same time</p>



<a name="499973952"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/step%20debugging%20in%20an%20interpreter/near/499973952" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/step.20debugging.20in.20an.20interpreter.html#499973952">(Feb 16 2025 at 03:29)</a>:</h4>
<p>like you're in a repl, but then also you have access to debugging commands for stepping, resuming, etc.</p>



<a name="499974020"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/step%20debugging%20in%20an%20interpreter/near/499974020" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/step.20debugging.20in.20an.20interpreter.html#499974020">(Feb 16 2025 at 03:30)</a>:</h4>
<p>Yeah, so I guess all 3? repl + debugger + hot reloading (even line by line in the debugger)?</p>



<a name="499974037"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/step%20debugging%20in%20an%20interpreter/near/499974037" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/step.20debugging.20in.20an.20interpreter.html#499974037">(Feb 16 2025 at 03:30)</a>:</h4>
<p>yep! <span aria-label="grinning face with smiling eyes" class="emoji emoji-1f601" role="img" title="grinning face with smiling eyes">:grinning_face_with_smiling_eyes:</span></p>



<hr><p>Last updated: Mar 01 2026 at 12:20 UTC</p>
</html>