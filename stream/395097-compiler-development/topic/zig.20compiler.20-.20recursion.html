<html>
<head><meta charset="utf-8"><title>zig compiler - recursion · compiler development · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/index.html">compiler development</a></h2>
<h3>Topic: <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20recursion.html">zig compiler - recursion</a></h3>

<hr>

<base href="https://roc.zulipchat.com">

<head><link href="https://roc-lang.github.io/zulip-export/style.css" rel="stylesheet"></head>

<a name="521851590"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20recursion/near/521851590" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jared Ramirez <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20recursion.html#521851590">(Jun 02 2025 at 21:56)</a>:</h4>
<p><span class="user-mention silent" data-user-id="343810">Brendan Hansknecht</span> <a href="#narrow/channel/395097-compiler-development/topic/casual.20conversation/near/521448522">said</a>:</p>
<blockquote>
<p>For example, a list or a box should break infinite recursion and be valid:</p>
<p><div class="codehilite"><pre><span></span><code>Node a: { data: a, children: List(Node(a)) }
</code></pre></div><br>
</p>
</blockquote>
<p>For this (and your other example), these would need to be wrapped in a nominal type, not an alias, correct? Based on <a href="https://github.com/roc-lang/rfcs/blob/ayaz/compile-with-lambda-sets/0101-compiling-recursive-types.md#1-recursive-types-must-have-a-explicit-point-of-recursion">this RFC</a></p>



<a name="521851684"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20recursion/near/521851684" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20recursion.html#521851684">(Jun 02 2025 at 21:57)</a>:</h4>
<p>I hope not</p>



<a name="521851709"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20recursion/near/521851709" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20recursion.html#521851709">(Jun 02 2025 at 21:57)</a>:</h4>
<p>At least for the list one (same with box, set, dict, etc)</p>



<a name="521851850"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20recursion/near/521851850" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20recursion.html#521851850">(Jun 02 2025 at 21:58)</a>:</h4>
<p>For the other one, I think nominal type is reasonable and should make the rfc</p>



<a name="521852454"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20recursion/near/521852454" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Notification Bot <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20recursion.html#521852454">(Jun 02 2025 at 22:02)</a>:</h4>
<p>4 messages were moved here from <a class="stream-topic" data-stream-id="395097" href="/#narrow/channel/395097-compiler-development/topic/casual.20conversation/with/373264697">#compiler development &gt; casual conversation</a> by <span class="user-mention silent" data-user-id="341568">Jared Ramirez</span>.</p>



<a name="521853366"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20recursion/near/521853366" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jared Ramirez <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20recursion.html#521853366">(Jun 02 2025 at 22:09)</a>:</h4>
<p>Moving this into its own topic!</p>
<p>I’m a bit confused about what kinds of recursion are allowed and what aren’t. I’ve been working on implementing an occurs check based on this <a href="https://github.com/roc-lang/rfcs/blob/ayaz/compile-with-lambda-sets/0101-compiling-recursive-types.md#1-recursive-types-must-have-a-explicit-point-of-recursion">RFC</a> — but it’s possible I misunderstood the intent there.</p>
<p>My understanding was that, due to the issue outlined in that RFC, the problem stemmed from recursive types that are equivalent-but-not-equal, which lead to layout mismatches. I thought the proposed solution in the new compiler was to require all recursion to go through a nominal type. That seemed to be echoed in <a href="#narrow/channel/231634-beginners/topic/Help.20implementing.20recursive.20type.3F/with/497919873">this Zulip thread</a> as well.</p>
<p>I'm not taking a position on whether recursion <em>should</em> always go through nominal types — I just want to clarify what the actual rules are, so I can implement the correct behavior!</p>



<a name="521855075"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20recursion/near/521855075" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20recursion.html#521855075">(Jun 02 2025 at 22:24)</a>:</h4>
<p><span class="user-mention" data-user-id="454654">@Ayaz Hafiz</span> would be the expert on this topic for sure <span aria-label="smile" class="emoji emoji-1f604" role="img" title="smile">:smile:</span></p>



<a name="521855600"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20recursion/near/521855600" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20recursion.html#521855600">(Jun 02 2025 at 22:28)</a>:</h4>
<p>Personally, I want to just special case list and box (special casing list by extension special cases dict and set which are implemented with list). </p>
<p>They contain pointers (that is just part of the implementation). As such, they should always break recursion.</p>



<a name="521855624"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20recursion/near/521855624" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20recursion.html#521855624">(Jun 02 2025 at 22:28)</a>:</h4>
<p>So no matter the rest of the rules, I think those need special casing</p>



<a name="522426077"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20recursion/near/522426077" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ayaz Hafiz <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20recursion.html#522426077">(Jun 04 2025 at 18:33)</a>:</h4>
<p>I think the only way to make it work is to have the recursion only allowed if it's defined from a nominal type</p>



<a name="522426152"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20recursion/near/522426152" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ayaz Hafiz <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20recursion.html#522426152">(Jun 04 2025 at 18:33)</a>:</h4>
<blockquote>
<p>require all recursion to go through a nominal type<br>
this is the way imo</p>
</blockquote>



<a name="522454411"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20recursion/near/522454411" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20recursion.html#522454411">(Jun 04 2025 at 21:25)</a>:</h4>
<p>so in other words this would work:</p>
<div class="codehilite"><pre><span></span><code>Node(a) := [Node({ data: a, children: List(Node(a)) })]
</code></pre></div>
<p>...but the type alias version with an anonymous record wouldn't work: (the distinction being <code>:</code> vs <code>:=</code>)</p>
<div class="codehilite"><pre><span></span><code>Node(a) : { data: a, children: List(Node(a)) }
</code></pre></div>



<a name="522462595"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20recursion/near/522462595" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20recursion.html#522462595">(Jun 04 2025 at 22:31)</a>:</h4>
<p>i hope we have a really good error message for this</p>



<a name="522462628"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20recursion/near/522462628" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20recursion.html#522462628">(Jun 04 2025 at 22:31)</a>:</h4>
<p>this is going to feel surprising for functional devs</p>



<a name="522462802"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20recursion/near/522462802" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20recursion.html#522462802">(Jun 04 2025 at 22:32)</a>:</h4>
<p>yeah error message can be very direct</p>



<a name="522462820"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20recursion/near/522462820" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20recursion.html#522462820">(Jun 04 2025 at 22:33)</a>:</h4>
<p>like "hey you need to do it this other way"</p>



<a name="522463063"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20recursion/near/522463063" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20recursion.html#522463063">(Jun 04 2025 at 22:35)</a>:</h4>
<p>i meant that i think it should explain why. it seems arbitrary if you aren't used to thinking about memory layout</p>



<a name="522463535"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20recursion/near/522463535" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ayaz Hafiz <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20recursion.html#522463535">(Jun 04 2025 at 22:40)</a>:</h4>
<p>there are good explanations without invoking memory layout. most ML family languages require names for types like these anyway</p>



<a name="522463765"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20recursion/near/522463765" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20recursion.html#522463765">(Jun 04 2025 at 22:42)</a>:</h4>
<p>Sure, but we aren't talking about anonymous records versus nominal. we are talking about named (via alias here) versus nominal. i think many will struggle to understand why one is boxed and one is not</p>



<a name="522463843"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20recursion/near/522463843" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20recursion.html#522463843">(Jun 04 2025 at 22:43)</a>:</h4>
<p>Even being called an alias, I think many will feel "Node(a) = ..." is naming a type</p>



<a name="522465871"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20recursion/near/522465871" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20recursion.html#522465871">(Jun 04 2025 at 23:03)</a>:</h4>
<p>there's actually no difference in terms of boxing</p>



<a name="522465910"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20recursion/near/522465910" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20recursion.html#522465910">(Jun 04 2025 at 23:03)</a>:</h4>
<p>I don't know if there's an explanation concise enough to fit in an error message <span aria-label="sweat smile" class="emoji emoji-1f605" role="img" title="sweat smile">:sweat_smile:</span></p>



<a name="522465995"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20recursion/near/522465995" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20recursion.html#522465995">(Jun 04 2025 at 23:04)</a>:</h4>
<p>the reason for the design decision is so subtle  that nobody even realized it was a problem until people had been making Roc programs for years</p>



<a name="522466765"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20recursion/near/522466765" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ayaz Hafiz <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20recursion.html#522466765">(Jun 04 2025 at 23:12)</a>:</h4>
<p>the explanation is that Roc needs to know where the recursion happens and with anonymous and alias types the point is ambiguous. You need to know where recursion happens for efficiency reasons</p>



<a name="522466814"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20recursion/near/522466814" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ayaz Hafiz <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20recursion.html#522466814">(Jun 04 2025 at 23:13)</a>:</h4>
<p>you could also break module isolation in implementation which solves this problem without the surface level change. but that is harder to implement</p>



<a name="522466850"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20recursion/near/522466850" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ayaz Hafiz <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20recursion.html#522466850">(Jun 04 2025 at 23:13)</a>:</h4>
<p>it’s really an implementation constraint</p>



<a name="522467202"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20recursion/near/522467202" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20recursion.html#522467202">(Jun 04 2025 at 23:15)</a>:</h4>
<p>i guess i don't even understand it <span aria-label="rolling on the floor laughing" class="emoji emoji-1f923" role="img" title="rolling on the floor laughing">:rolling_on_the_floor_laughing:</span><span aria-label="rolling on the floor laughing" class="emoji emoji-1f923" role="img" title="rolling on the floor laughing">:rolling_on_the_floor_laughing:</span><span aria-label="rolling on the floor laughing" class="emoji emoji-1f923" role="img" title="rolling on the floor laughing">:rolling_on_the_floor_laughing:</span></p>



<a name="522469206"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20recursion/near/522469206" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jared Ramirez <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20recursion.html#522469206">(Jun 04 2025 at 23:36)</a>:</h4>
<p><span class="user-mention silent" data-user-id="281383">Richard Feldman</span> <a href="#narrow/channel/395097-compiler-development/topic/zig.20compiler.20-.20recursion/near/522454411">said</a>:</p>
<blockquote>
<p><code>Node(a) := [Node({ data: a, children: List(Node(a)) })]</code></p>
</blockquote>
<p>I <em>think</em> this would also work?</p>
<div class="codehilite"><pre><span></span><code>Node(a) := { data: a, children: List(Node(a)) }

node = @Node({ ... })
</code></pre></div>
<p>Since it's a List (which breaks recursion), and passes thru a nominal type</p>
<p>Or maybe this <em>would've</em> worked with opaque types in the old compiler, but will not with nominal types in the new one? I'm not clear on exactly how nominal types will work (eg how to construct them, with an <code>@</code>?)</p>



<a name="522471659"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20recursion/near/522471659" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20recursion.html#522471659">(Jun 05 2025 at 00:03)</a>:</h4>
<p>I think <code>List(a)</code> and <code>Box(a)</code> should be special exceptions that don't require nominal types.</p>



<a name="522471675"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20recursion/near/522471675" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20recursion.html#522471675">(Jun 05 2025 at 00:03)</a>:</h4>
<p>they should work with simple aliases.</p>



<a name="522471819"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20recursion/near/522471819" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20recursion.html#522471819">(Jun 05 2025 at 00:05)</a>:</h4>
<p>Given <code>List(a)</code> and <code>Box(a)</code> are guaranteed to break recursion, I see no reason they need nominal types.</p>



<a name="522471902"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20recursion/near/522471902" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20recursion.html#522471902">(Jun 05 2025 at 00:05)</a>:</h4>
<p>If you see <code>List(a)</code> simply don't check for recursion on the <code>a</code>.</p>



<a name="522471963"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20recursion/near/522471963" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20recursion.html#522471963">(Jun 05 2025 at 00:06)</a>:</h4>
<p>So to the recursion checker, these two should be equivalent:</p>
<div class="codehilite"><pre><span></span><code>Node(a) : { data: a, children: List(Node(a)) }
</code></pre></div>
<div class="codehilite"><pre><span></span><code>Node(a) : { data: a, children: List({}) }
</code></pre></div>



<a name="522474016"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20recursion/near/522474016" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20recursion.html#522474016">(Jun 05 2025 at 00:31)</a>:</h4>
<p>so the current planned design, which I'm already thinking should be tweaked slightly, is that only nominal tag unions are a thing</p>



<a name="522474057"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20recursion/near/522474057" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20recursion.html#522474057">(Jun 05 2025 at 00:32)</a>:</h4>
<p>the way those work is that I can use <code>:=</code> but only if the thing right after it is a tag union, and then it becomes nominal</p>



<a name="522474114"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20recursion/near/522474114" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20recursion.html#522474114">(Jun 05 2025 at 00:33)</a>:</h4>
<p>and the way I refer to its variants are by fully-qualifiyng them with the name of the type, e.g. this would work:</p>
<div class="codehilite" data-code-language="Haskell"><pre><span></span><code><span class="kt">ConsList</span><span class="p">(</span><span class="n">a</span><span class="p">)</span><span class="w"> </span><span class="kt">:=</span><span class="w"> </span><span class="p">[</span><span class="kt">Nil</span><span class="p">,</span><span class="w"> </span><span class="kt">Node</span><span class="p">(</span><span class="kt">ConsList</span><span class="p">(</span><span class="n">a</span><span class="p">))]</span>

<span class="nf">empty</span><span class="w"> </span><span class="kt">:</span><span class="w"> </span><span class="kt">ConsList</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
<span class="nf">empty</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="kt">ConsList</span><span class="o">.</span><span class="kt">Nil</span>
</code></pre></div>



<a name="522474968"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20recursion/near/522474968" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20recursion.html#522474968">(Jun 05 2025 at 00:42)</a>:</h4>
<p><span class="user-mention silent" data-user-id="343810">Brendan Hansknecht</span> <a href="#narrow/channel/395097-compiler-development/topic/zig.20compiler.20-.20recursion/near/522471963">said</a>:</p>
<blockquote>
<p>So to the recursion checker, these two should be equivalent:</p>
<div class="codehilite"><pre><span></span><code>Node(a) : { data: a, children: List(Node(a)) }
</code></pre></div>
<p><div class="codehilite"><pre><span></span><code>Node(a) : { data: a, children: List({}) }
</code></pre></div><br>
</p>
</blockquote>
<p>yeah, re-reading the RFC it seems like this is compatible with it?</p>



<a name="522475065"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20recursion/near/522475065" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20recursion.html#522475065">(Jun 05 2025 at 00:43)</a>:</h4>
<p>from the RFC:</p>
<blockquote>
<p>Types must be equal, not just equivalent.</p>
</blockquote>
<p>I think if the recursion in a structural type is only done through some combination of <code>List</code> and/or <code>Box</code>, then we wouldn't have the problem outlined in the RFC because reproducing that problem requires recursion through tag unions with equivalent types but different layouts</p>



<a name="522475089"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20recursion/near/522475089" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20recursion.html#522475089">(Jun 05 2025 at 00:44)</a>:</h4>
<p>but if a <code>List</code> and a <code>Box</code> are type-compatible, then they also have the same layout</p>



<a name="522475108"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20recursion/near/522475108" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20recursion.html#522475108">(Jun 05 2025 at 00:44)</a>:</h4>
<p>so unless I'm missing something (and again <span class="user-mention" data-user-id="454654">@Ayaz Hafiz</span> would know better than I would!) I <em>think</em> it should work?</p>



<a name="522475115"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20recursion/near/522475115" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20recursion.html#522475115">(Jun 05 2025 at 00:44)</a>:</h4>
<p>but then again I thought the original design would work, so... <span aria-label="joy" class="emoji emoji-1f602" role="img" title="joy">:joy:</span></p>



<a name="522475143"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20recursion/near/522475143" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20recursion.html#522475143">(Jun 05 2025 at 00:44)</a>:</h4>
<p><span class="user-mention silent" data-user-id="281383">Richard Feldman</span> <a href="#narrow/stream/395097-compiler-development/topic/zig.20compiler.20-.20recursion/near/522474016">said</a>:</p>
<blockquote>
<p>so the current planned design, which I'm already thinking should be tweaked slightly, is that only nominal tag unions are a thing</p>
</blockquote>
<p>Would that hurt automatic error tag accumulation? Seems like one of the big roc features many people like</p>



<a name="522475771"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20recursion/near/522475771" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ayaz Hafiz <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20recursion.html#522475771">(Jun 05 2025 at 00:50)</a>:</h4>
<p>No, it doesn't work - it either must be named or the implementation needs to break module isolation when computing the points of recursion</p>



<a name="522476004"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20recursion/near/522476004" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20recursion.html#522476004">(Jun 05 2025 at 00:53)</a>:</h4>
<p>Really, you couldn't just blackbox all list element types when doing recursion checking. Like literally treat all <code>List(a)</code> types as <code>List({})</code>. Cause from a recursion standpoint they are the same.</p>



<a name="522476027"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20recursion/near/522476027" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20recursion.html#522476027">(Jun 05 2025 at 00:54)</a>:</h4>
<p>They are also the same from a layout stand point.</p>



<a name="522476170"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20recursion/near/522476170" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ayaz Hafiz <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20recursion.html#522476170">(Jun 05 2025 at 00:56)</a>:</h4>
<p>thats not the problem though</p>



<a name="522476280"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20recursion/near/522476280" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ayaz Hafiz <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20recursion.html#522476280">(Jun 05 2025 at 00:57)</a>:</h4>
<p>like you might have a larger type where there is an equivalent version where the recursion does not happen at <code>List a</code> (<code>a</code> being the anonymous type)</p>



<a name="522476300"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20recursion/near/522476300" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ayaz Hafiz <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20recursion.html#522476300">(Jun 05 2025 at 00:57)</a>:</h4>
<p>then you are back to the same problem</p>



<a name="522476440"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20recursion/near/522476440" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20recursion.html#522476440">(Jun 05 2025 at 00:58)</a>:</h4>
<p>I don't follow. If we are only allowing recusion through nominal tags or <code>List(a)</code>, where does this other recursion get introduced in the larger type?</p>



<a name="522476753"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20recursion/near/522476753" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ayaz Hafiz <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20recursion.html#522476753">(Jun 05 2025 at 01:01)</a>:</h4>
<p>refer to this example in the document</p>
<div class="codehilite"><pre><span></span><code>Rec1 : [ From2 { from1 : &lt;Rec1&gt; }, End ]
Rec2 : { from1 : [ From2 &lt;Rec2&gt;, End ] }
</code></pre></div>
<p>now imagine this was</p>
<div class="codehilite"><pre><span></span><code>Rec1 : [ From2 { from1 : List(&lt;Rec1&gt;) }, End ]
Rec2 : List({ from1 : [ From2 &lt;Rec2&gt;, End ] })
</code></pre></div>



<a name="522477095"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20recursion/near/522477095" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ayaz Hafiz <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20recursion.html#522477095">(Jun 05 2025 at 01:04)</a>:</h4>
<p>actually, that example you could maybe make work with a special case. but there are larger types where it doesn't.</p>



<a name="522477104"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20recursion/near/522477104" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20recursion.html#522477104">(Jun 05 2025 at 01:05)</a>:</h4>
<p>Should be this?</p>
<div class="codehilite"><pre><span></span><code>Rec1 : [ From2 { from1 : List(&lt;Rec1&gt;) }, End ]
Rec2 : { from1 : List([ From2 &lt;Rec2&gt;, End ]) }
</code></pre></div>



<a name="522477372"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20recursion/near/522477372" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ayaz Hafiz <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20recursion.html#522477372">(Jun 05 2025 at 01:07)</a>:</h4>
<p>yes</p>



<a name="522478037"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20recursion/near/522478037" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20recursion.html#522478037">(Jun 05 2025 at 01:15)</a>:</h4>
<p>I think this should work.</p>
<p>If only recursion through <code>List(a)</code>, then the tag is simply a flat <code>tag</code> and <code>payload</code> with no pointers (except those in the list). As such <code>{ from1: List(Rec1) }</code> and <code>Rec2</code> will have the exact same layout.</p>
<p>If recursion happens through any other mechanism, we are still requiring the type to be nominal. As such, you won't be able to compare them anyway.</p>



<a name="522478272"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20recursion/near/522478272" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20recursion.html#522478272">(Jun 05 2025 at 01:17)</a>:</h4>
<p>But maybe I am missing something that would relate to multi-recusion or nested recursion via <code>List(a)</code> and <code>List(b)</code> together.</p>



<a name="522478412"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20recursion/near/522478412" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ayaz Hafiz <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20recursion.html#522478412">(Jun 05 2025 at 01:19)</a>:</h4>
<p>i considered this when i wrote this</p>



<a name="522478446"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20recursion/near/522478446" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ayaz Hafiz <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20recursion.html#522478446">(Jun 05 2025 at 01:19)</a>:</h4>
<p>you can write out a bunch of increasing complicated examples and what they compile to and you will see it fails</p>



<a name="522478529"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20recursion/near/522478529" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ayaz Hafiz <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20recursion.html#522478529">(Jun 05 2025 at 01:20)</a>:</h4>
<p>the only way i have found is the three options listed in the document. I am probably missing something, but it's also not entirely naive, and the List/Box thing doesn't solve it</p>



<a name="522478641"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20recursion/near/522478641" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20recursion.html#522478641">(Jun 05 2025 at 01:21)</a>:</h4>
<p>I trust you, I'm just quite surprised about List based recursion specifically. I totally understand from the recursive tag perspective that this needs one of your 3 solutions.</p>



<a name="522480806"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20recursion/near/522480806" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20recursion.html#522480806">(Jun 05 2025 at 01:44)</a>:</h4>
<p>Actually, wait, as I think about this more, I am more convinced <code>List(a)</code> is fine. The fundamental problem discussed in the RFC is that tags, when generated in different context, can lead to different layouts. Thus, they need one of the suggested solutions. This is not true for <code>List</code>. No matter how a list is generated, it will always have the exact same layout.</p>
<p>So I feel pretty convinced that any structural type that only have recursions via lists should be fine.</p>
<p>For recursion via tags directly, we still need one of the 3 suggested solutions. And if you mix list recursion and direct tag recursion, you must follow tag recursion rules. So that again will use one of the 3 suggested solutions, but I think pure list recursion is a proper special case that is valid with structural types.</p>



<a name="522480975"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20recursion/near/522480975" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20recursion.html#522480975">(Jun 05 2025 at 01:46)</a>:</h4>
<p><code>Box(a)</code> is a bit more complicated than <code>List(a)</code> in terms of rules, but also could be special cased in a similar way. <code>Box(a)</code> though requires both avoiding any sort of direct tag based recursion and being in a tag with a base case (otherwise, it is an infinite type).</p>



<a name="522481138"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20recursion/near/522481138" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20recursion.html#522481138">(Jun 05 2025 at 01:48)</a>:</h4>
<p>I really just want <code>Node a : { val: a, children: List(Node(a)) }</code> to work as a structural type. Otherwise, I think it is bad UX for the language. We have seen a ton of beginners hit this over the years.</p>



<a name="522594431"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20recursion/near/522594431" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ayaz Hafiz <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20recursion.html#522594431">(Jun 05 2025 at 13:38)</a>:</h4>
<p>i don't disagree with that, but the fundamental problem is that</p>
<div class="codehilite"><pre><span></span><code>Rec1 : [ From2 { from1 : List(&lt;Rec1&gt;) }, End ]
Rec2 : { from1 : List([ From2 &lt;Rec2&gt;, End ]) }
</code></pre></div>
<p>still have unequal layouts</p>



<a name="522604935"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20recursion/near/522604935" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20recursion.html#522604935">(Jun 05 2025 at 14:24)</a>:</h4>
<p>Due to starting at different points in the recursion chain, sure, but I don't see the problem with that. If you line up the layouts by wrapping Rec1, they become the exact same layout and are comparable.</p>
<p><code>{ from1: List(Rec1) }</code> is equivalent to <code>Rec2</code></p>
<p>And extracting the first element from the list in a <code>Rec2</code> has the same layout as a <code>Rec1</code>.</p>
<p>Ao once lined up in the recursion chain, they will always have identical layout.</p>
<p>So what is the problem with that?</p>



<a name="522605167"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20recursion/near/522605167" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20recursion.html#522605167">(Jun 05 2025 at 14:25)</a>:</h4>
<p>Even if eventually recursively the same, they are not the same without some sort of wrapping or unwrapping. That seems fine.</p>



<a name="522605378"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20recursion/near/522605378" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20recursion.html#522605378">(Jun 05 2025 at 14:26)</a>:</h4>
<p>To check for the ability to compare, both the starting point and the recursion point have to be the same.</p>



<a name="522606688"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20recursion/near/522606688" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20recursion.html#522606688">(Jun 05 2025 at 14:32)</a>:</h4>
<p>In terms of your rfc, those two type are not equivalent structurally recursive types without either apply some sort of wrapping or unwrapping. Once that is applied, they are guaranteed to have equivalent layouts due to List always having the same layout and tags being sorted alphabetically.</p>



<a name="522608941"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20recursion/near/522608941" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20recursion.html#522608941">(Jun 05 2025 at 14:42)</a>:</h4>
<p>Looking concrete at:</p>
<div class="codehilite"><pre><span></span><code>val1 : { from1 : List(Rec1) }
val1 = ...

val2 : Rec2
val2 = ...

expect val1 == val2
</code></pre></div>
<p>The layout of <code>val1</code> is the same as a list (3 usizes)<br>
The layout of <code>val2</code> is the same as a list (3 usizes)</p>
<p>Both have a wrapper record field that does not affect layout.<br>
Both lists contain a tag with 2 variants (<code>From1</code> and <code>End</code>). Both tags have variant 0 containing a payout of a List (wrapped in a record). Both tags have an empty variant 1.</p>
<p>So when the starting point is aligned, the recursive layout is guaranteed the same when using Lists as the only recursion point.</p>



<a name="522610348"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20recursion/near/522610348" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20recursion.html#522610348">(Jun 05 2025 at 14:49)</a>:</h4>
<p>The important note here is that from the tags perspective, it is not really recursive at all. As such, there are no raw pointers introduced and the tag and payload are always stored inline.</p>



<a name="522854025"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20recursion/near/522854025" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20recursion.html#522854025">(Jun 06 2025 at 22:30)</a>:</h4>
<p>hm, I think this case would be problematic?</p>
<ul>
<li>you get <code>|rec|</code> as an argument - so, it's an open record</li>
<li>based on how you use it, it's inferred that the open record contains a field which refers to the open record (e.g. you get an element out of the list and pass it to the original function that takes <code>rec</code> as an argument)</li>
<li>then you pass that open record to another module, which unifies it with another record in a way that adds more fields which introduce another recursion point</li>
</ul>



<a name="522854046"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20recursion/near/522854046" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20recursion.html#522854046">(Jun 06 2025 at 22:30)</a>:</h4>
<p>in a nominal type that couldn't happen bc they can't grow</p>



<a name="522868849"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20recursion/near/522868849" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20recursion.html#522868849">(Jun 07 2025 at 03:25)</a>:</h4>
<p>Is that an open record specific problem?</p>



<a name="522868873"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20recursion/near/522868873" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20recursion.html#522868873">(Jun 07 2025 at 03:26)</a>:</h4>
<p>Isnt it the same if I make some silly function that gets a value from a list and the passes it into the same function. So infinitely deep lists?</p>



<a name="522868917"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20recursion/near/522868917" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20recursion.html#522868917">(Jun 07 2025 at 03:27)</a>:</h4>
<p>Also, multiple recursion points is fine. They just all have to be through list.</p>



<hr><p>Last updated: Nov 01 2025 at 12:13 UTC</p>
</html>