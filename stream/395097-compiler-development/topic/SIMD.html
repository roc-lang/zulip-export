<html>
<head><meta charset="utf-8"><title>SIMD Â· compiler development Â· Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/index.html">compiler development</a></h2>
<h3>Topic: <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/SIMD.html">SIMD</a></h3>

<hr>

<base href="https://roc.zulipchat.com">

<head><link href="https://roc-lang.github.io/zulip-export/style.css" rel="stylesheet"></head>

<a name="421714050"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/SIMD/near/421714050" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/SIMD.html#421714050">(Feb 15 2024 at 18:18)</a>:</h4>
<p>The <code>Great SIMD ergonomics</code> section of <a href="https://www.modular.com/blog/mojo-vs-rust-is-mojo-faster-than-rust">Mojo vs. Rust: is Mojo ðŸ”¥ faster than Rust ðŸ¦€ ?</a> is quite interesting.</p>
<p>This is a very interesting idea</p>
<blockquote>
<p>Mojo's primitives are natively designed to be SIMD-first: <code>UInt8</code> is actually a <code>SIMD[DType.uint8, 1]</code> which is a SIMD of 1 element. There is no performance overhead to represent it this way, but it allows the programmer to easily use it for SIMD optimizations.</p>
</blockquote>



<a name="421731576"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/SIMD/near/421731576" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/SIMD.html#421731576">(Feb 15 2024 at 20:04)</a>:</h4>
<p>unrelated: I really hope they give up on this "Mojo<span aria-label="fire" class="emoji emoji-1f525" role="img" title="fire">:fire:</span>" "Rust<span aria-label="crab" class="emoji emoji-1f980" role="img" title="crab">:crab:</span>" style of writing, it bothers me every time I see it <span aria-label="sweat smile" class="emoji emoji-1f605" role="img" title="sweat smile">:sweat_smile:</span></p>



<a name="421731938"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/SIMD/near/421731938" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/SIMD.html#421731938">(Feb 15 2024 at 20:07)</a>:</h4>
<p><span class="user-mention silent" data-user-id="343810">Brendan Hansknecht</span> <a href="#narrow/stream/395097-compiler-development/topic/Casual.20Conversation/near/421714050">said</a>:</p>
<blockquote>
<p>This is a very interesting idea</p>
<blockquote>
<p>Mojo's primitives are natively designed to be SIMD-first: <code>UInt8</code> is actually a <code>SIMD[DType.uint8, 1]</code> which is a SIMD of 1 element. There is no performance overhead to represent it this way, but it allows the programmer to easily use it for SIMD optimizations.</p>
</blockquote>
</blockquote>
<p>I think I'm missing something here, because there certainly is performance overhead if you put some of these into a struct, because there will be way more alignment padding <span aria-label="thinking" class="emoji emoji-1f914" role="img" title="thinking">:thinking:</span></p>



<a name="421732018"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/SIMD/near/421732018" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/SIMD.html#421732018">(Feb 15 2024 at 20:07)</a>:</h4>
<p>Yeah... No idea<span aria-label="light bulb" class="emoji emoji-1f4a1" role="img" title="light bulb">:light_bulb:</span> why they tripled<span aria-label="three" class="emoji emoji-0033-20e3" role="img" title="three">:three:</span> down<span aria-label="point down" class="emoji emoji-1f447" role="img" title="point down">:point_down:</span> on emojis <span aria-label="stuck out tongue wink" class="emoji emoji-1f61c" role="img" title="stuck out tongue wink">:stuck_out_tongue_wink:</span></p>



<a name="421732272"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/SIMD/near/421732272" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/SIMD.html#421732272">(Feb 15 2024 at 20:09)</a>:</h4>
<p>exclusively <span aria-label="ring" class="emoji emoji-1f48d" role="img" title="ring">:ring:</span> redundant <span aria-label="women with bunny ears" class="emoji emoji-1f46f-200d-2640" role="img" title="women with bunny ears">:women_with_bunny_ears:</span> ones <span aria-label="one" class="emoji emoji-0031-20e3" role="img" title="one">:one:</span><span aria-label="one" class="emoji emoji-0031-20e3" role="img" title="one">:one:</span> too <span aria-label="two" class="emoji emoji-0032-20e3" role="img" title="two">:two:</span></p>



<a name="421732842"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/SIMD/near/421732842" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/SIMD.html#421732842">(Feb 15 2024 at 20:13)</a>:</h4>
<blockquote>
<p>because there will be way more alignment padding</p>
</blockquote>
<p>I think what they are really saying is that they type will implicitly promote to simd if wanted. Not that it is stored in simd alignment.</p>
<p><code>SIMD[DType.uint8, 1]</code> -&gt; size 1 byte, alignment 1 byte. Since it is a simd type though, it can be used with other simd types.<br>
So you can do <code>8 * SIMD[DType.uint8, 8](2, 4, 6, 8, 16, 32, 64, 128)</code>.</p>



<a name="421732993"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/SIMD/near/421732993" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/SIMD.html#421732993">(Feb 15 2024 at 20:14)</a>:</h4>
<p>I also think that the simd numbers automatically figure out how to map to the widest simd hardware that they match</p>



<a name="421733035"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/SIMD/near/421733035" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/SIMD.html#421733035">(Feb 15 2024 at 20:14)</a>:</h4>
<p>So <code>SIMD[DType.uint8, 1]</code> won't actually use simd hardware if used alone. I think only if used with other simd units.</p>



<a name="421733124"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/SIMD/near/421733124" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/SIMD.html#421733124">(Feb 15 2024 at 20:15)</a>:</h4>
<p>Also, I have seen some kernel code that has helpers that deal with the simd alignment mapping while also dealing with any extra elements that don't align.</p>



<a name="421733253"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/SIMD/near/421733253" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/SIMD.html#421733253">(Feb 15 2024 at 20:16)</a>:</h4>
<p>It can all be automatic/run the same code, cause for most of the function, it can run with <code>SIMD[DType.uint8, 8]</code>, but for the remainder elements, it can automatically switch to running with <code>SIMD[DType.uint8, 1]</code>.</p>



<a name="421733331"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/SIMD/near/421733331" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/SIMD.html#421733331">(Feb 15 2024 at 20:16)</a>:</h4>
<p>So I think it all boils down to smarter duck typing (at least it feels like duck typing). Though technically all the types are known at compile time.</p>



<a name="421733850"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/SIMD/near/421733850" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/SIMD.html#421733850">(Feb 15 2024 at 20:20)</a>:</h4>
<p>ahh gotcha!</p>



<a name="421734445"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/SIMD/near/421734445" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/SIMD.html#421734445">(Feb 15 2024 at 20:24)</a>:</h4>
<p>yeah I've thought about how, for example, if you have a <code>List Foo</code> in Roc, and <code>Foo</code> happens to be 32 bits in size, then we can automatically implement certain <code>List</code> operations in terms of SIMD (e.g. equals or <code>contains</code>, or if we had an <code>indexOf</code>, it could use it too)</p>



<a name="421734607"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/SIMD/near/421734607" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/SIMD.html#421734607">(Feb 15 2024 at 20:25)</a>:</h4>
<blockquote>
<p>equals or contains</p>
</blockquote>
<p>I don't think this is true anymore cause we have custom Eq. That said, it could be an optimization for types that don't have custom eq.</p>



<a name="421734752"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/SIMD/near/421734752" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/SIMD.html#421734752">(Feb 15 2024 at 20:26)</a>:</h4>
<p>oh sure, I mean for if you're just using the default</p>



<a name="421734761"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/SIMD/near/421734761" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/SIMD.html#421734761">(Feb 15 2024 at 20:26)</a>:</h4>
<p>or like if <code>Foo</code> is a type alias</p>



<a name="421735981"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/SIMD/near/421735981" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/SIMD.html#421735981">(Feb 15 2024 at 20:34)</a>:</h4>
<p>Yeah. Definitely sounds like it could be useful. Of course with the minor concerns of avx512 intermixed with other code issues. Though probably we just need to follow whatever glibc memcpy does. It is highly optimized and uses some simd</p>



<a name="421736652"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/SIMD/near/421736652" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Notification Bot <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/SIMD.html#421736652">(Feb 15 2024 at 20:39)</a>:</h4>
<p>17 messages were moved here from <a class="stream-topic" data-stream-id="395097" href="/#narrow/stream/395097-compiler-development/topic/Casual.20Conversation">#compiler development &gt; Casual Conversation</a> by <span class="user-mention silent" data-user-id="281383">Richard Feldman</span>.</p>



<a name="421736698"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/SIMD/near/421736698" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/SIMD.html#421736698">(Feb 15 2024 at 20:39)</a>:</h4>
<p>regarding AVX512, I kinda assume we'll end up on the lowest common denominator of 16B SIMD but maybe not?</p>



<a name="421736885"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/SIMD/near/421736885" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/SIMD.html#421736885">(Feb 15 2024 at 20:40)</a>:</h4>
<p>Many libraries do a dynamic dispatch on the supported simd.</p>



<a name="421736993"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/SIMD/near/421736993" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/SIMD.html#421736993">(Feb 15 2024 at 20:41)</a>:</h4>
<p>Either at first load or at first run, update some pointers based on the simd that is available on the pc..</p>



<a name="421737035"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/SIMD/near/421737035" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/SIMD.html#421737035">(Feb 15 2024 at 20:41)</a>:</h4>
<p>Not actually sure what memcpy does for glibc. They may just use the lowest common denominator.</p>



<a name="421737436"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/SIMD/near/421737436" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/SIMD.html#421737436">(Feb 15 2024 at 20:44)</a>:</h4>
<p><span class="user-mention silent" data-user-id="343810">Brendan Hansknecht</span> <a href="#narrow/stream/395097-compiler-development/topic/SIMD/near/421736993">said</a>:</p>
<blockquote>
<p>Either at first load or at first run, update some pointers based on the simd that is available on the pc..</p>
</blockquote>
<p>right, I just wonder about the costs of this in practice (hopefully minimal, but maybe not?) and the "processor dials back clock speed because avx512 runs hot" concern we talked about in some other thread</p>



<a name="421737515"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/SIMD/near/421737515" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/SIMD.html#421737515">(Feb 15 2024 at 20:45)</a>:</h4>
<p>like 16B SIMD seems like an obvious win compared to doing things 8B (or smaller) at a time, and it's widely supported, but beyond that it's not as obvious that it would consistently be a win</p>



<a name="421737520"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/SIMD/near/421737520" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/SIMD.html#421737520">(Feb 15 2024 at 20:45)</a>:</h4>
<p>maybe so though!</p>



<a name="421751362"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/SIMD/near/421751362" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/SIMD.html#421751362">(Feb 15 2024 at 22:25)</a>:</h4>
<p>true</p>



<a name="421751673"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/SIMD/near/421751673" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/SIMD.html#421751673">(Feb 15 2024 at 22:28)</a>:</h4>
<p>May be a case of 16B is low hanging fruit, 32B is probably good, 64B maybe is a not yet but maybe one day.</p>



<hr><p>Last updated: Nov 01 2025 at 12:13 UTC</p>
</html>