<html>
<head><meta charset="utf-8"><title>zig compiler - parser · compiler development · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/index.html">compiler development</a></h2>
<h3>Topic: <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html">zig compiler - parser</a></h3>

<hr>

<base href="https://roc.zulipchat.com">

<head><link href="https://roc-lang.github.io/zulip-export/style.css" rel="stylesheet"></head>

<a name="500302241"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/500302241" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#500302241">(Feb 18 2025 at 01:49)</a>:</h4>
<p><span class="user-mention silent" data-user-id="453336">Joshua Warner</span> <a href="#narrow/channel/395097-compiler-development/topic/zig.20compiler.20-.20spike/near/500301669">said</a>:</p>
<blockquote>
<p><span class="user-mention silent" data-user-id="461444">Sam Mohr</span> the reason I'd like not to just directly have a header/statements is I want this to be able to directly parse individual expressions both for testing and for repl evaluation</p>
</blockquote>
<p>Okay, then what's the best way to:</p>
<ul>
<li>parse just the headers, finding declared packages (and ideally save the parse position)</li>
<li>parse a header and then a list of statements for canonicalization</li>
</ul>



<a name="500305714"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/500305714" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Notification Bot <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#500305714">(Feb 18 2025 at 02:22)</a>:</h4>
<p><a href="#narrow/channel/395097-compiler-development/topic/zig.20compiler.20-.20parser/near/500302241">A message</a> was moved here from <a class="stream-topic" data-stream-id="395097" href="/#narrow/channel/395097-compiler-development/topic/zig.20compiler.20-.20spike/with/497101907">#compiler development &gt; zig compiler - spike</a> by <span class="user-mention silent" data-user-id="453336">Joshua Warner</span>.</p>



<a name="500305829"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/500305829" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Warner <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#500305829">(Feb 18 2025 at 02:24)</a>:</h4>
<p><span class="user-mention" data-user-id="461444">@Sam Mohr</span>  Why do you need to just parse the header? My intent would be to make parsing fast enough that parsing the whole file is plenty fast.</p>



<a name="500305952"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/500305952" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#500305952">(Feb 18 2025 at 02:25)</a>:</h4>
<p>We'd want to parse just the header of the root <code>main.roc</code> of each app/package/platform to get their dep packages to discover the file trees of each package</p>



<a name="500305977"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/500305977" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#500305977">(Feb 18 2025 at 02:25)</a>:</h4>
<p>But if it's  fast enough to just parse the whole thing, then no need</p>



<a name="500306074"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/500306074" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#500306074">(Feb 18 2025 at 02:26)</a>:</h4>
<p>Also, if we persist said list of imported packages in the <code>CanIR</code>, then we can just pull it from the cache and keep around the <code>CanIR</code> until later</p>



<a name="500306334"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/500306334" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Warner <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#500306334">(Feb 18 2025 at 02:29)</a>:</h4>
<p>Cool. We can explore that optimization in the future. that does add a non-trivial amount of complexity though so I'd like to do the simple thing for now</p>



<a name="500306475"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/500306475" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#500306475">(Feb 18 2025 at 02:30)</a>:</h4>
<p>Yeah, totally agreed</p>



<a name="500311917"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/500311917" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Warner <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#500311917">(Feb 18 2025 at 03:37)</a>:</h4>
<p>Ok, I think this test should get you going:</p>
<div class="codehilite"><pre><span></span><code>test &quot;canonicalize&quot; {
    const source =
        \\app [name] { pf: platform &quot;main.roc&quot; }
        \\
        \\name = &quot;Luke&quot;
    ;

    var parse_ir = parse.parse(std.testing.allocator, source);
    var can_ir = IR.init(std.testing.allocator);
    parse_ir.store.emptyScratch();
    canonicalize(&amp;can_ir, &amp;parse_ir, std.testing.allocator);
}
</code></pre></div>



<a name="500312026"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/500312026" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Warner <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#500312026">(Feb 18 2025 at 03:38)</a>:</h4>
<p>The primary problem with the test you posted is just that module headers are not currently supported... and the particular way error recovery happens right now is looping forever (whoops!), which made that harder than expected to figure out.</p>



<a name="500312068"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/500312068" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Warner <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#500312068">(Feb 18 2025 at 03:39)</a>:</h4>
<p>(whoops left some debug stuff in; now removed)</p>



<a name="500313484"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/500313484" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#500313484">(Feb 18 2025 at 03:56)</a>:</h4>
<p>Okay, this is a good start!</p>



<a name="500316848"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/500316848" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Warner <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#500316848">(Feb 18 2025 at 04:32)</a>:</h4>
<p>If I wanted to start looking at intern'ing for symbols in the tokenizer - is there an existing structure you're expecting that data to go into?</p>



<a name="500317024"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/500317024" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#500317024">(Feb 18 2025 at 04:34)</a>:</h4>
<p>The interners in the <code>ModuleEnv</code> <a href="https://github.com/roc-lang/roc/blob/26f9416929aa0cd52ca732fc533b4a94a690de04/src/base/ModuleEnv.zig#L22">https://github.com/roc-lang/roc/blob/26f9416929aa0cd52ca732fc533b4a94a690de04/src/base/ModuleEnv.zig#L22</a></p>



<a name="500317205"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/500317205" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#500317205">(Feb 18 2025 at 04:36)</a>:</h4>
<p>Ideally, we'd put text in the "right" bucket:</p>
<ul>
<li>idents in <code>Ident.Store</code></li>
<li>tag names and type names (e.g. the <code>List</code> of <code>List a</code>) in <code>TagName.Store</code></li>
<li>field names in <code>FieldName.Store</code></li>
<li>string literals in <code>StringLiteral.Store</code></li>
</ul>



<a name="500317249"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/500317249" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#500317249">(Feb 18 2025 at 04:37)</a>:</h4>
<p>But if that turns out to be difficult/not possible to do consistently during tokenization, then maybe we reduce down to just <code>Ident.Store</code></p>



<a name="500317386"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/500317386" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Warner <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#500317386">(Feb 18 2025 at 04:39)</a>:</h4>
<p>I can split lower and upper idents, that's about it.</p>



<a name="500317394"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/500317394" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#500317394">(Feb 18 2025 at 04:39)</a>:</h4>
<p>I figured</p>



<a name="500317413"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/500317413" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Warner <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#500317413">(Feb 18 2025 at 04:39)</a>:</h4>
<p>At the layer of hashing, do they need to be in separate buckets?</p>



<a name="500317425"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/500317425" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#500317425">(Feb 18 2025 at 04:39)</a>:</h4>
<p>Not sure what you mean by the layer of hashing</p>



<a name="500317504"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/500317504" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#500317504">(Feb 18 2025 at 04:40)</a>:</h4>
<p>I think we should just make 2 buckets, <code>upper_idents</code> and <code>lower_idents</code></p>



<a name="500317624"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/500317624" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Warner <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#500317624">(Feb 18 2025 at 04:42)</a>:</h4>
<p>I'm thinking we can do something like:</p>
<ul>
<li>Have everything in the same bucket (indexable in the same index space)</li>
<li>Tokenizer just throws everything in there and gets back an id, which it passes to the parser</li>
<li>The parser receives that id, knows more about how it's used, and can wrap that in a safe wrapper type - FieldNameIdx, TagNameIdx, IdentNameIdx, etc</li>
</ul>



<a name="500317653"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/500317653" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#500317653">(Feb 18 2025 at 04:42)</a>:</h4>
<p>That works!</p>



<a name="500317715"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/500317715" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#500317715">(Feb 18 2025 at 04:43)</a>:</h4>
<p>We'd want those IDs to be <em>pretty much</em> as granular as possible, within reason</p>



<a name="500317757"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/500317757" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Warner <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#500317757">(Feb 18 2025 at 04:43)</a>:</h4>
<p>Can you expand on that? Do you mean for the purpose of types? Or is it beneficial to have the id space be compact?</p>



<a name="500317823"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/500317823" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#500317823">(Feb 18 2025 at 04:44)</a>:</h4>
<p>Which should mean:</p>
<ul>
<li>Ident.Idx</li>
<li>ModuleName.Idx</li>
<li>TagName.Idx</li>
<li>FieldName.Idx</li>
<li>TypeName.Idx</li>
<li>TypeVarName.Idx</li>
</ul>



<a name="500317832"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/500317832" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#500317832">(Feb 18 2025 at 04:44)</a>:</h4>
<p>For the purpose of types</p>



<a name="500317845"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/500317845" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#500317845">(Feb 18 2025 at 04:44)</a>:</h4>
<p>Using a single bucket makes the most sense</p>



<a name="500318384"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/500318384" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#500318384">(Feb 18 2025 at 04:50)</a>:</h4>
<p>I'm not actually sure how much benefit there is for having these distinct types compared to just <code>LowerIdent.Idx</code> and <code>UpperIdent.Idx</code></p>



<a name="500318408"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/500318408" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#500318408">(Feb 18 2025 at 04:50)</a>:</h4>
<p>The <code>TagName</code> and <code>FieldName</code> stuff is an artifact from the <code>specialize_types</code> prototype from <span class="user-mention" data-user-id="489294">@Agus Zubiaga</span></p>



<a name="500318536"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/500318536" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#500318536">(Feb 18 2025 at 04:52)</a>:</h4>
<p>I think we can just start with a single <code>SmallStringInterner</code> that we have <code>UpperIndex.Idx</code> and <code>LowerIdent.Idx</code> both point into</p>



<a name="500555197"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/500555197" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Warner <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#500555197">(Feb 19 2025 at 03:27)</a>:</h4>
<p>In Ident.Store:</p>
<div class="codehilite"><pre><span></span><code>pub fn insert(self: *Store, ident: Ident, region: Region, problems: *std.ArrayList(Problem)) Idx {
</code></pre></div>
<p>... I'm a little worried about the overhead of alloc'ing an ArrayList of Problem for every ident.</p>
<p>I'm also somewhat concerned at doing the interning in the tokenizer based on this Ident type, since these:</p>
<div class="codehilite"><pre><span></span><code>/// Attributes of the identifier such as if it is effectful, ignored, or reassignable.
attributes: Attributes,
</code></pre></div>
<p>... are things we don't really know at this point in compiling and I'm hesitant to create a lie; I think that'll lead to issues down the road.</p>
<p>Furthermore:</p>
<div class="codehilite"><pre><span></span><code>/// Problems with the identifier
/// e.g. if it has two underscores in a row
/// or if it starts with a lowercase then it shouldn&#39;t be `lowerCamelCase`, it must be `snake_case`
problems: Problems,
</code></pre></div>
<p>These are things that IMO should be reported as diagnostics in the tokenizer, and none of the rest of the compiler should really need to track (or care about at all).</p>
<p>I'm thinking instead I'd like to do interning on a lower-level type that _only_ represents the text, giving a simple intern'd string id (u32) and nothing else.</p>
<p>Thoughts <span class="user-mention" data-user-id="461444">@Sam Mohr</span> / <span class="user-mention" data-user-id="515757">@Luke Boswell</span> ?</p>



<a name="500556931"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/500556931" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#500556931">(Feb 19 2025 at 03:47)</a>:</h4>
<p>I assumed the point of passing in problems like that would be to just have one for the whole pass that gets passed around, and each call may or may not push problems onto it</p>



<a name="500556944"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/500556944" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#500556944">(Feb 19 2025 at 03:47)</a>:</h4>
<p>(as opposed to allocating a new one each time)</p>



<a name="500557221"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/500557221" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Warner <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#500557221">(Feb 19 2025 at 03:50)</a>:</h4>
<p>Possibly</p>



<a name="500557315"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/500557315" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Warner <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#500557315">(Feb 19 2025 at 03:51)</a>:</h4>
<p>But given what's currently in <code>Problems</code>, I don't see why the design would warrant that</p>



<a name="500557409"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/500557409" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Warner <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#500557409">(Feb 19 2025 at 03:52)</a>:</h4>
<p>There is no need to dynamically allocate these. and the ones that are there right now probably ought to be just tokenizer diagnostics.</p>



<a name="500557420"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/500557420" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Warner <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#500557420">(Feb 19 2025 at 03:52)</a>:</h4>
<p>So I guess, the question is what might be in there in the future that would justify this?</p>



<a name="500557448"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/500557448" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Warner <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#500557448">(Feb 19 2025 at 03:53)</a>:</h4>
<p>I expect there was some discussion about this that I just was not part of and want to make sure I'm not missing anything</p>



<a name="500559362"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/500559362" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#500559362">(Feb 19 2025 at 04:13)</a>:</h4>
<p>I don't think we've really discussed it in any detail. Sam has just been developing these data types and structures as a best effort based on what we know so far, so we have something to start with. We expect them to evolve a lot as we go.</p>



<a name="500559771"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/500559771" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#500559771">(Feb 19 2025 at 04:18)</a>:</h4>
<p><span class="user-mention silent" data-user-id="281383">Richard Feldman</span> <a href="#narrow/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser/near/500556931">said</a>:</p>
<blockquote>
<p>I assumed the point of passing in problems like that would be to just have one for the whole pass that gets passed around, and each call may or may not push problems onto it</p>
</blockquote>
<p>This</p>



<a name="500559818"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/500559818" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#500559818">(Feb 19 2025 at 04:19)</a>:</h4>
<p>The reason I put the problems as a mutable reference was so that you knew as a caller that your problems on the Ident would be reported on interning</p>



<a name="500559828"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/500559828" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#500559828">(Feb 19 2025 at 04:19)</a>:</h4>
<p>It prevents someone from forgetting to intern the problems</p>



<a name="500559901"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/500559901" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#500559901">(Feb 19 2025 at 04:20)</a>:</h4>
<p>We could alternatively pass the problem reference to the Ident.Store, but that gets us closer to pointer jungle</p>



<a name="500559917"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/500559917" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#500559917">(Feb 19 2025 at 04:20)</a>:</h4>
<p>So this seems less tangled from bird's eye view</p>



<a name="500560128"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/500560128" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#500560128">(Feb 19 2025 at 04:22)</a>:</h4>
<p>Minor note, this may be the wanted type for storing problems: <a href="https://ziglang.org/documentation/master/std/#std.BoundedArray">https://ziglang.org/documentation/master/std/#std.BoundedArray</a></p>



<a name="500560150"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/500560150" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#500560150">(Feb 19 2025 at 04:22)</a>:</h4>
<p>Do you think we're just going with UpperString and LowerString for interners, or are we having all the different variants?</p>



<a name="500560178"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/500560178" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#500560178">(Feb 19 2025 at 04:23)</a>:</h4>
<p>as opposed to slices and counts or growing arraylists</p>



<a name="500561784"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/500561784" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Warner <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#500561784">(Feb 19 2025 at 04:42)</a>:</h4>
<p>What's the use case for some later compiler stage knowing that an identifier has a subsequent_underscores problem? That should have already been reported in the tokenizer.</p>



<a name="500561986"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/500561986" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#500561986">(Feb 19 2025 at 04:45)</a>:</h4>
<p>So we can report that to the user as a warning?</p>



<a name="500562090"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/500562090" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#500562090">(Feb 19 2025 at 04:46)</a>:</h4>
<p>I'm not sure why we store a list of problems in the Ident though</p>



<a name="500562102"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/500562102" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#500562102">(Feb 19 2025 at 04:46)</a>:</h4>
<blockquote>
<p>What's the use case for some later compiler stage knowing that an identifier has a subsequent_underscores problem?</p>
</blockquote>
<p>I think the goal is to collect all problems and then dispatch in one place to decide exactly how everything is reported to the end users.</p>



<a name="500562103"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/500562103" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#500562103">(Feb 19 2025 at 04:46)</a>:</h4>
<p>I thought all the Problems would be stored in the ModuleEnv</p>



<a name="500562160"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/500562160" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#500562160">(Feb 19 2025 at 04:47)</a>:</h4>
<p>I'm guessing this field can be removed, because we store all the problems in ModuleEnv</p>
<div class="codehilite" data-code-language="Zig"><pre><span></span><code><span class="c1">/// Problems with the identifier</span>
<span class="c1">/// e.g. if it has two underscores in a row</span>
<span class="c1">/// or if it starts with a lowercase then it shouldn't be `lowerCamelCase`, it must be `snake_case`</span>
<span class="n">problems</span><span class="o">:</span><span class="w"> </span><span class="n">Problems</span><span class="p">,</span>
</code></pre></div>



<a name="500562657"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/500562657" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Warner <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#500562657">(Feb 19 2025 at 04:53)</a>:</h4>
<p>Makes sense</p>



<a name="500562665"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/500562665" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Warner <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#500562665">(Feb 19 2025 at 04:53)</a>:</h4>
<p>How is this intended to work?</p>
<div class="codehilite"><pre><span></span><code>/// Identifier attributes such as if it is effectful, ignored, or reassignable packed into 3-bits.
pub const Attributes = packed struct(u3) {
    effectful: bool,
    ignored: bool,
    reassignable: bool,
};
</code></pre></div>



<a name="500562675"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/500562675" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Warner <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#500562675">(Feb 19 2025 at 04:53)</a>:</h4>
<p>Those are things that will be different for different instantiations of the same identifier</p>



<a name="500562690"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/500562690" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Warner <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#500562690">(Feb 19 2025 at 04:54)</a>:</h4>
<p>e.g. the same name used in as different local variables in two different functions</p>



<a name="500562743"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/500562743" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#500562743">(Feb 19 2025 at 04:54)</a>:</h4>
<p>This is a very good point...</p>



<a name="500562774"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/500562774" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Warner <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#500562774">(Feb 19 2025 at 04:54)</a>:</h4>
<p>Actually</p>



<a name="500562781"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/500562781" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Warner <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#500562781">(Feb 19 2025 at 04:55)</a>:</h4>
<p>I guess reassignable would be the <code>_</code> suffix, effectful would be the <code>!</code> suffix, and ignored would be the <code>_</code> prefix?</p>



<a name="500562798"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/500562798" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Warner <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#500562798">(Feb 19 2025 at 04:55)</a>:</h4>
<p>Maybe that is actually a textual property of the identifier</p>



<a name="500563083"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/500563083" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Warner <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#500563083">(Feb 19 2025 at 04:59)</a>:</h4>
<p>The tokenizer will actually know those already, so we can just pass those in pre-computed</p>



<a name="500563088"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/500563088" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Warner <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#500563088">(Feb 19 2025 at 04:59)</a>:</h4>
<p>Easy enough</p>



<a name="500567333"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/500567333" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#500567333">(Feb 19 2025 at 05:48)</a>:</h4>
<p><span class="user-mention silent" data-user-id="453336">Joshua Warner</span> <a href="#narrow/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser/near/500562798">said</a>:</p>
<blockquote>
<p>Maybe that is actually a textual property of the identifier</p>
</blockquote>
<p>This was the plan yes</p>



<a name="500569825"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/500569825" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Warner <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#500569825">(Feb 19 2025 at 06:13)</a>:</h4>
<p>How do those attributes apply to things like uppercase idents, field names, etc?</p>



<a name="500570203"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/500570203" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#500570203">(Feb 19 2025 at 06:17)</a>:</h4>
<p>They don't, which is part of the reason why they used to be separate</p>



<a name="500570270"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/500570270" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#500570270">(Feb 19 2025 at 06:17)</a>:</h4>
<p>But it seems to be cheap enough to just set the attributes to all false, AKA zero, and leave them in there</p>



<a name="500570670"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/500570670" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#500570670">(Feb 19 2025 at 06:21)</a>:</h4>
<p>However, if those attributes are easier to parse unilaterally, then having them for non idents, e.g. for ignored field names in record builders, they'll just get ignored</p>



<a name="500572694"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/500572694" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Warner <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#500572694">(Feb 19 2025 at 06:39)</a>:</h4>
<p>Ok cool</p>



<a name="500572731"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/500572731" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Warner <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#500572731">(Feb 19 2025 at 06:39)</a>:</h4>
<p>Initial PR for integrating interning in the tokenizer: <a href="https://github.com/roc-lang/roc/pull/7624">https://github.com/roc-lang/roc/pull/7624</a></p>



<a name="500890397"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/500890397" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#500890397">(Feb 20 2025 at 14:20)</a>:</h4>
<p>PR for parsing the new <code>match</code> expression and some more patterns: <a href="https://github.com/roc-lang/roc/pull/7626">https://github.com/roc-lang/roc/pull/7626</a></p>



<a name="500890713"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/500890713" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#500890713">(Feb 20 2025 at 14:21)</a>:</h4>
<p>Make sure to keep an eye on this test, as it is the "everything implemented right now" test:</p>
<div class="codehilite" data-code-language="Zig"><pre><span></span><code><span class="k">test</span><span class="w"> </span><span class="s">"Syntax grab bag"</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">try</span><span class="w"> </span><span class="n">moduleFmtsSame</span><span class="p">(</span>
<span class="w">        </span><span class="sh">\\app [main!] { pf: platform "../basic-cli/platform.roc" }</span>
<span class="w">        </span><span class="sh">\\</span>
<span class="w">        </span><span class="sh">\\import pf.Stdout</span>
<span class="w">        </span><span class="sh">\\</span>
<span class="w">        </span><span class="sh">\\add_one_oneline = |num| if num 2 else 5</span>
<span class="w">        </span><span class="sh">\\</span>
<span class="w">        </span><span class="sh">\\add_one = |num| {</span>
<span class="w">        </span><span class="sh">\\    other = 1</span>
<span class="w">        </span><span class="sh">\\    if num {</span>
<span class="w">        </span><span class="sh">\\        dbg some_func()</span>
<span class="w">        </span><span class="sh">\\        0</span>
<span class="w">        </span><span class="sh">\\    } else {</span>
<span class="w">        </span><span class="sh">\\        other</span>
<span class="w">        </span><span class="sh">\\    }</span>
<span class="w">        </span><span class="sh">\\}</span>
<span class="w">        </span><span class="sh">\\</span>
<span class="w">        </span><span class="sh">\\match_time = |a| {</span>
<span class="w">        </span><span class="sh">\\    match a {</span>
<span class="w">        </span><span class="sh">\\        Blue -&gt; 47,</span>
<span class="w">        </span><span class="sh">\\        Green -&gt; 19,</span>
<span class="w">        </span><span class="sh">\\        Red -&gt; 12,</span>
<span class="w">        </span><span class="sh">\\        lower -&gt; 1,</span>
<span class="w">        </span><span class="sh">\\        [1, 2, 3, .. as rest] -&gt; 123,</span>
<span class="w">        </span><span class="sh">\\        3.14 -&gt; 314,</span>
<span class="w">        </span><span class="sh">\\    }</span>
<span class="w">        </span><span class="sh">\\}</span>
<span class="w">        </span><span class="sh">\\</span>
<span class="w">        </span><span class="sh">\\main! = |_| {</span>
<span class="w">        </span><span class="sh">\\    world = "World"</span>
<span class="w">        </span><span class="sh">\\    number = 123</span>
<span class="w">        </span><span class="sh">\\    tag = Blue</span>
<span class="w">        </span><span class="sh">\\    tag_with_payload = Ok(number)</span>
<span class="w">        </span><span class="sh">\\    interpolated = "Hello, ${world}"</span>
<span class="w">        </span><span class="sh">\\    list = [add_one(number), 456, 789]</span>
<span class="w">        </span><span class="sh">\\    Stdout.line!(interpolated)?</span>
<span class="w">        </span><span class="sh">\\    Stdout.line!("How about ${Num.toStr(number)} as a string?")</span>
<span class="w">        </span><span class="sh">\\}</span>
<span class="w">    </span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>
<p>Let me know if anything looks wrong here.</p>



<a name="500891297"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/500891297" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#500891297">(Feb 20 2025 at 14:23)</a>:</h4>
<p>I'll try to get Tags with payloads and record patterns parsing this afternoon (and probably Tuple patterns)</p>



<a name="500891401"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/500891401" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#500891401">(Feb 20 2025 at 14:24)</a>:</h4>
<p>My plan after that is Type decls and Type annotations</p>



<a name="500891562"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/500891562" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#500891562">(Feb 20 2025 at 14:24)</a>:</h4>
<p>And then the hard stuff - Tuples, Records, and BinOps</p>



<a name="500891757"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/500891757" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#500891757">(Feb 20 2025 at 14:25)</a>:</h4>
<p>If someone needs/wants something done sooner (like other headers), let me know - or feel free to put in a PR yourself and send it to me!</p>



<a name="500892173"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/500892173" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#500892173">(Feb 20 2025 at 14:26)</a>:</h4>
<p>The hold-up with Records is I am going to have to refactor Body/Block to be just another type of expression and not it's own distinct type of Node</p>



<a name="500892705"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/500892705" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#500892705">(Feb 20 2025 at 14:28)</a>:</h4>
<p><span class="user-mention" data-user-id="453336">@Joshua Warner</span> remind me, did we decide to implement a NoSpaceColon token that will be required for (expression) Record Fields?</p>



<a name="500892815"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/500892815" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#500892815">(Feb 20 2025 at 14:28)</a>:</h4>
<p>I think Record Fields in type annotations can be more forgiving</p>



<a name="500893312"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/500893312" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#500893312">(Feb 20 2025 at 14:30)</a>:</h4>
<p>I think the only real alternative would be something more drastic like inline type annotations which has been ruled out in the past by Richard</p>



<a name="500906611"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/500906611" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#500906611">(Feb 20 2025 at 15:26)</a>:</h4>
<p>what if we made <code>match</code> consistent with <code>if</code> and have it just use curly braces instead of a special <code>-&gt;</code> and <code>,</code> thing?</p>



<a name="500906650"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/500906650" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#500906650">(Feb 20 2025 at 15:26)</a>:</h4>
<p>e.g. instead of this:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">match_time</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">|</span><span class="n">a</span><span class="o">|</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">match</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">Blue</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="mi">47</span><span class="p">,</span>
<span class="w">        </span><span class="n">Green</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="mi">19</span><span class="p">,</span>
<span class="w">        </span><span class="n">Red</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="mi">12</span><span class="p">,</span>
<span class="w">        </span><span class="n">lower</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span>
<span class="w">        </span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">rest</span><span class="p">]</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="mi">123</span><span class="p">,</span>
<span class="w">        </span><span class="mf">3.14</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="mi">314</span><span class="p">,</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>



<a name="500906734"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/500906734" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#500906734">(Feb 20 2025 at 15:26)</a>:</h4>
<p>...we do this:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">match_time</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">|</span><span class="n">a</span><span class="o">|</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">match</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">Blue</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="mi">47</span><span class="w"> </span><span class="p">}</span>
<span class="w">        </span><span class="n">Green</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="mi">19</span><span class="w"> </span><span class="p">}</span>
<span class="w">        </span><span class="n">Red</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="mi">12</span><span class="w"> </span><span class="p">}</span>
<span class="w">        </span><span class="n">lower</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">}</span>
<span class="w">        </span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">rest</span><span class="p">]</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="mi">123</span><span class="w"> </span><span class="p">}</span>
<span class="w">        </span><span class="mf">3.14</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="mi">314</span><span class="w"> </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>



<a name="500906869"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/500906869" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#500906869">(Feb 20 2025 at 15:27)</a>:</h4>
<p>seems like it's just as easy to read, it's one less piece of syntax to learn, and if you want a multiline branch you're already all set up with the curly braces</p>



<a name="500908336"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/500908336" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#500908336">(Feb 20 2025 at 15:33)</a>:</h4>
<p>it always annoys me in Rust having to switch back and forth between <code>,</code> and <code>{</code> <span aria-label="stuck out tongue" class="emoji emoji-1f61b" role="img" title="stuck out tongue">:stuck_out_tongue:</span></p>



<a name="500911256"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/500911256" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#500911256">(Feb 20 2025 at 15:45)</a>:</h4>
<p>Hmm... I guess it is just a bit less distinct, but once you have mutiline blocks is common anyway</p>



<a name="500911392"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/500911392" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#500911392">(Feb 20 2025 at 15:46)</a>:</h4>
<p>Also, will lead to more common fake record syntax</p>



<a name="500916684"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/500916684" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Warner <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#500916684">(Feb 20 2025 at 16:08)</a>:</h4>
<p><span class="user-mention" data-user-id="781658">@Anthony Bullard</span> I think we do want NoSpaceColon for now. We can always have the parser accept either token in cases where it’s not ambiguous.</p>



<a name="500926367"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/500926367" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#500926367">(Feb 20 2025 at 16:51)</a>:</h4>
<p><span class="user-mention" data-user-id="781658">@Anthony Bullard</span> how about we try the "no arrows" style above (as in, we just parse a pattern followed by an expression, and the formatter always chooses to put braces around that expression, just like with <code>if</code>) but if someone puts in <code>-&gt;</code> or <code>=&gt;</code> or <code>,</code> we treat them like semicolons (warn, and then the formatter drops them)</p>



<a name="500931332"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/500931332" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Agus Zubiaga <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#500931332">(Feb 20 2025 at 17:14)</a>:</h4>
<p>That’s syntax is great!</p>



<a name="500931372"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/500931372" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Agus Zubiaga <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#500931372">(Feb 20 2025 at 17:14)</a>:</h4>
<p><span class="user-mention silent" data-user-id="281383">Richard Feldman</span> <a href="#narrow/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser/near/500908336">said</a>:</p>
<blockquote>
<p>it always annoys me in Rust having to switch back and forth between <code>,</code> and <code>{</code> <span aria-label="stuck out tongue" class="emoji emoji-1f61b" role="img" title="stuck out tongue">:stuck_out_tongue:</span></p>
</blockquote>
<p>I also hate this</p>



<a name="500931963"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/500931963" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Warner <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#500931963">(Feb 20 2025 at 17:17)</a>:</h4>
<p>Hmm, I'm a little worried about ambiguities without -&gt; or similar</p>



<a name="500932247"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/500932247" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Warner <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#500932247">(Feb 20 2025 at 17:18)</a>:</h4>
<p><code>Blue { foo }</code> could either be <code>Blue -&gt; {foo:foo}</code>, or it could be <code>Blue {foo}</code> (i.e. a tag with a record pattern)... and then we need to keep parsing to find out what the branch body is.</p>



<a name="500932785"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/500932785" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Warner <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#500932785">(Feb 20 2025 at 17:21)</a>:</h4>
<p>Actually no, it's not the first thing. (brain fart)</p>



<a name="500932934"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/500932934" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Warner <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#500932934">(Feb 20 2025 at 17:22)</a>:</h4>
<p>It's ambiguous between <code>{foo}</code> being the body and <code>{foo}</code> being a record pattern with the body to come later.</p>



<a name="500932976"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/500932976" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Warner <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#500932976">(Feb 20 2025 at 17:22)</a>:</h4>
<p>You can keep going with that logic indefinitely</p>



<a name="500933057"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/500933057" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Warner <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#500933057">(Feb 20 2025 at 17:23)</a>:</h4>
<p>Err actually wait nvm ignore me; that'd be <code>Blue{(foo})</code><br>
EDIT, nope: <code>Blue({foo})</code></p>



<a name="500933071"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/500933071" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Warner <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#500933071">(Feb 20 2025 at 17:23)</a>:</h4>
<p><span aria-label="man facepalming" class="emoji emoji-1f926-200d-2642" role="img" title="man facepalming">:man_facepalming:</span></p>



<a name="500934603"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/500934603" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#500934603">(Feb 20 2025 at 17:30)</a>:</h4>
<p>beautifully cursed brackets <code>{(})</code></p>



<a name="500935395"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/500935395" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Isaac Van Doren <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#500935395">(Feb 20 2025 at 17:35)</a>:</h4>
<p>I like that the syntax requires the braces so that you never have to decide if they should be included or not</p>



<a name="500935734"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/500935734" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Agus Zubiaga <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#500935734">(Feb 20 2025 at 17:37)</a>:</h4>
<p>It's a bit inconsistent with lambdas because it's still optional there</p>



<a name="500935788"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/500935788" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Agus Zubiaga <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#500935788">(Feb 20 2025 at 17:37)</a>:</h4>
<p>but I think I prefer it remains optional</p>



<a name="500937586"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/500937586" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#500937586">(Feb 20 2025 at 17:48)</a>:</h4>
<p>To remain optional would just be?</p>
<div class="codehilite" data-code-language="Ruby"><pre><span></span><code><span class="n">match_time</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">|</span><span class="n">a</span><span class="o">|</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">match</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="no">Blue</span><span class="w"> </span><span class="mi">47</span>
<span class="w">        </span><span class="no">Green</span><span class="w"> </span><span class="mi">19</span>
<span class="w">        </span><span class="no">Red</span><span class="w"> </span><span class="mi">12</span>
<span class="w">        </span><span class="n">lower</span><span class="w"> </span><span class="mi">1</span>
<span class="w">        </span><span class="o">[</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="n">as</span><span class="w"> </span><span class="n">rest</span><span class="o">]</span><span class="w"> </span><span class="mi">123</span>
<span class="w">        </span><span class="mi">3</span><span class="o">.</span><span class="mi">14</span><span class="w"> </span><span class="mi">314</span>
<span class="w">    </span><span class="p">}</span>
</code></pre></div>



<a name="500937612"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/500937612" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#500937612">(Feb 20 2025 at 17:48)</a>:</h4>
<p>yeah, that's what I think it should be</p>



<a name="500937631"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/500937631" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#500937631">(Feb 20 2025 at 17:48)</a>:</h4>
<p>but then the formatter adds braces for clarity</p>



<a name="500937668"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/500937668" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#500937668">(Feb 20 2025 at 17:48)</a>:</h4>
<p>it's conceptually simple: you just alternate patterns and expressions, that's it</p>



<a name="500937683"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/500937683" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Agus Zubiaga <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#500937683">(Feb 20 2025 at 17:48)</a>:</h4>
<p>but not in lambdas</p>



<a name="500937713"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/500937713" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Agus Zubiaga <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#500937713">(Feb 20 2025 at 17:49)</a>:</h4>
<p>(the formatter doesn't add braces)</p>



<a name="500937730"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/500937730" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#500937730">(Feb 20 2025 at 17:49)</a>:</h4>
<p>right, just in <code>match</code></p>



<a name="500937776"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/500937776" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#500937776">(Feb 20 2025 at 17:49)</a>:</h4>
<p><code>match { 1 2 1 2 1 2 }</code> would technically be valid <span aria-label="stuck out tongue" class="emoji emoji-1f61b" role="img" title="stuck out tongue">:stuck_out_tongue:</span></p>



<a name="500937806"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/500937806" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#500937806">(Feb 20 2025 at 17:49)</a>:</h4>
<p>at least from a parsing perspective</p>



<a name="500937809"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/500937809" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#500937809">(Feb 20 2025 at 17:49)</a>:</h4>
<p>with <code>1</code>s being patterns and <code>2</code>s being expressions</p>



<a name="500937815"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/500937815" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Agus Zubiaga <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#500937815">(Feb 20 2025 at 17:49)</a>:</h4>
<p>that might be nice too for typing speed</p>



<a name="500937827"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/500937827" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#500937827">(Feb 20 2025 at 17:49)</a>:</h4>
<p>yeah that's the symmetry with <code>if</code></p>



<a name="500937889"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/500937889" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#500937889">(Feb 20 2025 at 17:50)</a>:</h4>
<p>where like <code>if True False else True</code> is valid</p>
<p>edit: was originally <code>if True False True</code> - forgot the <code>else</code>!</p>



<a name="500937911"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/500937911" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#500937911">(Feb 20 2025 at 17:50)</a>:</h4>
<p>but the formatter adds braces for clarity</p>



<a name="500937953"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/500937953" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#500937953">(Feb 20 2025 at 17:50)</a>:</h4>
<p><code>if True False True</code> how is this valid?</p>



<a name="500937958"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/500937958" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#500937958">(Feb 20 2025 at 17:50)</a>:</h4>
<p>so if you want to take the shortcut when typing, you can</p>



<a name="500937971"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/500937971" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#500937971">(Feb 20 2025 at 17:50)</a>:</h4>
<p>No else of else if</p>



<a name="500937991"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/500937991" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#500937991">(Feb 20 2025 at 17:50)</a>:</h4>
<p>oops, fixed!</p>



<a name="500938013"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/500938013" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#500938013">(Feb 20 2025 at 17:50)</a>:</h4>
<p>ah</p>



<a name="500938132"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/500938132" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#500938132">(Feb 20 2025 at 17:51)</a>:</h4>
<p>I kinda hate the lack of grouping in all of this, but I guess the formatter readds it, so maybe ok</p>



<a name="500938155"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/500938155" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#500938155">(Feb 20 2025 at 17:51)</a>:</h4>
<p>in general the theme is "braces are never required, but the formatter may add them"</p>



<a name="500938181"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/500938181" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#500938181">(Feb 20 2025 at 17:51)</a>:</h4>
<p>That said, I'm really not a fan of same line things without grouping</p>



<a name="500938212"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/500938212" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Agus Zubiaga <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#500938212">(Feb 20 2025 at 17:51)</a>:</h4>
<p>we could soft enforce them with a warning</p>



<a name="500938291"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/500938291" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#500938291">(Feb 20 2025 at 17:52)</a>:</h4>
<p>could, but probably unnecessary</p>



<a name="500938301"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/500938301" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#500938301">(Feb 20 2025 at 17:52)</a>:</h4>
<p>Even</p>
<div class="codehilite" data-code-language="Ruby"><pre><span></span><code><span class="k">if</span><span class="w"> </span><span class="no">True</span>
<span class="w">    </span><span class="no">False</span>
</code></pre></div>
<p>and </p>
<div class="codehilite" data-code-language="Ruby"><pre><span></span><code><span class="k">if</span><span class="w"> </span><span class="no">True</span><span class="w"> </span><span class="no">False</span>
</code></pre></div>
<p>Feel like they shouldn't be allowed.</p>



<a name="500938352"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/500938352" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#500938352">(Feb 20 2025 at 17:52)</a>:</h4>
<p>I like the conceptual simplicity though - braces are a special case of expressions</p>



<a name="500938390"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/500938390" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#500938390">(Feb 20 2025 at 17:52)</a>:</h4>
<p>I know</p>



<a name="500938413"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/500938413" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#500938413">(Feb 20 2025 at 17:52)</a>:</h4>
<p>so anywhere you're using them as an expression, you could of course omit them</p>



<a name="500938450"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/500938450" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#500938450">(Feb 20 2025 at 17:53)</a>:</h4>
<p>But feels like conceptional simplicity being traded for allowing messy code</p>



<a name="500938514"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/500938514" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#500938514">(Feb 20 2025 at 17:53)</a>:</h4>
<p>Extra symbols and splitting things up can definitely help with readability</p>



<a name="500938522"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/500938522" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#500938522">(Feb 20 2025 at 17:53)</a>:</h4>
<p>I hear that, but there's all sorts of messy code you can write if you don't use the formatter <span aria-label="laughing" class="emoji emoji-1f606" role="img" title="laughing">:laughing:</span></p>



<a name="500938560"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/500938560" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#500938560">(Feb 20 2025 at 17:53)</a>:</h4>
<p>and I think we could reasonably add a warning if it seems like people are actually doing it in practice</p>



<a name="500938616"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/500938616" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#500938616">(Feb 20 2025 at 17:54)</a>:</h4>
<p>my assumption is that they wouldn't</p>



<a name="500938668"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/500938668" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#500938668">(Feb 20 2025 at 17:54)</a>:</h4>
<p>idk...a lot of people like being terse way too much</p>



<a name="500938690"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/500938690" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#500938690">(Feb 20 2025 at 17:54)</a>:</h4>
<p>but yeah, probably just a limited few</p>



<a name="500938881"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/500938881" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Agus Zubiaga <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#500938881">(Feb 20 2025 at 17:55)</a>:</h4>
<p>I like the idea of allowing a lot of common mistakes to parse/run, but still discourage them with a warning, and have the formatter fix them automatically</p>



<a name="500938942"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/500938942" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Agus Zubiaga <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#500938942">(Feb 20 2025 at 17:56)</a>:</h4>
<p>it's the best of both worlds</p>



<a name="500947538"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/500947538" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#500947538">(Feb 20 2025 at 18:46)</a>:</h4>
<p>As long as the formatter never fails and can format all bad code consistently</p>



<a name="500973906"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/500973906" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#500973906">(Feb 20 2025 at 21:39)</a>:</h4>
<p>So basically I should just remove the need for the arrow, and in the formatter force braces?</p>



<a name="500973935"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/500973935" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#500973935">(Feb 20 2025 at 21:39)</a>:</h4>
<p>And remove the need for commas? <span class="user-mention" data-user-id="281383">@Richard Feldman</span></p>



<a name="500973992"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/500973992" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#500973992">(Feb 20 2025 at 21:39)</a>:</h4>
<p>I personally think we should keep commas between branches</p>



<a name="500974069"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/500974069" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#500974069">(Feb 20 2025 at 21:40)</a>:</h4>
<p>As it is an unbounded list of things</p>



<a name="500974201"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/500974201" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#500974201">(Feb 20 2025 at 21:41)</a>:</h4>
<p>Lists, Tuples, Record Fields, Function Args, Lambda Args, Exposes items, package entries, they all require <code>,</code> between the "items"</p>



<a name="500974400"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/500974400" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#500974400">(Feb 20 2025 at 21:42)</a>:</h4>
<p><span class="user-mention silent" data-user-id="453336">Joshua Warner</span> <a href="#narrow/channel/395097-compiler-development/topic/zig.20compiler.20-.20parser/near/500916684">said</a>:</p>
<blockquote>
<p><span class="user-mention silent" data-user-id="781658">Anthony Bullard</span> I think we do want NoSpaceColon for now. We can always have the parser accept either token in cases where it’s not ambiguous.</p>
</blockquote>
<p>How then are we going to distinguish between a record or a block starting with a type annotation with backtracking?</p>



<a name="500976825"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/500976825" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#500976825">(Feb 20 2025 at 21:59)</a>:</h4>
<p>Should this be spun out into an ideas thread? <a class="message-link" href="/#narrow/channel/395097-compiler-development/topic/zig.20compiler.20-.20parser/near/500906611">#compiler development &gt; zig compiler - parser @ 💬</a> </p>
<p>I feel like we should put together some larger examples. My concern is the strangeness budget with removing the arrows which seem to be pretty universal in other languages. Not saying I couldn't get used to it, but just not sure discussion in the middle of a parser thread really meets our usual standard for these things.</p>



<a name="500977241"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/500977241" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#500977241">(Feb 20 2025 at 22:01)</a>:</h4>
<p>The braces on a single line look a little strange to me <code>{ 4 }</code> ... I like the braces for multiple lines though.</p>



<a name="500977577"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/500977577" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#500977577">(Feb 20 2025 at 22:03)</a>:</h4>
<p><span class="user-mention silent" data-user-id="781658">Anthony Bullard</span> <a href="#narrow/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser/near/500974201">said</a>:</p>
<blockquote>
<p>Lists, Tuples, Record Fields, Function Args, Lambda Args, Exposes items, package entries, they all require <code>,</code> between the "items"</p>
</blockquote>
<p>yeah, but <code>switch</code> statements don't, and when they're all on different lines, it just feels to me like a chore that doesn't add value</p>



<a name="500977746"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/500977746" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#500977746">(Feb 20 2025 at 22:04)</a>:</h4>
<p>this does make me realize the formatter could add missing commas in lists and records though! <span aria-label="smiley" class="emoji emoji-1f603" role="img" title="smiley">:smiley:</span></p>



<a name="500977919"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/500977919" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#500977919">(Feb 20 2025 at 22:05)</a>:</h4>
<p>I'm not sure if these are formative ideas, or decisions from our BDFN</p>



<a name="500978088"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/500978088" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#500978088">(Feb 20 2025 at 22:06)</a>:</h4>
<p>fair point on starting a thread about <code>-&gt;</code> in <code>match</code>, I'll write one up later</p>



<a name="500978216"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/500978216" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#500978216">(Feb 20 2025 at 22:07)</a>:</h4>
<p>mainly I just saw the example code, thought "oh we definitely don't need commas" and then thought I'd mention that idea while I was at it - but it does deserve its own thread</p>



<a name="500978403"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/500978403" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#500978403">(Feb 20 2025 at 22:08)</a>:</h4>
<p>the formatter being able to add missing commas in lists and records (and tuples!) is just an observation about a convenience we could add</p>



<a name="500978454"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/500978454" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#500978454">(Feb 20 2025 at 22:08)</a>:</h4>
<p>not a syntax change, just error recovery</p>



<a name="500979395"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/500979395" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#500979395">(Feb 20 2025 at 22:14)</a>:</h4>
<p>I think we could do the same here</p>



<a name="500979419"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/500979419" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#500979419">(Feb 20 2025 at 22:15)</a>:</h4>
<p>Allow commas, but not require</p>



<a name="500979438"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/500979438" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#500979438">(Feb 20 2025 at 22:15)</a>:</h4>
<p>And the formatter add them</p>



<a name="500979460"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/500979460" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#500979460">(Feb 20 2025 at 22:15)</a>:</h4>
<p>This is what is currently implemented:</p>
<div class="codehilite" data-code-language="Zig"><pre><span></span><code><span class="k">test</span><span class="w"> </span><span class="s">"Syntax grab bag"</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">try</span><span class="w"> </span><span class="n">moduleFmtsSame</span><span class="p">(</span>
<span class="w">        </span><span class="sh">\\app [main!] { pf: platform "../basic-cli/platform.roc" }</span>
<span class="w">        </span><span class="sh">\\</span>
<span class="w">        </span><span class="sh">\\import pf.Stdout</span>
<span class="w">        </span><span class="sh">\\</span>
<span class="w">        </span><span class="sh">\\add_one_oneline = |num| if num 2 else 5</span>
<span class="w">        </span><span class="sh">\\</span>
<span class="w">        </span><span class="sh">\\add_one = |num| {</span>
<span class="w">        </span><span class="sh">\\    other = 1</span>
<span class="w">        </span><span class="sh">\\    if num {</span>
<span class="w">        </span><span class="sh">\\        dbg some_func()</span>
<span class="w">        </span><span class="sh">\\        0</span>
<span class="w">        </span><span class="sh">\\    } else {</span>
<span class="w">        </span><span class="sh">\\        dbg 123</span>
<span class="w">        </span><span class="sh">\\        other</span>
<span class="w">        </span><span class="sh">\\    }</span>
<span class="w">        </span><span class="sh">\\}</span>
<span class="w">        </span><span class="sh">\\</span>
<span class="w">        </span><span class="sh">\\match_time = |a| match a {</span>
<span class="w">        </span><span class="sh">\\    Blue { 47 },</span>
<span class="w">        </span><span class="sh">\\    Green { 19 },</span>
<span class="w">        </span><span class="sh">\\    Red { 12 },</span>
<span class="w">        </span><span class="sh">\\    lower { 1 },</span>
<span class="w">        </span><span class="sh">\\    [1, 2, 3, .. as rest] { 123 },</span>
<span class="w">        </span><span class="sh">\\    3.14 { 314 },</span>
<span class="w">        </span><span class="sh">\\}</span>
<span class="w">        </span><span class="sh">\\</span>
<span class="w">        </span><span class="sh">\\main! = |_| {</span>
<span class="w">        </span><span class="sh">\\    world = "World"</span>
<span class="w">        </span><span class="sh">\\    number = 123</span>
<span class="w">        </span><span class="sh">\\    tag = Blue</span>
<span class="w">        </span><span class="sh">\\    tag_with_payload = Ok(number)</span>
<span class="w">        </span><span class="sh">\\    interpolated = "Hello, ${world}"</span>
<span class="w">        </span><span class="sh">\\    list = [add_one(number), 456, 789]</span>
<span class="w">        </span><span class="sh">\\    Stdout.line!(interpolated)?</span>
<span class="w">        </span><span class="sh">\\    Stdout.line!("How about ${Num.toStr(number)} as a string?")</span>
<span class="w">        </span><span class="sh">\\}</span>
<span class="w">    </span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>



<a name="500979522"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/500979522" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#500979522">(Feb 20 2025 at 22:15)</a>:</h4>
<p>I can't as a human parse the branches without at least the commas</p>



<a name="500979605"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/500979605" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#500979605">(Feb 20 2025 at 22:16)</a>:</h4>
<p><code>switch</code> gets away without them because it has <code>case</code> keyword before each branch</p>



<a name="500979739"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/500979739" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#500979739">(Feb 20 2025 at 22:17)</a>:</h4>
<p>And usually in C-like languages <code>:</code> between the "pattern" and the block (and also many times a near-mandatory <code>break;</code> statements at the end of a case block.)</p>



<a name="500979934"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/500979934" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#500979934">(Feb 20 2025 at 22:18)</a>:</h4>
<p>Sometimes syntax that is unnecessary for machine parsing is very much necessary for human visual parsing</p>



<a name="500980072"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/500980072" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#500980072">(Feb 20 2025 at 22:19)</a>:</h4>
<p>To your point though Richard, I think we at a point where for machine parsing there is no need for commas in ANY collection-like syntactic construct</p>



<a name="500980089"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/500980089" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#500980089">(Feb 20 2025 at 22:19)</a>:</h4>
<p>They are there for the humans :-)</p>



<a name="500982143"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/500982143" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#500982143">(Feb 20 2025 at 22:33)</a>:</h4>
<p><span class="user-mention silent" data-user-id="281383">Richard Feldman</span> <a href="#narrow/channel/395097-compiler-development/topic/zig.20compiler.20-.20parser/near/500906611">said</a>:</p>
<blockquote>
<p>what if we made <code>match</code> consistent with <code>if</code> and have it just use curly braces instead of a special <code>-&gt;</code> and <code>,</code> thing?</p>
</blockquote>
<p>I made a PR for realword to see what this looks like <a href="https://github.com/rtfeldman/roc-realworld/pull/1">https://github.com/rtfeldman/roc-realworld/pull/1</a></p>



<a name="500982205"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/500982205" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#500982205">(Feb 20 2025 at 22:33)</a>:</h4>
<p>It's based on <span class="user-mention" data-user-id="781658">@Anthony Bullard</span>'s current implementation of match above. I'm not sure if the commas are optional but I included them.</p>



<a name="500982296"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/500982296" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#500982296">(Feb 20 2025 at 22:34)</a>:</h4>
<p>I really like with zig how adding the comma lets the formatter know to make it multi-line or not... if we can borrow that feature I think that would be nice.</p>



<a name="500982471"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/500982471" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#500982471">(Feb 20 2025 at 22:35)</a>:</h4>
<p>I think I missed a couple of matches ... I'll add those (done)</p>



<a name="500983735"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/500983735" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#500983735">(Feb 20 2025 at 22:44)</a>:</h4>
<p>From making this PR.. I would say removing <code>-&gt;</code> and just using braces feels good. </p>
<div class="codehilite" data-code-language="Ruby"><pre><span></span><code><span class="n">match</span><span class="w"> </span><span class="n">client</span><span class="o">.</span><span class="n">query!</span><span class="p">(</span><span class="n">cmd</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="no">Ok</span><span class="p">(</span><span class="o">[</span><span class="n">row</span><span class="o">]</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="no">Article</span><span class="o">.</span><span class="n">fromRow</span><span class="p">(</span><span class="n">row</span><span class="p">)</span><span class="o">.</span><span class="p">(</span><span class="no">Ok</span><span class="p">)</span><span class="w"> </span><span class="p">},</span>
<span class="w">    </span><span class="no">Ok</span><span class="p">(</span><span class="o">[]</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="no">Err</span><span class="p">(</span><span class="no">NotFound</span><span class="p">)</span><span class="w"> </span><span class="p">},</span>
<span class="w">    </span><span class="no">Err</span><span class="p">(</span><span class="n">db_err</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="no">Err</span><span class="p">(</span><span class="no">InternalErr</span><span class="p">(</span><span class="n">db_err</span><span class="o">.</span><span class="n">inspect</span><span class="p">()))</span><span class="w"> </span><span class="p">},</span>
<span class="p">}</span>
</code></pre></div>



<a name="500986361"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/500986361" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#500986361">(Feb 20 2025 at 23:03)</a>:</h4>
<p><span class="user-mention silent" data-user-id="781658">Anthony Bullard</span> <a href="#narrow/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser/near/500979438">said</a>:</p>
<blockquote>
<p>And the formatter add them</p>
</blockquote>
<p>we could, I just don't see a benefit <span aria-label="sweat smile" class="emoji emoji-1f605" role="img" title="sweat smile">:sweat_smile:</span></p>



<a name="500986422"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/500986422" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#500986422">(Feb 20 2025 at 23:04)</a>:</h4>
<p>if we're already adding braces on every branch, it's super clear where each one begins and ends</p>



<a name="500986544"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/500986544" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#500986544">(Feb 20 2025 at 23:04)</a>:</h4>
<p>to put it another way, I don't see why <code>},</code> is a better delimiter for every branch than just <code>}</code></p>



<a name="500986656"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/500986656" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#500986656">(Feb 20 2025 at 23:05)</a>:</h4>
<p>That's fair</p>



<a name="500987084"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/500987084" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#500987084">(Feb 20 2025 at 23:08)</a>:</h4>
<p>Pushed a change to make commas optional, and not included in the formatted output</p>



<a name="500987193"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/500987193" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#500987193">(Feb 20 2025 at 23:09)</a>:</h4>
<div class="codehilite"><pre><span></span><code>match_time = |a| match a {
    Blue { 47 }
    Green { 19 }
    Red { 12 }
    lower { 1 }
    [1, 2, 3, .. as rest] { 123 }
    3.14 { 314 }
}
</code></pre></div>



<a name="500988087"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/500988087" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#500988087">(Feb 20 2025 at 23:16)</a>:</h4>
<p>I made <a href="#narrow/channel/304641-ideas/topic/.60match.60.20without.20.60-.3E.60">#ideas &gt; &#96;match&#96; without &#96;-&gt;&#96;</a> to discuss the design question!</p>



<a name="500991375"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/500991375" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#500991375">(Feb 20 2025 at 23:43)</a>:</h4>
<p>Tuple patterns are implemented in my PR, thought I'd get records done also in this little 30 minute stretch - but I hit a weird bug trying to fix an obvious tokenizer bug.</p>
<p><span class="user-mention" data-user-id="453336">@Joshua Warner</span> Currently when we read a <code>(</code>, we have whether we emit a NoSpaceOpenRound or OpenRound token flipped from how it should be.  But when I fixed that, we get an infinite loop.  These are impossible to debug in Zig with print debugging because the output with <code>std.debug.print</code> just never gets flushed.  Could you take a look at that sometime?  Not a blocker or high priority, but should be fixed I think</p>



<a name="500991629"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/500991629" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#500991629">(Feb 20 2025 at 23:45)</a>:</h4>
<p>Here's the currently implemented syntax...focusing on solely match here:</p>
<div class="codehilite" data-code-language="Zig"><pre><span></span><code><span class="k">test</span><span class="w"> </span><span class="s">"Syntax grab bag"</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">try</span><span class="w"> </span><span class="n">statementFmtsSame</span><span class="p">(</span><span class="w"> </span><span class="c1">// This is a made-up function that doesn't actually exist :-)</span>
<span class="w">        </span><span class="sh">\\match_time = |a| match a {</span>
<span class="w">        </span><span class="sh">\\    Blue { 47 }</span>
<span class="w">        </span><span class="sh">\\    Green { 19 }</span>
<span class="w">        </span><span class="sh">\\    Red { 12 }</span>
<span class="w">        </span><span class="sh">\\    lower { 1 }</span>
<span class="w">        </span><span class="sh">\\    [1, 2, 3, .. as rest] { 123 }</span>
<span class="w">        </span><span class="sh">\\    3.14 { 314 }</span>
<span class="w">        </span><span class="sh">\\    (1, 2, 3) { 123 }</span>
<span class="w">        </span><span class="sh">\\}</span>
<span class="w">    </span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>



<a name="501019019"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/501019019" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Warner <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#501019019">(Feb 21 2025 at 04:31)</a>:</h4>
<p><span class="user-mention" data-user-id="781658">@Anthony Bullard</span> I repro'd one infinite loop at least, and doing this works for me:</p>
<div class="codehilite"><pre><span></span><code>diff --git a/src/check/parse/Parser.zig b/src/check/parse/Parser.zig
index 5ba9d25af4..aec25d5179 100644
--- a/src/check/parse/Parser.zig
+++ b/src/check/parse/Parser.zig
@@ -577,7 +577,7 @@ pub fn parseExpr(self: *Parser) IR.NodeStore.ExprIdx {
     if (expr) |e| {
         var expression = e;
         // Check for an apply...
-        if (self.peek() == .OpenRound) {
+        if (self.peek() == .NoSpaceOpenRound) {
             const scratch_top = self.store.scratch_exprs.items.len;
             self.advance();
             while (self.peek() != .CloseRound) {
diff --git a/src/check/parse/tokenize.zig b/src/check/parse/tokenize.zig
index c831a5ef7a..e1e180aab7 100644
--- a/src/check/parse/tokenize.zig
+++ b/src/check/parse/tokenize.zig
@@ -992,7 +992,7 @@ pub const Tokenizer = struct {
                 &#39;(&#39; =&gt; {
                     self.cursor.pos += 1;
                     self.stack.append(.Round) catch exitOnOom();
-                    self.output.pushTokenNormal(if (sp) .NoSpaceOpenRound else .OpenRound, start, 1);
+                    self.output.pushTokenNormal(if (sp) .OpenRound else .NoSpaceOpenRound, start, 1);
                 },
                 &#39;[&#39; =&gt; {
                     self.cursor.pos += 1;
</code></pre></div>



<a name="501019251"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/501019251" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Warner <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#501019251">(Feb 21 2025 at 04:33)</a>:</h4>
<p>The trick I've taken to doing to debug hanging tests is:</p>
<ul>
<li><code>zig build test</code></li>
<li>(wait for it to hang in the test)</li>
<li>hit ctrl+Z</li>
<li><code>pgrep -lf test</code> to find the name of the test binary running: something like <code>5107 /Users/joshw/src/github.com/roc-lang/roc/.zig-cache/o/05e8b24ea2f7133aef9cb6aa47b421e7/test --listen=-</code></li>
<li>From there I can either run that binary myself, attaching lldb to the process, etc.</li>
</ul>
<p>I assume there must be a better way to do this tho. Maybe <span class="user-mention" data-user-id="406911">@Andrew Kelley</span> knows some tricks?</p>



<a name="501084994"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/501084994" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#501084994">(Feb 21 2025 at 11:42)</a>:</h4>
<p>I think you are right about the debugging process.  I guess I need to improve my lldb skills. (Or just set up DAP in my Neovim)</p>



<a name="501085144"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/501085144" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#501085144">(Feb 21 2025 at 11:43)</a>:</h4>
<p>And I'm going to add the above patch to my PR</p>



<a name="501128397"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/501128397" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#501128397">(Feb 21 2025 at 15:20)</a>:</h4>
<p>Current syntax supported in my latest PR:</p>
<div class="codehilite" data-code-language="Zig"><pre><span></span><code><span class="k">test</span><span class="w"> </span><span class="s">"Syntax grab bag"</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">try</span><span class="w"> </span><span class="n">moduleFmtsSame</span><span class="p">(</span>
<span class="w">        </span><span class="sh">\\app [main!] { pf: platform "../basic-cli/platform.roc" }</span>
<span class="w">        </span><span class="sh">\\</span>
<span class="w">        </span><span class="sh">\\import pf.Stdout</span>
<span class="w">        </span><span class="sh">\\</span>
<span class="w">        </span><span class="sh">\\add_one_oneline = |num| if num 2 else 5</span>
<span class="w">        </span><span class="sh">\\</span>
<span class="w">        </span><span class="sh">\\add_one = |num| {</span>
<span class="w">        </span><span class="sh">\\    other = 1</span>
<span class="w">        </span><span class="sh">\\    if num {</span>
<span class="w">        </span><span class="sh">\\        dbg some_func()</span>
<span class="w">        </span><span class="sh">\\        0</span>
<span class="w">        </span><span class="sh">\\    } else {</span>
<span class="w">        </span><span class="sh">\\        dbg 123</span>
<span class="w">        </span><span class="sh">\\        other</span>
<span class="w">        </span><span class="sh">\\    }</span>
<span class="w">        </span><span class="sh">\\}</span>
<span class="w">        </span><span class="sh">\\</span>
<span class="w">        </span><span class="sh">\\match_time = |a| match a {</span>
<span class="w">        </span><span class="sh">\\    Blue | Green | Red -&gt; {</span>
<span class="w">        </span><span class="sh">\\        x = 12</span>
<span class="w">        </span><span class="sh">\\        x</span>
<span class="w">        </span><span class="sh">\\    }</span>
<span class="w">        </span><span class="sh">\\    lower -&gt; 1</span>
<span class="w">        </span><span class="sh">\\    "foo" -&gt; 100</span>
<span class="w">        </span><span class="sh">\\    "foo" | "bar" -&gt; 200</span>
<span class="w">        </span><span class="sh">\\    [1, 2, 3, .. as rest] -&gt; 123</span>
<span class="w">        </span><span class="sh">\\    [1, 2 | 5, 3, .. as rest] -&gt; 123</span>
<span class="w">        </span><span class="sh">\\    3.14 -&gt; 314</span>
<span class="w">        </span><span class="sh">\\    3.14 | 6.28 -&gt; 314</span>
<span class="w">        </span><span class="sh">\\    (1, 2, 3) -&gt; 123</span>
<span class="w">        </span><span class="sh">\\    (1, 2 | 5, 3) -&gt; 123</span>
<span class="w">        </span><span class="sh">\\    {foo: 1, bar: 2} -&gt; 12</span>
<span class="w">        </span><span class="sh">\\    {foo: 1, bar: 2 | 7} -&gt; 12</span>
<span class="w">        </span><span class="sh">\\}</span>
<span class="w">        </span><span class="sh">\\</span>
<span class="w">        </span><span class="sh">\\main! = |_| {</span>
<span class="w">        </span><span class="sh">\\    world = "World"</span>
<span class="w">        </span><span class="sh">\\    number = 123</span>
<span class="w">        </span><span class="sh">\\    tag = Blue</span>
<span class="w">        </span><span class="sh">\\    tag_with_payload = Ok(number)</span>
<span class="w">        </span><span class="sh">\\    interpolated = "Hello, ${world}"</span>
<span class="w">        </span><span class="sh">\\    list = [add_one(number), 456, 789]</span>
<span class="w">        </span><span class="sh">\\    Stdout.line!(interpolated)?</span>
<span class="w">        </span><span class="sh">\\    Stdout.line!("How about ${Num.toStr(number)} as a string?")</span>
<span class="w">        </span><span class="sh">\\}</span>
<span class="w">    </span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>



<a name="501204022"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/501204022" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#501204022">(Feb 21 2025 at 23:40)</a>:</h4>
<p>^ UPDATED THE ABOVE</p>



<a name="501204103"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/501204103" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#501204103">(Feb 21 2025 at 23:40)</a>:</h4>
<p>Only thing left in patterns is Tags with payloads</p>



<a name="501204105"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/501204105" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#501204105">(Feb 21 2025 at 23:40)</a>:</h4>
<p>Can we move to =&gt; for match? Seemed like <span class="user-mention" data-user-id="281383">@Richard Feldman</span> was pushing for that, but I may be mistaken</p>



<a name="501204115"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/501204115" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#501204115">(Feb 21 2025 at 23:40)</a>:</h4>
<p>Oh yeah! Also</p>



<a name="501204155"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/501204155" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#501204155">(Feb 21 2025 at 23:41)</a>:</h4>
<p>....?</p>



<a name="501204156"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/501204156" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#501204156">(Feb 21 2025 at 23:41)</a>:</h4>
<p><code>.. as rest</code> might need to be allowable, but I think we were trying to prefer <code>..rest</code></p>



<a name="501204164"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/501204164" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#501204164">(Feb 21 2025 at 23:41)</a>:</h4>
<p>Oh</p>



<a name="501204176"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/501204176" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#501204176">(Feb 21 2025 at 23:41)</a>:</h4>
<p>Ok, so <code>as</code> is dead?</p>



<a name="501204185"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/501204185" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#501204185">(Feb 21 2025 at 23:41)</a>:</h4>
<p>No, which is a problem...</p>



<a name="501204188"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/501204188" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#501204188">(Feb 21 2025 at 23:41)</a>:</h4>
<p>And are we 100% on fat arrows for match?</p>



<a name="501204193"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/501204193" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#501204193">(Feb 21 2025 at 23:41)</a>:</h4>
<p>No</p>



<a name="501204196"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/501204196" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Warner <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#501204196">(Feb 21 2025 at 23:42)</a>:</h4>
<p>I would prefer landing the current diff and iterating on it later :)</p>



<a name="501204231"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/501204231" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#501204231">(Feb 21 2025 at 23:42)</a>:</h4>
<p>Good idea</p>



<a name="501204238"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/501204238" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#501204238">(Feb 21 2025 at 23:42)</a>:</h4>
<p>Yeah</p>



<a name="501204250"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/501204250" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#501204250">(Feb 21 2025 at 23:42)</a>:</h4>
<p>I've already implemented 5 syntaxes for match <span aria-label="rofl" class="emoji emoji-1f923" role="img" title="rofl">:rofl:</span></p>



<a name="501204269"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/501204269" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#501204269">(Feb 21 2025 at 23:42)</a>:</h4>
<p>I thought I might spend a couple hours today tinkering with the Parse IR and see if I can make it generate an SExpr for a snapshot.</p>



<a name="501204341"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/501204341" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#501204341">(Feb 21 2025 at 23:43)</a>:</h4>
<p>We actually probably don't want to support <code>..&lt;pattern&gt;</code> in record destructs because we already have <code>.. as &lt;ident&gt;</code> and there shouldn't be two ways to do the same thing</p>



<a name="501204571"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/501204571" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#501204571">(Feb 21 2025 at 23:46)</a>:</h4>
<p>Wait <code>..</code> is followed by a pattern?</p>



<a name="501204580"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/501204580" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#501204580">(Feb 21 2025 at 23:46)</a>:</h4>
<p>That doesn't seem right...</p>



<a name="501204598"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/501204598" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#501204598">(Feb 21 2025 at 23:46)</a>:</h4>
<p>Yeah, I agree</p>



<a name="501204603"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/501204603" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#501204603">(Feb 21 2025 at 23:46)</a>:</h4>
<p>I think we should use <code>..&lt;ident&gt;</code> in both lists and records</p>



<a name="501204650"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/501204650" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#501204650">(Feb 21 2025 at 23:46)</a>:</h4>
<p>Well, if we support that in records, then we can do <code>{ foo: 123, ..rest }</code> and also <code>{ foo: 123, .. as rest }</code></p>



<a name="501204677"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/501204677" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#501204677">(Feb 21 2025 at 23:47)</a>:</h4>
<p>Gotta go eat dinner, I'll try to pop back on and take care of that conflict</p>



<a name="501204684"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/501204684" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#501204684">(Feb 21 2025 at 23:47)</a>:</h4>
<p>Maybe we can put a warning on the second</p>



<a name="501204696"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/501204696" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#501204696">(Feb 21 2025 at 23:47)</a>:</h4>
<p>I would rather just remove the second</p>



<a name="501204705"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/501204705" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#501204705">(Feb 21 2025 at 23:47)</a>:</h4>
<p>There is no advantage to it</p>



<a name="501204737"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/501204737" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#501204737">(Feb 21 2025 at 23:47)</a>:</h4>
<p>Agreed, except for the fact that there's now a specific use of <code>as</code> that doesn't work</p>



<a name="501204743"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/501204743" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#501204743">(Feb 21 2025 at 23:48)</a>:</h4>
<p>I actually haven't even implemented Record Pattern rest</p>



<a name="501204785"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/501204785" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#501204785">(Feb 21 2025 at 23:48)</a>:</h4>
<p>Which is?</p>



<a name="501204921"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/501204921" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#501204921">(Feb 21 2025 at 23:48)</a>:</h4>
<p><code>as</code> is usually </p>
<div class="codehilite" data-code-language="Zig"><pre><span></span><code><span class="kr">pub</span><span class="w"> </span><span class="kr">const</span><span class="w"> </span><span class="n">AsPattern</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">pattern</span><span class="o">:</span><span class="w"> </span><span class="n">Pattern</span><span class="p">,</span>
<span class="w">    </span><span class="n">ident</span><span class="o">:</span><span class="w"> </span><span class="n">Ident</span><span class="p">,</span>
<span class="w">    </span><span class="n">region</span><span class="o">:</span><span class="w"> </span><span class="n">Region</span><span class="p">,</span>
<span class="p">};</span>
</code></pre></div>



<a name="501205017"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/501205017" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#501205017">(Feb 21 2025 at 23:48)</a>:</h4>
<p>But it can't be just <code>Pattern</code> anymore</p>



<a name="501205057"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/501205057" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#501205057">(Feb 21 2025 at 23:49)</a>:</h4>
<p>If you can make it work though, go for it</p>



<a name="501208491"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/501208491" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#501208491">(Feb 22 2025 at 00:28)</a>:</h4>
<p>Yeah, I removed this in my PR and made <code>as</code> a part of rest</p>



<a name="501209751"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/501209751" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#501209751">(Feb 22 2025 at 00:44)</a>:</h4>
<p>My PR is rebased and ready for review</p>



<a name="501209771"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/501209771" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#501209771">(Feb 22 2025 at 00:44)</a>:</h4>
<p>Next up for me is Type Annotations and Declarations</p>



<a name="501214241"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/501214241" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#501214241">(Feb 22 2025 at 01:41)</a>:</h4>
<p><span class="user-mention silent" data-user-id="461444">Sam Mohr</span> <a href="#narrow/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser/near/501204105">said</a>:</p>
<blockquote>
<p>Can we move to =&gt; for match? Seemed like <span class="user-mention silent" data-user-id="281383">Richard Feldman</span> was pushing for that, but I may be mistaken</p>
</blockquote>
<p>let's do it for now just to address the parsing ambiguity on <code>Ok(a) if a-&gt;b-&gt;c</code></p>



<a name="501216785"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/501216785" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#501216785">(Feb 22 2025 at 02:14)</a>:</h4>
<p>No parsing ambiguity as I haven't even implemented record access / static dispatch, let alone -&gt; (which we should have a name for)</p>



<a name="501216791"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/501216791" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#501216791">(Feb 22 2025 at 02:14)</a>:</h4>
<p><span aria-label="smile" class="emoji emoji-1f642" role="img" title="smile">:smile:</span></p>



<a name="501216836"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/501216836" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#501216836">(Feb 22 2025 at 02:15)</a>:</h4>
<p>But I can put it with my current change, which actually I tried to sneak into the last PR but was too late</p>



<a name="501216844"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/501216844" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#501216844">(Feb 22 2025 at 02:15)</a>:</h4>
<p>(Tags with payload patterns)</p>



<a name="501216862"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/501216862" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#501216862">(Feb 22 2025 at 02:15)</a>:</h4>
<p><span class="user-mention" data-user-id="781658">@Anthony Bullard</span> you may need to rebase any PR's, we just merged a change that changed a few things across the compiler</p>



<a name="501216910"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/501216910" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#501216910">(Feb 22 2025 at 02:16)</a>:</h4>
<p>I have no outstanding PRs, but thanks I'll rebase now!</p>



<a name="501216917"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/501216917" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#501216917">(Feb 22 2025 at 02:16)</a>:</h4>
<p>Did we land interning?</p>



<a name="501216932"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/501216932" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#501216932">(Feb 22 2025 at 02:16)</a>:</h4>
<p>Yes</p>



<a name="501216942"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/501216942" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#501216942">(Feb 22 2025 at 02:16)</a>:</h4>
<p>Holy hell, 8 commits?</p>



<a name="501216945"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/501216945" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#501216945">(Feb 22 2025 at 02:16)</a>:</h4>
<p>Josh landed a primitive version</p>



<a name="501216950"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/501216950" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#501216950">(Feb 22 2025 at 02:16)</a>:</h4>
<p>Ok, I've rebased....I'm holding on to my seat as I rebase</p>



<a name="501216953"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/501216953" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#501216953">(Feb 22 2025 at 02:16)</a>:</h4>
<p>I'm currently trying to figure out how to get the top-level nodes out of the parse AST</p>
<div class="codehilite" data-code-language="Zig"><pre><span></span><code><span class="k">test</span><span class="w"> </span><span class="s">"example s-expr"</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kr">const</span><span class="w"> </span><span class="n">source</span><span class="w"> </span><span class="o">=</span>
<span class="w">        </span><span class="sh">\\module []</span>
<span class="w">        </span><span class="sh">\\</span>
<span class="w">        </span><span class="sh">\\foo = "bar"</span>
<span class="w">    </span><span class="p">;</span>
<span class="w">    </span><span class="kr">var</span><span class="w"> </span><span class="n">arena</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="p">.</span><span class="n">heap</span><span class="p">.</span><span class="n">ArenaAllocator</span><span class="p">.</span><span class="n">init</span><span class="p">(</span><span class="n">testing</span><span class="p">.</span><span class="n">allocator</span><span class="p">);</span>
<span class="w">    </span><span class="k">defer</span><span class="w"> </span><span class="n">arena</span><span class="p">.</span><span class="n">deinit</span><span class="p">();</span>
<span class="w">    </span><span class="kr">var</span><span class="w"> </span><span class="n">env</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">base</span><span class="p">.</span><span class="n">ModuleEnv</span><span class="p">.</span><span class="n">init</span><span class="p">(</span><span class="o">&amp;</span><span class="n">arena</span><span class="p">);</span>
<span class="w">    </span><span class="kr">var</span><span class="w"> </span><span class="n">parse_ast</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">parse</span><span class="p">(</span><span class="o">&amp;</span><span class="n">env</span><span class="p">,</span><span class="w"> </span><span class="n">testing</span><span class="p">.</span><span class="n">allocator</span><span class="p">,</span><span class="w"> </span><span class="n">source</span><span class="p">);</span>
<span class="w">    </span><span class="k">defer</span><span class="w"> </span><span class="n">parse_ast</span><span class="p">.</span><span class="n">deinit</span><span class="p">();</span>

<span class="w">    </span><span class="kr">var</span><span class="w"> </span><span class="n">iter</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">parse_ast</span><span class="p">.</span><span class="n">store</span><span class="p">.</span><span class="n">nodes</span><span class="p">.</span><span class="n">iterIndices</span><span class="p">();</span>
<span class="w">    </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="n">iter</span><span class="p">.</span><span class="n">next</span><span class="p">())</span><span class="w"> </span><span class="o">|</span><span class="n">node</span><span class="o">|</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">std</span><span class="p">.</span><span class="n">debug</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">"{}"</span><span class="p">,</span><span class="w"> </span><span class="p">.{</span><span class="n">parse_ast</span><span class="p">.</span><span class="n">store</span><span class="p">.</span><span class="n">getStatement</span><span class="p">(</span><span class="n">node</span><span class="p">)});</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>



<a name="501216973"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/501216973" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#501216973">(Feb 22 2025 at 02:17)</a>:</h4>
<p>Use parse_ast.store.getFile(), and then follow on from there</p>



<a name="501217000"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/501217000" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#501217000">(Feb 22 2025 at 02:17)</a>:</h4>
<p>The file will have the header and statements, and if you read the types it should be easy to figure out what store method to use to get children</p>



<a name="501217004"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/501217004" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#501217004">(Feb 22 2025 at 02:18)</a>:</h4>
<p>I can talk later if you need help</p>



<a name="501217063"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/501217063" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#501217063">(Feb 22 2025 at 02:18)</a>:</h4>
<p>Actually, look at fmt.zig</p>



<a name="501217067"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/501217067" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#501217067">(Feb 22 2025 at 02:18)</a>:</h4>
<p>From <code>formatFile</code> on</p>



<a name="501217076"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/501217076" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#501217076">(Feb 22 2025 at 02:18)</a>:</h4>
<p>We need mental institutionalization, not just help</p>



<a name="501217077"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/501217077" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#501217077">(Feb 22 2025 at 02:18)</a>:</h4>
<p>Your code should be similar in how you walk the AST</p>



<a name="501217080"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/501217080" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Warner <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#501217080">(Feb 22 2025 at 02:18)</a>:</h4>
<p>BTW I'm currently reworking string tokenizing to make a little more sense</p>



<a name="501217094"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/501217094" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#501217094">(Feb 22 2025 at 02:18)</a>:</h4>
<p><span class="user-mention silent" data-user-id="461444">Sam Mohr</span> <a href="#narrow/channel/395097-compiler-development/topic/zig.20compiler.20-.20parser/near/501217076">said</a>:</p>
<blockquote>
<p>We need mental institutionalization, not just help</p>
</blockquote>
<p>Some more than others :-)</p>



<a name="501217106"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/501217106" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#501217106">(Feb 22 2025 at 02:19)</a>:</h4>
<p>I have a 4-year-old</p>



<a name="501217126"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/501217126" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#501217126">(Feb 22 2025 at 02:19)</a>:</h4>
<p>*You have a 4-year-old and mental problems</p>



<a name="501217337"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/501217337" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#501217337">(Feb 22 2025 at 02:22)</a>:</h4>
<p><code>thread 12285665 panic: reached unreachable code</code> --- <span aria-label="man facepalming" class="emoji emoji-1f926-200d-2642" role="img" title="man facepalming">:man_facepalming:</span></p>



<a name="501217353"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/501217353" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#501217353">(Feb 22 2025 at 02:23)</a>:</h4>
<p>I shouldn't be allowed to touch these things</p>



<a name="501217358"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/501217358" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#501217358">(Feb 22 2025 at 02:23)</a>:</h4>
<p>Errr</p>



<a name="501217360"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/501217360" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#501217360">(Feb 22 2025 at 02:23)</a>:</h4>
<p>What’s the sourxe</p>



<a name="501217368"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/501217368" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#501217368">(Feb 22 2025 at 02:23)</a>:</h4>
<p>And your code</p>



<a name="501217377"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/501217377" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#501217377">(Feb 22 2025 at 02:23)</a>:</h4>
<p>And the error?</p>



<a name="501217419"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/501217419" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#501217419">(Feb 22 2025 at 02:24)</a>:</h4>
<p><span class="user-mention" data-user-id="515757">@Luke Boswell</span></p>



<a name="501217459"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/501217459" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#501217459">(Feb 22 2025 at 02:24)</a>:</h4>
<p>See your DM's</p>



<a name="501217505"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/501217505" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Agus Zubiaga <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#501217505">(Feb 22 2025 at 02:25)</a>:</h4>
<p>omg I didn’t take a screenshot of it, but Apple Intelligence summarized the notifications in this channel as “Anthony has mental problems; Luke panicked”</p>



<a name="501217592"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/501217592" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#501217592">(Feb 22 2025 at 02:26)</a>:</h4>
<p>Fair</p>



<a name="501217616"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/501217616" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Agus Zubiaga <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#501217616">(Feb 22 2025 at 02:26)</a>:</h4>
<p>That’s one way to make me read Zulip</p>



<a name="501217637"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/501217637" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#501217637">(Feb 22 2025 at 02:27)</a>:</h4>
<p>More crazy talk, got it</p>



<a name="501217796"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/501217796" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#501217796">(Feb 22 2025 at 02:28)</a>:</h4>
<p>I think it’s a fair summary</p>



<a name="501218056"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/501218056" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#501218056">(Feb 22 2025 at 02:32)</a>:</h4>
<p>nobody else here knows it, but Agus went HAM on the recent Zed release, it was really impressive!</p>



<a name="501218077"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/501218077" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#501218077">(Feb 22 2025 at 02:33)</a>:</h4>
<p>Big W for Zed</p>



<a name="501218079"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/501218079" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#501218079">(Feb 22 2025 at 02:33)</a>:</h4>
<p>people who joined after him probably assume he's been at Zed for years based on that <span aria-label="laughing" class="emoji emoji-1f606" role="img" title="laughing">:laughing:</span></p>



<a name="501218097"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/501218097" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#501218097">(Feb 22 2025 at 02:33)</a>:</h4>
<p>We are thankful for your efforts! It's been powering my collab with Luke for the last week or two</p>



<a name="501218121"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/501218121" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#501218121">(Feb 22 2025 at 02:33)</a>:</h4>
<p>Cant say if this has improved productivity...</p>



<a name="501416943"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/501416943" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#501416943">(Feb 23 2025 at 22:40)</a>:</h4>
<div class="codehilite" data-code-language="Zig"><pre><span></span><code><span class="k">test</span><span class="w"> </span><span class="s">"Syntax grab bag"</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">try</span><span class="w"> </span><span class="n">moduleFmtsSame</span><span class="p">(</span>
<span class="w">        </span><span class="sh">\\app [main!] { pf: platform "../basic-cli/platform.roc" }</span>
<span class="w">        </span><span class="sh">\\</span>
<span class="w">        </span><span class="sh">\\import pf.Stdout</span>
<span class="w">        </span><span class="sh">\\</span>
<span class="w">        </span><span class="sh">\\Map a b : List(a), (a -&gt; b) -&gt; List(b)</span>
<span class="w">        </span><span class="sh">\\</span>
<span class="w">        </span><span class="sh">\\Foo : (Bar, Baz)</span>
<span class="w">        </span><span class="sh">\\</span>
<span class="w">        </span><span class="sh">\\Some a : { foo : Ok(a), bar : Something }</span>
<span class="w">        </span><span class="sh">\\</span>
<span class="w">        </span><span class="sh">\\Maybe a : [Some(a), None]</span>
<span class="w">        </span><span class="sh">\\</span>
<span class="w">        </span><span class="sh">\\SomeFunc a : Maybe(a), a -&gt; Maybe(a)</span>
<span class="w">        </span><span class="sh">\\</span>
<span class="w">        </span><span class="sh">\\add_one_oneline = |num| if num 2 else 5</span>
<span class="w">        </span><span class="sh">\\</span>
<span class="w">        </span><span class="sh">\\add_one : (U64 -&gt; U64)</span>
<span class="w">        </span><span class="sh">\\add_one = |num| {</span>
<span class="w">        </span><span class="sh">\\    other = 1</span>
<span class="w">        </span><span class="sh">\\    if num {</span>
<span class="w">        </span><span class="sh">\\        dbg some_func()</span>
<span class="w">        </span><span class="sh">\\        0</span>
<span class="w">        </span><span class="sh">\\    } else {</span>
<span class="w">        </span><span class="sh">\\        dbg 123</span>
<span class="w">        </span><span class="sh">\\        other</span>
<span class="w">        </span><span class="sh">\\    }</span>
<span class="w">        </span><span class="sh">\\}</span>
<span class="w">        </span><span class="sh">\\</span>
<span class="w">        </span><span class="sh">\\match_time = |a| match a {</span>
<span class="w">        </span><span class="sh">\\    Blue | Green | Red -&gt; {</span>
<span class="w">        </span><span class="sh">\\        x = 12</span>
<span class="w">        </span><span class="sh">\\        x</span>
<span class="w">        </span><span class="sh">\\    }</span>
<span class="w">        </span><span class="sh">\\    lower -&gt; 1</span>
<span class="w">        </span><span class="sh">\\    "foo" -&gt; 100</span>
<span class="w">        </span><span class="sh">\\    "foo" | "bar" -&gt; 200</span>
<span class="w">        </span><span class="sh">\\    [1, 2, 3, .. as rest] -&gt; 123</span>
<span class="w">        </span><span class="sh">\\    [1, 2 | 5, 3, .. as rest] -&gt; 123</span>
<span class="w">        </span><span class="sh">\\    3.14 -&gt; 314</span>
<span class="w">        </span><span class="sh">\\    3.14 | 6.28 -&gt; 314</span>
<span class="w">        </span><span class="sh">\\    (1, 2, 3) -&gt; 123</span>
<span class="w">        </span><span class="sh">\\    (1, 2 | 5, 3) -&gt; 123</span>
<span class="w">        </span><span class="sh">\\    { foo: 1, bar: 2, ..rest } -&gt; 12</span>
<span class="w">        </span><span class="sh">\\    { foo: 1, bar: 2 | 7 } -&gt; 12</span>
<span class="w">        </span><span class="sh">\\    Ok(123) -&gt; 123</span>
<span class="w">        </span><span class="sh">\\    Ok(Some(dude)) -&gt; dude</span>
<span class="w">        </span><span class="sh">\\    TwoArgs("hello", Some("world")) -&gt; 1000</span>
<span class="w">        </span><span class="sh">\\}</span>
<span class="w">        </span><span class="sh">\\</span>
<span class="w">        </span><span class="sh">\\main! : List(String) -&gt; Result({}, _)</span>
<span class="w">        </span><span class="sh">\\main! = |_| {</span>
<span class="w">        </span><span class="sh">\\    world = "World"</span>
<span class="w">        </span><span class="sh">\\    number = 123</span>
<span class="w">        </span><span class="sh">\\    tag = Blue</span>
<span class="w">        </span><span class="sh">\\    tag_with_payload = Ok(number)</span>
<span class="w">        </span><span class="sh">\\    interpolated = "Hello, ${world}"</span>
<span class="w">        </span><span class="sh">\\    list = [add_one(number), 456, 789]</span>
<span class="w">        </span><span class="sh">\\    Stdout.line!(interpolated)?</span>
<span class="w">        </span><span class="sh">\\    Stdout.line!("How about ${Num.toStr(number)} as a string?")</span>
<span class="w">        </span><span class="sh">\\}</span>
<span class="w">    </span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>
<p>Syntax supported with my latest parser+formatter PR</p>



<a name="501416992"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/501416992" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#501416992">(Feb 23 2025 at 22:41)</a>:</h4>
<p>Next up:  Record literal expressions</p>



<a name="501417055"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/501417055" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#501417055">(Feb 23 2025 at 22:42)</a>:</h4>
<p>After that: BinOps ( <span aria-label="scared" class="emoji emoji-1f628" role="img" title="scared">:scared:</span> )</p>



<a name="501422456"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/501422456" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#501422456">(Feb 24 2025 at 00:04)</a>:</h4>
<p>for binops, is Pratt Parsing on your radar already?</p>



<a name="501423805"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/501423805" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#501423805">(Feb 24 2025 at 00:22)</a>:</h4>
<p>you've mentioned it</p>



<a name="501423808"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/501423808" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#501423808">(Feb 24 2025 at 00:22)</a>:</h4>
<p>I'll read up on it</p>



<a name="501425246"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/501425246" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#501425246">(Feb 24 2025 at 00:42)</a>:</h4>
<p><a href="https://matklad.github.io/2020/04/13/simple-but-powerful-pratt-parsing.html">https://matklad.github.io/2020/04/13/simple-but-powerful-pratt-parsing.html</a></p>



<a name="501431212"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/501431212" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Andrew Kelley <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#501431212">(Feb 24 2025 at 02:01)</a>:</h4>
<p><span class="user-mention silent" data-user-id="453336">Joshua Warner</span> <a href="#narrow/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser/near/501019251">said</a>:</p>
<blockquote>
<p>The trick I've taken to doing to debug hanging tests is:</p>
<ul>
<li><code>zig build test</code></li>
<li>(wait for it to hang in the test)</li>
<li>hit ctrl+Z</li>
<li><code>pgrep -lf test</code> to find the name of the test binary running: something like <code>5107 /Users/joshw/src/github.com/roc-lang/roc/.zig-cache/o/05e8b24ea2f7133aef9cb6aa47b421e7/test --listen=-</code></li>
<li>From there I can either run that binary myself, attaching lldb to the process, etc.</li>
</ul>
<p>I assume there must be a better way to do this tho. Maybe <span class="user-mention silent" data-user-id="406911">Andrew Kelley</span> knows some tricks?</p>
</blockquote>
<p>That workflow seems reasonable to me. Is there a way you can imagine it being improved with some zig tooling changes?</p>



<a name="501431927"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/501431927" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Warner <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#501431927">(Feb 24 2025 at 02:09)</a>:</h4>
<p>Couple thoughts: (1) It would be convenient if the binary name was stable so I don’t need to do the ctrl+z switcheroo. Or perhaps it could print the full path of the currently running binary. (2) it would be useful for the runner to do something like print the test name that’s running (perhaps after some minimum timeout). (3) it could also be useful to be able to run only a single test via passing the name of that test on the command line (or perhaps the name of the file, if the test is anonymous)</p>



<a name="501449867"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/501449867" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Andrew Kelley <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#501449867">(Feb 24 2025 at 05:36)</a>:</h4>
<p>(1) you can get if you drop down into zig build-exe CLI with <code>-femit-bin=foobar</code><br>
(2) you can get with <code>--verbose</code><br>
(3) is <code>--test-filter</code> with the direct CLI, and you can introduce a -D build option into your build script and set the test filter there</p>
<p>if you combine (1) and (2) you can get what you want I think</p>
<p>one more random tip, always delete the <code>--listen=-</code> arg when running manually, unless you want to speak the Build Runner Protocol</p>



<a name="501449976"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/501449976" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Andrew Kelley <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#501449976">(Feb 24 2025 at 05:37)</a>:</h4>
<p>so to be clear you can use --verbose to get the <code>zig build-exe</code>  or <code>zig test</code> command, then you can copy paste that, delete <code>--listen=-</code> add <code>-femit-bin=foobar</code> and then you have yourself the desired workflow</p>



<a name="501450039"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/501450039" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Andrew Kelley <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#501450039">(Feb 24 2025 at 05:37)</a>:</h4>
<p>as for <code>--test-filter</code> note that the filter is applied very early, so you can use this when doing large refactorings to only test a subset of unit tests even if the rest of your app is not compiling</p>



<a name="501563172"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/501563172" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#501563172">(Feb 24 2025 at 14:48)</a>:</h4>
<p>I'm running into a spot where Zig just doesn't enjoy passing functions.  I <em>want</em> to have this helper:</p>
<div class="codehilite" data-code-language="Zig"><pre><span></span><code><span class="k">fn</span><span class="w"> </span><span class="n">parseCollection</span><span class="p">(</span><span class="n">self</span><span class="o">:</span><span class="w"> </span><span class="o">*</span><span class="n">Parser</span><span class="p">,</span><span class="w"> </span><span class="kr">comptime</span><span class="w"> </span><span class="n">T</span><span class="o">:</span><span class="w"> </span><span class="kt">type</span><span class="p">,</span><span class="w"> </span><span class="n">end_token</span><span class="o">:</span><span class="w"> </span><span class="n">Token</span><span class="p">.</span><span class="n">Tag</span><span class="p">,</span><span class="w"> </span><span class="n">scratch</span><span class="o">:</span><span class="w"> </span><span class="o">*</span><span class="n">std</span><span class="p">.</span><span class="n">ArrayList</span><span class="p">(</span><span class="n">T</span><span class="p">),</span><span class="w"> </span><span class="n">parser</span><span class="o">:</span><span class="w"> </span><span class="k">fn</span><span class="w"> </span><span class="p">(</span><span class="o">*</span><span class="n">Parser</span><span class="p">)</span><span class="w"> </span><span class="n">T</span><span class="p">)</span><span class="w"> </span><span class="n">ExpectError</span><span class="o">!</span><span class="kt">usize</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kr">const</span><span class="w"> </span><span class="n">scratch_top</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">scratch</span><span class="p">.</span><span class="n">items</span><span class="p">.</span><span class="n">len</span><span class="p">;</span>
<span class="w">    </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">peek</span><span class="p">()</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">end_token</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">scratch</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">parser</span><span class="p">(</span><span class="n">self</span><span class="p">))</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="n">exitOnOom</span><span class="p">();</span>
<span class="w">        </span><span class="n">self</span><span class="p">.</span><span class="n">expect</span><span class="p">(.</span><span class="n">Comma</span><span class="p">)</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">break</span><span class="p">;</span>
<span class="w">        </span><span class="p">};</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="n">self</span><span class="p">.</span><span class="n">expect</span><span class="p">(</span><span class="n">end_token</span><span class="p">)</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">ExpectError</span><span class="p">.</span><span class="n">expected_not_found</span><span class="p">;</span>
<span class="w">    </span><span class="p">};</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">scratch_top</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<p>Since that exact kind of code happens at least 19 times in the parser.  But if one of the parsers takes an argument, I understand I need to create a new top-level function that can be called with zero args here (calling the real function with a specific value for it's arg).  But when you have recursion, usually the function is parametric on that argument, so we need to be able to call the correct parser when we recurse.  Like this:</p>
<div class="codehilite" data-code-language="Zig"><pre><span></span><code><span class="kr">const</span><span class="w"> </span><span class="n">parser</span><span class="o">:</span><span class="w"> </span><span class="k">fn</span><span class="w"> </span><span class="p">(</span><span class="o">*</span><span class="n">Parser</span><span class="p">)</span><span class="w"> </span><span class="n">IR</span><span class="p">.</span><span class="n">NodeStore</span><span class="p">.</span><span class="n">PatternIdx</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">alternatives</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="p">.</span><span class="n">alternatives_allowed</span><span class="p">)</span><span class="w"> </span><span class="n">parsePatternWithAlts</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="n">parsePatternNoAlts</span><span class="p">;</span>
</code></pre></div>
<p>But no matter what I do, that gives me the following error:</p>
<div class="codehilite"><pre><span></span><code>check/parse/Parser.zig:449:58: error: value with comptime-only type &#39;fn (*check.parse.Parser) check.parse.IR.NodeStore.PatternIdx&#39; depends on runtime control flow
    const parser: fn (*Parser) IR.NodeStore.PatternIdx = if (alternatives == .alternatives_allowed) parsePatternWithAlts else parsePatternNoAlts;
                                                         ^~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
</code></pre></div>
<p>I guess i don't understand the argument here.  The type of <code>parser</code> is always the same, and can be verified correctly at comptime.  So why is this not allowed?</p>



<a name="501563559"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/501563559" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#501563559">(Feb 24 2025 at 14:49)</a>:</h4>
<p>Now obviously if we went with <a href="#narrow/channel/304641-ideas/topic/.E2.9C.94.20.60or.60.20instead.20of.20.60.7C.60.20in.20.60when.60.20branches">#ideas &gt; ✔ &#96;or&#96; instead of &#96;|&#96; in &#96;when&#96; branches</a>  (or one of the similar proposals) then this problem goes away because there is no longer contention between pattern alternatives and <code>|...|</code> lambda args.</p>



<a name="501564550"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/501564550" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#501564550">(Feb 24 2025 at 14:53)</a>:</h4>
<p>let's just try that</p>



<a name="501564671"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/501564671" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#501564671">(Feb 24 2025 at 14:53)</a>:</h4>
<p>if we don't like <code>or</code> for alternatives in practice, we can always reconsider, but it seems like a reasonable design in its own right</p>



<a name="501565532"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/501565532" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#501565532">(Feb 24 2025 at 14:57)</a>:</h4>
<p>If you are OK with it, I will do it</p>



<a name="501567961"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/501567961" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#501567961">(Feb 24 2025 at 15:05)</a>:</h4>
<p>go for it</p>



<a name="501568180"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/501568180" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#501568180">(Feb 24 2025 at 15:06)</a>:</h4>
<p>worst-case scenario is that we find out we don't like it, which would justify the more involved implementation</p>



<a name="501580605"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/501580605" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Warner <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#501580605">(Feb 24 2025 at 15:55)</a>:</h4>
<p><span class="user-mention" data-user-id="781658">@Anthony Bullard</span> I wonder if instead of a function pointer, you could do a comptime enum for all the collection variants? Or perhaps you can pass in the desired return type as comptime, and you call ::parse() on that?</p>



<a name="501588338"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/501588338" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#501588338">(Feb 24 2025 at 16:20)</a>:</h4>
<p>The issue is that a function is a comptime only type</p>



<a name="501588416"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/501588416" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#501588416">(Feb 24 2025 at 16:21)</a>:</h4>
<p>You want to use a function pointer if the value can change at runtime</p>



<a name="501588523"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/501588523" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#501588523">(Feb 24 2025 at 16:21)</a>:</h4>
<p>Zig does not have first class functions or lambdas or closures</p>



<a name="501588693"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/501588693" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#501588693">(Feb 24 2025 at 16:22)</a>:</h4>
<p>I think the original code just needs <code>*const fn ...</code></p>



<a name="501661702"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/501661702" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Andrew Kelley <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#501661702">(Feb 24 2025 at 22:28)</a>:</h4>
<p>I think you're gonna have a better time if you always pass functions comptime unless you're doing the vtable pattern</p>



<a name="501661719"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/501661719" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Andrew Kelley <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#501661719">(Feb 24 2025 at 22:28)</a>:</h4>
<p>the optimizer will definitely have a better time</p>



<a name="501661934"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/501661934" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Andrew Kelley <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#501661934">(Feb 24 2025 at 22:30)</a>:</h4>
<p>also I recognize this is more of a functional/imperative preference thing, but I reworked a contributor's code that used that parser function pointer pattern in zig's parser to simply not do that, and felt like the result was better. yeah it technically is less DRY</p>



<a name="501662046"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/501662046" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Andrew Kelley <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#501662046">(Feb 24 2025 at 22:30)</a>:</h4>
<p>anyway the comptime suggestion is irrelevant to that though</p>



<a name="501669313"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/501669313" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#501669313">(Feb 24 2025 at 23:08)</a>:</h4>
<p><span class="user-mention silent" data-user-id="343810">Brendan Hansknecht</span> <a href="#narrow/channel/395097-compiler-development/topic/zig.20compiler.20-.20parser/near/501588693">said</a>:</p>
<blockquote>
<p>I think the original code just needs <code>*const fn ...</code></p>
</blockquote>
<p>Interesting .. why did I think that Zig did not support function pointers?  I think moving towards <code>or</code> for pattern alternation will make a lot of things clearer in OUR grammar anyway, open up more places where it can be used, and also make this code a lot easier to understand.</p>



<a name="501670675"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/501670675" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#501670675">(Feb 24 2025 at 23:15)</a>:</h4>
<p>yeah like in my mind both are totally reasonable options as an end user, just with some different tradeoffs, and since we've only tried one but have an implementation reason to try out the other, seems like a fine excuse to try it out and see how we like it in practice</p>



<a name="501789905"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/501789905" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#501789905">(Feb 25 2025 at 12:12)</a>:</h4>
<p><a href="https://github.com/roc-lang/roc/pull/7638">#7638</a> Parsing Records and Tuples</p>



<a name="501790004"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/501790004" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#501790004">(Feb 25 2025 at 12:12)</a>:</h4>
<p>Support syntax:</p>
<div class="codehilite" data-code-language="Zig"><pre><span></span><code><span class="k">test</span><span class="w"> </span><span class="s">"Syntax grab bag"</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">try</span><span class="w"> </span><span class="n">moduleFmtsSame</span><span class="p">(</span>
<span class="w">        </span><span class="sh">\\app [main!] { pf: platform "../basic-cli/platform.roc" }</span>
<span class="w">        </span><span class="sh">\\</span>
<span class="w">        </span><span class="sh">\\import pf.Stdout</span>
<span class="w">        </span><span class="sh">\\</span>
<span class="w">        </span><span class="sh">\\Map a b : List(a), (a -&gt; b) -&gt; List(b)</span>
<span class="w">        </span><span class="sh">\\</span>
<span class="w">        </span><span class="sh">\\Foo : (Bar, Baz)</span>
<span class="w">        </span><span class="sh">\\</span>
<span class="w">        </span><span class="sh">\\Some a : { foo : Ok(a), bar : Something }</span>
<span class="w">        </span><span class="sh">\\</span>
<span class="w">        </span><span class="sh">\\Maybe a : [Some(a), None]</span>
<span class="w">        </span><span class="sh">\\</span>
<span class="w">        </span><span class="sh">\\SomeFunc a : Maybe(a), a -&gt; Maybe(a)</span>
<span class="w">        </span><span class="sh">\\</span>
<span class="w">        </span><span class="sh">\\add_one_oneline = |num| if num 2 else 5</span>
<span class="w">        </span><span class="sh">\\</span>
<span class="w">        </span><span class="sh">\\add_one : (U64 -&gt; U64)</span>
<span class="w">        </span><span class="sh">\\add_one = |num| {</span>
<span class="w">        </span><span class="sh">\\    other = 1</span>
<span class="w">        </span><span class="sh">\\    if num {</span>
<span class="w">        </span><span class="sh">\\        dbg some_func()</span>
<span class="w">        </span><span class="sh">\\        0</span>
<span class="w">        </span><span class="sh">\\    } else {</span>
<span class="w">        </span><span class="sh">\\        dbg 123</span>
<span class="w">        </span><span class="sh">\\        other</span>
<span class="w">        </span><span class="sh">\\    }</span>
<span class="w">        </span><span class="sh">\\}</span>
<span class="w">        </span><span class="sh">\\</span>
<span class="w">        </span><span class="sh">\\match_time = |a| match a {</span>
<span class="w">        </span><span class="sh">\\    Blue | Green | Red -&gt; {</span>
<span class="w">        </span><span class="sh">\\        x = 12</span>
<span class="w">        </span><span class="sh">\\        x</span>
<span class="w">        </span><span class="sh">\\    }</span>
<span class="w">        </span><span class="sh">\\    lower -&gt; 1</span>
<span class="w">        </span><span class="sh">\\    "foo" -&gt; 100</span>
<span class="w">        </span><span class="sh">\\    "foo" | "bar" -&gt; 200</span>
<span class="w">        </span><span class="sh">\\    [1, 2, 3, .. as rest] -&gt; 123</span>
<span class="w">        </span><span class="sh">\\    [1, 2 | 5, 3, .. as rest] -&gt; 123</span>
<span class="w">        </span><span class="sh">\\    3.14 -&gt; 314</span>
<span class="w">        </span><span class="sh">\\    3.14 | 6.28 -&gt; 314</span>
<span class="w">        </span><span class="sh">\\    (1, 2, 3) -&gt; 123</span>
<span class="w">        </span><span class="sh">\\    (1, 2 | 5, 3) -&gt; 123</span>
<span class="w">        </span><span class="sh">\\    { foo: 1, bar: 2, ..rest } -&gt; 12</span>
<span class="w">        </span><span class="sh">\\    { foo: 1, bar: 2 | 7 } -&gt; 12</span>
<span class="w">        </span><span class="sh">\\    Ok(123) -&gt; 123</span>
<span class="w">        </span><span class="sh">\\    Ok(Some(dude)) -&gt; dude</span>
<span class="w">        </span><span class="sh">\\    TwoArgs("hello", Some("world")) -&gt; 1000</span>
<span class="w">        </span><span class="sh">\\}</span>
<span class="w">        </span><span class="sh">\\</span>
<span class="w">        </span><span class="sh">\\main! : List(String) -&gt; Result({}, _)</span>
<span class="w">        </span><span class="sh">\\main! = |_| {</span>
<span class="w">        </span><span class="sh">\\    world = "World"</span>
<span class="w">        </span><span class="sh">\\    number = 123</span>
<span class="w">        </span><span class="sh">\\    tag = Blue</span>
<span class="w">        </span><span class="sh">\\    tag_with_payload = Ok(number)</span>
<span class="w">        </span><span class="sh">\\    interpolated = "Hello, ${world}"</span>
<span class="w">        </span><span class="sh">\\    list = [add_one(number), 456, 789]</span>
<span class="w">        </span><span class="sh">\\    # New!</span>
<span class="w">        </span><span class="sh">\\    record = { foo: 123, bar: "Hello", baz: tag, qux: Ok(world), punned }</span>
<span class="w">        </span><span class="sh">\\    # New!</span>
<span class="w">        </span><span class="sh">\\    tuple = (123, "World", tag, Ok(world), (nested, tuple), [1, 2, 3])</span>
<span class="w">        </span><span class="sh">\\    Stdout.line!(interpolated)?</span>
<span class="w">        </span><span class="sh">\\    Stdout.line!("How about ${Num.toStr(number)} as a string?")</span>
<span class="w">        </span><span class="sh">\\}</span>
<span class="w">    </span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>



<a name="501790373"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/501790373" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#501790373">(Feb 25 2025 at 12:13)</a>:</h4>
<p>Next up: BinOps (via Pratt Parsing)</p>



<a name="501790614"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/501790614" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#501790614">(Feb 25 2025 at 12:14)</a>:</h4>
<p>(Note: I will come back to replace <code>|</code> with <code>or</code>, I want to push the supported syntax forward right now, and I think that BinOps are just critical to getting that done)</p>



<a name="501790832"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/501790832" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#501790832">(Feb 25 2025 at 12:15)</a>:</h4>
<p>After BinOps, I think you should be able to parse some simple programs</p>



<a name="501927468"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/501927468" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Andrew Kelley <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#501927468">(Feb 25 2025 at 23:12)</a>:</h4>
<p>That unit test looks familiar :)</p>



<a name="502052100"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/502052100" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#502052100">(Feb 26 2025 at 13:52)</a>:</h4>
<p>BinOps have landed (in my <a href="https://github.com/roc-lang/roc/pull/7638">PR</a>) - using Pratt Parsing which was <em>soooooo</em> easy (thanks <span class="user-mention" data-user-id="281383">@Richard Feldman</span> ):</p>
<div class="codehilite" data-code-language="Zig"><pre><span></span><code><span class="k">test</span><span class="w"> </span><span class="s">"Syntax grab bag"</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">try</span><span class="w"> </span><span class="n">moduleFmtsSame</span><span class="p">(</span>
<span class="w">        </span><span class="sh">\\app [main!] { pf: platform "../basic-cli/platform.roc" }</span>
<span class="w">        </span><span class="sh">\\</span>
<span class="w">        </span><span class="sh">\\import pf.Stdout</span>
<span class="w">        </span><span class="sh">\\</span>
<span class="w">        </span><span class="sh">\\Map a b : List(a), (a -&gt; b) -&gt; List(b)</span>
<span class="w">        </span><span class="sh">\\</span>
<span class="w">        </span><span class="sh">\\Foo : (Bar, Baz)</span>
<span class="w">        </span><span class="sh">\\</span>
<span class="w">        </span><span class="sh">\\Some a : { foo : Ok(a), bar : Something }</span>
<span class="w">        </span><span class="sh">\\</span>
<span class="w">        </span><span class="sh">\\Maybe a : [Some(a), None]</span>
<span class="w">        </span><span class="sh">\\</span>
<span class="w">        </span><span class="sh">\\SomeFunc a : Maybe(a), a -&gt; Maybe(a)</span>
<span class="w">        </span><span class="sh">\\</span>
<span class="w">        </span><span class="sh">\\add_one_oneline = |num| if num 2 else 5</span>
<span class="w">        </span><span class="sh">\\</span>
<span class="w">        </span><span class="sh">\\add_one : (U64 -&gt; U64)</span>
<span class="w">        </span><span class="sh">\\add_one = |num| {</span>
<span class="w">        </span><span class="sh">\\    other = 1</span>
<span class="w">        </span><span class="sh">\\    if num {</span>
<span class="w">        </span><span class="sh">\\        dbg some_func()</span>
<span class="w">        </span><span class="sh">\\        0</span>
<span class="w">        </span><span class="sh">\\    } else {</span>
<span class="w">        </span><span class="sh">\\        dbg 123</span>
<span class="w">        </span><span class="sh">\\        other</span>
<span class="w">        </span><span class="sh">\\    }</span>
<span class="w">        </span><span class="sh">\\}</span>
<span class="w">        </span><span class="sh">\\</span>
<span class="w">        </span><span class="sh">\\match_time = |a| match a {</span>
<span class="w">        </span><span class="sh">\\    Blue | Green | Red -&gt; {</span>
<span class="w">        </span><span class="sh">\\        x = 12</span>
<span class="w">        </span><span class="sh">\\        x</span>
<span class="w">        </span><span class="sh">\\    }</span>
<span class="w">        </span><span class="sh">\\    lower -&gt; 1</span>
<span class="w">        </span><span class="sh">\\    "foo" -&gt; 100</span>
<span class="w">        </span><span class="sh">\\    "foo" | "bar" -&gt; 200</span>
<span class="w">        </span><span class="sh">\\    [1, 2, 3, .. as rest] -&gt; 123</span>
<span class="w">        </span><span class="sh">\\    [1, 2 | 5, 3, .. as rest] -&gt; 123</span>
<span class="w">        </span><span class="sh">\\    3.14 -&gt; 314</span>
<span class="w">        </span><span class="sh">\\    3.14 | 6.28 -&gt; 314</span>
<span class="w">        </span><span class="sh">\\    (1, 2, 3) -&gt; 123</span>
<span class="w">        </span><span class="sh">\\    (1, 2 | 5, 3) -&gt; 123</span>
<span class="w">        </span><span class="sh">\\    { foo: 1, bar: 2, ..rest } -&gt; 12</span>
<span class="w">        </span><span class="sh">\\    { foo: 1, bar: 2 | 7 } -&gt; 12</span>
<span class="w">        </span><span class="sh">\\    Ok(123) -&gt; 123</span>
<span class="w">        </span><span class="sh">\\    Ok(Some(dude)) -&gt; dude</span>
<span class="w">        </span><span class="sh">\\    TwoArgs("hello", Some("world")) -&gt; 1000</span>
<span class="w">        </span><span class="sh">\\}</span>
<span class="w">        </span><span class="sh">\\</span>
<span class="w">        </span><span class="sh">\\expect blah == 1</span>
<span class="w">        </span><span class="sh">\\</span>
<span class="w">        </span><span class="sh">\\main! : List(String) -&gt; Result({}, _)</span>
<span class="w">        </span><span class="sh">\\main! = |_| {</span>
<span class="w">        </span><span class="sh">\\    world = "World"</span>
<span class="w">        </span><span class="sh">\\    number = 123</span>
<span class="w">        </span><span class="sh">\\    expect blah == 1</span>
<span class="w">        </span><span class="sh">\\    tag = Blue</span>
<span class="w">        </span><span class="sh">\\    return tag</span>
<span class="w">        </span><span class="sh">\\    crash "Unreachable!"</span>
<span class="w">        </span><span class="sh">\\    tag_with_payload = Ok(number)</span>
<span class="w">        </span><span class="sh">\\    interpolated = "Hello, ${world}"</span>
<span class="w">        </span><span class="sh">\\    list = [add_one(number), 456, 789]</span>
<span class="w">        </span><span class="sh">\\    record = { foo: 123, bar: "Hello", baz: tag, qux: Ok(world), punned }</span>
<span class="w">        </span><span class="sh">\\    tuple = (123, "World", tag, Ok(world), (nested, tuple), [1, 2, 3])</span>
<span class="w">        </span><span class="sh">\\    bin_op_result = Err(foo) ?? 12 &gt; 5 * 5 or 13 + 2 &lt; 5 and 10 - 1 &gt;= 16 or 12 &lt;= 3 / 5</span>
<span class="w">        </span><span class="sh">\\    Stdout.line!(interpolated)?</span>
<span class="w">        </span><span class="sh">\\    Stdout.line!("How about ${Num.toStr(number)} as a string?")</span>
<span class="w">        </span><span class="sh">\\}</span>
<span class="w">        </span><span class="sh">\\</span>
<span class="w">        </span><span class="sh">\\expect {</span>
<span class="w">        </span><span class="sh">\\    foo = 1</span>
<span class="w">        </span><span class="sh">\\    blah = 1</span>
<span class="w">        </span><span class="sh">\\    blah == foo</span>
<span class="w">        </span><span class="sh">\\}</span>
<span class="w">    </span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>



<a name="502052834"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/502052834" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#502052834">(Feb 26 2025 at 13:56)</a>:</h4>
<p>This test for the binops may also be helpful for people to correct any precedence or associativity errors I may have made:</p>
<div class="codehilite" data-code-language="Zig"><pre><span></span><code><span class="k">test</span><span class="w"> </span><span class="s">"BinOp omnibus"</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kr">const</span><span class="w"> </span><span class="n">expr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"Err(foo) ?? 12 &gt; 5 * 5 or 13 + 2 &lt; 5 and 10 - 1 &gt;= 16 or 12 &lt;= 3 / 5"</span><span class="p">;</span>
<span class="w">    </span><span class="kr">const</span><span class="w"> </span><span class="n">expr_sloppy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"Err(foo)??12&gt;5*5 or 13+2&lt;5 and 10-1&gt;=16 or 12&lt;=3/5"</span><span class="p">;</span>
<span class="w">    </span><span class="kr">const</span><span class="w"> </span><span class="n">formatted</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"((((Err(foo) ?? 12) &gt; (5 * 5)) or (((13 + 2) &lt; 5) and ((10 - 1) &gt;= 16))) or (12 &lt;= (3 / 5)))"</span><span class="p">;</span>
<span class="w">    </span><span class="k">try</span><span class="w"> </span><span class="n">exprFmtsSame</span><span class="p">(</span><span class="n">expr</span><span class="p">,</span><span class="w"> </span><span class="p">.</span><span class="n">no_debug</span><span class="p">);</span>
<span class="w">    </span><span class="k">try</span><span class="w"> </span><span class="n">exprFmtsTo</span><span class="p">(</span><span class="n">expr_sloppy</span><span class="p">,</span><span class="w"> </span><span class="n">expr</span><span class="p">,</span><span class="w"> </span><span class="p">.</span><span class="n">no_debug</span><span class="p">);</span>
<span class="w">    </span><span class="k">try</span><span class="w"> </span><span class="n">exprFmtsTo</span><span class="p">(</span><span class="n">expr</span><span class="p">,</span><span class="w"> </span><span class="n">formatted</span><span class="p">,</span><span class="w"> </span><span class="p">.</span><span class="n">debug_binop</span><span class="p">);</span>
<span class="w">    </span><span class="k">try</span><span class="w"> </span><span class="n">exprFmtsTo</span><span class="p">(</span><span class="n">expr_sloppy</span><span class="p">,</span><span class="w"> </span><span class="n">formatted</span><span class="p">,</span><span class="w"> </span><span class="p">.</span><span class="n">debug_binop</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>



<a name="502053011"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/502053011" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#502053011">(Feb 26 2025 at 13:57)</a>:</h4>
<p>Not that the <code>()</code>-laden <code>formatted</code> variable is using a debug flag in the formatter to show the boundaries of the individual operations (until we have full SExpr IR support here)</p>



<a name="502107884"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/502107884" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#502107884">(Feb 26 2025 at 17:48)</a>:</h4>
<p>Anthony, I'm gonna have to break your legs</p>



<a name="502107904"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/502107904" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#502107904">(Feb 26 2025 at 17:48)</a>:</h4>
<p>You're going too fast</p>



<a name="502108692"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/502108692" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anton <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#502108692">(Feb 26 2025 at 17:52)</a>:</h4>
<p>Drastic actions :p</p>



<a name="502115334"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/502115334" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#502115334">(Feb 26 2025 at 18:26)</a>:</h4>
<p><span class="user-mention silent" data-user-id="461444">Sam Mohr</span> <a href="#narrow/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser/near/502107904">said</a>:</p>
<blockquote>
<p>You're going too fast</p>
</blockquote>
<p>I’m only doing this an hour (or two) a day!  I’ve felt like I’m moving at a glacial pace, so thanks for the pick-me-up</p>



<a name="502116274"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/502116274" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#502116274">(Feb 26 2025 at 18:31)</a>:</h4>
<p>But don’t feel bad - adding expect, crash, and return statements is causing a lot of problems</p>



<a name="502118212"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/502118212" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#502118212">(Feb 26 2025 at 18:41)</a>:</h4>
<p>If there's problems from requiring return to not have statements after, then feel free to make the canonicalize code handle it</p>



<a name="502118259"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/502118259" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#502118259">(Feb 26 2025 at 18:41)</a>:</h4>
<p>I presume that's not the main issue, though</p>



<a name="502120447"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/502120447" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#502120447">(Feb 26 2025 at 18:52)</a>:</h4>
<p>No I haven’t figured it out, hit it right before work so I’ll find out tonight or in the morning</p>



<a name="502128800"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/502128800" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#502128800">(Feb 26 2025 at 19:35)</a>:</h4>
<p>oh yeah canonicalize should definitely handle that imo <span aria-label="big smile" class="emoji emoji-1f604" role="img" title="big smile">:big_smile:</span></p>



<a name="502167473"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/502167473" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#502167473">(Feb 26 2025 at 23:56)</a>:</h4>
<p>Updated the syntax for my PR above to include expect, crash, and return</p>



<a name="502167511"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/502167511" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#502167511">(Feb 26 2025 at 23:56)</a>:</h4>
<p>I think import exposing and the rest of the headers should be next</p>



<a name="502167547"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/502167547" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#502167547">(Feb 26 2025 at 23:57)</a>:</h4>
<p>And then we need to talk about static dispatch and record access</p>



<a name="502167595"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/502167595" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#502167595">(Feb 26 2025 at 23:57)</a>:</h4>
<p>I want to treat it similar to binop, but not being a binop</p>



<a name="502167690"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/502167690" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#502167690">(Feb 26 2025 at 23:58)</a>:</h4>
<p>It's &lt;expr&gt;&lt;apply args&gt;&lt;try suffix&gt;&lt;dot access&gt;&lt;binop....&gt; in terms of (not real) binding power</p>



<a name="502167708"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/502167708" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#502167708">(Feb 26 2025 at 23:59)</a>:</h4>
<p>Or maybe try suffix goes last...</p>



<a name="502167772"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/502167772" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#502167772">(Feb 26 2025 at 23:59)</a>:</h4>
<p>Do we want to support <code>some_fn(arg1)?.static_dispatch_method()?.next_static_dispatch_method()?.record_field</code>?</p>



<a name="502167914"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/502167914" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#502167914">(Feb 27 2025 at 00:00)</a>:</h4>
<p>That code looks like it should be valid</p>



<a name="502187744"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/502187744" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#502187744">(Feb 27 2025 at 03:11)</a>:</h4>
<p><span class="user-mention silent" data-user-id="343810">Brendan Hansknecht</span> <a href="#narrow/channel/395097-compiler-development/topic/zig.20compiler.20-.20parser/near/502167914">said</a>:</p>
<blockquote>
<p>That code looks like it should be valid</p>
</blockquote>
<p>And it is so....</p>
<div class="codehilite" data-code-language="Zig"><pre><span></span><code><span class="k">test</span><span class="w"> </span><span class="s">"Syntax grab bag"</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">try</span><span class="w"> </span><span class="n">moduleFmtsSame</span><span class="p">(</span>
<span class="w">        </span><span class="sh">\\app [main!] { pf: platform "../basic-cli/platform.roc" }</span>
<span class="w">        </span><span class="sh">\\</span>
<span class="w">        </span><span class="sh">\\import pf.Stdout</span>
<span class="w">        </span><span class="sh">\\</span>
<span class="w">        </span><span class="sh">\\Map a b : List(a), (a -&gt; b) -&gt; List(b)</span>
<span class="w">        </span><span class="sh">\\</span>
<span class="w">        </span><span class="sh">\\Foo : (Bar, Baz)</span>
<span class="w">        </span><span class="sh">\\</span>
<span class="w">        </span><span class="sh">\\Some a : { foo : Ok(a), bar : Something }</span>
<span class="w">        </span><span class="sh">\\</span>
<span class="w">        </span><span class="sh">\\Maybe a : [Some(a), None]</span>
<span class="w">        </span><span class="sh">\\</span>
<span class="w">        </span><span class="sh">\\SomeFunc a : Maybe(a), a -&gt; Maybe(a)</span>
<span class="w">        </span><span class="sh">\\</span>
<span class="w">        </span><span class="sh">\\add_one_oneline = |num| if num 2 else 5</span>
<span class="w">        </span><span class="sh">\\</span>
<span class="w">        </span><span class="sh">\\add_one : (U64 -&gt; U64)</span>
<span class="w">        </span><span class="sh">\\add_one = |num| {</span>
<span class="w">        </span><span class="sh">\\    other = 1</span>
<span class="w">        </span><span class="sh">\\    if num {</span>
<span class="w">        </span><span class="sh">\\        dbg some_func()</span>
<span class="w">        </span><span class="sh">\\        0</span>
<span class="w">        </span><span class="sh">\\    } else {</span>
<span class="w">        </span><span class="sh">\\        dbg 123</span>
<span class="w">        </span><span class="sh">\\        other</span>
<span class="w">        </span><span class="sh">\\    }</span>
<span class="w">        </span><span class="sh">\\}</span>
<span class="w">        </span><span class="sh">\\</span>
<span class="w">        </span><span class="sh">\\match_time = |a| match a {</span>
<span class="w">        </span><span class="sh">\\    Blue | Green | Red -&gt; {</span>
<span class="w">        </span><span class="sh">\\        x = 12</span>
<span class="w">        </span><span class="sh">\\        x</span>
<span class="w">        </span><span class="sh">\\    }</span>
<span class="w">        </span><span class="sh">\\    lower -&gt; 1</span>
<span class="w">        </span><span class="sh">\\    "foo" -&gt; 100</span>
<span class="w">        </span><span class="sh">\\    "foo" | "bar" -&gt; 200</span>
<span class="w">        </span><span class="sh">\\    [1, 2, 3, .. as rest] -&gt; 123</span>
<span class="w">        </span><span class="sh">\\    [1, 2 | 5, 3, .. as rest] -&gt; 123</span>
<span class="w">        </span><span class="sh">\\    3.14 -&gt; 314</span>
<span class="w">        </span><span class="sh">\\    3.14 | 6.28 -&gt; 314</span>
<span class="w">        </span><span class="sh">\\    (1, 2, 3) -&gt; 123</span>
<span class="w">        </span><span class="sh">\\    (1, 2 | 5, 3) -&gt; 123</span>
<span class="w">        </span><span class="sh">\\    { foo: 1, bar: 2, ..rest } -&gt; 12</span>
<span class="w">        </span><span class="sh">\\    { foo: 1, bar: 2 | 7 } -&gt; 12</span>
<span class="w">        </span><span class="sh">\\    Ok(123) -&gt; 123</span>
<span class="w">        </span><span class="sh">\\    Ok(Some(dude)) -&gt; dude</span>
<span class="w">        </span><span class="sh">\\    TwoArgs("hello", Some("world")) -&gt; 1000</span>
<span class="w">        </span><span class="sh">\\}</span>
<span class="w">        </span><span class="sh">\\</span>
<span class="w">        </span><span class="sh">\\expect blah == 1</span>
<span class="w">        </span><span class="sh">\\</span>
<span class="w">        </span><span class="sh">\\main! : List(String) -&gt; Result({}, _)</span>
<span class="w">        </span><span class="sh">\\main! = |_| {</span>
<span class="w">        </span><span class="sh">\\    world = "World"</span>
<span class="w">        </span><span class="sh">\\    number = 123</span>
<span class="w">        </span><span class="sh">\\    expect blah == 1</span>
<span class="w">        </span><span class="sh">\\    tag = Blue</span>
<span class="w">        </span><span class="sh">\\    return tag</span>
<span class="w">        </span><span class="sh">\\    crash "Unreachable!"</span>
<span class="w">        </span><span class="sh">\\    tag_with_payload = Ok(number)</span>
<span class="w">        </span><span class="sh">\\    interpolated = "Hello, ${world}"</span>
<span class="w">        </span><span class="sh">\\    list = [add_one(number), 456, 789]</span>
<span class="w">        </span><span class="sh">\\    record = { foo: 123, bar: "Hello", baz: tag, qux: Ok(world), punned }</span>
<span class="w">        </span><span class="sh">\\    tuple = (123, "World", tag, Ok(world), (nested, tuple), [1, 2, 3])</span>
<span class="w">        </span><span class="sh">\\    bin_op_result = Err(foo) ?? 12 &gt; 5 * 5 or 13 + 2 &lt; 5 and 10 - 1 &gt;= 16 or 12 &lt;= 3 / 5</span>
<span class="w">        </span><span class="sh">\\    # NEW!!!</span>
<span class="w">        </span><span class="sh">\\    static_dispatch_style = some_fn(arg1)?.static_dispatch_method()?.next_static_dispatch_method()?.record_field?</span>
<span class="w">        </span><span class="sh">\\    Stdout.line!(interpolated)?</span>
<span class="w">        </span><span class="sh">\\    Stdout.line!("How about ${Num.toStr(number)} as a string?")</span>
<span class="w">        </span><span class="sh">\\}</span>
<span class="w">        </span><span class="sh">\\</span>
<span class="w">        </span><span class="sh">\\expect {</span>
<span class="w">        </span><span class="sh">\\    foo = 1</span>
<span class="w">        </span><span class="sh">\\    blah = 1</span>
<span class="w">        </span><span class="sh">\\    blah == foo</span>
<span class="w">        </span><span class="sh">\\}</span>
<span class="w">    </span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>



<a name="502188080"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/502188080" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#502188080">(Feb 27 2025 at 03:15)</a>:</h4>
<p>I forgot I have unary ops (easy), and record updaters and record builders.  What are the current status and agreed-upon syntax for them?  The same as in the current alpha?</p>



<a name="502188119"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/502188119" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#502188119">(Feb 27 2025 at 03:15)</a>:</h4>
<p>Yeah I think there's no change to Record Builder</p>



<a name="502188286"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/502188286" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#502188286">(Feb 27 2025 at 03:17)</a>:</h4>
<p>Are we doing something with <code>..</code> for record update?</p>



<a name="502188298"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/502188298" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#502188298">(Feb 27 2025 at 03:17)</a>:</h4>
<p>See <a href="https://github.com/roc-lang/roc/issues/7091">https://github.com/roc-lang/roc/issues/7091</a></p>



<a name="502188371"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/502188371" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#502188371">(Feb 27 2025 at 03:18)</a>:</h4>
<p>Ah...ok, so it's like List rest</p>



<a name="502188377"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/502188377" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#502188377">(Feb 27 2025 at 03:18)</a>:</h4>
<p>Or it's parent Issue <a href="https://github.com/roc-lang/roc/issues/7106">https://github.com/roc-lang/roc/issues/7106</a> "Syntax Changes"</p>



<a name="502188408"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/502188408" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#502188408">(Feb 27 2025 at 03:18)</a>:</h4>
<p>Oooo, the ellipsis keyword!  Almost forgot about that!</p>



<a name="502188436"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/502188436" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#502188436">(Feb 27 2025 at 03:19)</a>:</h4>
<p>Ok, I'll make sure this all gets done</p>



<a name="502188463"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/502188463" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#502188463">(Feb 27 2025 at 03:19)</a>:</h4>
<p>That'll leave me with Custom Types and the replacement syntax for abilities</p>



<a name="502188475"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/502188475" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#502188475">(Feb 27 2025 at 03:19)</a>:</h4>
<p>Do you have the issue handy for that?  Or is there one?</p>



<a name="502188546"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/502188546" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#502188546">(Feb 27 2025 at 03:20)</a>:</h4>
<p><a href="https://github.com/roc-lang/roc/issues/7458">https://github.com/roc-lang/roc/issues/7458</a></p>



<a name="502188554"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/502188554" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#502188554">(Feb 27 2025 at 03:20)</a>:</h4>
<p>I guess I just look at the static dispatch doc...</p>



<a name="502188907"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/502188907" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#502188907">(Feb 27 2025 at 03:24)</a>:</h4>
<p>And this is the doc for Custom Types...</p>
<p><a href="https://docs.google.com/document/d/10OFeNl9KAYAErajE0Wio4AAR66yM2u13bku0mTUawVk/edit?tab=t.0">https://docs.google.com/document/d/10OFeNl9KAYAErajE0Wio4AAR66yM2u13bku0mTUawVk/edit?tab=t.0</a></p>



<a name="502189052"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/502189052" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#502189052">(Feb 27 2025 at 03:26)</a>:</h4>
<p>If there has been any meaningful changes to this proposal (the thread had no concrete takeaways that were scannable), let me know</p>



<a name="502189647"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/502189647" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#502189647">(Feb 27 2025 at 03:32)</a>:</h4>
<p>I'm wondering if we still need the <code>*</code> in <code>module [User.*, SomethingElse, …etc]</code>.  Didn't we discuss somewhere that fields in a Custom Record would always be public.</p>



<a name="502190388"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/502190388" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#502190388">(Feb 27 2025 at 03:39)</a>:</h4>
<p>for nominal types, the only one we're going to support is tag unions (not records or tuples after all)</p>



<a name="502190430"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/502190430" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#502190430">(Feb 27 2025 at 03:39)</a>:</h4>
<p>and they do still need the <code>.*</code> syntax for making the tags optionally public</p>



<a name="502191126"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/502191126" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#502191126">(Feb 27 2025 at 03:47)</a>:</h4>
<p>That should be the only use of <code>*</code> then. Because we're going to remove it from types and use a variable instead. <a href="https://github.com/roc-lang/roc/issues/7451">https://github.com/roc-lang/roc/issues/7451</a></p>



<a name="502293446"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/502293446" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#502293446">(Feb 27 2025 at 14:09)</a>:</h4>
<p><span class="user-mention silent" data-user-id="515757">Luke Boswell</span> <a href="#narrow/channel/395097-compiler-development/topic/zig.20compiler.20-.20parser/near/502191126">said</a>:</p>
<blockquote>
<p>That should be the only use of <code>*</code> then. Because we're going to remove it from types and use a variable instead. <a href="https://github.com/roc-lang/roc/issues/7451">https://github.com/roc-lang/roc/issues/7451</a></p>
</blockquote>
<p>PR for this: <a href="https://github.com/roc-lang/roc/pull/7642">https://github.com/roc-lang/roc/pull/7642</a></p>



<a name="502295952"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/502295952" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#502295952">(Feb 27 2025 at 14:20)</a>:</h4>
<p><span class="user-mention silent" data-user-id="781658">Anthony Bullard</span> <a href="#narrow/channel/395097-compiler-development/topic/zig.20compiler.20-.20parser/near/502293446">said</a>:</p>
<blockquote>
<p><span class="user-mention silent" data-user-id="515757">Luke Boswell</span> <a href="#narrow/channel/395097-compiler-development/topic/zig.20compiler.20-.20parser/near/502191126">said</a>:</p>
<blockquote>
<p>That should be the only use of <code>*</code> then. Because we're going to remove it from types and use a variable instead. <a href="https://github.com/roc-lang/roc/issues/7451">https://github.com/roc-lang/roc/issues/7451</a></p>
</blockquote>
<p>PR for this: <a href="https://github.com/roc-lang/roc/pull/7642">https://github.com/roc-lang/roc/pull/7642</a></p>
</blockquote>
<p>Added <code>...</code> expression to the above</p>



<a name="502296229"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/502296229" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#502296229">(Feb 27 2025 at 14:21)</a>:</h4>
<p>Update from the above PR:</p>
<div class="codehilite" data-code-language="Zig"><pre><span></span><code><span class="k">test</span><span class="w"> </span><span class="s">"Syntax grab bag"</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">try</span><span class="w"> </span><span class="n">moduleFmtsSame</span><span class="p">(</span>
<span class="w">        </span><span class="sh">\\app [main!] { pf: platform "../basic-cli/platform.roc" }</span>
<span class="w">        </span><span class="sh">\\</span>
<span class="w">        </span><span class="sh">\\import pf.Stdout</span>
<span class="w">        </span><span class="sh">\\</span>
<span class="w">        </span><span class="sh">\\Map a b : List(a), (a -&gt; b) -&gt; List(b)</span>
<span class="w">        </span><span class="sh">\\</span>
<span class="w">        </span><span class="sh">\\Foo : (Bar, Baz)</span>
<span class="w">        </span><span class="sh">\\</span>
<span class="w">        </span><span class="sh">\\Some a : { foo : Ok(a), bar : Something }</span>
<span class="w">        </span><span class="sh">\\</span>
<span class="w">        </span><span class="sh">\\Maybe a : [Some(a), None]</span>
<span class="w">        </span><span class="sh">\\</span>
<span class="w">        </span><span class="sh">\\SomeFunc a : Maybe(a), a -&gt; Maybe(a)</span>
<span class="w">        </span><span class="sh">\\</span>
<span class="w">        </span><span class="sh">\\add_one_oneline = |num| if num 2 else 5</span>
<span class="w">        </span><span class="sh">\\</span>
<span class="w">        </span><span class="sh">\\add_one : (U64 -&gt; U64)</span>
<span class="w">        </span><span class="sh">\\add_one = |num| {</span>
<span class="w">        </span><span class="sh">\\    other = 1</span>
<span class="w">        </span><span class="sh">\\    if num {</span>
<span class="w">        </span><span class="sh">\\        dbg some_func()</span>
<span class="w">        </span><span class="sh">\\        0</span>
<span class="w">        </span><span class="sh">\\    } else {</span>
<span class="w">        </span><span class="sh">\\        dbg 123</span>
<span class="w">        </span><span class="sh">\\        other</span>
<span class="w">        </span><span class="sh">\\    }</span>
<span class="w">        </span><span class="sh">\\}</span>
<span class="w">        </span><span class="sh">\\</span>
<span class="w">        </span><span class="sh">\\match_time = |a| match a {</span>
<span class="w">        </span><span class="sh">\\    Blue | Green | Red -&gt; {</span>
<span class="w">        </span><span class="sh">\\        x = 12</span>
<span class="w">        </span><span class="sh">\\        x</span>
<span class="w">        </span><span class="sh">\\    }</span>
<span class="w">        </span><span class="sh">\\    lower -&gt; 1</span>
<span class="w">        </span><span class="sh">\\    "foo" -&gt; 100</span>
<span class="w">        </span><span class="sh">\\    "foo" | "bar" -&gt; 200</span>
<span class="w">        </span><span class="sh">\\    [1, 2, 3, .. as rest] -&gt; 123</span>
<span class="w">        </span><span class="sh">\\    [1, 2 | 5, 3, .. as rest] -&gt; 123</span>
<span class="w">        </span><span class="sh">\\    3.14 -&gt; 314</span>
<span class="w">        </span><span class="sh">\\    3.14 | 6.28 -&gt; 314</span>
<span class="w">        </span><span class="sh">\\    (1, 2, 3) -&gt; 123</span>
<span class="w">        </span><span class="sh">\\    (1, 2 | 5, 3) -&gt; 123</span>
<span class="w">        </span><span class="sh">\\    { foo: 1, bar: 2, ..rest } -&gt; 12</span>
<span class="w">        </span><span class="sh">\\    { foo: 1, bar: 2 | 7 } -&gt; 12</span>
<span class="w">        </span><span class="sh">\\    Ok(123) -&gt; 123</span>
<span class="w">        </span><span class="sh">\\    Ok(Some(dude)) -&gt; dude</span>
<span class="w">        </span><span class="sh">\\    TwoArgs("hello", Some("world")) -&gt; 1000</span>
<span class="w">        </span><span class="sh">\\}</span>
<span class="w">        </span><span class="sh">\\</span>
<span class="w">        </span><span class="sh">\\expect blah == 1</span>
<span class="w">        </span><span class="sh">\\</span>
<span class="w">        </span><span class="sh">\\main! : List(String) -&gt; Result({}, _)</span>
<span class="w">        </span><span class="sh">\\main! = |_| {</span>
<span class="w">        </span><span class="sh">\\    world = "World"</span>
<span class="w">        </span><span class="sh">\\    number = 123</span>
<span class="w">        </span><span class="sh">\\    expect blah == 1</span>
<span class="w">        </span><span class="sh">\\    tag = Blue</span>
<span class="w">        </span><span class="sh">\\    return tag</span>
<span class="w">        </span><span class="sh">\\    # NEW!!!</span>
<span class="w">        </span><span class="sh">\\    ...</span>
<span class="w">        </span><span class="sh">\\    match_time(...)</span>
<span class="w">        </span><span class="sh">\\    crash "Unreachable!"</span>
<span class="w">        </span><span class="sh">\\    tag_with_payload = Ok(number)</span>
<span class="w">        </span><span class="sh">\\    interpolated = "Hello, ${world}"</span>
<span class="w">        </span><span class="sh">\\    list = [add_one(number), 456, 789]</span>
<span class="w">        </span><span class="sh">\\    record = { foo: 123, bar: "Hello", baz: tag, qux: Ok(world), punned }</span>
<span class="w">        </span><span class="sh">\\    tuple = (123, "World", tag, Ok(world), (nested, tuple), [1, 2, 3])</span>
<span class="w">        </span><span class="sh">\\    bin_op_result = Err(foo) ?? 12 &gt; 5 * 5 or 13 + 2 &lt; 5 and 10 - 1 &gt;= 16 or 12 &lt;= 3 / 5</span>
<span class="w">        </span><span class="sh">\\    static_dispatch_style = some_fn(arg1)?.static_dispatch_method()?.next_static_dispatch_method()?.record_field?</span>
<span class="w">        </span><span class="sh">\\    Stdout.line!(interpolated)?</span>
<span class="w">        </span><span class="sh">\\    Stdout.line!("How about ${Num.toStr(number)} as a string?")</span>
<span class="w">        </span><span class="sh">\\}</span>
<span class="w">        </span><span class="sh">\\</span>
<span class="w">        </span><span class="sh">\\expect {</span>
<span class="w">        </span><span class="sh">\\    foo = 1</span>
<span class="w">        </span><span class="sh">\\    blah = 1</span>
<span class="w">        </span><span class="sh">\\    blah == foo</span>
<span class="w">        </span><span class="sh">\\}</span>
<span class="w">    </span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>



<a name="504004831"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/504004831" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#504004831">(Mar 07 2025 at 07:13)</a>:</h4>
<p>Ok... so what should be happening with malformed nodes? </p>
<p>For example say I have a roc file that is literally</p>
<div class="codehilite"><pre><span></span><code>modZZZ [foo]

foo = 1
</code></pre></div>
<p>I have a malformed header here and so expect there to be an error pushed into the list of Diagnostics and a malformed node added to the AST. </p>
<p>Now if I want to format this AST ... what should happen when I get to this point? </p>
<div class="codehilite" data-code-language="Zig"><pre><span></span><code><span class="kr">pub</span><span class="w"> </span><span class="k">fn</span><span class="w"> </span><span class="n">getHeader</span><span class="p">(</span><span class="n">store</span><span class="o">:</span><span class="w"> </span><span class="o">*</span><span class="n">NodeStore</span><span class="p">,</span><span class="w"> </span><span class="n">header</span><span class="o">:</span><span class="w"> </span><span class="n">HeaderIdx</span><span class="p">)</span><span class="w"> </span><span class="n">Header</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kr">const</span><span class="w"> </span><span class="n">node</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">store</span><span class="p">.</span><span class="n">nodes</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="nb">@enumFromInt</span><span class="p">(</span><span class="n">header</span><span class="p">.</span><span class="n">id</span><span class="p">));</span>
<span class="w">    </span><span class="k">switch</span><span class="w"> </span><span class="p">(</span><span class="n">node</span><span class="p">.</span><span class="n">tag</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="p">.</span><span class="n">app_header</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="p">},</span>
<span class="w">        </span><span class="p">.</span><span class="n">module_header</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="p">},</span>
<span class="w">        </span><span class="k">else</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">std</span><span class="p">.</span><span class="n">debug</span><span class="p">.</span><span class="n">panic</span><span class="p">(</span><span class="s">"Expected a valid header tag, got {s}"</span><span class="p">,</span><span class="w"> </span><span class="p">.{</span><span class="nb">@tagName</span><span class="p">(</span><span class="n">node</span><span class="p">.</span><span class="n">tag</span><span class="p">)});</span>
<span class="w">        </span><span class="p">},</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>We call <code>getHeader</code> and then it blows up because we don't have a malformed node.</p>
<p>Maybe we might actually want to add a malformed node here... so I gave that a try. Heres a PR that does that for just the header <a href="https://github.com/roc-lang/roc/pull/7672">https://github.com/roc-lang/roc/pull/7672</a></p>
<p>Am I on the right track?</p>



<a name="504006160"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/504006160" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#504006160">(Mar 07 2025 at 07:14)</a>:</h4>
<p>Side note -- I think I found a memory leak in the error diagnostics here by accident. </p>
<div class="codehilite"><pre><span></span><code>$ zig build snapshot
warning: file /Users/luke/Documents/GitHub/roc/src/snapshots/003.txt: contained 1 errors, skipping
info: processed 2 snapshots in 2 ms.
error(gpa): memory address 0x102928700 leaked:
/Users/luke/zig-macos-aarch64-0.13.0/lib/std/array_list.zig:1081:62: 0x102873d1f in ensureTotalCapacityPrecise (snapshot)
                const new_memory = try allocator.alignedAlloc(T, alignment, new_capacity);
                                                             ^
/Users/luke/zig-macos-aarch64-0.13.0/lib/std/array_list.zig:1058:51: 0x1028628e3 in ensureTotalCapacity (snapshot)
            return self.ensureTotalCapacityPrecise(allocator, better_capacity);
                                                  ^
/Users/luke/zig-macos-aarch64-0.13.0/lib/std/array_list.zig:1111:41: 0x102847daf in addOne (snapshot)
            try self.ensureTotalCapacity(allocator, newlen);
                                        ^
/Users/luke/zig-macos-aarch64-0.13.0/lib/std/array_list.zig:848:49: 0x10281b687 in append (snapshot)
            const new_item_ptr = try self.addOne(allocator);
                                                ^
/Users/luke/Documents/GitHub/roc/src/check/parse/Parser.zig:121:28: 0x1028462ef in pushMalformed__anon_11980 (snapshot)
    self.diagnostics.append(self.gpa, .{
                           ^
/Users/luke/Documents/GitHub/roc/src/check/parse/Parser.zig:943:38: 0x10281a103 in parseExprWithBp (snapshot)
            return self.pushMalformed(IR.NodeStore.ExprIdx, .unexpected_token);
                                     ^
</code></pre></div>



<a name="504128827"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/504128827" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#504128827">(Mar 07 2025 at 15:59)</a>:</h4>
<p>This is a great question for <span class="user-mention" data-user-id="453336">@Joshua Warner</span> since he designed the malformed node system.  Ideally it would just be something aggressive like (MALFORMED &lt;tag&gt;)</p>



<a name="504129851"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/504129851" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#504129851">(Mar 07 2025 at 16:04)</a>:</h4>
<p>Need some alignment on syntax supported in exposes/exposing list(both in headers and in imports)</p>
<ul>
<li>lower and upper idents obviously</li>
<li>they can have alias using <code>as</code> (?)</li>
<li>they can have a <code>.</code> with either <code>*</code> or curlies around a comma separated list of lower and upper idents</li>
<li>Can Those ^ have aliases?</li>
</ul>
<div class="codehilite"><pre><span></span><code>import SomeModule exposing [
    lowerIdent!,
    UpperIdent,
    something as something_else, # ???
    Foo.*,
    Bar.{ fn_one, fn_two },
    Baz.{ fn_one as function_one, fn_two as function_two }, #???
]
</code></pre></div>



<a name="504129910"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/504129910" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#504129910">(Mar 07 2025 at 16:04)</a>:</h4>
<p>And are there differences worth worrying about between headers and imports?</p>



<a name="504129926"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/504129926" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#504129926">(Mar 07 2025 at 16:05)</a>:</h4>
<p>(At least for parsing)</p>



<a name="504129953"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/504129953" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#504129953">(Mar 07 2025 at 16:05)</a>:</h4>
<p><span class="user-mention" data-user-id="281383">@Richard Feldman</span> since you are the keeper of the syntax :-)</p>



<a name="504146799"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/504146799" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#504146799">(Mar 07 2025 at 17:30)</a>:</h4>
<p>Those last two don't exist anymore, right?</p>



<a name="504148933"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/504148933" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#504148933">(Mar 07 2025 at 17:42)</a>:</h4>
<p>also <code>.*</code> should not be allowed in imports</p>



<a name="504149019"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/504149019" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#504149019">(Mar 07 2025 at 17:43)</a>:</h4>
<p>only in the specific case of a module header that's exposing a nominal tag union</p>



<a name="504149027"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/504149027" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#504149027">(Mar 07 2025 at 17:43)</a>:</h4>
<p>You're thinking of glob exposes for custom unions, Anthony</p>



<a name="504160731"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/504160731" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#504160731">(Mar 07 2025 at 18:44)</a>:</h4>
<p>Probably. I think I forgot custom types became a tag union rather than a record</p>



<a name="504161180"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/504161180" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#504161180">(Mar 07 2025 at 18:46)</a>:</h4>
<p>So</p>
<div class="codehilite"><pre><span></span><code>import SomeModule exposing [
    lowerIdent!,
    UpperIdent,
    something as something_else,
]
</code></pre></div>
<p>And </p>
<div class="codehilite"><pre><span></span><code>module exposing [
    lowerIdent!,
    UpperIdent,
    something as something_else,
    Foo.*,
]
</code></pre></div>



<a name="504161296"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/504161296" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#504161296">(Mar 07 2025 at 18:47)</a>:</h4>
<p>I think I’ll parse the same and let Can throw an error on .* in an import</p>



<a name="504163199"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/504163199" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#504163199">(Mar 07 2025 at 18:57)</a>:</h4>
<p>That all looks right to me, except for <code>module exposing [a as b]</code>, not sure if that's planned for support</p>



<a name="504163460"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/504163460" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Warner <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#504163460">(Mar 07 2025 at 18:59)</a>:</h4>
<p><span class="user-mention silent" data-user-id="781658">Anthony Bullard</span> <a href="#narrow/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser/near/504128827">said</a>:</p>
<blockquote>
<p>This is a great question for <span class="user-mention silent" data-user-id="453336">Joshua Warner</span> since he designed the malformed node system.  Ideally it would just be something aggressive like (MALFORMED &lt;tag&gt;)</p>
</blockquote>
<p>Yep this is exactly what I was thinking</p>



<a name="504213180"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/504213180" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#504213180">(Mar 08 2025 at 00:53)</a>:</h4>
<p><span class="user-mention silent" data-user-id="461444">Sam Mohr</span> <a href="#narrow/channel/395097-compiler-development/topic/zig.20compiler.20-.20parser/near/504163199">said</a>:</p>
<blockquote>
<p>That all looks right to me, except for <code>module exposing [a as b]</code>, not sure if that's planned for support</p>
</blockquote>
<p>If it's not, it should :-)</p>



<a name="504213383"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/504213383" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#504213383">(Mar 08 2025 at 00:55)</a>:</h4>
<p>Renaming on expose? Why?</p>



<a name="504213394"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/504213394" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#504213394">(Mar 08 2025 at 00:55)</a>:</h4>
<p>Feels like that is a sign the function was simply named wrong</p>



<a name="504213525"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/504213525" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#504213525">(Mar 08 2025 at 00:56)</a>:</h4>
<p>It's not uncommon to encounter a situation where more than one import exposes a function/type that has the same name that you may want to use without namespacing</p>



<a name="504213546"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/504213546" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#504213546">(Mar 08 2025 at 00:57)</a>:</h4>
<p>But now that I think of it, maybe that mostly disappears with SD</p>



<a name="504213571"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/504213571" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#504213571">(Mar 08 2025 at 00:57)</a>:</h4>
<p>I think of multiple types having a map function for instance</p>



<a name="504213679"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/504213679" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#504213679">(Mar 08 2025 at 00:58)</a>:</h4>
<p>Ok, so the only different thing available here is the .* syntax in headers</p>



<a name="504213695"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/504213695" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#504213695">(Mar 08 2025 at 00:58)</a>:</h4>
<p>It would make SD more complicated than "the module needs a function named xyz" to allow renaming two things to the same name in the same module</p>



<a name="504213699"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/504213699" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#504213699">(Mar 08 2025 at 00:58)</a>:</h4>
<p>Man that seems like such a silly thing to have to create a new node type for</p>



<a name="504213720"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/504213720" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#504213720">(Mar 08 2025 at 00:58)</a>:</h4>
<p>And besides that, there's no value to doing it there besides at the module name</p>



<a name="504213740"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/504213740" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#504213740">(Mar 08 2025 at 00:59)</a>:</h4>
<p>So I vote actively not adding that feature</p>



<a name="504213744"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/504213744" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#504213744">(Mar 08 2025 at 00:59)</a>:</h4>
<p>My specific comment is rename on <code>exposing</code>. Rename on <code>import</code> makes sense to me</p>



<a name="504213775"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/504213775" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#504213775">(Mar 08 2025 at 00:59)</a>:</h4>
<p><span class="user-mention silent" data-user-id="781658">Anthony Bullard</span> <a href="#narrow/channel/395097-compiler-development/topic/zig.20compiler.20-.20parser/near/504213699">said</a>:</p>
<blockquote>
<p>Man that seems like such a silly thing to have to create a new node type for</p>
</blockquote>
<p>copium</p>



<a name="504213776"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/504213776" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#504213776">(Mar 08 2025 at 00:59)</a>:</h4>
<p><span class="user-mention silent" data-user-id="343810">Brendan Hansknecht</span> <a href="#narrow/channel/395097-compiler-development/topic/zig.20compiler.20-.20parser/near/504213744">said</a>:</p>
<blockquote>
<p>My specific comment is rename on <code>exposing</code>. Rename on <code>import</code> makes sense to me</p>
</blockquote>
<p>I agree with you on the header</p>



<a name="504213792"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/504213792" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#504213792">(Mar 08 2025 at 00:59)</a>:</h4>
<p><span class="user-mention silent" data-user-id="461444">Sam Mohr</span> <a href="#narrow/channel/395097-compiler-development/topic/zig.20compiler.20-.20parser/near/504213775">said</a>:</p>
<blockquote>
<p><span class="user-mention silent" data-user-id="781658">Anthony Bullard</span> <a href="#narrow/channel/395097-compiler-development/topic/zig.20compiler.20-.20parser/near/504213699">said</a>:</p>
<blockquote>
<p>Man that seems like such a silly thing to have to create a new node type for</p>
</blockquote>
<p>copium</p>
</blockquote>
<p><span aria-label="stuck out tongue closed eyes" class="emoji emoji-1f61d" role="img" title="stuck out tongue closed eyes">:stuck_out_tongue_closed_eyes:</span></p>



<a name="504238388"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/504238388" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#504238388">(Mar 08 2025 at 05:44)</a>:</h4>
<p>the benefit is to avoid shadowing</p>



<a name="504238435"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/504238435" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#504238435">(Mar 08 2025 at 05:45)</a>:</h4>
<p>let's say I have a module named <code>Parser</code> and I want to expose <code>Parser.str</code> but I also want to use the name <code>str</code> all over the place in <code>Parser.roc</code></p>



<a name="504238517"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/504238517" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#504238517">(Mar 08 2025 at 05:46)</a>:</h4>
<p><code>as</code> in the module header's <code>exposing</code> means I can locally name it <code>inner_str</code> (or whatever) and then expose <code>inner_str as str</code> so everyone outside the module gets the nice name of <code>Parser.str</code> but inside <code>Parser.roc</code> I still get to use the name <code>str</code> for argument names etc.</p>



<a name="504239881"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/504239881" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#504239881">(Mar 08 2025 at 06:04)</a>:</h4>
<p>I guess</p>



<a name="504239888"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/504239888" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#504239888">(Mar 08 2025 at 06:04)</a>:</h4>
<p>I feel like that is rare</p>



<a name="504239920"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/504239920" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#504239920">(Mar 08 2025 at 06:05)</a>:</h4>
<p>And if you really need it, you can make <code>Parser.roc</code> that reexports things form <code>InnerParser.roc</code></p>



<a name="504239940"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/504239940" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#504239940">(Mar 08 2025 at 06:05)</a>:</h4>
<p>No strong feels, just feel unnecessary.</p>



<a name="504286797"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/504286797" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#504286797">(Mar 08 2025 at 15:28)</a>:</h4>
<p>I feel like, reading <span class="user-mention" data-user-id="281383">@Richard Feldman</span> 's message, that I should implement <code>as</code> in exposing</p>



<a name="504322439"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/504322439" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#504322439">(Mar 08 2025 at 22:07)</a>:</h4>
<p>I think I can parse a <code>crash</code> at the top level.. but not in a def. </p>
<p>This blows up because it makes that a malformed node</p>
<div class="codehilite"><pre><span></span><code>module []

thing =
    crash &quot;something&quot;
</code></pre></div>
<p>But this is fine</p>
<div class="codehilite"><pre><span></span><code>module []

crash &quot;something&quot;
</code></pre></div>



<a name="504322731"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/504322731" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#504322731">(Mar 08 2025 at 22:11)</a>:</h4>
<p>Actually I think it's the same for <code>expect</code> and <code>return</code> too</p>



<a name="504323646"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/504323646" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#504323646">(Mar 08 2025 at 22:24)</a>:</h4>
<p>That shouldn't break, yes, but I think in this case it's looking for braces</p>



<a name="504323668"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/504323668" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#504323668">(Mar 08 2025 at 22:25)</a>:</h4>
<p>Which I think is good, because it keeps statement-only behaviors from working as expressions</p>



<a name="504323685"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/504323685" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#504323685">(Mar 08 2025 at 22:25)</a>:</h4>
<p>Though a proper error message would be nice</p>



<a name="504323784"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/504323784" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#504323784">(Mar 08 2025 at 22:26)</a>:</h4>
<p>I thought we decided those wouldn't have braces -- edit err parens <code>(</code>?</p>



<a name="504323902"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/504323902" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#504323902">(Mar 08 2025 at 22:27)</a>:</h4>
<p>Interesting... so this parses correctly</p>
<div class="codehilite"><pre><span></span><code>module []

foo = { crash &quot;something&quot; }
</code></pre></div>
<p>But the formatter removes the braces <code>{</code>, and then it blows up</p>



<a name="504323909"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/504323909" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#504323909">(Mar 08 2025 at 22:28)</a>:</h4>
<p><span class="user-mention silent" data-user-id="281383">Richard Feldman</span> <a href="#narrow/channel/304641-ideas/topic/.60if.60.20condition.20pattern.20match/near/502677490">said</a>:</p>
<blockquote>
<p>here is a concrete proposal that I'm happy with. If anyone would rather we didn't do this, please say why!</p>
<ol>
<li>Change the way <code>?? return ""</code> formats to have the formatter add braces so it becomes <code>?? { return "" }</code> and same with <code>crash</code>. No changes to the semantics of anything involved in this; it's purely to address the concern over it being not visually obvious enough what the code does.</li>
<li>Introduce <code>if Ok(path) = paths.first() {</code> pattern matching. We explored a bunch of alternatives and this still feels like the best solution to the problem at the top of the thread.</li>
</ol>
<p>that's it, no other changes. Both of these are addressing specific ergonomics concerns with the status quo, and are not trying to go back to the drawing board and reconsider everything.</p>
</blockquote>



<a name="504323964"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/504323964" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#504323964">(Mar 08 2025 at 22:28)</a>:</h4>
<p>Okay, I was changing remembered history in bias of my preferences</p>



<a name="504323967"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/504323967" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#504323967">(Mar 08 2025 at 22:28)</a>:</h4>
<p>Classic</p>



<a name="504329762"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/504329762" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#504329762">(Mar 08 2025 at 23:48)</a>:</h4>
<p><span class="user-mention silent" data-user-id="515757">Luke Boswell</span> <a href="#narrow/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser/near/504323902">said</a>:</p>
<blockquote>
<p>Interesting... so this parses correctly</p>
<div class="codehilite"><pre><span></span><code>module []

foo = { crash &quot;something&quot; }
</code></pre></div>
<p>But the formatter removes the braces <code>{</code>, and then it blows up</p>
</blockquote>
<p>This is my fault. Kind of. Crash is a statement but not an expression right now, and statements are only parsed in the top level and inside of blocks</p>
<p>But the formatter removes the curlies form single statement blocks - assuming they are just an expression</p>



<a name="504329810"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/504329810" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#504329810">(Mar 08 2025 at 23:49)</a>:</h4>
<p>The only way to resolve this in the parser would be to lookup what kind of statement is in the single statement blocks to ensure it is a Expr</p>



<a name="504329870"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/504329870" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#504329870">(Mar 08 2025 at 23:50)</a>:</h4>
<p>But I can’t push anything today due to a day long outage by Comcast in near-west Chicago</p>



<a name="504330258"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/504330258" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#504330258">(Mar 08 2025 at 23:57)</a>:</h4>
<p>It's alg. I'm just noting things as I find them.</p>
<p>I'm often not sure if its me, the parser impl  or what the intended syntax is. </p>
<p>It's not urgent or anything.</p>



<a name="504437200"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/504437200" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#504437200">(Mar 09 2025 at 22:13)</a>:</h4>
<p>I've just been looping with the fuzzer and fixing bugs one by one in <a href="https://github.com/roc-lang/roc/pull/7672">https://github.com/roc-lang/roc/pull/7672</a></p>
<p>I'm not 100% my approach is right so I'm just keeping it in draft until I get some feedback or we have a clear direction for handling errors. </p>
<p>I'm just picking the first fuzz crash, fixing that and making a snapshot test for it, then moving on to the next. </p>
<p>I'm expecting there will be changes required and happy to do that later. But I figure it doesn't hurt to just keep going for now.</p>



<a name="504967134"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/504967134" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#504967134">(Mar 11 2025 at 22:05)</a>:</h4>
<p>I just noticed we have two different <code>Region</code> types. One has indexes into the token buffer, so token indexes. The other has indexes into the source code bytes.</p>
<p>Should we rename one of these, e.g. <code>TRegion</code> or something to reflect it's spanning the tokens instead?</p>



<a name="504967424"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/504967424" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#504967424">(Mar 11 2025 at 22:07)</a>:</h4>
<p>The other idea I have, is to move the Region that indexes tokens, under Token.. so it's a <code>Token.Region</code> instead</p>



<a name="504969797"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/504969797" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#504969797">(Mar 11 2025 at 22:21)</a>:</h4>
<p>It would be nice to unify them, yes. I think the other suggestion from <span class="user-mention" data-user-id="453336">@Joshua Warner</span> was to make <code>Region</code> be a <code>Node.Idx</code>. That would allow us to use half the memory (we only need one u32 value instead of a start and end that are both u32), though some diagnostics might need to store more <code>Region</code>s when they refer to complex regions.</p>



<a name="504969926"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/504969926" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#504969926">(Mar 11 2025 at 22:22)</a>:</h4>
<p>At the very least, I agree that renaming one of the two <code>Region</code>s in our codebase would mitigate some confusion.</p>



<a name="504973322"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/504973322" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#504973322">(Mar 11 2025 at 22:38)</a>:</h4>
<blockquote>
<p>I think the other suggestion from @Joshua Warner was to make <code>Region</code> be a <code>Node.Idx</code>.</p>
</blockquote>
<p>Does this work in general? Won't a region in the parser be a range of tokens rather than a single token?</p>



<a name="504973382"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/504973382" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#504973382">(Mar 11 2025 at 22:39)</a>:</h4>
<p>Like the region of an expression will include many many tokens</p>



<a name="504974161"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/504974161" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#504974161">(Mar 11 2025 at 22:43)</a>:</h4>
<p>Yes, it would hold many tokens</p>



<a name="504974370"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/504974370" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#504974370">(Mar 11 2025 at 22:44)</a>:</h4>
<p>The tradeoff is that we can store everything we need a <code>Region</code> to do, which is display/highlight code for diagnostics, in 32 bits</p>



<a name="504974458"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/504974458" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#504974458">(Mar 11 2025 at 22:44)</a>:</h4>
<p>But at the cost of needing the parse AST to figure out what a <code>Region</code> refers to</p>



<a name="504974664"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/504974664" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#504974664">(Mar 11 2025 at 22:45)</a>:</h4>
<p>If there is a tradeoff here, I lean towards keeping it brain dead simple for now... until we have a working compiler</p>



<a name="504974681"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/504974681" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#504974681">(Mar 11 2025 at 22:45)</a>:</h4>
<p>Agreed</p>



<a name="504974713"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/504974713" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#504974713">(Mar 11 2025 at 22:45)</a>:</h4>
<p>Though they both seem simple to me</p>



<a name="504974966"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/504974966" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#504974966">(Mar 11 2025 at 22:47)</a>:</h4>
<p><del>Option 1: two <code>Region</code> types, <code>Region = { start: u32, len: u32 }</code> and refers to a slice of the source code, <code>TokenRegion</code> is separate for the tokenizer</del></p>



<a name="504975345"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/504975345" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#504975345">(Mar 11 2025 at 22:49)</a>:</h4>
<p>Okay, looking now at the <code>Parse.IR.Region</code> type, they can definitely be the same thing</p>



<a name="504975419"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/504975419" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#504975419">(Mar 11 2025 at 22:49)</a>:</h4>
<div class="codehilite" data-code-language="Zig"><pre><span></span><code><span class="c1">/// The first and last token consumed by a Node</span>
<span class="kr">pub</span><span class="w"> </span><span class="kr">const</span><span class="w"> </span><span class="n">Region</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">start</span><span class="o">:</span><span class="w"> </span><span class="n">TokenIdx</span><span class="p">,</span>
<span class="w">    </span><span class="n">end</span><span class="o">:</span><span class="w"> </span><span class="n">TokenIdx</span><span class="p">,</span>
<span class="p">};</span>
</code></pre></div>
<p><a href="https://github.com/roc-lang/roc/blob/13c5152cb736d7d46a599fe4624e4ddd58d8a1a5/src/check/parse/IR.zig#L100">defined here</a></p>



<a name="504975733"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/504975733" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#504975733">(Mar 11 2025 at 22:51)</a>:</h4>
<p>I think we should either use <code>Region = Parse.IR.Region</code> or <code>Region = Node.Idx</code></p>



<a name="504976163"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/504976163" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#504976163">(Mar 11 2025 at 22:54)</a>:</h4>
<p>Both of them assume that tokenizing/parsing has happened, but unless we either:</p>
<ul>
<li>keep a copy of each source file of memory, or</li>
<li>trust that the contents of the source file haven't changed between the initial parse and the reporting of diagnostics</li>
</ul>
<p>Even the <code>Region = { start: u32, len: u32 }</code> solution is fragile to source-code changes</p>



<a name="504976290"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/504976290" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#504976290">(Mar 11 2025 at 22:55)</a>:</h4>
<p><del>If we get diagnostics, we could rip out the relevant text before closing the file</del> Nvm, late stages might have diagnostics...was just thinking about tokenize and parse diagnostics</p>



<a name="504976363"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/504976363" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#504976363">(Mar 11 2025 at 22:55)</a>:</h4>
<p>What about diagnostics (which I'm using interchangeably with errors/warnings) for type errors?</p>



<a name="504976369"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/504976369" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#504976369">(Mar 11 2025 at 22:55)</a>:</h4>
<p>yep</p>



<a name="504976464"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/504976464" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#504976464">(Mar 11 2025 at 22:56)</a>:</h4>
<p>I think we just reopen the file and if it changed, oh well</p>



<a name="504976519"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/504976519" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#504976519">(Mar 11 2025 at 22:56)</a>:</h4>
<p>Yeah, not worth making our compiler more memory-bloated to handle this</p>



<a name="504976569"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/504976569" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#504976569">(Mar 11 2025 at 22:57)</a>:</h4>
<p>Also, keeping original source ranges enables use to just drop the tokenized buffer. So I lean towards that.</p>



<a name="504976628"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/504976628" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#504976628">(Mar 11 2025 at 22:57)</a>:</h4>
<p>The plan was to just tokenize/parse a second time</p>



<a name="504976654"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/504976654" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#504976654">(Mar 11 2025 at 22:57)</a>:</h4>
<p>If we do that, then we can use a single u32</p>



<a name="504976752"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/504976752" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#504976752">(Mar 11 2025 at 22:58)</a>:</h4>
<p>The start offset to tokenize/parse from?</p>



<a name="504976798"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/504976798" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#504976798">(Mar 11 2025 at 22:58)</a>:</h4>
<p>The <code>Parse.IR.Store.Node.Idx</code></p>



<a name="504976902"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/504976902" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#504976902">(Mar 11 2025 at 22:59)</a>:</h4>
<p>Oh, and just assume that reparsing will generate the exact same node. Then from the node get the start and end token and from those get the region start and end bytes</p>



<a name="504976916"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/504976916" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#504976916">(Mar 11 2025 at 22:59)</a>:</h4>
<p>Yep!</p>



<a name="504977066"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/504977066" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#504977066">(Mar 11 2025 at 23:00)</a>:</h4>
<p>I don't believe that would be much harder than the current approach, and neither solution is implemented yet since error rendering is entirely untouched</p>



<a name="504977108"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/504977108" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#504977108">(Mar 11 2025 at 23:00)</a>:</h4>
<p>Just trying to think about the implications of llvm debug info generation (and interpreter single stepping and printing surrounding context).</p>



<a name="504977310"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/504977310" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#504977310">(Mar 11 2025 at 23:01)</a>:</h4>
<p>The interpreter would probably want to keep a parse AST for every file, or even the source of the file at time of interpretation</p>



<a name="504977333"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/504977333" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#504977333">(Mar 11 2025 at 23:01)</a>:</h4>
<p>For llvm debug info means that we will reparse every single file (but this reduce max memory requirement of the compiler and llvm is really just for optimized builds so reparsing should be really cheap).</p>



<a name="504977549"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/504977549" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#504977549">(Mar 11 2025 at 23:02)</a>:</h4>
<p>I was suggesting to <span class="user-mention" data-user-id="453336">@Joshua Warner</span> that we used to parse just the header of files when looking for package dependencies, and he said "I'm hoping parsing is so fast that we don't need to worry about partial parsing"</p>



<a name="504977566"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/504977566" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#504977566">(Mar 11 2025 at 23:02)</a>:</h4>
<p><span class="user-mention silent" data-user-id="461444">Sam Mohr</span> <a href="#narrow/channel/395097-compiler-development/topic/zig.20compiler.20-.20parser/near/504977310">said</a>:</p>
<blockquote>
<p>The interpreter would probably want to keep a parse AST for every file, or even the source of the file at time of interpretation</p>
</blockquote>
<p>Yeah, quite possibly. Though don't want to ruin memory use due to a single gigantic file. So might want to reload only if needed. Cause execution flow doesn't need any line info, only repl and debug flows.</p>



<a name="504977578"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/504977578" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#504977578">(Mar 11 2025 at 23:02)</a>:</h4>
<p>I think parsing can be super fast</p>



<a name="504977616"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/504977616" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#504977616">(Mar 11 2025 at 23:03)</a>:</h4>
<p>yeah, all sounds reasonable</p>



<a name="504977654"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/504977654" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#504977654">(Mar 11 2025 at 23:03)</a>:</h4>
<p>I'll be really curious to bench parsing against the rust compiler</p>



<a name="504977757"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/504977757" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#504977757">(Mar 11 2025 at 23:03)</a>:</h4>
<p>Benchmarking of just parsing and also eventually typechecking as well would be awesome to see side-by-side!</p>



<a name="504977968"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/504977968" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#504977968">(Mar 11 2025 at 23:05)</a>:</h4>
<p>Yeah, full <code>roc check</code> flow once it is working</p>



<a name="504978071"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/504978071" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#504978071">(Mar 11 2025 at 23:05)</a>:</h4>
<blockquote>
<p>since error rendering is entirely untouched</p>
</blockquote>
<p>That's not entirely true anymore</p>



<a name="504978164"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/504978164" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#504978164">(Mar 11 2025 at 23:06)</a>:</h4>
<p><a href="https://github.com/roc-lang/roc/blob/13c5152cb736d7d46a599fe4624e4ddd58d8a1a5/src/problem.zig#L82">https://github.com/roc-lang/roc/blob/13c5152cb736d7d46a599fe4624e4ddd58d8a1a5/src/problem.zig#L82</a></p>



<a name="504980854"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/504980854" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#504980854">(Mar 11 2025 at 23:24)</a>:</h4>
<p>Good to know!</p>



<a name="505145073"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/505145073" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#505145073">(Mar 12 2025 at 14:12)</a>:</h4>
<p>Holy cow</p>



<a name="505145279"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/505145279" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#505145279">(Mar 12 2025 at 14:13)</a>:</h4>
<p>Don't have enough time right now to read all of this, but I have a new PR that gets us down the path towards multiline and commented code formatting: <a href="https://github.com/roc-lang/roc/pull/7695">https://github.com/roc-lang/roc/pull/7695</a></p>
<p>Here's a preview of the supported syntax:</p>
<div class="codehilite" data-code-language="Zig"><pre><span></span><code><span class="w">    </span><span class="k">try</span><span class="w"> </span><span class="n">moduleFmtsSame</span><span class="p">(</span>
<span class="w">        </span><span class="sh">\\app [main!] { pf: platform "../basic-cli/platform.roc" }</span>
<span class="w">        </span><span class="sh">\\</span>
<span class="w">        </span><span class="sh">\\... # Elided for clarity and terseness - I love that this is parsed as valid code :-)</span>
<span class="w">        </span><span class="sh">\\</span>
<span class="w">        </span><span class="sh">\\main! : List(String) -&gt; Result({}, _)</span>
<span class="w">        </span><span class="sh">\\main! = |_| {</span>
<span class="w">        </span><span class="sh">\\    world = "World"</span>
<span class="w">        </span><span class="sh">\\    number = 123</span>
<span class="w">        </span><span class="sh">\\    expect blah == 1</span>
<span class="w">        </span><span class="sh">\\    tag = Blue</span>
<span class="w">        </span><span class="sh">\\    return tag</span>
<span class="w">        </span><span class="sh">\\    ...</span>
<span class="w">        </span><span class="sh">\\    match_time(...)</span>
<span class="w">        </span><span class="sh">\\    crash "Unreachable!"</span>
<span class="w">        </span><span class="sh">\\    tag_with_payload = Ok(number)</span>
<span class="w">        </span><span class="sh">\\    interpolated = "Hello, ${world}"</span>
<span class="w">        </span><span class="sh">\\    list = [</span>
<span class="w">        </span><span class="sh">\\        add_one(number), # Comment one</span>
<span class="w">        </span><span class="sh">\\        456, # Comment two</span>
<span class="w">        </span><span class="sh">\\        789, # Comment three</span>
<span class="w">        </span><span class="sh">\\    ]</span>
<span class="w">        </span><span class="sh">\\    record = { foo: 123, bar: "Hello", baz: tag, qux: Ok(world), punned }</span>
<span class="w">        </span><span class="sh">\\    tuple = (123, "World", tag, Ok(world), (nested, tuple), [1, 2, 3])</span>
<span class="w">        </span><span class="sh">\\    multiline_tuple = (</span>
<span class="w">        </span><span class="sh">\\        123,</span>
<span class="w">        </span><span class="sh">\\        "World",</span>
<span class="w">        </span><span class="sh">\\        tag1,</span>
<span class="w">        </span><span class="sh">\\        Ok(world), # This one has a comment</span>
<span class="w">        </span><span class="sh">\\        (nested, tuple),</span>
<span class="w">        </span><span class="sh">\\        [1, 2, 3],</span>
<span class="w">        </span><span class="sh">\\    )</span>
<span class="w">        </span><span class="sh">\\    bin_op_result = Err(foo) ?? 12 &gt; 5 * 5 or 13 + 2 &lt; 5 and 10 - 1 &gt;= 16 or 12 &lt;= 3 / 5</span>
<span class="w">        </span><span class="sh">\\    static_dispatch_style = some_fn(arg1)?.static_dispatch_method()?.next_static_dispatch_method()?.record_field?</span>
<span class="w">        </span><span class="sh">\\    Stdout.line!(interpolated)?</span>
<span class="w">        </span><span class="sh">\\    Stdout.line!("How about ${Num.toStr(number)} as a string?")</span>
<span class="w">        </span><span class="sh">\\}</span>
<span class="w">        </span><span class="sh">\\</span>
<span class="w">        </span><span class="sh">\\expect {</span>
<span class="w">        </span><span class="sh">\\    foo = 1 # This should work too</span>
<span class="w">        </span><span class="sh">\\    blah = 1</span>
<span class="w">        </span><span class="sh">\\    blah == foo</span>
<span class="w">        </span><span class="sh">\\}</span>
<span class="w">    </span><span class="p">);</span>
</code></pre></div>



<a name="505145353"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/505145353" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#505145353">(Mar 12 2025 at 14:13)</a>:</h4>
<p>From here it'll be pretty mechanical</p>



<a name="505145585"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/505145585" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#505145585">(Mar 12 2025 at 14:14)</a>:</h4>
<p>I need to add a function to get comments at the start of a multiline construct, and do some massaging of the comment to collapse excessive newlines</p>



<a name="505145717"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/505145717" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#505145717">(Mar 12 2025 at 14:15)</a>:</h4>
<p>And of course adopt my new <code>formatCollection</code> function in about 12 places, adjusting some bad Region calculations along the way</p>



<a name="505145922"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/505145922" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#505145922">(Mar 12 2025 at 14:16)</a>:</h4>
<p>The hardest part will definitely be the headers more than likely</p>



<a name="505147728"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/505147728" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#505147728">(Mar 12 2025 at 14:22)</a>:</h4>
<p>And at the end I'll try to incorporate "trailing comma multiline forcing"</p>



<a name="505148289"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/505148289" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#505148289">(Mar 12 2025 at 14:24)</a>:</h4>
<p><span class="user-mention silent" data-user-id="461444">Sam Mohr</span> <a href="#narrow/channel/395097-compiler-development/topic/zig.20compiler.20-.20parser/near/504977757">said</a>:</p>
<blockquote>
<p>Benchmarking of just parsing and also eventually typechecking as well would be awesome to see side-by-side!</p>
</blockquote>
<p>I'm also interested in this as well (obviously), but it won't be quite a fair fight since the grammar is in many ways much easier to parse now without WSS</p>



<a name="505148346"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/505148346" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#505148346">(Mar 12 2025 at 14:24)</a>:</h4>
<p>And also, we are tokenizing before parsing now</p>



<a name="505174762"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/505174762" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#505174762">(Mar 12 2025 at 15:48)</a>:</h4>
<p>I don't think it needs to be fair. Part of the rewrite of the compiler was improving the grammar</p>



<a name="505174971"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/505174971" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#505174971">(Mar 12 2025 at 15:49)</a>:</h4>
<p>It is just important to remember that it is a multifaceted comparison, not just rust vs zig or DOD vs not or etc.</p>



<a name="505175162"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/505175162" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#505175162">(Mar 12 2025 at 15:49)</a>:</h4>
<p>Cause at the end of the day, users will care about the compiler perf and won't particularly care about any of those other details.</p>



<a name="505822544"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/505822544" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#505822544">(Mar 15 2025 at 07:57)</a>:</h4>
<p>These are only super preliminary numbers... I'm really hoping I didn't mess anything up. I don't think I did, but the numbers feel too good to be true:</p>
<div class="spoiler-block"><div class="spoiler-header">
<p>M1 Mac</p>
</div><div class="spoiler-content" aria-hidden="true">
<div class="codehilite" data-code-language="Bash"><pre><span></span><code><span class="w"> </span>hyperfine<span class="w"> </span>-N<span class="w"> </span>-w<span class="w"> </span><span class="m">5</span><span class="w"> </span>-r<span class="w"> </span><span class="m">30</span><span class="w"> </span>--prepare<span class="w"> </span><span class="s1">'sync &amp;&amp; sudo purge'</span><span class="w"> </span><span class="s2">"roc format /tmp/old"</span><span class="w"> </span><span class="s2">"./zig-out/bin/roc format /tmp/new"</span>
Benchmark<span class="w"> </span><span class="m">1</span>:<span class="w"> </span>roc<span class="w"> </span>format<span class="w"> </span>/tmp/old
<span class="w">  </span>Time<span class="w"> </span><span class="o">(</span>mean<span class="w"> </span>±<span class="w"> </span>σ<span class="o">)</span>:<span class="w">     </span><span class="m">298</span>.2<span class="w"> </span>ms<span class="w"> </span>±<span class="w">   </span><span class="m">0</span>.7<span class="w"> </span>ms<span class="w">    </span><span class="o">[</span>User:<span class="w"> </span><span class="m">257</span>.4<span class="w"> </span>ms,<span class="w"> </span>System:<span class="w"> </span><span class="m">38</span>.8<span class="w"> </span>ms<span class="o">]</span>
<span class="w">  </span>Range<span class="w"> </span><span class="o">(</span>min<span class="w"> </span>…<span class="w"> </span>max<span class="o">)</span>:<span class="w">   </span><span class="m">297</span>.0<span class="w"> </span>ms<span class="w"> </span>…<span class="w"> </span><span class="m">299</span>.6<span class="w"> </span>ms<span class="w">    </span><span class="m">30</span><span class="w"> </span>runs

Benchmark<span class="w"> </span><span class="m">2</span>:<span class="w"> </span>./zig-out/bin/roc<span class="w"> </span>format<span class="w"> </span>/tmp/new
<span class="w">  </span>Time<span class="w"> </span><span class="o">(</span>mean<span class="w"> </span>±<span class="w"> </span>σ<span class="o">)</span>:<span class="w">      </span><span class="m">25</span>.7<span class="w"> </span>ms<span class="w"> </span>±<span class="w">   </span><span class="m">0</span>.2<span class="w"> </span>ms<span class="w">    </span><span class="o">[</span>User:<span class="w"> </span><span class="m">18</span>.3<span class="w"> </span>ms,<span class="w"> </span>System:<span class="w"> </span><span class="m">6</span>.6<span class="w"> </span>ms<span class="o">]</span>
<span class="w">  </span>Range<span class="w"> </span><span class="o">(</span>min<span class="w"> </span>…<span class="w"> </span>max<span class="o">)</span>:<span class="w">    </span><span class="m">25</span>.0<span class="w"> </span>ms<span class="w"> </span>…<span class="w">  </span><span class="m">26</span>.2<span class="w"> </span>ms<span class="w">    </span><span class="m">30</span><span class="w"> </span>runs

Summary
<span class="w">  </span>./zig-out/bin/roc<span class="w"> </span>format<span class="w"> </span>/tmp/new<span class="w"> </span>ran
<span class="w">   </span><span class="m">11</span>.62<span class="w"> </span>±<span class="w"> </span><span class="m">0</span>.12<span class="w"> </span><span class="nb">times</span><span class="w"> </span>faster<span class="w"> </span>than<span class="w"> </span>roc<span class="w"> </span>format<span class="w"> </span>/tmp/old
</code></pre></div>
</div></div>
<div class="spoiler-block"><div class="spoiler-header">
<p>X86 Linux</p>
</div><div class="spoiler-content" aria-hidden="true">
<div class="codehilite" data-code-language="Bash"><pre><span></span><code><span class="w"> </span>hyperfine<span class="w"> </span>--prepare<span class="w"> </span><span class="s1">'sync; echo 3 | sudo tee /proc/sys/vm/drop_caches'</span><span class="w"> </span>-w<span class="w"> </span><span class="m">5</span><span class="w"> </span>-r<span class="w"> </span><span class="m">30</span><span class="w"> </span><span class="s2">"./target/release/roc format /tmp/old"</span><span class="w"> </span><span class="s2">"./zig-out/bin/roc format /tmp/new"</span>
Benchmark<span class="w"> </span><span class="m">1</span>:<span class="w"> </span>./target/release/roc<span class="w"> </span>format<span class="w"> </span>/tmp/old
<span class="w">  </span>Time<span class="w"> </span><span class="o">(</span>mean<span class="w"> </span>±<span class="w"> </span>σ<span class="o">)</span>:<span class="w">     </span><span class="m">585</span>.9<span class="w"> </span>ms<span class="w"> </span>±<span class="w">  </span><span class="m">59</span>.5<span class="w"> </span>ms<span class="w">    </span><span class="o">[</span>User:<span class="w"> </span><span class="m">431</span>.7<span class="w"> </span>ms,<span class="w"> </span>System:<span class="w"> </span><span class="m">152</span>.9<span class="w"> </span>ms<span class="o">]</span>
<span class="w">  </span>Range<span class="w"> </span><span class="o">(</span>min<span class="w"> </span>…<span class="w"> </span>max<span class="o">)</span>:<span class="w">   </span><span class="m">453</span>.3<span class="w"> </span>ms<span class="w"> </span>…<span class="w"> </span><span class="m">713</span>.7<span class="w"> </span>ms<span class="w">    </span><span class="m">30</span><span class="w"> </span>runs

Benchmark<span class="w"> </span><span class="m">2</span>:<span class="w"> </span>./zig-out/bin/roc<span class="w"> </span>format<span class="w"> </span>/tmp/new
<span class="w">  </span>Time<span class="w"> </span><span class="o">(</span>mean<span class="w"> </span>±<span class="w"> </span>σ<span class="o">)</span>:<span class="w">      </span><span class="m">85</span>.0<span class="w"> </span>ms<span class="w"> </span>±<span class="w">   </span><span class="m">2</span>.1<span class="w"> </span>ms<span class="w">    </span><span class="o">[</span>User:<span class="w"> </span><span class="m">46</span>.0<span class="w"> </span>ms,<span class="w"> </span>System:<span class="w"> </span><span class="m">37</span>.8<span class="w"> </span>ms<span class="o">]</span>
<span class="w">  </span>Range<span class="w"> </span><span class="o">(</span>min<span class="w"> </span>…<span class="w"> </span>max<span class="o">)</span>:<span class="w">    </span><span class="m">82</span>.8<span class="w"> </span>ms<span class="w"> </span>…<span class="w">  </span><span class="m">92</span>.3<span class="w"> </span>ms<span class="w">    </span><span class="m">30</span><span class="w"> </span>runs

<span class="w">  </span>Warning:<span class="w"> </span>Statistical<span class="w"> </span>outliers<span class="w"> </span>were<span class="w"> </span>detected.<span class="w"> </span>Consider<span class="w"> </span>re-running<span class="w"> </span>this<span class="w"> </span>benchmark<span class="w"> </span>on<span class="w"> </span>a<span class="w"> </span>quiet<span class="w"> </span>system<span class="w"> </span>without<span class="w"> </span>any<span class="w"> </span>interferences<span class="w"> </span>from<span class="w"> </span>other<span class="w"> </span>programs.

Summary
<span class="w">  </span>./zig-out/bin/roc<span class="w"> </span>format<span class="w"> </span>/tmp/new<span class="w"> </span>ran
<span class="w">    </span><span class="m">6</span>.89<span class="w"> </span>±<span class="w"> </span><span class="m">0</span>.72<span class="w"> </span><span class="nb">times</span><span class="w"> </span>faster<span class="w"> </span>than<span class="w"> </span>./target/release/roc<span class="w"> </span>format<span class="w"> </span>/tmp/old
</code></pre></div>
</div></div>



<a name="505822683"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/505822683" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#505822683">(Mar 15 2025 at 07:59)</a>:</h4>
<p>Note, the old compiler does have a big disadvantage that it is way larger and loads slower. That said, this is parsing and formatting 100 files with ~1000 lines (24kb each), so I don't think load time should be a big factor.</p>



<a name="505822703"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/505822703" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#505822703">(Mar 15 2025 at 08:00)</a>:</h4>
<div class="spoiler-block"><div class="spoiler-header">
<p>more stats via poop</p>
</div><div class="spoiler-content" aria-hidden="true">
<p>Note: this is with a hot cache unlike hyperfine</p>
<div class="codehilite" data-code-language="Bash"><pre><span></span><code>Benchmark<span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="o">(</span><span class="m">11</span><span class="w"> </span>runs<span class="o">)</span>:<span class="w"> </span>./target/release/roc<span class="w"> </span>format<span class="w"> </span>/tmp/old
<span class="w">  </span>measurement<span class="w">          </span>mean<span class="w"> </span>±<span class="w"> </span>σ<span class="w">            </span>min<span class="w"> </span>…<span class="w"> </span>max<span class="w">           </span>outliers<span class="w">         </span>delta
<span class="w">  </span>wall_time<span class="w">           </span>468ms<span class="w"> </span>±<span class="w"> </span><span class="m">16</span>.5ms<span class="w">     </span>447ms<span class="w"> </span>…<span class="w">  </span>493ms<span class="w">          </span><span class="m">0</span><span class="w"> </span><span class="o">(</span><span class="w"> </span><span class="m">0</span>%<span class="o">)</span><span class="w">        </span><span class="m">0</span>%
<span class="w">  </span>peak_rss<span class="w">            </span>424MB<span class="w"> </span>±<span class="w"> </span><span class="m">53</span>.6KB<span class="w">     </span>424MB<span class="w"> </span>…<span class="w">  </span>424MB<span class="w">          </span><span class="m">2</span><span class="w"> </span><span class="o">(</span><span class="m">18</span>%<span class="o">)</span><span class="w">        </span><span class="m">0</span>%
<span class="w">  </span>cpu_cycles<span class="w">         </span><span class="m">1</span>.65G<span class="w">  </span>±<span class="w"> </span><span class="m">58</span>.9M<span class="w">     </span><span class="m">1</span>.59G<span class="w">  </span>…<span class="w"> </span><span class="m">1</span>.81G<span class="w">           </span><span class="m">1</span><span class="w"> </span><span class="o">(</span><span class="w"> </span><span class="m">9</span>%<span class="o">)</span><span class="w">        </span><span class="m">0</span>%
<span class="w">  </span>instructions<span class="w">       </span><span class="m">3</span>.06G<span class="w">  </span>±<span class="w"> </span><span class="m">4</span>.56K<span class="w">     </span><span class="m">3</span>.06G<span class="w">  </span>…<span class="w"> </span><span class="m">3</span>.06G<span class="w">           </span><span class="m">0</span><span class="w"> </span><span class="o">(</span><span class="w"> </span><span class="m">0</span>%<span class="o">)</span><span class="w">        </span><span class="m">0</span>%
<span class="w">  </span>cache_references<span class="w">   </span><span class="m">53</span>.4M<span class="w">  </span>±<span class="w"> </span><span class="m">1</span>.36M<span class="w">     </span><span class="m">51</span>.1M<span class="w">  </span>…<span class="w"> </span><span class="m">55</span>.1M<span class="w">           </span><span class="m">0</span><span class="w"> </span><span class="o">(</span><span class="w"> </span><span class="m">0</span>%<span class="o">)</span><span class="w">        </span><span class="m">0</span>%
<span class="w">  </span>cache_misses<span class="w">       </span><span class="m">5</span>.09M<span class="w">  </span>±<span class="w">  </span>137K<span class="w">     </span><span class="m">4</span>.84M<span class="w">  </span>…<span class="w"> </span><span class="m">5</span>.30M<span class="w">           </span><span class="m">0</span><span class="w"> </span><span class="o">(</span><span class="w"> </span><span class="m">0</span>%<span class="o">)</span><span class="w">        </span><span class="m">0</span>%
<span class="w">  </span>branch_misses<span class="w">      </span><span class="m">6</span>.94M<span class="w">  </span>±<span class="w"> </span><span class="m">1</span>.69M<span class="w">     </span><span class="m">5</span>.48M<span class="w">  </span>…<span class="w"> </span><span class="m">11</span>.7M<span class="w">           </span><span class="m">1</span><span class="w"> </span><span class="o">(</span><span class="w"> </span><span class="m">9</span>%<span class="o">)</span><span class="w">        </span><span class="m">0</span>%
Benchmark<span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="o">(</span><span class="m">57</span><span class="w"> </span>runs<span class="o">)</span>:<span class="w"> </span>./zig-out/bin/roc<span class="w"> </span>format<span class="w"> </span>/tmp/new
<span class="w">  </span>measurement<span class="w">          </span>mean<span class="w"> </span>±<span class="w"> </span>σ<span class="w">            </span>min<span class="w"> </span>…<span class="w"> </span>max<span class="w">           </span>outliers<span class="w">         </span>delta
<span class="w">  </span>wall_time<span class="w">          </span><span class="m">87</span>.2ms<span class="w"> </span>±<span class="w"> </span><span class="m">2</span>.76ms<span class="w">    </span><span class="m">83</span>.1ms<span class="w"> </span>…<span class="w"> </span><span class="m">93</span>.1ms<span class="w">          </span><span class="m">0</span><span class="w"> </span><span class="o">(</span><span class="w"> </span><span class="m">0</span>%<span class="o">)</span><span class="w">        </span>⚡-<span class="w"> </span><span class="m">81</span>.4%<span class="w"> </span>±<span class="w">  </span><span class="m">1</span>.0%
<span class="w">  </span>peak_rss<span class="w">            </span>901KB<span class="w"> </span>±<span class="w">    </span><span class="m">0</span><span class="w">       </span>901KB<span class="w"> </span>…<span class="w">  </span>901KB<span class="w">          </span><span class="m">0</span><span class="w"> </span><span class="o">(</span><span class="w"> </span><span class="m">0</span>%<span class="o">)</span><span class="w">        </span>⚡-<span class="w"> </span><span class="m">99</span>.8%<span class="w"> </span>±<span class="w">  </span><span class="m">0</span>.0%
<span class="w">  </span>cpu_cycles<span class="w">          </span>172M<span class="w">  </span>±<span class="w"> </span><span class="m">10</span>.3M<span class="w">      </span>155M<span class="w">  </span>…<span class="w">  </span>191M<span class="w">           </span><span class="m">0</span><span class="w"> </span><span class="o">(</span><span class="w"> </span><span class="m">0</span>%<span class="o">)</span><span class="w">        </span>⚡-<span class="w"> </span><span class="m">89</span>.6%<span class="w"> </span>±<span class="w">  </span><span class="m">1</span>.0%
<span class="w">  </span>instructions<span class="w">        </span>321M<span class="w">  </span>±<span class="w">  </span><span class="m">940</span><span class="w">       </span>321M<span class="w">  </span>…<span class="w">  </span>321M<span class="w">           </span><span class="m">0</span><span class="w"> </span><span class="o">(</span><span class="w"> </span><span class="m">0</span>%<span class="o">)</span><span class="w">        </span>⚡-<span class="w"> </span><span class="m">89</span>.5%<span class="w"> </span>±<span class="w">  </span><span class="m">0</span>.0%
<span class="w">  </span>cache_references<span class="w">   </span><span class="m">2</span>.94M<span class="w">  </span>±<span class="w">  </span>103K<span class="w">     </span><span class="m">2</span>.76M<span class="w">  </span>…<span class="w"> </span><span class="m">3</span>.13M<span class="w">           </span><span class="m">0</span><span class="w"> </span><span class="o">(</span><span class="w"> </span><span class="m">0</span>%<span class="o">)</span><span class="w">        </span>⚡-<span class="w"> </span><span class="m">94</span>.5%<span class="w"> </span>±<span class="w">  </span><span class="m">0</span>.7%
<span class="w">  </span>cache_misses<span class="w">       </span><span class="m">1</span>.95K<span class="w">  </span>±<span class="w">  </span><span class="m">536</span><span class="w">      </span><span class="m">1</span>.42K<span class="w">  </span>…<span class="w"> </span><span class="m">4</span>.87K<span class="w">           </span><span class="m">7</span><span class="w"> </span><span class="o">(</span><span class="m">12</span>%<span class="o">)</span><span class="w">        </span>⚡-100.0%<span class="w"> </span>±<span class="w">  </span><span class="m">0</span>.7%
<span class="w">  </span>branch_misses<span class="w">      </span><span class="m">1</span>.15M<span class="w">  </span>±<span class="w">  </span>176K<span class="w">      </span>875K<span class="w">  </span>…<span class="w"> </span><span class="m">1</span>.49M<span class="w">           </span><span class="m">0</span><span class="w"> </span><span class="o">(</span><span class="w"> </span><span class="m">0</span>%<span class="o">)</span><span class="w">        </span>⚡-<span class="w"> </span><span class="m">83</span>.4%<span class="w"> </span>±<span class="w">  </span><span class="m">6</span>.4%
</code></pre></div>
</div></div>



<a name="505822955"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/505822955" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#505822955">(Mar 15 2025 at 08:02)</a>:</h4>
<p>Aside, despite using 99% less memory to parse a file, I am still stunned how much memory we use. In an allocation tracking profiler, I see ~10x memory usage compared to source file size.... Actually, that makes a lot of sense. All tokens take up 12bytes. Which is ~10x more than the single byte a token takes up in the original source file.</p>



<a name="505823058"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/505823058" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#505823058">(Mar 15 2025 at 08:04)</a>:</h4>
<p>I guess this is way we may not want to store the tag or length of tokens. Saves a ton of memory and retokenizing is theoretically super fast.</p>



<a name="505823158"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/505823158" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#505823158">(Mar 15 2025 at 08:05)</a>:</h4>
<p>Also cc <span class="user-mention" data-user-id="406911">@Andrew Kelley</span> cause I know you were interesting in what perf numbers we get with the new compiler. As said, very preliminary numbers, but the parse to format loop looks to be 5 to 10x faster with 500x less memory usage.</p>



<a name="505823853"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/505823853" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#505823853">(Mar 15 2025 at 08:15)</a>:</h4>
<p>Ah, I think I found some of the discrepancy. The old compiler has extra checks to ensure that formatting is stable and not bugged. I need to disable those and see what cost savings it gets.</p>



<a name="505824596"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/505824596" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#505824596">(Mar 15 2025 at 08:26)</a>:</h4>
<p>Ok, disabled all the extra reformatting and validation logic. So both codebases are just doing their parse to format loop. So should be more apples to apples now. We are still 3 to 5x faster with the new compiler (and 200x less memory).</p>
<div class="spoiler-block"><div class="spoiler-header">
<p>M1 Mac</p>
</div><div class="spoiler-content" aria-hidden="true">
<div class="codehilite" data-code-language="Bash"><pre><span></span><code>hyperfine<span class="w"> </span>-N<span class="w"> </span>-w<span class="w"> </span><span class="m">5</span><span class="w"> </span>-r<span class="w"> </span><span class="m">30</span><span class="w"> </span>--prepare<span class="w"> </span><span class="s1">'sync &amp;&amp; sudo purge'</span><span class="w"> </span><span class="s2">"roc format /tmp/old"</span><span class="w"> </span><span class="s2">"./zig-out/bin/roc format /tmp/new"</span>
Benchmark<span class="w"> </span><span class="m">1</span>:<span class="w"> </span>roc<span class="w"> </span>format<span class="w"> </span>/tmp/old
<span class="w">  </span>Time<span class="w"> </span><span class="o">(</span>mean<span class="w"> </span>±<span class="w"> </span>σ<span class="o">)</span>:<span class="w">     </span><span class="m">123</span>.8<span class="w"> </span>ms<span class="w"> </span>±<span class="w">   </span><span class="m">0</span>.6<span class="w"> </span>ms<span class="w">    </span><span class="o">[</span>User:<span class="w"> </span><span class="m">97</span>.7<span class="w"> </span>ms,<span class="w"> </span>System:<span class="w"> </span><span class="m">22</span>.8<span class="w"> </span>ms<span class="o">]</span>
<span class="w">  </span>Range<span class="w"> </span><span class="o">(</span>min<span class="w"> </span>…<span class="w"> </span>max<span class="o">)</span>:<span class="w">   </span><span class="m">122</span>.8<span class="w"> </span>ms<span class="w"> </span>…<span class="w"> </span><span class="m">125</span>.0<span class="w"> </span>ms<span class="w">    </span><span class="m">30</span><span class="w"> </span>runs

Benchmark<span class="w"> </span><span class="m">2</span>:<span class="w"> </span>./zig-out/bin/roc<span class="w"> </span>format<span class="w"> </span>/tmp/new
<span class="w">  </span>Time<span class="w"> </span><span class="o">(</span>mean<span class="w"> </span>±<span class="w"> </span>σ<span class="o">)</span>:<span class="w">      </span><span class="m">25</span>.8<span class="w"> </span>ms<span class="w"> </span>±<span class="w">   </span><span class="m">1</span>.0<span class="w"> </span>ms<span class="w">    </span><span class="o">[</span>User:<span class="w"> </span><span class="m">18</span>.5<span class="w"> </span>ms,<span class="w"> </span>System:<span class="w"> </span><span class="m">6</span>.6<span class="w"> </span>ms<span class="o">]</span>
<span class="w">  </span>Range<span class="w"> </span><span class="o">(</span>min<span class="w"> </span>…<span class="w"> </span>max<span class="o">)</span>:<span class="w">    </span><span class="m">25</span>.2<span class="w"> </span>ms<span class="w"> </span>…<span class="w">  </span><span class="m">30</span>.9<span class="w"> </span>ms<span class="w">    </span><span class="m">30</span><span class="w"> </span>runs

<span class="w">  </span>Warning:<span class="w"> </span>Statistical<span class="w"> </span>outliers<span class="w"> </span>were<span class="w"> </span>detected.<span class="w"> </span>Consider<span class="w"> </span>re-running<span class="w"> </span>this<span class="w"> </span>benchmark<span class="w"> </span>on<span class="w"> </span>a<span class="w"> </span>quiet<span class="w"> </span>system<span class="w"> </span>without<span class="w"> </span>any<span class="w"> </span>interferences<span class="w"> </span>from<span class="w"> </span>other<span class="w"> </span>programs.

Summary
<span class="w">  </span>./zig-out/bin/roc<span class="w"> </span>format<span class="w"> </span>/tmp/new<span class="w"> </span>ran
<span class="w">    </span><span class="m">4</span>.79<span class="w"> </span>±<span class="w"> </span><span class="m">0</span>.18<span class="w"> </span><span class="nb">times</span><span class="w"> </span>faster<span class="w"> </span>than<span class="w"> </span>roc<span class="w"> </span>format<span class="w"> </span>/tmp/old
</code></pre></div>
</div></div>
<div class="spoiler-block"><div class="spoiler-header">
<p>X86 Linux</p>
</div><div class="spoiler-content" aria-hidden="true">
<div class="codehilite" data-code-language="Bash"><pre><span></span><code>hyperfine<span class="w"> </span>--prepare<span class="w"> </span><span class="s1">'sync; echo 3 | sudo tee /proc/sys/vm/drop_caches'</span><span class="w"> </span>-w<span class="w"> </span><span class="m">5</span><span class="w"> </span>-r<span class="w"> </span><span class="m">30</span><span class="w"> </span><span class="s2">"./target/release/roc format /tmp/old"</span><span class="w"> </span><span class="s2">"./zig-out/bin/roc format /tmp/new"</span>
Benchmark<span class="w"> </span><span class="m">1</span>:<span class="w"> </span>./target/release/roc<span class="w"> </span>format<span class="w"> </span>/tmp/old
<span class="w">  </span>Time<span class="w"> </span><span class="o">(</span>mean<span class="w"> </span>±<span class="w"> </span>σ<span class="o">)</span>:<span class="w">     </span><span class="m">305</span>.8<span class="w"> </span>ms<span class="w"> </span>±<span class="w">  </span><span class="m">12</span>.1<span class="w"> </span>ms<span class="w">    </span><span class="o">[</span>User:<span class="w"> </span><span class="m">144</span>.9<span class="w"> </span>ms,<span class="w"> </span>System:<span class="w"> </span><span class="m">160</span>.3<span class="w"> </span>ms<span class="o">]</span>
<span class="w">  </span>Range<span class="w"> </span><span class="o">(</span>min<span class="w"> </span>…<span class="w"> </span>max<span class="o">)</span>:<span class="w">   </span><span class="m">293</span>.8<span class="w"> </span>ms<span class="w"> </span>…<span class="w"> </span><span class="m">345</span>.9<span class="w"> </span>ms<span class="w">    </span><span class="m">30</span><span class="w"> </span>runs

Benchmark<span class="w"> </span><span class="m">2</span>:<span class="w"> </span>./zig-out/bin/roc<span class="w"> </span>format<span class="w"> </span>/tmp/new
<span class="w">  </span>Time<span class="w"> </span><span class="o">(</span>mean<span class="w"> </span>±<span class="w"> </span>σ<span class="o">)</span>:<span class="w">      </span><span class="m">84</span>.4<span class="w"> </span>ms<span class="w"> </span>±<span class="w">   </span><span class="m">1</span>.3<span class="w"> </span>ms<span class="w">    </span><span class="o">[</span>User:<span class="w"> </span><span class="m">44</span>.7<span class="w"> </span>ms,<span class="w"> </span>System:<span class="w"> </span><span class="m">38</span>.6<span class="w"> </span>ms<span class="o">]</span>
<span class="w">  </span>Range<span class="w"> </span><span class="o">(</span>min<span class="w"> </span>…<span class="w"> </span>max<span class="o">)</span>:<span class="w">    </span><span class="m">82</span>.9<span class="w"> </span>ms<span class="w"> </span>…<span class="w">  </span><span class="m">88</span>.8<span class="w"> </span>ms<span class="w">    </span><span class="m">30</span><span class="w"> </span>runs

<span class="w">  </span>Warning:<span class="w"> </span>Statistical<span class="w"> </span>outliers<span class="w"> </span>were<span class="w"> </span>detected.<span class="w"> </span>Consider<span class="w"> </span>re-running<span class="w"> </span>this<span class="w"> </span>benchmark<span class="w"> </span>on<span class="w"> </span>a<span class="w"> </span>quiet<span class="w"> </span>system<span class="w"> </span>without<span class="w"> </span>any<span class="w"> </span>interferences<span class="w"> </span>from<span class="w"> </span>other<span class="w"> </span>programs.

Summary
<span class="w">  </span>./zig-out/bin/roc<span class="w"> </span>format<span class="w"> </span>/tmp/new<span class="w"> </span>ran
<span class="w">    </span><span class="m">3</span>.63<span class="w"> </span>±<span class="w"> </span><span class="m">0</span>.15<span class="w"> </span><span class="nb">times</span><span class="w"> </span>faster<span class="w"> </span>than<span class="w"> </span>./target/release/roc<span class="w"> </span>format<span class="w"> </span>/tmp/old
</code></pre></div>
</div></div>



<a name="505824651"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/505824651" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#505824651">(Mar 15 2025 at 08:27)</a>:</h4>
<p>And detailed stats with poop still look great (this is with hot cache unlike the commands above).</p>
<div class="spoiler-block"><div class="spoiler-header">
<p>stats</p>
</div><div class="spoiler-content" aria-hidden="true">
<div class="codehilite" data-code-language="Bash"><pre><span></span><code>poop<span class="w"> </span><span class="s2">"./target/release/roc format /tmp/old"</span><span class="w"> </span><span class="s2">"./zig-out/bin/roc format /tmp/new"</span>
Benchmark<span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="o">(</span><span class="m">29</span><span class="w"> </span>runs<span class="o">)</span>:<span class="w"> </span>./target/release/roc<span class="w"> </span>format<span class="w"> </span>/tmp/old
<span class="w">  </span>measurement<span class="w">          </span>mean<span class="w"> </span>±<span class="w"> </span>σ<span class="w">            </span>min<span class="w"> </span>…<span class="w"> </span>max<span class="w">           </span>outliers<span class="w">         </span>delta
<span class="w">  </span>wall_time<span class="w">           </span>173ms<span class="w"> </span>±<span class="w"> </span><span class="m">25</span>.7ms<span class="w">     </span>159ms<span class="w"> </span>…<span class="w">  </span>303ms<span class="w">          </span><span class="m">2</span><span class="w"> </span><span class="o">(</span><span class="w"> </span><span class="m">7</span>%<span class="o">)</span><span class="w">        </span><span class="m">0</span>%
<span class="w">  </span>peak_rss<span class="w">            </span>195MB<span class="w"> </span>±<span class="w"> </span><span class="m">63</span>.1KB<span class="w">     </span>195MB<span class="w"> </span>…<span class="w">  </span>195MB<span class="w">          </span><span class="m">6</span><span class="w"> </span><span class="o">(</span><span class="m">21</span>%<span class="o">)</span><span class="w">        </span><span class="m">0</span>%
<span class="w">  </span>cpu_cycles<span class="w">          </span>573M<span class="w">  </span>±<span class="w"> </span><span class="m">17</span>.3M<span class="w">      </span>553M<span class="w">  </span>…<span class="w">  </span>630M<span class="w">           </span><span class="m">1</span><span class="w"> </span><span class="o">(</span><span class="w"> </span><span class="m">3</span>%<span class="o">)</span><span class="w">        </span><span class="m">0</span>%
<span class="w">  </span>instructions<span class="w">        </span>991M<span class="w">  </span>±<span class="w"> </span><span class="m">32</span>.9K<span class="w">      </span>991M<span class="w">  </span>…<span class="w">  </span>991M<span class="w">           </span><span class="m">0</span><span class="w"> </span><span class="o">(</span><span class="w"> </span><span class="m">0</span>%<span class="o">)</span><span class="w">        </span><span class="m">0</span>%
<span class="w">  </span>cache_references<span class="w">   </span><span class="m">19</span>.3M<span class="w">  </span>±<span class="w">  </span>532K<span class="w">     </span><span class="m">18</span>.3M<span class="w">  </span>…<span class="w"> </span><span class="m">20</span>.7M<span class="w">           </span><span class="m">1</span><span class="w"> </span><span class="o">(</span><span class="w"> </span><span class="m">3</span>%<span class="o">)</span><span class="w">        </span><span class="m">0</span>%
<span class="w">  </span>cache_misses<span class="w">       </span><span class="m">1</span>.51M<span class="w">  </span>±<span class="w"> </span><span class="m">61</span>.0K<span class="w">     </span><span class="m">1</span>.36M<span class="w">  </span>…<span class="w"> </span><span class="m">1</span>.64M<span class="w">           </span><span class="m">1</span><span class="w"> </span><span class="o">(</span><span class="w"> </span><span class="m">3</span>%<span class="o">)</span><span class="w">        </span><span class="m">0</span>%
<span class="w">  </span>branch_misses<span class="w">      </span><span class="m">2</span>.18M<span class="w">  </span>±<span class="w">  </span>488K<span class="w">     </span><span class="m">1</span>.62M<span class="w">  </span>…<span class="w"> </span><span class="m">3</span>.50M<span class="w">           </span><span class="m">0</span><span class="w"> </span><span class="o">(</span><span class="w"> </span><span class="m">0</span>%<span class="o">)</span><span class="w">        </span><span class="m">0</span>%
Benchmark<span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="o">(</span><span class="m">56</span><span class="w"> </span>runs<span class="o">)</span>:<span class="w"> </span>./zig-out/bin/roc<span class="w"> </span>format<span class="w"> </span>/tmp/new
<span class="w">  </span>measurement<span class="w">          </span>mean<span class="w"> </span>±<span class="w"> </span>σ<span class="w">            </span>min<span class="w"> </span>…<span class="w"> </span>max<span class="w">           </span>outliers<span class="w">         </span>delta
<span class="w">  </span>wall_time<span class="w">          </span><span class="m">87</span>.8ms<span class="w"> </span>±<span class="w"> </span><span class="m">2</span>.87ms<span class="w">    </span><span class="m">82</span>.4ms<span class="w"> </span>…<span class="w"> </span><span class="m">94</span>.4ms<span class="w">          </span><span class="m">0</span><span class="w"> </span><span class="o">(</span><span class="w"> </span><span class="m">0</span>%<span class="o">)</span><span class="w">        </span>⚡-<span class="w"> </span><span class="m">49</span>.2%<span class="w"> </span>±<span class="w">  </span><span class="m">4</span>.0%
<span class="w">  </span>peak_rss<span class="w">            </span>889KB<span class="w"> </span>±<span class="w">    </span><span class="m">0</span><span class="w">       </span>889KB<span class="w"> </span>…<span class="w">  </span>889KB<span class="w">          </span><span class="m">0</span><span class="w"> </span><span class="o">(</span><span class="w"> </span><span class="m">0</span>%<span class="o">)</span><span class="w">        </span>⚡-<span class="w"> </span><span class="m">99</span>.5%<span class="w"> </span>±<span class="w">  </span><span class="m">0</span>.0%
<span class="w">  </span>cpu_cycles<span class="w">          </span>173M<span class="w">  </span>±<span class="w"> </span><span class="m">10</span>.9M<span class="w">      </span>156M<span class="w">  </span>…<span class="w">  </span>199M<span class="w">           </span><span class="m">0</span><span class="w"> </span><span class="o">(</span><span class="w"> </span><span class="m">0</span>%<span class="o">)</span><span class="w">        </span>⚡-<span class="w"> </span><span class="m">69</span>.9%<span class="w"> </span>±<span class="w">  </span><span class="m">1</span>.1%
<span class="w">  </span>instructions<span class="w">        </span>321M<span class="w">  </span>±<span class="w">  </span><span class="m">949</span><span class="w">       </span>321M<span class="w">  </span>…<span class="w">  </span>321M<span class="w">           </span><span class="m">0</span><span class="w"> </span><span class="o">(</span><span class="w"> </span><span class="m">0</span>%<span class="o">)</span><span class="w">        </span>⚡-<span class="w"> </span><span class="m">67</span>.6%<span class="w"> </span>±<span class="w">  </span><span class="m">0</span>.0%
<span class="w">  </span>cache_references<span class="w">   </span><span class="m">3</span>.02M<span class="w">  </span>±<span class="w"> </span><span class="m">95</span>.1K<span class="w">     </span><span class="m">2</span>.85M<span class="w">  </span>…<span class="w"> </span><span class="m">3</span>.30M<span class="w">           </span><span class="m">0</span><span class="w"> </span><span class="o">(</span><span class="w"> </span><span class="m">0</span>%<span class="o">)</span><span class="w">        </span>⚡-<span class="w"> </span><span class="m">84</span>.3%<span class="w"> </span>±<span class="w">  </span><span class="m">0</span>.8%
<span class="w">  </span>cache_misses<span class="w">       </span><span class="m">2</span>.10K<span class="w">  </span>±<span class="w"> </span><span class="m">1</span>.15K<span class="w">     </span><span class="m">1</span>.32K<span class="w">  </span>…<span class="w"> </span><span class="m">9</span>.53K<span class="w">           </span><span class="m">6</span><span class="w"> </span><span class="o">(</span><span class="m">11</span>%<span class="o">)</span><span class="w">        </span>⚡-<span class="w"> </span><span class="m">99</span>.9%<span class="w"> </span>±<span class="w">  </span><span class="m">1</span>.1%
<span class="w">  </span>branch_misses<span class="w">      </span><span class="m">1</span>.17M<span class="w">  </span>±<span class="w">  </span>183K<span class="w">      </span>896K<span class="w">  </span>…<span class="w"> </span><span class="m">1</span>.61M<span class="w">           </span><span class="m">0</span><span class="w"> </span><span class="o">(</span><span class="w"> </span><span class="m">0</span>%<span class="o">)</span><span class="w">        </span>⚡-<span class="w"> </span><span class="m">46</span>.2%<span class="w"> </span>±<span class="w">  </span><span class="m">6</span>.7%
</code></pre></div>
</div></div>



<a name="505824666"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/505824666" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#505824666">(Mar 15 2025 at 08:27)</a>:</h4>
<p>And we haven't even looked at SIMD yet!</p>



<a name="505824777"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/505824777" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#505824777">(Mar 15 2025 at 08:28)</a>:</h4>
<p>Also, about half of execution time is spent in tokenizing, quarter in parsing, and quarter in formatting.</p>



<a name="505846553"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/505846553" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#505846553">(Mar 15 2025 at 13:06)</a>:</h4>
<p>wowwww, this is great!</p>



<a name="505846622"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/505846622" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#505846622">(Mar 15 2025 at 13:07)</a>:</h4>
<p>I'm personally excited that half is tokenizing - means the simd style might actually have a benefit beyond being fun to try implementing <span aria-label="grinning face with smiling eyes" class="emoji emoji-1f601" role="img" title="grinning face with smiling eyes">:grinning_face_with_smiling_eyes:</span></p>



<a name="505846933"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/505846933" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#505846933">(Mar 15 2025 at 13:11)</a>:</h4>
<p>RIIZ <span aria-label="high voltage" class="emoji emoji-26a1" role="img" title="high voltage">:high_voltage:</span></p>



<a name="505847208"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/505847208" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#505847208">(Mar 15 2025 at 13:14)</a>:</h4>
<p>are we missing any parsing features that might make it apples-to-oranges?</p>



<a name="505847246"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/505847246" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#505847246">(Mar 15 2025 at 13:15)</a>:</h4>
<p>(aside from deprecated things not needing to be parsed of course)</p>



<a name="505847275"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/505847275" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#505847275">(Mar 15 2025 at 13:15)</a>:</h4>
<p>or is parsing feature-complete at this point?</p>



<a name="505857740"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/505857740" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#505857740">(Mar 15 2025 at 15:23)</a>:</h4>
<p>We definitely aren't at parity in terms of edge cases, error handling, and comments, but the syntax grab bag looked featureful enough that it seemed worth testing:<br>
<a href="https://github.com/roc-lang/roc/blob/327647a6161b96d06f6524ee393ab675c2fc1335/src/fmt.zig#L938">https://github.com/roc-lang/roc/blob/327647a6161b96d06f6524ee393ab675c2fc1335/src/fmt.zig#L938</a></p>



<a name="505877686"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/505877686" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#505877686">(Mar 15 2025 at 19:22)</a>:</h4>
<p>Extra note, with a tiny bit of allocation tuning (initCapacity instead of starting empty), we can get another ~9% faster. Not allocating and copying during tokenization by allocating a large array can make tokenization 1.5x faster.</p>



<a name="505877816"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/505877816" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#505877816">(Mar 15 2025 at 19:24)</a>:</h4>
<p>That said, this is with overallocating to ensure space for all tokens...might not be worth it memory wise. Really depends on average number of characters per token as to what the default should be. And that depends on how many comments someone has among other things like variable name length.</p>



<a name="506120260"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/506120260" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#506120260">(Mar 17 2025 at 11:20)</a>:</h4>
<p>I didn't realize this thing I'm writing is THAT fast</p>



<a name="506120350"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/506120350" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#506120350">(Mar 17 2025 at 11:21)</a>:</h4>
<p>I haven't even optimized for performance besides the memory-locality stuff</p>



<a name="506120531"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/506120531" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#506120531">(Mar 17 2025 at 11:21)</a>:</h4>
<p>I would love to see us do SIMD tokenization</p>



<a name="506120672"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/506120672" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#506120672">(Mar 17 2025 at 11:22)</a>:</h4>
<p>Let's hope we can get similar speed-ups in the more compute heavy parts of the compiler!</p>



<a name="506122564"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/506122564" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#506122564">(Mar 17 2025 at 11:30)</a>:</h4>
<p>You can really see the advantages of the SoA architecture in the HUGE delta in cache misses.  That's three orders of magnitude fewer!</p>



<a name="506205219"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/506205219" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#506205219">(Mar 17 2025 at 16:34)</a>:</h4>
<p>Yeah, simply using less memory and allocating less does a metric ton.</p>
<p>The old compiler does ~30x more allocations (presumably of many tiny IR nodes). I'm actually a bit surprised it is so bad in the old compiler. I thought we put all that stuff in arenas, but apparently tons of stuff is not in the arenas. Then as you mention, DOD + SOA leads to way less memory usage in general which equates to way more cache hits.</p>
<p>And yeah, we have room for many optimizations.</p>



<a name="506213561"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/506213561" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Warner <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#506213561">(Mar 17 2025 at 17:09)</a>:</h4>
<p>In the old compiler, Defs has a bunch of Vecs that are not in the arenas</p>



<a name="506213643"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/506213643" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Warner <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#506213643">(Mar 17 2025 at 17:09)</a>:</h4>
<p>In fact, I'm pretty confident that was a memory leak</p>



<a name="506861816"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/506861816" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Warner <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#506861816">(Mar 20 2025 at 01:59)</a>:</h4>
<p>The new parser currently expects this syntax:</p>
<div class="codehilite"><pre><span></span><code>Map a b : List(a), (a -&gt; b) -&gt; List(b)
</code></pre></div>
<p>... but with PNC I would expect that to be:</p>
<div class="codehilite"><pre><span></span><code>Map(a, b) : List(a), (a -&gt; b) -&gt; List(b)
</code></pre></div>
<p>... no?</p>



<a name="507071945"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/507071945" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Andrew Kelley <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#507071945">(Mar 20 2025 at 20:48)</a>:</h4>
<p><span class="user-mention silent" data-user-id="343810">Brendan Hansknecht</span> <a href="#narrow/channel/395097-compiler-development/topic/zig.20compiler.20-.20parser/near/505823158">said</a>:</p>
<blockquote>
<p>Also cc <span class="user-mention silent" data-user-id="406911">Andrew Kelley</span> cause I know you were interesting in what perf numbers we get with the new compiler. As said, very preliminary numbers, but the parse to format loop looks to be 5 to 10x faster with 500x less memory usage.</p>
</blockquote>
<p>very cool, thanks for sharing!</p>



<a name="507072187"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/507072187" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Warner <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#507072187">(Mar 20 2025 at 20:49)</a>:</h4>
<p>FWIW, part of the difference there is we're actually parsing a different (simpler) language now</p>



<a name="507072666"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/507072666" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Andrew Kelley <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#507072666">(Mar 20 2025 at 20:52)</a>:</h4>
<p>I like to think that there's a relationship between syntax being simpler for the computer and also being simpler for the human to parse</p>



<a name="507086371"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/507086371" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#507086371">(Mar 20 2025 at 22:25)</a>:</h4>
<p><span class="user-mention silent" data-user-id="453336">Joshua Warner</span> <a href="#narrow/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser/near/507072187">said</a>:</p>
<blockquote>
<p>FWIW, part of the difference there is we're actually parsing a different (simpler) language now</p>
</blockquote>
<p>Yeah, it is a whole mix of things. I would guess the biggest gain is in terms of memory usage and allocations. The sheer amount of data being generated and processed by the old compiler almost certainly is the bottleneck. Even if we changed the grammar, I would expect the allocations, data movement, and cache misses to dominate.</p>



<a name="508487815"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/508487815" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#508487815">(Mar 27 2025 at 11:17)</a>:</h4>
<p>After <a href="https://github.com/roc-lang/roc/pull/7695">#7695</a> lands, this shows all of the syntax that will be parsed and formatted correctly (in this exact style):</p>
<div class="codehilite" data-code-language="Zig"><pre><span></span><code><span class="k">try</span><span class="w"> </span><span class="n">moduleFmtsSame</span><span class="p">(</span>
<span class="w">        </span><span class="sh">\\# This is a module comment!</span>
<span class="w">        </span><span class="sh">\\app [main!] { pf: platform "../basic-cli/platform.roc" }</span>
<span class="w">        </span><span class="sh">\\</span>
<span class="w">        </span><span class="sh">\\import pf.Stdout exposing [line!, write!]</span>
<span class="w">        </span><span class="sh">\\</span>
<span class="w">        </span><span class="sh">\\import # Comment after import keyword</span>
<span class="w">        </span><span class="sh">\\    pf # Comment after qualifier</span>
<span class="w">        </span><span class="sh">\\        .StdoutMultiline # Comment after ident</span>
<span class="w">        </span><span class="sh">\\        exposing [ # Comment after exposing open</span>
<span class="w">        </span><span class="sh">\\            line!, # Comment after exposed item</span>
<span class="w">        </span><span class="sh">\\            write!, # Another after exposed item</span>
<span class="w">        </span><span class="sh">\\        ] # Comment after exposing close</span>
<span class="w">        </span><span class="sh">\\</span>
<span class="w">        </span><span class="sh">\\import pkg.Something exposing [func as function, Type as ValueCategory, Custom.*]</span>
<span class="w">        </span><span class="sh">\\</span>
<span class="w">        </span><span class="sh">\\import BadName as GoodName</span>
<span class="w">        </span><span class="sh">\\import</span>
<span class="w">        </span><span class="sh">\\    BadNameMultiline</span>
<span class="w">        </span><span class="sh">\\        as</span>
<span class="w">        </span><span class="sh">\\        GoodNameMultiline</span>
<span class="w">        </span><span class="sh">\\</span>
<span class="w">        </span><span class="sh">\\Map a b : List(a), (a -&gt; b) -&gt; List(b)</span>
<span class="w">        </span><span class="sh">\\MapML # Comment here</span>
<span class="w">        </span><span class="sh">\\    a # And here</span>
<span class="w">        </span><span class="sh">\\    b # And after the last arg</span>
<span class="w">        </span><span class="sh">\\        : # And after the colon</span>
<span class="w">        </span><span class="sh">\\            List( # Inside Tag args</span>
<span class="w">        </span><span class="sh">\\                a, # After tag arg</span>
<span class="w">        </span><span class="sh">\\            ),</span>
<span class="w">        </span><span class="sh">\\            (a -&gt; b) -&gt; # After arrow</span>
<span class="w">        </span><span class="sh">\\                List( # Inside tag args</span>
<span class="w">        </span><span class="sh">\\                    b,</span>
<span class="w">        </span><span class="sh">\\                ) # And after the type decl</span>
<span class="w">        </span><span class="sh">\\</span>
<span class="w">        </span><span class="sh">\\Foo : (Bar, Baz)</span>
<span class="w">        </span><span class="sh">\\</span>
<span class="w">        </span><span class="sh">\\FooMultiline : ( # Comment after pattern tuple open</span>
<span class="w">        </span><span class="sh">\\    Bar, # Comment after pattern tuple item</span>
<span class="w">        </span><span class="sh">\\    Baz, # Another after pattern tuple item</span>
<span class="w">        </span><span class="sh">\\) # Comment after pattern tuple close</span>
<span class="w">        </span><span class="sh">\\</span>
<span class="w">        </span><span class="sh">\\Some a : { foo : Ok(a), bar : Something }</span>
<span class="w">        </span><span class="sh">\\SomeMl a : { # After record open</span>
<span class="w">        </span><span class="sh">\\    foo : Ok(a), # After field</span>
<span class="w">        </span><span class="sh">\\    bar : Something, # After last field</span>
<span class="w">        </span><span class="sh">\\}</span>
<span class="w">        </span><span class="sh">\\</span>
<span class="w">        </span><span class="sh">\\SomeMultiline a : { # Comment after pattern record open</span>
<span class="w">        </span><span class="sh">\\    foo # After field name</span>
<span class="w">        </span><span class="sh">\\        : # Before field anno</span>
<span class="w">        </span><span class="sh">\\            Ok(a), # Comment after pattern record field</span>
<span class="w">        </span><span class="sh">\\    bar : Something, # Another after pattern record field</span>
<span class="w">        </span><span class="sh">\\} # Comment after pattern record close</span>
<span class="w">        </span><span class="sh">\\</span>
<span class="w">        </span><span class="sh">\\Maybe a : [Some(a), None]</span>
<span class="w">        </span><span class="sh">\\</span>
<span class="w">        </span><span class="sh">\\MaybeMultiline a : [ # Comment after tag union open</span>
<span class="w">        </span><span class="sh">\\    Some(a), # Comment after tag union member</span>
<span class="w">        </span><span class="sh">\\    None, # Another after tag union member</span>
<span class="w">        </span><span class="sh">\\] # Comment after tag union close</span>
<span class="w">        </span><span class="sh">\\</span>
<span class="w">        </span><span class="sh">\\SomeFunc a : Maybe(a), a -&gt; Maybe(a)</span>
<span class="w">        </span><span class="sh">\\</span>
<span class="w">        </span><span class="sh">\\add_one_oneline = |num| if num 2 else 5</span>
<span class="w">        </span><span class="sh">\\</span>
<span class="w">        </span><span class="sh">\\add_one : (U64 -&gt; U64)</span>
<span class="w">        </span><span class="sh">\\add_one = |num| {</span>
<span class="w">        </span><span class="sh">\\    other = 1</span>
<span class="w">        </span><span class="sh">\\    if num {</span>
<span class="w">        </span><span class="sh">\\        dbg # After debug</span>
<span class="w">        </span><span class="sh">\\            some_func() # After debug expr</span>
<span class="w">        </span><span class="sh">\\        0</span>
<span class="w">        </span><span class="sh">\\    } else {</span>
<span class="w">        </span><span class="sh">\\        dbg 123</span>
<span class="w">        </span><span class="sh">\\        other</span>
<span class="w">        </span><span class="sh">\\    }</span>
<span class="w">        </span><span class="sh">\\}</span>
<span class="w">        </span><span class="sh">\\</span>
<span class="w">        </span><span class="sh">\\match_time = |</span>
<span class="w">        </span><span class="sh">\\    a, # After arg</span>
<span class="w">        </span><span class="sh">\\    b,</span>
<span class="w">        </span><span class="sh">\\| # After args</span>
<span class="w">        </span><span class="sh">\\    match a {</span>
<span class="w">        </span><span class="sh">\\        Blue | Green | Red -&gt; {</span>
<span class="w">        </span><span class="sh">\\            x = 12</span>
<span class="w">        </span><span class="sh">\\            x</span>
<span class="w">        </span><span class="sh">\\        }</span>
<span class="w">        </span><span class="sh">\\        Blue # After pattern in alt</span>
<span class="w">        </span><span class="sh">\\        | # Before pattern in alt</span>
<span class="w">        </span><span class="sh">\\            Green</span>
<span class="w">        </span><span class="sh">\\        | Red # After alt pattern</span>
<span class="w">        </span><span class="sh">\\            -&gt; {</span>
<span class="w">        </span><span class="sh">\\                x = 12</span>
<span class="w">        </span><span class="sh">\\                x</span>
<span class="w">        </span><span class="sh">\\            }</span>
<span class="w">        </span><span class="sh">\\        lower # After pattern comment</span>
<span class="w">        </span><span class="sh">\\            -&gt; 1</span>
<span class="w">        </span><span class="sh">\\        "foo" -&gt; # After arrow comment</span>
<span class="w">        </span><span class="sh">\\            100</span>
<span class="w">        </span><span class="sh">\\        "foo" | "bar" -&gt; 200</span>
<span class="w">        </span><span class="sh">\\        [1, 2, 3, .. as rest] # After pattern comment</span>
<span class="w">        </span><span class="sh">\\            -&gt; # After arrow comment</span>
<span class="w">        </span><span class="sh">\\                123 # After branch comment</span>
<span class="w">        </span><span class="sh">\\</span>
<span class="w">        </span><span class="sh">\\        # Just a random comment</span>
<span class="w">        </span><span class="sh">\\</span>
<span class="w">        </span><span class="sh">\\        [1, 2 | 5, 3, .. as rest] -&gt; 123</span>
<span class="w">        </span><span class="sh">\\        [</span>
<span class="w">        </span><span class="sh">\\            1,</span>
<span class="w">        </span><span class="sh">\\            2 | 5,</span>
<span class="w">        </span><span class="sh">\\            3,</span>
<span class="w">        </span><span class="sh">\\            .. # After DoubleDot</span>
<span class="w">        </span><span class="sh">\\                as # Before alias</span>
<span class="w">        </span><span class="sh">\\                    rest, # After last pattern in list</span>
<span class="w">        </span><span class="sh">\\        ] -&gt; 123</span>
<span class="w">        </span><span class="sh">\\        3.14 -&gt; 314</span>
<span class="w">        </span><span class="sh">\\        3.14 | 6.28 -&gt; 314</span>
<span class="w">        </span><span class="sh">\\        (1, 2, 3) -&gt; 123</span>
<span class="w">        </span><span class="sh">\\        (1, 2 | 5, 3) -&gt; 123</span>
<span class="w">        </span><span class="sh">\\        { foo: 1, bar: 2, ..rest } -&gt; 12</span>
<span class="w">        </span><span class="sh">\\        { # After pattern record open</span>
<span class="w">        </span><span class="sh">\\            foo # After pattern record field name</span>
<span class="w">        </span><span class="sh">\\                : # Before pattern record field value</span>
<span class="w">        </span><span class="sh">\\                    1, # After pattern record field</span>
<span class="w">        </span><span class="sh">\\            bar: 2,</span>
<span class="w">        </span><span class="sh">\\            .. # After spread operator</span>
<span class="w">        </span><span class="sh">\\                rest, # After last field</span>
<span class="w">        </span><span class="sh">\\        } -&gt; 12</span>
<span class="w">        </span><span class="sh">\\        { foo: 1, bar: 2 | 7 } -&gt; 12</span>
<span class="w">        </span><span class="sh">\\        {</span>
<span class="w">        </span><span class="sh">\\            foo: 1,</span>
<span class="w">        </span><span class="sh">\\            bar: 2 | 7, # After last record field</span>
<span class="w">        </span><span class="sh">\\        } -&gt; 12</span>
<span class="w">        </span><span class="sh">\\        Ok(123) -&gt; 123</span>
<span class="w">        </span><span class="sh">\\        Ok(Some(dude)) -&gt; dude</span>
<span class="w">        </span><span class="sh">\\        TwoArgs("hello", Some("world")) -&gt; 1000</span>
<span class="w">        </span><span class="sh">\\    }</span>
<span class="w">        </span><span class="sh">\\</span>
<span class="w">        </span><span class="sh">\\expect # Comment after expect keyword</span>
<span class="w">        </span><span class="sh">\\    blah == 1 # Comment after expect statement</span>
<span class="w">        </span><span class="sh">\\</span>
<span class="w">        </span><span class="sh">\\main! : List(String) -&gt; Result({}, _)</span>
<span class="w">        </span><span class="sh">\\main! = |_| { # Yeah I can leave a comment here</span>
<span class="w">        </span><span class="sh">\\    world = "World"</span>
<span class="w">        </span><span class="sh">\\    number = 123</span>
<span class="w">        </span><span class="sh">\\    expect blah == 1</span>
<span class="w">        </span><span class="sh">\\    tag = Blue</span>
<span class="w">        </span><span class="sh">\\    return # Comment after return keyword</span>
<span class="w">        </span><span class="sh">\\        tag # Comment after return statement</span>
<span class="w">        </span><span class="sh">\\</span>
<span class="w">        </span><span class="sh">\\    # Just a random comment!</span>
<span class="w">        </span><span class="sh">\\</span>
<span class="w">        </span><span class="sh">\\    ...</span>
<span class="w">        </span><span class="sh">\\    match_time(</span>
<span class="w">        </span><span class="sh">\\        ..., # Single args with comment</span>
<span class="w">        </span><span class="sh">\\    )</span>
<span class="w">        </span><span class="sh">\\    some_func(</span>
<span class="w">        </span><span class="sh">\\        dbg # After debug</span>
<span class="w">        </span><span class="sh">\\            42, # After debug expr</span>
<span class="w">        </span><span class="sh">\\    )</span>
<span class="w">        </span><span class="sh">\\    crash # Comment after crash keyword</span>
<span class="w">        </span><span class="sh">\\        "Unreachable!" # Comment after crash statement</span>
<span class="w">        </span><span class="sh">\\    tag_with_payload = Ok(number)</span>
<span class="w">        </span><span class="sh">\\    interpolated = "Hello, ${world}"</span>
<span class="w">        </span><span class="sh">\\    list = [</span>
<span class="w">        </span><span class="sh">\\        add_one(</span>
<span class="w">        </span><span class="sh">\\            dbg # After dbg in list</span>
<span class="w">        </span><span class="sh">\\                number, # after dbg expr as arg</span>
<span class="w">        </span><span class="sh">\\        ), # Comment one</span>
<span class="w">        </span><span class="sh">\\        456, # Comment two</span>
<span class="w">        </span><span class="sh">\\        789, # Comment three</span>
<span class="w">        </span><span class="sh">\\    ]</span>
<span class="w">        </span><span class="sh">\\    record = { foo: 123, bar: "Hello", baz: tag, qux: Ok(world), punned }</span>
<span class="w">        </span><span class="sh">\\    tuple = (123, "World", tag, Ok(world), (nested, tuple), [1, 2, 3])</span>
<span class="w">        </span><span class="sh">\\    multiline_tuple = (</span>
<span class="w">        </span><span class="sh">\\        123,</span>
<span class="w">        </span><span class="sh">\\        "World",</span>
<span class="w">        </span><span class="sh">\\        tag1,</span>
<span class="w">        </span><span class="sh">\\        Ok(world), # This one has a comment</span>
<span class="w">        </span><span class="sh">\\        (nested, tuple),</span>
<span class="w">        </span><span class="sh">\\        [1, 2, 3],</span>
<span class="w">        </span><span class="sh">\\    )</span>
<span class="w">        </span><span class="sh">\\    bin_op_result = Err(foo) ?? 12 &gt; 5 * 5 or 13 + 2 &lt; 5 and 10 - 1 &gt;= 16 or 12 &lt;= 3 / 5</span>
<span class="w">        </span><span class="sh">\\    static_dispatch_style = some_fn(arg1)?.static_dispatch_method()?.next_static_dispatch_method()?.record_field?</span>
<span class="w">        </span><span class="sh">\\    Stdout.line!(interpolated)?</span>
<span class="w">        </span><span class="sh">\\    Stdout.line!(</span>
<span class="w">        </span><span class="sh">\\        "How about ${ # Comment after string interpolation open</span>
<span class="w">        </span><span class="sh">\\            Num.toStr(number) # Comment after string interpolation expr</span>
<span class="w">        </span><span class="sh">\\        } as a string?",</span>
<span class="w">        </span><span class="sh">\\    )</span>
<span class="w">        </span><span class="sh">\\} # Comment after top-level decl</span>
<span class="w">        </span><span class="sh">\\</span>
<span class="w">        </span><span class="sh">\\expect {</span>
<span class="w">        </span><span class="sh">\\    foo = 1 # This should work too</span>
<span class="w">        </span><span class="sh">\\    blah = 1</span>
<span class="w">        </span><span class="sh">\\    blah == foo</span>
<span class="w">        </span><span class="sh">\\}</span>
<span class="w">    </span><span class="p">);</span>
</code></pre></div>



<a name="508489791"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/508489791" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#508489791">(Mar 27 2025 at 11:28)</a>:</h4>
<p>One of the next things that need to be done is to start transcribing the builtins to the v0.1 syntax.  Where should they live?  I'll start doing that and finishing the parser by parsing <code>hosted</code>, <code>platform</code>, and <code>package</code> headers</p>



<a name="508525348"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/508525348" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#508525348">(Mar 27 2025 at 13:57)</a>:</h4>
<p>Preferably, we would make the old compiler able to migrate them to the new syntax</p>



<a name="508525443"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/508525443" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#508525443">(Mar 27 2025 at 13:57)</a>:</h4>
<p>That would ensure folks have an easy way to migrate when the zig compiler comes out</p>



<a name="508525601"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/508525601" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#508525601">(Mar 27 2025 at 13:58)</a>:</h4>
<p>It also makes it easier to benchmark against the old compiler if they both support the exact same syntax</p>



<a name="508545840"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/508545840" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Warner <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#508545840">(Mar 27 2025 at 15:14)</a>:</h4>
<p>I’be been working on a syntax migration tool in the old compiler, and it’s getting reasonably close. I’d say we should just use that tool to auto-translate the builtins and anything else we want to migrate, with a focus on improving the tool and rerunning it rather than doing hand fix ups to the migrated code</p>



<a name="508562595"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/508562595" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#508562595">(Mar 27 2025 at 16:15)</a>:</h4>
<p>100% agree</p>



<a name="510942868"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/510942868" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Notification Bot <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#510942868">(Apr 08 2025 at 14:00)</a>:</h4>
<p>9 messages were moved from this topic to <a class="stream-topic" data-stream-id="304641" href="/#narrow/channel/304641-ideas/topic/Needed.20Function.20signature.20and.20lambda.20expr.20change/with/510927622">#ideas &gt; Needed Function signature and lambda expr change</a> by <span class="user-mention silent" data-user-id="361169">Anton</span>.</p>



<a name="511946558"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/511946558" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#511946558">(Apr 13 2025 at 22:00)</a>:</h4>
<p>Reading through the Static Dispatch document for the 27th time, am I right to understand that <code>where</code> are only a part of a function's type?</p>



<a name="511946609"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/511946609" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#511946609">(Apr 13 2025 at 22:01)</a>:</h4>
<p>The where is saying that a function uses variables that have constraints</p>



<a name="511946663"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/511946663" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#511946663">(Apr 13 2025 at 22:02)</a>:</h4>
<p>This is just a parsing question, actually</p>



<a name="511946674"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/511946674" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#511946674">(Apr 13 2025 at 22:02)</a>:</h4>
<p>You can also use them in aliases</p>



<a name="511946686"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/511946686" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#511946686">(Apr 13 2025 at 22:02)</a>:</h4>
<p>Yes, but it would only appear as part of the type annotation of a function type?</p>



<a name="511946690"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/511946690" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#511946690">(Apr 13 2025 at 22:02)</a>:</h4>
<p>We haven't ironed out the links there</p>



<a name="511946693"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/511946693" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#511946693">(Apr 13 2025 at 22:02)</a>:</h4>
<p>Oh yeah, and in aliases</p>



<a name="511946703"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/511946703" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#511946703">(Apr 13 2025 at 22:02)</a>:</h4>
<p>I think I'll just be implementing them as part of function types for now</p>



<a name="511946736"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/511946736" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#511946736">(Apr 13 2025 at 22:03)</a>:</h4>
<p>But if anyone (<em>ahem</em> <span class="user-mention" data-user-id="281383">@Richard Feldman</span> ) has a nice summary of the overall plan here (as well as changes in syntax), please let me know</p>



<a name="511946743"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/511946743" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#511946743">(Apr 13 2025 at 22:03)</a>:</h4>
<p>We want to be able to say <code>sort_list : List(a) -&gt; List(a) where Sortable(a)</code></p>



<a name="511946792"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/511946792" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#511946792">(Apr 13 2025 at 22:04)</a>:</h4>
<p>Though <code>a.Sortable</code> was also thrown around</p>



<a name="511946811"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/511946811" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#511946811">(Apr 13 2025 at 22:04)</a>:</h4>
<p>So starting with just functions is fine for now</p>



<a name="511946820"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/511946820" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#511946820">(Apr 13 2025 at 22:04)</a>:</h4>
<p>Yeah, I think the big issue is the current syntax - outside of aliases - is likely going to cause some parsing issues</p>



<a name="511946975"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/511946975" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#511946975">(Apr 13 2025 at 22:06)</a>:</h4>
<div class="codehilite" data-code-language="Elm"><pre><span></span><code><span class="kt">Dict</span><span class="nf">.</span><span class="nv">insert</span><span class="w"> </span><span class="nf">:</span><span class="w"> </span><span class="kt">Dict</span><span class="w"> </span><span class="nv">k</span><span class="w"> </span><span class="nv">v</span><span class="p">,</span><span class="w"> </span><span class="nv">k</span><span class="p">,</span><span class="w"> </span><span class="nv">v</span><span class="w"> </span><span class="nf">-&gt;</span><span class="w"> </span><span class="kt">Dict</span><span class="w"> </span><span class="nv">k</span><span class="w"> </span><span class="nv">v</span>
<span class="w">    </span><span class="kr">where</span><span class="w"> </span><span class="nv">k</span><span class="nf">.</span><span class="kt">Hash</span><span class="p">,</span><span class="w"> </span><span class="nv">k</span><span class="nf">.</span><span class="kt">Eq</span>

<span class="kt">Hash</span><span class="w"> </span><span class="nv">a</span><span class="w"> </span><span class="nf">:</span><span class="w"> </span><span class="nv">a</span>
<span class="w">    </span><span class="kr">where</span>
<span class="w">        </span><span class="nv">a</span><span class="nf">.</span><span class="nv">hash</span><span class="p">(</span><span class="nv">hasher</span><span class="p">,</span><span class="w"> </span><span class="nv">a</span><span class="w"> </span><span class="nf">-&gt;</span><span class="w"> </span><span class="nv">hasher</span><span class="p">),</span>
<span class="w">        </span><span class="nv">hasher</span><span class="nf">.</span><span class="kt">Hasher</span><span class="p">,</span>
</code></pre></div>
<p>I'm actually wondering if I should attach these instead to annotations and type definitions</p>



<a name="511946995"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/511946995" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#511946995">(Apr 13 2025 at 22:07)</a>:</h4>
<p>Because this being used inside of an aggregate type would be .... complicated</p>



<a name="511947669"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/511947669" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#511947669">(Apr 13 2025 at 22:17)</a>:</h4>
<p>Just thinking out loud here...</p>
<p>so today we have</p>
<div class="codehilite" data-code-language="Ruby"><pre><span></span><code><span class="no">Hasher</span><span class="w"> </span><span class="n">implements</span>
<span class="w">    </span><span class="n">add_bytes</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="no">List</span><span class="w"> </span><span class="no">U8</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">where</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">implements</span><span class="w"> </span><span class="no">Hasher</span>
<span class="w">    </span><span class="n">add_u8</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="no">U8</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">where</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">implements</span><span class="w"> </span><span class="no">Hasher</span>
<span class="w">    </span><span class="n">add_u16</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="no">U16</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">where</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">implements</span><span class="w"> </span><span class="no">Hasher</span>
<span class="w">    </span><span class="n">add_u32</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="no">U32</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">where</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">implements</span><span class="w"> </span><span class="no">Hasher</span>
<span class="w">    </span><span class="n">add_u64</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="no">U64</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">where</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">implements</span><span class="w"> </span><span class="no">Hasher</span>
<span class="w">    </span><span class="n">add_u128</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="no">U128</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">where</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">implements</span><span class="w"> </span><span class="no">Hasher</span>
<span class="w">    </span><span class="n">complete</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="no">U64</span><span class="w"> </span><span class="n">where</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">implements</span><span class="w"> </span><span class="no">Hasher</span>
</code></pre></div>
<p>and I think we would have with v0.1</p>
<div class="codehilite" data-code-language="Ruby"><pre><span></span><code><span class="no">Hasher</span><span class="w"> </span><span class="ss">a</span><span class="p">:</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">where</span>
<span class="w">    </span><span class="n">a</span><span class="o">.</span><span class="n">add_bytes</span><span class="p">(</span><span class="no">List</span><span class="w"> </span><span class="no">U8</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="p">,</span>
<span class="w">    </span><span class="n">a</span><span class="o">.</span><span class="n">add_u8</span><span class="p">(</span><span class="no">U8</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">a</span><span class="p">,</span>
<span class="w">    </span><span class="n">a</span><span class="o">.</span><span class="n">add_u16</span><span class="p">(</span><span class="no">U16</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">a</span><span class="p">,</span>
<span class="w">    </span><span class="n">a</span><span class="o">.</span><span class="n">add_u32</span><span class="p">(</span><span class="no">U32</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">a</span><span class="p">,</span>
<span class="w">    </span><span class="n">a</span><span class="o">.</span><span class="n">add_u64</span><span class="p">(</span><span class="no">U64</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">a</span><span class="p">,</span>
<span class="w">    </span><span class="n">a</span><span class="o">.</span><span class="n">add_u128</span><span class="p">(</span><span class="no">U128</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">a</span><span class="p">,</span>
<span class="w">    </span><span class="n">a</span><span class="o">.</span><span class="n">complete</span><span class="p">()</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="no">U64</span>
</code></pre></div>
<p>Does that look correct?</p>



<a name="511947839"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/511947839" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#511947839">(Apr 13 2025 at 22:19)</a>:</h4>
<p>And that allows for us to then have something like:</p>
<div class="codehilite" data-code-language="Ruby"><pre><span></span><code><span class="c1"># In `Dict.roc`</span>
<span class="n">insert</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="no">Dict</span><span class="w"> </span><span class="n">k</span><span class="w"> </span><span class="n">v</span><span class="p">,</span><span class="w"> </span><span class="n">k</span><span class="p">,</span><span class="w"> </span><span class="n">v</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="no">Dict</span><span class="w"> </span><span class="n">k</span><span class="w"> </span><span class="n">v</span>
<span class="w">    </span><span class="n">where</span>
<span class="w">        </span><span class="n">k</span><span class="o">.</span><span class="n">Hash</span><span class="p">,</span>
<span class="w">        </span><span class="n">k</span><span class="o">.</span><span class="n">Eq</span><span class="p">,</span>

<span class="c1"># In `Str.roc`</span>
<span class="nb">hash</span><span class="w"> </span><span class="p">:</span><span class="w">  </span><span class="no">Str</span><span class="p">,</span><span class="w"> </span><span class="no">Hash</span><span class="o">.</span><span class="n">Hasher</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="no">Hash</span><span class="o">.</span><span class="n">Hasher</span>
<span class="nb">hash</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="o">...</span><span class="c1"># Implementation</span>
<span class="p">}</span>

<span class="c1"># In `Hash.roc`</span>
<span class="no">Hash</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">a</span>
<span class="w">        </span><span class="n">where</span>
<span class="w">            </span><span class="n">a</span><span class="o">.</span><span class="n">hash</span><span class="p">(</span><span class="n">hasher</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">hasher</span><span class="p">,</span>
<span class="w">            </span><span class="n">hasher</span><span class="o">.</span><span class="n">Hasher</span><span class="p">,</span>
<span class="no">Hasher</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">a</span>
<span class="w">    </span><span class="n">where</span>
<span class="w">        </span><span class="n">a</span><span class="o">.</span><span class="n">add_bytes</span><span class="p">(</span><span class="no">List</span><span class="w"> </span><span class="no">U8</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="p">,</span>
<span class="w">        </span><span class="n">a</span><span class="o">.</span><span class="n">add_u8</span><span class="p">(</span><span class="no">U8</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">a</span><span class="p">,</span>
<span class="w">        </span><span class="n">a</span><span class="o">.</span><span class="n">add_u16</span><span class="p">(</span><span class="no">U16</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">a</span><span class="p">,</span>
<span class="w">        </span><span class="n">a</span><span class="o">.</span><span class="n">add_u32</span><span class="p">(</span><span class="no">U32</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">a</span><span class="p">,</span>
<span class="w">        </span><span class="n">a</span><span class="o">.</span><span class="n">add_u64</span><span class="p">(</span><span class="no">U64</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">a</span><span class="p">,</span>
<span class="w">        </span><span class="n">a</span><span class="o">.</span><span class="n">add_u128</span><span class="p">(</span><span class="no">U128</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">a</span><span class="p">,</span>
<span class="w">        </span><span class="n">a</span><span class="o">.</span><span class="n">complete</span><span class="p">()</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="no">U64</span>
</code></pre></div>



<a name="511948117"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/511948117" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#511948117">(Apr 13 2025 at 22:23)</a>:</h4>
<p>And then a <code>Dict(Str, Str)</code> is valid (assuming similar is implemented for Eq)</p>



<a name="511948491"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/511948491" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#511948491">(Apr 13 2025 at 22:28)</a>:</h4>
<p>So each clause in a where is one of:</p>
<ol>
<li>LowerIdent, NoSpaceDotLowerIdent, NoSpaceOpenParen, &lt;type args&gt;, CloseParens, OpArrow, &lt;type arg&gt;</li>
<li>LowerIdent, NoSpaceDotUpperIdent</li>
</ol>



<a name="511950918"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/511950918" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#511950918">(Apr 13 2025 at 22:58)</a>:</h4>
<p><span class="user-mention silent" data-user-id="781658">Anthony Bullard</span> <a href="#narrow/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser/near/511946558">said</a>:</p>
<blockquote>
<p>Reading through the Static Dispatch document for the 27th time, am I right to understand that <code>where</code> are only a part of a function's type?</p>
</blockquote>
<p>Yep</p>



<a name="511950960"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/511950960" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#511950960">(Apr 13 2025 at 22:59)</a>:</h4>
<p><span class="user-mention silent" data-user-id="781658">Anthony Bullard</span> <a href="#narrow/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser/near/511947669">said</a>:</p>
<blockquote>
<p>Just thinking out loud here...</p>
<p>so today we have</p>
<div class="codehilite" data-code-language="Ruby"><pre><span></span><code><span class="no">Hasher</span><span class="w"> </span><span class="n">implements</span>
<span class="w">    </span><span class="n">add_bytes</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="no">List</span><span class="w"> </span><span class="no">U8</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">where</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">implements</span><span class="w"> </span><span class="no">Hasher</span>
<span class="w">    </span><span class="n">add_u8</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="no">U8</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">where</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">implements</span><span class="w"> </span><span class="no">Hasher</span>
<span class="w">    </span><span class="n">add_u16</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="no">U16</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">where</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">implements</span><span class="w"> </span><span class="no">Hasher</span>
<span class="w">    </span><span class="n">add_u32</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="no">U32</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">where</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">implements</span><span class="w"> </span><span class="no">Hasher</span>
<span class="w">    </span><span class="n">add_u64</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="no">U64</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">where</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">implements</span><span class="w"> </span><span class="no">Hasher</span>
<span class="w">    </span><span class="n">add_u128</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="no">U128</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">where</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">implements</span><span class="w"> </span><span class="no">Hasher</span>
<span class="w">    </span><span class="n">complete</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="no">U64</span><span class="w"> </span><span class="n">where</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">implements</span><span class="w"> </span><span class="no">Hasher</span>
</code></pre></div>
<p>and I think we would have with v0.1</p>
<div class="codehilite" data-code-language="Ruby"><pre><span></span><code><span class="no">Hasher</span><span class="w"> </span><span class="ss">a</span><span class="p">:</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">where</span>
<span class="w">    </span><span class="n">a</span><span class="o">.</span><span class="n">add_bytes</span><span class="p">(</span><span class="no">List</span><span class="w"> </span><span class="no">U8</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="p">,</span>
<span class="w">    </span><span class="n">a</span><span class="o">.</span><span class="n">add_u8</span><span class="p">(</span><span class="no">U8</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">a</span><span class="p">,</span>
<span class="w">    </span><span class="n">a</span><span class="o">.</span><span class="n">add_u16</span><span class="p">(</span><span class="no">U16</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">a</span><span class="p">,</span>
<span class="w">    </span><span class="n">a</span><span class="o">.</span><span class="n">add_u32</span><span class="p">(</span><span class="no">U32</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">a</span><span class="p">,</span>
<span class="w">    </span><span class="n">a</span><span class="o">.</span><span class="n">add_u64</span><span class="p">(</span><span class="no">U64</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">a</span><span class="p">,</span>
<span class="w">    </span><span class="n">a</span><span class="o">.</span><span class="n">add_u128</span><span class="p">(</span><span class="no">U128</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">a</span><span class="p">,</span>
<span class="w">    </span><span class="n">a</span><span class="o">.</span><span class="n">complete</span><span class="p">()</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="no">U64</span>
</code></pre></div>
<p>Does that look correct?</p>
</blockquote>
<p>Yep</p>



<a name="511951159"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/511951159" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#511951159">(Apr 13 2025 at 23:01)</a>:</h4>
<p><span class="user-mention silent" data-user-id="781658">Anthony Bullard</span> <a href="#narrow/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser/near/511946975">said</a>:</p>
<blockquote>
<div class="codehilite" data-code-language="Elm"><pre><span></span><code><span class="kt">Dict</span><span class="nf">.</span><span class="nv">insert</span><span class="w"> </span><span class="nf">:</span><span class="w"> </span><span class="kt">Dict</span><span class="w"> </span><span class="nv">k</span><span class="w"> </span><span class="nv">v</span><span class="p">,</span><span class="w"> </span><span class="nv">k</span><span class="p">,</span><span class="w"> </span><span class="nv">v</span><span class="w"> </span><span class="nf">-&gt;</span><span class="w"> </span><span class="kt">Dict</span><span class="w"> </span><span class="nv">k</span><span class="w"> </span><span class="nv">v</span>
<span class="w">    </span><span class="kr">where</span><span class="w"> </span><span class="nv">k</span><span class="nf">.</span><span class="kt">Hash</span><span class="p">,</span><span class="w"> </span><span class="nv">k</span><span class="nf">.</span><span class="kt">Eq</span>

<span class="kt">Hash</span><span class="w"> </span><span class="nv">a</span><span class="w"> </span><span class="nf">:</span><span class="w"> </span><span class="nv">a</span>
<span class="w">    </span><span class="kr">where</span>
<span class="w">        </span><span class="nv">a</span><span class="nf">.</span><span class="nv">hash</span><span class="p">(</span><span class="nv">hasher</span><span class="p">,</span><span class="w"> </span><span class="nv">a</span><span class="w"> </span><span class="nf">-&gt;</span><span class="w"> </span><span class="nv">hasher</span><span class="p">),</span>
<span class="w">        </span><span class="nv">hasher</span><span class="nf">.</span><span class="kt">Hasher</span><span class="p">,</span>
</code></pre></div>
<p>I'm actually wondering if I should attach these instead to annotations and type definitions</p>
</blockquote>
<p>Hash looks to be defined wrong. I think it would be <code>a.hash(hasher) -&gt; hasher</code>. That or it needs to be defined differently to be module based instead of standard static dispatch.</p>



<a name="511951249"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/511951249" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#511951249">(Apr 13 2025 at 23:02)</a>:</h4>
<p>The other way to define it would be <code>module(a).hash(hasher, a) -&gt; hasher</code></p>



<a name="511952220"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/511952220" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#511952220">(Apr 13 2025 at 23:15)</a>:</h4>
<p>What does the module(a) buy us over just a?</p>



<a name="511953079"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/511953079" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#511953079">(Apr 13 2025 at 23:27)</a>:</h4>
<p>Is that for when the argument of type <code>a</code> is not the first arg (in the "receiver" position)?</p>



<a name="511957349"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/511957349" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#511957349">(Apr 14 2025 at 00:25)</a>:</h4>
<p>Yes</p>



<a name="511957360"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/511957360" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#511957360">(Apr 14 2025 at 00:25)</a>:</h4>
<p>Need for decode</p>



<a name="511957373"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/511957373" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#511957373">(Apr 14 2025 at 00:25)</a>:</h4>
<p>Cause decode is <code>List(U8) -&gt; a</code></p>



<a name="511957476"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/511957476" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#511957476">(Apr 14 2025 at 00:26)</a>:</h4>
<p>Probably will a decoding format as well or something like that</p>



<a name="512137795"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/512137795" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#512137795">(Apr 14 2025 at 17:32)</a>:</h4>
<p>Decode a : a where a.decode(List(U8)) -&gt; a<br>
Encode a : a where a.encode(a) -&gt; List(U8)</p>



<a name="512156983"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/512156983" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#512156983">(Apr 14 2025 at 19:23)</a>:</h4>
<p>How would that definition of decode work? You won't have <code>a</code> if you are trying to decode an <code>a</code>.</p>
<p>I think it has to be<br>
Decode a : a where module(a).decode(List(U8)) -&gt; a</p>



<a name="512158316"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/512158316" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#512158316">(Apr 14 2025 at 19:31)</a>:</h4>
<p>Sorry</p>



<a name="512158339"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/512158339" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#512158339">(Apr 14 2025 at 19:31)</a>:</h4>
<p>I was just typing out syntax</p>



<a name="512158377"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/512158377" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#512158377">(Apr 14 2025 at 19:31)</a>:</h4>
<p>That wasn’t meant to be real (or actually submitted)</p>



<a name="512443897"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/512443897" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#512443897">(Apr 16 2025 at 01:50)</a>:</h4>
<p>The PR for parsing and formatting is here: <a href="https://github.com/roc-lang/roc/pull/7745">https://github.com/roc-lang/roc/pull/7745</a></p>



<a name="512446070"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/512446070" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#512446070">(Apr 16 2025 at 02:13)</a>:</h4>
<p>My absolute rough draft, first take re-implementation of Hash.roc from the builtins based on all of the syntax for v0.1 that is available today:</p>
<div class="codehilite" data-code-language="Ruby"><pre><span></span><code><span class="n">module</span><span class="w"> </span><span class="o">[</span>
<span class="w">    </span><span class="no">Hash</span><span class="p">,</span>
<span class="w">    </span><span class="no">Hasher</span><span class="p">,</span>
<span class="w">    </span><span class="n">hash_list</span><span class="p">,</span>
<span class="w">    </span><span class="n">hash_unordered</span><span class="p">,</span>
<span class="o">]</span>

<span class="n">import</span><span class="w"> </span><span class="no">Num</span><span class="w"> </span><span class="n">exposing</span><span class="w"> </span><span class="o">[</span>
<span class="w">    </span><span class="no">U8</span><span class="p">,</span>
<span class="w">    </span><span class="no">U16</span><span class="p">,</span>
<span class="w">    </span><span class="no">U32</span><span class="p">,</span>
<span class="w">    </span><span class="no">U64</span><span class="p">,</span>
<span class="w">    </span><span class="no">U128</span><span class="p">,</span>
<span class="o">]</span>

<span class="c1">## A value that can be hashed.</span>
<span class="no">Hash</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">a</span>
<span class="w">    </span><span class="n">where</span>
<span class="w">        </span><span class="c1">## Hashes a value into a [Hasher].</span>
<span class="w">        </span><span class="c1">## Note that [hash] does not produce a hash value itself; the hasher must be</span>
<span class="w">        </span><span class="c1">## [complete]d in order to extract the hash value.</span>
<span class="w">        </span><span class="n">a</span><span class="o">.</span><span class="n">hash</span><span class="p">(</span><span class="n">hasher</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">hasher</span><span class="p">,</span>
<span class="w">        </span><span class="n">hasher</span><span class="o">.</span><span class="n">Hasher</span><span class="p">,</span>

<span class="c1">## Describes a hashing algorithm that is fed bytes and produces an integer hash.</span>
<span class="c1">##</span>
<span class="c1">## The [Hasher] ability describes general-purpose hashers. It only allows</span>
<span class="c1">## emission of 64-bit unsigned integer hashes. It is not suitable for</span>
<span class="c1">## cryptographically-secure hashing.</span>
<span class="no">Hasher</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">a</span>
<span class="w">    </span><span class="n">where</span>
<span class="w">        </span><span class="c1">## Adds a list of bytes to the hasher.</span>
<span class="w">        </span><span class="n">a</span><span class="o">.</span><span class="n">add_bytes</span><span class="p">(</span><span class="no">List</span><span class="p">(</span><span class="no">U8</span><span class="p">))</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">a</span><span class="p">,</span>

<span class="w">        </span><span class="c1">## Adds a single U8 to the hasher.</span>
<span class="w">        </span><span class="n">a</span><span class="o">.</span><span class="n">add_u8</span><span class="p">(</span><span class="no">U8</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">a</span><span class="p">,</span>

<span class="w">        </span><span class="c1">## Adds a single U16 to the hasher.</span>
<span class="w">        </span><span class="n">a</span><span class="o">.</span><span class="n">add_u16</span><span class="p">(</span><span class="no">U16</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">a</span><span class="p">,</span>

<span class="w">        </span><span class="c1">## Adds a single U32 to the hasher.</span>
<span class="w">        </span><span class="n">a</span><span class="o">.</span><span class="n">add_u32</span><span class="p">(</span><span class="no">U32</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">a</span><span class="p">,</span>

<span class="w">        </span><span class="c1">## Adds a single U64 to the hasher.</span>
<span class="w">        </span><span class="n">a</span><span class="o">.</span><span class="n">add_u64</span><span class="p">(</span><span class="no">U64</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">a</span><span class="p">,</span>

<span class="w">        </span><span class="c1">## Adds a single U128 to the hasher.</span>
<span class="w">        </span><span class="n">a</span><span class="o">.</span><span class="n">add_u128</span><span class="p">(</span><span class="no">U128</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">a</span><span class="p">,</span>

<span class="w">        </span><span class="c1">## Completes the hasher, extracting a hash value from its</span>
<span class="w">        </span><span class="c1">## accumulated hash state.</span>
<span class="w">        </span><span class="n">a</span><span class="o">.</span><span class="n">complete</span><span class="p">()</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="no">U64</span><span class="p">,</span>

<span class="c1">## Adds a list of [Hash]able elements to a [Hasher] by hashing each element.</span>
<span class="n">hash_list</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">hasher</span><span class="p">,</span><span class="w"> </span><span class="no">List</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">hasher</span>
<span class="w">    </span><span class="n">where</span>
<span class="w">        </span><span class="n">a</span><span class="o">.</span><span class="n">Hash</span><span class="p">,</span>
<span class="w">        </span><span class="n">hasher</span><span class="o">.</span><span class="n">Hasher</span><span class="p">,</span>
<span class="n">hash_list</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">|</span><span class="n">hasher</span><span class="p">,</span><span class="w"> </span><span class="n">lst</span><span class="o">|</span>
<span class="w">    </span><span class="n">lst</span><span class="o">.</span><span class="n">walk</span><span class="p">(</span>
<span class="w">        </span><span class="n">hasher</span><span class="p">,</span>
<span class="w">        </span><span class="o">|</span><span class="n">accum_hasher</span><span class="p">,</span><span class="w"> </span><span class="n">elem</span><span class="o">|</span>
<span class="w">            </span><span class="n">elem</span><span class="o">.</span><span class="n">hash</span><span class="p">(</span><span class="n">accum_hasher</span><span class="p">),</span>
<span class="w">    </span><span class="p">)</span>

<span class="no">HashFunction</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">hasher</span><span class="p">,</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">hasher</span><span class="w"> </span><span class="n">where</span><span class="w"> </span><span class="n">a</span><span class="o">.</span><span class="n">Hash</span><span class="p">,</span><span class="w"> </span><span class="n">hasher</span><span class="o">.</span><span class="n">Hasher</span>
<span class="no">HashWalker</span><span class="w"> </span><span class="n">container</span><span class="w"> </span><span class="n">elem</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">hasher</span><span class="p">,</span><span class="w"> </span><span class="n">container</span><span class="p">,</span><span class="w"> </span><span class="no">HashFunction</span><span class="p">(</span><span class="n">elem</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">hasher</span>
<span class="w">    </span><span class="n">where</span>
<span class="w">        </span><span class="n">elem</span><span class="o">.</span><span class="n">Hash</span><span class="p">,</span>
<span class="w">        </span><span class="n">hasher</span><span class="o">.</span><span class="n">Hasher</span><span class="p">,</span>

<span class="c1">## Adds a container of [Hash]able elements to a [Hasher] by hashing each element.</span>
<span class="c1">## The container is iterated using the walk method passed in.</span>
<span class="c1">## The order of the elements does not affect the final hash.</span>
<span class="n">hash_unordered</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">hasher</span><span class="p">,</span><span class="w"> </span><span class="n">container</span><span class="p">,</span><span class="w"> </span><span class="no">HashWalker</span><span class="p">(</span><span class="n">container</span><span class="p">,</span><span class="w"> </span><span class="n">elem</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">hasher</span>
<span class="w">    </span><span class="n">where</span>
<span class="w">        </span><span class="n">elem</span><span class="o">.</span><span class="n">Hash</span><span class="p">,</span>
<span class="w">        </span><span class="n">hasher</span><span class="o">.</span><span class="n">Hasher</span><span class="p">,</span>
<span class="n">hash_unordered</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">|</span><span class="n">hasher</span><span class="p">,</span><span class="w"> </span><span class="n">container</span><span class="p">,</span><span class="w"> </span><span class="n">walk</span><span class="o">|</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">acc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">walk</span><span class="p">(</span>
<span class="w">        </span><span class="n">container</span><span class="p">,</span>
<span class="w">        </span><span class="mi">0</span><span class="p">,</span>
<span class="w">        </span><span class="o">|</span><span class="n">accum</span><span class="p">,</span><span class="w"> </span><span class="n">elem</span><span class="o">|</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">x</span><span class="w"> </span><span class="o">=</span>
<span class="w">                </span><span class="c1"># Note, we intentionally copy the hasher in every iteration.</span>
<span class="w">                </span><span class="c1"># Having the same base state is required for unordered hashing.</span>
<span class="w">                </span><span class="n">elem</span>
<span class="w">                </span><span class="o">.</span><span class="n">hash</span><span class="p">(</span><span class="n">hasher</span><span class="p">)</span>
<span class="w">                </span><span class="o">.</span><span class="n">complete</span><span class="p">()</span>
<span class="w">            </span><span class="n">next_accum</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">accum</span><span class="o">.</span><span class="n">add_wrap</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="n">next_accum</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">accum</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="c1"># we don't want to lose a bit of entropy on overflow, so add it back in.</span>
<span class="w">                </span><span class="n">next_accum</span><span class="o">.</span><span class="n">add_wrap</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="w">            </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="n">next_accum</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">},</span>
<span class="w">    </span><span class="p">)</span>
<span class="w">    </span><span class="n">hasher</span><span class="o">.</span><span class="n">add_u64</span><span class="p">(</span><span class="n">acc</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div>
<div class="codehilite"><pre><span></span><code>
</code></pre></div>



<a name="512446198"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/512446198" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#512446198">(Apr 16 2025 at 02:15)</a>:</h4>
<p>If that looks correct to everyone, I'll add a snapshot for it</p>



<a name="512447247"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/512447247" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#512447247">(Apr 16 2025 at 02:25)</a>:</h4>
<p>I assume <code>a.add_u8(U8) -&gt; hasher,</code> should be <code>a.add_u8(U8) -&gt; a,</code> same for other functions in <code>Hasher</code></p>
<p>Also, is it now <code>Hash(a)</code> and <code>Hasher(a)</code> instead of <code>Hash a</code> and <code>Hasher a</code></p>
<p><code>(hasher, b, (hasher, a -&gt; hasher) -&gt; hasher)</code> could use a anlias to be less confusing. That or at least change the name <code>b</code> to <code>container</code> and <code>a</code> to <code>elem</code>.</p>
<hr>
<p>Yeah, looks roughly correct.</p>



<a name="512447350"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/512447350" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#512447350">(Apr 16 2025 at 02:26)</a>:</h4>
<p>Also, I wonder if we need a better way to apply aliases. <code>hasher.Hasher,</code> doesn't look good.</p>



<a name="512447417"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/512447417" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#512447417">(Apr 16 2025 at 02:27)</a>:</h4>
<p>Like it doesn't feel like it is saying that <code>hasher</code> implements the <code>Hasher</code> ability. I wonder if it would be clearer to just do <code>Hasher(hasher)</code> or something similar....not sure</p>



<a name="512447559"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/512447559" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#512447559">(Apr 16 2025 at 02:28)</a>:</h4>
<p>Hey <span class="user-mention" data-user-id="281383">@Richard Feldman</span>, do we have any plans on fixing byte hashing for static dispatch? As in, a <code>List U8</code> will by default hash via <code>hash_list</code> instead <code>add_bytes</code>. As such, it leaves a lot of performance on the table by default.</p>



<a name="512447609"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/512447609" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#512447609">(Apr 16 2025 at 02:29)</a>:</h4>
<p>Really in a perfect world, all number types would hash via <code>add_bytes</code> and only complex types would use <code>hash_list</code> that walks an element at a time.</p>



<a name="512450719"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/512450719" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#512450719">(Apr 16 2025 at 03:02)</a>:</h4>
<p>hm, I'm not familiar with the distinction <span aria-label="sweat smile" class="emoji emoji-1f605" role="img" title="sweat smile">:sweat_smile:</span></p>



<a name="512450811"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/512450811" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#512450811">(Apr 16 2025 at 03:02)</a>:</h4>
<p>I assume <code>hash_list</code> is hashing each byte individually, which of course is suboptimal</p>



<a name="512450822"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/512450822" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#512450822">(Apr 16 2025 at 03:02)</a>:</h4>
<p>but what does <code>add_bytes</code> do?</p>



<a name="512454125"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/512454125" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#512454125">(Apr 16 2025 at 03:36)</a>:</h4>
<p>Yeah, <code>hash_list</code> is the one element at a time thing</p>



<a name="512454148"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/512454148" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#512454148">(Apr 16 2025 at 03:37)</a>:</h4>
<p>And <code>add_bytes</code> leaves it up to the hasher and thus can run way faster algorithms</p>



<a name="512454293"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/512454293" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#512454293">(Apr 16 2025 at 03:38)</a>:</h4>
<p>The issue is that we cannot specialize hash on <code>List U8</code> only on <code>List a</code>. So we get stuck hashing <code>List U8</code> with <code>hash_list</code> unless a user manually overrides it in a custom type hash implementation.</p>



<a name="512454479"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/512454479" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#512454479">(Apr 16 2025 at 03:40)</a>:</h4>
<p>As an aside, theoretically for most structural types the best hashing would be to hash like <code>add_bytes</code> but to mask out the padding, but that is another level of complexity to even orchestrate.</p>



<a name="512525388"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/512525388" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#512525388">(Apr 16 2025 at 11:08)</a>:</h4>
<p><span class="user-mention silent" data-user-id="343810">Brendan Hansknecht</span> <a href="#narrow/channel/395097-compiler-development/topic/zig.20compiler.20-.20parser/near/512447247">said</a>:</p>
<blockquote>
<p>I assume <code>a.add_u8(U8) -&gt; hasher,</code> should be <code>a.add_u8(U8) -&gt; a,</code> same for other functions in <code>Hasher</code></p>
<p>Also, is it now <code>Hash(a)</code> and <code>Hasher(a)</code> instead of <code>Hash a</code> and <code>Hasher a</code></p>
<p><code>(hasher, b, (hasher, a -&gt; hasher) -&gt; hasher)</code> could use a anlias to be less confusing. That or at least change the name <code>b</code> to <code>container</code> and <code>a</code> to <code>elem</code>.</p>
<hr>
<p>Yeah, looks roughly correct.</p>
</blockquote>
<p>I fixed the couple of things that were obviously wrong, and made some type aliases to make <code>list_unordered</code>'s signature readable.</p>
<p>Currently a Type Header still uses space separated args.  Did this change <span class="user-mention" data-user-id="281383">@Richard Feldman</span> ?</p>



<a name="512525583"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/512525583" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#512525583">(Apr 16 2025 at 11:09)</a>:</h4>
<p>This is why it would be very nice if there were a Grammar specification - outside of the implementation in the parser - that we could use to track the parser's compliance (and therefore completion)</p>



<a name="512525742"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/512525742" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#512525742">(Apr 16 2025 at 11:10)</a>:</h4>
<p>As good as Zulip is, trying to find the answer to every such question is very difficult</p>



<a name="512526476"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/512526476" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#512526476">(Apr 16 2025 at 11:13)</a>:</h4>
<p>In <a class="message-link" href="/#narrow/channel/304641-ideas/topic/.E2.9C.94.20Using.20parens.20for.20types/near/499544093">#ideas &gt; ✔ Using parens for types @ 💬</a>  we decided to use parens for type arguments in the annotation itself, but no real direction of type alias headers</p>



<a name="512546569"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/512546569" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#512546569">(Apr 16 2025 at 12:56)</a>:</h4>
<p>good question! I think we should match what patterns do</p>



<a name="512546760"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/512546760" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#512546760">(Apr 16 2025 at 12:57)</a>:</h4>
<p>so for example:</p>
<div class="codehilite" data-code-language="Perl"><pre><span></span><code><span class="n">Alias</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">)</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="o">...</span>
</code></pre></div>



<a name="512548870"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/512548870" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#512548870">(Apr 16 2025 at 13:06)</a>:</h4>
<p><span class="user-mention silent" data-user-id="343810">Brendan Hansknecht</span> <a href="#narrow/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser/near/512454293">said</a>:</p>
<blockquote>
<p>The issue is that we cannot specialize hash on <code>List U8</code> only on <code>List a</code>. So we get stuck hashing <code>List U8</code> with <code>hash_list</code> unless a user manually overrides it in a custom type hash implementation.</p>
</blockquote>
<p>ah, yeah static dispatch doesn't actually help with this; the <code>List</code> type is still in the <code>List</code> module.</p>



<a name="512549038"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/512549038" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#512549038">(Apr 16 2025 at 13:07)</a>:</h4>
<p>Good point!  The <code>hash_list</code> function should be in the list module</p>



<a name="512549072"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/512549072" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#512549072">(Apr 16 2025 at 13:07)</a>:</h4>
<p>And ok on the change to type alias headers</p>



<a name="512549110"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/512549110" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#512549110">(Apr 16 2025 at 13:07)</a>:</h4>
<p>I can do that real quick before work</p>



<a name="512549263"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/512549263" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#512549263">(Apr 16 2025 at 13:08)</a>:</h4>
<p><span class="user-mention silent" data-user-id="343810">Brendan Hansknecht</span> <a href="#narrow/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser/near/512454479">said</a>:</p>
<blockquote>
<p>As an aside, theoretically for most structural types the best hashing would be to hash like <code>add_bytes</code> but to mask out the padding, but that is another level of complexity to even orchestrate.</p>
</blockquote>
<p><span aria-label="thinking" class="emoji emoji-1f914" role="img" title="thinking">:thinking:</span> we could make it so that all the non-pointers in structural types get hashed using <code>add_bytes</code>. They should all end up right next to each other anyway because of alignment, and we can't do better than that because we need to chase the pointers anyway (and not include the addresses in the hash)</p>



<a name="512549803"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/512549803" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#512549803">(Apr 16 2025 at 13:10)</a>:</h4>
<p>And then we need:</p>
<ol>
<li>Whatever we call <code>[-2, 0, 2].map(.abs().sub(1))</code>. Tearoffs?</li>
<li><code>var</code> statements</li>
<li><code>for</code> statements</li>
</ol>



<a name="512550021"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/512550021" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#512550021">(Apr 16 2025 at 13:11)</a>:</h4>
<p>And then v0.1 parsing will be complete</p>



<a name="512550127"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/512550127" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#512550127">(Apr 16 2025 at 13:12)</a>:</h4>
<p>Obviously the formatter will need quite a bit of iteration to dial in the style over time</p>



<a name="512550351"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/512550351" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#512550351">(Apr 16 2025 at 13:13)</a>:</h4>
<p><span class="user-mention" data-user-id="281383">@Richard Feldman</span> have we ever finalized the syntax and semantics for a) Tearoffs and b) local function application in a static dispatch chain?</p>



<a name="512553926"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/512553926" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#512553926">(Apr 16 2025 at 13:29)</a>:</h4>
<p>a) let's hold off on that for now. I'd like to see how often people actually want to reach for it in practice once we have static dispatch. Might turn out to not be worth doing.<br>
b) yeah, we settled on <code>a-&gt;b</code> in <a href="#narrow/stream/304641-ideas/topic/static.20dispatch.20-.20pass_to.20alternative">https://roc.zulipchat.com/#narrow/stream/304641-ideas/topic/static.20dispatch.20-.20pass_to.20alternative</a></p>



<a name="512555187"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/512555187" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#512555187">(Apr 16 2025 at 13:35)</a>:</h4>
<p>more specifically:</p>
<ul>
<li><code>a-&gt;b(1, 2)-&gt;c(3, 4)</code> desugars to <code>c(b(a, 1, 2), 3, 4)</code></li>
<li>you can omit <code>()</code> from these when there are no extra args to pass, so for example you can do <code>-&gt;Ok</code> instead of <code>-&gt;Ok()</code>, and <code>4-&gt;hours-&gt;ago!</code> instead of <code>4-&gt;hours()-&gt;ago!()</code></li>
<li>the parser should accept either style, but then the formatter should remove <code>()</code>s that are used after <code>-&gt;</code></li>
</ul>



<a name="512555768"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/512555768" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#512555768">(Apr 16 2025 at 13:37)</a>:</h4>
<p>Just to clarify about b - We decided on <code>-&gt;</code> for local dispatch / "Arrow calls", but there was some suggestion (not really touched upon) that <code>match</code> clauses would drop <code>-&gt;</code>.  Is that a thing?</p>



<a name="512561881"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/512561881" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#512561881">(Apr 16 2025 at 14:03)</a>:</h4>
<p>Well, this change was a <em>tad</em> more difficult than I expected - it creates some contention with a plain applied Tag expression.  Have to make statements differentiate between top-level and  inside of a block.</p>



<a name="512562025"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/512562025" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#512562025">(Apr 16 2025 at 14:04)</a>:</h4>
<p>So I'll try to finish it tomorrow morning :-)</p>



<a name="512562065"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/512562065" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#512562065">(Apr 16 2025 at 14:04)</a>:</h4>
<p>Now off to writing AI Agents...</p>



<a name="512593796"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/512593796" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#512593796">(Apr 16 2025 at 16:16)</a>:</h4>
<p><span class="user-mention silent" data-user-id="781658">Anthony Bullard</span> <a href="#narrow/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser/near/512555768">said</a>:</p>
<blockquote>
<p>Just to clarify about b - We decided on <code>-&gt;</code> for local dispatch / "Arrow calls", but there was some suggestion (not really touched upon) that <code>match</code> clauses would drop <code>-&gt;</code>.  Is that a thing?</p>
</blockquote>
<p>we decided to use <code>=&gt;</code> with <code>match</code> for now</p>



<a name="512598312"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/512598312" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anton <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#512598312">(Apr 16 2025 at 16:37)</a>:</h4>
<p><span class="user-mention silent" data-user-id="781658">Anthony Bullard</span> <a href="#narrow/channel/395097-compiler-development/topic/zig.20compiler.20-.20parser/near/512562065">said</a>:</p>
<blockquote>
<p>Now off to writing AI Agents...</p>
</blockquote>
<p>Cool, what are you working on specifically?</p>



<a name="512631676"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/512631676" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#512631676">(Apr 16 2025 at 18:05)</a>:</h4>
<p><span class="user-mention silent" data-user-id="281383">Richard Feldman</span> <a href="#narrow/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser/near/512549263">said</a>:</p>
<blockquote>
<p><span class="user-mention silent" data-user-id="343810">Brendan Hansknecht</span> <a href="#narrow/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser/near/512454479">said</a>:</p>
<blockquote>
<p>As an aside, theoretically for most structural types the best hashing would be to hash like <code>add_bytes</code> but to mask out the padding, but that is another level of complexity to even orchestrate.</p>
</blockquote>
<p><span aria-label="thinking" class="emoji emoji-1f914" role="img" title="thinking">:thinking:</span> we could make it so that all the non-pointers in structural types get hashed using <code>add_bytes</code>. They should all end up right next to each other anyway because of alignment, and we can't do better than that because we need to chase the pointers anyway (and not include the addresses in the hash)</p>
</blockquote>
<p>Ah yeah, structural types without pointers can do what I said when in a list. If you have pointers, you need to do things an element at a time</p>



<a name="512647573"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/512647573" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#512647573">(Apr 16 2025 at 18:47)</a>:</h4>
<p><span class="user-mention silent" data-user-id="361169">Anton</span> <a href="#narrow/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser/near/512598312">said</a>:</p>
<blockquote>
<p><span class="user-mention silent" data-user-id="781658">Anthony Bullard</span> <a href="#narrow/channel/395097-compiler-development/topic/zig.20compiler.20-.20parser/near/512562065">said</a>:</p>
<blockquote>
<p>Now off to writing AI Agents...</p>
</blockquote>
<p>Cool, what are you working on specifically?</p>
</blockquote>
<p>Wish I could be specific, but let’s just exploration around UI Generation when the UI is not created from source code</p>



<a name="512802359"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/512802359" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#512802359">(Apr 17 2025 at 11:24)</a>:</h4>
<p>Type alias header using parens for args: <a href="https://github.com/roc-lang/roc/pull/7749">https://github.com/roc-lang/roc/pull/7749</a></p>



<a name="512803775"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/512803775" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#512803775">(Apr 17 2025 at 11:32)</a>:</h4>
<p>My next steps:</p>
<ol>
<li>Move <code>match</code> clauses to using fat arrow <code>=&gt;</code></li>
<li>Implement "arrow calls" as described in <a class="message-link" href="/#narrow/channel/395097-compiler-development/topic/zig.20compiler.20-.20parser/near/512555187">#compiler development &gt; zig compiler - parser @ 💬</a> </li>
<li>Implement <code>var</code> statements</li>
<li>Implement <code>for</code> construct</li>
</ol>
<p>I'll probably do 1 &amp; 2 in a single PR, hopefully by EOW.<br>
Then 3 &amp; 4 should be relatively straightforward so I'm hoping to have everything done before the next contributor meet up.</p>



<a name="513012977"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/513012977" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#513012977">(Apr 18 2025 at 10:56)</a>:</h4>
<p>Move match clauses to fat arrow: <a href="https://github.com/roc-lang/roc/pull/7751">https://github.com/roc-lang/roc/pull/7751</a></p>



<a name="517360040"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/517360040" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#517360040">(May 11 2025 at 13:10)</a>:</h4>
<p>Parse and format "Local dispatch arrow calls": <a href="https://github.com/roc-lang/roc/pull/7780">https://github.com/roc-lang/roc/pull/7780</a></p>



<a name="517556671"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/517556671" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#517556671">(May 12 2025 at 13:59)</a>:</h4>
<p>Parse and format <code>var</code> and <code>for</code> statements: <a href="https://github.com/roc-lang/roc/pull/7783">https://github.com/roc-lang/roc/pull/7783</a></p>



<a name="517557143"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/517557143" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#517557143">(May 12 2025 at 14:01)</a>:</h4>
<p>Unless something has been missed, the above should <em>functionally</em> complete the parser, parse IR, and formatter for the v0.1 syntax</p>



<a name="517559510"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/517559510" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#517559510">(May 12 2025 at 14:08)</a>:</h4>
<p>yoooooooo <span aria-label="heart eyes" class="emoji emoji-1f60d" role="img" title="heart eyes">:heart_eyes:</span><span aria-label="heart eyes" class="emoji emoji-1f60d" role="img" title="heart eyes">:heart_eyes:</span><span aria-label="heart eyes" class="emoji emoji-1f60d" role="img" title="heart eyes">:heart_eyes:</span></p>



<a name="517560804"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/517560804" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#517560804">(May 12 2025 at 14:11)</a>:</h4>
<p>now to find something difficult to work on <span aria-label="thinking" class="emoji emoji-1f914" role="img" title="thinking">:thinking:</span></p>



<a name="517561108"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/517561108" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#517561108">(May 12 2025 at 14:12)</a>:</h4>
<p>(and i want to make it very clear that the formatter style is still a WIP but it works, is stable, and loses no information)</p>



<a name="522219349"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/522219349" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#522219349">(Jun 03 2025 at 21:39)</a>:</h4>
<p><span class="user-mention silent" data-user-id="343810">Brendan Hansknecht</span> <a href="#narrow/channel/395097-compiler-development/topic/zig.20compiler.20-.20parser/near/505824596">said</a>:</p>
<blockquote>
<p>Ok, disabled all the extra reformatting and validation logic. So both codebases are just doing their parse to format loop. So should be more apples to apples now. We are still 3 to 5x faster with the new compiler (and 200x less memory).</p>
<div class="spoiler-block"><div class="spoiler-header">
<p>M1 Mac</p>
</div><div class="spoiler-content" aria-hidden="true">
<div class="codehilite" data-code-language="Bash"><pre><span></span><code>hyperfine<span class="w"> </span>-N<span class="w"> </span>-w<span class="w"> </span><span class="m">5</span><span class="w"> </span>-r<span class="w"> </span><span class="m">30</span><span class="w"> </span>--prepare<span class="w"> </span><span class="s1">'sync &amp;&amp; sudo purge'</span><span class="w"> </span><span class="s2">"roc format /tmp/old"</span><span class="w"> </span><span class="s2">"./zig-out/bin/roc format /tmp/new"</span>
Benchmark<span class="w"> </span><span class="m">1</span>:<span class="w"> </span>roc<span class="w"> </span>format<span class="w"> </span>/tmp/old
<span class="w">  </span>Time<span class="w"> </span><span class="o">(</span>mean<span class="w"> </span>±<span class="w"> </span>σ<span class="o">)</span>:<span class="w">     </span><span class="m">123</span>.8<span class="w"> </span>ms<span class="w"> </span>±<span class="w">   </span><span class="m">0</span>.6<span class="w"> </span>ms<span class="w">    </span><span class="o">[</span>User:<span class="w"> </span><span class="m">97</span>.7<span class="w"> </span>ms,<span class="w"> </span>System:<span class="w"> </span><span class="m">22</span>.8<span class="w"> </span>ms<span class="o">]</span>
<span class="w">  </span>Range<span class="w"> </span><span class="o">(</span>min<span class="w"> </span>…<span class="w"> </span>max<span class="o">)</span>:<span class="w">   </span><span class="m">122</span>.8<span class="w"> </span>ms<span class="w"> </span>…<span class="w"> </span><span class="m">125</span>.0<span class="w"> </span>ms<span class="w">    </span><span class="m">30</span><span class="w"> </span>runs

Benchmark<span class="w"> </span><span class="m">2</span>:<span class="w"> </span>./zig-out/bin/roc<span class="w"> </span>format<span class="w"> </span>/tmp/new
<span class="w">  </span>Time<span class="w"> </span><span class="o">(</span>mean<span class="w"> </span>±<span class="w"> </span>σ<span class="o">)</span>:<span class="w">      </span><span class="m">25</span>.8<span class="w"> </span>ms<span class="w"> </span>±<span class="w">   </span><span class="m">1</span>.0<span class="w"> </span>ms<span class="w">    </span><span class="o">[</span>User:<span class="w"> </span><span class="m">18</span>.5<span class="w"> </span>ms,<span class="w"> </span>System:<span class="w"> </span><span class="m">6</span>.6<span class="w"> </span>ms<span class="o">]</span>
<span class="w">  </span>Range<span class="w"> </span><span class="o">(</span>min<span class="w"> </span>…<span class="w"> </span>max<span class="o">)</span>:<span class="w">    </span><span class="m">25</span>.2<span class="w"> </span>ms<span class="w"> </span>…<span class="w">  </span><span class="m">30</span>.9<span class="w"> </span>ms<span class="w">    </span><span class="m">30</span><span class="w"> </span>runs

<span class="w">  </span>Warning:<span class="w"> </span>Statistical<span class="w"> </span>outliers<span class="w"> </span>were<span class="w"> </span>detected.<span class="w"> </span>Consider<span class="w"> </span>re-running<span class="w"> </span>this<span class="w"> </span>benchmark<span class="w"> </span>on<span class="w"> </span>a<span class="w"> </span>quiet<span class="w"> </span>system<span class="w"> </span>without<span class="w"> </span>any<span class="w"> </span>interferences<span class="w"> </span>from<span class="w"> </span>other<span class="w"> </span>programs.

Summary
<span class="w">  </span>./zig-out/bin/roc<span class="w"> </span>format<span class="w"> </span>/tmp/new<span class="w"> </span>ran
<span class="w">    </span><span class="m">4</span>.79<span class="w"> </span>±<span class="w"> </span><span class="m">0</span>.18<span class="w"> </span><span class="nb">times</span><span class="w"> </span>faster<span class="w"> </span>than<span class="w"> </span>roc<span class="w"> </span>format<span class="w"> </span>/tmp/old
</code></pre></div>
</div></div>
<div class="spoiler-block"><div class="spoiler-header">
<p>X86 Linux</p>
</div><div class="spoiler-content" aria-hidden="true">
<div class="codehilite" data-code-language="Bash"><pre><span></span><code>hyperfine<span class="w"> </span>--prepare<span class="w"> </span><span class="s1">'sync; echo 3 | sudo tee /proc/sys/vm/drop_caches'</span><span class="w"> </span>-w<span class="w"> </span><span class="m">5</span><span class="w"> </span>-r<span class="w"> </span><span class="m">30</span><span class="w"> </span><span class="s2">"./target/release/roc format /tmp/old"</span><span class="w"> </span><span class="s2">"./zig-out/bin/roc format /tmp/new"</span>
Benchmark<span class="w"> </span><span class="m">1</span>:<span class="w"> </span>./target/release/roc<span class="w"> </span>format<span class="w"> </span>/tmp/old
<span class="w">  </span>Time<span class="w"> </span><span class="o">(</span>mean<span class="w"> </span>±<span class="w"> </span>σ<span class="o">)</span>:<span class="w">     </span><span class="m">305</span>.8<span class="w"> </span>ms<span class="w"> </span>±<span class="w">  </span><span class="m">12</span>.1<span class="w"> </span>ms<span class="w">    </span><span class="o">[</span>User:<span class="w"> </span><span class="m">144</span>.9<span class="w"> </span>ms,<span class="w"> </span>System:<span class="w"> </span><span class="m">160</span>.3<span class="w"> </span>ms<span class="o">]</span>
<span class="w">  </span>Range<span class="w"> </span><span class="o">(</span>min<span class="w"> </span>…<span class="w"> </span>max<span class="o">)</span>:<span class="w">   </span><span class="m">293</span>.8<span class="w"> </span>ms<span class="w"> </span>…<span class="w"> </span><span class="m">345</span>.9<span class="w"> </span>ms<span class="w">    </span><span class="m">30</span><span class="w"> </span>runs

Benchmark<span class="w"> </span><span class="m">2</span>:<span class="w"> </span>./zig-out/bin/roc<span class="w"> </span>format<span class="w"> </span>/tmp/new
<span class="w">  </span>Time<span class="w"> </span><span class="o">(</span>mean<span class="w"> </span>±<span class="w"> </span>σ<span class="o">)</span>:<span class="w">      </span><span class="m">84</span>.4<span class="w"> </span>ms<span class="w"> </span>±<span class="w">   </span><span class="m">1</span>.3<span class="w"> </span>ms<span class="w">    </span><span class="o">[</span>User:<span class="w"> </span><span class="m">44</span>.7<span class="w"> </span>ms,<span class="w"> </span>System:<span class="w"> </span><span class="m">38</span>.6<span class="w"> </span>ms<span class="o">]</span>
<span class="w">  </span>Range<span class="w"> </span><span class="o">(</span>min<span class="w"> </span>…<span class="w"> </span>max<span class="o">)</span>:<span class="w">    </span><span class="m">82</span>.9<span class="w"> </span>ms<span class="w"> </span>…<span class="w">  </span><span class="m">88</span>.8<span class="w"> </span>ms<span class="w">    </span><span class="m">30</span><span class="w"> </span>runs

<span class="w">  </span>Warning:<span class="w"> </span>Statistical<span class="w"> </span>outliers<span class="w"> </span>were<span class="w"> </span>detected.<span class="w"> </span>Consider<span class="w"> </span>re-running<span class="w"> </span>this<span class="w"> </span>benchmark<span class="w"> </span>on<span class="w"> </span>a<span class="w"> </span>quiet<span class="w"> </span>system<span class="w"> </span>without<span class="w"> </span>any<span class="w"> </span>interferences<span class="w"> </span>from<span class="w"> </span>other<span class="w"> </span>programs.

Summary
<span class="w">  </span>./zig-out/bin/roc<span class="w"> </span>format<span class="w"> </span>/tmp/new<span class="w"> </span>ran
<span class="w">    </span><span class="m">3</span>.63<span class="w"> </span>±<span class="w"> </span><span class="m">0</span>.15<span class="w"> </span><span class="nb">times</span><span class="w"> </span>faster<span class="w"> </span>than<span class="w"> </span>./target/release/roc<span class="w"> </span>format<span class="w"> </span>/tmp/old
</code></pre></div>
<p></div></div><br>
</p>
</blockquote>
<p>I'm going on the Changelog podcast tomorrow, and it occurred to me that it would be cool to be able to talk about redoing these benchmarks now that we have a feature-complete parser and formatter!</p>



<a name="522219426"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/522219426" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#522219426">(Jun 03 2025 at 21:39)</a>:</h4>
<p>would be sweet to be able to have not only a comparison with the old compiler, but also something like "we can now parse the equivalent of _____ lines of code per second"</p>



<a name="522219621"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/522219621" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#522219621">(Jun 03 2025 at 21:41)</a>:</h4>
<p>I won't have time between now and then, but if anyone has time to run those benchmarks, would be great to have them! would be awesome to inspire some people to get involved if they're interested in helping out with a performance-focused compiler <span aria-label="smiley" class="emoji emoji-1f603" role="img" title="smiley">:smiley:</span></p>



<a name="522224680"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/522224680" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#522224680">(Jun 03 2025 at 22:19)</a>:</h4>
<p>i would love to see those numbers as well!  i don't have a lot of time at the moment but i'd love to brag about how much better we've made things</p>



<a name="522228899"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/522228899" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#522228899">(Jun 03 2025 at 22:47)</a>:</h4>
<p>if the existing benchmarks hold up it's 3.9M LOC/s</p>



<a name="522229182"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/522229182" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#522229182">(Jun 03 2025 at 22:50)</a>:</h4>
<p>oh and that's parse and formatting across 100 files</p>



<a name="522229431"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/522229431" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#522229431">(Jun 03 2025 at 22:51)</a>:</h4>
<p>That portends wonderful things for the LS as well</p>



<a name="522232548"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/522232548" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#522232548">(Jun 03 2025 at 23:19)</a>:</h4>
<p><span class="user-mention silent" data-user-id="781658">Anthony Bullard</span> <a href="#narrow/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser/near/522228899">said</a>:</p>
<blockquote>
<p>if the existing benchmarks hold up it's 3.9M LOC/s</p>
</blockquote>
<p>is that for parse <em>and</em> format?</p>



<a name="522232564"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/522232564" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#522232564">(Jun 03 2025 at 23:19)</a>:</h4>
<p>or just parse</p>



<a name="522232643"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/522232643" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#522232643">(Jun 03 2025 at 23:20)</a>:</h4>
<p>It says parse and format loop</p>



<a name="522232732"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/522232732" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#522232732">(Jun 03 2025 at 23:21)</a>:</h4>
<p>which means that includes at least a couple hundred sys calls for reading and writing files</p>



<a name="522232746"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/522232746" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#522232746">(Jun 03 2025 at 23:21)</a>:</h4>
<p>correct me if that's wrong <span class="user-mention" data-user-id="343810">@Brendan Hansknecht</span></p>



<a name="522235665"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/522235665" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#522235665">(Jun 03 2025 at 23:49)</a>:</h4>
<p>Yeah, parse and format. If I recall correctly, only about 20% is formatting....</p>



<a name="522235748"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/522235748" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#522235748">(Jun 03 2025 at 23:50)</a>:</h4>
<p>I probably could pull more updated numbers. Biggest caveat being I don't have real meaningful source code in both old and new parser syntax. Last time I was using a modified syntax grab bag which is not that much like real world code.</p>



<a name="522235797"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/522235797" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#522235797">(Jun 03 2025 at 23:51)</a>:</h4>
<p>Could Claude generate some realistic source code?</p>



<a name="522235800"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/522235800" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#522235800">(Jun 03 2025 at 23:51)</a>:</h4>
<p>I know we wanted to make the old parser auto update, but feature like abilities make the standard library fail to port over.</p>



<a name="522235813"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/522235813" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#522235813">(Jun 03 2025 at 23:51)</a>:</h4>
<p>is the rust compiler v0.1 migrator finished?</p>



<a name="522235830"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/522235830" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#522235830">(Jun 03 2025 at 23:51)</a>:</h4>
<p><span class="user-mention" data-user-id="453336">@Joshua Warner</span></p>



<a name="522235849"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/522235849" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#522235849">(Jun 03 2025 at 23:52)</a>:</h4>
<p>I think it is mostly there but has edge cases and clearly can't handle things like abilities.</p>



<a name="522235858"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/522235858" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#522235858">(Jun 03 2025 at 23:52)</a>:</h4>
<p>we could try to just find a number of source files in different projects that succeed</p>



<a name="522235891"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/522235891" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#522235891">(Jun 03 2025 at 23:52)</a>:</h4>
<p><span class="user-mention" data-user-id="281383">@Richard Feldman</span> when do you need the numbers by?</p>



<a name="522235957"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/522235957" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#522235957">(Jun 03 2025 at 23:53)</a>:</h4>
<p><span class="user-mention silent" data-user-id="281383">Richard Feldman</span> <a href="#narrow/channel/395097-compiler-development/topic/zig.20compiler.20-.20parser/near/522219349">said</a>:</p>
<blockquote>
<p>I'm going on the Changelog podcast tomorrow...</p>
</blockquote>



<a name="522236040"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/522236040" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#522236040">(Jun 03 2025 at 23:54)</a>:</h4>
<p>I think we can give the existing numbers as showing at least the order of magnitude</p>



<a name="522236050"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/522236050" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#522236050">(Jun 03 2025 at 23:54)</a>:</h4>
<p>and caveat it</p>



<a name="522236900"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/522236900" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#522236900">(Jun 04 2025 at 00:02)</a>:</h4>
<p><span class="user-mention" data-user-id="343810">@Brendan Hansknecht</span> noon Pacific is when the recording starts</p>



<a name="522245681"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/522245681" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#522245681">(Jun 04 2025 at 01:33)</a>:</h4>
<p>Just testing the formatter now to see if I can get more meaningful code migrated (like some of the builtins).</p>
<p>Definitely a few pieces missing for migration:</p>
<ol>
<li>abilities (no fix cause they just don't exist)</li>
<li>wildcard types (those can just become an abitrary letter)</li>
<li>pizza op (that should be able to turn into static dispatch)</li>
</ol>
<p>I still will try to manually convert some things and see how it goes.</p>



<a name="522246128"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/522246128" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#522246128">(Jun 04 2025 at 01:38)</a>:</h4>
<p>hmm...something also definitely goes wrong with closures and braces.</p>



<a name="522247113"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/522247113" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#522247113">(Jun 04 2025 at 01:48)</a>:</h4>
<p>Also <span class="user-mention" data-user-id="781658">@Anthony Bullard</span>, found a parser bug. This definitely should parse:</p>
<div class="codehilite"><pre><span></span><code>expect {
    foo : U32
    foo = 1 # This should work too
    blah = 1
    blah == foo
}
</code></pre></div>
<p>Specifically the <code>foo : U32</code> line breaks parsing.</p>



<a name="522247287"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/522247287" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#522247287">(Jun 04 2025 at 01:50)</a>:</h4>
<p>surprising that it doesn't</p>



<a name="522247325"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/522247325" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#522247325">(Jun 04 2025 at 01:50)</a>:</h4>
<p>i thought i had a similar test</p>



<a name="522247335"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/522247335" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#522247335">(Jun 04 2025 at 01:50)</a>:</h4>
<p>is it the U32?</p>



<a name="522247540"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/522247540" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#522247540">(Jun 04 2025 at 01:53)</a>:</h4>
<p>I don't think so. I hit it with <code>List(a)</code> first.</p>



<a name="522247565"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/522247565" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#522247565">(Jun 04 2025 at 01:53)</a>:</h4>
<p>Some reason it seems to expect the <code>expect</code> to end right after that line.</p>



<a name="522247780"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/522247780" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#522247780">(Jun 04 2025 at 01:55)</a>:</h4>
<p>ah it must think it's a record literal</p>



<a name="522247840"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/522247840" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#522247840">(Jun 04 2025 at 01:56)</a>:</h4>
<p>that shouldn't happen. i check for this and bail out of a record and parse it as a block</p>



<a name="522247878"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/522247878" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#522247878">(Jun 04 2025 at 01:56)</a>:</h4>
<p>I can take a look in the morning but that's the best i can do</p>



<a name="522247901"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/522247901" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#522247901">(Jun 04 2025 at 01:56)</a>:</h4>
<p>Yeah, I don't need it fixed, just noting it</p>



<a name="522247957"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/522247957" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#522247957">(Jun 04 2025 at 01:57)</a>:</h4>
<p>ok sorry about that</p>



<a name="522247979"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/522247979" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#522247979">(Jun 04 2025 at 01:57)</a>:</h4>
<p>i'll add the above as a snapshot and makes sure it parses</p>



<a name="522248022"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/522248022" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#522248022">(Jun 04 2025 at 01:58)</a>:</h4>
<p>One other question for you, does the new zig compiler attempt to parse thing like <code>List a</code> and convert to <code>List(a)</code>?</p>



<a name="522248966"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/522248966" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#522248966">(Jun 04 2025 at 02:07)</a>:</h4>
<p>I don't think we should try to do that honestly</p>



<a name="522249004"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/522249004" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#522249004">(Jun 04 2025 at 02:07)</a>:</h4>
<p>I think the amount of complexity wouldn't be worth it, considering LLMs can now do that sort of migration well enough <span aria-label="smile" class="emoji emoji-1f604" role="img" title="smile">:smile:</span></p>



<a name="522249073"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/522249073" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#522249073">(Jun 04 2025 at 02:08)</a>:</h4>
<p>and I remember a conversation where we discussed that if we knew the new parser didn't need to support whitespace application at all, it would significantly simplify several areas</p>



<a name="522249139"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/522249139" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#522249139">(Jun 04 2025 at 02:08)</a>:</h4>
<p>yeah no white space application at all</p>



<a name="522249552"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/522249552" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#522249552">(Jun 04 2025 at 02:13)</a>:</h4>
<p>love the idea of parsing the stdlib as a point of comparison btw! <span aria-label="smiley" class="emoji emoji-1f603" role="img" title="smiley">:smiley:</span></p>



<a name="522250571"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/522250571" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#522250571">(Jun 04 2025 at 02:25)</a>:</h4>
<p>Yeah, just was curious cause in the half migrated list.roc file I have it has some cases where it doesn't seem to care about <code>List a</code> but others where it does care....no idea why.</p>



<a name="522251019"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/522251019" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#522251019">(Jun 04 2025 at 02:30)</a>:</h4>
<blockquote>
<p>love the idea of parsing the stdlib as a point of comparison btw!</p>
</blockquote>
<p>Yeah, just not sure if I can port the stdlib in time to get meaningful numbers. Theoretically an llm might be able to help, but they definitely don't know roc currently.</p>



<a name="522251072"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/522251072" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#522251072">(Jun 04 2025 at 02:31)</a>:</h4>
<p>Doesn't have to be a fully functional port, but at least needs to parse and format.</p>



<a name="522251085"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/522251085" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#522251085">(Jun 04 2025 at 02:31)</a>:</h4>
<p>ah yeah I guess we don't have an equivalent of <a href="https://www.roc-lang.org/builtins/llms.txt">https://www.roc-lang.org/builtins/llms.txt</a> for the new syntax</p>



<a name="522251108"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/522251108" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#522251108">(Jun 04 2025 at 02:31)</a>:</h4>
<p>could try giving it some basic examples but maybe not enough</p>



<a name="522251123"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/522251123" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#522251123">(Jun 04 2025 at 02:31)</a>:</h4>
<p>or like tests in the source code maybe?</p>



<a name="522251917"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/522251917" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#522251917">(Jun 04 2025 at 02:40)</a>:</h4>
<p>Oh, one other parser bug found. The new parser doesn't understand doc comments <code>## ...</code></p>



<a name="522251975"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/522251975" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#522251975">(Jun 04 2025 at 02:41)</a>:</h4>
<p>that's super easy to add. i thought the tokenizer handled that</p>



<a name="522252072"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/522252072" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#522252072">(Jun 04 2025 at 02:42)</a>:</h4>
<p>we definitely don't have a concept of a doc comment in the parser because the parser doesn't know about comments at all</p>



<a name="522252123"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/522252123" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#522252123">(Jun 04 2025 at 02:43)</a>:</h4>
<p>Ah yeah, fair</p>



<a name="522252157"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/522252157" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#522252157">(Jun 04 2025 at 02:43)</a>:</h4>
<p>either way should be very straight forward</p>



<a name="522252203"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/522252203" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#522252203">(Jun 04 2025 at 02:44)</a>:</h4>
<p>there's a function called chompTrivia that handles it i believe</p>



<a name="522252220"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/522252220" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#522252220">(Jun 04 2025 at 02:44)</a>:</h4>
<p>in the tokenizer</p>



<a name="522252919"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/522252919" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#522252919">(Jun 04 2025 at 02:51)</a>:</h4>
<p>Also, to note, I think it is may just be the formatting that needs to be fixed. Outputs <code># # ...</code></p>



<a name="522253049"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/522253049" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#522253049">(Jun 04 2025 at 02:53)</a>:</h4>
<p>we may need to start keeping doc comments (although not regular ones) around for parsing so we can parse their markdown but yeah</p>



<a name="522262574"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/522262574" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#522262574">(Jun 04 2025 at 04:33)</a>:</h4>
<p>Hmm, looks like we are missing record destructuring in the new syntax:<br>
<code>{ start, end, step } = rec</code><br>
<code>expr_unexpected_token, at token OpAssign at ...</code></p>



<a name="522263269"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/522263269" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#522263269">(Jun 04 2025 at 04:40)</a>:</h4>
<p>And maybe missing guards on match statements.<br>
<code>[x, .. as rest] if x == delimiter =&gt;</code><br>
<code>expr_unexpected_token, at token OpFatArrow at ...</code></p>



<a name="522266799"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/522266799" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#522266799">(Jun 04 2025 at 05:17)</a>:</h4>
<p>Ok, so I ported over List.roc. I think it is a reasonably representative file for well documented roc code. It is about ~800 LOC and ~800 lines of comments/blank/bracket only.<br>
The new version is about 100 lines of brackets more than the old version. That said, total byte count is pretty similar. I padded the old roc file with an extra comment to make them the exact same number of bytes.</p>
<p>All numbers on M1 mac</p>
<div class="spoiler-block"><div class="spoiler-header">
<p>Formatting 1000 files that are all List.roc</p>
</div><div class="spoiler-content" aria-hidden="true">
<p>3.2x faster<br>
1000x less memory</p>
<hr>
<p>460ms total<br>
65% of time is reading files, tokenize, and parse<br>
So...<br>
~1,600,000 lines parsed  in ~300ms (~5 million lines per second)<br>
~800,000 lines of actual code parsed (~2.5 million lines of code per second)</p>
<p>Note, many lines of code are still really short, so it may not be the most representative.</p>
<hr>
<p>Raw times:</p>
<div class="codehilite"><pre><span></span><code>Benchmark 1: ./roc-rust format old-list/
  Time (mean ± σ):      1.498 s ±  0.037 s    [User: 1.200 s, System: 0.245 s]
  Range (min … max):    1.438 s …  1.574 s    10 runs

Benchmark 2: ./roc-zig format new-list/
  Time (mean ± σ):     464.9 ms ±   6.1 ms    [User: 374.0 ms, System: 86.1 ms]
  Range (min … max):   457.4 ms … 475.4 ms    10 runs

Summary
  ./roc-zig format new-list/ ran
    3.22 ± 0.09 times faster than ./roc-rust format old-list/
</code></pre></div>
</div></div>
<div class="spoiler-block"><div class="spoiler-header">
<p>Formatting List.roc single file with 1000x the body size</p>
</div><div class="spoiler-content" aria-hidden="true">
<p>3.6x faster<br>
6x less memory</p>
<hr>
<p>390ms total<br>
65% of time is reading files, tokenize, and parse<br>
So...<br>
~1,600,000 lines parsed  in ~250ms (~6.4 million lines per second)<br>
~800,000 lines of actual code parsed (~3.2 million lines of code per second)</p>
<p>Note, many lines of code are still really short, so it may not be the most representative.</p>
<hr>
<p>Raw times:</p>
<div class="codehilite"><pre><span></span><code>Benchmark 1: ./roc-rust format Old-List.roc
  Time (mean ± σ):      1.384 s ±  0.018 s    [User: 1.182 s, System: 0.165 s]
  Range (min … max):    1.357 s …  1.421 s    10 runs

Benchmark 2: ./roc-zig format New-List.roc
  Time (mean ± σ):     384.9 ms ±  10.9 ms    [User: 305.3 ms, System: 60.0 ms]
  Range (min … max):   372.3 ms … 400.2 ms    10 runs

Summary
  ./roc-zig format New-List.roc ran
    3.59 ± 0.11 times faster than ./roc-rust format Old-List.roc
</code></pre></div>
</div></div>
<p>Also, definitely room for more gains like making chomptrivia faster.</p>



<a name="522267073"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/522267073" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#522267073">(Jun 04 2025 at 05:20)</a>:</h4>
<p><span class="user-mention" data-user-id="281383">@Richard Feldman</span> here are some rough numbers just based on <code>List.roc</code>.</p>
<p>Clearly we leak memory with every new file in the old rust compiler.</p>
<p>Also, big numbers that matter:<br>
~3 to 4x faster than rust compiler (parse and format combined)<br>
~2 to 3 millions lines of code parsed per second<br>
~5 to 6 millions lines per second when including comments, bracket only, and blank lines</p>



<a name="522267878"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/522267878" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#522267878">(Jun 04 2025 at 05:29)</a>:</h4>
<blockquote>
<p>making chomptrivia faster</p>
</blockquote>
<p>Nice, sounds like a fun project <span aria-label="racecar" class="emoji emoji-1f3ce" role="img" title="racecar">:racecar:</span></p>



<a name="522268422"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/522268422" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#522268422">(Jun 04 2025 at 05:35)</a>:</h4>
<p>Yeah, chomp trivia and string interning are the two things that stick out most.</p>



<a name="522268618"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/522268618" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#522268618">(Jun 04 2025 at 05:36)</a>:</h4>
<p>The plan is to do some SIMD stuff there? It sounds like it might be a really contained side project. Would it be too early to explore that now?</p>



<a name="522269380"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/522269380" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#522269380">(Jun 04 2025 at 05:44)</a>:</h4>
<p>Someone could definitely do this now if they are interested.</p>



<a name="522282841"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/522282841" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#522282841">(Jun 04 2025 at 07:17)</a>:</h4>
<p>I had an initial stab at it... <a href="https://github.com/roc-lang/roc/pull/7815">https://github.com/roc-lang/roc/pull/7815</a> </p>
<p><span class="user-mention" data-user-id="343810">@Brendan Hansknecht</span> can you share your <code>List.roc</code> file so I can test this.</p>



<a name="522325660"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/522325660" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#522325660">(Jun 04 2025 at 10:48)</a>:</h4>
<p>I don't know enough about SIMD to really review your implementation <span class="user-mention" data-user-id="515757">@Luke Boswell</span> but it looks good to me, thank you for adding tests to check correctness!</p>



<a name="522327314"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/522327314" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#522327314">(Jun 04 2025 at 10:57)</a>:</h4>
<p><span class="user-mention silent" data-user-id="343810">Brendan Hansknecht</span> <a href="#narrow/channel/395097-compiler-development/topic/zig.20compiler.20-.20parser/near/522262574">said</a>:</p>
<blockquote>
<p>Hmm, looks like we are missing record destructuring in the new syntax:<br>
<code>{ start, end, step } = rec</code><br>
<code>expr_unexpected_token, at token OpAssign at ...</code></p>
</blockquote>
<p>Can you share the overall file and I'll add it as a snapshot that I can fill in gaps.  To be clear, this is supposed to be supported.  I can see from even syntax grab bag (and verified by looking at Parser.parseStmt) that I must have just forgotten to look for OpenCurly and OpenSquare in the statement position to check them being used as a pattern before sending it over to parseExpr.</p>



<a name="522327419"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/522327419" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#522327419">(Jun 04 2025 at 10:57)</a>:</h4>
<p>And the match guards were also just for some reason not on my check list</p>



<a name="522466615"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/522466615" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#522466615">(Jun 04 2025 at 23:11)</a>:</h4>
<p>the Changelog episode recording went great, and I used the numbers in it - thanks for doing those <span class="user-mention" data-user-id="343810">@Brendan Hansknecht</span> and thanks for getting the parser and formatter to the point where we could actually compile a whole builtin module with them <span class="user-mention" data-user-id="781658">@Anthony Bullard</span>! <span aria-label="heart eyes" class="emoji emoji-1f60d" role="img" title="heart eyes">:heart_eyes:</span></p>



<a name="522466628"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/522466628" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#522466628">(Jun 04 2025 at 23:11)</a>:</h4>
<p>episode should be out in a week or two</p>



<a name="522471072"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/522471072" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#522471072">(Jun 04 2025 at 23:58)</a>:</h4>
<p><span class="user-mention" data-user-id="515757">@Luke Boswell</span> I ran it on a folder with 1000 copies of this file<br>
<a href="/user_uploads/22008/sv6AHKywaGY_sylPtBrceLmq/file_1.roc">file_1.roc</a></p>



<a name="522471131"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/522471131" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#522471131">(Jun 04 2025 at 23:59)</a>:</h4>
<p>and a version of it that just duplicated the body 1000 times</p>



<a name="522471158"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/522471158" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#522471158">(Jun 04 2025 at 23:59)</a>:</h4>
<p><a href="/user_uploads/22008/HUEdGmz489ctTJCID5KuYvck/New-List.roc">New-List.roc</a></p>



<a name="522471515"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/522471515" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#522471515">(Jun 05 2025 at 00:02)</a>:</h4>
<blockquote>
<p>Can you share the overall file and I'll add it as a snapshot that I can fill in gaps.</p>
</blockquote>
<p>I ended up removing everything that caused a problem in order to get it compiling.... I can try to find and re-add all the things that broke the tokenizer/parser. Might not have time to do so tonight though. Should just be the two issues I mentioned above and then many commented out type annotations.</p>



<a name="522471735"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/522471735" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#522471735">(Jun 05 2025 at 00:04)</a>:</h4>
<p>This is good. Thank you. I'm currently rewriting a bunch of things. I've been experimenting with the LLM workflow, and it's amazing how useful but also unhelpful the AI can be. It gives code that looks pretty good but can be totally useless. I'm rebuilding my test cases to ensure it's working correctly.</p>



<a name="522472486"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/522472486" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#522472486">(Jun 05 2025 at 00:13)</a>:</h4>
<blockquote>
<p>Might not have time to do so tonight though</p>
</blockquote>
<p>Actually, I am confused on what day it is. I should have time tonight, don't have time tomorrow night. I'll try to skim through the file and re-add the various pieces I had to remove.</p>



<a name="522479982"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/522479982" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#522479982">(Jun 05 2025 at 01:35)</a>:</h4>
<p><span class="user-mention" data-user-id="781658">@Anthony Bullard</span> I think this file should work for your snapshot test. Also, beyond just making parse, definitely needs some formatting cleanup.<br>
Edit: newer version of file with another fix.<br>
<a href="/user_uploads/22008/UNMXULNfklsoT0CzAok4LY9c/List.roc">List.roc</a></p>



<a name="522480068"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/522480068" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#522480068">(Jun 05 2025 at 01:35)</a>:</h4>
<p>For example:</p>
<div class="codehilite" data-code-language="Ruby"><pre><span></span><code><span class="n">walk_backwards_help</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">|</span><span class="n">list</span><span class="p">,</span><span class="w"> </span><span class="n">state</span><span class="p">,</span><span class="w"> </span><span class="n">f</span><span class="p">,</span><span class="w"> </span><span class="n">index_plus_one</span><span class="o">|</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="n">index_plus_one</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span>
<span class="w">        </span><span class="n">state</span>
<span class="w">            </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="n">index</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="no">Num</span><span class="o">.</span><span class="n">sub_wrap</span><span class="p">(</span><span class="n">index_plus_one</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span>
<span class="w">                </span><span class="n">next_state</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">f</span><span class="p">(</span><span class="n">state</span><span class="p">,</span><span class="w"> </span><span class="n">get_unsafe</span><span class="p">(</span><span class="n">list</span><span class="p">,</span><span class="w"> </span><span class="n">index</span><span class="p">))</span>

<span class="w">                </span><span class="n">walk_backwards_help</span><span class="p">(</span><span class="n">list</span><span class="p">,</span><span class="w"> </span><span class="n">next_state</span><span class="p">,</span><span class="w"> </span><span class="n">f</span><span class="p">,</span><span class="w"> </span><span class="n">index</span><span class="p">)</span>
<span class="w">            </span><span class="p">}</span>
</code></pre></div>



<a name="522489818"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/522489818" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#522489818">(Jun 05 2025 at 03:17)</a>:</h4>
<p>I keep remembering ...oh, and one more thing for this.... In the new compiler we don't allow <code>_intionally_named_but_ignored</code>. It has to just be <code>_</code>. Was this intentional? I like named ignored variables, but maybe not everyone does and we decided to remove it?</p>



<a name="522490287"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/522490287" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#522490287">(Jun 05 2025 at 03:23)</a>:</h4>
<p>I think its meant to be the same, i.e. <code>_named_ignored_thing</code> is still valid. It's probably just been overlooked/not implemented yet.</p>



<a name="522741734"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/522741734" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anton <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#522741734">(Jun 06 2025 at 09:44)</a>:</h4>
<p><span class="user-mention silent" data-user-id="515757">Luke Boswell</span> <a href="#narrow/channel/395097-compiler-development/topic/zig.20compiler.20-.20parser/near/522268618">said</a>:</p>
<blockquote>
<p>The plan is to do some SIMD stuff there? It sounds like it might be a really contained side project. Would it be too early to explore that now?</p>
</blockquote>
<p>I followed the updates and PR on this, but I think it's too early for SIMD, I would not add serious complexity to code that is still expected to change and not a bottleneck.</p>



<a name="522743137"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/522743137" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#522743137">(Jun 06 2025 at 09:52)</a>:</h4>
<p>I agree. It was fun to explore a little, but turned out to be a little more complicated than I thought.</p>



<a name="522790968"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/522790968" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#522790968">(Jun 06 2025 at 14:33)</a>:</h4>
<p><span class="user-mention silent" data-user-id="361169">Anton</span> <a href="#narrow/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser/near/522741734">said</a>:</p>
<blockquote>
<p>I followed the updates and PR on this, but I think it's too early for SIMD, I would not add serious complexity to code that is still expected to change and not a bottleneck.</p>
</blockquote>
<p>Luckily, chomp trivia is not still expected to change and is a bottleneck.</p>



<a name="522791067"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/522791067" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#522791067">(Jun 06 2025 at 14:34)</a>:</h4>
<p>It also is such a small chunk of code that it would be trivial to switch back if we need</p>



<a name="522791169"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/522791169" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#522791169">(Jun 06 2025 at 14:34)</a>:</h4>
<p>I think small localized optimizations like this should be totally fine.</p>



<a name="522791681"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/522791681" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#522791681">(Jun 06 2025 at 14:37)</a>:</h4>
<p>I say this more in terms of, people should feel free to explore optimizations and we should definitely accept them if they are small and self contained. Don't want to block that energy.</p>



<a name="522797594"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/522797594" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anton <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#522797594">(Jun 06 2025 at 15:07)</a>:</h4>
<p>I agree, I forgot that this was about <code>chompTrivia</code> specifically</p>



<a name="522800362"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/522800362" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anton <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#522800362">(Jun 06 2025 at 15:24)</a>:</h4>
<p>For the bottleneck I was thinking about parsing not being a bottleneck in compilation but yeah small, self-contained and not expected to change sounds good</p>



<a name="522801180"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/522801180" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#522801180">(Jun 06 2025 at 15:29)</a>:</h4>
<p>Yeah, for dev with an interpreter, will be interesting to see the bottlenecks</p>



<a name="522801303"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/522801303" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#522801303">(Jun 06 2025 at 15:30)</a>:</h4>
<p>Also, I guess formatting a ton of files is another workflow we want to be super fast</p>



<a name="522801375"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/522801375" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#522801375">(Jun 06 2025 at 15:30)</a>:</h4>
<p>But yeah, in general I agree</p>



<a name="522980342"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/522980342" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#522980342">(Jun 08 2025 at 14:27)</a>:</h4>
<p><span class="user-mention silent" data-user-id="281383">Richard Feldman</span> <a href="#narrow/channel/395097-compiler-development/topic/zig.20compiler.20-.20parser/near/522466615">said</a>:</p>
<blockquote>
<p>the Changelog episode recording went great, and I used the numbers in it - thanks for doing those <span class="user-mention silent" data-user-id="343810">Brendan Hansknecht</span> and thanks for getting the parser and formatter to the point where we could actually compile a whole builtin module with them <span class="user-mention silent" data-user-id="781658">Anthony Bullard</span>! <span aria-label="heart eyes" class="emoji emoji-1f60d" role="img" title="heart eyes">:heart_eyes:</span></p>
</blockquote>
<p>Can't wait to see it myself!</p>



<a name="524998040"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/524998040" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#524998040">(Jun 20 2025 at 08:24)</a>:</h4>
<p>I've noticed we don't parse tuple patterns... are these planned but just not implemented yet?</p>
<h1>Analysis from Claude</h1>
<p>The parser only looks for pattern assignments when it sees a <code>LowerIdent</code> token. For tuple patterns starting with <code>(</code>, it falls through to the default case where it parses an expression statement instead of a pattern assignment.</p>
<p>To fix this, we would need to:</p>
<ol>
<li>Add a case for <code>.OpenRound</code> and <code>.NoSpaceOpenRound</code> in <code>parseStmtByType</code> </li>
<li>Try to parse a pattern, then check if it's followed by <code>OpAssign</code></li>
<li>If so, create a <code>.decl</code> statement with the pattern</li>
</ol>
<p>However, this approach has a problem: we'd need to look ahead quite a bit to determine if we have a pattern assignment vs just a tuple expression. A better approach might be to:</p>
<ol>
<li>In the default case (where expressions are parsed), after parsing an expression, check if it's followed by <code>OpAssign</code></li>
<li>If so, try to convert the expression to a pattern (or report an error if it can't be converted)</li>
<li>Then parse the RHS and create a <code>.decl</code> statement</li>
</ol>
<p>This is likely why the current parser implementation only supports simple identifier patterns in assignments - handling complex patterns requires either significant lookahead or the ability to convert expressions to patterns after parsing.</p>
<p>The snapshot shows this limitation clearly - tuple "patterns" are being parsed as tuple expressions, leading to the "expr_unexpected_token" error when the parser encounters the <code>=</code> sign.</p>
<h2>Snapshot</h2>
<p>I thought these would be supported, but I think they haven't been implemented in the Parser yet </p>
<div class="codehilite"><pre><span></span><code>~~~META
description=Tuple pattern matching tests
type=expr
~~~SOURCE
{

    # Simple tuple destructuring
    (x, y) = (1, 2)

    # Nested tuple patterns
    ((a, b), (c, d)) = ((10, 20), (30, 40))

    # Mixed patterns with literals
    (first, second, third) = (100, 42, 200)

    # Tuple with string and tag patterns
    (name, string, boolean) = (&quot;Alice&quot;, &quot;fixed&quot;, True)

    # Tuple with list pattern
    (list, hello) = ([1, 2, 3], &quot;hello&quot;)

    {}
}
</code></pre></div>



<a name="525099923"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/525099923" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#525099923">(Jun 20 2025 at 20:28)</a>:</h4>
<p>check the syntax grab bag snapshot</p>



<a name="525099931"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/525099931" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#525099931">(Jun 20 2025 at 20:29)</a>:</h4>
<p>that's all of the implemented syntax</p>



<a name="525099945"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/525099945" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#525099945">(Jun 20 2025 at 20:29)</a>:</h4>
<p>if tuples aren't there i think it was an oversight</p>



<a name="525104893"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/525104893" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#525104893">(Jun 20 2025 at 21:22)</a>:</h4>
<p>I think it is specifically for pattern matching that they aren't implemented.</p>



<a name="525104922"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/525104922" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#525104922">(Jun 20 2025 at 21:22)</a>:</h4>
<p>I mentioned this a while ago in this thread when porting List.roc over</p>



<a name="525105733"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/525105733" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#525105733">(Jun 20 2025 at 21:31)</a>:</h4>
<p>should be trivial to fix, but it would be MUCH easier for all of this if decls started with a keyword <span aria-label="rolling on the floor laughing" class="emoji emoji-1f923" role="img" title="rolling on the floor laughing">:rolling_on_the_floor_laughing:</span></p>



<a name="525107861"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/525107861" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#525107861">(Jun 20 2025 at 21:53)</a>:</h4>
<p>Like <code>let</code>? What are you thinking</p>



<a name="525107869"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/525107869" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#525107869">(Jun 20 2025 at 21:53)</a>:</h4>
<p>yeah</p>



<a name="525109274"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/525109274" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#525109274">(Jun 20 2025 at 22:11)</a>:</h4>
<p>this is how we end up with nice syntax: we do the thing that's nicer for the end user but harder for the compiler authors <span aria-label="grinning face with smiling eyes" class="emoji emoji-1f601" role="img" title="grinning face with smiling eyes">:grinning_face_with_smiling_eyes:</span></p>



<a name="525109654"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/525109654" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#525109654">(Jun 20 2025 at 22:16)</a>:</h4>
<p>oh totally!  not suggesting we SHOULD</p>



<a name="525109833"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/525109833" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#525109833">(Jun 20 2025 at 22:18)</a>:</h4>
<p>just stating the simple fact that patterns in decls with no keywords that are almost indistinguishable from a expr of the same shape until you find the equal sign is complicated specifically for things like lists and tuples</p>



<a name="525109872"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/525109872" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#525109872">(Jun 20 2025 at 22:18)</a>:</h4>
<p>with a record i know after two tokens</p>



<a name="525109939"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/525109939" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#525109939">(Jun 20 2025 at 22:19)</a>:</h4>
<p>ah for sure!</p>



<a name="525109943"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/525109943" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#525109943">(Jun 20 2025 at 22:19)</a>:</h4>
<p>but lists and tuples patterns can mean a theoretically unbounded lookahead</p>



<a name="525110343"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/525110343" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#525110343">(Jun 20 2025 at 22:24)</a>:</h4>
<p>What do you think of Claude's suggestion </p>
<blockquote>
<p>handling complex patterns requires either significant lookahead or the ability to convert expressions to patterns after parsing.</p>
</blockquote>
<p>Could we convert it from an expression to pattern in Can?</p>



<a name="525111563"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/525111563" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#525111563">(Jun 20 2025 at 22:41)</a>:</h4>
<p>possibly</p>



<a name="525111617"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/525111617" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Warner <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#525111617">(Jun 20 2025 at 22:42)</a>:</h4>
<p>FWIW I’d actually like to have the same underlying ast nodes be reused for exprs and patterns</p>



<a name="525111623"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/525111623" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#525111623">(Jun 20 2025 at 22:42)</a>:</h4>
<p>but i think it would be a pain, but i can look at it</p>



<a name="525111644"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/525111644" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Warner <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#525111644">(Jun 20 2025 at 22:42)</a>:</h4>
<p>That way we don’t have to convert (only verify)</p>



<a name="525111712"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/525111712" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#525111712">(Jun 20 2025 at 22:43)</a>:</h4>
<p><span class="user-mention silent" data-user-id="453336">Joshua Warner</span> <a href="#narrow/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser/near/525111617">said</a>:</p>
<blockquote>
<p>FWIW I’d actually like to have the same underlying ast nodes be reused for exprs and patterns</p>
</blockquote>
<p>there'd have to be near perfect symmetry between them for me to roll that way. i can take a look at that tomorrow</p>



<a name="525111727"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/525111727" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#525111727">(Jun 20 2025 at 22:43)</a>:</h4>
<p>it would unlock some nice characteristics</p>



<a name="525111736"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/525111736" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#525111736">(Jun 20 2025 at 22:43)</a>:</h4>
<p>really removing the need for lookahead at all</p>



<a name="525112265"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/525112265" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#525112265">(Jun 20 2025 at 22:51)</a>:</h4>
<p>the only issue i can think of off top is alternates</p>



<a name="525112286"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/525112286" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Warner <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#525112286">(Jun 20 2025 at 22:51)</a>:</h4>
<p>There’s not a perfect symmetry, but it’s close enough to be useful IMO. The only alternative is allowing conversions, which I think will end up being a bit costly from a perf perspective</p>



<a name="525112301"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/525112301" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#525112301">(Jun 20 2025 at 22:52)</a>:</h4>
<p>like <code>Foo(1 | 2)</code></p>



<a name="525112324"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/525112324" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Warner <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#525112324">(Jun 20 2025 at 22:52)</a>:</h4>
<p>Alternates can’t occur in expr position anyway (at the start of a statement)</p>



<a name="525112409"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/525112409" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#525112409">(Jun 20 2025 at 22:53)</a>:</h4>
<p>yeah but i wouldn't want to underfit the node to support something for this kind of pattern that's also used for exprs</p>



<a name="525112452"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/525112452" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Warner <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#525112452">(Jun 20 2025 at 22:54)</a>:</h4>
<p>Oh to be clear I’m taking about the internal node types being shared, not the types exposed to the rest of the compiler</p>



<a name="525112486"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/525112486" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#525112486">(Jun 20 2025 at 22:55)</a>:</h4>
<p>i mean all nodes internally are identical</p>



<a name="525112521"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/525112521" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Warner <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#525112521">(Jun 20 2025 at 22:55)</a>:</h4>
<p>Right, but expressions and patterns should use the same node type IDs ￼</p>



<a name="525112549"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/525112549" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Warner <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#525112549">(Jun 20 2025 at 22:56)</a>:</h4>
<p>We can then translate them into different public e￼numeration types, depending on the context</p>



<a name="525112556"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/525112556" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#525112556">(Jun 20 2025 at 22:56)</a>:</h4>
<p>it's just the different tags and how those tags affect the interpretation of the data and extra data</p>



<a name="525112580"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/525112580" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Warner <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#525112580">(Jun 20 2025 at 22:56)</a>:</h4>
<p>Yep, so the same internal tags, but different external enumerations ￼</p>



<a name="525112593"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/525112593" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#525112593">(Jun 20 2025 at 22:56)</a>:</h4>
<p>so all use expr ids</p>



<a name="525112606"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/525112606" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#525112606">(Jun 20 2025 at 22:56)</a>:</h4>
<p>but you get / set with specific functions for pattern or expr?</p>



<a name="525112626"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/525112626" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Warner <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#525112626">(Jun 20 2025 at 22:57)</a>:</h4>
<p>I was matching we would also have a pattern ID that sneaky uses the same ID space as expression IDs</p>



<a name="525112637"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/525112637" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Warner <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#525112637">(Jun 20 2025 at 22:57)</a>:</h4>
<p>Sneakily</p>



<a name="525112655"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/525112655" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#525112655">(Jun 20 2025 at 22:57)</a>:</h4>
<p>they all have the same address space</p>



<a name="525112683"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/525112683" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#525112683">(Jun 20 2025 at 22:57)</a>:</h4>
<p>they are all just integer offsets into a single array list</p>



<a name="525112714"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/525112714" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Warner <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#525112714">(Jun 20 2025 at 22:58)</a>:</h4>
<p>Errrr… right, I forgot about that.</p>



<a name="525112746"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/525112746" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#525112746">(Jun 20 2025 at 22:58)</a>:</h4>
<p>so this shouldn't be two hard at all</p>



<a name="525112767"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/525112767" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Warner <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#525112767">(Jun 20 2025 at 22:59)</a>:</h4>
<p>I guess the only critical thing then is making sure that if you were to take a pattern ID and cast it to an expression ID, then decoded as an expression, it should “just work”</p>



<a name="525112778"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/525112778" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#525112778">(Jun 20 2025 at 22:59)</a>:</h4>
<p>yes</p>



<a name="525112816"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/525112816" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#525112816">(Jun 20 2025 at 23:00)</a>:</h4>
<p>actually that might not be that much work</p>



<a name="525112828"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/525112828" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#525112828">(Jun 20 2025 at 23:00)</a>:</h4>
<p>(famous last words)</p>



<a name="525112875"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/525112875" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Warner <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#525112875">(Jun 20 2025 at 23:00)</a>:</h4>
<p>Naturally, these code paths to convert to the external types will act as correctness assertions on the purse parser ￼algorithms that are deciding what is and is not a valid expression (or pattern)</p>



<a name="525112886"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/525112886" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Warner <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#525112886">(Jun 20 2025 at 23:00)</a>:</h4>
<p>Yeah hopefully</p>



<a name="525112907"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/525112907" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Warner <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#525112907">(Jun 20 2025 at 23:01)</a>:</h4>
<p>lol dictating the word parser is impossibrl</p>



<a name="525113005"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/525113005" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#525113005">(Jun 20 2025 at 23:02)</a>:</h4>
<p>wow you are right!</p>



<a name="525113016"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/525113016" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#525113016">(Jun 20 2025 at 23:02)</a>:</h4>
<p>just tried myself</p>



<a name="526679633"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/526679633" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jared Ramirez <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#526679633">(Jul 01 2025 at 20:38)</a>:</h4>
<p>Does the parser currently support multiple patterns in <code>match</code>? ie <code>A | B =&gt; ...</code></p>



<a name="526679811"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/526679811" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jared Ramirez <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#526679811">(Jul 01 2025 at 20:40)</a>:</h4>
<p>The type looks like in <code>parse/AST.zig</code> looks like:</p>
<div class="codehilite" data-code-language="Zig"><pre><span></span><code><span class="kr">pub</span><span class="w"> </span><span class="kr">const</span><span class="w"> </span><span class="n">MatchBranch</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">pattern</span><span class="o">:</span><span class="w"> </span><span class="n">Pattern</span><span class="p">.</span><span class="n">Idx</span><span class="p">,</span>
<span class="w">    </span><span class="n">body</span><span class="o">:</span><span class="w"> </span><span class="n">Expr</span><span class="p">.</span><span class="n">Idx</span><span class="p">,</span>
<span class="w">    </span><span class="n">region</span><span class="o">:</span><span class="w"> </span><span class="n">TokenizedRegion</span><span class="p">,</span>
<span class="p">}</span>
</code></pre></div>
<p>So I'm guessing either it's not yet implemented, or when we parse we split <code>A</code> and <code>B</code> into their own branches pointing to the same expr?</p>



<a name="526682920"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/526682920" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#526682920">(Jul 01 2025 at 21:06)</a>:</h4>
<p>I did think about that. I haven't implemented it (or at least not deliberately) in my PR</p>



<a name="526683112"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/526683112" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#526683112">(Jul 01 2025 at 21:07)</a>:</h4>
<p>My guess is we'll split that into multiple branches... but the Parser should be where that is done I think. Actually I'm not sure...</p>



<a name="526684659"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/526684659" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#526684659">(Jul 01 2025 at 21:20)</a>:</h4>
<p>We dont want to desugar in this version of the compiler so we probably need a different approach to ha dle this.</p>



<a name="526685286"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/526685286" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jared Ramirez <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#526685286">(Jul 01 2025 at 21:26)</a>:</h4>
<p>In CIR, it has a span. Can the parse AST do the same?</p>
<div class="codehilite" data-code-language="Zig"><pre><span></span><code><span class="kr">pub</span><span class="w"> </span><span class="kr">const</span><span class="w"> </span><span class="n">Branch</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="n">patterns</span><span class="o">:</span><span class="w"> </span><span class="n">Match</span><span class="p">.</span><span class="n">BranchPattern</span><span class="p">.</span><span class="n">Span</span><span class="p">,</span>
<span class="w">  </span><span class="p">...</span>
<span class="p">}</span>
</code></pre></div>



<a name="526687975"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/526687975" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#526687975">(Jul 01 2025 at 21:50)</a>:</h4>
<p>I think so, it's a fair change to the parser. We may want to wait until after <span class="user-mention" data-user-id="781658">@Anthony Bullard</span> has done his thing before we change it.</p>



<a name="527314831"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/527314831" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#527314831">(Jul 06 2025 at 01:31)</a>:</h4>
<p>seems like higher-order function type annotations don't parse without parens right now <span aria-label="sweat smile" class="emoji emoji-1f605" role="img" title="sweat smile">:sweat_smile:</span> </p>
<p>this parses:</p>
<div class="codehilite"><pre><span></span><code>foo : ((Str -&gt; Str) -&gt; Str)
</code></pre></div>
<p>...but without the outer parens, this fails to parse:</p>
<div class="codehilite"><pre><span></span><code>foo : (Str -&gt; Str) -&gt; Str
</code></pre></div>



<a name="527316390"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/527316390" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#527316390">(Jul 06 2025 at 02:13)</a>:</h4>
<p>that's definitely a bug</p>



<a name="527316399"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/527316399" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#527316399">(Jul 06 2025 at 02:13)</a>:</h4>
<p>if you add a snapshot for it i'll fix it</p>



<a name="527318195"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/527318195" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#527318195">(Jul 06 2025 at 03:00)</a>:</h4>
<p>thanks! I pushed a repro snapshot to <a href="https://github.com/roc-lang/roc/pull/7955"><code>higher-order-annotations</code></a></p>



<a name="532591896"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/532591896" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#532591896">(Aug 03 2025 at 19:39)</a>:</h4>
<p>I think we may have just hit an exciting-ish point in parser fuzzing. The fuzzer isn't failing on super short edge cases anymore. Instead, it is now via forcing a stack overflow...at least that is my assumption based on the input.</p>
<div class="spoiler-block"><div class="spoiler-header">
</div><div class="spoiler-content" aria-hidden="true">
<p><code>zig build repro-parse -- -b MHt7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7ezA= -v</code></p>
</div></div>



<a name="532592402"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/532592402" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#532592402">(Aug 03 2025 at 19:45)</a>:</h4>
<p>amazing!!!</p>



<a name="532593350"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/532593350" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> JRI98 <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#532593350">(Aug 03 2025 at 19:56)</a>:</h4>
<p>Oh exciting indeed. But this raises the question: right now the parser is recursive by design. How should we handle these kinds of situations? Would a randomly defined recursion limit like 256 be fine? Because I can't imagine this happening in usual code <span aria-label="laughing" class="emoji emoji-1f606" role="img" title="laughing">:laughing:</span></p>



<a name="532594013"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/532594013" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#532594013">(Aug 03 2025 at 20:04)</a>:</h4>
<p>ideally we'd make it stack-safe by using a heap-allocated stack instead of the call stack</p>



<a name="532594611"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/532594611" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> JRI98 <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#532594611">(Aug 03 2025 at 20:11)</a>:</h4>
<p>That was my second option. Fuzzing can really find the edge cases</p>



<a name="532897283"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/532897283" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#532897283">(Aug 05 2025 at 11:41)</a>:</h4>
<p>That looks like token wise it's just 4 tokens so I think it would be a tokenization issue</p>



<a name="532897348"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/532897348" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#532897348">(Aug 05 2025 at 11:41)</a>:</h4>
<p>And i thought the chomping of chars in a ident was in a tight loop, not recursion...</p>



<a name="532936488"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/532936488" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Warner <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#532936488">(Aug 05 2025 at 15:07)</a>:</h4>
<p>That's the base 64 that appears to be just 4 tokens. The actual input is a boatload of open curlies.</p>



<a name="532936590"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/532936590" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Warner <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#532936590">(Aug 05 2025 at 15:07)</a>:</h4>
<p>... which leads to the stack overflow you'd expect - </p>
<div class="codehilite"><pre><span></span><code>...
    frame #10300: 0x00000001001003a4 repro-parse`Parser.parseStmtByType(self=0x000000016fdfa400, statementType=in_body) at Parser.zig:1214:36
    frame #10301: 0x000000010014662c repro-parse`Parser.parseStmt(self=0x000000016fdfa400) at Parser.zig:922:36
    frame #10302: 0x000000010013f854 repro-parse`Parser.parseBlock(self=0x000000016fdfa400, start=17) at Parser.zig:2791:45
    frame #10303: 0x0000000100130bcc repro-parse`Parser.parseExprWithBp(self=0x000000016fdfa400, min_bp=&#39;\0&#39;) at Parser.zig:1948:43
    frame #10304: 0x000000010011d588 repro-parse`Parser.parseExpr(self=0x000000016fdfa400) at Parser.zig:1718:36
    frame #10305: 0x00000001001003a4 repro-parse`Parser.parseStmtByType(self=0x000000016fdfa400, statementType=in_body) at Parser.zig:1214:36
    frame #10306: 0x000000010014662c repro-parse`Parser.parseStmt(self=0x000000016fdfa400) at Parser.zig:922:36
    frame #10307: 0x000000010013f854 repro-parse`Parser.parseBlock(self=0x000000016fdfa400, start=16) at Parser.zig:2791:45
    frame #10308: 0x0000000100130bcc repro-parse`Parser.parseExprWithBp(self=0x000000016fdfa400, min_bp=&#39;\0&#39;) at Parser.zig:1948:43
    frame #10309: 0x000000010011d588 repro-parse`Parser.parseExpr(self=0x000000016fdfa400) at Parser.zig:1718:36
    frame #10310: 0x00000001001003a4 repro-parse`Parser.parseStmtByType(self=0x000000016fdfa400, statementType=in_body) at Parser.zig:1214:36
    frame #10311: 0x000000010014662c repro-parse`Parser.parseStmt(self=0x000000016fdfa400) at Parser.zig:922:36
    frame #10312: 0x000000010013f854 repro-parse`Parser.parseBlock(self=0x000000016fdfa400, start=15) at Parser.zig:2791:45
    frame #10313: 0x0000000100130bcc repro-parse`Parser.parseExprWithBp(self=0x000000016fdfa400, min_bp=&#39;\0&#39;) at Parser.zig:1948:43
    frame #10314: 0x000000010011d588 repro-parse`Parser.parseExpr(self=0x000000016fdfa400) at Parser.zig:1718:36
    frame #10315: 0x00000001001003a4 repro-parse`Parser.parseStmtByType(self=0x000000016fdfa400, statementType=in_body) at Parser.zig:1214:36
    frame #10316: 0x000000010014662c repro-parse`Parser.parseStmt(self=0x000000016fdfa400) at Parser.zig:922:36
    frame #10317: 0x000000010013f854 repro-parse`Parser.parseBlock(self=0x000000016fdfa400, start=14) at Parser.zig:2791:45
    frame #10318: 0x0000000100130bcc repro-parse`Parser.parseExprWithBp(self=0x000000016fdfa400, min_bp=&#39;\0&#39;) at Parser.zig:1948:43
    frame #10319: 0x000000010011d588 repro-parse`Parser.parseExpr(self=0x000000016fdfa400) at Parser.zig:1718:36
...
</code></pre></div>



<a name="533076999"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/533076999" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#533076999">(Aug 06 2025 at 11:01)</a>:</h4>
<p>I have a fix for this, basically using a nesting counter that decrements every time we enter parsing an expression (and increments on a defer) - throwing a new Error when we try to decrement when already at zero</p>



<a name="533077076"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/533077076" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#533077076">(Aug 06 2025 at 11:01)</a>:</h4>
<p>I put the value for now at 128, that would probably need to vary based on platform/arch</p>



<a name="533077137"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/533077137" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#533077137">(Aug 06 2025 at 11:02)</a>:</h4>
<p>I can put up a PR for it, and you can give me feedback</p>



<a name="533078257"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/533078257" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#533078257">(Aug 06 2025 at 11:08)</a>:</h4>
<p><a href="https://github.com/roc-lang/roc/pull/8166">https://github.com/roc-lang/roc/pull/8166</a></p>



<a name="533121467"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/533121467" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> JRI98 <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#533121467">(Aug 06 2025 at 14:56)</a>:</h4>
<p>Yeah as a temporary solution it should work</p>



<a name="533122224"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/533122224" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> JRI98 <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#533122224">(Aug 06 2025 at 15:00)</a>:</h4>
<p>But I don't think this only relates to expressions. Pattern parsing is also recursive and I can imagine the fuzzer finding an example for it</p>



<a name="533122782"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/533122782" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> JRI98 <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#533122782">(Aug 06 2025 at 15:03)</a>:</h4>
<p>Constructed manually:</p>
<div class="spoiler-block"><div class="spoiler-header">
</div><div class="spoiler-content" aria-hidden="true">
<p>module []<br>
x=match l{[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[</p>
</div></div>



<a name="533125702"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/533125702" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> JRI98 <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#533125702">(Aug 06 2025 at 15:18)</a>:</h4>
<p>Type annotations parsing too (example here needs to be extended as it is too big for Zulip):</p>
<div class="spoiler-block"><div class="spoiler-header">
</div><div class="spoiler-content" aria-hidden="true">
<p>module []<br>
Foo : A(A(A(A(A(A(A(A(A(A(A(A(A(A(A(A(A(A(A(A(A(A(A(A(A(A(A(A(A(A(A(A(A(A(A(A(A(A(A(A(A(A(A(A(A(A(A(A(A(A(A(A(A(A(A(...</p>
</div></div>



<a name="533175167"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/533175167" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#533175167">(Aug 06 2025 at 20:31)</a>:</h4>
<p>Yeah, I know in the long term we don't want arbitrary limits like this, but they definitely work for the short and probably medium term.</p>



<a name="533180517"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/533180517" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#533180517">(Aug 06 2025 at 21:14)</a>:</h4>
<p>Yeah good call out <span class="user-mention" data-user-id="639239">@JRI98</span> i hadn't went all the way through with this change, just wanted to see if we feel comfortable with this approach for solving this general problem for at least the medium term</p>



<a name="533180563"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/533180563" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#533180563">(Aug 06 2025 at 21:15)</a>:</h4>
<p>The other options, at least in Zig, are much higher effort</p>



<a name="533180580"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/533180580" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#533180580">(Aug 06 2025 at 21:15)</a>:</h4>
<p>And higher in complexity</p>



<a name="533183346"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/533183346" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> JRI98 <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#533183346">(Aug 06 2025 at 21:40)</a>:</h4>
<p>Agree. And if we can get the fuzzer to a passing state like already happens with the tokenizer, we could maybe execute shorter runs for PRs. I don't know how feasible this would be though</p>



<a name="533187424"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/533187424" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#533187424">(Aug 06 2025 at 22:29)</a>:</h4>
<p>Probably less effort to run the fuzzer for a few mins than to build our rust compiler in nix <span aria-label="sweat smile" class="emoji emoji-1f605" role="img" title="sweat smile">:sweat_smile:</span></p>



<a name="533187515"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/533187515" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#533187515">(Aug 06 2025 at 22:30)</a>:</h4>
<p>With this PR on my M1 Pro mac book i got three crashes in 5 minutes</p>



<a name="533187516"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/533187516" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#533187516">(Aug 06 2025 at 22:30)</a>:</h4>
<p>We had the rust fuzzer running in CI for a little while there, so I think that's something we would like to do again.</p>



<a name="533187555"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/533187555" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#533187555">(Aug 06 2025 at 22:31)</a>:</h4>
<p>We'd need to get fuzz clean first <span aria-label="smiley" class="emoji emoji-1f603" role="img" title="smiley">:smiley:</span></p>



<a name="533187569"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/533187569" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#533187569">(Aug 06 2025 at 22:31)</a>:</h4>
<p>haven't had time to look at the crashes yet though</p>



<a name="533187596"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/533187596" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#533187596">(Aug 06 2025 at 22:31)</a>:</h4>
<p>i think until the work in my dead PR is done, the fuzzer will have issues</p>



<a name="533187644"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/533187644" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#533187644">(Aug 06 2025 at 22:32)</a>:</h4>
<p>The parser has some cracks around differentiating blocks/record exprs/record patterns</p>



<a name="533187689"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/533187689" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#533187689">(Aug 06 2025 at 22:32)</a>:</h4>
<p>And for some reason parses a module with a number after the header successfully</p>



<a name="533187724"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/533187724" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#533187724">(Aug 06 2025 at 22:33)</a>:</h4>
<p>i just don't have the time to go super deep right now</p>



<a name="533187773"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/533187773" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#533187773">(Aug 06 2025 at 22:33)</a>:</h4>
<p>I wonder if <span class="user-mention" data-user-id="639239">@JRI98</span> would be interested in helping with that PR? It's definitely the direction we want to go right? It needs someone familiar with the Parser to execute the refactor.</p>



<a name="533187814"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/533187814" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#533187814">(Aug 06 2025 at 22:33)</a>:</h4>
<p>Just trying to start the conversation about solving specifically the stack overflow on the above PR</p>



<a name="533187849"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/533187849" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#533187849">(Aug 06 2025 at 22:34)</a>:</h4>
<p>I'd be happy to talk someone through the high level design</p>



<a name="533187882"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/533187882" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#533187882">(Aug 06 2025 at 22:34)</a>:</h4>
<p>With the "Untyped nodes" solution</p>



<a name="533188442"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/533188442" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> JRI98 <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#533188442">(Aug 06 2025 at 22:40)</a>:</h4>
<p>Currently I don't really have the bandwidth for big refactors. But when <a href="https://github.com/roc-lang/roc/issues/8166">#8166</a> is merged, I could look at the fuzzer crashes that come after it</p>



<a name="533189642"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/533189642" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> JRI98 <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#533189642">(Aug 06 2025 at 22:54)</a>:</h4>
<p><span class="user-mention silent" data-user-id="781658">Anthony Bullard</span> <a href="#narrow/channel/395097-compiler-development/topic/zig.20compiler.20-.20parser/near/533187689">said</a>:</p>
<blockquote>
<p>And for some reason parses a module with a number after the header successfully</p>
</blockquote>
<p>Like this?</p>
<div class="codehilite" data-code-language="roc"><pre><span></span><code>module []

0
</code></pre></div>



<a name="533190930"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/533190930" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> JRI98 <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#533190930">(Aug 06 2025 at 23:10)</a>:</h4>
<p>If it is that, <a href="https://github.com/roc-lang/roc/issues/8167">#8167</a> should fix it. The parser was accepting expressions as top level statements</p>



<a name="533193906"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/533193906" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#533193906">(Aug 06 2025 at 23:50)</a>:</h4>
<p>I think the plan was to never have the fuzzer in ci. Or at least to never have it block ci.</p>



<a name="533193929"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/533193929" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#533193929">(Aug 06 2025 at 23:50)</a>:</h4>
<p>It is the kind of failure that we simply want to report but never block on.</p>



<a name="533194018"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/533194018" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#533194018">(Aug 06 2025 at 23:51)</a>:</h4>
<p>There was a good talk about this a while back by I think one of the tiger beetle folks. It's actually what inspired the design of our current fuzzing setup</p>



<a name="533194085"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/533194085" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#533194085">(Aug 06 2025 at 23:52)</a>:</h4>
<p>This one I think: <a href="https://www.hytradboi.com/2025/c222d11a-6f4d-4211-a243-f5b7fafc8d79-rocket-science-of-simulation-testing">https://www.hytradboi.com/2025/c222d11a-6f4d-4211-a243-f5b7fafc8d79-rocket-science-of-simulation-testing</a></p>



<a name="533202866"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/533202866" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#533202866">(Aug 07 2025 at 01:36)</a>:</h4>
<p>should i assume that with no comments on my PR I should be good to go ahead and move forward with the nesting counter strategy for patterns and type annotations as well?</p>



<a name="533202937"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/533202937" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#533202937">(Aug 07 2025 at 01:37)</a>:</h4>
<p>i think with that and removing expressions being valid at top-level (which was not intended), We should be as clean as we can be fuzz wise until Untyped Nodes refactor lands</p>



<a name="533271733"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/533271733" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> JRI98 <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#533271733">(Aug 07 2025 at 11:17)</a>:</h4>
<p>After the previous changes, the fuzzer found an example that triggers memory leaks, caused by the parser now returning the recursion error and not cleaning up in this case.</p>
<div class="spoiler-block"><div class="spoiler-header">
</div><div class="spoiler-content" aria-hidden="true">
<p>zig build repro-parse -- -b bW9kdWxlIFtdCgpmID0gfHwgewogICAgY3Jhc2s1MkxmckAJCS4wMzdvODYtDQkJbTA4bW9kdWxlIFtNeVJldWx0LkVyfGssIGlzX29rXQoKTXllIVJlc3VsdChvaywgZXJyKSA6PSBbT2sob3JyKV0KCm9rIDogb2sgLT4gTXlSZXN1bHQob2ssIF8pCkMoYSwgYiwpIDogKGEsIGIsKQpEKGEsIGIsKSA6IEMoYSwgYiwpCkUgOiB7IGEgOiBTdHIsIGIgOiBTdHIsIH0KRiA6IFtBLCBCLF0KCmcgOiBlIC0+IGUgd2hlcmUg7/////////8pLkEsIG1vYm1sZShlKS5CLAoKIEIsXQoKZyA6IGUgLT4gZSB3aGVyZSDv/////////zEyOiB4LCBoMTM6IHsgaDEzISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhIQaQISEKCk15UmVzdWx0KG9rLCBlcnIpIDo9IFtPayghISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISgoJioiKickISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISFST0xPISEhISEhRAAhISEhISEhISEhISEhISEJISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhb2R1bGUg//9jp7O24A1bZm9vXQpmZmZmZmaaZmZmZmZmZmZmZmZmZmZmZmZmb0BAQEBvZIAAAABAIUBAQEBAOQBAQEBAyBRAQKJSAAAABEBoIGxAQHdbQEBAQDxAQEBAQECiUgAAAARAaCBsQEB3W0BAQEA8QEBvAEBAQEDIFEBAolH/82igbEBAd1tAQEBAPEBAQEBvZCEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISFoIHJlc3VsdGR7X3wgCiDs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OwKTXlS -v</p>
</div></div>
<p>PR <a href="https://github.com/roc-lang/roc/issues/8170">#8170</a> fixes it but someone please double check that it is fine.</p>



<a name="533274723"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/533274723" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#533274723">(Aug 07 2025 at 11:36)</a>:</h4>
<p>Here is the followup PR that adds the counter check to type annos, patterns, and statements: <a href="https://github.com/roc-lang/roc/pull/8171">https://github.com/roc-lang/roc/pull/8171</a></p>



<a name="533276312"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/533276312" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#533276312">(Aug 07 2025 at 11:46)</a>:</h4>
<p>I closed <a href="https://github.com/roc-lang/roc/pull/7897">#7897</a> since it'll be easier just to play the same work on a new branch given the refactor of putting parse into a new top-level directory inside of src</p>



<a name="533309260"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/533309260" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> JRI98 <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#533309260">(Aug 07 2025 at 14:49)</a>:</h4>
<p><span aria-label="eyes" class="emoji emoji-1f440" role="img" title="eyes">:eyes:</span><br>
<a href="/user_uploads/22008/BkS-r-tAFWCfLlnbADurFFO8/Screenshot-2025-08-07-at-15.49.02.png">Screenshot 2025-08-07 at 15.49.02.png</a></p>
<div class="message_inline_image"><a href="/user_uploads/22008/BkS-r-tAFWCfLlnbADurFFO8/Screenshot-2025-08-07-at-15.49.02.png" title="Screenshot 2025-08-07 at 15.49.02.png"><img data-original-content-type="image/png" data-original-dimensions="2400x290" src="/user_uploads/thumbnail/22008/BkS-r-tAFWCfLlnbADurFFO8/Screenshot-2025-08-07-at-15.49.02.png/840x560.webp"></a></div>



<a name="533309348"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/533309348" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> JRI98 <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#533309348">(Aug 07 2025 at 14:49)</a>:</h4>
<p>I found one crash in a local run but it is an easy fix related to unstable formatting. But looking good, finally green <span aria-label="tada" class="emoji emoji-1f389" role="img" title="tada">:tada:</span></p>



<a name="533310419"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/533310419" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#533310419">(Aug 07 2025 at 14:55)</a>:</h4>
<p>No failures on 15 million runs?  I'll take it!</p>



<a name="533311098"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/533311098" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> JRI98 <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#533311098">(Aug 07 2025 at 14:59)</a>:</h4>
<p>After this PR that should be it <a href="https://github.com/roc-lang/roc/issues/8172">#8172</a></p>



<a name="533319003"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/533319003" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#533319003">(Aug 07 2025 at 15:44)</a>:</h4>
<p><span aria-label="tada" class="emoji emoji-1f389" role="img" title="tada">:tada:</span> huge milestone!</p>



<a name="533359647"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/533359647" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Niclas Ahden <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#533359647">(Aug 07 2025 at 20:32)</a>:</h4>
<p>Would it be useful to run fuzzing on spare hardware? I’ve got some 9950Xs and Macs that I’d happily fuzz Roc 24/7 on if it’d be helpful</p>



<a name="533369923"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/533369923" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#533369923">(Aug 07 2025 at 22:11)</a>:</h4>
<p>I don't think it is particularly needed, but wouldn't hurt. GitHub lets us kick off runners pretty much 24/7 if we want. Given we find so many failures currently, I set the cadence and totally run time pretty short. I can amp it up to run for a lot longer or more frequently.</p>



<a name="533370017"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/533370017" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#533370017">(Aug 07 2025 at 22:12)</a>:</h4>
<p>Also, I don't recall for sure, but I think fuzzing may not really work right on Mac currently or that maybe it works but only we debug builds....don't recall exactly. It is an issue when dealing with afl++ and zig coverage instrumentation.</p>



<a name="533382542"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/533382542" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#533382542">(Aug 08 2025 at 01:02)</a>:</h4>
<p>I also have my i9 Mac Mini (2018) that has linux on it that I could do the same</p>



<a name="533382612"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/533382612" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#533382612">(Aug 08 2025 at 01:03)</a>:</h4>
<p>It seems to run fine on my Mac</p>



<a name="533387574"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/533387574" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#533387574">(Aug 08 2025 at 02:28)</a>:</h4>
<div class="codehilite" data-code-language="Zig"><pre><span></span><code><span class="w">        </span><span class="c1">// Work around instrumentation bugs on mac without giving up perf on linux.</span>
<span class="w">        </span><span class="p">.</span><span class="n">optimize</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">target</span><span class="p">.</span><span class="n">result</span><span class="p">.</span><span class="n">os</span><span class="p">.</span><span class="n">tag</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="p">.</span><span class="n">macos</span><span class="p">)</span><span class="w"> </span><span class="p">.</span><span class="n">Debug</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">.</span><span class="n">ReleaseSafe</span><span class="p">,</span>
</code></pre></div>



<a name="533387659"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/533387659" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#533387659">(Aug 08 2025 at 02:30)</a>:</h4>
<p>Actually, may not matter. I think zig-afl-kit consumes it as llvm bitcode. So it should be able to optimize it.</p>



<a name="533387846"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/533387846" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#533387846">(Aug 08 2025 at 02:32)</a>:</h4>
<p>Not sure if it misses any zig optimizations, but it shouldn't miss any llvm optimization I think</p>



<a name="533438367"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/533438367" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#533438367">(Aug 08 2025 at 10:32)</a>:</h4>
<p>Ran the fuzzer overnight on my M1 Pro Macbook, no crashes after 9 hours (29M Execs)!</p>
<p><a href="/user_uploads/22008/osbQ25b6evZaKI2bREgB28-q/Screenshot-2025-08-08-at-5.31.29-AM.png">Screenshot 2025-08-08 at 5.31.29 AM.png</a></p>
<div class="message_inline_image"><a href="/user_uploads/22008/osbQ25b6evZaKI2bREgB28-q/Screenshot-2025-08-08-at-5.31.29-AM.png" title="Screenshot 2025-08-08 at 5.31.29 AM.png"><img data-original-content-type="image/png" data-original-dimensions="1260x1090" src="/user_uploads/thumbnail/22008/osbQ25b6evZaKI2bREgB28-q/Screenshot-2025-08-08-at-5.31.29-AM.png/840x560.webp"></a></div>



<a name="533439971"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/533439971" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> JRI98 <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#533439971">(Aug 08 2025 at 10:44)</a>:</h4>
<p>Roc's fuzzer found one but it is related to unstable formatting and those are simple to fix <a href="https://github.com/roc-lang/roc/issues/8174">#8174</a></p>



<a name="533443508"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/533443508" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#533443508">(Aug 08 2025 at 11:10)</a>:</h4>
<p>You found a new one on main?</p>



<a name="533443525"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/533443525" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#533443525">(Aug 08 2025 at 11:10)</a>:</h4>
<p>This is using the fuzzer based on main</p>



<a name="533443667"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/533443667" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#533443667">(Aug 08 2025 at 11:11)</a>:</h4>
<p>Just a small number of hangs that are basically all some around a string of 10,000+ <code>{</code>s or other brace right after each other (and unclosed)</p>



<a name="533444961"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/533444961" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> JRI98 <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#533444961">(Aug 08 2025 at 11:20)</a>:</h4>
<p>It must have been random luck</p>



<a name="533445254"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/533445254" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#533445254">(Aug 08 2025 at 11:23)</a>:</h4>
<p>btw this is super random but I know we talked back in...January? about wanting a column width constraint on the formatter so that we could solve the problem of docs on the website overflowing dynamic width and creating horizontal scrollbars</p>
<p>I learned about <code>@container</code> in CSS which apparently makes it possible to do this in pure CSS, so that appears to be unnecessary anymore! <span aria-label="smile" class="emoji emoji-1f604" role="img" title="smile">:smile:</span></p>



<a name="533676210"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/533676210" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#533676210">(Aug 10 2025 at 20:58)</a>:</h4>
<p>TIL that Rust already does the "don't distinguish between patterns, types, and exprs in parsing; treat them all the same in the AST and then categorize them in the subsequent pass" thing - and for the same reasons!</p>
<blockquote>
<p>Rather than trying to keep the categories separately in the syntax, use the same surface syntax to express all three, and categorize later, during semantic analysis. </p>
</blockquote>
<p><a href="https://matklad.github.io/2025/08/09/zigs-lovely-syntax.html">https://matklad.github.io/2025/08/09/zigs-lovely-syntax.html</a></p>



<a name="533681912"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/533681912" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#533681912">(Aug 10 2025 at 23:00)</a>:</h4>
<p>It's really not hard for Rust or Zig. they have keywords for everything and no ambiguity with parsing blocks vs struct literals vs struct patterns vs type annos</p>



<a name="533682057"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/533682057" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#533682057">(Aug 10 2025 at 23:02)</a>:</h4>
<p>if in Roc, decls and type decls had keyword introduction, and annos were inline it wouldn't be needed. But then it really wouldn't be Roc anymore, it'd virtually be gleam syntactically.</p>



<a name="533682200"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/533682200" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#533682200">(Aug 10 2025 at 23:05)</a>:</h4>
<p>Actually keywords for bindings and (anonymous) records having a sigil is all that would be required.  Annos could stay the way they are since type annos are only on a single named binding and type decls are required to start with an UpperIdent.</p>



<a name="533682289"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/533682289" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#533682289">(Aug 10 2025 at 23:07)</a>:</h4>
<p>(also you could have no sigil for records if blocks used do..end syntax which i won't rehash)</p>



<a name="533682571"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/533682571" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#533682571">(Aug 10 2025 at 23:13)</a>:</h4>
<p>I mainly just found it interesting that we're not moving towards a novel AST design; there's already a mainstream language doing it <span aria-label="smile" class="emoji emoji-1f604" role="img" title="smile">:smile:</span></p>



<a name="533684067"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/zig%20compiler%20-%20parser/near/533684067" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/zig.20compiler.20-.20parser.html#533684067">(Aug 10 2025 at 23:44)</a>:</h4>
<p>And here i thought we were innovating <span aria-label="rolling on the floor laughing" class="emoji emoji-1f923" role="img" title="rolling on the floor laughing">:rolling_on_the_floor_laughing:</span></p>



<hr><p>Last updated: Mar 01 2026 at 12:20 UTC</p>
</html>