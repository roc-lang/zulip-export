<html>
<head><meta charset="utf-8"><title>Rust and Zig stdlib · compiler development · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/index.html">compiler development</a></h2>
<h3>Topic: <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/Rust.20and.20Zig.20stdlib.html">Rust and Zig stdlib</a></h3>

<hr>

<base href="https://roc.zulipchat.com">

<head><link href="https://roc-lang.github.io/zulip-export/style.css" rel="stylesheet"></head>

<a name="390796562"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/Rust%20and%20Zig%20stdlib/near/390796562" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/Rust.20and.20Zig.20stdlib.html#390796562">(Sep 13 2023 at 20:23)</a>:</h4>
<p>I'm trying to remember some details about the time when we tried out Zig as an alternative to Rust for the stdlib - as I recall (maybe <span class="user-mention" data-user-id="341568">@Jared Ramirez</span> remembers?) we first tried out Rust, and then it wasn't going well, and then we talked about "wouldn't it be easier if we just did it in C?" and then "if we're going to do it in C, why not Zig?"</p>



<a name="390796638"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/Rust%20and%20Zig%20stdlib/near/390796638" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/Rust.20and.20Zig.20stdlib.html#390796638">(Sep 13 2023 at 20:23)</a>:</h4>
<p>I definitely remember one of the challenges we ran into was a toolchain thing, something along the lines of the <code>--emit=llvm-ir</code> flag not working the way we wanted to, or something like that</p>



<a name="390796642"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/Rust%20and%20Zig%20stdlib/near/390796642" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/Rust.20and.20Zig.20stdlib.html#390796642">(Sep 13 2023 at 20:23)</a>:</h4>
<p>might also have been wasm-related?</p>



<a name="390796705"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/Rust%20and%20Zig%20stdlib/near/390796705" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/Rust.20and.20Zig.20stdlib.html#390796705">(Sep 13 2023 at 20:24)</a>:</h4>
<p>does anyone remember the specifics of what originally motivated looking at non-Rust options?</p>



<a name="390796819"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/Rust%20and%20Zig%20stdlib/near/390796819" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/Rust.20and.20Zig.20stdlib.html#390796819">(Sep 13 2023 at 20:25)</a>:</h4>
<p>(besides just "this uses <code>unsafe</code> all over the place, so we aren't really getting much from Rust" and the opportunity cost of other languages having things like nicer opt-in runtime checking for memory management mistakes etc.)</p>



<a name="390797050"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/Rust%20and%20Zig%20stdlib/near/390797050" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/Rust.20and.20Zig.20stdlib.html#390797050">(Sep 13 2023 at 20:26)</a>:</h4>
<p>I specifically remember that rust just added in lots of stuff we did not want/need</p>



<a name="390797119"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/Rust%20and%20Zig%20stdlib/near/390797119" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/Rust.20and.20Zig.20stdlib.html#390797119">(Sep 13 2023 at 20:26)</a>:</h4>
<p>I'm guessing panics specifically?</p>



<a name="390797199"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/Rust%20and%20Zig%20stdlib/near/390797199" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/Rust.20and.20Zig.20stdlib.html#390797199">(Sep 13 2023 at 20:27)</a>:</h4>
<p>also yeah LLVM might sort of work but getting the object files from rust is not easy</p>



<a name="390797227"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/Rust%20and%20Zig%20stdlib/near/390797227" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/Rust.20and.20Zig.20stdlib.html#390797227">(Sep 13 2023 at 20:27)</a>:</h4>
<p>llvm would also get split into many separate files I think with rust</p>



<a name="390798670"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/Rust%20and%20Zig%20stdlib/near/390798670" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/Rust.20and.20Zig.20stdlib.html#390798670">(Sep 13 2023 at 20:34)</a>:</h4>
<p>oh yeah</p>



<a name="390798744"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/Rust%20and%20Zig%20stdlib/near/390798744" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/Rust.20and.20Zig.20stdlib.html#390798744">(Sep 13 2023 at 20:35)</a>:</h4>
<p>I would have thought <code>no_std</code> would get rid of panic infrastructure, but maybe we didn't know about that at the time?</p>



<a name="390799309"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/Rust%20and%20Zig%20stdlib/near/390799309" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/Rust.20and.20Zig.20stdlib.html#390799309">(Sep 13 2023 at 20:39)</a>:</h4>
<p>well it does panic = abort, which might not be what you want either?</p>



<a name="390799349"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/Rust%20and%20Zig%20stdlib/near/390799349" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/Rust.20and.20Zig.20stdlib.html#390799349">(Sep 13 2023 at 20:39)</a>:</h4>
<p>generally rust generated code is pretty bloaty</p>



<a name="390800099"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/Rust%20and%20Zig%20stdlib/near/390800099" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/Rust.20and.20Zig.20stdlib.html#390800099">(Sep 13 2023 at 20:44)</a>:</h4>
<p>yeah I just remember there was a moment where it was like "ugh, this is really painful...what if we did C?" and I remember it being a couple of specific development pain points rather than code gen</p>



<a name="390800119"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/Rust%20and%20Zig%20stdlib/near/390800119" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/Rust.20and.20Zig.20stdlib.html#390800119">(Sep 13 2023 at 20:44)</a>:</h4>
<p>but I don't remember what exactly they were <span aria-label="laughing" class="emoji emoji-1f606" role="img" title="laughing">:laughing:</span></p>



<a name="390801247"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/Rust%20and%20Zig%20stdlib/near/390801247" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jared Ramirez <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/Rust.20and.20Zig.20stdlib.html#390801247">(Sep 13 2023 at 20:53)</a>:</h4>
<p>I don't recall the specific pain points either unfortunately, but I think the the rust generated llvm-ir needed quite a bit of transforming to get it to work with the output after the roc compiler gen was done (I seem to recall a lot of duplicate def issues, among other things). I also remember the dev process was pretty painful and it being annoying to link the generated bitcode back into the <code>gen</code> crate</p>



<a name="390801419"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/Rust%20and%20Zig%20stdlib/near/390801419" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jared Ramirez <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/Rust.20and.20Zig.20stdlib.html#390801419">(Sep 13 2023 at 20:55)</a>:</h4>
<p>also found this old PR: <a href="https://github.com/roc-lang/roc/pull/568">https://github.com/roc-lang/roc/pull/568</a></p>
<p>the comment says</p>
<blockquote>
<p>After talking, Richard and I decided to go with the completely different approach of using libc/c for builtins bitcode generation</p>
</blockquote>
<p>so not very helpful as to what was the reasoning at the time</p>



<a name="390801447"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/Rust%20and%20Zig%20stdlib/near/390801447" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jared Ramirez <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/Rust.20and.20Zig.20stdlib.html#390801447">(Sep 13 2023 at 20:55)</a>:</h4>
<p>then we did use c for a bit which had it's own problems so we ultimately switched to zig</p>



<a name="390802839"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/Rust%20and%20Zig%20stdlib/near/390802839" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/Rust.20and.20Zig.20stdlib.html#390802839">(Sep 13 2023 at 21:07)</a>:</h4>
<p>I definitely think the big thing was that everything was unsafe rust and it didn't feel very useful to use rust.</p>



<a name="390802877"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/Rust%20and%20Zig%20stdlib/near/390802877" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/Rust.20and.20Zig.20stdlib.html#390802877">(Sep 13 2023 at 21:07)</a>:</h4>
<p>Like none of the benefits of rust</p>



<a name="390804224"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/Rust%20and%20Zig%20stdlib/near/390804224" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/Rust.20and.20Zig.20stdlib.html#390804224">(Sep 13 2023 at 21:18)</a>:</h4>
<p>oh yeah! I forgot that we literally used C briefly - <span class="user-mention" data-user-id="341568">@Jared Ramirez</span> do you remember what any of the C pain points were by any chance? <span aria-label="smiley" class="emoji emoji-1f603" role="img" title="smiley">:smiley:</span></p>



<a name="390804450"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/Rust%20and%20Zig%20stdlib/near/390804450" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/Rust.20and.20Zig.20stdlib.html#390804450">(Sep 13 2023 at 21:20)</a>:</h4>
<p>a guess: cross-compilation?</p>



<a name="390807158"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/Rust%20and%20Zig%20stdlib/near/390807158" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/Rust.20and.20Zig.20stdlib.html#390807158">(Sep 13 2023 at 21:43)</a>:</h4>
<p>but I think we always emit llvm bitcode, right? <span aria-label="thinking" class="emoji emoji-1f914" role="img" title="thinking">:thinking:</span></p>



<a name="390807495"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/Rust%20and%20Zig%20stdlib/near/390807495" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/Rust.20and.20Zig.20stdlib.html#390807495">(Sep 13 2023 at 21:46)</a>:</h4>
<p>Not for dev backends</p>



<a name="390807527"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/Rust%20and%20Zig%20stdlib/near/390807527" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/Rust.20and.20Zig.20stdlib.html#390807527">(Sep 13 2023 at 21:46)</a>:</h4>
<p>but that wasn't a real concern back then, I don't think.</p>



<a name="390807540"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/Rust%20and%20Zig%20stdlib/near/390807540" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/Rust.20and.20Zig.20stdlib.html#390807540">(Sep 13 2023 at 21:46)</a>:</h4>
<p>Cause dev backends didn't exist</p>



<a name="390819374"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/Rust%20and%20Zig%20stdlib/near/390819374" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jared Ramirez <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/Rust.20and.20Zig.20stdlib.html#390819374">(Sep 13 2023 at 23:38)</a>:</h4>
<p>Maybe pain points was the wrong wording, I think it might've worked okay but Zig was easier to write safely and was new/exciting. Plus I think we just weren't psyched on writing C in general at the time</p>



<hr><p>Last updated: Mar 01 2026 at 12:20 UTC</p>
</html>