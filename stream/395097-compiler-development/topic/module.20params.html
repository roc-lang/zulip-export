<html>
<head><meta charset="utf-8"><title>module params · compiler development · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/index.html">compiler development</a></h2>
<h3>Topic: <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/module.20params.html">module params</a></h3>

<hr>

<base href="https://roc.zulipchat.com">

<head><link href="https://roc-lang.github.io/zulip-export/style.css" rel="stylesheet"></head>

<a name="404120299"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/module%20params/near/404120299" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Agus Zubiaga <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/module.20params.html#404120299">(Nov 25 2023 at 15:30)</a>:</h4>
<p>So I found some time today to work on <a href="https://docs.google.com/document/d/110MwQi7Dpo1Y69ECFXyyvDWzF4OYv1BLojIm08qDTvg/edit?pli=1">Module Params</a>. I'm starting with the parser changes for the inline import syntax described <a href="https://docs.google.com/document/d/1E_77fO-44BtoBtXoVeWyGh1xN2KRTWTu8q6i25RNNx0/edit#heading=h.34oh2o35t50f">here</a>.</p>
<div class="codehilite" data-code-language="Elm"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nc">Json</span>
<span class="kn">import</span><span class="w"> </span><span class="nc">Unicode</span><span class="w"> </span><span class="kr">as</span><span class="w"> </span><span class="kt">Uc</span>
<span class="kn">import</span><span class="w"> </span><span class="err">[</span><span class="nc">Req</span><span class="p">,</span><span class="w"> </span><span class="kt">Resp</span><span class="p">]</span><span class="w"> </span><span class="nv">from</span><span class="w"> </span><span class="kt">InternalHttp</span>
<span class="kn">import</span><span class="w"> </span><span class="err">[</span><span class="nc">CodePoint</span><span class="p">,</span><span class="w"> </span><span class="nv">first</span><span class="p">]</span><span class="w"> </span><span class="nv">from</span><span class="w"> </span><span class="kt">CodePoint</span><span class="w"> </span><span class="kr">as</span><span class="w"> </span><span class="kt">Cp</span>
<span class="kn">import</span><span class="w"> </span><span class="nc">foo</span><span class="w"> </span><span class="nf">:</span><span class="w"> </span><span class="kt">Str</span><span class="w"> </span><span class="nv">from</span><span class="w"> </span><span class="s">"some-file.txt"</span>
</code></pre></div>
<p>I think it makes sense to treat these as defs because they can appear in the top-level, but also nested in an expression/expect. </p>
<p>My first question is whether it would be appropriate to add a variant to <a href="https://github.com/roc-lang/roc/blob/668a9d363d0350002b487f2501444f5aa684f99e/crates/compiler/parse/src/ast.rs#L418"><code>ValueDef</code></a> for imports? At first I thought imports aren't "values", but we seem to have <code>Expect</code> and <code>Dbg</code> in that union.</p>
<p>If not, I suppose we can change <a href="https://github.com/roc-lang/roc/blob/668a9d363d0350002b487f2501444f5aa684f99e/crates/compiler/parse/src/expr.rs#L1026"><code>SingleDef.type_or_value</code></a> to something like <code>type_or_value_or_import</code> <span aria-label="smile" class="emoji emoji-1f642" role="img" title="smile">:smile:</span></p>



<a name="404121010"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/module%20params/near/404121010" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/module.20params.html#404121010">(Nov 25 2023 at 15:40)</a>:</h4>
<p>I think they structurally are values if we truly allow them anywhere (though I could see an argument for only allowing them at the top of a block). They are kinda a pattern matching let statement, just over modules.</p>



<a name="404122833"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/module%20params/near/404122833" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/module.20params.html#404122833">(Nov 25 2023 at 16:04)</a>:</h4>
<p>yeah I think they go in the same category as <code>dbg</code> and <code>expect</code>, and should parse the same way those do</p>



<a name="404122874"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/module%20params/near/404122874" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/module.20params.html#404122874">(Nov 25 2023 at 16:05)</a>:</h4>
<p>I think of them more like statements or declarations than values</p>



<a name="404123448"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/module%20params/near/404123448" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ayaz Hafiz <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/module.20params.html#404123448">(Nov 25 2023 at 16:17)</a>:</h4>
<p>Agreed, maybe consider renaming ValueDef if it's appropriate</p>



<a name="404129430"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/module%20params/near/404129430" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Agus Zubiaga <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/module.20params.html#404129430">(Nov 25 2023 at 17:21)</a>:</h4>
<p>Cool. So basically, <code>ValueDef</code> are any “statements” that are not type definitions.</p>



<a name="404130578"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/module%20params/near/404130578" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Agus Zubiaga <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/module.20params.html#404130578">(Nov 25 2023 at 17:31)</a>:</h4>
<p>I’m struggling to come up with a name that captures that exactly. I’ll keep it for now and maybe it’ll become apparent as we implement more things in the proposal.</p>



<a name="404164355"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/module%20params/near/404164355" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/module.20params.html#404164355">(Nov 25 2023 at 21:40)</a>:</h4>
<p>inline imports are convenient I guess but do mean that we need to also support that in load. it's no longer true that after reading the header you know all dependencies, you now need to at least parse the whole file</p>



<a name="404164449"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/module%20params/near/404164449" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/module.20params.html#404164449">(Nov 25 2023 at 21:41)</a>:</h4>
<p>yep, for sure</p>



<a name="404164513"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/module%20params/near/404164513" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/module.20params.html#404164513">(Nov 25 2023 at 21:41)</a>:</h4>
<p>although I think that will actually simplify things a bit, and I don't think the performance gains turned out to be significant after all <span aria-label="big smile" class="emoji emoji-1f604" role="img" title="big smile">:big_smile:</span></p>



<a name="404165249"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/module%20params/near/404165249" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Agus Zubiaga <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/module.20params.html#404165249">(Nov 25 2023 at 21:46)</a>:</h4>
<p>If we really wanted to, I suppose we could parse the ones between the header and the first non-import def (common case), and start processing those before parsing the rest of the file</p>



<a name="404165363"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/module%20params/near/404165363" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Agus Zubiaga <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/module.20params.html#404165363">(Nov 25 2023 at 21:47)</a>:</h4>
<p>but that'd probably complicate things a bit</p>



<a name="404166136"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/module%20params/near/404166136" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/module.20params.html#404166136">(Nov 25 2023 at 21:53)</a>:</h4>
<p>another possibility would be to have the parser take an "import listener" which it would call every time it parsed an import, so it would immediately enqueue other modules as soon as it encountered them</p>



<a name="404166244"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/module%20params/near/404166244" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/module.20params.html#404166244">(Nov 25 2023 at 21:54)</a>:</h4>
<p>but really I think the best answer is to make the parser so fast there'd be no noticeable difference between the more complicated strategies and just parsing the whole file and reporting all the imports at the end <span aria-label="big smile" class="emoji emoji-1f604" role="img" title="big smile">:big_smile:</span></p>



<a name="404167753"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/module%20params/near/404167753" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/module.20params.html#404167753">(Nov 25 2023 at 22:03)</a>:</h4>
<p>yeah I'm not worried about performance, but it is some extra complexity</p>



<a name="404299993"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/module%20params/near/404299993" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Agus Zubiaga <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/module.20params.html#404299993">(Nov 26 2023 at 23:41)</a>:</h4>
<p>What is <code>Malformed</code> for exactly? In the new proposal, module names can't have dots. If we encounter some during parsing should that be treated as a failure or as malformed?</p>



<a name="404300240"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/module%20params/near/404300240" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Agus Zubiaga <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/module.20params.html#404300240">(Nov 26 2023 at 23:45)</a>:</h4>
<p>Hm, it looks like we use that for generating runtime errors in codegen. I wonder if we should still try to run if you have a bad import.</p>



<a name="404303129"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/module%20params/near/404303129" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ayaz Hafiz <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/module.20params.html#404303129">(Nov 27 2023 at 00:20)</a>:</h4>
<p>I think keeping it is Malformed is good if it's not a lot of effort. It also means type checking can proceed with import errors</p>



<a name="404304377"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/module%20params/near/404304377" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/module.20params.html#404304377">(Nov 27 2023 at 00:32)</a>:</h4>
<p>the general rule is "always proceed"</p>



<a name="404304534"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/module%20params/near/404304534" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/module.20params.html#404304534">(Nov 27 2023 at 00:34)</a>:</h4>
<p>my general thinking on this is that an advantage interpreted languages (usually) have over statically compiled languages is that you can always run them no matter what problems there are, meaning you can always attempt to run the program no matter what</p>



<a name="404304613"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/module%20params/near/404304613" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/module.20params.html#404304613">(Nov 27 2023 at 00:34)</a>:</h4>
<p>so the idea is to try to get that benefit by reporting errors at compile time but still proceeding to run the program if that was requested (e.g. via <code>roc run</code>) and then generating a crash once we encounter it in practice</p>



<a name="404304679"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/module%20params/near/404304679" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/module.20params.html#404304679">(Nov 27 2023 at 00:35)</a>:</h4>
<p>so for example, if an invalid <code>import</code> is located inside a function, it might never come up if you're running a program that never hits that code path</p>



<a name="404310726"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/module%20params/near/404310726" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Agus Zubiaga <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/module.20params.html#404310726">(Nov 27 2023 at 01:28)</a>:</h4>
<p>That makes sense, thanks!</p>



<a name="404310953"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/module%20params/near/404310953" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Agus Zubiaga <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/module.20params.html#404310953">(Nov 27 2023 at 01:30)</a>:</h4>
<p>That function could even run fine until the point it tries to reference an (incorrectly) imported symbol</p>



<a name="404863561"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/module%20params/near/404863561" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Agus Zubiaga <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/module.20params.html#404863561">(Nov 29 2023 at 13:18)</a>:</h4>
<p>How do we want to format multi-line imports? Something like this?</p>
<div class="codehilite"><pre><span></span><code>import [
     map,
     int,
] from Json as J
</code></pre></div>



<a name="404863824"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/module%20params/near/404863824" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Agus Zubiaga <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/module.20params.html#404863824">(Nov 29 2023 at 13:19)</a>:</h4>
<p>This feels too whitespace heavy</p>
<div class="codehilite"><pre><span></span><code>import
  [
     map,
     int,
  ]
  from Json
  as J
</code></pre></div>



<a name="404863905"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/module%20params/near/404863905" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anton <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/module.20params.html#404863905">(Nov 29 2023 at 13:19)</a>:</h4>
<p>Yeah, the first one looks better</p>



<a name="404865712"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/module%20params/near/404865712" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Agus Zubiaga <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/module.20params.html#404865712">(Nov 29 2023 at 13:29)</a>:</h4>
<p>Also I think we should only allow newlines and comments inside  the exposed members part (<code>[ ]</code>)</p>



<a name="404867701"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/module%20params/near/404867701" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/module.20params.html#404867701">(Nov 29 2023 at 13:38)</a>:</h4>
<p>as opposed to...? <span aria-label="thinking" class="emoji emoji-1f914" role="img" title="thinking">:thinking:</span></p>



<a name="404867844"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/module%20params/near/404867844" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Agus Zubiaga <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/module.20params.html#404867844">(Nov 29 2023 at 13:39)</a>:</h4>
<p>I mean something like this shouldn't be allowed, right?</p>
<div class="codehilite"><pre><span></span><code>import
   # TODO: Use new module
   DeprecatedJson
</code></pre></div>



<a name="404868067"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/module%20params/near/404868067" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Agus Zubiaga <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/module.20params.html#404868067">(Nov 29 2023 at 13:40)</a>:</h4>
<p>(edited: Removed already disallowed dot)</p>



<a name="404875384"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/module%20params/near/404875384" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ayaz Hafiz <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/module.20params.html#404875384">(Nov 29 2023 at 14:16)</a>:</h4>
<p>Why not?</p>



<a name="404894691"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/module%20params/near/404894691" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Agus Zubiaga <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/module.20params.html#404894691">(Nov 29 2023 at 15:37)</a>:</h4>
<p>Well, it could. I just haven’t seen that before.</p>



<a name="404894871"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/module%20params/near/404894871" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Agus Zubiaga <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/module.20params.html#404894871">(Nov 29 2023 at 15:38)</a>:</h4>
<p>Oh wow, Elm allows this</p>



<a name="404896401"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/module%20params/near/404896401" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Agus Zubiaga <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/module.20params.html#404896401">(Nov 29 2023 at 15:46)</a>:</h4>
<p>If you can have comments between any of the keywords, we probably need a few different format styles</p>



<a name="404897342"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/module%20params/near/404897342" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Agus Zubiaga <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/module.20params.html#404897342">(Nov 29 2023 at 15:50)</a>:</h4>
<div class="codehilite"><pre><span></span><code>import Json as J
import
  # comment
  Json as J

import
  # comment
  Json
  # comment
  as J

import [
  map,
  int
] from Json as J

import
  # comment
  [
    map,
    int
  ]
  # comment
  from
    # comment
    Json
  # comment
  as
    # comment
    J
</code></pre></div>



<a name="404898447"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/module%20params/near/404898447" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ayaz Hafiz <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/module.20params.html#404898447">(Nov 29 2023 at 15:56)</a>:</h4>
<p>I feel like comments should be supported anywhere. A bias, but to me it would feel weird if adding a comment somewhere causes a parse error.</p>



<a name="404898539"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/module%20params/near/404898539" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ayaz Hafiz <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/module.20params.html#404898539">(Nov 29 2023 at 15:56)</a>:</h4>
<p>The formatting probably doesn't need to be perfect I think</p>



<a name="404898751"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/module%20params/near/404898751" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Agus Zubiaga <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/module.20params.html#404898751">(Nov 29 2023 at 15:57)</a>:</h4>
<p>Yeah, that's a good point</p>



<a name="404950514"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/module%20params/near/404950514" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Agus Zubiaga <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/module.20params.html#404950514">(Nov 29 2023 at 21:09)</a>:</h4>
<p>I found <a href="https://github.com/roc-lang/roc/blob/ead90313d89e8939549732136d536f301e522a16/crates/compiler/fmt/src/annotation.rs#L93-L100"><code>is_collection_multiline</code></a> under <code>annotation.rs</code> which we seem to use in other modules for non-annotation purposes. Shouldn't this live in <code>collection.rs</code>?</p>



<a name="404950676"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/module%20params/near/404950676" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Agus Zubiaga <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/module.20params.html#404950676">(Nov 29 2023 at 21:10)</a>:</h4>
<p>I need it in <code>def.rs</code> but I wasn't sure whether we consider ok to use it there</p>



<a name="404984469"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/module%20params/near/404984469" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/module.20params.html#404984469">(Nov 30 2023 at 01:35)</a>:</h4>
<p>moving it makes sense to me! <span aria-label="thumbs up" class="emoji emoji-1f44d" role="img" title="thumbs up">:thumbs_up:</span></p>



<a name="404984534"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/module%20params/near/404984534" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/module.20params.html#404984534">(Nov 30 2023 at 01:36)</a>:</h4>
<p>there's a good chance it existed before we'd created <code>collection.rs</code></p>



<a name="405368490"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/module%20params/near/405368490" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Agus Zubiaga <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/module.20params.html#405368490">(Dec 01 2023 at 13:55)</a>:</h4>
<p>The parser and formatter for inline imports is mostly done! I started looking into canonicalization now, and realized that introducing inline imports before <a href="https://docs.google.com/document/d/1E_77fO-44BtoBtXoVeWyGh1xN2KRTWTu8q6i25RNNx0/edit#heading=h.x84bh32l37em">"Module and privacy changes"</a> is probably a waste of effort since the module system changes significantly, and the new imports are just not compatible with the current system even at the syntax level (e.g. packages shorthand).</p>
<p>I think it probably makes sense to do <a href="https://docs.google.com/document/d/1E_77fO-44BtoBtXoVeWyGh1xN2KRTWTu8q6i25RNNx0/edit">this</a> wholesale. Let me know what you think.</p>



<a name="405368685"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/module%20params/near/405368685" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Agus Zubiaga <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/module.20params.html#405368685">(Dec 01 2023 at 13:56)</a>:</h4>
<p>I would still break it into small reviewable PRs but not to <code>main</code>.</p>



<a name="405373210"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/module%20params/near/405373210" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/module.20params.html#405373210">(Dec 01 2023 at 14:16)</a>:</h4>
<p>makes sense to me! <span aria-label="thumbs up" class="emoji emoji-1f44d" role="img" title="thumbs up">:thumbs_up:</span></p>



<a name="405587594"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/module%20params/near/405587594" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Agus Zubiaga <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/module.20params.html#405587594">(Dec 03 2023 at 01:33)</a>:</h4>
<p>Should we sort imports alphabetically like elm format does?</p>



<a name="405587758"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/module%20params/near/405587758" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Agus Zubiaga <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/module.20params.html#405587758">(Dec 03 2023 at 01:35)</a>:</h4>
<p>Sorting whole import defs might feel weird, but it might make sense to sort names inside <code>exposing</code></p>



<a name="405588410"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/module%20params/near/405588410" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/module.20params.html#405588410">(Dec 03 2023 at 01:42)</a>:</h4>
<p>I think so, yeah!</p>



<a name="405588459"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/module%20params/near/405588459" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/module.20params.html#405588459">(Dec 03 2023 at 01:43)</a>:</h4>
<p>also capitalized things (so, types and abilities) before non-capitalized things</p>



<a name="405588576"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/module%20params/near/405588576" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Agus Zubiaga <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/module.20params.html#405588576">(Dec 03 2023 at 01:44)</a>:</h4>
<p>Cool! And do you agree we shouldn't reorder whole import defs or do you think we should try it?</p>



<a name="405588656"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/module%20params/near/405588656" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/module.20params.html#405588656">(Dec 03 2023 at 01:45)</a>:</h4>
<p>hm, what would be an example of that?</p>



<a name="405588683"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/module%20params/near/405588683" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Agus Zubiaga <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/module.20params.html#405588683">(Dec 03 2023 at 01:45)</a>:</h4>
<div class="codehilite"><pre><span></span><code>import B
import A
</code></pre></div>
<p>would be formatted to:</p>
<div class="codehilite"><pre><span></span><code>import A
import B
</code></pre></div>



<a name="405588743"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/module%20params/near/405588743" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/module.20params.html#405588743">(Dec 03 2023 at 01:46)</a>:</h4>
<p>oh interesting...yeah I think let's actually try it</p>



<a name="405588757"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/module%20params/near/405588757" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/module.20params.html#405588757">(Dec 03 2023 at 01:46)</a>:</h4>
<p>if they're all in a group, at least</p>



<a name="405588761"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/module%20params/near/405588761" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/module.20params.html#405588761">(Dec 03 2023 at 01:46)</a>:</h4>
<p>like one after another</p>



<a name="405588821"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/module%20params/near/405588821" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Agus Zubiaga <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/module.20params.html#405588821">(Dec 03 2023 at 01:47)</a>:</h4>
<p>Gotcha! Yeah, I like that elm format does this. I thought it would not be as useful when imports aren't in a centralized place, but that might still be the case for a lot of modules.</p>



<a name="405594609"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/module%20params/near/405594609" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/module.20params.html#405594609">(Dec 03 2023 at 02:51)</a>:</h4>
<p>I like it that <code>elm-format</code> does this too, and I'm glad I wrote it into the original <code>elm-format</code> spec document! <span aria-label="laughing" class="emoji emoji-1f606" role="img" title="laughing">:laughing:</span></p>



<a name="405600275"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/module%20params/near/405600275" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Pearce Keesling <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/module.20params.html#405600275">(Dec 03 2023 at 04:03)</a>:</h4>
<p>Yeah it is nice to respect line break grouping so I can group certain imports together when I want to but still get sorting within those groups</p>



<a name="405712967"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/module%20params/near/405712967" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Agus Zubiaga <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/module.20params.html#405712967">(Dec 04 2023 at 00:24)</a>:</h4>
<p>Re this: <a href="https://github.com/roc-lang/roc/issues/6172">https://github.com/roc-lang/roc/issues/6172</a></p>
<p>Instead of using a special module name parser, I’m leaning towards just using the regular identifier parser and treating this case as malformed. So it wouldn’t fail as a syntax error and we can provide a helpful error message explaining how module names must be capitalized.</p>



<a name="405713283"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/module%20params/near/405713283" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/module.20params.html#405713283">(Dec 04 2023 at 00:27)</a>:</h4>
<p>Is there a particular design behind only allowing valid ident names for module file and folder names? It came up for me when I wanted to put my AoC into a 2023 folder and 01 subfolder, but they aren't valid idents so that was a parsing error.</p>



<a name="405713400"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/module%20params/near/405713400" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/module.20params.html#405713400">(Dec 04 2023 at 00:28)</a>:</h4>
<p>well for referring to them in a qualified way</p>



<a name="405713413"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/module%20params/near/405713413" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/module.20params.html#405713413">(Dec 04 2023 at 00:28)</a>:</h4>
<p>e.g. <code>Foo.Bar.baz</code></p>



<a name="405713742"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/module%20params/near/405713742" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Agus Zubiaga <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/module.20params.html#405713742">(Dec 04 2023 at 00:31)</a>:</h4>
<p>To clarify, that’s not a thing anymore in the new proposal, right?</p>



<a name="405714222"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/module%20params/near/405714222" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/module.20params.html#405714222">(Dec 04 2023 at 00:36)</a>:</h4>
<p>hm true</p>



<a name="405714230"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/module%20params/near/405714230" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/module.20params.html#405714230">(Dec 04 2023 at 00:36)</a>:</h4>
<p>well, <code>Bar.baz</code> still is</p>



<a name="405714289"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/module%20params/near/405714289" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/module.20params.html#405714289">(Dec 04 2023 at 00:36)</a>:</h4>
<p>so like if you loaded from a module named <code>x-y-z.roc</code> then referring to that in a qualified way would be <code>x-y-z.baz</code> which definitely means something else <span aria-label="big smile" class="emoji emoji-1f604" role="img" title="big smile">:big_smile:</span></p>



<a name="405714975"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/module%20params/near/405714975" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/module.20params.html#405714975">(Dec 04 2023 at 00:42)</a>:</h4>
<p>Is there a bit of a convention here, apps/packages/platform mains are lowercase and other modules are uppercase?</p>



<a name="405714985"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/module%20params/near/405714985" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Agus Zubiaga <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/module.20params.html#405714985">(Dec 04 2023 at 00:42)</a>:</h4>
<p>Totally. I suppose we could support that by requiring an alias, but honestly I haven’t had the need to do something like this in Elm.</p>



<a name="405715003"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/module%20params/near/405715003" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/module.20params.html#405715003">(Dec 04 2023 at 00:42)</a>:</h4>
<p>yeah same</p>



<a name="405715041"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/module%20params/near/405715041" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/module.20params.html#405715041">(Dec 04 2023 at 00:43)</a>:</h4>
<p><span class="user-mention silent" data-user-id="515757">Luke Boswell</span> <a href="#narrow/stream/395097-compiler-development/topic/module.20params/near/405714975">said</a>:</p>
<blockquote>
<p>Is there a bit of a convention here, apps/packages/platform mains are lowercase and other modules are uppercase?</p>
</blockquote>
<p>yeah exactly - partly because those can't be imported as modules anyway</p>



<a name="405715066"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/module%20params/near/405715066" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/module.20params.html#405715066">(Dec 04 2023 at 00:43)</a>:</h4>
<p>so they can be named anything</p>



<a name="406294047"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/module%20params/near/406294047" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Agus Zubiaga <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/module.20params.html#406294047">(Dec 06 2023 at 12:25)</a>:</h4>
<p>I was looking at <a href="https://github.com/roc-lang/roc/issues/6185">this issue</a> related to imports and realized that I don't know how it's supposed to work. </p>
<p>So if you have an <code>app</code> or <code>package</code> you can specify dependency packages, import modules from them, and you can also import <code>interface</code> modules that use those packages. If you run <code>roc check</code> (or test) against the <code>app</code> file, everything works as expected.</p>
<p>However, you can also run <code>roc check</code> with an <code>interface</code> file directly, and it works fine as long as you don't import a package. This makes sense because since there's no  <code>app</code>, there's no way it can know what package the shorthand refers to. I imagine the LSP would also have this problem as it tries to check or autocomplete a module. </p>
<p>Is there a plan to resolve the app somehow? Maybe there's a convention for where to find it, or a CLI flag that can be specified?</p>



<a name="406294466"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/module%20params/near/406294466" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/module.20params.html#406294466">(Dec 06 2023 at 12:28)</a>:</h4>
<p>yeah it could be an app, package, or platform too</p>



<a name="406294583"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/module%20params/near/406294583" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/module.20params.html#406294583">(Dec 06 2023 at 12:28)</a>:</h4>
<p>certainly we already have a convention of that being main.roc, but of course it doesn't have to be</p>



<a name="406294693"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/module%20params/near/406294693" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/module.20params.html#406294693">(Dec 06 2023 at 12:29)</a>:</h4>
<p>I think the cli flag option makes sense</p>



<a name="406294941"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/module%20params/near/406294941" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/module.20params.html#406294941">(Dec 06 2023 at 12:30)</a>:</h4>
<p>LSP could do things like trying main.roc first, and if that's not there, try all the .roc files in the folder (it's probably going to end up reading and parsing them all anyway, so once we have caching that should be cheap) and then remembering which one it concluded was the root module until that file is deleted from the file system</p>



<a name="406295077"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/module%20params/near/406295077" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Agus Zubiaga <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/module.20params.html#406295077">(Dec 06 2023 at 12:31)</a>:</h4>
<p>You'd probably need a config option for the LSP too, in case you have multiple apps.</p>



<a name="406295201"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/module%20params/near/406295201" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Agus Zubiaga <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/module.20params.html#406295201">(Dec 06 2023 at 12:32)</a>:</h4>
<p>Do you think the CLI could also default to <code>main.roc</code> or should we fail and require the user to specify when checking a module?</p>



<a name="406295429"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/module%20params/near/406295429" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/module.20params.html#406295429">(Dec 06 2023 at 12:33)</a>:</h4>
<p>yeah I think multiple apps should be very rare unless they're small scripts that probably don't have interfaces, but of course it could happen <span aria-label="+1" class="emoji emoji-1f44d" role="img" title="+1">:+1:</span></p>



<a name="406295510"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/module%20params/near/406295510" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/module.20params.html#406295510">(Dec 06 2023 at 12:34)</a>:</h4>
<p>I think default to main.roc</p>



<a name="406295768"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/module%20params/near/406295768" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Agus Zubiaga <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/module.20params.html#406295768">(Dec 06 2023 at 12:35)</a>:</h4>
<p>Yeah, that seems convenient. I suppose it would recursively try to find it from the module's directory and back. I believe this is how node finds <code>node_modules</code>, for example.</p>



<a name="406296017"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/module%20params/near/406296017" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Agus Zubiaga <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/module.20params.html#406296017">(Dec 06 2023 at 12:37)</a>:</h4>
<p>Maybe just looking in the current directory is more sensible, though</p>



<a name="406297139"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/module%20params/near/406297139" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/module.20params.html#406297139">(Dec 06 2023 at 12:44)</a>:</h4>
<p>oh yeah I forget where we ended up on the interface name appearing at the start of the module or not</p>



<a name="406297168"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/module%20params/near/406297168" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/module.20params.html#406297168">(Dec 06 2023 at 12:44)</a>:</h4>
<p>if it's in the source file, then we know what directory to look in</p>



<a name="406297186"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/module%20params/near/406297186" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/module.20params.html#406297186">(Dec 06 2023 at 12:44)</a>:</h4>
<p>but if not, then yeah we'd have to recurse</p>



<a name="406297300"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/module%20params/near/406297300" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Agus Zubiaga <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/module.20params.html#406297300">(Dec 06 2023 at 12:45)</a>:</h4>
<p>Well, what we need to find is the app/package file and I don't think the module would refer to that anyway.</p>



<a name="406297424"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/module%20params/near/406297424" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Agus Zubiaga <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/module.20params.html#406297424">(Dec 06 2023 at 12:46)</a>:</h4>
<p>I might have misunderstood what you meant</p>



<a name="406298040"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/module%20params/near/406298040" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/module.20params.html#406298040">(Dec 06 2023 at 12:50)</a>:</h4>
<p>like if I have <code>interface Foo.Bar.Baz</code> then I know to look up exactly 2 directories (<code>Foo/Bar/</code>) for the root module</p>



<a name="406298114"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/module%20params/near/406298114" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/module.20params.html#406298114">(Dec 06 2023 at 12:50)</a>:</h4>
<p>but if that isn't declared at the top of the file, then the root module could be any number of directories up</p>



<a name="406298155"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/module%20params/near/406298155" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Agus Zubiaga <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/module.20params.html#406298155">(Dec 06 2023 at 12:51)</a>:</h4>
<p>Ah, I didn't think of that! Yeah, at least in the google doc, it looks like we won't have that anymore.</p>



<a name="406298723"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/module%20params/near/406298723" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Agus Zubiaga <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/module.20params.html#406298723">(Dec 06 2023 at 12:54)</a>:</h4>
<p>It doesn't look like that changed from Zulip discussions. At least, I haven't found that.</p>



<a name="406299040"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/module%20params/near/406299040" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Agus Zubiaga <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/module.20params.html#406299040">(Dec 06 2023 at 12:57)</a>:</h4>
<p>Personally, I like the idea of using the file name as the source of truth. Having to keep those in sync can be a little annoying in Elm.</p>



<a name="406299959"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/module%20params/near/406299959" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Agus Zubiaga <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/module.20params.html#406299959">(Dec 06 2023 at 13:02)</a>:</h4>
<p>I'm now torn, though. It does seem convenient for this use case. I don't care that much about the implementation, recursing would probably be fine, but I think for the user, it might be more intuitive to find the app/package this way.</p>



<a name="406301833"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/module%20params/near/406301833" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/module.20params.html#406301833">(Dec 06 2023 at 13:13)</a>:</h4>
<p>besides convenience, another theoretical benefit of not having the path there is that multiple root modules in different directories can import the same interface</p>



<a name="406304065"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/module%20params/near/406304065" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/module.20params.html#406304065">(Dec 06 2023 at 13:26)</a>:</h4>
<p>I've never actually wanted to do this in practice though <span aria-label="sweat smile" class="emoji emoji-1f605" role="img" title="sweat smile">:sweat_smile:</span></p>



<a name="407006874"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/module%20params/near/407006874" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Agus Zubiaga <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/module.20params.html#407006874">(Dec 10 2023 at 04:04)</a>:</h4>
<p>I just realized that we don’t need to recurse to find the app/package main since there won’t be module folders anymore <span aria-label="big smile" class="emoji emoji-1f604" role="img" title="big smile">:big_smile:</span></p>



<a name="407007135"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/module%20params/near/407007135" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/module.20params.html#407007135">(Dec 10 2023 at 04:08)</a>:</h4>
<p>oh right! <span aria-label="laughing" class="emoji emoji-1f606" role="img" title="laughing">:laughing:</span></p>



<a name="407008643"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/module%20params/near/407008643" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Agus Zubiaga <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/module.20params.html#407008643">(Dec 10 2023 at 04:26)</a>:</h4>
<p>Do we only want to parse record literals for module params or can they be any expression?</p>
<p>In other words, should this be allowed?</p>
<div class="codehilite"><pre><span></span><code>params = { echo }

import A params
</code></pre></div>



<a name="407008725"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/module%20params/near/407008725" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Agus Zubiaga <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/module.20params.html#407008725">(Dec 10 2023 at 04:27)</a>:</h4>
<p>I guess not, but just to be sure <span aria-label="smile" class="emoji emoji-1f642" role="img" title="smile">:smile:</span></p>



<a name="407008985"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/module%20params/near/407008985" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/module.20params.html#407008985">(Dec 10 2023 at 04:31)</a>:</h4>
<p>only record literals I think</p>



<a name="407009018"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/module%20params/near/407009018" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/module.20params.html#407009018">(Dec 10 2023 at 04:31)</a>:</h4>
<p>(we can always relax that in the future if there's some specific reason it seems like a good idea)</p>



<a name="407009123"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/module%20params/near/407009123" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Agus Zubiaga <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/module.20params.html#407009123">(Dec 10 2023 at 04:32)</a>:</h4>
<p>Sounds good. I thought there might be some use cases where passing a tag could be nice, but I couldn't come up with any obvious ones :D</p>



<a name="407009395"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/module%20params/near/407009395" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/module.20params.html#407009395">(Dec 10 2023 at 04:36)</a>:</h4>
<p>for testing I can imagine theoretically wanting to pass a record in, but supporting that is more than just a parsing concern</p>



<a name="407009410"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/module%20params/near/407009410" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/module.20params.html#407009410">(Dec 10 2023 at 04:36)</a>:</h4>
<p>doesn't seem worth assuming it's a good idea <span aria-label="stuck out tongue" class="emoji emoji-1f61b" role="img" title="stuck out tongue">:stuck_out_tongue:</span></p>



<a name="410053910"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/module%20params/near/410053910" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Agus Zubiaga <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/module.20params.html#410053910">(Dec 26 2023 at 18:18)</a>:</h4>
<p>I'm back to this now that I have some free time <span aria-label="smiley" class="emoji emoji-1f603" role="img" title="smiley">:smiley:</span> </p>
<p>I'm running into a parsing issue I don't have an obvious solution for. Take this example:</p>
<div class="codehilite"><pre><span></span><code>users : List { name: Str, age: U8 }
users =
    import &quot;users.json&quot; as data : Str
    data |&gt; parseJson |&gt; Result.withDefault []
</code></pre></div>
<p>When it's parsing the annotation in <code>data : Str</code>, it will continue to the next line and parse the intended <code>data</code> expr identifier as a type variable for <code>Str</code>, as if it were <code>... as data : Str data</code>. </p>
<p>It later fails when it finds the <code>|&gt;</code> because that doesn't make sense as part of type annotation or as the start of the expression that follows. </p>
<p>Initially, I think that wouldn't happen because I use <code>increment_min_indent</code> after I find the <code>import</code> keyword. However, it looks like <a href="https://github.com/roc-lang/roc/blob/5d98783cf2767e6d1c96b80ffeca8a1ff3e84637/crates/compiler/parse/src/module.rs#L573"><code>module::typed_ident</code> resets it</a>.</p>
<p>Any ideas on how to handle this?</p>



<a name="410054287"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/module%20params/near/410054287" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anton <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/module.20params.html#410054287">(Dec 26 2023 at 18:24)</a>:</h4>
<p><span class="user-mention" data-user-id="453336">@Joshua Warner</span> may have an idea</p>



<a name="410054599"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/module%20params/near/410054599" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Agus Zubiaga <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/module.20params.html#410054599">(Dec 26 2023 at 18:28)</a>:</h4>
<p>We only support <code>Str</code> and <code>List U8</code> for ingested files, so I could cheat here, but that seems weird</p>



<a name="410055199"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/module%20params/near/410055199" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Agus Zubiaga <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/module.20params.html#410055199">(Dec 26 2023 at 18:36)</a>:</h4>
<p>I'm not sure <code>typed_ident</code> needs to reset min ident. At first, I thought that was because we want this to parse:</p>
<div class="codehilite"><pre><span></span><code>User : {
  age: U8,
}
</code></pre></div>
<p>However, given that <a href="https://github.com/roc-lang/roc/blob/5d98783cf2767e6d1c96b80ffeca8a1ff3e84637/crates/compiler/parse/src/module.rs#L555-L587"><code>typed_ident</code></a> itself doesn't <code>increment_min_ident</code> after the name (<code>User</code>), that would still parse I think.</p>



<a name="410056190"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/module%20params/near/410056190" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Warner <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/module.20params.html#410056190">(Dec 26 2023 at 18:50)</a>:</h4>
<p>I think the fault here lies with <code>type_annotation::expression</code> not enforcing that the second (and later) terms in a type expression must be indented relative to the line the expression starts on</p>



<a name="410056350"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/module%20params/near/410056350" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Warner <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/module.20params.html#410056350">(Dec 26 2023 at 18:53)</a>:</h4>
<p>Actually... the fix is fairly simple. This <code>and!</code> should be an <code>indented_seq!</code> instead: <a href="https://github.com/roc-lang/roc/blob/5d98783cf2767e6d1c96b80ffeca8a1ff3e84637/crates/compiler/parse/src/type_annotation.rs#L389">https://github.com/roc-lang/roc/blob/5d98783cf2767e6d1c96b80ffeca8a1ff3e84637/crates/compiler/parse/src/type_annotation.rs#L389</a></p>



<a name="410056469"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/module%20params/near/410056469" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Agus Zubiaga <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/module.20params.html#410056469">(Dec 26 2023 at 18:55)</a>:</h4>
<p>Oh, cool. I'll try that.</p>



<a name="410056488"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/module%20params/near/410056488" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Agus Zubiaga <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/module.20params.html#410056488">(Dec 26 2023 at 18:55)</a>:</h4>
<p>FWIW all tests seem to pass if I remove <code>reset_min_indent</code> from <code>typed_ident</code>, and my example parses correctly</p>



<a name="410056509"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/module%20params/near/410056509" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Agus Zubiaga <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/module.20params.html#410056509">(Dec 26 2023 at 18:55)</a>:</h4>
<p>Do you think we still need it?</p>



<a name="410056512"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/module%20params/near/410056512" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Warner <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/module.20params.html#410056512">(Dec 26 2023 at 18:55)</a>:</h4>
<p>Yeah, I think it's arguable whether that reset_min_indent belongs there</p>



<a name="410056661"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/module%20params/near/410056661" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Warner <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/module.20params.html#410056661">(Dec 26 2023 at 18:57)</a>:</h4>
<p>On the one hand, it does make the parser a little more error tolerant if someone accidentally put a newline right after the : and forgot to indent. On the other hand, that someone might equally have forgotten to put a type after the :, and by continuing to parse at the same indent level, we're just going to be accidentally interpreting part of the next line as a type.</p>



<a name="410057304"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/module%20params/near/410057304" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Agus Zubiaga <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/module.20params.html#410057304">(Dec 26 2023 at 19:03)</a>:</h4>
<p>Yeah, exactly what I was thinking.</p>
<p>It looks like <a href="https://github.com/roc-lang/roc/blob/5d98783cf2767e6d1c96b80ffeca8a1ff3e84637/crates/compiler/parse/src/parser.rs#L1332">unlike <code>and!</code></a>, <code>indented_seq!</code> <a href="https://github.com/roc-lang/roc/blob/5d98783cf2767e6d1c96b80ffeca8a1ff3e84637/crates/compiler/parse/src/parser.rs#L1378">discards the output of <code>$p1</code></a>, so it doesn't quite work.</p>



<a name="410057453"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/module%20params/near/410057453" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Agus Zubiaga <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/module.20params.html#410057453">(Dec 26 2023 at 19:05)</a>:</h4>
<p>It works more like <code>skip_first!</code>, which makes sense the other cases use keywords in <code>$p1</code></p>



<a name="410057552"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/module%20params/near/410057552" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Warner <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/module.20params.html#410057552">(Dec 26 2023 at 19:06)</a>:</h4>
<p>We probably want a variant of <code>indented_seq!</code> that doesn't drop the first argument</p>



<a name="410057641"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/module%20params/near/410057641" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Warner <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/module.20params.html#410057641">(Dec 26 2023 at 19:07)</a>:</h4>
<p>actually, we should probably just rename the current one to <code>indented_seq_skip_first</code> or something, and make a new one that returns both args</p>



<a name="410057973"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/module%20params/near/410057973" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Agus Zubiaga <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/module.20params.html#410057973">(Dec 26 2023 at 19:11)</a>:</h4>
<p>It seems to work fine with this change! Thank you <span aria-label="raised hands" class="emoji emoji-1f64c" role="img" title="raised hands">:raised_hands:</span></p>



<a name="410058071"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/module%20params/near/410058071" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Agus Zubiaga <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/module.20params.html#410058071">(Dec 26 2023 at 19:13)</a>:</h4>
<p><span class="user-mention silent" data-user-id="453336">Joshua Warner</span> <a href="#narrow/stream/395097-compiler-development/topic/module.20params/near/410056661">said</a>:</p>
<blockquote>
<p>On the one hand, it does make the parser a little more error tolerant if someone accidentally put a newline right after the : and forgot to indent. On the other hand, that someone might equally have forgotten to put a type after the :, and by continuing to parse at the same indent level, we're just going to be accidentally interpreting part of the next line as a type.</p>
</blockquote>
<p>I'm curious what <span class="user-mention" data-user-id="281383">@Richard Feldman</span> thinks about this, but that's not a blocker.</p>



<a name="410203236"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/module%20params/near/410203236" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Agus Zubiaga <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/module.20params.html#410203236">(Dec 27 2023 at 21:23)</a>:</h4>
<p>I'm working on updating <code>load</code> to work with inline imports. As we've discussed before, now that imports could appear anywhere, we don't know the dependencies until we have actually parsed the whole file (not just the header).</p>
<p>I'm not sure what's the best way to find these after parsing, though. They are available in the AST, but walking through all the expressions to find them seems wasteful, or is that ok? Another option, is to add a <code>Vec</code> to the parser's state to which we would insert imported module names as we find them. Does that sound like a good idea?</p>



<a name="410203913"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/module%20params/near/410203913" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ayaz Hafiz <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/module.20params.html#410203913">(Dec 27 2023 at 21:31)</a>:</h4>
<p>I would suggest walking the AST first and then if it turns out having it in the parser state gets rid of a bottleneck doing that later.</p>



<a name="410336131"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/module%20params/near/410336131" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Agus Zubiaga <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/module.20params.html#410336131">(Dec 28 2023 at 19:59)</a>:</h4>
<p>So while building headers in <code>load</code>, we have a <code>scope_size</code> variable that gets incremented whenever we find an import and is later used to allocate hashmap. </p>
<p>That all makes sense, but I think what we are incrementing it by is wrong: <a href="https://github.com/roc-lang/roc/blob/4569770c82c48b297d6552405023ee16f271cd86/crates/compiler/load_internal/src/file.rs#L4312">https://github.com/roc-lang/roc/blob/4569770c82c48b297d6552405023ee16f271cd86/crates/compiler/load_internal/src/file.rs#L4312</a></p>
<p>I think that should be <code>+= exposed.len()</code>, not <code>+= num_exposes</code> since <code>num_exposes</code> is actually the number of exposed names from the current module, not those from the import.</p>



<a name="410337361"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/module%20params/near/410337361" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/module.20params.html#410337361">(Dec 28 2023 at 20:12)</a>:</h4>
<p>I think you're right!</p>



<a name="410462739"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/module%20params/near/410462739" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Agus Zubiaga <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/module.20params.html#410462739">(Dec 29 2023 at 18:16)</a>:</h4>
<p>I just realized we can now do this without a special REPL command: <a href="https://github.com/roc-lang/roc/issues/609">https://github.com/roc-lang/roc/issues/609</a> <span aria-label="smile" class="emoji emoji-1f642" role="img" title="smile">:smile:</span></p>



<a name="410462796"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/module%20params/near/410462796" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/module.20params.html#410462796">(Dec 29 2023 at 18:17)</a>:</h4>
<p>ha, good point!</p>



<a name="412251158"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/module%20params/near/412251158" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Agus Zubiaga <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/module.20params.html#412251158">(Jan 11 2024 at 01:35)</a>:</h4>
<p>I'm rewriting unused import warnings because, with inline imports, they now need to happen in <code>can</code> instead of <code>load</code> as they're limited to certain scopes.</p>
<p>It looks like currently we don't differentiate between qualified and unqualified symbol references, which means that we don't report exposed symbols from imports, even if they're only used qualified.</p>
<div class="codehilite" data-code-language="CoffeeScript"><pre><span></span><code><span class="nx">app</span><span class="w"> </span><span class="s">"example"</span>
<span class="w">    </span><span class="nx">packages</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nv">pf</span><span class="o">:</span><span class="w"> </span><span class="s">".."</span><span class="w"> </span><span class="p">}</span>
<span class="w">    </span><span class="nx">imports</span><span class="w"> </span><span class="p">[</span><span class="nx">pf</span><span class="p">.</span><span class="nx">Stdout</span><span class="p">.{</span><span class="w"> </span><span class="nx">line</span><span class="w"> </span><span class="p">}]</span>
<span class="w">                       </span><span class="c1"># ^^^^ this is unused</span>
<span class="w">    </span><span class="nx">provides</span><span class="w"> </span><span class="p">[</span><span class="nx">main</span><span class="p">]</span><span class="w"> </span><span class="nx">to</span><span class="w"> </span><span class="nx">pf</span>

<span class="nv">main</span><span class="w"> </span><span class="o">=</span>
<span class="w">    </span><span class="nx">Stdout</span><span class="p">.</span><span class="nx">line</span><span class="w"> </span><span class="s">"Hello world!"</span>
<span class="w">    </span><span class="c1">#      ^^^^ symbol used here but qualified</span>
</code></pre></div>
<p>This is a bug, right?</p>



<a name="412253104"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/module%20params/near/412253104" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Agus Zubiaga <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/module.20params.html#412253104">(Jan 11 2024 at 01:59)</a>:</h4>
<p>I found <a href="https://github.com/roc-lang/roc/blob/4e51efcba5a9e97063a67a855d5dbb6adaeba116/crates/compiler/load_internal/tests/fixtures/build/interface_with_deps/Primary.roc#L3">tests</a> with these unused exposed names (see <code>Dep2.{ two }</code>), but I guess those are just leftovers</p>



<a name="412253321"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/module%20params/near/412253321" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/module.20params.html#412253321">(Jan 11 2024 at 02:01)</a>:</h4>
<p>yeah that's a bug!</p>



<a name="412253338"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/module%20params/near/412253338" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/module.20params.html#412253338">(Jan 11 2024 at 02:01)</a>:</h4>
<p>I don't think I even considered this scenario when I was writing the unused warnings in like 2019 <span aria-label="sweat smile" class="emoji emoji-1f605" role="img" title="sweat smile">:sweat_smile:</span></p>



<a name="412253767"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/module%20params/near/412253767" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Agus Zubiaga <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/module.20params.html#412253767">(Jan 11 2024 at 02:07)</a>:</h4>
<p>Makes sense. I'll fix it! <span aria-label="smiley" class="emoji emoji-1f603" role="img" title="smiley">:smiley:</span></p>



<a name="412253905"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/module%20params/near/412253905" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/module.20params.html#412253905">(Jan 11 2024 at 02:08)</a>:</h4>
<p>thank you, appreciate it! <span aria-label="heart" class="emoji emoji-2764" role="img" title="heart">:heart:</span></p>



<a name="412254166"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/module%20params/near/412254166" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Agus Zubiaga <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/module.20params.html#412254166">(Jan 11 2024 at 02:12)</a>:</h4>
<p>I think we need to tweak the copy a bit now that imports can appear inside defs:</p>
<div class="codehilite" data-code-language="Elm"><pre><span></span><code><span class="nv">unusedModule</span><span class="w"> </span><span class="nf">=</span>
<span class="w">    </span><span class="kr">import</span><span class="w"> </span><span class="kt">Dep</span>
<span class="w">    </span><span class="s">"I'm not using Dep"</span>
</code></pre></div>
<p>As I have it now, this would be reported as:</p>
<div class="codehilite"><pre><span></span><code>── UNUSED IMPORT ───────────────────────────────────── tmp/unused_imports/Main ─

Nothing from Dep is used in this module.

10│      import Dep
         ^^^^^^^^^^

Since Dep isn&#39;t used, you don&#39;t need to import it
</code></pre></div>
<p>Should we use "scope" instead of "module" if it isn't top-level? Is that too technical?</p>



<a name="412254227"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/module%20params/near/412254227" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/module.20params.html#412254227">(Jan 11 2024 at 02:13)</a>:</h4>
<p>I'd just re-word it to "Dep2  is imported but not used."</p>



<a name="412254277"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/module%20params/near/412254277" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Agus Zubiaga <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/module.20params.html#412254277">(Jan 11 2024 at 02:14)</a>:</h4>
<p>Ah cool, that's easy :)</p>



<a name="412430383"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/module%20params/near/412430383" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Agus Zubiaga <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/module.20params.html#412430383">(Jan 11 2024 at 22:14)</a>:</h4>
<p>It looks like currently you can import a builtin explicitly and we'll just ignore it. Should we make that a warning?  It could be an opportunity to explain how builtins work <span aria-label="smile" class="emoji emoji-1f642" role="img" title="smile">:smile:</span></p>



<a name="412430839"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/module%20params/near/412430839" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/module.20params.html#412430839">(Jan 11 2024 at 22:18)</a>:</h4>
<p>if we do, we might need special handling for the builtins themselves; they actually need to import each other explicitly</p>



<a name="412430950"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/module%20params/near/412430950" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Agus Zubiaga <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/module.20params.html#412430950">(Jan 11 2024 at 22:19)</a>:</h4>
<p>Yeah, but that's as easy as <code>.is_builtin()</code></p>



<a name="412431348"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/module%20params/near/412431348" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Agus Zubiaga <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/module.20params.html#412431348">(Jan 11 2024 at 22:22)</a>:</h4>
<p>This is what I'm thinking:</p>
<div class="codehilite"><pre><span></span><code>── BUILTIN IMPORT ───────────────────────────────────── tmp/unused_builtins/Main ─

The Str builtin was imported explicitly.

10│      import Str
         ^^^^^^^^^^

Builtins are imported automatically into every Roc module, so you can remove this line.

You can learn more about builtin modules at &lt;https://www.roc-lang.org/tutorial#builtin-modules&gt;
</code></pre></div>



<a name="412431612"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/module%20params/near/412431612" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Agus Zubiaga <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/module.20params.html#412431612">(Jan 11 2024 at 22:24)</a>:</h4>
<p>I don't know, maybe it's not that useful</p>



<a name="412458299"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/module%20params/near/412458299" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/module.20params.html#412458299">(Jan 12 2024 at 01:49)</a>:</h4>
<p>I think it's reasonable!</p>



<a name="412458329"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/module%20params/near/412458329" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/module.20params.html#412458329">(Jan 12 2024 at 01:49)</a>:</h4>
<p>in general we tend to warn for things that are definitely unnecessary</p>



<a name="412458379"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/module%20params/near/412458379" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/module.20params.html#412458379">(Jan 12 2024 at 01:49)</a>:</h4>
<p>I'd say only do it if you feel like it, but from a design perspective it seems like a good idea to me <span aria-label="big smile" class="emoji emoji-1f604" role="img" title="big smile">:big_smile:</span></p>



<a name="416689153"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/module%20params/near/416689153" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/module.20params.html#416689153">(Jan 19 2024 at 02:14)</a>:</h4>
<p>I've been working on something for my Action-State experiment and stopped to think about this proposal and what it might look like. I'm just wondering what the following might look like in a module-params future?? Note the modules <code>Action</code>, <code>GUI</code>, and <code>Core</code> come from the platform.</p>
<h3>Current</h3>
<div class="codehilite" data-code-language="Haskell"><pre><span></span><code><span class="nf">interface</span><span class="w"> </span><span class="kt">Counter</span>
<span class="w">    </span><span class="n">exposes</span><span class="w"> </span><span class="p">[</span>
<span class="w">        </span><span class="kt">Counter</span><span class="p">,</span>
<span class="w">        </span><span class="n">init</span><span class="p">,</span>
<span class="w">        </span><span class="n">render</span><span class="p">,</span>
<span class="w">    </span><span class="p">]</span>
<span class="w">    </span><span class="n">imports</span><span class="w"> </span><span class="p">[</span><span class="n">ray</span><span class="o">.</span><span class="kt">Action</span><span class="o">.</span><span class="p">{</span><span class="w"> </span><span class="kt">Action</span><span class="w"> </span><span class="p">},</span><span class="w"> </span><span class="n">ray</span><span class="o">.</span><span class="kt">Core</span><span class="o">.</span><span class="p">{</span><span class="w"> </span><span class="kt">Color</span><span class="w"> </span><span class="p">},</span><span class="w"> </span><span class="n">ray</span><span class="o">.</span><span class="kt">GUI</span><span class="o">.</span><span class="p">{</span><span class="w"> </span><span class="kt">Elem</span><span class="w"> </span><span class="p">}]</span>

<span class="kt">Counter</span><span class="w"> </span><span class="kt">:=</span><span class="w"> </span><span class="kt">I64</span>

<span class="nf">init</span><span class="w"> </span><span class="kt">:</span><span class="w"> </span><span class="kt">I64</span><span class="w"> </span><span class="ow">-&gt;</span><span class="w"> </span><span class="kt">Counter</span>
<span class="nf">init</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="o">@</span><span class="kt">Counter</span>

<span class="nf">render</span><span class="w"> </span><span class="kt">:</span><span class="w"> </span><span class="kt">Counter</span><span class="p">,</span><span class="w"> </span><span class="kt">Color</span><span class="w"> </span><span class="ow">-&gt;</span><span class="w"> </span><span class="kt">Elem</span><span class="w"> </span><span class="kt">Counter</span>
<span class="nf">render</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="o">\@</span><span class="kt">Counter</span><span class="w"> </span><span class="n">state</span><span class="p">,</span><span class="w"> </span><span class="n">color</span><span class="w"> </span><span class="ow">-&gt;</span>
<span class="w">    </span><span class="kt">GUI</span><span class="o">.</span><span class="n">col</span><span class="w"> </span><span class="p">[</span>
<span class="w">        </span><span class="kt">GUI</span><span class="o">.</span><span class="n">button</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">text</span><span class="kt">:</span><span class="w"> </span><span class="s">"+"</span><span class="p">,</span><span class="w"> </span><span class="n">onPress</span><span class="kt">:</span><span class="w"> </span><span class="o">\@</span><span class="kt">Counter</span><span class="w"> </span><span class="n">prev</span><span class="w"> </span><span class="ow">-&gt;</span><span class="w"> </span><span class="kt">Action</span><span class="o">.</span><span class="n">update</span><span class="w"> </span><span class="p">(</span><span class="o">@</span><span class="kt">Counter</span><span class="w"> </span><span class="p">(</span><span class="n">prev</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">))</span><span class="w"> </span><span class="p">},</span>
<span class="w">        </span><span class="kt">GUI</span><span class="o">.</span><span class="n">text</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">label</span><span class="kt">:</span><span class="w"> </span><span class="s">"Clicked $(Num.toStr state) times"</span><span class="p">,</span><span class="w"> </span><span class="n">color</span><span class="w"> </span><span class="p">},</span>
<span class="w">        </span><span class="kt">GUI</span><span class="o">.</span><span class="n">button</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">text</span><span class="kt">:</span><span class="w"> </span><span class="s">"-"</span><span class="p">,</span><span class="w"> </span><span class="n">onPress</span><span class="kt">:</span><span class="w"> </span><span class="o">\@</span><span class="kt">Counter</span><span class="w"> </span><span class="n">prev</span><span class="w"> </span><span class="ow">-&gt;</span><span class="w"> </span><span class="kt">Action</span><span class="o">.</span><span class="n">update</span><span class="w"> </span><span class="p">(</span><span class="o">@</span><span class="kt">Counter</span><span class="w"> </span><span class="p">(</span><span class="n">prev</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">))</span><span class="w"> </span><span class="p">},</span>
<span class="w">    </span><span class="p">]</span>
</code></pre></div>
<h3>Future ??</h3>
<div class="codehilite" data-code-language="Haskell"><pre><span></span><code><span class="kr">module</span><span class="w"> </span><span class="err">{</span><span class="nn">Elem</span><span class="p">,</span><span class="kt">Color</span><span class="p">,</span><span class="n">button</span><span class="p">,</span><span class="n">text</span><span class="p">,</span><span class="n">col</span><span class="p">,</span><span class="n">update</span><span class="p">}</span><span class="w"> </span><span class="ow">-&gt;</span><span class="w"> </span><span class="p">[</span><span class="kt">Counter</span><span class="p">,</span><span class="w"> </span><span class="n">init</span><span class="p">,</span><span class="w"> </span><span class="n">render</span><span class="p">]</span>

<span class="kt">Counter</span><span class="w"> </span><span class="kt">:=</span><span class="w"> </span><span class="kt">I64</span>

<span class="nf">init</span><span class="w"> </span><span class="kt">:</span><span class="w"> </span><span class="kt">I64</span><span class="w"> </span><span class="ow">-&gt;</span><span class="w"> </span><span class="kt">Counter</span>
<span class="nf">init</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="o">@</span><span class="kt">Counter</span>

<span class="nf">render</span><span class="w"> </span><span class="kt">:</span><span class="w"> </span><span class="kt">Counter</span><span class="p">,</span><span class="w"> </span><span class="kt">Color</span><span class="w"> </span><span class="ow">-&gt;</span><span class="w"> </span><span class="kt">Elem</span><span class="w"> </span><span class="kt">Counter</span>
<span class="nf">render</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="o">\@</span><span class="kt">Counter</span><span class="w"> </span><span class="n">state</span><span class="p">,</span><span class="w"> </span><span class="n">color</span><span class="w"> </span><span class="ow">-&gt;</span>
<span class="w">    </span><span class="n">col</span><span class="w"> </span><span class="p">[</span>
<span class="w">        </span><span class="n">button</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">text</span><span class="kt">:</span><span class="w"> </span><span class="s">"+"</span><span class="p">,</span><span class="w"> </span><span class="n">onPress</span><span class="kt">:</span><span class="w"> </span><span class="o">\@</span><span class="kt">Counter</span><span class="w"> </span><span class="n">prev</span><span class="w"> </span><span class="ow">-&gt;</span><span class="w"> </span><span class="n">update</span><span class="w"> </span><span class="p">(</span><span class="o">@</span><span class="kt">Counter</span><span class="w"> </span><span class="p">(</span><span class="n">prev</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">))</span><span class="w"> </span><span class="p">},</span>
<span class="w">        </span><span class="n">text</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">label</span><span class="kt">:</span><span class="w"> </span><span class="s">"Clicked $(Num.toStr state) times"</span><span class="p">,</span><span class="w"> </span><span class="n">color</span><span class="w"> </span><span class="p">},</span>
<span class="w">        </span><span class="n">button</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">text</span><span class="kt">:</span><span class="w"> </span><span class="s">"-"</span><span class="p">,</span><span class="w"> </span><span class="n">onPress</span><span class="kt">:</span><span class="w"> </span><span class="o">\@</span><span class="kt">Counter</span><span class="w"> </span><span class="n">prev</span><span class="w"> </span><span class="ow">-&gt;</span><span class="w"> </span><span class="n">update</span><span class="w"> </span><span class="p">(</span><span class="o">@</span><span class="kt">Counter</span><span class="w"> </span><span class="p">(</span><span class="n">prev</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">))</span><span class="w"> </span><span class="p">},</span>
<span class="w">    </span><span class="p">]</span>
</code></pre></div>



<a name="416695890"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/module%20params/near/416695890" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/module.20params.html#416695890">(Jan 19 2024 at 02:41)</a>:</h4>
<p>I'm not sure it makes sense for most of those pieces to be generic as module params. Module params are really just for dependency injection.</p>
<p>So I would guess most of those inputs would be imported directly. Though I guess if you want your counter to be generic over gui/tui/etc you might do something like that.</p>



<a name="416696858"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/module%20params/near/416696858" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/module.20params.html#416696858">(Jan 19 2024 at 02:52)</a>:</h4>
<p>Oh, so can we still import modules from the platform? </p>
<p>Like <code>import ray.GUI {col, button, text}</code> etc?</p>



<a name="416697780"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/module%20params/near/416697780" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/module.20params.html#416697780">(Jan 19 2024 at 03:01)</a>:</h4>
<p>I think it will be <code>import ray.Gui exposing {col, button, text}</code></p>



<a name="416697836"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/module%20params/near/416697836" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/module.20params.html#416697836">(Jan 19 2024 at 03:02)</a>:</h4>
<p>though not exactly sure the final syntax</p>



<a name="416756825"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/module%20params/near/416756825" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Agus Zubiaga <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/module.20params.html#416756825">(Jan 19 2024 at 11:13)</a>:</h4>
<p>Yeah, your local modules can import things from the platform, packages cannot</p>



<a name="416757090"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/module%20params/near/416757090" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Agus Zubiaga <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/module.20params.html#416757090">(Jan 19 2024 at 11:15)</a>:</h4>
<p><span class="user-mention silent" data-user-id="343810">Brendan Hansknecht</span> <a href="#narrow/stream/395097-compiler-development/topic/module.20params/near/416697780">said</a>:</p>
<blockquote>
<p>I think it will be <code>import ray.Gui exposing {col, button, text}</code></p>
</blockquote>
<p>That’s correct, except we are using square brackets <span aria-label="smile" class="emoji emoji-1f642" role="img" title="smile">:smile:</span></p>
<div class="codehilite"><pre><span></span><code>import ray.Gui exposing [col, button, text]
</code></pre></div>



<a name="416984932"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/module%20params/near/416984932" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Agus Zubiaga <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/module.20params.html#416984932">(Jan 20 2024 at 11:50)</a>:</h4>
<p>I just got ingested files working for the new imports. I had to move some code from load/file to can/def which depended on the module's path, and I ended up having to thread that through a ton of can functions: <a href="https://github.com/roc-lang/roc/commit/002493e32c2c3784da7e0a9a1ade6b1f1c52e993">diff</a></p>
<p>Should I add that to can's <code>Env</code> instead? I'm not sure how we decide what goes in there</p>



<a name="418438378"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/module%20params/near/418438378" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Agus Zubiaga <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/module.20params.html#418438378">(Jan 27 2024 at 18:46)</a>:</h4>
<p>I have an automatic fix for the import syntax working:<br>
<a href="/user_uploads/22008/L60IoXYj3NYtNDaVYzYHdJoe/CleanShot-2024-01-27-at-15.42.05.mp4">CleanShot-2024-01-27-at-15.42.05.mp4</a><br>
I think this will help with the transition, given every single Roc file will be affected by it.</p>
<div class="message_inline_image message_inline_video"><a href="/user_uploads/22008/L60IoXYj3NYtNDaVYzYHdJoe/CleanShot-2024-01-27-at-15.42.05.mp4" title="CleanShot-2024-01-27-at-15.42.05.mp4"><video preload="metadata" src="/user_uploads/22008/L60IoXYj3NYtNDaVYzYHdJoe/CleanShot-2024-01-27-at-15.42.05.mp4"></video></a></div>



<a name="418438559"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/module%20params/near/418438559" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/module.20params.html#418438559">(Jan 27 2024 at 18:49)</a>:</h4>
<p>yoooooooo</p>



<a name="418438562"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/module%20params/near/418438562" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/module.20params.html#418438562">(Jan 27 2024 at 18:49)</a>:</h4>
<p>that's super nice!!!</p>



<a name="418438567"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/module%20params/near/418438567" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/module.20params.html#418438567">(Jan 27 2024 at 18:49)</a>:</h4>
<p>great stuff, <span class="user-mention" data-user-id="489294">@Agus Zubiaga</span>!</p>



<a name="418438867"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/module%20params/near/418438867" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Agus Zubiaga <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/module.20params.html#418438867">(Jan 27 2024 at 18:55)</a>:</h4>
<p>I'm now working on the new headers keywords. I think we can also autofix a lot of that. Not everything though, since some of the semantics changed.</p>



<a name="418439107"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/module%20params/near/418439107" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/module.20params.html#418439107">(Jan 27 2024 at 18:59)</a>:</h4>
<p>what do you think of trying out having them be records instead of keywords?</p>



<a name="418439172"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/module%20params/near/418439172" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/module.20params.html#418439172">(Jan 27 2024 at 19:00)</a>:</h4>
<p>from <a href="#narrow/stream/304641-ideas/topic/Fewer.2Fdifferent.20keywords.20in.20the.20file.20header/near/412256602">https://roc.zulipchat.com/#narrow/stream/304641-ideas/topic/Fewer.2Fdifferent.20keywords.20in.20the.20file.20header/near/412256602</a></p>



<a name="418443072"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/module%20params/near/418443072" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Agus Zubiaga <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/module.20params.html#418443072">(Jan 27 2024 at 20:08)</a>:</h4>
<p>Interesting. I'll reply in that thread.</p>



<a name="422032685"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/module%20params/near/422032685" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Agus Zubiaga <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/module.20params.html#422032685">(Feb 17 2024 at 18:20)</a>:</h4>
<p>Hey all! <span class="user-mention" data-user-id="515757">@Luke Boswell</span> asked me how this is going and I thought I would post an update publicly too.</p>
<p>I haven’t had a lot of time outside of work lately, so I have been moving slowly. I should start getting more free time this week.</p>
<p>Last time I touched it, I had the new inline imports working with all its features and the formatter would automatically upgrade header imports to this new syntax.</p>
<p>I also started working on the syntax changes to the headers themselves, and formatter upgrade mechanism for those too. I’m hoping I’ll make some good progress on that this weekend.</p>
<p>While the parser changes are easy, updating the thousands of mini roc files across tests and examples takes a significant part of the time. I can have the formatter do this automatically for some, but not for any of the <code>test_syntax</code> snapshot tests because we want the originals to be unformatted, so we can test how the formatter affects them.<br>
This is often creates conflicts with changes on <code>main</code> too.</p>
<p>After this is all done, I’ll work on the privacy changes listed in the proposal and fixing some of the bugs in the module system in general.</p>
<p>The actual work on implementing module params will likely start sometime in March.</p>



<a name="422032818"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/module%20params/near/422032818" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/module.20params.html#422032818">(Feb 17 2024 at 18:22)</a>:</h4>
<p>ooh, if there's something that requires lots of mechanical stuff with not much thought, I'd love to volunteer to help! <span aria-label="smiley" class="emoji emoji-1f603" role="img" title="smiley">:smiley:</span></p>



<a name="422032882"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/module%20params/near/422032882" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/module.20params.html#422032882">(Feb 17 2024 at 18:23)</a>:</h4>
<p>that fits very well with the "Dad has 15 minutes free and can't realistically do anything that requires loading lots of context, but could knock out a bunch of mechanical work in that time" situation I very often find myself in these days <span aria-label="laughing" class="emoji emoji-1f606" role="img" title="laughing">:laughing:</span></p>



<a name="422033849"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/module%20params/near/422033849" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Agus Zubiaga <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/module.20params.html#422033849">(Feb 17 2024 at 18:38)</a>:</h4>
<p>Haha nice, good to know! Let’s see how these days go and maybe I’ll push parser changes without necessary fixing everything</p>



<a name="422034213"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/module%20params/near/422034213" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/module.20params.html#422034213">(Feb 17 2024 at 18:45)</a>:</h4>
<p>cool, lmk anytime! And welcome back, exciting to hear about your plans on this! <span aria-label="smiley" class="emoji emoji-1f603" role="img" title="smiley">:smiley:</span></p>



<a name="422134533"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/module%20params/near/422134533" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Agus Zubiaga <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/module.20params.html#422134533">(Feb 18 2024 at 22:24)</a>:</h4>
<p>Ok, the <code>interface</code> to <code>module</code> syntax change is <a href="https://github.com/roc-lang/roc/commit/ebd5223a318dc7a958ee84894656b7d5bea38860">done</a>. The old header is still supported and <code>roc format</code> updates it automatically like with <code>imports</code>.</p>



<a name="422134563"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/module%20params/near/422134563" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/module.20params.html#422134563">(Feb 18 2024 at 22:24)</a>:</h4>
<p>sweeeeeeeet!!!</p>



<a name="422134602"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/module%20params/near/422134602" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Agus Zubiaga <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/module.20params.html#422134602">(Feb 18 2024 at 22:25)</a>:</h4>
<p>Now working on the new <code>app</code> header with the syntax discussed <a href="#narrow/stream/304641-ideas/topic/Fewer.2Fdifferent.20keywords.20in.20the.20file.20header/near/418444862">here</a></p>



<a name="423283866"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/module%20params/near/423283866" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Agus Zubiaga <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/module.20params.html#423283866">(Feb 25 2024 at 18:55)</a>:</h4>
<p><a href="/user_uploads/22008/O5epA9pqsesWJeBr7vK3dfOk/CleanShot-2024-02-25-at-16.03.24.gif">CleanShot-2024-02-25-at-16.03.24.gif</a></p>
<div class="message_inline_image"><a href="/user_uploads/22008/O5epA9pqsesWJeBr7vK3dfOk/CleanShot-2024-02-25-at-16.03.24.gif" title="CleanShot-2024-02-25-at-16.03.24.gif"><img src="/user_uploads/22008/O5epA9pqsesWJeBr7vK3dfOk/CleanShot-2024-02-25-at-16.03.24.gif"></a></div><p>Got the new app headers working today</p>



<a name="423283983"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/module%20params/near/423283983" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Agus Zubiaga <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/module.20params.html#423283983">(Feb 25 2024 at 18:57)</a>:</h4>
<p>I fixed most of the tests, but I stumbled into <a href="https://github.com/roc-lang/roc/blob/f55df4bf6b99da1064abd98485516ee30ec739c1/crates/compiler/load_internal/tests/fixtures/build/app_with_deps/Quicksort.roc#L1">something weird</a>: </p>
<div class="codehilite"><pre><span></span><code>app &quot;quicksort&quot; provides [swap, partition, partitionHelp, quicksort] to &quot;./platform&quot;
</code></pre></div>



<a name="423284122"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/module%20params/near/423284122" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Agus Zubiaga <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/module.20params.html#423284122">(Feb 25 2024 at 18:59)</a>:</h4>
<p>That <code>app</code> fixture uses a platform that's not specified in <code>packages</code> -which apparently is something you can do-, but the platform doesn't exist, yet the app is loaded fine</p>



<a name="423284253"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/module%20params/near/423284253" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/module.20params.html#423284253">(Feb 25 2024 at 19:01)</a>:</h4>
<p>I'm guessing it was one of the first, and is now a bit of a legacy thing. But I don't know.</p>



<a name="423284500"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/module%20params/near/423284500" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Agus Zubiaga <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/module.20params.html#423284500">(Feb 25 2024 at 19:04)</a>:</h4>
<p>Yeah, it looks like the platform is ignored if you use that syntax. In the new <code>app</code> header, there's no <code>provides</code> keyword, so you have to specify the platform in the packages.</p>



<a name="423284567"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/module%20params/near/423284567" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Agus Zubiaga <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/module.20params.html#423284567">(Feb 25 2024 at 19:06)</a>:</h4>
<p>I created a fake platform that'd take those functions in the fixture, but it looks like the helpers in <code>test_load</code> break if a platform is actually loaded <span aria-label="upside down" class="emoji emoji-1f643" role="img" title="upside down">:upside_down:</span></p>



<a name="423285487"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/module%20params/near/423285487" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/module.20params.html#423285487">(Feb 25 2024 at 19:21)</a>:</h4>
<p>hm, that test seems redundant with <a href="https://github.com/roc-lang/roc/blob/f55df4bf6b99da1064abd98485516ee30ec739c1/crates/cli_testing_examples/algorithms/quicksort.roc">https://github.com/roc-lang/roc/blob/f55df4bf6b99da1064abd98485516ee30ec739c1/crates/cli_testing_examples/algorithms/quicksort.roc</a></p>



<a name="423285492"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/module%20params/near/423285492" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/module.20params.html#423285492">(Feb 25 2024 at 19:21)</a>:</h4>
<p>maybe we can just delete it?</p>



<a name="423285510"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/module%20params/near/423285510" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/module.20params.html#423285510">(Feb 25 2024 at 19:21)</a>:</h4>
<p>we'll certainly get a test failure if that quicksort example breaks, and I'm not sure why 2 failures would be more helpful than 1 <span aria-label="big smile" class="emoji emoji-1f604" role="img" title="big smile">:big_smile:</span></p>



<a name="423286143"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/module%20params/near/423286143" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Agus Zubiaga <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/module.20params.html#423286143">(Feb 25 2024 at 19:30)</a>:</h4>
<p>Ah, good point. Thanks!</p>



<a name="423286473"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/module%20params/near/423286473" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/module.20params.html#423286473">(Feb 25 2024 at 19:36)</a>:</h4>
<p>this is looking AMAZING btw!!! <span aria-label="heart eyes" class="emoji emoji-1f60d" role="img" title="heart eyes">:heart_eyes:</span></p>



<a name="423286481"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/module%20params/near/423286481" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/module.20params.html#423286481">(Feb 25 2024 at 19:36)</a>:</h4>
<p>super exciting to see!</p>



<a name="423287131"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/module%20params/near/423287131" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/module.20params.html#423287131">(Feb 25 2024 at 19:48)</a>:</h4>
<p>Yeah, I think it looks so much cleaner too.</p>



<a name="424436758"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/module%20params/near/424436758" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Agus Zubiaga <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/module.20params.html#424436758">(Mar 02 2024 at 19:01)</a>:</h4>
<p>I just realized that there's a special way to provide types to the platform in <code>app</code> headers:</p>
<div class="codehilite"><pre><span></span><code>app &quot;test&quot;
    packages { pf: &quot;./platform&quot; }
    provides [quicksort] { Flags, Model } to pf
#                        ^^^^^^^^^^^^^^^^
</code></pre></div>
<p>How is this used in practice?</p>



<a name="424436864"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/module%20params/near/424436864" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Agus Zubiaga <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/module.20params.html#424436864">(Mar 02 2024 at 19:02)</a>:</h4>
<p>I think this wouldn't work with the new syntax, and I wonder if we are using this or if it's legacy. I hadn't seen it before.</p>



<a name="424437192"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/module%20params/near/424437192" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Agus Zubiaga <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/module.20params.html#424437192">(Mar 02 2024 at 19:06)</a>:</h4>
<p>Maybe they can be provided amongst the values <code>app [quicksort, Flags, Model]</code> like <code>module</code> exposed names</p>



<a name="424437293"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/module%20params/near/424437293" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Agus Zubiaga <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/module.20params.html#424437293">(Mar 02 2024 at 19:07)</a>:</h4>
<p>But I still don't really get what these are for, couldn't the provided functions just have type vars?</p>



<a name="424439017"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/module%20params/near/424439017" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/module.20params.html#424439017">(Mar 02 2024 at 19:29)</a>:</h4>
<p>yeah it's a workaround</p>



<a name="424439040"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/module%20params/near/424439040" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/module.20params.html#424439040">(Mar 02 2024 at 19:29)</a>:</h4>
<p>we shouldn't need it anymore once we can pass closures to hosts</p>



<a name="424439053"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/module%20params/near/424439053" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/module.20params.html#424439053">(Mar 02 2024 at 19:29)</a>:</h4>
<p>(or rather, once we can correctly generate glue for doing that)</p>



<a name="424440457"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/module%20params/near/424440457" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Agus Zubiaga <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/module.20params.html#424440457">(Mar 02 2024 at 19:47)</a>:</h4>
<p>Ah, I see. So we should keep it for now, right?</p>



<a name="424440661"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/module%20params/near/424440661" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/module.20params.html#424440661">(Mar 02 2024 at 19:50)</a>:</h4>
<p>yeah I think some applications probably rely on it right now</p>



<a name="424440676"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/module%20params/near/424440676" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/module.20params.html#424440676">(Mar 02 2024 at 19:50)</a>:</h4>
<p>I'd like to drop it eventually though</p>



<a name="424440855"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/module%20params/near/424440855" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Agus Zubiaga <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/module.20params.html#424440855">(Mar 02 2024 at 19:53)</a>:</h4>
<p>What syntax should we use?</p>



<a name="424444638"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/module%20params/near/424444638" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/module.20params.html#424444638">(Mar 02 2024 at 20:46)</a>:</h4>
<p>maybe we can just accept uppercase identifiers in the square brackets for what the app provides to the platform <span aria-label="thinking" class="emoji emoji-1f914" role="img" title="thinking">:thinking:</span></p>



<a name="424447708"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/module%20params/near/424447708" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Agus Zubiaga <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/module.20params.html#424447708">(Mar 02 2024 at 21:36)</a>:</h4>
<p>Sounds good, I'll do that.</p>



<a name="424447759"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/module%20params/near/424447759" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Agus Zubiaga <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/module.20params.html#424447759">(Mar 02 2024 at 21:37)</a>:</h4>
<p>Technically, we already allow uppercase idents in the square brackets, because it just uses <code>exposes_entry</code>: <a href="https://github.com/roc-lang/roc/blob/26e21addeeab0bd0126aa6ee47c7138492d4fd38/crates/compiler/parse/src/module.rs#L239">source</a></p>



<a name="424447832"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/module%20params/near/424447832" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Agus Zubiaga <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/module.20params.html#424447832">(Mar 02 2024 at 21:38)</a>:</h4>
<p>I'll deal with it in <code>load</code></p>



<a name="424449551"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/module%20params/near/424449551" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/module.20params.html#424449551">(Mar 02 2024 at 22:06)</a>:</h4>
<p>nice, sounds good!</p>



<a name="424453337"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/module%20params/near/424453337" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Agus Zubiaga <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/module.20params.html#424453337">(Mar 02 2024 at 23:10)</a>:</h4>
<p>Pasting some new errors here in case people have feedback:</p>
<div class="codehilite"><pre><span></span><code>   ── UNSPECIFIED PLATFORM in tmp/no_platform_specified/Test.roc ──────────────────

    This app does not specify a platform:

    1│&gt;  app [main] {
    2│&gt;      json: &quot;../json/main.roc&quot;
    3│&gt;  }

    Every Roc app must select a package to use as its platform, like this:

        app [main] {
            pf: platform &quot;…path or URL to platform…&quot;
        }

    Tip: See an example in the tutorial: &lt;https://www.roc-lang.org/tutorial#building-an-application&gt;
</code></pre></div>
<div class="codehilite"><pre><span></span><code>    ── MULTIPLE PLATFORMS in tmp/multiple_platforms_specified/Test.roc ─────────────

    This app specifies multiple packages as `platform`:

    1│&gt;  app [main] {
    2│&gt;      cli: platform &quot;../cli/main.roc&quot;,
    3│&gt;      web: platform &quot;../web/main.roc&quot;,
    4│&gt;  }

    Roc apps must specify exactly one platform.
</code></pre></div>



<a name="424453594"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/module%20params/near/424453594" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Agus Zubiaga <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/module.20params.html#424453594">(Mar 02 2024 at 23:15)</a>:</h4>
<p>Maybe there’s something more insightful to say about the “multiple platforms” one</p>



<a name="424455625"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/module%20params/near/424455625" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/module.20params.html#424455625">(Mar 02 2024 at 23:44)</a>:</h4>
<p>We should have a FAQ entry for that. I can write one and we can link to it!</p>



<a name="424455731"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/module%20params/near/424455731" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Agus Zubiaga <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/module.20params.html#424455731">(Mar 02 2024 at 23:46)</a>:</h4>
<p>Nice, that’d be great!</p>



<a name="424763734"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/module%20params/near/424763734" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Agus Zubiaga <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/module.20params.html#424763734">(Mar 04 2024 at 23:04)</a>:</h4>
<p>New <code>package</code> headers are <a href="https://github.com/roc-lang/roc/commit/8dac981594f7c503474bcf51e2733addfcc2386f">done</a>!</p>



<a name="424763993"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/module%20params/near/424763993" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Agus Zubiaga <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/module.20params.html#424763993">(Mar 04 2024 at 23:07)</a>:</h4>
<p>I'm going to start working on the <a href="https://docs.google.com/document/d/1E_77fO-44BtoBtXoVeWyGh1xN2KRTWTu8q6i25RNNx0/edit?pli=1#heading=h.x84bh32l37em">"Module and package privacy changes"</a> section now</p>



<a name="424764169"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/module%20params/near/424764169" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Agus Zubiaga <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/module.20params.html#424764169">(Mar 04 2024 at 23:08)</a>:</h4>
<p>I still have to update the <code>platform</code> header, but I'll do that one later since that's not just a syntax change.</p>



<a name="424765352"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/module%20params/near/424765352" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Agus Zubiaga <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/module.20params.html#424765352">(Mar 04 2024 at 23:20)</a>:</h4>
<p>The proposal indicates that it should be possible for nested packages to inherit packages from its parent:</p>
<div class="codehilite" data-code-language="F#"><pre><span></span><code><span class="n">package</span><span class="w"> </span><span class="o">[</span><span class="n">ParserCore</span><span class="o">,</span><span class="w"> </span><span class="n">ParserCsv</span><span class="o">,</span><span class="w"> </span><span class="n">ParserStr</span><span class="o">]</span>
<span class="w">        </span><span class="n">packages</span><span class="w"> </span><span class="o">[</span>
<span class="w">            </span><span class="n">JsonDecode</span><span class="w"> </span><span class="n">from</span><span class="w"> </span><span class="s">"https://…/json/…"</span><span class="o">,</span>
<span class="w">            </span><span class="n">CodePt</span><span class="o">,</span><span class="w"> </span><span class="n">Segment</span><span class="w"> </span><span class="n">from</span><span class="w"> </span><span class="s">"https://…/unicode/…"</span><span class="o">,</span>
<span class="w">            </span><span class="n">Foo</span><span class="o">,</span><span class="w"> </span><span class="n">Bar</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">Blah</span><span class="o">,</span><span class="w"> </span><span class="n">Baz</span><span class="w"> </span><span class="n">from</span><span class="w"> </span><span class="o">..</span>
<span class="w">        </span><span class="o">]</span>
</code></pre></div>
<p>However, we later decided we need to keep the package shorthands, so what syntax should be use to inherit packages?</p>



<a name="424765515"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/module%20params/near/424765515" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Agus Zubiaga <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/module.20params.html#424765515">(Mar 04 2024 at 23:21)</a>:</h4>
<p>Maybe something like this:</p>
<div class="codehilite" data-code-language="Haskell"><pre><span></span><code><span class="nf">package</span><span class="w"> </span><span class="p">[</span><span class="kt">ParserCore</span><span class="p">,</span><span class="w"> </span><span class="kt">ParserCsv</span><span class="p">,</span><span class="w"> </span><span class="kt">ParserStr</span><span class="p">]</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">json</span><span class="kt">:</span><span class="w"> </span><span class="s">"https://…/json/…"</span><span class="p">,</span>
<span class="w">    </span><span class="n">unicode</span><span class="kt">:</span><span class="w"> </span><span class="s">"https://…/unicode/…"</span><span class="p">,</span>
<span class="w">    </span><span class="n">foo</span><span class="kt">:</span><span class="w"> </span><span class="n">inherit</span><span class="p">,</span>
<span class="w">    </span><span class="n">bar</span><span class="kt">:</span><span class="w"> </span><span class="n">inherit</span><span class="p">,</span>
<span class="p">}</span>
</code></pre></div>



<a name="424765620"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/module%20params/near/424765620" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Agus Zubiaga <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/module.20params.html#424765620">(Mar 04 2024 at 23:22)</a>:</h4>
<p>This is similar to the <code>platform</code> indicator in the <code>app</code> header</p>



<a name="424765674"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/module%20params/near/424765674" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Agus Zubiaga <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/module.20params.html#424765674">(Mar 04 2024 at 23:23)</a>:</h4>
<p>Another option:</p>
<div class="codehilite" data-code-language="Haskell"><pre><span></span><code><span class="nf">package</span><span class="w"> </span><span class="p">[</span><span class="kt">ParserCore</span><span class="p">,</span><span class="w"> </span><span class="kt">ParserCsv</span><span class="p">,</span><span class="w"> </span><span class="kt">ParserStr</span><span class="p">]</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">json</span><span class="kt">:</span><span class="w"> </span><span class="s">"https://…/json/…"</span><span class="p">,</span>
<span class="w">    </span><span class="n">unicode</span><span class="kt">:</span><span class="w"> </span><span class="s">"https://…/unicode/…"</span><span class="p">,</span>
<span class="w">    </span><span class="n">foo</span><span class="p">,</span>
<span class="w">    </span><span class="n">bar</span><span class="p">,</span>
<span class="p">}</span>
</code></pre></div>



<a name="424765797"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/module%20params/near/424765797" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Agus Zubiaga <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/module.20params.html#424765797">(Mar 04 2024 at 23:24)</a>:</h4>
<p>Or <code>foo: ..</code></p>



<a name="424782731"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/module%20params/near/424782731" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/module.20params.html#424782731">(Mar 05 2024 at 02:26)</a>:</h4>
<p>I like the second option, just <code>foo,</code> <code>bar,</code></p>



<a name="429131638"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/module%20params/near/429131638" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Agus Zubiaga <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/module.20params.html#429131638">(Mar 24 2024 at 00:43)</a>:</h4>
<p>In Elm you can do this:</p>
<div class="codehilite" data-code-language="Elm"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nc">Maybe</span>
<span class="kn">import</span><span class="w"> </span><span class="nc">Maybe.Extra</span><span class="w"> </span><span class="kr">as</span><span class="w"> </span><span class="kt">Maybe</span>
</code></pre></div>
<p>I used to like this at first because it felt like extending the module, but after a few years using the language, I stopped doing this because it makes it hard to figure out which of the modules a function is coming from.</p>
<p>Do we want Roc to support this or should we make it an error?</p>



<a name="429132017"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/module%20params/near/429132017" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Agus Zubiaga <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/module.20params.html#429132017">(Mar 24 2024 at 00:48)</a>:</h4>
<p>This is what I'm thinking:</p>
<div class="codehilite"><pre><span></span><code>── IMPORT ALIAS CONFLICT in tmp/duplicate_alias/Main.roc ───────────────────────

MaybeExtra was imported as Maybe

4│  import MaybeExtra as Maybe
                         ^^^^^

but Maybe is also the name of another module:

3│  import Maybe

Using the same name for both can make it hard to tell which one you&#39;re referring to.

Make sure each import has a unique alias or none at all.
</code></pre></div>



<a name="429132115"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/module%20params/near/429132115" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Agus Zubiaga <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/module.20params.html#429132115">(Mar 24 2024 at 00:50)</a>:</h4>
<p>Similarly we wouldn't allow the same alias to be used for two modules:</p>
<div class="codehilite"><pre><span></span><code>── IMPORT ALIAS CONFLICT in tmp/duplicate_alias/Main.roc ───────────────────────

One was imported as D:

3│  import One as D
                  ^

but the same alias was also used for Two:

4│  import Two as D
                  ^

Each import should have a unique alias or none at all.
</code></pre></div>



<a name="429190166"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/module%20params/near/429190166" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/module.20params.html#429190166">(Mar 24 2024 at 11:51)</a>:</h4>
<p>yeah totally agree</p>



<a name="432951674"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/module%20params/near/432951674" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Agus Zubiaga <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/module.20params.html#432951674">(Apr 12 2024 at 17:44)</a>:</h4>
<p>Now that I'm pretty close to finish the rest of the module system changes, I want to start thinking about ways to implement the actual module params</p>



<a name="432951745"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/module%20params/near/432951745" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Agus Zubiaga <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/module.20params.html#432951745">(Apr 12 2024 at 17:44)</a>:</h4>
<p>In what stage of the compiler should we deal with them? Is it something we can desugar at canonicalization?</p>



<a name="432951832"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/module%20params/near/432951832" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Agus Zubiaga <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/module.20params.html#432951832">(Apr 12 2024 at 17:45)</a>:</h4>
<p>The simplest approach to me would be to desguar by currying all the functions of the module with the params</p>



<a name="432951855"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/module%20params/near/432951855" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Agus Zubiaga <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/module.20params.html#432951855">(Apr 12 2024 at 17:45)</a>:</h4>
<p>I wonder what are the implications of that to performance and such</p>



<a name="432952389"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/module%20params/near/432952389" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Agus Zubiaga <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/module.20params.html#432952389">(Apr 12 2024 at 17:49)</a>:</h4>
<p>I also thought we could generate globals that we set basically where the import is. However, I think that would require generating a module per import which might result in big binaries.</p>



<a name="432952440"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/module%20params/near/432952440" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/module.20params.html#432952440">(Apr 12 2024 at 17:49)</a>:</h4>
<p>I think it has to be arguments for inline imports</p>



<a name="432952574"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/module%20params/near/432952574" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/module.20params.html#432952574">(Apr 12 2024 at 17:50)</a>:</h4>
<p>especially considering you could theoretically import the same module multiple times with <code>as</code> <span aria-label="big smile" class="emoji emoji-1f604" role="img" title="big smile">:big_smile:</span></p>



<a name="432952585"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/module%20params/near/432952585" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/module.20params.html#432952585">(Apr 12 2024 at 17:50)</a>:</h4>
<p>and have them be in scope at the same time</p>



<a name="432952648"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/module%20params/near/432952648" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Agus Zubiaga <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/module.20params.html#432952648">(Apr 12 2024 at 17:51)</a>:</h4>
<p>Yeah, exactly. That's why I think the globals approach would require emitting the same module multiple times.</p>



<a name="432952728"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/module%20params/near/432952728" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Agus Zubiaga <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/module.20params.html#432952728">(Apr 12 2024 at 17:51)</a>:</h4>
<p>Arguments should be fine, right?</p>



<a name="432952736"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/module%20params/near/432952736" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/module.20params.html#432952736">(Apr 12 2024 at 17:51)</a>:</h4>
<p>I think so yeah</p>



<a name="432952838"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/module%20params/near/432952838" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/module.20params.html#432952838">(Apr 12 2024 at 17:52)</a>:</h4>
<p>so then the next question is what specifically goes in those arguments</p>



<a name="432952863"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/module%20params/near/432952863" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Agus Zubiaga <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/module.20params.html#432952863">(Apr 12 2024 at 17:52)</a>:</h4>
<p>Maybe instead of actually currying the function, we extend its arguments with the module params record</p>



<a name="432952888"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/module%20params/near/432952888" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/module.20params.html#432952888">(Apr 12 2024 at 17:52)</a>:</h4>
<p>yeah that's what I was thinking</p>



<a name="432952945"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/module%20params/near/432952945" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Agus Zubiaga <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/module.20params.html#432952945">(Apr 12 2024 at 17:52)</a>:</h4>
<p>and constants would become functions</p>



<a name="432952978"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/module%20params/near/432952978" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/module.20params.html#432952978">(Apr 12 2024 at 17:53)</a>:</h4>
<p>so every function gets exactly 1 extra argument, and it's always a pointer to a record that lives on the stack</p>



<a name="432953123"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/module%20params/near/432953123" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Agus Zubiaga <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/module.20params.html#432953123">(Apr 12 2024 at 17:54)</a>:</h4>
<p>I guess it's not worth it to make each field of the record an argument, right? That should be optimized already</p>



<a name="432953153"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/module%20params/near/432953153" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/module.20params.html#432953153">(Apr 12 2024 at 17:54)</a>:</h4>
<p>yeah I think it'll be better to pass it as a pointer</p>



<a name="432953243"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/module%20params/near/432953243" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/module.20params.html#432953243">(Apr 12 2024 at 17:55)</a>:</h4>
<p>so the next question is when to build up that record</p>



<a name="432953311"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/module%20params/near/432953311" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/module.20params.html#432953311">(Apr 12 2024 at 17:55)</a>:</h4>
<p>because if I'm calling 3 functions in a different module (the same module) in a row, I don't want to have to assemble module params records for that module 3 times</p>



<a name="432953377"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/module%20params/near/432953377" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/module.20params.html#432953377">(Apr 12 2024 at 17:55)</a>:</h4>
<p>because they'll be the same each time! I'd rather just assemble it once and pass it in 3 times</p>



<a name="432953440"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/module%20params/near/432953440" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Agus Zubiaga <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/module.20params.html#432953440">(Apr 12 2024 at 17:56)</a>:</h4>
<p>If the import is inside a function, I guess we would create it whereever the import is. But it's trickier for top-level imports.</p>



<a name="432953493"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/module%20params/near/432953493" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/module.20params.html#432953493">(Apr 12 2024 at 17:56)</a>:</h4>
<p>yeah so my thinking there is that we can essentially keep track in each scope like an <code>VecMap&lt;ModuleId, ModuleParams&gt;</code></p>



<a name="432953542"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/module%20params/near/432953542" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Agus Zubiaga <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/module.20params.html#432953542">(Apr 12 2024 at 17:56)</a>:</h4>
<p>Yeah, or <code>VecMap&lt;ModuleName, ModuleParams&gt;</code></p>



<a name="432953544"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/module%20params/near/432953544" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/module.20params.html#432953544">(Apr 12 2024 at 17:57)</a>:</h4>
<p>which we populate once we've created the module params for a given module</p>



<a name="432953549"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/module%20params/near/432953549" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Agus Zubiaga <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/module.20params.html#432953549">(Apr 12 2024 at 17:57)</a>:</h4>
<p>haha exactly</p>



<a name="432953603"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/module%20params/near/432953603" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/module.20params.html#432953603">(Apr 12 2024 at 17:57)</a>:</h4>
<p>and then yeah, we can just go grab those (or maybe just a <code>Symbol</code> for them) if we already have them</p>



<a name="432953617"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/module%20params/near/432953617" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Agus Zubiaga <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/module.20params.html#432953617">(Apr 12 2024 at 17:57)</a>:</h4>
<p>I think it'd be <code>ModuleName</code> instead of <code>ModuleId</code> because you can have the same <code>ModuleId</code> multiple times with different aliases</p>



<a name="432953632"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/module%20params/near/432953632" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/module.20params.html#432953632">(Apr 12 2024 at 17:57)</a>:</h4>
<p>ah true!</p>



<a name="432953730"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/module%20params/near/432953730" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/module.20params.html#432953730">(Apr 12 2024 at 17:58)</a>:</h4>
<p>I suspect we'd want to do this during monomorphization</p>



<a name="432953786"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/module%20params/near/432953786" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/module.20params.html#432953786">(Apr 12 2024 at 17:58)</a>:</h4>
<p>because at that point we're traversing all the canonical nodes and then translating them into a different function format</p>



<a name="432953808"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/module%20params/near/432953808" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/module.20params.html#432953808">(Apr 12 2024 at 17:58)</a>:</h4>
<p>and also transforming all the call sites as well</p>



<a name="432953848"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/module%20params/near/432953848" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/module.20params.html#432953848">(Apr 12 2024 at 17:58)</a>:</h4>
<p>so right when we're doing both of those, we can add the extra param to the function definitions and the extra arg at the call sites</p>



<a name="432953903"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/module%20params/near/432953903" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/module.20params.html#432953903">(Apr 12 2024 at 17:59)</a>:</h4>
<p>I think this would also be an excellent time to add another parameter (and another argument at the call sites) for Allocators</p>



<a name="432953954"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/module%20params/near/432953954" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/module.20params.html#432953954">(Apr 12 2024 at 17:59)</a>:</h4>
<p>because we want to change it so that hosts pass in a pointer to an Allocator struct instead of having <code>roc_alloc</code>, <code>roc_dealloc</code>, etc. be top-level symbols</p>



<a name="432953988"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/module%20params/near/432953988" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Agus Zubiaga <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/module.20params.html#432953988">(Apr 12 2024 at 17:59)</a>:</h4>
<p>oh, I see</p>



<a name="432954063"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/module%20params/near/432954063" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/module.20params.html#432954063">(Apr 12 2024 at 18:00)</a>:</h4>
<p>we can actually populate those and wire them up separately, but it seems like a good time to just go ahead and add 2 extra pointer arguments instead of 1</p>



<a name="432954105"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/module%20params/near/432954105" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/module.20params.html#432954105">(Apr 12 2024 at 18:00)</a>:</h4>
<p>while in the process of doing exactly that to all the functions <span aria-label="big smile" class="emoji emoji-1f604" role="img" title="big smile">:big_smile:</span></p>



<a name="432954155"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/module%20params/near/432954155" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/module.20params.html#432954155">(Apr 12 2024 at 18:00)</a>:</h4>
<p>I think we can also just uncritically add them, because I believe one of LLVM's optimizations is unused argument elimination</p>



<a name="432954157"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/module%20params/near/432954157" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Agus Zubiaga <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/module.20params.html#432954157">(Apr 12 2024 at 18:00)</a>:</h4>
<p>Yeah, it's like allocators are module params or I guess app params <span aria-label="smiley" class="emoji emoji-1f603" role="img" title="smiley">:smiley:</span></p>



<a name="432954197"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/module%20params/near/432954197" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/module.20params.html#432954197">(Apr 12 2024 at 18:00)</a>:</h4>
<p>so if we pass them in and then don't use them, they should just get eliminated anyway</p>



<a name="432954440"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/module%20params/near/432954440" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Agus Zubiaga <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/module.20params.html#432954440">(Apr 12 2024 at 18:02)</a>:</h4>
<p>Ah, I see. I was also thinking whether we wanted to detect whether a param was used in a def to decide whether we should add the args.</p>



<a name="432954455"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/module%20params/near/432954455" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Agus Zubiaga <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/module.20params.html#432954455">(Apr 12 2024 at 18:02)</a>:</h4>
<p>Cool</p>



<a name="432954601"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/module%20params/near/432954601" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/module.20params.html#432954601">(Apr 12 2024 at 18:03)</a>:</h4>
<p>so then I think the only other thing is needing to destructure the records at the top of each function</p>



<a name="432954698"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/module%20params/near/432954698" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/module.20params.html#432954698">(Apr 12 2024 at 18:03)</a>:</h4>
<p>because they'll be referred to in canonicalization as like <code>foo</code> rather than <code>record.foo</code></p>



<a name="432954701"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/module%20params/near/432954701" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Agus Zubiaga <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/module.20params.html#432954701">(Apr 12 2024 at 18:03)</a>:</h4>
<p>I guess destructuring is dealt with earlier than mono, right?</p>



<a name="432954709"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/module%20params/near/432954709" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/module.20params.html#432954709">(Apr 12 2024 at 18:03)</a>:</h4>
<p>so we need <code>foo = record.foo</code> somewhere in there</p>



<a name="432954767"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/module%20params/near/432954767" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/module.20params.html#432954767">(Apr 12 2024 at 18:04)</a>:</h4>
<p>I think we could do it in mono too</p>



<a name="432954789"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/module%20params/near/432954789" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/module.20params.html#432954789">(Apr 12 2024 at 18:04)</a>:</h4>
<p>a nice thing about doing it in mono is that then <code>roc check</code> doesn't pay for it <span aria-label="big smile" class="emoji emoji-1f604" role="img" title="big smile">:big_smile:</span></p>



<a name="432955001"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/module%20params/near/432955001" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Agus Zubiaga <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/module.20params.html#432955001">(Apr 12 2024 at 18:05)</a>:</h4>
<p>Yeah, we still have to type check them, so it's definitely going to involve some work in can for that</p>



<a name="432955506"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/module%20params/near/432955506" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/module.20params.html#432955506">(Apr 12 2024 at 18:07)</a>:</h4>
<p>for sure <span aria-label="thumbs up" class="emoji emoji-1f44d" role="img" title="thumbs up">:thumbs_up:</span></p>



<a name="432955681"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/module%20params/near/432955681" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/module.20params.html#432955681">(Apr 12 2024 at 18:07)</a>:</h4>
<p>yeah I just mean the part about pulling them out of the record in the arg - that's just a code gen detail we need to take care of</p>



<a name="432955875"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/module%20params/near/432955875" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/module.20params.html#432955875">(Apr 12 2024 at 18:08)</a>:</h4>
<p>I'm curious what <span class="user-mention" data-user-id="343810">@Brendan Hansknecht</span> and <span class="user-mention" data-user-id="281543">@Folkert de Vries</span> think about this in general!</p>



<a name="432955895"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/module%20params/near/432955895" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Agus Zubiaga <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/module.20params.html#432955895">(Apr 12 2024 at 18:08)</a>:</h4>
<p>Ah, I see</p>



<a name="432956182"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/module%20params/near/432956182" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Agus Zubiaga <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/module.20params.html#432956182">(Apr 12 2024 at 18:09)</a>:</h4>
<p>So if we have a top-level import. When is the record constructed? Is it like constants?</p>



<a name="432956482"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/module%20params/near/432956482" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Agus Zubiaga <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/module.20params.html#432956482">(Apr 12 2024 at 18:10)</a>:</h4>
<p>There's no obvious time to do it, right?</p>



<a name="432956944"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/module%20params/near/432956944" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/module.20params.html#432956944">(Apr 12 2024 at 18:11)</a>:</h4>
<p>well the caller constructs it</p>



<a name="432957219"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/module%20params/near/432957219" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Agus Zubiaga <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/module.20params.html#432957219">(Apr 12 2024 at 18:12)</a>:</h4>
<p>By that you mean the expression that references a module function?</p>



<a name="432957380"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/module%20params/near/432957380" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Agus Zubiaga <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/module.20params.html#432957380">(Apr 12 2024 at 18:13)</a>:</h4>
<p>Because in that case, the record would be constructed every time you do that, right?</p>



<a name="432957518"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/module%20params/near/432957518" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/module.20params.html#432957518">(Apr 12 2024 at 18:13)</a>:</h4>
<p>yeah so like if I've imported module <code>Foo</code> and given it <code>{ blah }</code> and I call <code>Foo.bar</code>, then I have to construct the <code>{ blah }</code> function before I can call <code>Foo.bar</code>, because <code>Foo.bar</code> will now be expecting a pointer to a <code>{ blah }</code> record as its last argument</p>



<a name="432957555"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/module%20params/near/432957555" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/module.20params.html#432957555">(Apr 12 2024 at 18:13)</a>:</h4>
<p>and that pointer is going to be on my stack</p>



<a name="432957611"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/module%20params/near/432957611" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/module.20params.html#432957611">(Apr 12 2024 at 18:13)</a>:</h4>
<p>or rather I'm passing it a pointer to a record that's on my stack</p>



<a name="432957746"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/module%20params/near/432957746" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/module.20params.html#432957746">(Apr 12 2024 at 18:14)</a>:</h4>
<p>and <code>Foo.bar</code> knows that it accepts a <code>{ blah }</code> record specifically because that's what's declared at the top of teh <code>Foo</code> module</p>



<a name="432957876"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/module%20params/near/432957876" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/module.20params.html#432957876">(Apr 12 2024 at 18:14)</a>:</h4>
<p><span class="user-mention silent" data-user-id="489294">Agus Zubiaga</span> <a href="#narrow/stream/395097-compiler-development/topic/module.20params/near/432957380">said</a>:</p>
<blockquote>
<p>Because in that case, the record would be constructed every time you do that, right?</p>
</blockquote>
<p>the <code>VecMap&lt;ModuleName, ModuleParams&gt;</code> thing from earlier can prevent constructing it multiple times</p>



<a name="432957983"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/module%20params/near/432957983" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/module.20params.html#432957983">(Apr 12 2024 at 18:14)</a>:</h4>
<p>like we cache it in scope so that if we already have one constructed in scope, we just use that instead of constructing another one</p>



<a name="432958002"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/module%20params/near/432958002" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Agus Zubiaga <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/module.20params.html#432958002">(Apr 12 2024 at 18:15)</a>:</h4>
<p>Right, exactly. But only inside of a function, right?</p>



<a name="432958133"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/module%20params/near/432958133" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/module.20params.html#432958133">(Apr 12 2024 at 18:15)</a>:</h4>
<p>oh you mean like what if I have <code>foo = if ...</code> at the top level, and it's not defined as a function?</p>



<a name="432958163"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/module%20params/near/432958163" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/module.20params.html#432958163">(Apr 12 2024 at 18:15)</a>:</h4>
<p>as in, <code>foo</code> itself is not a function</p>



<a name="432958906"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/module%20params/near/432958906" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Agus Zubiaga <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/module.20params.html#432958906">(Apr 12 2024 at 18:17)</a>:</h4>
<p>No, I mean from the caller side. If I have something like:</p>
<div class="codehilite"><pre><span></span><code>module [...]

import Foo { blah }

bar =
     Foo.bar + Foo.bar

baz =
    Foo.bar
</code></pre></div>
<p>I can cache the construction of <code>{ blah }</code> inside <code>bar</code>, but when I call <code>baz</code> I would have to construct it again.</p>



<a name="432959079"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/module%20params/near/432959079" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/module.20params.html#432959079">(Apr 12 2024 at 18:18)</a>:</h4>
<p>ahh I see</p>



<a name="432959110"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/module%20params/near/432959110" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/module.20params.html#432959110">(Apr 12 2024 at 18:18)</a>:</h4>
<p>yeah I agree, and I think that's fine</p>



<a name="432959140"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/module%20params/near/432959140" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Agus Zubiaga <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/module.20params.html#432959140">(Apr 12 2024 at 18:18)</a>:</h4>
<p>Unless we constructed <code>{blah}</code> before anything in the program runs</p>



<a name="432959164"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/module%20params/near/432959164" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/module.20params.html#432959164">(Apr 12 2024 at 18:18)</a>:</h4>
<p>in the future we can do compile-time evaluation of constants to eliminate that</p>



<a name="432959169"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/module%20params/near/432959169" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/module.20params.html#432959169">(Apr 12 2024 at 18:18)</a>:</h4>
<p>yeah exactly</p>



<a name="432959200"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/module%20params/near/432959200" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/module.20params.html#432959200">(Apr 12 2024 at 18:19)</a>:</h4>
<p>but in the meantime top-level non-functions always re-evaluate everything at runtime and I think that's fine (for now)</p>



<a name="432959240"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/module%20params/near/432959240" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/module.20params.html#432959240">(Apr 12 2024 at 18:19)</a>:</h4>
<p>oh I guess we'll need to add the extra pointer arguments to those generated top-level thunks too!</p>



<a name="432959261"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/module%20params/near/432959261" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/module.20params.html#432959261">(Apr 12 2024 at 18:19)</a>:</h4>
<p>since that's how we compile them today (top-level "constants" get compiled into 0-argument thunks during mono)</p>



<a name="432959334"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/module%20params/near/432959334" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Agus Zubiaga <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/module.20params.html#432959334">(Apr 12 2024 at 18:20)</a>:</h4>
<p>Right, exactly. That what I meant by "it's like constants" earlier <span aria-label="smiley" class="emoji emoji-1f603" role="img" title="smiley">:smiley:</span></p>



<a name="432959439"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/module%20params/near/432959439" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Agus Zubiaga <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/module.20params.html#432959439">(Apr 12 2024 at 18:20)</a>:</h4>
<p>So all defs in a module with params get a new argument</p>



<a name="432959494"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/module%20params/near/432959494" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Agus Zubiaga <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/module.20params.html#432959494">(Apr 12 2024 at 18:21)</a>:</h4>
<p>Well, I guess it's just the top-level ones. Because the nested ones already have it available from the parent.</p>



<a name="432959562"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/module%20params/near/432959562" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/module.20params.html#432959562">(Apr 12 2024 at 18:21)</a>:</h4>
<p>yep!</p>



<a name="432959603"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/module%20params/near/432959603" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/module.20params.html#432959603">(Apr 12 2024 at 18:21)</a>:</h4>
<p>well, 2 new arguments in anticipation of allocators, but yeah <span aria-label="big smile" class="emoji emoji-1f604" role="img" title="big smile">:big_smile:</span></p>



<a name="432959699"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/module%20params/near/432959699" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Agus Zubiaga <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/module.20params.html#432959699">(Apr 12 2024 at 18:22)</a>:</h4>
<p>right</p>



<a name="432961557"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/module%20params/near/432961557" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/module.20params.html#432961557">(Apr 12 2024 at 18:34)</a>:</h4>
<p>Yeah, all this sounds fine. Given this is for "slow" io anyway, I think it is better to just keep it simple as a pointer to struct of function pointers instead of thinking about any form of monomorphizing it away.</p>
<p>I have minor questions about what llvm would optimize best in certain cases, but nothing I have meanful data to decide between (arg order for example)</p>
<p>I think my biggest question that is hard to know the answer to is:<br>
1 pointer with allocators and imported function (will need to be reconstructed more often, though it is just cheap copying of a few function pointers)<br>
Or, 2 pointers, one for each. Allocators never need to be reconstructed then. But you are forever pinning two registers to hold the pointers.</p>



<a name="432963033"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/module%20params/near/432963033" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/module.20params.html#432963033">(Apr 12 2024 at 18:44)</a>:</h4>
<p>Third option:<br>
Use 1 pointer, but nest an extra level. So the module params hold the allocators or vice versa. The allocators would still be stored on the stack, just an extra pointer jump to access them.</p>
<p>Very solid chance that this is the best option. Allocation is a relatively rare and slow event. An extra indirection contained on the stack should be safe. Freeing that register on x86 and in all function calls is probably worth it. When creating a new module param set, just copy a single pointer over.</p>



<a name="432963514"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/module%20params/near/432963514" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/module.20params.html#432963514">(Apr 12 2024 at 18:48)</a>:</h4>
<p>yeah if we did that option it would have to be allocators hold the module params</p>



<a name="432963563"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/module%20params/near/432963563" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/module.20params.html#432963563">(Apr 12 2024 at 18:48)</a>:</h4>
<p>because the allocator struct has to be created in the host, potentially in the host's stack</p>



<a name="432963732"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/module%20params/near/432963732" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/module.20params.html#432963732">(Apr 12 2024 at 18:49)</a>:</h4>
<p>if you think that's most likely the best option, then maybe we should just plan to add the 1 param for module params</p>



<a name="432963822"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/module%20params/near/432963822" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/module.20params.html#432963822">(Apr 12 2024 at 18:50)</a>:</h4>
<p>and then later we can modify the contents of that pointer to do allocator things</p>



<a name="432963907"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/module%20params/near/432963907" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/module.20params.html#432963907">(Apr 12 2024 at 18:51)</a>:</h4>
<p>It's definitely a gut feeling especially given the extra arg shuffling that might be needed otherwise.</p>



<a name="432964349"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/module%20params/near/432964349" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/module.20params.html#432964349">(Apr 12 2024 at 18:54)</a>:</h4>
<p>Also, I think it has to be module param holds the allocator (as t least if we want life to be simple).</p>
<p>Allocator will never change (in the scope of a single call to roc). Module param will change potentially on every function call. If we update the the module params, it would update globally if we are updating the module params within the global allocator allocated on the host. As such whenever returning from a function we would have to revert that.</p>
<p>If module params hold the allocator, whenever we create a new module param struct, we just pass an extra pointer in for the allocator. Grab it from the old module param struct.</p>



<a name="432964474"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/module%20params/near/432964474" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/module.20params.html#432964474">(Apr 12 2024 at 18:55)</a>:</h4>
<p>Just need a special helper for each entry from host to roc or to make the host pass in a <code>**allocator</code> for that to all work.</p>



<a name="432971706"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/module%20params/near/432971706" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/module.20params.html#432971706">(Apr 12 2024 at 19:48)</a>:</h4>
<p>good point! <span aria-label="thumbs up" class="emoji emoji-1f44d" role="img" title="thumbs up">:thumbs_up:</span></p>



<a name="433633964"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/module%20params/near/433633964" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Agus Zubiaga <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/module.20params.html#433633964">(Apr 17 2024 at 01:49)</a>:</h4>
<p>I'm trying to fix the REPL in my branch, but I'm confused about where its platform is</p>



<a name="433633987"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/module%20params/near/433633987" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Agus Zubiaga <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/module.20params.html#433633987">(Apr 17 2024 at 01:49)</a>:</h4>
<p>I can see we prepend this to the expression: <a href="https://github.com/roc-lang/roc/blob/c74685f74aa4aee259b3b30f2792d25981a48dee/crates/repl_eval/src/gen.rs#L175">https://github.com/roc-lang/roc/blob/c74685f74aa4aee259b3b30f2792d25981a48dee/crates/repl_eval/src/gen.rs#L175</a></p>



<a name="433634028"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/module%20params/near/433634028" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Agus Zubiaga <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/module.20params.html#433634028">(Apr 17 2024 at 01:50)</a>:</h4>
<p>but where is this <code>./platform</code>?</p>



<a name="433634055"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/module%20params/near/433634055" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/module.20params.html#433634055">(Apr 17 2024 at 01:50)</a>:</h4>
<p>I think we just load it as a shared library, right. So it is more ingrained into the compiler with some sort of libloading call</p>



<a name="433634086"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/module%20params/near/433634086" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Agus Zubiaga <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/module.20params.html#433634086">(Apr 17 2024 at 01:50)</a>:</h4>
<p>Right, but don't we still need a platform roc file?</p>



<a name="433634138"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/module%20params/near/433634138" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Agus Zubiaga <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/module.20params.html#433634138">(Apr 17 2024 at 01:51)</a>:</h4>
<p>This fails in my branch because it can't find <code>./platform</code>, but somehow it doesn't in <code>main</code></p>



<a name="433634182"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/module%20params/near/433634182" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/module.20params.html#433634182">(Apr 17 2024 at 01:52)</a>:</h4>
<p>Not necessarily. It may be more adhoc like all of the gen tests.</p>



<a name="433634200"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/module%20params/near/433634200" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/module.20params.html#433634200">(Apr 17 2024 at 01:52)</a>:</h4>
<p>But I don't recall for sure. Didn't write the code but definitely dug into it before.</p>



<a name="433634219"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/module%20params/near/433634219" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Agus Zubiaga <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/module.20params.html#433634219">(Apr 17 2024 at 01:53)</a>:</h4>
<p>Yeah, I fixed the gen tests by making a real platform roc file: <a href="https://github.com/roc-lang/roc/pull/6645/commits/d3efc751e2e93d4b5d739905702678a0dfb3fe4c">https://github.com/roc-lang/roc/pull/6645/commits/d3efc751e2e93d4b5d739905702678a0dfb3fe4c</a></p>



<a name="433634246"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/module%20params/near/433634246" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Agus Zubiaga <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/module.20params.html#433634246">(Apr 17 2024 at 01:53)</a>:</h4>
<p>I could do the same with the REPL I suppose, but I guess I'd like to understand what this mythical <code>./platform</code> path does <span aria-label="smiley" class="emoji emoji-1f603" role="img" title="smiley">:smiley:</span></p>



<a name="433634310"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/module%20params/near/433634310" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Agus Zubiaga <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/module.20params.html#433634310">(Apr 17 2024 at 01:54)</a>:</h4>
<p>Was it exploiting a bug in load?</p>



<a name="433635350"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/module%20params/near/433635350" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/module.20params.html#433635350">(Apr 17 2024 at 02:07)</a>:</h4>
<p>Probably related to <code>LoadStart::from_str</code></p>



<a name="433635370"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/module%20params/near/433635370" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/module.20params.html#433635370">(Apr 17 2024 at 02:07)</a>:</h4>
<p>Custom path that I think is only used by the repl</p>



<a name="433635389"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/module%20params/near/433635389" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/module.20params.html#433635389">(Apr 17 2024 at 02:07)</a>:</h4>
<p>On phone, really hard to dig in</p>



<a name="433635415"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/module%20params/near/433635415" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Agus Zubiaga <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/module.20params.html#433635415">(Apr 17 2024 at 02:07)</a>:</h4>
<p>Yeah, no worries</p>



<a name="433635494"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/module%20params/near/433635494" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Agus Zubiaga <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/module.20params.html#433635494">(Apr 17 2024 at 02:08)</a>:</h4>
<p>I think we are basically ignoring the platform path when it's specified in <code>provides</code> rather than in <code>packages</code></p>



<a name="433635502"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/module%20params/near/433635502" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Agus Zubiaga <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/module.20params.html#433635502">(Apr 17 2024 at 02:08)</a>:</h4>
<p><a href="https://github.com/roc-lang/roc/blob/c74685f74aa4aee259b3b30f2792d25981a48dee/crates/compiler/load_internal/src/file.rs#L4082-L4086">https://github.com/roc-lang/roc/blob/c74685f74aa4aee259b3b30f2792d25981a48dee/crates/compiler/load_internal/src/file.rs#L4082-L4086</a></p>



<a name="433635539"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/module%20params/near/433635539" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Agus Zubiaga <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/module.20params.html#433635539">(Apr 17 2024 at 02:09)</a>:</h4>
<p>It's not in <code>packages</code> here, so it's never loaded: <a href="https://github.com/roc-lang/roc/blob/c74685f74aa4aee259b3b30f2792d25981a48dee/crates/compiler/load_internal/src/file.rs#L4054-L4064">https://github.com/roc-lang/roc/blob/c74685f74aa4aee259b3b30f2792d25981a48dee/crates/compiler/load_internal/src/file.rs#L4054-L4064</a></p>



<a name="433635657"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/module%20params/near/433635657" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Agus Zubiaga <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/module.20params.html#433635657">(Apr 17 2024 at 02:10)</a>:</h4>
<p>So I think it's basically exploiting this in the REPL and tests to generate the shared lib without specifying a real platform</p>



<a name="433635791"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/module%20params/near/433635791" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Agus Zubiaga <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/module.20params.html#433635791">(Apr 17 2024 at 02:12)</a>:</h4>
<p>In the new app headers, we don't have this "provides to <code>NewPackage</code>" syntax</p>



<a name="433635827"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/module%20params/near/433635827" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Agus Zubiaga <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/module.20params.html#433635827">(Apr 17 2024 at 02:12)</a>:</h4>
<p>Maybe I should allow <code>app [main] { }</code> for the REPL and tests</p>



<hr><p>Last updated: Mar 01 2026 at 12:20 UTC</p>
</html>