<html>
<head><meta charset="utf-8"><title>Remove shared memory infra - flaky bitcode · compiler development · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/index.html">compiler development</a></h2>
<h3>Topic: <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/Remove.20shared.20memory.20infra.20-.20flaky.20bitcode.html">Remove shared memory infra - flaky bitcode</a></h3>

<hr>

<base href="https://roc.zulipchat.com">

<head><link href="https://roc-lang.github.io/zulip-export/style.css" rel="stylesheet"></head>

<a name="490338555"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/Remove%20shared%20memory%20infra%20-%20flaky%20bitcode/near/490338555" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/Remove.20shared.20memory.20infra.20-.20flaky.20bitcode.html#490338555">(Dec 21 2024 at 23:15)</a>:</h4>
<p>We have flaky builtins. </p>
<p>One idea I had, was if we remove the shared memory infrastructure currently used for roc test, do we still need bitcode anymore? The test platforms will bundle libc and implementations for working with RocStr etc.</p>
<p>When I had an attempt at removing that, or maybe it was with the zig upgrade, I had that idea but didn't get around to asking... basically can we rip all this flaky stuff out now?</p>



<a name="490338670"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/Remove%20shared%20memory%20infra%20-%20flaky%20bitcode/near/490338670" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Notification Bot <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/Remove.20shared.20memory.20infra.20-.20flaky.20bitcode.html#490338670">(Dec 21 2024 at 23:16)</a>:</h4>
<p><a href="#narrow/channel/395097-compiler-development/topic/Remove.20shared.20memory.20infra.20-.20flaky.20bitcode/near/490338555">A message</a> was moved here from <a class="stream-topic" data-stream-id="397893" href="/#narrow/channel/397893-announcements/topic/Snake.20case.20support.20PSA">#announcements &gt; Snake case support PSA</a> by <span class="user-mention silent" data-user-id="515757">Luke Boswell</span>.</p>



<a name="490338709"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/Remove%20shared%20memory%20infra%20-%20flaky%20bitcode/near/490338709" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/Remove.20shared.20memory.20infra.20-.20flaky.20bitcode.html#490338709">(Dec 21 2024 at 23:17)</a>:</h4>
<p>I don't follow the question</p>



<a name="490338723"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/Remove%20shared%20memory%20infra%20-%20flaky%20bitcode/near/490338723" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/Remove.20shared.20memory.20infra.20-.20flaky.20bitcode.html#490338723">(Dec 21 2024 at 23:17)</a>:</h4>
<p>What specifically are you trying to remove?</p>



<a name="490338791"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/Remove%20shared%20memory%20infra%20-%20flaky%20bitcode/near/490338791" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/Remove.20shared.20memory.20infra.20-.20flaky.20bitcode.html#490338791">(Dec 21 2024 at 23:18)</a>:</h4>
<p>Modernize Expect</p>



<a name="490338805"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/Remove%20shared%20memory%20infra%20-%20flaky%20bitcode/near/490338805" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/Remove.20shared.20memory.20infra.20-.20flaky.20bitcode.html#490338805">(Dec 21 2024 at 23:19)</a>:</h4>
<p><a href="https://github.com/roc-lang/roc/issues/6930">https://github.com/roc-lang/roc/issues/6930</a></p>



<a name="490338822"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/Remove%20shared%20memory%20infra%20-%20flaky%20bitcode/near/490338822" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/Remove.20shared.20memory.20infra.20-.20flaky.20bitcode.html#490338822">(Dec 21 2024 at 23:19)</a>:</h4>
<blockquote>
<ol>
<li>Rip out all of the old shared memory infrastructure.</li>
</ol>
</blockquote>



<a name="490338833"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/Remove%20shared%20memory%20infra%20-%20flaky%20bitcode/near/490338833" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/Remove.20shared.20memory.20infra.20-.20flaky.20bitcode.html#490338833">(Dec 21 2024 at 23:19)</a>:</h4>
<p>I thought I understood what this meant... but I'm not confident</p>



<a name="490338841"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/Remove%20shared%20memory%20infra%20-%20flaky%20bitcode/near/490338841" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/Remove.20shared.20memory.20infra.20-.20flaky.20bitcode.html#490338841">(Dec 21 2024 at 23:19)</a>:</h4>
<p>Nothing blocking it. But we need to modernize expect and have a it working with platforms before we delete all the shared infra (I mean can be done in the same pr, but we shouldn't rip it out until we have the replacement)</p>



<a name="490338927"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/Remove%20shared%20memory%20infra%20-%20flaky%20bitcode/near/490338927" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/Remove.20shared.20memory.20infra.20-.20flaky.20bitcode.html#490338927">(Dec 21 2024 at 23:20)</a>:</h4>
<p>Yeah... just wanted to know if this would remove the need for bitcode, as that seems to be the cause of all our flakiness with the builtins</p>



<a name="490338990"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/Remove%20shared%20memory%20infra%20-%20flaky%20bitcode/near/490338990" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/Remove.20shared.20memory.20infra.20-.20flaky.20bitcode.html#490338990">(Dec 21 2024 at 23:21)</a>:</h4>
<p>Remove the need for bitcode as a whole?</p>



<a name="490339039"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/Remove%20shared%20memory%20infra%20-%20flaky%20bitcode/near/490339039" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/Remove.20shared.20memory.20infra.20-.20flaky.20bitcode.html#490339039">(Dec 21 2024 at 23:22)</a>:</h4>
<p>We use the bitcode for all of the zig builtins</p>



<a name="490339208"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/Remove%20shared%20memory%20infra%20-%20flaky%20bitcode/near/490339208" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/Remove.20shared.20memory.20infra.20-.20flaky.20bitcode.html#490339208">(Dec 21 2024 at 23:25)</a>:</h4>
<p>ok, yeah I misunderstood. I was forgetting about that, I thought it may have just been for linking with the test platforms.</p>



<a name="490339284"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/Remove%20shared%20memory%20infra%20-%20flaky%20bitcode/near/490339284" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/Remove.20shared.20memory.20infra.20-.20flaky.20bitcode.html#490339284">(Dec 21 2024 at 23:26)</a>:</h4>
<p>We need to bundle the bitcode so roc can link that also to produce an object file with all the correct symbols defined in it.</p>



<a name="490339430"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/Remove%20shared%20memory%20infra%20-%20flaky%20bitcode/near/490339430" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/Remove.20shared.20memory.20infra.20-.20flaky.20bitcode.html#490339430">(Dec 21 2024 at 23:29)</a>:</h4>
<p>Yeah, and by consuming it as bitcode, llvm can optimize it way more than only generating an object file</p>



<a name="490339583"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/Remove%20shared%20memory%20infra%20-%20flaky%20bitcode/near/490339583" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/Remove.20shared.20memory.20infra.20-.20flaky.20bitcode.html#490339583">(Dec 21 2024 at 23:31)</a>:</h4>
<p>thanks for clearing that up</p>



<hr><p>Last updated: Mar 01 2026 at 12:20 UTC</p>
</html>