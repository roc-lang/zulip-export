<html>
<head><meta charset="utf-8"><title>bug: Outstanding references to the derived module · compiler development · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/index.html">compiler development</a></h2>
<h3>Topic: <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/bug.3A.20Outstanding.20references.20to.20the.20derived.20module.html">bug: Outstanding references to the derived module</a></h3>

<hr>

<base href="https://roc.zulipchat.com">

<head><link href="https://roc-lang.github.io/zulip-export/style.css" rel="stylesheet"></head>

<a name="491134824"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/bug%3A%20Outstanding%20references%20to%20the%20derived%20module/near/491134824" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/bug.3A.20Outstanding.20references.20to.20the.20derived.20module.html#491134824">(Dec 29 2024 at 01:23)</a>:</h4>
<p>Does this look like something easy to fix? <a href="https://github.com/roc-lang/roc/issues/7429">https://github.com/roc-lang/roc/issues/7429</a></p>
<p>It's giving me grief upgrading the webserver demo's and using Isaac's RTL templating engine</p>



<a name="491135016"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/bug%3A%20Outstanding%20references%20to%20the%20derived%20module/near/491135016" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/bug.3A.20Outstanding.20references.20to.20the.20derived.20module.html#491135016">(Dec 29 2024 at 01:26)</a>:</h4>
<p>I didn't repro with latest nightly</p>



<a name="491135022"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/bug%3A%20Outstanding%20references%20to%20the%20derived%20module/near/491135022" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/bug.3A.20Outstanding.20references.20to.20the.20derived.20module.html#491135022">(Dec 29 2024 at 01:26)</a>:</h4>
<p>What version of Roc are you using?</p>



<a name="491135137"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/bug%3A%20Outstanding%20references%20to%20the%20derived%20module/near/491135137" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/bug.3A.20Outstanding.20references.20to.20the.20derived.20module.html#491135137">(Dec 29 2024 at 01:28)</a>:</h4>
<p>Built from source</p>
<div class="codehilite"><pre><span></span><code>$ roc version
roc built from commit 06e78daa91, committed at 2024-12-28 22:05:45 UTC
</code></pre></div>



<a name="491135203"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/bug%3A%20Outstanding%20references%20to%20the%20derived%20module/near/491135203" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/bug.3A.20Outstanding.20references.20to.20the.20derived.20module.html#491135203">(Dec 29 2024 at 01:29)</a>:</h4>
<p>oh wait, let me update the Issue, it needs to be in a sub-folder</p>



<a name="491135300"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/bug%3A%20Outstanding%20references%20to%20the%20derived%20module/near/491135300" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/bug.3A.20Outstanding.20references.20to.20the.20derived.20module.html#491135300">(Dec 29 2024 at 01:30)</a>:</h4>
<p>Like </p>
<div class="codehilite"><pre><span></span><code>$ roc check src/Views/broken.roc
An internal compiler expectation was broken.
This is definitely a compiler bug.
Please file an issue here: &lt;https://github.com/roc-lang/roc/issues/new/choose&gt;
Outstanding references to the derived module
Location: crates/compiler/load_internal/src/file.rs:3358:29
</code></pre></div>



<a name="491135355"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/bug%3A%20Outstanding%20references%20to%20the%20derived%20module/near/491135355" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/bug.3A.20Outstanding.20references.20to.20the.20derived.20module.html#491135355">(Dec 29 2024 at 01:31)</a>:</h4>
<p>Sorry, I hadn't realised the folder thing was relevant here</p>



<a name="491135807"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/bug%3A%20Outstanding%20references%20to%20the%20derived%20module/near/491135807" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/bug.3A.20Outstanding.20references.20to.20the.20derived.20module.html#491135807">(Dec 29 2024 at 01:38)</a>:</h4>
<p>The whole <code>derived_module</code> thing looks a bit confusing.</p>



<a name="491136240"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/bug%3A%20Outstanding%20references%20to%20the%20derived%20module/near/491136240" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/bug.3A.20Outstanding.20references.20to.20the.20derived.20module.html#491136240">(Dec 29 2024 at 01:45)</a>:</h4>
<p>I'm unable to replicate</p>



<a name="491136327"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/bug%3A%20Outstanding%20references%20to%20the%20derived%20module/near/491136327" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/bug.3A.20Outstanding.20references.20to.20the.20derived.20module.html#491136327">(Dec 29 2024 at 01:46)</a>:</h4>
<p>I checked out the commit, created a --release build, and ran <code>roc/target/release/roc check src/Views/broken.roc</code></p>



<a name="491136348"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/bug%3A%20Outstanding%20references%20to%20the%20derived%20module/near/491136348" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/bug.3A.20Outstanding.20references.20to.20the.20derived.20module.html#491136348">(Dec 29 2024 at 01:46)</a>:</h4>
<div class="codehilite"><pre><span></span><code>~/dev
❯ roc/target/release/roc check src/Views/broken.roc
0 errors and 0 warnings found in 29 ms.
</code></pre></div>



<a name="491136361"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/bug%3A%20Outstanding%20references%20to%20the%20derived%20module/near/491136361" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/bug.3A.20Outstanding.20references.20to.20the.20derived.20module.html#491136361">(Dec 29 2024 at 01:47)</a>:</h4>
<p>Is this in the roc-htmx-tailwind repo?</p>



<a name="491136372"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/bug%3A%20Outstanding%20references%20to%20the%20derived%20module/near/491136372" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/bug.3A.20Outstanding.20references.20to.20the.20derived.20module.html#491136372">(Dec 29 2024 at 01:47)</a>:</h4>
<p>Oh, that repo</p>



<a name="491136394"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/bug%3A%20Outstanding%20references%20to%20the%20derived%20module/near/491136394" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/bug.3A.20Outstanding.20references.20to.20the.20derived.20module.html#491136394">(Dec 29 2024 at 01:48)</a>:</h4>
<p><a href="https://github.com/lukewilliamboswell/roc-htmx-tailwindcss-demo/tree/upgrade-0.11.0">https://github.com/lukewilliamboswell/roc-htmx-tailwindcss-demo/tree/upgrade-0.11.0</a></p>



<a name="491136481"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/bug%3A%20Outstanding%20references%20to%20the%20derived%20module/near/491136481" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/bug.3A.20Outstanding.20references.20to.20the.20derived.20module.html#491136481">(Dec 29 2024 at 01:49)</a>:</h4>
<p>Yeah, if you checkout that branch and add the file <code>src/Views/broken.roc</code> you should get;</p>
<div class="codehilite"><pre><span></span><code>$ roc check src/Views/broken.roc
An internal compiler expectation was broken.
This is definitely a compiler bug.
Please file an issue here: &lt;https://github.com/roc-lang/roc/issues/new/choose&gt;
Outstanding references to the derived module
Location: crates/compiler/load_internal/src/file.rs:3358:29
</code></pre></div>



<a name="491136504"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/bug%3A%20Outstanding%20references%20to%20the%20derived%20module/near/491136504" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/bug.3A.20Outstanding.20references.20to.20the.20derived.20module.html#491136504">(Dec 29 2024 at 01:49)</a>:</h4>
<p>It also happens with <code>$ roc check src/Views/Pages.roc</code> but the <code>broken.roc</code> is a super small repro</p>



<a name="491136505"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/bug%3A%20Outstanding%20references%20to%20the%20derived%20module/near/491136505" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/bug.3A.20Outstanding.20references.20to.20the.20derived.20module.html#491136505">(Dec 29 2024 at 01:49)</a>:</h4>
<p>Okay, got it with <code>Layout.roc</code></p>



<a name="491136620"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/bug%3A%20Outstanding%20references%20to%20the%20derived%20module/near/491136620" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/bug.3A.20Outstanding.20references.20to.20the.20derived.20module.html#491136620">(Dec 29 2024 at 01:51)</a>:</h4>
<p>Well, it also works with just <code>module []</code> in <code>broken.roc</code></p>



<a name="491136673"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/bug%3A%20Outstanding%20references%20to%20the%20derived%20module/near/491136673" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/bug.3A.20Outstanding.20references.20to.20the.20derived.20module.html#491136673">(Dec 29 2024 at 01:52)</a>:</h4>
<p>ohk, interesting</p>



<a name="491136683"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/bug%3A%20Outstanding%20references%20to%20the%20derived%20module/near/491136683" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/bug.3A.20Outstanding.20references.20to.20the.20derived.20module.html#491136683">(Dec 29 2024 at 01:52)</a>:</h4>
<p>So this isn't a "minimal" repro IMO since I think the problem is elsewhere</p>



<a name="491136901"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/bug%3A%20Outstanding%20references%20to%20the%20derived%20module/near/491136901" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/bug.3A.20Outstanding.20references.20to.20the.20derived.20module.html#491136901">(Dec 29 2024 at 01:56)</a>:</h4>
<p>Ok heres a minimal repro <a href="https://github.com/lukewilliamboswell/roc-htmx-tailwindcss-demo/tree/broken">https://github.com/lukewilliamboswell/roc-htmx-tailwindcss-demo/tree/broken</a></p>



<a name="491136908"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/bug%3A%20Outstanding%20references%20to%20the%20derived%20module/near/491136908" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/bug.3A.20Outstanding.20references.20to.20the.20derived.20module.html#491136908">(Dec 29 2024 at 01:56)</a>:</h4>
<p>There's only two files in there, the <code>broken.roc</code> and a minimal <code>main.roc</code> referencing the new webserver</p>



<a name="491136928"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/bug%3A%20Outstanding%20references%20to%20the%20derived%20module/near/491136928" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/bug.3A.20Outstanding.20references.20to.20the.20derived.20module.html#491136928">(Dec 29 2024 at 01:57)</a>:</h4>
<p>Okay, that's minimal</p>



<a name="491136939"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/bug%3A%20Outstanding%20references%20to%20the%20derived%20module/near/491136939" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/bug.3A.20Outstanding.20references.20to.20the.20derived.20module.html#491136939">(Dec 29 2024 at 01:57)</a>:</h4>
<p>I wonder if it happens with <code>basic-cli</code></p>



<a name="491136954"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/bug%3A%20Outstanding%20references%20to%20the%20derived%20module/near/491136954" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/bug.3A.20Outstanding.20references.20to.20the.20derived.20module.html#491136954">(Dec 29 2024 at 01:57)</a>:</h4>
<p>1 sec</p>



<a name="491137017"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/bug%3A%20Outstanding%20references%20to%20the%20derived%20module/near/491137017" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/bug.3A.20Outstanding.20references.20to.20the.20derived.20module.html#491137017">(Dec 29 2024 at 01:59)</a>:</h4>
<p>Yeah it does. Just pushed a commit changing the <code>main.roc</code> to </p>
<div class="codehilite"><pre><span></span><code>app [main!] { pf: platform &quot;https://github.com/roc-lang/basic-cli/releases/download/0.17.0/lZFLstMUCUvd5bjnnpYromZJXkQUrdhbva4xdBInicE.tar.br&quot; }

main! = \_ -&gt; Err TODO
</code></pre></div>



<a name="491137025"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/bug%3A%20Outstanding%20references%20to%20the%20derived%20module/near/491137025" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/bug.3A.20Outstanding.20references.20to.20the.20derived.20module.html#491137025">(Dec 29 2024 at 01:59)</a>:</h4>
<p>Okay, then it's maybe not a platform problem?</p>



<a name="491137035"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/bug%3A%20Outstanding%20references%20to%20the%20derived%20module/near/491137035" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/bug.3A.20Outstanding.20references.20to.20the.20derived.20module.html#491137035">(Dec 29 2024 at 01:59)</a>:</h4>
<p>No it's definitely the compiler</p>



<a name="491137140"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/bug%3A%20Outstanding%20references%20to%20the%20derived%20module/near/491137140" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/bug.3A.20Outstanding.20references.20to.20the.20derived.20module.html#491137140">(Dec 29 2024 at 02:00)</a>:</h4>
<p>Oh, it's definitely the compiler</p>



<a name="491137149"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/bug%3A%20Outstanding%20references%20to%20the%20derived%20module/near/491137149" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/bug.3A.20Outstanding.20references.20to.20the.20derived.20module.html#491137149">(Dec 29 2024 at 02:00)</a>:</h4>
<p>I mean whether this happens in just a Roc package vs. a platform</p>



<a name="491137251"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/bug%3A%20Outstanding%20references%20to%20the%20derived%20module/near/491137251" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/bug.3A.20Outstanding.20references.20to.20the.20derived.20module.html#491137251">(Dec 29 2024 at 02:02)</a>:</h4>
<p>In this case it's neither of those... this has an app module at the root, the parent folder from the module we are checking</p>



<a name="491138375"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/bug%3A%20Outstanding%20references%20to%20the%20derived%20module/near/491138375" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/bug.3A.20Outstanding.20references.20to.20the.20derived.20module.html#491138375">(Dec 29 2024 at 02:24)</a>:</h4>
<p>Can you update the GH issue?</p>



<a name="491139096"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/bug%3A%20Outstanding%20references%20to%20the%20derived%20module/near/491139096" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/bug.3A.20Outstanding.20references.20to.20the.20derived.20module.html#491139096">(Dec 29 2024 at 02:37)</a>:</h4>
<p>done</p>



<a name="491140512"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/bug%3A%20Outstanding%20references%20to%20the%20derived%20module/near/491140512" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/bug.3A.20Outstanding.20references.20to.20the.20derived.20module.html#491140512">(Dec 29 2024 at 03:04)</a>:</h4>
<p>That’s weird. Can you check the compiler commit right before my change to package headers?</p>



<a name="491140526"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/bug%3A%20Outstanding%20references%20to%20the%20derived%20module/near/491140526" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/bug.3A.20Outstanding.20references.20to.20the.20derived.20module.html#491140526">(Dec 29 2024 at 03:04)</a>:</h4>
<p>If that works it’s an easy bisect <span aria-label="blush" class="emoji emoji-1f60a" role="img" title="blush">:blush:</span></p>



<a name="491140540"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/bug%3A%20Outstanding%20references%20to%20the%20derived%20module/near/491140540" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/bug.3A.20Outstanding.20references.20to.20the.20derived.20module.html#491140540">(Dec 29 2024 at 03:05)</a>:</h4>
<p>And you get the added pleasure of shaming me</p>



<a name="491141884"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/bug%3A%20Outstanding%20references%20to%20the%20derived%20module/near/491141884" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ayaz Hafiz <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/bug.3A.20Outstanding.20references.20to.20the.20derived.20module.html#491141884">(Dec 29 2024 at 03:30)</a>:</h4>
<p>the bug is present before that</p>



<a name="491142066"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/bug%3A%20Outstanding%20references%20to%20the%20derived%20module/near/491142066" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Notification Bot <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/bug.3A.20Outstanding.20references.20to.20the.20derived.20module.html#491142066">(Dec 29 2024 at 03:33)</a>:</h4>
<p>37 messages were moved here from <a class="stream-topic" data-stream-id="395097" href="/#narrow/channel/395097-compiler-development/topic/casual.20conversation">#compiler development &gt; casual conversation</a> by <span class="user-mention silent" data-user-id="515757">Luke Boswell</span>.</p>



<a name="491143241"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/bug%3A%20Outstanding%20references%20to%20the%20derived%20module/near/491143241" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ayaz Hafiz <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/bug.3A.20Outstanding.20references.20to.20the.20derived.20module.html#491143241">(Dec 29 2024 at 03:55)</a>:</h4>
<p>is this a valid way to use a value from a platform?</p>
<div class="codehilite"><pre><span></span><code>module []

import pf.Stderr

foo = Stderr.line
</code></pre></div>



<a name="491146113"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/395097-compiler%20development/topic/bug%3A%20Outstanding%20references%20to%20the%20derived%20module/near/491146113" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ayaz Hafiz <a href="https://roc-lang.github.io/zulip-export/stream/395097-compiler-development/topic/bug.3A.20Outstanding.20references.20to.20the.20derived.20module.html#491146113">(Dec 29 2024 at 04:46)</a>:</h4>
<p>i understand the problem well I think. The issue is that when a module is checked, if there is a transitive platform found, that platform is also placed into the queue of modules to resolve (<a href="https://github.com/roc-lang/roc/blob/723e35f11e1b1744c77cde77e42ed2b48fff12a6/crates/compiler/load_internal/src/file.rs#L1300-L1361">https://github.com/roc-lang/roc/blob/723e35f11e1b1744c77cde77e42ed2b48fff12a6/crates/compiler/load_internal/src/file.rs#L1300-L1361</a>). However if the module doesn't use the platform, it will finish all its computation before the platform has had a chance to, hence the panic. I think probably (?) the right way to do this is to only traverse to find the package if it doesn't exist in the package shorthand list,  and then add it as a dependency of the module, but I don't totally understand all the flow here and Ive run out of tie</p>



<hr><p>Last updated: Nov 01 2025 at 12:13 UTC</p>
</html>