<html>
<head><meta charset="utf-8"><title>roc test crash · bugs · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://roc-lang.github.io/zulip-export/stream/463736-bugs/index.html">bugs</a></h2>
<h3>Topic: <a href="https://roc-lang.github.io/zulip-export/stream/463736-bugs/topic/roc.20test.20crash.html">roc test crash</a></h3>

<hr>

<base href="https://roc.zulipchat.com">

<head><link href="https://roc-lang.github.io/zulip-export/style.css" rel="stylesheet"></head>

<a name="478184682"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/463736-bugs/topic/roc%20test%20crash/near/478184682" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> drew <a href="https://roc-lang.github.io/zulip-export/stream/463736-bugs/topic/roc.20test.20crash.html#478184682">(Oct 22 2024 at 01:41)</a>:</h4>
<p>within <a href="https://github.com/drewolson/aoc-roc">https://github.com/drewolson/aoc-roc</a>, the following command works:</p>



<a name="478184696"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/463736-bugs/topic/roc%20test%20crash/near/478184696" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> drew <a href="https://roc-lang.github.io/zulip-export/stream/463736-bugs/topic/roc.20test.20crash.html#478184696">(Oct 22 2024 at 01:41)</a>:</h4>
<div class="codehilite"><pre><span></span><code>$ roc test Aoc/Year2023/Day14.roc
0 failed and 2 passed in 368 ms.
</code></pre></div>



<a name="478184703"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/463736-bugs/topic/roc%20test%20crash/near/478184703" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> drew <a href="https://roc-lang.github.io/zulip-export/stream/463736-bugs/topic/roc.20test.20crash.html#478184703">(Oct 22 2024 at 01:41)</a>:</h4>
<p>but this command crashes</p>



<a name="478184715"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/463736-bugs/topic/roc%20test%20crash/near/478184715" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> drew <a href="https://roc-lang.github.io/zulip-export/stream/463736-bugs/topic/roc.20test.20crash.html#478184715">(Oct 22 2024 at 01:41)</a>:</h4>
<div class="codehilite"><pre><span></span><code>$ roc test Aoc/Year2023/Day09.roc
thread &#39;main&#39; panicked at crates/compiler/load_internal/src/file.rs:373:85:
called `Option::unwrap()` on a `None` value
note: run with `RUST_BACKTRACE=1` environment variable to display a backtrace
^C
</code></pre></div>



<a name="478184720"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/463736-bugs/topic/roc%20test%20crash/near/478184720" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> drew <a href="https://roc-lang.github.io/zulip-export/stream/463736-bugs/topic/roc.20test.20crash.html#478184720">(Oct 22 2024 at 01:41)</a>:</h4>
<p>for the life of me i can't spot a reason why</p>



<a name="478184774"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/463736-bugs/topic/roc%20test%20crash/near/478184774" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> drew <a href="https://roc-lang.github.io/zulip-export/stream/463736-bugs/topic/roc.20test.20crash.html#478184774">(Oct 22 2024 at 01:42)</a>:</h4>
<p><code>roc test</code> without arguments works fine</p>



<a name="478184778"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/463736-bugs/topic/roc%20test%20crash/near/478184778" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> drew <a href="https://roc-lang.github.io/zulip-export/stream/463736-bugs/topic/roc.20test.20crash.html#478184778">(Oct 22 2024 at 01:42)</a>:</h4>
<div class="codehilite"><pre><span></span><code>$ roc test
0 failed and 5 passed in 423 ms.
</code></pre></div>



<a name="478186844"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/463736-bugs/topic/roc%20test%20crash/near/478186844" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/463736-bugs/topic/roc.20test.20crash.html#478186844">(Oct 22 2024 at 02:03)</a>:</h4>
<p>I'm guessing a bug in the implementation of that feature for <code>roc test</code> to take a file path as an argument</p>



<a name="478186924"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/463736-bugs/topic/roc%20test%20crash/near/478186924" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/463736-bugs/topic/roc.20test.20crash.html#478186924">(Oct 22 2024 at 02:04)</a>:</h4>
<p>Indeed it is a bit strange</p>



<a name="478186956"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/463736-bugs/topic/roc%20test%20crash/near/478186956" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/463736-bugs/topic/roc.20test.20crash.html#478186956">(Oct 22 2024 at 02:04)</a>:</h4>
<p>If you can try a debug build of the compiler it might give you more information</p>



<a name="478186985"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/463736-bugs/topic/roc%20test%20crash/near/478186985" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> drew <a href="https://roc-lang.github.io/zulip-export/stream/463736-bugs/topic/roc.20test.20crash.html#478186985">(Oct 22 2024 at 02:04)</a>:</h4>
<p>i’ll give it a shot later, thanks</p>



<a name="484543828"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/463736-bugs/topic/roc%20test%20crash/near/484543828" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> drew <a href="https://roc-lang.github.io/zulip-export/stream/463736-bugs/topic/roc.20test.20crash.html#484543828">(Nov 26 2024 at 15:46)</a>:</h4>
<p>any updates on <a href="https://github.com/roc-lang/roc/issues/7175">https://github.com/roc-lang/roc/issues/7175</a>? i'd love to try roc for aoc this year, but the LSP constantly crashes when opening files in my multi-file project. happy to wait until next year if it's not the right time.</p>



<a name="484543949"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/463736-bugs/topic/roc%20test%20crash/near/484543949" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> drew <a href="https://roc-lang.github.io/zulip-export/stream/463736-bugs/topic/roc.20test.20crash.html#484543949">(Nov 26 2024 at 15:47)</a>:</h4>
<p>though it look like <code>roc check</code> no longer fails on this file, so that's good!</p>



<a name="484548823"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/463736-bugs/topic/roc%20test%20crash/near/484548823" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anton <a href="https://roc-lang.github.io/zulip-export/stream/463736-bugs/topic/roc.20test.20crash.html#484548823">(Nov 26 2024 at 16:10)</a>:</h4>
<p>I can take a look at it after I'm done with the breaking changes update, although others are welcome to investigate this high priority issue</p>



<a name="484933396"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/463736-bugs/topic/roc%20test%20crash/near/484933396" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/463736-bugs/topic/roc.20test.20crash.html#484933396">(Nov 28 2024 at 14:28)</a>:</h4>
<p>Looks like it may be an issue with something holding an extra reference to an Arc that contains the module ids.  When i finish up the snake_case work I can take a look</p>



<a name="484937217"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/463736-bugs/topic/roc%20test%20crash/near/484937217" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/463736-bugs/topic/roc.20test.20crash.html#484937217">(Nov 28 2024 at 14:47)</a>:</h4>
<p>Any pointers you can give on tracking down these sort of references would be helpful.</p>



<a name="484938110"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/463736-bugs/topic/roc%20test%20crash/near/484938110" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anton <a href="https://roc-lang.github.io/zulip-export/stream/463736-bugs/topic/roc.20test.20crash.html#484938110">(Nov 28 2024 at 14:52)</a>:</h4>
<p>Looking at the authors of <a href="https://github.com/roc-lang/roc/blame/61c9be564b07398188b2010ca0c03cf2b6df8b90/crates/compiler/load_internal/src/file.rs#L3311C20-L3311C20">the surrounding code</a>, it's possible that <span class="user-mention" data-user-id="454654">@Ayaz Hafiz</span>, <span class="user-mention" data-user-id="281383">@Richard Feldman</span> or <span class="user-mention" data-user-id="281543">@Folkert de Vries</span> have some good tips.</p>



<a name="484942222"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/463736-bugs/topic/roc%20test%20crash/near/484942222" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/463736-bugs/topic/roc.20test.20crash.html#484942222">(Nov 28 2024 at 15:13)</a>:</h4>
<p>Ok, checking this locally it looks like I'm seeing a different error with the latest.  Now the issue is that there is a dependency that hasn't been solved when type checking completes.</p>
<p>These are the steps that are not Done at this stage:</p>
<div class="codehilite" data-code-language="Text only"><pre><span></span><code>Step(pf.PlatformTasks, SolveTypes): NotStarted,
Step(pf., SolveTypes): NotStarted,
Step(pf.Stderr, SolveTypes): NotStarted,
Step(pf., CanonicalizeAndConstrain): NotStarted,
Step(pf.Stderr, CanonicalizeAndConstrain): NotStarted,
Step(pf.PlatformTasks, CanonicalizeAndConstrain): Pending,
Step(pf.InternalHttp, SolveTypes): Pending,
Step(pf.InternalCommand, SolveTypes): Pending,
Step(pf.InternalPath, SolveTypes): Pending,
</code></pre></div>



<a name="484959487"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/463736-bugs/topic/roc%20test%20crash/near/484959487" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/463736-bugs/topic/roc.20test.20crash.html#484959487">(Nov 28 2024 at 16:56)</a>:</h4>
<p>It seems that it is adding the platform modules to be solved, but since they are never used in checking this leaf module, we never typecheck.  It seems that we should only add a Canonicalize/SolveTypes Steps when the module is required.</p>



<a name="485226040"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/463736-bugs/topic/roc%20test%20crash/near/485226040" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/463736-bugs/topic/roc.20test.20crash.html#485226040">(Nov 30 2024 at 12:58)</a>:</h4>
<p>I'm really struggling with this.  It seems that the use case is valid (single file checking), but when we decide to add the msgs for the platform modules, we don't know if the file we are checking even needs them.  So the solutions I see are:</p>
<ul>
<li>Thread a flag down to the handle_root_type function on whether or not to load the main path by default.  If we are checking a single file, this would be false.  We would then need a way to say "Hey this file actually imports from the platform/packages in the main.roc, load it now".  This seems smart, but would need to be generalized or would feel very rickity.</li>
<li>Always force Can and TypeChecking on the platform and package modules.  Seems to be the lower effort thing and likely to "just work" in most cases, but would require us to do more work than we need to in many cases.</li>
</ul>
<p>I'd like to get some thoughts from some of the core team on this. <span class="user-mention" data-user-id="361169">@Anton</span> <span class="user-mention" data-user-id="343810">@Brendan Hansknecht</span> <span class="user-mention" data-user-id="281383">@Richard Feldman</span> (Sorry, I don't know all who's on the core team).</p>



<a name="485245051"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/463736-bugs/topic/roc%20test%20crash/near/485245051" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/463736-bugs/topic/roc.20test.20crash.html#485245051">(Nov 30 2024 at 16:58)</a>:</h4>
<p>Regardless, I'd probably need a little walk through to understand all the things I need to think about regarding this</p>



<a name="485247785"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/463736-bugs/topic/roc%20test%20crash/near/485247785" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/463736-bugs/topic/roc.20test.20crash.html#485247785">(Nov 30 2024 at 17:37)</a>:</h4>
<p>So the issue is that to check the validity of a single roc file, we also have to check the platform in order to fully solve the type information?</p>
<p>Also, which specific messages are problematic, do you have an example?</p>



<a name="485248243"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/463736-bugs/topic/roc%20test%20crash/near/485248243" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/463736-bugs/topic/roc.20test.20crash.html#485248243">(Nov 30 2024 at 17:43)</a>:</h4>
<p>So in file.rs::update when we determine that have finished all type checking because the root_id equals the module_id and some other things, the platform modules have not been solved and we hit an assert that checks that and blows up. </p>
<div class="codehilite" data-code-language="Text only"><pre><span></span><code>thread 'main' panicked at crates/compiler/load_internal/src/file.rs:2532:17:
assertion failed: state.dependencies.solved_all()
note: run with `RUST_BACKTRACE=1` environment variable to display a backtrace
</code></pre></div>
<p>If you ignore this like I'm doing right now when the root type is a module, you get the original issue where there are outstanding references (Arc clones) to state.derived module.</p>
<div class="codehilite" data-code-language="Text only"><pre><span></span><code>An internal compiler expectation was broken.
This is definitely a compiler bug.
Please file an issue here: &lt;https://github.com/roc-lang/roc/issues/new/choose&gt;
Outstanding references to the derived module
Location: crates/compiler/load_internal/src/file.rs:3325:29
</code></pre></div>



<a name="485248321"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/463736-bugs/topic/roc%20test%20crash/near/485248321" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/463736-bugs/topic/roc.20test.20crash.html#485248321">(Nov 30 2024 at 17:44)</a>:</h4>
<p>We don't need to (from a functional standpoint) check the platform since it's not used.  But this assert makes us have to (probably to ensure all check errors are returned).</p>



<a name="485248442"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/463736-bugs/topic/roc%20test%20crash/near/485248442" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/463736-bugs/topic/roc.20test.20crash.html#485248442">(Nov 30 2024 at 17:46)</a>:</h4>
<p>It seems like the check is there to prevent this latter message from happening (clearing all the work will cause all of the clones to be dropped).</p>



<a name="485248481"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/463736-bugs/topic/roc%20test%20crash/near/485248481" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/463736-bugs/topic/roc.20test.20crash.html#485248481">(Nov 30 2024 at 17:46)</a>:</h4>
<p>It's a lot of different concepts to swim through when I get about 30mins at a time to look into it.</p>



<a name="485428638"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/463736-bugs/topic/roc%20test%20crash/near/485428638" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> drew <a href="https://roc-lang.github.io/zulip-export/stream/463736-bugs/topic/roc.20test.20crash.html#485428638">(Nov 30 2024 at 23:21)</a>:</h4>
<p>if it helps, i still get the error on this repo <a href="https://github.com/drewolson/aoc-roc">https://github.com/drewolson/aoc-roc</a></p>



<a name="485428643"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/463736-bugs/topic/roc%20test%20crash/near/485428643" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> drew <a href="https://roc-lang.github.io/zulip-export/stream/463736-bugs/topic/roc.20test.20crash.html#485428643">(Nov 30 2024 at 23:21)</a>:</h4>
<p><code>roc build</code> works</p>



<a name="485428653"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/463736-bugs/topic/roc%20test%20crash/near/485428653" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> drew <a href="https://roc-lang.github.io/zulip-export/stream/463736-bugs/topic/roc.20test.20crash.html#485428653">(Nov 30 2024 at 23:21)</a>:</h4>
<p>however <code>roc check Aoc/Year2023/Day09.roc</code> errors</p>



<a name="485428659"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/463736-bugs/topic/roc%20test%20crash/near/485428659" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> drew <a href="https://roc-lang.github.io/zulip-export/stream/463736-bugs/topic/roc.20test.20crash.html#485428659">(Nov 30 2024 at 23:21)</a>:</h4>
<p>(and therefore i get persistent LSP errors)</p>



<a name="485428670"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/463736-bugs/topic/roc%20test%20crash/near/485428670" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> drew <a href="https://roc-lang.github.io/zulip-export/stream/463736-bugs/topic/roc.20test.20crash.html#485428670">(Nov 30 2024 at 23:21)</a>:</h4>
<p>i'm on the latest roc, parser, and basic-cli</p>



<a name="485428672"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/463736-bugs/topic/roc%20test%20crash/near/485428672" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> drew <a href="https://roc-lang.github.io/zulip-export/stream/463736-bugs/topic/roc.20test.20crash.html#485428672">(Nov 30 2024 at 23:21)</a>:</h4>
<div class="codehilite"><pre><span></span><code>$ roc --version
roc nightly pre-release, built from commit d72da8eb0fb on Fri Nov 29 09:25:13 UTC 2024
</code></pre></div>



<a name="485431305"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/463736-bugs/topic/roc%20test%20crash/near/485431305" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/463736-bugs/topic/roc.20test.20crash.html#485431305">(Dec 01 2024 at 00:06)</a>:</h4>
<p>It sounds silly but add an import for any module from your platform to the file and it’s good to go</p>



<a name="485431364"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/463736-bugs/topic/roc%20test%20crash/near/485431364" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> drew <a href="https://roc-lang.github.io/zulip-export/stream/463736-bugs/topic/roc.20test.20crash.html#485431364">(Dec 01 2024 at 00:07)</a>:</h4>
<p>sorry can you explain that more?</p>



<a name="485431586"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/463736-bugs/topic/roc%20test%20crash/near/485431586" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> drew <a href="https://roc-lang.github.io/zulip-export/stream/463736-bugs/topic/roc.20test.20crash.html#485431586">(Dec 01 2024 at 00:11)</a>:</h4>
<p>you're saying i should import a platform function?</p>



<a name="485431652"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/463736-bugs/topic/roc%20test%20crash/near/485431652" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> drew <a href="https://roc-lang.github.io/zulip-export/stream/463736-bugs/topic/roc.20test.20crash.html#485431652">(Dec 01 2024 at 00:12)</a>:</h4>
<p>adding <code>import pf.Stdout</code> still has the same error</p>



<a name="485431869"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/463736-bugs/topic/roc%20test%20crash/near/485431869" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> drew <a href="https://roc-lang.github.io/zulip-export/stream/463736-bugs/topic/roc.20test.20crash.html#485431869">(Dec 01 2024 at 00:16)</a>:</h4>
<p>i'd be more than happy to do a workaround for now if i can have working LSP for advent of code <span aria-label="smile" class="emoji emoji-1f642" role="img" title="smile">:smile:</span></p>



<a name="485432110"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/463736-bugs/topic/roc%20test%20crash/near/485432110" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> drew <a href="https://roc-lang.github.io/zulip-export/stream/463736-bugs/topic/roc.20test.20crash.html#485432110">(Dec 01 2024 at 00:21)</a>:</h4>
<p>ok weird, this did work for the LSP! but the command line <code>roc check</code> still fails</p>



<a name="485432406"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/463736-bugs/topic/roc%20test%20crash/near/485432406" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/463736-bugs/topic/roc.20test.20crash.html#485432406">(Dec 01 2024 at 00:26)</a>:</h4>
<p>That’s weird. The roc check will fail now because you have an unused import, but it shouldn’t crash</p>



<a name="485432443"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/463736-bugs/topic/roc%20test%20crash/near/485432443" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> drew <a href="https://roc-lang.github.io/zulip-export/stream/463736-bugs/topic/roc.20test.20crash.html#485432443">(Dec 01 2024 at 00:27)</a>:</h4>
<div class="codehilite"><pre><span></span><code>$ roc check Aoc/Year2023/Day09.roc
An internal compiler expectation was broken.
This is definitely a compiler bug.
Please file an issue here: &lt;https://github.com/roc-lang/roc/issues/new/choose&gt;
Outstanding references to the derived module
Location: crates/compiler/load_internal/src/file.rs:3311:29
</code></pre></div>



<a name="485432454"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/463736-bugs/topic/roc%20test%20crash/near/485432454" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> drew <a href="https://roc-lang.github.io/zulip-export/stream/463736-bugs/topic/roc.20test.20crash.html#485432454">(Dec 01 2024 at 00:27)</a>:</h4>
<div class="codehilite"><pre><span></span><code>$ head Aoc/Year2023/Day09.roc
module [part1, part2]

import pf.Stdout

nextVal : List I64 -&gt; I64
nextVal = \l -&gt;
    if List.all l \n -&gt; n == 0 then
        0
    else
        diffs = List.map2 l (List.dropFirst l 1) \a, b -&gt; b - a
</code></pre></div>



<a name="485432462"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/463736-bugs/topic/roc%20test%20crash/near/485432462" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/463736-bugs/topic/roc.20test.20crash.html#485432462">(Dec 01 2024 at 00:27)</a>:</h4>
<p>Interesting</p>



<a name="485432463"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/463736-bugs/topic/roc%20test%20crash/near/485432463" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> drew <a href="https://roc-lang.github.io/zulip-export/stream/463736-bugs/topic/roc.20test.20crash.html#485432463">(Dec 01 2024 at 00:27)</a>:</h4>
<p>but weirdly the LSP now works</p>



<a name="485432474"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/463736-bugs/topic/roc%20test%20crash/near/485432474" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/463736-bugs/topic/roc.20test.20crash.html#485432474">(Dec 01 2024 at 00:27)</a>:</h4>
<p>Take that as a win I guess</p>



<a name="485432480"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/463736-bugs/topic/roc%20test%20crash/near/485432480" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/463736-bugs/topic/roc.20test.20crash.html#485432480">(Dec 01 2024 at 00:27)</a>:</h4>
<p>I’m less worried about the single file chdckt</p>



<a name="485432486"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/463736-bugs/topic/roc%20test%20crash/near/485432486" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/463736-bugs/topic/roc.20test.20crash.html#485432486">(Dec 01 2024 at 00:27)</a>:</h4>
<p>I’m less worried about the single file check</p>



<a name="485432532"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/463736-bugs/topic/roc%20test%20crash/near/485432532" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/463736-bugs/topic/roc.20test.20crash.html#485432532">(Dec 01 2024 at 00:28)</a>:</h4>
<p>But the LSP working is inportant</p>



<a name="485432534"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/463736-bugs/topic/roc%20test%20crash/near/485432534" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> drew <a href="https://roc-lang.github.io/zulip-export/stream/463736-bugs/topic/roc.20test.20crash.html#485432534">(Dec 01 2024 at 00:28)</a>:</h4>
<p><code>roc check</code> does work</p>



<a name="485432536"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/463736-bugs/topic/roc%20test%20crash/near/485432536" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> drew <a href="https://roc-lang.github.io/zulip-export/stream/463736-bugs/topic/roc.20test.20crash.html#485432536">(Dec 01 2024 at 00:28)</a>:</h4>
<p>with no arguments</p>



<a name="485432545"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/463736-bugs/topic/roc%20test%20crash/near/485432545" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/463736-bugs/topic/roc.20test.20crash.html#485432545">(Dec 01 2024 at 00:28)</a>:</h4>
<p>Yes because main.roc probably uses a platform import</p>



<a name="485432551"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/463736-bugs/topic/roc%20test%20crash/near/485432551" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> drew <a href="https://roc-lang.github.io/zulip-export/stream/463736-bugs/topic/roc.20test.20crash.html#485432551">(Dec 01 2024 at 00:28)</a>:</h4>
<p>actually <code>roc check</code> works before any changes</p>



<a name="485432596"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/463736-bugs/topic/roc%20test%20crash/near/485432596" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/463736-bugs/topic/roc.20test.20crash.html#485432596">(Dec 01 2024 at 00:29)</a>:</h4>
<p>Yes</p>



<a name="485432655"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/463736-bugs/topic/roc%20test%20crash/near/485432655" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/463736-bugs/topic/roc.20test.20crash.html#485432655">(Dec 01 2024 at 00:30)</a>:</h4>
<p>During a run of check _something_ has to import from platform</p>



<a name="485432675"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/463736-bugs/topic/roc%20test%20crash/near/485432675" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/463736-bugs/topic/roc.20test.20crash.html#485432675">(Dec 01 2024 at 00:30)</a>:</h4>
<p>That’s the bug I’m trying to fix</p>



<a name="485433968"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/463736-bugs/topic/roc%20test%20crash/near/485433968" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/463736-bugs/topic/roc.20test.20crash.html#485433968">(Dec 01 2024 at 00:55)</a>:</h4>
<p>I doubt I’ll have much time tonight to work on this, but if I have a commit with a fix, I’ll share the SHA here</p>



<a name="485437747"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/463736-bugs/topic/roc%20test%20crash/near/485437747" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/463736-bugs/topic/roc.20test.20crash.html#485437747">(Dec 01 2024 at 01:58)</a>:</h4>
<p>I think I have a fix</p>



<a name="485437753"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/463736-bugs/topic/roc%20test%20crash/near/485437753" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/463736-bugs/topic/roc.20test.20crash.html#485437753">(Dec 01 2024 at 01:58)</a>:</h4>
<p>Let me get a PR together</p>



<a name="485437951"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/463736-bugs/topic/roc%20test%20crash/near/485437951" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/463736-bugs/topic/roc.20test.20crash.html#485437951">(Dec 01 2024 at 02:01)</a>:</h4>
<p>Don't have time for that, here's a patch that you can git apply if you have a local repo:</p>
<div class="codehilite" data-code-language="Text only"><pre><span></span><code>diff --git a/crates/compiler/load_internal/src/file.rs b/crates/compiler/load_internal/src/file.rs
index ff7ce3a50c..ba8c47c95f 100644
--- a/crates/compiler/load_internal/src/file.rs
+++ b/crates/compiler/load_internal/src/file.rs
@@ -658,7 +658,7 @@ struct CanAndCon {
     module_docs: Option&lt;ModuleDocumentation&gt;,
 }

-#[derive(Debug)]
+#[derive(Debug, PartialEq, Eq)]
 enum PlatformPath&lt;'a&gt; {
     NotSpecified,
     Valid(To&lt;'a&gt;),
@@ -1141,7 +1141,6 @@ impl&lt;'a&gt; LoadStart&lt;'a&gt; {

         // Load the root module synchronously; we can't proceed until we have its id.
         let root_start_time = Instant::now();
-
         let load_result = load_filename(
             arena,
             filename.clone(),
@@ -1286,7 +1285,6 @@ fn handle_root_type&lt;'a&gt;(
                 if let (Some(main_path), Some(cache_dir)) = (main_path.clone(), cache_dir) {
                     let mut messages = Vec::with_capacity(4);
                     messages.push(header_output.msg);
-
                     load_packages_from_main(
                         arena,
                         src_dir.clone(),
@@ -2245,7 +2243,9 @@ fn update&lt;'a&gt;(

                     // If we're building an app module, and this was the platform
                     // specified in its header's `to` field, record it as our platform.
-                    if state.opt_platform_shorthand == Some(config_shorthand) {
+                    if state.opt_platform_shorthand == Some(config_shorthand)
+                        || state.platform_path == PlatformPath::RootIsModule
+                    {
                         debug_assert!(state.platform_data.is_none());

                         state.platform_data = Some(PlatformData {
@@ -2339,7 +2339,6 @@ fn update&lt;'a&gt;(
                 extend_module_with_builtin_import(parsed, ModuleId::INSPECT);
                 extend_module_with_builtin_import(parsed, ModuleId::TASK);
             }
-
             state
                 .module_cache
                 .imports
</code></pre></div>



<a name="485438182"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/463736-bugs/topic/roc%20test%20crash/near/485438182" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/463736-bugs/topic/roc.20test.20crash.html#485438182">(Dec 01 2024 at 02:05)</a>:</h4>
<p>Created a PR after all :-) <a href="https://github.com/roc-lang/roc/pull/7283">https://github.com/roc-lang/roc/pull/7283</a></p>



<a name="485438227"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/463736-bugs/topic/roc%20test%20crash/near/485438227" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/463736-bugs/topic/roc.20test.20crash.html#485438227">(Dec 01 2024 at 02:06)</a>:</h4>
<p>Going to run tests on it locally, pushed it up fast so you can test <span class="user-mention" data-user-id="463085">@drew</span></p>



<a name="485438258"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/463736-bugs/topic/roc%20test%20crash/near/485438258" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/463736-bugs/topic/roc.20test.20crash.html#485438258">(Dec 01 2024 at 02:06)</a>:</h4>
<p>But on my local I created your minimal repro and it is fixed.</p>



<a name="485438312"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/463736-bugs/topic/roc%20test%20crash/near/485438312" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> drew <a href="https://roc-lang.github.io/zulip-export/stream/463736-bugs/topic/roc.20test.20crash.html#485438312">(Dec 01 2024 at 02:07)</a>:</h4>
<p>nice!!</p>



<a name="485438315"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/463736-bugs/topic/roc%20test%20crash/near/485438315" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> drew <a href="https://roc-lang.github.io/zulip-export/stream/463736-bugs/topic/roc.20test.20crash.html#485438315">(Dec 01 2024 at 02:07)</a>:</h4>
<p>thanks <span aria-label="folded hands" class="emoji emoji-1f64f" role="img" title="folded hands">:folded_hands:</span></p>



<a name="485438321"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/463736-bugs/topic/roc%20test%20crash/near/485438321" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/463736-bugs/topic/roc.20test.20crash.html#485438321">(Dec 01 2024 at 02:07)</a>:</h4>
<p>I'm going to assume I've made a mistake here and some tests will fail, or it will fail on a larger test case.</p>



<a name="485438381"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/463736-bugs/topic/roc%20test%20crash/near/485438381" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/463736-bugs/topic/roc.20test.20crash.html#485438381">(Dec 01 2024 at 02:08)</a>:</h4>
<p><span class="user-mention" data-user-id="515757">@Luke Boswell</span> If you have a moment to take a look at that PR and see if there isn't something obvious I'm going to mess  up here?</p>



<a name="485438444"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/463736-bugs/topic/roc%20test%20crash/near/485438444" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/463736-bugs/topic/roc.20test.20crash.html#485438444">(Dec 01 2024 at 02:09)</a>:</h4>
<p>Do you have commit signing setup?</p>



<a name="485438496"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/463736-bugs/topic/roc%20test%20crash/near/485438496" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/463736-bugs/topic/roc.20test.20crash.html#485438496">(Dec 01 2024 at 02:10)</a>:</h4>
<p>I don't see anything obvious <span aria-label="smiley" class="emoji emoji-1f603" role="img" title="smiley">:smiley:</span></p>



<a name="485438505"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/463736-bugs/topic/roc%20test%20crash/near/485438505" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/463736-bugs/topic/roc.20test.20crash.html#485438505">(Dec 01 2024 at 02:10)</a>:</h4>
<p>Thanks for submitting this <span aria-label="heart" class="emoji emoji-2764" role="img" title="heart">:heart:</span></p>



<a name="485438643"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/463736-bugs/topic/roc%20test%20crash/near/485438643" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/463736-bugs/topic/roc.20test.20crash.html#485438643">(Dec 01 2024 at 02:12)</a>:</h4>
<p>I’m not setup for it, but I can of needed</p>



<a name="485438645"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/463736-bugs/topic/roc%20test%20crash/near/485438645" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/463736-bugs/topic/roc.20test.20crash.html#485438645">(Dec 01 2024 at 02:12)</a>:</h4>
<p>If needed.</p>



<a name="485438672"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/463736-bugs/topic/roc%20test%20crash/near/485438672" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/463736-bugs/topic/roc.20test.20crash.html#485438672">(Dec 01 2024 at 02:13)</a>:</h4>
<p>I’m waiting for my test run locally to complete</p>



<a name="485438691"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/463736-bugs/topic/roc%20test%20crash/near/485438691" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/463736-bugs/topic/roc.20test.20crash.html#485438691">(Dec 01 2024 at 02:13)</a>:</h4>
<p>We can only have a single platform right?</p>



<a name="485438703"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/463736-bugs/topic/roc%20test%20crash/near/485438703" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/463736-bugs/topic/roc.20test.20crash.html#485438703">(Dec 01 2024 at 02:13)</a>:</h4>
<p>Yeah that's correct</p>



<a name="485438841"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/463736-bugs/topic/roc%20test%20crash/near/485438841" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/463736-bugs/topic/roc.20test.20crash.html#485438841">(Dec 01 2024 at 02:16)</a>:</h4>
<p>This was so much easier than it looked at first</p>



<a name="485438933"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/463736-bugs/topic/roc%20test%20crash/near/485438933" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/463736-bugs/topic/roc.20test.20crash.html#485438933">(Dec 01 2024 at 02:17)</a>:</h4>
<p>So if we have <code>PlatformPath::RootIsModule</code> we give it a fake <code>platform_data</code>?</p>



<a name="485438940"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/463736-bugs/topic/roc%20test%20crash/near/485438940" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/463736-bugs/topic/roc.20test.20crash.html#485438940">(Dec 01 2024 at 02:17)</a>:</h4>
<p>Is that basically all it was?</p>



<a name="485439137"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/463736-bugs/topic/roc%20test%20crash/near/485439137" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/463736-bugs/topic/roc.20test.20crash.html#485439137">(Dec 01 2024 at 02:20)</a>:</h4>
<p>No I’d root is module we give it the actual platform data from the platform found in main.roc</p>



<a name="485439143"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/463736-bugs/topic/roc%20test%20crash/near/485439143" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/463736-bugs/topic/roc.20test.20crash.html#485439143">(Dec 01 2024 at 02:20)</a>:</h4>
<p>*if root is</p>



<a name="485439150"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/463736-bugs/topic/roc%20test%20crash/near/485439150" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/463736-bugs/topic/roc.20test.20crash.html#485439150">(Dec 01 2024 at 02:21)</a>:</h4>
<p>Sorry on my phone , can’t edit</p>



<a name="485439245"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/463736-bugs/topic/roc%20test%20crash/near/485439245" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/463736-bugs/topic/roc.20test.20crash.html#485439245">(Dec 01 2024 at 02:22)</a>:</h4>
<p>Nice, works well</p>



<a name="485439589"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/463736-bugs/topic/roc%20test%20crash/near/485439589" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/463736-bugs/topic/roc.20test.20crash.html#485439589">(Dec 01 2024 at 02:29)</a>:</h4>
<p>If you need to sign the commit let me know and I’ll try to get that done tonight</p>



<a name="485440582"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/463736-bugs/topic/roc%20test%20crash/near/485440582" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/463736-bugs/topic/roc.20test.20crash.html#485440582">(Dec 01 2024 at 02:46)</a>:</h4>
<p>We can merge this one I think. But if you plan on contributing more, please set it up when you can <span aria-label="smiley" class="emoji emoji-1f603" role="img" title="smiley">:smiley:</span></p>



<a name="485445160"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/463736-bugs/topic/roc%20test%20crash/near/485445160" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/463736-bugs/topic/roc.20test.20crash.html#485445160">(Dec 01 2024 at 04:08)</a>:</h4>
<p>All tests passed locally</p>



<a name="485447312"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/463736-bugs/topic/roc%20test%20crash/near/485447312" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> drew <a href="https://roc-lang.github.io/zulip-export/stream/463736-bugs/topic/roc.20test.20crash.html#485447312">(Dec 01 2024 at 04:48)</a>:</h4>
<p>thanks for fixing and merging this! much appreciated.</p>



<hr><p>Last updated: Mar 01 2026 at 12:20 UTC</p>
</html>