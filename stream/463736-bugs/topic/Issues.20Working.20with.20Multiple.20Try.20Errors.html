<html>
<head><meta charset="utf-8"><title>Issues Working with Multiple Try Errors · bugs · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://roc-lang.github.io/zulip-export/stream/463736-bugs/index.html">bugs</a></h2>
<h3>Topic: <a href="https://roc-lang.github.io/zulip-export/stream/463736-bugs/topic/Issues.20Working.20with.20Multiple.20Try.20Errors.html">Issues Working with Multiple Try Errors</a></h3>

<hr>

<base href="https://roc.zulipchat.com">

<head><link href="https://roc-lang.github.io/zulip-export/style.css" rel="stylesheet"></head>

<a name="561312276"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/463736-bugs/topic/Issues%20Working%20with%20Multiple%20Try%20Errors/near/561312276" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Edwin Santos <a href="https://roc-lang.github.io/zulip-export/stream/463736-bugs/topic/Issues.20Working.20with.20Multiple.20Try.20Errors.html#561312276">(Dec 02 2025 at 02:17)</a>:</h4>
<p>Hi, for today's AoC I tried creating the following small function</p>
<div class="codehilite"><pre><span></span><code>parse_direction : Str -&gt; Try(I64, [RotationIsNotLR, BadNumStr])
parse_direction = |string| {
    if string.starts_with(&quot;L&quot;) {
        parse_attempt = string.drop_prefix(&quot;L&quot;) -&gt; I64.from_str
        l_result = map_ok(parse_attempt, |n| n*-1)?
        Ok(l_result)
    } else if string.starts_with(&quot;R&quot;) {
        parse_attempt = string.drop_prefix(&quot;R&quot;) -&gt; I64.from_str
        r_result = parse_attempt?
        Ok(r_result)
    } else {
        Err(RotationIsNotLR)
    }
}
</code></pre></div>
<p>which looks like it should simply propagate the parse errors up to the error set and then keep moving forward. However the compiler actually gives me the following type error:</p>
<div class="codehilite"><pre><span></span><code>-- TYPE MISMATCH ---------------------------------

This expression is used in an unexpected way:
     ┌─ aoc_2025_01.roc:4479:20
     │
4479 │         l_result = map_ok(parse_attempt, |n| n*-1)?
     │                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

It has the type:
    [Err([BadNumStr])][Ok(I64)]

But I expected it to be:
    Try(I64, [BadNumStr, RotationIsNotLR])
</code></pre></div>
<p>So it seems like ? is having trouble correctly converting the original error to the expanded error set. If resolving this isn't too crazy I can also take a crack at the issue tomorrow.</p>



<a name="561312853"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/463736-bugs/topic/Issues%20Working%20with%20Multiple%20Try%20Errors/near/561312853" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/463736-bugs/topic/Issues.20Working.20with.20Multiple.20Try.20Errors.html#561312853">(Dec 02 2025 at 02:24)</a>:</h4>
<p>I can take a look at it tonight, thanks for the reproduction!</p>



<a name="561314263"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/463736-bugs/topic/Issues%20Working%20with%20Multiple%20Try%20Errors/near/561314263" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Edwin Santos <a href="https://roc-lang.github.io/zulip-export/stream/463736-bugs/topic/Issues.20Working.20with.20Multiple.20Try.20Errors.html#561314263">(Dec 02 2025 at 02:42)</a>:</h4>
<p>Yup, also uses map_ok (I'll put a PR up once I've finished up snapshot tests):</p>
<div class="codehilite"><pre><span></span><code>        map_ok : Try(a, err), (a -&gt; b) -&gt; Try(b, err)
        map_ok = |try, fn| {
            match try {
            Ok(ok_val) =&gt; Ok(fn(ok_val))
            Err(e) =&gt; Err(e)
            }
        }
</code></pre></div>



<hr><p>Last updated: Mar 01 2026 at 12:20 UTC</p>
</html>