<html>
<head><meta charset="utf-8"><title>✔ effectful functions cannot be stored in a record with PI · bugs · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://roc-lang.github.io/zulip-export/stream/463736-bugs/index.html">bugs</a></h2>
<h3>Topic: <a href="https://roc-lang.github.io/zulip-export/stream/463736-bugs/topic/.E2.9C.94.20effectful.20functions.20cannot.20be.20stored.20in.20a.20record.20with.20PI.html">✔ effectful functions cannot be stored in a record with PI</a></h3>

<hr>

<base href="https://roc.zulipchat.com">

<head><link href="https://roc-lang.github.io/zulip-export/style.css" rel="stylesheet"></head>

<a name="492172050"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/463736-bugs/topic/%E2%9C%94%20effectful%20functions%20cannot%20be%20stored%20in%20a%20record%20with%20PI/near/492172050" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ian McLerran <a href="https://roc-lang.github.io/zulip-export/stream/463736-bugs/topic/.E2.9C.94.20effectful.20functions.20cannot.20be.20stored.20in.20a.20record.20with.20PI.html#492172050">(Jan 06 2025 at 19:46)</a>:</h4>
<p><code>a Expr::TrySuffix expression was not completely removed in desugar_value_def_suffixed</code></p>
<p>So after stripping down all my effectful <code>if then else</code> blocks to dummy blocks to eliminate the <a href="#narrow/channel/463736-bugs/topic/.E2.9C.94.20Value.20defined.20in.20prior.20line.20not.20recognized.20in.20function.20.2E.2E.2E">stack overflow issue</a> (seems to have been in the <code>fileTreeHelper!</code> if block), I have encountered a new bug, as listed at the top of this post.</p>
<p>Wondering if it could have to do with using <code>!</code> at the end of a record field name? (I have records which contain one effectful function as a field.)</p>



<a name="492172530"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/463736-bugs/topic/%E2%9C%94%20effectful%20functions%20cannot%20be%20stored%20in%20a%20record%20with%20PI/near/492172530" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ian McLerran <a href="https://roc-lang.github.io/zulip-export/stream/463736-bugs/topic/.E2.9C.94.20effectful.20functions.20cannot.20be.20stored.20in.20a.20record.20with.20PI.html#492172530">(Jan 06 2025 at 19:49)</a>:</h4>
<p>Can confirm. When I eliminate the records which contain the field name ending in <code>!</code>, this error is resolved.</p>



<a name="492173008"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/463736-bugs/topic/%E2%9C%94%20effectful%20functions%20cannot%20be%20stored%20in%20a%20record%20with%20PI/near/492173008" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ian McLerran <a href="https://roc-lang.github.io/zulip-export/stream/463736-bugs/topic/.E2.9C.94.20effectful.20functions.20cannot.20be.20stored.20in.20a.20record.20with.20PI.html#492173008">(Jan 06 2025 at 19:52)</a>:</h4>
<p>The records look like this:</p>
<div class="codehilite" data-code-language="CoffeeScript"><pre><span></span><code><span class="nv">readFileContents</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nv">name</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="nx">Str</span><span class="p">,</span><span class="w"> </span><span class="nx">handler</span><span class="o">!</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="nx">Str</span><span class="w"> </span><span class="nf">=&gt;</span><span class="w"> </span><span class="nx">Result</span><span class="w"> </span><span class="nx">Str</span><span class="w"> </span><span class="o">*</span><span class="p">,</span><span class="w"> </span><span class="nv">tool</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="nx">Tool</span><span class="w"> </span><span class="p">}</span>
<span class="nv">readFileContents</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nv">name</span><span class="o">:</span><span class="w"> </span><span class="nx">readFileContentsTool</span><span class="p">.</span><span class="nx">function</span><span class="p">.</span><span class="nx">name</span><span class="p">,</span>
<span class="w">    </span><span class="nx">handler</span><span class="o">!:</span><span class="w"> </span><span class="nx">readFileContentsHandler</span><span class="o">!</span><span class="p">,</span>
<span class="w">    </span><span class="nv">tool</span><span class="o">:</span><span class="w"> </span><span class="nx">readFileContentsTool</span><span class="p">,</span>
<span class="p">}</span>
</code></pre></div>



<a name="492173129"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/463736-bugs/topic/%E2%9C%94%20effectful%20functions%20cannot%20be%20stored%20in%20a%20record%20with%20PI/near/492173129" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ian McLerran <a href="https://roc-lang.github.io/zulip-export/stream/463736-bugs/topic/.E2.9C.94.20effectful.20functions.20cannot.20be.20stored.20in.20a.20record.20with.20PI.html#492173129">(Jan 06 2025 at 19:53)</a>:</h4>
<p>However, if I simply rename the <code>handler!</code> field to <code>handler</code>, the same error is encountered, presumably due to assigning an effectful function to the field.</p>



<a name="492173304"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/463736-bugs/topic/%E2%9C%94%20effectful%20functions%20cannot%20be%20stored%20in%20a%20record%20with%20PI/near/492173304" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ian McLerran <a href="https://roc-lang.github.io/zulip-export/stream/463736-bugs/topic/.E2.9C.94.20effectful.20functions.20cannot.20be.20stored.20in.20a.20record.20with.20PI.html#492173304">(Jan 06 2025 at 19:54)</a>:</h4>
<p>So this record still encounters the bug:</p>
<div class="codehilite" data-code-language="CoffeeScript"><pre><span></span><code><span class="nv">readFileContents</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nv">name</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="nx">Str</span><span class="p">,</span><span class="w"> </span><span class="nv">handler</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="nx">Str</span><span class="w"> </span><span class="nf">=&gt;</span><span class="w"> </span><span class="nx">Result</span><span class="w"> </span><span class="nx">Str</span><span class="w"> </span><span class="o">*</span><span class="p">,</span><span class="w"> </span><span class="nv">tool</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="nx">Tool</span><span class="w"> </span><span class="p">}</span>
<span class="nv">readFileContents</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nv">name</span><span class="o">:</span><span class="w"> </span><span class="nx">readFileContentsTool</span><span class="p">.</span><span class="nx">function</span><span class="p">.</span><span class="nx">name</span><span class="p">,</span>
<span class="w">    </span><span class="nv">handler</span><span class="o">:</span><span class="w"> </span><span class="nx">readFileContentsHandler</span><span class="o">!</span><span class="p">,</span>
<span class="w">    </span><span class="nv">tool</span><span class="o">:</span><span class="w"> </span><span class="nx">readFileContentsTool</span><span class="p">,</span>
<span class="p">}</span>
</code></pre></div>



<a name="492173829"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/463736-bugs/topic/%E2%9C%94%20effectful%20functions%20cannot%20be%20stored%20in%20a%20record%20with%20PI/near/492173829" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ian McLerran <a href="https://roc-lang.github.io/zulip-export/stream/463736-bugs/topic/.E2.9C.94.20effectful.20functions.20cannot.20be.20stored.20in.20a.20record.20with.20PI.html#492173829">(Jan 06 2025 at 19:57)</a>:</h4>
<p><a href="https://github.com/imclerran/roc-ai/tree/desugar-suffixed-bug">https://github.com/imclerran/roc-ai/tree/desugar-suffixed-bug</a></p>



<a name="492179175"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/463736-bugs/topic/%E2%9C%94%20effectful%20functions%20cannot%20be%20stored%20in%20a%20record%20with%20PI/near/492179175" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ian McLerran <a href="https://roc-lang.github.io/zulip-export/stream/463736-bugs/topic/.E2.9C.94.20effectful.20functions.20cannot.20be.20stored.20in.20a.20record.20with.20PI.html#492179175">(Jan 06 2025 at 20:29)</a>:</h4>
<p>Okay, while trying to make a min-repro, I have semi disproven my hypothesis for the cause of the bug...</p>



<a name="492179616"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/463736-bugs/topic/%E2%9C%94%20effectful%20functions%20cannot%20be%20stored%20in%20a%20record%20with%20PI/near/492179616" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ian McLerran <a href="https://roc-lang.github.io/zulip-export/stream/463736-bugs/topic/.E2.9C.94.20effectful.20functions.20cannot.20be.20stored.20in.20a.20record.20with.20PI.html#492179616">(Jan 06 2025 at 20:32)</a>:</h4>
<p>Since the following works:</p>
<div class="codehilite" data-code-language="CoffeeScript"><pre><span></span><code><span class="nx">main</span><span class="o">!</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="err">\</span><span class="nx">_args</span><span class="w"> </span><span class="nf">-&gt;</span>
<span class="w">    </span><span class="k">try</span><span class="w"> </span><span class="nx">effects</span><span class="p">.</span><span class="nx">echo</span><span class="o">!</span><span class="w"> </span><span class="s">"Hello, world!"</span>
<span class="w">    </span><span class="nx">Ok</span><span class="w"> </span><span class="p">{}</span>

<span class="nv">effects</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">echo</span><span class="o">!:</span><span class="w"> </span><span class="nx">Str</span><span class="w"> </span><span class="nf">=&gt;</span><span class="w"> </span><span class="nx">Result</span><span class="w"> </span><span class="p">{}</span><span class="w"> </span><span class="nx">_</span><span class="w"> </span><span class="p">}</span>
<span class="nv">effects</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">echo</span><span class="o">!:</span><span class="w"> </span><span class="nx">Stdout</span><span class="p">.</span><span class="nx">line</span><span class="o">!</span><span class="p">,</span>
<span class="p">}</span>
</code></pre></div>



<a name="492179809"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/463736-bugs/topic/%E2%9C%94%20effectful%20functions%20cannot%20be%20stored%20in%20a%20record%20with%20PI/near/492179809" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/463736-bugs/topic/.E2.9C.94.20effectful.20functions.20cannot.20be.20stored.20in.20a.20record.20with.20PI.html#492179809">(Jan 06 2025 at 20:33)</a>:</h4>
<p>We parse differently if the module is purity inference or Task based</p>



<a name="492180027"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/463736-bugs/topic/%E2%9C%94%20effectful%20functions%20cannot%20be%20stored%20in%20a%20record%20with%20PI/near/492180027" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ian McLerran <a href="https://roc-lang.github.io/zulip-export/stream/463736-bugs/topic/.E2.9C.94.20effectful.20functions.20cannot.20be.20stored.20in.20a.20record.20with.20PI.html#492180027">(Jan 06 2025 at 20:34)</a>:</h4>
<p>Both of these examples should be PI based... unless there's something I'm missing in the original module that is triggering it to treat it as non-pi...</p>



<a name="492180153"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/463736-bugs/topic/%E2%9C%94%20effectful%20functions%20cannot%20be%20stored%20in%20a%20record%20with%20PI/near/492180153" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ian McLerran <a href="https://roc-lang.github.io/zulip-export/stream/463736-bugs/topic/.E2.9C.94.20effectful.20functions.20cannot.20be.20stored.20in.20a.20record.20with.20PI.html#492180153">(Jan 06 2025 at 20:35)</a>:</h4>
<p>The code worked fine in my original non-pi version.</p>



<a name="492180230"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/463736-bugs/topic/%E2%9C%94%20effectful%20functions%20cannot%20be%20stored%20in%20a%20record%20with%20PI/near/492180230" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/463736-bugs/topic/.E2.9C.94.20effectful.20functions.20cannot.20be.20stored.20in.20a.20record.20with.20PI.html#492180230">(Jan 06 2025 at 20:35)</a>:</h4>
<p>So if your module exposed an ident with a ! at the end, it parses as PI</p>



<a name="492180238"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/463736-bugs/topic/%E2%9C%94%20effectful%20functions%20cannot%20be%20stored%20in%20a%20record%20with%20PI/near/492180238" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/463736-bugs/topic/.E2.9C.94.20effectful.20functions.20cannot.20be.20stored.20in.20a.20record.20with.20PI.html#492180238">(Jan 06 2025 at 20:35)</a>:</h4>
<p>If not, Task</p>



<a name="492180378"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/463736-bugs/topic/%E2%9C%94%20effectful%20functions%20cannot%20be%20stored%20in%20a%20record%20with%20PI/near/492180378" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/463736-bugs/topic/.E2.9C.94.20effectful.20functions.20cannot.20be.20stored.20in.20a.20record.20with.20PI.html#492180378">(Jan 06 2025 at 20:36)</a>:</h4>
<p>So what does your module expose?</p>



<a name="492180396"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/463736-bugs/topic/%E2%9C%94%20effectful%20functions%20cannot%20be%20stored%20in%20a%20record%20with%20PI/near/492180396" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ian McLerran <a href="https://roc-lang.github.io/zulip-export/stream/463736-bugs/topic/.E2.9C.94.20effectful.20functions.20cannot.20be.20stored.20in.20a.20record.20with.20PI.html#492180396">(Jan 06 2025 at 20:36)</a>:</h4>
<p>Ah.... it exposes a record which DOES NOT have a <code>!</code> at the end, but the record contains an ident ending in <code>!</code>. That must be the issue.</p>



<a name="492180697"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/463736-bugs/topic/%E2%9C%94%20effectful%20functions%20cannot%20be%20stored%20in%20a%20record%20with%20PI/near/492180697" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ian McLerran <a href="https://roc-lang.github.io/zulip-export/stream/463736-bugs/topic/.E2.9C.94.20effectful.20functions.20cannot.20be.20stored.20in.20a.20record.20with.20PI.html#492180697">(Jan 06 2025 at 20:38)</a>:</h4>
<p>My module exposes 4 records with the same type as:</p>
<div class="codehilite" data-code-language="CoffeeScript"><pre><span></span><code><span class="nv">readFileContents</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nv">name</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="nx">Str</span><span class="p">,</span><span class="w"> </span><span class="nx">handler</span><span class="o">!</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="nx">Str</span><span class="w"> </span><span class="nf">=&gt;</span><span class="w"> </span><span class="nx">Result</span><span class="w"> </span><span class="nx">Str</span><span class="w"> </span><span class="o">*</span><span class="p">,</span><span class="w"> </span><span class="nv">tool</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="nx">Tool</span><span class="w"> </span><span class="p">}</span>
</code></pre></div>
<p>They all contain <code>handler</code>, but none of the record names themselves were named with a <code>!</code> since the records have both the effectful field, and idents which are not effectful.</p>



<a name="492180835"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/463736-bugs/topic/%E2%9C%94%20effectful%20functions%20cannot%20be%20stored%20in%20a%20record%20with%20PI/near/492180835" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ian McLerran <a href="https://roc-lang.github.io/zulip-export/stream/463736-bugs/topic/.E2.9C.94.20effectful.20functions.20cannot.20be.20stored.20in.20a.20record.20with.20PI.html#492180835">(Jan 06 2025 at 20:39)</a>:</h4>
<p>Let me just expose the handlers themselves as well. Sounds like that should trigger PI parsing.</p>



<a name="492181349"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/463736-bugs/topic/%E2%9C%94%20effectful%20functions%20cannot%20be%20stored%20in%20a%20record%20with%20PI/near/492181349" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ian McLerran <a href="https://roc-lang.github.io/zulip-export/stream/463736-bugs/topic/.E2.9C.94.20effectful.20functions.20cannot.20be.20stored.20in.20a.20record.20with.20PI.html#492181349">(Jan 06 2025 at 20:43)</a>:</h4>
<p>Yep, if I expose the <code>readFileContentsHandler!</code> in addition to my records, the module parses without issue. I wonder if lack of PI parsing was the reason I hit the stack overflow in the last bug...? <span aria-label="thinking" class="emoji emoji-1f914" role="img" title="thinking">:thinking:</span></p>



<a name="492182033"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/463736-bugs/topic/%E2%9C%94%20effectful%20functions%20cannot%20be%20stored%20in%20a%20record%20with%20PI/near/492182033" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/463736-bugs/topic/.E2.9C.94.20effectful.20functions.20cannot.20be.20stored.20in.20a.20record.20with.20PI.html#492182033">(Jan 06 2025 at 20:47)</a>:</h4>
<p>I'm 99% sure the answer is no</p>



<a name="492182227"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/463736-bugs/topic/%E2%9C%94%20effectful%20functions%20cannot%20be%20stored%20in%20a%20record%20with%20PI/near/492182227" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ian McLerran <a href="https://roc-lang.github.io/zulip-export/stream/463736-bugs/topic/.E2.9C.94.20effectful.20functions.20cannot.20be.20stored.20in.20a.20record.20with.20PI.html#492182227">(Jan 06 2025 at 20:48)</a>:</h4>
<p>Well I was using PI syntax, and we know now it wasn't parsing as PI, so that was bound to cause some kind of issues...</p>



<a name="492182684"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/463736-bugs/topic/%E2%9C%94%20effectful%20functions%20cannot%20be%20stored%20in%20a%20record%20with%20PI/near/492182684" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ian McLerran <a href="https://roc-lang.github.io/zulip-export/stream/463736-bugs/topic/.E2.9C.94.20effectful.20functions.20cannot.20be.20stored.20in.20a.20record.20with.20PI.html#492182684">(Jan 06 2025 at 20:51)</a>:</h4>
<p>Interesting. I created what I thought would be a min repro of this issue, but it parses correctly:<br>
<strong>main.roc</strong></p>
<div class="codehilite" data-code-language="CoffeeScript"><pre><span></span><code><span class="nx">app</span><span class="w"> </span><span class="p">[</span><span class="nx">main</span><span class="o">!</span><span class="p">]</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nv">cli</span><span class="o">:</span><span class="w"> </span><span class="nx">platform</span><span class="w"> </span><span class="s">"https://github.com/roc-lang/basic-cli/releases/download/0.18.0/0APbwVN1_p1mJ96tXjaoiUCr8NBGamr8G8Ac_DrXR-o.tar.br"</span><span class="p">,</span>
<span class="p">}</span>

<span class="nx">import</span><span class="w"> </span><span class="nx">cli</span><span class="p">.</span><span class="nx">Stdout</span>
<span class="nx">import</span><span class="w"> </span><span class="nx">Module</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">echo</span><span class="o">!:</span><span class="w"> </span><span class="nx">Stdout</span><span class="p">.</span><span class="nx">line</span><span class="o">!</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="nx">exposing</span><span class="w"> </span><span class="p">[</span><span class="nx">effects</span><span class="p">]</span>

<span class="nx">main</span><span class="o">!</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="err">\</span><span class="nx">_args</span><span class="w"> </span><span class="nf">-&gt;</span>
<span class="w">    </span><span class="k">try</span><span class="w"> </span><span class="nx">effects</span><span class="p">.</span><span class="nx">echo</span><span class="o">!</span><span class="w"> </span><span class="s">"Hello, world!"</span>
<span class="w">    </span><span class="nx">Ok</span><span class="w"> </span><span class="p">{}</span>
</code></pre></div>
<p><strong>Module.roc</strong></p>
<div class="codehilite" data-code-language="CoffeeScript"><pre><span></span><code><span class="nx">module</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">stdout</span><span class="o">!</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="nf">-&gt;</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="nx">effects</span><span class="w"> </span><span class="p">]</span>

<span class="nv">effects</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">echo</span><span class="o">!:</span><span class="w"> </span><span class="nx">Str</span><span class="w"> </span><span class="nf">=&gt;</span><span class="w"> </span><span class="nx">Result</span><span class="w"> </span><span class="p">{}</span><span class="w"> </span><span class="nx">_</span><span class="w"> </span><span class="p">}</span>
<span class="nv">effects</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">echo</span><span class="o">!:</span><span class="w"> </span><span class="nx">stdout</span><span class="o">!</span><span class="p">,</span>
<span class="p">}</span>
</code></pre></div>



<a name="492182811"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/463736-bugs/topic/%E2%9C%94%20effectful%20functions%20cannot%20be%20stored%20in%20a%20record%20with%20PI/near/492182811" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ian McLerran <a href="https://roc-lang.github.io/zulip-export/stream/463736-bugs/topic/.E2.9C.94.20effectful.20functions.20cannot.20be.20stored.20in.20a.20record.20with.20PI.html#492182811">(Jan 06 2025 at 20:52)</a>:</h4>
<p>More investigation required. But I can say that in my large code file, simply exposing a single ident ending in <code>!</code> resolves the issue.</p>



<a name="492183340"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/463736-bugs/topic/%E2%9C%94%20effectful%20functions%20cannot%20be%20stored%20in%20a%20record%20with%20PI/near/492183340" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ian McLerran <a href="https://roc-lang.github.io/zulip-export/stream/463736-bugs/topic/.E2.9C.94.20effectful.20functions.20cannot.20be.20stored.20in.20a.20record.20with.20PI.html#492183340">(Jan 06 2025 at 20:55)</a>:</h4>
<p>Ah, but - if I simply <code>roc check Module.roc</code> I do hit a broken compiler expectation. However it is a different error than my original bug here.</p>



<a name="492183391"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/463736-bugs/topic/%E2%9C%94%20effectful%20functions%20cannot%20be%20stored%20in%20a%20record%20with%20PI/near/492183391" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ian McLerran <a href="https://roc-lang.github.io/zulip-export/stream/463736-bugs/topic/.E2.9C.94.20effectful.20functions.20cannot.20be.20stored.20in.20a.20record.20with.20PI.html#492183391">(Jan 06 2025 at 20:55)</a>:</h4>
<p>Even though running main.roc in the min repro compiles and runs.</p>



<a name="492183529"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/463736-bugs/topic/%E2%9C%94%20effectful%20functions%20cannot%20be%20stored%20in%20a%20record%20with%20PI/near/492183529" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/463736-bugs/topic/.E2.9C.94.20effectful.20functions.20cannot.20be.20stored.20in.20a.20record.20with.20PI.html#492183529">(Jan 06 2025 at 20:56)</a>:</h4>
<p>The code that caused the overflow is known to be fragile. If we weren't planning on removing it, I'd be trying to investigate it more</p>



<a name="492183552"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/463736-bugs/topic/%E2%9C%94%20effectful%20functions%20cannot%20be%20stored%20in%20a%20record%20with%20PI/near/492183552" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/463736-bugs/topic/.E2.9C.94.20effectful.20functions.20cannot.20be.20stored.20in.20a.20record.20with.20PI.html#492183552">(Jan 06 2025 at 20:56)</a>:</h4>
<p>We really want to avoid ever crashing</p>



<a name="492183587"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/463736-bugs/topic/%E2%9C%94%20effectful%20functions%20cannot%20be%20stored%20in%20a%20record%20with%20PI/near/492183587" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/463736-bugs/topic/.E2.9C.94.20effectful.20functions.20cannot.20be.20stored.20in.20a.20record.20with.20PI.html#492183587">(Jan 06 2025 at 20:57)</a>:</h4>
<p>Luckily, I don't think it's a problem outside of the case you're in</p>



<a name="492185532"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/463736-bugs/topic/%E2%9C%94%20effectful%20functions%20cannot%20be%20stored%20in%20a%20record%20with%20PI/near/492185532" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ian McLerran <a href="https://roc-lang.github.io/zulip-export/stream/463736-bugs/topic/.E2.9C.94.20effectful.20functions.20cannot.20be.20stored.20in.20a.20record.20with.20PI.html#492185532">(Jan 06 2025 at 21:08)</a>:</h4>
<p>Well it turns out the only reason the stack overflow is hit at all is because the module isn't being parsed as PI. If the parser recognizes the file as PI, the code is now 100% correct.</p>



<a name="492185659"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/463736-bugs/topic/%E2%9C%94%20effectful%20functions%20cannot%20be%20stored%20in%20a%20record%20with%20PI/near/492185659" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/463736-bugs/topic/.E2.9C.94.20effectful.20functions.20cannot.20be.20stored.20in.20a.20record.20with.20PI.html#492185659">(Jan 06 2025 at 21:09)</a>:</h4>
<p>Yes</p>



<a name="492185853"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/463736-bugs/topic/%E2%9C%94%20effectful%20functions%20cannot%20be%20stored%20in%20a%20record%20with%20PI/near/492185853" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ian McLerran <a href="https://roc-lang.github.io/zulip-export/stream/463736-bugs/topic/.E2.9C.94.20effectful.20functions.20cannot.20be.20stored.20in.20a.20record.20with.20PI.html#492185853">(Jan 06 2025 at 21:11)</a>:</h4>
<p>Raises the question of why this parses correctly:</p>
<div class="codehilite" data-code-language="CoffeeScript"><pre><span></span><code><span class="nx">module</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">stdout</span><span class="o">!</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="nf">-&gt;</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="nx">effects</span><span class="w"> </span><span class="p">]</span>

<span class="nv">effects</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">echo</span><span class="o">!:</span><span class="w"> </span><span class="nx">Str</span><span class="w"> </span><span class="nf">=&gt;</span><span class="w"> </span><span class="nx">Result</span><span class="w"> </span><span class="p">{}</span><span class="w"> </span><span class="nx">_</span><span class="w"> </span><span class="p">}</span>
<span class="nv">effects</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">echo</span><span class="o">!:</span><span class="w"> </span><span class="nx">stdout</span><span class="o">!</span><span class="p">,</span>
<span class="p">}</span>
</code></pre></div>
<p>but why I have to expose <code>listDirectoryHandler!</code> in FileSystem.roc for the code to parse as PI...</p>
<div class="codehilite" data-code-language="CoffeeScript"><pre><span></span><code><span class="nx">module</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">pathFromStr</span><span class="p">,</span><span class="w"> </span><span class="nx">pathToStr</span><span class="p">,</span><span class="w"> </span><span class="nx">listDir</span><span class="o">!</span><span class="p">,</span><span class="w"> </span><span class="nx">isDir</span><span class="o">!</span><span class="p">,</span><span class="w"> </span><span class="nx">readFile</span><span class="o">!</span><span class="p">,</span><span class="w"> </span><span class="nx">writeUtf8</span><span class="o">!</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="nf">-&gt;</span><span class="w"> </span><span class="p">[</span>
<span class="w">    </span><span class="nx">listDirectory</span><span class="p">,</span>
<span class="w">    </span><span class="c1">#listDirectoryHandler!,</span>
<span class="w">    </span><span class="nx">listFileTree</span><span class="p">,</span>
<span class="w">    </span><span class="nx">readFileContents</span><span class="p">,</span>
<span class="w">    </span><span class="nx">writeFileContents</span><span class="p">,</span>
<span class="p">]</span>

<span class="nv">listDirectory</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nv">name</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="nx">Str</span><span class="p">,</span><span class="w"> </span><span class="nx">handler</span><span class="o">!</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="nx">Str</span><span class="w"> </span><span class="nf">=&gt;</span><span class="w"> </span><span class="nx">Result</span><span class="w"> </span><span class="nx">Str</span><span class="w"> </span><span class="o">*</span><span class="p">,</span><span class="w"> </span><span class="nv">tool</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="nx">Tool</span><span class="w"> </span><span class="p">}</span>
<span class="c1">#...</span>
</code></pre></div>



<a name="492186203"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/463736-bugs/topic/%E2%9C%94%20effectful%20functions%20cannot%20be%20stored%20in%20a%20record%20with%20PI/near/492186203" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/463736-bugs/topic/.E2.9C.94.20effectful.20functions.20cannot.20be.20stored.20in.20a.20record.20with.20PI.html#492186203">(Jan 06 2025 at 21:13)</a>:</h4>
<p>It's not a parsing thing, it's a desugaring thing: <a href="https://github.com/roc-lang/roc/blob/a089cf2487d2cb5f1d977a2e01be5ab7b4de3275/crates/compiler/can/src/desugar.rs#L540">https://github.com/roc-lang/roc/blob/a089cf2487d2cb5f1d977a2e01be5ab7b4de3275/crates/compiler/can/src/desugar.rs#L540</a></p>



<a name="492186245"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/463736-bugs/topic/%E2%9C%94%20effectful%20functions%20cannot%20be%20stored%20in%20a%20record%20with%20PI/near/492186245" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/463736-bugs/topic/.E2.9C.94.20effectful.20functions.20cannot.20be.20stored.20in.20a.20record.20with.20PI.html#492186245">(Jan 06 2025 at 21:13)</a>:</h4>
<p>They parse the exact same</p>



<a name="492186349"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/463736-bugs/topic/%E2%9C%94%20effectful%20functions%20cannot%20be%20stored%20in%20a%20record%20with%20PI/near/492186349" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ian McLerran <a href="https://roc-lang.github.io/zulip-export/stream/463736-bugs/topic/.E2.9C.94.20effectful.20functions.20cannot.20be.20stored.20in.20a.20record.20with.20PI.html#492186349">(Jan 06 2025 at 21:14)</a>:</h4>
<p>Yeah, but it shouldn't be desugaring the <code>!</code>. It should be parsing as PI, and not desugaring at all.</p>



<a name="492186374"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/463736-bugs/topic/%E2%9C%94%20effectful%20functions%20cannot%20be%20stored%20in%20a%20record%20with%20PI/near/492186374" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/463736-bugs/topic/.E2.9C.94.20effectful.20functions.20cannot.20be.20stored.20in.20a.20record.20with.20PI.html#492186374">(Jan 06 2025 at 21:14)</a>:</h4>
<p><a href="https://github.com/roc-lang/roc/blob/a089cf2487d2cb5f1d977a2e01be5ab7b4de3275/crates/compiler/load_internal/src/file.rs#L2332">https://github.com/roc-lang/roc/blob/a089cf2487d2cb5f1d977a2e01be5ab7b4de3275/crates/compiler/load_internal/src/file.rs#L2332</a></p>



<a name="492186488"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/463736-bugs/topic/%E2%9C%94%20effectful%20functions%20cannot%20be%20stored%20in%20a%20record%20with%20PI/near/492186488" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ian McLerran <a href="https://roc-lang.github.io/zulip-export/stream/463736-bugs/topic/.E2.9C.94.20effectful.20functions.20cannot.20be.20stored.20in.20a.20record.20with.20PI.html#492186488">(Jan 06 2025 at 21:15)</a>:</h4>
<p>If you just uncomment that <code>listDirectoryHandler!</code> in the module exports, doesn't try to desugar, because it parses the file as a PI module.</p>



<a name="492186592"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/463736-bugs/topic/%E2%9C%94%20effectful%20functions%20cannot%20be%20stored%20in%20a%20record%20with%20PI/near/492186592" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ian McLerran <a href="https://roc-lang.github.io/zulip-export/stream/463736-bugs/topic/.E2.9C.94.20effectful.20functions.20cannot.20be.20stored.20in.20a.20record.20with.20PI.html#492186592">(Jan 06 2025 at 21:15)</a>:</h4>
<p>Maybe I'm getting my terminology mixed a little here, forgive me if I'm confusing things here between parsing and desugaring</p>



<a name="492186611"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/463736-bugs/topic/%E2%9C%94%20effectful%20functions%20cannot%20be%20stored%20in%20a%20record%20with%20PI/near/492186611" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/463736-bugs/topic/.E2.9C.94.20effectful.20functions.20cannot.20be.20stored.20in.20a.20record.20with.20PI.html#492186611">(Jan 06 2025 at 21:15)</a>:</h4>
<p>You're totally fine</p>



<a name="492186688"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/463736-bugs/topic/%E2%9C%94%20effectful%20functions%20cannot%20be%20stored%20in%20a%20record%20with%20PI/near/492186688" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/463736-bugs/topic/.E2.9C.94.20effectful.20functions.20cannot.20be.20stored.20in.20a.20record.20with.20PI.html#492186688">(Jan 06 2025 at 21:16)</a>:</h4>
<p>Let me try to say this:</p>



<a name="492186707"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/463736-bugs/topic/%E2%9C%94%20effectful%20functions%20cannot%20be%20stored%20in%20a%20record%20with%20PI/near/492186707" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/463736-bugs/topic/.E2.9C.94.20effectful.20functions.20cannot.20be.20stored.20in.20a.20record.20with.20PI.html#492186707">(Jan 06 2025 at 21:16)</a>:</h4>
<p>The code is shitty and we are okay with that</p>



<a name="492186755"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/463736-bugs/topic/%E2%9C%94%20effectful%20functions%20cannot%20be%20stored%20in%20a%20record%20with%20PI/near/492186755" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/463736-bugs/topic/.E2.9C.94.20effectful.20functions.20cannot.20be.20stored.20in.20a.20record.20with.20PI.html#492186755">(Jan 06 2025 at 21:16)</a>:</h4>
<p>Because it won't be shitty as soon as we permanently move to <code>FxMode::PurityInference</code></p>



<a name="492186771"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/463736-bugs/topic/%E2%9C%94%20effectful%20functions%20cannot%20be%20stored%20in%20a%20record%20with%20PI/near/492186771" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/463736-bugs/topic/.E2.9C.94.20effectful.20functions.20cannot.20be.20stored.20in.20a.20record.20with.20PI.html#492186771">(Jan 06 2025 at 21:16)</a>:</h4>
<p>And rip out the bad part</p>



<a name="492186808"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/463736-bugs/topic/%E2%9C%94%20effectful%20functions%20cannot%20be%20stored%20in%20a%20record%20with%20PI/near/492186808" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/463736-bugs/topic/.E2.9C.94.20effectful.20functions.20cannot.20be.20stored.20in.20a.20record.20with.20PI.html#492186808">(Jan 06 2025 at 21:17)</a>:</h4>
<p>Is there something you think we should do on top of that?</p>



<a name="492186820"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/463736-bugs/topic/%E2%9C%94%20effectful%20functions%20cannot%20be%20stored%20in%20a%20record%20with%20PI/near/492186820" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ian McLerran <a href="https://roc-lang.github.io/zulip-export/stream/463736-bugs/topic/.E2.9C.94.20effectful.20functions.20cannot.20be.20stored.20in.20a.20record.20with.20PI.html#492186820">(Jan 06 2025 at 21:17)</a>:</h4>
<p>But seems, from my limited understanding of the compiler, that it is trying to desugar <code>!</code> to <code>Task.await</code>, because it thinks the code is not purity inference, because there is no <code>!</code> ident exported.</p>



<a name="492186867"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/463736-bugs/topic/%E2%9C%94%20effectful%20functions%20cannot%20be%20stored%20in%20a%20record%20with%20PI/near/492186867" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/463736-bugs/topic/.E2.9C.94.20effectful.20functions.20cannot.20be.20stored.20in.20a.20record.20with.20PI.html#492186867">(Jan 06 2025 at 21:17)</a>:</h4>
<p>You are correct</p>



<a name="492186916"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/463736-bugs/topic/%E2%9C%94%20effectful%20functions%20cannot%20be%20stored%20in%20a%20record%20with%20PI/near/492186916" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/463736-bugs/topic/.E2.9C.94.20effectful.20functions.20cannot.20be.20stored.20in.20a.20record.20with.20PI.html#492186916">(Jan 06 2025 at 21:17)</a>:</h4>
<p>PI is not determined from the code you write, but <em>only</em> from the exports</p>



<a name="492187040"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/463736-bugs/topic/%E2%9C%94%20effectful%20functions%20cannot%20be%20stored%20in%20a%20record%20with%20PI/near/492187040" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ian McLerran <a href="https://roc-lang.github.io/zulip-export/stream/463736-bugs/topic/.E2.9C.94.20effectful.20functions.20cannot.20be.20stored.20in.20a.20record.20with.20PI.html#492187040">(Jan 06 2025 at 21:18)</a>:</h4>
<p>I'm with ya. Since we won't have split modes of parsing forever, no need to perfectly determine PI, since eventually it will always be used, and that will solve the issue.</p>



<a name="492187053"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/463736-bugs/topic/%E2%9C%94%20effectful%20functions%20cannot%20be%20stored%20in%20a%20record%20with%20PI/near/492187053" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Notification Bot <a href="https://roc-lang.github.io/zulip-export/stream/463736-bugs/topic/.E2.9C.94.20effectful.20functions.20cannot.20be.20stored.20in.20a.20record.20with.20PI.html#492187053">(Jan 06 2025 at 21:18)</a>:</h4>
<p><span class="user-mention silent" data-user-id="518883">Ian McLerran</span> has marked this topic as resolved.</p>



<a name="492187093"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/463736-bugs/topic/%E2%9C%94%20effectful%20functions%20cannot%20be%20stored%20in%20a%20record%20with%20PI/near/492187093" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/463736-bugs/topic/.E2.9C.94.20effectful.20functions.20cannot.20be.20stored.20in.20a.20record.20with.20PI.html#492187093">(Jan 06 2025 at 21:18)</a>:</h4>
<p>Also, no offense to you Agus if you're reading this, the use of <code>FxMode</code> to allow for a smooth transition from Task to PI has been a godsend</p>



<a name="492513758"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/463736-bugs/topic/%E2%9C%94%20effectful%20functions%20cannot%20be%20stored%20in%20a%20record%20with%20PI/near/492513758" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Agus Zubiaga <a href="https://roc-lang.github.io/zulip-export/stream/463736-bugs/topic/.E2.9C.94.20effectful.20functions.20cannot.20be.20stored.20in.20a.20record.20with.20PI.html#492513758">(Jan 08 2025 at 14:17)</a>:</h4>
<p>Yeah, none taken. Things can be shitty and useful at the same time <span aria-label="smiley" class="emoji emoji-1f603" role="img" title="smiley">:smiley:</span></p>



<hr><p>Last updated: Mar 01 2026 at 12:20 UTC</p>
</html>