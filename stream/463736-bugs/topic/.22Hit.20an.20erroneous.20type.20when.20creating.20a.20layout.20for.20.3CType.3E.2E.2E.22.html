<html>
<head><meta charset="utf-8"><title>&quot;Hit an erroneous type when creating a layout for &lt;Type&gt;..&quot; · bugs · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://roc-lang.github.io/zulip-export/stream/463736-bugs/index.html">bugs</a></h2>
<h3>Topic: <a href="https://roc-lang.github.io/zulip-export/stream/463736-bugs/topic/.22Hit.20an.20erroneous.20type.20when.20creating.20a.20layout.20for.20.3CType.3E.2E.2E.22.html">&quot;Hit an erroneous type when creating a layout for &lt;Type&gt;..&quot;</a></h3>

<hr>

<base href="https://roc.zulipchat.com">

<head><link href="https://roc-lang.github.io/zulip-export/style.css" rel="stylesheet"></head>

<a name="506321671"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/463736-bugs/topic/%22Hit%20an%20erroneous%20type%20when%20creating%20a%20layout%20for%20%3CType%3E..%22/near/506321671" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Austin Davis <a href="https://roc-lang.github.io/zulip-export/stream/463736-bugs/topic/.22Hit.20an.20erroneous.20type.20when.20creating.20a.20layout.20for.20.3CType.3E.2E.2E.22.html#506321671">(Mar 18 2025 at 04:28)</a>:</h4>
<p>I ran into this error message, and I don't really know enough about the compiler to understand what is causing it:</p>
<div class="codehilite"><pre><span></span><code>This expectation crashed while running:

76│&gt;  expect
77│&gt;      from_list([(1, &quot;1&quot;), (2, &quot;2&quot;), (3, &quot;3&quot;), (4, &quot;4&quot;)])
78│&gt;      == (
79│&gt;          empty({})
80│&gt;          |&gt; insert(1, &quot;1&quot;)
81│&gt;          |&gt; insert(2, &quot;2&quot;)
82│&gt;          |&gt; insert(3, &quot;3&quot;)
83│&gt;          |&gt; insert(4, &quot;4&quot;)

The crash reported this message:

Hit an erroneous type when creating a layout for `AvlTreeNum.IdentId(6)`
</code></pre></div>
<p>Can anyone help me out with this one?</p>



<a name="506425630"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/463736-bugs/topic/%22Hit%20an%20erroneous%20type%20when%20creating%20a%20layout%20for%20%3CType%3E..%22/near/506425630" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anton <a href="https://roc-lang.github.io/zulip-export/stream/463736-bugs/topic/.22Hit.20an.20erroneous.20type.20when.20creating.20a.20layout.20for.20.3CType.3E.2E.2E.22.html#506425630">(Mar 18 2025 at 09:24)</a>:</h4>
<p>Hi <span class="user-mention" data-user-id="816530">@Austin Davis</span>,<br>
I could not reproduce this crash myself, can you share a complete roc file?</p>



<a name="506565376"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/463736-bugs/topic/%22Hit%20an%20erroneous%20type%20when%20creating%20a%20layout%20for%20%3CType%3E..%22/near/506565376" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Austin Davis <a href="https://roc-lang.github.io/zulip-export/stream/463736-bugs/topic/.22Hit.20an.20erroneous.20type.20when.20creating.20a.20layout.20for.20.3CType.3E.2E.2E.22.html#506565376">(Mar 18 2025 at 19:40)</a>:</h4>
<p><span class="user-mention" data-user-id="361169">@Anton</span> Here is a public repo for a Roc package that should reproduce the error when running <code>roc test</code> from the <code>/package</code> directory.</p>
<p><a href="https://github.com/austindd/roc-data-structures">https://github.com/austindd/roc-data-structures</a></p>
<p>I was working from a different repo to flesh out some ideas, but I moved it to a fresh repo that (currently) only includes the modules I needed to reproduce the error.</p>



<a name="506565619"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/463736-bugs/topic/%22Hit%20an%20erroneous%20type%20when%20creating%20a%20layout%20for%20%3CType%3E..%22/near/506565619" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Austin Davis <a href="https://roc-lang.github.io/zulip-export/stream/463736-bugs/topic/.22Hit.20an.20erroneous.20type.20when.20creating.20a.20layout.20for.20.3CType.3E.2E.2E.22.html#506565619">(Mar 18 2025 at 19:41)</a>:</h4>
<p>The error occurs when running <code>AvlTreeNum.from_list</code>. The other functions seem to work fine.</p>



<a name="506715081"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/463736-bugs/topic/%22Hit%20an%20erroneous%20type%20when%20creating%20a%20layout%20for%20%3CType%3E..%22/near/506715081" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anton <a href="https://roc-lang.github.io/zulip-export/stream/463736-bugs/topic/.22Hit.20an.20erroneous.20type.20when.20creating.20a.20layout.20for.20.3CType.3E.2E.2E.22.html#506715081">(Mar 19 2025 at 12:32)</a>:</h4>
<p>The fix ended up quite simple :)<br>
Add <code> &amp; Inspect</code> to the type signature of AvlTreeBase.fromList:</p>
<div class="codehilite"><pre><span></span><code>from_list : List (a, b) -&gt; AvlTreeBase a b where a implements Ord &amp; Inspect
</code></pre></div>
<p>We will probably not improve that error message because we're working on a completely new compiler.</p>



<a name="506715334"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/463736-bugs/topic/%22Hit%20an%20erroneous%20type%20when%20creating%20a%20layout%20for%20%3CType%3E..%22/near/506715334" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anton <a href="https://roc-lang.github.io/zulip-export/stream/463736-bugs/topic/.22Hit.20an.20erroneous.20type.20when.20creating.20a.20layout.20for.20.3CType.3E.2E.2E.22.html#506715334">(Mar 19 2025 at 12:34)</a>:</h4>
<p>By the way, it's recommended to use intermediary variables (<code>tree_a</code>,<code>tree_b</code>) for more helpful test output:</p>
<div class="codehilite"><pre><span></span><code>This expectation failed:

77│&gt;  expect
78│&gt;      tree_a = from_list([(1, &quot;1&quot;), (2, &quot;2&quot;), (3, &quot;3&quot;), (4, &quot;4&quot;)])
79│&gt;      tree_b = (
80│&gt;          empty({})
81│&gt;          |&gt; insert(1, &quot;1&quot;)
82│&gt;          |&gt; insert(2, &quot;2&quot;)
83│&gt;          |&gt; insert(3, &quot;3&quot;)
84│&gt;          |&gt; insert(4, &quot;4&quot;)
85│&gt;      )
86│&gt;
87│&gt;      tree_a == tree_b

When it failed, these variables had these values:

tree_a : AvlTreeNum a Str
tree_a = @AvlTreeNum (Node { h: 2, k: @NumKey 2, l: Leaf { k: @NumKey 1, v: &quot;1&quot; }, r: Leaf { k: @NumKey 3, v: &quot;3&quot; }, v: &quot;2&quot; })

tree_b : AvlTreeNum a Str
tree_b = @AvlTreeNum (Node { h: 3, k: @NumKey 2, l: Leaf { k: @NumKey 1, v: &quot;1&quot; }, r: Node { h: 2, k: @NumKey 4, l: Leaf { k: @NumKey 3, v: &quot;3&quot; }, r: Empty, v: &quot;4&quot; }, v: &quot;2&quot; })


1 failed and 0 passed in 197 ms.
</code></pre></div>



<a name="506817663"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/463736-bugs/topic/%22Hit%20an%20erroneous%20type%20when%20creating%20a%20layout%20for%20%3CType%3E..%22/near/506817663" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Austin Davis <a href="https://roc-lang.github.io/zulip-export/stream/463736-bugs/topic/.22Hit.20an.20erroneous.20type.20when.20creating.20a.20layout.20for.20.3CType.3E.2E.2E.22.html#506817663">(Mar 19 2025 at 20:01)</a>:</h4>
<p>Amazing, thank you for the help <span class="user-mention" data-user-id="361169">@Anton</span> !</p>



<hr><p>Last updated: Nov 01 2025 at 12:13 UTC</p>
</html>