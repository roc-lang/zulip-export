<html>
<head><meta charset="utf-8"><title>Segfault and a few missing functions · bugs · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://roc-lang.github.io/zulip-export/stream/463736-bugs/index.html">bugs</a></h2>
<h3>Topic: <a href="https://roc-lang.github.io/zulip-export/stream/463736-bugs/topic/Segfault.20and.20a.20few.20missing.20functions.html">Segfault and a few missing functions</a></h3>

<hr>

<base href="https://roc.zulipchat.com">

<head><link href="https://roc-lang.github.io/zulip-export/style.css" rel="stylesheet"></head>

<a name="561773634"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/463736-bugs/topic/Segfault%20and%20a%20few%20missing%20functions/near/561773634" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Aurélien Geron <a href="https://roc-lang.github.io/zulip-export/stream/463736-bugs/topic/Segfault.20and.20a.20few.20missing.20functions.html#561773634">(Dec 04 2025 at 00:19)</a>:</h4>
<p>Hi there,<br>
I'm still trying to get AoC 2025 Day 01 to work.<br>
I was missing <code>List.split_on</code> and <code>List.map_try</code> so I tried to implement them.<br>
It took me a while but I managed to have zero compilation error or warning. However, I'm getting a segfault now:</p>
<p>Here's my full program:</p>
<div class="codehilite" data-code-language="Ruby"><pre><span></span><code><span class="n">app</span><span class="w"> </span><span class="o">[</span><span class="n">main!</span><span class="o">]</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="ss">pf</span><span class="p">:</span><span class="w"> </span><span class="n">platform</span><span class="w"> </span><span class="s2">"https://github.com/lukewilliamboswell/roc-platform-template-zig/releases/download/0.3/98T93wthPgoBRLYtPTT4RBBsQunrfDG94gihPf1zYYmE.tar.zst"</span><span class="w"> </span><span class="p">}</span>

<span class="n">import</span><span class="w"> </span><span class="n">pf</span><span class="o">.</span><span class="n">Stdout</span>

<span class="n">data</span><span class="w"> </span><span class="o">=</span>
<span class="w">    </span><span class="p">\\</span><span class="no">L50</span>
<span class="w">    </span><span class="p">\\</span><span class="no">L12</span>
<span class="w">    </span><span class="p">\\</span><span class="no">R13</span>
<span class="w">    </span><span class="p">\\</span><span class="no">L1</span>
<span class="w">    </span><span class="p">\\</span><span class="no">L5</span>
<span class="w">    </span><span class="p">\\</span><span class="no">R5</span>


<span class="ss">parse_instruction</span><span class="p">:</span><span class="w"> </span><span class="no">List</span><span class="p">(</span><span class="no">U8</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="no">Try</span><span class="p">(</span><span class="no">I32</span><span class="p">,</span><span class="w"> </span><span class="n">_</span><span class="p">)</span>
<span class="n">parse_instruction</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">|</span><span class="n">chars</span><span class="o">|</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">match</span><span class="w"> </span><span class="n">chars</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="o">[]</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="no">Err</span><span class="p">(</span><span class="no">ParsingError</span><span class="p">)</span>
<span class="w">        </span><span class="o">[</span><span class="n">c</span><span class="p">,</span><span class="w"> </span><span class="o">..</span><span class="n">rest</span><span class="o">]</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">num_str</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="no">Str</span><span class="o">.</span><span class="n">from_utf8</span><span class="p">(</span><span class="n">rest</span><span class="p">)?</span>
<span class="w">            </span><span class="n">num</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="no">I32</span><span class="o">.</span><span class="n">from_str</span><span class="p">(</span><span class="n">num_str</span><span class="p">)?</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="n">c</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s1">'L'</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="no">Ok</span><span class="p">(</span><span class="o">-</span><span class="n">num</span><span class="p">)</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="no">Ok</span><span class="p">(</span><span class="n">num</span><span class="p">)</span><span class="w"> </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>

<span class="ss">count_zeroes</span><span class="p">:</span><span class="w"> </span><span class="no">List</span><span class="p">(</span><span class="no">I32</span><span class="p">),</span><span class="w"> </span><span class="no">I32</span><span class="p">,</span><span class="w"> </span><span class="no">U32</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="no">U32</span>
<span class="n">count_zeroes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">|</span><span class="n">instructions</span><span class="p">,</span><span class="w"> </span><span class="n">pos</span><span class="p">,</span><span class="w"> </span><span class="n">count</span><span class="o">|</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">match</span><span class="w"> </span><span class="n">instructions</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="o">[]</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">count</span>
<span class="w">        </span><span class="o">[</span><span class="n">inst</span><span class="p">,</span><span class="w"> </span><span class="o">..</span><span class="n">rest</span><span class="o">]</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">new_pos</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pos</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">inst</span>
<span class="w">            </span><span class="n">new_count</span><span class="w"> </span><span class="o">=</span>
<span class="w">                </span><span class="k">if</span><span class="w"> </span><span class="n">new_pos</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mi">100</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span>
<span class="w">                    </span><span class="n">count</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span>
<span class="w">                </span><span class="k">else</span>
<span class="w">                    </span><span class="n">count</span>
<span class="w">            </span><span class="n">rest</span><span class="o">-&gt;</span><span class="n">count_zeroes</span><span class="p">(</span><span class="n">new_pos</span><span class="p">,</span><span class="w"> </span><span class="n">new_count</span><span class="p">)</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>

<span class="ss">split_on</span><span class="p">:</span><span class="w"> </span><span class="no">List</span><span class="p">(</span><span class="n">a</span><span class="p">),</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="no">List</span><span class="p">(</span><span class="no">List</span><span class="p">(</span><span class="n">a</span><span class="p">))</span><span class="w"> </span><span class="n">where</span><span class="w"> </span><span class="o">[</span><span class="n">a</span><span class="o">.</span><span class="n">is_eq</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="no">Bool</span><span class="o">]</span>
<span class="n">split_on</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">|</span><span class="n">elements</span><span class="p">,</span><span class="w"> </span><span class="n">delimiter</span><span class="o">|</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">help</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">|</span><span class="n">remaining</span><span class="p">,</span><span class="w"> </span><span class="n">chunks</span><span class="p">,</span><span class="w"> </span><span class="n">current_chunk</span><span class="o">|</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">match</span><span class="w"> </span><span class="n">remaining</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="o">[]</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">chunks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">current_chunk</span><span class="p">)</span>
<span class="w">            </span><span class="o">[</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="o">..</span><span class="n">rest</span><span class="o">]</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="k">if</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">delimiter</span><span class="w"> </span><span class="p">{</span>
<span class="w">                    </span><span class="n">help</span><span class="p">(</span><span class="n">rest</span><span class="p">,</span><span class="w"> </span><span class="n">chunks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">current_chunk</span><span class="p">),</span><span class="w"> </span><span class="o">[]</span><span class="p">)</span>
<span class="w">                </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">                    </span><span class="n">help</span><span class="p">(</span><span class="n">rest</span><span class="p">,</span><span class="w"> </span><span class="n">chunks</span><span class="p">,</span><span class="w"> </span><span class="n">current_chunk</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
<span class="w">                </span><span class="p">}</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="n">help</span><span class="p">(</span><span class="n">elements</span><span class="p">,</span><span class="w"> </span><span class="o">[]</span><span class="p">,</span><span class="w"> </span><span class="o">[]</span><span class="p">)</span>
<span class="p">}</span>

<span class="ss">map_try</span><span class="p">:</span><span class="w"> </span><span class="no">List</span><span class="p">(</span><span class="n">a</span><span class="p">),</span><span class="w"> </span><span class="p">(</span><span class="n">a</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="no">Try</span><span class="p">(</span><span class="n">b</span><span class="p">,</span><span class="w"> </span><span class="n">c</span><span class="p">))</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="no">Try</span><span class="p">(</span><span class="no">List</span><span class="p">(</span><span class="n">b</span><span class="p">),</span><span class="w"> </span><span class="n">c</span><span class="p">)</span>
<span class="n">map_try</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">|</span><span class="n">list</span><span class="p">,</span><span class="w"> </span><span class="n">to_result_fun</span><span class="o">|</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">list</span><span class="o">-&gt;</span><span class="n">walk_try</span><span class="p">(</span>
<span class="w">        </span><span class="o">[]</span><span class="p">,</span>
<span class="w">        </span><span class="o">|</span><span class="n">state</span><span class="p">,</span><span class="w"> </span><span class="n">elem</span><span class="o">|</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">match</span><span class="w"> </span><span class="n">to_result_fun</span><span class="p">(</span><span class="n">elem</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="no">Ok</span><span class="p">(</span><span class="n">ok</span><span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="no">Ok</span><span class="p">(</span><span class="n">state</span><span class="o">-&gt;</span><span class="no">List</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ok</span><span class="p">))</span>
<span class="w">                </span><span class="no">Err</span><span class="p">(</span><span class="n">b</span><span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="no">Err</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">)</span>
<span class="p">}</span>

<span class="ss">walk_try</span><span class="p">:</span><span class="w"> </span><span class="no">List</span><span class="p">(</span><span class="n">a</span><span class="p">),</span><span class="w"> </span><span class="n">s</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="n">s</span><span class="p">,</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="no">Try</span><span class="p">(</span><span class="n">s</span><span class="p">,</span><span class="w"> </span><span class="n">c</span><span class="p">))</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="no">Try</span><span class="p">(</span><span class="n">s</span><span class="p">,</span><span class="w"> </span><span class="n">c</span><span class="p">)</span>
<span class="n">walk_try</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">|</span><span class="n">list</span><span class="p">,</span><span class="w"> </span><span class="n">init</span><span class="p">,</span><span class="w"> </span><span class="n">func</span><span class="o">|</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">match</span><span class="w"> </span><span class="n">list</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="o">[]</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="no">Ok</span><span class="p">(</span><span class="n">init</span><span class="p">)</span><span class="w"> </span><span class="p">}</span>
<span class="w">        </span><span class="o">[</span><span class="n">val</span><span class="p">,</span><span class="w"> </span><span class="o">..</span><span class="n">rest</span><span class="o">]</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">maybe_state</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">func</span><span class="p">(</span><span class="n">init</span><span class="p">,</span><span class="w"> </span><span class="n">val</span><span class="p">)</span>
<span class="w">            </span><span class="n">match</span><span class="w"> </span><span class="n">maybe_state</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="no">Ok</span><span class="p">(</span><span class="n">state</span><span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">walk_try</span><span class="p">(</span><span class="n">rest</span><span class="p">,</span><span class="w"> </span><span class="n">state</span><span class="p">,</span><span class="w"> </span><span class="n">func</span><span class="p">)</span>
<span class="w">                </span><span class="no">Err</span><span class="p">(</span><span class="n">b</span><span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="no">Err</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>

<span class="n">main!</span><span class="p">:</span><span class="w"> </span><span class="no">List</span><span class="w"> </span><span class="no">Str</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="no">Try</span><span class="p">({},</span><span class="w"> </span><span class="no">Exit</span><span class="p">)</span>
<span class="n">main!</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">|</span><span class="n">_args</span><span class="o">|</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">maybe_instructions</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">data</span><span class="o">.</span><span class="n">to_utf8</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">split_on</span><span class="p">(</span><span class="s1">'</span><span class="se">\n</span><span class="s1">'</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">map_try</span><span class="p">(</span><span class="n">parse_instruction</span><span class="p">)</span>
<span class="w">    </span><span class="n">match</span><span class="w"> </span><span class="n">maybe_instructions</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="no">Ok</span><span class="p">(</span><span class="n">instructions</span><span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">result1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">instructions</span><span class="o">-&gt;</span><span class="n">count_zeroes</span><span class="p">(</span><span class="mi">50</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
<span class="w">            </span><span class="no">Stdout</span><span class="o">.</span><span class="n">line!</span><span class="p">(</span><span class="n">result1</span><span class="o">.</span><span class="n">to_str</span><span class="p">())</span>
<span class="w">            </span><span class="no">Ok</span><span class="p">({})</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="n">_</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="no">Err</span><span class="p">(</span><span class="no">Exit</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>Here's the segfault:</p>
<div class="codehilite"><pre><span></span><code>error: Child process /Users/ageron/Library/Caches/roc/e59c636351ad64c25ba81dca340f7248/temp/roc-tmp-9Tj9smFRS15c5UvOO30epYt9BZ2CYQ9G/roc_run_994723065 killed by signal: 11
error: Child process crashed with segmentation fault (SIGSEGV)
</code></pre></div>
<p>I'm running the latest code compiled from source (<code>Roc compiler version debug-b578eea3</code>).</p>
<p>Thanks for your help!</p>



<a name="561774027"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/463736-bugs/topic/Segfault%20and%20a%20few%20missing%20functions/near/561774027" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/463736-bugs/topic/Segfault.20and.20a.20few.20missing.20functions.html#561774027">(Dec 04 2025 at 00:24)</a>:</h4>
<p>Is that type annotation on main correct? <code>main!: List Str -&gt; Try({}, Exit)</code></p>



<a name="561774093"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/463736-bugs/topic/Segfault%20and%20a%20few%20missing%20functions/near/561774093" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/463736-bugs/topic/Segfault.20and.20a.20few.20missing.20functions.html#561774093">(Dec 04 2025 at 00:24)</a>:</h4>
<p>I think it should be </p>
<div class="codehilite"><pre><span></span><code>main! : List(Str) =&gt; Try({}, [Exit(I32)])
</code></pre></div>



<a name="561774154"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/463736-bugs/topic/Segfault%20and%20a%20few%20missing%20functions/near/561774154" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Aurélien Geron <a href="https://roc-lang.github.io/zulip-export/stream/463736-bugs/topic/Segfault.20and.20a.20few.20missing.20functions.html#561774154">(Dec 04 2025 at 00:25)</a>:</h4>
<p>Oh good point, thanks. I commented it out and still got the segfault</p>



<a name="561774162"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/463736-bugs/topic/Segfault%20and%20a%20few%20missing%20functions/near/561774162" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/463736-bugs/topic/Segfault.20and.20a.20few.20missing.20functions.html#561774162">(Dec 04 2025 at 00:25)</a>:</h4>
<p>Are you able to post a copy of your cli running <code>roc check</code> <code>roc test</code> and <code>roc ...</code></p>



<a name="561774231"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/463736-bugs/topic/Segfault%20and%20a%20few%20missing%20functions/near/561774231" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Aurélien Geron <a href="https://roc-lang.github.io/zulip-export/stream/463736-bugs/topic/Segfault.20and.20a.20few.20missing.20functions.html#561774231">(Dec 04 2025 at 00:26)</a>:</h4>
<p>Sure. Here's <code>roc check</code>:</p>
<div class="codehilite"><pre><span></span><code>-- BAD LIST REST PATTERN SYNTAX ------------------

List rest patterns should use the `.. as name` syntax, not `..name`.
For example, use `[first, .. as rest]` instead of `[first, ..rest]`.

   ┌─ /Users/ageron/dev/roc/aoc2025-roc/day01.roc:18:13
   │
18 │         [c, ..rest] =&gt; {
   │             ^^^^^^

-- BAD LIST REST PATTERN SYNTAX ------------------

List rest patterns should use the `.. as name` syntax, not `..name`.
For example, use `[first, .. as rest]` instead of `[first, ..rest]`.

   ┌─ /Users/ageron/dev/roc/aoc2025-roc/day01.roc:30:16
   │
30 │         [inst, ..rest] =&gt; {
   │                ^^^^^^

-- BAD LIST REST PATTERN SYNTAX ------------------

List rest patterns should use the `.. as name` syntax, not `..name`.
For example, use `[first, .. as rest]` instead of `[first, ..rest]`.

   ┌─ /Users/ageron/dev/roc/aoc2025-roc/day01.roc:47:17
   │
47 │             [x, ..rest] =&gt; {
   │                 ^^^^^^

-- BAD LIST REST PATTERN SYNTAX ------------------

List rest patterns should use the `.. as name` syntax, not `..name`.
For example, use `[first, .. as rest]` instead of `[first, ..rest]`.

   ┌─ /Users/ageron/dev/roc/aoc2025-roc/day01.roc:76:15
   │
76 │         [val, ..rest] =&gt; {
   │               ^^^^^^
</code></pre></div>



<a name="561774355"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/463736-bugs/topic/Segfault%20and%20a%20few%20missing%20functions/near/561774355" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Aurélien Geron <a href="https://roc-lang.github.io/zulip-export/stream/463736-bugs/topic/Segfault.20and.20a.20few.20missing.20functions.html#561774355">(Dec 04 2025 at 00:28)</a>:</h4>
<p><code>roc test</code> gives a segfault:</p>
<div class="codehilite"><pre><span></span><code>zsh: segmentation fault  roc2 test day01.roc
</code></pre></div>
<p>Not sure whether it matters but I'm using a symlink named <code>roc2</code>.</p>



<a name="561774467"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/463736-bugs/topic/Segfault%20and%20a%20few%20missing%20functions/near/561774467" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Aurélien Geron <a href="https://roc-lang.github.io/zulip-export/stream/463736-bugs/topic/Segfault.20and.20a.20few.20missing.20functions.html#561774467">(Dec 04 2025 at 00:29)</a>:</h4>
<p>I tried replacing <code>..rest</code> with <code>.. as rest</code>, and now <code>roc check</code> gives no error, but I still get the segfault.</p>



<a name="561774547"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/463736-bugs/topic/Segfault%20and%20a%20few%20missing%20functions/near/561774547" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/463736-bugs/topic/Segfault.20and.20a.20few.20missing.20functions.html#561774547">(Dec 04 2025 at 00:30)</a>:</h4>
<p>My guess is the segfault is refcounting related... shouldn't be too hard to find.</p>



<a name="561774642"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/463736-bugs/topic/Segfault%20and%20a%20few%20missing%20functions/near/561774642" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/463736-bugs/topic/Segfault.20and.20a.20few.20missing.20functions.html#561774642">(Dec 04 2025 at 00:32)</a>:</h4>
<p>If you're interested to explore yourself, you can build roc with refcount tracing <code>zig build roc -Dtrace-refcount</code> and if you build a debug version of the zig platform template it also has refcount tracing... then when you run you will get a detailed trace of every allocation (incref/decref)</p>



<a name="561774683"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/463736-bugs/topic/Segfault%20and%20a%20few%20missing%20functions/near/561774683" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Aurélien Geron <a href="https://roc-lang.github.io/zulip-export/stream/463736-bugs/topic/Segfault.20and.20a.20few.20missing.20functions.html#561774683">(Dec 04 2025 at 00:32)</a>:</h4>
<p>Cool, thanks Luke</p>



<a name="561774703"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/463736-bugs/topic/Segfault%20and%20a%20few%20missing%20functions/near/561774703" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/463736-bugs/topic/Segfault.20and.20a.20few.20missing.20functions.html#561774703">(Dec 04 2025 at 00:32)</a>:</h4>
<p>I normally feed that trace into claude and a few moment later have narrowed down which builtin isn't following the correct ownership semantics</p>



<a name="561774726"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/463736-bugs/topic/Segfault%20and%20a%20few%20missing%20functions/near/561774726" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/463736-bugs/topic/Segfault.20and.20a.20few.20missing.20functions.html#561774726">(Dec 04 2025 at 00:33)</a>:</h4>
<p>Write a test to reproduce, then fix, then verify etc... <span aria-label="smiley" class="emoji emoji-1f603" role="img" title="smiley">:smiley:</span></p>



<a name="561774740"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/463736-bugs/topic/Segfault%20and%20a%20few%20missing%20functions/near/561774740" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Aurélien Geron <a href="https://roc-lang.github.io/zulip-export/stream/463736-bugs/topic/Segfault.20and.20a.20few.20missing.20functions.html#561774740">(Dec 04 2025 at 00:33)</a>:</h4>
<p>A couple questions:</p>
<ul>
<li>Where can I find the list of builtin functions that are currently implemented in the new compiler?</li>
<li>Am I supposed to use <code>.. as rest</code> or <code>..rest</code> in the new compiler?</li>
</ul>



<a name="561774914"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/463736-bugs/topic/Segfault%20and%20a%20few%20missing%20functions/near/561774914" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/463736-bugs/topic/Segfault.20and.20a.20few.20missing.20functions.html#561774914">(Dec 04 2025 at 00:35)</a>:</h4>
<p>builtins currently implemented <a href="https://github.com/roc-lang/roc/blob/bb17e26f7bd1aa51ce8e18a2a795eab9d07369a9/src/build/roc/Builtin.roc#L4">https://github.com/roc-lang/roc/blob/bb17e26f7bd1aa51ce8e18a2a795eab9d07369a9/src/build/roc/Builtin.roc#L4</a></p>



<a name="561774971"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/463736-bugs/topic/Segfault%20and%20a%20few%20missing%20functions/near/561774971" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/463736-bugs/topic/Segfault.20and.20a.20few.20missing.20functions.html#561774971">(Dec 04 2025 at 00:35)</a>:</h4>
<p>about the rest thing... I'm not sure -- the discussions are many and so these things get blurry. I would look into the code, or maybe try it out on a smaller test program.</p>



<a name="561775214"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/463736-bugs/topic/Segfault%20and%20a%20few%20missing%20functions/near/561775214" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Aurélien Geron <a href="https://roc-lang.github.io/zulip-export/stream/463736-bugs/topic/Segfault.20and.20a.20few.20missing.20functions.html#561775214">(Dec 04 2025 at 00:38)</a>:</h4>
<p>I ran <code>zig build roc -Dtrace-refcount</code> and now when I run <code>roc day01.roc</code> I get:</p>
<div class="codehilite"><pre><span></span><code>[REFCOUNT] INCREF list (copyToPtr) ptr=0x101460018 len=1 rc=1 slice=0 elems_rc=1
error: Child process /Users/ageron/Library/Caches/roc/e59c636351ad64c25ba81dca340f7248/temp/roc-tmp-2q9ZB7TrXASkuFMITQ3Xqvx7AXG5qNWK/roc_run_994723065 killed by signal: 11
error: Child process crashed with segmentation fault (SIGSEGV)
</code></pre></div>
<blockquote>
<p>and if you build a debug version of the zig platform template</p>
</blockquote>
<p>How can I do that?</p>



<a name="561775395"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/463736-bugs/topic/Segfault%20and%20a%20few%20missing%20functions/near/561775395" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/463736-bugs/topic/Segfault.20and.20a.20few.20missing.20functions.html#561775395">(Dec 04 2025 at 00:40)</a>:</h4>
<p>Clone the template repository, then <code>zig build</code> you can also do <code>zig build native</code> which is quicker because it only builds the libraries for your current system and doesn't cross-compile for all the supported os/arches</p>



<a name="561775449"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/463736-bugs/topic/Segfault%20and%20a%20few%20missing%20functions/near/561775449" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/463736-bugs/topic/Segfault.20and.20a.20few.20missing.20functions.html#561775449">(Dec 04 2025 at 00:40)</a>:</h4>
<p>Use a relative path to the <code>../roc-platform-template-zig/platform/main.roc</code> in your test app</p>



<a name="561775512"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/463736-bugs/topic/Segfault%20and%20a%20few%20missing%20functions/near/561775512" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Aurélien Geron <a href="https://roc-lang.github.io/zulip-export/stream/463736-bugs/topic/Segfault.20and.20a.20few.20missing.20functions.html#561775512">(Dec 04 2025 at 00:41)</a>:</h4>
<p>I'll try that after lunch, thanks Luke.</p>



<hr><p>Last updated: Mar 01 2026 at 12:20 UTC</p>
</html>