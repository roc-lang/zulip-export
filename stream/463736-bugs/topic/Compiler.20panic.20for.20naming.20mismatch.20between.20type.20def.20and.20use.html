<html>
<head><meta charset="utf-8"><title>Compiler panic for naming mismatch between type def and use · bugs · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://roc-lang.github.io/zulip-export/stream/463736-bugs/index.html">bugs</a></h2>
<h3>Topic: <a href="https://roc-lang.github.io/zulip-export/stream/463736-bugs/topic/Compiler.20panic.20for.20naming.20mismatch.20between.20type.20def.20and.20use.html">Compiler panic for naming mismatch between type def and use</a></h3>

<hr>

<base href="https://roc.zulipchat.com">

<head><link href="https://roc-lang.github.io/zulip-export/style.css" rel="stylesheet"></head>

<a name="492352313"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/463736-bugs/topic/Compiler%20panic%20for%20naming%20mismatch%20between%20type%20def%20and%20use/near/492352313" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ian McLerran <a href="https://roc-lang.github.io/zulip-export/stream/463736-bugs/topic/Compiler.20panic.20for.20naming.20mismatch.20between.20type.20def.20and.20use.html#492352313">(Jan 07 2025 at 17:15)</a>:</h4>
<p>Not sure if this is a known bug, but a mismatch between the naming of a record field in its type annotation and its definition / usage will produce a compiler panic:</p>
<p>IE:</p>
<div class="codehilite" data-code-language="CoffeeScript"><pre><span></span><code><span class="nv">month_days</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nv">month</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="nx">Int</span><span class="w"> </span><span class="o">*</span><span class="p">,</span><span class="w"> </span><span class="nx">isLeap</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="nx">Bool</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="nf">-&gt;</span><span class="w"> </span><span class="nx">U64</span>
<span class="nv">month_days</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="err">\</span><span class="p">{</span><span class="w"> </span><span class="nx">month</span><span class="p">,</span><span class="w"> </span><span class="nx">is_leap</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="nx">Bool</span><span class="p">.</span><span class="nx">false</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="nf">-&gt;</span>
<span class="w">    </span><span class="k">when</span><span class="w"> </span><span class="nx">month</span><span class="w"> </span><span class="o">is</span>
<span class="w">        </span><span class="mi">1</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">3</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">5</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">7</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">8</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">10</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">12</span><span class="w"> </span><span class="nf">-&gt;</span><span class="w"> </span><span class="mi">31</span>
<span class="w">        </span><span class="mi">4</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">6</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">9</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">11</span><span class="w"> </span><span class="nf">-&gt;</span><span class="w"> </span><span class="mi">30</span>
<span class="w">        </span><span class="mi">2</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="nx">is_leap</span><span class="w"> </span><span class="nf">-&gt;</span><span class="w"> </span><span class="mi">29</span>
<span class="w">        </span><span class="mi">2</span><span class="w"> </span><span class="nf">-&gt;</span><span class="w"> </span><span class="mi">28</span>
<span class="w">        </span><span class="nx">_</span><span class="w"> </span><span class="nf">-&gt;</span><span class="w"> </span><span class="mi">0</span>
</code></pre></div>
<p>produces:</p>
<div class="codehilite"><pre><span></span><code>thread &#39;main&#39; panicked at crates/compiler/gen_llvm/src/llvm/build.rs:5582:19:
Error in alias analysis: error in module ModName(&quot;UserApp&quot;), function definition FuncName(&quot;\x12\x00\x00\x00\r\x00\x00\x00r,\xe4idl\x95\x92&quot;), definition of value binding ValueId(3): tuple field index 2 out of range
note: run with `RUST_BACKTRACE=1` environment variable to display a backtrace
</code></pre></div>



<a name="492354873"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/463736-bugs/topic/Compiler%20panic%20for%20naming%20mismatch%20between%20type%20def%20and%20use/near/492354873" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anton <a href="https://roc-lang.github.io/zulip-export/stream/463736-bugs/topic/Compiler.20panic.20for.20naming.20mismatch.20between.20type.20def.20and.20use.html#492354873">(Jan 07 2025 at 17:31)</a>:</h4>
<p>I haven't seen that cause an error like this before, can you make an issue?</p>



<a name="492355180"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/463736-bugs/topic/Compiler%20panic%20for%20naming%20mismatch%20between%20type%20def%20and%20use/near/492355180" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ian McLerran <a href="https://roc-lang.github.io/zulip-export/stream/463736-bugs/topic/Compiler.20panic.20for.20naming.20mismatch.20between.20type.20def.20and.20use.html#492355180">(Jan 07 2025 at 17:33)</a>:</h4>
<p>Yeah... although in trying to find a min repro, its a little more complex. Trying to identify the exact case that produces this in a min repro</p>



<a name="492360738"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/463736-bugs/topic/Compiler%20panic%20for%20naming%20mismatch%20between%20type%20def%20and%20use/near/492360738" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ian McLerran <a href="https://roc-lang.github.io/zulip-export/stream/463736-bugs/topic/Compiler.20panic.20for.20naming.20mismatch.20between.20type.20def.20and.20use.html#492360738">(Jan 07 2025 at 18:08)</a>:</h4>
<p>Okay, <del>this one is actually VERY specific, but</del> I think I've narrowed down to a fairly minimum repro.</p>
<p>(Wasn't quite as specific as I thought for a minute...)</p>



<a name="492361882"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/463736-bugs/topic/Compiler%20panic%20for%20naming%20mismatch%20between%20type%20def%20and%20use/near/492361882" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ian McLerran <a href="https://roc-lang.github.io/zulip-export/stream/463736-bugs/topic/Compiler.20panic.20for.20naming.20mismatch.20between.20type.20def.20and.20use.html#492361882">(Jan 07 2025 at 18:16)</a>:</h4>
<p>Conditions I have been able to establish:</p>
<ul>
<li>a function which takes a record with two or more fields, one of which must be optional</li>
<li>the optional record field must be a number type of <code>U16</code>/<code>I16</code> or larger, <code>Str</code>, or <code>Bool</code>, maybe other types (Specifically does <em>not</em> apply to optional <code>U8</code>/<code>I8</code> types).</li>
<li>the optional record field has one name in the type annotation, but a different name is used in the definition, and the name from the definition is used in the function call.</li>
</ul>
<p><strong>Min repro:</strong></p>
<div class="codehilite" data-code-language="CoffeeScript"><pre><span></span><code><span class="nx">main</span><span class="o">!</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="err">\</span><span class="nx">_</span><span class="w"> </span><span class="nf">-&gt;</span>
<span class="w">    </span><span class="nv">_</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">foo</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nv">bar</span><span class="o">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="nv">baz</span><span class="o">:</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">}</span>
<span class="w">    </span><span class="nx">Ok</span><span class="w"> </span><span class="p">{}</span>

<span class="nv">foo</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">qux</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="nx">U16</span><span class="p">,</span><span class="w"> </span><span class="nv">baz</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="nx">U8</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="nf">-&gt;</span><span class="w"> </span><span class="nx">U8</span>
<span class="nv">foo</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="err">\</span><span class="p">{</span><span class="w"> </span><span class="nx">bar</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="nx">baz</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="nf">-&gt;</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">bar</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="k">then</span>
<span class="w">        </span><span class="mi">0</span>
<span class="w">    </span><span class="k">else</span>
<span class="w">        </span><span class="nx">baz</span>
</code></pre></div>



<a name="492362183"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/463736-bugs/topic/Compiler%20panic%20for%20naming%20mismatch%20between%20type%20def%20and%20use/near/492362183" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ian McLerran <a href="https://roc-lang.github.io/zulip-export/stream/463736-bugs/topic/Compiler.20panic.20for.20naming.20mismatch.20between.20type.20def.20and.20use.html#492362183">(Jan 07 2025 at 18:18)</a>:</h4>
<p>Note that I also tried reversing the <code>U16</code> and <code>U8</code> types so the optional is <code>U8</code> and the non-optional is <code>U16</code>, but this does not trigger the error, so it does not appear to be based on the total size of the record.</p>



<a name="492363826"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/463736-bugs/topic/Compiler%20panic%20for%20naming%20mismatch%20between%20type%20def%20and%20use/near/492363826" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ian McLerran <a href="https://roc-lang.github.io/zulip-export/stream/463736-bugs/topic/Compiler.20panic.20for.20naming.20mismatch.20between.20type.20def.20and.20use.html#492363826">(Jan 07 2025 at 18:29)</a>:</h4>
<p>Filed an issue @ <a href="https://github.com/roc-lang/roc/issues/7478">#7478</a></p>



<a name="492383946"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/463736-bugs/topic/Compiler%20panic%20for%20naming%20mismatch%20between%20type%20def%20and%20use/near/492383946" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/463736-bugs/topic/Compiler.20panic.20for.20naming.20mismatch.20between.20type.20def.20and.20use.html#492383946">(Jan 07 2025 at 20:43)</a>:</h4>
<p>Gotta be something weird with alignment and layout</p>



<a name="492391234"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/463736-bugs/topic/Compiler%20panic%20for%20naming%20mismatch%20between%20type%20def%20and%20use/near/492391234" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/463736-bugs/topic/Compiler.20panic.20for.20naming.20mismatch.20between.20type.20def.20and.20use.html#492391234">(Jan 07 2025 at 21:34)</a>:</h4>
<p>In general, I think optional record fields are more a sharp edge than valuable in current roc.</p>



<a name="492392233"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/463736-bugs/topic/Compiler%20panic%20for%20naming%20mismatch%20between%20type%20def%20and%20use/near/492392233" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/463736-bugs/topic/Compiler.20panic.20for.20naming.20mismatch.20between.20type.20def.20and.20use.html#492392233">(Jan 07 2025 at 21:41)</a>:</h4>
<p>That feels more like a current problem with a fragile implementation than the eventual state of the feature, right?</p>



<a name="492392271"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/463736-bugs/topic/Compiler%20panic%20for%20naming%20mismatch%20between%20type%20def%20and%20use/near/492392271" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/463736-bugs/topic/Compiler.20panic.20for.20naming.20mismatch.20between.20type.20def.20and.20use.html#492392271">(Jan 07 2025 at 21:41)</a>:</h4>
<p>Or do you kinda feel like we should get rid of them</p>



<a name="492392295"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/463736-bugs/topic/Compiler%20panic%20for%20naming%20mismatch%20between%20type%20def%20and%20use/near/492392295" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/463736-bugs/topic/Compiler.20panic.20for.20naming.20mismatch.20between.20type.20def.20and.20use.html#492392295">(Jan 07 2025 at 21:41)</a>:</h4>
<p>They're great for UI building</p>



<a name="492393865"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/463736-bugs/topic/Compiler%20panic%20for%20naming%20mismatch%20between%20type%20def%20and%20use/near/492393865" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/463736-bugs/topic/Compiler.20panic.20for.20naming.20mismatch.20between.20type.20def.20and.20use.html#492393865">(Jan 07 2025 at 21:52)</a>:</h4>
<p>I think optional fields are a _real difference_ in Roc as a feature</p>



<a name="492393976"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/463736-bugs/topic/Compiler%20panic%20for%20naming%20mismatch%20between%20type%20def%20and%20use/near/492393976" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/463736-bugs/topic/Compiler.20panic.20for.20naming.20mismatch.20between.20type.20def.20and.20use.html#492393976">(Jan 07 2025 at 21:52)</a>:</h4>
<p>For UI specifically, the amount of noise you can avoid is insanely large</p>



<a name="492394422"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/463736-bugs/topic/Compiler%20panic%20for%20naming%20mismatch%20between%20type%20def%20and%20use/near/492394422" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/463736-bugs/topic/Compiler.20panic.20for.20naming.20mismatch.20between.20type.20def.20and.20use.html#492394422">(Jan 07 2025 at 21:55)</a>:</h4>
<p>It makes Weaver much cleaner</p>



<a name="492394480"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/463736-bugs/topic/Compiler%20panic%20for%20naming%20mismatch%20between%20type%20def%20and%20use/near/492394480" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/463736-bugs/topic/Compiler.20panic.20for.20naming.20mismatch.20between.20type.20def.20and.20use.html#492394480">(Jan 07 2025 at 21:56)</a>:</h4>
<p><span class="user-mention silent" data-user-id="343810">Brendan Hansknecht</span> <a href="#narrow/stream/463736-bugs/topic/Compiler.20panic.20for.20naming.20mismatch.20between.20type.20def.20and.20use/near/492391234">said</a>:</p>
<blockquote>
<p>In general, I think optional record fields are more a sharp edge than valuable in current roc.</p>
</blockquote>
<p><span aria-label="thinking" class="emoji emoji-1f914" role="img" title="thinking">:thinking:</span> I wonder if static dispatch could make "builder" APIs comparably nice for specifying config</p>



<a name="492394598"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/463736-bugs/topic/Compiler%20panic%20for%20naming%20mismatch%20between%20type%20def%20and%20use/near/492394598" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/463736-bugs/topic/Compiler.20panic.20for.20naming.20mismatch.20between.20type.20def.20and.20use.html#492394598">(Jan 07 2025 at 21:57)</a>:</h4>
<p>If I ever get around to wrapping Clay in Roc, it allows for really nice API (like it has in C, but without dealing with the C preprocessor)</p>



<a name="492394614"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/463736-bugs/topic/Compiler%20panic%20for%20naming%20mismatch%20between%20type%20def%20and%20use/near/492394614" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/463736-bugs/topic/Compiler.20panic.20for.20naming.20mismatch.20between.20type.20def.20and.20use.html#492394614">(Jan 07 2025 at 21:57)</a>:</h4>
<p>Ooh <img alt=":galaxy_brain:" class="emoji" src="https://avatars.zulip.com/22008/emoji/images/e7a6a0fc.png" title="galaxy brain"> it would definitely work for Weaver</p>



<a name="492394698"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/463736-bugs/topic/Compiler%20panic%20for%20naming%20mismatch%20between%20type%20def%20and%20use/near/492394698" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/463736-bugs/topic/Compiler.20panic.20for.20naming.20mismatch.20between.20type.20def.20and.20use.html#492394698">(Jan 07 2025 at 21:57)</a>:</h4>
<p>There is an inherent cost to builder APIs, especially for things like immediate mode rendering systems</p>



<a name="492394716"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/463736-bugs/topic/Compiler%20panic%20for%20naming%20mismatch%20between%20type%20def%20and%20use/near/492394716" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/463736-bugs/topic/Compiler.20panic.20for.20naming.20mismatch.20between.20type.20def.20and.20use.html#492394716">(Jan 07 2025 at 21:58)</a>:</h4>
<p>Which would be a "zero-cost abstraction" with pure expression compile-time eval</p>



<a name="492394836"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/463736-bugs/topic/Compiler%20panic%20for%20naming%20mismatch%20between%20type%20def%20and%20use/near/492394836" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/463736-bugs/topic/Compiler.20panic.20for.20naming.20mismatch.20between.20type.20def.20and.20use.html#492394836">(Jan 07 2025 at 21:58)</a>:</h4>
<p>You assume that most of this configuration is static</p>



<a name="492394852"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/463736-bugs/topic/Compiler%20panic%20for%20naming%20mismatch%20between%20type%20def%20and%20use/near/492394852" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/463736-bugs/topic/Compiler.20panic.20for.20naming.20mismatch.20between.20type.20def.20and.20use.html#492394852">(Jan 07 2025 at 21:58)</a>:</h4>
<p>And that is not the truth a lot of the time</p>



<a name="492394920"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/463736-bugs/topic/Compiler%20panic%20for%20naming%20mismatch%20between%20type%20def%20and%20use/near/492394920" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/463736-bugs/topic/Compiler.20panic.20for.20naming.20mismatch.20between.20type.20def.20and.20use.html#492394920">(Jan 07 2025 at 21:59)</a>:</h4>
<div class="codehilite" data-code-language="Ruby"><pre><span></span><code><span class="n">button</span><span class="p">(</span><span class="no">Config</span><span class="o">.</span><span class="n">default</span><span class="p">()</span><span class="o">.</span><span class="n">border</span><span class="p">(</span><span class="n">green</span><span class="p">)</span><span class="o">.</span><span class="n">enabled</span><span class="p">(</span><span class="n">foo</span><span class="p">))</span>
</code></pre></div>
<p>I know we haven't decided for sure whether we want to do this, but you could eliminate the default config by taking a function that operates on it:</p>
<div class="codehilite" data-code-language="Ruby"><pre><span></span><code><span class="n">button</span><span class="p">(</span><span class="o">.</span><span class="n">border</span><span class="p">(</span><span class="n">green</span><span class="p">)</span><span class="o">.</span><span class="n">enabled</span><span class="p">(</span><span class="n">foo</span><span class="p">))</span>
</code></pre></div>



<a name="492394945"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/463736-bugs/topic/Compiler%20panic%20for%20naming%20mismatch%20between%20type%20def%20and%20use/near/492394945" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/463736-bugs/topic/Compiler.20panic.20for.20naming.20mismatch.20between.20type.20def.20and.20use.html#492394945">(Jan 07 2025 at 21:59)</a>:</h4>
<p>Yeah, we'd need LLVM to pull in clutch 100% of the time on top of constant folding</p>



<a name="492395017"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/463736-bugs/topic/Compiler%20panic%20for%20naming%20mismatch%20between%20type%20def%20and%20use/near/492395017" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/463736-bugs/topic/Compiler.20panic.20for.20naming.20mismatch.20between.20type.20def.20and.20use.html#492395017">(Jan 07 2025 at 21:59)</a>:</h4>
<p>if the config isn't static then we're doing runtime work anyway, probably makes no difference</p>



<a name="492395116"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/463736-bugs/topic/Compiler%20panic%20for%20naming%20mismatch%20between%20type%20def%20and%20use/near/492395116" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/463736-bugs/topic/Compiler.20panic.20for.20naming.20mismatch.20between.20type.20def.20and.20use.html#492395116">(Jan 07 2025 at 22:00)</a>:</h4>
<p>also I wouldn't be surprised if llvm would already optimize this away</p>



<a name="492395150"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/463736-bugs/topic/Compiler%20panic%20for%20naming%20mismatch%20between%20type%20def%20and%20use/near/492395150" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/463736-bugs/topic/Compiler.20panic.20for.20naming.20mismatch.20between.20type.20def.20and.20use.html#492395150">(Jan 07 2025 at 22:00)</a>:</h4>
<p>I think the real question is how it reads</p>



<a name="492395212"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/463736-bugs/topic/Compiler%20panic%20for%20naming%20mismatch%20between%20type%20def%20and%20use/near/492395212" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/463736-bugs/topic/Compiler.20panic.20for.20naming.20mismatch.20between.20type.20def.20and.20use.html#492395212">(Jan 07 2025 at 22:00)</a>:</h4>
<p>especially if you have a lot of them in a DSL <span aria-label="big smile" class="emoji emoji-1f604" role="img" title="big smile">:big_smile:</span></p>



<a name="492395315"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/463736-bugs/topic/Compiler%20panic%20for%20naming%20mismatch%20between%20type%20def%20and%20use/near/492395315" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/463736-bugs/topic/Compiler.20panic.20for.20naming.20mismatch.20between.20type.20def.20and.20use.html#492395315">(Jan 07 2025 at 22:01)</a>:</h4>
<p><span class="user-mention silent" data-user-id="281383">Richard Feldman</span> <a href="#narrow/stream/463736-bugs/topic/Compiler.20panic.20for.20naming.20mismatch.20between.20type.20def.20and.20use/near/492394920">said</a>:</p>
<blockquote>
<p>I know we haven't decided for sure whether we want to do this, but you could eliminate the default config by taking a function that operates on it:</p>
<p><div class="codehilite" data-code-language="Ruby"><pre><span></span><code><span class="n">button</span><span class="p">(</span><span class="o">.</span><span class="n">border</span><span class="p">(</span><span class="n">green</span><span class="p">)</span><span class="o">.</span><span class="n">enabled</span><span class="p">(</span><span class="n">foo</span><span class="p">))</span>
</code></pre></div><br>
</p>
</blockquote>
<p>I actually really like how that reads!</p>



<a name="492395723"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/463736-bugs/topic/Compiler%20panic%20for%20naming%20mismatch%20between%20type%20def%20and%20use/near/492395723" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/463736-bugs/topic/Compiler.20panic.20for.20naming.20mismatch.20between.20type.20def.20and.20use.html#492395723">(Jan 07 2025 at 22:04)</a>:</h4>
<p>it's about as concise as default record fields, but without the separate language feature</p>



<a name="492395807"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/463736-bugs/topic/Compiler%20panic%20for%20naming%20mismatch%20between%20type%20def%20and%20use/near/492395807" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/463736-bugs/topic/Compiler.20panic.20for.20naming.20mismatch.20between.20type.20def.20and.20use.html#492395807">(Jan 07 2025 at 22:04)</a>:</h4>
<p>I wonder how we can make a default button nice without needing a separate <code>default_button()</code>, since you need to do <code>button(|c| c)</code> here</p>



<a name="492395925"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/463736-bugs/topic/Compiler%20panic%20for%20naming%20mismatch%20between%20type%20def%20and%20use/near/492395925" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/463736-bugs/topic/Compiler.20panic.20for.20naming.20mismatch.20between.20type.20def.20and.20use.html#492395925">(Jan 07 2025 at 22:05)</a>:</h4>
<p>You could make <code>.</code> the identity function</p>



<a name="492395973"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/463736-bugs/topic/Compiler%20panic%20for%20naming%20mismatch%20between%20type%20def%20and%20use/near/492395973" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/463736-bugs/topic/Compiler.20panic.20for.20naming.20mismatch.20between.20type.20def.20and.20use.html#492395973">(Jan 07 2025 at 22:06)</a>:</h4>
<p><code>button(.)</code></p>



<a name="492396124"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/463736-bugs/topic/Compiler%20panic%20for%20naming%20mismatch%20between%20type%20def%20and%20use/near/492396124" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/463736-bugs/topic/Compiler.20panic.20for.20naming.20mismatch.20between.20type.20def.20and.20use.html#492396124">(Jan 07 2025 at 22:07)</a>:</h4>
<p>I'm telling you if we get rid of optional fields, with PNC we will absolutely end up with labelled/named arguments</p>



<a name="492396173"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/463736-bugs/topic/Compiler%20panic%20for%20naming%20mismatch%20between%20type%20def%20and%20use/near/492396173" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/463736-bugs/topic/Compiler.20panic.20for.20naming.20mismatch.20between.20type.20def.20and.20use.html#492396173">(Jan 07 2025 at 22:07)</a>:</h4>
<p>I don't have perms to move everything from <a class="message-link" href="/#narrow/channel/463736-bugs/topic/Compiler.20panic.20for.20naming.20mismatch.20between.20type.20def.20and.20use/near/492391234">#bugs &gt; Compiler panic for naming mismatch between type def and use @ 💬</a> on into a different channel. Can someone do that?</p>



<a name="492396184"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/463736-bugs/topic/Compiler%20panic%20for%20naming%20mismatch%20between%20type%20def%20and%20use/near/492396184" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/463736-bugs/topic/Compiler.20panic.20for.20naming.20mismatch.20between.20type.20def.20and.20use.html#492396184">(Jan 07 2025 at 22:07)</a>:</h4>
<p>Might as well start bikeshedding the syntax now</p>



<a name="492396188"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/463736-bugs/topic/Compiler%20panic%20for%20naming%20mismatch%20between%20type%20def%20and%20use/near/492396188" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/463736-bugs/topic/Compiler.20panic.20for.20naming.20mismatch.20between.20type.20def.20and.20use.html#492396188">(Jan 07 2025 at 22:07)</a>:</h4>
<p>I think labelled args are great</p>



<a name="492396203"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/463736-bugs/topic/Compiler%20panic%20for%20naming%20mismatch%20between%20type%20def%20and%20use/near/492396203" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/463736-bugs/topic/Compiler.20panic.20for.20naming.20mismatch.20between.20type.20def.20and.20use.html#492396203">(Jan 07 2025 at 22:07)</a>:</h4>
<p>If you don't use records</p>



<a name="492396259"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/463736-bugs/topic/Compiler%20panic%20for%20naming%20mismatch%20between%20type%20def%20and%20use/near/492396259" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/463736-bugs/topic/Compiler.20panic.20for.20naming.20mismatch.20between.20type.20def.20and.20use.html#492396259">(Jan 07 2025 at 22:08)</a>:</h4>
<p>I worked on the Flutter team at Google - I like labelled args :-)</p>



<a name="492396260"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/463736-bugs/topic/Compiler%20panic%20for%20naming%20mismatch%20between%20type%20def%20and%20use/near/492396260" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/463736-bugs/topic/Compiler.20panic.20for.20naming.20mismatch.20between.20type.20def.20and.20use.html#492396260">(Jan 07 2025 at 22:08)</a>:</h4>
<p>But we have records already</p>



<a name="492396280"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/463736-bugs/topic/Compiler%20panic%20for%20naming%20mismatch%20between%20type%20def%20and%20use/near/492396280" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/463736-bugs/topic/Compiler.20panic.20for.20naming.20mismatch.20between.20type.20def.20and.20use.html#492396280">(Jan 07 2025 at 22:08)</a>:</h4>
<p>BRO</p>



<a name="492396291"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/463736-bugs/topic/Compiler%20panic%20for%20naming%20mismatch%20between%20type%20def%20and%20use/near/492396291" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/463736-bugs/topic/Compiler.20panic.20for.20naming.20mismatch.20between.20type.20def.20and.20use.html#492396291">(Jan 07 2025 at 22:08)</a>:</h4>
<p>So jealous</p>



<a name="492396310"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/463736-bugs/topic/Compiler%20panic%20for%20naming%20mismatch%20between%20type%20def%20and%20use/near/492396310" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/463736-bugs/topic/Compiler.20panic.20for.20naming.20mismatch.20between.20type.20def.20and.20use.html#492396310">(Jan 07 2025 at 22:08)</a>:</h4>
<p>I wasn't on the Glamorous side</p>



<a name="492396334"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/463736-bugs/topic/Compiler%20panic%20for%20naming%20mismatch%20between%20type%20def%20and%20use/near/492396334" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/463736-bugs/topic/Compiler.20panic.20for.20naming.20mismatch.20between.20type.20def.20and.20use.html#492396334">(Jan 07 2025 at 22:08)</a>:</h4>
<p>So not jealous</p>



<a name="492396361"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/463736-bugs/topic/Compiler%20panic%20for%20naming%20mismatch%20between%20type%20def%20and%20use/near/492396361" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/463736-bugs/topic/Compiler.20panic.20for.20naming.20mismatch.20between.20type.20def.20and.20use.html#492396361">(Jan 07 2025 at 22:09)</a>:</h4>
<p>I was _mostly_ diving into the Dart compiler and internal tooling/infra</p>



<a name="492396521"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/463736-bugs/topic/Compiler%20panic%20for%20naming%20mismatch%20between%20type%20def%20and%20use/near/492396521" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/463736-bugs/topic/Compiler.20panic.20for.20naming.20mismatch.20between.20type.20def.20and.20use.html#492396521">(Jan 07 2025 at 22:10)</a>:</h4>
<p><span class="user-mention silent" data-user-id="781658">Anthony Bullard</span> <a href="#narrow/stream/463736-bugs/topic/Compiler.20panic.20for.20naming.20mismatch.20between.20type.20def.20and.20use/near/492396124">said</a>:</p>
<blockquote>
<p>I'm telling you if we get rid of optional fields, with PNC we will absolutely end up with labelled/named arguments</p>
</blockquote>
<p>labeled arguments are a different thing from optional arguments. We already have records serving the purpose of labeling!</p>



<a name="492396837"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/463736-bugs/topic/Compiler%20panic%20for%20naming%20mismatch%20between%20type%20def%20and%20use/near/492396837" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/463736-bugs/topic/Compiler.20panic.20for.20naming.20mismatch.20between.20type.20def.20and.20use.html#492396837">(Jan 07 2025 at 22:12)</a>:</h4>
<p><span class="user-mention silent" data-user-id="461444">Sam Mohr</span> <a href="#narrow/channel/463736-bugs/topic/Compiler.20panic.20for.20naming.20mismatch.20between.20type.20def.20and.20use/near/492395973">said</a>:</p>
<blockquote>
<p><code>button(.)</code></p>
</blockquote>
<p>This aligns with the <code>.method()</code> syntax for desugaring to <code>|x| x.method()</code>, so <code>.</code> goes to <code>|x| x</code>. Literally trimmed off the end.</p>
<p>If we do something like <code>_.method()</code> goes to <code>|x| x.method()</code> instead, then maybe <code>_.</code> or just <code>_</code> can be the identity function</p>



<a name="492396840"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/463736-bugs/topic/Compiler%20panic%20for%20naming%20mismatch%20between%20type%20def%20and%20use/near/492396840" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/463736-bugs/topic/Compiler.20panic.20for.20naming.20mismatch.20between.20type.20def.20and.20use.html#492396840">(Jan 07 2025 at 22:12)</a>:</h4>
<p>True-ish.  But in a language like dart optional args are almost always labelled.</p>



<a name="492396902"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/463736-bugs/topic/Compiler%20panic%20for%20naming%20mismatch%20between%20type%20def%20and%20use/near/492396902" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/463736-bugs/topic/Compiler.20panic.20for.20naming.20mismatch.20between.20type.20def.20and.20use.html#492396902">(Jan 07 2025 at 22:13)</a>:</h4>
<p><span class="user-mention silent" data-user-id="461444">Sam Mohr</span> <a href="#narrow/channel/463736-bugs/topic/Compiler.20panic.20for.20naming.20mismatch.20between.20type.20def.20and.20use/near/492395973">said</a>:</p>
<blockquote>
<p><code>button(.)</code></p>
</blockquote>
<p>What if the function arg was....optional?</p>



<a name="492397070"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/463736-bugs/topic/Compiler%20panic%20for%20naming%20mismatch%20between%20type%20def%20and%20use/near/492397070" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/463736-bugs/topic/Compiler.20panic.20for.20naming.20mismatch.20between.20type.20def.20and.20use.html#492397070">(Jan 07 2025 at 22:14)</a>:</h4>
<p>We've come full circle</p>



<a name="492397139"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/463736-bugs/topic/Compiler%20panic%20for%20naming%20mismatch%20between%20type%20def%20and%20use/near/492397139" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/463736-bugs/topic/Compiler.20panic.20for.20naming.20mismatch.20between.20type.20def.20and.20use.html#492397139">(Jan 07 2025 at 22:14)</a>:</h4>
<p><span class="user-mention silent" data-user-id="281383">Richard Feldman</span> <a href="#narrow/channel/463736-bugs/topic/Compiler.20panic.20for.20naming.20mismatch.20between.20type.20def.20and.20use/near/492396521">said</a>:</p>
<blockquote>
<p><span class="user-mention silent" data-user-id="781658">Anthony Bullard</span> <a href="#narrow/stream/463736-bugs/topic/Compiler.20panic.20for.20naming.20mismatch.20between.20type.20def.20and.20use/near/492396124">said</a>:</p>
<blockquote>
<p>I'm telling you if we get rid of optional fields, with PNC we will absolutely end up with labelled/named arguments</p>
</blockquote>
<p>labeled arguments are a different thing from optional arguments. We already have records serving the purpose of labeling!</p>
</blockquote>
<p>I think there are a lot of reasons for labelling args.  One can be the Swift/ObjC/SmallTalk approach where the set of labelled args are part of the function "name".  One can be for clarity at the call site.  And another is to allow arguments to be reordered and left out at the call site based on usage.</p>



<a name="492397334"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/463736-bugs/topic/Compiler%20panic%20for%20naming%20mismatch%20between%20type%20def%20and%20use/near/492397334" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/463736-bugs/topic/Compiler.20panic.20for.20naming.20mismatch.20between.20type.20def.20and.20use.html#492397334">(Jan 07 2025 at 22:16)</a>:</h4>
<p>And to be clear - I'm not saying labelled arguments are right for Roc.</p>



<a name="492398275"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/463736-bugs/topic/Compiler%20panic%20for%20naming%20mismatch%20between%20type%20def%20and%20use/near/492398275" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/463736-bugs/topic/Compiler.20panic.20for.20naming.20mismatch.20between.20type.20def.20and.20use.html#492398275">(Jan 07 2025 at 22:25)</a>:</h4>
<p><span class="user-mention silent" data-user-id="781658">Anthony Bullard</span> <a href="#narrow/stream/463736-bugs/topic/Compiler.20panic.20for.20naming.20mismatch.20between.20type.20def.20and.20use/near/492396902">said</a>:</p>
<blockquote>
<p><span class="user-mention silent" data-user-id="461444">Sam Mohr</span> <a href="#narrow/channel/463736-bugs/topic/Compiler.20panic.20for.20naming.20mismatch.20between.20type.20def.20and.20use/near/492395973">said</a>:</p>
<blockquote>
<p><code>button(.)</code></p>
</blockquote>
<p>What if the function arg was....optional?</p>
</blockquote>
<p>optional args are a deep topic. I'm happy to talk about it but I've thought about it a lot over the years and I keep coming back to the conclusion that they sound like a good idea but actually just lead to both worse APIs and also a worse experience for API designers</p>



<a name="492398459"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/463736-bugs/topic/Compiler%20panic%20for%20naming%20mismatch%20between%20type%20def%20and%20use/near/492398459" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/463736-bugs/topic/Compiler.20panic.20for.20naming.20mismatch.20between.20type.20def.20and.20use.html#492398459">(Jan 07 2025 at 22:26)</a>:</h4>
<p>I think that's true - but I think either optional args or optional record fields are needed in the language</p>



<a name="492398503"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/463736-bugs/topic/Compiler%20panic%20for%20naming%20mismatch%20between%20type%20def%20and%20use/near/492398503" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/463736-bugs/topic/Compiler.20panic.20for.20naming.20mismatch.20between.20type.20def.20and.20use.html#492398503">(Jan 07 2025 at 22:26)</a>:</h4>
<p>Or most UI libraries will be very verbose</p>



<a name="492398513"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/463736-bugs/topic/Compiler%20panic%20for%20naming%20mismatch%20between%20type%20def%20and%20use/near/492398513" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/463736-bugs/topic/Compiler.20panic.20for.20naming.20mismatch.20between.20type.20def.20and.20use.html#492398513">(Jan 07 2025 at 22:26)</a>:</h4>
<p>But I could be wrong</p>



<a name="492398524"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/463736-bugs/topic/Compiler%20panic%20for%20naming%20mismatch%20between%20type%20def%20and%20use/near/492398524" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/463736-bugs/topic/Compiler.20panic.20for.20naming.20mismatch.20between.20type.20def.20and.20use.html#492398524">(Jan 07 2025 at 22:26)</a>:</h4>
<p>I'm not sure what use case they are needed for that terse builders can't handle</p>



<a name="492398550"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/463736-bugs/topic/Compiler%20panic%20for%20naming%20mismatch%20between%20type%20def%20and%20use/near/492398550" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/463736-bugs/topic/Compiler.20panic.20for.20naming.20mismatch.20between.20type.20def.20and.20use.html#492398550">(Jan 07 2025 at 22:26)</a>:</h4>
<p>I know flutter couldn't work (in it's current design) without them</p>



<a name="492398551"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/463736-bugs/topic/Compiler%20panic%20for%20naming%20mismatch%20between%20type%20def%20and%20use/near/492398551" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/463736-bugs/topic/Compiler.20panic.20for.20naming.20mismatch.20between.20type.20def.20and.20use.html#492398551">(Jan 07 2025 at 22:26)</a>:</h4>
<p>Okay, we can write up an experiment</p>



<a name="492398643"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/463736-bugs/topic/Compiler%20panic%20for%20naming%20mismatch%20between%20type%20def%20and%20use/near/492398643" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/463736-bugs/topic/Compiler.20panic.20for.20naming.20mismatch.20between.20type.20def.20and.20use.html#492398643">(Jan 07 2025 at 22:27)</a>:</h4>
<p><span class="user-mention silent" data-user-id="461444">Sam Mohr</span> <a href="#narrow/channel/463736-bugs/topic/Compiler.20panic.20for.20naming.20mismatch.20between.20type.20def.20and.20use/near/492398524">said</a>:</p>
<blockquote>
<p>terse builders</p>
</blockquote>
<p>This sounds like magic</p>



<a name="492398766"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/463736-bugs/topic/Compiler%20panic%20for%20naming%20mismatch%20between%20type%20def%20and%20use/near/492398766" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/463736-bugs/topic/Compiler.20panic.20for.20naming.20mismatch.20between.20type.20def.20and.20use.html#492398766">(Jan 07 2025 at 22:28)</a>:</h4>
<p>What Richard is describing is what I'm referring to</p>



<a name="492398781"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/463736-bugs/topic/Compiler%20panic%20for%20naming%20mismatch%20between%20type%20def%20and%20use/near/492398781" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/463736-bugs/topic/Compiler.20panic.20for.20naming.20mismatch.20between.20type.20def.20and.20use.html#492398781">(Jan 07 2025 at 22:28)</a>:</h4>
<p>It seems almost as terse as optional record fields</p>



<a name="492398812"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/463736-bugs/topic/Compiler%20panic%20for%20naming%20mismatch%20between%20type%20def%20and%20use/near/492398812" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/463736-bugs/topic/Compiler.20panic.20for.20naming.20mismatch.20between.20type.20def.20and.20use.html#492398812">(Jan 07 2025 at 22:28)</a>:</h4>
<p>But we _could_ maybe find a way to have a UI library that has functions for elements that all return a root custom type that has all the config functions defined in the module, and then you can config that way</p>



<a name="492398821"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/463736-bugs/topic/Compiler%20panic%20for%20naming%20mismatch%20between%20type%20def%20and%20use/near/492398821" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/463736-bugs/topic/Compiler.20panic.20for.20naming.20mismatch.20between.20type.20def.20and.20use.html#492398821">(Jan 07 2025 at 22:28)</a>:</h4>
<p>Like SwiftUI</p>



<a name="492398928"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/463736-bugs/topic/Compiler%20panic%20for%20naming%20mismatch%20between%20type%20def%20and%20use/near/492398928" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/463736-bugs/topic/Compiler.20panic.20for.20naming.20mismatch.20between.20type.20def.20and.20use.html#492398928">(Jan 07 2025 at 22:29)</a>:</h4>
<div class="codehilite" data-code-language="Ruby"><pre><span></span><code><span class="n">button</span><span class="p">(</span><span class="s2">"Some text"</span><span class="p">)</span>
<span class="w">    </span><span class="o">.</span><span class="n">border</span><span class="p">(</span><span class="no">Colors</span><span class="o">.</span><span class="n">green</span><span class="p">)</span>
<span class="w">    </span><span class="o">.</span><span class="n">enabled</span><span class="p">(</span><span class="n">foo</span><span class="p">)</span>
</code></pre></div>



<a name="492399057"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/463736-bugs/topic/Compiler%20panic%20for%20naming%20mismatch%20between%20type%20def%20and%20use/near/492399057" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/463736-bugs/topic/Compiler.20panic.20for.20naming.20mismatch.20between.20type.20def.20and.20use.html#492399057">(Jan 07 2025 at 22:30)</a>:</h4>
<p>So the "main business" of an element/component happens in it's args.  Anything that would wrap it or change some config of the root type would be a SD function</p>



<a name="492399058"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/463736-bugs/topic/Compiler%20panic%20for%20naming%20mismatch%20between%20type%20def%20and%20use/near/492399058" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/463736-bugs/topic/Compiler.20panic.20for.20naming.20mismatch.20between.20type.20def.20and.20use.html#492399058">(Jan 07 2025 at 22:30)</a>:</h4>
<p>Hmmmm, that works</p>



<a name="492399103"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/463736-bugs/topic/Compiler%20panic%20for%20naming%20mismatch%20between%20type%20def%20and%20use/near/492399103" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/463736-bugs/topic/Compiler.20panic.20for.20naming.20mismatch.20between.20type.20def.20and.20use.html#492399103">(Jan 07 2025 at 22:30)</a>:</h4>
<p>great point!</p>



<a name="492399186"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/463736-bugs/topic/Compiler%20panic%20for%20naming%20mismatch%20between%20type%20def%20and%20use/near/492399186" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/463736-bugs/topic/Compiler.20panic.20for.20naming.20mismatch.20between.20type.20def.20and.20use.html#492399186">(Jan 07 2025 at 22:31)</a>:</h4>
<p>I know Flutter has talked about experimenting with a similar design (to compete with SwiftUI I imagine)</p>



<a name="492399238"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/463736-bugs/topic/Compiler%20panic%20for%20naming%20mismatch%20between%20type%20def%20and%20use/near/492399238" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/463736-bugs/topic/Compiler.20panic.20for.20naming.20mismatch.20between.20type.20def.20and.20use.html#492399238">(Jan 07 2025 at 22:31)</a>:</h4>
<p>Anyway, it would be fun to experiment with this for my hypothetical Clay wrapper</p>



<a name="492399366"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/463736-bugs/topic/Compiler%20panic%20for%20naming%20mismatch%20between%20type%20def%20and%20use/near/492399366" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/463736-bugs/topic/Compiler.20panic.20for.20naming.20mismatch.20between.20type.20def.20and.20use.html#492399366">(Jan 07 2025 at 22:32)</a>:</h4>
<p>Someone with perms should really clean up this thread :-)</p>



<a name="492399391"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/463736-bugs/topic/Compiler%20panic%20for%20naming%20mismatch%20between%20type%20def%20and%20use/near/492399391" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/463736-bugs/topic/Compiler.20panic.20for.20naming.20mismatch.20between.20type.20def.20and.20use.html#492399391">(Jan 07 2025 at 22:32)</a>:</h4>
<p>Sorry <span class="user-mention" data-user-id="518883">@Ian McLerran</span> !</p>



<a name="492399429"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/463736-bugs/topic/Compiler%20panic%20for%20naming%20mismatch%20between%20type%20def%20and%20use/near/492399429" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/463736-bugs/topic/Compiler.20panic.20for.20naming.20mismatch.20between.20type.20def.20and.20use.html#492399429">(Jan 07 2025 at 22:32)</a>:</h4>
<p><span class="user-mention" data-user-id="461444">@Sam Mohr</span> I'd be curious what weaver would look like with this config idea</p>



<a name="492399527"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/463736-bugs/topic/Compiler%20panic%20for%20naming%20mismatch%20between%20type%20def%20and%20use/near/492399527" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/463736-bugs/topic/Compiler.20panic.20for.20naming.20mismatch.20between.20type.20def.20and.20use.html#492399527">(Jan 07 2025 at 22:33)</a>:</h4>
<p>I'll draft something later today, probably tonight</p>



<a name="492399632"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/463736-bugs/topic/Compiler%20panic%20for%20naming%20mismatch%20between%20type%20def%20and%20use/near/492399632" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/463736-bugs/topic/Compiler.20panic.20for.20naming.20mismatch.20between.20type.20def.20and.20use.html#492399632">(Jan 07 2025 at 22:34)</a>:</h4>
<p>Weaver is a great candidate, actually! It could help clean up the number of functions</p>



<a name="492399795"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/463736-bugs/topic/Compiler%20panic%20for%20naming%20mismatch%20between%20type%20def%20and%20use/near/492399795" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/463736-bugs/topic/Compiler.20panic.20for.20naming.20mismatch.20between.20type.20def.20and.20use.html#492399795">(Jan 07 2025 at 22:35)</a>:</h4>
<p>We don't need <code>Opt.str({ short: "v" })</code>, we can do <code>opt(.str().short("v"))</code> or maybe <code>opt().str().short("v")</code></p>



<a name="492399806"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/463736-bugs/topic/Compiler%20panic%20for%20naming%20mismatch%20between%20type%20def%20and%20use/near/492399806" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/463736-bugs/topic/Compiler.20panic.20for.20naming.20mismatch.20between.20type.20def.20and.20use.html#492399806">(Jan 07 2025 at 22:35)</a>:</h4>
<p>I'll mess with it</p>



<a name="492399844"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/463736-bugs/topic/Compiler%20panic%20for%20naming%20mismatch%20between%20type%20def%20and%20use/near/492399844" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/463736-bugs/topic/Compiler.20panic.20for.20naming.20mismatch.20between.20type.20def.20and.20use.html#492399844">(Jan 07 2025 at 22:35)</a>:</h4>
<p>Currently we have 3 times 13 num functions for Opt and Param each</p>



<a name="492401176"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/463736-bugs/topic/Compiler%20panic%20for%20naming%20mismatch%20between%20type%20def%20and%20use/near/492401176" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/463736-bugs/topic/Compiler.20panic.20for.20naming.20mismatch.20between.20type.20def.20and.20use.html#492401176">(Jan 07 2025 at 22:45)</a>:</h4>
<blockquote>
<p>optional args are a deep topic. I'm happy to talk about it but I've thought about it a lot over the years and I keep coming back to the conclusion that they sound like a good idea but actually just lead to both worse APIs and also a worse experience for API designers</p>
</blockquote>
<p>I'm using the optional args extensively in <a href="https://github.com/lukewilliamboswell/plume">https://github.com/lukewilliamboswell/plume</a></p>
<p>I tried a few different API's, but this just felt the nicest. I'm very interested to know if they is another way!</p>



<a name="492401917"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/463736-bugs/topic/Compiler%20panic%20for%20naming%20mismatch%20between%20type%20def%20and%20use/near/492401917" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/463736-bugs/topic/Compiler.20panic.20for.20naming.20mismatch.20between.20type.20def.20and.20use.html#492401917">(Jan 07 2025 at 22:51)</a>:</h4>
<p><span class="user-mention" data-user-id="515757">@Luke Boswell</span> If the <code>Trace</code> type was a Custom Type and we had static dispatch you could just add a <code>with_orientation</code>(or just <code>orientation</code>) function to that module and initialize one with</p>
<div class="codehilite" data-code-language="Ruby"><pre><span></span><code><span class="no">Trace</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="w">    </span><span class="o">.</span><span class="n">orientation</span><span class="p">(</span><span class="no">Horizontal</span><span class="p">)</span>
<span class="w">    </span><span class="o">.</span><span class="n">name</span><span class="p">(</span><span class="s2">"This is my trace!"</span><span class="p">)</span>
<span class="w">    </span><span class="o">.</span><span class="n">bar_width</span><span class="p">(</span><span class="mi">35</span><span class="o">.</span><span class="mi">5</span><span class="p">)</span>
</code></pre></div>
<p>And if you don't want to use any of that other stuff it's just</p>
<div class="codehilite" data-code-language="Ruby"><pre><span></span><code><span class="no">Trace</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</code></pre></div>



<a name="492402089"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/463736-bugs/topic/Compiler%20panic%20for%20naming%20mismatch%20between%20type%20def%20and%20use/near/492402089" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/463736-bugs/topic/Compiler.20panic.20for.20naming.20mismatch.20between.20type.20def.20and.20use.html#492402089">(Jan 07 2025 at 22:52)</a>:</h4>
<p>Ohk... yeah they're all custom types. So we can try this out when we have static dispatch.</p>



<a name="492402154"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/463736-bugs/topic/Compiler%20panic%20for%20naming%20mismatch%20between%20type%20def%20and%20use/near/492402154" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/463736-bugs/topic/Compiler.20panic.20for.20naming.20mismatch.20between.20type.20def.20and.20use.html#492402154">(Jan 07 2025 at 22:52)</a>:</h4>
<p>I'll make a branch of Weaver anyway just to show what the API would look like, but we won't be able to test it, per se</p>



<a name="492404687"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/463736-bugs/topic/Compiler%20panic%20for%20naming%20mismatch%20between%20type%20def%20and%20use/near/492404687" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/463736-bugs/topic/Compiler.20panic.20for.20naming.20mismatch.20between.20type.20def.20and.20use.html#492404687">(Jan 07 2025 at 23:13)</a>:</h4>
<p>yeah, but it's really useful to know if this looks viable</p>



<a name="492404761"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/463736-bugs/topic/Compiler%20panic%20for%20naming%20mismatch%20between%20type%20def%20and%20use/near/492404761" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/463736-bugs/topic/Compiler.20panic.20for.20naming.20mismatch.20between.20type.20def.20and.20use.html#492404761">(Jan 07 2025 at 23:14)</a>:</h4>
<p>Agreed</p>



<a name="492404807"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/463736-bugs/topic/Compiler%20panic%20for%20naming%20mismatch%20between%20type%20def%20and%20use/near/492404807" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/463736-bugs/topic/Compiler.20panic.20for.20naming.20mismatch.20between.20type.20def.20and.20use.html#492404807">(Jan 07 2025 at 23:14)</a>:</h4>
<p>would be a very nice simplification to have static dispatch replacing Abilities, module params, <em>and</em> optional record fields <span aria-label="smiley" class="emoji emoji-1f603" role="img" title="smiley">:smiley:</span></p>



<a name="492414226"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/463736-bugs/topic/Compiler%20panic%20for%20naming%20mismatch%20between%20type%20def%20and%20use/near/492414226" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/463736-bugs/topic/Compiler.20panic.20for.20naming.20mismatch.20between.20type.20def.20and.20use.html#492414226">(Jan 08 2025 at 00:43)</a>:</h4>
<p>Note, default record fields are by no means fundamentally broken. I would assume the fix isn't even that hard (I just don't know that part of the compiler). Fundamentally, we just need to generate more specializations based on if the default is used or not (that or we could generate it at the call sight. Just fill in the full record).</p>



<a name="492414541"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/463736-bugs/topic/Compiler%20panic%20for%20naming%20mismatch%20between%20type%20def%20and%20use/near/492414541" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/463736-bugs/topic/Compiler.20panic.20for.20naming.20mismatch.20between.20type.20def.20and.20use.html#492414541">(Jan 08 2025 at 00:46)</a>:</h4>
<p>I feel like default record fields are a lot simpler and require less API overhead, but builders do work. I find builders quite heavy for simple things like preparing an SQlite transaction for example. Default is deferred transactions, but you can explicitly specify other options.</p>



<a name="492414567"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/463736-bugs/topic/Compiler%20panic%20for%20naming%20mismatch%20between%20type%20def%20and%20use/near/492414567" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/463736-bugs/topic/Compiler.20panic.20for.20naming.20mismatch.20between.20type.20def.20and.20use.html#492414567">(Jan 08 2025 at 00:47)</a>:</h4>
<p>And for a new user I don't want them to think about transaction types at all. So they will just use the default and not even know what it means</p>



<a name="492417183"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/463736-bugs/topic/Compiler%20panic%20for%20naming%20mismatch%20between%20type%20def%20and%20use/near/492417183" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/463736-bugs/topic/Compiler.20panic.20for.20naming.20mismatch.20between.20type.20def.20and.20use.html#492417183">(Jan 08 2025 at 01:14)</a>:</h4>
<p>I'd still like to explore what APIs would look like. It's not just about the implementation, and how the code looks, but also about whether the language primitive is worth it overall in comparison to how the code would look if we didn't have it (in the static dispatch world)</p>



<a name="492417207"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/463736-bugs/topic/Compiler%20panic%20for%20naming%20mismatch%20between%20type%20def%20and%20use/near/492417207" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/463736-bugs/topic/Compiler.20panic.20for.20naming.20mismatch.20between.20type.20def.20and.20use.html#492417207">(Jan 08 2025 at 01:14)</a>:</h4>
<p>plus they have been a recurring source of misunderstanding about how they work</p>



<a name="492417905"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/463736-bugs/topic/Compiler%20panic%20for%20naming%20mismatch%20between%20type%20def%20and%20use/near/492417905" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/463736-bugs/topic/Compiler.20panic.20for.20naming.20mismatch.20between.20type.20def.20and.20use.html#492417905">(Jan 08 2025 at 01:22)</a>:</h4>
<p>another way to say it is: if we already had APIs based around static dispatch, would we accept a proposal to introduce optional record arguments?</p>



<a name="492418094"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/463736-bugs/topic/Compiler%20panic%20for%20naming%20mismatch%20between%20type%20def%20and%20use/near/492418094" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Karl <a href="https://roc-lang.github.io/zulip-export/stream/463736-bugs/topic/Compiler.20panic.20for.20naming.20mismatch.20between.20type.20def.20and.20use.html#492418094">(Jan 08 2025 at 01:25)</a>:</h4>
<p>My issue with the chaining config function approach is that I usually want an immutable struct for stability across the codebase but it has to be mutable for the construction chain to work. I've seen a two struct workaround where one builds up the config and then whatever is finalizing copies the values over to an immutable struct but it's verbose. Is there a fix for this that I don't know about?</p>



<a name="492418239"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/463736-bugs/topic/Compiler%20panic%20for%20naming%20mismatch%20between%20type%20def%20and%20use/near/492418239" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/463736-bugs/topic/Compiler.20panic.20for.20naming.20mismatch.20between.20type.20def.20and.20use.html#492418239">(Jan 08 2025 at 01:27)</a>:</h4>
<p>You could use record builders maybe to enforce that using types?</p>



<a name="492419304"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/463736-bugs/topic/Compiler%20panic%20for%20naming%20mismatch%20between%20type%20def%20and%20use/near/492419304" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/463736-bugs/topic/Compiler.20panic.20for.20naming.20mismatch.20between.20type.20def.20and.20use.html#492419304">(Jan 08 2025 at 01:39)</a>:</h4>
<p><span class="user-mention silent" data-user-id="281383">Richard Feldman</span> <a href="#narrow/stream/463736-bugs/topic/Compiler.20panic.20for.20naming.20mismatch.20between.20type.20def.20and.20use/near/492417207">said</a>:</p>
<blockquote>
<p>plus they have been a recurring source of misunderstanding about how they work</p>
</blockquote>
<p>I strongly feel most of this is due to naming, poor explanations, and bugs rather than anything innate to the feature. (For example we still regularly call them optional record fields when they are actually default value record fields)</p>



<a name="492419342"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/463736-bugs/topic/Compiler%20panic%20for%20naming%20mismatch%20between%20type%20def%20and%20use/near/492419342" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/463736-bugs/topic/Compiler.20panic.20for.20naming.20mismatch.20between.20type.20def.20and.20use.html#492419342">(Jan 08 2025 at 01:39)</a>:</h4>
<p>But I totally agree we should explore other features. I think builder style apis can be great. They just suck for anything simple.</p>



<a name="492420084"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/463736-bugs/topic/Compiler%20panic%20for%20naming%20mismatch%20between%20type%20def%20and%20use/near/492420084" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/463736-bugs/topic/Compiler.20panic.20for.20naming.20mismatch.20between.20type.20def.20and.20use.html#492420084">(Jan 08 2025 at 01:47)</a>:</h4>
<p><span class="user-mention silent" data-user-id="705503">Karl</span> <a href="#narrow/channel/463736-bugs/topic/Compiler.20panic.20for.20naming.20mismatch.20between.20type.20def.20and.20use/near/492418094">said</a>:</p>
<blockquote>
<p>My issue with the chaining config function approach is that I usually want an immutable struct for stability across the codebase but it has to be mutable for the construction chain to work. I've seen a two struct workaround where one builds up the config and then whatever is finalizing copies the values over to an immutable struct but it's verbose. Is there a fix for this that I don't know about?</p>
</blockquote>
<p>in Roc they'd all be (semantically) immutable, e.g. </p>
<div class="codehilite" data-code-language="Ruby"><pre><span></span><code><span class="n">button</span><span class="p">(</span><span class="s2">"Done"</span><span class="p">)</span><span class="o">.</span><span class="n">border</span><span class="p">(</span><span class="n">green</span><span class="p">)</span><span class="o">.</span><span class="n">enabled</span><span class="p">(</span><span class="n">is_enabled</span><span class="p">)</span>
</code></pre></div>
<p>the types of these functions would be something like:</p>
<div class="codehilite" data-code-language="Ruby"><pre><span></span><code><span class="no">Elem</span><span class="o">.</span><span class="n">button</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="no">Str</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="no">Elem</span>

<span class="no">Elem</span><span class="o">.</span><span class="n">border</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="no">Elem</span><span class="p">,</span><span class="w"> </span><span class="no">Color</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="no">Elem</span>

<span class="no">Elem</span><span class="o">.</span><span class="n">enabled</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="no">Elem</span><span class="p">,</span><span class="w"> </span><span class="no">Bool</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="no">Elem</span>
</code></pre></div>



<a name="492420182"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/463736-bugs/topic/Compiler%20panic%20for%20naming%20mismatch%20between%20type%20def%20and%20use/near/492420182" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Karl <a href="https://roc-lang.github.io/zulip-export/stream/463736-bugs/topic/Compiler.20panic.20for.20naming.20mismatch.20between.20type.20def.20and.20use.html#492420182">(Jan 08 2025 at 01:48)</a>:</h4>
<p>But the Elem that's actually holding all the values would still be mutable, yes?</p>



<a name="492420237"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/463736-bugs/topic/Compiler%20panic%20for%20naming%20mismatch%20between%20type%20def%20and%20use/near/492420237" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Karl <a href="https://roc-lang.github.io/zulip-export/stream/463736-bugs/topic/Compiler.20panic.20for.20naming.20mismatch.20between.20type.20def.20and.20use.html#492420237">(Jan 08 2025 at 01:49)</a>:</h4>
<p>Or are we producing new immutable Elems that are partially initialized?</p>



<a name="492420655"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/463736-bugs/topic/Compiler%20panic%20for%20naming%20mismatch%20between%20type%20def%20and%20use/near/492420655" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/463736-bugs/topic/Compiler.20panic.20for.20naming.20mismatch.20between.20type.20def.20and.20use.html#492420655">(Jan 08 2025 at 01:53)</a>:</h4>
<p>Roc doesn't have semantically mutable values <span aria-label="big smile" class="emoji emoji-1f604" role="img" title="big smile">:big_smile:</span></p>



<a name="492420732"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/463736-bugs/topic/Compiler%20panic%20for%20naming%20mismatch%20between%20type%20def%20and%20use/near/492420732" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/463736-bugs/topic/Compiler.20panic.20for.20naming.20mismatch.20between.20type.20def.20and.20use.html#492420732">(Jan 08 2025 at 01:54)</a>:</h4>
<p><a href="https://www.roc-lang.org/functional#opportunistic-mutation">https://www.roc-lang.org/functional#opportunistic-mutation</a></p>



<a name="492459546"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/463736-bugs/topic/Compiler%20panic%20for%20naming%20mismatch%20between%20type%20def%20and%20use/near/492459546" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/463736-bugs/topic/Compiler.20panic.20for.20naming.20mismatch.20between.20type.20def.20and.20use.html#492459546">(Jan 08 2025 at 08:57)</a>:</h4>
<p>Here's my experimental results for a Weaver API using terse builders: <a href="https://gist.github.com/smores56/dc7b37f73114df11d28cd6a148987dea#file-weaver-builders-roc">https://gist.github.com/smores56/dc7b37f73114df11d28cd6a148987dea#file-weaver-builders-roc</a></p>
<div class="codehilite" data-code-language="Elm"><pre><span></span><code><span class="nv">app</span><span class="w"> </span><span class="p">[</span><span class="nv">main</span><span class="err">!</span><span class="p">]</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nv">cli</span><span class="nf">:</span><span class="w"> </span><span class="nv">platform</span><span class="w"> </span><span class="s">"&lt;basic-cli&gt;"</span><span class="w"> </span><span class="p">}</span>

<span class="kn">import</span><span class="w"> </span><span class="nc">weaver.Opt</span>
<span class="kn">import</span><span class="w"> </span><span class="nc">weaver.Cli</span>
<span class="kn">import</span><span class="w"> </span><span class="nc">cli.Stdout</span>

<span class="nv">main</span><span class="err">!</span><span class="w"> </span><span class="nf">=</span><span class="w"> </span><span class="nf">|</span><span class="nv">args</span><span class="nf">|</span>
<span class="w">    </span><span class="nv">data</span><span class="w"> </span><span class="nf">=</span>
<span class="w">        </span><span class="nv">cli_parser</span><span class="nf">.</span><span class="nv">parse_or_display_message</span><span class="p">(</span><span class="nv">args</span><span class="p">)</span>
<span class="w">        </span><span class="nf">.</span><span class="nv">on_err</span><span class="err">!</span><span class="p">(</span><span class="nf">|</span><span class="nv">message</span><span class="nf">|</span>
<span class="w">            </span><span class="kt">Stdout</span><span class="nf">.</span><span class="nv">line</span><span class="err">!</span><span class="p">(</span><span class="nv">message</span><span class="p">)</span><span class="err">?</span>
<span class="w">            </span><span class="kt">Err</span><span class="p">(</span><span class="kt">Exit</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="s">""</span><span class="p">)))</span>
<span class="w">        </span><span class="p">)</span><span class="err">?</span>

<span class="w">    </span><span class="kt">Stdout</span><span class="nf">.</span><span class="nv">line</span><span class="err">!</span><span class="p">(</span>
<span class="w">        </span><span class="s">"""</span>
<span class="s">        Successfully parsed! Here's what I got:</span>

<span class="s">        ${data.to_str()}</span>
<span class="s">        """</span>
<span class="w">    </span><span class="p">)</span><span class="err">?</span>

<span class="w">    </span><span class="kt">Ok</span><span class="p">({})</span>

<span class="nv">cli_parser</span><span class="w"> </span><span class="nf">=</span>
<span class="w">    </span><span class="p">{</span><span class="w"> </span><span class="kt">Cli</span><span class="nf">.</span><span class="nv">weave</span><span class="w"> </span><span class="nf">&lt;-</span>
<span class="w">        </span><span class="nv">force</span><span class="nf">:</span><span class="w"> </span><span class="kt">Opt</span><span class="nf">.</span><span class="nv">flag</span><span class="p">(</span><span class="nf">.</span><span class="nv">short</span><span class="p">(</span><span class="s">"f"</span><span class="p">)</span><span class="nf">.</span><span class="nv">help</span><span class="p">(</span><span class="s">"Force the task to complete."</span><span class="p">)),</span>
<span class="w">        </span><span class="nv">alpha</span><span class="nf">:</span><span class="w"> </span><span class="kt">Opt</span><span class="nf">.</span><span class="nv">single</span><span class="p">(</span>
<span class="w">            </span><span class="nf">.</span><span class="nv">u64</span><span class="p">()</span>
<span class="w">            </span><span class="nf">.</span><span class="nv">short</span><span class="p">(</span><span class="s">"a"</span><span class="p">)</span>
<span class="w">            </span><span class="nf">.</span><span class="nv">help</span><span class="p">(</span><span class="s">"Set the alpha level."</span><span class="p">)</span>
<span class="w">            </span><span class="nf">.</span><span class="nv">default_fn</span><span class="p">(</span><span class="nf">||</span><span class="w"> </span><span class="mi">1</span><span class="nf">.</span><span class="nv">left_shift_by</span><span class="p">(</span><span class="mi">7</span><span class="p">)),</span>
<span class="w">        </span><span class="p">),</span>
<span class="w">        </span><span class="nv">files</span><span class="nf">:</span><span class="w"> </span><span class="kt">Param</span><span class="nf">.</span><span class="nv">list</span><span class="p">(</span><span class="nf">.</span><span class="nv">str</span><span class="p">()</span><span class="nf">.</span><span class="nv">name</span><span class="p">(</span><span class="s">"files"</span><span class="p">)</span><span class="nf">.</span><span class="nv">help</span><span class="p">(</span><span class="s">"The rest of the files."</span><span class="p">)),</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="nf">.</span><span class="nv">finish</span><span class="p">({</span>
<span class="w">        </span><span class="nv">name</span><span class="nf">:</span><span class="w"> </span><span class="s">"basic"</span><span class="p">,</span>
<span class="w">        </span><span class="nv">version</span><span class="nf">:</span><span class="w"> </span><span class="s">"v0.0.1"</span><span class="p">,</span>
<span class="w">        </span><span class="nv">authors</span><span class="nf">:</span><span class="w"> </span><span class="p">[</span><span class="s">"Some One &lt;some.one@mail.com&gt;"</span><span class="p">],</span>
<span class="w">        </span><span class="nv">description</span><span class="nf">:</span><span class="w"> </span><span class="s">"This is a basic example of what you can build with Weaver"</span><span class="p">,</span>
<span class="w">    </span><span class="p">})</span>
<span class="w">    </span><span class="nf">.</span><span class="nv">assert_valid</span><span class="p">()</span>
</code></pre></div>



<a name="492459801"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/463736-bugs/topic/Compiler%20panic%20for%20naming%20mismatch%20between%20type%20def%20and%20use/near/492459801" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/463736-bugs/topic/Compiler.20panic.20for.20naming.20mismatch.20between.20type.20def.20and.20use.html#492459801">(Jan 08 2025 at 08:59)</a>:</h4>
<p>In the linked gist, I put most of the code we'd need to parse an <code>Opt</code>. This API just plugs into the existing Weaver codebase, so it's not much of a change for this to work</p>



<a name="492459863"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/463736-bugs/topic/Compiler%20panic%20for%20naming%20mismatch%20between%20type%20def%20and%20use/near/492459863" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/463736-bugs/topic/Compiler.20panic.20for.20naming.20mismatch.20between.20type.20def.20and.20use.html#492459863">(Jan 08 2025 at 08:59)</a>:</h4>
<p>Some nice things:</p>



<a name="492460069"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/463736-bugs/topic/Compiler%20panic%20for%20naming%20mismatch%20between%20type%20def%20and%20use/near/492460069" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/463736-bugs/topic/Compiler.20panic.20for.20naming.20mismatch.20between.20type.20def.20and.20use.html#492460069">(Jan 08 2025 at 09:00)</a>:</h4>
<p>To parse a U64 arg, we can shorten the function</p>
<div class="codehilite" data-code-language="Elm"><pre><span></span><code><span class="nf">|</span><span class="nv">arg</span><span class="nf">|</span>
<span class="w">    </span><span class="nv">str</span><span class="w"> </span><span class="nf">=</span><span class="w"> </span><span class="nv">arg</span><span class="nf">.</span><span class="nv">as_str</span><span class="p">()</span><span class="err">?</span>
<span class="w">    </span><span class="nv">str</span><span class="nf">.</span><span class="nv">to_u64</span><span class="p">()</span>
</code></pre></div>
<p>to the following with methods and <code>Result.try</code></p>
<div class="codehilite" data-code-language="Elm"><pre><span></span><code><span class="nv">u64</span><span class="w"> </span><span class="nf">:</span><span class="w"> </span><span class="kt">ArgTypeSelector</span><span class="w"> </span><span class="nf">-&gt;</span><span class="w"> </span><span class="kt">ArgValueParser</span><span class="w"> </span><span class="kt">U64</span>
<span class="nv">u64</span><span class="w"> </span><span class="nf">=</span><span class="w"> </span><span class="nf">|</span><span class="kt">ArgTypeSelector</span><span class="nf">.</span><span class="p">()</span><span class="nf">|</span>
<span class="w">    </span><span class="kt">ArgValueParser</span><span class="nf">.</span><span class="p">({</span><span class="w"> </span><span class="nv">type_name</span><span class="nf">:</span><span class="w"> </span><span class="s">"u64"</span><span class="p">,</span><span class="w"> </span><span class="nv">parser</span><span class="nf">:</span><span class="w"> </span><span class="nf">.</span><span class="nv">as_str</span><span class="p">()</span><span class="nf">.</span><span class="nv">try</span><span class="p">(</span><span class="nf">.</span><span class="nv">to_u64</span><span class="p">())</span><span class="w"> </span><span class="p">})</span>
</code></pre></div>



<a name="492460273"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/463736-bugs/topic/Compiler%20panic%20for%20naming%20mismatch%20between%20type%20def%20and%20use/near/492460273" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/463736-bugs/topic/Compiler.20panic.20for.20naming.20mismatch.20between.20type.20def.20and.20use.html#492460273">(Jan 08 2025 at 09:02)</a>:</h4>
<p>We can now ensure that either <code>short</code> or <code>long</code> <strong>must</strong> be called, whereas that's not possible to handle nicely in a single record with optional fields</p>



<a name="492460373"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/463736-bugs/topic/Compiler%20panic%20for%20naming%20mismatch%20between%20type%20def%20and%20use/near/492460373" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/463736-bugs/topic/Compiler.20panic.20for.20naming.20mismatch.20between.20type.20def.20and.20use.html#492460373">(Jan 08 2025 at 09:02)</a>:</h4>
<p>Since <code>{ short ?? Str, long ?? Str }</code> has both as optional to allow either to be passed, but then both could be empty</p>



<a name="492460702"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/463736-bugs/topic/Compiler%20panic%20for%20naming%20mismatch%20between%20type%20def%20and%20use/near/492460702" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/463736-bugs/topic/Compiler.20panic.20for.20naming.20mismatch.20between.20type.20def.20and.20use.html#492460702">(Jan 08 2025 at 09:04)</a>:</h4>
<p>We can ensure <code>short</code> or <code>long</code> are empty by making the builder function passed to <code>Opt.single(...)</code> go through a few types:</p>
<ul>
<li>Start with a <code>ArgTypeSelector</code> that has <code>str</code> or <code>u64</code> methods</li>
<li>That produces a <code>ArgValueParser a</code>, which only has <code>short</code> and <code>long</code> methods</li>
<li>That then produces the required <code>OptionConfigParams a</code>, which can further receive <code>short</code>, <code>long</code>, <code>default</code>, etc.</li>
</ul>



<a name="492460959"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/463736-bugs/topic/Compiler%20panic%20for%20naming%20mismatch%20between%20type%20def%20and%20use/near/492460959" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/463736-bugs/topic/Compiler.20panic.20for.20naming.20mismatch.20between.20type.20def.20and.20use.html#492460959">(Jan 08 2025 at 09:05)</a>:</h4>
<p>I can't really type check this code, but I'm 99% sure that all of this will work with the planned static dispatch and custom types behavior</p>



<a name="492461251"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/463736-bugs/topic/Compiler%20panic%20for%20naming%20mismatch%20between%20type%20def%20and%20use/near/492461251" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/463736-bugs/topic/Compiler.20panic.20for.20naming.20mismatch.20between.20type.20def.20and.20use.html#492461251">(Jan 08 2025 at 09:07)</a>:</h4>
<p>Anyway, there might be a <em>slight</em> aesthetic drop? But otherwise this seems like an improved API over optional record fields to me, since you get more opportunity for type safety with basically the same number of characters</p>



<a name="492461345"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/463736-bugs/topic/Compiler%20panic%20for%20naming%20mismatch%20between%20type%20def%20and%20use/near/492461345" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/463736-bugs/topic/Compiler.20panic.20for.20naming.20mismatch.20between.20type.20def.20and.20use.html#492461345">(Jan 08 2025 at 09:08)</a>:</h4>
<p>The one cost I don't know how to fix is field name punning, but I don't think syntax sugar is important for that</p>



<a name="492461408"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/463736-bugs/topic/Compiler%20panic%20for%20naming%20mismatch%20between%20type%20def%20and%20use/near/492461408" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/463736-bugs/topic/Compiler.20panic.20for.20naming.20mismatch.20between.20type.20def.20and.20use.html#492461408">(Jan 08 2025 at 09:08)</a>:</h4>
<p>Though it's something we could consider</p>



<a name="492461421"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/463736-bugs/topic/Compiler%20panic%20for%20naming%20mismatch%20between%20type%20def%20and%20use/near/492461421" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/463736-bugs/topic/Compiler.20panic.20for.20naming.20mismatch.20between.20type.20def.20and.20use.html#492461421">(Jan 08 2025 at 09:08)</a>:</h4>
<p>Do you have to call things in the correct order?</p>



<a name="492461488"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/463736-bugs/topic/Compiler%20panic%20for%20naming%20mismatch%20between%20type%20def%20and%20use/near/492461488" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/463736-bugs/topic/Compiler.20panic.20for.20naming.20mismatch.20between.20type.20def.20and.20use.html#492461488">(Jan 08 2025 at 09:08)</a>:</h4>
<p>This API requires you to call in certain groups: type, then arg name, then everything else</p>



<a name="492461522"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/463736-bugs/topic/Compiler%20panic%20for%20naming%20mismatch%20between%20type%20def%20and%20use/near/492461522" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/463736-bugs/topic/Compiler.20panic.20for.20naming.20mismatch.20between.20type.20def.20and.20use.html#492461522">(Jan 08 2025 at 09:09)</a>:</h4>
<p>But you could definitely make it handle arbitrary order</p>



<a name="492461530"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/463736-bugs/topic/Compiler%20panic%20for%20naming%20mismatch%20between%20type%20def%20and%20use/near/492461530" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/463736-bugs/topic/Compiler.20panic.20for.20naming.20mismatch.20between.20type.20def.20and.20use.html#492461530">(Jan 08 2025 at 09:09)</a>:</h4>
<p>Like </p>
<div class="codehilite"><pre><span></span><code>Opt.single(
    .u64()
    .short(&quot;a&quot;)
    ...
</code></pre></div>
<p>Versus</p>
<div class="codehilite"><pre><span></span><code>Opt.single(
    .short(&quot;a&quot;)
    .u64()
    ...
</code></pre></div>



<a name="492461567"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/463736-bugs/topic/Compiler%20panic%20for%20naming%20mismatch%20between%20type%20def%20and%20use/near/492461567" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/463736-bugs/topic/Compiler.20panic.20for.20naming.20mismatch.20between.20type.20def.20and.20use.html#492461567">(Jan 08 2025 at 09:09)</a>:</h4>
<p>I required ordering because I thought it would improve readability</p>



<a name="492461591"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/463736-bugs/topic/Compiler%20panic%20for%20naming%20mismatch%20between%20type%20def%20and%20use/near/492461591" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/463736-bugs/topic/Compiler.20panic.20for.20naming.20mismatch.20between.20type.20def.20and.20use.html#492461591">(Jan 08 2025 at 09:09)</a>:</h4>
<p>I like it</p>



<a name="492461607"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/463736-bugs/topic/Compiler%20panic%20for%20naming%20mismatch%20between%20type%20def%20and%20use/near/492461607" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/463736-bugs/topic/Compiler.20panic.20for.20naming.20mismatch.20between.20type.20def.20and.20use.html#492461607">(Jan 08 2025 at 09:09)</a>:</h4>
<p>We could require the type at the end</p>



<a name="492462654"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/463736-bugs/topic/Compiler%20panic%20for%20naming%20mismatch%20between%20type%20def%20and%20use/near/492462654" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/463736-bugs/topic/Compiler.20panic.20for.20naming.20mismatch.20between.20type.20def.20and.20use.html#492462654">(Jan 08 2025 at 09:15)</a>:</h4>
<p>A weakness of this API stemming from an intentional weakness of the API: I couldn't get just <code>opt(.single().u64())</code> to work because we'd need to allow representing HKTs. This is now another place where HKTs are useful, but they're still not necessary for a good API</p>



<a name="492531230"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/463736-bugs/topic/Compiler%20panic%20for%20naming%20mismatch%20between%20type%20def%20and%20use/near/492531230" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/463736-bugs/topic/Compiler.20panic.20for.20naming.20mismatch.20between.20type.20def.20and.20use.html#492531230">(Jan 08 2025 at 15:43)</a>:</h4>
<p>How hard would this to be rework using the SD-style approach I laid out?  Where the required args are in the main constructor, and all optionals are set in SD funcs?</p>



<a name="492536591"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/463736-bugs/topic/Compiler%20panic%20for%20naming%20mismatch%20between%20type%20def%20and%20use/near/492536591" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ian McLerran <a href="https://roc-lang.github.io/zulip-export/stream/463736-bugs/topic/Compiler.20panic.20for.20naming.20mismatch.20between.20type.20def.20and.20use.html#492536591">(Jan 08 2025 at 16:11)</a>:</h4>
<p>Roc-ai is already doing something similar to this for client configuration, albeit without PNC or static dispatch, so not exactly the same…</p>
<div class="codehilite" data-code-language="CoffeeScript"><pre><span></span><code><span class="nv">client</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Client</span><span class="p">.</span><span class="nx">init</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">apiKey</span><span class="w"> </span><span class="p">}</span>
<span class="w">    </span><span class="o">|&gt;</span><span class="w"> </span><span class="nx">Client</span><span class="p">.</span><span class="nx">setUrl</span><span class="w"> </span><span class="nx">url</span>
<span class="w">    </span><span class="o">|&gt;</span><span class="w"> </span><span class="nx">Client</span><span class="p">.</span><span class="nx">setModel</span><span class="w"> </span><span class="nx">model</span>
<span class="w">    </span><span class="o">|&gt;</span><span class="w"> </span><span class="nx">Client</span><span class="p">.</span><span class="nx">setProviderOrder</span><span class="w"> </span><span class="nx">providers</span>
<span class="w">    </span><span class="o">|&gt;</span><span class="w"> </span><span class="nx">Client</span><span class="p">.</span><span class="nx">setTemperature</span><span class="w"> </span><span class="nx">temp</span>
</code></pre></div>
<p>The init function takes a record with 1 required field and 17 optional ones, but then there are 18 corresponding set functions. That makes for a very bloated signature for the init function. At least in such an extreme example (similar to weaver) I think chained function calls really is cleaner than optional record fields.</p>
<p>Additionally, the init function actually <del>has to call </del> <em>calls</em> the setter functions itself for 6 of the params, because the parameter accepted in as an argument is actually a different type (simplified) than what is actually stored, so optional record fields can’t handle this type conversion at all.</p>



<a name="492537545"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/463736-bugs/topic/Compiler%20panic%20for%20naming%20mismatch%20between%20type%20def%20and%20use/near/492537545" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/463736-bugs/topic/Compiler.20panic.20for.20naming.20mismatch.20between.20type.20def.20and.20use.html#492537545">(Jan 08 2025 at 16:16)</a>:</h4>
<p>So that could be with PNC/SD:</p>
<div class="codehilite" data-code-language="Ruby"><pre><span></span><code><span class="n">client</span><span class="w"> </span><span class="o">=</span>
<span class="w">    </span><span class="no">Client</span><span class="o">.</span><span class="n">init</span><span class="p">(</span><span class="n">apiKey</span><span class="p">)</span>
<span class="w">        </span><span class="o">.</span><span class="n">setUrl</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
<span class="w">        </span><span class="o">.</span><span class="n">setModel</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>
<span class="w">        </span><span class="o">.</span><span class="n">setProviderOrder</span><span class="p">(</span><span class="n">providers</span><span class="p">)</span>
<span class="w">        </span><span class="o">.</span><span class="n">setTemperature</span><span class="p">(</span><span class="n">temp</span><span class="p">)</span>
</code></pre></div>



<a name="492537744"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/463736-bugs/topic/Compiler%20panic%20for%20naming%20mismatch%20between%20type%20def%20and%20use/near/492537744" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/463736-bugs/topic/Compiler.20panic.20for.20naming.20mismatch.20between.20type.20def.20and.20use.html#492537744">(Jan 08 2025 at 16:17)</a>:</h4>
<p>The big advantage of optional record fields here is performance.  In this case you would be avoiding four function calls</p>



<a name="492538082"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/463736-bugs/topic/Compiler%20panic%20for%20naming%20mismatch%20between%20type%20def%20and%20use/near/492538082" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ian McLerran <a href="https://roc-lang.github.io/zulip-export/stream/463736-bugs/topic/Compiler.20panic.20for.20naming.20mismatch.20between.20type.20def.20and.20use.html#492538082">(Jan 08 2025 at 16:19)</a>:</h4>
<p>Yeah, if you have to create 18 stack frames with 18 copies of client, that’s a lot less optimal than just one…</p>



<a name="492538205"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/463736-bugs/topic/Compiler%20panic%20for%20naming%20mismatch%20between%20type%20def%20and%20use/near/492538205" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/463736-bugs/topic/Compiler.20panic.20for.20naming.20mismatch.20between.20type.20def.20and.20use.html#492538205">(Jan 08 2025 at 16:20)</a>:</h4>
<p>It depends on inlining</p>



<a name="492538241"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/463736-bugs/topic/Compiler%20panic%20for%20naming%20mismatch%20between%20type%20def%20and%20use/near/492538241" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/463736-bugs/topic/Compiler.20panic.20for.20naming.20mismatch.20between.20type.20def.20and.20use.html#492538241">(Jan 08 2025 at 16:20)</a>:</h4>
<p>Which I have no idea if/when LLVM would inline these</p>



<a name="492538323"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/463736-bugs/topic/Compiler%20panic%20for%20naming%20mismatch%20between%20type%20def%20and%20use/near/492538323" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/463736-bugs/topic/Compiler.20panic.20for.20naming.20mismatch.20between.20type.20def.20and.20use.html#492538323">(Jan 08 2025 at 16:21)</a>:</h4>
<p>If they are reliably inlined, there is probably no perf difference with --optimize</p>



<a name="492548877"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/463736-bugs/topic/Compiler%20panic%20for%20naming%20mismatch%20between%20type%20def%20and%20use/near/492548877" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ian McLerran <a href="https://roc-lang.github.io/zulip-export/stream/463736-bugs/topic/Compiler.20panic.20for.20naming.20mismatch.20between.20type.20def.20and.20use.html#492548877">(Jan 08 2025 at 17:07)</a>:</h4>
<p><span class="user-mention silent" data-user-id="281383">Richard Feldman</span> <a href="#narrow/stream/463736-bugs/topic/Compiler.20panic.20for.20naming.20mismatch.20between.20type.20def.20and.20use/near/492404807">said</a>:</p>
<blockquote>
<p>would be a very nice simplification to have static dispatch replacing Abilities, module params, <em>and</em> optional record fields <span aria-label="smiley" class="emoji emoji-1f603" role="img" title="smiley">:smiley:</span></p>
</blockquote>
<p>Wait how will/could SD replace module params? Zulip link anyone? <span aria-label="fingers crossed" class="emoji emoji-1f91e" role="img" title="fingers crossed">:fingers_crossed:</span></p>



<a name="492550914"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/463736-bugs/topic/Compiler%20panic%20for%20naming%20mismatch%20between%20type%20def%20and%20use/near/492550914" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/463736-bugs/topic/Compiler.20panic.20for.20naming.20mismatch.20between.20type.20def.20and.20use.html#492550914">(Jan 08 2025 at 17:17)</a>:</h4>
<p><span class="user-mention silent" data-user-id="781658">Anthony Bullard</span> <a href="#narrow/stream/463736-bugs/topic/Compiler.20panic.20for.20naming.20mismatch.20between.20type.20def.20and.20use/near/492538323">said</a>:</p>
<blockquote>
<p>If they are reliably inlined, there is probably no perf difference with --optimize</p>
</blockquote>
<p>As much as llvm inlines everything, I would expect this to still manifest some copies (especially with more complex types). At the same time, I would be quite surprised if that generally affects perf.</p>



<a name="492551010"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/463736-bugs/topic/Compiler%20panic%20for%20naming%20mismatch%20between%20type%20def%20and%20use/near/492551010" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/463736-bugs/topic/Compiler.20panic.20for.20naming.20mismatch.20between.20type.20def.20and.20use.html#492551010">(Jan 08 2025 at 17:17)</a>:</h4>
<p>As a simple example, refcounting between copies likely forces llvm to copy.</p>



<a name="492565635"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/463736-bugs/topic/Compiler%20panic%20for%20naming%20mismatch%20between%20type%20def%20and%20use/near/492565635" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/463736-bugs/topic/Compiler.20panic.20for.20naming.20mismatch.20between.20type.20def.20and.20use.html#492565635">(Jan 08 2025 at 18:53)</a>:</h4>
<p><span class="user-mention" data-user-id="518883">@Ian McLerran</span> check out Richard's recent Realworld application impl. Having tried to use module params vs. just a record that saves the relevant effectful closures, it seems like the latter with SD is simpler and has fewer sharp corners like testing and all. <a class="message-link" href="/#narrow/channel/304902-show-and-tell/topic/roc-realworld.20initial.20exploration/near/491565735">#show and tell &gt; roc-realworld initial exploration @ 💬</a></p>



<hr><p>Last updated: Nov 01 2025 at 12:13 UTC</p>
</html>