<html>
<head><meta charset="utf-8"><title>Regressions (segfaults) after the latest PR (ranges) · bugs · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://roc-lang.github.io/zulip-export/stream/463736-bugs/index.html">bugs</a></h2>
<h3>Topic: <a href="https://roc-lang.github.io/zulip-export/stream/463736-bugs/topic/Regressions.20.28segfaults.29.20after.20the.20latest.20PR.20.28ranges.29.html">Regressions (segfaults) after the latest PR (ranges)</a></h3>

<hr>

<base href="https://roc.zulipchat.com">

<head><link href="https://roc-lang.github.io/zulip-export/style.css" rel="stylesheet"></head>

<a name="562157252"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/463736-bugs/topic/Regressions%20%28segfaults%29%20after%20the%20latest%20PR%20%28ranges%29/near/562157252" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthieu Pizenberg <a href="https://roc-lang.github.io/zulip-export/stream/463736-bugs/topic/Regressions.20.28segfaults.29.20after.20the.20latest.20PR.20.28ranges.29.html#562157252">(Dec 05 2025 at 18:00)</a>:</h4>
<p>It seems like my AoC solution for day 1 is now segfaulting after the ranges PR. Should I look into it or is it something you are aware of already?</p>



<a name="562159696"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/463736-bugs/topic/Regressions%20%28segfaults%29%20after%20the%20latest%20PR%20%28ranges%29/near/562159696" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthieu Pizenberg <a href="https://roc-lang.github.io/zulip-export/stream/463736-bugs/topic/Regressions.20.28segfaults.29.20after.20the.20latest.20PR.20.28ranges.29.html#562159696">(Dec 05 2025 at 18:17)</a>:</h4>
<p>So the regression is related to the one-liner for my <code>print!</code> function.</p>
<div class="codehilite" data-code-language="Ruby"><pre><span></span><code><span class="nb">print</span><span class="o">!</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">|</span><span class="n">msg</span><span class="o">|</span><span class="w"> </span><span class="n">msg</span><span class="o">.</span><span class="n">split_on</span><span class="p">(</span><span class="s2">"</span><span class="se">\n</span><span class="s2">"</span><span class="p">)</span><span class="o">.</span><span class="n">for_each!</span><span class="p">(</span><span class="no">Stdout</span><span class="o">.</span><span class="n">line!</span><span class="p">)</span>
</code></pre></div>
<p>Before the latest PR, this works. But after the ranges PR, I now have to write it again with a for loop to not trigger a segfault. <span class="user-mention" data-user-id="281383">@Richard Feldman</span> I believe you had fixed that issue in another PR a few days back. Some of your changes in the range PR might have re-introduced some negative effect on this line.</p>



<a name="562162555"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/463736-bugs/topic/Regressions%20%28segfaults%29%20after%20the%20latest%20PR%20%28ranges%29/near/562162555" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthieu Pizenberg <a href="https://roc-lang.github.io/zulip-export/stream/463736-bugs/topic/Regressions.20.28segfaults.29.20after.20the.20latest.20PR.20.28ranges.29.html#562162555">(Dec 05 2025 at 18:37)</a>:</h4>
<p>Hum actually it’s not just that. Context matters. I’m looking into it more and trying to make another minimal reproducible example.</p>



<a name="562167206"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/463736-bugs/topic/Regressions%20%28segfaults%29%20after%20the%20latest%20PR%20%28ranges%29/near/562167206" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthieu Pizenberg <a href="https://roc-lang.github.io/zulip-export/stream/463736-bugs/topic/Regressions.20.28segfaults.29.20after.20the.20latest.20PR.20.28ranges.29.html#562167206">(Dec 05 2025 at 19:06)</a>:</h4>
<p>Ok, this is the weirdest bug I’ve ever seen. Here is my minimal example with a segfault on main (4766997).</p>
<div class="codehilite" data-code-language="Ruby"><pre><span></span><code><span class="n">app</span><span class="w"> </span><span class="o">[</span><span class="n">main!</span><span class="o">]</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="ss">pf</span><span class="p">:</span><span class="w"> </span><span class="n">platform</span><span class="w"> </span><span class="s2">"./platform/main.roc"</span><span class="w"> </span><span class="p">}</span>

<span class="n">import</span><span class="w"> </span><span class="n">pf</span><span class="o">.</span><span class="n">Stdout</span>

<span class="nb">print</span><span class="o">!</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="no">Str</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">{}</span>
<span class="nb">print</span><span class="o">!</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">|</span><span class="n">msg</span><span class="o">|</span><span class="w"> </span><span class="n">msg</span><span class="o">.</span><span class="n">split_on</span><span class="p">(</span><span class="s2">"</span><span class="se">\n</span><span class="s2">"</span><span class="p">)</span><span class="o">.</span><span class="n">for_each!</span><span class="p">(</span><span class="no">Stdout</span><span class="o">.</span><span class="n">line!</span><span class="p">)</span>

<span class="n">fnA</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="no">Str</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="no">Try</span><span class="p">(</span><span class="no">I64</span><span class="p">,</span><span class="w"> </span><span class="n">_</span><span class="p">)</span>
<span class="n">fnA</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">|</span><span class="n">_input</span><span class="o">|</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">var</span><span class="w"> </span><span class="vg">$x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span>
<span class="w">    </span><span class="no">Ok</span><span class="p">(</span><span class="vg">$x</span><span class="p">)</span>
<span class="p">}</span>

<span class="n">fnB</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="no">Str</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="no">Try</span><span class="p">(</span><span class="no">I64</span><span class="p">,</span><span class="w"> </span><span class="n">_</span><span class="p">)</span>
<span class="n">fnB</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">|</span><span class="n">_input</span><span class="o">|</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">var</span><span class="w"> </span><span class="vg">$y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span>
<span class="w">    </span><span class="no">Ok</span><span class="p">(</span><span class="vg">$y</span><span class="p">)</span>
<span class="p">}</span>

<span class="n">run!</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nb">print</span><span class="o">!</span><span class="p">(</span><span class="s2">"A1: ${fnA("</span><span class="nb">test</span><span class="s2">")?.to_str()}"</span><span class="p">)</span>
<span class="w">    </span><span class="nb">print</span><span class="o">!</span><span class="p">(</span><span class="s2">"A2: ${fnA("</span><span class="nb">test</span><span class="s2">")?.to_str()}"</span><span class="p">)</span>
<span class="w">    </span><span class="nb">print</span><span class="o">!</span><span class="p">(</span><span class="s2">"A3: ${fnA("</span><span class="nb">test</span><span class="s2">")?.to_str()}"</span><span class="p">)</span>
<span class="w">    </span><span class="no">Ok</span><span class="p">({})</span>
<span class="p">}</span>

<span class="n">main!</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">_ignore</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">run!</span><span class="p">()</span>
<span class="p">}</span>
</code></pre></div>
<p>If I do any of the following things, there is NO segfault anymore.</p>
<ul>
<li>remove the unused function fnB</li>
<li>remove one of the fnA calls</li>
<li>replace the vars by constants</li>
<li>return I64 instead of Try(I64, _)</li>
</ul>
<p>This is truly a mystery to me how to minimize this segfault further.</p>



<a name="562167636"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/463736-bugs/topic/Regressions%20%28segfaults%29%20after%20the%20latest%20PR%20%28ranges%29/near/562167636" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthieu Pizenberg <a href="https://roc-lang.github.io/zulip-export/stream/463736-bugs/topic/Regressions.20.28segfaults.29.20after.20the.20latest.20PR.20.28ranges.29.html#562167636">(Dec 05 2025 at 19:09)</a>:</h4>
<div class="codehilite" data-code-language="Bash"><pre><span></span><code>❯<span class="w"> </span>roc<span class="w"> </span>test/fx/segfault.roc
A1:<span class="w"> </span><span class="m">1</span>
A2:<span class="w"> </span><span class="m">1</span>
error:<span class="w"> </span>Child<span class="w"> </span>process<span class="w"> </span>/var/folders/q3/lls0f9bd6x112cdkq8bgjldr0000gn/T/roc-65931/segfault.roc<span class="w"> </span>killed<span class="w"> </span>by<span class="w"> </span>signal:<span class="w"> </span><span class="m">11</span>
error:<span class="w"> </span>Child<span class="w"> </span>process<span class="w"> </span>crashed<span class="w"> </span>with<span class="w"> </span>segmentation<span class="w"> </span>fault<span class="w"> </span><span class="o">(</span>SIGSEGV<span class="o">)</span>
</code></pre></div>



<a name="562173300"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/463736-bugs/topic/Regressions%20%28segfaults%29%20after%20the%20latest%20PR%20%28ranges%29/near/562173300" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anton <a href="https://roc-lang.github.io/zulip-export/stream/463736-bugs/topic/Regressions.20.28segfaults.29.20after.20the.20latest.20PR.20.28ranges.29.html#562173300">(Dec 05 2025 at 19:51)</a>:</h4>
<blockquote>
<p>This is truly a mystery to me how to minimize this segfault further.</p>
</blockquote>
<p>Try getting a stacktrace with gdb: <code>gdb --ex run --ex bt --args roc test/fx/segfault.roc</code> that may get you some extra useful info.</p>



<a name="562173806"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/463736-bugs/topic/Regressions%20%28segfaults%29%20after%20the%20latest%20PR%20%28ranges%29/near/562173806" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anton <a href="https://roc-lang.github.io/zulip-export/stream/463736-bugs/topic/Regressions.20.28segfaults.29.20after.20the.20latest.20PR.20.28ranges.29.html#562173806">(Dec 05 2025 at 19:55)</a>:</h4>
<p>I have my OS pretty locked down so that I can safely run <code>codex --yolo</code> or <code>claude --dangerously-skip-permissions</code>. They should be able to find the cause of the segfault in that mode but they don't always find the best fix.</p>



<a name="562174622"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/463736-bugs/topic/Regressions%20%28segfaults%29%20after%20the%20latest%20PR%20%28ranges%29/near/562174622" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/463736-bugs/topic/Regressions.20.28segfaults.29.20after.20the.20latest.20PR.20.28ranges.29.html#562174622">(Dec 05 2025 at 20:01)</a>:</h4>
<p>I'll take a look!</p>



<a name="562218068"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/463736-bugs/topic/Regressions%20%28segfaults%29%20after%20the%20latest%20PR%20%28ranges%29/near/562218068" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/463736-bugs/topic/Regressions.20.28segfaults.29.20after.20the.20latest.20PR.20.28ranges.29.html#562218068">(Dec 06 2025 at 05:19)</a>:</h4>
<p><a href="https://github.com/roc-lang/roc/pull/8576">https://github.com/roc-lang/roc/pull/8576</a> should fix this, although I'm not quite ready to land the PR yet - needs some changes, but if you try that branch it should unblock!</p>



<a name="562234755"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/463736-bugs/topic/Regressions%20%28segfaults%29%20after%20the%20latest%20PR%20%28ranges%29/near/562234755" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthieu Pizenberg <a href="https://roc-lang.github.io/zulip-export/stream/463736-bugs/topic/Regressions.20.28segfaults.29.20after.20the.20latest.20PR.20.28ranges.29.html#562234755">(Dec 06 2025 at 10:53)</a>:</h4>
<p>Indeed, it fixes the segfault for day 1 :)</p>



<hr><p>Last updated: Mar 01 2026 at 12:20 UTC</p>
</html>