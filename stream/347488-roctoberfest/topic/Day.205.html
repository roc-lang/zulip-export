<html>
<head><meta charset="utf-8"><title>Day 5 · roctoberfest · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://roc-lang.github.io/zulip-export/stream/347488-roctoberfest/index.html">roctoberfest</a></h2>
<h3>Topic: <a href="https://roc-lang.github.io/zulip-export/stream/347488-roctoberfest/topic/Day.205.html">Day 5</a></h3>

<hr>

<base href="https://roc.zulipchat.com">

<head><link href="https://roc-lang.github.io/zulip-export/style.css" rel="stylesheet"></head>

<a name="302158805"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/347488-roctoberfest/topic/Day%205/near/302158805" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ayaz Hafiz <a href="https://roc-lang.github.io/zulip-export/stream/347488-roctoberfest/topic/Day.205.html#302158805">(Oct 03 2022 at 22:23)</a>:</h4>
<p>Day 5, part 1 and 2: <a href="https://github.com/ayazhafiz/roc-advent-of-code/blob/main/2021/day5.roc">https://github.com/ayazhafiz/roc-advent-of-code/blob/main/2021/day5.roc</a></p>



<a name="302159029"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/347488-roctoberfest/topic/Day%205/near/302159029" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ayaz Hafiz <a href="https://roc-lang.github.io/zulip-export/stream/347488-roctoberfest/topic/Day.205.html#302159029">(Oct 03 2022 at 22:25)</a>:</h4>
<p>I feel like this problem hit the limit of what the associativity-list implementation of <code>Dict</code> in the standard library can do. I used <span class="user-mention" data-user-id="343810">@Brendan Hansknecht</span> 's implementation here instead. I know there are more efficient ways to solve this problem, but this is probably a sign we should implement <code>Hash</code> and a faster Dict implementation <span aria-label="sweat smile" class="emoji emoji-1f605" role="img" title="sweat smile">:sweat_smile:</span></p>



<a name="302159566"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/347488-roctoberfest/topic/Day%205/near/302159566" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/347488-roctoberfest/topic/Day.205.html#302159566">(Oct 03 2022 at 22:28)</a>:</h4>
<p>I probably have a similar implementation, but I used our list based set in a way that it still worked for the problem....though it definitely took a bit on part 2: <a href="https://github.com/bhansconnect/roc-aoc-2021/tree/trunk/day5">https://github.com/bhansconnect/roc-aoc-2021/tree/trunk/day5</a></p>



<a name="302159712"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/347488-roctoberfest/topic/Day%205/near/302159712" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/347488-roctoberfest/topic/Day.205.html#302159712">(Oct 03 2022 at 22:28)</a>:</h4>
<p>Super inefficient, but I really like the solution after parsing: <a href="https://github.com/bhansconnect/roc-aoc-2021/blob/trunk/day5/part2.roc#L96">https://github.com/bhansconnect/roc-aoc-2021/blob/trunk/day5/part2.roc#L96</a></p>



<a name="302159740"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/347488-roctoberfest/topic/Day%205/near/302159740" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ayaz Hafiz <a href="https://roc-lang.github.io/zulip-export/stream/347488-roctoberfest/topic/Day.205.html#302159740">(Oct 03 2022 at 22:29)</a>:</h4>
<p>otherwise, wow, Roc makes parsing into ad-hoc representations so painless. Only define the type annotations you want, compose things easily without ceremony - the startup ergonomics are at least as nice as they are in Haskell, and definitely feel better in most cases</p>



<a name="302159848"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/347488-roctoberfest/topic/Day%205/near/302159848" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/347488-roctoberfest/topic/Day.205.html#302159848">(Oct 03 2022 at 22:29)</a>:</h4>
<p>I definitely have to learn your parser stuff at some point. Until then...the world of <code>Str.split</code> and hacks continues.</p>



<a name="302160093"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/347488-roctoberfest/topic/Day%205/near/302160093" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ayaz Hafiz <a href="https://roc-lang.github.io/zulip-export/stream/347488-roctoberfest/topic/Day.205.html#302160093">(Oct 03 2022 at 22:31)</a>:</h4>
<p>Set is smarter, I used Dict which ends up touching a lot more probably</p>



<a name="302160196"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/347488-roctoberfest/topic/Day%205/near/302160196" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/347488-roctoberfest/topic/Day.205.html#302160196">(Oct 03 2022 at 22:31)</a>:</h4>
<p>Ah, that's definitely true.</p>



<a name="302160585"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/347488-roctoberfest/topic/Day%205/near/302160585" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ayaz Hafiz <a href="https://roc-lang.github.io/zulip-export/stream/347488-roctoberfest/topic/Day.205.html#302160585">(Oct 03 2022 at 22:34)</a>:</h4>
<p>hopefully your <code>U64FlatHashDict</code> can carry us, as long as we need it, until we implement one for the stdlib</p>



<a name="302160881"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/347488-roctoberfest/topic/Day%205/near/302160881" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/347488-roctoberfest/topic/Day.205.html#302160881">(Oct 03 2022 at 22:37)</a>:</h4>
<p>If you help me add <code>Hash</code>, I should be able to upgrade the standard library dict and set. Though we do want to change a few things about my version to avoid ordering problems (should be done before merging) and hash flooding attacks (can be done after merging).</p>



<a name="302160959"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/347488-roctoberfest/topic/Day%205/near/302160959" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/347488-roctoberfest/topic/Day.205.html#302160959">(Oct 03 2022 at 22:37)</a>:</h4>
<p>I really just don't know much about abilities, but once I see a dummy implementation and just need to fill in the bodies, I should be good.</p>



<a name="302162076"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/347488-roctoberfest/topic/Day%205/near/302162076" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ayaz Hafiz <a href="https://roc-lang.github.io/zulip-export/stream/347488-roctoberfest/topic/Day.205.html#302162076">(Oct 03 2022 at 22:47)</a>:</h4>
<p>opened <a class="stream-topic" data-stream-id="304641" href="/#narrow/stream/304641-ideas/topic/Hash.20ability">#ideas &gt; Hash ability</a> to discuss. Happy to pair on the ability implementation once we get the base API sorted out, now that we have Encode/Decode in place you'll see that it's relatively straightforward</p>



<a name="302188822"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/347488-roctoberfest/topic/Day%205/near/302188822" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Shritesh Bhattarai <a href="https://roc-lang.github.io/zulip-export/stream/347488-roctoberfest/topic/Day.205.html#302188822">(Oct 04 2022 at 04:34)</a>:</h4>
<p>My day 5 part 1 is an abomination: <a href="https://github.com/shritesh/advent/blob/main/2021/5.roc">https://github.com/shritesh/advent/blob/main/2021/5.roc</a><br>
I couldn't figure out how to use the aforementioned parser in the stdlib (including two packages crashes the compiler?) so I hand rolled my own state-machine based one. Also, I couldn't figure out an ergonomic way to essentially do <code>List.update</code> so I've got a hackjob of <code>List.replace</code>, <code>List.set</code> and custom tag types to make it work, which is probably why the code runs dead slow.</p>



<a name="302191277"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/347488-roctoberfest/topic/Day%205/near/302191277" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/347488-roctoberfest/topic/Day.205.html#302191277">(Oct 04 2022 at 05:11)</a>:</h4>
<p>The issue is likely not truely your fault. Roc has some shape edges around uniqueness and copying. I am betting that you are copying your 1ish MB list many many times.</p>



<a name="302191866"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/347488-roctoberfest/topic/Day%205/near/302191866" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/347488-roctoberfest/topic/Day.205.html#302191866">(Oct 04 2022 at 05:20)</a>:</h4>
<p>I am gonna test an try to figure if uniqueness is the issue.</p>



<a name="302192484"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/347488-roctoberfest/topic/Day%205/near/302192484" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/347488-roctoberfest/topic/Day.205.html#302192484">(Oct 04 2022 at 05:28)</a>:</h4>
<p>Yeah, this is 100% roc uniqueness sharp edge leading to tons of copying.</p>



<a name="302192601"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/347488-roctoberfest/topic/Day%205/near/302192601" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/347488-roctoberfest/topic/Day.205.html#302192601">(Oct 04 2022 at 05:30)</a>:</h4>
<p>Try changing cover to this:</p>
<div class="codehilite" data-code-language="CoffeeScript"><pre><span></span><code><span class="nv">cover</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="err">\</span><span class="p">{</span><span class="nx">width</span><span class="p">,</span><span class="w"> </span><span class="nx">height</span><span class="p">,</span><span class="w"> </span><span class="nx">data</span><span class="p">},</span><span class="w"> </span><span class="nx">x</span><span class="p">,</span><span class="w"> </span><span class="nx">y</span><span class="w"> </span><span class="nf">-&gt;</span><span class="w"></span>
<span class="w">    </span><span class="nv">index</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">width</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">y</span><span class="w"></span>

<span class="w">    </span><span class="k">when</span><span class="w"> </span><span class="nx">List</span><span class="p">.</span><span class="nx">replace</span><span class="w"> </span><span class="nx">data</span><span class="w"> </span><span class="nx">index</span><span class="w"> </span><span class="nx">One</span><span class="w"> </span><span class="o">is</span><span class="w"></span>
<span class="w">        </span><span class="p">{</span><span class="w"> </span><span class="nv">value</span><span class="o">:</span><span class="w"> </span><span class="nx">None</span><span class="p">,</span><span class="w"> </span><span class="nx">list</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="nf">-&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">width</span><span class="p">,</span><span class="w"> </span><span class="nx">height</span><span class="p">,</span><span class="w"> </span><span class="nv">data</span><span class="o">:</span><span class="w"> </span><span class="nx">list</span><span class="w"> </span><span class="p">}</span><span class="w"></span>
<span class="w">        </span><span class="p">{</span><span class="w"> </span><span class="nv">value</span><span class="o">:</span><span class="w"> </span><span class="nx">One</span><span class="p">,</span><span class="w"> </span><span class="nx">list</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="nf">-&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">width</span><span class="p">,</span><span class="w"> </span><span class="nx">height</span><span class="p">,</span><span class="w"> </span><span class="nv">data</span><span class="o">:</span><span class="w"> </span><span class="nx">List</span><span class="p">.</span><span class="nx">set</span><span class="w"> </span><span class="nx">list</span><span class="w"> </span><span class="nx">index</span><span class="w"> </span><span class="nx">TwoOrMore</span><span class="w"> </span><span class="p">}</span><span class="w"></span>
<span class="w">        </span><span class="p">{</span><span class="w"> </span><span class="nv">value</span><span class="o">:</span><span class="w"> </span><span class="nx">TwoOrMore</span><span class="p">,</span><span class="w"> </span><span class="nx">list</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="nf">-&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">width</span><span class="p">,</span><span class="w"> </span><span class="nx">height</span><span class="p">,</span><span class="w"> </span><span class="nv">data</span><span class="o">:</span><span class="w"> </span><span class="nx">List</span><span class="p">.</span><span class="nx">set</span><span class="w"> </span><span class="nx">list</span><span class="w"> </span><span class="nx">index</span><span class="w"> </span><span class="nx">TwoOrMore</span><span class="w"> </span><span class="p">}</span><span class="w"></span>
</code></pre></div>



<a name="302192766"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/347488-roctoberfest/topic/Day%205/near/302192766" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/347488-roctoberfest/topic/Day.205.html#302192766">(Oct 04 2022 at 05:32)</a>:</h4>
<p>The problem is that you were keep a reference to the grid because it was used after the <code>List.replace</code> statement in the when clause. This meant that every call to <code>List.replace</code> had to completely clone the list. This allocated about 1MB for every point in every line.</p>



<a name="302193095"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/347488-roctoberfest/topic/Day%205/near/302193095" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Shritesh Bhattarai <a href="https://roc-lang.github.io/zulip-export/stream/347488-roctoberfest/topic/Day.205.html#302193095">(Oct 04 2022 at 05:35)</a>:</h4>
<p>Yup. Much faster. Thanks</p>



<a name="302195618"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/347488-roctoberfest/topic/Day%205/near/302195618" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Shritesh Bhattarai <a href="https://roc-lang.github.io/zulip-export/stream/347488-roctoberfest/topic/Day.205.html#302195618">(Oct 04 2022 at 06:02)</a>:</h4>
<p>Part 2 is done: <a href="https://github.com/shritesh/advent/blob/main/2021/5.roc">https://github.com/shritesh/advent/blob/main/2021/5.roc</a> <br>
<code>List.range</code> is broken in Roc. <code>List.range 1 1 == List.range 1 2 == [1]</code>.<br>
<span class="user-mention" data-user-id="343810">@Brendan Hansknecht</span> 's solution helped in figuring that out.</p>



<a name="302279624"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/347488-roctoberfest/topic/Day%205/near/302279624" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Shritesh Bhattarai <a href="https://roc-lang.github.io/zulip-export/stream/347488-roctoberfest/topic/Day.205.html#302279624">(Oct 04 2022 at 15:00)</a>:</h4>
<p>Filed an issue about it: <a href="https://github.com/roc-lang/roc/issues/4196">https://github.com/roc-lang/roc/issues/4196</a></p>



<a name="302309494"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/347488-roctoberfest/topic/Day%205/near/302309494" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anton <a href="https://roc-lang.github.io/zulip-export/stream/347488-roctoberfest/topic/Day.205.html#302309494">(Oct 04 2022 at 17:19)</a>:</h4>
<p><span aria-label="+1" class="emoji emoji-1f44d" role="img" title="+1">:+1:</span> thanks <span class="user-mention" data-user-id="452038">@Shritesh Bhattarai</span> :)</p>



<a name="302822200"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/347488-roctoberfest/topic/Day%205/near/302822200" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ghislain <a href="https://roc-lang.github.io/zulip-export/stream/347488-roctoberfest/topic/Day.205.html#302822200">(Oct 07 2022 at 10:43)</a>:</h4>
<p>Hi, here's my solution for part2 <a href="https://github.com/ghigt/advent-of-code/blob/main/roc/day-5/part2.roc">https://github.com/ghigt/advent-of-code/blob/main/roc/day-5/part2.roc</a><br>
My algorithm is SOO slow, 4min on my M1 :(<br>
99% of it is spent on this function to look for the duplications:</p>
<div class="codehilite" data-code-language="Elm"><pre><span></span><code><span class="nv">seeDuplicate</span><span class="w"> </span><span class="nf">:</span><span class="w"> </span><span class="kt">List</span><span class="w"> </span><span class="kt">Coord</span><span class="w"> </span><span class="nf">-&gt;</span><span class="w"> </span><span class="kt">Set</span><span class="w"> </span><span class="kt">Coord</span><span class="w"></span>
<span class="nv">seeDuplicate</span><span class="w"> </span><span class="nf">=</span><span class="w"> </span><span class="nf">\</span><span class="nv">list</span><span class="w"> </span><span class="nf">-&gt;</span><span class="w"></span>
<span class="w">    </span><span class="kt">List</span><span class="nf">.</span><span class="nv">walk</span><span class="w"> </span><span class="nv">list</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nv">s</span><span class="nf">:</span><span class="w"> </span><span class="kt">Set</span><span class="nf">.</span><span class="nv">empty</span><span class="p">,</span><span class="w"> </span><span class="nv">d</span><span class="nf">:</span><span class="w"> </span><span class="kt">Set</span><span class="nf">.</span><span class="nv">empty</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">(</span><span class="nf">\</span><span class="p">{</span><span class="nv">s</span><span class="p">,</span><span class="w"> </span><span class="nv">d</span><span class="p">},</span><span class="w"> </span><span class="nv">c</span><span class="w"> </span><span class="nf">-&gt;</span><span class="w"></span>
<span class="w">        </span><span class="kr">if</span><span class="w"> </span><span class="kt">Set</span><span class="nf">.</span><span class="nv">contains</span><span class="w"> </span><span class="nv">s</span><span class="w"> </span><span class="nv">c</span><span class="w"> </span><span class="kr">then</span><span class="w"></span>
<span class="w">            </span><span class="p">{</span><span class="w"> </span><span class="nv">d</span><span class="nf">:</span><span class="w"> </span><span class="kt">Set</span><span class="nf">.</span><span class="nv">insert</span><span class="w"> </span><span class="nv">d</span><span class="w"> </span><span class="nv">c</span><span class="p">,</span><span class="w"> </span><span class="nv">s</span><span class="w"> </span><span class="p">}</span><span class="w"></span>
<span class="w">        </span><span class="kr">else</span><span class="w"></span>
<span class="w">            </span><span class="p">{</span><span class="w"> </span><span class="nv">s</span><span class="nf">:</span><span class="w"> </span><span class="kt">Set</span><span class="nf">.</span><span class="nv">insert</span><span class="w"> </span><span class="nv">s</span><span class="w"> </span><span class="nv">c</span><span class="p">,</span><span class="w"> </span><span class="nv">d</span><span class="w"> </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="nf">|&gt;</span><span class="w"> </span><span class="nf">.</span><span class="nv">d</span><span class="w"></span>
</code></pre></div>
<p>Tried several other implementations with only one <code>Set</code> and <code>Tag</code> but it was even worse</p>



<a name="302855967"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/347488-roctoberfest/topic/Day%205/near/302855967" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/347488-roctoberfest/topic/Day.205.html#302855967">(Oct 07 2022 at 13:49)</a>:</h4>
<p>Currently sets are list based instead of hash set based. So contains and insert both scan the entire list doing comparisons.</p>



<a name="302856200"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/347488-roctoberfest/topic/Day%205/near/302856200" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/347488-roctoberfest/topic/Day.205.html#302856200">(Oct 07 2022 at 13:50)</a>:</h4>
<p>We just added the <code>Hash</code> ability. Soon, i will port over a Hash based dictionary (and set). That should greatly help here.</p>



<a name="302857759"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/347488-roctoberfest/topic/Day%205/near/302857759" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/347488-roctoberfest/topic/Day.205.html#302857759">(Oct 07 2022 at 13:57)</a>:</h4>
<p>Also, i think lists currently grow by 1 element instead of 1.5 to 2x. So every time you insert, the list has to be reallocated and all bytes copied.</p>



<a name="302858009"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/347488-roctoberfest/topic/Day%205/near/302858009" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/347488-roctoberfest/topic/Day.205.html#302858009">(Oct 07 2022 at 13:58)</a>:</h4>
<p>In other words, probably more a Roc maturity problem than a real problem with your code.</p>



<a name="302859405"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/347488-roctoberfest/topic/Day%205/near/302859405" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ghislain <a href="https://roc-lang.github.io/zulip-export/stream/347488-roctoberfest/topic/Day.205.html#302859405">(Oct 07 2022 at 14:05)</a>:</h4>
<p>Ok, a strategy like in Go which grows the slice capacity by 2x if <code>append</code> needs it</p>



<a name="302860034"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/347488-roctoberfest/topic/Day%205/near/302860034" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ghislain <a href="https://roc-lang.github.io/zulip-export/stream/347488-roctoberfest/topic/Day.205.html#302860034">(Oct 07 2022 at 14:08)</a>:</h4>
<p>I should look at the implementation of <code>List</code>, I naively thought it was a rust <code>Vec</code> which then grew its capacity with the rust strategy</p>



<a name="302862136"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/347488-roctoberfest/topic/Day%205/near/302862136" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/347488-roctoberfest/topic/Day.205.html#302862136">(Oct 07 2022 at 14:19)</a>:</h4>
<p>I think we would prefer 1.5x more than 2x. The issue with 2x is that it can never reuse memory. Your new list is always large enough that it can't fit in the sum of all previous memory locations it occupied even if they are continuous. As such, the number at most can be the golden ratio.</p>



<a name="302862182"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/347488-roctoberfest/topic/Day%205/near/302862182" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/347488-roctoberfest/topic/Day.205.html#302862182">(Oct 07 2022 at 14:19)</a>:</h4>
<p>But yeah, should be a simple addition if you want to try and fix it. (assuming it hasn't already been done)</p>



<a name="302863203"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/347488-roctoberfest/topic/Day%205/near/302863203" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/347488-roctoberfest/topic/Day.205.html#302863203">(Oct 07 2022 at 14:25)</a>:</h4>
<p>Yeah, looks like this still needs to be done. Might require changes in a few different functions (probably funneling them all through list a single growth function)</p>



<a name="302863289"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/347488-roctoberfest/topic/Day%205/near/302863289" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ghislain <a href="https://roc-lang.github.io/zulip-export/stream/347488-roctoberfest/topic/Day.205.html#302863289">(Oct 07 2022 at 14:25)</a>:</h4>
<p>oh, I'm a "read-only" source code developer on Roc for now, hope to be able to help in a near future when I will have a better understanding of what happens under the hood! <span aria-label="sweat smile" class="emoji emoji-1f605" role="img" title="sweat smile">:sweat_smile:</span></p>



<a name="302863634"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/347488-roctoberfest/topic/Day%205/near/302863634" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ghislain <a href="https://roc-lang.github.io/zulip-export/stream/347488-roctoberfest/topic/Day.205.html#302863634">(Oct 07 2022 at 14:27)</a>:</h4>
<p>But having a look at all PR/docs since a couple of weeks now, it's a real pleasure to learn!</p>



<a name="302864525"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/347488-roctoberfest/topic/Day%205/near/302864525" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/347488-roctoberfest/topic/Day.205.html#302864525">(Oct 07 2022 at 14:31)</a>:</h4>
<p>Ah, that's fine.</p>



<a name="302870290"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/347488-roctoberfest/topic/Day%205/near/302870290" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/347488-roctoberfest/topic/Day.205.html#302870290">(Oct 07 2022 at 14:58)</a>:</h4>
<p>I'll add this and we can see if/how much it helps your example</p>



<a name="302952999"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/347488-roctoberfest/topic/Day%205/near/302952999" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/347488-roctoberfest/topic/Day.205.html#302952999">(Oct 08 2022 at 00:36)</a>:</h4>
<p>Oh, actually in this case, I think you just needed the <code>--optimize</code> flag. I just ran it on an M1 and it ran in 13s.</p>



<a name="302978525"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/347488-roctoberfest/topic/Day%205/near/302978525" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ghislain <a href="https://roc-lang.github.io/zulip-export/stream/347488-roctoberfest/topic/Day.205.html#302978525">(Oct 08 2022 at 07:55)</a>:</h4>
<p>What does this flag do?</p>



<a name="302982889"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/347488-roctoberfest/topic/Day%205/near/302982889" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anton <a href="https://roc-lang.github.io/zulip-export/stream/347488-roctoberfest/topic/Day.205.html#302982889">(Oct 08 2022 at 08:41)</a>:</h4>
<p>I think it requests LLVM to optimize for execution speed.</p>



<a name="302984212"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/347488-roctoberfest/topic/Day%205/near/302984212" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/347488-roctoberfest/topic/Day.205.html#302984212">(Oct 08 2022 at 08:54)</a>:</h4>
<p>in general it tells the Roc compiler "spend time optimizing this program so that it will run faster (but take longer to build compared to normal)"</p>



<hr><p>Last updated: Nov 01 2025 at 12:13 UTC</p>
</html>