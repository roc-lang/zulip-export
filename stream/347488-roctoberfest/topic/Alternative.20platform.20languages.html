<html>
<head><meta charset="utf-8"><title>Alternative platform languages · roctoberfest · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://roc-lang.github.io/zulip-export/stream/347488-roctoberfest/index.html">roctoberfest</a></h2>
<h3>Topic: <a href="https://roc-lang.github.io/zulip-export/stream/347488-roctoberfest/topic/Alternative.20platform.20languages.html">Alternative platform languages</a></h3>

<hr>

<base href="https://roc.zulipchat.com">

<head><link href="https://roc-lang.github.io/zulip-export/style.css" rel="stylesheet"></head>

<a name="303071987"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/347488-roctoberfest/topic/Alternative%20platform%20languages/near/303071987" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis <a href="https://roc-lang.github.io/zulip-export/stream/347488-roctoberfest/topic/Alternative.20platform.20languages.html#303071987">(Oct 08 2022 at 23:12)</a>:</h4>
<p>Hey all <span aria-label="wave" class="emoji emoji-1f44b" role="img" title="wave">:wave:</span> . Are there any non-rust (zig or c) alternatives to the cli-platform?  And if not, is there anywhere I could read about creating one?   I would like to do some advent of code problems but don't have a rust compiler setup on this machine.</p>



<a name="303072048"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/347488-roctoberfest/topic/Alternative%20platform%20languages/near/303072048" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/347488-roctoberfest/topic/Alternative.20platform.20languages.html#303072048">(Oct 08 2022 at 23:13)</a>:</h4>
<p>Some platforms are zig based, but no equivalent of the cli platform. The benchmarks platform uses zig for example</p>



<a name="303072051"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/347488-roctoberfest/topic/Alternative%20platform%20languages/near/303072051" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis <a href="https://roc-lang.github.io/zulip-export/stream/347488-roctoberfest/topic/Alternative.20platform.20languages.html#303072051">(Oct 08 2022 at 23:13)</a>:</h4>
<p>Or maybe the easiest thing is to just embed the inputs into my .roc files?  Does roc havemultiline strings?</p>



<a name="303072183"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/347488-roctoberfest/topic/Alternative%20platform%20languages/near/303072183" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/347488-roctoberfest/topic/Alternative.20platform.20languages.html#303072183">(Oct 08 2022 at 23:15)</a>:</h4>
<p>I'm not sure about multiline strings (we should, just not sure on syntax/if it has been added). If you choose to embed, you should be able to just based a simple zig platform (like the platform switching one) and return and string of what to print.</p>



<a name="303072196"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/347488-roctoberfest/topic/Alternative%20platform%20languages/near/303072196" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis <a href="https://roc-lang.github.io/zulip-export/stream/347488-roctoberfest/topic/Alternative.20platform.20languages.html#303072196">(Oct 08 2022 at 23:15)</a>:</h4>
<p>Oh interesting. I'll take a look at the benchmarks platform, maybe learn from that.  I saw the rocLovesZig hello world platform. Maybe the benchmarks platform has more to look at.</p>



<a name="303072254"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/347488-roctoberfest/topic/Alternative%20platform%20languages/near/303072254" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/347488-roctoberfest/topic/Alternative.20platform.20languages.html#303072254">(Oct 08 2022 at 23:16)</a>:</h4>
<p>Otherwise, platforms don't really have good docs, though the API is significantly more stable than it use to be.</p>



<a name="303072370"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/347488-roctoberfest/topic/Alternative%20platform%20languages/near/303072370" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis <a href="https://roc-lang.github.io/zulip-export/stream/347488-roctoberfest/topic/Alternative.20platform.20languages.html#303072370">(Oct 08 2022 at 23:18)</a>:</h4>
<p>Are there any foreseeable roadblocks with using zig?  Like anything rust-specific in the cli platform which I'll run into?</p>



<a name="303072373"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/347488-roctoberfest/topic/Alternative%20platform%20languages/near/303072373" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/347488-roctoberfest/topic/Alternative.20platform.20languages.html#303072373">(Oct 08 2022 at 23:18)</a>:</h4>
<p>Roc does indeed have multiline strings! <span class="user-mention" data-user-id="453336">@Joshua Warner</span> got them working recently</p>



<a name="303072391"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/347488-roctoberfest/topic/Alternative%20platform%20languages/near/303072391" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/347488-roctoberfest/topic/Alternative.20platform.20languages.html#303072391">(Oct 08 2022 at 23:18)</a>:</h4>
<p>the syntax is triple quotes, and you can use them either on one line or across multiple lines</p>



<a name="303072396"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/347488-roctoberfest/topic/Alternative%20platform%20languages/near/303072396" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/347488-roctoberfest/topic/Alternative.20platform.20languages.html#303072396">(Oct 08 2022 at 23:18)</a>:</h4>
<p>If you have questions, feel free to ask. Also, i am gonna move this chain of messages out of the day 9 thread, into it's own thread.</p>



<a name="303072422"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/347488-roctoberfest/topic/Alternative%20platform%20languages/near/303072422" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/347488-roctoberfest/topic/Alternative.20platform.20languages.html#303072422">(Oct 08 2022 at 23:19)</a>:</h4>
<p>if you do it across multiple lines, the <code>"""</code>s each have to be on their own lines (with nothing else on the line) and indented the same amount</p>



<a name="303072523"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/347488-roctoberfest/topic/Alternative%20platform%20languages/near/303072523" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/347488-roctoberfest/topic/Alternative.20platform.20languages.html#303072523">(Oct 08 2022 at 23:20)</a>:</h4>
<blockquote>
<p>Are there any foreseeable roadblocks with using zig?</p>
</blockquote>
<p>Nope. Zig should be just fine. The main thing is that you would be redefining the cli-platform/creating a new platform.</p>



<a name="303072558"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/347488-roctoberfest/topic/Alternative%20platform%20languages/near/303072558" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis <a href="https://roc-lang.github.io/zulip-export/stream/347488-roctoberfest/topic/Alternative.20platform.20languages.html#303072558">(Oct 08 2022 at 23:21)</a>:</h4>
<p>Yessss multiline strings!  <span aria-label="praise" class="emoji emoji-1f64c" role="img" title="praise">:praise:</span></p>



<a name="303072559"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/347488-roctoberfest/topic/Alternative%20platform%20languages/near/303072559" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/347488-roctoberfest/topic/Alternative.20platform.20languages.html#303072559">(Oct 08 2022 at 23:21)</a>:</h4>
<p>If you wanted the exact same platform, you would have to conform to the same api. Otherwise, zig is powerful enough to make any platform.</p>



<a name="303072836"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/347488-roctoberfest/topic/Alternative%20platform%20languages/near/303072836" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis <a href="https://roc-lang.github.io/zulip-export/stream/347488-roctoberfest/topic/Alternative.20platform.20languages.html#303072836">(Oct 08 2022 at 23:24)</a>:</h4>
<p>Ok thanks for the input.  Maybe I'll look into recreating the cli-platform in zig.  Would be nice to have...</p>



<a name="303072921"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/347488-roctoberfest/topic/Alternative%20platform%20languages/near/303072921" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis <a href="https://roc-lang.github.io/zulip-export/stream/347488-roctoberfest/topic/Alternative.20platform.20languages.html#303072921">(Oct 08 2022 at 23:26)</a>:</h4>
<p>thats good to hear. i'm much more comfortable in zig than rust or c.</p>



<a name="303073086"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/347488-roctoberfest/topic/Alternative%20platform%20languages/near/303073086" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/347488-roctoberfest/topic/Alternative.20platform.20languages.html#303073086">(Oct 08 2022 at 23:28)</a>:</h4>
<p>Go for it if you want. Would be interesting to see. Though if you just install rust, you shouldn't actually need to code in rust at all to use the cli platform to solve the advent of code problems.</p>



<a name="303073918"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/347488-roctoberfest/topic/Alternative%20platform%20languages/near/303073918" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis <a href="https://roc-lang.github.io/zulip-export/stream/347488-roctoberfest/topic/Alternative.20platform.20languages.html#303073918">(Oct 08 2022 at 23:41)</a>:</h4>
<p>oh and thanks for creating the new thread. i've now identified the 'new topic' menu item <span aria-label="eyes" class="emoji emoji-1f440" role="img" title="eyes">:eyes:</span> and will consider using it.</p>



<a name="303076609"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/347488-roctoberfest/topic/Alternative%20platform%20languages/near/303076609" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jan kili <a href="https://roc-lang.github.io/zulip-export/stream/347488-roctoberfest/topic/Alternative.20platform.20languages.html#303076609">(Oct 09 2022 at 00:27)</a>:</h4>
<p>Sharing API logic across differently-hosted platforms sounds like a fun future project...</p>



<a name="303076643"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/347488-roctoberfest/topic/Alternative%20platform%20languages/near/303076643" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jan kili <a href="https://roc-lang.github.io/zulip-export/stream/347488-roctoberfest/topic/Alternative.20platform.20languages.html#303076643">(Oct 09 2022 at 00:28)</a>:</h4>
<p>In case host language preferences lead to increased platform fragmentation</p>



<a name="303076698"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/347488-roctoberfest/topic/Alternative%20platform%20languages/near/303076698" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jan kili <a href="https://roc-lang.github.io/zulip-export/stream/347488-roctoberfest/topic/Alternative.20platform.20languages.html#303076698">(Oct 09 2022 at 00:28)</a>:</h4>
<p>Or maybe that's just a use case for extracting the common logic into a pure-Roc library for multiple implementation platforms to import</p>



<a name="303077012"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/347488-roctoberfest/topic/Alternative%20platform%20languages/near/303077012" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis <a href="https://roc-lang.github.io/zulip-export/stream/347488-roctoberfest/topic/Alternative.20platform.20languages.html#303077012">(Oct 09 2022 at 00:35)</a>:</h4>
<p>having one roc lib with multiple platforms supporting it sounds nice.</p>



<a name="303081458"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/347488-roctoberfest/topic/Alternative%20platform%20languages/near/303081458" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/347488-roctoberfest/topic/Alternative.20platform.20languages.html#303081458">(Oct 09 2022 at 01:56)</a>:</h4>
<blockquote>
<p>In case host language preferences lead to increased platform fragmentation</p>
</blockquote>
<p>I think this is highly unlikely. Long term, most Roc developers are not likely to be platform devs.</p>



<a name="303084422"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/347488-roctoberfest/topic/Alternative%20platform%20languages/near/303084422" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis <a href="https://roc-lang.github.io/zulip-export/stream/347488-roctoberfest/topic/Alternative.20platform.20languages.html#303084422">(Oct 09 2022 at 02:47)</a>:</h4>
<p><span class="user-mention" data-user-id="462053">@JanCVanB</span> or anyone else have any ideas how to write this in zig? </p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="c1">// in examples/cli/cli-platform/src/lib.rs</span>
<span class="k">pub</span><span class="w"> </span><span class="k">extern</span><span class="w"> </span><span class="s">"C"</span><span class="w"> </span><span class="k">fn</span> <span class="nf">roc_fx_fileReadBytes</span><span class="p">(</span><span class="n">roc_path</span>: <span class="kp">&amp;</span><span class="nc">RocList</span><span class="o">&lt;</span><span class="kt">u8</span><span class="o">&gt;</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nc">RocResult</span><span class="o">&lt;</span><span class="n">RocList</span><span class="o">&lt;</span><span class="kt">u8</span><span class="o">&gt;</span><span class="p">,</span><span class="w"> </span><span class="n">ReadErr</span><span class="o">&gt;</span><span class="w"></span>
</code></pre></div>
<p>here's what i have in zig</p>
<div class="codehilite" data-code-language="TypeScript"><pre><span></span><code><span class="kd">const</span><span class="w"> </span><span class="nx">str</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">@import</span><span class="p">(</span><span class="s2">"str"</span><span class="p">);</span><span class="w"></span>
<span class="kd">const</span><span class="w"> </span><span class="nx">RocStr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">str</span><span class="p">.</span><span class="nx">RocStr</span><span class="p">;</span><span class="w"></span>

<span class="nx">fn</span><span class="w"> </span><span class="nx">RocResult</span><span class="p">(</span><span class="nx">comptime</span><span class="w"> </span><span class="nx">T</span><span class="o">:</span><span class="w"> </span><span class="kt">type</span><span class="p">)</span><span class="w"> </span><span class="kr">type</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">extern</span><span class="w"> </span><span class="nx">struct</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="nx">value</span><span class="o">:</span><span class="w"> </span><span class="kt">T</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="nx">is_error</span><span class="o">:</span><span class="w"> </span><span class="kt">bool</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="p">};</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="nx">pub</span><span class="w"> </span><span class="k">export</span><span class="w"> </span><span class="nx">fn</span><span class="w"> </span><span class="nx">roc_fx_readFileBytes</span><span class="p">(</span><span class="nx">roc_path</span><span class="o">:</span><span class="w"> </span><span class="o">*</span><span class="nx">RocStr</span><span class="p">)</span><span class="w"> </span><span class="nx">RocResult</span><span class="p">(</span><span class="nx">RocStr</span><span class="p">)</span><span class="w"></span>
</code></pre></div>
<p>but i'm getting this output:</p>
<div class="codehilite" data-code-language="Bash Session"><pre><span></span><code><span class="gp">$ </span>roc <span class="m">2021</span>/1.roc --linker<span class="o">=</span>legacy
<span class="go">🔨 Rebuilding platform...</span>
<span class="go">ld: /tmp/roc_appYwTVxq.o: in function `roc_fx_fileReadBytes_fastcc_wrapper':</span>
<span class="go">builtins-host:(.text+0xf2b6): undefined reference to `roc_fx_fileReadBytes'</span>
</code></pre></div>



<a name="303084586"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/347488-roctoberfest/topic/Alternative%20platform%20languages/near/303084586" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/347488-roctoberfest/topic/Alternative.20platform.20languages.html#303084586">(Oct 09 2022 at 02:50)</a>:</h4>
<p>I think you need: <code>callconv(.C)</code></p>



<a name="303084650"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/347488-roctoberfest/topic/Alternative%20platform%20languages/near/303084650" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis <a href="https://roc-lang.github.io/zulip-export/stream/347488-roctoberfest/topic/Alternative.20platform.20languages.html#303084650">(Oct 09 2022 at 02:51)</a>:</h4>
<p>just noticed i was missing <code>callconv(.C)</code> too but still getting the same error</p>



<a name="303084778"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/347488-roctoberfest/topic/Alternative%20platform%20languages/near/303084778" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/347488-roctoberfest/topic/Alternative.20platform.20languages.html#303084778">(Oct 09 2022 at 02:53)</a>:</h4>
<p>I don't have time to debug tonight, but I can probably take a look tomorrow if you push it somewhere. Otherwise, I can ally attempt to answer questions.</p>



<a name="303084803"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/347488-roctoberfest/topic/Alternative%20platform%20languages/near/303084803" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/347488-roctoberfest/topic/Alternative.20platform.20languages.html#303084803">(Oct 09 2022 at 02:53)</a>:</h4>
<p>You could try manual export with name: <code> @export(roc_fx_getInt, .{ .name = "roc_fx_getInt" });</code></p>



<a name="303084805"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/347488-roctoberfest/topic/Alternative%20platform%20languages/near/303084805" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/347488-roctoberfest/topic/Alternative.20platform.20languages.html#303084805">(Oct 09 2022 at 02:53)</a>:</h4>
<p>But for your function</p>



<a name="303084808"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/347488-roctoberfest/topic/Alternative%20platform%20languages/near/303084808" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/347488-roctoberfest/topic/Alternative.20platform.20languages.html#303084808">(Oct 09 2022 at 02:53)</a>:</h4>
<p>That may work</p>



<a name="303084852"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/347488-roctoberfest/topic/Alternative%20platform%20languages/near/303084852" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/347488-roctoberfest/topic/Alternative.20platform.20languages.html#303084852">(Oct 09 2022 at 02:54)</a>:</h4>
<p>Not sure though</p>



<a name="303085148"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/347488-roctoberfest/topic/Alternative%20platform%20languages/near/303085148" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis <a href="https://roc-lang.github.io/zulip-export/stream/347488-roctoberfest/topic/Alternative.20platform.20languages.html#303085148">(Oct 09 2022 at 02:59)</a>:</h4>
<p>manual export produces the same error.  thanks. will let you know if i push code somewhere.</p>



<a name="303085391"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/347488-roctoberfest/topic/Alternative%20platform%20languages/near/303085391" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/347488-roctoberfest/topic/Alternative.20platform.20languages.html#303085391">(Oct 09 2022 at 03:02)</a>:</h4>
<p>I wonder if your platform isn't recompiling for some reason.</p>



<a name="303085426"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/347488-roctoberfest/topic/Alternative%20platform%20languages/near/303085426" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis <a href="https://roc-lang.github.io/zulip-export/stream/347488-roctoberfest/topic/Alternative.20platform.20languages.html#303085426">(Oct 09 2022 at 03:03)</a>:</h4>
<p>i'm seeing zig error messages so it seems to be recompiling.</p>



<a name="303086522"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/347488-roctoberfest/topic/Alternative%20platform%20languages/near/303086522" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/347488-roctoberfest/topic/Alternative.20platform.20languages.html#303086522">(Oct 09 2022 at 03:20)</a>:</h4>
<p>Can you compile and run a zig platform in the repo that has an effect?</p>



<a name="303086541"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/347488-roctoberfest/topic/Alternative%20platform%20languages/near/303086541" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/347488-roctoberfest/topic/Alternative.20platform.20languages.html#303086541">(Oct 09 2022 at 03:21)</a>:</h4>
<p>Benchmarks or tui i think. Some thing with a <code>host.zig</code> that has an FX function</p>



<a name="303087008"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/347488-roctoberfest/topic/Alternative%20platform%20languages/near/303087008" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis <a href="https://roc-lang.github.io/zulip-export/stream/347488-roctoberfest/topic/Alternative.20platform.20languages.html#303087008">(Oct 09 2022 at 03:29)</a>:</h4>
<p>yes i am able to run examples/cli/tui.roc</p>
<div class="codehilite" data-code-language="Bash Session"><pre><span></span><code><span class="gp">$ </span>roc ../roc/examples/cli/tui.roc
<span class="go">🔨 Rebuilding platform...</span>

<span class="go">Hello World!</span>
</code></pre></div>



<a name="303087072"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/347488-roctoberfest/topic/Alternative%20platform%20languages/near/303087072" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis <a href="https://roc-lang.github.io/zulip-export/stream/347488-roctoberfest/topic/Alternative.20platform.20languages.html#303087072">(Oct 09 2022 at 03:30)</a>:</h4>
<p>i didn't realize tui was a zig platofrm. neat! will have a look there.</p>



<a name="303087884"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/347488-roctoberfest/topic/Alternative%20platform%20languages/near/303087884" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis <a href="https://roc-lang.github.io/zulip-export/stream/347488-roctoberfest/topic/Alternative.20platform.20languages.html#303087884">(Oct 09 2022 at 03:45)</a>:</h4>
<p>strange it looks like host.o contains the roc_fx_readFileBytes symbol. not sure what this means</p>
<div class="codehilite" data-code-language="Bash Session"><pre><span></span><code><span class="gp">$ </span>nm platform/host.o <span class="p">|</span> grep roc_fx
<span class="go">0000000000003ba0 T roc_fx_getInt</span>
<span class="go">0000000000003d80 t roc_fx_getInt_help</span>
<span class="go">0000000000003650 T roc_fx_putInt</span>
<span class="go">00000000000038a0 T roc_fx_putLine</span>
<span class="go">0000000000004030 T roc_fx_readFileBytes</span>
</code></pre></div>



<a name="303087987"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/347488-roctoberfest/topic/Alternative%20platform%20languages/near/303087987" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis <a href="https://roc-lang.github.io/zulip-export/stream/347488-roctoberfest/topic/Alternative.20platform.20languages.html#303087987">(Oct 09 2022 at 03:47)</a>:</h4>
<p>i deleted all the artifacts in platform/ right before i ran this to verify i wasn't looking at an old object file</p>



<a name="303089149"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/347488-roctoberfest/topic/Alternative%20platform%20languages/near/303089149" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis <a href="https://roc-lang.github.io/zulip-export/stream/347488-roctoberfest/topic/Alternative.20platform.20languages.html#303089149">(Oct 09 2022 at 04:01)</a>:</h4>
<p>was getting a similar <code>undefined reference to 'roc_fx_stdoutLine'</code> and fixed it with </p>
<div class="codehilite" data-code-language="TypeScript"><pre><span></span><code><span class="c1">// host.zig</span><span class="w"></span>
<span class="nx">comptime</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kd">@export</span><span class="p">(</span><span class="nx">roc_fx_putLine</span><span class="p">,</span><span class="w"> </span><span class="p">.{</span><span class="w"> </span><span class="p">.</span><span class="nx">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"roc_fx_stdoutLine"</span><span class="w"> </span><span class="p">});</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>



<a name="303089191"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/347488-roctoberfest/topic/Alternative%20platform%20languages/near/303089191" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis <a href="https://roc-lang.github.io/zulip-export/stream/347488-roctoberfest/topic/Alternative.20platform.20languages.html#303089191">(Oct 09 2022 at 04:02)</a>:</h4>
<p>so it seems to be something specific to <code>roc_fx_readFileBytes</code></p>



<a name="303090821"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/347488-roctoberfest/topic/Alternative%20platform%20languages/near/303090821" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis <a href="https://roc-lang.github.io/zulip-export/stream/347488-roctoberfest/topic/Alternative.20platform.20languages.html#303090821">(Oct 09 2022 at 04:38)</a>:</h4>
<p>figured it out. this seems to be the required signature:</p>
<div class="codehilite" data-code-language="TypeScript"><pre><span></span><code><span class="nx">pub</span><span class="w"> </span><span class="k">export</span><span class="w"> </span><span class="nx">fn</span><span class="w"> </span><span class="nx">roc_fx_fileReadBytes</span><span class="p">(</span><span class="nx">roc_path</span><span class="o">:</span><span class="w"> </span><span class="o">*</span><span class="nx">RocStr</span><span class="p">,</span><span class="w"> </span><span class="nx">output</span><span class="o">:</span><span class="w"> </span><span class="o">*</span><span class="nx">RocResult</span><span class="p">)</span><span class="w"> </span><span class="nx">callconv</span><span class="p">(.</span><span class="nx">C</span><span class="p">)</span><span class="w"> </span><span class="ow">void</span><span class="w"></span>
</code></pre></div>



<a name="303091496"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/347488-roctoberfest/topic/Alternative%20platform%20languages/near/303091496" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis <a href="https://roc-lang.github.io/zulip-export/stream/347488-roctoberfest/topic/Alternative.20platform.20languages.html#303091496">(Oct 09 2022 at 04:52)</a>:</h4>
<p>oops i guess the args are switched. no wonder i couldn't print the string <span aria-label="smirk" class="emoji emoji-1f60f" role="img" title="smirk">:smirk:</span></p>



<a name="303095144"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/347488-roctoberfest/topic/Alternative%20platform%20languages/near/303095144" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/347488-roctoberfest/topic/Alternative.20platform.20languages.html#303095144">(Oct 09 2022 at 06:05)</a>:</h4>
<p>Also the name changed? <code>roc_fx_readFileBytes</code> and <code>roc_fx_fileReadBytes</code>?</p>



<a name="303095604"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/347488-roctoberfest/topic/Alternative%20platform%20languages/near/303095604" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis <a href="https://roc-lang.github.io/zulip-export/stream/347488-roctoberfest/topic/Alternative.20platform.20languages.html#303095604">(Oct 09 2022 at 06:14)</a>:</h4>
<p>omg you're right.  i am blind <span aria-label="face palm" class="emoji emoji-1f926" role="img" title="face palm">:face_palm:</span></p>



<a name="303096288"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/347488-roctoberfest/topic/Alternative%20platform%20languages/near/303096288" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/347488-roctoberfest/topic/Alternative.20platform.20languages.html#303096288">(Oct 09 2022 at 06:27)</a>:</h4>
<p>It's the simple things sometimes.</p>



<a name="303105410"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/347488-roctoberfest/topic/Alternative%20platform%20languages/near/303105410" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Carroll <a href="https://roc-lang.github.io/zulip-export/stream/347488-roctoberfest/topic/Alternative.20platform.20languages.html#303105410">(Oct 09 2022 at 08:38)</a>:</h4>
<p><span class="user-mention" data-user-id="551275">@Travis</span> I didn't see it mentioned above so FYI we use Zig 0.9.1 in the Roc standard library so that might be the best version to use in your platform too.</p>



<a name="303105460"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/347488-roctoberfest/topic/Alternative%20platform%20languages/near/303105460" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis <a href="https://roc-lang.github.io/zulip-export/stream/347488-roctoberfest/topic/Alternative.20platform.20languages.html#303105460">(Oct 09 2022 at 08:39)</a>:</h4>
<p>here is a zig version of <code> roc_fx_fileReadBytes()</code></p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">pub</span><span class="w"> </span><span class="n">export</span><span class="w"> </span><span class="k">fn</span> <span class="nf">roc_fx_fileReadBytes</span><span class="p">(</span><span class="n">result</span>: <span class="o">*</span><span class="n">RocResult</span><span class="p">,</span><span class="w"> </span><span class="n">path</span>: <span class="o">*</span><span class="n">RocStr</span><span class="p">)</span><span class="w"> </span><span class="n">callconv</span><span class="p">(.</span><span class="n">C</span><span class="p">)</span><span class="w"> </span><span class="n">void</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="n">file</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="p">.</span><span class="n">fs</span><span class="p">.</span><span class="n">cwd</span><span class="p">().</span><span class="n">openFile</span><span class="p">(</span><span class="n">path</span><span class="p">.</span><span class="n">asSlice</span><span class="p">(),</span><span class="w"> </span><span class="p">.{})</span><span class="w"> </span><span class="n">catch</span><span class="w"> </span><span class="n">unreachable</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="n">defer</span><span class="w"> </span><span class="n">file</span><span class="p">.</span><span class="n">close</span><span class="p">();</span><span class="w"></span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="n">stat</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">file</span><span class="p">.</span><span class="n">stat</span><span class="p">()</span><span class="w"> </span><span class="n">catch</span><span class="w"> </span><span class="n">unreachable</span><span class="p">;</span><span class="w"></span>

<span class="w">    </span><span class="n">var</span><span class="w"> </span><span class="n">buf</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">malloc</span><span class="p">(</span><span class="n">stat</span><span class="p">.</span><span class="n">size</span><span class="p">)</span><span class="w"> </span><span class="n">orelse</span><span class="w"> </span><span class="n">unreachable</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="n">var</span><span class="w"> </span><span class="n">slice</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">@</span><span class="n">ptrCast</span><span class="p">([</span><span class="o">*</span><span class="p">]</span><span class="kt">u8</span><span class="p">,</span><span class="w"> </span><span class="n">buf</span><span class="p">)[</span><span class="mi">0</span><span class="o">..</span><span class="n">stat</span><span class="p">.</span><span class="n">size</span><span class="p">];</span><span class="w"></span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="n">amt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">file</span><span class="p">.</span><span class="n">readAll</span><span class="p">(</span><span class="n">slice</span><span class="p">)</span><span class="w"> </span><span class="n">catch</span><span class="w"> </span><span class="n">unreachable</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="n">std</span><span class="p">.</span><span class="n">debug</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">"slice {s}</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span><span class="w"> </span><span class="p">.{</span><span class="n">slice</span><span class="p">[</span><span class="mi">0</span><span class="o">..</span><span class="mi">10</span><span class="p">]});</span><span class="w"></span>
<span class="w">    </span><span class="n">std</span><span class="p">.</span><span class="n">debug</span><span class="p">.</span><span class="n">assert</span><span class="p">(</span><span class="n">amt</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">stat</span><span class="p">.</span><span class="n">size</span><span class="p">);</span><span class="w"></span>

<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="n">usizes</span>: <span class="p">[</span><span class="o">*</span><span class="p">]</span><span class="kt">usize</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">@</span><span class="n">ptrCast</span><span class="p">([</span><span class="o">*</span><span class="p">]</span><span class="kt">usize</span><span class="p">,</span><span class="w"> </span><span class="o">@</span><span class="n">alignCast</span><span class="p">(</span><span class="o">@</span><span class="n">alignOf</span><span class="p">(</span><span class="kt">usize</span><span class="p">),</span><span class="w"> </span><span class="o">&amp;</span><span class="n">result</span><span class="p">.</span><span class="n">bytes</span><span class="p">));</span><span class="w"></span>
<span class="w">    </span><span class="n">usizes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"> </span><span class="c1">// Ok tag == 1</span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="n">outstr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">@</span><span class="n">ptrCast</span><span class="p">(</span><span class="o">*</span><span class="n">RocStr</span><span class="p">,</span><span class="w"> </span><span class="n">usizes</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="c1">// const outstr = std.mem.bytesAsValue(RocStr, @ptrCast([*]u8, @alignCast(1, (usizes + 1)))[0..@sizeOf(RocStr)]);</span>
<span class="w">    </span><span class="n">outstr</span><span class="p">.</span><span class="o">*</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.{</span><span class="w"> </span><span class="p">.</span><span class="n">str_bytes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">slice</span><span class="p">.</span><span class="n">ptr</span><span class="p">,</span><span class="w"> </span><span class="p">.</span><span class="n">str_len</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">slice</span><span class="p">.</span><span class="n">len</span><span class="p">,</span><span class="w"> </span><span class="p">.</span><span class="n">str_capacity</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">slice</span><span class="p">.</span><span class="n">len</span><span class="w"> </span><span class="p">};</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>
<p>it compiles and runs but doesn't seem to assign its result param correctly.  i have verified that the incoming path is correct and that it can read the file's contents.  however, nothing is printed from the roc program and subsequent prints in roc are broken after calling this function.  <br>
So i have a couple of questions:</p>
<ol>
<li>how to allocate memory in a platform call such as <code>roc_fx_fileReadBytes</code>?  this one just calls <code>malloc</code>.</li>
<li>how to set the outgoing <code>*RocResult</code> param.?  i used the following definition i from crates/compiler/builtins/bitcode/src/utils.zig.  but i'm not sure its correct or that i'm  assigning to it correctly.</li>
</ol>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">pub</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">RocResult</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">extern</span><span class="w"> </span><span class="k">struct</span> <span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="n">bytes</span>: <span class="o">?</span><span class="p">[</span><span class="o">*</span><span class="p">]</span><span class="kt">u8</span><span class="p">,</span><span class="w"></span>

<span class="w">    </span><span class="k">pub</span><span class="w"> </span><span class="k">fn</span> <span class="nf">isOk</span><span class="p">(</span><span class="bp">self</span>: <span class="nc">RocResult</span><span class="p">)</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="c1">// assumptions</span>
<span class="w">        </span><span class="c1">//</span>
<span class="w">        </span><span class="c1">// - the tag is the first field</span>
<span class="w">        </span><span class="c1">// - the tag is usize bytes wide</span>
<span class="w">        </span><span class="c1">// - Ok has tag_id 1, because Err &lt; Ok</span>
<span class="w">        </span><span class="k">const</span><span class="w"> </span><span class="n">usizes</span>: <span class="p">[</span><span class="o">*</span><span class="p">]</span><span class="kt">usize</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">@</span><span class="n">ptrCast</span><span class="p">([</span><span class="o">*</span><span class="p">]</span><span class="kt">usize</span><span class="p">,</span><span class="w"> </span><span class="o">@</span><span class="n">alignCast</span><span class="p">(</span><span class="o">@</span><span class="n">alignOf</span><span class="p">(</span><span class="kt">usize</span><span class="p">),</span><span class="w"> </span><span class="bp">self</span><span class="p">.</span><span class="n">bytes</span><span class="p">));</span><span class="w"></span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">usizes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="k">pub</span><span class="w"> </span><span class="k">fn</span> <span class="nf">isErr</span><span class="p">(</span><span class="bp">self</span>: <span class="nc">RocResult</span><span class="p">)</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="o">!</span><span class="bp">self</span><span class="p">.</span><span class="n">isOk</span><span class="p">();</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="p">};</span><span class="w"></span>
</code></pre></div>



<a name="303105609"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/347488-roctoberfest/topic/Alternative%20platform%20languages/near/303105609" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis <a href="https://roc-lang.github.io/zulip-export/stream/347488-roctoberfest/topic/Alternative.20platform.20languages.html#303105609">(Oct 09 2022 at 08:40)</a>:</h4>
<p>Thanks <span class="user-mention" data-user-id="431893">@Brian Carroll</span> yep thats the one i'm using:</p>
<div class="codehilite" data-code-language="Bash Session"><pre><span></span><code><span class="gp">$ </span>zig version
<span class="go">0.9.1</span>
</code></pre></div>



<a name="303106734"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/347488-roctoberfest/topic/Alternative%20platform%20languages/near/303106734" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis <a href="https://roc-lang.github.io/zulip-export/stream/347488-roctoberfest/topic/Alternative.20platform.20languages.html#303106734">(Oct 09 2022 at 08:51)</a>:</h4>
<p>i'm looking through crates/compiler/builtins/bitcode/src/str.zig and think i might be answering some of these questions</p>



<a name="303106741"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/347488-roctoberfest/topic/Alternative%20platform%20languages/near/303106741" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis <a href="https://roc-lang.github.io/zulip-export/stream/347488-roctoberfest/topic/Alternative.20platform.20languages.html#303106741">(Oct 09 2022 at 08:51)</a>:</h4>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="w">    </span><span class="c1">// allocate space for a (big or small) RocStr, but put nothing in it yet</span>
<span class="w">    </span><span class="k">pub</span><span class="w"> </span><span class="k">fn</span> <span class="nf">allocate</span><span class="p">(</span><span class="n">length</span>: <span class="kt">usize</span><span class="p">,</span><span class="w"> </span><span class="n">capacity</span>: <span class="kt">usize</span><span class="p">)</span><span class="w"> </span><span class="n">RocStr</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
</code></pre></div>



<a name="303107956"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/347488-roctoberfest/topic/Alternative%20platform%20languages/near/303107956" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Carroll <a href="https://roc-lang.github.io/zulip-export/stream/347488-roctoberfest/topic/Alternative.20platform.20languages.html#303107956">(Oct 09 2022 at 09:05)</a>:</h4>
<p>Roc code itself uses <code>roc_alloc</code> for heap allocations. Usually best to use that for anything that Roc code can touch.<br>
It's often implemented as a wrapper around malloc anyway.<br>
But Roc heap allocations also need reference counts. The standard library functions you found will do that for you.</p>



<a name="303108293"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/347488-roctoberfest/topic/Alternative%20platform%20languages/near/303108293" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis <a href="https://roc-lang.github.io/zulip-export/stream/347488-roctoberfest/topic/Alternative.20platform.20languages.html#303108293">(Oct 09 2022 at 09:08)</a>:</h4>
<p>another question: does this signature look correct? just noticed the rust version uses RocList&lt;u8&gt;</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">pub</span><span class="w"> </span><span class="k">extern</span><span class="w"> </span><span class="s">"C"</span><span class="w"> </span><span class="k">fn</span> <span class="nf">roc_fx_fileReadBytes</span><span class="p">(</span><span class="n">roc_path</span>: <span class="kp">&amp;</span><span class="nc">RocList</span><span class="o">&lt;</span><span class="kt">u8</span><span class="o">&gt;</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nc">RocResult</span><span class="o">&lt;</span><span class="n">RocList</span><span class="o">&lt;</span><span class="kt">u8</span><span class="o">&gt;</span><span class="p">,</span><span class="w"> </span><span class="n">ReadErr</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
</code></pre></div>
<p>and that there is a zig version of RocList in crates/compiler/builtins/bitcode/src/list.zig</p>



<a name="303108749"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/347488-roctoberfest/topic/Alternative%20platform%20languages/near/303108749" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis <a href="https://roc-lang.github.io/zulip-export/stream/347488-roctoberfest/topic/Alternative.20platform.20languages.html#303108749">(Oct 09 2022 at 09:14)</a>:</h4>
<p>thanks <span class="user-mention" data-user-id="431893">@Brian Carroll</span> i hadn't seen <code>roc_alloc</code> yet. i'm thinking that <code>RocStr.allocate</code> is the way to do this but still seeing no output in roc with it. is it correct to just read bytes from the file directly into the <code>RocStr</code>? or is there an encoding i'm missing?</p>



<a name="303108826"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/347488-roctoberfest/topic/Alternative%20platform%20languages/near/303108826" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis <a href="https://roc-lang.github.io/zulip-export/stream/347488-roctoberfest/topic/Alternative.20platform.20languages.html#303108826">(Oct 09 2022 at 09:15)</a>:</h4>
<p>i assumed since this is <code>readFileBytes</code> that it does no encoding</p>



<a name="303141809"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/347488-roctoberfest/topic/Alternative%20platform%20languages/near/303141809" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/347488-roctoberfest/topic/Alternative.20platform.20languages.html#303141809">(Oct 09 2022 at 14:53)</a>:</h4>
<p>As long as zig uses utf8, reading into a <code>RocStr</code> should be correct. I am actually surprised the rust version using a <code>RocList&lt;U8&gt;</code></p>



<a name="303143307"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/347488-roctoberfest/topic/Alternative%20platform%20languages/near/303143307" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis <a href="https://roc-lang.github.io/zulip-export/stream/347488-roctoberfest/topic/Alternative.20platform.20languages.html#303143307">(Oct 09 2022 at 15:10)</a>:</h4>
<p>ok thats good to know. zig strings are not encoded in any way, just byte slices.</p>



<a name="303143534"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/347488-roctoberfest/topic/Alternative%20platform%20languages/near/303143534" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis <a href="https://roc-lang.github.io/zulip-export/stream/347488-roctoberfest/topic/Alternative.20platform.20languages.html#303143534">(Oct 09 2022 at 15:12)</a>:</h4>
<p>any idea about the correctness of  the last few lines of my zig <code>roc_fx_fileReadBytes()</code> here  <a href="#narrow/stream/347488-roctoberfest/topic/Alternative.20platform.20languages/near/303105460">https://roc.zulipchat.com/#narrow/stream/347488-roctoberfest/topic/Alternative.20platform.20languages/near/303105460</a> ?  i'm interpreting the first param as a <code>*RocResult</code> and writing a 1 to the first <code>usize</code> then treating the next 3 <code>usize</code> as a <code>RocStr</code> value.</p>



<a name="303144874"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/347488-roctoberfest/topic/Alternative%20platform%20languages/near/303144874" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis <a href="https://roc-lang.github.io/zulip-export/stream/347488-roctoberfest/topic/Alternative.20platform.20languages.html#303144874">(Oct 09 2022 at 15:27)</a>:</h4>
<p>here is an updated version which uses <code>RocStr.allocate()</code></p>



<a name="303144885"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/347488-roctoberfest/topic/Alternative%20platform%20languages/near/303144885" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis <a href="https://roc-lang.github.io/zulip-export/stream/347488-roctoberfest/topic/Alternative.20platform.20languages.html#303144885">(Oct 09 2022 at 15:27)</a>:</h4>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">pub</span><span class="w"> </span><span class="n">export</span><span class="w"> </span><span class="k">fn</span> <span class="nf">roc_fx_fileReadBytes</span><span class="p">(</span><span class="n">result</span>: <span class="o">*</span><span class="n">RocResult</span><span class="p">,</span><span class="w"> </span><span class="n">path</span>: <span class="o">*</span><span class="n">RocStr</span><span class="p">)</span><span class="w"> </span><span class="n">callconv</span><span class="p">(.</span><span class="n">C</span><span class="p">)</span><span class="w"> </span><span class="n">void</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="n">file</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="p">.</span><span class="n">fs</span><span class="p">.</span><span class="n">cwd</span><span class="p">().</span><span class="n">openFile</span><span class="p">(</span><span class="n">path</span><span class="p">.</span><span class="n">asSlice</span><span class="p">(),</span><span class="w"> </span><span class="p">.{})</span><span class="w"> </span><span class="n">catch</span><span class="w"> </span><span class="n">unreachable</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="n">defer</span><span class="w"> </span><span class="n">file</span><span class="p">.</span><span class="n">close</span><span class="p">();</span><span class="w"></span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="n">stat</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">file</span><span class="p">.</span><span class="n">stat</span><span class="p">()</span><span class="w"> </span><span class="n">catch</span><span class="w"> </span><span class="n">unreachable</span><span class="p">;</span><span class="w"></span>

<span class="w">    </span><span class="n">var</span><span class="w"> </span><span class="n">rocstr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">RocStr</span><span class="p">.</span><span class="n">allocate</span><span class="p">(</span><span class="n">stat</span><span class="p">.</span><span class="n">size</span><span class="p">,</span><span class="w"> </span><span class="n">stat</span><span class="p">.</span><span class="n">size</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="n">var</span><span class="w"> </span><span class="n">bytes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rocstr</span><span class="p">.</span><span class="n">str_bytes</span><span class="w"> </span><span class="n">orelse</span><span class="w"> </span><span class="n">unreachable</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="n">slice</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">bytes</span><span class="p">[</span><span class="mi">0</span><span class="o">..</span><span class="n">stat</span><span class="p">.</span><span class="n">size</span><span class="p">];</span><span class="w"></span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="n">amt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">file</span><span class="p">.</span><span class="n">readAll</span><span class="p">(</span><span class="n">slice</span><span class="p">)</span><span class="w"> </span><span class="n">catch</span><span class="w"> </span><span class="n">unreachable</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="c1">// std.debug.print("slice {s}\n", .{slice[0..10]});</span>
<span class="w">    </span><span class="n">std</span><span class="p">.</span><span class="n">debug</span><span class="p">.</span><span class="n">assert</span><span class="p">(</span><span class="n">amt</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">stat</span><span class="p">.</span><span class="n">size</span><span class="p">);</span><span class="w"></span>

<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="n">usizes</span>: <span class="p">[</span><span class="o">*</span><span class="p">]</span><span class="kt">usize</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">@</span><span class="n">ptrCast</span><span class="p">([</span><span class="o">*</span><span class="p">]</span><span class="kt">usize</span><span class="p">,</span><span class="w"> </span><span class="o">@</span><span class="n">alignCast</span><span class="p">(</span><span class="o">@</span><span class="n">alignOf</span><span class="p">(</span><span class="kt">usize</span><span class="p">),</span><span class="w"> </span><span class="o">&amp;</span><span class="n">result</span><span class="p">.</span><span class="n">bytes</span><span class="p">));</span><span class="w"></span>
<span class="w">    </span><span class="n">usizes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"> </span><span class="c1">// Ok tag == 1</span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="n">outstr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">@</span><span class="n">ptrCast</span><span class="p">(</span><span class="o">*</span><span class="n">RocStr</span><span class="p">,</span><span class="w"> </span><span class="n">usizes</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="n">outstr</span><span class="p">.</span><span class="o">*</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rocstr</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>



<a name="303152500"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/347488-roctoberfest/topic/Alternative%20platform%20languages/near/303152500" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/347488-roctoberfest/topic/Alternative.20platform.20languages.html#303152500">(Oct 09 2022 at 16:48)</a>:</h4>
<p><code>RocResults</code> doesn't work that way. The tag is at the end.</p>



<a name="303152534"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/347488-roctoberfest/topic/Alternative%20platform%20languages/near/303152534" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/347488-roctoberfest/topic/Alternative.20platform.20languages.html#303152534">(Oct 09 2022 at 16:49)</a>:</h4>
<p>I am pretty sure we always put tags at the end to save space by making them able to pack smaller</p>



<a name="303152713"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/347488-roctoberfest/topic/Alternative%20platform%20languages/near/303152713" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/347488-roctoberfest/topic/Alternative.20platform.20languages.html#303152713">(Oct 09 2022 at 16:51)</a>:</h4>
<p>Also, I think you should be returning the RocResult, not taking it as an out param.</p>



<a name="303154400"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/347488-roctoberfest/topic/Alternative%20platform%20languages/near/303154400" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis <a href="https://roc-lang.github.io/zulip-export/stream/347488-roctoberfest/topic/Alternative.20platform.20languages.html#303154400">(Oct 09 2022 at 17:10)</a>:</h4>
<p><span class="user-mention silent" data-user-id="343810">Brendan Hansknecht</span> <a href="#narrow/stream/347488-roctoberfest/topic/Alternative.20platform.20languages/near/303152713">said</a>:</p>
<blockquote>
<p>Also, I think you should be returning the RocResult, not taking it as an out param.</p>
</blockquote>
<p>if this is the case, any idea what the first param is? path is being correctly passed as the second param and i'm able to print it out.</p>



<a name="303154628"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/347488-roctoberfest/topic/Alternative%20platform%20languages/near/303154628" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/347488-roctoberfest/topic/Alternative.20platform.20languages.html#303154628">(Oct 09 2022 at 17:13)</a>:</h4>
<p>Ah, that's just c-abi fun. I guess technically under c-abi the two function signatures are the same.</p>



<a name="303154734"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/347488-roctoberfest/topic/Alternative%20platform%20languages/near/303154734" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/347488-roctoberfest/topic/Alternative.20platform.20languages.html#303154734">(Oct 09 2022 at 17:14)</a>:</h4>
<p>Anything returned that is larger than 128bit is converted to return via pointer. But zigs callconv c should handle that for you. Also, zig handling it means you don't have to think about the differences as you change platforms.</p>



<a name="303154929"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/347488-roctoberfest/topic/Alternative%20platform%20languages/near/303154929" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis <a href="https://roc-lang.github.io/zulip-export/stream/347488-roctoberfest/topic/Alternative.20platform.20languages.html#303154929">(Oct 09 2022 at 17:17)</a>:</h4>
<p>ah that makes sense. so would it be proper to ignore the first param and return a RocResult by value or go back to the out param?</p>



<a name="303155022"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/347488-roctoberfest/topic/Alternative%20platform%20languages/near/303155022" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/347488-roctoberfest/topic/Alternative.20platform.20languages.html#303155022">(Oct 09 2022 at 17:18)</a>:</h4>
<p>You would have to go back to the out param.</p>



<a name="303155091"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/347488-roctoberfest/topic/Alternative%20platform%20languages/near/303155091" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/347488-roctoberfest/topic/Alternative.20platform.20languages.html#303155091">(Oct 09 2022 at 17:19)</a>:</h4>
<p>Also, as a base test, maybe make it just return a RocStr and not a result. That will ensure the pipelining before you figure out the RocResult correctly.</p>



<a name="303155150"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/347488-roctoberfest/topic/Alternative%20platform%20languages/near/303155150" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis <a href="https://roc-lang.github.io/zulip-export/stream/347488-roctoberfest/topic/Alternative.20platform.20languages.html#303155150">(Oct 09 2022 at 17:19)</a>:</h4>
<p>hmm ok thanks. will give it a try.</p>



<a name="303155482"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/347488-roctoberfest/topic/Alternative%20platform%20languages/near/303155482" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/347488-roctoberfest/topic/Alternative.20platform.20languages.html#303155482">(Oct 09 2022 at 17:23)</a>:</h4>
<p>Hmm. Also just double checked some code. How you set the roc result originally actually looks correct. We do put the tag at the beginning. I stand corrected.</p>



<a name="303155876"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/347488-roctoberfest/topic/Alternative%20platform%20languages/near/303155876" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/347488-roctoberfest/topic/Alternative.20platform.20languages.html#303155876">(Oct 09 2022 at 17:27)</a>:</h4>
<p>Hmmm....i am confused. In our rust code for roc result, the tag is at the end. In a util function in zig, the tag is at the beginning.....definitely a bug somewhere.</p>



<a name="303155961"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/347488-roctoberfest/topic/Alternative%20platform%20languages/near/303155961" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/347488-roctoberfest/topic/Alternative.20platform.20languages.html#303155961">(Oct 09 2022 at 17:28)</a>:</h4>
<p>Ah, the zig function is never used....so probably wrong.</p>



<a name="303156157"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/347488-roctoberfest/topic/Alternative%20platform%20languages/near/303156157" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis <a href="https://roc-lang.github.io/zulip-export/stream/347488-roctoberfest/topic/Alternative.20platform.20languages.html#303156157">(Oct 09 2022 at 17:31)</a>:</h4>
<p>yeah i was a little confused by that too. are you looking at <code>const RocResult =</code> in crates/compiler/builtins/bitcode/src/utils.zig ?</p>



<a name="303156220"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/347488-roctoberfest/topic/Alternative%20platform%20languages/near/303156220" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/347488-roctoberfest/topic/Alternative.20platform.20languages.html#303156220">(Oct 09 2022 at 17:31)</a>:</h4>
<p>Ok, yeah sorry for the confusion. Ignore the code in <code>utils.zig</code> it isn't used and is outdated and wrong. So I am pretty sure the tag is at the beginning and you should define RocResult like this (rust definition):</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="cp">#[repr(C)]</span><span class="w"></span>
<span class="k">pub</span><span class="w"> </span><span class="k">struct</span> <span class="nc">RocResult</span><span class="o">&lt;</span><span class="n">T</span><span class="p">,</span><span class="w"> </span><span class="n">E</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="n">payload</span>: <span class="nc">RocResultPayload</span><span class="o">&lt;</span><span class="n">T</span><span class="p">,</span><span class="w"> </span><span class="n">E</span><span class="o">&gt;</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="n">tag</span>: <span class="nc">RocResultTag</span><span class="p">,</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="cp">#[repr(u8)]</span><span class="w"></span>
<span class="cp">#[derive(Clone, Copy)]</span><span class="w"></span>
<span class="k">enum</span> <span class="nc">RocResultTag</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="n">RocErr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="n">RocOk</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="cp">#[repr(C)]</span><span class="w"></span>
<span class="k">union</span> <span class="nc">RocResultPayload</span><span class="o">&lt;</span><span class="n">T</span><span class="p">,</span><span class="w"> </span><span class="n">E</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="n">ok</span>: <span class="nc">ManuallyDrop</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="n">err</span>: <span class="nc">ManuallyDrop</span><span class="o">&lt;</span><span class="n">E</span><span class="o">&gt;</span><span class="p">,</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>



<a name="303156417"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/347488-roctoberfest/topic/Alternative%20platform%20languages/near/303156417" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis <a href="https://roc-lang.github.io/zulip-export/stream/347488-roctoberfest/topic/Alternative.20platform.20languages.html#303156417">(Oct 09 2022 at 17:34)</a>:</h4>
<p>ok sounds good. one last question, would the result payload be a <code>*RocStr</code> or <code>RocStr</code>?</p>



<a name="303156475"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/347488-roctoberfest/topic/Alternative%20platform%20languages/near/303156475" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis <a href="https://roc-lang.github.io/zulip-export/stream/347488-roctoberfest/topic/Alternative.20platform.20languages.html#303156475">(Oct 09 2022 at 17:35)</a>:</h4>
<p>or more generally <code>*T</code> vs <code>T</code></p>



<a name="303156509"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/347488-roctoberfest/topic/Alternative%20platform%20languages/near/303156509" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/347488-roctoberfest/topic/Alternative.20platform.20languages.html#303156509">(Oct 09 2022 at 17:35)</a>:</h4>
<p>Should be a RocStr</p>



<a name="303156522"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/347488-roctoberfest/topic/Alternative%20platform%20languages/near/303156522" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/347488-roctoberfest/topic/Alternative.20platform.20languages.html#303156522">(Oct 09 2022 at 17:35)</a>:</h4>
<p>So T</p>



<a name="303196425"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/347488-roctoberfest/topic/Alternative%20platform%20languages/near/303196425" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis <a href="https://roc-lang.github.io/zulip-export/stream/347488-roctoberfest/topic/Alternative.20platform.20languages.html#303196425">(Oct 10 2022 at 04:52)</a>:</h4>
<p>i made a repo for this incase anyone is interested in using or contributing</p>



<a name="303196431"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/347488-roctoberfest/topic/Alternative%20platform%20languages/near/303196431" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis <a href="https://roc-lang.github.io/zulip-export/stream/347488-roctoberfest/topic/Alternative.20platform.20languages.html#303196431">(Oct 10 2022 at 04:52)</a>:</h4>
<p><a href="https://github.com/travisstaloch/roc-zig-cli-platform">https://github.com/travisstaloch/roc-zig-cli-platform</a></p>



<a name="303196602"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/347488-roctoberfest/topic/Alternative%20platform%20languages/near/303196602" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis <a href="https://roc-lang.github.io/zulip-export/stream/347488-roctoberfest/topic/Alternative.20platform.20languages.html#303196602">(Oct 10 2022 at 04:56)</a>:</h4>
<p>so far it can only really do <code>Stdout.line</code>. the following works with the commented out lines currently broken.</p>
<div class="codehilite" data-code-language="Elixir"><pre><span></span><code><span class="n">main</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="nc">Program</span><span class="w"></span>
<span class="n">main</span><span class="w"> </span><span class="o">=</span><span class="w"></span>
<span class="w">    </span><span class="n">pathstr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"platform-test/1.txt"</span><span class="w"></span>
<span class="w">    </span><span class="n">path</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">Path</span><span class="o">.</span><span class="n">fromStr</span><span class="w"> </span><span class="n">pathstr</span><span class="w"></span>
<span class="w">    </span><span class="n">task</span><span class="w"> </span><span class="o">=</span><span class="w"></span>
<span class="w">        </span><span class="bp">_</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nc">Task</span><span class="o">.</span><span class="n">await</span><span class="w"> </span><span class="p">(</span><span class="nc">Stdout</span><span class="o">.</span><span class="n">line</span><span class="w"> </span><span class="p">(</span><span class="nc">Path</span><span class="o">.</span><span class="n">display</span><span class="w"> </span><span class="n">path</span><span class="p">))</span><span class="w"></span>
<span class="w">        </span><span class="bp">_</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nc">Task</span><span class="o">.</span><span class="n">await</span><span class="w"> </span><span class="p">(</span><span class="nc">Stdout</span><span class="o">.</span><span class="n">line</span><span class="w"> </span><span class="s2">"this gets printed"</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="c1"># contents &lt;- Task.await (File.readBytes path)</span><span class="w"></span>
<span class="w">        </span><span class="c1"># _ &lt;- Task.await (Stdout.line ((Str.fromUtf8 contents) # silently fails, breaks subsequent prints</span><span class="w"></span>
<span class="w">        </span><span class="c1">#    |&gt; (Result.withDefault "oops")))</span><span class="w"></span>
<span class="w">        </span><span class="nc">Stdout</span><span class="o">.</span><span class="n">line</span><span class="w"> </span><span class="s2">"this doesn't get printed"</span><span class="w"></span>
<span class="w">    </span><span class="nc">Program</span><span class="o">.</span><span class="n">quick</span><span class="w"> </span><span class="n">task</span><span class="w"></span>
</code></pre></div>



<a name="303196721"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/347488-roctoberfest/topic/Alternative%20platform%20languages/near/303196721" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis <a href="https://roc-lang.github.io/zulip-export/stream/347488-roctoberfest/topic/Alternative.20platform.20languages.html#303196721">(Oct 10 2022 at 04:57)</a>:</h4>
<p>its a straight copy of the rust platform in examples/cli/cli-platform</p>



<a name="303197262"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/347488-roctoberfest/topic/Alternative%20platform%20languages/near/303197262" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis <a href="https://roc-lang.github.io/zulip-export/stream/347488-roctoberfest/topic/Alternative.20platform.20languages.html#303197262">(Oct 10 2022 at 05:04)</a>:</h4>
<div class="codehilite" data-code-language="Bash Session"><pre><span></span><code><span class="gp">$ </span>./build.sh
<span class="go">🔨 Rebuilding platform...</span>
<span class="go">platform-test/1.txt</span>
<span class="go">this gets printed</span>
<span class="go">this doesn't get printed</span>
</code></pre></div>



<a name="303197503"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/347488-roctoberfest/topic/Alternative%20platform%20languages/near/303197503" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis <a href="https://roc-lang.github.io/zulip-export/stream/347488-roctoberfest/topic/Alternative.20platform.20languages.html#303197503">(Oct 10 2022 at 05:08)</a>:</h4>
<p>i am hoping to get some guidance on how to make <code>File.readBytes</code> work correctly. here is my attempt: <a href="https://github.com/travisstaloch/roc-zig-cli-platform/blob/main/platform/host.zig#L258">https://github.com/travisstaloch/roc-zig-cli-platform/blob/main/platform/host.zig#L258</a></p>



<a name="303203098"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/347488-roctoberfest/topic/Alternative%20platform%20languages/near/303203098" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/347488-roctoberfest/topic/Alternative.20platform.20languages.html#303203098">(Oct 10 2022 at 06:24)</a>:</h4>
<p>Just a general note for you, there is a tool <code>roc glue</code> that will make this significantly easier in the future. Currently it only supports rust, but it is made to take roc data structures and convert them to another language. Would eventually also do function signatures. That would more or less directly solve the main problems you are fighting here.</p>



<a name="303206794"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/347488-roctoberfest/topic/Alternative%20platform%20languages/near/303206794" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis <a href="https://roc-lang.github.io/zulip-export/stream/347488-roctoberfest/topic/Alternative.20platform.20languages.html#303206794">(Oct 10 2022 at 07:06)</a>:</h4>
<p>neat! will keep an eye on it.  i'm guessing it depends on a rust/cargo?  that might explain the panic when i try to use it</p>



<a name="303262244"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/347488-roctoberfest/topic/Alternative%20platform%20languages/near/303262244" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis <a href="https://roc-lang.github.io/zulip-export/stream/347488-roctoberfest/topic/Alternative.20platform.20languages.html#303262244">(Oct 10 2022 at 13:41)</a>:</h4>
<p><span class="user-mention silent" data-user-id="343810">Brendan Hansknecht</span> <a href="#narrow/stream/347488-roctoberfest/topic/Alternative.20platform.20languages/near/303155091">said</a>:</p>
<blockquote>
<p>Also, as a base test, maybe make it just return a RocStr and not a result. That will ensure the pipelining before you figure out the RocResult correctly.</p>
</blockquote>
<p>I forgot to mention that I did attempt this, and was glad for the suggestion. but I couldn't manage to create correct roc Effect code to call it.</p>



<a name="303262547"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/347488-roctoberfest/topic/Alternative%20platform%20languages/near/303262547" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis <a href="https://roc-lang.github.io/zulip-export/stream/347488-roctoberfest/topic/Alternative.20platform.20languages.html#303262547">(Oct 10 2022 at 13:43)</a>:</h4>
<p>and if you have any suggestions on how to do it, i'd like to try them</p>



<a name="303263193"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/347488-roctoberfest/topic/Alternative%20platform%20languages/near/303263193" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis <a href="https://roc-lang.github.io/zulip-export/stream/347488-roctoberfest/topic/Alternative.20platform.20languages.html#303263193">(Oct 10 2022 at 13:46)</a>:</h4>
<p>on a different note, I wonder if the issues i'm having could possibly be invoking some zig/c abi bugs? there was discussion in the zig discord  yesterday  about this <a href="https://discord.com/channels/605571803288698900/785499283368706060/1028831580426354718">https://discord.com/channels/605571803288698900/785499283368706060/1028831580426354718</a> - sounds like its specific to zig extern structs as arguments to c functions</p>



<a name="303263665"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/347488-roctoberfest/topic/Alternative%20platform%20languages/near/303263665" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis <a href="https://roc-lang.github.io/zulip-export/stream/347488-roctoberfest/topic/Alternative.20platform.20languages.html#303263665">(Oct 10 2022 at 13:49)</a>:</h4>
<p>i might try implementing <code>roc_fx_fileReadBytes()</code> in c</p>



<a name="303264202"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/347488-roctoberfest/topic/Alternative%20platform%20languages/near/303264202" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis <a href="https://roc-lang.github.io/zulip-export/stream/347488-roctoberfest/topic/Alternative.20platform.20languages.html#303264202">(Oct 10 2022 at 13:52)</a>:</h4>
<p>and if that works, i wonder if its possible to have a mixed c/zig host?</p>



<a name="303266297"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/347488-roctoberfest/topic/Alternative%20platform%20languages/near/303266297" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/347488-roctoberfest/topic/Alternative.20platform.20languages.html#303266297">(Oct 10 2022 at 14:03)</a>:</h4>
<p>Zig will compile c, do that should be fine</p>



<a name="303266385"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/347488-roctoberfest/topic/Alternative%20platform%20languages/near/303266385" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/347488-roctoberfest/topic/Alternative.20platform.20languages.html#303266385">(Oct 10 2022 at 14:04)</a>:</h4>
<p>Also, I'll try and take a look today to see if I missed something with the zig signature</p>



<a name="303266680"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/347488-roctoberfest/topic/Alternative%20platform%20languages/near/303266680" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis <a href="https://roc-lang.github.io/zulip-export/stream/347488-roctoberfest/topic/Alternative.20platform.20languages.html#303266680">(Oct 10 2022 at 14:06)</a>:</h4>
<blockquote>
<p>Zig will compile c, do that should be fine</p>
</blockquote>
<p>are you thinking of @cImport or does roc automatically add host.c files to the compilation?</p>



<a name="303267031"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/347488-roctoberfest/topic/Alternative%20platform%20languages/near/303267031" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis <a href="https://roc-lang.github.io/zulip-export/stream/347488-roctoberfest/topic/Alternative.20platform.20languages.html#303267031">(Oct 10 2022 at 14:08)</a>:</h4>
<p>cause @cImport is really meant for headers, not implementations</p>



<a name="303267753"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/347488-roctoberfest/topic/Alternative%20platform%20languages/near/303267753" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/347488-roctoberfest/topic/Alternative.20platform.20languages.html#303267753">(Oct 10 2022 at 14:12)</a>:</h4>
<p>I just mean that I know zig can be used to build projects that are a mix of c and zig. So this should be possible to set up</p>



<a name="303268773"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/347488-roctoberfest/topic/Alternative%20platform%20languages/near/303268773" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis <a href="https://roc-lang.github.io/zulip-export/stream/347488-roctoberfest/topic/Alternative.20platform.20languages.html#303268773">(Oct 10 2022 at 14:18)</a>:</h4>
<p>oic. yeah would be nice</p>



<a name="303269746"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/347488-roctoberfest/topic/Alternative%20platform%20languages/near/303269746" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/347488-roctoberfest/topic/Alternative.20platform.20languages.html#303269746">(Oct 10 2022 at 14:24)</a>:</h4>
<p>We would probably have to change roc to support build.zig files, but should be doable.</p>



<a name="303269838"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/347488-roctoberfest/topic/Alternative%20platform%20languages/near/303269838" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis <a href="https://roc-lang.github.io/zulip-export/stream/347488-roctoberfest/topic/Alternative.20platform.20languages.html#303269838">(Oct 10 2022 at 14:24)</a>:</h4>
<p>do you happen to know much about how platforms are built? i want to know why its possible to @import("str") package in a host.zig</p>



<a name="303269972"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/347488-roctoberfest/topic/Alternative%20platform%20languages/near/303269972" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis <a href="https://roc-lang.github.io/zulip-export/stream/347488-roctoberfest/topic/Alternative.20platform.20languages.html#303269972">(Oct 10 2022 at 14:25)</a>:</h4>
<p>the only build.zig i could find in the whole project is ./crates/compiler/builtins/bitcode/build.zig and it doesn't seem to call <code>addPackage()</code> anywhere</p>



<a name="303270120"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/347488-roctoberfest/topic/Alternative%20platform%20languages/near/303270120" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/347488-roctoberfest/topic/Alternative.20platform.20languages.html#303270120">(Oct 10 2022 at 14:26)</a>:</h4>
<p>Just a simple hack were we call zig build-exe with an extra age for our internal str.zig file. Look at crstes/compiler/build/src/link.rs (full disclosure: very hacked together and naturally grown)</p>



<a name="303270167"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/347488-roctoberfest/topic/Alternative%20platform%20languages/near/303270167" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis <a href="https://roc-lang.github.io/zulip-export/stream/347488-roctoberfest/topic/Alternative.20platform.20languages.html#303270167">(Oct 10 2022 at 14:26)</a>:</h4>
<p>maybe there is a command line for it ie: <code>$ zig build-exe ... --pkg-begin str .. --pkg-end</code></p>



<a name="303270223"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/347488-roctoberfest/topic/Alternative%20platform%20languages/near/303270223" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis <a href="https://roc-lang.github.io/zulip-export/stream/347488-roctoberfest/topic/Alternative.20platform.20languages.html#303270223">(Oct 10 2022 at 14:26)</a>:</h4>
<p>ah ok thank you</p>



<a name="303270265"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/347488-roctoberfest/topic/Alternative%20platform%20languages/near/303270265" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/347488-roctoberfest/topic/Alternative.20platform.20languages.html#303270265">(Oct 10 2022 at 14:27)</a>:</h4>
<p>And yeah, exactly what you just posted</p>



<a name="303270393"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/347488-roctoberfest/topic/Alternative%20platform%20languages/near/303270393" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/347488-roctoberfest/topic/Alternative.20platform.20languages.html#303270393">(Oct 10 2022 at 14:27)</a>:</h4>
<p>Realistically, we shouldn't do that. Our str.zig file should be internal only. Platforms longer term should depend on glue for a proper definition. Just doesn't support anything but rust yet.</p>



<a name="303270404"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/347488-roctoberfest/topic/Alternative%20platform%20languages/near/303270404" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis <a href="https://roc-lang.github.io/zulip-export/stream/347488-roctoberfest/topic/Alternative.20platform.20languages.html#303270404">(Oct 10 2022 at 14:28)</a>:</h4>
<p>good to know where that happens</p>



<a name="303277305"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/347488-roctoberfest/topic/Alternative%20platform%20languages/near/303277305" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/347488-roctoberfest/topic/Alternative.20platform.20languages.html#303277305">(Oct 10 2022 at 15:06)</a>:</h4>
<p>Ok. So example implementation that at least mostly works:</p>
<div class="codehilite" data-code-language="Zig"><pre><span></span><code><span class="kr">pub</span><span class="w"> </span><span class="kr">export</span><span class="w"> </span><span class="k">fn</span><span class="w"> </span><span class="n">roc_fx_fileReadBytes</span><span class="p">(</span><span class="n">path</span><span class="o">:</span><span class="w"> </span><span class="o">*</span><span class="n">RocList</span><span class="p">)</span><span class="w"> </span><span class="n">callconv</span><span class="p">(.</span><span class="n">C</span><span class="p">)</span><span class="w"> </span><span class="n">ResultRocList</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="n">std</span><span class="p">.</span><span class="n">debug</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">"Called fileReadBytes</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span><span class="w"> </span><span class="p">.{});</span><span class="w"></span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">path</span><span class="p">.</span><span class="n">bytes</span><span class="p">)</span><span class="w"> </span><span class="o">|</span><span class="n">path_ptr</span><span class="o">|</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="kr">const</span><span class="w"> </span><span class="n">path_slice</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">path_ptr</span><span class="p">[</span><span class="mi">0</span><span class="p">..</span><span class="n">path</span><span class="p">.</span><span class="n">len</span><span class="p">()];</span><span class="w"></span>
<span class="w">        </span><span class="kr">var</span><span class="w"> </span><span class="n">realpathbuf</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="mi">256</span><span class="p">]</span><span class="kt">u8</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">undefined</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="kr">const</span><span class="w"> </span><span class="n">realpath</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="p">.</span><span class="n">fs</span><span class="p">.</span><span class="n">cwd</span><span class="p">().</span><span class="n">realpath</span><span class="p">(</span><span class="s">"."</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">realpathbuf</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">std</span><span class="p">.</span><span class="n">debug</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">"path '{s}' realpath {s}</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span><span class="w"> </span><span class="p">.{</span><span class="w"> </span><span class="n">path_slice</span><span class="p">,</span><span class="w"> </span><span class="n">realpath</span><span class="w"> </span><span class="p">});</span><span class="w"></span>
<span class="w">        </span><span class="kr">const</span><span class="w"> </span><span class="n">file</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="p">.</span><span class="n">fs</span><span class="p">.</span><span class="n">cwd</span><span class="p">().</span><span class="n">openFile</span><span class="p">(</span><span class="n">path_slice</span><span class="p">,</span><span class="w"> </span><span class="p">.{})</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="o">|</span><span class="n">e</span><span class="o">|</span><span class="w"></span>
<span class="w">            </span><span class="n">roc_panic_print</span><span class="p">(</span><span class="s">"{s} file path '{s}'</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span><span class="w"> </span><span class="p">.{</span><span class="w"> </span><span class="nb">@errorName</span><span class="p">(</span><span class="n">e</span><span class="p">),</span><span class="w"> </span><span class="n">path_slice</span><span class="w"> </span><span class="p">});</span><span class="w"></span>
<span class="w">        </span><span class="k">defer</span><span class="w"> </span><span class="n">file</span><span class="p">.</span><span class="n">close</span><span class="p">();</span><span class="w"></span>
<span class="w">        </span><span class="kr">const</span><span class="w"> </span><span class="n">stat</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">file</span><span class="p">.</span><span class="n">stat</span><span class="p">()</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="o">|</span><span class="n">e</span><span class="o">|</span><span class="w"></span>
<span class="w">            </span><span class="n">roc_panic_print</span><span class="p">(</span><span class="s">"{s} file path '{s}'</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span><span class="w"> </span><span class="p">.{</span><span class="w"> </span><span class="nb">@errorName</span><span class="p">(</span><span class="n">e</span><span class="p">),</span><span class="w"> </span><span class="n">path_slice</span><span class="w"> </span><span class="p">});</span><span class="w"></span>
<span class="w">        </span><span class="c1">// std.debug.print("stat.size {}\n", .{stat.size});</span>
<span class="w">        </span><span class="kr">var</span><span class="w"> </span><span class="n">roclist</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">RocList</span><span class="p">.</span><span class="n">allocate</span><span class="p">(</span><span class="nb">@alignOf</span><span class="p">(</span><span class="kt">usize</span><span class="p">),</span><span class="w"> </span><span class="n">stat</span><span class="p">.</span><span class="n">size</span><span class="p">,</span><span class="w"> </span><span class="n">stat</span><span class="p">.</span><span class="n">size</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">roclist</span><span class="p">.</span><span class="n">bytes</span><span class="p">)</span><span class="w"> </span><span class="o">|</span><span class="n">bytes</span><span class="o">|</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="kr">const</span><span class="w"> </span><span class="n">slice</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">bytes</span><span class="p">[</span><span class="mi">0</span><span class="p">..</span><span class="n">stat</span><span class="p">.</span><span class="n">size</span><span class="p">];</span><span class="w"></span>
<span class="w">            </span><span class="kr">const</span><span class="w"> </span><span class="n">amt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">file</span><span class="p">.</span><span class="n">readAll</span><span class="p">(</span><span class="n">slice</span><span class="p">)</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="k">unreachable</span><span class="p">;</span><span class="w"></span>
<span class="w">            </span><span class="n">std</span><span class="p">.</span><span class="n">debug</span><span class="p">.</span><span class="n">assert</span><span class="p">(</span><span class="n">amt</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">stat</span><span class="p">.</span><span class="n">size</span><span class="p">);</span><span class="w"></span>

<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">ResultRocList</span><span class="p">{</span><span class="w"></span>
<span class="w">                </span><span class="p">.</span><span class="n">payload</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">roclist</span><span class="p">,</span><span class="w"></span>
<span class="w">                </span><span class="p">.</span><span class="n">tag</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"></span>
<span class="w">            </span><span class="p">};</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">ResultRocList</span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="p">.</span><span class="n">payload</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">RocList</span><span class="p">.</span><span class="n">empty</span><span class="p">(),</span><span class="w"></span>
<span class="w">        </span><span class="p">.</span><span class="n">tag</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="p">};</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>



<a name="303277356"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/347488-roctoberfest/topic/Alternative%20platform%20languages/near/303277356" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/347488-roctoberfest/topic/Alternative.20platform.20languages.html#303277356">(Oct 10 2022 at 15:06)</a>:</h4>
<p>Note, using RocList to match the Effect that is defined: <code>fileReadBytes : List U8 -&gt; Effect (Result (List U8) InternalFile.ReadErr)</code></p>



<a name="303277747"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/347488-roctoberfest/topic/Alternative%20platform%20languages/near/303277747" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/347488-roctoberfest/topic/Alternative.20platform.20languages.html#303277747">(Oct 10 2022 at 15:08)</a>:</h4>
<p>For your roc main:</p>
<div class="codehilite" data-code-language="CoffeeScript"><pre><span></span><code><span class="w">        </span><span class="nx">_</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nx">Task</span><span class="p">.</span><span class="nx">await</span><span class="w"> </span><span class="p">(</span><span class="nx">Stdout</span><span class="p">.</span><span class="nx">line</span><span class="w"> </span><span class="p">(</span><span class="nx">Path</span><span class="p">.</span><span class="nx">display</span><span class="w"> </span><span class="nx">path</span><span class="p">))</span><span class="w"></span>
<span class="w">        </span><span class="nx">_</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nx">Task</span><span class="p">.</span><span class="nx">await</span><span class="w"> </span><span class="p">(</span><span class="nx">Stdout</span><span class="p">.</span><span class="nx">line</span><span class="w"> </span><span class="s">"this gets printed"</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="nx">contents</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nx">Task</span><span class="p">.</span><span class="nx">await</span><span class="w"> </span><span class="p">(</span><span class="nx">File</span><span class="p">.</span><span class="nx">readBytes</span><span class="w"> </span><span class="nx">path</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="nx">_</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nx">Task</span><span class="p">.</span><span class="nx">await</span><span class="w"> </span><span class="p">(</span><span class="nx">Stdout</span><span class="p">.</span><span class="nx">line</span><span class="w"> </span><span class="p">((</span><span class="nx">Str</span><span class="p">.</span><span class="nx">fromUtf8</span><span class="w"> </span><span class="nx">contents</span><span class="p">)</span><span class="w"> </span><span class="c1"># silently fails, breaks subsequent prints</span><span class="w"></span>
<span class="w">            </span><span class="o">|&gt;</span><span class="w"> </span><span class="p">(</span><span class="nx">Result</span><span class="p">.</span><span class="nx">withDefault</span><span class="w"> </span><span class="s">"oops"</span><span class="p">)))</span><span class="w"></span>
<span class="w">        </span><span class="nx">Stdout</span><span class="p">.</span><span class="nx">line</span><span class="w"> </span><span class="s">"this doesn't get printed"</span><span class="w"></span>
</code></pre></div>
<p>The last line doesn't print because the <code>Task.await</code> is returning a failure. That kills the rest of the task chain.</p>



<a name="303277877"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/347488-roctoberfest/topic/Alternative%20platform%20languages/near/303277877" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/347488-roctoberfest/topic/Alternative.20platform.20languages.html#303277877">(Oct 10 2022 at 15:09)</a>:</h4>
<p>Why does the function return a failure even when you set the tag to 1:</p>
<p>Try commenting out <code>Unrecognized I32 Str</code> in <code>InternalFile.roc</code>. Now everything should run fine.</p>



<a name="303278053"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/347488-roctoberfest/topic/Alternative%20platform%20languages/near/303278053" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis <a href="https://roc-lang.github.io/zulip-export/stream/347488-roctoberfest/topic/Alternative.20platform.20languages.html#303278053">(Oct 10 2022 at 15:10)</a>:</h4>
<p>oh wow! i'm going to try it out now <span aria-label="pray" class="emoji emoji-1f64f" role="img" title="pray">:pray:</span></p>



<a name="303278115"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/347488-roctoberfest/topic/Alternative%20platform%20languages/near/303278115" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/347488-roctoberfest/topic/Alternative.20platform.20languages.html#303278115">(Oct 10 2022 at 15:11)</a>:</h4>
<p>The root issues is that the Error case is larger than the Ok case. As such, your result is not the right size. The payload is not the size of a RocList. It is the size of a tag union that contains a RocStr and an I32.</p>



<a name="303278172"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/347488-roctoberfest/topic/Alternative%20platform%20languages/near/303278172" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/347488-roctoberfest/topic/Alternative.20platform.20languages.html#303278172">(Oct 10 2022 at 15:11)</a>:</h4>
<p>Commenting out that line makes the payload smaller than a RocList and everything works.</p>



<a name="303278240"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/347488-roctoberfest/topic/Alternative%20platform%20languages/near/303278240" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis <a href="https://roc-lang.github.io/zulip-export/stream/347488-roctoberfest/topic/Alternative.20platform.20languages.html#303278240">(Oct 10 2022 at 15:12)</a>:</h4>
<p>that makes a lot of sense about the await chain being broken. i wondered about that.</p>



<a name="303278572"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/347488-roctoberfest/topic/Alternative%20platform%20languages/near/303278572" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis <a href="https://roc-lang.github.io/zulip-export/stream/347488-roctoberfest/topic/Alternative.20platform.20languages.html#303278572">(Oct 10 2022 at 15:14)</a>:</h4>
<p>i am surprised this works. i was never able to use path as the first param. maybe a c-ism like you talked about yesterday (returning a value vs out param)</p>



<a name="303278858"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/347488-roctoberfest/topic/Alternative%20platform%20languages/near/303278858" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis <a href="https://roc-lang.github.io/zulip-export/stream/347488-roctoberfest/topic/Alternative.20platform.20languages.html#303278858">(Oct 10 2022 at 15:16)</a>:</h4>
<blockquote>
<p>The root issues is that the Error case is larger than the Ok case. As such, your result is not the right size. The payload is not the size of a RocList. It is the size of a tag union that contains a RocStr and an I32.</p>
</blockquote>
<p>are you referencing my impl or yours here?</p>



<a name="303279094"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/347488-roctoberfest/topic/Alternative%20platform%20languages/near/303279094" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/347488-roctoberfest/topic/Alternative.20platform.20languages.html#303279094">(Oct 10 2022 at 15:18)</a>:</h4>
<p>That was a follow up to this line:</p>
<blockquote>
<p>Try commenting out <code>Unrecognized I32 Str</code> in <code>InternalFile.roc</code>. Now everything should run fine.</p>
</blockquote>



<a name="303279110"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/347488-roctoberfest/topic/Alternative%20platform%20languages/near/303279110" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/347488-roctoberfest/topic/Alternative.20platform.20languages.html#303279110">(Oct 10 2022 at 15:18)</a>:</h4>
<p>The defined error type in Roc.</p>



<a name="303279135"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/347488-roctoberfest/topic/Alternative%20platform%20languages/near/303279135" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/347488-roctoberfest/topic/Alternative.20platform.20languages.html#303279135">(Oct 10 2022 at 15:18)</a>:</h4>
<p><code>InternalFile.ReadErr</code></p>



<a name="303279202"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/347488-roctoberfest/topic/Alternative%20platform%20languages/near/303279202" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/347488-roctoberfest/topic/Alternative.20platform.20languages.html#303279202">(Oct 10 2022 at 15:18)</a>:</h4>
<p>Also, I didn't fix the issue in the zig code I posted.</p>



<a name="303279262"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/347488-roctoberfest/topic/Alternative%20platform%20languages/near/303279262" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/347488-roctoberfest/topic/Alternative.20platform.20languages.html#303279262">(Oct 10 2022 at 15:19)</a>:</h4>
<p>Which is why I just said comment out that line for now.</p>



<a name="303281248"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/347488-roctoberfest/topic/Alternative%20platform%20languages/near/303281248" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/347488-roctoberfest/topic/Alternative.20platform.20languages.html#303281248">(Oct 10 2022 at 15:31)</a>:</h4>
<p>Oh, just noticed.<br>
This is wrong: <code>var roclist = RocList.allocate(@alignOf(usize), stat.size, stat.size);</code></p>
<p>The last argument should be the element size, so <code>@sizeOf(u8)</code></p>



<a name="303281587"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/347488-roctoberfest/topic/Alternative%20platform%20languages/near/303281587" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis <a href="https://roc-lang.github.io/zulip-export/stream/347488-roctoberfest/topic/Alternative.20platform.20languages.html#303281587">(Oct 10 2022 at 15:33)</a>:</h4>
<p>i think i've made all the changes you indicated. but i'm not seeing any file output. did you see the file printed out?</p>



<a name="303281647"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/347488-roctoberfest/topic/Alternative%20platform%20languages/near/303281647" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis <a href="https://roc-lang.github.io/zulip-export/stream/347488-roctoberfest/topic/Alternative.20platform.20languages.html#303281647">(Oct 10 2022 at 15:33)</a>:</h4>
<div class="codehilite" data-code-language="Bash Session"><pre><span></span><code><span class="gp">$ </span>./build.sh
<span class="go">🔨 Rebuilding platform...</span>
<span class="go">platform-test/1.txt</span>
<span class="go">this gets printed</span>
<span class="go">Called fileReadBytes</span>
<span class="go">path 'platform-test/1.txt' realpath ~/roc/advent-of-code</span>
<span class="go">roclist.bytes != null # added by me</span>
<span class="go">runtime: 0.081ms</span>
</code></pre></div>



<a name="303282319"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/347488-roctoberfest/topic/Alternative%20platform%20languages/near/303282319" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis <a href="https://roc-lang.github.io/zulip-export/stream/347488-roctoberfest/topic/Alternative.20platform.20languages.html#303282319">(Oct 10 2022 at 15:37)</a>:</h4>
<blockquote>
<p>The last argument should be the element size, so @sizeOf(u8)</p>
</blockquote>
<p>still no file output. are you seeing any thing different?</p>



<a name="303283047"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/347488-roctoberfest/topic/Alternative%20platform%20languages/near/303283047" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/347488-roctoberfest/topic/Alternative.20platform.20languages.html#303283047">(Oct 10 2022 at 15:41)</a>:</h4>
<p>Yeah, I saw the file printed out.</p>



<a name="303283080"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/347488-roctoberfest/topic/Alternative%20platform%20languages/near/303283080" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/347488-roctoberfest/topic/Alternative.20platform.20languages.html#303283080">(Oct 10 2022 at 15:42)</a>:</h4>
<p>Can you push your changes so I can take a look?</p>



<a name="303283234"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/347488-roctoberfest/topic/Alternative%20platform%20languages/near/303283234" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis <a href="https://roc-lang.github.io/zulip-export/stream/347488-roctoberfest/topic/Alternative.20platform.20languages.html#303283234">(Oct 10 2022 at 15:42)</a>:</h4>
<p>yeah sure. just a minute. btw, what os are you on? im on linux debian x64</p>



<a name="303283814"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/347488-roctoberfest/topic/Alternative%20platform%20languages/near/303283814" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis <a href="https://roc-lang.github.io/zulip-export/stream/347488-roctoberfest/topic/Alternative.20platform.20languages.html#303283814">(Oct 10 2022 at 15:46)</a>:</h4>
<p>aw snap nevermind. i edited the wrong InternalFile.roc (i have a sub folder of the originals)</p>



<a name="303283840"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/347488-roctoberfest/topic/Alternative%20platform%20languages/near/303283840" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis <a href="https://roc-lang.github.io/zulip-export/stream/347488-roctoberfest/topic/Alternative.20platform.20languages.html#303283840">(Oct 10 2022 at 15:46)</a>:</h4>
<p>it works! <span aria-label="tada" class="emoji emoji-1f389" role="img" title="tada">:tada:</span></p>



<a name="303283951"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/347488-roctoberfest/topic/Alternative%20platform%20languages/near/303283951" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis <a href="https://roc-lang.github.io/zulip-export/stream/347488-roctoberfest/topic/Alternative.20platform.20languages.html#303283951">(Oct 10 2022 at 15:46)</a>:</h4>
<p>was about to commit the changes and noticed the missing diff</p>



<a name="303284021"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/347488-roctoberfest/topic/Alternative%20platform%20languages/near/303284021" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/347488-roctoberfest/topic/Alternative.20platform.20languages.html#303284021">(Oct 10 2022 at 15:47)</a>:</h4>
<p>I generally use an M1 mac (light weight and portable form factor), but I also use debian x64 pretty often.</p>



<a name="303284264"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/347488-roctoberfest/topic/Alternative%20platform%20languages/near/303284264" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis <a href="https://roc-lang.github.io/zulip-export/stream/347488-roctoberfest/topic/Alternative.20platform.20languages.html#303284264">(Oct 10 2022 at 15:48)</a>:</h4>
<p>ok only reason i asked is i thought it might account for the differences. but no just edited the wrong file. <span aria-label="laughing" class="emoji emoji-1f606" role="img" title="laughing">:laughing:</span></p>



<a name="303284645"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/347488-roctoberfest/topic/Alternative%20platform%20languages/near/303284645" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis <a href="https://roc-lang.github.io/zulip-export/stream/347488-roctoberfest/topic/Alternative.20platform.20languages.html#303284645">(Oct 10 2022 at 15:50)</a>:</h4>
<p>but thanks a lot! i'll have to think about this a bit maybe have some questions later on.</p>



<a name="303284664"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/347488-roctoberfest/topic/Alternative%20platform%20languages/near/303284664" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis <a href="https://roc-lang.github.io/zulip-export/stream/347488-roctoberfest/topic/Alternative.20platform.20languages.html#303284664">(Oct 10 2022 at 15:50)</a>:</h4>
<p>do you want to make a pr or should i just credit you in comments?</p>



<a name="303285565"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/347488-roctoberfest/topic/Alternative%20platform%20languages/near/303285565" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis <a href="https://roc-lang.github.io/zulip-export/stream/347488-roctoberfest/topic/Alternative.20platform.20languages.html#303285565">(Oct 10 2022 at 15:56)</a>:</h4>
<p>ok i think i'm following what you said about the payload sizes differing and how commenting that line out make the sizes comptible now.</p>



<a name="303285659"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/347488-roctoberfest/topic/Alternative%20platform%20languages/near/303285659" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis <a href="https://roc-lang.github.io/zulip-export/stream/347488-roctoberfest/topic/Alternative.20platform.20languages.html#303285659">(Oct 10 2022 at 15:57)</a>:</h4>
<p>so the fix would be to implement the &lt;T, E&gt; union like in rust?</p>



<a name="303285856"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/347488-roctoberfest/topic/Alternative%20platform%20languages/near/303285856" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis <a href="https://roc-lang.github.io/zulip-export/stream/347488-roctoberfest/topic/Alternative.20platform.20languages.html#303285856">(Oct 10 2022 at 15:58)</a>:</h4>
<p>like this:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="cp">#[repr(C)]</span><span class="w"></span>
<span class="k">union</span> <span class="nc">RocResultPayload</span><span class="o">&lt;</span><span class="n">T</span><span class="p">,</span><span class="w"> </span><span class="n">E</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="n">ok</span>: <span class="nc">ManuallyDrop</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="n">err</span>: <span class="nc">ManuallyDrop</span><span class="o">&lt;</span><span class="n">E</span><span class="o">&gt;</span><span class="p">,</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>



<a name="303286054"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/347488-roctoberfest/topic/Alternative%20platform%20languages/near/303286054" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis <a href="https://roc-lang.github.io/zulip-export/stream/347488-roctoberfest/topic/Alternative.20platform.20languages.html#303286054">(Oct 10 2022 at 15:59)</a>:</h4>
<p>but then i wouldn't know how to get the size of E <span aria-label="thinking" class="emoji emoji-1f914" role="img" title="thinking">:thinking:</span></p>



<a name="303300180"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/347488-roctoberfest/topic/Alternative%20platform%20languages/near/303300180" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/347488-roctoberfest/topic/Alternative.20platform.20languages.html#303300180">(Oct 10 2022 at 17:28)</a>:</h4>
<blockquote>
<p>do you want to make a pr or should i just credit you in comments?</p>
</blockquote>
<p>Don't worry about it. Just here to help</p>



<a name="303300225"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/347488-roctoberfest/topic/Alternative%20platform%20languages/near/303300225" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/347488-roctoberfest/topic/Alternative.20platform.20languages.html#303300225">(Oct 10 2022 at 17:29)</a>:</h4>
<blockquote>
<p>so the fix would be to implement the &lt;T, E&gt; union like in rust?</p>
</blockquote>
<p>Correct</p>



<a name="303300715"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/347488-roctoberfest/topic/Alternative%20platform%20languages/near/303300715" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/347488-roctoberfest/topic/Alternative.20platform.20languages.html#303300715">(Oct 10 2022 at 17:32)</a>:</h4>
<blockquote>
<p>but then i wouldn't know how to get the size of E <span aria-label="thinking" class="emoji emoji-1f914" role="img" title="thinking">:thinking:</span></p>
</blockquote>
<p>Yeah....this is where glue would be quit useful. Instead you have to do it manually.</p>
<p>There error type should be fine to define as:</p>
<div class="codehilite"><pre><span></span><code>code: i32,
message: RocStr,
tag: u8
</code></pre></div>
<p>Where tag picks the specific <code>ReadError</code> in alphabetical order and code/message are only set when using the <code>Unrecognized</code> variant.</p>



<a name="303300837"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/347488-roctoberfest/topic/Alternative%20platform%20languages/near/303300837" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/347488-roctoberfest/topic/Alternative.20platform.20languages.html#303300837">(Oct 10 2022 at 17:33)</a>:</h4>
<p>You should be able to make constructors such that the use is less painful.</p>



<a name="303301080"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/347488-roctoberfest/topic/Alternative%20platform%20languages/near/303301080" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis <a href="https://roc-lang.github.io/zulip-export/stream/347488-roctoberfest/topic/Alternative.20platform.20languages.html#303301080">(Oct 10 2022 at 17:35)</a>:</h4>
<p>oic so i would need to sync the sizes myself. makes sense. idk why i was thinking it could be provided dynamically somehow at compile time.</p>



<a name="303301110"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/347488-roctoberfest/topic/Alternative%20platform%20languages/near/303301110" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis <a href="https://roc-lang.github.io/zulip-export/stream/347488-roctoberfest/topic/Alternative.20platform.20languages.html#303301110">(Oct 10 2022 at 17:35)</a>:</h4>
<p>i can see where glue would be nice to have for this.</p>



<a name="303301798"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/347488-roctoberfest/topic/Alternative%20platform%20languages/near/303301798" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/347488-roctoberfest/topic/Alternative.20platform.20languages.html#303301798">(Oct 10 2022 at 17:40)</a>:</h4>
<p>Yep, it makes platform dev a world nicer</p>



<a name="303450567"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/347488-roctoberfest/topic/Alternative%20platform%20languages/near/303450567" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis <a href="https://roc-lang.github.io/zulip-export/stream/347488-roctoberfest/topic/Alternative.20platform.20languages.html#303450567">(Oct 11 2022 at 14:30)</a>:</h4>
<p>hey <span class="user-mention" data-user-id="343810">@Brendan Hansknecht</span> last night i tried running other's aoc roc solutions including yours.  as a result i added <code>Stdout.line</code> support locally and then ran into <code>foc_fx_args</code> missing.  do you have any recommendations on how implement that one?</p>



<a name="303450804"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/347488-roctoberfest/topic/Alternative%20platform%20languages/near/303450804" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/347488-roctoberfest/topic/Alternative.20platform.20languages.html#303450804">(Oct 11 2022 at 14:31)</a>:</h4>
<p>I think it just returns a <code>List (Str)</code> of the args passed into the program.</p>



<a name="303450810"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/347488-roctoberfest/topic/Alternative%20platform%20languages/near/303450810" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis <a href="https://roc-lang.github.io/zulip-export/stream/347488-roctoberfest/topic/Alternative.20platform.20languages.html#303450810">(Oct 11 2022 at 14:31)</a>:</h4>
<p>i tried to wing it by just making that function and building a RocList&lt;RocString&gt; from <code>std.process.args</code> but there were 0 args when i tried to run it which was strange.</p>



<a name="303450885"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/347488-roctoberfest/topic/Alternative%20platform%20languages/near/303450885" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/347488-roctoberfest/topic/Alternative.20platform.20languages.html#303450885">(Oct 11 2022 at 14:31)</a>:</h4>
<p>that seems wrong, there should always be at least the executable name...</p>



<a name="303450888"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/347488-roctoberfest/topic/Alternative%20platform%20languages/near/303450888" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/347488-roctoberfest/topic/Alternative.20platform.20languages.html#303450888">(Oct 11 2022 at 14:31)</a>:</h4>
<p>hmm</p>



<a name="303451014"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/347488-roctoberfest/topic/Alternative%20platform%20languages/near/303451014" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/347488-roctoberfest/topic/Alternative.20platform.20languages.html#303451014">(Oct 11 2022 at 14:32)</a>:</h4>
<p>Also, zero args on the zig side, or none got passed to the roc app?</p>



<a name="303451195"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/347488-roctoberfest/topic/Alternative%20platform%20languages/near/303451195" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis <a href="https://roc-lang.github.io/zulip-export/stream/347488-roctoberfest/topic/Alternative.20platform.20languages.html#303451195">(Oct 11 2022 at 14:32)</a>:</h4>
<p>i looked at your #3990 pr a bit but didn't get too far. i see there are <code>roc_main</code> and <code>roc__mainForHost_1_exposed_generic</code> functions but i'm not sure if those are important here.</p>



<a name="303451401"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/347488-roctoberfest/topic/Alternative%20platform%20languages/near/303451401" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/347488-roctoberfest/topic/Alternative.20platform.20languages.html#303451401">(Oct 11 2022 at 14:33)</a>:</h4>
<p>The rust version just defines it as:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="cp">#[no_mangle]</span><span class="w"></span>
<span class="k">pub</span><span class="w"> </span><span class="k">extern</span><span class="w"> </span><span class="s">"C"</span><span class="w"> </span><span class="k">fn</span> <span class="nf">roc_fx_args</span><span class="p">()</span><span class="w"> </span>-&gt; <span class="nc">RocList</span><span class="o">&lt;</span><span class="n">RocStr</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="c1">// TODO: can we be more efficient about reusing the String's memory for RocStr?</span>
<span class="w">    </span><span class="n">std</span>::<span class="n">env</span>::<span class="n">args_os</span><span class="p">()</span><span class="w"></span>
<span class="w">        </span><span class="p">.</span><span class="n">map</span><span class="p">(</span><span class="o">|</span><span class="n">os_str</span><span class="o">|</span><span class="w"> </span><span class="n">RocStr</span>::<span class="n">from</span><span class="p">(</span><span class="n">os_str</span><span class="p">.</span><span class="n">to_string_lossy</span><span class="p">().</span><span class="n">borrow</span><span class="p">()))</span><span class="w"></span>
<span class="w">        </span><span class="p">.</span><span class="n">collect</span><span class="p">()</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>
<p>So basically what you said.</p>



<a name="303451426"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/347488-roctoberfest/topic/Alternative%20platform%20languages/near/303451426" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis <a href="https://roc-lang.github.io/zulip-export/stream/347488-roctoberfest/topic/Alternative.20platform.20languages.html#303451426">(Oct 11 2022 at 14:33)</a>:</h4>
<p>zero args. i tried using both <code>process.args()</code> and <code>process.argsAlloc()</code> and both had 0 args</p>



<a name="303451680"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/347488-roctoberfest/topic/Alternative%20platform%20languages/near/303451680" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis <a href="https://roc-lang.github.io/zulip-export/stream/347488-roctoberfest/topic/Alternative.20platform.20languages.html#303451680">(Oct 11 2022 at 14:34)</a>:</h4>
<p>yeah i looked at the rust version too and was following it. thats why i assumed i could just do what i did. is there something else that has to happen first?</p>



<a name="303452227"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/347488-roctoberfest/topic/Alternative%20platform%20languages/near/303452227" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/347488-roctoberfest/topic/Alternative.20platform.20languages.html#303452227">(Oct 11 2022 at 14:37)</a>:</h4>
<p>Also, 0 args when printing them from zig? If so, that is probably some sort of zig issue.</p>



<a name="303452388"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/347488-roctoberfest/topic/Alternative%20platform%20languages/near/303452388" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/347488-roctoberfest/topic/Alternative.20platform.20languages.html#303452388">(Oct 11 2022 at 14:38)</a>:</h4>
<p>If you can print out the args from zig, probably just some sort of issue generating the list of strings.</p>



<a name="303452565"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/347488-roctoberfest/topic/Alternative%20platform%20languages/near/303452565" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/347488-roctoberfest/topic/Alternative.20platform.20languages.html#303452565">(Oct 11 2022 at 14:38)</a>:</h4>
<p>Also, just creating that effect should be enough to my understanding.</p>



<a name="303453106"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/347488-roctoberfest/topic/Alternative%20platform%20languages/near/303453106" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis <a href="https://roc-lang.github.io/zulip-export/stream/347488-roctoberfest/topic/Alternative.20platform.20languages.html#303453106">(Oct 11 2022 at 14:40)</a>:</h4>
<p>ooh thats one thing i didn't consider much. i'll review the .roc files in my platform folder. might have commented something out or forgot to copy over.</p>



<a name="303454150"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/347488-roctoberfest/topic/Alternative%20platform%20languages/near/303454150" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis <a href="https://roc-lang.github.io/zulip-export/stream/347488-roctoberfest/topic/Alternative.20platform.20languages.html#303454150">(Oct 11 2022 at 14:45)</a>:</h4>
<p>i don't see anything amiss with the .roc files. i see Effect.roc/args and Process.roc/withArgs were copied over from the cli-platform.</p>



<a name="303454215"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/347488-roctoberfest/topic/Alternative%20platform%20languages/near/303454215" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis <a href="https://roc-lang.github.io/zulip-export/stream/347488-roctoberfest/topic/Alternative.20platform.20languages.html#303454215">(Oct 11 2022 at 14:45)</a>:</h4>
<p>maybe i'll see whats in <code>std.os.argv</code></p>



<a name="303455378"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/347488-roctoberfest/topic/Alternative%20platform%20languages/near/303455378" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis <a href="https://roc-lang.github.io/zulip-export/stream/347488-roctoberfest/topic/Alternative.20platform.20languages.html#303455378">(Oct 11 2022 at 14:51)</a>:</h4>
<p>yeah strange. here's what i see after building</p>
<div class="codehilite"><pre><span></span><code>$ day1/exec-part1 day1/data.txt
argv.len 0 # printed out from zig
Expected a file name passed on the command line
</code></pre></div>



<a name="303455465"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/347488-roctoberfest/topic/Alternative%20platform%20languages/near/303455465" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis <a href="https://roc-lang.github.io/zulip-export/stream/347488-roctoberfest/topic/Alternative.20platform.20languages.html#303455465">(Oct 11 2022 at 14:52)</a>:</h4>
<p>i'll search for that error message 'Expected a file name passed on the command line' see what that turns up</p>



<a name="303456768"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/347488-roctoberfest/topic/Alternative%20platform%20languages/near/303456768" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis <a href="https://roc-lang.github.io/zulip-export/stream/347488-roctoberfest/topic/Alternative.20platform.20languages.html#303456768">(Oct 11 2022 at 14:58)</a>:</h4>
<p>ah that message was from your advent day1 solution. <span aria-label="laughing" class="emoji emoji-1f606" role="img" title="laughing">:laughing:</span> of course. so something is not happening on zig side. i wonder why there are no args there <span aria-label="thinking" class="emoji emoji-1f914" role="img" title="thinking">:thinking:</span></p>



<a name="303459621"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/347488-roctoberfest/topic/Alternative%20platform%20languages/near/303459621" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/347488-roctoberfest/topic/Alternative.20platform.20languages.html#303459621">(Oct 11 2022 at 15:12)</a>:</h4>
<p>I guess make a zig app without any roc and make sure it works correctly on your computer?</p>



<a name="303462671"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/347488-roctoberfest/topic/Alternative%20platform%20languages/near/303462671" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis <a href="https://roc-lang.github.io/zulip-export/stream/347488-roctoberfest/topic/Alternative.20platform.20languages.html#303462671">(Oct 11 2022 at 15:26)</a>:</h4>
<p>yeah args look fine from standalone zig app: </p>
<div class="codehilite" data-code-language="Bash Session"><pre><span></span><code><span class="gp">$ </span>cat test.zig
<span class="go">const std = @import("std");</span>

<span class="go">pub fn main() !void {</span>
<span class="go">    const allocator = std.heap.page_allocator;</span>
<span class="go">    const args = try std.process.argsAlloc(allocator);</span>
<span class="go">    std.debug.print("args.len {}\n", .{args.len});</span>
<span class="go">}</span>
<span class="go">travis:/tmp/roc-aoc-2021</span>
<span class="gp">$ </span>zig run test.zig -- asdf asdf
<span class="go">args.len 3</span>
</code></pre></div>



<a name="303465350"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/347488-roctoberfest/topic/Alternative%20platform%20languages/near/303465350" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/347488-roctoberfest/topic/Alternative.20platform.20languages.html#303465350">(Oct 11 2022 at 15:38)</a>:</h4>
<p>Interesting. I wonder if it has to be run from main/roc is messing that up? What happens if you put the function in main instead of in roc_fx_args?</p>



<a name="303466639"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/347488-roctoberfest/topic/Alternative%20platform%20languages/near/303466639" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis <a href="https://roc-lang.github.io/zulip-export/stream/347488-roctoberfest/topic/Alternative.20platform.20languages.html#303466639">(Oct 11 2022 at 15:44)</a>:</h4>
<p>you mean what happens if i print out args from host.zig/main()? i tried that too last night and saw 0 args</p>



<a name="303468047"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/347488-roctoberfest/topic/Alternative%20platform%20languages/near/303468047" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/347488-roctoberfest/topic/Alternative.20platform.20languages.html#303468047">(Oct 11 2022 at 15:52)</a>:</h4>
<p>Can you try with <code>--linker=legacy</code></p>



<a name="303468678"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/347488-roctoberfest/topic/Alternative%20platform%20languages/near/303468678" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis <a href="https://roc-lang.github.io/zulip-export/stream/347488-roctoberfest/topic/Alternative.20platform.20languages.html#303468678">(Oct 11 2022 at 15:56)</a>:</h4>
<p>same thing. no args. here's how i called it</p>
<div class="codehilite" data-code-language="Bash Session"><pre><span></span><code><span class="gp">$ </span>roc day1/part1.roc --linker<span class="o">=</span>legacy -- day1/data.txt
</code></pre></div>



<a name="303471795"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/347488-roctoberfest/topic/Alternative%20platform%20languages/near/303471795" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/347488-roctoberfest/topic/Alternative.20platform.20languages.html#303471795">(Oct 11 2022 at 16:12)</a>:</h4>
<p>Hmm....i am quite confused.</p>



<a name="303474205"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/347488-roctoberfest/topic/Alternative%20platform%20languages/near/303474205" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis <a href="https://roc-lang.github.io/zulip-export/stream/347488-roctoberfest/topic/Alternative.20platform.20languages.html#303474205">(Oct 11 2022 at 16:25)</a>:</h4>
<p>yeah me too. i'm looking at some of the rust platform examples like the false interpreter have an args param</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="w">    </span><span class="cp">#[link_name = </span><span class="s">"roc__mainForHost_1_exposed_generic"</span><span class="cp">]</span><span class="w"></span>
<span class="w">    </span><span class="k">fn</span> <span class="nf">roc_main</span><span class="p">(</span><span class="n">output</span>: <span class="o">*</span><span class="k">mut</span><span class="w"> </span><span class="kt">u8</span><span class="p">,</span><span class="w"> </span><span class="n">args</span>: <span class="kp">&amp;</span><span class="nc">RocStr</span><span class="p">);</span><span class="w"></span>
</code></pre></div>
<p>while others have none</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="w">    </span><span class="cp">#[link_name = </span><span class="s">"roc__mainForHost_1_exposed_generic"</span><span class="cp">]</span><span class="w"></span>
<span class="w">    </span><span class="k">fn</span> <span class="nf">roc_main</span><span class="p">(</span><span class="n">output</span>: <span class="o">*</span><span class="k">mut</span><span class="w"> </span><span class="kt">u8</span><span class="p">);</span><span class="w"></span>
</code></pre></div>



<a name="303476961"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/347488-roctoberfest/topic/Alternative%20platform%20languages/near/303476961" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/347488-roctoberfest/topic/Alternative.20platform.20languages.html#303476961">(Oct 11 2022 at 16:40)</a>:</h4>
<p>Just different designs. False interpretter passes it in as an arg to main.</p>



<a name="303476998"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/347488-roctoberfest/topic/Alternative%20platform%20languages/near/303476998" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/347488-roctoberfest/topic/Alternative.20platform.20languages.html#303476998">(Oct 11 2022 at 16:40)</a>:</h4>
<p>The cli platform passes it in via an effect.</p>



<a name="303485913"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/347488-roctoberfest/topic/Alternative%20platform%20languages/near/303485913" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis <a href="https://roc-lang.github.io/zulip-export/stream/347488-roctoberfest/topic/Alternative.20platform.20languages.html#303485913">(Oct 11 2022 at 17:30)</a>:</h4>
<p>if you have time to try running it, i just pushed a wip commit with debug statements in host.zig/main() and roc_fx_args()</p>



<a name="303485990"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/347488-roctoberfest/topic/Alternative%20platform%20languages/near/303485990" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis <a href="https://roc-lang.github.io/zulip-export/stream/347488-roctoberfest/topic/Alternative.20platform.20languages.html#303485990">(Oct 11 2022 at 17:30)</a>:</h4>
<p>run against your day1/part1.roc should trigger the debug statements</p>



<a name="303486097"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/347488-roctoberfest/topic/Alternative%20platform%20languages/near/303486097" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis <a href="https://roc-lang.github.io/zulip-export/stream/347488-roctoberfest/topic/Alternative.20platform.20languages.html#303486097">(Oct 11 2022 at 17:31)</a>:</h4>
<p>here's what i see</p>
<div class="codehilite" data-code-language="Bash Session"><pre><span></span><code><span class="gp">$ </span>roc day1/part1.roc -- day1/data.txt
<span class="go">🔨 Rebuilding platform...</span>
<span class="go">main() args.len 0</span>
<span class="go">roc_fx_args() args.len 0 osargs.len 0</span>
<span class="go">Expected a file name passed on the command line</span>
<span class="go">runtime: 0.030ms</span>
</code></pre></div>



<a name="303544322"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/347488-roctoberfest/topic/Alternative%20platform%20languages/near/303544322" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/347488-roctoberfest/topic/Alternative.20platform.20languages.html#303544322">(Oct 12 2022 at 01:01)</a>:</h4>
<p>So my only guess is the fact that we tell zig to build an object file. Then call ld directly to link it is somehow breaking things.</p>



<a name="303544647"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/347488-roctoberfest/topic/Alternative%20platform%20languages/near/303544647" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/347488-roctoberfest/topic/Alternative.20platform.20languages.html#303544647">(Oct 12 2022 at 01:04)</a>:</h4>
<p>So this may be a case of quite annoying to debug</p>



<a name="303545507"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/347488-roctoberfest/topic/Alternative%20platform%20languages/near/303545507" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/347488-roctoberfest/topic/Alternative.20platform.20languages.html#303545507">(Oct 12 2022 at 01:15)</a>:</h4>
<p>Even letting zig control the building and linking doesn't work: <code>zig build-exe platform/host.zig ~/Projects/roc-aoc-2021/day1/exec-part1.o</code></p>



<a name="303545520"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/347488-roctoberfest/topic/Alternative%20platform%20languages/near/303545520" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/347488-roctoberfest/topic/Alternative.20platform.20languages.html#303545520">(Oct 12 2022 at 01:15)</a>:</h4>
<p>It runs, but no args.</p>



<a name="303546101"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/347488-roctoberfest/topic/Alternative%20platform%20languages/near/303546101" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/347488-roctoberfest/topic/Alternative.20platform.20languages.html#303546101">(Oct 12 2022 at 01:23)</a>:</h4>
<p>I figured out the issue. It makes little sense to me, but I found it.</p>
<p><code>pub export fn main() callconv(.C) u8</code> -&gt; <code>pub fn main() u8</code></p>



<a name="303546120"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/347488-roctoberfest/topic/Alternative%20platform%20languages/near/303546120" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/347488-roctoberfest/topic/Alternative.20platform.20languages.html#303546120">(Oct 12 2022 at 01:23)</a>:</h4>
<p>Causes the program the have args and then crash for what look like proper reasons.</p>



<a name="303546185"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/347488-roctoberfest/topic/Alternative%20platform%20languages/near/303546185" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/347488-roctoberfest/topic/Alternative.20platform.20languages.html#303546185">(Oct 12 2022 at 01:24)</a>:</h4>
<p>Something with <code>list.listAppendUnsafe</code></p>



<a name="303548830"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/347488-roctoberfest/topic/Alternative%20platform%20languages/near/303548830" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis <a href="https://roc-lang.github.io/zulip-export/stream/347488-roctoberfest/topic/Alternative.20platform.20languages.html#303548830">(Oct 12 2022 at 02:05)</a>:</h4>
<p>thanks so much! <span aria-label="heart" class="emoji emoji-2764" role="img" title="heart">:heart:</span>  i never would have thought of this.  i'm seeing a similar crash here now but the length of the args looks correct. <span aria-label="+1" class="emoji emoji-1f44d" role="img" title="+1">:+1:</span></p>



<a name="303549542"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/347488-roctoberfest/topic/Alternative%20platform%20languages/near/303549542" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis <a href="https://roc-lang.github.io/zulip-export/stream/347488-roctoberfest/topic/Alternative.20platform.20languages.html#303549542">(Oct 12 2022 at 02:16)</a>:</h4>
<p>got it working. fix was passing <code>@ptrCast([*]u8, &amp;rocstr)</code> instead of <code>rocstr.str_bytes</code></p>



<a name="303549943"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/347488-roctoberfest/topic/Alternative%20platform%20languages/near/303549943" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis <a href="https://roc-lang.github.io/zulip-export/stream/347488-roctoberfest/topic/Alternative.20platform.20languages.html#303549943">(Oct 12 2022 at 02:23)</a>:</h4>
<p>in the meantime, i've got Env.cwd working.</p>



<a name="303550007"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/347488-roctoberfest/topic/Alternative%20platform%20languages/near/303550007" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis <a href="https://roc-lang.github.io/zulip-export/stream/347488-roctoberfest/topic/Alternative.20platform.20languages.html#303550007">(Oct 12 2022 at 02:24)</a>:</h4>
<p>and Env.var</p>



<a name="303550050"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/347488-roctoberfest/topic/Alternative%20platform%20languages/near/303550050" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis <a href="https://roc-lang.github.io/zulip-export/stream/347488-roctoberfest/topic/Alternative.20platform.20languages.html#303550050">(Oct 12 2022 at 02:25)</a>:</h4>
<p>somehow Env.setCwd doesn't seem to work tho.</p>



<a name="303550053"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/347488-roctoberfest/topic/Alternative%20platform%20languages/near/303550053" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis <a href="https://roc-lang.github.io/zulip-export/stream/347488-roctoberfest/topic/Alternative.20platform.20languages.html#303550053">(Oct 12 2022 at 02:25)</a>:</h4>
<p>atleast when i try to <code>cd /tmp</code> and then print <code>cwd</code> again it doesn't change</p>



<a name="303550227"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/347488-roctoberfest/topic/Alternative%20platform%20languages/near/303550227" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis <a href="https://roc-lang.github.io/zulip-export/stream/347488-roctoberfest/topic/Alternative.20platform.20languages.html#303550227">(Oct 12 2022 at 02:28)</a>:</h4>
<p>and its also seems wierd that arg 0 is ' /proc/self/fd/3' <span aria-label="thinking" class="emoji emoji-1f914" role="img" title="thinking">:thinking:</span> </p>
<div class="codehilite" data-code-language="Bash Session"><pre><span></span><code><span class="gp">$ </span><span class="nv">foo</span><span class="o">=</span>bar roc platform-test/main.roc -- asdf asfd
<span class="go">🔨 Rebuilding platform...</span>
<span class="go">platform-test/1.txt</span>
<span class="go">...</span>
<span class="go">cli arg 0: /proc/self/fd/3</span>
<span class="go">cli arg 1: asdf</span>
<span class="go">cwd ~/roc/advent-of-code</span>
<span class="go">cwd2 should be /tmp ~/roc/advent-of-code</span>
<span class="go">env:foo=bar</span>
<span class="go">runtime: 0.109ms</span>
</code></pre></div>



<a name="303550541"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/347488-roctoberfest/topic/Alternative%20platform%20languages/near/303550541" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis <a href="https://roc-lang.github.io/zulip-export/stream/347488-roctoberfest/topic/Alternative.20platform.20languages.html#303550541">(Oct 12 2022 at 02:33)</a>:</h4>
<p>arg 1 looks fine. exe path is wierd. i'll try making <code>roc_fx_exePath</code> next and see if that is different.</p>



<a name="303552121"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/347488-roctoberfest/topic/Alternative%20platform%20languages/near/303552121" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/347488-roctoberfest/topic/Alternative.20platform.20languages.html#303552121">(Oct 12 2022 at 03:00)</a>:</h4>
<p>Arg 0 is weird because we compile in memory and then launch from the roc run executable as opposed to launching the binary from disk</p>



<a name="303552612"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/347488-roctoberfest/topic/Alternative%20platform%20languages/near/303552612" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis <a href="https://roc-lang.github.io/zulip-export/stream/347488-roctoberfest/topic/Alternative.20platform.20languages.html#303552612">(Oct 12 2022 at 03:10)</a>:</h4>
<p>aaah. i see. good to know</p>



<a name="303555678"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/347488-roctoberfest/topic/Alternative%20platform%20languages/near/303555678" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis <a href="https://roc-lang.github.io/zulip-export/stream/347488-roctoberfest/topic/Alternative.20platform.20languages.html#303555678">(Oct 12 2022 at 04:05)</a>:</h4>
<p>ok makes more sense now. arg 0 is only borked when run with <code>roc file.roc</code></p>



<a name="303555682"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/347488-roctoberfest/topic/Alternative%20platform%20languages/near/303555682" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis <a href="https://roc-lang.github.io/zulip-export/stream/347488-roctoberfest/topic/Alternative.20platform.20languages.html#303555682">(Oct 12 2022 at 04:05)</a>:</h4>
<p>but runing the compiled version arg 0  looks fine.</p>



<a name="303558191"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/347488-roctoberfest/topic/Alternative%20platform%20languages/near/303558191" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis <a href="https://roc-lang.github.io/zulip-export/stream/347488-roctoberfest/topic/Alternative.20platform.20languages.html#303558191">(Oct 12 2022 at 04:44)</a>:</h4>
<p>oops. Env.setCwd works fine. i was printing out the same path twice <span aria-label="face palm" class="emoji emoji-1f926" role="img" title="face palm">:face_palm:</span>  <span aria-label="laughter tears" class="emoji emoji-1f602" role="img" title="laughter tears">:laughter_tears:</span></p>



<a name="303558850"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/347488-roctoberfest/topic/Alternative%20platform%20languages/near/303558850" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/347488-roctoberfest/topic/Alternative.20platform.20languages.html#303558850">(Oct 12 2022 at 04:54)</a>:</h4>
<p>Awesome to see all the progress</p>



<a name="303559277"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/347488-roctoberfest/topic/Alternative%20platform%20languages/near/303559277" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis <a href="https://roc-lang.github.io/zulip-export/stream/347488-roctoberfest/topic/Alternative.20platform.20languages.html#303559277">(Oct 12 2022 at 05:01)</a>:</h4>
<p>thanks <span aria-label="big smile" class="emoji emoji-1f604" role="img" title="big smile">:big_smile:</span> .  you deserve a lot of the credit. been very helpful and patient with my flails.</p>



<a name="303559295"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/347488-roctoberfest/topic/Alternative%20platform%20languages/near/303559295" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis <a href="https://roc-lang.github.io/zulip-export/stream/347488-roctoberfest/topic/Alternative.20platform.20languages.html#303559295">(Oct 12 2022 at 05:01)</a>:</h4>
<p><span aria-label="pray" class="emoji emoji-1f64f" role="img" title="pray">:pray:</span></p>



<a name="303675130"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/347488-roctoberfest/topic/Alternative%20platform%20languages/near/303675130" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis <a href="https://roc-lang.github.io/zulip-export/stream/347488-roctoberfest/topic/Alternative.20platform.20languages.html#303675130">(Oct 12 2022 at 16:25)</a>:</h4>
<p><span class="user-mention" data-user-id="343810">@Brendan Hansknecht</span> if you have a chance, take a look at my error handling attempts: <a href="https://github.com/travisstaloch/roc-cli-platform-zig/blob/main/platform/host.zig#L249">https://github.com/travisstaloch/roc-cli-platform-zig/blob/main/platform/host.zig#L249</a>  I haven't really tested the error handling except to verify that it can catch "Not Found".</p>



<a name="303675300"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/347488-roctoberfest/topic/Alternative%20platform%20languages/near/303675300" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis <a href="https://roc-lang.github.io/zulip-export/stream/347488-roctoberfest/topic/Alternative.20platform.20languages.html#303675300">(Oct 12 2022 at 16:26)</a>:</h4>
<p>but i reworked as a union &lt;T,E&gt; like we discussed. not 100% sure about the layout.</p>



<a name="303675659"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/347488-roctoberfest/topic/Alternative%20platform%20languages/near/303675659" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis <a href="https://roc-lang.github.io/zulip-export/stream/347488-roctoberfest/topic/Alternative.20platform.20languages.html#303675659">(Oct 12 2022 at 16:28)</a>:</h4>
<p>but it atleast works after adding back the ReadError <code>Unrecognized I32 Str,</code> line</p>



<a name="303675768"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/347488-roctoberfest/topic/Alternative%20platform%20languages/near/303675768" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis <a href="https://roc-lang.github.io/zulip-export/stream/347488-roctoberfest/topic/Alternative.20platform.20languages.html#303675768">(Oct 12 2022 at 16:29)</a>:</h4>
<p>and doesn't panic anymore. the error handling was tricky. only real changes are to <code>roc_fx_fileReadBytes</code></p>



<a name="303676324"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/347488-roctoberfest/topic/Alternative%20platform%20languages/near/303676324" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis <a href="https://roc-lang.github.io/zulip-export/stream/347488-roctoberfest/topic/Alternative.20platform.20languages.html#303676324">(Oct 12 2022 at 16:32)</a>:</h4>
<p>its strange that zig's Dir.openFile() wasn't returning an error for file not found. and then there was a panic in the  File.stat() call which meant i had to check for <code>fd == -1</code></p>



<a name="303676522"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/347488-roctoberfest/topic/Alternative%20platform%20languages/near/303676522" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis <a href="https://roc-lang.github.io/zulip-export/stream/347488-roctoberfest/topic/Alternative.20platform.20languages.html#303676522">(Oct 12 2022 at 16:33)</a>:</h4>
<p>wonder if this has changed since 0.9.1</p>



<a name="303679011"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/347488-roctoberfest/topic/Alternative%20platform%20languages/near/303679011" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/347488-roctoberfest/topic/Alternative.20platform.20languages.html#303679011">(Oct 12 2022 at 16:47)</a>:</h4>
<p>I think <code>Payload</code> needs to be sorted alphabetically, otherwise, I think that is correct. Would need to do some testing to confirm though.</p>



<a name="303679076"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/347488-roctoberfest/topic/Alternative%20platform%20languages/near/303679076" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/347488-roctoberfest/topic/Alternative.20platform.20languages.html#303679076">(Oct 12 2022 at 16:47)</a>:</h4>
<p>Should have time to do that later</p>



<a name="303679161"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/347488-roctoberfest/topic/Alternative%20platform%20languages/near/303679161" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/347488-roctoberfest/topic/Alternative.20platform.20languages.html#303679161">(Oct 12 2022 at 16:48)</a>:</h4>
<p>Also, really interesting helper for initializing them.</p>



<a name="303685846"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/347488-roctoberfest/topic/Alternative%20platform%20languages/near/303685846" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis <a href="https://roc-lang.github.io/zulip-export/stream/347488-roctoberfest/topic/Alternative.20platform.20languages.html#303685846">(Oct 12 2022 at 17:24)</a>:</h4>
<p>yeah i thought the helper makes verbose union init syntax a lot cleaner</p>



<a name="303686241"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/347488-roctoberfest/topic/Alternative%20platform%20languages/near/303686241" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis <a href="https://roc-lang.github.io/zulip-export/stream/347488-roctoberfest/topic/Alternative.20platform.20languages.html#303686241">(Oct 12 2022 at 17:26)</a>:</h4>
<p>if you have any ideas for testing i'm all ears. i was considering trying to pare things down into separate files.</p>



<a name="303686443"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/347488-roctoberfest/topic/Alternative%20platform%20languages/near/303686443" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis <a href="https://roc-lang.github.io/zulip-export/stream/347488-roctoberfest/topic/Alternative.20platform.20languages.html#303686443">(Oct 12 2022 at 17:27)</a>:</h4>
<p>i wonder if its possible to run a Task in an expect? i tried the other day but couldn't figure it out.</p>



<a name="303688409"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/347488-roctoberfest/topic/Alternative%20platform%20languages/near/303688409" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/347488-roctoberfest/topic/Alternative.20platform.20languages.html#303688409">(Oct 12 2022 at 17:37)</a>:</h4>
<p><span class="user-mention silent" data-user-id="551275">Travis</span> <a href="#narrow/stream/347488-roctoberfest/topic/Alternative.20platform.20languages/near/303686443">said</a>:</p>
<blockquote>
<p>i wonder if its possible to run a Task in an expect? i tried the other day but couldn't figure it out.</p>
</blockquote>
<p>not yet! we're going to have a separate <code>expect-fx</code> keyword for that, but it doesn't exist yet <span aria-label="big smile" class="emoji emoji-1f604" role="img" title="big smile">:big_smile:</span></p>



<a name="303688630"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/347488-roctoberfest/topic/Alternative%20platform%20languages/near/303688630" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/347488-roctoberfest/topic/Alternative.20platform.20languages.html#303688630">(Oct 12 2022 at 17:39)</a>:</h4>
<p>well, that's for testing in the sense of actually running the task - there's a separate concept of "simulating" tasks where you never actually run them, but rather sort of mock out their inputs and outputs; that's a separate topic</p>



<a name="303690051"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/347488-roctoberfest/topic/Alternative%20platform%20languages/near/303690051" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis <a href="https://roc-lang.github.io/zulip-export/stream/347488-roctoberfest/topic/Alternative.20platform.20languages.html#303690051">(Oct 12 2022 at 17:47)</a>:</h4>
<p>ooh <code>expect-fx</code> sounds neat.  cool to hear thats in the works. and there was good reason it wasn't working for me.</p>



<a name="303691126"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/347488-roctoberfest/topic/Alternative%20platform%20languages/near/303691126" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/347488-roctoberfest/topic/Alternative.20platform.20languages.html#303691126">(Oct 12 2022 at 17:52)</a>:</h4>
<p>The manual way to test is to trigger each error from roc and then have roc print a message for each error. Should tell you if it gets every value correctly.</p>



<a name="303715017"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/347488-roctoberfest/topic/Alternative%20platform%20languages/near/303715017" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis <a href="https://roc-lang.github.io/zulip-export/stream/347488-roctoberfest/topic/Alternative.20platform.20languages.html#303715017">(Oct 12 2022 at 20:18)</a>:</h4>
<p>yeah i think i'll try to break up into smaller tests. now that cli args are working, will be a bit easier to make the errors happen. and just letting the program fail sounds good.</p>



<a name="303715546"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/347488-roctoberfest/topic/Alternative%20platform%20languages/near/303715546" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis <a href="https://roc-lang.github.io/zulip-export/stream/347488-roctoberfest/topic/Alternative.20platform.20languages.html#303715546">(Oct 12 2022 at 20:22)</a>:</h4>
<p>btw, i tried to repro the wierd zig 0.9.1 behavor i was describing earlier using on latest download build and wasn't able to do so.</p>



<a name="303715864"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/347488-roctoberfest/topic/Alternative%20platform%20languages/near/303715864" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis <a href="https://roc-lang.github.io/zulip-export/stream/347488-roctoberfest/topic/Alternative.20platform.20languages.html#303715864">(Oct 12 2022 at 20:24)</a>:</h4>
<p>not sure if this is a good repro or not. </p>
<div class="codehilite" data-code-language="Bash Session"><pre><span></span><code><span class="gp">$ </span>zig version
<span class="go">0.10.0-dev.4280+c3d67c5c4</span>

<span class="gp">$ </span>cat /tmp/test.zig
<span class="go">const std = @import("std");</span>

<span class="go">export fn func() callconv(.C) isize {</span>
<span class="go">    const fname = "/tmp/test.zigg";</span>
<span class="go">    std.debug.print("1\n", .{});</span>
<span class="go">    const f = std.fs.cwd().openFile(fname, .{}) catch {</span>
<span class="go">        return -1;</span>
<span class="go">    };</span>
<span class="go">    std.debug.print("2\n", .{});</span>
<span class="go">    defer f.close();</span>
<span class="go">    std.debug.print("3\n", .{});</span>
<span class="go">    const s = f.stat() catch {</span>
<span class="go">        return -1;</span>
<span class="go">    };</span>
<span class="go">    std.debug.print("stat.size {}\n", .{s.size});</span>
<span class="go">    return 0;</span>
<span class="go">}</span>

<span class="go">pub export fn main() callconv(.C) void {</span>
<span class="go">    const x = func();</span>
<span class="go">    std.debug.print("x {}\n", .{x});</span>
<span class="go">}</span>

<span class="gp">$ </span>zig run /tmp/test.zig
<span class="go">1</span>
<span class="go">x -1</span>
</code></pre></div>



<a name="303718041"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/347488-roctoberfest/topic/Alternative%20platform%20languages/near/303718041" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis <a href="https://roc-lang.github.io/zulip-export/stream/347488-roctoberfest/topic/Alternative.20platform.20languages.html#303718041">(Oct 12 2022 at 20:38)</a>:</h4>
<p>same result with a normal <code>fn main</code></p>



<a name="303724003"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/347488-roctoberfest/topic/Alternative%20platform%20languages/near/303724003" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/347488-roctoberfest/topic/Alternative.20platform.20languages.html#303724003">(Oct 12 2022 at 21:23)</a>:</h4>
<p>I thought the issue was only with <code>std.process.args/argsAlloc</code> which you aren't calling in that example.</p>



<a name="303724038"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/347488-roctoberfest/topic/Alternative%20platform%20languages/near/303724038" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/347488-roctoberfest/topic/Alternative.20platform.20languages.html#303724038">(Oct 12 2022 at 21:23)</a>:</h4>
<p>Or is this for a different issue?</p>



<a name="303728613"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/347488-roctoberfest/topic/Alternative%20platform%20languages/near/303728613" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis <a href="https://roc-lang.github.io/zulip-export/stream/347488-roctoberfest/topic/Alternative.20platform.20languages.html#303728613">(Oct 12 2022 at 22:05)</a>:</h4>
<p>a different issue. i couldn't figure out why zig's <code>Dir.openFile</code> and <code>File.stat</code> weren't returning errors and early returning in <code>roc_fx_fileReadBytes</code>'s catches.  thats where the funky error handling is required (checking if fd == 1).</p>



<a name="303728747"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/347488-roctoberfest/topic/Alternative%20platform%20languages/near/303728747" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis <a href="https://roc-lang.github.io/zulip-export/stream/347488-roctoberfest/topic/Alternative.20platform.20languages.html#303728747">(Oct 12 2022 at 22:06)</a>:</h4>
<p>what was actually happening is the underlying call to stat was panicking when that should have been caught</p>



<a name="303729094"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/347488-roctoberfest/topic/Alternative%20platform%20languages/near/303729094" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis <a href="https://roc-lang.github.io/zulip-export/stream/347488-roctoberfest/topic/Alternative.20platform.20languages.html#303729094">(Oct 12 2022 at 22:09)</a>:</h4>
<p>and finallly after i figured out what was going on (with wierd error traces), the <code>defer file.close()</code> was also panicking. <span aria-label="cry" class="emoji emoji-1f622" role="img" title="cry">:cry:</span></p>



<a name="303729292"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/347488-roctoberfest/topic/Alternative%20platform%20languages/near/303729292" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis <a href="https://roc-lang.github.io/zulip-export/stream/347488-roctoberfest/topic/Alternative.20platform.20languages.html#303729292">(Oct 12 2022 at 22:11)</a>:</h4>
<p>so that had to be move down a line. i don't remember 0.9.1 having these issues. something seems off.</p>



<a name="303729389"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/347488-roctoberfest/topic/Alternative%20platform%20languages/near/303729389" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis <a href="https://roc-lang.github.io/zulip-export/stream/347488-roctoberfest/topic/Alternative.20platform.20languages.html#303729389">(Oct 12 2022 at 22:12)</a>:</h4>
<p>my hunch is some abi issues but its just a guess</p>



<a name="303735109"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/347488-roctoberfest/topic/Alternative%20platform%20languages/near/303735109" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/347488-roctoberfest/topic/Alternative.20platform.20languages.html#303735109">(Oct 12 2022 at 23:11)</a>:</h4>
<p>ah, ok</p>



<a name="304063349"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/347488-roctoberfest/topic/Alternative%20platform%20languages/near/304063349" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis <a href="https://roc-lang.github.io/zulip-export/stream/347488-roctoberfest/topic/Alternative.20platform.20languages.html#304063349">(Oct 14 2022 at 15:51)</a>:</h4>
<p>hey <span class="user-mention" data-user-id="343810">@Brendan Hansknecht</span> if you have any time could you look at this branch? <a href="https://github.com/travisstaloch/roc-cli-platform-zig/tree/detect-read-errs">https://github.com/travisstaloch/roc-cli-platform-zig/tree/detect-read-errs</a></p>



<a name="304063661"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/347488-roctoberfest/topic/Alternative%20platform%20languages/near/304063661" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/347488-roctoberfest/topic/Alternative.20platform.20languages.html#304063661">(Oct 14 2022 at 15:53)</a>:</h4>
<p>Can probably do so sometime later in the day. Anything specific you want me to look at?</p>



<a name="304063978"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/347488-roctoberfest/topic/Alternative%20platform%20languages/near/304063978" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis <a href="https://roc-lang.github.io/zulip-export/stream/347488-roctoberfest/topic/Alternative.20platform.20languages.html#304063978">(Oct 14 2022 at 15:54)</a>:</h4>
<p>awesome. yeah: i feel like the host.zig is correct but for some reason i can't catch the errors <a href="https://github.com/travisstaloch/roc-cli-platform-zig/blob/detect-read-errs/test/file-read-errors.roc">https://github.com/travisstaloch/roc-cli-platform-zig/blob/detect-read-errs/test/file-read-errors.roc</a>. does the error matching here look right to you ?</p>



<a name="304064491"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/347488-roctoberfest/topic/Alternative%20platform%20languages/near/304064491" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis <a href="https://roc-lang.github.io/zulip-export/stream/347488-roctoberfest/topic/Alternative.20platform.20languages.html#304064491">(Oct 14 2022 at 15:56)</a>:</h4>
<p>i've simplified host.zig too. seems closer to what what you indicated before. ReadErr is now just a struct</p>



<a name="304064558"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/347488-roctoberfest/topic/Alternative%20platform%20languages/near/304064558" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis <a href="https://roc-lang.github.io/zulip-export/stream/347488-roctoberfest/topic/Alternative.20platform.20languages.html#304064558">(Oct 14 2022 at 15:56)</a>:</h4>
<div class="codehilite"><pre><span></span><code>    code: i32,
    message: RocStr,
    tag: u8,
</code></pre></div>



<a name="304065291"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/347488-roctoberfest/topic/Alternative%20platform%20languages/near/304065291" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis <a href="https://roc-lang.github.io/zulip-export/stream/347488-roctoberfest/topic/Alternative.20platform.20languages.html#304065291">(Oct 14 2022 at 15:59)</a>:</h4>
<p>this is a branch where i've only changed that ^ file and host.zig.</p>



<a name="304065299"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/347488-roctoberfest/topic/Alternative%20platform%20languages/near/304065299" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis <a href="https://roc-lang.github.io/zulip-export/stream/347488-roctoberfest/topic/Alternative.20platform.20languages.html#304065299">(Oct 14 2022 at 15:59)</a>:</h4>
<p><a href="https://github.com/travisstaloch/roc-cli-platform-zig/blob/detect-read-errs/platform/host.zig#L254">https://github.com/travisstaloch/roc-cli-platform-zig/blob/detect-read-errs/platform/host.zig#L254</a></p>



<a name="304065591"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/347488-roctoberfest/topic/Alternative%20platform%20languages/near/304065591" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis <a href="https://roc-lang.github.io/zulip-export/stream/347488-roctoberfest/topic/Alternative.20platform.20languages.html#304065591">(Oct 14 2022 at 16:01)</a>:</h4>
<p>my hunch is that the roc error catching is the issue.</p>



<a name="304067922"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/347488-roctoberfest/topic/Alternative%20platform%20languages/near/304067922" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis <a href="https://roc-lang.github.io/zulip-export/stream/347488-roctoberfest/topic/Alternative.20platform.20languages.html#304067922">(Oct 14 2022 at 16:11)</a>:</h4>
<p>because when i remove <code>when</code>'s <code>else</code> branch, there is a big error message suggesting to me that the ReadErr types are wrong.</p>



<a name="304069546"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/347488-roctoberfest/topic/Alternative%20platform%20languages/near/304069546" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis <a href="https://roc-lang.github.io/zulip-export/stream/347488-roctoberfest/topic/Alternative.20platform.20languages.html#304069546">(Oct 14 2022 at 16:18)</a>:</h4>
<p>even though the match is supposed to be exhaustive</p>



<a name="304072272"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/347488-roctoberfest/topic/Alternative%20platform%20languages/near/304072272" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis <a href="https://roc-lang.github.io/zulip-export/stream/347488-roctoberfest/topic/Alternative.20platform.20languages.html#304072272">(Oct 14 2022 at 16:31)</a>:</h4>
<p>ok i think i got the right error matching syntax now.</p>



<a name="304072433"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/347488-roctoberfest/topic/Alternative%20platform%20languages/near/304072433" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis <a href="https://roc-lang.github.io/zulip-export/stream/347488-roctoberfest/topic/Alternative.20platform.20languages.html#304072433">(Oct 14 2022 at 16:32)</a>:</h4>
<p>and it seems to be working.</p>
<div class="codehilite" data-code-language="Bash Session"><pre><span></span><code><span class="gp">$ </span>roc test/file-read-errors.roc
<span class="go">🔨 Rebuilding platform...</span>
<span class="go">not found</span>
</code></pre></div>



<a name="304072473"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/347488-roctoberfest/topic/Alternative%20platform%20languages/near/304072473" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis <a href="https://roc-lang.github.io/zulip-export/stream/347488-roctoberfest/topic/Alternative.20platform.20languages.html#304072473">(Oct 14 2022 at 16:32)</a>:</h4>
<p><span aria-label="duck" class="emoji emoji-1f986" role="img" title="duck">:duck:</span></p>



<a name="304072783"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/347488-roctoberfest/topic/Alternative%20platform%20languages/near/304072783" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis <a href="https://roc-lang.github.io/zulip-export/stream/347488-roctoberfest/topic/Alternative.20platform.20languages.html#304072783">(Oct 14 2022 at 16:34)</a>:</h4>
<p>hunch was right anyway. i was just struggling matching the error.  <span aria-label="joy" class="emoji emoji-1f602" role="img" title="joy">:joy:</span></p>



<a name="304074345"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/347488-roctoberfest/topic/Alternative%20platform%20languages/near/304074345" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis <a href="https://roc-lang.github.io/zulip-export/stream/347488-roctoberfest/topic/Alternative.20platform.20languages.html#304074345">(Oct 14 2022 at 16:41)</a>:</h4>
<p>other errors look good now too. except for <code>Unrecognized.</code>  when i try to return one of those i get a segfault. <span aria-label="thinking" class="emoji emoji-1f914" role="img" title="thinking">:thinking:</span></p>



<a name="304078011"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/347488-roctoberfest/topic/Alternative%20platform%20languages/near/304078011" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis <a href="https://roc-lang.github.io/zulip-export/stream/347488-roctoberfest/topic/Alternative.20platform.20languages.html#304078011">(Oct 14 2022 at 17:01)</a>:</h4>
<p>i pushed another commit. for now it returns an <code>Unrecoginzed</code> and segfaults when file path is 'foo'</p>



<a name="304078168"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/347488-roctoberfest/topic/Alternative%20platform%20languages/near/304078168" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis <a href="https://roc-lang.github.io/zulip-export/stream/347488-roctoberfest/topic/Alternative.20platform.20languages.html#304078168">(Oct 14 2022 at 17:02)</a>:</h4>
<p>running this will trigger it:<br>
<code>$ roc test/file-read-errors.roc</code></p>



<a name="304082425"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/347488-roctoberfest/topic/Alternative%20platform%20languages/near/304082425" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis <a href="https://roc-lang.github.io/zulip-export/stream/347488-roctoberfest/topic/Alternative.20platform.20languages.html#304082425">(Oct 14 2022 at 17:26)</a>:</h4>
<p>i've got <em>a solution</em> although i'm not sure its a good idea</p>



<a name="304082586"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/347488-roctoberfest/topic/Alternative%20platform%20languages/near/304082586" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis <a href="https://roc-lang.github.io/zulip-export/stream/347488-roctoberfest/topic/Alternative.20platform.20languages.html#304082586">(Oct 14 2022 at 17:26)</a>:</h4>
<p>this layout works with <code>message</code> and <code>code</code> now swapped from the way i had them. and added the <code>_padding</code> field</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">pub</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">ReadErr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">extern</span><span class="w"> </span><span class="k">struct</span> <span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="n">message</span>: <span class="nc">RocStr</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="n">code</span>: <span class="kt">i32</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="n">_padding</span>: <span class="p">[</span><span class="mi">7</span><span class="p">]</span><span class="kt">u8</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">undefined</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="n">tag</span>: <span class="kt">u8</span><span class="p">,</span><span class="w"></span>
</code></pre></div>



<a name="304082682"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/347488-roctoberfest/topic/Alternative%20platform%20languages/near/304082682" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis <a href="https://roc-lang.github.io/zulip-export/stream/347488-roctoberfest/topic/Alternative.20platform.20languages.html#304082682">(Oct 14 2022 at 17:27)</a>:</h4>
<div class="codehilite" data-code-language="Bash Session"><pre><span></span><code><span class="gp">$ </span>roc test/file-read-errors.roc
<span class="go">🔨 Rebuilding platform...</span>
<span class="go">Unrecognized code 69 message fo ur twenty</span>
</code></pre></div>



<a name="304082883"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/347488-roctoberfest/topic/Alternative%20platform%20languages/near/304082883" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis <a href="https://roc-lang.github.io/zulip-export/stream/347488-roctoberfest/topic/Alternative.20platform.20languages.html#304082883">(Oct 14 2022 at 17:28)</a>:</h4>
<p>other tests look good too. i'll push another commit now.</p>



<a name="304106031"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/347488-roctoberfest/topic/Alternative%20platform%20languages/near/304106031" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/347488-roctoberfest/topic/Alternative.20platform.20languages.html#304106031">(Oct 14 2022 at 19:55)</a>:</h4>
<p>So I was looking at the rust datastructures generated by glue and trying to figure out what the correct generation is when I realized that glue definitely has a bug in generation. I am going to take a look at that and them hopefully get back to you on what the correct representation actually is.</p>



<a name="304111632"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/347488-roctoberfest/topic/Alternative%20platform%20languages/near/304111632" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/347488-roctoberfest/topic/Alternative.20platform.20languages.html#304111632">(Oct 14 2022 at 20:29)</a>:</h4>
<p>Ok. So I looked into this a bit more and realized what I though was a bug was actually me looking at the 32bit definition instead of the 64bit definition.</p>



<a name="304112092"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/347488-roctoberfest/topic/Alternative%20platform%20languages/near/304112092" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/347488-roctoberfest/topic/Alternative.20platform.20languages.html#304112092">(Oct 14 2022 at 20:32)</a>:</h4>
<p>If I am reading the code correctly, the definition should be:</p>
<div class="codehilite"><pre><span></span><code>pub const ReadErr = extern struct {
    code: i32,
    message: RocStr,
    tag: u8,
    _padding: [7]u8 = undefined,
</code></pre></div>
<p>This leads to 4 bytes for the i32, 4 bytes of padding, 24 bytes for the RocStr, then the tag as a u8. So 40 bytes total with the tag at index 32.</p>



<a name="304113440"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/347488-roctoberfest/topic/Alternative%20platform%20languages/near/304113440" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis <a href="https://roc-lang.github.io/zulip-export/stream/347488-roctoberfest/topic/Alternative.20platform.20languages.html#304113440">(Oct 14 2022 at 20:41)</a>:</h4>
<p>ah. hmm ok. well that seems to be correct. not sure how i was getting something that looked correct earlier.  but this is good.</p>



<a name="304113447"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/347488-roctoberfest/topic/Alternative%20platform%20languages/near/304113447" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis <a href="https://roc-lang.github.io/zulip-export/stream/347488-roctoberfest/topic/Alternative.20platform.20languages.html#304113447">(Oct 14 2022 at 20:42)</a>:</h4>
<p>thank you  <span aria-label="+1" class="emoji emoji-1f44d" role="img" title="+1">:+1:</span></p>



<a name="304113749"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/347488-roctoberfest/topic/Alternative%20platform%20languages/near/304113749" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis <a href="https://roc-lang.github.io/zulip-export/stream/347488-roctoberfest/topic/Alternative.20platform.20languages.html#304113749">(Oct 14 2022 at 20:44)</a>:</h4>
<p>in the last little big ive been working on a strictly testing/debugging version of <code>roc_fx_fileReadBytes</code> which just returns errors.</p>



<a name="304113784"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/347488-roctoberfest/topic/Alternative%20platform%20languages/near/304113784" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis <a href="https://roc-lang.github.io/zulip-export/stream/347488-roctoberfest/topic/Alternative.20platform.20languages.html#304113784">(Oct 14 2022 at 20:44)</a>:</h4>
<p>wasn't working til now. so this seems correct.</p>



<a name="304114201"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/347488-roctoberfest/topic/Alternative%20platform%20languages/near/304114201" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/347488-roctoberfest/topic/Alternative.20platform.20languages.html#304114201">(Oct 14 2022 at 20:46)</a>:</h4>
<p>glad it works.</p>



<a name="304114409"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/347488-roctoberfest/topic/Alternative%20platform%20languages/near/304114409" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis <a href="https://roc-lang.github.io/zulip-export/stream/347488-roctoberfest/topic/Alternative.20platform.20languages.html#304114409">(Oct 14 2022 at 20:48)</a>:</h4>
<p>ooh wait. think i spoke too soon again. <code>Unrecognized</code> doesn't seem to work but the others look good.</p>



<a name="304114548"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/347488-roctoberfest/topic/Alternative%20platform%20languages/near/304114548" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis <a href="https://roc-lang.github.io/zulip-export/stream/347488-roctoberfest/topic/Alternative.20platform.20languages.html#304114548">(Oct 14 2022 at 20:49)</a>:</h4>
<p>thats the one with the code/message</p>



<a name="304114727"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/347488-roctoberfest/topic/Alternative%20platform%20languages/near/304114727" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis <a href="https://roc-lang.github.io/zulip-export/stream/347488-roctoberfest/topic/Alternative.20platform.20languages.html#304114727">(Oct 14 2022 at 20:50)</a>:</h4>
<p>the tag looks fine but the code and message are wrong.</p>



<a name="304114934"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/347488-roctoberfest/topic/Alternative%20platform%20languages/near/304114934" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis <a href="https://roc-lang.github.io/zulip-export/stream/347488-roctoberfest/topic/Alternative.20platform.20languages.html#304114934">(Oct 14 2022 at 20:51)</a>:</h4>
<p>haha shoot i think this is my mistake. nevermind for now.</p>



<a name="304115056"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/347488-roctoberfest/topic/Alternative%20platform%20languages/near/304115056" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis <a href="https://roc-lang.github.io/zulip-export/stream/347488-roctoberfest/topic/Alternative.20platform.20languages.html#304115056">(Oct 14 2022 at 20:52)</a>:</h4>
<p>yeah i had Unrecognized/Unsupported mixed up <span aria-label="blushing" class="emoji emoji-1f633" role="img" title="blushing">:blushing:</span></p>



<a name="304115515"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/347488-roctoberfest/topic/Alternative%20platform%20languages/near/304115515" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis <a href="https://roc-lang.github.io/zulip-export/stream/347488-roctoberfest/topic/Alternative.20platform.20languages.html#304115515">(Oct 14 2022 at 20:55)</a>:</h4>
<p>and it segfaulted. i had to flip code/message back to the say i had it. this is what seems to work. </p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">pub</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">ReadErr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">extern</span><span class="w"> </span><span class="k">struct</span> <span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="n">message</span>: <span class="nc">RocStr</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="n">code</span>: <span class="kt">i32</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="n">tag</span>: <span class="kt">u8</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="n">_padding</span>: <span class="p">[</span><span class="mi">7</span><span class="p">]</span><span class="kt">u8</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">undefined</span><span class="p">,</span><span class="w"></span>
</code></pre></div>



<a name="304115608"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/347488-roctoberfest/topic/Alternative%20platform%20languages/near/304115608" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis <a href="https://roc-lang.github.io/zulip-export/stream/347488-roctoberfest/topic/Alternative.20platform.20languages.html#304115608">(Oct 14 2022 at 20:56)</a>:</h4>
<p>let me make a better test script so i can be sure i'm correct.</p>



<a name="304115884"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/347488-roctoberfest/topic/Alternative%20platform%20languages/near/304115884" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis <a href="https://roc-lang.github.io/zulip-export/stream/347488-roctoberfest/topic/Alternative.20platform.20languages.html#304115884">(Oct 14 2022 at 20:58)</a>:</h4>
<p>the reason i thought this was correct in the first place is this: line 182 in <a href="http://file_glue.rs">file_glue.rs</a></p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="cp">#[cfg(any(</span>
<span class="cp">    target_arch = </span><span class="s">"aarch64"</span><span class="cp">,</span>
<span class="cp">    target_arch = </span><span class="s">"x86_64"</span><span class="cp"></span>
<span class="cp">))]</span><span class="w"></span>
<span class="cp">#[derive(Clone, Debug, Default, Eq, Ord, Hash, PartialEq, PartialOrd)]</span><span class="w"></span>
<span class="cp">#[repr(C)]</span><span class="w"></span>
<span class="k">struct</span> <span class="nc">ReadErr_Unrecognized</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">pub</span><span class="w"> </span><span class="n">f1</span>: <span class="nc">roc_std</span>::<span class="n">RocStr</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="k">pub</span><span class="w"> </span><span class="n">f0</span>: <span class="kt">i32</span><span class="p">,</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>



<a name="304116024"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/347488-roctoberfest/topic/Alternative%20platform%20languages/near/304116024" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis <a href="https://roc-lang.github.io/zulip-export/stream/347488-roctoberfest/topic/Alternative.20platform.20languages.html#304116024">(Oct 14 2022 at 20:59)</a>:</h4>
<p>the one i'm looking at is examples/cli/cli-platform/src/file_glue.rs</p>



<a name="304116451"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/347488-roctoberfest/topic/Alternative%20platform%20languages/near/304116451" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis <a href="https://roc-lang.github.io/zulip-export/stream/347488-roctoberfest/topic/Alternative.20platform.20languages.html#304116451">(Oct 14 2022 at 21:02)</a>:</h4>
<p>*edited added arches</p>



<a name="304116706"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/347488-roctoberfest/topic/Alternative%20platform%20languages/near/304116706" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis <a href="https://roc-lang.github.io/zulip-export/stream/347488-roctoberfest/topic/Alternative.20platform.20languages.html#304116706">(Oct 14 2022 at 21:04)</a>:</h4>
<p>and on line 78 theyre backwards for 32 bit</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="cp">#[cfg(any(</span>
<span class="cp">    target_arch = </span><span class="s">"arm"</span><span class="cp">,</span>
<span class="cp">    target_arch = </span><span class="s">"wasm32"</span><span class="cp">,</span>
<span class="cp">    target_arch = </span><span class="s">"x86"</span><span class="cp"></span>
<span class="cp">))]</span><span class="w"></span>
<span class="cp">#[derive(Clone, Debug, Default, Eq, Ord, Hash, PartialEq, PartialOrd)]</span><span class="w"></span>
<span class="cp">#[repr(C)]</span><span class="w"></span>
<span class="k">struct</span> <span class="nc">ReadErr_Unrecognized</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">pub</span><span class="w"> </span><span class="n">f0</span>: <span class="kt">i32</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="k">pub</span><span class="w"> </span><span class="n">f1</span>: <span class="nc">roc_std</span>::<span class="n">RocStr</span><span class="p">,</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>



<a name="304116739"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/347488-roctoberfest/topic/Alternative%20platform%20languages/near/304116739" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/347488-roctoberfest/topic/Alternative.20platform.20languages.html#304116739">(Oct 14 2022 at 21:04)</a>:</h4>
<p>oh, duh</p>



<a name="304116753"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/347488-roctoberfest/topic/Alternative%20platform%20languages/near/304116753" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/347488-roctoberfest/topic/Alternative.20platform.20languages.html#304116753">(Oct 14 2022 at 21:04)</a>:</h4>
<p>My bad</p>



<a name="304116795"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/347488-roctoberfest/topic/Alternative%20platform%20languages/near/304116795" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/347488-roctoberfest/topic/Alternative.20platform.20languages.html#304116795">(Oct 14 2022 at 21:04)</a>:</h4>
<p>We first sort fields by alignment and then by name</p>



<a name="304116859"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/347488-roctoberfest/topic/Alternative%20platform%20languages/near/304116859" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/347488-roctoberfest/topic/Alternative.20platform.20languages.html#304116859">(Oct 14 2022 at 21:05)</a>:</h4>
<p>So on a 64bit system, Str before I32.</p>



<a name="304116894"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/347488-roctoberfest/topic/Alternative%20platform%20languages/near/304116894" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/347488-roctoberfest/topic/Alternative.20platform.20languages.html#304116894">(Oct 14 2022 at 21:05)</a>:</h4>
<p>Cause Str contains pointers and is aligned to 8</p>



<a name="304116942"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/347488-roctoberfest/topic/Alternative%20platform%20languages/near/304116942" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/347488-roctoberfest/topic/Alternative.20platform.20languages.html#304116942">(Oct 14 2022 at 21:05)</a>:</h4>
<p>On the 32 bit system, they are both aligned to 4.</p>



<a name="304116992"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/347488-roctoberfest/topic/Alternative%20platform%20languages/near/304116992" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/347488-roctoberfest/topic/Alternative.20platform.20languages.html#304116992">(Oct 14 2022 at 21:06)</a>:</h4>
<p>I didn't realize that this optimization also applied to tag unions, I thought it was just for records.</p>



<a name="304117097"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/347488-roctoberfest/topic/Alternative%20platform%20languages/near/304117097" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis <a href="https://roc-lang.github.io/zulip-export/stream/347488-roctoberfest/topic/Alternative.20platform.20languages.html#304117097">(Oct 14 2022 at 21:06)</a>:</h4>
<p>ah good. that makes a lot of sense now.</p>



<a name="304117208"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/347488-roctoberfest/topic/Alternative%20platform%20languages/near/304117208" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis <a href="https://roc-lang.github.io/zulip-export/stream/347488-roctoberfest/topic/Alternative.20platform.20languages.html#304117208">(Oct 14 2022 at 21:07)</a>:</h4>
<p>i'm just going to shoot for a working 64 bit impl before thinking about 32</p>



<a name="304117346"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/347488-roctoberfest/topic/Alternative%20platform%20languages/near/304117346" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis <a href="https://roc-lang.github.io/zulip-export/stream/347488-roctoberfest/topic/Alternative.20platform.20languages.html#304117346">(Oct 14 2022 at 21:08)</a>:</h4>
<p>but glad to know a little more about these types of details. <span aria-label="smile" class="emoji emoji-1f642" role="img" title="smile">:smile:</span></p>



<a name="304117935"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/347488-roctoberfest/topic/Alternative%20platform%20languages/near/304117935" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/347488-roctoberfest/topic/Alternative.20platform.20languages.html#304117935">(Oct 14 2022 at 21:13)</a>:</h4>
<p>Yeah, this is a big reason for glue existing in general.</p>



<a name="304122476"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/347488-roctoberfest/topic/Alternative%20platform%20languages/near/304122476" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis <a href="https://roc-lang.github.io/zulip-export/stream/347488-roctoberfest/topic/Alternative.20platform.20languages.html#304122476">(Oct 14 2022 at 21:50)</a>:</h4>
<p>i've got a good test script now passing in error names from the cli. i was experimenting trying to get them all corrected and i this is what i've come up with.  </p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">pub</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">ReadErr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">extern</span><span class="w"> </span><span class="k">struct</span> <span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="n">message</span>: <span class="nc">RocStr</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="n">code</span>: <span class="kt">i32</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="n">tag</span>: <span class="kt">usize</span><span class="p">,</span><span class="w"></span>
</code></pre></div>



<a name="304122601"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/347488-roctoberfest/topic/Alternative%20platform%20languages/near/304122601" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis <a href="https://roc-lang.github.io/zulip-export/stream/347488-roctoberfest/topic/Alternative.20platform.20languages.html#304122601">(Oct 14 2022 at 21:51)</a>:</h4>
<p>with this all the error tags are good and the <code>Unrecognized</code> payload is too. <span aria-label="big smile" class="emoji emoji-1f604" role="img" title="big smile">:big_smile:</span></p>



<a name="304122748"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/347488-roctoberfest/topic/Alternative%20platform%20languages/near/304122748" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/347488-roctoberfest/topic/Alternative.20platform.20languages.html#304122748">(Oct 14 2022 at 21:53)</a>:</h4>
<p>Yeah, should work on any 64 bit little endian system.</p>



<a name="304122886"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/347488-roctoberfest/topic/Alternative%20platform%20languages/near/304122886" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis <a href="https://roc-lang.github.io/zulip-export/stream/347488-roctoberfest/topic/Alternative.20platform.20languages.html#304122886">(Oct 14 2022 at 21:54)</a>:</h4>
<p>do we need big endian support too?</p>



<a name="304123041"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/347488-roctoberfest/topic/Alternative%20platform%20languages/near/304123041" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/347488-roctoberfest/topic/Alternative.20platform.20languages.html#304123041">(Oct 14 2022 at 21:55)</a>:</h4>
<p>not yet...maybe one day</p>



<a name="304123067"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/347488-roctoberfest/topic/Alternative%20platform%20languages/near/304123067" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/347488-roctoberfest/topic/Alternative.20platform.20languages.html#304123067">(Oct 14 2022 at 21:55)</a>:</h4>
<p>currently the only supported platforms are little endian and either 32 or 64 bit</p>



<a name="304123187"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/347488-roctoberfest/topic/Alternative%20platform%20languages/near/304123187" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis <a href="https://roc-lang.github.io/zulip-export/stream/347488-roctoberfest/topic/Alternative.20platform.20languages.html#304123187">(Oct 14 2022 at 21:56)</a>:</h4>
<p>ok good to know.</p>



<hr><p>Last updated: Nov 01 2025 at 12:13 UTC</p>
</html>