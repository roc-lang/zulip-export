<html>
<head><meta charset="utf-8"><title>2023 day 14 · roctoberfest · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://roc-lang.github.io/zulip-export/stream/347488-roctoberfest/index.html">roctoberfest</a></h2>
<h3>Topic: <a href="https://roc-lang.github.io/zulip-export/stream/347488-roctoberfest/topic/2023.20day.2014.html">2023 day 14</a></h3>

<hr>

<base href="https://roc.zulipchat.com">

<head><link href="https://roc-lang.github.io/zulip-export/style.css" rel="stylesheet"></head>

<a name="397374804"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/347488-roctoberfest/topic/2023%20day%2014/near/397374804" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Fabian Schmalzried <a href="https://roc-lang.github.io/zulip-export/stream/347488-roctoberfest/topic/2023.20day.2014.html#397374804">(Oct 18 2023 at 19:52)</a>:</h4>
<p>I just did day 14 and my (probably not optimal) solution for part 2 took about a minute to run. With --optimize it was "only" about 20s. So it's probably good to know that there is --optimize.</p>



<a name="397651283"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/347488-roctoberfest/topic/2023%20day%2014/near/397651283" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anton <a href="https://roc-lang.github.io/zulip-export/stream/347488-roctoberfest/topic/2023.20day.2014.html#397651283">(Oct 20 2023 at 07:52)</a>:</h4>
<p>Hi <span class="user-mention" data-user-id="559412">@Fabian Schmalzried</span>,<br>
Can you share your code? If it's some new patholigical performance case I'll make an issue for it</p>



<a name="397830549"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/347488-roctoberfest/topic/2023%20day%2014/near/397830549" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Fabian Schmalzried <a href="https://roc-lang.github.io/zulip-export/stream/347488-roctoberfest/topic/2023.20day.2014.html#397830549">(Oct 21 2023 at 08:48)</a>:</h4>
<p>Here it is, but I don't think it's rocs fault.<br>
<a href="https://gist.github.com/FabHof/5b2ac84a1df7cb165da43231fb84c616">https://gist.github.com/FabHof/5b2ac84a1df7cb165da43231fb84c616</a></p>



<a name="397831458"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/347488-roctoberfest/topic/2023%20day%2014/near/397831458" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anton <a href="https://roc-lang.github.io/zulip-export/stream/347488-roctoberfest/topic/2023.20day.2014.html#397831458">(Oct 21 2023 at 09:02)</a>:</h4>
<p>Uhu, yes, I expect that all the non-tail recursive calls cause the slowdown. Thanks for sharing anyway :)</p>



<a name="397978044"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/347488-roctoberfest/topic/2023%20day%2014/near/397978044" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Elias Mulhall <a href="https://roc-lang.github.io/zulip-export/stream/347488-roctoberfest/topic/2023.20day.2014.html#397978044">(Oct 22 2023 at 23:05)</a>:</h4>
<p>Here's a different take on day 14, I've actually had this one partially completed for a bit!<br>
<a href="https://github.com/mulias/roctoberfest/blob/main/advent_2022/day_14/main.roc">https://github.com/mulias/roctoberfest/blob/main/advent_2022/day_14/main.roc</a></p>



<a name="397978105"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/347488-roctoberfest/topic/2023%20day%2014/near/397978105" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Elias Mulhall <a href="https://roc-lang.github.io/zulip-export/stream/347488-roctoberfest/topic/2023.20day.2014.html#397978105">(Oct 22 2023 at 23:06)</a>:</h4>
<p>The output for this one is fun<br>
<a href="/user_uploads/22008/bAVlmywbDCjzUYiYTVgqayKr/Screenshot_2023-10-22_19-01-45.png">Screenshot_2023-10-22_19-01-45.png</a><br>
<a href="/user_uploads/22008/IBnSpGHDNyo9BtiBzRJ86xQu/Screenshot_2023-10-22_19-01-26.png">Screenshot_2023-10-22_19-01-26.png</a></p>
<div class="message_inline_image"><a href="/user_uploads/22008/bAVlmywbDCjzUYiYTVgqayKr/Screenshot_2023-10-22_19-01-45.png" title="Screenshot_2023-10-22_19-01-45.png"><img src="/user_uploads/22008/bAVlmywbDCjzUYiYTVgqayKr/Screenshot_2023-10-22_19-01-45.png"></a></div><div class="message_inline_image"><a href="/user_uploads/22008/IBnSpGHDNyo9BtiBzRJ86xQu/Screenshot_2023-10-22_19-01-26.png" title="Screenshot_2023-10-22_19-01-26.png"><img src="/user_uploads/22008/IBnSpGHDNyo9BtiBzRJ86xQu/Screenshot_2023-10-22_19-01-26.png"></a></div>



<a name="397978237"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/347488-roctoberfest/topic/2023%20day%2014/near/397978237" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/347488-roctoberfest/topic/2023.20day.2014.html#397978237">(Oct 22 2023 at 23:09)</a>:</h4>
<p>I love how clean the solution reads in Roc. Thank you for sharing.</p>



<a name="397979391"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/347488-roctoberfest/topic/2023%20day%2014/near/397979391" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/347488-roctoberfest/topic/2023.20day.2014.html#397979391">(Oct 22 2023 at 23:31)</a>:</h4>
<p>that poor <code>addSand</code> function. I wonder if we can write in a different way to help with the nesting.</p>



<a name="397982707"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/347488-roctoberfest/topic/2023%20day%2014/near/397982707" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Elias Mulhall <a href="https://roc-lang.github.io/zulip-export/stream/347488-roctoberfest/topic/2023.20day.2014.html#397982707">(Oct 23 2023 at 00:26)</a>:</h4>
<p>Haha. This works, not sure if it's much better?</p>
<div class="codehilite"><pre><span></span><code>addSand : Cave, Array2D.Index -&gt; Result Cave [SandFellIntoTheInfiniteAbyss, Blocked]
addSand = \cave, pos -&gt;
    when Array2D.get cave pos is
        Err OutOfBounds -&gt; Err SandFellIntoTheInfiniteAbyss
        Ok Sand | Ok Rock -&gt; Err Blocked
        Ok Air -&gt;
            addSand cave (down pos)
            |&gt; Result.onErr \err -&gt;
                if err == Blocked then
                    addSand cave (downLeft pos)
                else
                    Err err
            |&gt; Result.onErr \err -&gt;
                if err == Blocked then
                    addSand cave (downRight pos)
                else
                    Err err
            |&gt; Result.onErr \err -&gt;
                if err == Blocked then
                    Ok (Array2D.set cave pos Sand)
                else
                    Err err
</code></pre></div>



<a name="397984734"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/347488-roctoberfest/topic/2023%20day%2014/near/397984734" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Elias Mulhall <a href="https://roc-lang.github.io/zulip-export/stream/347488-roctoberfest/topic/2023.20day.2014.html#397984734">(Oct 23 2023 at 00:47)</a>:</h4>
<p>This isn't too bad</p>
<div class="codehilite"><pre><span></span><code>addSand : Cave, Array2D.Index -&gt; Result Cave [SandFellIntoTheInfiniteAbyss, Blocked]
addSand = \cave, pos -&gt;
    when Array2D.get cave pos is
        Err OutOfBounds -&gt; Err SandFellIntoTheInfiniteAbyss
        Ok Sand | Ok Rock -&gt; Err Blocked
        Ok Air -&gt;
            addSand cave (down pos)
            |&gt; elseIfBlocked \_ -&gt; addSand cave (downLeft pos)
            |&gt; elseIfBlocked \_ -&gt; addSand cave (downRight pos)
            |&gt; elseIfBlocked \_ -&gt; Ok (Array2D.set cave pos Sand)

elseIfBlocked = \result, thunk -&gt;
    when result is
        Err Blocked -&gt; thunk {}
        _ -&gt; result
</code></pre></div>



<a name="397988981"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/347488-roctoberfest/topic/2023%20day%2014/near/397988981" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/347488-roctoberfest/topic/2023.20day.2014.html#397988981">(Oct 23 2023 at 01:28)</a>:</h4>
<p>Oh wow <span aria-label="astonished" class="emoji emoji-1f632" role="img" title="astonished">:astonished:</span>...yeah, much nicer</p>



<a name="397989451"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/347488-roctoberfest/topic/2023%20day%2014/near/397989451" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/347488-roctoberfest/topic/2023.20day.2014.html#397989451">(Oct 23 2023 at 01:33)</a>:</h4>
<p>I like how clear this is to follow the logic. I wonder though how performant this is, like would you expect this to be significantly worse than an equivalent imperative implementation or roughly equivalent when using <code>--optimize</code>?  This is probably not straightforward to verify realistically for performance, but if this kind of thing is as good as or better, then that is a very positive signal for Roc. It looks really easy to test and verify correctness, and is easy to read and follow the logic... almost as easy as reading the text of the problem description.</p>



<a name="397990281"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/347488-roctoberfest/topic/2023%20day%2014/near/397990281" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/347488-roctoberfest/topic/2023.20day.2014.html#397990281">(Oct 23 2023 at 01:42)</a>:</h4>
<p>I think llvm will inline <code>elseIfBlocked</code> and all of the <code>thunk</code>s. Once those are inlined, I think it is tail recursive, so perf should be fine</p>



<a name="397990675"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/347488-roctoberfest/topic/2023%20day%2014/near/397990675" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Elias Mulhall <a href="https://roc-lang.github.io/zulip-export/stream/347488-roctoberfest/topic/2023.20day.2014.html#397990675">(Oct 23 2023 at 01:46)</a>:</h4>
<p>It runs in less than a second on my machine. <code>--optimize</code> maybe makes it very slightly snappier. We're manipulating a list of 68,000 elements so there's some work going on, but this still feels like a toy problem to me. </p>
<p>Having O(1) array element access is definitely nice, that's one of the things that kills me when I do AoC in list-based functional languages.</p>



<a name="397993717"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/347488-roctoberfest/topic/2023%20day%2014/near/397993717" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/347488-roctoberfest/topic/2023.20day.2014.html#397993717">(Oct 23 2023 at 02:19)</a>:</h4>
<p>This is what I see with <code>hyperfine</code>. <code>--optimize</code> does a lot.</p>
<p>Just run:</p>
<div class="codehilite"><pre><span></span><code>Benchmark 1: ./day14-dev
  Time (mean ± σ):     671.3 ms ±  11.5 ms    [User: 664.1 ms, System: 3.7 ms]
  Range (min … max):   664.6 ms … 716.0 ms    20 runs

Benchmark 2: ./day14-opt
  Time (mean ± σ):     137.7 ms ±   1.2 ms    [User: 135.9 ms, System: 1.2 ms]
  Range (min … max):   135.8 ms … 139.3 ms    20 runs

Summary
  &#39;./day14-opt&#39; ran
    4.88 ± 0.09 times faster than &#39;./day14-dev&#39;
</code></pre></div>



<a name="397993851"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/347488-roctoberfest/topic/2023%20day%2014/near/397993851" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/347488-roctoberfest/topic/2023.20day.2014.html#397993851">(Oct 23 2023 at 02:20)</a>:</h4>
<p>Of course from an end user perspective, the compile time is long enough that <code>dev</code> is probably faster if you are building and running.</p>



<a name="397994710"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/347488-roctoberfest/topic/2023%20day%2014/near/397994710" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Elias Mulhall <a href="https://roc-lang.github.io/zulip-export/stream/347488-roctoberfest/topic/2023.20day.2014.html#397994710">(Oct 23 2023 at 02:25)</a>:</h4>
<p>very cool!</p>



<hr><p>Last updated: Nov 01 2025 at 12:13 UTC</p>
</html>