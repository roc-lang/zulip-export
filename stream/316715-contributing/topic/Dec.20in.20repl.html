<html>
<head><meta charset="utf-8"><title>Dec in repl · contributing · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/index.html">contributing</a></h2>
<h3>Topic: <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Dec.20in.20repl.html">Dec in repl</a></h3>

<hr>

<base href="https://roc.zulipchat.com">

<head><link href="https://roc-lang.github.io/zulip-export/style.css" rel="stylesheet"></head>

<a name="274153046"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Dec%20in%20repl/near/274153046" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Derek Gustafson <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Dec.20in.20repl.html#274153046">(Mar 04 2022 at 16:25)</a>:</h4>
<p>I'm trying to get Decs to work in the repl. I've traced it back to repl_eval/src/eval.rs It looks like the function being passed to app.call_function needs to take a RocDec, which isn't included in the crate. Does this sound right? I want to make sure I'm not I'm not going about this in the wrong way before adding RocDec to the appropriate cargo file</p>



<a name="274154451"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Dec%20in%20repl/near/274154451" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Dec.20in.20repl.html#274154451">(Mar 04 2022 at 16:36)</a>:</h4>
<p>I think you can use <code>deref_i128</code></p>



<a name="274154471"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Dec%20in%20repl/near/274154471" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Dec.20in.20repl.html#274154471">(Mar 04 2022 at 16:36)</a>:</h4>
<p>and then in the cli and wasm crates (that already import roc_std) do the actual conversion to RocDec</p>



<a name="274154515"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Dec%20in%20repl/near/274154515" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Dec.20in.20repl.html#274154515">(Mar 04 2022 at 16:37)</a>:</h4>
<p><code>repl_cli</code> and <code>repl_wasm</code>, that is</p>



<a name="274154637"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Dec%20in%20repl/near/274154637" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Dec.20in.20repl.html#274154637">(Mar 04 2022 at 16:38)</a>:</h4>
<p>at least that's how we do it with strings and lists today</p>



<a name="274154856"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Dec%20in%20repl/near/274154856" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Derek Gustafson <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Dec.20in.20repl.html#274154856">(Mar 04 2022 at 16:39)</a>:</h4>
<p>I'll give that a try. Thanks!</p>



<a name="274168948"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Dec%20in%20repl/near/274168948" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Derek Gustafson <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Dec.20in.20repl.html#274168948">(Mar 04 2022 at 18:23)</a>:</h4>
<p>Now that I've dug deeper, what's needed in <code>repl_eval</code> is an <code>Expr::Num</code>, which takes a string representation of the number. I see 3 options:</p>
<ol>
<li>Use <code>deref_i128</code> and build the display logic into <code>repl_eval</code>. This will require leaking implementation details (how many decimal digits) of <code>Dec</code> into <code>repl_eval</code></li>
<li>Add <code>deref_dec(&amp;self, addr: usize) -&gt; &amp;str</code> to <code>ReplAppMemory</code> and add a function <code>toStr(&amp;self) -&gt; &amp;str</code> to <code>RocDec</code>. This feels the cleanest to me.</li>
<li>Add <code>deref_dec(&amp;self, addr: usize) -&gt; (i128, i32)</code> to <code>ReplAppMemory</code> that returns the whole and decimal parts. Then add a function to <code>repl_eval</code> to display the pair. Note that there is already display logic for other numbers in <code>repl_eval</code></li>
</ol>
<p>Thoughts?</p>



<a name="274169324"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Dec%20in%20repl/near/274169324" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Dec.20in.20repl.html#274169324">(Mar 04 2022 at 18:26)</a>:</h4>
<p>that's surprising. What makes it different form list/str ?</p>



<a name="274169692"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Dec%20in%20repl/near/274169692" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Derek Gustafson <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Dec.20in.20repl.html#274169692">(Mar 04 2022 at 18:29)</a>:</h4>
<p><code>deref_str</code> uses method 2.</p>



<a name="274169886"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Dec%20in%20repl/near/274169886" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Dec.20in.20repl.html#274169886">(Mar 04 2022 at 18:31)</a>:</h4>
<p>right, let's go with that then</p>



<a name="274170019"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Dec%20in%20repl/near/274170019" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Dec.20in.20repl.html#274170019">(Mar 04 2022 at 18:32)</a>:</h4>
<p><code>toStr</code> is implemented in zig, but should be easy to port to rust</p>



<a name="274170086"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Dec%20in%20repl/near/274170086" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Derek Gustafson <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Dec.20in.20repl.html#274170086">(Mar 04 2022 at 18:32)</a>:</h4>
<p>I don't understand the List structure enough to be sure, but I think it basically uses 1 and leaks that it's implemented as an array.</p>



<a name="274170199"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Dec%20in%20repl/near/274170199" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Derek Gustafson <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Dec.20in.20repl.html#274170199">(Mar 04 2022 at 18:33)</a>:</h4>
<p>Should I leave the zig implementation for generating the llvm bytecode, or just convert the function to rust, and call that one?</p>



<a name="274170329"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Dec%20in%20repl/near/274170329" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Dec.20in.20repl.html#274170329">(Mar 04 2022 at 18:33)</a>:</h4>
<p>porting that code and putting it into <code>roc_std</code> should work</p>



<a name="274170411"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Dec%20in%20repl/near/274170411" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Dec.20in.20repl.html#274170411">(Mar 04 2022 at 18:34)</a>:</h4>
<p>the type signature there doesn't work though</p>



<a name="274170443"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Dec%20in%20repl/near/274170443" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Derek Gustafson <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Dec.20in.20repl.html#274170443">(Mar 04 2022 at 18:34)</a>:</h4>
<p><span aria-label="+1" class="emoji emoji-1f44d" role="img" title="+1">:+1:</span></p>



<a name="274170486"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Dec%20in%20repl/near/274170486" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Dec.20in.20repl.html#274170486">(Mar 04 2022 at 18:34)</a>:</h4>
<p>it has to be <code>deref_dec(&amp;self, addr: usize) -&gt; i128</code>, or at least something that is not a reference type</p>



<a name="274171021"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Dec%20in%20repl/near/274171021" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Derek Gustafson <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Dec.20in.20repl.html#274171021">(Mar 04 2022 at 18:37)</a>:</h4>
<p>Why not a <code>&amp;str</code>?</p>



<a name="274171335"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Dec%20in%20repl/near/274171335" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Derek Gustafson <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Dec.20in.20repl.html#274171335">(Mar 04 2022 at 18:39)</a>:</h4>
<p>I guess the other possibility is <code>deref_dec(&amp;self, addr: usize) -&gt; f64</code> and the print it as a <code>f64</code></p>



<a name="274171827"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Dec%20in%20repl/near/274171827" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Dec.20in.20repl.html#274171827">(Mar 04 2022 at 18:43)</a>:</h4>
<p>lifetimes</p>



<a name="274171859"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Dec%20in%20repl/near/274171859" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Dec.20in.20repl.html#274171859">(Mar 04 2022 at 18:43)</a>:</h4>
<p>you cannot return a <code>&amp;str</code> there, there is no way to allocate it</p>



<a name="274171890"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Dec%20in%20repl/near/274171890" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Dec.20in.20repl.html#274171890">(Mar 04 2022 at 18:43)</a>:</h4>
<p>it works in the case of <code>deref_str</code> because <code>self</code> contains the bytes</p>



<a name="274171921"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Dec%20in%20repl/near/274171921" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Dec.20in.20repl.html#274171921">(Mar 04 2022 at 18:43)</a>:</h4>
<p>but you cannot create a new string there and then return it as a <code>&amp;str</code></p>



<a name="274172003"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Dec%20in%20repl/near/274172003" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Derek Gustafson <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Dec.20in.20repl.html#274172003">(Mar 04 2022 at 18:44)</a>:</h4>
<p>Right</p>



<a name="274172011"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Dec%20in%20repl/near/274172011" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Dec.20in.20repl.html#274172011">(Mar 04 2022 at 18:44)</a>:</h4>
<p><code>f64</code> is a good option I think</p>



<a name="274172062"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Dec%20in%20repl/near/274172062" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Dec.20in.20repl.html#274172062">(Mar 04 2022 at 18:44)</a>:</h4>
<p>although</p>



<a name="274172072"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Dec%20in%20repl/near/274172072" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Dec.20in.20repl.html#274172072">(Mar 04 2022 at 18:44)</a>:</h4>
<p>maybe not</p>



<a name="274172128"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Dec%20in%20repl/near/274172128" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Dec.20in.20repl.html#274172128">(Mar 04 2022 at 18:45)</a>:</h4>
<p>we can represent <code>1/3</code> exactly I think right? and floats cannot</p>



<a name="274172160"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Dec%20in%20repl/near/274172160" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Dec.20in.20repl.html#274172160">(Mar 04 2022 at 18:45)</a>:</h4>
<p>so converting via float could introduce weird <code>.000000001</code> problems</p>



<a name="274172696"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Dec%20in%20repl/near/274172696" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Dec.20in.20repl.html#274172696">(Mar 04 2022 at 18:49)</a>:</h4>
<p>you know what, <code>mono</code> is a dependency of <code>repl_eval</code> and it already imports <code>roc_std</code>, so adding it as a dependency has no effect whatsoever to repl_eval</p>



<a name="274172744"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Dec%20in%20repl/near/274172744" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Dec.20in.20repl.html#274172744">(Mar 04 2022 at 18:49)</a>:</h4>
<p>so making it <code>deref_dec(...) -&gt; RocDec</code> should also be just fine</p>



<a name="274173004"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Dec%20in%20repl/near/274173004" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Derek Gustafson <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Dec.20in.20repl.html#274173004">(Mar 04 2022 at 18:52)</a>:</h4>
<p>And then call <code>toStr</code> to get the representation on the stack, and env.arena.alloc to get it on the heap, right?</p>



<a name="274173542"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Dec%20in%20repl/near/274173542" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Dec.20in.20repl.html#274173542">(Mar 04 2022 at 18:57)</a>:</h4>
<p>let's see, we want to do this right. </p>
<p>1) implement std::fmt::Display for RocStr <br>
2) make a bumpalo::collections::String::with_capacity_in(max_num_of_digits)<br>
3) use <code>write!(bumaplo_string, "{}", roc_dec)</code>; it converts the RocDec to a string and pushes that result into the bumpalo string efficiently <br>
4) there's probably some <code>.into_bump_slice</code> equivalent for strings, I'll look this up</p>



<a name="274173813"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Dec%20in%20repl/near/274173813" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Dec.20in.20repl.html#274173813">(Mar 04 2022 at 18:59)</a>:</h4>
<p>step 1 is only efficient if you <code>write!</code> the individual characters to the formatter, don't create a String in there</p>



<a name="274173823"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Dec%20in%20repl/near/274173823" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Dec.20in.20repl.html#274173823">(Mar 04 2022 at 18:59)</a>:</h4>
<p>the zig implementation does something similar</p>



<a name="274173871"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Dec%20in%20repl/near/274173871" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Derek Gustafson <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Dec.20in.20repl.html#274173871">(Mar 04 2022 at 18:59)</a>:</h4>
<p>Here's what's being called for the other numbers.<br>
<a href="/user_uploads/22008/O0yJ82tO63_OpeccxJ5NyHBg/image.png">image.png</a></p>
<div class="message_inline_image"><a href="/user_uploads/22008/O0yJ82tO63_OpeccxJ5NyHBg/image.png" title="image.png"><img src="/user_uploads/22008/O0yJ82tO63_OpeccxJ5NyHBg/image.png"></a></div>



<a name="274174090"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Dec%20in%20repl/near/274174090" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Dec.20in.20repl.html#274174090">(Mar 04 2022 at 19:00)</a>:</h4>
<p>oh that's not great</p>



<a name="274174130"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Dec%20in%20repl/near/274174130" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Dec.20in.20repl.html#274174130">(Mar 04 2022 at 19:01)</a>:</h4>
<p>you can use the later steps I described to create a bumpalo string directly</p>



<a name="274174140"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Dec%20in%20repl/near/274174140" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Derek Gustafson <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Dec.20in.20repl.html#274174140">(Mar 04 2022 at 19:01)</a>:</h4>
<p>Does this mean we can punt on steps 2-4?</p>



<a name="274174354"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Dec%20in%20repl/near/274174354" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Derek Gustafson <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Dec.20in.20repl.html#274174354">(Mar 04 2022 at 19:02)</a>:</h4>
<p>Or does it mean I should rewrite that function to use bumpalo?</p>



<a name="274174610"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Dec%20in%20repl/near/274174610" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Dec.20in.20repl.html#274174610">(Mar 04 2022 at 19:04)</a>:</h4>
<p>yeah, something like</p>
<div class="codehilite"><pre><span></span><code>fn number_literal_to_ast&lt;T: std::fmt::Display&gt;(arena: &amp;Bump, num: T) -&gt; Expr&lt;&#39;_&gt; {
    let mut string = bumpalo::collections::String::with_capacity_in(64, arena);
    write!(string, &quot;{}&quot;, num).unwrap();
    Expr::Num(string.into_bump_slice())
}
</code></pre></div>



<a name="274174771"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Dec%20in%20repl/near/274174771" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Dec.20in.20repl.html#274174771">(Mar 04 2022 at 19:05)</a>:</h4>
<p>that doesn't quite work yet though, I'll do some debugging</p>



<a name="274174958"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Dec%20in%20repl/near/274174958" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Derek Gustafson <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Dec.20in.20repl.html#274174958">(Mar 04 2022 at 19:07)</a>:</h4>
<p>I'll start by getting <code>deref_dec</code> and <code>Display</code> implemented</p>



<a name="274175469"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Dec%20in%20repl/near/274175469" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Dec.20in.20repl.html#274175469">(Mar 04 2022 at 19:11)</a>:</h4>
<p>got it</p>
<div class="codehilite"><pre><span></span><code>/// This is centralized in case we want to format it differently later,
/// e.g. adding underscores for large numbers
fn number_literal_to_ast&lt;T: std::fmt::Display&gt;(arena: &amp;Bump, num: T) -&gt; Expr&lt;&#39;_&gt; {
    use std::fmt::Write;

    let mut string = bumpalo::collections::String::with_capacity_in(64, arena);
    write!(string, &quot;{}&quot;, num).unwrap();
    Expr::Num(string.into_bump_str())
}
</code></pre></div>



<a name="274176242"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Dec%20in%20repl/near/274176242" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Carroll <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Dec.20in.20repl.html#274176242">(Mar 04 2022 at 19:17)</a>:</h4>
<p>Oh yeah the original one allocates the string twice! Nice improvement.</p>



<a name="274176352"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Dec%20in%20repl/near/274176352" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Derek Gustafson <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Dec.20in.20repl.html#274176352">(Mar 04 2022 at 19:18)</a>:</h4>
<p>Do I need to worry about boxing/unboxing RocDec? Or can I just call this macro with RocDec?<br>
<a href="/user_uploads/22008/vNMUrVsOcFMwB1cYro2LmOi0/image.png">image.png</a></p>
<div class="message_inline_image"><a href="/user_uploads/22008/vNMUrVsOcFMwB1cYro2LmOi0/image.png" title="image.png"><img src="/user_uploads/22008/vNMUrVsOcFMwB1cYro2LmOi0/image.png"></a></div>



<a name="274176397"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Dec%20in%20repl/near/274176397" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Derek Gustafson <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Dec.20in.20repl.html#274176397">(Mar 04 2022 at 19:19)</a>:</h4>
<p>Well that's tiny</p>



<a name="274176424"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Dec%20in%20repl/near/274176424" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Dec.20in.20repl.html#274176424">(Mar 04 2022 at 19:19)</a>:</h4>
<p>I think the best approach is a default trait method</p>



<a name="274176541"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Dec%20in%20repl/near/274176541" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Dec.20in.20repl.html#274176541">(Mar 04 2022 at 19:20)</a>:</h4>
<div class="codehilite"><pre><span></span><code>    fn deref_dec(&amp;self, addr: usize) -&gt; RocDec {
        bits = self.deref_i128(addr)
        ...
    }
</code></pre></div>



<a name="274176551"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Dec%20in%20repl/near/274176551" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Dec.20in.20repl.html#274176551">(Mar 04 2022 at 19:20)</a>:</h4>
<p>in the definition of </p>
<div class="codehilite"><pre><span></span><code>pub trait ReplAppMemory {
</code></pre></div>



<a name="274176599"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Dec%20in%20repl/near/274176599" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Carroll <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Dec.20in.20repl.html#274176599">(Mar 04 2022 at 19:21)</a>:</h4>
<p>wouldn't we need separate methods for i128 and Dec?</p>



<a name="274176616"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Dec%20in%20repl/near/274176616" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Carroll <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Dec.20in.20repl.html#274176616">(Mar 04 2022 at 19:21)</a>:</h4>
<p>oh right sorry, that's what you wrote</p>



<a name="274176620"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Dec%20in%20repl/near/274176620" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Carroll <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Dec.20in.20repl.html#274176620">(Mar 04 2022 at 19:21)</a>:</h4>
<p>I misread</p>



<a name="274176626"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Dec%20in%20repl/near/274176626" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Dec.20in.20repl.html#274176626">(Mar 04 2022 at 19:21)</a>:</h4>
<p>yeah</p>



<a name="274176652"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Dec%20in%20repl/near/274176652" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Dec.20in.20repl.html#274176652">(Mar 04 2022 at 19:21)</a>:</h4>
<p>just, we only need to implement <code>deref_dec</code> once in this way</p>



<a name="274176707"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Dec%20in%20repl/near/274176707" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Carroll <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Dec.20in.20repl.html#274176707">(Mar 04 2022 at 19:22)</a>:</h4>
<p>Right, that's a good idea!</p>



<a name="274185729"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Dec%20in%20repl/near/274185729" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Dec.20in.20repl.html#274185729">(Mar 04 2022 at 20:40)</a>:</h4>
<p><span class="user-mention silent" data-user-id="281543">Folkert de Vries</span> <a href="#narrow/stream/316715-contributing/topic/Dec.20in.20repl/near/274172128">said</a>:</p>
<blockquote>
<p>we can represent <code>1/3</code> exactly I think right? and floats cannot</p>
</blockquote>
<p>No, but if I remember correctly, our dec is essentially a <code>x * 10^-18</code>. So anything divisible by <code>10^-18</code> is always perfectly represented. So <code>1/3</code> is still a problem.</p>



<a name="274186499"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Dec%20in%20repl/near/274186499" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Dec.20in.20repl.html#274186499">(Mar 04 2022 at 20:50)</a>:</h4>
<p>wait then what problem do decimals solve?</p>



<a name="274186530"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Dec%20in%20repl/near/274186530" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Dec.20in.20repl.html#274186530">(Mar 04 2022 at 20:50)</a>:</h4>
<p>I thought they were designed to prevent this sort of <code>0.0000000001</code> thing</p>



<a name="274187475"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Dec%20in%20repl/near/274187475" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Dec.20in.20repl.html#274187475">(Mar 04 2022 at 20:59)</a>:</h4>
<p>Representing cash and any sort of numbers divisible by 10 is the main thing.</p>



<a name="274187814"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Dec%20in%20repl/near/274187814" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Dec.20in.20repl.html#274187814">(Mar 04 2022 at 21:01)</a>:</h4>
<p>Theoretically we could have the base to make it nicer for other cases. Could make it base 60 so it gets 1/2, 1/3, 1/4, 1/5, 1/6, 1/10, 1/12. That gets most human expected fractions and still makes it work well with base 10 since it is a multiple of 10.</p>



<a name="274188042"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Dec%20in%20repl/near/274188042" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Dec.20in.20repl.html#274188042">(Mar 04 2022 at 21:03)</a>:</h4>
<p>Change the number to <code>x * 60^10</code></p>



<a name="274188344"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Dec%20in%20repl/near/274188344" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Dec.20in.20repl.html#274188344">(Mar 04 2022 at 21:07)</a>:</h4>
<p>Also, I guess it still has a slightly more reasonable third already. Would be <code>0.33333....3</code> with 18 3s. So it shouldn't have as many issues with the <code>0.000000001</code> thing.</p>



<a name="274190228"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Dec%20in%20repl/near/274190228" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Derek Gustafson <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Dec.20in.20repl.html#274190228">(Mar 04 2022 at 21:24)</a>:</h4>
<p>If I remember correctly, 0.3 isn't exactly representable in base 2.</p>



<a name="274190258"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Dec%20in%20repl/near/274190258" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Dec.20in.20repl.html#274190258">(Mar 04 2022 at 21:24)</a>:</h4>
<p>ah that must be what I'm thinking of</p>



<a name="274190621"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Dec%20in%20repl/near/274190621" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Derek Gustafson <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Dec.20in.20repl.html#274190621">(Mar 04 2022 at 21:27)</a>:</h4>
<p>If we're looking to provide nice representations for lots of fractions, we probably want it to be a fractional class, although that will be representable in Roc itself once Abilities are implemented.</p>



<a name="274191021"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Dec%20in%20repl/near/274191021" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Dec.20in.20repl.html#274191021">(Mar 04 2022 at 21:30)</a>:</h4>
<p>Ah yeah, it fixes the 0.3 case and like 0.1 + 0.9 actually equalling 1.</p>



<a name="274191041"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Dec%20in%20repl/near/274191041" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Dec.20in.20repl.html#274191041">(Mar 04 2022 at 21:31)</a>:</h4>
<p>yeah in every language that uses IEEE floats if you put 0.1 + 0.2 into the repl, it does not print 0.3 <span aria-label="sweat smile" class="emoji emoji-1f605" role="img" title="sweat smile">:sweat_smile:</span></p>



<a name="274191048"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Dec%20in%20repl/near/274191048" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Dec.20in.20repl.html#274191048">(Mar 04 2022 at 21:31)</a>:</h4>
<p>but with<code>Dec</code> in Roc it would!</p>



<a name="274191093"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Dec%20in%20repl/near/274191093" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Dec.20in.20repl.html#274191093">(Mar 04 2022 at 21:31)</a>:</h4>
<p>so it's better for currency, but is it good?</p>



<a name="274191115"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Dec%20in%20repl/near/274191115" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Dec.20in.20repl.html#274191115">(Mar 04 2022 at 21:31)</a>:</h4>
<p>when you calculate interest, it would still be inaccurate right?</p>



<a name="274191228"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Dec%20in%20repl/near/274191228" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Dec.20in.20repl.html#274191228">(Mar 04 2022 at 21:32)</a>:</h4>
<p>(and potentially accumulating the errors to a point where they matter)</p>



<a name="274191331"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Dec%20in%20repl/near/274191331" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Dec.20in.20repl.html#274191331">(Mar 04 2022 at 21:33)</a>:</h4>
<p>I remember asking some people about this</p>



<a name="274191529"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Dec%20in%20repl/near/274191529" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Dec.20in.20repl.html#274191529">(Mar 04 2022 at 21:35)</a>:</h4>
<p>I forget exactly who told me this, but it's something like "nobody in finance uses fixed-point decimal with more than 6 decimal places, and one time we had a client ask for 8 or 9 and it was the most absurd thing, everyone was laughing about it"</p>



<a name="274191539"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Dec%20in%20repl/near/274191539" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Carroll <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Dec.20in.20repl.html#274191539">(Mar 04 2022 at 21:35)</a>:</h4>
<p>depends what inaccurate is. If everyone accepts that interest is always compounded at a certain time interval and rounded off then it's ok</p>



<a name="274191545"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Dec%20in%20repl/near/274191545" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Dec.20in.20repl.html#274191545">(Mar 04 2022 at 21:35)</a>:</h4>
<p>and <code>Dec</code> has 18 decimal places, so...seems like we're ok? <span aria-label="sweat smile" class="emoji emoji-1f605" role="img" title="sweat smile">:sweat_smile:</span></p>



<a name="274191658"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Dec%20in%20repl/near/274191658" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Dec.20in.20repl.html#274191658">(Mar 04 2022 at 21:36)</a>:</h4>
<p>SQL Server has a fixed-point decimal type where you can configure the number of decimal places, and the common advice there is to always use 4</p>



<a name="274191898"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Dec%20in%20repl/near/274191898" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Dec.20in.20repl.html#274191898">(Mar 04 2022 at 21:38)</a>:</h4>
<p>I remember asking around for various use cases and nobody I talked to had any use cases they knew of where 18 decimal places wouldn't suffice</p>



<a name="274191946"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Dec%20in%20repl/near/274191946" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Dec.20in.20repl.html#274191946">(Mar 04 2022 at 21:39)</a>:</h4>
<p>(unless of course you're doing arbitrary fractions like 1/3, in which case yeah - probably want a different datatype altogether for that!)</p>



<a name="274192290"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Dec%20in%20repl/near/274192290" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Dec.20in.20repl.html#274192290">(Mar 04 2022 at 21:41)</a>:</h4>
<p>basically the goal with <code>Dec</code> is to have a better default than <code>F32</code> or <code>F64</code>, which actually works the way people expect it to in terms of decimal math</p>



<a name="274192317"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Dec%20in%20repl/near/274192317" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Dec.20in.20repl.html#274192317">(Mar 04 2022 at 21:41)</a>:</h4>
<p>as opposed to all the weird footguns of floating-point math, currency or otherwise</p>



<a name="274192401"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Dec%20in%20repl/near/274192401" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Dec.20in.20repl.html#274192401">(Mar 04 2022 at 21:42)</a>:</h4>
<p>and still having reasoanble, if not ideal, performance</p>



<a name="274192461"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Dec%20in%20repl/near/274192461" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Dec.20in.20repl.html#274192461">(Mar 04 2022 at 21:42)</a>:</h4>
<p>while still of course having <code>F32</code> and <code>F64</code> as opt-in higher-performance alternatives if you care more about math operation performance than about precision (e.g. for graphics coordinates)</p>



<a name="274193702"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Dec%20in%20repl/near/274193702" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Derek Gustafson <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Dec.20in.20repl.html#274193702">(Mar 04 2022 at 21:55)</a>:</h4>
<p><span class="user-mention" data-user-id="431893">@Brian Carroll</span> It's fairly common to quote daily compounding, and actually use continuous compounding, which adds even more inaccuracies.</p>



<a name="274193888"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Dec%20in%20repl/near/274193888" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Derek Gustafson <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Dec.20in.20repl.html#274193888">(Mar 04 2022 at 21:56)</a>:</h4>
<p>I've managed to get myself confused in the RocDec implementation.</p>
<div class="codehilite"><pre><span></span><code>#[derive(Copy, Clone, PartialEq, Eq, Hash, Debug)]
pub struct RocDec(pub i128);
</code></pre></div>
<p>That i128 is never named. How can I reference it?</p>



<a name="274193926"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Dec%20in%20repl/near/274193926" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Dec.20in.20repl.html#274193926">(Mar 04 2022 at 21:57)</a>:</h4>
<p><code>roc_dec_value.0</code></p>



<a name="274194022"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Dec%20in%20repl/near/274194022" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Dec.20in.20repl.html#274194022">(Mar 04 2022 at 21:58)</a>:</h4>
<p>btw if anyone wants to do a bachelors/masters thesis on the Dec type, its implementation (e.g. we'll also need <code>sin</code> and <code>sqrt</code> ect) and its accuracy tradeoffs, that would be very cool</p>



<a name="274194023"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Dec%20in%20repl/near/274194023" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Derek Gustafson <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Dec.20in.20repl.html#274194023">(Mar 04 2022 at 21:58)</a>:</h4>
<p><span aria-label="+1" class="emoji emoji-1f44d" role="img" title="+1">:+1:</span></p>



<a name="274194078"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Dec%20in%20repl/near/274194078" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Dec.20in.20repl.html#274194078">(Mar 04 2022 at 21:58)</a>:</h4>
<p>oh also speed because we do integer arithmetic but it's more operations than the equivalent float operation that happens in hardware</p>



<a name="274194113"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Dec%20in%20repl/near/274194113" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Dec.20in.20repl.html#274194113">(Mar 04 2022 at 21:59)</a>:</h4>
<p>cc <span class="user-mention" data-user-id="483118">@Samuel Dubovec</span></p>



<a name="274194153"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Dec%20in%20repl/near/274194153" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Dec.20in.20repl.html#274194153">(Mar 04 2022 at 21:59)</a>:</h4>
<p>btw <span class="user-mention" data-user-id="483003">@Derek Gustafson</span> was that field already <code>pub</code>? that seems suspicious</p>



<a name="274194218"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Dec%20in%20repl/near/274194218" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Derek Gustafson <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Dec.20in.20repl.html#274194218">(Mar 04 2022 at 22:00)</a>:</h4>
<p>Yup, already pub</p>



<a name="274194268"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Dec%20in%20repl/near/274194268" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Dec.20in.20repl.html#274194268">(Mar 04 2022 at 22:00)</a>:</h4>
<p>does anything bad happen when you remove it?</p>



<a name="274194334"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Dec%20in%20repl/near/274194334" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Derek Gustafson <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Dec.20in.20repl.html#274194334">(Mar 04 2022 at 22:00)</a>:</h4>
<p>I'll give it a try and let you know</p>



<a name="274194362"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Dec%20in%20repl/near/274194362" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Dec.20in.20repl.html#274194362">(Mar 04 2022 at 22:00)</a>:</h4>
<p>I guess we want to construct from an <code>i128</code> sometimes</p>



<a name="274194382"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Dec%20in%20repl/near/274194382" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Dec.20in.20repl.html#274194382">(Mar 04 2022 at 22:01)</a>:</h4>
<p>but we could add <code>from_le_bytes</code></p>



<a name="274194435"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Dec%20in%20repl/near/274194435" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Derek Gustafson <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Dec.20in.20repl.html#274194435">(Mar 04 2022 at 22:01)</a>:</h4>
<p>Since I'm not interested in writing about the Dec implementation, should I leave it alone once I'm done with this feature?</p>



<a name="274194528"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Dec%20in%20repl/near/274194528" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Derek Gustafson <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Dec.20in.20repl.html#274194528">(Mar 04 2022 at 22:02)</a>:</h4>
<p>And, speed wise, Dec should be comparable to f64, if there is a fpu available</p>



<a name="274195040"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Dec%20in%20repl/near/274195040" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Dec.20in.20repl.html#274195040">(Mar 04 2022 at 22:06)</a>:</h4>
<p>not for more specialized operations right? like <code>sqrt</code> or <code>sin</code>?</p>



<a name="274195072"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Dec%20in%20repl/near/274195072" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Dec.20in.20repl.html#274195072">(Mar 04 2022 at 22:07)</a>:</h4>
<p>at least I thought those might by "in silicon"</p>



<a name="274195197"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Dec%20in%20repl/near/274195197" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Dec.20in.20repl.html#274195197">(Mar 04 2022 at 22:08)</a>:</h4>
<p>and no if the material interests you go ahead with implementing. Don't want to block on the chance that someone comes along to do a thesis, but if it works out that way then it would be cool</p>



<a name="274195270"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Dec%20in%20repl/near/274195270" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Derek Gustafson <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Dec.20in.20repl.html#274195270">(Mar 04 2022 at 22:09)</a>:</h4>
<p>It's been a decade since I've worked on that sort of stuff. You're probably right that those are hardware instructions on the fpu, and we'd be implementing in software</p>



<a name="274197922"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Dec%20in%20repl/near/274197922" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Dec.20in.20repl.html#274197922">(Mar 04 2022 at 22:36)</a>:</h4>
<p>If I remember, I think one operation is already slower than F64. I believe it was multiplication because it requires more expensive normalization.</p>



<a name="274198157"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Dec%20in%20repl/near/274198157" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Derek Gustafson <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Dec.20in.20repl.html#274198157">(Mar 04 2022 at 22:39)</a>:</h4>
<p>Probably. The work I was doing was fixed point base 2 arithmatic, so we got the renormalization shr, which is really fast.</p>



<a name="274198325"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Dec%20in%20repl/near/274198325" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Dec.20in.20repl.html#274198325">(Mar 04 2022 at 22:40)</a>:</h4>
<p>from way back when we originally talked about this:</p>
<p><a href="/user_uploads/22008/HMuEPX-j2WLnE6BvgqHnOd_5/Screen-Shot-2022-03-04-at-5.39.23-PM.png">Screen-Shot-2022-03-04-at-5.39.23-PM.png</a> <a href="/user_uploads/22008/tJqr29h0zxToG7G5MI2Ng_pH/Screen-Shot-2022-03-04-at-5.39.38-PM.png">Screen-Shot-2022-03-04-at-5.39.38-PM.png</a></p>
<div class="message_inline_image"><a href="/user_uploads/22008/HMuEPX-j2WLnE6BvgqHnOd_5/Screen-Shot-2022-03-04-at-5.39.23-PM.png" title="Screen-Shot-2022-03-04-at-5.39.23-PM.png"><img src="/user_uploads/22008/HMuEPX-j2WLnE6BvgqHnOd_5/Screen-Shot-2022-03-04-at-5.39.23-PM.png"></a></div><div class="message_inline_image"><a href="/user_uploads/22008/tJqr29h0zxToG7G5MI2Ng_pH/Screen-Shot-2022-03-04-at-5.39.38-PM.png" title="Screen-Shot-2022-03-04-at-5.39.38-PM.png"><img src="/user_uploads/22008/tJqr29h0zxToG7G5MI2Ng_pH/Screen-Shot-2022-03-04-at-5.39.38-PM.png"></a></div>



<a name="274200717"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Dec%20in%20repl/near/274200717" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Derek Gustafson <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Dec.20in.20repl.html#274200717">(Mar 04 2022 at 23:04)</a>:</h4>
<p><span class="user-mention" data-user-id="281543">@Folkert de Vries</span> Removing <code>pub</code> from <code>RocDec.0</code> causes  compilation to fail in mono with 4 errors. I expect they're fixable using traits that are already defined on RocDec, but one problem at a time. I'll make an issue so it doesn't get lost.</p>



<a name="274205819"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Dec%20in%20repl/near/274205819" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Derek Gustafson <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Dec.20in.20repl.html#274205819">(Mar 05 2022 at 00:05)</a>:</h4>
<p>Do we have a safe mode vs release mode implemented?</p>



<a name="274206768"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Dec%20in%20repl/near/274206768" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Dec.20in.20repl.html#274206768">(Mar 05 2022 at 00:21)</a>:</h4>
<p>there's multiple levels to this</p>



<a name="274206822"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Dec%20in%20repl/near/274206822" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Dec.20in.20repl.html#274206822">(Mar 05 2022 at 00:22)</a>:</h4>
<p>so, we can build our compiler with <code>--release</code>, which instructs the rust compiler to perform more optimizations</p>



<a name="274206832"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Dec%20in%20repl/near/274206832" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Dec.20in.20repl.html#274206832">(Mar 05 2022 at 00:22)</a>:</h4>
<p>but, we can also make our compiler turn Roc code into more optimal code</p>



<a name="274206837"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Dec%20in%20repl/near/274206837" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Dec.20in.20repl.html#274206837">(Mar 05 2022 at 00:22)</a>:</h4>
<p>with the <code>--optimize</code> flag</p>



<a name="274206868"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Dec%20in%20repl/near/274206868" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Dec.20in.20repl.html#274206868">(Mar 05 2022 at 00:22)</a>:</h4>
<p>optimizations are always safe btw</p>



<a name="274206874"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Dec%20in%20repl/near/274206874" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Dec.20in.20repl.html#274206874">(Mar 05 2022 at 00:23)</a>:</h4>
<p>so <code>--release</code> is for <code>cargo</code>, and makes the <code>roc</code> executable run faster</p>



<a name="274206887"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Dec%20in%20repl/near/274206887" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Dec.20in.20repl.html#274206887">(Mar 05 2022 at 00:23)</a>:</h4>
<p>and <code>--optimize</code> is an argument you pass to the <code>roc</code> executable to make the compiled roc code go faster</p>



<a name="274206900"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Dec%20in%20repl/near/274206900" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Dec.20in.20repl.html#274206900">(Mar 05 2022 at 00:23)</a>:</h4>
<p>yeah, that <span aria-label="point up" class="emoji emoji-1f446" role="img" title="point up">:point_up:</span> <span aria-label="big smile" class="emoji emoji-1f604" role="img" title="big smile">:big_smile:</span></p>



<a name="274206984"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Dec%20in%20repl/near/274206984" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Dec.20in.20repl.html#274206984">(Mar 05 2022 at 00:24)</a>:</h4>
<p>e.g. <code>cargo run -- --optimize --debug examples/benchmarks/Deriv.roc</code></p>



<a name="274206992"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Dec%20in%20repl/near/274206992" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Dec.20in.20repl.html#274206992">(Mar 05 2022 at 00:24)</a>:</h4>
<p>here <code>--debug</code> make the roc compiler emit the LLVM bytecode to a file</p>



<a name="274207015"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Dec%20in%20repl/near/274207015" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Dec.20in.20repl.html#274207015">(Mar 05 2022 at 00:25)</a>:</h4>
<p>you will need an extra tool for that though, using that flag should panic with a link to instructions on how to do that</p>



<a name="274207534"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Dec%20in%20repl/near/274207534" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Derek Gustafson <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Dec.20in.20repl.html#274207534">(Mar 05 2022 at 00:33)</a>:</h4>
<p>So,  I'm going to be calling <code>str.from_utf8</code> which returns a <code>Result</code>. The compiler is building the string from the i128, so if we've done our job right, it should always succeed. It's nice to have that check while we're building the compiler, so we know it failed, but in a release mode, we should probably call <code>str.from_utf8unsafe</code> and skip the check that it's a valid codepoint</p>



<a name="274207550"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Dec%20in%20repl/near/274207550" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Dec.20in.20repl.html#274207550">(Mar 05 2022 at 00:33)</a>:</h4>
<p>oh we just use unsafe in those cases</p>



<a name="274207559"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Dec%20in%20repl/near/274207559" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Dec.20in.20repl.html#274207559">(Mar 05 2022 at 00:34)</a>:</h4>
<p>it makes sense here; we have to trust ourselves</p>



<a name="274207600"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Dec%20in%20repl/near/274207600" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Dec.20in.20repl.html#274207600">(Mar 05 2022 at 00:34)</a>:</h4>
<p>and we add tests ect but we choose speed in this sort of scenario</p>



<a name="274207633"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Dec%20in%20repl/near/274207633" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Derek Gustafson <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Dec.20in.20repl.html#274207633">(Mar 05 2022 at 00:35)</a>:</h4>
<p>Okay. I'm used to C where the preprocessor can switch between those choices at compile time</p>



<a name="274207946"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Dec%20in%20repl/near/274207946" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Dec.20in.20repl.html#274207946">(Mar 05 2022 at 00:40)</a>:</h4>
<p>I'm sure you can, but <span aria-label="shrug" class="emoji emoji-1f937" role="img" title="shrug">:shrug:</span></p>



<a name="274207977"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Dec%20in%20repl/near/274207977" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Dec.20in.20repl.html#274207977">(Mar 05 2022 at 00:41)</a>:</h4>
<p>To be fair, you can do that in rust as well. Just have to use <code>cfg</code></p>



<a name="274207996"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Dec%20in%20repl/near/274207996" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Dec.20in.20repl.html#274207996">(Mar 05 2022 at 00:41)</a>:</h4>
<p>Generally though, I don't think that would add much value.</p>



<a name="274235376"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Dec%20in%20repl/near/274235376" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Carroll <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Dec.20in.20repl.html#274235376">(Mar 05 2022 at 10:36)</a>:</h4>
<p>Yeah part of the explanation here is in the way a compiler is structured. It's really only the parser that needs to handle invalid UTF8. If the user input doesn't make it past the parser, then none of the other stages need to worry about it.</p>



<a name="274248990"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Dec%20in%20repl/near/274248990" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Derek Gustafson <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Dec.20in.20repl.html#274248990">(Mar 05 2022 at 15:23)</a>:</h4>
<p>What's the format for <code>1: Dec</code>? I can think of 3 reasonable answers<br>
1)  <code>1</code><br>
2)  <code>1.</code><br>
3)  <code>1.0</code></p>



<a name="274249201"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Dec%20in%20repl/near/274249201" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Carroll <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Dec.20in.20repl.html#274249201">(Mar 05 2022 at 15:26)</a>:</h4>
<p>I suppose whatever we do for <code>1: F64</code> this should be the same?</p>



<a name="274249809"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Dec%20in%20repl/near/274249809" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Derek Gustafson <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Dec.20in.20repl.html#274249809">(Mar 05 2022 at 15:38)</a>:</h4>
<p>That would be option 1)</p>



<a name="274249911"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Dec%20in%20repl/near/274249911" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ayaz Hafiz <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Dec.20in.20repl.html#274249911">(Mar 05 2022 at 15:41)</a>:</h4>
<p>I think 1) is good for now, unlike other languages (at least today) a float literal can be inferred without having to have a decimal point after it.</p>



<a name="274271876"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Dec%20in%20repl/near/274271876" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Derek Gustafson <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Dec.20in.20repl.html#274271876">(Mar 05 2022 at 23:31)</a>:</h4>
<p>Pushed my RocDec fix and I'm getting a number of failing tests regarding recognizing records with a single <code>Num *</code> in them as <code>Num *</code>.<br>
The error is in the function <code>num_to_ast</code> in <code>repl_eval/src/eval.rs</code>, but I don't understand <code>Content</code> well enough to understand what's going on.<br>
Anyone have a suggestion of what could be going on, and where I should look?</p>



<a name="274272049"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Dec%20in%20repl/near/274272049" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Dec.20in.20repl.html#274272049">(Mar 05 2022 at 23:35)</a>:</h4>
<p>if you just want to peek at what is in a <code>Content</code>, then <code>dbg!(roc_types::subs::SubsFmtContent(content, subs))</code> works</p>



<a name="274272422"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Dec%20in%20repl/near/274272422" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Dec.20in.20repl.html#274272422">(Mar 05 2022 at 23:44)</a>:</h4>
<p>hmm I can reproduce the problem locally and it's odd that your changes would cause this issue</p>



<a name="274272512"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Dec%20in%20repl/near/274272512" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Dec.20in.20repl.html#274272512">(Mar 05 2022 at 23:47)</a>:</h4>
<p>got it, in <code>eval.rs</code>, change this snippet to</p>
<div class="codehilite"><pre><span></span><code>    let (newtype_containers, content) = unroll_newtypes(env, content);
    let content = unroll_aliases(env, content);

    macro_rules! helper {
        ($ty:ty) =&gt; {
            app.call_function(main_fn_name, |_, num: $ty| {
                num_to_ast(env, number_literal_to_ast(env.arena, num), content)
            })
        };
    }
</code></pre></div>



<a name="274272513"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Dec%20in%20repl/near/274272513" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ayaz Hafiz <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Dec.20in.20repl.html#274272513">(Mar 05 2022 at 23:47)</a>:</h4>
<p>I think the moving of <code>helper</code> up to line 281 may be causing the problem, as it seems to be capturing <code>content</code> before unrolling</p>



<a name="274272514"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Dec%20in%20repl/near/274272514" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Dec.20in.20repl.html#274272514">(Mar 05 2022 at 23:47)</a>:</h4>
<p>crucially, <code>content</code> must be defined before the macro</p>



<a name="274272557"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Dec%20in%20repl/near/274272557" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Dec.20in.20repl.html#274272557">(Mar 05 2022 at 23:48)</a>:</h4>
<p>yes, exactly</p>



<a name="274272558"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Dec%20in%20repl/near/274272558" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ayaz Hafiz <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Dec.20in.20repl.html#274272558">(Mar 05 2022 at 23:48)</a>:</h4>
<p>What Folkert said :)</p>



<a name="274272559"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Dec%20in%20repl/near/274272559" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Derek Gustafson <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Dec.20in.20repl.html#274272559">(Mar 05 2022 at 23:48)</a>:</h4>
<p>I assumed that my changes exposed an unhandled case of RocDec</p>



<a name="274272567"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Dec%20in%20repl/near/274272567" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Dec.20in.20repl.html#274272567">(Mar 05 2022 at 23:48)</a>:</h4>
<p>no this is why shadowing is not allowed in roc</p>



<a name="274272572"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Dec%20in%20repl/near/274272572" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Dec.20in.20repl.html#274272572">(Mar 05 2022 at 23:48)</a>:</h4>
<p>but it's so convenient sometimes ...</p>



<a name="274272584"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Dec%20in%20repl/near/274272584" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Dec.20in.20repl.html#274272584">(Mar 05 2022 at 23:49)</a>:</h4>
<p>but yeah you have to be careful when moving macros that they capture the same things</p>



<a name="274272587"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Dec%20in%20repl/near/274272587" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Derek Gustafson <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Dec.20in.20repl.html#274272587">(Mar 05 2022 at 23:49)</a>:</h4>
<p>Should I revert that change, or rename something</p>



<a name="274272590"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Dec%20in%20repl/near/274272590" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Dec.20in.20repl.html#274272590">(Mar 05 2022 at 23:49)</a>:</h4>
<p>no just swap the lines around</p>



<a name="274272595"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Dec%20in%20repl/near/274272595" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Dec.20in.20repl.html#274272595">(Mar 05 2022 at 23:49)</a>:</h4>
<p>like in the snippet I posted</p>



<a name="274272598"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Dec%20in%20repl/near/274272598" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Derek Gustafson <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Dec.20in.20repl.html#274272598">(Mar 05 2022 at 23:50)</a>:</h4>
<p>Okay. Will do when I get home</p>



<a name="274272644"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Dec%20in%20repl/near/274272644" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Dec.20in.20repl.html#274272644">(Mar 05 2022 at 23:50)</a>:</h4>
<p>I'll just push that change then, got it already</p>



<a name="274272672"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Dec%20in%20repl/near/274272672" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Dec.20in.20repl.html#274272672">(Mar 05 2022 at 23:51)</a>:</h4>
<p>repl tests all succeed at least</p>



<hr><p>Last updated: Mar 01 2026 at 12:20 UTC</p>
</html>