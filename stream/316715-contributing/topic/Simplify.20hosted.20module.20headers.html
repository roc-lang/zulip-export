<html>
<head><meta charset="utf-8"><title>Simplify hosted module headers · contributing · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/index.html">contributing</a></h2>
<h3>Topic: <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Simplify.20hosted.20module.20headers.html">Simplify hosted module headers</a></h3>

<hr>

<base href="https://roc.zulipchat.com">

<head><link href="https://roc-lang.github.io/zulip-export/style.css" rel="stylesheet"></head>

<a name="492246989"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Simplify%20hosted%20module%20headers/near/492246989" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Simplify.20hosted.20module.20headers.html#492246989">(Jan 07 2025 at 05:40)</a>:</h4>
<p>We have simplified the syntax for app modules and interface modules, but we didn't get to the other module types yet. Currently the hosted module header is</p>
<div class="codehilite" data-code-language="Elm"><pre><span></span><code><span class="nv">hosted</span><span class="w"> </span><span class="kt">Host</span>
<span class="w">    </span><span class="nv">exposes</span><span class="w"> </span><span class="p">[</span><span class="nf">...</span><span class="p">]</span><span class="w"> </span><span class="nv">imports</span><span class="w"> </span><span class="p">[</span><span class="nf">...</span><span class="p">]</span>
</code></pre></div>
<p>In the style of interface modules, we should move to</p>
<div class="codehilite" data-code-language="Elm"><pre><span></span><code><span class="nv">hosted</span><span class="w"> </span><span class="p">[</span><span class="nf">...</span><span class="p">]</span>
</code></pre></div>
<p>where the [...] is the "exposes" list, and we use import statements like every other module type</p>



<a name="492247139"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Simplify%20hosted%20module%20headers/near/492247139" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Simplify.20hosted.20module.20headers.html#492247139">(Jan 07 2025 at 05:42)</a>:</h4>
<p>We will have updated every module header except for platform modules, and I'm not sure how to reduce those</p>



<a name="492247177"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Simplify%20hosted%20module%20headers/near/492247177" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Simplify.20hosted.20module.20headers.html#492247177">(Jan 07 2025 at 05:42)</a>:</h4>
<div class="codehilite" data-code-language="Elm"><pre><span></span><code><span class="nv">platform</span><span class="w"> </span><span class="s">"cli"</span>
<span class="w">    </span><span class="nv">requires</span><span class="w"> </span><span class="p">{}</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nv">main</span><span class="err">!</span><span class="w"> </span><span class="nf">:</span><span class="w"> </span><span class="kt">List</span><span class="w"> </span><span class="kt">Arg</span><span class="nf">.</span><span class="kt">Arg</span><span class="w"> </span><span class="nf">=&gt;</span><span class="w"> </span><span class="kt">Result</span><span class="w"> </span><span class="p">{}</span><span class="w"> </span><span class="p">[</span><span class="kt">Exit</span><span class="w"> </span><span class="kt">I32</span><span class="w"> </span><span class="kt">Str</span><span class="p">]</span><span class="nv">_</span><span class="w"> </span><span class="p">}</span>
<span class="w">    </span><span class="nv">exposes</span><span class="w"> </span><span class="p">[</span><span class="nf">...</span><span class="p">]</span>
<span class="w">    </span><span class="nv">packages</span><span class="w"> </span><span class="p">{}</span>
<span class="w">    </span><span class="nv">imports</span><span class="w"> </span><span class="p">[]</span>
<span class="w">    </span><span class="nv">provides</span><span class="w"> </span><span class="p">[</span><span class="nv">main_for_host</span><span class="err">!</span><span class="p">]</span>
</code></pre></div>



<a name="492247188"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Simplify%20hosted%20module%20headers/near/492247188" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Simplify.20hosted.20module.20headers.html#492247188">(Jan 07 2025 at 05:43)</a>:</h4>
<p>This is the current one for <code>basic-cli</code> with the exposes section elided</p>



<a name="492247301"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Simplify%20hosted%20module%20headers/near/492247301" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Simplify.20hosted.20module.20headers.html#492247301">(Jan 07 2025 at 05:45)</a>:</h4>
<p>We can remove the "cli" name, remove "imports" in favor of import statements, and combine the two "requires" sections, but it seems not reducible after that</p>



<a name="492247332"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Simplify%20hosted%20module%20headers/near/492247332" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Simplify.20hosted.20module.20headers.html#492247332">(Jan 07 2025 at 05:45)</a>:</h4>
<div class="codehilite" data-code-language="Elm"><pre><span></span><code><span class="nv">platform</span>
<span class="w">    </span><span class="nv">requires</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nv">main</span><span class="err">!</span><span class="w"> </span><span class="nf">:</span><span class="w"> </span><span class="kt">List</span><span class="w"> </span><span class="kt">Arg</span><span class="nf">.</span><span class="kt">Arg</span><span class="w"> </span><span class="nf">=&gt;</span><span class="w"> </span><span class="kt">Result</span><span class="w"> </span><span class="p">{}</span><span class="w"> </span><span class="p">[</span><span class="kt">Exit</span><span class="w"> </span><span class="kt">I32</span><span class="w"> </span><span class="kt">Str</span><span class="p">]</span><span class="nv">_</span><span class="w"> </span><span class="p">}</span>
<span class="w">    </span><span class="nv">exposes</span><span class="w"> </span><span class="p">[</span><span class="nf">...</span><span class="p">]</span>
<span class="w">    </span><span class="nv">packages</span><span class="w"> </span><span class="p">{}</span>
<span class="w">    </span><span class="nv">provides</span><span class="w"> </span><span class="p">[</span><span class="nv">main_for_host</span><span class="err">!</span><span class="p">]</span>
</code></pre></div>



<a name="492247349"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Simplify%20hosted%20module%20headers/near/492247349" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Simplify.20hosted.20module.20headers.html#492247349">(Jan 07 2025 at 05:45)</a>:</h4>
<p>I think removing the words would just get confusing, but maybe there's something I'm missing</p>



<a name="492247440"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Simplify%20hosted%20module%20headers/near/492247440" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Simplify.20hosted.20module.20headers.html#492247440">(Jan 07 2025 at 05:47)</a>:</h4>
<p>The one other option I can consider for that one is to put everything in a single record for visual consistency with all other module types only having one or two sets of fields:</p>
<div class="codehilite" data-code-language="Elm"><pre><span></span><code><span class="nv">platform</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nv">requires</span><span class="nf">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nv">main</span><span class="err">!</span><span class="w"> </span><span class="nf">:</span><span class="w"> </span><span class="kt">List</span><span class="w"> </span><span class="kt">Arg</span><span class="nf">.</span><span class="kt">Arg</span><span class="w"> </span><span class="nf">=&gt;</span><span class="w"> </span><span class="kt">Result</span><span class="w"> </span><span class="p">{}</span><span class="w"> </span><span class="p">[</span><span class="kt">Exit</span><span class="w"> </span><span class="kt">I32</span><span class="w"> </span><span class="kt">Str</span><span class="p">]</span><span class="nv">_</span><span class="w"> </span><span class="p">},</span>
<span class="w">    </span><span class="nv">exposes</span><span class="nf">:</span><span class="w"> </span><span class="p">[</span><span class="nf">...</span><span class="p">],</span>
<span class="w">    </span><span class="nv">packages</span><span class="nf">:</span><span class="w"> </span><span class="p">{},</span>
<span class="w">    </span><span class="nv">provides</span><span class="nf">:</span><span class="w"> </span><span class="p">[</span><span class="nv">main_for_host</span><span class="err">!</span><span class="p">]</span>
<span class="p">}</span>
</code></pre></div>



<a name="492247459"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Simplify%20hosted%20module%20headers/near/492247459" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Simplify.20hosted.20module.20headers.html#492247459">(Jan 07 2025 at 05:47)</a>:</h4>
<p>Thoughts?</p>



<a name="492257611"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Simplify%20hosted%20module%20headers/near/492257611" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Oskar Hahn <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Simplify.20hosted.20module.20headers.html#492257611">(Jan 07 2025 at 07:46)</a>:</h4>
<p>When you are changing this both headers, could you consider the problem, that it is not possible to import the <code>requires</code> symbols in any other module of the platform. Especially not in the hosted module. One consequence is, that it is impossible to have effects that have a <code>Model</code>as argument or return type.</p>
<p>For example, it is impossible for an platform to implement an STM as discussed in <a href="#narrow/channel/304641-ideas/topic/STM.20.28software.20transactional.20memory.29.20builtin">this thread</a>. It would need effects like<br>
<code>get_model_for_reading! : {} =&gt; Model</code> or <code>do_stuff_with_Model! : (Model =&gt; a) =&gt; a</code>. But currently, it is impossible for the hosted module to import the Model-symbol.</p>
<p>So my question is, could/should the hosted module header also have something like an <code>requires</code> argument? Or should the <code>requires</code> feature be redesigned in a way, that solves that problem? (and therefore would need a different header)</p>



<a name="492262286"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Simplify%20hosted%20module%20headers/near/492262286" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Simplify.20hosted.20module.20headers.html#492262286">(Jan 07 2025 at 08:22)</a>:</h4>
<p>I can understand wanting there to be platform functions that can access the <code>requires</code> types, but I don't think it's viable for the hosted module to send <code>Model</code> to the host.</p>



<a name="492262377"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Simplify%20hosted%20module%20headers/near/492262377" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Simplify.20hosted.20module.20headers.html#492262377">(Jan 07 2025 at 08:23)</a>:</h4>
<p>FFI needs to send/receive statically-sized types, and Model changes depending on the user's code outside of the platform</p>



<a name="492262555"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Simplify%20hosted%20module%20headers/near/492262555" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Simplify.20hosted.20module.20headers.html#492262555">(Jan 07 2025 at 08:24)</a>:</h4>
<p>Currently, we compile the platform before even sending it to the user as a code archive via GH releases, so there's not a performant way to make a dynamically-sized value available to the host</p>



<a name="492262866"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Simplify%20hosted%20module%20headers/near/492262866" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Simplify.20hosted.20module.20headers.html#492262866">(Jan 07 2025 at 08:26)</a>:</h4>
<p>That said, we <em>could</em> make it available but not allow sending it over the FFI boundary, instead requiring the platform to serialize/deserialize to and from <code>List U8</code></p>



<a name="492262938"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Simplify%20hosted%20module%20headers/near/492262938" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Simplify.20hosted.20module.20headers.html#492262938">(Jan 07 2025 at 08:27)</a>:</h4>
<p>But then we're promoting low-perf behavior, right?</p>



<a name="492262982"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Simplify%20hosted%20module%20headers/near/492262982" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Simplify.20hosted.20module.20headers.html#492262982">(Jan 07 2025 at 08:27)</a>:</h4>
<p>Would love to hear a lower-level expertised opinion on this</p>



<a name="492269744"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Simplify%20hosted%20module%20headers/near/492269744" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Oskar Hahn <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Simplify.20hosted.20module.20headers.html#492269744">(Jan 07 2025 at 09:12)</a>:</h4>
<p>To send a <code>Model</code> to the host, you have to box it. Its the same thing  you have to do, when you use the <code>Model</code> in the exported functions. So an effect would actually look like <code>get_model_with_lock : {} =&gt; Box Model</code> and afterwords there could be another effect like <code>release_lock : [Commit (Box Model), Rollback] =&gt; {}</code> . In this example, the host would not need to do anything with the Model, just return the pointer. And the Roc part of the platform could provide a function like <code>call_with_model : (Model -&gt; a) =&gt; a</code> that internally calls this both functions. But this function would also need access the the <code>requires</code> part from the header.</p>
<p>(I think I highjacked your topic.  If you think, that my posts are off topic, you could move them.)</p>



<a name="492271074"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Simplify%20hosted%20module%20headers/near/492271074" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Simplify.20hosted.20module.20headers.html#492271074">(Jan 07 2025 at 09:20)</a>:</h4>
<p>Nah, they're on topic enough. I don't expect much resistance to aligning the format of the <code>hosted</code> module header to the standard <code>module</code> header, and this discussion could help us align the <code>hosted</code> and <code>platform</code> headers</p>



<a name="492271548"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Simplify%20hosted%20module%20headers/near/492271548" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Simplify.20hosted.20module.20headers.html#492271548">(Jan 07 2025 at 09:23)</a>:</h4>
<p>So anyway, the <code>Box</code> approach makes sense, thanks for outlining that to me.</p>



<a name="492272115"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Simplify%20hosted%20module%20headers/near/492272115" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Simplify.20hosted.20module.20headers.html#492272115">(Jan 07 2025 at 09:26)</a>:</h4>
<p>I believe there was recent discussion surrounding the desire for type variables in <code>requires</code> types, but we can't do it if we want all types used in the program to be concrete for runtime</p>



<a name="492272184"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Simplify%20hosted%20module%20headers/near/492272184" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Simplify.20hosted.20module.20headers.html#492272184">(Jan 07 2025 at 09:27)</a>:</h4>
<p>As long as <code>requires</code> types like <code>Model</code> need to be concrete, then what you're suggesting makes sense</p>



<a name="492272408"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Simplify%20hosted%20module%20headers/near/492272408" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Simplify.20hosted.20module.20headers.html#492272408">(Jan 07 2025 at 09:28)</a>:</h4>
<p>There was a spitball idea maybe 6-8 months ago from Richard to use modules params in the <code>platform</code> module to define the host functions, rendering the <code>hosted</code> module type redundant</p>



<a name="492272460"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Simplify%20hosted%20module%20headers/near/492272460" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Simplify.20hosted.20module.20headers.html#492272460">(Jan 07 2025 at 09:28)</a>:</h4>
<p>Since module params may be going the way of the dodo, I don't think it's wise for us to assume we'll have them long-term</p>



<a name="492273002"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Simplify%20hosted%20module%20headers/near/492273002" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Simplify.20hosted.20module.20headers.html#492273002">(Jan 07 2025 at 09:31)</a>:</h4>
<p>But something is of intrigue there: for each platform, the following things need to be done only once:</p>
<ul>
<li>request a list of <code>requires</code> types and values/functions that are passed to the host via the <code>provides</code> clause<ul>
<li>write the <code>provides</code> functions using the <code>requires</code> entities</li>
</ul>
</li>
<li>set a list of required packages (e.g. <code>roc-json</code>, <code>weaver</code>, etc.) for the platform</li>
<li>define a list of functions that are translated to FFI with the host</li>
<li>expose a list of modules for app authors to use from the platform</li>
</ul>



<a name="492273109"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Simplify%20hosted%20module%20headers/near/492273109" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Simplify.20hosted.20module.20headers.html#492273109">(Jan 07 2025 at 09:32)</a>:</h4>
<p>In theory, all of these could be done in one, big module, but that would probably lead to having a <em>really</em> big module for mature platforms</p>



<a name="492273178"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Simplify%20hosted%20module%20headers/near/492273178" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Simplify.20hosted.20module.20headers.html#492273178">(Jan 07 2025 at 09:32)</a>:</h4>
<p>Though as you point out, the current <code>hosted</code> module separation prevents platform authors from being able to access <code>requires</code> entities</p>



<a name="492273518"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Simplify%20hosted%20module%20headers/near/492273518" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Simplify.20hosted.20module.20headers.html#492273518">(Jan 07 2025 at 09:34)</a>:</h4>
<p>I think we should either:</p>
<ul>
<li>combine <code>platform</code> and <code>hosted</code> into a single module type (leads to bigger modules, but simplifies Roc a bit)</li>
<li>add the <code>requires</code> clause to <code>hosted</code> modules as well, and give errors when <code>platform</code> and <code>hosted</code> disagree on the contents of the <code>requires</code> clauses</li>
</ul>



<a name="492274047"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Simplify%20hosted%20module%20headers/near/492274047" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Oskar Hahn <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Simplify.20hosted.20module.20headers.html#492274047">(Jan 07 2025 at 09:38)</a>:</h4>
<p>There is another problem, with a combined <code>platform</code> and <code>hosted</code> modules. It is currently impossible to import stuff from it. For an platform to export something to the app, it has to be inside another module, so it can be imported with <code>import pf.Module</code>. If the exported functions would live inside the platform-module, they could not be used be an app or any other Module provided by the platform.</p>



<a name="492274066"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Simplify%20hosted%20module%20headers/near/492274066" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Simplify.20hosted.20module.20headers.html#492274066">(Jan 07 2025 at 09:38)</a>:</h4>
<p>I'd vote for the first one because it seems simpler, and I'm not convinced it'll be that much of a problem for big platforms to have everything in a single file since you tend to only have a couple functions that glue <code>requires</code> to <code>provides</code>, and the FFI definitions are only type signatures, not function bodies</p>



<a name="492274140"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Simplify%20hosted%20module%20headers/near/492274140" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Simplify.20hosted.20module.20headers.html#492274140">(Jan 07 2025 at 09:39)</a>:</h4>
<p><del>you can import <code>Stdout</code> from the <code>platform</code> module</del></p>



<a name="492274164"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Simplify%20hosted%20module%20headers/near/492274164" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Simplify.20hosted.20module.20headers.html#492274164">(Jan 07 2025 at 09:39)</a>:</h4>
<p>Oh, I see</p>



<a name="492275912"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Simplify%20hosted%20module%20headers/near/492275912" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Simplify.20hosted.20module.20headers.html#492275912">(Jan 07 2025 at 09:50)</a>:</h4>
<p>A solution we could push is to combine the two modules and require the <code>platform</code> module to be named <code>Platform.roc</code> or something like that. And then everyone can always just <code>import Platform exposing [...]</code></p>



<a name="492276688"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Simplify%20hosted%20module%20headers/near/492276688" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Oskar Hahn <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Simplify.20hosted.20module.20headers.html#492276688">(Jan 07 2025 at 09:56)</a>:</h4>
<p>Maybe the way, stuff gets passed around between the app and the platform has to be rethinked <span aria-label="grinning" class="emoji emoji-1f600" role="img" title="grinning">:grinning:</span> </p>
<p>If you do, another (off topic) issue is, how a platform-Module can define, that something is exported to the app or exported only to other modules inside the platform. In my previous example, the platform only wants to export <code>call_with_model</code>. But the hosted-module exports <code>get_model_with_lock</code> and <code>release_lock</code>. How can the platform make sure, that the app can not import this effects directly? I think, basic-cli and basic-webserver use Modules with an <code>Internal</code>-Prefix. But If I understand it correct, then an app could import the stuff from the <code>Internal</code>-Modules as well.</p>
<p>An example where this is a problem is the current version of the kingfisher platform. The <a href="https://github.com/ostcar/kingfisher/blob/d7ff00af22ba69f330a8f098b29b518d85ef0d1f/platform/Host.roc#L10">hosted module exports <code>save_event!</code></a> . But the app is only allowed to use it in a write request as defined <a href="https://github.com/ostcar/kingfisher/blob/d7ff00af22ba69f330a8f098b29b518d85ef0d1f/platform/Http.roc#L77-L80">here</a>. If an app just imports <code>pf.Host</code> and uses this functions, all guaranties of the platform are off.</p>
<p>Go solves the problem with an <a href="https://www.bytesizego.com/blog/golang-internal-package"><code>internal</code> directory</a>. Maybe Roc could forbid apps to import stuff from the <code>hosted</code> (or combined <code>hosted</code> and <code>platform</code>) module and also forbid apps import from Modules, when the Name starts with <code>Internal</code>.</p>



<a name="492277431"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Simplify%20hosted%20module%20headers/near/492277431" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Oskar Hahn <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Simplify.20hosted.20module.20headers.html#492277431">(Jan 07 2025 at 10:00)</a>:</h4>
<p><span class="user-mention silent" data-user-id="461444">Sam Mohr</span> <a href="#narrow/channel/316715-contributing/topic/Simplify.20hosted.20module.20headers/near/492275912">said</a>:</p>
<blockquote>
<p>A solution we could push is to combine the two modules and require the <code>platform</code> module to be named <code>Platform.roc</code> or something like that. And then everyone can always just <code>import Platform exposing [...]</code></p>
</blockquote>
<p>If this <code>Platform.roc</code>-Module could also export <code>Model</code> then my initial problem would be solved. And if Roc forbids apps to import stuff from the Platform-module, then I would be fully happy <span aria-label="innocent" class="emoji emoji-1f607" role="img" title="innocent">:innocent:</span></p>



<a name="492322511"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Simplify%20hosted%20module%20headers/near/492322511" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Simplify.20hosted.20module.20headers.html#492322511">(Jan 07 2025 at 14:42)</a>:</h4>
<p>Note, we should be able to pass a <code>Box a</code> to and from the host just fine. The specific problem is that we need to link the <code>a</code> from two different effects. This is currently done through requires, but it doesn't have to be.</p>



<a name="492322754"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Simplify%20hosted%20module%20headers/near/492322754" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Simplify.20hosted.20module.20headers.html#492322754">(Jan 07 2025 at 14:44)</a>:</h4>
<p>For example, it would be easier to deal with basic webserver if the <code>Model</code> as actually <code>model</code>. Then you wouldn't have to worry nexted about type variables and some of the typing conplxity</p>



<a name="492322915"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Simplify%20hosted%20module%20headers/near/492322915" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Simplify.20hosted.20module.20headers.html#492322915">(Jan 07 2025 at 14:45)</a>:</h4>
<p>To do this, we just need a way to specify that <code>model</code> from <code>init!</code> and <code>respond!</code> are the same type. The same would apply to many effects.</p>



<a name="492323002"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Simplify%20hosted%20module%20headers/near/492323002" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Simplify.20hosted.20module.20headers.html#492323002">(Jan 07 2025 at 14:45)</a>:</h4>
<p>I think this would be far nicer to support in general and would prefer it over requires syntax.</p>



<a name="492323196"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Simplify%20hosted%20module%20headers/near/492323196" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Simplify.20hosted.20module.20headers.html#492323196">(Jan 07 2025 at 14:46)</a>:</h4>
<p>Caveat. This only removes the use of requires for types. It would still be needed to pass app functions to the platform unless the platform just imports the app and calls something.</p>



<a name="492327087"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Simplify%20hosted%20module%20headers/near/492327087" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Simplify.20hosted.20module.20headers.html#492327087">(Jan 07 2025 at 15:05)</a>:</h4>
<p>Note, we can work around this for platform main functions, but not for effects. For basic webserver <code>init!</code> and <code>respond!</code>, we can instead use a record <code>{ init!, respond! }</code> and use the record to link the type. It would be nicer to also link effect types.</p>



<a name="492341833"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Simplify%20hosted%20module%20headers/near/492341833" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Oskar Hahn <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Simplify.20hosted.20module.20headers.html#492341833">(Jan 07 2025 at 16:19)</a>:</h4>
<p>Wow. I was fixated on the dogma that <code>Model</code> has to be pass to the platform. Your idea seems much simpler.</p>
<p>I don't understand how this could work on effects or other exported functions. How could the platform specify, that the argument from <code>do_stuff_with_Model! : (model =&gt; a) =&gt; a</code> is the same as the return value from the provided function <code>init! : {} =&gt; model</code>?</p>



<a name="492358202"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Simplify%20hosted%20module%20headers/near/492358202" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Simplify.20hosted.20module.20headers.html#492358202">(Jan 07 2025 at 17:53)</a>:</h4>
<p>Yeah, I'm not sure how we would wire it up, but fundamentally it is just propagating a constraint. (Just have to make that clear to the user and platform author somehow)</p>
<p>Dumb idea, but it could be a simple as a <code>!</code> suffix links type variables in the platform</p>
<p>So:<br>
<code>do_something_with_model! : (model! =&gt; a) =&gt; a</code><br>
And<br>
<code>init! : {} =&gt; model!</code></p>



<a name="492359405"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Simplify%20hosted%20module%20headers/near/492359405" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Simplify.20hosted.20module.20headers.html#492359405">(Jan 07 2025 at 18:00)</a>:</h4>
<p>yeah I like <a href="https://package.elm-lang.org/packages/elm/browser/latest/Browser#sandbox">the way Elm does it</a> and would like for us to do something that too - where it's just normal type variables and that's it</p>



<a name="492359503"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Simplify%20hosted%20module%20headers/near/492359503" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Simplify.20hosted.20module.20headers.html#492359503">(Jan 07 2025 at 18:01)</a>:</h4>
<p>e.g.</p>
<div class="codehilite" data-code-language="Ruby"><pre><span></span><code><span class="n">init!</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{}</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">(</span><span class="n">model</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="n">model</span><span class="p">,</span><span class="w"> </span><span class="no">Request</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">(</span><span class="n">model</span><span class="p">,</span><span class="w"> </span><span class="no">Response</span><span class="p">)))</span>
</code></pre></div>



<a name="492359714"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Simplify%20hosted%20module%20headers/near/492359714" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Simplify.20hosted.20module.20headers.html#492359714">(Jan 07 2025 at 18:02)</a>:</h4>
<p>so in that type, <code>init!</code> returns both the initial model as well as the function which takes the current model and a request and returns the new model and a response</p>



<a name="492359789"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Simplify%20hosted%20module%20headers/near/492359789" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Simplify.20hosted.20module.20headers.html#492359789">(Jan 07 2025 at 18:02)</a>:</h4>
<p>although as discussed somewhere else, that would have race condition problems <span aria-label="sweat smile" class="emoji emoji-1f605" role="img" title="sweat smile">:sweat_smile:</span></p>



<a name="492359829"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Simplify%20hosted%20module%20headers/near/492359829" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Simplify.20hosted.20module.20headers.html#492359829">(Jan 07 2025 at 18:03)</a>:</h4>
<p>if handlers can run concurrently</p>



<a name="492360571"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Simplify%20hosted%20module%20headers/near/492360571" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Simplify.20hosted.20module.20headers.html#492360571">(Jan 07 2025 at 18:07)</a>:</h4>
<p>You could do something like this to allow async model updates:</p>
<div class="codehilite" data-code-language="Elm"><pre><span></span><code><span class="nv">init</span><span class="err">!</span><span class="w"> </span><span class="nf">:</span><span class="w"> </span><span class="p">{}</span><span class="w"> </span><span class="nf">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nv">model</span><span class="p">,</span>
<span class="w">    </span><span class="nv">respond</span><span class="err">!</span><span class="nf">:</span><span class="w">  </span><span class="nv">model</span><span class="p">,</span><span class="w"> </span><span class="kt">Request</span><span class="w"> </span><span class="nf">=&gt;</span><span class="w"> </span><span class="p">(</span><span class="nv">update</span><span class="p">,</span><span class="w"> </span><span class="kt">Response</span><span class="p">),</span>
<span class="w">    </span><span class="nv">updateModel</span><span class="nf">:</span><span class="w"> </span><span class="nv">model</span><span class="p">,</span><span class="w"> </span><span class="nv">update</span><span class="w"> </span><span class="nf">-&gt;</span><span class="w"> </span><span class="nv">model</span><span class="p">,</span>
<span class="p">}</span>
</code></pre></div>



<a name="492361743"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Simplify%20hosted%20module%20headers/near/492361743" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Simplify.20hosted.20module.20headers.html#492361743">(Jan 07 2025 at 18:15)</a>:</h4>
<p>Wow, I didn't even read that link</p>



<a name="492370025"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Simplify%20hosted%20module%20headers/near/492370025" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Simplify.20hosted.20module.20headers.html#492370025">(Jan 07 2025 at 19:08)</a>:</h4>
<p>yeah in Elm terminology it would be:</p>
<div class="codehilite" data-code-language="Ruby"><pre><span></span><code><span class="n">init!</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">model</span><span class="p">,</span>
<span class="w">    </span><span class="n">respond!</span><span class="p">:</span><span class="w"> </span><span class="n">model</span><span class="p">,</span><span class="w"> </span><span class="no">Request</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">(</span><span class="n">msg</span><span class="p">,</span><span class="w"> </span><span class="no">Response</span><span class="p">),</span>
<span class="w">    </span><span class="n">update!</span><span class="p">:</span><span class="w"> </span><span class="n">model</span><span class="p">,</span><span class="w"> </span><span class="n">msg</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">model</span><span class="p">,</span>
<span class="p">}</span>
</code></pre></div>



<a name="492370070"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Simplify%20hosted%20module%20headers/near/492370070" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Simplify.20hosted.20module.20headers.html#492370070">(Jan 07 2025 at 19:08)</a>:</h4>
<p>Does update need to be effecful?</p>



<a name="492370122"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Simplify%20hosted%20module%20headers/near/492370122" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Simplify.20hosted.20module.20headers.html#492370122">(Jan 07 2025 at 19:09)</a>:</h4>
<p>doesn't have to be, but you might want to do logging or something in there</p>



<a name="492370133"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Simplify%20hosted%20module%20headers/near/492370133" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Simplify.20hosted.20module.20headers.html#492370133">(Jan 07 2025 at 19:09)</a>:</h4>
<p>Sure</p>



<a name="492370153"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Simplify%20hosted%20module%20headers/near/492370153" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Simplify.20hosted.20module.20headers.html#492370153">(Jan 07 2025 at 19:09)</a>:</h4>
<p>it does have to be single-threaded</p>



<a name="492370197"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Simplify%20hosted%20module%20headers/near/492370197" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Simplify.20hosted.20module.20headers.html#492370197">(Jan 07 2025 at 19:09)</a>:</h4>
<p>as in, at most one <code>update</code> function is ever running at a time</p>



<a name="492370215"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Simplify%20hosted%20module%20headers/near/492370215" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Simplify.20hosted.20module.20headers.html#492370215">(Jan 07 2025 at 19:09)</a>:</h4>
<p>just going through the queue of messages</p>



<a name="492370351"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Simplify%20hosted%20module%20headers/near/492370351" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Simplify.20hosted.20module.20headers.html#492370351">(Jan 07 2025 at 19:10)</a>:</h4>
<p>The problem with this approach is you no longer guarantee seeing updates to model before the next request handling happens, but also that's just the case anyway with proper multithreading</p>



<a name="492370366"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Simplify%20hosted%20module%20headers/near/492370366" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Simplify.20hosted.20module.20headers.html#492370366">(Jan 07 2025 at 19:10)</a>:</h4>
<p>right</p>



<a name="492370378"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Simplify%20hosted%20module%20headers/near/492370378" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Simplify.20hosted.20module.20headers.html#492370378">(Jan 07 2025 at 19:10)</a>:</h4>
<p>I think this API is pretty good</p>



<a name="492370529"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Simplify%20hosted%20module%20headers/near/492370529" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Simplify.20hosted.20module.20headers.html#492370529">(Jan 07 2025 at 19:11)</a>:</h4>
<p>I definitely think it's good to use normal type variables for this</p>



<a name="492370539"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Simplify%20hosted%20module%20headers/near/492370539" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Simplify.20hosted.20module.20headers.html#492370539">(Jan 07 2025 at 19:11)</a>:</h4>
<p>So we still don't need to expose model to the host? Is there a use case that would make that desired?</p>



<a name="492370544"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Simplify%20hosted%20module%20headers/near/492370544" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Simplify.20hosted.20module.20headers.html#492370544">(Jan 07 2025 at 19:11)</a>:</h4>
<p>I'd love to get rid of the <code>Model</code> concept we have today</p>



<a name="492370607"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Simplify%20hosted%20module%20headers/near/492370607" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Simplify.20hosted.20module.20headers.html#492370607">(Jan 07 2025 at 19:12)</a>:</h4>
<p>actually it was originally a workaround</p>



<a name="492370649"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Simplify%20hosted%20module%20headers/near/492370649" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Simplify.20hosted.20module.20headers.html#492370649">(Jan 07 2025 at 19:12)</a>:</h4>
<p>because we didn't have sending closure captures to the host working, and that seemed like a big project</p>



<a name="492370658"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Simplify%20hosted%20module%20headers/near/492370658" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Simplify.20hosted.20module.20headers.html#492370658">(Jan 07 2025 at 19:12)</a>:</h4>
<p>so Folkert suggested adding this as a workaround to unblock the use cases <span aria-label="big smile" class="emoji emoji-1f604" role="img" title="big smile">:big_smile:</span></p>



<a name="492370663"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Simplify%20hosted%20module%20headers/near/492370663" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Simplify.20hosted.20module.20headers.html#492370663">(Jan 07 2025 at 19:12)</a>:</h4>
<p>That's one more section gone from the platform</p>



<a name="492370690"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Simplify%20hosted%20module%20headers/near/492370690" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Simplify.20hosted.20module.20headers.html#492370690">(Jan 07 2025 at 19:12)</a>:</h4>
<p>but it was never intended to be the long-term design</p>



<a name="492371380"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Simplify%20hosted%20module%20headers/near/492371380" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Simplify.20hosted.20module.20headers.html#492371380">(Jan 07 2025 at 19:17)</a>:</h4>
<p>the other thing is that I suspect this pattern of <code>init!</code> returning the request handler function is going to end up being what every webserver wants to do</p>



<a name="492371398"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Simplify%20hosted%20module%20headers/near/492371398" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Simplify.20hosted.20module.20headers.html#492371398">(Jan 07 2025 at 19:17)</a>:</h4>
<p>because it's such a convenient way to get environment variables etc. on startup</p>



<a name="492371524"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Simplify%20hosted%20module%20headers/near/492371524" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Simplify.20hosted.20module.20headers.html#492371524">(Jan 07 2025 at 19:18)</a>:</h4>
<p>and then you just close over them and that's it</p>



<a name="492372128"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Simplify%20hosted%20module%20headers/near/492372128" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Simplify.20hosted.20module.20headers.html#492372128">(Jan 07 2025 at 19:22)</a>:</h4>
<p>I'm actually not sure if today it might need to use <code>Box</code></p>



<a name="492372149"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Simplify%20hosted%20module%20headers/near/492372149" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Simplify.20hosted.20module.20headers.html#492372149">(Jan 07 2025 at 19:23)</a>:</h4>
<p>in order to work around current compilation issues, not sure</p>



<a name="492372197"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Simplify%20hosted%20module%20headers/near/492372197" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Simplify.20hosted.20module.20headers.html#492372197">(Jan 07 2025 at 19:23)</a>:</h4>
<p>we could try it out on <code>basic-webserver</code>, see if it works as-is</p>



<a name="492377482"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Simplify%20hosted%20module%20headers/near/492377482" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Oskar Hahn <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Simplify.20hosted.20module.20headers.html#492377482">(Jan 07 2025 at 19:57)</a>:</h4>
<p>I cannot see, how this solution would support effects that use model. You would need to define all effects in this init structure.</p>



<a name="492380371"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Simplify%20hosted%20module%20headers/near/492380371" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Simplify.20hosted.20module.20headers.html#492380371">(Jan 07 2025 at 20:18)</a>:</h4>
<p><span aria-label="thinking" class="emoji emoji-1f914" role="img" title="thinking">:thinking:</span> what effects use Model?</p>



<a name="492381324"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Simplify%20hosted%20module%20headers/near/492381324" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Simplify.20hosted.20module.20headers.html#492381324">(Jan 07 2025 at 20:24)</a>:</h4>
<p>Something like <code>save_to_db! : Model =&gt; {}</code> or load_from_db : {} =&gt; Model`</p>



<a name="492381332"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Simplify%20hosted%20module%20headers/near/492381332" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Simplify.20hosted.20module.20headers.html#492381332">(Jan 07 2025 at 20:24)</a>:</h4>
<p>Stuff for Kingfisher</p>



<a name="492382289"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Simplify%20hosted%20module%20headers/near/492382289" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Simplify.20hosted.20module.20headers.html#492382289">(Jan 07 2025 at 20:31)</a>:</h4>
<p>ah I see</p>



<a name="492382943"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Simplify%20hosted%20module%20headers/near/492382943" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Simplify.20hosted.20module.20headers.html#492382943">(Jan 07 2025 at 20:36)</a>:</h4>
<p>so a tradeoff there is that if you have to represent that using a value that you pass around - e.g. something like:</p>
<div class="codehilite" data-code-language="Ruby"><pre><span></span><code><span class="n">save_to_db!</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="no">Db</span><span class="w"> </span><span class="n">model</span><span class="p">,</span><span class="w"> </span><span class="n">model</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">()</span>

<span class="n">load_from_db!</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="no">Db</span><span class="w"> </span><span class="n">model</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">model</span>
</code></pre></div>
<p>...then it's less convenient in that you have an extra value to pass around, but on the other hand, without that, you wouldn't have a way to simulate database state during tests. You'd have to always the real platform functions</p>



<a name="492383001"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Simplify%20hosted%20module%20headers/near/492383001" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Simplify.20hosted.20module.20headers.html#492383001">(Jan 07 2025 at 20:36)</a>:</h4>
<p>as opposed to being able to construct a fake <code>Db</code> and pass it around</p>



<a name="492390898"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Simplify%20hosted%20module%20headers/near/492390898" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Simplify.20hosted.20module.20headers.html#492390898">(Jan 07 2025 at 21:31)</a>:</h4>
<p><span class="user-mention silent" data-user-id="281383">Richard Feldman</span> <a href="#narrow/stream/316715-contributing/topic/Simplify.20hosted.20module.20headers/near/492370025">said</a>:</p>
<blockquote>
<p>yeah in Elm terminology it would be:</p>
<p><div class="codehilite" data-code-language="Ruby"><pre><span></span><code><span class="n">init!</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">model</span><span class="p">,</span>
<span class="w">    </span><span class="n">respond!</span><span class="p">:</span><span class="w"> </span><span class="n">model</span><span class="p">,</span><span class="w"> </span><span class="no">Request</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">(</span><span class="n">msg</span><span class="p">,</span><span class="w"> </span><span class="no">Response</span><span class="p">),</span>
<span class="w">    </span><span class="n">update!</span><span class="p">:</span><span class="w"> </span><span class="n">model</span><span class="p">,</span><span class="w"> </span><span class="n">msg</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">model</span><span class="p">,</span>
<span class="p">}</span>
</code></pre></div><br>
</p>
</blockquote>
<p>What is the benefit of that over just exposing a record of functions to the host?</p>



<a name="492393302"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Simplify%20hosted%20module%20headers/near/492393302" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Simplify.20hosted.20module.20headers.html#492393302">(Jan 07 2025 at 21:48)</a>:</h4>
<p>you can read env vars (and similar) and use them in any of the returned functions</p>



<a name="492396827"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Simplify%20hosted%20module%20headers/near/492396827" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Simplify.20hosted.20module.20headers.html#492396827">(Jan 07 2025 at 22:12)</a>:</h4>
<p>You can also do that by storing them in model</p>



<a name="492396925"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Simplify%20hosted%20module%20headers/near/492396925" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Simplify.20hosted.20module.20headers.html#492396925">(Jan 07 2025 at 22:13)</a>:</h4>
<p>But I guess this would mean that you could avoid storing queries in the model. They are constant after creation. That would simplify all the error managing.</p>



<a name="492401156"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Simplify%20hosted%20module%20headers/near/492401156" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Simplify.20hosted.20module.20headers.html#492401156">(Jan 07 2025 at 22:45)</a>:</h4>
<p>yeah exactly</p>



<a name="492407228"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Simplify%20hosted%20module%20headers/near/492407228" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Simplify.20hosted.20module.20headers.html#492407228">(Jan 07 2025 at 23:37)</a>:</h4>
<p>I guess that may be a reasonable api once repeatedly using closures with the platform just works.</p>



<a name="492439313"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Simplify%20hosted%20module%20headers/near/492439313" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Oskar Hahn <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Simplify.20hosted.20module.20headers.html#492439313">(Jan 08 2025 at 05:56)</a>:</h4>
<p><span class="user-mention silent" data-user-id="281383">Richard Feldman</span> <a href="#narrow/stream/316715-contributing/topic/Simplify.20hosted.20module.20headers/near/492382943">said</a>:</p>
<blockquote>
<p>so a tradeoff there is that if you have to represent that using a value that you pass around - e.g. something like:</p>
<p><div class="codehilite" data-code-language="Ruby"><pre><span></span><code><span class="n">save_to_db!</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="no">Db</span><span class="w"> </span><span class="n">model</span><span class="p">,</span><span class="w"> </span><span class="n">model</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">()</span>

<span class="n">load_from_db!</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="no">Db</span><span class="w"> </span><span class="n">model</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">model</span>
</code></pre></div><br>
</p>
</blockquote>
<p>I don't get it. What is <code>Db model</code>? Is this something <code>Init</code> has to return?</p>



<hr><p>Last updated: Mar 01 2026 at 12:20 UTC</p>
</html>