<html>
<head><meta charset="utf-8"><title>âœ” Missing Str.graphemes Â· contributing Â· Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/index.html">contributing</a></h2>
<h3>Topic: <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/.E2.9C.94.20Missing.20Str.2Egraphemes.html">âœ” Missing Str.graphemes</a></h3>

<hr>

<base href="https://roc.zulipchat.com">

<head><link href="https://roc-lang.github.io/zulip-export/style.css" rel="stylesheet"></head>

<a name="303130991"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/%E2%9C%94%20Missing%20Str.graphemes/near/303130991" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Duncan <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/.E2.9C.94.20Missing.20Str.2Egraphemes.html#303130991">(Oct 09 2022 at 13:00)</a>:</h4>
<p>In both Elm and JavaScript, you can pass an empty string to the <code>split</code> function to get a list of characters from a string. However, according to <a href="https://www.roc-lang.org/builtins/Str#split">Roc's documentation</a>, it won't behave the same, and we should use <code>graphemes</code> instead, yet this function does not exist in the <code>Str</code> module.</p>
<p>Was the <code>graphemes</code> function removed from the module? Was it intended to be built in the future? There's a discrepancy between the documentation and the code we should fix.</p>
<p>Is the intended path for this use case to use <code>graphemes</code>? At least for what I'm working on, I can use <code>toScalars</code> or <code>toUtf8</code>. Are these alternatives the intended path?</p>



<a name="303142395"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/%E2%9C%94%20Missing%20Str.graphemes/near/303142395" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/.E2.9C.94.20Missing.20Str.2Egraphemes.html#303142395">(Oct 09 2022 at 15:00)</a>:</h4>
<p>Hmm.... <span class="user-mention" data-user-id="281383">@Richard Feldman</span> is <code>toScalars</code> different than what <code>graphemes</code> would be? Did the function just get renamed?</p>



<a name="303144198"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/%E2%9C%94%20Missing%20Str.graphemes/near/303144198" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Prajwal S N <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/.E2.9C.94.20Missing.20Str.2Egraphemes.html#303144198">(Oct 09 2022 at 15:20)</a>:</h4>
<p>As far as I understand from the (confusing) Unicode docs, graphemes are the smallest text element in a script. Scalars are a single unicode character, which may consist of one of more graphemes. Multiple scalars can then be grouped into grapheme clusters.</p>
<p>Edit: fixed the definitions</p>



<a name="303144857"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/%E2%9C%94%20Missing%20Str.graphemes/near/303144857" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/.E2.9C.94.20Missing.20Str.2Egraphemes.html#303144857">(Oct 09 2022 at 15:27)</a>:</h4>
<p>yeah they're different</p>



<a name="303144873"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/%E2%9C%94%20Missing%20Str.graphemes/near/303144873" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/.E2.9C.94.20Missing.20Str.2Egraphemes.html#303144873">(Oct 09 2022 at 15:27)</a>:</h4>
<p>it was never implemented, I just wrote about it as if it already existed, although it doesn't <span aria-label="sweat smile" class="emoji emoji-1f605" role="img" title="sweat smile">:sweat_smile:</span></p>



<a name="303144895"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/%E2%9C%94%20Missing%20Str.graphemes/near/303144895" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/.E2.9C.94.20Missing.20Str.2Egraphemes.html#303144895">(Oct 09 2022 at 15:27)</a>:</h4>
<p><span class="user-mention" data-user-id="551190">@Prajwal S N</span> that's correct!</p>



<a name="303144978"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/%E2%9C%94%20Missing%20Str.graphemes/near/303144978" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/.E2.9C.94.20Missing.20Str.2Egraphemes.html#303144978">(Oct 09 2022 at 15:28)</a>:</h4>
<p>basically if you want to split it into whole emojis instead of chopped-up emojis, you want graphemes and not scalars</p>



<a name="303145016"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/%E2%9C%94%20Missing%20Str.graphemes/near/303145016" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/.E2.9C.94.20Missing.20Str.2Egraphemes.html#303145016">(Oct 09 2022 at 15:29)</a>:</h4>
<p>because all emojis are one grapheme each, but multiple scalars each</p>



<a name="303145049"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/%E2%9C%94%20Missing%20Str.graphemes/near/303145049" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Prajwal S N <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/.E2.9C.94.20Missing.20Str.2Egraphemes.html#303145049">(Oct 09 2022 at 15:29)</a>:</h4>
<p>It looks like a we can use <code>grapheme.zig</code> with the logic used in <code>Str.toScalars</code> to implement this</p>



<a name="303145167"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/%E2%9C%94%20Missing%20Str.graphemes/near/303145167" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Prajwal S N <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/.E2.9C.94.20Missing.20Str.2Egraphemes.html#303145167">(Oct 09 2022 at 15:30)</a>:</h4>
<p>I would like to give this a shot if no one else is already working on it</p>



<a name="303145189"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/%E2%9C%94%20Missing%20Str.graphemes/near/303145189" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/.E2.9C.94.20Missing.20Str.2Egraphemes.html#303145189">(Oct 09 2022 at 15:30)</a>:</h4>
<p>that would be wonderful! <span aria-label="heart eyes" class="emoji emoji-1f60d" role="img" title="heart eyes">:heart_eyes:</span></p>



<a name="303145224"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/%E2%9C%94%20Missing%20Str.graphemes/near/303145224" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/.E2.9C.94.20Missing.20Str.2Egraphemes.html#303145224">(Oct 09 2022 at 15:30)</a>:</h4>
<p>happy to help you with that in any way!</p>



<a name="303145267"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/%E2%9C%94%20Missing%20Str.graphemes/near/303145267" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Duncan <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/.E2.9C.94.20Missing.20Str.2Egraphemes.html#303145267">(Oct 09 2022 at 15:31)</a>:</h4>
<p>Thanks <span class="user-mention" data-user-id="551190">@Prajwal S N</span> ! <span aria-label="raised hands" class="emoji emoji-1f64c" role="img" title="raised hands">:raised_hands:</span></p>



<a name="303147038"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/%E2%9C%94%20Missing%20Str.graphemes/near/303147038" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Prajwal S N <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/.E2.9C.94.20Missing.20Str.2Egraphemes.html#303147038">(Oct 09 2022 at 15:50)</a>:</h4>
<p>I can think of two ways to implement this:</p>
<ol>
<li>We return a <code>List (List U32)</code>, with each sub-list consisting of the code points for a single grapheme</li>
<li>We return a <code>List Str</code>, with each element being one grapheme</li>
</ol>
<p>Which one do you guys think is better?</p>



<a name="303149796"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/%E2%9C%94%20Missing%20Str.graphemes/near/303149796" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/.E2.9C.94.20Missing.20Str.2Egraphemes.html#303149796">(Oct 09 2022 at 16:18)</a>:</h4>
<p>definitely #2!</p>



<a name="303149855"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/%E2%9C%94%20Missing%20Str.graphemes/near/303149855" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/.E2.9C.94.20Missing.20Str.2Egraphemes.html#303149855">(Oct 09 2022 at 16:19)</a>:</h4>
<p>you can quickly and easily go from <code>Str</code> to <code>List U32</code>, but going the other way around requires a utf-8 validation check and a <code>Result</code> <span aria-label="big smile" class="emoji emoji-1f604" role="img" title="big smile">:big_smile:</span></p>



<a name="303279541"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/%E2%9C%94%20Missing%20Str.graphemes/near/303279541" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Prajwal S N <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/.E2.9C.94.20Missing.20Str.2Egraphemes.html#303279541">(Oct 10 2022 at 15:21)</a>:</h4>
<p>I managed to get some sort of implementation done, but I've been dealing with all forms of allocation issues, segfaults, and core dumps since yesterday <span aria-label="skull" class="emoji emoji-1f480" role="img" title="skull">:skull:</span> I'll open a draft PR, would be great if someone can help with fixing it (I have close to zero knowledge of Zig, so I'm not sure how to go about making it work either)</p>



<a name="303279868"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/%E2%9C%94%20Missing%20Str.graphemes/near/303279868" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Prajwal S N <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/.E2.9C.94.20Missing.20Str.2Egraphemes.html#303279868">(Oct 10 2022 at 15:23)</a>:</h4>
<p><a href="https://github.com/roc-lang/roc/pull/4286">https://github.com/roc-lang/roc/pull/4286</a></p>



<a name="303288037"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/%E2%9C%94%20Missing%20Str.graphemes/near/303288037" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/.E2.9C.94.20Missing.20Str.2Egraphemes.html#303288037">(Oct 10 2022 at 16:10)</a>:</h4>
<p>cc <span class="user-mention" data-user-id="551275">@Travis</span> in case you're interested - you seem to be very knowledgeable about Zig! <span aria-label="smiley" class="emoji emoji-1f603" role="img" title="smiley">:smiley:</span></p>



<a name="303289203"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/%E2%9C%94%20Missing%20Str.graphemes/near/303289203" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/.E2.9C.94.20Missing.20Str.2Egraphemes.html#303289203">(Oct 10 2022 at 16:18)</a>:</h4>
<p>yes i would like to help if i can. although i'm not very comfy in rust (and no rust install yet). <span class="user-mention" data-user-id="551190">@Prajwal S N</span> feel free to ping me if you have any zig questions.</p>



<a name="303289614"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/%E2%9C%94%20Missing%20Str.graphemes/near/303289614" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/.E2.9C.94.20Missing.20Str.2Egraphemes.html#303289614">(Oct 10 2022 at 16:20)</a>:</h4>
<p>have you looked at ziglyph? <a href="https://github.com/jecolon/ziglyph">https://github.com/jecolon/ziglyph</a></p>



<a name="303289966"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/%E2%9C%94%20Missing%20Str.graphemes/near/303289966" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/.E2.9C.94.20Missing.20Str.2Egraphemes.html#303289966">(Oct 10 2022 at 16:23)</a>:</h4>
<p>not sure if its applicable to your pr just the first thing that comes to mind</p>



<a name="303292850"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/%E2%9C%94%20Missing%20Str.graphemes/near/303292850" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Prajwal S N <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/.E2.9C.94.20Missing.20Str.2Egraphemes.html#303292850">(Oct 10 2022 at 16:41)</a>:</h4>
<p>Yes I did take a look at it, but I'm not keen on adding another dependency to the backend</p>



<a name="303293148"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/%E2%9C%94%20Missing%20Str.graphemes/near/303293148" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Prajwal S N <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/.E2.9C.94.20Missing.20Str.2Egraphemes.html#303293148">(Oct 10 2022 at 16:43)</a>:</h4>
<p>Or would it be alright to replace the existing <code>grapheme.zig</code> dependency with ziglyph?</p>



<a name="303809769"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/%E2%9C%94%20Missing%20Str.graphemes/near/303809769" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Prajwal S N <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/.E2.9C.94.20Missing.20Str.2Egraphemes.html#303809769">(Oct 13 2022 at 11:45)</a>:</h4>
<p><span class="user-mention" data-user-id="551275">@Travis</span> need some help with copying slices in Zig</p>
<div class="codehilite" data-code-language="Zig"><pre><span></span><code><span class="kr">var</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="o">?</span><span class="p">[]</span><span class="kr">const</span><span class="w"> </span><span class="kt">u8</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span><span class="w"></span>
<span class="kr">var</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="p">[]</span><span class="kr">const</span><span class="w"> </span><span class="kt">u8</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"hello"</span><span class="p">;</span><span class="w"></span>
</code></pre></div>
<p>How do I copy the contents of b to a? Doing <code>@memcpy(a, b, b.len)</code> throws <code>expected [*]u8, got ?[]const u8</code></p>



<a name="303813605"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/%E2%9C%94%20Missing%20Str.graphemes/near/303813605" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/.E2.9C.94.20Missing.20Str.2Egraphemes.html#303813605">(Oct 13 2022 at 12:09)</a>:</h4>
<p>what do you want this to do? you have a null pointer, can't store anything into that?</p>



<a name="303868062"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/%E2%9C%94%20Missing%20Str.graphemes/near/303868062" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/.E2.9C.94.20Missing.20Str.2Egraphemes.html#303868062">(Oct 13 2022 at 15:52)</a>:</h4>
<p><del>do you want this to happen at runtime? if so, a would need to be a <code>?[] u8</code> cause you can't write to a const pointer.</del></p>



<a name="303868193"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/%E2%9C%94%20Missing%20Str.graphemes/near/303868193" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/.E2.9C.94.20Missing.20Str.2Egraphemes.html#303868193">(Oct 13 2022 at 15:53)</a>:</h4>
<p>or do you mean overwrite a to point to b?</p>



<a name="303868303"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/%E2%9C%94%20Missing%20Str.graphemes/near/303868303" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/.E2.9C.94.20Missing.20Str.2Egraphemes.html#303868303">(Oct 13 2022 at 15:53)</a>:</h4>
<p>cause that would just be <code>a = b</code>. so yeah i'm not sure what youre trying to do.</p>



<a name="303868800"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/%E2%9C%94%20Missing%20Str.graphemes/near/303868800" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/.E2.9C.94.20Missing.20Str.2Egraphemes.html#303868800">(Oct 13 2022 at 15:56)</a>:</h4>
<p>in order for this to work, a needs to have memory somewhere.</p>



<a name="303868922"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/%E2%9C%94%20Missing%20Str.graphemes/near/303868922" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/.E2.9C.94.20Missing.20Str.2Egraphemes.html#303868922">(Oct 13 2022 at 15:56)</a>:</h4>
<p>if you have an allocator you could do <code>a = try allocator.dupe(u8, b)</code></p>



<a name="303896674"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/%E2%9C%94%20Missing%20Str.graphemes/near/303896674" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Prajwal S N <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/.E2.9C.94.20Missing.20Str.2Egraphemes.html#303896674">(Oct 13 2022 at 18:19)</a>:</h4>
<blockquote>
<p>in order for this to work, a needs to have memory somewhere.</p>
</blockquote>
<p>Yes I would like to allocate and copy the slice into a</p>



<a name="303897203"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/%E2%9C%94%20Missing%20Str.graphemes/near/303897203" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Prajwal S N <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/.E2.9C.94.20Missing.20Str.2Egraphemes.html#303897203">(Oct 13 2022 at 18:22)</a>:</h4>
<blockquote>
<p>what do you want this to do? you have a null pointer, can't store anything into that?</p>
</blockquote>
<p><span class="user-mention" data-user-id="281543">@Folkert de Vries</span> It needs to be null since I'm using it in an if within a while loop. In every iteration of the loop, I need b to be copied and stored in a as the previous value. See this PR (<a href="https://github.com/roc-lang/roc/pull/4286">https://github.com/roc-lang/roc/pull/4286</a>) for the complete function. I'm trying to refactor it into using a u8 slice instead of u21 values for the codepoints</p>



<a name="303900941"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/%E2%9C%94%20Missing%20Str.graphemes/near/303900941" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/.E2.9C.94.20Missing.20Str.2Egraphemes.html#303900941">(Oct 13 2022 at 18:43)</a>:</h4>
<p>are you referring to <code>opt_last_codepoint</code> here? <a href="https://github.com/snprajwal/roc/commit/240df7e679e23b7366732a94374ca578a432188e#diff-a30a29d5d2db3689cadd795ef9925fa8bd162463993bff0ff13c91e1178f7d7dR1328">https://github.com/snprajwal/roc/commit/240df7e679e23b7366732a94374ca578a432188e#diff-a30a29d5d2db3689cadd795ef9925fa8bd162463993bff0ff13c91e1178f7d7dR1328</a></p>



<a name="303901186"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/%E2%9C%94%20Missing%20Str.graphemes/near/303901186" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/.E2.9C.94.20Missing.20Str.2Egraphemes.html#303901186">(Oct 13 2022 at 18:44)</a>:</h4>
<p>and you're trying to refactor that to a <code>?[]const u8</code>?</p>



<a name="303901286"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/%E2%9C%94%20Missing%20Str.graphemes/near/303901286" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/.E2.9C.94.20Missing.20Str.2Egraphemes.html#303901286">(Oct 13 2022 at 18:45)</a>:</h4>
<p>would it be any easier to make it a <code>?[4]u8</code>?</p>



<a name="304459876"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/%E2%9C%94%20Missing%20Str.graphemes/near/304459876" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Prajwal S N <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/.E2.9C.94.20Missing.20Str.2Egraphemes.html#304459876">(Oct 17 2022 at 13:27)</a>:</h4>
<blockquote>
<p>and you're trying to refactor that to a ?[]const u8?</p>
</blockquote>
<p>Bingo, that seems to make everything work correctly, but I need to copy the slice in order to not omit the first character</p>



<a name="304460048"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/%E2%9C%94%20Missing%20Str.graphemes/near/304460048" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Prajwal S N <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/.E2.9C.94.20Missing.20Str.2Egraphemes.html#304460048">(Oct 17 2022 at 13:28)</a>:</h4>
<blockquote>
<p>would it be any easier to make it a ?[4]u8?</p>
</blockquote>
<p>I'm guessing even if I do that, I will still have to copy the slice over...</p>



<a name="304549708"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/%E2%9C%94%20Missing%20Str.graphemes/near/304549708" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/.E2.9C.94.20Missing.20Str.2Egraphemes.html#304549708">(Oct 17 2022 at 20:15)</a>:</h4>
<p><span class="user-mention silent" data-user-id="551190">Prajwal S N</span> <a href="#narrow/stream/316715-contributing/topic/Missing.20Str.2Egraphemes/near/304460048">said</a>:</p>
<blockquote>
<p>I'm guessing even if I do that, I will still have to copy the slice over...<br>
</p>
</blockquote>
<p>Yes you'll have to copy over the slice over into the [4]u8 and keep track of the length.</p>



<a name="304549990"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/%E2%9C%94%20Missing%20Str.graphemes/near/304549990" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/.E2.9C.94.20Missing.20Str.2Egraphemes.html#304549990">(Oct 17 2022 at 20:17)</a>:</h4>
<p>This all seems kinda kludgy imo.  Maybe better to use a u32 which you can set to zero and @bitcast to/from a [4]u8?</p>



<a name="304551005"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/%E2%9C%94%20Missing%20Str.graphemes/near/304551005" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/.E2.9C.94.20Missing.20Str.2Egraphemes.html#304551005">(Oct 17 2022 at 20:23)</a>:</h4>
<p>seems like doing it this way you wouldn't need an optional. just check if the u32 equals zero rather than null.</p>



<a name="304551231"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/%E2%9C%94%20Missing%20Str.graphemes/near/304551231" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/.E2.9C.94.20Missing.20Str.2Egraphemes.html#304551231">(Oct 17 2022 at 20:24)</a>:</h4>
<p>idk. these are just ideas. haven't thought carefully about the code in question.</p>



<a name="304682564"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/%E2%9C%94%20Missing%20Str.graphemes/near/304682564" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Prajwal S N <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/.E2.9C.94.20Missing.20Str.2Egraphemes.html#304682564">(Oct 18 2022 at 13:51)</a>:</h4>
<p>I think I'll step back from this. I do not have the Zig expertise to get it working, and I've been going in circles for the past week. If anyone else would like to continue with what I've already implemented, please feel free to do so!</p>



<a name="304789653"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/%E2%9C%94%20Missing%20Str.graphemes/near/304789653" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/.E2.9C.94.20Missing.20Str.2Egraphemes.html#304789653">(Oct 18 2022 at 16:29)</a>:</h4>
<p><span class="user-mention" data-user-id="551190">@Prajwal S N</span>  i am interested in attempting to implement the zig portion of this pr. however, i am not very familiar with the compiler or rust. so i would need a lot of guidance.</p>



<a name="304789727"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/%E2%9C%94%20Missing%20Str.graphemes/near/304789727" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/.E2.9C.94.20Missing.20Str.2Egraphemes.html#304789727">(Oct 18 2022 at 16:29)</a>:</h4>
<p>would you be interested in working together?  if you or someone else could oversee and assign me tasks plus do the rust coding, i might be able to help complete this.</p>



<a name="304802937"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/%E2%9C%94%20Missing%20Str.graphemes/near/304802937" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Prajwal S N <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/.E2.9C.94.20Missing.20Str.2Egraphemes.html#304802937">(Oct 18 2022 at 17:34)</a>:</h4>
<p><span class="user-mention" data-user-id="551275">@Travis</span> I would be happy to assist you in any way possible. The Rust portion of the implementation is already complete, along with the LLVM bindings for the Zig function. The only issue currently is with the logic used for splitting the string into graphemes. You won't have to touch anything outside of <code>compiler/builtins/bitcode/src/str.zig</code></p>



<a name="304803231"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/%E2%9C%94%20Missing%20Str.graphemes/near/304803231" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Prajwal S N <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/.E2.9C.94.20Missing.20Str.2Egraphemes.html#304803231">(Oct 18 2022 at 17:36)</a>:</h4>
<p>The <code>isGraphemeBreak()</code> function used by <code>strGraphemes()</code> is provided by <code>compiler/builtins/bitcode/src/helpers/grapheme.zig</code>, you might want to take a look at that too</p>



<a name="304803554"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/%E2%9C%94%20Missing%20Str.graphemes/near/304803554" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Prajwal S N <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/.E2.9C.94.20Missing.20Str.2Egraphemes.html#304803554">(Oct 18 2022 at 17:37)</a>:</h4>
<p>There were a couple of very useful reviews on the PR by <span class="user-mention silent" data-user-id="431893">Brian Carroll</span>  , would also recommend going through that once</p>



<a name="304804357"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/%E2%9C%94%20Missing%20Str.graphemes/near/304804357" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/.E2.9C.94.20Missing.20Str.2Egraphemes.html#304804357">(Oct 18 2022 at 17:41)</a>:</h4>
<p>ok thanks <span class="user-mention" data-user-id="551190">@Prajwal S N</span> . sounds like a reasonable task. i'll take a closer look at the pr and comments.</p>



<a name="304804739"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/%E2%9C%94%20Missing%20Str.graphemes/near/304804739" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/.E2.9C.94.20Missing.20Str.2Egraphemes.html#304804739">(Oct 18 2022 at 17:44)</a>:</h4>
<p>question: are there existing ci tests for this? will the ci just fail if i have errors?</p>



<a name="304805000"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/%E2%9C%94%20Missing%20Str.graphemes/near/304805000" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/.E2.9C.94.20Missing.20Str.2Egraphemes.html#304805000">(Oct 18 2022 at 17:45)</a>:</h4>
<p>what would be even better is if there are zig tests i could run locally (using <code>$ zig test ...</code>) without having to push and wait for ci to run.  (i'm assuming the ci takes a while to run)</p>



<a name="304806061"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/%E2%9C%94%20Missing%20Str.graphemes/near/304806061" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/.E2.9C.94.20Missing.20Str.2Egraphemes.html#304806061">(Oct 18 2022 at 17:51)</a>:</h4>
<p>and if no zig tests exist, could you point me to where the tests are defined so that i can create zig tests.</p>



<a name="304806328"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/%E2%9C%94%20Missing%20Str.graphemes/near/304806328" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/.E2.9C.94.20Missing.20Str.2Egraphemes.html#304806328">(Oct 18 2022 at 17:52)</a>:</h4>
<p>or if they don't exist help me create them by providing some inputs and expected outputs to strGrapheme?</p>



<a name="304807906"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/%E2%9C%94%20Missing%20Str.graphemes/near/304807906" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/.E2.9C.94.20Missing.20Str.2Egraphemes.html#304807906">(Oct 18 2022 at 18:01)</a>:</h4>
<p>i don't see any <code>strGrapheme</code> specific tests here: <a href="https://github.com/snprajwal/roc/blob/str-graphemes/crates/compiler/builtins/bitcode/src/str.zig#L1310">https://github.com/snprajwal/roc/blob/str-graphemes/crates/compiler/builtins/bitcode/src/str.zig#L1310</a></p>



<a name="304944973"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/%E2%9C%94%20Missing%20Str.graphemes/near/304944973" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Prajwal S N <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/.E2.9C.94.20Missing.20Str.2Egraphemes.html#304944973">(Oct 19 2022 at 12:33)</a>:</h4>
<p>You're right, I haven't added any tests yet. You can define them in <code>str.zig</code> itself, something like</p>
<div class="codehilite" data-code-language="Zig"><pre><span></span><code><span class="k">test</span><span class="w"> </span><span class="s">"strGraphemes: emojis, ut8, and ascii characters"</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kr">const</span><span class="w"> </span><span class="n">bytes_arr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"6ðŸ¤”Ã¥"</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="kr">const</span><span class="w"> </span><span class="n">bytes_len</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">bytes_arr</span><span class="p">.</span><span class="n">len</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="kr">const</span><span class="w"> </span><span class="n">str</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">RocStr</span><span class="p">.</span><span class="n">init</span><span class="p">(</span><span class="n">bytes_arr</span><span class="p">,</span><span class="w"> </span><span class="n">bytes_len</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="kr">const</span><span class="w"> </span><span class="n">expected</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="n">RocStr</span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="n">RocStr</span><span class="p">.</span><span class="n">init</span><span class="p">(</span><span class="s">"6"</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">),</span><span class="w"> </span><span class="n">RocStr</span><span class="p">.</span><span class="n">init</span><span class="p">(</span><span class="s">"ðŸ¤”"</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">),</span><span class="w"> </span><span class="n">RocStr</span><span class="p">.</span><span class="n">init</span><span class="p">(</span><span class="s">"Ã¥"</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">),</span><span class="w"></span>
<span class="w">    </span><span class="p">};</span><span class="w"></span>
<span class="w">    </span><span class="k">defer</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">expected</span><span class="p">)</span><span class="w"> </span><span class="o">|</span><span class="n">rocStr</span><span class="o">|</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="n">rocStr</span><span class="p">.</span><span class="n">deinit</span><span class="p">();</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="n">str</span><span class="p">.</span><span class="n">deinit</span><span class="p">();</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="kr">const</span><span class="w"> </span><span class="n">array</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">strGraphemes</span><span class="p">(</span><span class="n">str</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="k">try</span><span class="w"> </span><span class="n">expectEqual</span><span class="p">(</span><span class="n">array</span><span class="p">.</span><span class="n">len</span><span class="p">,</span><span class="w"> </span><span class="n">expected</span><span class="p">.</span><span class="n">len</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="k">try</span><span class="w"> </span><span class="n">expect</span><span class="p">(</span><span class="n">array</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">eq</span><span class="p">(</span><span class="n">expected</span><span class="p">[</span><span class="mi">0</span><span class="p">]));</span><span class="w"></span>
<span class="w">    </span><span class="k">try</span><span class="w"> </span><span class="n">expect</span><span class="p">(</span><span class="n">array</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="n">eq</span><span class="p">(</span><span class="n">expected</span><span class="p">[</span><span class="mi">1</span><span class="p">]));</span><span class="w"></span>
<span class="w">    </span><span class="k">try</span><span class="w"> </span><span class="n">expect</span><span class="p">(</span><span class="n">array</span><span class="p">[</span><span class="mi">2</span><span class="p">].</span><span class="n">eq</span><span class="p">(</span><span class="n">expected</span><span class="p">[</span><span class="mi">2</span><span class="p">]));</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>



<a name="304962543"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/%E2%9C%94%20Missing%20Str.graphemes/near/304962543" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/.E2.9C.94.20Missing.20Str.2Egraphemes.html#304962543">(Oct 19 2022 at 14:04)</a>:</h4>
<p>thank you!  you wrote a whole test. very nice.  </p>
<p>while this is much appreciated, i was only asking for inputs and outputs.  i think i understand what strGraphemes() is supposed to do - just split up a string into graphemes.  what i'm hoping for is some input / outputs like this:</p>
<div class="codehilite"><pre><span></span><code>1. &quot;ab&quot; -&gt; [&quot;a&quot;, &quot;b&quot;]
2. &quot;6ðŸ¤”Ã¥&quot; -&gt; [&quot;6&quot;, &quot;ðŸ¤”&quot;, &quot;Ã¥&quot;]
</code></pre></div>



<a name="304962945"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/%E2%9C%94%20Missing%20Str.graphemes/near/304962945" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/.E2.9C.94.20Missing.20Str.2Egraphemes.html#304962945">(Oct 19 2022 at 14:05)</a>:</h4>
<p>i don't know what important edge cases will look like and would like to add them.</p>



<a name="304994780"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/%E2%9C%94%20Missing%20Str.graphemes/near/304994780" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/.E2.9C.94.20Missing.20Str.2Egraphemes.html#304994780">(Oct 19 2022 at 16:33)</a>:</h4>
<p>I put up a pr: <a href="https://github.com/roc-lang/roc/pull/4364">https://github.com/roc-lang/roc/pull/4364</a></p>



<a name="304994961"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/%E2%9C%94%20Missing%20Str.graphemes/near/304994961" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/.E2.9C.94.20Missing.20Str.2Egraphemes.html#304994961">(Oct 19 2022 at 16:34)</a>:</h4>
<p>i consider it a first draft. please review and let me know what it needs.</p>



<a name="304996704"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/%E2%9C%94%20Missing%20Str.graphemes/near/304996704" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/.E2.9C.94.20Missing.20Str.2Egraphemes.html#304996704">(Oct 19 2022 at 16:41)</a>:</h4>
<p><span class="user-mention" data-user-id="431893">@Brian Carroll</span> please take a look if you can too ^</p>



<a name="305006267"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/%E2%9C%94%20Missing%20Str.graphemes/near/305006267" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Prajwal S N <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/.E2.9C.94.20Missing.20Str.2Egraphemes.html#305006267">(Oct 19 2022 at 17:32)</a>:</h4>
<blockquote>
<p>you wrote a whole test. very nice.</p>
</blockquote>
<p>Haha no I just ripped off an existing test for <code>Str.countGraphemeClusters</code> and <code>Str.split</code> <span aria-label="stuck out tongue" class="emoji emoji-1f61b" role="img" title="stuck out tongue">:stuck_out_tongue:</span></p>



<a name="305008675"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/%E2%9C%94%20Missing%20Str.graphemes/near/305008675" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/.E2.9C.94.20Missing.20Str.2Egraphemes.html#305008675">(Oct 19 2022 at 17:44)</a>:</h4>
<p>glad for a painless rebase. <span aria-label="relief" class="emoji emoji-1f62e-200d-1f4a8" role="img" title="relief">:relief:</span>  didn't want to have to deal with any conflicts.</p>



<a name="305021803"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/%E2%9C%94%20Missing%20Str.graphemes/near/305021803" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/.E2.9C.94.20Missing.20Str.2Egraphemes.html#305021803">(Oct 19 2022 at 18:58)</a>:</h4>
<p>i just did a squash. hoping that + signing worked ok</p>



<a name="305027360"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/%E2%9C%94%20Missing%20Str.graphemes/near/305027360" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/.E2.9C.94.20Missing.20Str.2Egraphemes.html#305027360">(Oct 19 2022 at 19:31)</a>:</h4>
<p>seems good now if anyone wants to kick off the ci</p>



<a name="305042611"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/%E2%9C%94%20Missing%20Str.graphemes/near/305042611" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/.E2.9C.94.20Missing.20Str.2Egraphemes.html#305042611">(Oct 19 2022 at 21:08)</a>:</h4>
<p>can't tell why the ci failed <a href="https://github.com/roc-lang/roc/pull/4364">https://github.com/roc-lang/roc/pull/4364</a></p>



<a name="305042722"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/%E2%9C%94%20Missing%20Str.graphemes/near/305042722" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/.E2.9C.94.20Missing.20Str.2Egraphemes.html#305042722">(Oct 19 2022 at 21:09)</a>:</h4>
<p><em>doesn't seem</em> so be related to <code>strGraphemes()</code>?</p>



<a name="305044155"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/%E2%9C%94%20Missing%20Str.graphemes/near/305044155" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Carroll <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/.E2.9C.94.20Missing.20Str.2Egraphemes.html#305044155">(Oct 19 2022 at 21:19)</a>:</h4>
<p>Agreed. I reran it, let's see what happens</p>



<a name="305046543"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/%E2%9C%94%20Missing%20Str.graphemes/near/305046543" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/.E2.9C.94.20Missing.20Str.2Egraphemes.html#305046543">(Oct 19 2022 at 21:39)</a>:</h4>
<p>thanks. looks like it failed again with same the errors.</p>



<a name="305090829"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/%E2%9C%94%20Missing%20Str.graphemes/near/305090829" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anton <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/.E2.9C.94.20Missing.20Str.2Egraphemes.html#305090829">(Oct 20 2022 at 07:04)</a>:</h4>
<p><code>unix_wait_status(139)</code> is for segmentation faults. I've tested it locally and was able to reproduce it, all failed tests use a c platform.</p>



<a name="305189871"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/%E2%9C%94%20Missing%20Str.graphemes/near/305189871" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/.E2.9C.94.20Missing.20Str.2Egraphemes.html#305189871">(Oct 20 2022 at 16:35)</a>:</h4>
<p>huh <span aria-label="thinking" class="emoji emoji-1f914" role="img" title="thinking">:thinking:</span> thanks for testing locally. thats an interesting observation that they're all using a c platform. could that perhaps suggest some type of linking error is happening?</p>



<a name="305191951"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/%E2%9C%94%20Missing%20Str.graphemes/near/305191951" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/.E2.9C.94.20Missing.20Str.2Egraphemes.html#305191951">(Oct 20 2022 at 16:45)</a>:</h4>
<p>the failing tests are</p>
<div class="codehilite" data-code-language="Bash Session"><pre><span></span><code><span class="go"> failures:</span>
<span class="go">    cli_run::parse_movies_csv</span>
<span class="go">    cli_run::platform_switching_main</span>
<span class="go">    cli_run::ruby_interop</span>
</code></pre></div>



<a name="305192242"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/%E2%9C%94%20Missing%20Str.graphemes/near/305192242" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/.E2.9C.94.20Missing.20Str.2Egraphemes.html#305192242">(Oct 20 2022 at 16:46)</a>:</h4>
<p>and the first failure looks like this</p>
<div class="codehilite" data-code-language="Bash Session"><pre><span></span><code><span class="go">test cli_run::false_interpreter ... ok</span>
<span class="go">test cli_run::breakout ... ok</span>

<span class="go">failures:</span>

<span class="go">---- cli_run::parse_movies_csv stdout ---- thread 'cli_run::parse_movies_csv'</span>
<span class="go">     panicked at 'bad status Out { stdout: "2 movies were found:\n\nThe</span>
<span class="go">     movie 'Airplane!' was released in 1980 and stars Robert Hays and Julie</span>
<span class="go">     Hagerty\nThe movie 'Caddyshack' was released in 1980 and stars Chevy</span>
<span class="go">     Chase, Rodney Dangerfield, Ted Knight, Michael O'Keefe and Bill</span>
<span class="go">     Murray\n\nParse success!\n", stderr: "ðŸ”¨ Rebuilding platform...\n", status:</span>
<span class="go">     ExitStatus(unix_wait_status(139)) }', crates/cli/tests/cli_run.rs:118:9</span>
</code></pre></div>



<a name="305192964"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/%E2%9C%94%20Missing%20Str.graphemes/near/305192964" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/.E2.9C.94.20Missing.20Str.2Egraphemes.html#305192964">(Oct 20 2022 at 16:49)</a>:</h4>
<p>so it appears that the test's stdout looks good. and everything else seems ok except the segfault exit status.</p>



<a name="305204392"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/%E2%9C%94%20Missing%20Str.graphemes/near/305204392" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/.E2.9C.94.20Missing.20Str.2Egraphemes.html#305204392">(Oct 20 2022 at 17:46)</a>:</h4>
<p>is it possible that the tests i added are causing this segfault? i think the new tests are the only real addition. the <code>strGraphemes()</code> function is very similar to <span class="user-mention" data-user-id="551190">@Prajwal S N</span>'s version which passed ci fine.</p>



<a name="305208125"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/%E2%9C%94%20Missing%20Str.graphemes/near/305208125" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Prajwal S N <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/.E2.9C.94.20Missing.20Str.2Egraphemes.html#305208125">(Oct 20 2022 at 18:04)</a>:</h4>
<p>I don't think so, they're coming from an entirely different crate</p>



<a name="305213738"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/%E2%9C%94%20Missing%20Str.graphemes/near/305213738" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/.E2.9C.94.20Missing.20Str.2Egraphemes.html#305213738">(Oct 20 2022 at 18:35)</a>:</h4>
<p>This is somehow specifically caused by the surgical linker in optimized builds. The exit function is crashing. From valgrind:</p>
<div class="codehilite"><pre><span></span><code>==34239== Process terminating with default action of signal 11 (SIGSEGV)
==34239==  Bad permissions for mapped region at address 0x121004
==34239==    at 0x121004: ??? (in /home/bren077s/Projects/roc-misc/roc/examples/parser/parse-movies-csv)
==34239==    by 0x498E0C4: __run_exit_handlers (in /nix/store/6f66prpgx1qx4n6k450sxs3d157ia1ps-glibc-2.35-163/lib/libc.so.6)
==34239==    by 0x498E24D: exit (in /nix/store/6f66prpgx1qx4n6k450sxs3d157ia1ps-glibc-2.35-163/lib/libc.so.6)
==34239==    by 0x4977254: (below main) (in /nix/store/6f66prpgx1qx4n6k450sxs3d157ia1ps-glibc-2.35-163/lib/libc.so.6)
</code></pre></div>



<a name="305214058"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/%E2%9C%94%20Missing%20Str.graphemes/near/305214058" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/.E2.9C.94.20Missing.20Str.2Egraphemes.html#305214058">(Oct 20 2022 at 18:37)</a>:</h4>
<p>Does not look to be nix/glibc version specific:</p>
<div class="codehilite"><pre><span></span><code>==34807== Process terminating with default action of signal 11 (SIGSEGV)
==34807==  Bad permissions for mapped region at address 0x121010
==34807==    at 0x121010: ??? (in /home/bren077s/Projects/roc-misc/roc/examples/parser/parse-movies-csv)
==34807==    by 0x4988FB4: __run_exit_handlers (exit.c:113)
==34807==    by 0x4989129: exit (exit.c:143)
==34807==    by 0x4972210: (below main) (libc_start_call_main.h:74)
</code></pre></div>



<a name="305215210"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/%E2%9C%94%20Missing%20Str.graphemes/near/305215210" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/.E2.9C.94.20Missing.20Str.2Egraphemes.html#305215210">(Oct 20 2022 at 18:44)</a>:</h4>
<p>Based on some googling, this seems to happen when something in an app is trying to write to or execute from a section without those permissions. For example, if you have a string constant and try to write to it. The constant would be in a read only section and this would happen.</p>



<a name="305216860"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/%E2%9C%94%20Missing%20Str.graphemes/near/305216860" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/.E2.9C.94.20Missing.20Str.2Egraphemes.html#305216860">(Oct 20 2022 at 18:53)</a>:</h4>
<p>Ok so. when unloading, the app loads the <code>FINI</code> address: <code>FINI                 0x0000000000019010</code>. It adds some value to that and then calls it as a function.</p>



<a name="305217004"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/%E2%9C%94%20Missing%20Str.graphemes/near/305217004" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/.E2.9C.94.20Missing.20Str.2Egraphemes.html#305217004">(Oct 20 2022 at 18:54)</a>:</h4>
<p>It looks to be successfully jumping to the <code>fini</code> function, which based on the address looks like it is in an executable section, yet when trying to run the first instruction to increment the stack, it crashes.</p>



<a name="305223765"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/%E2%9C%94%20Missing%20Str.graphemes/near/305223765" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/.E2.9C.94.20Missing.20Str.2Egraphemes.html#305223765">(Oct 20 2022 at 19:35)</a>:</h4>
<p>Summary:<br>
I can see what is broken. It doesn't look to me like it should be broken. I am quite confused how this change led to the breakage.</p>



<a name="305223935"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/%E2%9C%94%20Missing%20Str.graphemes/near/305223935" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/.E2.9C.94.20Missing.20Str.2Egraphemes.html#305223935">(Oct 20 2022 at 19:36)</a>:</h4>
<p>Cause:<br>
New function, surgical linker, and optimized build leading to segfault when trying to exit the program.</p>



<a name="305238746"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/%E2%9C%94%20Missing%20Str.graphemes/near/305238746" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/.E2.9C.94.20Missing.20Str.2Egraphemes.html#305238746">(Oct 20 2022 at 21:11)</a>:</h4>
<p>could it possibly have something to do with the large arrays in <a href="https://github.com/roc-lang/roc/blob/main/crates/compiler/builtins/bitcode/src/helpers/grapheme.zig">helpers/grapheme.zig</a>? doesn't seem likely as this file existed and was used prior to this pr.</p>



<a name="305238957"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/%E2%9C%94%20Missing%20Str.graphemes/near/305238957" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/.E2.9C.94.20Missing.20Str.2Egraphemes.html#305238957">(Oct 20 2022 at 21:12)</a>:</h4>
<p>like maybe we're trampling/overflowing the stack?</p>



<a name="305238989"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/%E2%9C%94%20Missing%20Str.graphemes/near/305238989" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/.E2.9C.94.20Missing.20Str.2Egraphemes.html#305238989">(Oct 20 2022 at 21:12)</a>:</h4>
<p>i remember zig having some issues with very large arrays at some point. not likely, just a thought.</p>



<a name="305240353"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/%E2%9C%94%20Missing%20Str.graphemes/near/305240353" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Carroll <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/.E2.9C.94.20Missing.20Str.2Egraphemes.html#305240353">(Oct 20 2022 at 21:21)</a>:</h4>
<p>Ok this is a stupid idea but ... the last change was the one to rename that export. And we're having some kind of linker issue. Wanna try changing it back as an experiment? If we don't learn anything we can change back again.</p>



<a name="305240800"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/%E2%9C%94%20Missing%20Str.graphemes/near/305240800" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/.E2.9C.94.20Missing.20Str.2Egraphemes.html#305240800">(Oct 20 2022 at 21:24)</a>:</h4>
<p>ok sounds good. will try it out..</p>



<a name="305241494"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/%E2%9C%94%20Missing%20Str.graphemes/near/305241494" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/.E2.9C.94.20Missing.20Str.2Egraphemes.html#305241494">(Oct 20 2022 at 21:29)</a>:</h4>
<p>ok just pushed. ci needs approval.</p>



<a name="305247415"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/%E2%9C%94%20Missing%20Str.graphemes/near/305247415" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/.E2.9C.94.20Missing.20Str.2Egraphemes.html#305247415">(Oct 20 2022 at 22:20)</a>:</h4>
<p>no luck. same errors on linux.  i wondered about this too but forgot to bring it up. glad we ruled it out anyway.</p>



<a name="305248100"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/%E2%9C%94%20Missing%20Str.graphemes/near/305248100" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/.E2.9C.94.20Missing.20Str.2Egraphemes.html#305248100">(Oct 20 2022 at 22:25)</a>:</h4>
<p>Is this the first time importing the grapheme.zig file? If so, it is probably generating something that breaks the surgical linker (still not sure how given everything runs and it only crashes on exiting). Also, it breaks test that theoretically shouldn't include any code generated from it.</p>



<a name="305248313"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/%E2%9C%94%20Missing%20Str.graphemes/near/305248313" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/.E2.9C.94.20Missing.20Str.2Egraphemes.html#305248313">(Oct 20 2022 at 22:27)</a>:</h4>
<p>no helpers/grapheme.zig was there previous to this pr. its used in str.zig#countGraphemeClusters()</p>



<a name="305248568"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/%E2%9C%94%20Missing%20Str.graphemes/near/305248568" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/.E2.9C.94.20Missing.20Str.2Egraphemes.html#305248568">(Oct 20 2022 at 22:28)</a>:</h4>
<p><a href="https://github.com/roc-lang/roc/blob/main/crates/compiler/builtins/bitcode/src/str.zig#L1216">https://github.com/roc-lang/roc/blob/main/crates/compiler/builtins/bitcode/src/str.zig#L1216</a></p>



<a name="305248792"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/%E2%9C%94%20Missing%20Str.graphemes/near/305248792" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/.E2.9C.94.20Missing.20Str.2Egraphemes.html#305248792">(Oct 20 2022 at 22:30)</a>:</h4>
<p>Ah, it just wasn't imported at the top of the file. Ok</p>



<a name="305252840"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/%E2%9C%94%20Missing%20Str.graphemes/near/305252840" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/.E2.9C.94.20Missing.20Str.2Egraphemes.html#305252840">(Oct 20 2022 at 23:08)</a>:</h4>
<p>Ok, i figured something out</p>



<a name="305252935"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/%E2%9C%94%20Missing%20Str.graphemes/near/305252935" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/.E2.9C.94.20Missing.20Str.2Egraphemes.html#305252935">(Oct 20 2022 at 23:09)</a>:</h4>
<p>When we compile a c/c++ host, we always build it with the built-ins object file. This is not wanted for the llvm backend. The llvm backend already loads the built-ins through the llvm bitcode.</p>



<a name="305253042"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/%E2%9C%94%20Missing%20Str.graphemes/near/305253042" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/.E2.9C.94.20Missing.20Str.2Egraphemes.html#305253042">(Oct 20 2022 at 23:10)</a>:</h4>
<p>Somehow (haven't figured out why yet), if we compile the c/c++ host with the new builtins object generated from the new PR, it is broken.</p>



<a name="305253068"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/%E2%9C%94%20Missing%20Str.graphemes/near/305253068" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/.E2.9C.94.20Missing.20Str.2Egraphemes.html#305253068">(Oct 20 2022 at 23:10)</a>:</h4>
<p>Simply not compiling it with the built-ins object is a fix.</p>



<a name="305253161"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/%E2%9C%94%20Missing%20Str.graphemes/near/305253161" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/.E2.9C.94.20Missing.20Str.2Egraphemes.html#305253161">(Oct 20 2022 at 23:11)</a>:</h4>
<p>This may mean we will run into more related problems when the dev backend is more complete, but I don't think we need to worry about that too much for now.</p>



<a name="305253293"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/%E2%9C%94%20Missing%20Str.graphemes/near/305253293" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/.E2.9C.94.20Missing.20Str.2Egraphemes.html#305253293">(Oct 20 2022 at 23:13)</a>:</h4>
<p>So for now, a fix should be to comment out <code>link.rs</code> line 437.</p>



<a name="305265734"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/%E2%9C%94%20Missing%20Str.graphemes/near/305265734" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/.E2.9C.94.20Missing.20Str.2Egraphemes.html#305265734">(Oct 21 2022 at 01:08)</a>:</h4>
<p>should i try commenting out that line in this pr? maybe just temporarily to see if it passes the ci.</p>



<a name="305266152"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/%E2%9C%94%20Missing%20Str.graphemes/near/305266152" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/.E2.9C.94.20Missing.20Str.2Egraphemes.html#305266152">(Oct 21 2022 at 01:10)</a>:</h4>
<p>i'll give it a try. if anyone sees this and can approve the ci run in a few minutes that would be appreciated.</p>



<a name="305266499"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/%E2%9C%94%20Missing%20Str.graphemes/near/305266499" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/.E2.9C.94.20Missing.20Str.2Egraphemes.html#305266499">(Oct 21 2022 at 01:11)</a>:</h4>
<p>awaiting ci approval: <a href="https://github.com/roc-lang/roc/pull/4364">https://github.com/roc-lang/roc/pull/4364</a></p>



<a name="305271537"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/%E2%9C%94%20Missing%20Str.graphemes/near/305271537" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/.E2.9C.94.20Missing.20Str.2Egraphemes.html#305271537">(Oct 21 2022 at 02:19)</a>:</h4>
<p><span class="user-mention silent" data-user-id="343810">Brendan Hansknecht</span> <a href="#narrow/stream/316715-contributing/topic/Missing.20Str.2Egraphemes/near/305253293">said</a>:</p>
<blockquote>
<p>So for now, a fix should be to comment out <code>link.rs</code> line 437.</p>
</blockquote>
<p>This worked! Nice job.</p>



<a name="305271677"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/%E2%9C%94%20Missing%20Str.graphemes/near/305271677" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/.E2.9C.94.20Missing.20Str.2Egraphemes.html#305271677">(Oct 21 2022 at 02:21)</a>:</h4>
<p><span class="user-mention" data-user-id="343810">@Brendan Hansknecht</span> <span class="user-mention" data-user-id="431893">@Brian Carroll</span>  do you guys want me to leave this link.rs:437 as is or should we put that in a separate pr?  As is, that line is included (commented out) and i've removed the <code>str_</code> prefixed symbol.</p>



<a name="305275385"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/%E2%9C%94%20Missing%20Str.graphemes/near/305275385" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/.E2.9C.94.20Missing.20Str.2Egraphemes.html#305275385">(Oct 21 2022 at 03:21)</a>:</h4>
<p>Should be fine to change in this pr. Can you add a comment. Something like:<br>
With the addition of Str.graphemes, always linking the built-ins led to a surgical linker bug for optimized builds. Disabling until it is needed for dev builds.</p>



<a name="305401445"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/%E2%9C%94%20Missing%20Str.graphemes/near/305401445" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/.E2.9C.94.20Missing.20Str.2Egraphemes.html#305401445">(Oct 21 2022 at 16:53)</a>:</h4>
<p>does anyone have any guidance for this idea: <a href="https://github.com/roc-lang/roc/pull/4364#issuecomment-1286453759">https://github.com/roc-lang/roc/pull/4364#issuecomment-1286453759</a> ?</p>



<a name="305401603"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/%E2%9C%94%20Missing%20Str.graphemes/near/305401603" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/.E2.9C.94.20Missing.20Str.2Egraphemes.html#305401603">(Oct 21 2022 at 16:54)</a>:</h4>
<p>i just wanted to add a little bit more test coverage for strGraphemes() and it makes sense to me to combine with the existing countGraphemeClusters() tests.</p>



<a name="305405292"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/%E2%9C%94%20Missing%20Str.graphemes/near/305405292" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/.E2.9C.94.20Missing.20Str.2Egraphemes.html#305405292">(Oct 21 2022 at 17:12)</a>:</h4>
<p>i combined the tests. can easily change it back if necessary - let me know.</p>



<a name="305406351"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/%E2%9C%94%20Missing%20Str.graphemes/near/305406351" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/.E2.9C.94.20Missing.20Str.2Egraphemes.html#305406351">(Oct 21 2022 at 17:18)</a>:</h4>
<p>have you thought about writing the tests in Roc (using <code>expect</code> inside <code>Str.roc</code>, similar to how we are in some other places in that file) instead of zig?</p>



<a name="305407247"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/%E2%9C%94%20Missing%20Str.graphemes/near/305407247" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/.E2.9C.94.20Missing.20Str.2Egraphemes.html#305407247">(Oct 21 2022 at 17:22)</a>:</h4>
<p>no i hadn't noticed those tests in <code>Str.roc</code>.  if that is the preferred way, i can move them there.</p>



<a name="305407657"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/%E2%9C%94%20Missing%20Str.graphemes/near/305407657" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/.E2.9C.94.20Missing.20Str.2Egraphemes.html#305407657">(Oct 21 2022 at 17:25)</a>:</h4>
<p>note that it is nice to have the tests in zig for the all the devs (likely just me <span aria-label="smirk" class="emoji emoji-1f60f" role="img" title="smirk">:smirk:</span> ) who don't have a rust toolchain installed.</p>



<a name="305409804"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/%E2%9C%94%20Missing%20Str.graphemes/near/305409804" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/.E2.9C.94.20Missing.20Str.2Egraphemes.html#305409804">(Oct 21 2022 at 17:36)</a>:</h4>
<p>you should be able to run the <code>Str.roc</code> tests with the normal nightly builds of the compiler I think!</p>



<a name="305409836"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/%E2%9C%94%20Missing%20Str.graphemes/near/305409836" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/.E2.9C.94.20Missing.20Str.2Egraphemes.html#305409836">(Oct 21 2022 at 17:36)</a>:</h4>
<p><code>roc test path/to/Str.roc</code></p>



<a name="305411907"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/%E2%9C%94%20Missing%20Str.graphemes/near/305411907" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/.E2.9C.94.20Missing.20Str.2Egraphemes.html#305411907">(Oct 21 2022 at 17:48)</a>:</h4>
<p>ah. <span aria-label="light bulb" class="emoji emoji-1f4a1" role="img" title="light bulb">:light_bulb:</span>  i forgot that <code>str.zig</code> is compiled on the fly with the platform.</p>



<a name="305412580"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/%E2%9C%94%20Missing%20Str.graphemes/near/305412580" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/.E2.9C.94.20Missing.20Str.2Egraphemes.html#305412580">(Oct 21 2022 at 17:52)</a>:</h4>
<p>oh wait oops, I don't think the nightly will work if you need to incorporate new zig builtin code</p>



<a name="305610368"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/%E2%9C%94%20Missing%20Str.graphemes/near/305610368" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/.E2.9C.94.20Missing.20Str.2Egraphemes.html#305610368">(Oct 23 2022 at 02:39)</a>:</h4>
<p>think i got commit signing straightened out (...again <span aria-label="sweat smile" class="emoji emoji-1f605" role="img" title="sweat smile">:sweat_smile:</span> ) if anyone can approve the ci: <a href="https://github.com/roc-lang/roc/pull/4364">https://github.com/roc-lang/roc/pull/4364</a></p>



<a name="305637454"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/%E2%9C%94%20Missing%20Str.graphemes/near/305637454" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Notification Bot <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/.E2.9C.94.20Missing.20Str.2Egraphemes.html#305637454">(Oct 23 2022 at 08:58)</a>:</h4>
<p><span class="user-mention silent" data-user-id="551190">Prajwal S N</span> has marked this topic as resolved.</p>



<hr><p>Last updated: Mar 01 2026 at 12:20 UTC</p>
</html>