<html>
<head><meta charset="utf-8"><title>CI · contributing · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/index.html">contributing</a></h2>
<h3>Topic: <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/CI.html">CI</a></h3>

<hr>

<base href="https://roc.zulipchat.com">

<head><link href="https://roc-lang.github.io/zulip-export/style.css" rel="stylesheet"></head>

<a name="402901659"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/CI/near/402901659" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anton <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/CI.html#402901659">(Nov 18 2023 at 18:31)</a>:</h4>
<p>If any of you were getting "No space left on device" errors for apple silicon test, that should now be resolved.</p>



<a name="403536852"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/CI/near/403536852" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Norbert Hajagos <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/CI.html#403536852">(Nov 22 2023 at 07:42)</a>:</h4>
<p><span class="user-mention" data-user-id="361169">@Anton</span>  I just got one for <a href="https://github.com/roc-lang/roc/pull/5983">https://github.com/roc-lang/roc/pull/5983</a>. They ran ~8 hours ago with the last commit from main being 2afd9ca0a9b846fc4127b3d7fb55c521c6ae9ff9, which was done on Nov 20.<br>
Here are the two failed runs: <a href="https://github.com/roc-lang/roc/actions/runs/6942320780">devtools macos</a> and <a href="https://github.com/roc-lang/roc/actions/runs/6942320773">nix macos applse silicon</a>.<br>
 I re-merged main into the PR branch, so the workflows are waiting for approval again, but idk if that fixes anything</p>



<a name="403552426"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/CI/near/403552426" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anton <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/CI.html#403552426">(Nov 22 2023 at 09:27)</a>:</h4>
<p>I've approved the run, I think merging main should fix it, I very recently added a clean up step that should prevent "No space left on device".</p>



<a name="403571539"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/CI/near/403571539" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anton <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/CI.html#403571539">(Nov 22 2023 at 11:16)</a>:</h4>
<p>The apple silicon CI server is not picking up jobs, I'm investigating...</p>



<a name="403573362"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/CI/near/403573362" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anton <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/CI.html#403573362">(Nov 22 2023 at 11:29)</a>:</h4>
<p>Should be fixed now</p>



<a name="403573686"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/CI/near/403573686" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Norbert Hajagos <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/CI.html#403573686">(Nov 22 2023 at 11:31)</a>:</h4>
<p>Cool! Do I need to merge main, or do anything?</p>



<a name="403581716"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/CI/near/403581716" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anton <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/CI.html#403581716">(Nov 22 2023 at 12:24)</a>:</h4>
<p>No, your jobs are in the queue and will be started automatically</p>



<a name="403592477"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/CI/near/403592477" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/CI.html#403592477">(Nov 22 2023 at 13:29)</a>:</h4>
<p>maybe we should add some <code>paths-ignore</code> to our workflows so we don't run them when only <code>.md</code> files change, e.g.</p>
<div class="codehilite" data-code-language="YAML"><pre><span></span><code><span class="nt">on</span><span class="p">:</span>
<span class="w">  </span><span class="nt">push</span><span class="p">:</span>
<span class="w">    </span><span class="nt">branches</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">main</span>
<span class="w">    </span><span class="nt">paths-ignore</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">'**/*.md'</span>
<span class="w">  </span><span class="nt">pull_request</span><span class="p">:</span>
<span class="w">    </span><span class="nt">branches</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">main</span>
<span class="w">    </span><span class="nt">paths-ignore</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">'**/*.md'</span>
</code></pre></div>
<p>we might need to make an exception for a workflow that rebuilds the website, since we have <code>.md</code> files which go into that</p>



<a name="403599303"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/CI/near/403599303" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anton <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/CI.html#403599303">(Nov 22 2023 at 14:06)</a>:</h4>
<p>paths-ignore will <a href="https://github.com/orgs/community/discussions/8832">not work unfortunately</a> but a more convoluted solution using <code>if:</code> should be possible. I'll try to look at that this week.</p>



<a name="403723125"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/CI/near/403723125" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/CI.html#403723125">(Nov 23 2023 at 06:20)</a>:</h4>
<p>Is it possible to also not run CI on Draft PR's? I just cancelled CI for something that is WIP, but I wanted to push it to a PR to record my progress.</p>



<a name="403723255"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/CI/near/403723255" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/CI.html#403723255">(Nov 23 2023 at 06:21)</a>:</h4>
<p>Apparently this could work </p>
<div class="codehilite"><pre><span></span><code>on:
  push:
    branches:
      - main
  pull_request:
    branches: [main]
    paths:
      - &quot;**&quot;
      - &quot;!/*.md&quot;
      - &quot;!/**.md&quot;
    types:
      - ready_for_review
</code></pre></div>
<p>But you have to create them as Draft and then click "Ready for Review".... hmmm, I'm not good with this stuff</p>



<a name="403736928"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/CI/near/403736928" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Carroll <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/CI.html#403736928">(Nov 23 2023 at 08:10)</a>:</h4>
<blockquote>
<p>But you have to create them as Draft and then click "Ready for Review".... hmmm, I'm not good with this stuff</p>
</blockquote>
<p>GitHub's <a href="https://github.blog/2019-02-14-introducing-draft-pull-requests/">blog post</a>, from when they first announced the feature, shows a screenshot of how to do it. It still looks the same. Once you create it, the "ready for review" button appears near the bottom of the PR page.</p>



<a name="403946791"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/CI/near/403946791" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anton <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/CI.html#403946791">(Nov 24 2023 at 11:10)</a>:</h4>
<blockquote>
<p>Apparently this could work </p>
</blockquote>
<p>I think there are some problems with that approach. Including <code>[skip ci]</code> in your commit message is a simple and effective way.</p>



<a name="404001334"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/CI/near/404001334" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ayaz Hafiz <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/CI.html#404001334">(Nov 24 2023 at 17:27)</a>:</h4>
<p>For knowledge, what are the problems with the approach Luke listed?</p>



<a name="404006439"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/CI/near/404006439" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anton <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/CI.html#404006439">(Nov 24 2023 at 18:21)</a>:</h4>
<p><code>push</code> is only triggered after the PR is merged, which would be too late :p <br>
If there are only md file changes, required checks (github settings) would not be completed, because of <a href="https://github.com/orgs/community/discussions/8832">this issue</a>. If you have only md changes, we could then run tests with the "ready for review" button but newcomers will then press this too early. I'm also not sure if anybody but the author can trigger "ready for review". Lots of people don't have CI privileges so "ready for review" will not actually start CI.</p>
<p>But I will hopefully be able to prevent unnecessary runs with some changes to CI tomorrow.</p>



<a name="404144235"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/CI/near/404144235" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anton <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/CI.html#404144235">(Nov 25 2023 at 19:17)</a>:</h4>
<p>I've got a working prototype of the smarter orchestration, I will set it up in full next week<br>
<a href="/user_uploads/22008/1kHYO6qJ3c5aFKfrI9OJpJPZ/Screenshot_20231125_201542.png">Screenshot_20231125_201542.png</a></p>
<div class="message_inline_image"><a href="/user_uploads/22008/1kHYO6qJ3c5aFKfrI9OJpJPZ/Screenshot_20231125_201542.png" title="Screenshot_20231125_201542.png"><img src="/user_uploads/22008/1kHYO6qJ3c5aFKfrI9OJpJPZ/Screenshot_20231125_201542.png"></a></div>



<a name="404145217"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/CI/near/404145217" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/CI.html#404145217">(Nov 25 2023 at 19:24)</a>:</h4>
<p>That looks really great!</p>



<a name="437991416"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/CI/near/437991416" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anton <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/CI.html#437991416">(May 10 2024 at 14:27)</a>:</h4>
<p>Ci issues with the failing static_site_gen test have been resolved :)<br>
You can use the "update branch" button to get the fix on your branch.</p>



<a name="443309115"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/CI/near/443309115" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anton <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/CI.html#443309115">(Jun 07 2024 at 14:24)</a>:</h4>
<p>macos-11 is deprecated by github CI and will soon be removed so I'm going to remove it from all our workflows.</p>



<a name="443661064"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/CI/near/443661064" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/CI.html#443661064">(Jun 10 2024 at 00:28)</a>:</h4>
<p>Looks like we have a common issue with CI missing <code>xcrun</code> on the X86-64 MacOS machine</p>



<a name="443694553"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/CI/near/443694553" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anton <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/CI.html#443694553">(Jun 10 2024 at 06:48)</a>:</h4>
<p>Yeah that will be due to the upgrade to macos 12, I'll check it out.</p>



<a name="443736045"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/CI/near/443736045" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anton <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/CI.html#443736045">(Jun 10 2024 at 10:27)</a>:</h4>
<p>The xcrun issue has been fixed, I'm doing a full test run now to see if any issues come up</p>



<a name="443742040"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/CI/near/443742040" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anton <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/CI.html#443742040">(Jun 10 2024 at 10:48)</a>:</h4>
<p>Test run succeeded :)</p>



<a name="489232719"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/CI/near/489232719" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anton <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/CI.html#489232719">(Dec 16 2024 at 13:11)</a>:</h4>
<p>You may hit this issue when running CI on macos <a href="https://github.com/roc-lang/roc/issues/7380">#7380</a>:</p>
<div class="codehilite"><pre><span></span><code>error: failed to run custom build command for `roc_bitcode_bc v0.0.1 (/Users/m1ci/actions-runner2/_work/roc/roc/crates/compiler/builtins/bitcode/bc)`
note: To improve backtraces for build dependencies, set the CARGO_PROFILE_RELEASE-WITH-LTO_BUILD_OVERRIDE_DEBUG=true environment variable to enable debug information generation.

Caused by:
  process didn&#39;t exit successfully: `/Users/m1ci/actions-runner2/_work/roc/roc/target/release-with-lto/build/roc_bitcode_bc-8ac377685705d80e/build-script-build` (exit status: 1)
  --- stdout
  cargo:rerun-if-changed=build.rs
  Compiling host ir to: /Users/m1ci/actions-runner2/_work/roc/roc/crates/compiler/builtins/bitcode/bc/../zig-out/builtins-host.ll
  Compiling 64-bit bitcode to: /Users/m1ci/actions-runner2/_work/roc/roc/crates/compiler/builtins/bitcode/bc/../zig-out/builtins-host.bc
  Compiling host ir to: /Users/m1ci/actions-runner2/_work/roc/roc/crates/compiler/builtins/bitcode/bc/../zig-out/builtins-wasm32.ll
  Compiling 64-bit bitcode to: /Users/m1ci/actions-runner2/_work/roc/roc/crates/compiler/builtins/bitcode/bc/../zig-out/builtins-wasm32.bc

  --- stderr
  An internal compiler expectation was broken.
  This is definitely a compiler bug.
  Please file an issue here: &lt;https://github.com/roc-lang/roc/issues/new/choose&gt;
  zig build ir-wasm32 -Drelease=true failed with:
</code></pre></div>
<p>I'm investigating it now</p>



<a name="489256747"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/CI/near/489256747" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anton <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/CI.html#489256747">(Dec 16 2024 at 14:51)</a>:</h4>
<p>i've disconnected the macos apple Silicon CI server so I don't have to debug this in my garage</p>



<a name="489317418"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/CI/near/489317418" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anton <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/CI.html#489317418">(Dec 16 2024 at 18:54)</a>:</h4>
<p>That server is back up, the bug did not want to reproduce for me, just going add a retry workaround...</p>



<a name="489318758"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/CI/near/489318758" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anton <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/CI.html#489318758">(Dec 16 2024 at 19:00)</a>:</h4>
<p>It is interesting to see the amount of flaky errors we accumulated in builtins/bitcode/build.rs:</p>
<div class="codehilite"><pre><span></span><code> error_str.contains(&quot;FileNotFound&quot;)
 || error_str.contains(&quot;unable to save cached ZIR code&quot;)
 || error_str.contains(&quot;LLVM failed to emit asm&quot;)
 || error_str.contains(&quot;ir-wasm32 transitive failure&quot;)
</code></pre></div>
<p>Perhaps they share the same parallelism weirdness</p>



<a name="490202121"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/CI/near/490202121" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anton <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/CI.html#490202121">(Dec 20 2024 at 17:20)</a>:</h4>
<p>I've seen a bunch more failures with builtins bitcode on macos, I'm working on a new workaround</p>
<blockquote>
<p>It is interesting to see the amount of flaky errors we accumulated in builtins/bitcode/build.rs:</p>
<div class="codehilite"><pre><span></span><code> error_str.contains(&quot;FileNotFound&quot;)
 || error_str.contains(&quot;unable to save cached ZIR code&quot;)
 || error_str.contains(&quot;LLVM failed to emit asm&quot;)
 || error_str.contains(&quot;ir-wasm32 transitive failure&quot;)
</code></pre></div>
<p>Perhaps they share the same parallelism weirdness</p>
</blockquote>



<a name="490203916"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/CI/near/490203916" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/CI.html#490203916">(Dec 20 2024 at 17:32)</a>:</h4>
<p>Hopefully we can fix the root at some point</p>



<a name="491272282"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/CI/near/491272282" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anton <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/CI.html#491272282">(Dec 30 2024 at 11:42)</a>:</h4>
<p>Heads up: CI is broken on main on nix apple silicon main, I'll check it out</p>



<a name="491282547"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/CI/near/491282547" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anton <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/CI.html#491282547">(Dec 30 2024 at 13:30)</a>:</h4>
<p>This was due to 723e35f <a href="https://github.com/roc-lang/roc/pull/7424">PR#7424</a> I'm going to revert it</p>



<a name="491289489"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/CI/near/491289489" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anton <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/CI.html#491289489">(Dec 30 2024 at 14:36)</a>:</h4>
<p>Fixed in <a href="https://github.com/roc-lang/roc/issues/7435">#7435</a></p>



<a name="491866605"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/CI/near/491866605" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jakub Konka <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/CI.html#491866605">(Jan 04 2025 at 10:47)</a>:</h4>
<p>Is it just me or does it look like sometimes it takes a workflow over 1.5h to just compile roc, and sometimes it is almost instant. Is this some caching issue perhaps that then leads to some flakiness? On the other hand, I also occasionally see the following</p>
<div class="codehilite"><pre><span></span><code>error: failed to run custom build command for `roc_bitcode_bc v0.0.1 (/Users/m1ci/actions-runner2/_work/roc/roc/crates/compiler/builtins/bitcode/bc)`
note: To improve backtraces for build dependencies, set the CARGO_PROFILE_RELEASE_BUILD_OVERRIDE_DEBUG=true environment variable to enable debug information generation.

Caused by:
  process didn&#39;t exit successfully: `/Users/m1ci/actions-runner2/_work/roc/roc/target/release/build/roc_bitcode_bc-01dfdbf045b35be2/build-script-build` (exit status: 1)
  --- stdout
  cargo:rerun-if-changed=build.rs
  Compiling host ir to: /Users/m1ci/actions-runner2/_work/roc/roc/crates/compiler/builtins/bitcode/bc/../zig-out/builtins-host.ll
  Compiling 64-bit bitcode to: /Users/m1ci/actions-runner2/_work/roc/roc/crates/compiler/builtins/bitcode/bc/../zig-out/builtins-host.bc
  Compiling host ir to: /Users/m1ci/actions-runner2/_work/roc/roc/crates/compiler/builtins/bitcode/bc/../zig-out/builtins-wasm32.ll
  Compiling 64-bit bitcode to: /Users/m1ci/actions-runner2/_work/roc/roc/crates/compiler/builtins/bitcode/bc/../zig-out/builtins-wasm32.bc

  --- stderr
  An internal compiler expectation was broken.
  This is definitely a compiler bug.
  Please file an issue here: &lt;https://github.com/roc-lang/roc/issues/new/choose&gt;
  zig build ir-wasm32 -Drelease=true failed with:

    error: Unexpected


  Location: crates/compiler/builtins/bitcode/bc/build.rs:115:21
</code></pre></div>



<a name="491866680"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/CI/near/491866680" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anton <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/CI.html#491866680">(Jan 04 2025 at 10:48)</a>:</h4>
<blockquote>
<p>it takes a workflow over 1.5h to just compile roc</p>
</blockquote>
<p>Does it get stuck, or does it actually finish in that time?</p>



<a name="491866837"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/CI/near/491866837" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anton <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/CI.html#491866837">(Jan 04 2025 at 10:50)</a>:</h4>
<p>The <code>bitcode/bc/build.rs</code> issue is caused by multithreading but I don't know much more than that</p>



<a name="491866883"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/CI/near/491866883" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anton <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/CI.html#491866883">(Jan 04 2025 at 10:51)</a>:</h4>
<blockquote>
<p>Is this some caching issue</p>
</blockquote>
<p>It's not due to a cache that we use for CI fyi, just seems to be a problematic interaction with the rust and zig build processes</p>



<a name="491866973"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/CI/near/491866973" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anton <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/CI.html#491866973">(Jan 04 2025 at 10:53)</a>:</h4>
<p>We used to have a bandaid solution for this problem but it stopped working since the llvm 18 zig 13 upgrade</p>



<a name="491867060"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/CI/near/491867060" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jakub Konka <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/CI.html#491867060">(Jan 04 2025 at 10:54)</a>:</h4>
<p><span class="user-mention silent" data-user-id="361169">Anton</span> <a href="#narrow/channel/316715-contributing/topic/CI/near/491866973">said</a>:</p>
<blockquote>
<p>We used to have a bandaid solution for this problem but it stopped working since the llvm 18 zig 13 upgrade</p>
</blockquote>
<p>Interesting, and what was the bandaid solution?</p>



<a name="491867075"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/CI/near/491867075" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jakub Konka <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/CI.html#491867075">(Jan 04 2025 at 10:54)</a>:</h4>
<p><span class="user-mention silent" data-user-id="361169">Anton</span> <a href="#narrow/channel/316715-contributing/topic/CI/near/491866680">said</a>:</p>
<blockquote>
<blockquote>
<p>it takes a workflow over 1.5h to just compile roc</p>
</blockquote>
<p>Does it get stuck, or does it actually finish in that time?</p>
</blockquote>
<p>I've seen it do both: finish and not finish in time</p>



<a name="491867358"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/CI/near/491867358" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anton <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/CI.html#491867358">(Jan 04 2025 at 10:59)</a>:</h4>
<blockquote>
<p>Interesting, and what was the bandaid solution?</p>
</blockquote>
<p><a href="https://github.com/roc-lang/roc/blob/6ecf25bd3eeab2b3f4d73615a0a60ec61b77f06b/crates/compiler/builtins/bitcode/build.rs#L162">Retry the failing command up to 10 times</a></p>



<a name="491867769"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/CI/near/491867769" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jakub Konka <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/CI.html#491867769">(Jan 04 2025 at 11:05)</a>:</h4>
<p>Ahh classic. FWIW I've seen a similar solution used in the past <a href="https://github.com/rust-lang/rust/pull/40422/files">https://github.com/rust-lang/rust/pull/40422/files</a> Interestingely, last I checked this bit of code is still present in the rustc implementation.</p>



<a name="491870728"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/CI/near/491870728" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jakub Konka <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/CI.html#491870728">(Jan 04 2025 at 11:50)</a>:</h4>
<p>Argh, looks like clippy is hanging on the M1 <a href="https://github.com/roc-lang/roc/actions/runs/12608939154/job/35144084934?pr=7455">https://github.com/roc-lang/roc/actions/runs/12608939154/job/35144084934?pr=7455</a></p>



<a name="492123243"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/CI/near/492123243" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anton <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/CI.html#492123243">(Jan 06 2025 at 15:12)</a>:</h4>
<p>I'm going to look at the flaky CI issues now</p>



<a name="492152849"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/CI/near/492152849" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anton <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/CI.html#492152849">(Jan 06 2025 at 17:48)</a>:</h4>
<p>We've picked up a new issue with nix-linux-x86-64-tests:</p>
<div class="codehilite"><pre><span></span><code> test cli_tests::test_platform_effects_zig::effectful_form has been running for over 60 seconds
</code></pre></div>
<p>Looking at it now</p>



<a name="492312058"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/CI/near/492312058" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anton <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/CI.html#492312058">(Jan 07 2025 at 13:42)</a>:</h4>
<p>Fixed in <a href="https://github.com/roc-lang/roc/pull/7475">PR#7475</a></p>



<a name="497496496"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/CI/near/497496496" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anton <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/CI.html#497496496">(Feb 03 2025 at 17:37)</a>:</h4>
<p>I'm going to disconnect the macos x64 CI machine for easier debugging of a build failure.</p>



<a name="497511664"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/CI/near/497511664" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anton <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/CI.html#497511664">(Feb 03 2025 at 19:01)</a>:</h4>
<p>Fixed :)</p>



<a name="497663260"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/CI/near/497663260" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anton <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/CI.html#497663260">(Feb 04 2025 at 13:16)</a>:</h4>
<p>If you get the error below, update your branch with latest main:</p>
<div class="codehilite"><pre><span></span><code>Run zig version
/Users/m1ci/actions-runner2/_work/_temp/f59e70e6-faef-46ea-a406-0a88e0decf65.sh: line 1: zig: command not found
Error: Process completed with exit code 127.
</code></pre></div>



<a name="498428356"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/CI/near/498428356" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anton <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/CI.html#498428356">(Feb 07 2025 at 21:19)</a>:</h4>
<p>The new CI workflow is on main :)<br>
.github/workflows/ci_zig.yml is called if there are changes to the src folder, build.zig or build.zig.zon; modify the two lists <a href="https://github.com/roc-lang/roc/blob/8d4974b0ec06d480381fde1b8274b60e4232ae8e/.github/workflows/ci_manager.yml#L25">here</a> if you want to alter that change detection. The old workflows are not called if the changes are only to new compiler files.</p>
<p>If you want to add additional CI checks for the new compiler they can be added <a href="https://github.com/roc-lang/roc/blob/8d4974b0ec06d480381fde1b8274b60e4232ae8e/.github/workflows/ci_zig.yml#L18">here</a>.</p>
<p>I did a bunch of testing, but I may still have missed something, so feel free to mention me if you think something's off.</p>



<a name="498430435"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/CI/near/498430435" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/CI.html#498430435">(Feb 07 2025 at 21:36)</a>:</h4>
<p>As a note, I think you can just <code>zig build test</code> instead of doing any sort of direct exe running or oa based checks</p>



<a name="498499848"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/CI/near/498499848" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anton <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/CI.html#498499848">(Feb 08 2025 at 12:55)</a>:</h4>
<p>I'm going to disconnect macos x64 CI for investigation again, it's hitting the same issue as before. If your changes are limited to the new compiler files, CI should still be able to complete.</p>



<a name="498523891"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/CI/near/498523891" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anton <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/CI.html#498523891">(Feb 08 2025 at 18:24)</a>:</h4>
<p>macos x64 CI is back up but I'm still trying workarounds</p>



<a name="501587126"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/CI/near/501587126" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anton <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/CI.html#501587126">(Feb 24 2025 at 16:16)</a>:</h4>
<p>Going to do some CI maintenance, this should not affect zig compiler workflows, those all use github CI machines</p>



<a name="501592830"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/CI/near/501592830" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anton <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/CI.html#501592830">(Feb 24 2025 at 16:37)</a>:</h4>
<p>Done</p>



<a name="503324303"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/CI/near/503324303" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anton <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/CI.html#503324303">(Mar 04 2025 at 17:27)</a>:</h4>
<p>Looks like a recent github image runner update broke something on our windows-2022 tests, I'm looking at it now</p>



<a name="503337291"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/CI/near/503337291" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anton <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/CI.html#503337291">(Mar 04 2025 at 18:35)</a>:</h4>
<p>It's only on my PR but it doesn't make any sense given the changes <span aria-label="thinking" class="emoji emoji-1f914" role="img" title="thinking">:thinking:</span></p>



<a name="503338349"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/CI/near/503338349" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/CI.html#503338349">(Mar 04 2025 at 18:40)</a>:</h4>
<p>Rust or zig? Also, have a link?</p>



<a name="503338613"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/CI/near/503338613" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anton <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/CI.html#503338613">(Mar 04 2025 at 18:41)</a>:</h4>
<p>zig<br>
<a href="https://github.com/roc-lang/roc/actions/runs/13658753462/job/38188514556">https://github.com/roc-lang/roc/actions/runs/13658753462/job/38188514556</a></p>



<a name="503338880"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/CI/near/503338880" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anton <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/CI.html#503338880">(Mar 04 2025 at 18:43)</a>:</h4>
<p>It may be due to random CI machines, some that have the update and some that don't</p>



<a name="503339469"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/CI/near/503339469" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anton <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/CI.html#503339469">(Mar 04 2025 at 18:46)</a>:</h4>
<p>No, they're the same version <span aria-label="sweat smile" class="emoji emoji-1f605" role="img" title="sweat smile">:sweat_smile:</span> <br>
I'm just going to open a new PR, this one is haunted</p>



<a name="503340801"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/CI/near/503340801" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/CI.html#503340801">(Mar 04 2025 at 18:53)</a>:</h4>
<p>Best I can guess is zig cache issue and corrupted download. Worst case, try adding:</p>
<div class="codehilite"><pre><span></span><code>rm -rf .zig-cache zig-out $ZIG_LOCAL_CACHE_DIR
</code></pre></div>
<p>...<br>
Actually, might need to nuke the global cache.</p>



<a name="503341054"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/CI/near/503341054" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/CI.html#503341054">(Mar 04 2025 at 18:55)</a>:</h4>
<p>Not sure it would make a difference, but I know that the mlugg zig cache thing sets some cache folders (I assume it does this cause it saves the folders).</p>



<a name="503341238"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/CI/near/503341238" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anton <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/CI.html#503341238">(Mar 04 2025 at 18:56)</a>:</h4>
<p>Uhu, that could be a likely cause, it passed in the new PR, so I think we're good now but we know where to look if we see it again</p>



<a name="504668056"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/CI/near/504668056" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anton <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/CI.html#504668056">(Mar 10 2025 at 19:11)</a>:</h4>
<p>CI is now calling old rust workflows when it doesn't need to :(<br>
I'll try to fix it tomorrow.</p>



<a name="504743331"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/CI/near/504743331" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/CI.html#504743331">(Mar 11 2025 at 05:13)</a>:</h4>
<p>If you are referring to this PR specifically, There is a zig file from the old compiler that got reformatted: <a href="https://github.com/roc-lang/roc/pull/7672">https://github.com/roc-lang/roc/pull/7672</a></p>



<a name="504743352"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/CI/near/504743352" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/CI.html#504743352">(Mar 11 2025 at 05:13)</a>:</h4>
<p>So CI may be working as expected.</p>



<a name="504744048"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/CI/near/504744048" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/CI.html#504744048">(Mar 11 2025 at 05:19)</a>:</h4>
<p>It's not just that PR. I've had to force merge a couple today that shouldnt have ran the old workflows</p>



<a name="504744136"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/CI/near/504744136" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/CI.html#504744136">(Mar 11 2025 at 05:20)</a>:</h4>
<p>I wanted the changes in main so I could merge for my PR and avoid more conflicts, so I didnt wait for Anton to look at it.</p>



<a name="504745434"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/CI/near/504745434" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/CI.html#504745434">(Mar 11 2025 at 05:31)</a>:</h4>
<p>more-sexprs ran full ci due to editing <code>.gitignore</code></p>



<a name="504745767"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/CI/near/504745767" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/CI.html#504745767">(Mar 11 2025 at 05:33)</a>:</h4>
<p>improve-zig-comments looks like it may have been a path filters bug/issue...</p>



<a name="504746056"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/CI/near/504746056" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/CI.html#504746056">(Mar 11 2025 at 05:36)</a>:</h4>
<p>Oh, found it: <a href="https://github.com/roc-lang/roc/pull/7683">https://github.com/roc-lang/roc/pull/7683</a></p>



<a name="504746081"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/CI/near/504746081" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/CI.html#504746081">(Mar 11 2025 at 05:36)</a>:</h4>
<p>it removed the <code>predicate-quantifier</code></p>



<a name="504746533"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/CI/near/504746533" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/CI.html#504746533">(Mar 11 2025 at 05:40)</a>:</h4>
<p>Fix: <a href="https://github.com/roc-lang/roc/pull/7685">https://github.com/roc-lang/roc/pull/7685</a></p>



<a name="504746897"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/CI/near/504746897" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/CI.html#504746897">(Mar 11 2025 at 05:43)</a>:</h4>
<p>Aside, we may want to go through and explicitly ignore ci an certain files/folders like <code>.gitignore</code>. Would just take expanding the <code>!file</code> list in that filter.</p>



<a name="504778415"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/CI/near/504778415" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anton <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/CI.html#504778415">(Mar 11 2025 at 09:03)</a>:</h4>
<p><span class="user-mention silent" data-user-id="343810">Brendan Hansknecht</span> <a href="#narrow/channel/316715-contributing/topic/CI/near/504746533">said</a>:</p>
<blockquote>
<p>Fix: <a href="https://github.com/roc-lang/roc/pull/7685">https://github.com/roc-lang/roc/pull/7685</a></p>
</blockquote>
<p>Yeah, I removed it because I spotted a warning in CI saying that predicate-quantifier was not a valid option, but now I no longer see it <span aria-label="shrug" class="emoji emoji-1f937" role="img" title="shrug">:shrug:</span></p>



<a name="504879738"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/CI/near/504879738" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/CI.html#504879738">(Mar 11 2025 at 15:42)</a>:</h4>
<p>Yeah, the warning was a bug that got fixed last week</p>



<a name="504879856"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/CI/near/504879856" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/CI.html#504879856">(Mar 11 2025 at 15:42)</a>:</h4>
<p>They added the feature, but forgot to document it, so GitHub didn't know it existed</p>



<a name="504880286"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/CI/near/504880286" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anton <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/CI.html#504880286">(Mar 11 2025 at 15:43)</a>:</h4>
<p>Oh, that makes sense :)</p>



<a name="508060990"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/CI/near/508060990" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anton <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/CI.html#508060990">(Mar 25 2025 at 15:46)</a>:</h4>
<p>I may have finally found a workaround for the nix apple silicon workflow failures (old compiler), it ran successfully 3 times in a row :)</p>



<a name="563238612"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/CI/near/563238612" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/CI.html#563238612">(Dec 11 2025 at 16:53)</a>:</h4>
<p>I see a lot of builds fail with this error, and re-running them tends to fix it - but I wonder if we could enable some caching so that even if the URL in the zon file is down, we're reading it from our own cache and it's ok anyway?<a href="/user_uploads/22008/4Tw8wCEJahDlGy5QGDG-2LBL/Screenshot-2025-12-11-at-11.52.13AM.png">Screenshot 2025-12-11 at 11.52.13 AM.png</a></p>
<div class="message_inline_image"><a href="/user_uploads/22008/4Tw8wCEJahDlGy5QGDG-2LBL/Screenshot-2025-12-11-at-11.52.13AM.png" title="Screenshot 2025-12-11 at 11.52.13 AM.png"><img data-original-content-type="image/png" data-original-dimensions="1884x592" src="/user_uploads/thumbnail/22008/4Tw8wCEJahDlGy5QGDG-2LBL/Screenshot-2025-12-11-at-11.52.13AM.png/840x560.webp"></a></div>



<a name="563428230"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/CI/near/563428230" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anton <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/CI.html#563428230">(Dec 12 2025 at 09:24)</a>:</h4>
<p>I will take a look</p>



<a name="563436001"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/CI/near/563436001" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anton <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/CI.html#563436001">(Dec 12 2025 at 10:05)</a>:</h4>
<p>Can you link to a failure <span class="user-mention" data-user-id="281383">@Richard Feldman</span>, I can not find any when going through <a href="https://github.com/roc-lang/roc/actions">https://github.com/roc-lang/roc/actions</a></p>



<a name="563484619"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/CI/near/563484619" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/CI.html#563484619">(Dec 12 2025 at 14:18)</a>:</h4>
<p>here's one that just came up! <span aria-label="smile" class="emoji emoji-1f604" role="img" title="smile">:smile:</span> </p>
<p><a href="https://github.com/roc-lang/roc/actions/runs/20169309444/job/57900623932?pr=8649">https://github.com/roc-lang/roc/actions/runs/20169309444/job/57900623932?pr=8649</a></p>



<a name="563494256"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/CI/near/563494256" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anton <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/CI.html#563494256">(Dec 12 2025 at 15:01)</a>:</h4>
<p>I fixed our automatic retry action in <a href="https://github.com/roc-lang/roc/pull/8640">https://github.com/roc-lang/roc/pull/8640</a>. I will make an issue on the setup-zig repo to discuss build.zig.zon caching. We already use <code>cache: true</code> there and the failing run was a cache hit, so it is just unsupported for now.</p>



<a name="563495854"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/CI/near/563495854" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anton <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/CI.html#563495854">(Dec 12 2025 at 15:07)</a>:</h4>
<p><a href="https://codeberg.org/mlugg/setup-zig/issues/64">https://codeberg.org/mlugg/setup-zig/issues/64</a></p>



<a name="572617603"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/CI/near/572617603" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/CI.html#572617603">(Feb 08 2026 at 12:35)</a>:</h4>
<p>I ran into some CI benchmarking failures that didn't make sense, and got some interesting Claude analysis:</p>
<blockquote>
<p>The benchmarks passed at commit 14ce4d9cef (our previous push). The only change since then is removing 2 dead code functions — impossible to cause OOM. Meanwhile, dev-objects and even-more-llvm branches are also running CI on the same machine, each building release binaries. The M1 runner is memory-constrained and the benchmark test (which runs the roc binary repeatedly via hyperfine) gets OOM-killed (SIGKILL = exit code 137).</p>
<p>Additional issue: --discard-failure=137 is not a valid hyperfine option. The benchmark script uses it but <a href="https://github.com/sharkdp/hyperfine/blob/master/CHANGELOG.md">https://github.com/sharkdp/hyperfine/blob/master/CHANGELOG.md</a>. The correct option would be --ignore-failure (with exit code list support added in <a href="https://github.com/sharkdp/hyperfine/releases/tag/v1.19.0">https://github.com/sharkdp/hyperfine/releases/tag/v1.19.0</a>). If the CI runner's hyperfine doesn't support --discard-failure, the flag is either silently ignored or causes unexpected behavior.</p>
</blockquote>



<a name="572624083"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/CI/near/572624083" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Rick Hull <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/CI.html#572624083">(Feb 08 2026 at 14:16)</a>:</h4>
<p>To state the obvious, this sounds like a tenancy issue, not a code-in-isolation issue:</p>
<blockquote>
<p>Meanwhile, dev-objects and even-more-llvm branches are also running CI on the same machine, each building release binaries. The M1 runner is memory-constrained and the benchmark test (which runs the roc binary repeatedly via hyperfine) gets OOM-killed (SIGKILL = exit code 137).</p>
</blockquote>



<a name="572632293"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/CI/near/572632293" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/CI.html#572632293">(Feb 08 2026 at 16:22)</a>:</h4>
<p>also it looks like some of our self-hosted runners are down <span aria-label="sweat smile" class="emoji emoji-1f605" role="img" title="sweat smile">:sweat_smile:</span> </p>
<p>cc <span class="user-mention" data-user-id="361169">@Anton</span> in case you can take a look when you're around!</p>



<a name="572715053"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/CI/near/572715053" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anton <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/CI.html#572715053">(Feb 09 2026 at 09:10)</a>:</h4>
<blockquote>
<p>--discard-failure=137 is not a valid hyperfine option.</p>
</blockquote>
<p>I added that myself in my hyperfine fork, it should ignore any flaky failures with exit code 137.</p>



<a name="572719783"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/CI/near/572719783" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anton <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/CI.html#572719783">(Feb 09 2026 at 09:29)</a>:</h4>
<p>Looks like the runner just ran out of disk space, I removed a bunch of stuff. I will keep on an eye on it.</p>



<a name="572851010"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/CI/near/572851010" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anton <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/CI.html#572851010">(Feb 09 2026 at 17:58)</a>:</h4>
<p>I was still able to reproduce the issue, I think it's some edge case when combined with another flag, will check it out.</p>



<a name="572860264"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/CI/near/572860264" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anton <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/CI.html#572860264">(Feb 09 2026 at 18:45)</a>:</h4>
<p>Fixed, looks like it's working well now :)</p>



<hr><p>Last updated: Mar 01 2026 at 12:20 UTC</p>
</html>