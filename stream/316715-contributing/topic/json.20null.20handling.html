<html>
<head><meta charset="utf-8"><title>json null handling · contributing · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/index.html">contributing</a></h2>
<h3>Topic: <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/json.20null.20handling.html">json null handling</a></h3>

<hr>

<base href="https://roc.zulipchat.com">

<head><link href="https://roc-lang.github.io/zulip-export/style.css" rel="stylesheet"></head>

<a name="400003081"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/json%20null%20handling/near/400003081" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/json.20null.20handling.html#400003081">(Nov 02 2023 at 18:53)</a>:</h4>
<p>I just discovered the hard way that our JSON decoder decodes <code>null</code> into the string <code>"null"</code> <span aria-label="joy" class="emoji emoji-1f602" role="img" title="joy">:joy:</span></p>



<a name="400003742"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/json%20null%20handling/near/400003742" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ayaz Hafiz <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/json.20null.20handling.html#400003742">(Nov 02 2023 at 18:58)</a>:</h4>
<p>only if you expect to decode it to a string, right?</p>



<a name="400003783"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/json%20null%20handling/near/400003783" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ayaz Hafiz <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/json.20null.20handling.html#400003783">(Nov 02 2023 at 18:58)</a>:</h4>
<p>somebody somewhere would call it a feature</p>



<a name="400012397"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/json%20null%20handling/near/400012397" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/json.20null.20handling.html#400012397">(Nov 02 2023 at 20:09)</a>:</h4>
<p>I think this is because we hadn't decided on a convention for what it should do with nulls</p>



<a name="400012548"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/json%20null%20handling/near/400012548" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/json.20null.20handling.html#400012548">(Nov 02 2023 at 20:10)</a>:</h4>
<p>I think <code>[Null, NotNull a]</code> seems like the frontrunner because it's very explicit, and also means you can do stuff like <code>{ email: Null }</code> and have it generate the right JSON</p>



<a name="400012736"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/json%20null%20handling/near/400012736" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/json.20null.20handling.html#400012736">(Nov 02 2023 at 20:12)</a>:</h4>
<p><span class="user-mention" data-user-id="515757">@Luke Boswell</span> do you think you'd have bandwidth to add null handling to your json package?</p>
<p>it's the first Roc in production blocker we've run into at work (which is, in one sense, a milestone for the language! <span aria-label="tada" class="emoji emoji-1f389" role="img" title="tada">:tada:</span><span aria-label="sweat smile" class="emoji emoji-1f605" role="img" title="sweat smile">:sweat_smile:</span><span aria-label="tada" class="emoji emoji-1f389" role="img" title="tada">:tada:</span>)</p>



<a name="400013271"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/json%20null%20handling/near/400013271" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/json.20null.20handling.html#400013271">(Nov 02 2023 at 20:17)</a>:</h4>
<p>oh wait, <span class="user-mention" data-user-id="454654">@Ayaz Hafiz</span> - <code>Decoding</code> doesn't support tag unions yet, does it?</p>



<a name="400013346"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/json%20null%20handling/near/400013346" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/json.20null.20handling.html#400013346">(Nov 02 2023 at 20:18)</a>:</h4>
<p>we would need that to be able to decode into <code>[Null, NotNull Str]</code> or whatever</p>



<a name="400017695"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/json%20null%20handling/near/400017695" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/json.20null.20handling.html#400017695">(Nov 02 2023 at 20:55)</a>:</h4>
<p>I should have some time today to look at it. Might be hlepful to make a summary of things not yet supported. We also dont support Dicts yet.</p>



<a name="400017853"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/json%20null%20handling/near/400017853" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/json.20null.20handling.html#400017853">(Nov 02 2023 at 20:56)</a>:</h4>
<p>nice! Actually another one that should be unblocked is being able to decode objects with extra fields</p>



<a name="400017861"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/json%20null%20handling/near/400017861" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/json.20null.20handling.html#400017861">(Nov 02 2023 at 20:56)</a>:</h4>
<p>From memory I think tags are good to go. Do you think it shouldn't be possible to decode a null or true or false into a Str? The alternative is these fail, and must use tags instead.</p>



<a name="400017892"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/json%20null%20handling/near/400017892" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/json.20null.20handling.html#400017892">(Nov 02 2023 at 20:56)</a>:</h4>
<p>e.g. if I want to decode <code>{ a, b }</code> from a JSON object that has <code>"a"</code>, <code>"b"</code>, and also <code>"c"</code> as fields, that fails currently</p>



<a name="400017907"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/json%20null%20handling/near/400017907" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/json.20null.20handling.html#400017907">(Nov 02 2023 at 20:56)</a>:</h4>
<p>yeah I think they should fail</p>



<a name="400017929"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/json%20null%20handling/near/400017929" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/json.20null.20handling.html#400017929">(Nov 02 2023 at 20:57)</a>:</h4>
<p>like if we get a <code>null</code> and we expected a string, that should fail</p>



<a name="400017965"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/json%20null%20handling/near/400017965" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/json.20null.20handling.html#400017965">(Nov 02 2023 at 20:57)</a>:</h4>
<p>if we think null could happen instead of string, we should decode into <code>[Null, NotNull Str]</code></p>



<a name="400018062"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/json%20null%20handling/near/400018062" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/json.20null.20handling.html#400018062">(Nov 02 2023 at 20:58)</a>:</h4>
<p>I thought extra fields were just ignored. I can look at that too.</p>



<a name="400018136"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/json%20null%20handling/near/400018136" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/json.20null.20handling.html#400018136">(Nov 02 2023 at 20:58)</a>:</h4>
<p>sweet, thank you so much! <span aria-label="heart eyes" class="emoji emoji-1f60d" role="img" title="heart eyes">:heart_eyes:</span></p>



<a name="400018541"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/json%20null%20handling/near/400018541" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/json.20null.20handling.html#400018541">(Nov 02 2023 at 21:01)</a>:</h4>
<p>btw the PascalCase field mapping came up right away and was super useful, so thanks for that! <span aria-label="smiley" class="emoji emoji-1f603" role="img" title="smiley">:smiley:</span></p>



<a name="400022070"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/json%20null%20handling/near/400022070" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ayaz Hafiz <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/json.20null.20handling.html#400022070">(Nov 02 2023 at 21:31)</a>:</h4>
<blockquote>
<p>Decoding doesn't support tag unions yet, does it?</p>
</blockquote>
<p>Yeah it doesn't</p>



<a name="400022110"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/json%20null%20handling/near/400022110" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/json.20null.20handling.html#400022110">(Nov 02 2023 at 21:32)</a>:</h4>
<p>I forget - were there unsolved design questions there?</p>



<a name="400022162"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/json%20null%20handling/near/400022162" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/json.20null.20handling.html#400022162">(Nov 02 2023 at 21:32)</a>:</h4>
<p>or is it unblocked but just not implemented</p>



<a name="400023943"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/json%20null%20handling/near/400023943" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/json.20null.20handling.html#400023943">(Nov 02 2023 at 21:50)</a>:</h4>
<p>Oh right, we currently encode tags, but can't decode them.</p>



<a name="400024858"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/json%20null%20handling/near/400024858" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/json.20null.20handling.html#400024858">(Nov 02 2023 at 21:59)</a>:</h4>
<p>yeah that makes sense</p>



<a name="400025971"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/json%20null%20handling/near/400025971" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/json.20null.20handling.html#400025971">(Nov 02 2023 at 22:08)</a>:</h4>
<p>So if we don't have tags, would you like me to update and have roc-json fail when trying to decode a Null into a string?</p>



<a name="400026079"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/json%20null%20handling/near/400026079" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/json.20null.20handling.html#400026079">(Nov 02 2023 at 22:09)</a>:</h4>
<p>That is an easy change, just remove this when statement</p>
<div class="codehilite"><pre><span></span><code>decodeString = Decode.custom \bytes, @Json {} -&gt;
    when bytes is
        [&#39;n&#39;, &#39;u&#39;, &#39;l&#39;, &#39;l&#39;, ..] -&gt;
            { result: Ok &quot;null&quot;, rest: List.dropFirst bytes 4 }
</code></pre></div>



<a name="400026878"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/json%20null%20handling/near/400026878" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/json.20null.20handling.html#400026878">(Nov 02 2023 at 22:17)</a>:</h4>
<p>the specific scenario we ran into at work is needing to distinguish between null and non-null things</p>



<a name="400026889"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/json%20null%20handling/near/400026889" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/json.20null.20handling.html#400026889">(Nov 02 2023 at 22:17)</a>:</h4>
<p>so <code>Bool</code> errors out on null at the moment, which is actually a blocker <span aria-label="sweat smile" class="emoji emoji-1f605" role="img" title="sweat smile">:sweat_smile:</span></p>



<a name="400026916"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/json%20null%20handling/near/400026916" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/json.20null.20handling.html#400026916">(Nov 02 2023 at 22:17)</a>:</h4>
<p>so what we need is to be able to tell the difference, not to have it error out (or change it to a default value)</p>



<a name="400026922"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/json%20null%20handling/near/400026922" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/json.20null.20handling.html#400026922">(Nov 02 2023 at 22:17)</a>:</h4>
<p>in other words, we need tags</p>



<a name="400027763"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/json%20null%20handling/near/400027763" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/json.20null.20handling.html#400027763">(Nov 02 2023 at 22:25)</a>:</h4>
<p>It's easy enough to default null to false when decoding a Bool</p>



<a name="400027930"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/json%20null%20handling/near/400027930" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/json.20null.20handling.html#400027930">(Nov 02 2023 at 22:27)</a>:</h4>
<p>unfortunately in this use case we specifically need to be able to distinguish between null, true, and false <span aria-label="big smile" class="emoji emoji-1f604" role="img" title="big smile">:big_smile:</span></p>



<a name="400028489"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/json%20null%20handling/near/400028489" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/json.20null.20handling.html#400028489">(Nov 02 2023 at 22:32)</a>:</h4>
<p>but I think accepting unused object fields, should be unblocked, yeah?</p>



<a name="400028822"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/json%20null%20handling/near/400028822" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/json.20null.20handling.html#400028822">(Nov 02 2023 at 22:36)</a>:</h4>
<p>I think it should be working with <code>jsonWithOptions = \{ fieldNameMapping ? Default, skipMissingProperties ? Bool.true }</code></p>



<a name="400028862"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/json%20null%20handling/near/400028862" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/json.20null.20handling.html#400028862">(Nov 02 2023 at 22:36)</a>:</h4>
<p>Setting <code>skipMissingProperties: Bool.true</code> should be working</p>



<a name="400029063"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/json%20null%20handling/near/400029063" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/json.20null.20handling.html#400029063">(Nov 02 2023 at 22:38)</a>:</h4>
<p>ahh interesting</p>



<a name="400029072"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/json%20null%20handling/near/400029072" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/json.20null.20handling.html#400029072">(Nov 02 2023 at 22:38)</a>:</h4>
<p>can we default that to true?</p>



<a name="400029159"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/json%20null%20handling/near/400029159" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/json.20null.20handling.html#400029159">(Nov 02 2023 at 22:39)</a>:</h4>
<p>It is currently</p>
<div class="codehilite"><pre><span></span><code>## Returns a JSON `Encoder` and `Decoder`
json = @Json { fieldNameMapping: Default, skipMissingProperties: Bool.true }

## Returns a JSON `Encoder` and `Decoder` with configuration options
##
## `skipMissingProperties` - if `True` the decoder will skip additional properties
## in the json that are not present in the model. (Default: `True`)
jsonWithOptions = \{ fieldNameMapping ? Default, skipMissingProperties ? Bool.true } -&gt;
    @Json { fieldNameMapping, skipMissingProperties }
</code></pre></div>



<a name="400029279"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/json%20null%20handling/near/400029279" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/json.20null.20handling.html#400029279">(Nov 02 2023 at 22:40)</a>:</h4>
<p>And here is the test for it which passes</p>
<div class="codehilite"><pre><span></span><code># Test decode of partial record with multiple additional fields
expect
    input = Str.toUtf8 &quot;{\&quot;extraField\&quot;:2, \&quot;ownerName\&quot;: \&quot;Farmer Joe\&quot;, \&quot;extraField2\&quot;:2 }&quot;
    actual : DecodeResult { ownerName : Str }
    actual = Decode.fromBytesPartial input json

    expected = Ok { ownerName: &quot;Farmer Joe&quot; }

    result = actual.result
    result == expected
</code></pre></div>



<a name="400029450"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/json%20null%20handling/near/400029450" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/json.20null.20handling.html#400029450">(Nov 02 2023 at 22:42)</a>:</h4>
<p>oh but what about <code>Decode.decode</code>?</p>



<a name="400057496"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/json%20null%20handling/near/400057496" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ayaz Hafiz <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/json.20null.20handling.html#400057496">(Nov 03 2023 at 03:30)</a>:</h4>
<blockquote>
<p>or is it unblocked but just not implemented</p>
</blockquote>
<p>Yeah, it's this. We have a design for it here: <a href="https://github.com/roc-lang/roc/issues/3816">https://github.com/roc-lang/roc/issues/3816</a>. In principle ("principle") it should mostly be a copy-paste of what's needed for records</p>



<a name="400057847"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/json%20null%20handling/near/400057847" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/json.20null.20handling.html#400057847">(Nov 03 2023 at 03:34)</a>:</h4>
<p>awesome! Does anyone want to take a shot at implementing that? Could be a fun self-contained way to make a change to that part of the compiler <span aria-label="smiley" class="emoji emoji-1f603" role="img" title="smiley">:smiley:</span> </p>
<p>(with outside help and guidance of course!)</p>



<a name="400315803"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/json%20null%20handling/near/400315803" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/json.20null.20handling.html#400315803">(Nov 04 2023 at 17:35)</a>:</h4>
<p>if nobody else is interested, I'll pick it up, but I figured it might be a good introductory project to compiler type system stuff</p>



<a name="400325506"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/json%20null%20handling/near/400325506" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Isaac Van Doren <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/json.20null.20handling.html#400325506">(Nov 04 2023 at 20:33)</a>:</h4>
<p><span class="user-mention" data-user-id="281383">@Richard Feldman</span> if you haven't started on it yet I'd be interested in doing it. I have a good chunk of time I could spend on it tomorrow. That said, if it's very time sensitive to get it done for your work then I'll hold off.</p>



<a name="400325560"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/json%20null%20handling/near/400325560" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/json.20null.20handling.html#400325560">(Nov 04 2023 at 20:34)</a>:</h4>
<p>that's awesome, go for it! <span aria-label="smiley" class="emoji emoji-1f603" role="img" title="smiley">:smiley:</span></p>



<a name="400325655"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/json%20null%20handling/near/400325655" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Isaac Van Doren <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/json.20null.20handling.html#400325655">(Nov 04 2023 at 20:36)</a>:</h4>
<p>Okay sweet! Any guidance before I dig in?</p>



<a name="400326021"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/json%20null%20handling/near/400326021" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/json.20null.20handling.html#400326021">(Nov 04 2023 at 20:45)</a>:</h4>
<p>re-reading the notion doc linked in the issue, I don't remember what the <code>Nat</code> in <code>discriminant</code> does, or how this would work when specifically decoding the bytes <code>null</code> into a tag union  <span aria-label="sweat smile" class="emoji emoji-1f605" role="img" title="sweat smile">:sweat_smile:</span> </p>
<p><span class="user-mention" data-user-id="454654">@Ayaz Hafiz</span> do you remember how those would work?</p>



<a name="400327112"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/json%20null%20handling/near/400327112" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ayaz Hafiz <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/json.20null.20handling.html#400327112">(Nov 04 2023 at 21:07)</a>:</h4>
<p>it returns the index of the matched discriminant given the list of discriminants</p>



<a name="400327179"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/json%20null%20handling/near/400327179" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ayaz Hafiz <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/json.20null.20handling.html#400327179">(Nov 04 2023 at 21:08)</a>:</h4>
<p>the formatter could match null on the empty discriminant</p>



<a name="400327207"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/json%20null%20handling/near/400327207" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/json.20null.20handling.html#400327207">(Nov 04 2023 at 21:09)</a>:</h4>
<p>hm, I still don't follow <span aria-label="sweat smile" class="emoji emoji-1f605" role="img" title="sweat smile">:sweat_smile:</span> - how would that look in practice?</p>



<a name="400327395"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/json%20null%20handling/near/400327395" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/json.20null.20handling.html#400327395">(Nov 04 2023 at 21:12)</a>:</h4>
<p>so when <code>Json</code> encounters a <code>null</code> it calls <code>DecoderFormatting.discriminant [[]]</code> ? But in that case, how would that get translated to a <code>[Null, NotNull a]</code> on the decoded side?</p>



<a name="400328187"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/json%20null%20handling/near/400328187" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ayaz Hafiz <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/json.20null.20handling.html#400328187">(Nov 04 2023 at 21:30)</a>:</h4>
<p>No, the point is that the formatter implements discriminant right</p>



<a name="400328193"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/json%20null%20handling/near/400328193" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ayaz Hafiz <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/json.20null.20handling.html#400328193">(Nov 04 2023 at 21:30)</a>:</h4>
<p>So JSON implements that function</p>



<a name="400328209"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/json%20null%20handling/near/400328209" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ayaz Hafiz <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/json.20null.20handling.html#400328209">(Nov 04 2023 at 21:31)</a>:</h4>
<p>So given [[A],[B],[]] the formatter would return a decoder that when matched on null returns 2</p>



<a name="400328221"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/json%20null%20handling/near/400328221" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ayaz Hafiz <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/json.20null.20handling.html#400328221">(Nov 04 2023 at 21:31)</a>:</h4>
<p>And then that index is used to figure out what “sequence” function should be called</p>



<a name="400328266"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/json%20null%20handling/near/400328266" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ayaz Hafiz <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/json.20null.20handling.html#400328266">(Nov 04 2023 at 21:32)</a>:</h4>
<p>which for the index 2 case here, would return the variant named Null</p>



<a name="400328303"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/json%20null%20handling/near/400328303" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/json.20null.20handling.html#400328303">(Nov 04 2023 at 21:33)</a>:</h4>
<blockquote>
<p><code>[[A],[B],[]]</code></p>
</blockquote>
<p>is this the type of a tag union?</p>



<a name="400328347"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/json%20null%20handling/near/400328347" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ayaz Hafiz <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/json.20null.20handling.html#400328347">(Nov 04 2023 at 21:34)</a>:</h4>
<p>No, the list of discriminants passed to the discriminant function</p>



<a name="400328354"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/json%20null%20handling/near/400328354" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ayaz Hafiz <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/json.20null.20handling.html#400328354">(Nov 04 2023 at 21:34)</a>:</h4>
<p>The relevant tag union would be “A …, B…, Null”, I suppose</p>



<a name="400328474"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/json%20null%20handling/near/400328474" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/json.20null.20handling.html#400328474">(Nov 04 2023 at 21:37)</a>:</h4>
<p>ah gotcha - <span class="user-mention" data-user-id="611722">@Isaac Van Doren</span> does that make sense? Happy to answer questions if it would help!</p>



<a name="400329534"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/json%20null%20handling/near/400329534" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Isaac Van Doren <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/json.20null.20handling.html#400329534">(Nov 04 2023 at 22:01)</a>:</h4>
<p>I haven't looked at the implementation yet but I think this will be enough for me to get started tomorrow <span aria-label="check" class="emoji emoji-2705" role="img" title="check">:check:</span></p>



<a name="400443001"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/json%20null%20handling/near/400443001" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Isaac Van Doren <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/json.20null.20handling.html#400443001">(Nov 06 2023 at 01:59)</a>:</h4>
<p>What is the status of decoding tuples from json? I see that it's implemented but haven't gotten it to work</p>



<a name="400448014"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/json%20null%20handling/near/400448014" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ayaz Hafiz <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/json.20null.20handling.html#400448014">(Nov 06 2023 at 02:55)</a>:</h4>
<p>do you have an example you've tried?</p>



<a name="400448835"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/json%20null%20handling/near/400448835" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Isaac Van Doren <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/json.20null.20handling.html#400448835">(Nov 06 2023 at 03:02)</a>:</h4>
<p>As I was typing up a compact example, I got it to work. Looks like the reason it wasn't working before is because the file I was reading in had whitespace in it. </p>
<p>For example, this fails</p>
<div class="codehilite"><pre><span></span><code>expect
    actual = Decode.fromBytes (&quot;[ 123,456]&quot; |&gt; Str.toUtf8) Core.json
    expected = Ok (123,456)
    actual == expected
</code></pre></div>
<p>but it passes if I remove the space before 123. So I guess just a bug with whitespace then</p>



<a name="400448857"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/json%20null%20handling/near/400448857" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/json.20null.20handling.html#400448857">(Nov 06 2023 at 03:03)</a>:</h4>
<p>ah nice! can you open an issue for that?</p>



<a name="400449067"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/json%20null%20handling/near/400449067" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Isaac Van Doren <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/json.20null.20handling.html#400449067">(Nov 06 2023 at 03:05)</a>:</h4>
<p>Will do!</p>



<a name="400449633"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/json%20null%20handling/near/400449633" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Isaac Van Doren <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/json.20null.20handling.html#400449633">(Nov 06 2023 at 03:13)</a>:</h4>
<p><a href="https://github.com/lukewilliamboswell/roc-json/issues/5">https://github.com/lukewilliamboswell/roc-json/issues/5</a></p>



<a name="400449814"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/json%20null%20handling/near/400449814" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Isaac Van Doren <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/json.20null.20handling.html#400449814">(Nov 06 2023 at 03:15)</a>:</h4>
<p>Also, what's the status for removing the rest of <code>TotallyNotJson</code> from the builtins? Is it blocked or ready to proceed? I see that there is a partial PR from June to do so</p>



<a name="400449936"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/json%20null%20handling/near/400449936" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Isaac Van Doren <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/json.20null.20handling.html#400449936">(Nov 06 2023 at 03:16)</a>:</h4>
<p>Another thought, it might be nice to link to to roc-json somewhere on the Decode page so that it's easier to find. I had to dig around in Zulip for a while before I could figure out where Json was moved to.</p>



<a name="400450007"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/json%20null%20handling/near/400450007" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ayaz Hafiz <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/json.20null.20handling.html#400450007">(Nov 06 2023 at 03:17)</a>:</h4>
<p>I think the tests need to be updated to use a shim implementation, but I don't think there's any blocker. I think <span class="user-mention" data-user-id="515757">@Luke Boswell</span> has the most context</p>



<a name="400451003"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/json%20null%20handling/near/400451003" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Isaac Van Doren <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/json.20null.20handling.html#400451003">(Nov 06 2023 at 03:30)</a>:</h4>
<p>On another note, this approach to decoding is so cool <span aria-label="star struck" class="emoji emoji-1f929" role="img" title="star struck">:star_struck:</span>. Very slick to be able to do it without any type annotations if desired</p>



<a name="400451041"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/json%20null%20handling/near/400451041" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ayaz Hafiz <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/json.20null.20handling.html#400451041">(Nov 06 2023 at 03:31)</a>:</h4>
<p>yeah it's crazy, right</p>



<a name="400451047"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/json%20null%20handling/near/400451047" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ayaz Hafiz <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/json.20null.20handling.html#400451047">(Nov 06 2023 at 03:31)</a>:</h4>
<p>still blows my mind</p>



<a name="400451079"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/json%20null%20handling/near/400451079" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/json.20null.20handling.html#400451079">(Nov 06 2023 at 03:31)</a>:</h4>
<p><span class="user-mention silent" data-user-id="454654">Ayaz Hafiz</span> <a href="#narrow/stream/316715-contributing/topic/json.20null.20handling/near/400451047">said</a>:</p>
<blockquote>
<p>still blows my mind</p>
</blockquote>
<p>and you made it!!! <span aria-label="rolling on the floor laughing" class="emoji emoji-1f923" role="img" title="rolling on the floor laughing">:rolling_on_the_floor_laughing:</span></p>



<a name="400473388"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/json%20null%20handling/near/400473388" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/json.20null.20handling.html#400473388">(Nov 06 2023 at 07:05)</a>:</h4>
<p>Re removing TotallyNotJson I couldn't figure out how to inline the module into the rust tests at the time. I described the issue in a zulip thread I think, or maybe the issue. On my phone rn, I can dig into it later. I don't think there are any issues, it was just beyond my rust skills and probably a bit ambitious for someone with less than a month rust exposure <span aria-label="sweat smile" class="emoji emoji-1f605" role="img" title="sweat smile">:sweat_smile:</span></p>



<a name="400490968"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/json%20null%20handling/near/400490968" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/json.20null.20handling.html#400490968">(Nov 06 2023 at 09:23)</a>:</h4>
<p>This <a href="https://github.com/roc-lang/roc/pull/5543">#5543</a> is the inactive PR I was working on. I haven't looked at this in a while, and don't plan to any time soon. I probably should close this PR as I imagine it is pretty stale now.</p>



<a name="400492086"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/json%20null%20handling/near/400492086" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/json.20null.20handling.html#400492086">(Nov 06 2023 at 09:30)</a>:</h4>
<p><span class="user-mention" data-user-id="611722">@Isaac Van Doren</span> while you are looking at that part of the code base, there is another issue <a href="https://github.com/roc-lang/roc/issues/5294">#5294</a> which would be super useful. This would mean we can decode json straight into dicts. </p>
<p>i.e. <code>{'Mickey Mouse':'Disney', 'Donald Duck':'Disney', 'Daffy Duck':'Warner Brothers', 'Fred Flintstone':'Hanna Barbera'}</code><br>
could be decoded into <code>Dict Str Str</code></p>



<a name="400492184"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/json%20null%20handling/near/400492184" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/json.20null.20handling.html#400492184">(Nov 06 2023 at 09:31)</a>:</h4>
<p>I don't know how hard that is to implement. But just thought I would mention in case you are interested.</p>



<a name="400536332"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/json%20null%20handling/near/400536332" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Isaac Van Doren <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/json.20null.20handling.html#400536332">(Nov 06 2023 at 13:56)</a>:</h4>
<p>Okay sounds good. Thanks for mentioning it, I’ll keep it in mind if I get that far! It would be very nice to have</p>



<a name="400663099"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/json%20null%20handling/near/400663099" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Isaac Van Doren <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/json.20null.20handling.html#400663099">(Nov 07 2023 at 04:47)</a>:</h4>
<p>Trying to wrap my head around how this stuff works, so I could be totally off here. Do we need to have a <br>
<code>sequence : state, (state -&gt; [Keep (Decoder state fmt), Skip]), (state -&gt; Result val DecodeError) -&gt; Decoder val fmt | fmt has DecoderFormatting</code><br>
when we already have a <br>
<code>tuple : state, (state, Nat -&gt; [Next (Decoder state fmt), TooLong]), (state -&gt; Result val DecodeError) -&gt; Decoder val fmt where fmt implements DecoderFormatting</code>?</p>
<p>It seems like perhaps it could serve the same purpose.</p>



<a name="400663381"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/json%20null%20handling/near/400663381" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/json.20null.20handling.html#400663381">(Nov 07 2023 at 04:50)</a>:</h4>
<p>They seem to have different goals. Sequence looks to collect or skip items from a list while tuple takes a list of a specific length. So it would never skip anything and must fail if there are too few or many items.</p>



<a name="400663452"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/json%20null%20handling/near/400663452" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/json.20null.20handling.html#400663452">(Nov 07 2023 at 04:51)</a>:</h4>
<p>Though probably could be merged if really wanted. Would need a combined tag and more complex state machine.</p>



<a name="400663589"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/json%20null%20handling/near/400663589" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/json.20null.20handling.html#400663589">(Nov 07 2023 at 04:52)</a>:</h4>
<p>Also, what final type does sequence generate? I assume a list instead of a tuple?</p>



<a name="400664588"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/json%20null%20handling/near/400664588" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Isaac Van Doren <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/json.20null.20handling.html#400664588">(Nov 07 2023 at 05:02)</a>:</h4>
<p>I think they both would take a list of a specific length. Because the appropriate call to sequence would be made based on the particular tag that is trying to be decoded into. So in that case the arity of the tag (i.e. the length of the list) is known.</p>



<a name="400664663"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/json%20null%20handling/near/400664663" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Isaac Van Doren <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/json.20null.20handling.html#400664663">(Nov 07 2023 at 05:03)</a>:</h4>
<p>I think the usage of Keep and Skip may have been borrowed from the record decoder. I don’t see why you would want to skip some values if you’re trying to decode into a tag</p>



<a name="400664803"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/json%20null%20handling/near/400664803" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Isaac Van Doren <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/json.20null.20handling.html#400664803">(Nov 07 2023 at 05:05)</a>:</h4>
<blockquote>
<p>Also, what final type does sequence generate? I assume a list instead of a tuple?</p>
</blockquote>
<p>The idea is to use sequence to decode into a Tag with payload so basically the same thing as a tuple</p>



<a name="400664937"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/json%20null%20handling/near/400664937" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/json.20null.20handling.html#400664937">(Nov 07 2023 at 05:06)</a>:</h4>
<p>ah sequence is for tags. I'm not sure then cause a tag isn't really a tuple. A tag is a enum and then anything (record, list, tuple, etc)</p>



<a name="400665222"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/json%20null%20handling/near/400665222" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Isaac Van Doren <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/json.20null.20handling.html#400665222">(Nov 07 2023 at 05:10)</a>:</h4>
<p>Right I should have been more clear. What I mean is that T a b c holds basically the same payload as (a,b,c).</p>



<a name="400665295"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/json%20null%20handling/near/400665295" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/json.20null.20handling.html#400665295">(Nov 07 2023 at 05:11)</a>:</h4>
<p>ah yeah, totally.</p>



<a name="400665685"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/json%20null%20handling/near/400665685" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ayaz Hafiz <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/json.20null.20handling.html#400665685">(Nov 07 2023 at 05:16)</a>:</h4>
<p>Yeah i think using Tuple is fine</p>



<a name="400665703"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/json%20null%20handling/near/400665703" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ayaz Hafiz <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/json.20null.20handling.html#400665703">(Nov 07 2023 at 05:16)</a>:</h4>
<p>I wrote that document before tuples existed <span aria-label="upside down" class="emoji emoji-1f643" role="img" title="upside down">:upside_down:</span></p>



<a name="400739141"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/json%20null%20handling/near/400739141" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Isaac Van Doren <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/json.20null.20handling.html#400739141">(Nov 07 2023 at 13:25)</a>:</h4>
<p>Okay cool</p>



<a name="401884639"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/json%20null%20handling/near/401884639" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/json.20null.20handling.html#401884639">(Nov 14 2023 at 02:00)</a>:</h4>
<p><span class="user-mention" data-user-id="611722">@Isaac Van Doren</span> how are things going on this? I'm happy to help with anything! <span aria-label="smiley" class="emoji emoji-1f603" role="img" title="smiley">:smiley:</span></p>



<a name="401990781"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/json%20null%20handling/near/401990781" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Isaac Van Doren <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/json.20null.20handling.html#401990781">(Nov 14 2023 at 13:53)</a>:</h4>
<p>I’ve got most of the boilerplate for a module to derive tag unions, implemented discriminant, and mostly figured out how the decoding stuff fits together. </p>
<p>The next step is getting a sample implementation of what the derived decoder should be for an example tag Union so that I can test it and make sure I’m on the right track before writing all the code to actually generate it.</p>
<p>Originally I thought I would be able to use the tue decoder for the payload of a tag but I realized that won’t work because it needs to work for an empty tuples and single element tuple.</p>
<p>So I’ll need to implement sequence as Ayaz had originally thought might be necessary.</p>
<p>Once I have that I’ll have the example implementation done.</p>
<p>I’ve had some issues with building my branch which I don’t yet understand. Specifically, cargo check succeeded but cargo build hung on roc_load. Do you have an idea about what could cause this? Also have not gotten rust analyzer and cargo to play together nicely yet. </p>
<p>If you need this done more promptly for work I am happy to let you take over.</p>



<a name="401991291"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/json%20null%20handling/near/401991291" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/json.20null.20handling.html#401991291">(Nov 14 2023 at 13:55)</a>:</h4>
<p>oh wow, awesome!</p>



<a name="401991382"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/json%20null%20handling/near/401991382" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/json.20null.20handling.html#401991382">(Nov 14 2023 at 13:56)</a>:</h4>
<p>it's not urgent, and I'm excited to see your progress! <span aria-label="smiley" class="emoji emoji-1f603" role="img" title="smiley">:smiley:</span></p>



<a name="401991568"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/json%20null%20handling/near/401991568" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/json.20null.20handling.html#401991568">(Nov 14 2023 at 13:57)</a>:</h4>
<p>if you <code>git bisect</code>, can you find out which commit introduced the hang? I might have some ideas based on that</p>



<a name="401993346"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/json%20null%20handling/near/401993346" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anton <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/json.20null.20handling.html#401993346">(Nov 14 2023 at 14:04)</a>:</h4>
<blockquote>
<p>Also have not gotten rust analyzer and cargo to play together nicely yet.</p>
</blockquote>
<p>The <a href="https://github.com/roc-lang/roc/tree/main/devtools">devtools flake</a> should fix that</p>



<a name="401994036"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/json%20null%20handling/near/401994036" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ayaz Hafiz <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/json.20null.20handling.html#401994036">(Nov 14 2023 at 14:07)</a>:</h4>
<p>Does build hang around roc_load? If so I suspect it’s due to the builtins not compiling. you can try “cargo build -vvv” which should be much more verbose and show if that’s the issue. I suspect you may need to add the discriminant/sequence implementation to the Json module in the stdlib if you haven’t already</p>



<a name="402086060"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/json%20null%20handling/near/402086060" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Isaac Van Doren <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/json.20null.20handling.html#402086060">(Nov 14 2023 at 23:01)</a>:</h4>
<p>Okay good to know, I’ll try that. I have added the implementation to the Json module but there could certainly still be an error</p>



<a name="402086194"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/json%20null%20handling/near/402086194" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/json.20null.20handling.html#402086194">(Nov 14 2023 at 23:01)</a>:</h4>
<p>do you mean <code>TotallyNotJson</code> in the <code>roc/</code> repo?</p>



<a name="402086348"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/json%20null%20handling/near/402086348" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Isaac Van Doren <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/json.20null.20handling.html#402086348">(Nov 14 2023 at 23:02)</a>:</h4>
<blockquote>
<p>The <a href="https://github.com/roc-lang/roc/tree/main/devtools">devtools flake</a> should fix that</p>
</blockquote>
<p>Yes I need to get the setup! Right now I have the LSP building in a different directory which solved the main problem it seems</p>



<a name="402086376"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/json%20null%20handling/near/402086376" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Isaac Van Doren <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/json.20null.20handling.html#402086376">(Nov 14 2023 at 23:02)</a>:</h4>
<blockquote>
<p>do you mean <code>TotallyNotJson</code> in the <code>roc/</code> repo? </p>
</blockquote>
<p>Yes</p>



<a name="402086565"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/json%20null%20handling/near/402086565" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Isaac Van Doren <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/json.20null.20handling.html#402086565">(Nov 14 2023 at 23:03)</a>:</h4>
<p>I can probably figure something out once I get a chance to look into it more with the verbose output</p>



<a name="402086633"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/json%20null%20handling/near/402086633" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/json.20null.20handling.html#402086633">(Nov 14 2023 at 23:04)</a>:</h4>
<p>cool, let us know if you get stuck, and we can try some other things!</p>



<a name="402806889"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/json%20null%20handling/near/402806889" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Isaac Van Doren <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/json.20null.20handling.html#402806889">(Nov 18 2023 at 00:51)</a>:</h4>
<p>I have an example implementation of a derived decoder for a tag union:</p>
<div class="codehilite"><pre><span></span><code>example : Decoder [Zero, One a, Two b c] fmt where a implements Decoding, b implements Decoding, c implements Decoding, fmt implements DecoderFormatting
example =
    nameDecoder =
        [&quot;Zero&quot;, &quot;One&quot;, &quot;Two&quot;]
        |&gt; List.map Str.toUtf8
        |&gt; discriminant

    Decode.custom \bytes, fmt -&gt;
        { result: nameResult, rest: bytesAfterName } = Decode.decodeWith bytes nameDecoder fmt
        when nameResult is
            Err _ -&gt; { result: Err TooShort, rest: bytesAfterName }
            Ok index -&gt;
                when index is
                    0 -&gt;
                        state = {}
                        stepper = \_, _ -&gt; TooLong
                        finalizer = \_ -&gt; Ok Zero

                        Decode.decodeWith bytesAfterName (Decode.tuple state stepper finalizer) fmt

                    1 -&gt;
                        state = { e0: Err TooShort }
                        stepper = \s, i -&gt;
                            when i is
                                0 -&gt;
                                    Next
                                        (
                                            Decode.custom \b, f -&gt;
                                                when Decode.decodeWith b Decode.decoder f is
                                                    { result, rest } -&gt;
                                                        { result: Result.map result \val -&gt; { s &amp; e0: Ok val }, rest }
                                        )

                                _ -&gt; TooLong
                        finalizer = \s -&gt;
                            when s is
                                { e0: Ok val } -&gt; Ok (One val)
                                _ -&gt; Err TooShort

                        Decode.decodeWith bytesAfterName (Decode.tuple state stepper finalizer) fmt

                    2 -&gt;
                        state = { e0: Err TooShort, e1: Err TooShort }
                        stepper = \s, i -&gt;
                            when i is
                                0 -&gt;
                                    Next
                                        (
                                            Decode.custom \b, f -&gt;
                                                when Decode.decodeWith b Decode.decoder f is
                                                    { result, rest } -&gt;
                                                        { result: Result.map result \val -&gt; { s &amp; e0: Ok val }, rest }
                                        )

                                1 -&gt;
                                    Next
                                        (
                                            Decode.custom \b, f -&gt;
                                                when Decode.decodeWith b Decode.decoder f is
                                                    { result, rest } -&gt;
                                                        { result: Result.map result \val -&gt; { s &amp; e1: Ok val }, rest }
                                        )

                                _ -&gt; TooLong
                        finalizer = \s -&gt;
                            when s is
                                { e0: Ok v0, e1: Ok v1 } -&gt; Ok (Two v0 v1)
                                _ -&gt; Err TooShort

                        Decode.decodeWith bytesAfterName (Decode.tuple state stepper finalizer) fmt

                    _ -&gt; { result: Err TooShort, rest: bytesAfterName }
</code></pre></div>
<p>It type checks (<span aria-label="tada" class="emoji emoji-1f389" role="img" title="tada">:tada:</span>) but I have not been able to test it.</p>
<p>When I run this (using cargo)</p>
<div class="codehilite"><pre><span></span><code>expect
    actual = Decode.decodeWith (&quot;Two:[3,\&quot;foo\&quot;]&quot; |&gt; Str.toUtf8) example json
    actual.result == Ok (Two 3 &quot;foo&quot;)
</code></pre></div>
<p>I get </p>
<div class="codehilite"><pre><span></span><code>thread &#39;&lt;unnamed&gt;&#39; panicked at &#39;unspecialized lambda sets left over during resolution: LambdaSet([] + (&lt;22014&gt;FlexAble(a, [`Decode.Decoding`, `Bool.Eq`]):`Decode.decoder`:1), ^&lt;22018&gt;), UlsOfVar(VecMap { keys: [19831, 22014, 22367, 22462], values: [VecSet { elements: [19830] }, VecSet { elements: [22016] }, VecSet { elements: [22369] }, VecSet { elements: [22464] }] })&#39;, crates/compiler/mono/src/layout.rs:2074:17
</code></pre></div>
<p>Any suggestions about getting the testing to work or about the code in general? I figured it would be good to get feedback before I get too far in to implementing the code to generate it.</p>



<a name="402809359"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/json%20null%20handling/near/402809359" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/json.20null.20handling.html#402809359">(Nov 18 2023 at 01:06)</a>:</h4>
<p>if it's a lambda set problem, my general approach is "cross  my fingers and hope <span class="user-mention" data-user-id="454654">@Ayaz Hafiz</span> knows" <span aria-label="sweat smile" class="emoji emoji-1f605" role="img" title="sweat smile">:sweat_smile:</span></p>



<a name="402812564"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/json%20null%20handling/near/402812564" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ayaz Hafiz <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/json.20null.20handling.html#402812564">(Nov 18 2023 at 01:27)</a>:</h4>
<p>wow, is there 22K type variables in the derived implementation? or is that placed into a roc program?</p>



<a name="402812644"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/json%20null%20handling/near/402812644" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ayaz Hafiz <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/json.20null.20handling.html#402812644">(Nov 18 2023 at 01:28)</a>:</h4>
<p>have you added tests in the derive crate? there are some checks there that make sure the type variables are well formed</p>



<a name="402812800"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/json%20null%20handling/near/402812800" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ayaz Hafiz <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/json.20null.20handling.html#402812800">(Nov 18 2023 at 01:29)</a>:</h4>
<p>otherwise, if you can run a derive test with ROC_PRINT_UNIFICATIONS and ROC_TRACE_COMPACTION the output might give some pointers to us</p>



<a name="402812927"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/json%20null%20handling/near/402812927" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Isaac Van Doren <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/json.20null.20handling.html#402812927">(Nov 18 2023 at 01:30)</a>:</h4>
<p>This is just an example I wrote myself to figure out what the compiler should derive. I had it in the TotallyNotJson module to test with the other functions there. Given that, are there still tests I could add in the derive crate that would be helpful?</p>



<a name="402815601"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/json%20null%20handling/near/402815601" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ayaz Hafiz <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/json.20null.20handling.html#402815601">(Nov 18 2023 at 01:56)</a>:</h4>
<p>oh interesting</p>



<a name="402815658"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/json%20null%20handling/near/402815658" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ayaz Hafiz <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/json.20null.20handling.html#402815658">(Nov 18 2023 at 01:57)</a>:</h4>
<p>I’m out right now but I can take a deeper look in a bit. you might be running into what i lovingly call the “higher region restriction”</p>



<a name="402815751"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/json%20null%20handling/near/402815751" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ayaz Hafiz <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/json.20null.20handling.html#402815751">(Nov 18 2023 at 01:58)</a>:</h4>
<p>there are some notes on the possible patterns that cause it and workarounds here: <a href="https://github.com/roc-lang/roc/issues/3724">https://github.com/roc-lang/roc/issues/3724</a></p>



<a name="402816478"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/json%20null%20handling/near/402816478" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Isaac Van Doren <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/json.20null.20handling.html#402816478">(Nov 18 2023 at 02:03)</a>:</h4>
<p>Okay cool, I’ll check that out when I get a chance</p>



<a name="402837018"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/json%20null%20handling/near/402837018" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ayaz Hafiz <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/json.20null.20handling.html#402837018">(Nov 18 2023 at 05:44)</a>:</h4>
<p>Can you share your branch?</p>



<a name="402896126"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/json%20null%20handling/near/402896126" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Isaac Van Doren <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/json.20null.20handling.html#402896126">(Nov 18 2023 at 17:24)</a>:</h4>
<p>Yes here you go <a href="https://github.com/isaacvando/roc/tree/decode-tags-2">https://github.com/isaacvando/roc/tree/decode-tags-2</a></p>



<a name="402959385"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/json%20null%20handling/near/402959385" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ayaz Hafiz <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/json.20null.20handling.html#402959385">(Nov 19 2023 at 04:51)</a>:</h4>
<p>Alright, I don't know exactly why this is happening but it's not due to the HRR. But I suspect that it shouldn't be a blocker for the implementation of auto-derivation. I think this is a bug with type inference, but in the auto-deriver, the type variables will be explicitly linked together, and so things should "just compile"</p>



<a name="402963250"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/json%20null%20handling/near/402963250" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Isaac Van Doren <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/json.20null.20handling.html#402963250">(Nov 19 2023 at 05:28)</a>:</h4>
<p>Thanks for looking into it! I’ll go ahead with implementing the deriving for this</p>



<a name="404020033"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/json%20null%20handling/near/404020033" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Isaac Van Doren <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/json.20null.20handling.html#404020033">(Nov 24 2023 at 21:08)</a>:</h4>
<p>I would like to construct a <code>FlatDecodableKey::TagUnion(Vec&lt;(TagName, u16)&gt;)</code> <a href="https://github.com/roc-lang/roc/blob/531af182899835a9298efd758b927e5ba3e2f64a/crates/compiler/derive_key/src/decoding.rs#L75">here</a> to be used in deriving the decoder. The u16 is the arity of the tag in question. I'm not sure where I can get the arity, any suggestions?</p>



<a name="404025221"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/json%20null%20handling/near/404025221" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ayaz Hafiz <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/json.20null.20handling.html#404025221">(Nov 24 2023 at 22:20)</a>:</h4>
<p>here’s how it determined for Encode: <a href="https://github.com/roc-lang/roc/blob/531af182899835a9298efd758b927e5ba3e2f64a/crates/compiler/derive_key/src/encoding.rs#L80">https://github.com/roc-lang/roc/blob/531af182899835a9298efd758b927e5ba3e2f64a/crates/compiler/derive_key/src/encoding.rs#L80</a></p>



<a name="404051338"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/json%20null%20handling/near/404051338" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Isaac Van Doren <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/json.20null.20handling.html#404051338">(Nov 25 2023 at 03:30)</a>:</h4>
<p>Great, thanks!</p>



<a name="404772077"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/json%20null%20handling/near/404772077" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Isaac Van Doren <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/json.20null.20handling.html#404772077">(Nov 29 2023 at 03:38)</a>:</h4>
<p>I've started working on generating code for the decoder. Actually generating the code is pretty straightforward but I'm not sure what do with all of the type variables, when to unify them, and which ones to unify. I don't know how unification works in detail so perhaps I need to get more familiar with it.</p>
<p>That being said, I think I can probably get pretty far by using similar approaches to those used by the other decoder derivers.</p>
<p>Is there a good way to test the unification part incrementally? Right now I have a test in test_derive which is useful because I can see the code that gets generated, but I'm not sure about the unification piece.</p>
<p>This is my branch <a href="https://github.com/isaacvando/roc/tree/decode-tags-2">https://github.com/isaacvando/roc/tree/decode-tags-2</a></p>



<a name="404772763"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/json%20null%20handling/near/404772763" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Isaac Van Doren <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/json.20null.20handling.html#404772763">(Nov 29 2023 at 03:42)</a>:</h4>
<p>I'm also currently getting an error with the generated code about builtin functions not being found:</p>
<div class="codehilite"><pre><span></span><code>---- decoding::tag_union stdout ----
thread &#39;decoding::tag_union&#39; panicked at &#39;Derived does not typecheck:
── UNRECOGNIZED NAME ──────────────────────────────────────────────── Test.roc ─

The List module does not expose anything by the name `map`.

── UNRECOGNIZED NAME ──────────────────────────────────────────────── Test.roc ─

The Str module does not expose anything by the name `toUtf8`.

Derived def:
#Derived.decoder_[A 2,B 1] = discriminant (List.map Str.toUtf8 [&quot;A&quot;, &quot;B&quot;])
</code></pre></div>
<p>I'm not sure if if this is because I'm referencing them wrong or maybe because the derived code doesn't type check?</p>
<p>This is how I'm writing the calls:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">list_map_fn</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">Box</span>::<span class="n">new</span><span class="p">((</span>
<span class="w">        </span><span class="n">env</span><span class="p">.</span><span class="n">subs</span><span class="p">.</span><span class="n">fresh_unnamed_flex_var</span><span class="p">(),</span>
<span class="w">        </span><span class="n">Loc</span>::<span class="n">at_zero</span><span class="p">(</span><span class="n">Expr</span>::<span class="n">Var</span><span class="p">(</span>
<span class="w">            </span><span class="n">Symbol</span>::<span class="n">LIST_MAP</span><span class="p">,</span>
<span class="w">            </span><span class="n">env</span><span class="p">.</span><span class="n">subs</span><span class="p">.</span><span class="n">fresh_unnamed_flex_var</span><span class="p">(),</span>
<span class="w">        </span><span class="p">)),</span>
<span class="w">        </span><span class="n">env</span><span class="p">.</span><span class="n">subs</span><span class="p">.</span><span class="n">fresh_unnamed_flex_var</span><span class="p">(),</span>
<span class="w">        </span><span class="n">env</span><span class="p">.</span><span class="n">subs</span><span class="p">.</span><span class="n">fresh_unnamed_flex_var</span><span class="p">(),</span>
<span class="w">    </span><span class="p">));</span>

<span class="kd">let</span><span class="w"> </span><span class="n">list_map_to_utf8_call</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Expr</span>::<span class="n">Call</span><span class="p">(</span>
<span class="w">        </span><span class="n">list_map_fn</span><span class="p">,</span>
<span class="w">        </span><span class="fm">vec!</span><span class="p">[</span>
<span class="w">            </span><span class="p">(</span>
<span class="w">                </span><span class="n">env</span><span class="p">.</span><span class="n">subs</span><span class="p">.</span><span class="n">fresh_unnamed_flex_var</span><span class="p">(),</span>
<span class="w">                </span><span class="n">Loc</span>::<span class="n">at_zero</span><span class="p">(</span><span class="n">Expr</span>::<span class="n">Var</span><span class="p">(</span>
<span class="w">                    </span><span class="n">Symbol</span>::<span class="n">STR_TO_UTF8</span><span class="p">,</span>
<span class="w">                    </span><span class="n">env</span><span class="p">.</span><span class="n">subs</span><span class="p">.</span><span class="n">fresh_unnamed_flex_var</span><span class="p">(),</span>
<span class="w">                </span><span class="p">)),</span>
<span class="w">            </span><span class="p">),</span>
<span class="w">            </span><span class="p">(</span>
<span class="w">                </span><span class="n">env</span><span class="p">.</span><span class="n">subs</span><span class="p">.</span><span class="n">fresh_unnamed_flex_var</span><span class="p">(),</span>
<span class="w">                </span><span class="n">Loc</span>::<span class="n">at_zero</span><span class="p">(</span><span class="n">list_of_variants</span><span class="p">),</span>
<span class="w">            </span><span class="p">),</span>
<span class="w">        </span><span class="p">],</span>
<span class="w">        </span><span class="n">CalledVia</span>::<span class="n">Space</span><span class="p">,</span>
<span class="w">    </span><span class="p">);</span>
</code></pre></div>
<p>all the fresh_unnamed_flex_vars are placeholders for now</p>



<a name="407101224"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/json%20null%20handling/near/407101224" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Isaac Van Doren <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/json.20null.20handling.html#407101224">(Dec 10 2023 at 20:02)</a>:</h4>
<p><span class="user-mention" data-user-id="454654">@Ayaz Hafiz</span> do you know if there’s any good way to test parts of a derived decoder prior to having a full implementation?</p>



<a name="407104052"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/json%20null%20handling/near/407104052" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/json.20null.20handling.html#407104052">(Dec 10 2023 at 20:25)</a>:</h4>
<p>The uitest for deriving?</p>



<a name="407104089"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/json%20null%20handling/near/407104089" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/json.20null.20handling.html#407104089">(Dec 10 2023 at 20:25)</a>:</h4>
<p>They show then intermediate specializations info that is chosen</p>



<a name="407112643"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/json%20null%20handling/near/407112643" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ayaz Hafiz <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/json.20null.20handling.html#407112643">(Dec 10 2023 at 22:11)</a>:</h4>
<p>Not really. You can try writing a test in the <code>test_derive</code> crate (check out for example the tests for encoding/decoding in that crate)</p>



<a name="407112652"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/json%20null%20handling/near/407112652" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ayaz Hafiz <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/json.20null.20handling.html#407112652">(Dec 10 2023 at 22:11)</a>:</h4>
<p>They will check that the derived implementation is doesn't have type errors</p>



<a name="407112661"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/json%20null%20handling/near/407112661" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ayaz Hafiz <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/json.20null.20handling.html#407112661">(Dec 10 2023 at 22:11)</a>:</h4>
<p>It looks like the addition of those tests was missed for inspect.</p>



<a name="407116418"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/json%20null%20handling/near/407116418" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Isaac Van Doren <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/json.20null.20handling.html#407116418">(Dec 10 2023 at 23:10)</a>:</h4>
<p>Okay thanks</p>



<a name="407116498"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/json%20null%20handling/near/407116498" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Isaac Van Doren <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/json.20null.20handling.html#407116498">(Dec 10 2023 at 23:10)</a>:</h4>
<p>I have a test written there which is useful to see the code that is generated but doesn’t help with the variables when I’m just checking a small chunk</p>



<a name="407116554"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/json%20null%20handling/near/407116554" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Isaac Van Doren <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/json.20null.20handling.html#407116554">(Dec 10 2023 at 23:11)</a>:</h4>
<p>Another question, on Expr::Call there are three variables, one for the function, one for the closure, and one for function return type. What is the closure var and how does that differ from the function var?</p>



<a name="407120490"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/json%20null%20handling/near/407120490" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ayaz Hafiz <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/json.20null.20handling.html#407120490">(Dec 11 2023 at 00:07)</a>:</h4>
<p>The closure var is the so called "lambda set"</p>



<a name="407120551"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/json%20null%20handling/near/407120551" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ayaz Hafiz <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/json.20null.20handling.html#407120551">(Dec 11 2023 at 00:08)</a>:</h4>
<p>Each function type is of form <code>arg1, ..., argn -[clos]-&gt; ret</code>. The closure var is the "clos" part</p>



<a name="407139796"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/json%20null%20handling/near/407139796" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Isaac Van Doren <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/json.20null.20handling.html#407139796">(Dec 11 2023 at 02:44)</a>:</h4>
<p>Okay cool, thanks</p>



<a name="408719663"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/json%20null%20handling/near/408719663" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Isaac Van Doren <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/json.20null.20handling.html#408719663">(Dec 19 2023 at 01:25)</a>:</h4>
<p>Hi folks, working on this (adding support for decoding into tag unions) has become a drain recently so I am going to stop. If anyone would like to pick up on my progress, it is <a href="https://github.com/isaacvando/roc/tree/decode-tags-2">here</a>. I implemented discriminant, the necessary boilerplate, an example derived decoder, and some of the code to generate decoders. Thanks for the help along the way! If anyone does want to pick it up I’m happy to answer questions about my approach.</p>



<a name="408725828"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/json%20null%20handling/near/408725828" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/json.20null.20handling.html#408725828">(Dec 19 2023 at 02:15)</a>:</h4>
<p>fair enough, thanks for taking it this far - really appreciate it! <span aria-label="smiley" class="emoji emoji-1f603" role="img" title="smiley">:smiley:</span></p>



<a name="408744248"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/json%20null%20handling/near/408744248" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Isaac Van Doren <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/json.20null.20handling.html#408744248">(Dec 19 2023 at 03:26)</a>:</h4>
<p>Thanks for the opportunity! It was very cool to work on</p>



<hr><p>Last updated: Mar 01 2026 at 12:20 UTC</p>
</html>