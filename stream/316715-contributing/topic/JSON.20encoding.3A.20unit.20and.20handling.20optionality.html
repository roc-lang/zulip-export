<html>
<head><meta charset="utf-8"><title>JSON encoding: unit and handling optionality · contributing · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/index.html">contributing</a></h2>
<h3>Topic: <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/JSON.20encoding.3A.20unit.20and.20handling.20optionality.html">JSON encoding: unit and handling optionality</a></h3>

<hr>

<base href="https://roc.zulipchat.com">

<head><link href="https://roc-lang.github.io/zulip-export/style.css" rel="stylesheet"></head>

<a name="571059470"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/JSON%20encoding%3A%20unit%20and%20handling%20optionality/near/571059470" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/JSON.20encoding.3A.20unit.20and.20handling.20optionality.html#571059470">(Jan 30 2026 at 15:31)</a>:</h4>
<p>I think this is a complicated issue and I don't think <code>Maybe</code>/<code>Option</code> is the obvious answer. I think the downsides are subtle and nonobvious.</p>



<a name="571060714"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/JSON%20encoding%3A%20unit%20and%20handling%20optionality/near/571060714" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/JSON.20encoding.3A.20unit.20and.20handling.20optionality.html#571060714">(Jan 30 2026 at 15:36)</a>:</h4>
<p>for example, a potential design we could consider is having encoding and decoding have a special concept of "optional" tag unions, which are defined as tag unions with exactly 2 tags, where one of them has a payload of exactly one value and the other has no payload (so, the same shape as <code>Option</code>/<code>Maybe</code>/etc.)</p>



<a name="571061042"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/JSON%20encoding%3A%20unit%20and%20handling%20optionality/near/571061042" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/JSON.20encoding.3A.20unit.20and.20handling.20optionality.html#571061042">(Jan 30 2026 at 15:37)</a>:</h4>
<p>at that point, the json library doesn't need to be coupled to an <code>Option</code> or a <code>Maybe</code> type, and you can use more descriptive things in your data model than <code>Some</code>/<code>None</code>, e.g. <code>Found</code>/<code>NotFound</code>, <code>Provided</code>/<code>Omitted</code>, <code>Present</code>/<code>Absent</code>, <code>Available</code>/<code>Unavailable</code>, etc.</p>



<a name="571082640"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/JSON%20encoding%3A%20unit%20and%20handling%20optionality/near/571082640" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eli Dowling <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/JSON.20encoding.3A.20unit.20and.20handling.20optionality.html#571082640">(Jan 30 2026 at 17:11)</a>:</h4>
<p>I don't love that idea. <br>
I actually agree that being more specific is good. However there are a few big concerns i have with that.</p>
<ol>
<li>Compiler only: This is a feature not available to library authors, it's a special case inside the compiler that people have to learn, it feels like a hack.</li>
<li>Option types aren't just about encode/decode: mapping the Some variant, converting the none to a result with a specific error. all of this presumably would need more special compiler magic or not be available.</li>
<li>Unintuitive behaviour: What if i really did just want a tag union with that shape and now it's suddenly getting encoded in an unexpected way? That's weird and annoying and i don't see a solution when that's happening, without introducing some additional language construct or type system feature.</li>
</ol>
<p>Another option would be to just use a result right? <br>
I do have some objections to that too</p>
<ol>
<li>optionality is a real world property that needs to be modeled. A thing can exist or not exist. This is common, and very different to failure. Something not existing is not necessarily an error state and calling it one feels confused.</li>
<li>Options can now combine with errors, which again feels wrong, like if I do a http request to check if the fridge has milk. No milk, is not really at all related to 500. One is data representing the world, the other is a software fault.</li>
</ol>
<p>Just so we're clear I'm fully onboard with trying to find a better alternative and exploring solutions, but obviously thaey have to be better than the status quo, and I think being harshly critical is a good way to figure out if an idea is worth implementing.</p>
<p>I've also considered implementing option in terms of result, just with type aliases None:Err(None) and Some(a):Ok(a). I feel like that keeps error accumulation (if that's wanted) without having the weirdness of none being a failure. I don't like that much either. but it's a thought.</p>



<a name="571082715"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/JSON%20encoding%3A%20unit%20and%20handling%20optionality/near/571082715" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eli Dowling <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/JSON.20encoding.3A.20unit.20and.20handling.20optionality.html#571082715">(Jan 30 2026 at 17:11)</a>:</h4>
<p>Should this maybe be moved to an ideas discussion? I don't have permissions to do that.</p>



<a name="571104495"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/JSON%20encoding%3A%20unit%20and%20handling%20optionality/near/571104495" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/JSON.20encoding.3A.20unit.20and.20handling.20optionality.html#571104495">(Jan 30 2026 at 19:06)</a>:</h4>
<p>yeah those are all good points!</p>



<a name="571105390"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/JSON%20encoding%3A%20unit%20and%20handling%20optionality/near/571105390" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/JSON.20encoding.3A.20unit.20and.20handling.20optionality.html#571105390">(Jan 30 2026 at 19:10)</a>:</h4>
<p>I think not having <code>Option</code> or similar in the stdlib has been <em>great</em> for return values, because it's so clear that all "this operation failed" APIs should standardize on one type and one way to do it</p>



<a name="571106559"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/JSON%20encoding%3A%20unit%20and%20handling%20optionality/near/571106559" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/JSON.20encoding.3A.20unit.20and.20handling.20optionality.html#571106559">(Jan 30 2026 at 19:17)</a>:</h4>
<p>the main reasons I'm trying to find alternatives to <code>Option</code> for these use cases (which I certainly agree are important!) are: </p>
<ul>
<li>Not wanting to lose "there's one obvious way to do it" when it comes to return types. It's possible that our <code>?</code> operator combined with the stdlib being consistent about this will be sufficient to prevent that from happening - e.g. "Why would I return <code>Option</code>? Then I miss out on <code>?</code> and failure tag union accumulation!"</li>
<li>opportunity cost compared to other designs. For example, some languages have a more first-class "optional type" concept which can be used for things like optional record fields. (Default record fields ended up not working out for structural types, but similar features have totally different tradeoffs when it comes to nominal records, which we now have, and we haven't reevaluated the design space there since adding nominal records.)</li>
</ul>



<a name="571106741"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/JSON%20encoding%3A%20unit%20and%20handling%20optionality/near/571106741" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/JSON.20encoding.3A.20unit.20and.20handling.20optionality.html#571106741">(Jan 30 2026 at 19:18)</a>:</h4>
<p>but I think if we pull the trigger on adding <code>Option</code> to the stdlib, it will become entrenched and potentially better designs will never get explored properly.</p>



<a name="571107402"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/JSON%20encoding%3A%20unit%20and%20handling%20optionality/near/571107402" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/JSON.20encoding.3A.20unit.20and.20handling.20optionality.html#571107402">(Jan 30 2026 at 19:21)</a>:</h4>
<p>one concrete design question: supposing we added support for a concept of "optional record fields" (not just default, but actually optional where if you omit the field when passing the record to a function, the function can actually tell at runtime whether the field was present or missing</p>



<a name="571107705"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/JSON%20encoding%3A%20unit%20and%20handling%20optionality/near/571107705" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/JSON.20encoding.3A.20unit.20and.20handling.20optionality.html#571107705">(Jan 30 2026 at 19:23)</a>:</h4>
<p>if we had that, would we still want <code>Option</code>? If so, for what? e.g. JSON happens to make a distinction between "field was present but <code>null</code> vs field was missing" but does that matter from a decoding perspective? And does it matter from an encoding perspective if you can just tell the <code>encode</code> function "use <code>null</code> when I omit a field"?</p>



<a name="571116414"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/JSON%20encoding%3A%20unit%20and%20handling%20optionality/near/571116414" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Notification Bot <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/JSON.20encoding.3A.20unit.20and.20handling.20optionality.html#571116414">(Jan 30 2026 at 20:16)</a>:</h4>
<p>19 messages were moved here from <a class="stream-topic" data-stream-id="316715" href="/#narrow/channel/316715-contributing/topic/Worklog.20.28Draft.20PRs.20and.20coordination.29/with/570435779">#contributing &gt; Worklog (Draft PRs and coordination)</a> by <span class="user-mention silent" data-user-id="341568">Jared Ramirez</span>.</p>



<a name="571142101"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/JSON%20encoding%3A%20unit%20and%20handling%20optionality/near/571142101" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eli Dowling <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/JSON.20encoding.3A.20unit.20and.20handling.20optionality.html#571142101">(Jan 30 2026 at 23:39)</a>:</h4>
<p>I definitely agree with you there! And I think in the short term a non-stdlib option type, in a package is the way to go. I think that makes it clear that its "a solution" not "the solution" and that things can change.</p>
<p>When writing the json decoder I would include a specific "json option" tag union with <code>[null, undefined, value(a)]</code><br>
And then also include an option to choose whether normal option becomes null (this should be the default), or undefined.</p>
<p>I think there are rare cases where you want granular control and we should provide it to you. </p>
<p>In fact maybe we should include an "encoding option" because many formats have a differnce between null and missing. <br>
Yaml <br>
Xml had XSI:null vs no tag</p>
<p>We could say "this will make a best effort to encode as whatever null is in your output langauge, but for some it may be the same as undefined" </p>
<p>As for optional record fields I think it would be great if there was a way to have optional fields that supported structural and nominal types. Restricting it to nominal types would make most deserialization and serialization require nominal types which I think would be a shame. I think if would reduce the use of structural types significantly. If they aren't at the edge of your code they likely just won't be used as much inside.</p>



<a name="571514957"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/JSON%20encoding%3A%20unit%20and%20handling%20optionality/near/571514957" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/JSON.20encoding.3A.20unit.20and.20handling.20optionality.html#571514957">(Feb 02 2026 at 20:02)</a>:</h4>
<p>we had defaultable fields in structural records in the original Rust compiler, and my conclusion based on how it went is that it wasn't a good idea after all</p>



<a name="571518239"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/JSON%20encoding%3A%20unit%20and%20handling%20optionality/near/571518239" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dan G Knutson <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/JSON.20encoding.3A.20unit.20and.20handling.20optionality.html#571518239">(Feb 02 2026 at 20:24)</a>:</h4>
<p>does current roc have a 'spread' operator that would let you do a rust-style:</p>
<div class="codehilite"><pre><span></span><code>thing = Thing {
  color: Red,
  ..Thing.default(),
}
</code></pre></div>



<a name="571519234"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/JSON%20encoding%3A%20unit%20and%20handling%20optionality/near/571519234" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/JSON.20encoding.3A.20unit.20and.20handling.20optionality.html#571519234">(Feb 02 2026 at 20:30)</a>:</h4>
<p><a href="https://github.com/roc-lang/roc/issues/7097">https://github.com/roc-lang/roc/issues/7097</a></p>



<a name="571519291"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/JSON%20encoding%3A%20unit%20and%20handling%20optionality/near/571519291" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/JSON.20encoding.3A.20unit.20and.20handling.20optionality.html#571519291">(Feb 02 2026 at 20:31)</a>:</h4>
<p>yes that is the plan I believe</p>
<div class="codehilite"><pre><span></span><code>updatedRecord = { foo: 123, bar: &quot;abc&quot;, ..record }
</code></pre></div>



<hr><p>Last updated: Mar 01 2026 at 12:20 UTC</p>
</html>