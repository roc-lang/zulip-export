<html>
<head><meta charset="utf-8"><title>interpreter · contributing · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/index.html">contributing</a></h2>
<h3>Topic: <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/interpreter.html">interpreter</a></h3>

<hr>

<base href="https://roc.zulipchat.com">

<head><link href="https://roc-lang.github.io/zulip-export/style.css" rel="stylesheet"></head>

<a name="518845611"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/interpreter/near/518845611" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/interpreter.html#518845611">(May 17 2025 at 19:07)</a>:</h4>
<p>on the plane back from <span aria-label="flag netherlands" class="emoji emoji-1f1f3-1f1f1" role="img" title="flag netherlands">:flag_netherlands:</span> I got started on the interpreter</p>



<a name="518845702"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/interpreter/near/518845702" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/interpreter.html#518845702">(May 17 2025 at 19:08)</a>:</h4>
<p>I think we concluded that we wanted to essentially have it output exactly the bytes the host expects, right <span class="user-mention" data-user-id="343810">@Brendan Hansknecht</span>?</p>



<a name="518845758"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/interpreter/near/518845758" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/interpreter.html#518845758">(May 17 2025 at 19:09)</a>:</h4>
<p>Hey i was just talking about how much I'd like to see a v0.1 Hello World running...</p>



<a name="518845797"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/interpreter/near/518845797" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/interpreter.html#518845797">(May 17 2025 at 19:09)</a>:</h4>
<p>and then have the inferred types off to the side (like we do today in the repl) so we can tell what their layout is</p>



<a name="518845829"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/interpreter/near/518845829" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/interpreter.html#518845829">(May 17 2025 at 19:09)</a>:</h4>
<p>Yeah, that sounds roughly right</p>



<a name="518845912"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/interpreter/near/518845912" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/interpreter.html#518845912">(May 17 2025 at 19:10)</a>:</h4>
<p>this seems like what we need for debug builds, since the host has the same abi for debug and release builds</p>



<a name="518845946"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/interpreter/near/518845946" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/interpreter.html#518845946">(May 17 2025 at 19:10)</a>:</h4>
<p>The shim function that the host calls would generate the type spec (cause it knows this from the roc types at compile time). Then it would call into the interepretter passing in raw data and types.</p>



<a name="518845966"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/interpreter/near/518845966" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/interpreter.html#518845966">(May 17 2025 at 19:11)</a>:</h4>
<p>And yeah, same abi for debug and release is the important part.</p>



<a name="518845967"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/interpreter/near/518845967" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/interpreter.html#518845967">(May 17 2025 at 19:11)</a>:</h4>
<p>yeah makes sense!</p>



<a name="518845996"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/interpreter/near/518845996" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/interpreter.html#518845996">(May 17 2025 at 19:11)</a>:</h4>
<p>and then when interpreting constants at compile time, we can do what the repl does</p>



<a name="518846013"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/interpreter/near/518846013" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/interpreter.html#518846013">(May 17 2025 at 19:11)</a>:</h4>
<p>namely traverse the data and use the types to know where to put everything</p>



<a name="518846098"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/interpreter/near/518846098" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/interpreter.html#518846098">(May 17 2025 at 19:12)</a>:</h4>
<p>yep</p>



<a name="518846184"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/interpreter/near/518846184" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/interpreter.html#518846184">(May 17 2025 at 19:14)</a>:</h4>
<p>this is a snippet of the direction I'm going:</p>
<div class="codehilite" data-code-language="Zig"><pre><span></span><code><span class="w">            </span><span class="k">switch</span><span class="w"> </span><span class="p">(</span><span class="n">op_stack</span><span class="p">.</span><span class="n">pop</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="p">.</span><span class="n">branch</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">                    </span><span class="kr">const</span><span class="w"> </span><span class="n">then_idx</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">idx_stack</span><span class="p">.</span><span class="n">pop</span><span class="p">();</span>
<span class="w">                    </span><span class="kr">const</span><span class="w"> </span><span class="n">else_idx</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">idx_stack</span><span class="p">.</span><span class="n">pop</span><span class="p">();</span>
<span class="w">                    </span><span class="kr">const</span><span class="w"> </span><span class="n">cond</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">try</span><span class="w"> </span><span class="n">val_stack</span><span class="p">.</span><span class="n">pop</span><span class="p">().</span><span class="n">asBool</span><span class="p">();</span>
<span class="w">                    </span><span class="n">idx_stack</span><span class="p">.</span><span class="n">push</span><span class="p">(</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">cond</span><span class="p">)</span><span class="w"> </span><span class="n">then_idx</span><span class="p">,</span><span class="w"> </span><span class="n">else_idx</span><span class="p">);</span>
<span class="w">                    </span><span class="n">op_stack</span><span class="p">.</span><span class="n">push</span><span class="p">(</span><span class="n">Op</span><span class="p">.</span><span class="n">eval</span><span class="p">);</span>
<span class="w">                </span><span class="p">},</span>
<span class="w">                </span><span class="p">.</span><span class="n">assign</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">                    </span><span class="n">scope</span><span class="p">.</span><span class="n">insert</span><span class="p">(</span><span class="n">ident_stack</span><span class="p">.</span><span class="n">pop</span><span class="p">(),</span><span class="w"> </span><span class="n">val_stack</span><span class="p">.</span><span class="n">pop</span><span class="p">());</span>
<span class="w">                </span><span class="p">},</span>
<span class="w">                </span><span class="p">.</span><span class="n">begin_scope</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">                    </span><span class="c1">// TODO</span>
<span class="w">                </span><span class="p">},</span>
<span class="w">                </span><span class="p">.</span><span class="n">end_scope</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">                    </span><span class="c1">// TODO</span>
<span class="w">                </span><span class="p">},</span>
<span class="w">                </span><span class="p">.</span><span class="n">crash</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">                    </span><span class="c1">// TODO return a crash error along with the string.</span>
<span class="w">                </span><span class="p">},</span>
<span class="w">                </span><span class="p">.</span><span class="n">eval</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">                    </span><span class="kr">const</span><span class="w"> </span><span class="n">idx</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">idx_stack</span><span class="p">.</span><span class="n">pop</span><span class="p">();</span>

<span class="w">                    </span><span class="k">switch</span><span class="w"> </span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">exprAt</span><span class="p">(</span><span class="n">idx</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">                        </span><span class="p">.</span><span class="n">if_then_else</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="o">|</span><span class="n">if_then_else</span><span class="o">|</span><span class="w"> </span><span class="p">{</span>
<span class="w">                            </span><span class="c1">// first, eval the condition</span>
<span class="w">                            </span><span class="n">op_stack</span><span class="p">.</span><span class="n">push</span><span class="p">(</span><span class="n">Op</span><span class="p">.</span><span class="n">eval</span><span class="p">);</span>
<span class="w">                            </span><span class="n">idx_stack</span><span class="p">.</span><span class="n">push</span><span class="p">(</span><span class="n">if_then_else</span><span class="p">.</span><span class="n">condIdx</span><span class="p">());</span>

<span class="w">                            </span><span class="c1">// next, do an if/else branch</span>
<span class="w">                            </span><span class="n">op_stack</span><span class="p">.</span><span class="n">push</span><span class="p">(</span><span class="n">Op</span><span class="p">.</span><span class="n">branch</span><span class="p">);</span>
<span class="w">                            </span><span class="n">idx_stack</span><span class="p">.</span><span class="n">push</span><span class="p">(</span><span class="n">if_then_else</span><span class="p">.</span><span class="n">thenIdx</span><span class="p">());</span>
<span class="w">                            </span><span class="n">idx_stack</span><span class="p">.</span><span class="n">push</span><span class="p">(</span><span class="n">if_then_else</span><span class="p">.</span><span class="n">elseIdx</span><span class="p">());</span>
<span class="w">                        </span><span class="p">},</span>
<span class="w">                        </span><span class="p">.</span><span class="n">block</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="o">|</span><span class="n">block</span><span class="o">|</span><span class="w"> </span><span class="p">{</span>
<span class="w">                            </span><span class="c1">// blocks get their own scope for their assignments</span>
<span class="w">                            </span><span class="n">op_stack</span><span class="p">.</span><span class="n">push</span><span class="p">(</span><span class="n">Op</span><span class="p">.</span><span class="n">begin_scope</span><span class="p">);</span>

<span class="w">                            </span><span class="c1">// run all the statements preceding the expr</span>
<span class="w">                            </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">block</span><span class="p">.</span><span class="n">stmts</span><span class="p">)</span><span class="w"> </span><span class="o">|</span><span class="n">stmt</span><span class="o">|</span><span class="w"> </span><span class="p">{</span>
<span class="w">                                </span><span class="k">switch</span><span class="w"> </span><span class="p">(</span><span class="n">stmt</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                                    </span><span class="p">.</span><span class="n">assign</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="o">|</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">idx</span><span class="o">|</span><span class="w"> </span><span class="p">{</span>
<span class="w">                                        </span><span class="c1">// eval the expr that's being assigned to name</span>
<span class="w">                                        </span><span class="n">op_stack</span><span class="p">.</span><span class="n">push</span><span class="p">(</span><span class="n">Op</span><span class="p">.</span><span class="n">eval</span><span class="p">);</span>
<span class="w">                                        </span><span class="n">idx_stack</span><span class="p">.</span><span class="n">push</span><span class="p">(</span><span class="n">idx</span><span class="p">);</span>

<span class="w">                                        </span><span class="c1">// assign it to name</span>
<span class="w">                                        </span><span class="n">op_stack</span><span class="p">.</span><span class="n">push</span><span class="p">(</span><span class="n">Op</span><span class="p">.</span><span class="n">assign</span><span class="p">);</span>
<span class="w">                                        </span><span class="n">ident_stack</span><span class="p">.</span><span class="n">push</span><span class="p">(</span><span class="n">name</span><span class="p">);</span>
<span class="w">                                    </span><span class="p">},</span>
<span class="w">                                </span><span class="p">}</span>
<span class="w">                            </span><span class="p">}</span>

<span class="w">                            </span><span class="c1">// eval the expr at the end of the block</span>
<span class="w">                            </span><span class="n">op_stack</span><span class="p">.</span><span class="n">push</span><span class="p">(</span><span class="n">Op</span><span class="p">.</span><span class="n">eval</span><span class="p">);</span>
<span class="w">                            </span><span class="n">idx_stack</span><span class="p">.</span><span class="n">push</span><span class="p">(</span><span class="n">block</span><span class="p">.</span><span class="n">expr</span><span class="p">);</span>

<span class="w">                            </span><span class="n">op_stack</span><span class="p">.</span><span class="n">push</span><span class="p">(</span><span class="n">Op</span><span class="p">.</span><span class="n">end_scope</span><span class="p">);</span>
<span class="w">                        </span><span class="p">},</span>
<span class="w">                    </span><span class="p">}</span>
<span class="w">                </span><span class="p">},</span>
<span class="w">            </span><span class="p">}</span>
</code></pre></div>



<a name="518846257"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/interpreter/near/518846257" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/interpreter.html#518846257">(May 17 2025 at 19:14)</a>:</h4>
<p>that's all in a loop, where all the <code>stack</code>s are in scope</p>



<a name="518846281"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/interpreter/near/518846281" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/interpreter.html#518846281">(May 17 2025 at 19:14)</a>:</h4>
<p>not using recursion because we don't want the interpreter to blow the stack</p>



<a name="518846457"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/interpreter/near/518846457" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/interpreter.html#518846457">(May 17 2025 at 19:16)</a>:</h4>
<p>That seems reasonable for a base implementation. I'm sure we'll eventually have a lot a tricks for perf, but those aren't too important now.</p>



<a name="518846492"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/interpreter/near/518846492" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/interpreter.html#518846492">(May 17 2025 at 19:17)</a>:</h4>
<p>yeah my thinking is that for now the interpreter needs to be:</p>
<ul>
<li>ABI-compatible with release builds</li>
<li>correct</li>
<li>stack-safe</li>
</ul>



<a name="518846508"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/interpreter/near/518846508" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/interpreter.html#518846508">(May 17 2025 at 19:17)</a>:</h4>
<p>Yeah, that seems like great priorities</p>



<a name="518846511"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/interpreter/near/518846511" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/interpreter.html#518846511">(May 17 2025 at 19:17)</a>:</h4>
<p>and then yeah we can see how the perf is in practice and evaluate things accordingly</p>



<a name="518846585"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/interpreter/near/518846585" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/interpreter.html#518846585">(May 17 2025 at 19:18)</a>:</h4>
<p>I want to basically just get it off the ground and then let others pick it up</p>



<a name="518966700"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/interpreter/near/518966700" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/interpreter.html#518966700">(May 18 2025 at 23:12)</a>:</h4>
<p>Very excited to see something minimal working...</p>



<a name="520274761"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/interpreter/near/520274761" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> tk <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/interpreter.html#520274761">(May 25 2025 at 08:52)</a>:</h4>
<p>Two dumb questions:</p>
<ol>
<li>Is this an inprogress Roc interpreter written in Rust ?</li>
<li>Where can I find this code on github ?</li>
</ol>
<p>Context: I'm working on a project where I need an embedded interpreter where I can place cpu/memory limits (thus, somehow limit the bytecode interpreter). I am not looking for the Roc -&gt; wasm compiler. I am looking to see if there is a Roc interpreter written in Rust somewhere -- and stumbled across this thread.</p>



<a name="520280948"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/interpreter/near/520280948" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/interpreter.html#520280948">(May 25 2025 at 10:30)</a>:</h4>
<p>the Roc compiler as a whole is being rewritten in Zig, and that's where the interpreter will be as well</p>



<a name="520302959"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/interpreter/near/520302959" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> tk <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/interpreter.html#520302959">(May 25 2025 at 15:44)</a>:</h4>
<p>is the Rust compiler getting abandoned ? is there a thread where this Rust -&gt; Zig switch was debated ? I am mainly curious to understand the reasoning.</p>



<a name="520303026"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/interpreter/near/520303026" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/interpreter.html#520303026">(May 25 2025 at 15:45)</a>:</h4>
<p>Yeah, rust implementation is being abandoned</p>



<a name="520303932"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/interpreter/near/520303932" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/interpreter.html#520303932">(May 25 2025 at 15:58)</a>:</h4>
<p><span class="user-mention" data-user-id="919530">@tk</span> I wrote up this explanation back at the time: <a href="https://gist.github.com/rtfeldman/505bc158ad6965a71ff2777ad8451209">https://gist.github.com/rtfeldman/505bc158ad6965a71ff2777ad8451209</a></p>



<a name="520313738"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/interpreter/near/520313738" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> tk <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/interpreter.html#520313738">(May 25 2025 at 18:15)</a>:</h4>
<blockquote>
<p>Zig's x86-64 backend can reportedly scratch-build (without anything cached) the entire 300K-line Zig compiler code base in a second or two. It takes us longer than that to build one of our medium-sized Rust crates, and that's even <em>with</em> the benefit of caching.</p>
</blockquote>
<p>Yeah, I guess that is pretty relevant. I have a 100 kloc project with another 200 kloc forked crates, and I'd kill for a 2-second non-cached build time.</p>



<a name="520318036"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/interpreter/near/520318036" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthew Lugg <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/interpreter.html#520318036">(May 25 2025 at 19:14)</a>:</h4>
<p>it's worth noting that the numbers there are unfortunately overly optimistic right now, and aiui were based on a miscommunication between richand and andrew</p>



<a name="520318308"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/interpreter/near/520318308" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/interpreter.html#520318308">(May 25 2025 at 19:18)</a>:</h4>
<p>yeah, although as I understand it, incremental zig with non-llvm backend should outperform Rust by a lot once we get there</p>



<a name="520318343"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/interpreter/near/520318343" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/interpreter.html#520318343">(May 25 2025 at 19:19)</a>:</h4>
<p>and Zig is very close to that, whereas at least at the moment nothing like that is anywhere on Rust's roadmap (although I still hope that changes!)</p>



<a name="520318559"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/interpreter/near/520318559" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthew Lugg <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/interpreter.html#520318559">(May 25 2025 at 19:22)</a>:</h4>
<p>for the zig compiler, getting compile errors for a core subset of the pipeline is the number in question of 1-2 seconds (it's actually like 5 on my system but my system is currently a laptop lol), actually properly building just those core components is maybe around 50-100% more time all in all, building the whole compiler (llvm and package manager and all) is 25 seconds on my system and probably 15-20 seconds on a reasonable desktop. these are all scratch builds. we're aiming to improve these numbers over time ofc, compiler performance remains a high priority.</p>
<p>and, yeah, incremental builds are the real killer feature for development. idk if anyone on the roc team has had a reason to try out incremental compilation yet, but when it works (there are still occasional bugs, although for some use cases it's fairly solid now) it's <em>amazing</em>. my main use for it right now is after i've done a big local patch, and it's time to start fixing compile errors, i will spin up (approximately) <code>zig build -Dno-bin -fincremental --watch --prominent-compile-errors</code> in a new terminal, and it will just do semantic analysis on my code and show me all the compile errors; i fix them one at a time, and every time i save a file, i typically get new error output in somewhere between [idk, too fast to see] and (absolute worst case, because of some pathological cases the zig compiler handles poorly at the moment) 2 seconds</p>



<a name="520318723"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/interpreter/near/520318723" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthew Lugg <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/interpreter.html#520318723">(May 25 2025 at 19:24)</a>:</h4>
<p>well, i will be absolutely fair and say if you get <em>real</em> unlucky with how you hit a pathological case you might get close to scratch build time for one update. there is basically one design flaw in the current implementation of incremental compilation which causes these pathological cases where the compiler does way more work than it should need to, it's sooooomewhere on my priority list to solve</p>



<a name="520318870"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/interpreter/near/520318870" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthew Lugg <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/interpreter.html#520318870">(May 25 2025 at 19:26)</a>:</h4>
<p>i'm not trying to evangelise btw, i do apologise if it comes across that way, just trying to clarify the current real-world performance with the most realistic numbers i can</p>
<p>oh, and final note: all of the numbers above are with the self-hosted x86_64 backend. right now that's the only self-hosted backend which is generally usable (it's likely to become the default on x86_64-linux somewhat soon); for other targets you usually still have to go through LLVM, which comes with huge compilation speed losses because LLVM is (imo) wholly unreasonably slow at producing debug-mode binaries</p>
<p>okay, i'm done, sorry for wall of text :D</p>



<a name="520319615"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/interpreter/near/520319615" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/interpreter.html#520319615">(May 25 2025 at 19:36)</a>:</h4>
<p>Always a good sign to have honest engineers giving real world number and caveats</p>



<a name="520320979"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/interpreter/near/520320979" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/interpreter.html#520320979">(May 25 2025 at 19:56)</a>:</h4>
<p>yeah I haven't tried it yet, but that's mostly because our Zig compiler code base is still small enough that even cold compile times aren't long enough to be a pain point for me yet <span aria-label="smile" class="emoji emoji-1f604" role="img" title="smile">:smile:</span></p>



<a name="520320998"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/interpreter/near/520320998" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/interpreter.html#520320998">(May 25 2025 at 19:57)</a>:</h4>
<p>I'm hoping that there will be an aarch64 backend by the time I want to reach for it <span aria-label="fingers crossed" class="emoji emoji-1f91e" role="img" title="fingers crossed">:fingers_crossed:</span></p>



<a name="520321000"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/interpreter/near/520321000" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> tk <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/interpreter.html#520321000">(May 25 2025 at 19:57)</a>:</h4>
<p><span class="user-mention" data-user-id="918459">@Matthew Lugg</span> </p>
<blockquote>
<p>okay, i'm done, sorry for wall of text :D</p>
</blockquote>
<p>I found the wall of text really insightful. Thank you for taking your time to write out your experience. I do agree with you, alot of the time, what I really care about is 'time to first compile error', and less full on compile time.</p>



<a name="520322632"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/interpreter/near/520322632" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthew Lugg <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/interpreter.html#520322632">(May 25 2025 at 20:20)</a>:</h4>
<p><span class="user-mention silent" data-user-id="281383">Richard Feldman</span> <a href="#narrow/channel/316715-contributing/topic/interpreter/near/520320998">said</a>:</p>
<blockquote>
<p>I'm hoping that there will be an aarch64 backend by the time I want to reach for it <span aria-label="fingers crossed" class="emoji emoji-1f91e" role="img" title="fingers crossed">:fingers_crossed:</span></p>
</blockquote>
<p>ah yes, i always forget that people actually run aarch64 now lol</p>



<a name="520322902"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/interpreter/near/520322902" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthew Lugg <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/interpreter.html#520322902">(May 25 2025 at 20:24)</a>:</h4>
<p><span class="user-mention silent" data-user-id="919530">tk</span> <a href="#narrow/channel/316715-contributing/topic/interpreter/near/520321000">said</a>:</p>
<blockquote>
<p><span class="user-mention silent" data-user-id="918459">Matthew Lugg</span> </p>
<blockquote>
<p>okay, i'm done, sorry for wall of text :D</p>
</blockquote>
<p>I found the wall of text really insightful. Thank you for taking your time to write out your experience. I do agree with you, alot of the time, what I really care about is 'time to first compile error', and less full on compile time.</p>
</blockquote>
<p>no worries, do feel free to ping me with questions about this for the record, i tend to kind of enjoy discussing the compiler internals and how to get the most out of them</p>
<p>and indeed, in cases where i need fast compiles, usually what i <em>actually</em> need is fast response about compile errors. full-on incremental compilation is still very valuable ofc, it's still very actively being worked towards, but even without the codegen i find the feature incredibly useful. one interesting thing it makes feasible is a language server (as in, LSP) communicating with the compiler to quickly get up-to-date information about the compilation</p>



<a name="520324034"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/interpreter/near/520324034" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/interpreter.html#520324034">(May 25 2025 at 20:39)</a>:</h4>
<p><span class="user-mention silent" data-user-id="918459">Matthew Lugg</span> <a href="#narrow/stream/316715-contributing/topic/interpreter/near/520322632">said</a>:</p>
<blockquote>
<p><span class="user-mention silent" data-user-id="281383">Richard Feldman</span> <a href="#narrow/channel/316715-contributing/topic/interpreter/near/520320998">said</a>:</p>
<blockquote>
<p>I'm hoping that there will be an aarch64 backend by the time I want to reach for it <span aria-label="fingers crossed" class="emoji emoji-1f91e" role="img" title="fingers crossed">:fingers_crossed:</span></p>
</blockquote>
<p>ah yes, i always forget that people actually run aarch64 now lol</p>
</blockquote>
<p>everyone who has a Mac, yes <span aria-label="smile" class="emoji emoji-1f604" role="img" title="smile">:smile:</span></p>



<a name="520324208"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/interpreter/near/520324208" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthew Lugg <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/interpreter.html#520324208">(May 25 2025 at 20:41)</a>:</h4>
<p>what's really fun is that in principle you could just use the x86_64 backend and Rosetta 2, but iirc our linker (or maybe our actual codegen?) manages to emit something that completely breaks Rosetta</p>



<hr><p>Last updated: Mar 01 2026 at 12:20 UTC</p>
</html>