<html>
<head><meta charset="utf-8"><title>Random number generator · contributing · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/index.html">contributing</a></h2>
<h3>Topic: <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Random.20number.20generator.html">Random number generator</a></h3>

<hr>

<base href="https://roc.zulipchat.com">

<head><link href="https://roc-lang.github.io/zulip-export/style.css" rel="stylesheet"></head>

<a name="290255206"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Random%20number%20generator/near/290255206" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Martin Stewart <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Random.20number.20generator.html#290255206">(Jul 20 2022 at 15:54)</a>:</h4>
<p>I'm going to try implementing a random number generator package but I figure I should double check first if anyone has already implemented one.</p>



<a name="290255587"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Random%20number%20generator/near/290255587" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ayaz Hafiz <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Random.20number.20generator.html#290255587">(Jul 20 2022 at 15:57)</a>:</h4>
<p>I believe <span class="user-mention" data-user-id="462053">@JanCVanB</span> did something around this</p>



<a name="290255873"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Random%20number%20generator/near/290255873" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Random.20number.20generator.html#290255873">(Jul 20 2022 at 15:58)</a>:</h4>
<p><a href="https://github.com/JanCVanB/roc-random">https://github.com/JanCVanB/roc-random</a></p>



<a name="290255970"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Random%20number%20generator/near/290255970" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Martin Stewart <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Random.20number.20generator.html#290255970">(Jul 20 2022 at 15:59)</a>:</h4>
<p>Nice, good thing I checked then <span aria-label="thumbs up" class="emoji emoji-1f44d" role="img" title="thumbs up">:thumbs_up:</span></p>



<a name="290275089"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Random%20number%20generator/near/290275089" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jan kili <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Random.20number.20generator.html#290275089">(Jul 20 2022 at 18:12)</a>:</h4>
<p><span aria-label="grinning face with smiling eyes" class="emoji emoji-1f601" role="img" title="grinning face with smiling eyes">:grinning_face_with_smiling_eyes:</span></p>



<a name="290275199"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Random%20number%20generator/near/290275199" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jan kili <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Random.20number.20generator.html#290275199">(Jul 20 2022 at 18:13)</a>:</h4>
<p>I got it to v1 in a week, a few months ago, and I was looking for feedback for v2.</p>



<a name="290275374"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Random%20number%20generator/near/290275374" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jan kili <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Random.20number.20generator.html#290275374">(Jul 20 2022 at 18:14)</a>:</h4>
<p>Feedback, contributions, and collaborators are always welcome! Usage and interest of the lib would make me reprioritize it.</p>



<a name="290276120"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Random%20number%20generator/near/290276120" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jan kili <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Random.20number.20generator.html#290276120">(Jul 20 2022 at 18:19)</a>:</h4>
<p>This was my first experience with RNG theory &amp; implementation, so some of my naming/terminology might be off.</p>



<a name="290276385"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Random%20number%20generator/near/290276385" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jan kili <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Random.20number.20generator.html#290276385">(Jul 20 2022 at 18:20)</a>:</h4>
<p>Why are you interested in RNG? :) I was drawn to its seemingly-impure nature (potentially conflicting with Roc's purity) and use cases in art, data visualization, simulation, and games.</p>



<a name="290276778"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Random%20number%20generator/near/290276778" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jan kili <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Random.20number.20generator.html#290276778">(Jul 20 2022 at 18:23)</a>:</h4>
<p>I was very proud of this plot, even though I never successfully diagnosed the 0 bias: <a href="https://raw.githubusercontent.com/JanCVanB/roc-plotters/main/examples/scatter.png">https://raw.githubusercontent.com/JanCVanB/roc-plotters/main/examples/scatter.png</a></p>
<div class="message_inline_image"><a href="https://raw.githubusercontent.com/JanCVanB/roc-plotters/main/examples/scatter.png"><img src="https://uploads.zulipusercontent.net/aa3eeb75ec484bb4e324abb53a824078f9eba664/68747470733a2f2f7261772e67697468756275736572636f6e74656e742e636f6d2f4a616e4356616e422f726f632d706c6f74746572732f6d61696e2f6578616d706c65732f736361747465722e706e67"></a></div>



<a name="290277414"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Random%20number%20generator/near/290277414" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Martin Stewart <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Random.20number.20generator.html#290277414">(Jul 20 2022 at 18:27)</a>:</h4>
<p>I want to implement some of the core package stuff. Random numbers is pretty core!</p>



<a name="290277537"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Random%20number%20generator/near/290277537" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Martin Stewart <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Random.20number.20generator.html#290277537">(Jul 20 2022 at 18:28)</a>:</h4>
<p>I'm having a look at the code you've written now and experimenting with back passing to see if it can be used here.</p>



<a name="290277918"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Random%20number%20generator/near/290277918" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Random.20number.20generator.html#290277918">(Jul 20 2022 at 18:30)</a>:</h4>
<p><span class="user-mention" data-user-id="462053">@JanCVanB</span> I thought we eventually discovered the bug was related to a bug in the roc shifting functions. That should be fixed now (I think?), so maybe updating to latest roc would fix that plot.</p>



<a name="290278040"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Random%20number%20generator/near/290278040" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jan kili <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Random.20number.20generator.html#290278040">(Jul 20 2022 at 18:31)</a>:</h4>
<p><span class="user-mention" data-user-id="343810">@Brendan Hansknecht</span> Oh yeah, that might have been where I left it.</p>



<a name="290282425"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Random%20number%20generator/near/290282425" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Qqwy / Marten <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Random.20number.20generator.html#290282425">(Jul 20 2022 at 19:01)</a>:</h4>
<p><span class="user-mention" data-user-id="462053">@JanCVanB</span> Which pseudoRNG algorithm does the library implement?</p>



<a name="290283145"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Random%20number%20generator/near/290283145" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Qqwy / Marten <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Random.20number.20generator.html#290283145">(Jul 20 2022 at 19:05)</a>:</h4>
<p>That a RNG library exists and that we now have <code>expect</code> makes me hyped for a  property-based testing library! <span aria-label="happy" class="emoji emoji-1f600" role="img" title="happy">:happy:</span></p>



<a name="290283225"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Random%20number%20generator/near/290283225" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Martin Stewart <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Random.20number.20generator.html#290283225">(Jul 20 2022 at 19:05)</a>:</h4>
<p>Here's a proof of concept of my backpassing idea</p>
<div class="codehilite" data-code-language="Elm"><pre><span></span><code><span class="nv">interface</span><span class="w"> </span><span class="kt">Random</span><span class="w"></span>
<span class="w">    </span><span class="nv">exposes</span><span class="w"> </span><span class="p">[</span><span class="w"></span>
<span class="w">        </span><span class="nv">getSeed</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="nv">u32</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="nv">finish</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="kt">Seed</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="nv">run</span><span class="w"></span>
<span class="w">    </span><span class="p">]</span><span class="w"></span>
<span class="w">    </span><span class="nv">imports</span><span class="w"> </span><span class="p">[]</span><span class="w"></span>

<span class="kt">Generator</span><span class="w"> </span><span class="nv">a</span><span class="w"> </span><span class="nf">:</span><span class="w"> </span><span class="kt">Seed</span><span class="w"> </span><span class="nf">-&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nv">value</span><span class="nf">:</span><span class="w"> </span><span class="nv">a</span><span class="p">,</span><span class="w"> </span><span class="nv">newState</span><span class="nf">:</span><span class="w"> </span><span class="kt">Seed</span><span class="w"> </span><span class="p">}</span><span class="w"></span>

<span class="kt">Seed</span><span class="w"> </span><span class="nf">:=</span><span class="w"> </span><span class="kt">U32</span><span class="w"></span>

<span class="nv">getSeed</span><span class="w"> </span><span class="nf">:</span><span class="w"> </span><span class="kt">U32</span><span class="w"> </span><span class="nf">-&gt;</span><span class="w"> </span><span class="kt">Seed</span><span class="w"></span>
<span class="nv">getSeed</span><span class="w"> </span><span class="nf">=</span><span class="w"> </span><span class="nf">\</span><span class="nv">seed</span><span class="w"> </span><span class="nf">-&gt;</span><span class="w"> </span><span class="err">@</span><span class="kt">Seed</span><span class="w"> </span><span class="nv">seed</span><span class="w"></span>

<span class="nv">u32</span><span class="w"> </span><span class="nf">:</span><span class="w"> </span><span class="kt">U32</span><span class="p">,</span><span class="w"> </span><span class="kt">U32</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="kt">U32</span><span class="w"> </span><span class="nf">-&gt;</span><span class="w"> </span><span class="kt">Generator</span><span class="w"> </span><span class="nv">a</span><span class="p">)</span><span class="w"> </span><span class="nf">-&gt;</span><span class="w"> </span><span class="kt">Generator</span><span class="w"> </span><span class="nv">a</span><span class="w"></span>
<span class="nv">u32</span><span class="w"> </span><span class="nf">=</span><span class="w"> </span><span class="nf">\</span><span class="nv">low</span><span class="p">,</span><span class="w"> </span><span class="nv">high</span><span class="p">,</span><span class="w"> </span><span class="nv">func</span><span class="w"> </span><span class="nf">-&gt;</span><span class="w"></span>
<span class="w">    </span><span class="nf">\</span><span class="p">(</span><span class="err">@</span><span class="kt">Seed</span><span class="w"> </span><span class="nv">state</span><span class="p">)</span><span class="w"> </span><span class="nf">-&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nv">generator</span><span class="w"> </span><span class="nf">=</span><span class="w"> </span><span class="nv">func</span><span class="w"> </span><span class="p">(</span><span class="nv">state</span><span class="w"> </span><span class="nf">%</span><span class="w"> </span><span class="p">(</span><span class="nv">high</span><span class="w"> </span><span class="nf">-</span><span class="w"> </span><span class="nv">low</span><span class="p">)</span><span class="w"> </span><span class="nf">+</span><span class="w"> </span><span class="nv">low</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="nv">generator</span><span class="w"></span>
<span class="w">            </span><span class="err">#</span><span class="w"> </span><span class="kt">The</span><span class="w"> </span><span class="nv">random</span><span class="w"> </span><span class="nv">seed</span><span class="w"> </span><span class="nv">just</span><span class="w"> </span><span class="nv">increments</span><span class="w"> </span><span class="nv">between</span><span class="w"> </span><span class="nv">uses</span><span class="w"></span>
<span class="w">            </span><span class="p">(</span><span class="err">@</span><span class="kt">Seed</span><span class="w"> </span><span class="p">(</span><span class="nv">state</span><span class="w"> </span><span class="nf">+</span><span class="w"> </span><span class="mi">1</span><span class="p">))</span><span class="w"></span>

<span class="nv">finish</span><span class="w"> </span><span class="nf">:</span><span class="w"> </span><span class="nv">a</span><span class="w"> </span><span class="nf">-&gt;</span><span class="w"> </span><span class="kt">Generator</span><span class="w"> </span><span class="nv">a</span><span class="w"></span>
<span class="nv">finish</span><span class="w"> </span><span class="nf">=</span><span class="w"> </span><span class="nf">\</span><span class="nv">value</span><span class="w"> </span><span class="nf">-&gt;</span><span class="w"></span>
<span class="w">    </span><span class="p">(</span><span class="nf">\</span><span class="nv">state</span><span class="w"> </span><span class="nf">-&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nv">value</span><span class="nf">:</span><span class="w"> </span><span class="nv">value</span><span class="p">,</span><span class="w"> </span><span class="nv">newState</span><span class="w"> </span><span class="nf">:</span><span class="w"> </span><span class="nv">state</span><span class="w"> </span><span class="p">})</span><span class="w"></span>

<span class="err">#</span><span class="w"> </span><span class="kt">Example</span><span class="w"> </span><span class="nv">user</span><span class="w"> </span><span class="nv">code</span><span class="w"></span>

<span class="nv">point</span><span class="w"> </span><span class="nf">:</span><span class="w"> </span><span class="kt">Generator</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nv">x</span><span class="nf">:</span><span class="w"> </span><span class="kt">U32</span><span class="p">,</span><span class="w"> </span><span class="nv">y</span><span class="nf">:</span><span class="w"> </span><span class="kt">U32</span><span class="w"> </span><span class="p">}</span><span class="w"></span>
<span class="nv">point</span><span class="w"> </span><span class="nf">=</span><span class="w"></span>
<span class="w">    </span><span class="nv">x</span><span class="w"> </span><span class="nf">&lt;-</span><span class="w"> </span><span class="nv">u32</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="mi">9</span><span class="w"></span>
<span class="w">    </span><span class="nv">y</span><span class="w"> </span><span class="nf">&lt;-</span><span class="w"> </span><span class="nv">u32</span><span class="w"> </span><span class="mi">10</span><span class="w"> </span><span class="mi">19</span><span class="w"></span>
<span class="w">    </span><span class="nv">finish</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nv">x</span><span class="p">,</span><span class="w"> </span><span class="nv">y</span><span class="w"> </span><span class="p">}</span><span class="w"></span>

<span class="nv">run</span><span class="w"> </span><span class="nf">=</span><span class="w"></span>
<span class="w">    </span><span class="nv">point</span><span class="w"> </span><span class="p">(</span><span class="nv">getSeed</span><span class="w"> </span><span class="mi">123</span><span class="p">)</span><span class="w"></span>
</code></pre></div>



<a name="290283688"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Random%20number%20generator/near/290283688" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Qqwy / Marten <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Random.20number.20generator.html#290283688">(Jul 20 2022 at 19:09)</a>:</h4>
<p><span class="user-mention" data-user-id="432314">@Martin Stewart</span> That's great! We might even be able to go a step further with inferring the return type</p>



<a name="290283762"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Random%20number%20generator/near/290283762" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Random.20number.20generator.html#290283762">(Jul 20 2022 at 19:09)</a>:</h4>
<p>It uses a form of pcg if I recall</p>



<a name="290283916"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Random%20number%20generator/near/290283916" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Martin Stewart <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Random.20number.20generator.html#290283916">(Jul 20 2022 at 19:10)</a>:</h4>
<p>I'm not sure if this is what you mean but at first I tried writing <code>int : Int b, Int b, (Int b -&gt; Generator a) -&gt; Generator a</code> instead of <code>u32 : U32, U32, (U32 -&gt; Generator a) -&gt; Generator a</code> but Roc kept saying that it was inferring <code>Int b</code> as <code>Int Unsigned32</code> and that was preventing me from adding two ints together.</p>



<a name="290283922"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Random%20number%20generator/near/290283922" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Qqwy / Marten <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Random.20number.20generator.html#290283922">(Jul 20 2022 at 19:10)</a>:</h4>
<p>So you can just have</p>
<div class="codehilite"><pre><span></span><code>myVal : Generator {x: U32, y: I64, z: List Int64, w: Str}
x &lt;- range 0 9
y &lt;- range 10 19
z &lt;- random
w &lt;- random
finish {x, y, z, w}
</code></pre></div>



<a name="290284190"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Random%20number%20generator/near/290284190" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Martin Stewart <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Random.20number.20generator.html#290284190">(Jul 20 2022 at 19:12)</a>:</h4>
<p>I'm not sure I understand, could you provide an example of how <code>random</code> would be implemented?</p>



<a name="290285110"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Random%20number%20generator/near/290285110" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jan kili <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Random.20number.20generator.html#290285110">(Jul 20 2022 at 19:19)</a>:</h4>
<p>Yes it's pcg based, and I put pcg links in the Roc comments</p>



<a name="290285192"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Random%20number%20generator/near/290285192" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Qqwy / Marten <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Random.20number.20generator.html#290285192">(Jul 20 2022 at 19:20)</a>:</h4>
<p><span aria-label="thinking" class="emoji emoji-1f914" role="img" title="thinking">:thinking:</span> To implement <code>random</code> we need an ability (Roc's version of what is known as a 'trait' or 'typeclass' or roughly an 'interface' in other languages).<br>
Adding support for abilities is one of the things which is very recent (and it's not entirely finished yet if I remember correctly) but it should be possible to write this soon.</p>



<a name="290286654"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Random%20number%20generator/near/290286654" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Martin Stewart <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Random.20number.20generator.html#290286654">(Jul 20 2022 at 19:30)</a>:</h4>
<p>Gotcha. I don't think that's a good idea because, if I understand correctly, that means assigning exactly 1 way to randomly generate a given type. Most types will need some configuration, for example Random.str probably will take a min and max length (and maybe there could be another version called Random.ascii).</p>



<a name="290286977"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Random%20number%20generator/near/290286977" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Martin Stewart <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Random.20number.20generator.html#290286977">(Jul 20 2022 at 19:32)</a>:</h4>
<p><span class="user-mention" data-user-id="462053">@JanCVanB</span> If the backpassing approach looks good, I can try adding it to your code and making a PR</p>



<a name="290287145"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Random%20number%20generator/near/290287145" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Qqwy / Marten <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Random.20number.20generator.html#290287145">(Jul 20 2022 at 19:33)</a>:</h4>
<p>Yes, you're absolutely right! Sometimes you do want to customize something further!</p>
<p>...</p>
<p><a href="https://media1.giphy.com/media/3o85xIO33l7RlmLR4I/giphy.gif?cid=c623cb350xcnug6zjprgvhqji08s64h9f3z7qarern1qb1lc&amp;rid=giphy.gif&amp;ct=g">https://media1.giphy.com/media/3o85xIO33l7RlmLR4I/giphy.gif?cid=c623cb350xcnug6zjprgvhqji08s64h9f3z7qarern1qb1lc&amp;rid=giphy.gif&amp;ct=g</a> </p>
<div class="message_inline_image"><a href="https://media1.giphy.com/media/3o85xIO33l7RlmLR4I/giphy.gif?cid=c623cb350xcnug6zjprgvhqji08s64h9f3z7qarern1qb1lc&amp;rid=giphy.gif&amp;ct=g"><img src="https://uploads.zulipusercontent.net/0b4b46bb333598cdaae51fa7b33767af0bc9afe4/68747470733a2f2f6d65646961312e67697068792e636f6d2f6d656469612f336f383578494f33336c37526c6d4c5234492f67697068792e6769663f6369643d63363233636233353078636e7567367a6a7072677668716a693038733634683966337a3771617265726e317162316c63267269643d67697068792e6769662663743d67"></a></div><p><span aria-label="nerd" class="emoji emoji-1f913" role="img" title="nerd">:nerd:</span></p>



<a name="290295045"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Random%20number%20generator/near/290295045" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jan kili <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Random.20number.20generator.html#290295045">(Jul 20 2022 at 20:36)</a>:</h4>
<p><span class="user-mention" data-user-id="432314">@Martin Stewart</span> PRs are very welcome, thank you! I haven't really considered backpacking, so I'm looking forward to digging into your example above.</p>



<a name="290298390"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Random%20number%20generator/near/290298390" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jan kili <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Random.20number.20generator.html#290298390">(Jul 20 2022 at 21:01)</a>:</h4>
<p><span aria-label="laughing" class="emoji emoji-1f606" role="img" title="laughing">:laughing:</span> backpaSSing</p>



<a name="290313240"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Random%20number%20generator/near/290313240" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jan kili <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Random.20number.20generator.html#290313240">(Jul 20 2022 at 23:26)</a>:</h4>
<p><span class="user-mention" data-user-id="432314">@Martin Stewart</span> I think I see - is the backpassing support just to simplify the use of one-time generators?</p>



<a name="290315016"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Random%20number%20generator/near/290315016" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jan kili <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Random.20number.20generator.html#290315016">(Jul 20 2022 at 23:46)</a>:</h4>
<p>I definitely care about improving the ergonomics, so I'm open to stuff like this!</p>



<a name="290338302"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Random%20number%20generator/near/290338302" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Martin Stewart <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Random.20number.20generator.html#290338302">(Jul 21 2022 at 06:29)</a>:</h4>
<p>I'm not sure what you mean by one-time generators but yes this should simplify all generators</p>



<a name="290357527"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Random%20number%20generator/near/290357527" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jan kili <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Random.20number.20generator.html#290357527">(Jul 21 2022 at 10:18)</a>:</h4>
<p>In your example above, there is some conflation between seed &amp; state (a state is initialized with a seed) and since both seeds &amp; output values are <code>U32</code> it's a little tricky to say for certain whether variables like <code>x</code> and <code>y</code> are intended as seeds or output values (the backpassing callback function input parameter name calls them seeds, but they're returned from <code>point</code> like output values).</p>



<a name="290357607"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Random%20number%20generator/near/290357607" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jan kili <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Random.20number.20generator.html#290357607">(Jul 21 2022 at 10:19)</a>:</h4>
<p>However, details aside, using backpassing with generators seems like it would prevent state chaining.</p>



<a name="290357700"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Random%20number%20generator/near/290357700" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jan kili <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Random.20number.20generator.html#290357700">(Jul 21 2022 at 10:20)</a>:</h4>
<p>This means that if your <code>x</code> and <code>y</code> domains were identical, they would generate identical values for each iteration (because using the same seed leads to the same sequence of values, without chaining).</p>



<a name="290357764"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Random%20number%20generator/near/290357764" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jan kili <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Random.20number.20generator.html#290357764">(Jul 21 2022 at 10:21)</a>:</h4>
<p>In general, I see backpassing as primarily for asynchronous processes, but in this case it's used to avoid... what?</p>



<a name="290357835"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Random%20number%20generator/near/290357835" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jan kili <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Random.20number.20generator.html#290357835">(Jul 21 2022 at 10:22)</a>:</h4>
<p>I may be missing something critical here, so please let me know! :)</p>



<a name="290357915"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Random%20number%20generator/near/290357915" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jan kili <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Random.20number.20generator.html#290357915">(Jul 21 2022 at 10:23)</a>:</h4>
<p>I'd be curious to see <a href="https://github.com/JanCVanB/roc-random/blob/main/example_complex.roc">one of the <code>roc-random</code> examples</a> rewritten with backpassing, that might help me understand.</p>



<a name="290357990"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Random%20number%20generator/near/290357990" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Martin Stewart <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Random.20number.20generator.html#290357990">(Jul 21 2022 at 10:24)</a>:</h4>
<p>This code really is passing along a new seed to each generator. So x and y will get different values event if they had the same range</p>
<div class="codehilite" data-code-language="Elm"><pre><span></span><code><span class="nv">point</span><span class="w"> </span><span class="nf">:</span><span class="w"> </span><span class="kt">Generator</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nv">x</span><span class="nf">:</span><span class="w"> </span><span class="kt">U32</span><span class="p">,</span><span class="w"> </span><span class="nv">y</span><span class="nf">:</span><span class="w"> </span><span class="kt">U32</span><span class="w"> </span><span class="p">}</span><span class="w"></span>
<span class="nv">point</span><span class="w"> </span><span class="nf">=</span><span class="w"></span>
<span class="w">    </span><span class="nv">x</span><span class="w"> </span><span class="nf">&lt;-</span><span class="w"> </span><span class="nv">u32</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="mi">9</span><span class="w"></span>
<span class="w">    </span><span class="nv">y</span><span class="w"> </span><span class="nf">&lt;-</span><span class="w"> </span><span class="nv">u32</span><span class="w"> </span><span class="mi">10</span><span class="w"> </span><span class="mi">19</span><span class="w"></span>
<span class="w">    </span><span class="nv">finish</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nv">x</span><span class="p">,</span><span class="w"> </span><span class="nv">y</span><span class="w"> </span><span class="p">}</span><span class="w"></span>

<span class="nv">run</span><span class="w"> </span><span class="nf">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nv">value</span><span class="w"> </span><span class="nf">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nv">x</span><span class="nf">:</span><span class="w"> </span><span class="kt">U32</span><span class="p">,</span><span class="w"> </span><span class="nv">y</span><span class="nf">:</span><span class="w"> </span><span class="kt">U32</span><span class="w"> </span><span class="p">},</span><span class="w"> </span><span class="nv">newState</span><span class="nf">:</span><span class="w"> </span><span class="kt">Seed</span><span class="w"> </span><span class="p">}</span><span class="w"></span>
<span class="nv">run</span><span class="w"> </span><span class="nf">=</span><span class="w"></span>
<span class="w">    </span><span class="nv">point</span><span class="w"> </span><span class="p">(</span><span class="nv">getSeed</span><span class="w"> </span><span class="mi">123</span><span class="p">)</span><span class="w"></span>
</code></pre></div>
<p>It might be easier to see why this is possible if I replace the backpassing with the desugared version:</p>
<div class="codehilite" data-code-language="Elm"><pre><span></span><code><span class="nv">point</span><span class="w"> </span><span class="nf">:</span><span class="w"> </span><span class="kt">Generator</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nv">x</span><span class="nf">:</span><span class="w"> </span><span class="kt">U32</span><span class="p">,</span><span class="w"> </span><span class="nv">y</span><span class="nf">:</span><span class="w"> </span><span class="kt">U32</span><span class="w"> </span><span class="p">}</span><span class="w"></span>
<span class="nv">point</span><span class="w"> </span><span class="nf">=</span><span class="w"></span>
<span class="w">    </span><span class="err">#</span><span class="w"> </span><span class="kt">The</span><span class="w"> </span><span class="nv">second</span><span class="w"> </span><span class="nv">u32</span><span class="w"> </span><span class="nv">is</span><span class="w"> </span><span class="nv">passed</span><span class="w"> </span><span class="kr">in</span><span class="w"> </span><span class="kr">as</span><span class="w"> </span><span class="nv">a</span><span class="w"> </span><span class="nv">parameter</span><span class="w"> </span><span class="nv">to</span><span class="w"> </span><span class="nv">the</span><span class="w"> </span><span class="nv">first</span><span class="w"> </span><span class="nv">u32</span><span class="w"> </span><span class="nv">so</span><span class="w"> </span><span class="nv">it's</span><span class="w"> </span><span class="nv">possible</span><span class="w"> </span><span class="nv">for</span><span class="w"> </span><span class="nv">it</span><span class="w"> </span><span class="nv">to</span><span class="w"> </span><span class="nv">be</span><span class="w"> </span><span class="nv">given</span><span class="w"> </span><span class="nv">the</span><span class="w"> </span><span class="nv">next</span><span class="w"> </span><span class="nv">seed</span><span class="w"></span>
<span class="w">    </span><span class="nv">u32</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="mi">9</span><span class="w"> </span><span class="p">(</span><span class="nf">\</span><span class="nv">x</span><span class="w"> </span><span class="nf">-&gt;</span><span class="w"> </span><span class="nv">u32</span><span class="w"> </span><span class="mi">10</span><span class="w"> </span><span class="mi">19</span><span class="w"> </span><span class="p">(</span><span class="nf">\</span><span class="nv">y</span><span class="w"> </span><span class="nf">-&gt;</span><span class="w"> </span><span class="nv">finish</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nv">x</span><span class="p">,</span><span class="w"> </span><span class="nv">y</span><span class="w"> </span><span class="p">}))</span><span class="w"></span>

<span class="nv">run</span><span class="w"> </span><span class="nf">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nv">value</span><span class="w"> </span><span class="nf">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nv">x</span><span class="nf">:</span><span class="w"> </span><span class="kt">U32</span><span class="p">,</span><span class="w"> </span><span class="nv">y</span><span class="nf">:</span><span class="w"> </span><span class="kt">U32</span><span class="w"> </span><span class="p">},</span><span class="w"> </span><span class="nv">newState</span><span class="nf">:</span><span class="w"> </span><span class="kt">Seed</span><span class="w"> </span><span class="p">}</span><span class="w"></span>
<span class="nv">run</span><span class="w"> </span><span class="nf">=</span><span class="w"></span>
<span class="w">    </span><span class="nv">point</span><span class="w"> </span><span class="p">(</span><span class="nv">getSeed</span><span class="w"> </span><span class="mi">123</span><span class="p">)</span><span class="w"></span>
</code></pre></div>



<a name="290358021"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Random%20number%20generator/near/290358021" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jan kili <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Random.20number.20generator.html#290358021">(Jul 21 2022 at 10:25)</a>:</h4>
<p>Oh, wait, sorry, I just realized your example above is a from-scratch RNG implementation - I thought it was modifying my <code>roc-random</code> API.</p>



<a name="290358022"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Random%20number%20generator/near/290358022" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Martin Stewart <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Random.20number.20generator.html#290358022">(Jul 21 2022 at 10:25)</a>:</h4>
<p>I'll update your roc-random examples once I have the rest of my PR ready</p>



<a name="290358144"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Random%20number%20generator/near/290358144" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jan kili <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Random.20number.20generator.html#290358144">(Jul 21 2022 at 10:27)</a>:</h4>
<p>Ah! Are you using output values as state?</p>



<a name="290358225"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Random%20number%20generator/near/290358225" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jan kili <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Random.20number.20generator.html#290358225">(Jul 21 2022 at 10:28)</a>:</h4>
<p>Yes, that's it - okay. My seed chaining confusion came from the fact that I was assuming internal state and external return values were distinct.</p>



<a name="290358366"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Random%20number%20generator/near/290358366" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jan kili <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Random.20number.20generator.html#290358366">(Jul 21 2022 at 10:30)</a>:</h4>
<p>It's advantageous with PCG to have a transformation step during value return. By preventing direct exposure of the internal state, the randomness (against either just malicious actors or also stats, I can't remember) improves.</p>



<a name="290358417"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Random%20number%20generator/near/290358417" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jan kili <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Random.20number.20generator.html#290358417">(Jul 21 2022 at 10:31)</a>:</h4>
<p>Therefore, perhaps I'm simply expecting more complex parameters passed into the backpassing callback.</p>



<a name="290358544"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Random%20number%20generator/near/290358544" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jan kili <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Random.20number.20generator.html#290358544">(Jul 21 2022 at 10:33)</a>:</h4>
<p>I still don't see where the internal state (or any seed) is passed/chained between generators, though...</p>



<a name="290358947"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Random%20number%20generator/near/290358947" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Martin Stewart <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Random.20number.20generator.html#290358947">(Jul 21 2022 at 10:38)</a>:</h4>
<p>It's the last line here that passes the seed into the next generator.</p>
<div class="codehilite" data-code-language="Elm"><pre><span></span><code><span class="nv">u32</span><span class="w"> </span><span class="nf">:</span><span class="w"> </span><span class="kt">U32</span><span class="p">,</span><span class="w"> </span><span class="kt">U32</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="kt">U32</span><span class="w"> </span><span class="nf">-&gt;</span><span class="w"> </span><span class="kt">Generator</span><span class="w"> </span><span class="nv">a</span><span class="p">)</span><span class="w"> </span><span class="nf">-&gt;</span><span class="w"> </span><span class="kt">Generator</span><span class="w"> </span><span class="nv">a</span><span class="w"></span>
<span class="nv">u32</span><span class="w"> </span><span class="nf">=</span><span class="w"> </span><span class="nf">\</span><span class="nv">low</span><span class="p">,</span><span class="w"> </span><span class="nv">high</span><span class="p">,</span><span class="w"> </span><span class="nv">func</span><span class="w"> </span><span class="nf">-&gt;</span><span class="w"></span>
<span class="w">    </span><span class="nf">\</span><span class="p">(</span><span class="err">@</span><span class="kt">Seed</span><span class="w"> </span><span class="nv">state</span><span class="p">)</span><span class="w"> </span><span class="nf">-&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nv">generator</span><span class="w"> </span><span class="nf">=</span><span class="w"> </span><span class="nv">func</span><span class="w"> </span><span class="p">(</span><span class="nv">state</span><span class="w"> </span><span class="nf">%</span><span class="w"> </span><span class="p">(</span><span class="nv">high</span><span class="w"> </span><span class="nf">-</span><span class="w"> </span><span class="nv">low</span><span class="p">)</span><span class="w"> </span><span class="nf">+</span><span class="w"> </span><span class="nv">low</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="nv">generator</span><span class="w"></span>
<span class="w">            </span><span class="err">#</span><span class="w"> </span><span class="kt">The</span><span class="w"> </span><span class="nv">random</span><span class="w"> </span><span class="nv">seed</span><span class="w"> </span><span class="nv">just</span><span class="w"> </span><span class="nv">increments</span><span class="w"> </span><span class="nv">between</span><span class="w"> </span><span class="nv">uses</span><span class="w"></span>
<span class="w">            </span><span class="p">(</span><span class="err">@</span><span class="kt">Seed</span><span class="w"> </span><span class="p">(</span><span class="nv">state</span><span class="w"> </span><span class="nf">+</span><span class="w"> </span><span class="mi">1</span><span class="p">))</span><span class="w"></span>
</code></pre></div>
<p>I can give a more detailed explanation later if you'd like. Busy at the moment unfortunately</p>



<a name="290359087"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Random%20number%20generator/near/290359087" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jan kili <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Random.20number.20generator.html#290359087">(Jul 21 2022 at 10:40)</a>:</h4>
<p>That part makes sense, thank you.</p>



<a name="290359165"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Random%20number%20generator/near/290359165" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jan kili <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Random.20number.20generator.html#290359165">(Jul 21 2022 at 10:41)</a>:</h4>
<p>I'm wondering how <code>point</code> works, because I don't see how its input <code>Seed</code> is passed to its <code>u32</code> subgenerators.</p>



<a name="290359253"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Random%20number%20generator/near/290359253" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jan kili <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Random.20number.20generator.html#290359253">(Jul 21 2022 at 10:42)</a>:</h4>
<p>Is that the magic of backpassing?</p>



<a name="290359391"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Random%20number%20generator/near/290359391" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jan kili <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Random.20number.20generator.html#290359391">(Jul 21 2022 at 10:44)</a>:</h4>
<div class="codehilite"><pre><span></span><code>finish = \value -&gt;
    (\state -&gt; { value: value, newState : state })
...
point =
    x &lt;- u32 0 9
    y &lt;- u32 10 19
    finish { x, y }
</code></pre></div>
<p>This seems like <code>point</code> will return the same <code>.value</code> every time.</p>



<a name="290360968"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Random%20number%20generator/near/290360968" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jan kili <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Random.20number.20generator.html#290360968">(Jul 21 2022 at 11:05)</a>:</h4>
<p>Your desugared version above (thank you for that, very helpful for my backpassing noob brain) is<br>
<code>point = u32 0 9 (\x -&gt; u32 10 19 (\y -&gt; finish { x, y }))</code><br>
but I'm expecting something more like<br>
<code>...</code></p>



<a name="290361008"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Random%20number%20generator/near/290361008" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jan kili <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Random.20number.20generator.html#290361008">(Jul 21 2022 at 11:06)</a>:</h4>
<p>GAH! While thinking what I wanted in the second code snippet above, I think I figured out how this backpassing magic works <span aria-label="sweat smile" class="emoji emoji-1f605" role="img" title="sweat smile">:sweat_smile:</span></p>



<a name="290361077"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Random%20number%20generator/near/290361077" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jan kili <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Random.20number.20generator.html#290361077">(Jul 21 2022 at 11:06)</a>:</h4>
<p>My brain hurts. So many overlapping functions...</p>



<a name="290361997"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Random%20number%20generator/near/290361997" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jan kili <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Random.20number.20generator.html#290361997">(Jul 21 2022 at 11:17)</a>:</h4>
<p>Your backpassing system might be amazing <span aria-label="smiley" class="emoji emoji-1f603" role="img" title="smiley">:smiley:</span> I'll have to dig in more later!</p>



<a name="290362484"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Random%20number%20generator/near/290362484" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jan kili <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Random.20number.20generator.html#290362484">(Jul 21 2022 at 11:23)</a>:</h4>
<p>If it smoothly (though subtly) eliminates the need for <code>Random.next</code>/<code>.step</code> inside custom generators, that's great!</p>



<a name="290362768"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Random%20number%20generator/near/290362768" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jan kili <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Random.20number.20generator.html#290362768">(Jul 21 2022 at 11:26)</a>:</h4>
<p>I'm looking forward to implementing/seeing this with <code>Generation</code>s and <code>I8</code> values.</p>



<a name="290362891"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Random%20number%20generator/near/290362891" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jan kili <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Random.20number.20generator.html#290362891">(Jul 21 2022 at 11:27)</a>:</h4>
<p>I wonder if renaming some variables would help me not need a 10-second mental loading spinner every time I re-read the backpassing lines <span aria-label="laughing" class="emoji emoji-1f606" role="img" title="laughing">:laughing:</span></p>



<a name="290395882"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Random%20number%20generator/near/290395882" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jan kili <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Random.20number.20generator.html#290395882">(Jul 21 2022 at 16:03)</a>:</h4>
<p>I'm curious to see whether this backpassing system works better for simpler use cases or more complex use cases! Right now I think it's good for chaining but not for one-shots... but I'm vascillating on that with my shifting mental pseudocode. I'll have to try some examples!</p>



<a name="290398635"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Random%20number%20generator/near/290398635" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Random.20number.20generator.html#290398635">(Jul 21 2022 at 16:21)</a>:</h4>
<p>Even with one off uses, it can often make something look more like linear code and help reduce indenting</p>



<a name="290398714"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Random%20number%20generator/near/290398714" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Random.20number.20generator.html#290398714">(Jul 21 2022 at 16:22)</a>:</h4>
<p>So helps with readability</p>



<a name="290402574"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Random%20number%20generator/near/290402574" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jan kili <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Random.20number.20generator.html#290402574">(Jul 21 2022 at 16:51)</a>:</h4>
<p>When there's already callbacks involved yes, but this system is adding both callbacks and backpassing at the same time, so they're equally flat. This might still make it more readable, though.</p>



<a name="290402847"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Random%20number%20generator/near/290402847" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jan kili <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Random.20number.20generator.html#290402847">(Jul 21 2022 at 16:53)</a>:</h4>
<p>The readability gains would just be in hiding the state machine's internals, rather than decreasing indentation.</p>



<a name="290403074"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Random%20number%20generator/near/290403074" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Random.20number.20generator.html#290403074">(Jul 21 2022 at 16:54)</a>:</h4>
<p>Ah, yeah. Makes sense. Hiding state can definitely be really nice in Roc. Otherwise you get everyone's favorite variables <code>state0</code>, <code>state1</code>, <code>state2</code>, <code>state3</code>, ...</p>



<a name="290403128"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Random%20number%20generator/near/290403128" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Random.20number.20generator.html#290403128">(Jul 21 2022 at 16:54)</a>:</h4>
<p>This is the one reason I really miss shadowing.</p>



<a name="290403231"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Random%20number%20generator/near/290403231" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jan kili <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Random.20number.20generator.html#290403231">(Jul 21 2022 at 16:55)</a>:</h4>
<p>I made helper functions to pass state around externally, but <code>x.value</code> and <code>Random.step</code> are ugly tbh.</p>



<a name="290403513"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Random%20number%20generator/near/290403513" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Random.20number.20generator.html#290403513">(Jul 21 2022 at 16:57)</a>:</h4>
<p>Yeah, which is definitely an improvement and what I did for the second version of the wasm cpu emulator in Roc.</p>



<a name="290403525"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Random%20number%20generator/near/290403525" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Random.20number.20generator.html#290403525">(Jul 21 2022 at 16:57)</a>:</h4>
<p>But definitely less nice than bsckpassing</p>



<a name="290403534"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Random%20number%20generator/near/290403534" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Random.20number.20generator.html#290403534">(Jul 21 2022 at 16:57)</a>:</h4>
<p>Though probably a lot faster to compile</p>



<a name="290404564"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Random%20number%20generator/near/290404564" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jan kili <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Random.20number.20generator.html#290404564">(Jul 21 2022 at 17:04)</a>:</h4>
<p>Interesting, I hadn't even begun to think about performance implications</p>



<a name="290404678"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Random%20number%20generator/near/290404678" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jan kili <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Random.20number.20generator.html#290404678">(Jul 21 2022 at 17:05)</a>:</h4>
<p>The nested callback function call stack for each generator chain... Probably fine</p>



<a name="290411199"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Random%20number%20generator/near/290411199" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Qqwy / Marten <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Random.20number.20generator.html#290411199">(Jul 21 2022 at 17:58)</a>:</h4>
<p>Hopefully that will become less of a thing in the near future <span aria-label="sweat smile" class="emoji emoji-1f605" role="img" title="sweat smile">:sweat_smile:</span></p>



<a name="290417685"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Random%20number%20generator/near/290417685" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Random.20number.20generator.html#290417685">(Jul 21 2022 at 18:49)</a>:</h4>
<p>Oh, I more meant that no matter what it will cost more to compilation time. It means you have lambdas that have to be inlined and optimized. That is not the case for directly passing state around. So it will always have some form of higher cost. Should be relatively small though (if we do things right)</p>



<a name="290417863"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Random%20number%20generator/near/290417863" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Random.20number.20generator.html#290417863">(Jul 21 2022 at 18:50)</a>:</h4>
<p>For runtime, it should get inlined and have zero cost</p>



<a name="290465257"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Random%20number%20generator/near/290465257" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jan kili <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Random.20number.20generator.html#290465257">(Jul 22 2022 at 04:55)</a>:</h4>
<p><span class="user-mention" data-user-id="432314">@Martin Stewart</span> I've been playing around with refactoring <code>roc-random</code> to internalize its chained generator state management with backpassing instead of externalizing it, but I can't run it yet due to seemingly-unrelated compilation issues that I'll have to debug another time. In the meantime, this syntax looks really promising for cleanliness!</p>



<a name="290465569"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Random%20number%20generator/near/290465569" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jan kili <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Random.20number.20generator.html#290465569">(Jul 22 2022 at 05:00)</a>:</h4>
<p>I only have one remaining concern right now, and that's regarding chaining chains. For example, your <code>point</code> generator above - I believe it can't be chained with other point generators (as currently written) because the only state/seed it can return is the initial state/seed. Is that correct? It seems like the backpassing hiding state management (good) is also preventing that state from chaining with other contexts above/beyond the function context that calls those backpasses (bad), since that means multiple points requires multiple seedings.</p>



<a name="290470972"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Random%20number%20generator/near/290470972" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Qqwy / Marten <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Random.20number.20generator.html#290470972">(Jul 22 2022 at 06:40)</a>:</h4>
<p>In the example, <code>finish</code> extracts the final state (in the example: after two RNG 'hops'), not the initial state.</p>



<a name="290470999"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Random%20number%20generator/near/290470999" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Qqwy / Marten <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Random.20number.20generator.html#290470999">(Jul 22 2022 at 06:41)</a>:</h4>
<p>What could be added is a function <code>Generator a -&gt; (a -&gt; Generator b) -&gt; Generator b</code> which could be called <code>chain</code> or <code>andThen</code> or something similar. This would allow chaining arbitrary generators together (like calling <code>point</code> multiple times on the same generator)</p>



<a name="290503952"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Random%20number%20generator/near/290503952" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Martin Stewart <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Random.20number.20generator.html#290503952">(Jul 22 2022 at 13:11)</a>:</h4>
<p>Yeah, as Marten said, the latest seed does get returned. But there will need to be an andThen or something in order to make a finished generator compose with other generators</p>



<a name="290504012"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Random%20number%20generator/near/290504012" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Martin Stewart <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Random.20number.20generator.html#290504012">(Jul 22 2022 at 13:12)</a>:</h4>
<p>Haven't had a chance to continue working on it but I should have time this weekend</p>



<a name="290504290"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Random%20number%20generator/near/290504290" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jan kili <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Random.20number.20generator.html#290504290">(Jul 22 2022 at 13:15)</a>:</h4>
<p>Ah, so the <code>finish</code> is just a final wrapping step. Thank you both for that clarification!</p>



<a name="290504454"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Random%20number%20generator/near/290504454" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jan kili <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Random.20number.20generator.html#290504454">(Jul 22 2022 at 13:16)</a>:</h4>
<p>Yes, it seems that helpers like <code>Result.step</code> and/or <code>Result.next</code> will still be necessary when chaining without backpassing.</p>



<a name="290504480"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Random%20number%20generator/near/290504480" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jan kili <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Random.20number.20generator.html#290504480">(Jul 22 2022 at 13:16)</a>:</h4>
<p>I wonder if it would be valuable to support both ways, backpassing and not...</p>



<a name="290505562"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Random%20number%20generator/near/290505562" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Random.20number.20generator.html#290505562">(Jul 22 2022 at 13:27)</a>:</h4>
<p>oh definitely - for example, sometimes it's useful to store the seed in application state and then come back to it later</p>



<a name="290505584"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Random%20number%20generator/near/290505584" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Random.20number.20generator.html#290505584">(Jul 22 2022 at 13:27)</a>:</h4>
<p>I did this a bunch in the implementation of <code>elm-test</code></p>



<a name="290505665"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Random%20number%20generator/near/290505665" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Random.20number.20generator.html#290505665">(Jul 22 2022 at 13:28)</a>:</h4>
<p>because it would run the tests in parallel, but for the property-based tests, you could pass in a <code>--seed</code> value which would deterministically reproduce the results of a previous randomly-generated run</p>



<a name="290505683"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Random%20number%20generator/near/290505683" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Random.20number.20generator.html#290505683">(Jul 22 2022 at 13:28)</a>:</h4>
<p>and the way it did that was by storing the seeds in the application state in between test runs</p>



<a name="290505720"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Random%20number%20generator/near/290505720" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Random.20number.20generator.html#290505720">(Jul 22 2022 at 13:29)</a>:</h4>
<p>so it doesn't read as well when chaining several random operations together, but much nicer for storage!</p>



<a name="290510796"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Random%20number%20generator/near/290510796" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jan kili <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Random.20number.20generator.html#290510796">(Jul 22 2022 at 14:12)</a>:</h4>
<p>Is there a convention for how to support both patterns? Perhaps some sort of wrapper? Or is it just API x 2?</p>



<a name="290512129"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Random%20number%20generator/near/290512129" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jan kili <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Random.20number.20generator.html#290512129">(Jul 22 2022 at 14:22)</a>:</h4>
<p>I can probably figure something out by playing with callbacks and wrappers, but I don't see it just yet...</p>



<a name="290521466"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Random%20number%20generator/near/290521466" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Qqwy / Marten <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Random.20number.20generator.html#290521466">(Jul 22 2022 at 14:59)</a>:</h4>
<p>What do you mean?<br>
Using the <code>andThen</code>/<code>finish</code> based API does not prevent you from using the manual API interchangeably in your program. (Nor vice-versa)</p>



<a name="290548603"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Random%20number%20generator/near/290548603" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jan kili <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Random.20number.20generator.html#290548603">(Jul 22 2022 at 18:16)</a>:</h4>
<p>I hope to still support simple calls like this:</p>
<div class="codehilite"><pre><span></span><code>diceRoll = (Random.int 1 6) myNoise
Stdout.line (Num.toStr diceRoll)
</code></pre></div>



<a name="290548781"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Random%20number%20generator/near/290548781" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jan kili <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Random.20number.20generator.html#290548781">(Jul 22 2022 at 18:18)</a>:</h4>
<p>Adding a callback parameter to <code>Random.int</code> seems to deprecate the above simplicity, no?</p>



<a name="290549131"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Random%20number%20generator/near/290549131" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jan kili <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Random.20number.20generator.html#290549131">(Jul 22 2022 at 18:21)</a>:</h4>
<p>(granted, the current API isn't <strong><em>quite</em></strong> that simple, as it includes a <code>{ value: diceRoll }</code> destructuring of the wrapped state, but the above would be nice)</p>



<a name="290549674"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Random%20number%20generator/near/290549674" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jan kili <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Random.20number.20generator.html#290549674">(Jul 22 2022 at 18:26)</a>:</h4>
<p>I might be talking nonsense, though, as I still haven't finished the refactoring to see the changes in action!</p>



<a name="290549717"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Random%20number%20generator/near/290549717" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jan kili <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Random.20number.20generator.html#290549717">(Jul 22 2022 at 18:26)</a>:</h4>
<p>Thank you VERY much <span class="user-mention" data-user-id="361169">@Anton</span> for unsticking me on Rust/Nix stuff :)</p>



<a name="290700465"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Random%20number%20generator/near/290700465" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Martin Stewart <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Random.20number.20generator.html#290700465">(Jul 24 2022 at 21:21)</a>:</h4>
<p>So my from the beginning the idea was to not need any <code>Random.andThen</code> and you'd only write things like</p>
<div class="codehilite" data-code-language="Elm"><pre><span></span><code><span class="nv">randomPoint</span><span class="w"> </span><span class="nf">=</span><span class="w"></span>
<span class="w">    </span><span class="nv">x</span><span class="w"> </span><span class="nf">&lt;-</span><span class="w"> </span><span class="kt">Random</span><span class="nf">.</span><span class="nv">u32</span><span class="w"></span>
<span class="w">    </span><span class="nv">y</span><span class="w"> </span><span class="nf">&lt;-</span><span class="w"> </span><span class="kt">Random</span><span class="nf">.</span><span class="nv">u32</span><span class="w"></span>
<span class="w">    </span><span class="nv">finish</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nv">x</span><span class="p">,</span><span class="w"> </span><span class="nv">y</span><span class="w"> </span><span class="p">}</span><span class="w"></span>

<span class="nv">randomPerson</span><span class="w"> </span><span class="nf">=</span><span class="w"></span>
<span class="w">    </span><span class="nv">position</span><span class="w"> </span><span class="nf">&lt;-</span><span class="w"> </span><span class="nv">randomPoint</span><span class="w"></span>
<span class="w">    </span><span class="nv">age</span><span class="w"> </span><span class="nf">&lt;-</span><span class="w"> </span><span class="kt">Random</span><span class="nf">.</span><span class="nv">u16</span><span class="w"></span>
<span class="w">    </span><span class="nv">finish</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nv">position</span><span class="p">,</span><span class="w"> </span><span class="nv">age</span><span class="w"> </span><span class="p">}</span><span class="w"></span>

<span class="nv">randomPeople</span><span class="w"> </span><span class="nf">=</span><span class="w"></span>
<span class="w">    </span><span class="nv">count</span><span class="w"> </span><span class="nf">&lt;-</span><span class="w"> </span><span class="kt">Random</span><span class="nf">.</span><span class="nv">u8</span><span class="w"></span>
<span class="w">    </span><span class="nv">people</span><span class="w"> </span><span class="nf">&lt;-</span><span class="w"> </span><span class="kt">Random</span><span class="nf">.</span><span class="nv">list</span><span class="w"> </span><span class="nv">count</span><span class="w"> </span><span class="nv">randomPerson</span><span class="w"></span>
<span class="w">    </span><span class="nv">finish</span><span class="w"> </span><span class="nv">people</span><span class="w"></span>

<span class="nv">foo</span><span class="w"> </span><span class="nf">=</span><span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="w"> </span><span class="nv">value</span><span class="p">,</span><span class="w"> </span><span class="nv">newSeed</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="nf">=</span><span class="w"> </span><span class="kt">Random</span><span class="nf">.</span><span class="nv">generate</span><span class="w"> </span><span class="p">(</span><span class="kt">Random</span><span class="nf">.</span><span class="nv">initialSeed</span><span class="w"> </span><span class="mi">123</span><span class="p">)</span><span class="w"> </span><span class="nv">randomPeople</span><span class="w"></span>
<span class="w">    </span><span class="nv">value</span><span class="w"></span>
</code></pre></div>
<p>It seems like this isn't possible to do though. As <span class="user-mention" data-user-id="462053">@JanCVanB</span> pointed out <code>randomPoint</code> doesn't have the right type to be used the same way Random.u32 does for example. Maybe I'll call off that PR unless I come up with some better idea <span aria-label="sweat smile" class="emoji emoji-1f605" role="img" title="sweat smile">:sweat_smile:</span></p>



<a name="290700672"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Random%20number%20generator/near/290700672" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Qqwy / Marten <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Random.20number.20generator.html#290700672">(Jul 24 2022 at 21:26)</a>:</h4>
<p>I'm pretty sure there is a way to make it work, probably by just slightly altering the output type of <code>finish</code>.<br>
I'm on vacation this week so I can only take a look afterwards though <span aria-label="zip it" class="emoji emoji-1f910" role="img" title="zip it">:zip_it:</span></p>



<a name="290700834"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Random%20number%20generator/near/290700834" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Martin Stewart <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Random.20number.20generator.html#290700834">(Jul 24 2022 at 21:30)</a>:</h4>
<p>That would be super cool! I'm interested in seeing how it can be done</p>



<a name="290700850"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Random%20number%20generator/near/290700850" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jan kili <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Random.20number.20generator.html#290700850">(Jul 24 2022 at 21:30)</a>:</h4>
<p>This backpassing stuff is a fantastic idea <span class="user-mention" data-user-id="432314">@Martin Stewart</span>, thank you for proposing it! Yes, I intend for both primitive and custom generators to behave/chain identically, but what do you think, should that not be a requirement?</p>



<a name="290700856"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Random%20number%20generator/near/290700856" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Qqwy / Marten <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Random.20number.20generator.html#290700856">(Jul 24 2022 at 21:31)</a>:</h4>
<p>Haskell's <code>Data.Random</code> module allows this. But translating that to Roc might be a bit tricky unless you know Haskell well because Haskell code is quite terse  (and you need to take extra care to translate stuff that might depend on Haskell's lazy-by-default nature to Roc, which is strict)</p>



<a name="290700893"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Random%20number%20generator/near/290700893" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Qqwy / Marten <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Random.20number.20generator.html#290700893">(Jul 24 2022 at 21:31)</a>:</h4>
<p>Sorry, I should stop reading and responding this late</p>



<a name="290700932"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Random%20number%20generator/near/290700932" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Martin Stewart <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Random.20number.20generator.html#290700932">(Jul 24 2022 at 21:32)</a>:</h4>
<p><span class="user-mention silent" data-user-id="462053">JanCVanB</span> <a href="#narrow/stream/316715-contributing/topic/Random.20number.20generator/near/290700850">said</a>:</p>
<blockquote>
<p>This backpassing stuff is a fantastic idea <span class="user-mention silent" data-user-id="432314">Martin Stewart</span>, thank you for proposing it! Yes, I intend for both primitive and custom generators to behave/chain identically, but what do you think, should that not be a requirement?</p>
</blockquote>
<p>I agree that it would be ideal if primitive and custom generates behave the same way.</p>



<a name="290700933"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Random%20number%20generator/near/290700933" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Qqwy / Marten <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Random.20number.20generator.html#290700933">(Jul 24 2022 at 21:32)</a>:</h4>
<p>The Haskell implementation does make liberal use of <code>andThen</code></p>



<a name="290700943"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Random%20number%20generator/near/290700943" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jan kili <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Random.20number.20generator.html#290700943">(Jul 24 2022 at 21:32)</a>:</h4>
<p>I like the example above, how it chains lots of things together :))) very much what I'd like to see</p>



<hr><p>Last updated: Nov 01 2025 at 12:13 UTC</p>
</html>