<html>
<head><meta charset="utf-8"><title>Windows development · contributing · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/index.html">contributing</a></h2>
<h3>Topic: <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Windows.20development.html">Windows development</a></h3>

<hr>

<base href="https://roc.zulipchat.com">

<head><link href="https://roc-lang.github.io/zulip-export/style.css" rel="stylesheet"></head>

<a name="296579228"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Windows%20development/near/296579228" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Swiftaff <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Windows.20development.html#296579228">(Sep 01 2022 at 12:52)</a>:</h4>
<p>Hi I'm a hobby windows developer and I'd love to help out here if I can. I'm happy to look at good first issues having coded for a few years but never contributed before! My WSL2 roc install didn't fully work and so I saw this thread and was hopeful of trying the Windows build instead. cargo build failed for me on my Windows 10.0.19044.1889 initially until I realised I needed to install Zig. It now builds as far as roc_builtins and is now erroring on "No suitable version of LLVM was found system-wide or pointed to by LLVM_SYS_130_PREFIX. Consider using <code>llvmenv</code> to compile an appropriate copy of LLVM, and refer to the llvm-sys documentation for more information." and wondering if you can suggest what "appropriate LLVM" would be to install to get past that or if I've missed some other step? Or, I'm also happy to persevere with linux instead if that would be more appropriate.</p>



<a name="296579965"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Windows%20development/near/296579965" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Windows.20development.html#296579965">(Sep 01 2022 at 12:56)</a>:</h4>
<p>more people trying out windows and seeing what fails is really helpful. For llvm, the <code>BUILDING_FROM_SOURCE.md</code> has a section "llvm installation on windows" that you can follow</p>



<a name="296580030"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Windows%20development/near/296580030" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Windows.20development.html#296580030">(Sep 01 2022 at 12:56)</a>:</h4>
<p>based on experience, make sure that the path you install it at does not include any spaces</p>



<a name="296580078"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Windows%20development/near/296580078" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Windows.20development.html#296580078">(Sep 01 2022 at 12:57)</a>:</h4>
<p>the tooling does not seem to handle those well</p>



<a name="296580476"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Windows%20development/near/296580476" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Windows.20development.html#296580476">(Sep 01 2022 at 12:59)</a>:</h4>
<p>missing from that document is setting that you need to set this variable <code>$Env:LLVM_SYS_130_PREFIX="C:\foo\bar\LLVM-13.0.0-win64"</code> (note no bin on the end, it must point to the folder with the llvm things)</p>



<a name="296580605"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Windows%20development/near/296580605" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Swiftaff <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Windows.20development.html#296580605">(Sep 01 2022 at 12:59)</a>:</h4>
<p>OK great thanks I somehow missed the windows section as I skimmed that doc looking for instructions earlier - will give that and your notes a try!</p>



<a name="296580690"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Windows%20development/near/296580690" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Windows.20development.html#296580690">(Sep 01 2022 at 13:00)</a>:</h4>
<p>that should get you a working <code>cargo build</code> I think, and you can run some of our examples that have a zig platform</p>



<a name="296580821"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Windows%20development/near/296580821" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Windows.20development.html#296580821">(Sep 01 2022 at 13:00)</a>:</h4>
<p>other platform languages we have not tried (may be fun to see if e.g. rust works, or maybe it needs a bit of work with file names and extensions in some places)</p>



<a name="296580870"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Windows%20development/near/296580870" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Windows.20development.html#296580870">(Sep 01 2022 at 13:01)</a>:</h4>
<p>and many tests and examples seem to segfault</p>



<a name="296580939"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Windows%20development/near/296580939" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Windows.20development.html#296580939">(Sep 01 2022 at 13:01)</a>:</h4>
<p>if you are able to get a debugger to work on our binaries, that would be amazing</p>



<a name="296597322"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Windows%20development/near/296597322" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Swiftaff <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Windows.20development.html#296597322">(Sep 01 2022 at 14:27)</a>:</h4>
<p>I'm more used to "dbg!" than debugger but see how I go later.</p>
<p>For now it looks like I had debug tools and VS 2019 installed, so I updated those, installed LLVM directly under C to avoid spaces in path, added that to environment path and the LLVM_SYS_130_PREFIX pointing to the root llvm folder...<br>
...and cargo build worked!</p>
<p>So I tried these tests:</p>
<ul>
<li>
<p>cargo run repl worked except thread 'main' has overflowed its stack when I entered "hello, world"</p>
</li>
<li>
<p>cd to /target/debug and ran roc run ../../examples/hello-world/main.roc and I get a clang error: unsupported option '-fPIC' for target 'x86_64-pc-windows-msvc' ', crates\compiler\build\src\link.rs:1310:27</p>
</li>
</ul>
<p>which seems like an unsupported windows flag? I quickly tried commenting that flag out of <a href="http://link.rs">link.rs</a> and rebuilding and got more errors so assume that's not an obvious fix</p>
<ul>
<li>roc run ../../examples/algorithms/fibonacci.roc<br>
C:\ProgramData\chocolatey\lib\zig\tools\zig-windows-x86_64-0.9.1\lib\std\os.zig:73:25: error: container 'std.c' has no member called 'CLOCK'pub const CLOCK = system.CLOCK;<br>
                        ^<br>
', crates\compiler\build\src\link.rs:1310:27</li>
</ul>
<p>But I can get the basic zig example to work: <a href="https://ziglang.org/documentation/0.9.1/#Hello-World">https://ziglang.org/documentation/0.9.1/#Hello-World</a></p>
<p>Are these the kind of errors it should have at this stage, or do you think there are other steps I need to do first?</p>



<a name="296599121"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Windows%20development/near/296599121" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Swiftaff <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Windows.20development.html#296599121">(Sep 01 2022 at 14:36)</a>:</h4>
<p>and sorry meant to say cargo check is fine, but cargo test errors at below:</p>
<p>error: failed to run custom build command for <code>wasm3-sys v0.5.0 (https://github.com/roc-lang/wasm3-rs?rev=f0f807d1fc0a50d1d68e5799e54ee62c05af00f5#f0f807d1)</code></p>
<p>Caused by:<br>
  process didn't exit successfully: <code>H:\Development\roc\target\debug\build\wasm3-sys-45856a24a6e97685\build-script-build</code> (exit code: 101)  <br>
  --- stderr<br>
  thread 'main' panicked at 'Unable to generate bindings: Error { kind: NotFound, message: "program not found" }', C:\Users\&lt;redacted&gt;\.cargo\git\checkouts\wasm3-rs-50bf15e0ec9610c1\f0f807d\wasm3-sys\build.rs:68:35</p>



<a name="296607678"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Windows%20development/near/296607678" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Windows.20development.html#296607678">(Sep 01 2022 at 15:16)</a>:</h4>
<p><code>cargo install bindgen</code> for that last one</p>



<a name="296607957"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Windows%20development/near/296607957" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Windows.20development.html#296607957">(Sep 01 2022 at 15:17)</a>:</h4>
<p>for the zig clock thing, I have a PR that fixes it for the benchmarks platform <a href="https://github.com/roc-lang/roc/pull/3936">https://github.com/roc-lang/roc/pull/3936</a></p>



<a name="296608124"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Windows%20development/near/296608124" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Windows.20development.html#296608124">(Sep 01 2022 at 15:17)</a>:</h4>
<p>hello world uses a C platform. I wonder if maybe on windows we should use zig as the C compiler?</p>



<a name="296608283"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Windows%20development/near/296608283" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Windows.20development.html#296608283">(Sep 01 2022 at 15:18)</a>:</h4>
<p><code>cargo run examples/platform-switching/zig-platform/rocLovesZig.roc</code> should work btw</p>



<a name="296608369"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Windows%20development/near/296608369" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Windows.20development.html#296608369">(Sep 01 2022 at 15:18)</a>:</h4>
<p>and then yes, we get lots of random segfaults (reported as stack overflows or other stuff) currently</p>



<a name="296608456"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Windows%20development/near/296608456" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Windows.20development.html#296608456">(Sep 01 2022 at 15:19)</a>:</h4>
<p>the challenge will be to track those down, none of us have real developing native apps on windows experience</p>



<a name="296608510"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Windows%20development/near/296608510" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Windows.20development.html#296608510">(Sep 01 2022 at 15:19)</a>:</h4>
<p>so we don't currently have the tooling/know-how to debug the problems</p>



<a name="296649539"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Windows%20development/near/296649539" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Swiftaff <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Windows.20development.html#296649539">(Sep 01 2022 at 16:12)</a>:</h4>
<p>OK sorry I obviously missed that bindgen step too! - yes that worked and cargo test got through a lot more tests although crashed on a few at the end with link.exe existing code 1120 on roc_editor, roc_repository, test_derive roc_load_internal, roc_highlight, roc_glue (more out of terminal limit).<br>
I tried applying the 6 file updates from pull 3936 but after cargo build, cargo run examples/benchmark/platform/main.roc seemed to work but did nothing until cancelled after a few minutes of inactivity, unless it takes longer than few mins to run?<br>
Understand for hello world - I don't know really, but as zig seems to work it gets my vote<br>
And yes rocLovesZig works!<br>
And I see I get it now, I don't have much native Windows app experience either - I just use it as my main OS, but I'll look into setting up debugging and help where I can - and I can see if I can pick my .Net colleagues brains every now and then.<br>
Thanks so much for your patience and help, it's an interesting project and I look forward to contrinuting more usefully as I learn! Will turn in now and take another look tomorrow after work.</p>



<a name="296652506"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Windows%20development/near/296652506" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Windows.20development.html#296652506">(Sep 01 2022 at 16:28)</a>:</h4>
<p><code>main.roc</code> is the platform file, you should run the app module <code>rocLovesZig.roc</code></p>



<a name="296673476"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Windows%20development/near/296673476" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Windows.20development.html#296673476">(Sep 01 2022 at 18:17)</a>:</h4>
<p><a href="https://github.com/roc-lang/roc/pull/3948">https://github.com/roc-lang/roc/pull/3948</a> has a fix that hopefully fixes some tests on windows. It has a command to run some tests. Can someone on windows run those tests and report  the results?</p>



<a name="296692954"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Windows%20development/near/296692954" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Windows.20development.html#296692954">(Sep 01 2022 at 20:16)</a>:</h4>
<p>failures:</p>
<p>---- gen_num::to_i32_checked_larger_width_signed_fits_pos stdout ----<br>
thread 'gen_num::to_i32_checked_larger_width_signed_fits_pos' panicked at 'Found IntType(IntType { int_type: Type { address: 0x198d8a95aa8, llvm_type: "i64" } }) but expected the PointerType variant', C:\Users\Richard Feldman\.cargo\git\checkouts\inkwell-55729a4c43239568\accd406\src\types\enums.rs:398:13<br>
note: run with <code>RUST_BACKTRACE=1</code> environment variable to display a backtrace</p>
<p>---- gen_num::to_i32_checked_larger_width_signed_fits_neg stdout ----<br>
thread 'gen_num::to_i32_checked_larger_width_signed_fits_neg' panicked at 'Found IntType(IntType { int_type: Type { address: 0x198d3a30a88, llvm_type: "i64" } }) but expected the PointerType variant', C:\Users\Richard Feldman\.cargo\git\checkouts\inkwell-55729a4c43239568\accd406\src\types\enums.rs:398:13</p>
<p>---- gen_num::to_i32_checked_larger_width_signed_oob_pos stdout ----<br>
thread 'gen_num::to_i32_checked_larger_width_signed_oob_pos' panicked at 'Found IntType(IntType { int_type: Type { address: 0x198d0cbb4c8, llvm_type: "i64" } }) but expected the PointerType variant', C:\Users\Richard Feldman\.cargo\git\checkouts\inkwell-55729a4c43239568\accd406\src\types\enums.rs:398:13</p>
<p>---- gen_num::to_i32_checked_larger_width_unsigned_fits_pos stdout ----<br>
thread 'gen_num::to_i32_checked_larger_width_unsigned_fits_pos' panicked at 'Found IntType(IntType { int_type: Type { address: 0x198d0cb8a88, llvm_type: "i64" } }) but expected the PointerType variant', C:\Users\Richard Feldman\.cargo\git\checkouts\inkwell-55729a4c43239568\accd406\src\types\enums.rs:398:13</p>
<p>---- gen_num::to_i32_checked_larger_width_unsigned_oob_pos stdout ----<br>
thread 'gen_num::to_i32_checked_larger_width_unsigned_oob_pos' panicked at 'Found IntType(IntType { int_type: Type { address: 0x198d3a334c8, llvm_type: "i64" } }) but expected the PointerType variant', C:\Users\Richard Feldman\.cargo\git\checkouts\inkwell-55729a4c43239568\accd406\src\types\enums.rs:398:13</p>
<p>---- gen_num::to_i32_checked_larger_width_signed_oob_neg stdout ----<br>
thread 'gen_num::to_i32_checked_larger_width_signed_oob_neg' panicked at 'Found IntType(IntType { int_type: Type { address: 0x198cfef49b8, llvm_type: "i64" } }) but expected the PointerType variant', C:\Users\Richard Feldman\.cargo\git\checkouts\inkwell-55729a4c43239568\accd406\src\types\enums.rs:398:13</p>
<p>---- gen_num::to_i32_checked_same_width_unsigned_fits stdout ----<br>
thread 'gen_num::to_i32_checked_same_width_unsigned_fits' panicked at 'Found IntType(IntType { int_type: Type { address: 0x198cd4297a0, llvm_type: "i32" } }) but expected the PointerType variant', C:\Users\Richard Feldman\.cargo\git\checkouts\inkwell-55729a4c43239568\accd406\src\types\enums.rs:398:13</p>
<p>---- gen_num::to_i32_checked_same_width_unsigned_oob stdout ----<br>
thread 'gen_num::to_i32_checked_same_width_unsigned_oob' panicked at 'Found IntType(IntType { int_type: Type { address: 0x198d07254c0, llvm_type: "i32" } }) but expected the PointerType variant', C:\Users\Richard Feldman\.cargo\git\checkouts\inkwell-55729a4c43239568\accd406\src\types\enums.rs:398:13</p>
<p>---- gen_num::to_u32_checked_larger_width_signed_fits_pos stdout ----<br>
thread 'gen_num::to_u32_checked_larger_width_signed_fits_pos' panicked at 'Found IntType(IntType { int_type: Type { address: 0x198d7875cc8, llvm_type: "i64" } }) but expected the PointerType variant', C:\Users\Richard Feldman\.cargo\git\checkouts\inkwell-55729a4c43239568\accd406\src\types\enums.rs:398:13</p>
<p>---- gen_num::to_u32_checked_larger_width_signed_oob_neg stdout ----<br>
thread 'gen_num::to_u32_checked_larger_width_signed_oob_neg' panicked at 'Found IntType(IntType { int_type: Type { address: 0x198cac73d68, llvm_type: "i64" } }) but expected the PointerType variant', C:\Users\Richard Feldman\.cargo\git\checkouts\inkwell-55729a4c43239568\accd406\src\types\enums.rs:398:13</p>
<p>---- gen_num::to_u32_checked_same_width_signed_oob stdout ----<br>
thread 'gen_num::to_u32_checked_same_width_signed_oob' panicked at 'Found IntType(IntType { int_type: Type { address: 0x198e187a500, llvm_type: "i32" } }) but expected the PointerType variant', C:\Users\Richard Feldman\.cargo\git\checkouts\inkwell-55729a4c43239568\accd406\src\types\enums.rs:398:13</p>
<p>---- gen_num::to_u32_checked_larger_width_unsigned_oob_pos stdout ----<br>
thread 'gen_num::to_u32_checked_larger_width_unsigned_oob_pos' panicked at 'Found IntType(IntType { int_type: Type { address: 0x198dfbb3798, llvm_type: "i64" } }) but expected the PointerType variant', C:\Users\Richard Feldman\.cargo\git\checkouts\inkwell-55729a4c43239568\accd406\src\types\enums.rs:398:13</p>
<p>---- gen_num::to_u32_checked_same_width_signed_fits stdout ----<br>
thread 'gen_num::to_u32_checked_same_width_signed_fits' panicked at 'Found IntType(IntType { int_type: Type { address: 0x198e1b4fad0, llvm_type: "i32" } }) but expected the PointerType variant', C:\Users\Richard Feldman\.cargo\git\checkouts\inkwell-55729a4c43239568\accd406\src\types\enums.rs:398:13</p>
<p>---- gen_num::to_u32_checked_larger_width_unsigned_fits_pos stdout ----<br>
thread 'gen_num::to_u32_checked_larger_width_unsigned_fits_pos' panicked at 'Found IntType(IntType { int_type: Type { address: 0x198dfbb76f8, llvm_type: "i64" } }) but expected the PointerType variant', C:\Users\Richard Feldman\.cargo\git\checkouts\inkwell-55729a4c43239568\accd406\src\types\enums.rs:398:13</p>
<p>---- gen_num::to_u32_checked_larger_width_signed_oob_pos stdout ----<br>
thread 'gen_num::to_u32_checked_larger_width_signed_oob_pos' panicked at 'Found IntType(IntType { int_type: Type { address: 0x198e1878568, llvm_type: "i64" } }) but expected the PointerType variant', C:\Users\Richard Feldman\.cargo\git\checkouts\inkwell-55729a4c43239568\accd406\src\types\enums.rs:398:13</p>
<p>---- gen_num::to_u32_checked_smaller_width_neg_oob stdout ----<br>
thread 'gen_num::to_u32_checked_smaller_width_neg_oob' panicked at 'Found IntType(IntType { int_type: Type { address: 0x198cd6001e0, llvm_type: "i8" } }) but expected the PointerType variant', C:\Users\Richard Feldman\.cargo\git\checkouts\inkwell-55729a4c43239568\accd406\src\types\enums.rs:398:13</p>
<p>---- gen_num::to_u32_checked_smaller_width_pos stdout ----<br>
thread 'gen_num::to_u32_checked_smaller_width_pos' panicked at 'Found IntType(IntType { int_type: Type { address: 0x198d9898fa0, llvm_type: "i8" } }) but expected the PointerType variant', C:\Users\Richard Feldman\.cargo\git\checkouts\inkwell-55729a4c43239568\accd406\src\types\enums.rs:398:13</p>
<p>failures:<br>
    gen_num::to_i32_checked_larger_width_signed_fits_neg<br>
    gen_num::to_i32_checked_larger_width_signed_fits_pos<br>
    gen_num::to_i32_checked_larger_width_signed_oob_neg<br>
    gen_num::to_i32_checked_larger_width_signed_oob_pos<br>
    gen_num::to_i32_checked_larger_width_unsigned_fits_pos<br>
    gen_num::to_i32_checked_larger_width_unsigned_oob_pos<br>
    gen_num::to_i32_checked_same_width_unsigned_fits<br>
    gen_num::to_i32_checked_same_width_unsigned_oob<br>
    gen_num::to_u32_checked_larger_width_signed_fits_pos<br>
    gen_num::to_u32_checked_larger_width_signed_oob_neg<br>
    gen_num::to_u32_checked_larger_width_signed_oob_pos<br>
    gen_num::to_u32_checked_larger_width_unsigned_fits_pos<br>
    gen_num::to_u32_checked_larger_width_unsigned_oob_pos<br>
    gen_num::to_u32_checked_same_width_signed_fits<br>
    gen_num::to_u32_checked_same_width_signed_oob<br>
    gen_num::to_u32_checked_smaller_width_neg_oob<br>
    gen_num::to_u32_checked_smaller_width_pos</p>
<p>test result: FAILED. 149 passed; 17 failed; 0 ignored; 0 measured; 938 filtered out; finished in 22.65s</p>



<a name="296692981"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Windows%20development/near/296692981" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Windows.20development.html#296692981">(Sep 01 2022 at 20:16)</a>:</h4>
<p>that was on Windows 11</p>



<a name="296841836"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Windows%20development/near/296841836" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Swiftaff <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Windows.20development.html#296841836">(Sep 02 2022 at 15:21)</a>:</h4>
<p>FYI on Windows 10 I got the same result after pulling 3948 - plus these additional 5 failures:</p>
<p>---- gen_num::to_f32_from_i64 stdout ----<br>
thread 'gen_num::to_f32_from_i64' panicked at 'Error loading compiled dylib for test: LoadLibraryExW { source: Os { code: 193, kind: Uncategorized, message: "%1 is not a valid Win32 application." } }', crates\compiler\test_gen\src\helpers\llvm.rs:324:23<br>
note: run with <code>RUST_BACKTRACE=1</code> environment variable to display a backtrace</p>
<p>---- gen_num::to_f32_from_f64 stdout ----<br>
thread 'gen_num::to_f32_from_f64' panicked at 'Error loading compiled dylib for test: LoadLibraryExW { source: Os { code: 193, kind: Uncategorized, message: "%1 is not a valid Win32 application." } }', crates\compiler\test_gen\src\helpers\llvm.rs:324:23</p>
<p>---- gen_num::to_f32_from_f32 stdout ----<br>
thread 'gen_num::to_f32_from_f32' panicked at 'Error loading compiled dylib for test: LoadLibraryExW { source: Os { code: 193, kind: Uncategorized, message: "%1 is not a valid Win32 application." } }', crates\compiler\test_gen\src\helpers\llvm.rs:324:23</p>
<p>---- gen_num::to_f32_from_i16 stdout ----<br>
thread 'gen_num::to_f32_from_i16' panicked at 'Error loading compiled dylib for test: LoadLibraryExW { source: Os { code: 193, kind: Uncategorized, message: "%1 is not a valid Win32 application." } }', crates\compiler\test_gen\src\helpers\llvm.rs:324:23</p>
<p>---- gen_num::to_f32_from_i128 stdout ----<br>
thread 'gen_num::to_f32_from_i128' panicked at 'Error loading compiled dylib for test: LoadLibraryExW { source: Os { code: 193, kind: Uncategorized, message: "%1 is not a valid Win32 application." } }', crates\compiler\test_gen\src\helpers\llvm.rs:324:23</p>



<a name="296843234"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Windows%20development/near/296843234" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Swiftaff <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Windows.20development.html#296843234">(Sep 02 2022 at 15:28)</a>:</h4>
<p>Aaand just tried running the test a few more times and those extra 5 no longer error!</p>



<a name="296859592"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Windows%20development/near/296859592" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Swiftaff <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Windows.20development.html#296859592">(Sep 02 2022 at 16:57)</a>:</h4>
<p><span class="user-mention silent" data-user-id="281543">Folkert de Vries</span> <a href="#narrow/stream/316715-contributing/topic/Windows.20development/near/296580939">said</a>:</p>
<blockquote>
<p>if you are able to get a debugger to work on our binaries, that would be amazing</p>
</blockquote>
<p>I've just experimented after googling debugging .EXEs <a href="https://devblogs.microsoft.com/visualstudio/how-to-debug-and-profile-any-exe-with-visual-studio/">https://devblogs.microsoft.com/visualstudio/how-to-debug-and-profile-any-exe-with-visual-studio/</a> and ran a simple example through the Visual Studio 2019 debugger by debugging the '/target/debug/roc.exe' with 'repl' argument - since the repl always stack overflows for me after any command. The exception breakpoint stopped at the next statement to execute on 'roc\crates\compiler\constrain\src\expr.rs' at 'pub fn constrain_expr(' with this call stack... frankly I'm a bit out of my depth here - but happy to keep plugging away tomorrow onwards in the absence of anyone with more experience - if you have ideas on what I can look for</p>
<blockquote>
<p>roc.exe!roc_constrain::expr::constrain_expr(roc_can::constraint::Constraints * constraints, roc_constrain::expr::Env * env, roc_region::all::Region expr, enum$&lt;roc_can::expr::Expr&gt; * expected, enum$&lt;roc_can::expected::Expected&lt;enum$&lt;roc_types::types::Type&gt;&gt;&gt;) Line 174    Unknown<br>
    roc.exe!roc_constrain::expr::constrain_expr(roc_can::constraint::Constraints * constraints, roc_constrain::expr::Env * env, roc_region::all::Region expr, enum$&lt;roc_can::expr::Expr&gt; * expected, enum$&lt;roc_can::expected::Expected&lt;enum$&lt;roc_types::types::Type&gt;&gt;&gt;) Line 362    Unknown<br>
    roc.exe!roc_constrain::expr::constrain_expr(roc_can::constraint::Constraints * constraints, roc_constrain::expr::Env * env, roc_region::all::Region expr, enum$&lt;roc_can::expr::Expr&gt; * expected, enum$&lt;roc_can::expected::Expected&lt;enum$&lt;roc_types::types::Type&gt;&gt;&gt;) Line 389    Unknown<br>
    roc.exe!roc_constrain::expr::constrain_expr(roc_can::constraint::Constraints * constraints, roc_constrain::expr::Env * env, roc_region::all::Region expr, enum$&lt;roc_can::expr::Expr&gt; * expected, enum$&lt;roc_can::expected::Expected&lt;enum$&lt;roc_types::types::Type&gt;&gt;&gt;) Line 389    Unknown<br>
    roc.exe!roc_constrain::expr::constrain_field(roc_can::constraint::Constraints * constraints, roc_constrain::expr::Env * env, roc_types::subs::Variable field_var, roc_region::all::Loc&lt;enum$&lt;roc_can::expr::Expr&gt;&gt; * loc_expr) Line 1980    Unknown<br>
    roc.exe!roc_constrain::expr::constrain_expr(roc_can::constraint::Constraints * constraints, roc_constrain::expr::Env * env, roc_region::all::Region expr, enum$&lt;roc_can::expr::Expr&gt; * expected, enum$&lt;roc_can::expected::Expected&lt;enum$&lt;roc_types::types::Type&gt;&gt;&gt;) Line 205    Unknown<br>
    roc.exe!roc_constrain::expr::constrain_expr(roc_can::constraint::Constraints * constraints, roc_constrain::expr::Env * env, roc_region::all::Region expr, enum$&lt;roc_can::expr::Expr&gt; * expected, enum$&lt;roc_can::expected::Expected&lt;enum$&lt;roc_types::types::Type&gt;&gt;&gt;) Line 389    Unknown<br>
    roc.exe!roc_constrain::expr::constrain_def(roc_can::constraint::Constraints * constraints, roc_constrain::expr::Env * env, roc_can::def::Def * def, enum$&lt;roc_can::constraint::Constraint&gt; body_con) Line 2623  Unknown<br>
    roc.exe!roc_constrain::expr::constrain_expr(roc_can::constraint::Constraints * constraints, roc_constrain::expr::Env * env, roc_region::all::Region expr, enum$&lt;roc_can::expr::Expr&gt; * expected, enum$&lt;roc_can::expected::Expected&lt;enum$&lt;roc_types::types::Type&gt;&gt;&gt;) Line 1037   Unknown<br>
    [Inline Frame] roc.exe!roc_constrain::expr::constrain_when_branch_help(roc_can::constraint::Constraints * constraints, roc_constrain::expr::Env * env, roc_region::all::Region when_branch, roc_can::expr::WhenBranch * expr_expected, roc_constrain::expr::constrain_expr::closure_env$5) Line 1869    Unknown<br>
    roc.exe!roc_constrain::expr::constrain_expr(roc_can::constraint::Constraints * constraints, roc_constrain::expr::Env * env, roc_region::all::Region expr, enum$&lt;roc_can::expr::Expr&gt; * expected, enum$&lt;roc_can::expected::Expected&lt;enum$&lt;roc_types::types::Type&gt;&gt;&gt;) Line 804    Unknown<br>
    roc.exe!roc_constrain::expr::constrain_function_def(roc_can::constraint::Constraints * constraints, roc_constrain::expr::Env * env, roc_can::expr::Declarations * declarations, unsigned __int64 index, roc_collections::soa::Index&lt;roc_region::all::Loc&lt;roc_can::expr::FunctionDef&gt;&gt; function_def_index, enum$&lt;roc_can::constraint::Constraint&gt; body_con) Line 1561    Unknown<br>
    [Inline Frame] roc.exe!roc_constrain::expr::constrain_decls(roc_can::constraint::Constraints * constraints, roc_module::symbol::ModuleId home, roc_can::expr::Declarations * declarations) Line 2065    Unknown<br>
    roc.exe!roc_constrain::module::constrain_module(roc_can::constraint::Constraints * constraints, alloc::vec::Vec&lt;tuple$&lt;roc_region::all::Loc&lt;roc_module::symbol::Symbol&gt;,roc_region::all::Loc&lt;enum$&lt;roc_types::types::Type&gt;&gt;&gt;,alloc::alloc::Global&gt; symbols_from_requires, roc_can::abilities::IAbilitiesStore&lt;roc_can::abilities::Pending&gt; * abilities_store, roc_can::expr::Declarations * declarations, roc_module::symbol::ModuleId home) Line 18    Unknown<br>
    roc.exe!roc_load_internal:<span aria-label="file" class="emoji emoji-1f4c4" role="img" title="file">:file:</span>:canonicalize_and_constrain(bumpalo::Bump * arena, roc_module::symbol::ModuleIds * module_ids, roc_module::symbol::IdentIdsByModule dep_idents, roc_collections::vec_set::VecSet&lt;roc_module::symbol::Symbol&gt; exposed_symbols, std::collections:<span aria-label="hash" class="emoji emoji-0023-20e3" role="img" title="hash">:hash:</span><span aria-label="map" class="emoji emoji-1f5fa" role="img" title="map">:map:</span>:HashMap&lt;roc_module::symbol::Symbol,roc_types::types::Alias,core:<span aria-label="hash" class="emoji emoji-0023-20e3" role="img" title="hash">:hash:</span>:BuildHasherDefault&lt;wyhash::traits::WyHash&gt;&gt; aliases, roc_can::abilities::IAbilitiesStore&lt;roc_can::abilities::Pending&gt; imported_abilities_state, roc_load_internal:<span aria-label="file" class="emoji emoji-1f4c4" role="img" title="file">:file:</span>:ParsedModule parsed, bool skip_constraint_gen) Line 4594 Unknown<br>
    roc.exe!roc_load_internal:<span aria-label="file" class="emoji emoji-1f4c4" role="img" title="file">:file:</span>:run_task(enum$&lt;roc_load_internal:<span aria-label="file" class="emoji emoji-1f4c4" role="img" title="file">:file:</span>:BuildTask&gt; task, bumpalo::Bump * arena, ref$&lt;std::path::Path&gt;) Line 5415   Unknown<br>
    roc.exe!roc_load_internal:<span aria-label="file" class="emoji emoji-1f4c4" role="img" title="file">:file:</span>:worker_task_step(bumpalo::Bump * worker_arena, crossbeam_deque::deque::Worker&lt;enum$&lt;roc_load_internal:<span aria-label="file" class="emoji emoji-1f4c4" role="img" title="file">:file:</span>:BuildTask&gt;&gt; * worker, crossbeam_deque::deque::Injector&lt;enum$&lt;roc_load_internal:<span aria-label="file" class="emoji emoji-1f4c4" role="img" title="file">:file:</span>:BuildTask&gt;&gt; * injector, slice$&lt;crossbeam_deque::deque::Stealer&lt;enum$&lt;roc_load_internal:<span aria-label="file" class="emoji emoji-1f4c4" role="img" title="file">:file:</span>:BuildTask&gt;&gt;&gt; worker_msg_rx, crossbeam_channel::channel::Receiver&lt;roc_load_internal:<span aria-label="file" class="emoji emoji-1f4c4" role="img" title="file">:file:</span>:WorkerMsg&gt; * msg_tx, crossbeam_channel::channel::Sender&lt;enum$&lt;roc_load_internal:<span aria-label="file" class="emoji emoji-1f4c4" role="img" title="file">:file:</span>:Msg&gt;&gt; *) Line 1881   Unknown<br>
    roc.exe!roc_load_internal:<span aria-label="file" class="emoji emoji-1f4c4" role="img" title="file">:file:</span>:load_single_threaded(bumpalo::Bump * arena, roc_load_internal:<span aria-label="file" class="emoji emoji-1f4c4" role="img" title="file">:file:</span>:LoadStart load_start, roc_can::module::ExposedByModule exposed_types, roc_target::TargetInfo cached_subs, std::collections:<span aria-label="hash" class="emoji emoji-0023-20e3" role="img" title="hash">:hash:</span><span aria-label="map" class="emoji emoji-1f5fa" role="img" title="map">:map:</span>:HashMap&lt;roc_module::symbol::ModuleId,tuple$&lt;roc_types::subs::Subs,alloc::vec::Vec&lt;tuple$&lt;roc_module::symbol::Symbol,roc_types::subs::Variable&gt;,alloc::alloc::Global&gt;&gt;,core:<span aria-label="hash" class="emoji emoji-0023-20e3" role="img" title="hash">:hash:</span>:BuildHasherDefault&lt;wyhash::traits::WyHash&gt;&gt; render, roc_reporting::report::RenderTarget exec_mode, roc_load_internal:<span aria-label="file" class="emoji emoji-1f4c4" role="img" title="file">:file:</span>:ExecutionMode) Line 1542 Unknown<br>
    roc.exe!roc_load_internal:<span aria-label="file" class="emoji emoji-1f4c4" role="img" title="file">:file:</span>:load(bumpalo::Bump * arena, roc_load_internal:<span aria-label="file" class="emoji emoji-1f4c4" role="img" title="file">:file:</span>:LoadStart load_start, roc_can::module::ExposedByModule exposed_types, std::collections:<span aria-label="hash" class="emoji emoji-0023-20e3" role="img" title="hash">:hash:</span><span aria-label="map" class="emoji emoji-1f5fa" role="img" title="map">:map:</span>:HashMap&lt;roc_module::symbol::ModuleId,tuple$&lt;roc_types::subs::Subs,alloc::vec::Vec&lt;tuple$&lt;roc_module::symbol::Symbol,roc_types::subs::Variable&gt;,alloc::alloc::Global&gt;&gt;,core:<span aria-label="hash" class="emoji emoji-0023-20e3" role="img" title="hash">:hash:</span>:BuildHasherDefault&lt;wyhash::traits::WyHash&gt;&gt; cached_subs, roc_load_internal:<span aria-label="file" class="emoji emoji-1f4c4" role="img" title="file">:file:</span>:LoadConfig load_config) Line 1459  Unknown<br>
    roc.exe!roc_load::load(bumpalo::Bump * arena, roc_load_internal:<span aria-label="file" class="emoji emoji-1f4c4" role="img" title="file">:file:</span>:LoadStart load_start, roc_can::module::ExposedByModule exposed_types, roc_load_internal:<span aria-label="file" class="emoji emoji-1f4c4" role="img" title="file">:file:</span>:LoadConfig load_config) Line 32   Unknown<br>
    roc.exe!roc_load::load_and_monomorphize_from_str(bumpalo::Bump * arena, std::path::PathBuf filename, str src_dir, std::path::PathBuf exposed_types, roc_can::module::ExposedByModule load_config, roc_load_internal:<span aria-label="file" class="emoji emoji-1f4c4" role="img" title="file">:file:</span>:LoadConfig) Line 93  Unknown<br>
    roc.exe!roc_repl_eval::gen::compile_to_mono(bumpalo::Bump * arena, str palette, roc_target::TargetInfo) Line 57 Unknown<br>
    roc.exe!roc_repl_cli::gen_and_eval_llvm(str target, target_lexicon::triple::Triple opt_level, roc_mono::ir::OptLevel) Line 305  Unknown<br>
    roc.exe!roc_repl_cli::eval_and_format(str) Line 367 Unknown<br>
    roc.exe!roc_repl_cli::main() Line 433   Unknown<br>
    roc.exe!roc::main() Line 176    Unknown<br>
    roc.exe!core::ops::function::FnOnce::call_once&lt;enum$&lt;core::result::Result&lt;tuple$&lt;&gt;,std::io::error::Error&gt;, 1, 18446744073709551615, Err&gt; (<em>)(),tuple$&lt;&gt;&gt;(enum$&lt;core::result::Result&lt;tuple$&lt;&gt;,std::io::error::Error&gt;, 1, 18446744073709551615, Err&gt;(</em>)()) Line 227   Unknown<br>
    roc.exe!std::sys_common::backtrace::__rust_begin_short_backtrace&lt;enum$&lt;core::result::Result&lt;tuple$&lt;&gt;,std::io::error::Error&gt;, 1, 18446744073709551615, Err&gt; (<em>)(),enum$&lt;core::result::Result&lt;tuple$&lt;&gt;,std::io::error::Error&gt;, 1, 18446744073709551615, Err&gt;&gt;(enum$&lt;core::result::Result&lt;tuple$&lt;&gt;,std::io::error::Error&gt;, 1, 18446744073709551615, Err&gt;(</em>)() f) Line 122  Unknown<br>
    roc.exe!std::rt::lang_start::closure$0&lt;enum$&lt;core::result::Result&lt;tuple$&lt;&gt;,std::io::error::Error&gt;, 1, 18446744073709551615, Err&gt;&gt;(std::rt::lang_start::closure_env$0&lt;enum$&lt;core::result::Result&lt;tuple$&lt;&gt;,std::io::error::Error&gt;, 1, 18446744073709551615, Err&gt;&gt; *) Line 145 Unknown<br>
    [Inline Frame] roc.exe!core::ops::function::impls::impl$2::call_once() Line 259 Unknown<br>
    [Inline Frame] roc.exe!std::panicking::try::do_call() Line 492  Unknown<br>
    [Inline Frame] roc.exe!std::panicking::try() Line 456   Unknown<br>
    [Inline Frame] roc.exe!std::panic::catch_unwind() Line 137  Unknown<br>
    [Inline Frame] roc.exe!std::rt::lang_start_internal::closure$2() Line 128   Unknown<br>
    [Inline Frame] roc.exe!std::panicking::try::do_call() Line 492  Unknown<br>
    [Inline Frame] roc.exe!std::panicking::try() Line 456   Unknown<br>
    [Inline Frame] roc.exe!std::panic::catch_unwind() Line 137  Unknown<br>
    roc.exe!std::rt::lang_start_internal() Line 128 Unknown<br>
    roc.exe!std::rt::lang_start&lt;enum$&lt;core::result::Result&lt;tuple$&lt;&gt;,std::io::error::Error&gt;, 1, 18446744073709551615, Err&gt;&gt;(enum$&lt;core::result::Result&lt;tuple$&lt;&gt;,std::io::error::Error&gt;, 1, 18446744073709551615, Err&gt;(*)() main, __int64 argc, unsigned char * * argv) Line 144  Unknown<br>
    [External Code]</p>
</blockquote>



<a name="296863284"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Windows%20development/near/296863284" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Windows.20development.html#296863284">(Sep 02 2022 at 17:19)</a>:</h4>
<p>based on that output it might actually be a stack overflow</p>



<a name="296863313"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Windows%20development/near/296863313" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Windows.20development.html#296863313">(Sep 02 2022 at 17:19)</a>:</h4>
<p>meaning we'd need to increase how much stack space is allowed</p>



<a name="296863428"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Windows%20development/near/296863428" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Windows.20development.html#296863428">(Sep 02 2022 at 17:20)</a>:</h4>
<p>for those number errors, I kind of need a full backtrace</p>



<a name="296863484"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Windows%20development/near/296863484" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Windows.20development.html#296863484">(Sep 02 2022 at 17:20)</a>:</h4>
<p>so <code>$env:RUST_BACKTRACE=1</code> or something and then run just one of the failing tests again</p>



<a name="296868363"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Windows%20development/near/296868363" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Windows.20development.html#296868363">(Sep 02 2022 at 17:50)</a>:</h4>
<p>another one, Could someone on windows try <a href="https://github.com/roc-lang/roc/pull/3950">https://github.com/roc-lang/roc/pull/3950</a> with cargo test-gen-llvm gen_dict and report any errors</p>



<a name="296871105"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Windows%20development/near/296871105" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anton <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Windows.20development.html#296871105">(Sep 02 2022 at 18:06)</a>:</h4>
<p>running it now...</p>



<a name="296871700"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Windows%20development/near/296871700" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anton <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Windows.20development.html#296871700">(Sep 02 2022 at 18:09)</a>:</h4>
<p><a href="/user_uploads/22008/nawE10Tg9ykFpufJC-0MTyYb/test_gen_llvm_logs.txt">test_gen_llvm_logs.txt</a></p>



<a name="296872174"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Windows%20development/near/296872174" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Windows.20development.html#296872174">(Sep 02 2022 at 18:12)</a>:</h4>
<p>maybe try just one of them?</p>



<a name="296872184"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Windows%20development/near/296872184" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Windows.20development.html#296872184">(Sep 02 2022 at 18:12)</a>:</h4>
<p>there is a lot of noise</p>



<a name="296872205"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Windows%20development/near/296872205" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Windows.20development.html#296872205">(Sep 02 2022 at 18:13)</a>:</h4>
<p><code>gen_dict::insert_all_prefer_first</code> maybe</p>



<a name="296876101"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Windows%20development/near/296876101" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Windows.20development.html#296876101">(Sep 02 2022 at 18:38)</a>:</h4>
<p>and we made some improvements to installing the dependencies on windows. <a href="https://github.com/roc-lang/roc/pull/3953">https://github.com/roc-lang/roc/pull/3953</a> please leave a review comment if you have further suggestions</p>



<a name="296950719"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Windows%20development/near/296950719" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Swiftaff <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Windows.20development.html#296950719">(Sep 03 2022 at 07:18)</a>:</h4>
<p>I replied with my test results in pull/3948 &amp; pull/3950</p>



<a name="296973718"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Windows%20development/near/296973718" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Windows.20development.html#296973718">(Sep 03 2022 at 10:42)</a>:</h4>
<p>thanks! I made some changes to 3948, can you try it again?</p>



<a name="297007328"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Windows%20development/near/297007328" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Swiftaff <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Windows.20development.html#297007328">(Sep 03 2022 at 15:33)</a>:</h4>
<p>yup the 3948 tests all pass for me now!<br>
cargo test-gen-llvm gen_num::to_<br>
test result: ok. 166 passed; 0 failed; 0 ignored; 0 measured; 944 filtered out; finished in 137.87s</p>



<a name="297122081"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Windows%20development/near/297122081" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Windows.20development.html#297122081">(Sep 04 2022 at 17:06)</a>:</h4>
<p>another set of fixes <a href="https://github.com/roc-lang/roc/pull/3965">https://github.com/roc-lang/roc/pull/3965</a></p>
<p>based on the llvm IR gen, <code>cargo test-gen-llvm gen_num</code> should now be able to run all tests. please report any that fail</p>



<a name="297205780"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Windows%20development/near/297205780" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Swiftaff <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Windows.20development.html#297205780">(Sep 05 2022 at 10:59)</a>:</h4>
<p>Almost! but fails for me on looks like just the last 2 asserts of these 2 tests with exactly the same error like this but different test name...<br>
num_to_str_f32<br>
num_to_str_f64</p>
<p>Caused by:<br>
  process didn't exit successfully: <code>H:\Development\roc\target\debug\deps\test_gen-981323e19142b58c.exe gen_num::num_to_str_f64 --exact --nocapture</code> (exit code: 0xc0000374, STATUS_HEAP_CORRUPTION)</p>
<ul>
<li>The terminal process "C:\Users\neil.IBC\.cargo\bin\cargo.exe 'test', '--package', 'test_gen', '--test', 'test_gen', '--features', 'gen-llvm', '--', 'gen_num::num_to_str_f64', '--exact', '--nocapture'" terminated with exit code: 3221226356.</li>
</ul>
<p>Also - I asume it's expected for most tests to say 'warning: ignoring debug info with an invalid version (0) in app'?</p>



<a name="297206410"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Windows%20development/near/297206410" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Windows.20development.html#297206410">(Sep 05 2022 at 11:03)</a>:</h4>
<p>ok, those test failures make sense</p>



<a name="297206457"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Windows%20development/near/297206457" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Windows.20development.html#297206457">(Sep 05 2022 at 11:03)</a>:</h4>
<p>for some reason that we don't yet understand, whenever we return a pointer from roc to rust, that segfaults on windows</p>



<a name="297206531"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Windows%20development/near/297206531" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Windows.20development.html#297206531">(Sep 05 2022 at 11:04)</a>:</h4>
<p>and re the "warning: ignoring ..." that is something thatLLVM prints and I don't know why. Kind of hoping it goes away with zig 0.10</p>



<a name="298055319"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Windows%20development/near/298055319" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Windows.20development.html#298055319">(Sep 09 2022 at 21:22)</a>:</h4>
<p>Richard and I got the llvm gen tests to work <a href="https://github.com/roc-lang/roc/pull/4003">https://github.com/roc-lang/roc/pull/4003</a> by just ignoring 3 tests (they all use roc_panic, so something is up there)</p>



<a name="298055367"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Windows%20development/near/298055367" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Windows.20development.html#298055367">(Sep 09 2022 at 21:23)</a>:</h4>
<p>and by leaking memory allocated in a DLL (not 100% sure what's going on there, but this at least makes the tests run)</p>



<a name="298055478"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Windows%20development/near/298055478" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Windows.20development.html#298055478">(Sep 09 2022 at 21:23)</a>:</h4>
<p><span class="user-mention" data-user-id="361169">@Anton</span>  that means that the windows CI can not only build, but also run some tests (gen for llvm and wasm, and also parse and format tests already work)</p>



<a name="298058237"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Windows%20development/near/298058237" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ayaz Hafiz <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Windows.20development.html#298058237">(Sep 09 2022 at 21:46)</a>:</h4>
<p>For the tests that should panic and fail, I bet it's a problem with the setjmp/longjmp stuff. We had to patch that when making it work for M1 a few months ago as well.</p>



<a name="298067947"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Windows%20development/near/298067947" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Windows.20development.html#298067947">(Sep 09 2022 at 23:27)</a>:</h4>
<p>lots of the panics do work though... <span aria-label="thinking" class="emoji emoji-1f914" role="img" title="thinking">:thinking:</span></p>



<a name="298067953"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Windows%20development/near/298067953" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Windows.20development.html#298067953">(Sep 09 2022 at 23:27)</a>:</h4>
<p>er, lots of the tests with panics</p>



<a name="298093697"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Windows%20development/near/298093697" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anton <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Windows.20development.html#298093697">(Sep 10 2022 at 07:11)</a>:</h4>
<p>Awesome, I hope to tackle the lld-link build issue on the windows CI machine today, after that I'll add testing.</p>



<a name="299470431"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Windows%20development/near/299470431" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Windows.20development.html#299470431">(Sep 18 2022 at 19:45)</a>:</h4>
<p>if someone on windows wants to run this <a href="/user_uploads/22008/dugLlWisr24VPcJsplFG6MxN/app.exe">app.exe</a> and see what happens, that might be helpful. I expect it to crash, but hopefully it tells more than wine does</p>



<a name="299470503"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Windows%20development/near/299470503" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Windows.20development.html#299470503">(Sep 18 2022 at 19:46)</a>:</h4>
<p>it's the current state of the surgical linker on windows with a trivial (non-roc) app and host.</p>



<a name="299470515"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Windows%20development/near/299470515" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Windows.20development.html#299470515">(Sep 18 2022 at 19:47)</a>:</h4>
<p>it's close to working, but not quite there yet and now we're in the tedious debugging  phase</p>



<a name="299471832"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Windows%20development/near/299471832" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Carroll <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Windows.20development.html#299471832">(Sep 18 2022 at 20:05)</a>:</h4>
<div class="codehilite"><pre><span></span><code>PS C:\Users\Brian\Downloads&gt; .\app.exe
Program &#39;app.exe&#39; failed to run: The specified executable is not a valid application for this OS platform.At line:1
char:1
+ .\app.exe
+ ~~~~~~~~~.
At line:1 char:1
+ .\app.exe
+ ~~~~~~~~~
    + CategoryInfo          : ResourceUnavailable: (:) [], ApplicationFailedException
    + FullyQualifiedErrorId : NativeCommandFailed
</code></pre></div>



<a name="299472012"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Windows%20development/near/299472012" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Carroll <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Windows.20development.html#299472012">(Sep 18 2022 at 20:08)</a>:</h4>
<p>If I run it in a <code>cmd</code> shell rather than Powershell, I get a popup window saying "This app can't run on your PC. To find a version for your PC, check with the software publisher"</p>



<a name="299472198"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Windows%20development/near/299472198" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Windows.20development.html#299472198">(Sep 18 2022 at 20:11)</a>:</h4>
<p>well...</p>



<a name="299472199"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Windows%20development/near/299472199" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Carroll <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Windows.20development.html#299472199">(Sep 18 2022 at 20:11)</a>:</h4>
<p>x86_64 machine running Windows 11 Home, version 21H2, build 22000.856</p>



<a name="299472229"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Windows%20development/near/299472229" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Windows.20development.html#299472229">(Sep 18 2022 at 20:11)</a>:</h4>
<p>thanks for trying, but the error message quality here is not great ...</p>



<a name="299472286"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Windows%20development/near/299472286" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Carroll <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Windows.20development.html#299472286">(Sep 18 2022 at 20:12)</a>:</h4>
<p>Yep</p>



<a name="299472308"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Windows%20development/near/299472308" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Windows.20development.html#299472308">(Sep 18 2022 at 20:12)</a>:</h4>
<p>must mean something is malformed in practice. the .exe is syntactically valid, but semantically something must be fundamentally wrong</p>



<a name="299472334"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Windows%20development/near/299472334" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Carroll <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Windows.20development.html#299472334">(Sep 18 2022 at 20:13)</a>:</h4>
<p>yeah</p>



<a name="299472855"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Windows%20development/near/299472855" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Windows.20development.html#299472855">(Sep 18 2022 at 20:21)</a>:</h4>
<p>ok, seems like I can make some progress by using a host.exe that we did not touch (i.e. we didn't reserve any sections in it)</p>



<a name="299472890"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Windows%20development/near/299472890" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Windows.20development.html#299472890">(Sep 18 2022 at 20:21)</a>:</h4>
<p>I then remove the references to the dylib, and get</p>
<div class="codehilite"><pre><span></span><code>wine: Unhandled page fault on execute access to 0000000100003A20 at address 0000000100003A20 (thread 002b), starting debugger...
Unhandled exception: page fault on execute access to 0x100003a20 in 64-bit code (0x0000000100003a20).
Register dump:
 rip:0000000100003a20 rsp:000000000112f9f8 rbp:000000000112fa20 eflags:00010246 (  R- --  I  Z- -P- )
 rax:0000000000000001 rbx:0000000000000001 rcx:000000000000002a rdx:00000000011313f0
 rsi:00000000012d0810 rdi:0000000000000067  r8:00000000012d0810  r9:0000000000000020 r10:0000000000000003
 r11:0000000000000246 r12:0000000000000000 r13:0000000000000000 r14:00000000011313f0 r15:0000000000000001
</code></pre></div>
<p>which I'm pretty sure is because the function that the app is supposed to expose to the host is not hooked up correctly</p>



<a name="299472948"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Windows%20development/near/299472948" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Windows.20development.html#299472948">(Sep 18 2022 at 20:22)</a>:</h4>
<p>so it's trying to execute stuff on a page that is not executable</p>



<a name="299474856"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Windows%20development/near/299474856" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Windows.20development.html#299474856">(Sep 18 2022 at 20:52)</a>:</h4>
<p>does <a href="/user_uploads/22008/bII1RnQnDevFOoyOtCqb_MMD/hostapp.exe">hostapp.exe</a> do anything more interesting? based on the debugger it gets past the calls to our dynamic functions, but then runs into a page that is not marked as executable ?!</p>



<a name="299475432"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Windows%20development/near/299475432" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Carroll <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Windows.20development.html#299475432">(Sep 18 2022 at 21:00)</a>:</h4>
<p>No output at all but it returns an error code, which apparently you can retrieve by printing an env variable</p>
<div class="codehilite"><pre><span></span><code>C:\Users\Brian\Downloads&gt;.\hostapp.exe

C:\Users\Brian\Downloads&gt;echo %ERRORLEVEL%
-1073741819
</code></pre></div>



<a name="299475538"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Windows%20development/near/299475538" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Windows.20development.html#299475538">(Sep 18 2022 at 21:02)</a>:</h4>
<p>it is supposed to return a non-standard error code</p>



<a name="299475547"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Windows%20development/near/299475547" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Windows.20development.html#299475547">(Sep 18 2022 at 21:02)</a>:</h4>
<p>so I think that's good?</p>



<a name="299475609"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Windows%20development/near/299475609" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Windows.20development.html#299475609">(Sep 18 2022 at 21:04)</a>:</h4>
<p>it should return <code>192u8</code> though</p>



<a name="299475651"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Windows%20development/near/299475651" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Carroll <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Windows.20development.html#299475651">(Sep 18 2022 at 21:04)</a>:</h4>
<p>yeah that number is way too big I think</p>



<a name="299475708"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Windows%20development/near/299475708" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Windows.20development.html#299475708">(Sep 18 2022 at 21:05)</a>:</h4>
<p>not sure what the problem could be at this point though</p>



<a name="299476222"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Windows%20development/near/299476222" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Windows.20development.html#299476222">(Sep 18 2022 at 21:14)</a>:</h4>
<p>I guess this is where a debugger would be helpful?</p>



<a name="299476654"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Windows%20development/near/299476654" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Carroll <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Windows.20development.html#299476654">(Sep 18 2022 at 21:20)</a>:</h4>
<p>Yeah this runs in Visual Studio debugger, whereas app.exe didn't.</p>
<div class="codehilite"><pre><span></span><code>Exception thrown at 0x00007FF600001AA6 in hostapp.exe: 0xC0000005: Access violation executing location 0x00007FF600001AA6.
</code></pre></div>
<p>Call stack:</p>
<div class="codehilite"><pre><span></span><code>    Name    Language
    00007ff600001aa6()  Unknown
    hostapp.exe!00007ff61c7b1062()  Unknown
    hostapp.exe!00007ff61c7b146a()  Unknown
    hostapp.exe!00007ff61c7b14c6()  Unknown
    kernel32.dll!00007fff41e654e0() Unknown
    ntdll.dll!00007fff42e0485b()    Unknown
</code></pre></div>



<a name="299476669"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Windows%20development/near/299476669" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Carroll <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Windows.20development.html#299476669">(Sep 18 2022 at 21:20)</a>:</h4>
<p>So I guess there are no debug symbols in the file?</p>



<a name="299476747"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Windows%20development/near/299476747" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Windows.20development.html#299476747">(Sep 18 2022 at 21:22)</a>:</h4>
<p>right, I can add them add them though</p>



<a name="299476818"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Windows%20development/near/299476818" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Carroll <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Windows.20development.html#299476818">(Sep 18 2022 at 21:23)</a>:</h4>
<p>I can see the disassembly, and look at those locations in the call stack.<br>
the one where it throws only shows ??? for the disassembly but the other two in hostapp.exe look like normal x64 assembly code</p>



<a name="299476824"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Windows%20development/near/299476824" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Carroll <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Windows.20development.html#299476824">(Sep 18 2022 at 21:23)</a>:</h4>
<p>so I guess it jumped somewhere invalid</p>



<a name="299476929"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Windows%20development/near/299476929" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Windows.20development.html#299476929">(Sep 18 2022 at 21:25)</a>:</h4>
<p><a href="/user_uploads/22008/mxCjS9MnSLvzqjZ-YqO3r69b/hostapp.exe">hostapp.exe</a> </p>
<p>for me it now  shows</p>
<div class="codehilite"><pre><span></span><code>Segmentation fault at address 0x10005c3e6
???:?:?: 0x10005c3e6 in ??? (???)
/home/folkertdev/Downloads/zig-linux-x86_64-0.9.1/lib/std/start.zig:558:29: 0x1400039ee in std.start.callMain (host.obj)
thread 43 panic: reached unreachable code
/home/folkertdev/Downloads/zig-linux-x86_64-0.9.1/lib/std/os/windows.zig:114:33: 0x14003face in std.os.windows.OpenFile (host.obj)
Panicked during a panic. Aborting.
wine: Unhandled exception 0x80000003 in thread 2b at address 000000014000217A (thread 002b), starting debugger...
0x000000014000217a std.os.abort+0xa in hostapp: int $3
</code></pre></div>



<a name="299477254"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Windows%20development/near/299477254" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Carroll <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Windows.20development.html#299477254">(Sep 18 2022 at 21:30)</a>:</h4>
<p>In visual studio I get the same as before. Call stack is still hex addresses, not proper names.</p>



<a name="299477261"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Windows%20development/near/299477261" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Carroll <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Windows.20development.html#299477261">(Sep 18 2022 at 21:30)</a>:</h4>
<p>but call stack is now deeper</p>



<a name="299477284"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Windows%20development/near/299477284" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Carroll <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Windows.20development.html#299477284">(Sep 18 2022 at 21:31)</a>:</h4>
<p>6 hostapp frames instead of 3</p>



<a name="299477299"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Windows%20development/near/299477299" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Windows.20development.html#299477299">(Sep 18 2022 at 21:31)</a>:</h4>
<p>but, the problem to me seems to be outside of main</p>



<a name="299477406"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Windows%20development/near/299477406" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Windows.20development.html#299477406">(Sep 18 2022 at 21:33)</a>:</h4>
<p>these are the two calls to the linked-in functions</p>
<div class="codehilite"><pre><span></span><code>   140001ddc:   e8 87 f1 05 00          call   0x140060f68
   140001de1:   88 45 fd                mov    BYTE PTR [rbp-0x3],al
   140001de4:   31 c9                   xor    ecx,ecx
   140001de6:   e8 75 f1 05 00          call   0x140060f60
   140001deb:   88 c1                   mov    cl,al
   140001ded:   8a 45 fd                mov    al,BYTE PTR [rbp-0x3]
   140001df0:   00 c8                   add    al,cl
</code></pre></div>



<a name="299477663"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Windows%20development/near/299477663" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Windows.20development.html#299477663">(Sep 18 2022 at 21:37)</a>:</h4>
<p>hmm, <code>0x10005c3e6</code> is outside of the actual text section</p>



<a name="299477764"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Windows%20development/near/299477764" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Windows.20development.html#299477764">(Sep 18 2022 at 21:39)</a>:</h4>
<p>or is it?  I mean the address in <code>Segmentation fault at address 0x10005c3e6</code></p>
<div class="codehilite"><pre><span></span><code>SECTION HEADER #1
               .text name
               5bfda virtual size
                1000 virtual address
               5c000 size of raw data
                 400 file pointer to raw data
                   0 file pointer to relocation table
                   0 file pointer to line numbers
                   0 number of relocations
                   0 number of line numbers
            60000020 flags
                       CNT_CODE
                       MEM_EXECUTE
                       MEM_READ
</code></pre></div>



<a name="299477875"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Windows%20development/near/299477875" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Windows.20development.html#299477875">(Sep 18 2022 at 21:40)</a>:</h4>
<p>hmm that does not even make sense, because the whole app is loaded at <code>0x140000000</code></p>



<a name="299478594"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Windows%20development/near/299478594" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Windows.20development.html#299478594">(Sep 18 2022 at 21:52)</a>:</h4>
<p>ah, progress. There is a problem with calling the functions that originally came from the dynamic lib. When I add a branch (switching on a random number to fool the optimizer) and the functions are not called, the program runs correctly</p>



<a name="299478610"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Windows%20development/near/299478610" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Windows.20development.html#299478610">(Sep 18 2022 at 21:52)</a>:</h4>
<p>so it must be that I don't actually understand (fully) how to fix the calls</p>



<a name="299518779"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Windows%20development/near/299518779" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Windows.20development.html#299518779">(Sep 19 2022 at 08:01)</a>:</h4>
<p>I got this to work</p>
<div class="codehilite"><pre><span></span><code>&gt; wine64 hostapp.exe
Hello, 42!
</code></pre></div>

<p>it links these zig objects</p>
<div class="codehilite" data-code-language="Zig"><pre><span></span><code><span class="c1">// host</span>
<span class="kr">const</span><span class="w"> </span><span class="n">std</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">@import</span><span class="p">(</span><span class="s">"std"</span><span class="p">);</span><span class="w"></span>

<span class="kr">extern</span><span class="w"> </span><span class="k">fn</span><span class="w"> </span><span class="n">double</span><span class="p">()</span><span class="w"> </span><span class="n">callconv</span><span class="p">(.</span><span class="n">C</span><span class="p">)</span><span class="w"> </span><span class="kt">u64</span><span class="p">;</span><span class="w"></span>

<span class="kr">pub</span><span class="w"> </span><span class="k">fn</span><span class="w"> </span><span class="n">main</span><span class="p">()</span><span class="w"> </span><span class="o">!</span><span class="kt">void</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kr">const</span><span class="w"> </span><span class="n">stdout</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="p">.</span><span class="n">io</span><span class="p">.</span><span class="n">getStdOut</span><span class="p">().</span><span class="n">writer</span><span class="p">();</span><span class="w"></span>
<span class="w">    </span><span class="k">try</span><span class="w"> </span><span class="n">stdout</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">"Hello, {}!</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span><span class="w"> </span><span class="p">.{</span><span class="n">double</span><span class="p">()});</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>
<div class="codehilite" data-code-language="Zig"><pre><span></span><code><span class="c1">// app</span>
<span class="kr">export</span><span class="w"> </span><span class="k">fn</span><span class="w"> </span><span class="n">double</span><span class="p">()</span><span class="w"> </span><span class="kt">u64</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">42</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>
<p>with the surgical linking approach and IT WORKS!</p>



<a name="299520124"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Windows%20development/near/299520124" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Windows.20development.html#299520124">(Sep 19 2022 at 08:10)</a>:</h4>
<p>(the only cheaty bit is that I copied the app assembly manually, but that is acceptable for now I think)</p>



<a name="299525534"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Windows%20development/near/299525534" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Windows.20development.html#299525534">(Sep 19 2022 at 08:53)</a>:</h4>
<p>code <a href="https://github.com/roc-lang/roc/pull/4065">https://github.com/roc-lang/roc/pull/4065</a></p>



<a name="299570506"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Windows%20development/near/299570506" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Windows.20development.html#299570506">(Sep 19 2022 at 14:01)</a>:</h4>
<p>wooooooooo!!!!!!</p>



<a name="301742734"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Windows%20development/near/301742734" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Windows.20development.html#301742734">(Sep 30 2022 at 22:16)</a>:</h4>
<p>I'm hitting </p>
<div class="codehilite"><pre><span></span><code>warning: `roc_linker` (lib) generated 2 warnings
    Finished dev [unoptimized + debuginfo] target(s) in 1.65s
     Running `target\debug\roc.exe .\examples\platform-switching\rocLovesZig.roc`
🔨 Rebuilding platform...
warning: ignoring debug info with an invalid version (0) in app
thread &#39;&lt;unnamed&gt;&#39; panicked at &#39;Failed to rebuild host.zig - stderr of the `zig` command was:
error(compilation): clang failed with stderr: zig: error: unable to make temporary file: No such file or directory

error(compilation): clang failed with stderr: zig: error: unable to make temporary file: No such file or directory

error(compilation): clang failed with stderr: zig: error: unable to make temporary file: No such file or directory
...
error(compilation): C:\Users\folkert\Downloads\zig-windows-x86_64-0.9.1\lib\libc\mingw\math\x86\remquo.S:1:1: unable to build C object: clang exit
ed with code 1
error(compilation): C:\Users\folkert\Downloads\zig-windows-x86_64-0.9.1\lib\libc\mingw\math\x86\truncf.S:1:1: unable to build C object: clang exit
ed with code 1
</code></pre></div>
<p>on windows. It feels familiar, but I don't remember how to fix it</p>



<a name="301746105"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Windows%20development/near/301746105" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Windows.20development.html#301746105">(Sep 30 2022 at 22:45)</a>:</h4>
<p>Something with the zig cache folder?</p>



<a name="304805981"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Windows%20development/near/304805981" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Windows.20development.html#304805981">(Oct 18 2022 at 17:50)</a>:</h4>
<p>Could someone on windows run on the <code>refine-relocation-location</code> branch</p>
<div class="codehilite"><pre><span></span><code>cargo run -- --linker=surgical crates/cli_testing_examples/platform-switching/rocLovesZig.roc
</code></pre></div>

<p>I _think_ this should work. On my machine using this <code>cargo run</code> fails, but manually running the produced executable succeeds.</p>
<p>I get a mingw error here </p>
<p><a href="https://github.com/Alexpux/mingw-w64/blob/master/mingw-w64-crt/crt/pseudo-reloc.c#L195">https://github.com/Alexpux/mingw-w64/blob/master/mingw-w64-crt/crt/pseudo-reloc.c#L195</a></p>
<p>this is very odd, maybe something is wrong with the <code>memexec</code> crate but <span class="user-mention" data-user-id="431893">@Brian Carroll</span>  and I verified on one point that it worked on his machine.</p>



<a name="304806707"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Windows%20development/near/304806707" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Windows.20development.html#304806707">(Oct 18 2022 at 17:54)</a>:</h4>
<p>it does actually work when you explicitly pass <code>--linker=legacy</code>, so I guess there is still a bug in the surgical linker somewhere that neither wine nor a windows shell catches, but mingw does</p>



<a name="304809644"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Windows%20development/near/304809644" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Carroll <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Windows.20development.html#304809644">(Oct 18 2022 at 18:11)</a>:</h4>
<p>I will run it on my machine later, but need to go out for a couple of hours now.</p>



<a name="304827795"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Windows%20development/near/304827795" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Windows.20development.html#304827795">(Oct 18 2022 at 19:40)</a>:</h4>
<p>I get this error when I run it. <a href="https://gist.github.com/lukewilliamboswell/73b63b05c2d9c4387ff79f10d1440000">error.log</a></p>



<a name="304841581"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Windows%20development/near/304841581" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Windows.20development.html#304841581">(Oct 18 2022 at 21:11)</a>:</h4>
<p>hmm, yes, can you try commenting this <code>-fPIE</code> line?</p>
<div class="codehilite"><pre><span></span><code>    if let Some(shared_lib_path) = shared_lib_path {
        command.args(&amp;[
            &quot;build-exe&quot;,
            // &quot;-fPIE&quot;, PIE seems to fail on windows
</code></pre></div>
<p>in <code>crates/compiler/build/src/link.rs</code></p>



<a name="304841636"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Windows%20development/near/304841636" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Windows.20development.html#304841636">(Oct 18 2022 at 21:11)</a>:</h4>
<p>I'm pretty sure <code>PIE</code> is just not a thing on windows, the C compiler just won't do it</p>



<a name="304843563"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Windows%20development/near/304843563" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Carroll <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Windows.20development.html#304843563">(Oct 18 2022 at 21:27)</a>:</h4>
<p>Even without PIE, I still get</p>
<div class="codehilite"><pre><span></span><code>&#39;called `Result::unwrap()` on an `Err` value: Any { .. }&#39;, crates\cli\src\build.rs:307:46
</code></pre></div>



<a name="304843648"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Windows%20development/near/304843648" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Carroll <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Windows.20development.html#304843648">(Oct 18 2022 at 21:27)</a>:</h4>
<p>As well as the <code>-fPIE</code> I also tried getting rid of <code>-pie</code>, which could be unrelated and just sound similar! But same panic.</p>



<a name="304844597"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Windows%20development/near/304844597" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Carroll <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Windows.20development.html#304844597">(Oct 18 2022 at 21:34)</a>:</h4>
<p>Yeah from Googling around it seems that Windows achieves position independence by doing relocations when the executable is loaded.</p>



<a name="304844745"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Windows%20development/near/304844745" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Windows.20development.html#304844745">(Oct 18 2022 at 21:35)</a>:</h4>
<p>FYI <code>cargo build --release --locked</code> works now and gives me a working <code>roc</code>.</p>



<a name="304845192"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Windows%20development/near/304845192" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Windows.20development.html#304845192">(Oct 18 2022 at 21:39)</a>:</h4>
<p>I'm not sure if that is revelant information, but trying to use <code>roc run</code> on <code>helloWorld.roc</code> gives me this <a href="https://gist.github.com/lukewilliamboswell/054cf640b5d28fcf8e9b4ea3ec41eb9c">error.log gist</a></p>



<a name="304846569"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Windows%20development/near/304846569" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Windows.20development.html#304846569">(Oct 18 2022 at 21:49)</a>:</h4>
<p><code>roc repl</code> seems to be working ok.<br>
<a href="/user_uploads/22008/B-2bn96TZUPapOfOHWgpYG4J/Screenshot-2022-10-19-084846.jpg">Screenshot-2022-10-19-084846.jpg</a></p>
<div class="message_inline_image"><a href="/user_uploads/22008/B-2bn96TZUPapOfOHWgpYG4J/Screenshot-2022-10-19-084846.jpg" title="Screenshot-2022-10-19-084846.jpg"><img src="/user_uploads/22008/B-2bn96TZUPapOfOHWgpYG4J/Screenshot-2022-10-19-084846.jpg"></a></div>



<a name="304849429"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Windows%20development/near/304849429" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Windows.20development.html#304849429">(Oct 18 2022 at 22:10)</a>:</h4>
<p>only zig platforms would work right now</p>



<a name="304849506"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Windows%20development/near/304849506" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Windows.20development.html#304849506">(Oct 18 2022 at 22:11)</a>:</h4>
<p>for rust I think we'd need some compiler infra (cause some C is involved there), but also the cli platform is not currently written to be usable on windows, so that would need some work I'd guess (don't know how platform-specific it really is)</p>



<a name="304849640"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Windows%20development/near/304849640" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Windows.20development.html#304849640">(Oct 18 2022 at 22:12)</a>:</h4>
<p><span class="user-mention" data-user-id="431893">@Brian Carroll</span> does it now show more than that? that panic is when the host rebuild thread failed, that is a weird error in this case</p>



<a name="304849816"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Windows%20development/near/304849816" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Windows.20development.html#304849816">(Oct 18 2022 at 22:13)</a>:</h4>
<p>and the problem I was having indeed seems like something with program loading that mingw does not do in my case. I suspect something in the binary is not quite right for that to work. But it does work in wine/powershell so most of the structure of the binary is correct</p>



<a name="304888895"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Windows%20development/near/304888895" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Carroll <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Windows.20development.html#304888895">(Oct 19 2022 at 06:42)</a>:</h4>
<p><span class="user-mention silent" data-user-id="281543">Folkert de Vries</span> <a href="#narrow/stream/316715-contributing/topic/Windows.20development/near/304849640">said</a>:</p>
<blockquote>
<p><span class="user-mention silent" data-user-id="431893">Brian Carroll</span> does it now show more than that? that panic is when the host rebuild thread failed, that is a weird error in this case</p>
</blockquote>
<p>Yeah tons more. I skipped as I thought it was the same as others had posted but apparently it's not. The first few lines mention a directory that doesn't exist, that Zig seems to be trying to write a temporary file into. But I don't know where that would be. Maybe the zig cache?<br>
<a href="/user_uploads/22008/K5WnOjZqfMy9XoMPwYyMQCAM/errors.tmp">errors.tmp</a></p>



<a name="304890811"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Windows%20development/near/304890811" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Carroll <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Windows.20development.html#304890811">(Oct 19 2022 at 06:59)</a>:</h4>
<p>No, if I delete <code>crates\cli_testing_examples\platform-switching\zig-platform\zig-cache</code> and rerun the <code>cargo run</code> command, it is recreated with stuff inside it.</p>



<a name="304918862"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Windows%20development/near/304918862" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Windows.20development.html#304918862">(Oct 19 2022 at 10:12)</a>:</h4>
<p>yes this is because of that <code>-fPIE</code> flag</p>



<a name="304918923"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Windows%20development/near/304918923" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Windows.20development.html#304918923">(Oct 19 2022 at 10:12)</a>:</h4>
<p>or it should be... it is for me</p>



<a name="304941718"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Windows%20development/near/304941718" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Carroll <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Windows.20development.html#304941718">(Oct 19 2022 at 12:29)</a>:</h4>
<p>Hmmm... I'm on your branch, which has that commented out already, but I still get the error.<br>
Here is the output of <code>dbg!(&amp;command)</code>. You can see there is no <code>-fPIE</code>.</p>
<div class="codehilite"><pre><span></span><code>[crates\compiler\build\src\link.rs:236] &amp;command = &quot;zig&quot; &quot;build-exe&quot; &quot;crates\\cli_testing_examples\\platform-switching\\zig-platform\\libapp.obj&quot; &quot;C:\\Users\\Brian\\Documents\\GitHub\\roc\\target\\debug\\lib\\builtins-windows-x86_64.obj&quot; &quot;crates\\cli_testing_examples\\platform-switching\\zig-platform\\host.zig&quot; &quot;-femit-bin=crates\\cli_testing_examples\\platform-switching\\zig-platform\\dynhost.exe&quot; &quot;--pkg-begin&quot; &quot;str&quot; &quot;C:\\Users\\Brian\\Documents\\GitHub\\roc\\target\\debug\\lib\\str.zig&quot; &quot;--pkg-end&quot; &quot;--library&quot; &quot;c&quot; &quot;-dynamic&quot; &quot;-target&quot; &quot;x86_64-windows-gnu&quot;
</code></pre></div>



<a name="304946023"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Windows%20development/near/304946023" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Windows.20development.html#304946023">(Oct 19 2022 at 12:38)</a>:</h4>
<p>hmm, that is very strange</p>



<a name="304946124"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Windows%20development/near/304946124" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Windows.20development.html#304946124">(Oct 19 2022 at 12:39)</a>:</h4>
<p>and I guess using <code>roc build</code> instead produces the same thing?</p>



<a name="304946676"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Windows%20development/near/304946676" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Carroll <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Windows.20development.html#304946676">(Oct 19 2022 at 12:42)</a>:</h4>
<p>yes</p>



<a name="304947482"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Windows%20development/near/304947482" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Windows.20development.html#304947482">(Oct 19 2022 at 12:46)</a>:</h4>
<p>so what if you just run the zig command, that still fails?</p>



<a name="304947513"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Windows%20development/near/304947513" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Windows.20development.html#304947513">(Oct 19 2022 at 12:46)</a>:</h4>
<p>in your own shell I mean</p>



<a name="305007540"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Windows%20development/near/305007540" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Carroll <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Windows.20development.html#305007540">(Oct 19 2022 at 17:38)</a>:</h4>
<p>That works yeah! I had to put quotes around the path to <code>dynhost.exe</code> but when I did, no crash output</p>
<div class="codehilite"><pre><span></span><code>zig build-exe crates\cli_testing_examples\platform-switching\zig-platform\libapp.obj C:\Users\Brian\Documents\GitHub\roc\target\debug\lib\builtins-windows-x86_64.obj crates\cli_testing_examples\platform-switching\zig-platform\host.zig -femit-bin=&quot;crates\cli_testing_examples\platform-switching\zig-platform\dynhost.exe&quot; --pkg-begin str C:\Users\Brian\Documents\GitHub\roc\target\debug\lib\str.zig --pkg-end --library c -dynamic -target x86_64-windows-gnu
</code></pre></div>



<a name="305008108"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Windows%20development/near/305008108" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Windows.20development.html#305008108">(Oct 19 2022 at 17:41)</a>:</h4>
<p>so, the way we build up the <code>Command</code> is the problem here? can you play around with that a bit maybe?</p>



<a name="305039613"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Windows%20development/near/305039613" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Carroll <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Windows.20development.html#305039613">(Oct 19 2022 at 20:47)</a>:</h4>
<p>Ok. I can have a look tomorrow morning</p>



<a name="305084449"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Windows%20development/near/305084449" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Carroll <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Windows.20development.html#305084449">(Oct 20 2022 at 06:03)</a>:</h4>
<p>I don't think it's about how we build the command. I got it to work once and now it works every time. It's like some file or directory was created and now that it's there, everything is fine. But I don't know where! I have tried deleting libapp.obj and dynhost.exe but it still works fine.</p>



<a name="305084468"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Windows%20development/near/305084468" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Carroll <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Windows.20development.html#305084468">(Oct 20 2022 at 06:03)</a>:</h4>
<p>The original error mentioned something about Zig trying to write a temporary file somewhere so I also deleted the zig-cache but that didn't reproduce the error either</p>



<a name="305084849"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Windows%20development/near/305084849" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Carroll <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Windows.20development.html#305084849">(Oct 20 2022 at 06:06)</a>:</h4>
<p>OK if I delete Zig's global cache dir and retry the <code>cargo run</code> command, it crashes.</p>



<a name="305084969"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Windows%20development/near/305084969" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Carroll <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Windows.20development.html#305084969">(Oct 20 2022 at 06:07)</a>:</h4>
<p>I found and deleted it like this:</p>
<div class="codehilite"><pre><span></span><code>PS C:\Users\Brian&gt; zig env
{
 &quot;zig_exe&quot;: &quot;C:\\Users\\Brian\\zig-windows-x86_64-0.9.1\\zig.exe&quot;,
 &quot;lib_dir&quot;: &quot;C:\\Users\\Brian\\zig-windows-x86_64-0.9.1\\lib&quot;,
 &quot;std_dir&quot;: &quot;C:\\Users\\Brian\\zig-windows-x86_64-0.9.1\\lib\\std&quot;,
 &quot;global_cache_dir&quot;: &quot;C:\\Users\\Brian\\AppData\\Local\\zig&quot;,
 &quot;version&quot;: &quot;0.9.1&quot;
}
PS C:\Users\Brian&gt; del &quot;C:\\Users\\Brian\\AppData\\Local\\zig&quot;
</code></pre></div>



<a name="305090391"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Windows%20development/near/305090391" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Windows.20development.html#305090391">(Oct 20 2022 at 07:01)</a>:</h4>
<p>ok, that's wild</p>



<a name="305090430"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Windows%20development/near/305090430" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Windows.20development.html#305090430">(Oct 20 2022 at 07:01)</a>:</h4>
<p>and then adding some quotes to the command somehow fixes that?</p>



<a name="305090475"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Windows%20development/near/305090475" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Windows.20development.html#305090475">(Oct 20 2022 at 07:01)</a>:</h4>
<p>btw when it works, what does <code>roc run</code> do?</p>



<a name="305113071"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Windows%20development/near/305113071" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Carroll <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Windows.20development.html#305113071">(Oct 20 2022 at 09:45)</a>:</h4>
<p>No, when I let Rust do the command there is never any issue with quotes. Only when I manually enter the command into PowerShell I need to quote the dynhost.exe path or it gets upset about the <code>.exe</code>.<br>
So I think we can forget about the quotes issue.</p>



<a name="305113294"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Windows%20development/near/305113294" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Carroll <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Windows.20development.html#305113294">(Oct 20 2022 at 09:47)</a>:</h4>
<p>If you delete the zig global cache do you see the same thing?</p>



<a name="305114886"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Windows%20development/near/305114886" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Windows.20development.html#305114886">(Oct 20 2022 at 09:57)</a>:</h4>
<p>yes, actually</p>



<a name="305114948"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Windows%20development/near/305114948" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Windows.20development.html#305114948">(Oct 20 2022 at 09:57)</a>:</h4>
<p>so the way to fix that is to run in your own shell literally the thing that the rust program runs, and then it works?!</p>



<a name="305126778"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Windows%20development/near/305126778" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Carroll <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Windows.20development.html#305126778">(Oct 20 2022 at 11:04)</a>:</h4>
<p>Apparently, yeah! Not the slickest solution <span aria-label="joy" class="emoji emoji-1f602" role="img" title="joy">:joy:</span></p>



<a name="305126851"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Windows%20development/near/305126851" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Carroll <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Windows.20development.html#305126851">(Oct 20 2022 at 11:05)</a>:</h4>
<p>I wonder if there's some environment variables that are different when Rust runs it</p>



<a name="305129807"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Windows%20development/near/305129807" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Windows.20development.html#305129807">(Oct 20 2022 at 11:26)</a>:</h4>
<p>could it be the same mingw thing?</p>



<a name="305208190"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Windows%20development/near/305208190" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Windows.20development.html#305208190">(Oct 20 2022 at 18:05)</a>:</h4>
<p>hmm, running the zig command by itself does not fix compilation for me. That's unfortunate because now nothing works...</p>



<a name="305208237"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Windows%20development/near/305208237" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Windows.20development.html#305208237">(Oct 20 2022 at 18:05)</a>:</h4>
<p>in fact, the zig just errors because it can't find certain dlls</p>



<a name="305343614"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Windows%20development/near/305343614" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Windows.20development.html#305343614">(Oct 21 2022 at 12:36)</a>:</h4>
<p>I think I figured out the cause: the local <code>zig-cache</code> and the global one got out of sync.</p>



<a name="305343638"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Windows%20development/near/305343638" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Windows.20development.html#305343638">(Oct 21 2022 at 12:36)</a>:</h4>
<p>which you can fix by removing both and then re-building</p>



<a name="305343737"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Windows%20development/near/305343737" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Windows.20development.html#305343737">(Oct 21 2022 at 12:37)</a>:</h4>
<p>so idk, maybe either one of them got corrupted on your system (maybe using a newer/older zig version?) and then you get that error</p>



<a name="309048640"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Windows%20development/near/309048640" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Windows.20development.html#309048640">(Nov 10 2022 at 18:15)</a>:</h4>
<p>does someone know how to get the equivalent of <code>~/.cargo</code> on windows? I tried some stuff with <code>%HOMEPATH%</code> but that does not get expanded</p>



<a name="309049898"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Windows%20development/near/309049898" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Carroll <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Windows.20development.html#309049898">(Nov 10 2022 at 18:21)</a>:</h4>
<p>Try <code>%APPDATA%</code>. I think it usually expands to <code>c:\Users\Username\Appdata\Roaming</code></p>



<a name="309127860"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Windows%20development/near/309127860" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Salman Shaik <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Windows.20development.html#309127860">(Nov 11 2022 at 04:30)</a>:</h4>
<p>$home</p>



<a name="309272580"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Windows%20development/near/309272580" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Windows.20development.html#309272580">(Nov 11 2022 at 23:17)</a>:</h4>
<p>how do I remove this prefix here</p>
<div class="codehilite"><pre><span></span><code>use std::path::Path;

fn main() {
  let path = Path::new(&quot;\\\\?\\C:\\Users\\folkert\\Documents\\GitHub\\roc\\target\\debug\\roc.exe&quot;);

dbg!(path.starts_with(&quot;\\\\?\\&quot;));

}
</code></pre></div>
<p>paths on windows: maddening</p>



<a name="309272588"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Windows%20development/near/309272588" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Windows.20development.html#309272588">(Nov 11 2022 at 23:17)</a>:</h4>
<p>that debug print returns false by the way</p>



<a name="309272753"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Windows%20development/near/309272753" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Windows.20development.html#309272753">(Nov 11 2022 at 23:19)</a>:</h4>
<p>because the fun thing is, such paths don't actually work in powershell</p>



<a name="309273214"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Windows%20development/near/309273214" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Windows.20development.html#309273214">(Nov 11 2022 at 23:25)</a>:</h4>
<p>seems like there is just no good way to do this? <a href="https://stackoverflow.com/questions/50322817/how-do-i-remove-the-prefix-from-a-canonical-windows-path">https://stackoverflow.com/questions/50322817/how-do-i-remove-the-prefix-from-a-canonical-windows-path</a></p>



<a name="309273346"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Windows%20development/near/309273346" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Windows.20development.html#309273346">(Nov 11 2022 at 23:27)</a>:</h4>
<p><span class="user-mention" data-user-id="361169">@Anton</span> this breaks any use of the <code>utils::get_lib_path</code> function, because these paths are just unusable when doing a <code>Command</code></p>



<a name="309275077"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Windows%20development/near/309275077" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Windows.20development.html#309275077">(Nov 11 2022 at 23:51)</a>:</h4>
<p>I have a super hacky fix here <a href="https://github.com/roc-lang/roc/compare/csv-parser-zig">https://github.com/roc-lang/roc/compare/csv-parser-zig</a></p>



<a name="490265997"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Windows%20development/near/490265997" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Windows.20development.html#490265997">(Dec 21 2024 at 04:34)</a>:</h4>
<p><span class="user-mention" data-user-id="343810">@Brendan Hansknecht</span> or anyone... </p>
<p>Just testing a new build of Windows and have discovered that building with <code>--optimize</code> is now failing with non-zero exit code. Did we make any changes that might be related? </p>
<p>I'm guessing the llvm-zig upgrade is up there as a candidate. I don't suppose anyone else is using Windows and would have noticed.</p>
<div class="codehilite"><pre><span></span><code>PS C:\Users\bosyl\Documents\GitHub\roc-ray&gt; .\windows\bin\roc.exe build --no-link --output=app.obj .\examples\basic-shapes.roc
0 errors and 0 warnings found in 535 ms while successfully building:

    app.obj
PS C:\Users\bosyl\Documents\GitHub\roc-ray&gt; .\windows\bin\roc.exe build --no-link --optimize --output=app.obj .\examples\basic-shapes.roc
</code></pre></div>



<a name="490270778"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Windows%20development/near/490270778" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Windows.20development.html#490270778">(Dec 21 2024 at 06:00)</a>:</h4>
<p>Yeah, I would guess the zig and llvm upgrade</p>



<hr><p>Last updated: Mar 01 2026 at 12:20 UTC</p>
</html>