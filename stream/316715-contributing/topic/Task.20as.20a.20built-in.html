<html>
<head><meta charset="utf-8"><title>Task as a built-in · contributing · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/index.html">contributing</a></h2>
<h3>Topic: <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Task.20as.20a.20built-in.html">Task as a built-in</a></h3>

<hr>

<base href="https://roc.zulipchat.com">

<head><link href="https://roc-lang.github.io/zulip-export/style.css" rel="stylesheet"></head>

<a name="446329116"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Task%20as%20a%20built-in/near/446329116" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Task.20as.20a.20built-in.html#446329116">(Jun 22 2024 at 21:40)</a>:</h4>
<p>Bit of an insane question, but is implementing Task as a built-in currently possible, but not implemented? It seems like once that and module params are implemented, the ecosystem is now able to share effectful code through pure Roc packages. If it's possible, would someone be able to help me enumerate the work required to implement it? If not, what's blocking it?</p>



<a name="446329321"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Task%20as%20a%20built-in/near/446329321" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Agus Zubiaga <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Task.20as.20a.20built-in.html#446329321">(Jun 22 2024 at 21:41)</a>:</h4>
<p>I don't think it's blocked really. In fact, I think <span class="user-mention" data-user-id="611722">@Isaac Van Doren</span> had already started looking into it.</p>



<a name="446329465"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Task%20as%20a%20built-in/near/446329465" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Agus Zubiaga <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Task.20as.20a.20built-in.html#446329465">(Jun 22 2024 at 21:43)</a>:</h4>
<p><a href="#narrow/stream/395097-compiler-development/topic/Task.20as.20builtin/near/444132539">https://roc.zulipchat.com/#narrow/stream/395097-compiler-development/topic/Task.20as.20builtin/near/444132539</a></p>



<a name="446329701"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Task%20as%20a%20built-in/near/446329701" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Task.20as.20a.20built-in.html#446329701">(Jun 22 2024 at 21:45)</a>:</h4>
<p>Oh, nice! I forgot about this. I didn't see anything on <span class="user-mention" data-user-id="611722">@Isaac Van Doren</span> 's fork/branches, but I'd love to work with him if possible on implementing it</p>



<a name="446330459"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Task%20as%20a%20built-in/near/446330459" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Task.20as.20a.20built-in.html#446330459">(Jun 22 2024 at 21:54)</a>:</h4>
<p>Yeah not blocked, would be a massive benefit to have it <span aria-label="partying face" class="emoji emoji-1f973" role="img" title="partying face">:partying_face:</span></p>



<a name="446330479"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Task%20as%20a%20built-in/near/446330479" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Task.20as.20a.20built-in.html#446330479">(Jun 22 2024 at 21:54)</a>:</h4>
<p>My thoughts exactly</p>



<a name="446336794"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Task%20as%20a%20built-in/near/446336794" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Isaac Van Doren <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Task.20as.20a.20built-in.html#446336794">(Jun 22 2024 at 22:26)</a>:</h4>
<p><span class="user-mention" data-user-id="461444">@Sam Mohr</span> I haven’t made much progress so you’re welcome to start a branch! I’d be happy to collaborate also if it makes sense to.</p>
<p>We need the functions generated for the hosted module in the platform (defined in <a href="http://effect_module.rs">effect_module.rs</a>) to implement the task module in the builtins. I’m not sure how to go about exposing these functions to the builtins. Maybe they need to be rewritten in Zig?</p>



<a name="446339806"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Task%20as%20a%20built-in/near/446339806" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Task.20as.20a.20built-in.html#446339806">(Jun 22 2024 at 22:57)</a>:</h4>
<p>Yes, I'd expect as much, though we'll have to see when it gets written</p>



<a name="446339897"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Task%20as%20a%20built-in/near/446339897" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Task.20as.20a.20built-in.html#446339897">(Jun 22 2024 at 22:58)</a>:</h4>
<p>I'll look into it tomorrow and see what I find</p>



<a name="446339906"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Task%20as%20a%20built-in/near/446339906" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Task.20as.20a.20built-in.html#446339906">(Jun 22 2024 at 22:58)</a>:</h4>
<p>Thanks for the tip!</p>



<a name="446339928"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Task%20as%20a%20built-in/near/446339928" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Isaac Van Doren <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Task.20as.20a.20built-in.html#446339928">(Jun 22 2024 at 22:58)</a>:</h4>
<p>Sounds good!</p>



<a name="446709088"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Task%20as%20a%20built-in/near/446709088" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Task.20as.20a.20built-in.html#446709088">(Jun 24 2024 at 20:22)</a>:</h4>
<p>I've made good progress on the built-in Task implementation, which mainly has involved copying the <code>Task</code> module from <code>basic-cli</code> to <code>crates/compiler/builtins/roc/Task.roc</code>. Just to make sure I'm on the right path:</p>
<ul>
<li>I removed <code>Effect</code> and <code>InternalTask</code>, and now only <code>Task</code> remains. I implemented it as <code>Effect</code> was implemented, which means <code>Task := {} -&gt; Result ok err</code>.</li>
<li>I renamed <code>effect_module.rs</code> to <code>task_module.rs</code> and now for all foreign function definitions in the hosted module, I'm expecting them to return <code>Task</code> instead of <code>Effect</code></li>
<li>I am no longer generating the <code>Effect.after</code>, <code>Effect.always</code>, etc. because they acted as a bridge to <code>Task</code> that's no longer needed if it's in the std library (so I removed those functions)<ul>
<li>Since we don't need these functions, I removed the <code>generates Effect with [...]</code> section from our syntax and our codegen. We already have to update all hosted modules anyway to return <code>Task</code>s instead, so breaking their parsing doesn't seem too crazy.</li>
</ul>
</li>
<li>After work today, I'm going to work on converting <code>basic-cli</code> to return <code>Task</code>s instead, and if that works, then I'll add testing and then release at least a draft PR</li>
</ul>
<p>Does anyone disagree with this game plan? It might be too much for one PR (ignoring the PRs for the platforms), which would mean I will try to break up into multiple PR's, but otherwise this isn't that bad of a change to make since all of the infrastructure is already there.</p>



<a name="446713645"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Task%20as%20a%20built-in/near/446713645" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Task.20as.20a.20built-in.html#446713645">(Jun 24 2024 at 20:39)</a>:</h4>
<p>Sounds great. I'm happy to hack away on platforms and stage PRs when we're ready.</p>



<a name="446714261"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Task%20as%20a%20built-in/near/446714261" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Task.20as.20a.20built-in.html#446714261">(Jun 24 2024 at 20:42)</a>:</h4>
<p>If you're bored, you could start making PR's per platform now that declare <code>Task</code>s instead of <code>Effect</code>s for the FFI, but I'd recommend waiting until I test <code>basic-cli</code> integration just in case, so you don't waste your time</p>



<a name="446717266"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Task%20as%20a%20built-in/near/446717266" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Task.20as.20a.20built-in.html#446717266">(Jun 24 2024 at 20:58)</a>:</h4>
<p>Also, do we have a name we're considering for the hosted module instead of <code>Effect</code>? It seems like <code>PlatformTask</code> is a good name to imply that these are tasks that come from the platform. That's what I'm going to go with in the meantime</p>



<a name="446717290"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Task%20as%20a%20built-in/near/446717290" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Task.20as.20a.20built-in.html#446717290">(Jun 24 2024 at 20:58)</a>:</h4>
<p>It's a fair amount of work to make a change like this and I can chip in a little. </p>
<p>I'll wait until there's an E2E example, that will be a good point to replicate.</p>



<a name="446767915"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Task%20as%20a%20built-in/near/446767915" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ayaz Hafiz <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Task.20as.20a.20built-in.html#446767915">(Jun 25 2024 at 03:28)</a>:</h4>
<p>This sounds fine, I think lumping in one PR is fine. Landing this sooner is a good idea</p>



<a name="446768025"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Task%20as%20a%20built-in/near/446768025" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ayaz Hafiz <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Task.20as.20a.20built-in.html#446768025">(Jun 25 2024 at 03:29)</a>:</h4>
<p>is there any reason for hosted modules in the long term? i understand the need in the interim and any name seems fine, but I think there is no need to have hosted modules at all once this work is completed.</p>



<a name="446768416"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Task%20as%20a%20built-in/near/446768416" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Task.20as.20a.20built-in.html#446768416">(Jun 25 2024 at 03:32)</a>:</h4>
<p>Yeah, the suggestion from Richard was to use module params to declare the FFI (I think), rendering hosted module no longer needed</p>



<a name="446768476"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Task%20as%20a%20built-in/near/446768476" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ayaz Hafiz <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Task.20as.20a.20built-in.html#446768476">(Jun 25 2024 at 03:33)</a>:</h4>
<p>right, understood, thank you</p>



<a name="446768478"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Task%20as%20a%20built-in/near/446768478" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Task.20as.20a.20built-in.html#446768478">(Jun 25 2024 at 03:33)</a>:</h4>
<p>So I can't do it in the PR, but it'll be a welcome change.</p>



<a name="446768506"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Task%20as%20a%20built-in/near/446768506" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Task.20as.20a.20built-in.html#446768506">(Jun 25 2024 at 03:33)</a>:</h4>
<p>Should also be pretty easy since everything will already be changed to Tasks</p>



<a name="446801678"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Task%20as%20a%20built-in/near/446801678" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Task.20as.20a.20built-in.html#446801678">(Jun 25 2024 at 07:45)</a>:</h4>
<p>I have created two PRs, the <a href="https://github.com/roc-lang/roc/pull/6836">main one</a> in the language repo, and a <a href="https://github.com/roc-lang/basic-cli/pull/217">basic-cli</a> one as a platform update demo. They are both in draft mode because pretty much all of the implementation work is done, but I am running into a couple issues. The main one is that Roc says the inferred types of our generated FFI function bodies don't match their type definitions for the <code>Task</code> return types:</p>
<div class="codehilite"><pre><span></span><code>── TYPE MISMATCH in examples/cli/false-interpreter/platform/PlatformTask.roc ───

Something is off with the body of the getLine definition:




This Task.Task opaque wrapping has the type:

    Task *

But the type annotation on getLine says it should be:

    Task Str
</code></pre></div>
<p>If anyone has time to look at what the issue is (I expect it's in the newly-renamed <a href="https://github.com/roc-lang/roc/blob/700c7ae9aa3f9642857b9281da726ec93ae2cf71/crates/compiler/can/src/task_module.rs">task_module.rs</a>, which should be returning a manually-built <code>Task {} -&gt; Result ok err</code> but obviously something is wrong), that would be appreciated.</p>



<a name="446801879"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Task%20as%20a%20built-in/near/446801879" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Task.20as.20a.20built-in.html#446801879">(Jun 25 2024 at 07:46)</a>:</h4>
<p>The PR for the language looks very big, and that's because it is, but it includes a lot of minor file reformats from the new module syntax, so it's a little inflated</p>



<a name="446803834"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Task%20as%20a%20built-in/near/446803834" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Task.20as.20a.20built-in.html#446803834">(Jun 25 2024 at 07:57)</a>:</h4>
<p>And again, I'm happy to split this up, but for now I just wanted to get it into a draft PR so that someone else could run it if they wanted to</p>



<a name="446804148"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Task%20as%20a%20built-in/near/446804148" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Task.20as.20a.20built-in.html#446804148">(Jun 25 2024 at 07:59)</a>:</h4>
<p>Here's the command I ran for the above output: <code>cargo run --bin roc -- check examples/cli/false-interpreter/False.roc</code></p>



<a name="446809425"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Task%20as%20a%20built-in/near/446809425" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Task.20as.20a.20built-in.html#446809425">(Jun 25 2024 at 08:23)</a>:</h4>
<p><span class="user-mention" data-user-id="281543">@Folkert de Vries</span> if you have free time sometime soon, could you see if you can see anything?</p>



<a name="446810278"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Task%20as%20a%20built-in/near/446810278" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Task.20as.20a.20built-in.html#446810278">(Jun 25 2024 at 08:27)</a>:</h4>
<p>My current theory is that we allow inference of the Task's inner closure's type and that leads to the <code>Task *</code>, but I don't know if setting the type during canonicalization actually is respected or if it's "paved over" during type-checking</p>



<a name="446810437"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Task%20as%20a%20built-in/near/446810437" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Task.20as.20a.20built-in.html#446810437">(Jun 25 2024 at 08:28)</a>:</h4>
<p>This is the code I'm referring to: <a href="https://github.com/roc-lang/roc/blob/d47a073634e79d2db69a67fd08a12b714d46b514/crates/compiler/can/src/effect_module.rs#L1401">https://github.com/roc-lang/roc/blob/d47a073634e79d2db69a67fd08a12b714d46b514/crates/compiler/can/src/effect_module.rs#L1401</a></p>



<a name="446810472"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Task%20as%20a%20built-in/near/446810472" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Task.20as.20a.20built-in.html#446810472">(Jun 25 2024 at 08:28)</a>:</h4>
<p>So I'm gonna try changing it here and seeing if I can get things to work</p>



<a name="446810615"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Task%20as%20a%20built-in/near/446810615" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Task.20as.20a.20built-in.html#446810615">(Jun 25 2024 at 08:29)</a>:</h4>
<p>If you don't have time though, don't worry about it.</p>



<a name="447164649"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Task%20as%20a%20built-in/near/447164649" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Task.20as.20a.20built-in.html#447164649">(Jun 26 2024 at 09:15)</a>:</h4>
<p>Okay, I fixed the issue with type misalignment, I now understand the type system a whole lot better!</p>



<a name="447164763"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Task%20as%20a%20built-in/near/447164763" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Task.20as.20a.20built-in.html#447164763">(Jun 26 2024 at 09:16)</a>:</h4>
<p>I'm now running into other issues with respect to building our test platforms, but it's progress</p>



<a name="447168136"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Task%20as%20a%20built-in/near/447168136" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Task.20as.20a.20built-in.html#447168136">(Jun 26 2024 at 09:34)</a>:</h4>
<p>Just kidding, I thought it was hanging, but it was waiting for user input <span aria-label="upside down" class="emoji emoji-1f643" role="img" title="upside down">:upside_down:</span></p>



<a name="447171589"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Task%20as%20a%20built-in/near/447171589" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Task.20as.20a.20built-in.html#447171589">(Jun 26 2024 at 09:50)</a>:</h4>
<p>haha, know the feeling</p>



<a name="447184286"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Task%20as%20a%20built-in/near/447184286" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Task.20as.20a.20built-in.html#447184286">(Jun 26 2024 at 10:50)</a>:</h4>
<p><span class="user-mention" data-user-id="461444">@Sam Mohr</span> btw a helpful tip when making changes to builtins: if you break something in a builtin <code>.roc</code> file, <code>cargo check</code> can hang because it tries to build the builtins when compiling the rest of the compiler.</p>
<p>to see the error message, do <code>cargo check -vvv</code> ("very, very verbose") - which will print out the compile error message that occurred when trying to build the .roc files for the builtins</p>



<a name="447184364"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Task%20as%20a%20built-in/near/447184364" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Task.20as.20a.20built-in.html#447184364">(Jun 26 2024 at 10:51)</a>:</h4>
<p>Huh... that is really good to know</p>



<a name="447184544"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Task%20as%20a%20built-in/near/447184544" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Task.20as.20a.20built-in.html#447184544">(Jun 26 2024 at 10:52)</a>:</h4>
<p>Not the case with this last issue (not yet mentioned in this thread)</p>



<a name="447184560"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Task%20as%20a%20built-in/near/447184560" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Task.20as.20a.20built-in.html#447184560">(Jun 26 2024 at 10:52)</a>:</h4>
<p>But good for the back pocket</p>



<a name="447184660"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Task%20as%20a%20built-in/near/447184660" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Task.20as.20a.20built-in.html#447184660">(Jun 26 2024 at 10:53)</a>:</h4>
<p>I seem to have messed up the <code>load_internal/src/file.rs</code> "graph" of steps somehow, it runs out of steps after solving types, I believe, and then loops forever instead of exiting</p>



<a name="447184735"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Task%20as%20a%20built-in/near/447184735" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Task.20as.20a.20built-in.html#447184735">(Jun 26 2024 at 10:53)</a>:</h4>
<p>Once that's fixed, then I expect everything will be working</p>



<a name="447184814"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Task%20as%20a%20built-in/near/447184814" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Task.20as.20a.20built-in.html#447184814">(Jun 26 2024 at 10:54)</a>:</h4>
<p>I have Tasks as a built-in working with the <code>examples/cli/effects</code> platform</p>



<a name="447559581"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Task%20as%20a%20built-in/near/447559581" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Task.20as.20a.20built-in.html#447559581">(Jun 27 2024 at 19:02)</a>:</h4>
<p>Just a quick update on this, the issue I was running into with was that there were many <code>import pf.Task</code> statements in the <code>basic-cli</code> platform. I've tested with other built-ins, and it seems like <code>import pf.&lt;builtin&gt;</code> hangs, probably because built-in imports are only ignored in the current app. Here's a repro:</p>
<div class="codehilite" data-code-language="Elm"><pre><span></span><code><span class="nv">app</span><span class="w"> </span><span class="p">[</span><span class="nv">main</span><span class="p">]</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nv">pf</span><span class="nf">:</span><span class="w"> </span><span class="nv">platform</span><span class="w"> </span><span class="s">"https://github.com/roc-lang/basic-cli/releases/download/0.10.0/vNe6s9hWzoTZtFmNkvEICPErI9ptji_ySjicO6CkucY.tar.br"</span><span class="w"> </span><span class="p">}</span>

<span class="kn">import</span><span class="w"> </span><span class="nc">pf.Task</span>
<span class="kn">import</span><span class="w"> </span><span class="nc">pf.List</span>
<span class="kn">import</span><span class="w"> </span><span class="nc">pf.Stdout</span>

<span class="kr">main </span><span class="nf">=</span>
<span class="w">    </span><span class="kt">Stdout</span><span class="nf">.</span><span class="nv">line</span><span class="err">!</span><span class="w"> </span><span class="s">"Hello, world!"</span>
</code></pre></div>
<p>If I change <code>List</code> to <code>List2</code>, I get an error that it isn't found, and if I remove it, the app runs, but otherwise it hangs. I'll make an issue if I can't find an existing one for this.</p>



<a name="447562692"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Task%20as%20a%20built-in/near/447562692" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Task.20as.20a.20built-in.html#447562692">(Jun 27 2024 at 19:12)</a>:</h4>
<p>That being resolved, pretty much all of the CI tests are passing for <code>basic-cli</code> barring a couple for an odd reason. After changing the return type of <code>roc_fx_args</code> in <code>platform/src/lib.rs</code> to <code>RocResult&lt;RocList&lt;RocStr&gt;, ()&gt;</code>, calling the method deterministically returns <em>one of the error tags</em> for a different error. The Rust code cannot fail, and the type annotation on the Roc side is <code>args : Task (List Str) *</code>, so it shouldn't fail either. I believe I have to update the glue code, because it seems like a silent failure in the Rust -&gt; Roc decoding, but it would be nice to have type checking between the Roc and Rust FFI if at all possible.</p>



<a name="447563023"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Task%20as%20a%20built-in/near/447563023" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Task.20as.20a.20built-in.html#447563023">(Jun 27 2024 at 19:14)</a>:</h4>
<p>I think I'll make an issue for that as well, since changing the return type of a Rust function doesn't cause any errors during Roc runtime. It may not be an easy add, but it means we have weaker type safety than Elm's ports, which this is somewhat analogous to.</p>



<a name="447563094"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Task%20as%20a%20built-in/near/447563094" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Task.20as.20a.20built-in.html#447563094">(Jun 27 2024 at 19:14)</a>:</h4>
<p>Once this issue is fixed, I'll un-draft the PR's and ask for help reviewing this change.</p>



<a name="447564848"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Task%20as%20a%20built-in/near/447564848" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Agus Zubiaga <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Task.20as.20a.20built-in.html#447564848">(Jun 27 2024 at 19:24)</a>:</h4>
<p><span class="user-mention silent" data-user-id="461444">Sam Mohr</span> <a href="#narrow/stream/316715-contributing/topic/Task.20as.20a.20built-in/near/447563023">said</a>:</p>
<blockquote>
<p>I think I'll make an issue for that as well, since changing the return type of a Rust function doesn't cause any errors during Roc runtime. It may not be an easy add, but it means we have weaker type safety than Elm's ports, which this is somewhat analogous to.</p>
</blockquote>
<p>Hm, I don't know how we could do that without slowing down every IO interaction. I feel like the goal should be to make glue more reliable, probably via roundtrip property testing.</p>



<a name="447564910"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Task%20as%20a%20built-in/near/447564910" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Task.20as.20a.20built-in.html#447564910">(Jun 27 2024 at 19:24)</a>:</h4>
<p>I mean at compilation, not during runtime</p>



<a name="447564921"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Task%20as%20a%20built-in/near/447564921" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Task.20as.20a.20built-in.html#447564921">(Jun 27 2024 at 19:24)</a>:</h4>
<p>During runtime would be terrible</p>



<a name="447565441"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Task%20as%20a%20built-in/near/447565441" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Agus Zubiaga <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Task.20as.20a.20built-in.html#447565441">(Jun 27 2024 at 19:27)</a>:</h4>
<p>Oh, I'm not sure what that'd look like, but that's probably for another topic <span aria-label="smiley" class="emoji emoji-1f603" role="img" title="smiley">:smiley:</span></p>



<a name="447565579"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Task%20as%20a%20built-in/near/447565579" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Task.20as.20a.20built-in.html#447565579">(Jun 27 2024 at 19:28)</a>:</h4>
<p>This weekend if I remember I'll post in <a class="stream" data-stream-id="304641" href="/#narrow/stream/304641-ideas">#ideas</a></p>



<a name="448178884"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Task%20as%20a%20built-in/near/448178884" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Task.20as.20a.20built-in.html#448178884">(Jun 30 2024 at 21:43)</a>:</h4>
<h1>Builtin Task Coord</h1>
<p>Making a list of things to land <a href="https://github.com/roc-lang/roc/pull/6836">#6836</a></p>
<h2>Handy References</h2>
<ul>
<li><a href="https://github.com/lukewilliamboswell/roc-platform-template-zig/pull/3/files">PR roc-platform-template-zig</a> is ready for builtin task as an example</li>
</ul>
<h2>Preparations</h2>
<ul>
<li>Upgrade and pre-release of basic-cli <a href="https://github.com/roc-lang/basic-cli/pull/217">WIP PR #217</a></li>
<li>Upgrade and pre-release of basic-webserver TODO</li>
<li>Upgrade and pre-release of basic-ssg TODO</li>
<li>Stage pre-release URL platforms in roc-lang/examples TODO</li>
<li>Stage pre-release URL platforms in roc-lang/roc TODO</li>
</ul>
<h2>Nice to have</h2>
<ul>
<li>Upgrade and pre-release of roc-platform-template-zig DONE</li>
<li>Upgrade and pre-release of roc-wasm4 TODO</li>
<li>Upgrade and pre-release of <a href="https://github.com/lukewilliamboswell/roc-platform-template-rust">roc-platform-template-rust</a> TODO</li>
<li>Upgrade and pre-release of <a href="https://github.com/lukewilliamboswell/roc-platform-template-go">roc-platform-template-go</a> TODO</li>
<li>Upgrade and pre-release of <a href="https://github.com/lukewilliamboswell/roc-platform-template-swift">roc-platform-template-swift</a> TODO</li>
<li>Upgrade and pre-release of <a href="https://github.com/lukewilliamboswell/roc-platform-template-c">roc-platform-template-c</a> TODO</li>
</ul>



<a name="448179510"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Task%20as%20a%20built-in/near/448179510" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Task.20as.20a.20built-in.html#448179510">(Jun 30 2024 at 21:54)</a>:</h4>
<p>I lumped basic-webserver in with the required group, because I think we need to ensure it is working OK before we make this change. Most of the basic-cli changes to replace glue types will translate directly across.</p>



<a name="448197682"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Task%20as%20a%20built-in/near/448197682" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Task.20as.20a.20built-in.html#448197682">(Jul 01 2024 at 01:18)</a>:</h4>
<ul>
<li>Update Tutorial code samples and add Task in <a href="https://www.roc-lang.org/tutorial#builtin-modules">builtin-modules</a> DONE <span aria-label="check" class="emoji emoji-2705" role="img" title="check">:check:</span></li>
</ul>



<a name="448202870"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Task%20as%20a%20built-in/near/448202870" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Task.20as.20a.20built-in.html#448202870">(Jul 01 2024 at 02:08)</a>:</h4>
<p>Upgrade and pre-release of basic-ssg READY <span aria-label="check" class="emoji emoji-2705" role="img" title="check">:check:</span> </p>
<ul>
<li>PR <a href="https://github.com/lukewilliamboswell/basic-ssg/pull/2">basic-ssg #2</a></li>
<li>Pre-release <a href="https://github.com/lukewilliamboswell/basic-ssg/releases/tag/0.2.0">0.2.0</a></li>
<li>tested on aarch64 macos</li>
</ul>



<a name="448204822"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Task%20as%20a%20built-in/near/448204822" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Task.20as.20a.20built-in.html#448204822">(Jul 01 2024 at 02:19)</a>:</h4>
<p>Stage pre-release URL platforms in roc-lang/roc</p>
<ul>
<li>basic-ssg  <a href="https://github.com/roc-lang/roc/pull/6836/commits/66463c54c2a2bd21c828b0cb8b4ae29854c1a8ca">commit</a> <span aria-label="check" class="emoji emoji-2705" role="img" title="check">:check:</span> </li>
<li>basic-cli TODO <span aria-label="multiplication" class="emoji emoji-2716" role="img" title="multiplication">:multiplication:</span></li>
<li>basic-webserver N/A</li>
</ul>



<a name="448257095"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Task%20as%20a%20built-in/near/448257095" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Task.20as.20a.20built-in.html#448257095">(Jul 01 2024 at 08:08)</a>:</h4>
<p>Upgrade and pre-release of basic-webserver <a href="https://github.com/roc-lang/basic-webserver/pull/58">PR #58</a> READY FOR REVIEW <span aria-label="pray" class="emoji emoji-1f64f" role="img" title="pray">:pray:</span></p>



<a name="448793734"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Task%20as%20a%20built-in/near/448793734" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Task.20as.20a.20built-in.html#448793734">(Jul 03 2024 at 09:01)</a>:</h4>
<p>We are chugging along with the Task as a built-in PRs, and I think I finally found the source of my FFI decoding issues. With the current Roc code in the <code>smores56:builtin-task</code> branch, typing the <code>args</code> Task as <code>Task (Dict Str Str) *</code> in the hosted module gives this in the CLI:</p>
<div class="codehilite"><pre><span></span><code>smores@smortress:~/dev/roc$ cargo run --bin roc ../basic-cli/examples/args.roc
    Finished dev [unoptimized + debuginfo] target(s) in 0.15s
     Running `target/debug/roc ../basic-cli/examples/args.roc`
🔨 Rebuilding platform...
Parsing args...
Program exited with error:
    (StdoutErr Interrupted)
</code></pre></div>
<p>But if I change the Task declaration to <code>args : Task (Dict Str Str) {}</code> (a.k.a. make the type static by removing the wildcard), then the code works:</p>
<div class="codehilite"><pre><span></span><code>smores@smortress:~/dev/roc$ cargo run --bin roc ../basic-cli/examples/args.roc -- div
    Finished dev [unoptimized + debuginfo] target(s) in 0.15s
     Running `target/debug/roc ../basic-cli/examples/args.roc -- div`
🔨 Rebuilding platform...
Parsing args...
[src/lib.rs:379:9] std::env::args_os().map(|os_str|
            RocStr::from(os_str.to_string_lossy().borrow())).collect() = [
    &quot;/proc/self/fd/3&quot;,
    &quot;div&quot;,
]
Error: Required option -n/--dividend is missing.

Usage:
  args-example div -n/--dividend NUM -d/--divisor NUM
</code></pre></div>
<p>My theory is that <code>RocResult</code> is trying to decode my <code>Result data [StdoutErr err, Exit I32 Str]</code> as a <code>Result data []</code> since the FFI definition returns <code>RocResult&lt;RocDict&lt;RocStr, RocStr&gt;, ()&gt;</code>. The extra bytes mean we interpret the underlying struct totally incorrectly. There's probably more testing to be done here, though I'm not entirely sure about how to do that yet.</p>
<p>If this indeed our issues right now, then for now I'm going to change the <code>basic-cli</code> hosted module to only declare static types, and in the long term we should consider interpretting <code>Task ok *</code> as <code>Task ok []</code>, or better yet interpretting <code>Result ok err</code> as <code>Result ok err</code>, even if the error gets combined into a bigger tag union.</p>



<a name="448794172"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Task%20as%20a%20built-in/near/448794172" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Task.20as.20a.20built-in.html#448794172">(Jul 03 2024 at 09:03)</a>:</h4>
<p>Or maybe this is just a wildcard * implementation issue, I know that there are lots of issues surrounding it at the moment.</p>



<a name="448818750"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Task%20as%20a%20built-in/near/448818750" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Task.20as.20a.20built-in.html#448818750">(Jul 03 2024 at 10:57)</a>:</h4>
<h1>Builtin Task Coord (Update)</h1>
<ul>
<li><a href="https://github.com/roc-lang/roc/pull/6836">Task as Builtin PR</a> - Almost ready for review</li>
</ul>
<h2>Preparations</h2>
<ul>
<li>Upgrade and pre-release of basic-ssg DONE <span aria-label="check" class="emoji emoji-2705" role="img" title="check">:check:</span></li>
<li>Update Tutorial code samples and add Task in builtin-modules DONE <span aria-label="check" class="emoji emoji-2705" role="img" title="check">:check:</span></li>
<li>Upgrade and pre-release of <a href="https://github.com/roc-lang/basic-cli/pull/217">basic-cli PR</a> - Almost ready for review</li>
<li>Upgrade and pre-release of <a href="https://github.com/roc-lang/basic-webserver/pull/58">basic-webserver PR</a> - Almost ready for review</li>
<li>Stage pre-release URL platforms in roc-lang/examples TODO</li>
<li>Stage pre-release URL platforms in roc-lang/roc TODO</li>
</ul>
<p>We have made a lot of progress and are very close. <span aria-label="smiley" class="emoji emoji-1f603" role="img" title="smiley">:smiley:</span></p>



<a name="448888106"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Task%20as%20a%20built-in/near/448888106" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Agus Zubiaga <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Task.20as.20a.20built-in.html#448888106">(Jul 03 2024 at 15:52)</a>:</h4>
<p><span class="user-mention silent" data-user-id="461444">Sam Mohr</span> <a href="#narrow/stream/316715-contributing/topic/Task.20as.20a.20built-in/near/447559581">said</a>:</p>
<blockquote>
<p>Just a quick update on this, the issue I was running into with was that there were many <code>import pf.Task</code> statements in the <code>basic-cli</code> platform. I've tested with other built-ins, and it seems like <code>import pf.&lt;builtin&gt;</code> hangs</p>
</blockquote>
<p>Fixed in: <a href="https://github.com/roc-lang/roc/pull/6863">https://github.com/roc-lang/roc/pull/6863</a></p>



<a name="452550250"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Task%20as%20a%20built-in/near/452550250" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Task.20as.20a.20built-in.html#452550250">(Jul 19 2024 at 11:22)</a>:</h4>
<p>I spent some time this evening updating the PR's for builtin-task (just merging really).</p>
<p>It looks like there is one or two minor issues/failures on the roc PR, but otherwise it's looking almost ready for a testing release.</p>
<p>I updated basic-cli and that is also looking good. There is an issue/segfault with <code>Arg.list</code> which I think may be something I broke or a known issue... <span aria-label="thinking" class="emoji emoji-1f914" role="img" title="thinking">:thinking:</span> besides that it's also almost ready for a pre-release.</p>



<a name="452557474"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Task%20as%20a%20built-in/near/452557474" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anton <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Task.20as.20a.20built-in.html#452557474">(Jul 19 2024 at 12:10)</a>:</h4>
<blockquote>
<p>There is an issue/segfault with <code>Arg.list</code> ...</p>
</blockquote>
<p>Is that with builtin-task or without?</p>



<a name="452557902"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Task%20as%20a%20built-in/near/452557902" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Task.20as.20a.20built-in.html#452557902">(Jul 19 2024 at 12:13)</a>:</h4>
<p>Builtin-task</p>



<a name="452586293"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Task%20as%20a%20built-in/near/452586293" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anton <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Task.20as.20a.20built-in.html#452586293">(Jul 19 2024 at 14:39)</a>:</h4>
<p>I'm also now experiencing the segfault without builtin-task using the basic-cli 0.13 pre-release (built with the 0.13.x branch).</p>



<a name="452599594"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Task%20as%20a%20built-in/near/452599594" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anton <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Task.20as.20a.20built-in.html#452599594">(Jul 19 2024 at 15:33)</a>:</h4>
<p>Many other examples are failing as well, --linker=legacy makes the issue disappear, this could be musl related</p>



<a name="452600089"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Task%20as%20a%20built-in/near/452600089" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anton <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Task.20as.20a.20built-in.html#452600089">(Jul 19 2024 at 15:36)</a>:</h4>
<p>Valgrind errors:</p>
<div class="codehilite"><pre><span></span><code>==65301== Command: examples/LeastSquares/main
==65301==
==65301== Jump to the invalid address stated on the next line
==65301==    at 0x0: ???
==65301==    by 0x34E762: ??? (in /home/username/gitrepos/examples2/examples/examples/LeastSquares/main)
==65301==  Address 0x0 is not stack&#39;d, malloc&#39;d or (recently) free&#39;d
==65301==
==65301==
==65301== Process terminating with default action of signal 11 (SIGSEGV): dumping core
==65301==  Bad permissions for mapped region at address 0x0
==65301==    at 0x0: ???
==65301==    by 0x34E762: ??? (in /home/username/gitrepos/examples2/examples/examples/LeastSquares/main)
==65301==
==65301== HEAP SUMMARY:
==65301==     in use at exit: 0 bytes in 0 blocks
==65301==   total heap usage: 0 allocs, 0 frees, 0 bytes allocated
</code></pre></div>



<a name="452626506"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Task%20as%20a%20built-in/near/452626506" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Task.20as.20a.20built-in.html#452626506">(Jul 19 2024 at 17:31)</a>:</h4>
<p>Yeah, I think it is musl. I have been building locally and haven't hit this</p>



<a name="452628304"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Task%20as%20a%20built-in/near/452628304" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anton <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Task.20as.20a.20built-in.html#452628304">(Jul 19 2024 at 17:44)</a>:</h4>
<p><a href="/user_uploads/22008/xSUrVlSCDaZfC2S8faLrOEKu/Screenshot_20240719_194128.png">Screenshot_20240719_194128.png</a><br>
Interesting diff between the unique (over both files) functions in linux-x64.rh for 0.12 and 0.13 releases</p>
<div class="message_inline_image"><a href="/user_uploads/22008/xSUrVlSCDaZfC2S8faLrOEKu/Screenshot_20240719_194128.png" title="Screenshot_20240719_194128.png"><img src="/user_uploads/22008/xSUrVlSCDaZfC2S8faLrOEKu/Screenshot_20240719_194128.png"></a></div>



<a name="452647495"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Task%20as%20a%20built-in/near/452647495" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Task.20as.20a.20built-in.html#452647495">(Jul 19 2024 at 19:20)</a>:</h4>
<p>Well we ripped out all the roc glue generated types and replaced them with roc std and handrolled interfaces, also bumped the toolchain significantly. Maybe that explains the size difference?</p>



<a name="452649031"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Task%20as%20a%20built-in/near/452649031" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Task.20as.20a.20built-in.html#452649031">(Jul 19 2024 at 19:25)</a>:</h4>
<p>For the segfault.. you just gave me an idea. What if it's a dev backend issue? </p>
<p>So I'm not 100% on how we used to generate surgical hosts. But we updated the preprocess host subcommand. </p>
<p>We generate the host using a dylib generated by roc. It currently just uses <code>roc build --lib</code>, but does that default to dev backend on linux and maybe if we added <code>--optimize</code> it would be different? </p>
<p>I figured it wouldn't matter because the stubbed app is what gets replaced.  But maybe it confuses things somehow?</p>



<a name="452812440"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Task%20as%20a%20built-in/near/452812440" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anton <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Task.20as.20a.20built-in.html#452812440">(Jul 20 2024 at 09:12)</a>:</h4>
<blockquote>
<p>bumped the toolchain ...</p>
</blockquote>
<p>The rust toolchain is on 1.79 for both 0.12 and 0.13.</p>



<a name="452812702"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Task%20as%20a%20built-in/near/452812702" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anton <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Task.20as.20a.20built-in.html#452812702">(Jul 20 2024 at 09:17)</a>:</h4>
<p>I'll check out those leads...<br>
I'd say the missing memset in 0.13 is definitely suspicious/problematic</p>



<a name="452852944"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Task%20as%20a%20built-in/near/452852944" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Task.20as.20a.20built-in.html#452852944">(Jul 20 2024 at 15:35)</a>:</h4>
<p>Missing memset?</p>



<a name="452855950"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Task%20as%20a%20built-in/near/452855950" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anton <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Task.20as.20a.20built-in.html#452855950">(Jul 20 2024 at 15:57)</a>:</h4>
<p>Yeah, linux-x64.rh for 0.13 does not contain memset, but the same file does for 0.12</p>



<a name="452856062"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Task%20as%20a%20built-in/near/452856062" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Task.20as.20a.20built-in.html#452856062">(Jul 20 2024 at 15:58)</a>:</h4>
<p>Rust getting smarter at removing things if you use musl?</p>



<a name="452856182"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Task%20as%20a%20built-in/near/452856182" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Task.20as.20a.20built-in.html#452856182">(Jul 20 2024 at 15:59)</a>:</h4>
<p>The issue with musl is that toolchains tend so assume everything is static and can be cleaned up and hidden even if you use it.</p>



<a name="452856337"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Task%20as%20a%20built-in/near/452856337" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Task.20as.20a.20built-in.html#452856337">(Jul 20 2024 at 16:00)</a>:</h4>
<p>This is probably one of the biggest reasons we need effect interpretters with all these dependency functions passed in as pointers.</p>



<a name="452871752"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Task%20as%20a%20built-in/near/452871752" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Task.20as.20a.20built-in.html#452871752">(Jul 20 2024 at 18:01)</a>:</h4>
<p>I don't think those are coupled, for what it's worth</p>



<a name="452871897"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Task%20as%20a%20built-in/near/452871897" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Task.20as.20a.20built-in.html#452871897">(Jul 20 2024 at 18:02)</a>:</h4>
<p>we could get started on passing allocator functions (and the like) in from the host anytime, really</p>



<a name="452890229"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Task%20as%20a%20built-in/near/452890229" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Task.20as.20a.20built-in.html#452890229">(Jul 20 2024 at 19:31)</a>:</h4>
<p>Yeah, but unless we also pass all effects in from the host with the allocators, we still have the linker issues.</p>



<a name="452890710"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Task%20as%20a%20built-in/near/452890710" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Task.20as.20a.20built-in.html#452890710">(Jul 20 2024 at 19:35)</a>:</h4>
<p>totally, but given that both are a requirement, it's worth noting that we can start on the one anytime - and then the other one becomes the only remaining blocker to fixing the linking issue</p>



<a name="452890825"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Task%20as%20a%20built-in/near/452890825" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Task.20as.20a.20built-in.html#452890825">(Jul 20 2024 at 19:37)</a>:</h4>
<p>Ah yeah! that definitely could be started at any time.</p>



<a name="453479499"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Task%20as%20a%20built-in/near/453479499" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anton <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Task.20as.20a.20built-in.html#453479499">(Jul 23 2024 at 17:45)</a>:</h4>
<blockquote>
<p>Yeah, linux-x64.rh for 0.13 does not contain memset, but the same file does for 0.12</p>
</blockquote>
<p>We were also hitting an error earlier (still happens) running <code>cargo build</code> without <code>--release</code> inside <code>build.roc</code>:</p>
<div class="codehilite"><pre><span></span><code>error: linking with `cc` failed: exit status: 1
  |
  = note: LC_ALL=&quot;C&quot; PATH=&quot;/home/username/.rustup/toolchains/1.79.0-x86_64-unknown-linux-gnu/lib/rustlib/x86_64-unknown-linux-gnu/bin:
[...]
&quot;/home/username/gitrepos/basic-cli/target/debug/deps/host-1af30843a687a450&quot; &quot;-Wl,--gc-sections&quot; &quot;-pie&quot; &quot;-Wl,-z,relro,-z,now&quot; &quot;-nodefaultlibs&quot;
  = note: /usr/bin/ld: /home/username/gitrepos/basic-cli/target/debug/deps/libroc_host-2562b64005f3ca50.rlib(roc_host-2562b64005f3ca50.1t441est2wxz5auf.rcgu.o): in function `rust_main&#39;:
          /home/username/gitrepos/basic-cli/crates/roc_host/src/lib.rs:339: undefined reference to `roc__mainForHost_1_exposed_size&#39;
          /usr/bin/ld: /home/username/gitrepos/basic-cli/crates/roc_host/src/lib.rs:349: undefined reference to `roc__mainForHost_1_exposed_generic&#39;
          /usr/bin/ld: /home/username/gitrepos/basic-cli/target/debug/deps/libroc_host-2562b64005f3ca50.rlib(roc_host-2562b64005f3ca50.1t441est2wxz5auf.rcgu.o): in function `roc_host::call_the_closure&#39;:
          /home/username/gitrepos/basic-cli/crates/roc_host/src/lib.rs:368: undefined reference to `roc__mainForHost_0_caller&#39;
          collect2: error: ld returned 1 exit status

  = note: some `extern` functions couldn&#39;t be found; some native libraries may need to be installed or have their path specified
  = note: use the `-l` flag to specify native libraries to link
  = note: use the `cargo:rustc-link-lib` directive to specify the native libraries to link with Cargo (see https://doc.rust-lang.org/cargo/reference/build-scripts.html#rustc-link-lib)

error: could not compile `roc_host_bin` (bin &quot;host&quot;) due to 1 previous error
</code></pre></div>
<p>It does work with <code>cargo build --release</code>. There's a decent chance that if we fix this we fix the musl memset issue too.</p>



<a name="453480309"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Task%20as%20a%20built-in/near/453480309" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anton <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Task.20as.20a.20built-in.html#453480309">(Jul 23 2024 at 17:50)</a>:</h4>
<p><code>cargo build --release</code> no longer works if I remove:</p>
<div class="codehilite"><pre><span></span><code>[profile.release]
lto = true
strip = &quot;debuginfo&quot;
codegen-units = 1
</code></pre></div>



<a name="453480969"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Task%20as%20a%20built-in/near/453480969" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anton <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Task.20as.20a.20built-in.html#453480969">(Jul 23 2024 at 17:55)</a>:</h4>
<p>Getting close now... :)</p>



<a name="453757754"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Task%20as%20a%20built-in/near/453757754" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anton <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Task.20as.20a.20built-in.html#453757754">(Jul 24 2024 at 17:32)</a>:</h4>
<p>I found it <span aria-label="tada" class="emoji emoji-1f389" role="img" title="tada">:tada:</span> <span aria-label="tada" class="emoji emoji-1f389" role="img" title="tada">:tada:</span> </p>
<p><code>links=app</code> was in <code>crates/roc_host_bin/Cargo.toml</code> but should be in <code>crates/roc_host/Cargo.toml</code>  <span aria-label="expressionless" class="emoji emoji-1f611" role="img" title="expressionless">:expressionless:</span></p>



<a name="453766909"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Task%20as%20a%20built-in/near/453766909" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Task.20as.20a.20built-in.html#453766909">(Jul 24 2024 at 18:18)</a>:</h4>
<p>I wonder if that fixes some of our other strange segfault related errors</p>



<a name="454733289"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Task%20as%20a%20built-in/near/454733289" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Task.20as.20a.20built-in.html#454733289">(Jul 29 2024 at 06:18)</a>:</h4>
<p>I merged latest main for both <a href="https://github.com/roc-lang/roc/pull/6836">roc PR</a> and <a href="https://github.com/roc-lang/basic-cli/pull/217">basic-cli PR</a> and have all <span aria-label="check" class="emoji emoji-2705" role="img" title="check">:check:</span>'s. </p>
<p><span class="user-mention" data-user-id="461444">@Sam Mohr</span> I think these are good to go. You still have these marked as Draft -- can you please have a look and if you are happy with these update Ready for Review?</p>



<a name="454758864"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Task%20as%20a%20built-in/near/454758864" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anton <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Task.20as.20a.20built-in.html#454758864">(Jul 29 2024 at 08:27)</a>:</h4>
<p>Just a heads up, Sam mentioned earlier that he was going on vacation so he may still be vacationing :p</p>



<a name="454821154"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Task%20as%20a%20built-in/near/454821154" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Task.20as.20a.20built-in.html#454821154">(Jul 29 2024 at 12:37)</a>:</h4>
<p><span class="user-mention" data-user-id="361169">@Anton</span>  yeah, I went from Japan to now a week-long choir retreat, but I planned to have 4 hours each day of free time, so I can finally get back to working on Roc</p>



<a name="454821654"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Task%20as%20a%20built-in/near/454821654" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anton <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Task.20as.20a.20built-in.html#454821654">(Jul 29 2024 at 12:38)</a>:</h4>
<p>Cool, no pressure though :)</p>



<a name="455489883"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Task%20as%20a%20built-in/near/455489883" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Task.20as.20a.20built-in.html#455489883">(Jul 31 2024 at 21:39)</a>:</h4>
<p><span class="user-mention" data-user-id="461444">@Sam Mohr</span> do have to have all the effects be lambdas? Is there an issue on linux? it was working ok for me on my mac.</p>



<a name="455489950"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Task%20as%20a%20built-in/near/455489950" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Task.20as.20a.20built-in.html#455489950">(Jul 31 2024 at 21:39)</a>:</h4>
<p>So the change is coming from how the type system works</p>



<a name="455490050"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Task%20as%20a%20built-in/near/455490050" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Task.20as.20a.20built-in.html#455490050">(Jul 31 2024 at 21:40)</a>:</h4>
<p>The old way had the return types as [...]_</p>



<a name="455490132"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Task%20as%20a%20built-in/near/455490132" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Task.20as.20a.20built-in.html#455490132">(Jul 31 2024 at 21:40)</a>:</h4>
<p>Which meant that you couldn't actually use the same Task with two different error types, the compiler would infer a specific one</p>



<a name="455490170"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Task%20as%20a%20built-in/near/455490170" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Task.20as.20a.20built-in.html#455490170">(Jul 31 2024 at 21:41)</a>:</h4>
<p>So it felt like you could just do Arg.list!, but that was a false promise</p>



<a name="455490328"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Task%20as%20a%20built-in/near/455490328" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Task.20as.20a.20built-in.html#455490328">(Jul 31 2024 at 21:42)</a>:</h4>
<p>This constraint comes from the fact that a static <code>Task ok *</code> currently cannot be integrated into a larger error tag union</p>



<a name="455490374"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Task%20as%20a%20built-in/near/455490374" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Task.20as.20a.20built-in.html#455490374">(Jul 31 2024 at 21:42)</a>:</h4>
<p>Since it's a top level definition, which can only have one specialization</p>



<a name="455490652"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Task%20as%20a%20built-in/near/455490652" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Task.20as.20a.20built-in.html#455490652">(Jul 31 2024 at 21:44)</a>:</h4>
<p>Now, since they're all thunks, the * can actually be expanded to another tag union, meaning we can just call <code>Arg.list! {}</code> in context in multiple different functions with different error unions</p>



<a name="455490659"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Task%20as%20a%20built-in/near/455490659" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Task.20as.20a.20built-in.html#455490659">(Jul 31 2024 at 21:44)</a>:</h4>
<p><span class="user-mention silent" data-user-id="461444">Sam Mohr</span> <a href="#narrow/stream/316715-contributing/topic/Task.20as.20a.20built-in/near/455490374">said</a>:</p>
<blockquote>
<p>Since it's a top level definition, which can only have one specialization</p>
</blockquote>
<p>I think that's only true for some types but not others fwiw</p>



<a name="455490679"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Task%20as%20a%20built-in/near/455490679" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Task.20as.20a.20built-in.html#455490679">(Jul 31 2024 at 21:44)</a>:</h4>
<p>e.g. top-level <code>Num *</code> can have multiple specializations</p>



<a name="455490749"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Task%20as%20a%20built-in/near/455490749" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Task.20as.20a.20built-in.html#455490749">(Jul 31 2024 at 21:45)</a>:</h4>
<p>When I tried just using <code>Task ok *</code> I got type errors</p>



<a name="455490813"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Task%20as%20a%20built-in/near/455490813" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Task.20as.20a.20built-in.html#455490813">(Jul 31 2024 at 21:45)</a>:</h4>
<p>yeah, some types are special-cased</p>



<a name="455490827"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Task%20as%20a%20built-in/near/455490827" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Task.20as.20a.20built-in.html#455490827">(Jul 31 2024 at 21:45)</a>:</h4>
<p>I think it might actually just be <code>Num *</code> right now</p>



<a name="455490854"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Task%20as%20a%20built-in/near/455490854" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Task.20as.20a.20built-in.html#455490854">(Jul 31 2024 at 21:45)</a>:</h4>
<p>we've planned to expand that list for awhile, but haven't yet</p>



<a name="455491008"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Task%20as%20a%20built-in/near/455491008" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Task.20as.20a.20built-in.html#455491008">(Jul 31 2024 at 21:46)</a>:</h4>
<p>I think we should try and resolve the underlying type issue if possible. It was probably ok for the Arg.list workaround, but I'm concerned if we are doing this accross the board, and then may change it back again. There will be a lot of code that breaks.</p>



<a name="455491062"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Task%20as%20a%20built-in/near/455491062" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Task.20as.20a.20built-in.html#455491062">(Jul 31 2024 at 21:47)</a>:</h4>
<p>If we can special case <code>Result ok *</code> and <code>Task ok *</code> that would fix this need for thunks</p>



<a name="455491288"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Task%20as%20a%20built-in/near/455491288" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Task.20as.20a.20built-in.html#455491288">(Jul 31 2024 at 21:48)</a>:</h4>
<p><span class="user-mention" data-user-id="515757">@Luke Boswell</span> I wasn't considering it was possible because I thought it was a constraint of the type system, but if what Rich is saying is right, then I totally agree, let's do the right way</p>



<a name="455491396"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Task%20as%20a%20built-in/near/455491396" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Task.20as.20a.20built-in.html#455491396">(Jul 31 2024 at 21:49)</a>:</h4>
<p><span class="user-mention" data-user-id="454654">@Ayaz Hafiz</span> do we have written down anywhere what the "expand this by induction to other types" project would entail?</p>



<a name="455491468"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Task%20as%20a%20built-in/near/455491468" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Task.20as.20a.20built-in.html#455491468">(Jul 31 2024 at 21:50)</a>:</h4>
<p>I can look at the Num impl tonight after rehearsal</p>



<a name="455535012"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Task%20as%20a%20built-in/near/455535012" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ayaz Hafiz <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Task.20as.20a.20built-in.html#455535012">(Aug 01 2024 at 03:17)</a>:</h4>
<p>i really would not recommend trying to expand this to other value types right now</p>



<a name="455535256"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Task%20as%20a%20built-in/near/455535256" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ayaz Hafiz <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Task.20as.20a.20built-in.html#455535256">(Aug 01 2024 at 03:18)</a>:</h4>
<p>i understand that wrapping in lambdas can be annoying but i think the only other reasonable way to compile this is to desugar all polymorphic value types to lambdas after type checking, which is not easy (it's the reason it was removed)</p>



<a name="455535664"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Task%20as%20a%20built-in/near/455535664" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ayaz Hafiz <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Task.20as.20a.20built-in.html#455535664">(Aug 01 2024 at 03:20)</a>:</h4>
<p>there is a simple way to do it, but the existing implementation in mono and the backends is not amenable to it IMO</p>



<a name="455537577"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Task%20as%20a%20built-in/near/455537577" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Task.20as.20a.20built-in.html#455537577">(Aug 01 2024 at 03:29)</a>:</h4>
<p>It sounds like a reasonable trade-off then.</p>
<ul>
<li>All PlatformTasks <code>Task ok *</code> will be lambdas, even if they normally wouldn't take any arguments.</li>
<li>We can look at upgrading mono and backends in future</li>
<li>Maybe we could review the API and find ways to make use of the additional argument.</li>
</ul>



<a name="455649653"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Task%20as%20a%20built-in/near/455649653" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Task.20as.20a.20built-in.html#455649653">(Aug 01 2024 at 13:31)</a>:</h4>
<p>Okay, just saw this. I found where we determine generalizability in the <code>compiler/constrain</code> module <a href="https://github.com/roc-lang/roc/blob/c64b3d92cc49b587f71e87ba872745f702dae80d/crates/compiler/constrain/src/expr.rs#L4073">here</a>. Though as Ayaz points out, just marking <code>*</code> tag unions as generalizable isn't nearly where the work ends.</p>



<a name="455649879"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Task%20as%20a%20built-in/near/455649879" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Task.20as.20a.20built-in.html#455649879">(Aug 01 2024 at 13:32)</a>:</h4>
<p>So for now, I have all tests except for those based on the specific basic-cli version we use working in the task branch. So I think it's ready for review.</p>



<a name="455650935"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Task%20as%20a%20built-in/near/455650935" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Task.20as.20a.20built-in.html#455650935">(Aug 01 2024 at 13:36)</a>:</h4>
<p>I've marked the roc-lang PR as ready for review <a href="https://github.com/roc-lang/roc/pull/6836">https://github.com/roc-lang/roc/pull/6836</a>, and I'll update the summary to facilitate reviewing it, since even though the change isn't very complicated, there are a lot of files that are touched.</p>



<a name="462028248"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Task%20as%20a%20built-in/near/462028248" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Task.20as.20a.20built-in.html#462028248">(Aug 13 2024 at 06:09)</a>:</h4>
<p>I'm just wondering what the status on this change is?</p>
<p>I understand it's basically ready (looks like theres a recent conflict now), and we just need to coordinate a breaking change to make it happen and switch over. Or does this need further review? Ayaz has looked at it a few times and Sam has resolved the comments.</p>
<p>I'd love to help get this change over the line.</p>



<a name="462028284"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Task%20as%20a%20built-in/near/462028284" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Task.20as.20a.20built-in.html#462028284">(Aug 13 2024 at 06:09)</a>:</h4>
<p>Thanks for bringing this up! I was thinking about it earlier today</p>



<a name="462028354"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Task%20as%20a%20built-in/near/462028354" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Task.20as.20a.20built-in.html#462028354">(Aug 13 2024 at 06:10)</a>:</h4>
<p>I'll work on resolving those conflicts now</p>



<a name="462028458"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Task%20as%20a%20built-in/near/462028458" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Task.20as.20a.20built-in.html#462028458">(Aug 13 2024 at 06:11)</a>:</h4>
<p>I can help with basic-webserver, and merge the latest main with API changes into that branch</p>



<a name="462028469"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Task%20as%20a%20built-in/near/462028469" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Task.20as.20a.20built-in.html#462028469">(Aug 13 2024 at 06:11)</a>:</h4>
<p>I think once I do that, <span class="user-mention" data-user-id="361169">@Anton</span> (or someone with the same perms) will need to make a test release of basic-cli, then we can ensure the roc-lang PR works</p>



<a name="462028587"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Task%20as%20a%20built-in/near/462028587" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Task.20as.20a.20built-in.html#462028587">(Aug 13 2024 at 06:12)</a>:</h4>
<p>I think we can make a testing release of roc by making a PR and uncommenting the right part in CI script, we just can't upload the binaries without Anton but he can do that later if it all passes.</p>



<a name="462028606"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Task%20as%20a%20built-in/near/462028606" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Task.20as.20a.20built-in.html#462028606">(Aug 13 2024 at 06:12)</a>:</h4>
<p>We need roc before we'll get a passing release of basic-cli right?</p>



<a name="462028655"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Task%20as%20a%20built-in/near/462028655" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Task.20as.20a.20built-in.html#462028655">(Aug 13 2024 at 06:13)</a>:</h4>
<p>Well, Roc can't be merged without updating the tests in Roc that use hardcoded basic-cli versions</p>



<a name="462028677"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Task%20as%20a%20built-in/near/462028677" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Task.20as.20a.20built-in.html#462028677">(Aug 13 2024 at 06:13)</a>:</h4>
<p>Unless we assert "it'll be fine" and just do it anyway</p>



<a name="462028692"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Task%20as%20a%20built-in/near/462028692" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Task.20as.20a.20built-in.html#462028692">(Aug 13 2024 at 06:13)</a>:</h4>
<p>Which feels a little iffy to me, but I'd be okay with</p>



<a name="462028698"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Task%20as%20a%20built-in/near/462028698" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Task.20as.20a.20built-in.html#462028698">(Aug 13 2024 at 06:14)</a>:</h4>
<p>I mean, we can make a PR to build a testing release of Roc -- I don't think that runs CI tests or anything</p>



<a name="462028864"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Task%20as%20a%20built-in/near/462028864" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Task.20as.20a.20built-in.html#462028864">(Aug 13 2024 at 06:15)</a>:</h4>
<p>I think we can do it like <a href="https://github.com/roc-lang/roc/pull/6908">https://github.com/roc-lang/roc/pull/6908</a></p>



<a name="462029021"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Task%20as%20a%20built-in/near/462029021" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Task.20as.20a.20built-in.html#462029021">(Aug 13 2024 at 06:16)</a>:</h4>
<p>That would be great!</p>



<a name="462029228"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Task%20as%20a%20built-in/near/462029228" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Task.20as.20a.20built-in.html#462029228">(Aug 13 2024 at 06:18)</a>:</h4>
<p>It looks like we just make a PR from the task as builtin branch, and uncomment/comment the line in those five yaml files.</p>



<a name="462034576"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Task%20as%20a%20built-in/near/462034576" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Task.20as.20a.20built-in.html#462034576">(Aug 13 2024 at 06:52)</a>:</h4>
<p><span class="user-mention" data-user-id="515757">@Luke Boswell</span> just to be clear, I'd make a branch on top of my own <code>builtin-task</code> branch, do the YAML flips as Anton does in <a href="https://github.com/roc-lang/roc/issues/6908">#6908</a>, and then have him upload the created binary as a test release, which we'd then use to test basic-cli?</p>



<a name="462034727"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Task%20as%20a%20built-in/near/462034727" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Task.20as.20a.20built-in.html#462034727">(Aug 13 2024 at 06:53)</a>:</h4>
<p>After which we'd merge the <a href="https://github.com/roc-lang/basic-cli/pull/217">basic-cli PR</a> and then the roc PR after that?</p>



<a name="462057767"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Task%20as%20a%20built-in/near/462057767" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anton <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Task.20as.20a.20built-in.html#462057767">(Aug 13 2024 at 08:57)</a>:</h4>
<blockquote>
<p>I'd love to help get this change over the line.</p>
</blockquote>
<p>Yeah, I want to get this done but I really want to fix <a href="http://github.com/roc-lang/examples/pull/192">github.com/roc-lang/examples/pull/192</a> first</p>



<a name="462058598"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Task%20as%20a%20built-in/near/462058598" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anton <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Task.20as.20a.20built-in.html#462058598">(Aug 13 2024 at 09:02)</a>:</h4>
<p>btw instead of building Roc releases, it should be a lot easier to use nix to use a specific Roc commit like <a href="#narrow/stream/231634-beginners/topic/basic-cli.20http-get-json.20example/near/460027149">here</a>. It's not that important that ubuntu CI fails as long as nix CI passes for now.</p>



<a name="462064738"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Task%20as%20a%20built-in/near/462064738" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Task.20as.20a.20built-in.html#462064738">(Aug 13 2024 at 09:38)</a>:</h4>
<blockquote>
<p>btw instead of building Roc releases, it should be a lot easier to use nix to use a specific Roc commit</p>
</blockquote>
<p><span class="user-mention" data-user-id="361169">@Anton</span> can we use this to merge builtin task into main though? I thought we needed a release so that we can reference that and have CI pass before we can merge the branch into main.</p>



<a name="462065279"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Task%20as%20a%20built-in/near/462065279" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anton <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Task.20as.20a.20built-in.html#462065279">(Aug 13 2024 at 09:40)</a>:</h4>
<blockquote>
<p>@Anton can we use this to merge builtin task into main though?</p>
</blockquote>
<p>No, for the final merge you'll need a release. But you'll want to make sure basic-cli and basic-webserver tests pass (using nix to get that specific roc commit) before you make that release.</p>



<a name="464199509"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Task%20as%20a%20built-in/near/464199509" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Task.20as.20a.20built-in.html#464199509">(Aug 22 2024 at 00:10)</a>:</h4>
<p><span class="user-mention" data-user-id="361169">@Anton</span> -- sorry I missed your comment on using an LLM to update the basic-webserver PR until after I fixed it. </p>
<p>I did a quick pass over all three PRs, and from what I can tell the roc PR <span aria-label="check" class="emoji emoji-2705" role="img" title="check">:check:</span>, and basic-cli PR <span aria-label="check" class="emoji emoji-2705" role="img" title="check">:check:</span>  are good to go. There is just this LLVM issue blocking basic-webserver <span aria-label="cross mark" class="emoji emoji-274c" role="img" title="cross mark">:cross_mark:</span>  (and therefore the Task as builtin breaking change). The fix for this will be an update to the roc PR.</p>
<div class="codehilite"><pre><span></span><code>+ roc build --prebuilt-platform --linker=legacy examples/dir.roc
thread &#39;main&#39; panicked at /Users/luke/.cargo/git/checkouts/inkwell-55729a4c43239568/d1a5963/src/values/enums.rs:302:13:
Found StructValue(StructValue { struct_value: Value { name: &quot;load_result&quot;, address: 0x6000030b1040, is_const: false, is_null: false, is_undef: false, llvm_value: &quot;  %load_result = load { [0 x i64], [3 x i64], i8, [7 x i8] }, ptr %result_value, align 8, !dbg !10&quot;, llvm_type: &quot;{ [0 x i64], [3 x i64], i8, [7 x i8] }&quot; } }) but expected PointerValue variant
note: run with `RUST_BACKTRACE=1` environment variable to display a backtrace
</code></pre></div>



<a name="464199804"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Task%20as%20a%20built-in/near/464199804" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Task.20as.20a.20built-in.html#464199804">(Aug 22 2024 at 00:13)</a>:</h4>
<p><span class="user-mention" data-user-id="343810">@Brendan Hansknecht</span> -- does this LLVM look like an easy fix? I suspect there's just a typo somewhere in the task and builtin PR.</p>



<a name="464199898"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Task%20as%20a%20built-in/near/464199898" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Task.20as.20a.20built-in.html#464199898">(Aug 22 2024 at 00:14)</a>:</h4>
<p>It looks like we have an already loaded struct but didn't realize so. As such, we are trying to load the struct from a pointer even though we already have the struct loaded.</p>



<a name="464199900"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Task%20as%20a%20built-in/near/464199900" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Task.20as.20a.20built-in.html#464199900">(Aug 22 2024 at 00:14)</a>:</h4>
<p>Probably a minor bug</p>



<a name="464591894"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Task%20as%20a%20built-in/near/464591894" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anton <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Task.20as.20a.20built-in.html#464591894">(Aug 23 2024 at 09:08)</a>:</h4>
<blockquote>
<p>sorry I missed your comment on using an LLM to update the basic-webserver PR until after I fixed it.</p>
</blockquote>
<p>No problem, I got started on it but it requires some time to set up all the plumbing code, so I wanted to do it manually for now anyway</p>



<a name="464795834"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Task%20as%20a%20built-in/near/464795834" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Task.20as.20a.20built-in.html#464795834">(Aug 24 2024 at 05:59)</a>:</h4>
<p>More detailed error and backtrace:</p>
<div class="codehilite"><pre><span></span><code>thread &#39;main&#39; panicked at crates/compiler/gen_llvm/src/llvm/build.rs:3776:17:
&quot;PlatformTask_task_closure_stderrLine_146823d2bf8fc0c097442048ad932e5338966c8ef5244f2d062b7bbb52d84c7&quot;: StructValue(StructValue { struct_value: Value { name: &quot;load_result&quot;, address: 0x6000029b9c40, is_const: false, is_null: false, is_undef: false, llvm_value: &quot;  %load_result = load { [0 x i64], [3 x i64], i8, [7 x i8] }, ptr %result_value, align 8, !dbg !10&quot;, llvm_type: &quot;{ [0 x i64], [3 x i64], i8, [7 x i8] }&quot; } })
Union(NonRecursive([[InLayout(STR)], [InLayout(UNIT)]]))
note: run with `RUST_BACKTRACE=1` environment variable to display a backtrace
(base) ➜  roc git:(task-builtins) ✗ RUST_BACKTRACE=1 ROC_CHECK_MONO_IR=1 cargo run ../roc-webserver/examples/dir.roc
    Finished dev [unoptimized + debuginfo] target(s) in 0.29s
     Running `target/debug/roc ../roc-webserver/examples/dir.roc`
🔨 Rebuilding platform...
thread &#39;main&#39; panicked at crates/compiler/gen_llvm/src/llvm/build.rs:3776:17:
&quot;PlatformTask_task_closure_stderrLine_146823d2bf8fc0c097442048ad932e5338966c8ef5244f2d062b7bbb52d84c7&quot;: StructValue(StructValue { struct_value: Value { name: &quot;load_result&quot;, address: 0x60000008d880, is_const: false, is_null: false, is_undef: false, llvm_value: &quot;  %load_result = load { [0 x i64], [3 x i64], i8, [7 x i8] }, ptr %result_value, align 8, !dbg !10&quot;, llvm_type: &quot;{ [0 x i64], [3 x i64], i8, [7 x i8] }&quot; } })
Union(NonRecursive([[InLayout(STR)], [InLayout(UNIT)]]))
stack backtrace:
   0: rust_begin_unwind
             at /rustc/25ef9e3d85d934b27d9dada2f9dd52b1dc63bb04/library/std/src/panicking.rs:647:5
   1: core::panicking::panic_fmt
             at /rustc/25ef9e3d85d934b27d9dada2f9dd52b1dc63bb04/library/core/src/panicking.rs:72:14
   2: build_return
             at ./crates/compiler/gen_llvm/src/llvm/build.rs:3776:17
   3: build_exp_stmt
             at ./crates/compiler/gen_llvm/src/llvm/build.rs:3232:13
   4: build_exp_stmt
             at ./crates/compiler/gen_llvm/src/llvm/build.rs:3451:21
   5: build_exp_stmt
             at ./crates/compiler/gen_llvm/src/llvm/build.rs:3213:26
   6: build_proc
             at ./crates/compiler/gen_llvm/src/llvm/build.rs:6261:16
   7: build_procedures_help
             at ./crates/compiler/gen_llvm/src/llvm/build.rs:5803:13
   8: build_procedures
             at ./crates/compiler/gen_llvm/src/llvm/build.rs:5557:25
   9: gen_from_mono_module_llvm
             at ./crates/compiler/build/src/program.rs:239:5
  10: gen_from_mono_module
             at ./crates/compiler/build/src/program.rs:125:47
  11: build_loaded_file
             at ./crates/compiler/build/src/program.rs:924:61
  12: build_file
             at ./crates/compiler/build/src/program.rs:735:5
  13: build
             at ./crates/cli/src/lib.rs:904:27
  14: main
             at ./crates/cli/src/main.rs:48:17
</code></pre></div>



<a name="464795973"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Task%20as%20a%20built-in/near/464795973" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Task.20as.20a.20built-in.html#464795973">(Aug 24 2024 at 06:00)</a>:</h4>
<p>Caused by <code>stderrLine</code> somehow. Expected a pointer for somthing passed by reference. Instead got a tag with a struct in it.</p>



<a name="464796010"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Task%20as%20a%20built-in/near/464796010" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Task.20as.20a.20built-in.html#464796010">(Aug 24 2024 at 06:00)</a>:</h4>
<p>They type looks like it may be equivalent to <code>Result Str []</code></p>



<a name="464796161"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Task%20as%20a%20built-in/near/464796161" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Task.20as.20a.20built-in.html#464796161">(Aug 24 2024 at 06:01)</a>:</h4>
<p>I'm assuming this is a bug in the signature generation of the new task hosted module equivalent.</p>



<a name="464809079"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Task%20as%20a%20built-in/near/464809079" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Task.20as.20a.20built-in.html#464809079">(Aug 24 2024 at 08:10)</a>:</h4>
<p>Just to get this out of private chats and give an update:</p>
<p>Fundamentally the issue is caused by the platform api getting expanded by open tag unions and type variables. This leads to the platform static api having a different type than the final type that roc is generating.</p>
<p>In the specific case above we have something like this:<br>
<code>stdoutLine : Str -&gt; Task {} *</code></p>
<p>What this ends up becoming in basic webserver is:<br>
<code>stdoutLine : Str -&gt; Task {} [ServerErr Str]</code></p>
<p>Thus the return type of <code>[ C Str, C {} ]</code>. <code>Err</code> case of <code>Str</code> and <code>Ok</code> case of nothing.</p>
<hr>
<p>We are fundamentally missing a way to make sure that the platform api is static and never expands to support extra tag union variants through open tag merging. This would also be hit with the platform api returning an error union that gets expanded. Cause <code>Task Str [MyError]</code> might end up expanding to <code>Task Str [MyError, YourError Str]</code> which would change the layout and break the type.</p>



<a name="464809355"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Task%20as%20a%20built-in/near/464809355" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Task.20as.20a.20built-in.html#464809355">(Aug 24 2024 at 08:15)</a>:</h4>
<p>Do we have any way to lock down platform type variables and then programmatically expand them?</p>
<p>Like we really want <code>stdoutLine : Str -&gt; Task {} []</code> to mean that <code>stdoutLine</code> is infallible and the platform host function will return a <code>Result {} []</code>. We then want to force roc to deal with mapping the <code>Result {} []</code> to a <code>Result {} [ServerErr Str]</code> such that the platform api stays restricted but the resulting type can be used as expected.</p>



<a name="464827433"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Task%20as%20a%20built-in/near/464827433" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Task.20as.20a.20built-in.html#464827433">(Aug 24 2024 at 11:24)</a>:</h4>
<p>hm, could we make the hosted version be <code>Str -&gt; Task {} {}</code>?</p>



<a name="464827490"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Task%20as%20a%20built-in/near/464827490" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Task.20as.20a.20built-in.html#464827490">(Aug 24 2024 at 11:24)</a>:</h4>
<p>that doesn't express what we want it to express, but it certainly wouldn't expand!</p>



<a name="464867838"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Task%20as%20a%20built-in/near/464867838" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Task.20as.20a.20built-in.html#464867838">(Aug 24 2024 at 16:10)</a>:</h4>
<p>I mean we can, but it is a general problem that I think we need to solve. Any platform returning a tag union or a <code>*</code> from host to app could break based on how it is used.</p>



<a name="464868183"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Task%20as%20a%20built-in/near/464868183" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Task.20as.20a.20built-in.html#464868183">(Aug 24 2024 at 16:12)</a>:</h4>
<p>Also, you have to make the <code>{}</code> error case back to something that can merge with tags to make it happily work with await and error accumulation</p>



<a name="464868338"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Task%20as%20a%20built-in/near/464868338" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Task.20as.20a.20built-in.html#464868338">(Aug 24 2024 at 16:13)</a>:</h4>
<p>I mean in this case you can do <code>|&gt; Task.onErr \_ -&gt; Task.ok {}</code>, but that isn't a general solution.</p>



<a name="464868598"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Task%20as%20a%20built-in/near/464868598" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Task.20as.20a.20built-in.html#464868598">(Aug 24 2024 at 16:15)</a>:</h4>
<p>yeah I mainly meant it as a way to unblock in the short term</p>



<a name="464868646"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Task%20as%20a%20built-in/near/464868646" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Task.20as.20a.20built-in.html#464868646">(Aug 24 2024 at 16:15)</a>:</h4>
<p>not as a good long term solution <span aria-label="big smile" class="emoji emoji-1f604" role="img" title="big smile">:big_smile:</span></p>



<a name="464868891"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Task%20as%20a%20built-in/near/464868891" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Task.20as.20a.20built-in.html#464868891">(Aug 24 2024 at 16:16)</a>:</h4>
<p>I guess you could technically do this.</p>
<p>For everything infallible:<br>
<code>|&gt; Task.err \{} -&gt; crash "unreachable"</code></p>
<p>For everything fallible like<br>
<code>Task Str [Eof]</code><br>
You can do:</p>
<div class="codehilite"><pre><span></span><code>|&gt; Task.mapErr \err -&gt;
        when err is
            # manually list out all cases
            Eof -&gt; Eof
</code></pre></div>



<a name="464869189"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Task%20as%20a%20built-in/near/464869189" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Task.20as.20a.20built-in.html#464869189">(Aug 24 2024 at 16:18)</a>:</h4>
<p>We theoretically could even do this programmatically. Would need to ban <code>*</code> and <code>[]</code> in the API. Cause I don't know of a way to map those.</p>



<a name="464869277"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Task%20as%20a%20built-in/near/464869277" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Task.20as.20a.20built-in.html#464869277">(Aug 24 2024 at 16:19)</a>:</h4>
<p>But maybe there is a way to cleanly map all types.</p>



<a name="464998167"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Task%20as%20a%20built-in/near/464998167" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Task.20as.20a.20built-in.html#464998167">(Aug 25 2024 at 11:28)</a>:</h4>
<p>Made the updates I think we need for basic-webserver.</p>
<p>I think I found a new bug, but I could have done something silly. I've just smashed out these changes and need take a much closer look to see, but definitely haven't seen this issue before. </p>
<div class="codehilite"><pre><span></span><code>$ roc build platform/libapp.roc
🔨 Rebuilding platform...
thread &#39;main&#39; panicked at crates/compiler/gen_llvm/src/llvm/build.rs:3391:30:
called `Result::unwrap()` on an `Err` value: AlignmentError(&quot;The src_align_bytes argument to build_memcpy was not a power of 2.&quot;)
</code></pre></div>



<a name="465030805"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Task%20as%20a%20built-in/near/465030805" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Task.20as.20a.20built-in.html#465030805">(Aug 25 2024 at 17:38)</a>:</h4>
<p>I think I know the issue.</p>



<a name="465030808"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Task%20as%20a%20built-in/near/465030808" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Task.20as.20a.20built-in.html#465030808">(Aug 25 2024 at 17:38)</a>:</h4>
<p><code>0</code> isn't a valid alignment, but we generate it.</p>



<a name="465030830"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Task%20as%20a%20built-in/near/465030830" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Task.20as.20a.20built-in.html#465030830">(Aug 25 2024 at 17:39)</a>:</h4>
<p>A zero sized type still has an alignment of <code>1</code>.</p>



<a name="465035088"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Task%20as%20a%20built-in/near/465035088" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Task.20as.20a.20built-in.html#465035088">(Aug 25 2024 at 18:49)</a>:</h4>
<p>I think this should fix it, but haven't tested on basic-webserver: <a href="https://github.com/roc-lang/roc/pull/7024">https://github.com/roc-lang/roc/pull/7024</a></p>
<p>branch is <code>align-1</code> if you want to test locallly.</p>



<a name="465043149"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Task%20as%20a%20built-in/near/465043149" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Task.20as.20a.20built-in.html#465043149">(Aug 25 2024 at 21:06)</a>:</h4>
<p>Ok, so I think we're <span aria-label="check" class="emoji emoji-2705" role="img" title="check">:check:</span> across the board now -- when testing locally using nix on my mac. <span aria-label="tada" class="emoji emoji-1f389" role="img" title="tada">:tada:</span> </p>
<p>All that remains now I think some CI magic and release coordination etc. </p>
<p>The PR's are pointing at the latest commit on the builtin-task branch on roc.</p>



<a name="465043285"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Task%20as%20a%20built-in/near/465043285" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Task.20as.20a.20built-in.html#465043285">(Aug 25 2024 at 21:09)</a>:</h4>
<p>WOW</p>



<a name="465043297"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Task%20as%20a%20built-in/near/465043297" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Task.20as.20a.20built-in.html#465043297">(Aug 25 2024 at 21:09)</a>:</h4>
<p>I'm gonna be free in an hour for a few hours, and then tonight for a few hours after that. Or we can try to coordinate some other day soon?</p>



<a name="465043302"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Task%20as%20a%20built-in/near/465043302" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Task.20as.20a.20built-in.html#465043302">(Aug 25 2024 at 21:10)</a>:</h4>
<p>Or go without me! Whatever works</p>



<a name="465043349"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Task%20as%20a%20built-in/near/465043349" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Task.20as.20a.20built-in.html#465043349">(Aug 25 2024 at 21:10)</a>:</h4>
<p>It's all over to Anton from here I think.</p>



<a name="465043368"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Task%20as%20a%20built-in/near/465043368" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Task.20as.20a.20built-in.html#465043368">(Aug 25 2024 at 21:10)</a>:</h4>
<p>Thanks for all the work from <span class="user-mention" data-user-id="515757">@Luke Boswell</span> , <span class="user-mention" data-user-id="343810">@Brendan Hansknecht</span> , and <span class="user-mention" data-user-id="361169">@Anton</span> , you've all been instrumental to this massive effort!</p>



<a name="465043450"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Task%20as%20a%20built-in/near/465043450" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Task.20as.20a.20built-in.html#465043450">(Aug 25 2024 at 21:12)</a>:</h4>
<p>Actually, could you give the webserver PR a once over. I made a bunch of fixes very last night, I'm going to be sitting in an airport waiting for a flight in an hour or so.</p>



<a name="465044092"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Task%20as%20a%20built-in/near/465044092" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Task.20as.20a.20built-in.html#465044092">(Aug 25 2024 at 21:25)</a>:</h4>
<p>Sure</p>



<a name="465044401"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Task%20as%20a%20built-in/near/465044401" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Task.20as.20a.20built-in.html#465044401">(Aug 25 2024 at 21:31)</a>:</h4>
<p><span class="user-mention" data-user-id="515757">@Luke Boswell</span> I left a few comments a couple days ago, but it's otherwise good, and now approved</p>



<a name="465046819"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Task%20as%20a%20built-in/near/465046819" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Task.20as.20a.20built-in.html#465046819">(Aug 25 2024 at 22:21)</a>:</h4>
<p><span class="user-mention" data-user-id="461444">@Sam Mohr</span> </p>
<p>Any chance you can attempt to produce an error if a platform tasks has an unbound <code>[]</code> or <code>*</code>? Like preferably we would automatically generate the mapping I mentioned about to avoid accidentally expanding types, but this is definitely a case where it will easily lead to bugs and forces platforms to have worse apis (for example, all of our strings being used as error types for basic CLI instead of tags. That is a terrible API to workaround bugs like this cause by expanding tags).</p>



<a name="465046877"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Task%20as%20a%20built-in/near/465046877" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Task.20as.20a.20built-in.html#465046877">(Aug 25 2024 at 22:22)</a>:</h4>
<p>Let me try to do that once I get through security in 20 minutes</p>



<a name="465046881"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Task%20as%20a%20built-in/near/465046881" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Task.20as.20a.20built-in.html#465046881">(Aug 25 2024 at 22:22)</a>:</h4>
<p>Like landing this with the edge cases is fine, but I really think we need a proper fix here. At a minimum we really need proper errors to guide a platform author</p>



<a name="465046909"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Task%20as%20a%20built-in/near/465046909" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Task.20as.20a.20built-in.html#465046909">(Aug 25 2024 at 22:23)</a>:</h4>
<p>Yeah, I was internally worried about the PR size, but it's already so big, why not make it cleaner to avoid more and more breaking changes</p>



<a name="465047268"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Task%20as%20a%20built-in/near/465047268" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Task.20as.20a.20built-in.html#465047268">(Aug 25 2024 at 22:30)</a>:</h4>
<p><span class="user-mention silent" data-user-id="343810">Brendan Hansknecht</span> <a href="#narrow/stream/316715-contributing/topic/Task.20as.20a.20built-in/near/465046819">said</a>:</p>
<blockquote>
<p>for example, all of our strings being used as error types for basic CLI instead of tags. That is a terrible API to workaround bugs like this cause by expanding tags).</p>
</blockquote>
<p>Can we please break this into a separate branch and PR? (on top of builtin-task)</p>
<p>I've got everything happy on the builtin-task branch, and we can merge this later as a non-breaking change in roc. </p>
<p>Not a big problem, just have to do another round of nix flake updates and running all the tests.</p>



<a name="465047357"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Task%20as%20a%20built-in/near/465047357" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Task.20as.20a.20built-in.html#465047357">(Aug 25 2024 at 22:33)</a>:</h4>
<p>It seems like just waiting for everything to merge would be easier, then. How bad would doing it right after merging this be, <span class="user-mention" data-user-id="343810">@Brendan Hansknecht</span> ?</p>



<a name="465047565"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Task%20as%20a%20built-in/near/465047565" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Task.20as.20a.20built-in.html#465047565">(Aug 25 2024 at 22:37)</a>:</h4>
<p>Feel free to merge. I just don't want this to be forgotten</p>



<a name="465047635"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Task%20as%20a%20built-in/near/465047635" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Task.20as.20a.20built-in.html#465047635">(Aug 25 2024 at 22:38)</a>:</h4>
<p>It just a really easy edge to hit and the worse part is the platform author may not be aware the bug exists until a user writes complex enough code to break things</p>



<a name="465047682"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Task%20as%20a%20built-in/near/465047682" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Task.20as.20a.20built-in.html#465047682">(Aug 25 2024 at 22:39)</a>:</h4>
<p>I will DEFINITELY handle it in the next 48 hours</p>



<a name="465047887"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Task%20as%20a%20built-in/near/465047887" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Task.20as.20a.20built-in.html#465047887">(Aug 25 2024 at 22:43)</a>:</h4>
<p>Anton will be online in 12hrs or so... if the PR is merging into the builtin-task branch he may be able to include it in the release. We will need a pre-release of basic-cli first anyway before either of the roc PR's could pass CI.</p>
<p>My thoughts are if we keep it in a separate branch/PR then Anton can decide what will be easiest.</p>
<p>For similar changes (against breaking releases) he has asked me to do it this way.</p>



<a name="465048022"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Task%20as%20a%20built-in/near/465048022" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Task.20as.20a.20built-in.html#465048022">(Aug 25 2024 at 22:45)</a>:</h4>
<p>Okay, on it</p>



<a name="465080223"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Task%20as%20a%20built-in/near/465080223" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Task.20as.20a.20built-in.html#465080223">(Aug 26 2024 at 04:37)</a>:</h4>
<p>I think I found a blocking issue, just looking into it now. It only comes up when you go to build a URL package for the platform. </p>
<p>Maybe we should add a check in our CI for this on basic-cli/webserver (just using .tar.gz). </p>
<div class="codehilite"><pre><span></span><code>14:34:04 ~/Documents/GitHub/basic-webserver release $ roc build --bundle .tar.br platform/main.roc
Compressing with Brotli at maximum quality level…

(Note: Brotli compression can take awhile! Using --bundle .tar.gz takes less time, but usually produces a significantly larger output file. Brotli is generally worth the up-front wait if this is a file people will be downloading!)

thread &#39;main&#39; panicked at crates/packaging/src/tarball.rs:279:9:
not yet implemented
note: run with `RUST_BACKTRACE=1` environment variable to display a backtrace
</code></pre></div>



<a name="465080305"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Task%20as%20a%20built-in/near/465080305" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Task.20as.20a.20built-in.html#465080305">(Aug 26 2024 at 04:38)</a>:</h4>
<p>Blocking, but seemingly unrelated. Do you disagree?</p>



<a name="465080324"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Task%20as%20a%20built-in/near/465080324" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Task.20as.20a.20built-in.html#465080324">(Aug 26 2024 at 04:38)</a>:</h4>
<p>That seems like a good thing to test, unless it would significantly lengthen our CI testing wait</p>



<a name="465080457"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Task%20as%20a%20built-in/near/465080457" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Task.20as.20a.20built-in.html#465080457">(Aug 26 2024 at 04:39)</a>:</h4>
<p>Well it has to be related I think, it's a panic when parsing a platform module header</p>



<a name="465081930"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Task%20as%20a%20built-in/near/465081930" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Task.20as.20a.20built-in.html#465081930">(Aug 26 2024 at 04:54)</a>:</h4>
<p>Ok, maybe it's not a problem... and I had just done something strange locally</p>



<a name="465082130"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Task%20as%20a%20built-in/near/465082130" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Task.20as.20a.20built-in.html#465082130">(Aug 26 2024 at 04:57)</a>:</h4>
<p>Yeah, sorry I think that was a false alarm.</p>



<a name="465082140"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Task%20as%20a%20built-in/near/465082140" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Task.20as.20a.20built-in.html#465082140">(Aug 26 2024 at 04:57)</a>:</h4>
<p>I must have messed something up with versions of Roc</p>



<a name="465082215"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Task%20as%20a%20built-in/near/465082215" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Task.20as.20a.20built-in.html#465082215">(Aug 26 2024 at 04:58)</a>:</h4>
<p>Yeah, I was gonna point out that you used <code>roc</code>, not <code>/Users/mrcoolguy/roc/target/release/roc</code></p>



<a name="465082262"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Task%20as%20a%20built-in/near/465082262" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Task.20as.20a.20built-in.html#465082262">(Aug 26 2024 at 04:59)</a>:</h4>
<p>Testing that now</p>



<a name="465082274"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Task%20as%20a%20built-in/near/465082274" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Task.20as.20a.20built-in.html#465082274">(Aug 26 2024 at 04:59)</a>:</h4>
<p>Yeah, that was the giveaway actually... because my nix shell normally looks like <code>192-168-1-103:basic-cli luke$</code></p>



<a name="465082296"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Task%20as%20a%20built-in/near/465082296" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Task.20as.20a.20built-in.html#465082296">(Aug 26 2024 at 04:59)</a>:</h4>
<p>So the version of roc I have my OS pointing to is definitely long since out of date</p>



<a name="465082302"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Task%20as%20a%20built-in/near/465082302" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Task.20as.20a.20built-in.html#465082302">(Aug 26 2024 at 04:59)</a>:</h4>
<p>Yep, it broke with global <code>roc</code>, and worked with the Task version</p>



<a name="465082495"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Task%20as%20a%20built-in/near/465082495" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Task.20as.20a.20built-in.html#465082495">(Aug 26 2024 at 05:00)</a>:</h4>
<p>I use rocup, and because of the recent unblocking efforts, the latest binary is from August 23rd</p>



<a name="465082527"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Task%20as%20a%20built-in/near/465082527" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Task.20as.20a.20built-in.html#465082527">(Aug 26 2024 at 05:00)</a>:</h4>
<p>Would recommend <a href="https://github.com/appblue/rocup">rocup</a></p>



<a name="465082653"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Task%20as%20a%20built-in/near/465082653" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Task.20as.20a.20built-in.html#465082653">(Aug 26 2024 at 05:02)</a>:</h4>
<p>I'm switching between branches so much I couldn't imagine doing things without nix now.</p>



<a name="465082717"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Task%20as%20a%20built-in/near/465082717" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Task.20as.20a.20built-in.html#465082717">(Aug 26 2024 at 05:02)</a>:</h4>
<p>That's the way to be, yes</p>



<a name="465082761"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Task%20as%20a%20built-in/near/465082761" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Task.20as.20a.20built-in.html#465082761">(Aug 26 2024 at 05:03)</a>:</h4>
<p>Not to get <em>too</em> off topic, but: I use rocup for general package dev because it's easier, and nix for everything else (e.g. language/platform dev)</p>



<a name="465084535"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Task%20as%20a%20built-in/near/465084535" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Task.20as.20a.20built-in.html#465084535">(Aug 26 2024 at 05:14)</a>:</h4>
<p><a href="https://github.com/lukewilliamboswell/roc-htmx-tailwindcss-demo/pull/1">https://github.com/lukewilliamboswell/roc-htmx-tailwindcss-demo/pull/1</a></p>
<p>Upgraded the roc-htmx-tailwindcss demo app using a release I made and it's working well <span aria-label="smiley" class="emoji emoji-1f603" role="img" title="smiley">:smiley:</span> <img alt=":roc:" class="emoji" src="https://avatars.zulip.com/22008/emoji/images/5f42d943.png" title="roc"></p>



<a name="465085839"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Task%20as%20a%20built-in/near/465085839" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Task.20as.20a.20built-in.html#465085839">(Aug 26 2024 at 05:21)</a>:</h4>
<p>Approved!</p>



<a name="465090245"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Task%20as%20a%20built-in/near/465090245" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Task.20as.20a.20built-in.html#465090245">(Aug 26 2024 at 05:59)</a>:</h4>
<p>I'm trying to update rtl to builtin task.. and seeing a cryptic type error that may or may not be related...</p>
<div class="codehilite"><pre><span></span><code>15:58:55 ~/Documents/GitHub/rtl builtin-task $ roc check rtl.roc

── TYPE MISMATCH in rtl.roc ────────────────────────────────────────────────────

This 1st argument to this function has an unexpected type:

1│  app [main] {


This Utc.now value is a:

    ({} -&gt; Task Utc.Utc *)

But this function needs its 1st argument to be:

    Task a b

Tip: Add type annotations to functions or values to help you figure
this out.

────────────────────────────────────────────────────────────────────────────────

1 error and 14 warnings found in 48 ms
</code></pre></div>



<a name="465090317"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Task%20as%20a%20built-in/near/465090317" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Task.20as.20a.20built-in.html#465090317">(Aug 26 2024 at 06:00)</a>:</h4>
<div class="codehilite"><pre><span></span><code>main =

    start = Utc.now! {}

    cliParser =
        { Cli.combine &lt;-
    &lt;---- snipped----&gt;
</code></pre></div>



<a name="465092405"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Task%20as%20a%20built-in/near/465092405" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Task.20as.20a.20built-in.html#465092405">(Aug 26 2024 at 06:17)</a>:</h4>
<p>The implication there is that the desugaring for the ! bangs are not adding regions, so they show their type errors at the start of the document</p>



<a name="465092521"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Task%20as%20a%20built-in/near/465092521" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Task.20as.20a.20built-in.html#465092521">(Aug 26 2024 at 06:18)</a>:</h4>
<p>If you add explicit annotations to the definitions, do you see anything more helpful?</p>



<a name="465093548"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Task%20as%20a%20built-in/near/465093548" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Task.20as.20a.20built-in.html#465093548">(Aug 26 2024 at 06:26)</a>:</h4>
<p>It doesn't really help</p>
<div class="codehilite"><pre><span></span><code>main : Task {} [Exit I32 Str]_
main =

    start : Utc
    start = Utc.now! {}

    cliParser : Cli.CliParser { maybeInputDir : _, maybeOutputDir : _, maybeExtension : _  }
    cliParser =
        { Cli.combine &lt;-
</code></pre></div>



<a name="465093571"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Task%20as%20a%20built-in/near/465093571" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Task.20as.20a.20built-in.html#465093571">(Aug 26 2024 at 06:27)</a>:</h4>
<div class="codehilite"><pre><span></span><code>$ roc check rtl.roc

── TYPE MISMATCH in rtl.roc ────────────────────────────────────────────────────

This 1st argument to this function has an unexpected type:

1│  app [main] {


This Utc.now value is a:

    ({} -&gt; Task Utc.Utc *)

But this function needs its 1st argument to be:

    Task a b

Tip: Add type annotations to functions or values to help you figure
this out.

────────────────────────────────────────────────────────────────────────────────

1 error and 14 warnings found in 46 ms
</code></pre></div>



<a name="465093769"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Task%20as%20a%20built-in/near/465093769" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Task.20as.20a.20built-in.html#465093769">(Aug 26 2024 at 06:28)</a>:</h4>
<p>I'll check it out</p>



<a name="465095717"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Task%20as%20a%20built-in/near/465095717" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Task.20as.20a.20built-in.html#465095717">(Aug 26 2024 at 06:43)</a>:</h4>
<p>There's another <code>Utc.now!</code> on line 94 that needs <code>{}</code> as an arg</p>



<a name="465095731"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Task%20as%20a%20built-in/near/465095731" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Task.20as.20a.20built-in.html#465095731">(Aug 26 2024 at 06:44)</a>:</h4>
<p><span class="user-mention" data-user-id="515757">@Luke Boswell</span></p>



<a name="465096600"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Task%20as%20a%20built-in/near/465096600" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Task.20as.20a.20built-in.html#465096600">(Aug 26 2024 at 06:50)</a>:</h4>
<p><span aria-label="sweat smile" class="emoji emoji-1f605" role="img" title="sweat smile">:sweat_smile:</span></p>



<a name="465096656"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Task%20as%20a%20built-in/near/465096656" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Task.20as.20a.20built-in.html#465096656">(Aug 26 2024 at 06:51)</a>:</h4>
<p>Oh man, I'd really like regions in that error message</p>



<a name="465096772"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Task%20as%20a%20built-in/near/465096772" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Task.20as.20a.20built-in.html#465096772">(Aug 26 2024 at 06:52)</a>:</h4>
<p>Yeah...</p>



<a name="465254132"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Task%20as%20a%20built-in/near/465254132" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anton <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Task.20as.20a.20built-in.html#465254132">(Aug 26 2024 at 18:54)</a>:</h4>
<p>PRs have been reviewed, I'll build the TESTING release tomorrow <span aria-label="rocket" class="emoji emoji-1f680" role="img" title="rocket">:rocket:</span></p>



<a name="465278362"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Task%20as%20a%20built-in/near/465278362" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Task.20as.20a.20built-in.html#465278362">(Aug 26 2024 at 22:06)</a>:</h4>
<p>I've made the requested changes on the PR, we're looking good</p>



<a name="465527145"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Task%20as%20a%20built-in/near/465527145" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anton <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Task.20as.20a.20built-in.html#465527145">(Aug 27 2024 at 18:18)</a>:</h4>
<p>I ran into <code>No borrow signature for LambdaName</code> on <code>roc build ./examples/Tasks/main.roc</code>when testing the examples with the latest basic-cli pre-release.<br>
I'm done for today, so feel free to take a stab at it</p>



<a name="465527317"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Task%20as%20a%20built-in/near/465527317" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Task.20as.20a.20built-in.html#465527317">(Aug 27 2024 at 18:20)</a>:</h4>
<p>I'll check it out later</p>



<a name="465527730"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Task%20as%20a%20built-in/near/465527730" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anton <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Task.20as.20a.20built-in.html#465527730">(Aug 27 2024 at 18:22)</a>:</h4>
<p>I forgot to do <code>roc check</code>, I need to add that to the error message:</p>
<div class="codehilite"><pre><span></span><code>❯ roc check ./examples/Tasks/main.roc

── TYPE MISMATCH in ./examples/Tasks/main.roc ──────────────────────────────────

This 1st argument to this function has an unexpected type:

21│      startTime = Utc.now!
                     ^^^^^^^^

This Utc.now value is a:

    ({} -&gt; Task Utc.Utc *)

But this function needs its 1st argument to be:

    Task a b

Tip: Add type annotations to functions or values to help you figure
this out.


── TYPE MISMATCH in ./examples/Tasks/main.roc ──────────────────────────────────

This 1st argument to this function has an unexpected type:

47│      endTime = Utc.now!
                   ^^^^^^^^

This Utc.now value is a:

    ({} -&gt; Task Utc.Utc *)

But this function needs its 1st argument to be:

    Task a b

Tip: Add type annotations to functions or values to help you figure
this out.

────────────────────────────────────────────────────────────────────────────────

2 errors and 0 warnings found in 67 ms
</code></pre></div>
<p>I think I saw a similar issue recently, but I can't find it anymore</p>



<a name="465527879"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Task%20as%20a%20built-in/near/465527879" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Task.20as.20a.20built-in.html#465527879">(Aug 27 2024 at 18:23)</a>:</h4>
<p>Easy fix, just add a {} because they're thunks</p>



<a name="465527885"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Task%20as%20a%20built-in/near/465527885" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Task.20as.20a.20built-in.html#465527885">(Aug 27 2024 at 18:23)</a>:</h4>
<p>I can do it</p>



<a name="465528153"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Task%20as%20a%20built-in/near/465528153" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anton <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Task.20as.20a.20built-in.html#465528153">(Aug 27 2024 at 18:25)</a>:</h4>
<p>Haha, I glossed over the tip (I wrote that one too :p ):</p>
<div class="codehilite"><pre><span></span><code>Tip: This can happen when you call a function with less arguments than it expects.
        Like `Arg.list!` instead of `Arg.list! {}`
</code></pre></div>



<a name="465530573"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Task%20as%20a%20built-in/near/465530573" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Task.20as.20a.20built-in.html#465530573">(Aug 27 2024 at 18:40)</a>:</h4>
<p>Could someone actually give me contributor access for <a href="https://github.com/roc-lang/examples/pulls">roc/examples</a>?</p>



<a name="465530645"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Task%20as%20a%20built-in/near/465530645" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Task.20as.20a.20built-in.html#465530645">(Aug 27 2024 at 18:40)</a>:</h4>
<p>I don't believe I can help with this PR without it</p>



<a name="465543434"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Task%20as%20a%20built-in/near/465543434" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Task.20as.20a.20built-in.html#465543434">(Aug 27 2024 at 19:33)</a>:</h4>
<p>done!</p>



<a name="465549680"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Task%20as%20a%20built-in/near/465549680" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Task.20as.20a.20built-in.html#465549680">(Aug 27 2024 at 19:58)</a>:</h4>
<p>Thanks!</p>



<a name="466320535"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Task%20as%20a%20built-in/near/466320535" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anton <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Task.20as.20a.20built-in.html#466320535">(Aug 30 2024 at 18:12)</a>:</h4>
<p>It's nice that hello world is now shorter and also does not contain a new concept (for beginners) <code>Task</code>:</p>
<div class="codehilite" data-code-language="Haskell"><pre><span></span><code><span class="nf">app</span><span class="w"> </span><span class="p">[</span><span class="n">main</span><span class="p">]</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">pf</span><span class="kt">:</span><span class="w"> </span><span class="n">platform</span><span class="w"> </span><span class="s">"https://github.com/roc-lang/basic-cli/releases/download/0.15.0/SlwdbJ-3GR7uBWQo6zlmYWNYOxnvo8r6YABXD-45UOw.tar.br"</span><span class="w"> </span><span class="p">}</span>

<span class="kr">import</span><span class="w"> </span><span class="nn">pf.Stdout</span>

<span class="nf">main</span><span class="w"> </span><span class="ow">=</span>
<span class="w">    </span><span class="kt">Stdout</span><span class="o">.</span><span class="n">line</span><span class="o">!</span><span class="w"> </span><span class="s">"Hello, World!"</span>
</code></pre></div>



<hr><p>Last updated: Nov 01 2025 at 12:13 UTC</p>
</html>