<html>
<head><meta charset="utf-8"><title>basic-cli roc_fx_stdoutLine · contributing · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/index.html">contributing</a></h2>
<h3>Topic: <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20roc_fx_stdoutLine.html">basic-cli roc_fx_stdoutLine</a></h3>

<hr>

<base href="https://roc.zulipchat.com">

<head><link href="https://roc-lang.github.io/zulip-export/style.css" rel="stylesheet"></head>

<a name="481224941"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20roc_fx_stdoutLine/near/481224941" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20roc_fx_stdoutLine.html#481224941">(Nov 08 2024 at 01:08)</a>:</h4>
<p>I'm looking for some assistance with this solution... </p>
<div class="codehilite"><pre><span></span><code>app [main] {
    pf: platform &quot;https://github.com/roc-lang/basic-cli/releases/download/0.15.0/SlwdbJ-3GR7uBWQo6zlmYWNYOxnvo8r6YABXD-45UOw.tar.br&quot;,
    aoc: &quot;https://github.com/lukewilliamboswell/aoc-template/releases/download/0.1.0/DcTQw_U67F22cX7pgx93AcHz_ShvHRaFIFjcijF3nz0.tar.br&quot;,
}

import pf.Stdin
import pf.Stdout
import pf.Utc
import aoc.AoC {
    stdin: Stdin.bytes,
    stdout: Stdout.write,
    time: \{} -&gt; Utc.now {} |&gt; Task.map Utc.toMillisSinceEpoch,
}

main =
    AoC.solve {
        year: 2020,
        day: 1,
        title: &quot;Report Repair&quot;,
        part1,
        part2,
    }

part1 : Str -&gt; Result Str Str
part1 = \input -&gt;

    numbers : List U128
    numbers = parse input

    combined : List { x : U128, y : U128, mul : U128 }
    combined =
        List.joinMap numbers \x -&gt;
            List.keepOks numbers \y -&gt;
                if (x + y) == 2020 then
                    Ok { x, y, mul: x * y }
                else
                    Err NotValid

    combined
    |&gt; List.first
    |&gt; Result.map \{ x, y, mul } -&gt; &quot;$(Num.toStr x) * $(Num.toStr y) = $(Num.toStr mul)&quot;
    |&gt; Result.mapErr \_ -&gt; &quot;Expected at least one pair to have sum of 2020&quot;

part2 : Str -&gt; Result Str Str
part2 = \input -&gt;

    numbers : List U128
    numbers = parse input

    combined : List { x : U128, y : U128, z : U128, mul : U128 }
    combined =
        List.joinMap numbers \x -&gt;
            List.joinMap numbers \y -&gt;
                List.keepOks numbers \z -&gt;
                    if (x + y + z) == 2020 then
                        Ok { x, y, z, mul: x * y * z }
                    else
                        Err NotValid

    combined
    |&gt; List.first
    |&gt; Result.map \{ x, y, z, mul } -&gt; &quot;$(Num.toStr x) * $(Num.toStr y) * $(Num.toStr z) = $(Num.toStr mul)&quot;
    |&gt; Result.mapErr \_ -&gt; &quot;Expected at least one triple to have sum of 2020&quot;

parse : Str -&gt; List U128
parse = \input -&gt;
    input
    |&gt; Str.split &quot;\n&quot;
    |&gt; List.keepOks Str.toU128

expect
    result = part1 example
    result == Ok &quot;1721 * 299 = 514579&quot;

expect
    result = part2 example
    result == Ok &quot;979 * 366 * 675 = 241861950&quot;

expect parse example == [1721, 979, 366, 299, 675, 1456]

example =
    &quot;&quot;&quot;
    1721
    979
    366
    299
    675
    1456
    &quot;&quot;&quot;
</code></pre></div>
<div class="codehilite"><pre><span></span><code>$ roc --optimize 2020/01.roc &lt; input/2020_01.txt
--- ADVENT OF CODE 2020-1: Report Repair ---

INPUT:
Reading input from STDIN...

PART 1:
1939 * 81 = 157059

PART 2 ERROR:
&quot;Expected at least one triple to have sum of 2020&quot;

TIMING:
READING INPUT:  &lt;1ms
SOLVING PART 1: &lt;1ms
SOLVING PART 2: 4ms
---
</code></pre></div>
<p>For some reason I can't get the correct answer for Part 2... and I'm really scratching my head trying to figure out what is wrong here.</p>



<a name="481225028"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20roc_fx_stdoutLine/near/481225028" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20roc_fx_stdoutLine.html#481225028">(Nov 08 2024 at 01:09)</a>:</h4>
<p>I'm going through an upgrading my solutions to use latest Roc, so people can use these as examples for ideas. But this one has me stumped. <span aria-label="sweat smile" class="emoji emoji-1f605" role="img" title="sweat smile">:sweat_smile:</span></p>



<a name="481225093"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20roc_fx_stdoutLine/near/481225093" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20roc_fx_stdoutLine.html#481225093">(Nov 08 2024 at 01:10)</a>:</h4>
<p>I know what the answer is, I have a simple python script which also gives the correct answer (so I know it's not an issue with my input file).</p>



<a name="481225227"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20roc_fx_stdoutLine/near/481225227" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20roc_fx_stdoutLine.html#481225227">(Nov 08 2024 at 01:12)</a>:</h4>
<p>Oh ... maybe this is a basic-cli issue reading from Stdin</p>



<a name="481225271"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20roc_fx_stdoutLine/near/481225271" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20roc_fx_stdoutLine.html#481225271">(Nov 08 2024 at 01:12)</a>:</h4>
<p>Adding some dbg statements</p>
<div class="codehilite"><pre><span></span><code>parse : Str -&gt; List U128
parse = \input -&gt;
    input
    |&gt; Str.split &quot;\n&quot;
    |&gt; \lines -&gt;
        dbg List.len lines
        lines
    |&gt; List.keepOks Str.toU128
    |&gt; \numbers -&gt;
        dbg List.len numbers
        numbers
</code></pre></div>
<div class="codehilite"><pre><span></span><code>[2020/01.roc:70] List.len lines = 52
[2020/01.roc:74] List.len numbers = 52
</code></pre></div>
<p>I can see only 52 numbers/lines are being parsed when the input file is 200 lines long</p>



<a name="481225422"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20roc_fx_stdoutLine/near/481225422" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20roc_fx_stdoutLine.html#481225422">(Nov 08 2024 at 01:14)</a>:</h4>
<p>Looks like I may have found the issue...</p>
<div class="codehilite"><pre><span></span><code>#[no_mangle]
pub extern &quot;C&quot; fn roc_fx_stdinBytes() -&gt; RocResult&lt;RocList&lt;u8&gt;, ()&gt; {
    let stdin = std::io::stdin();
    let mut buffer: [u8; 256] = [0; 256];

    match stdin.lock().read(&amp;mut buffer) {
        Ok(bytes_read) =&gt; RocResult::ok(RocList::from(&amp;buffer[0..bytes_read])),
        Err(_) =&gt; RocResult::ok(RocList::from(([]).as_slice())),
    }
}
</code></pre></div>



<a name="481434537"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20roc_fx_stdoutLine/near/481434537" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20roc_fx_stdoutLine.html#481434537">(Nov 09 2024 at 06:42)</a>:</h4>
<p>Reading at most 256 bytes....was this effect copied from my false interpreter years ago? I added that restriction to false to force extra io for testing purposes.</p>



<a name="481434959"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20roc_fx_stdoutLine/near/481434959" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20roc_fx_stdoutLine.html#481434959">(Nov 09 2024 at 06:50)</a>:</h4>
<p>I don't have much to go off here... but 256 bytes seems ultra low to me for this kind of thing. It was good to discover though, as it's not the right effect for reading a whole file from stdin.</p>



<a name="481437201"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20roc_fx_stdoutLine/near/481437201" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20roc_fx_stdoutLine.html#481437201">(Nov 09 2024 at 07:26)</a>:</h4>
<p>Yeah, stupidly small intentionally. For basic CLI should be at least 4k, if not 16k</p>



<a name="481437250"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20roc_fx_stdoutLine/near/481437250" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20roc_fx_stdoutLine.html#481437250">(Nov 09 2024 at 07:27)</a>:</h4>
<p>I'll add that change in the purity inference branch <span aria-label="thumbs up" class="emoji emoji-1f44d" role="img" title="thumbs up">:thumbs_up:</span></p>



<a name="481437395"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20roc_fx_stdoutLine/near/481437395" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20roc_fx_stdoutLine.html#481437395">(Nov 09 2024 at 07:29)</a>:</h4>
<p>While I'm there, I'll remove some of the RocStr hacks we've got for handling errors.</p>



<a name="481437584"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20roc_fx_stdoutLine/near/481437584" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20roc_fx_stdoutLine.html#481437584">(Nov 09 2024 at 07:31)</a>:</h4>
<p><span class="user-mention" data-user-id="343810">@Brendan Hansknecht</span> </p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="cp">#[no_mangle]</span>
<span class="k">pub</span><span class="w"> </span><span class="k">extern</span><span class="w"> </span><span class="s">"C"</span><span class="w"> </span><span class="k">fn</span><span class="w"> </span><span class="nf">roc_fx_stdinBytes</span><span class="p">()</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">RocResult</span><span class="o">&lt;</span><span class="n">RocList</span><span class="o">&lt;</span><span class="kt">u8</span><span class="o">&gt;</span><span class="p">,</span><span class="w"> </span><span class="p">()</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="n">BUF_SIZE</span><span class="p">:</span><span class="w"> </span><span class="kt">usize</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">16_384</span><span class="p">;</span><span class="w"> </span><span class="c1">// 16 KiB = 16 * 1024 = 16,384 bytes</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">stdin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="p">::</span><span class="n">io</span><span class="p">::</span><span class="n">stdin</span><span class="p">();</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">buffer</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="kt">u8</span><span class="p">;</span><span class="w"> </span><span class="n">BUF_SIZE</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">BUF_SIZE</span><span class="p">];</span>

<span class="w">    </span><span class="k">match</span><span class="w"> </span><span class="n">stdin</span><span class="p">.</span><span class="n">lock</span><span class="p">().</span><span class="n">read</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="n">buffer</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nb">Ok</span><span class="p">(</span><span class="n">bytes_read</span><span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">RocResult</span><span class="p">::</span><span class="n">ok</span><span class="p">(</span><span class="n">RocList</span><span class="p">::</span><span class="n">from</span><span class="p">(</span><span class="o">&amp;</span><span class="n">buffer</span><span class="p">[</span><span class="mi">0</span><span class="o">..</span><span class="n">bytes_read</span><span class="p">])),</span>
<span class="w">        </span><span class="nb">Err</span><span class="p">(</span><span class="n">_</span><span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">RocResult</span><span class="p">::</span><span class="n">ok</span><span class="p">(</span><span class="n">RocList</span><span class="p">::</span><span class="n">from</span><span class="p">(([]).</span><span class="n">as_slice</span><span class="p">())),</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>



<a name="481437678"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20roc_fx_stdoutLine/near/481437678" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20roc_fx_stdoutLine.html#481437678">(Nov 09 2024 at 07:33)</a>:</h4>
<p>Shouldn't that return Eof at least as an error?</p>



<a name="481437772"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20roc_fx_stdoutLine/near/481437772" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20roc_fx_stdoutLine.html#481437772">(Nov 09 2024 at 07:34)</a>:</h4>
<p>I think end of file returns  <code>Ok</code></p>



<a name="481437802"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20roc_fx_stdoutLine/near/481437802" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20roc_fx_stdoutLine.html#481437802">(Nov 09 2024 at 07:35)</a>:</h4>
<p>There's an <code>ErrorKind::UnexpectedEof</code> </p>
<blockquote>
<p>An error returned when an operation could not be completed because an "end of file" was reached prematurely.<br>
This typically means that an operation could only succeed if it read a particular number of bytes but only a smaller number of bytes could be read.</p>
</blockquote>



<a name="481437900"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20roc_fx_stdoutLine/near/481437900" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20roc_fx_stdoutLine.html#481437900">(Nov 09 2024 at 07:36)</a>:</h4>
<p>I'm going to change that effect to handle errors, this is the set I've got that I think are helpful.</p>
<div class="codehilite"><pre><span></span><code>InternalIOErr : {
    tag : [
        BrokenPipe,
        WouldBlock,
        WriteZero,
        Unsupported,
        Interrupted,
        OutOfMemory,
        UnexpectedEof,
        InvalidInput,
        Other,
    ],
    msg : Str,
}
</code></pre></div>



<a name="481437923"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20roc_fx_stdoutLine/near/481437923" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20roc_fx_stdoutLine.html#481437923">(Nov 09 2024 at 07:37)</a>:</h4>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">impl</span><span class="w"> </span><span class="nb">From</span><span class="o">&lt;</span><span class="n">std</span><span class="p">::</span><span class="n">io</span><span class="p">::</span><span class="n">Error</span><span class="o">&gt;</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">InternalIOErr</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="o">..</span><span class="p">.</span><span class="w"> </span><span class="p">}</span>
</code></pre></div>



<a name="481438034"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20roc_fx_stdoutLine/near/481438034" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20roc_fx_stdoutLine.html#481438034">(Nov 09 2024 at 07:38)</a>:</h4>
<p>I don't think you will ever hit WouldBlock</p>



<a name="481438049"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20roc_fx_stdoutLine/near/481438049" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20roc_fx_stdoutLine.html#481438049">(Nov 09 2024 at 07:39)</a>:</h4>
<p>I've got this same type for all the Stdio effects -- sorry forgot to mention that</p>



<a name="481438065"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20roc_fx_stdoutLine/near/481438065" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20roc_fx_stdoutLine.html#481438065">(Nov 09 2024 at 07:39)</a>:</h4>
<p>Yeah, but basic CLI doesn't support async io</p>



<a name="481438116"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20roc_fx_stdoutLine/near/481438116" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20roc_fx_stdoutLine.html#481438116">(Nov 09 2024 at 07:40)</a>:</h4>
<p>So wouldblock shouldn't ever happen as an error</p>



<a name="481438131"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20roc_fx_stdoutLine/near/481438131" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20roc_fx_stdoutLine.html#481438131">(Nov 09 2024 at 07:40)</a>:</h4>
<p>Also, I wonder what a write zero error is</p>



<a name="481438338"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20roc_fx_stdoutLine/near/481438338" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20roc_fx_stdoutLine.html#481438338">(Nov 09 2024 at 07:43)</a>:</h4>
<p>Just doing a quick review of all the error kinds.. 1 min</p>



<a name="481438638"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20roc_fx_stdoutLine/near/481438638" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20roc_fx_stdoutLine.html#481438638">(Nov 09 2024 at 07:48)</a>:</h4>
<p><a href="https://doc.rust-lang.org/std/io/enum.ErrorKind.html">https://doc.rust-lang.org/std/io/enum.ErrorKind.html</a></p>
<div class="codehilite"><pre><span></span><code>#[non_exhaustive]
pub enum ErrorKind {
    NotFound, // YES
    PermissionDenied, // YES
    ConnectionRefused, // OTHER -- uncommon server related
    ConnectionReset, // OTHER -- uncommon server related
    HostUnreachable, // NO - experimental
    NetworkUnreachable, // NO - experimental
    ConnectionAborted, // OTHER -- uncommon
    NotConnected, // OTHER -- uncommon
    AddrInUse, // OTHER -- uncommon
    AddrNotAvailable, // OTHER -- uncommon
    NetworkDown,  // NO - experimental
    BrokenPipe, // YES - pipe was closed
    AlreadyExists, // YES
    WouldBlock, // OTHER -- async not used in basic-cli
    NotADirectory,  // NO - experimental
    IsADirectory,  // NO - experimental
    DirectoryNotEmpty,  // NO - experimental
    ReadOnlyFilesystem,  // NO - experimental
    FilesystemLoop,  // NO - experimental
    StaleNetworkFileHandle,  // NO - experimental
    InvalidInput,  // NO -- parameter was incorrect, unlikely to be hit
    InvalidData, // NO -- operation parameters were valid, however the error was caused by malformed input data, unlikely to be hit
    TimedOut, // YES -- operation’s timeout expired, causing it to be canceled
    WriteZero, // OTHER -- uncommon
    StorageFull, // NO - experimental
    NotSeekable, // NO - experimental
    FilesystemQuotaExceeded, // NO - experimental
    FileTooLarge, // NO - experimental
    ResourceBusy, // NO - experimental
    ExecutableFileBusy, // NO - experimental
    Deadlock, // NO - experimental
    CrossesDevices, // NO - experimental
    TooManyLinks, // NO - experimental
    InvalidFilename, // NO - experimental
    ArgumentListTooLong, // NO - experimental
    Interrupted, // YES - Interrupted operations can typically be retried
    Unsupported, // YES - operation is unsupported on this platform
    UnexpectedEof, // OTHER - unlikely to be hit
    OutOfMemory, // YES
    Other, // OTHER -- catch all
}
</code></pre></div>
<p>Leaves us with the following...</p>
<div class="codehilite"><pre><span></span><code>RocIOError [
    NotFound, // YES
    PermissionDenied, // YES
    BrokenPipe, // YES - pipe was closed
    AlreadyExists, // YES
    TimedOut, // YES -- operation’s timeout expired, causing it to be canceled
    Interrupted, // YES - Interrupted operations can typically be retried
    Unsupported, // YES - operation is unsupported on this platform
    OutOfMemory, // YES
    ++ OTHER Str for everything else.
]
</code></pre></div>



<a name="481438750"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20roc_fx_stdoutLine/near/481438750" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20roc_fx_stdoutLine.html#481438750">(Nov 09 2024 at 07:50)</a>:</h4>
<p>Is timedout also async io specific?</p>



<a name="481438764"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20roc_fx_stdoutLine/near/481438764" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20roc_fx_stdoutLine.html#481438764">(Nov 09 2024 at 07:50)</a>:</h4>
<p>Also, wow, so many experimental</p>



<a name="481438810"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20roc_fx_stdoutLine/near/481438810" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20roc_fx_stdoutLine.html#481438810">(Nov 09 2024 at 07:51)</a>:</h4>
<p>And otherwise, the list looks good to me</p>



<a name="481439153"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20roc_fx_stdoutLine/near/481439153" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20roc_fx_stdoutLine.html#481439153">(Nov 09 2024 at 07:55)</a>:</h4>
<p><span class="user-mention silent" data-user-id="343810">Brendan Hansknecht</span> <a href="#narrow/channel/316715-contributing/topic/basic-cli.20roc_fx_stdoutLine/near/481438750">said</a>:</p>
<blockquote>
<p>Is timedout also async io specific?</p>
</blockquote>
<p>I'll move it to OTHER category</p>



<a name="481440132"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20roc_fx_stdoutLine/near/481440132" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20roc_fx_stdoutLine.html#481440132">(Nov 09 2024 at 08:10)</a>:</h4>
<p><span class="user-mention" data-user-id="343810">@Brendan Hansknecht</span> </p>
<p>Just looking at this </p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="cp">#[no_mangle]</span>
<span class="k">pub</span><span class="w"> </span><span class="k">extern</span><span class="w"> </span><span class="s">"C"</span><span class="w"> </span><span class="k">fn</span><span class="w"> </span><span class="nf">roc_fx_stdinLine</span><span class="p">()</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">RocResult</span><span class="o">&lt;</span><span class="n">RocStr</span><span class="p">,</span><span class="w"> </span><span class="n">glue</span><span class="p">::</span><span class="n">IOErr</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">stdin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="p">::</span><span class="n">io</span><span class="p">::</span><span class="n">stdin</span><span class="p">();</span>

<span class="w">    </span><span class="k">match</span><span class="w"> </span><span class="n">stdin</span><span class="p">.</span><span class="n">lock</span><span class="p">().</span><span class="n">lines</span><span class="p">().</span><span class="n">next</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nb">None</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">RocResult</span><span class="p">::</span><span class="n">err</span><span class="p">(</span><span class="n">RocStr</span><span class="p">::</span><span class="n">from</span><span class="p">(</span><span class="s">"EOF"</span><span class="p">)),</span>
<span class="w">        </span><span class="nb">Some</span><span class="p">(</span><span class="nb">Ok</span><span class="p">(</span><span class="kt">str</span><span class="p">))</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">RocResult</span><span class="p">::</span><span class="n">ok</span><span class="p">(</span><span class="n">RocStr</span><span class="p">::</span><span class="n">from</span><span class="p">(</span><span class="kt">str</span><span class="p">.</span><span class="n">as_str</span><span class="p">())),</span>
<span class="w">        </span><span class="nb">Some</span><span class="p">(</span><span class="nb">Err</span><span class="p">(</span><span class="n">io_err</span><span class="p">))</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">RocResult</span><span class="p">::</span><span class="n">err</span><span class="p">(</span><span class="n">io_err</span><span class="p">.</span><span class="n">into</span><span class="p">()),</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>Instead of returning an <code>Err EndOfFile</code> I'm thinking we should return an <code>Ok "EOT"</code> where EOT is the ASCII 04 for end of transmission.</p>



<a name="481440166"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20roc_fx_stdoutLine/near/481440166" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20roc_fx_stdoutLine.html#481440166">(Nov 09 2024 at 08:11)</a>:</h4>
<p>My thoughts are that it's not an error condition, reading has succeeded there is just nothing further to read.</p>



<a name="481440251"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20roc_fx_stdoutLine/near/481440251" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20roc_fx_stdoutLine.html#481440251">(Nov 09 2024 at 08:12)</a>:</h4>
<p>I'm definitely on the fence here... because it would be easy to just return another Err tag for EndOfFile</p>



<a name="481440380"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20roc_fx_stdoutLine/near/481440380" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20roc_fx_stdoutLine.html#481440380">(Nov 09 2024 at 08:14)</a>:</h4>
<p>So like this.. </p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="cp">#[no_mangle]</span>
<span class="k">pub</span><span class="w"> </span><span class="k">extern</span><span class="w"> </span><span class="s">"C"</span><span class="w"> </span><span class="k">fn</span><span class="w"> </span><span class="nf">roc_fx_stdinLine</span><span class="p">()</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">RocResult</span><span class="o">&lt;</span><span class="n">RocStr</span><span class="p">,</span><span class="w"> </span><span class="n">glue</span><span class="p">::</span><span class="n">IOErr</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">stdin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="p">::</span><span class="n">io</span><span class="p">::</span><span class="n">stdin</span><span class="p">();</span>

<span class="w">    </span><span class="k">match</span><span class="w"> </span><span class="n">stdin</span><span class="p">.</span><span class="n">lock</span><span class="p">().</span><span class="n">lines</span><span class="p">().</span><span class="n">next</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nb">None</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">RocResult</span><span class="p">::</span><span class="n">ok</span><span class="p">(</span><span class="s">"</span><span class="se">\x04</span><span class="s">"</span><span class="p">.</span><span class="n">into</span><span class="p">()),</span>
<span class="w">        </span><span class="nb">Some</span><span class="p">(</span><span class="nb">Ok</span><span class="p">(</span><span class="kt">str</span><span class="p">))</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">RocResult</span><span class="p">::</span><span class="n">ok</span><span class="p">(</span><span class="kt">str</span><span class="p">.</span><span class="n">as_str</span><span class="p">().</span><span class="n">into</span><span class="p">()),</span>
<span class="w">        </span><span class="nb">Some</span><span class="p">(</span><span class="nb">Err</span><span class="p">(</span><span class="n">io_err</span><span class="p">))</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">RocResult</span><span class="p">::</span><span class="n">err</span><span class="p">(</span><span class="n">io_err</span><span class="p">.</span><span class="n">into</span><span class="p">()),</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>



<a name="481441360"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20roc_fx_stdoutLine/near/481441360" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20roc_fx_stdoutLine.html#481441360">(Nov 09 2024 at 08:29)</a>:</h4>
<p>I definitely wouldn't return a valid string. that will just confuse users</p>



<a name="481441363"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20roc_fx_stdoutLine/near/481441363" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20roc_fx_stdoutLine.html#481441363">(Nov 09 2024 at 08:29)</a>:</h4>
<p>It needs to be a tag of some sort</p>



<a name="481441373"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20roc_fx_stdoutLine/near/481441373" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20roc_fx_stdoutLine.html#481441373">(Nov 09 2024 at 08:29)</a>:</h4>
<p>It can be in the ok tag, but that is probably less convenient than putting it in the error tag</p>



<a name="481441442"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20roc_fx_stdoutLine/near/481441442" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20roc_fx_stdoutLine.html#481441442">(Nov 09 2024 at 08:30)</a>:</h4>
<p>I do agree that it generally isn't an actual error</p>



<a name="481441551"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20roc_fx_stdoutLine/near/481441551" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20roc_fx_stdoutLine.html#481441551">(Nov 09 2024 at 08:32)</a>:</h4>
<p>This is how I was thinking of handling it in the example</p>
<div class="codehilite"><pre><span></span><code>when Stdin.line! {} is

    # End of Transmission (EOT) / File (EOF)
    Ok str if str == &quot;\x04&quot; -&gt;
        try Stdout.line! (echo &quot;Received end of input.&quot;)
        Ok {}

    Ok str -&gt;
        try Stdout.line! (echo str)
        tick! {}

    Err (StdinErr err) -&gt;
        try Stdout.line! (echo &quot;Unable to read input $(Inspect.toStr err)&quot;)
        Ok {}
</code></pre></div>



<a name="481441595"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20roc_fx_stdoutLine/near/481441595" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20roc_fx_stdoutLine.html#481441595">(Nov 09 2024 at 08:33)</a>:</h4>
<p>But I think a tag is clearer</p>



<a name="481442374"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20roc_fx_stdoutLine/near/481442374" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20roc_fx_stdoutLine.html#481442374">(Nov 09 2024 at 08:46)</a>:</h4>
<p>Found an API that feels nice</p>
<div class="codehilite"><pre><span></span><code>line! : {} =&gt; Result Str [EndOfFile, StdinErr Err]
bytes! : {} =&gt; Result (List U8) [StdinErr Err]
readToEnd! : {} =&gt; Result (List U8) [StdinErr Err]
</code></pre></div>



<a name="481451458"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20roc_fx_stdoutLine/near/481451458" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anton <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20roc_fx_stdoutLine.html#481451458">(Nov 09 2024 at 11:16)</a>:</h4>
<p>It feels a bit weird to put <code>EndOfFile</code> in the error group of the Result.</p>



<a name="481471456"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20roc_fx_stdoutLine/near/481471456" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20roc_fx_stdoutLine.html#481471456">(Nov 09 2024 at 15:50)</a>:</h4>
<p>I feel like this was iterated on before. We had Eof in the ok side. Even though it technically makes more sense, it is less convenient to use in general.</p>



<a name="481471497"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20roc_fx_stdoutLine/near/481471497" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20roc_fx_stdoutLine.html#481471497">(Nov 09 2024 at 15:51)</a>:</h4>
<p>Also, bytes vs read to end feels a bit strange</p>



<a name="481471506"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20roc_fx_stdoutLine/near/481471506" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20roc_fx_stdoutLine.html#481471506">(Nov 09 2024 at 15:51)</a>:</h4>
<p>Shouldn't it just be read and read to end?</p>



<a name="481472823"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20roc_fx_stdoutLine/near/481472823" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anton <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20roc_fx_stdoutLine.html#481472823">(Nov 09 2024 at 16:08)</a>:</h4>
<blockquote>
<p>I feel like this was iterated on before.</p>
</blockquote>
<p>Yeah, me too but I could not find it on github</p>



<hr><p>Last updated: Nov 01 2025 at 12:13 UTC</p>
</html>