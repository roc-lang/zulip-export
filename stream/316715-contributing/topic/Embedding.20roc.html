<html>
<head><meta charset="utf-8"><title>Embedding roc · contributing · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/index.html">contributing</a></h2>
<h3>Topic: <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Embedding.20roc.html">Embedding roc</a></h3>

<hr>

<base href="https://roc.zulipchat.com">

<head><link href="https://roc-lang.github.io/zulip-export/style.css" rel="stylesheet"></head>

<a name="399043580"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Embedding%20roc/near/399043580" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Murariu Fabian <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Embedding.20roc.html#399043580">(Oct 28 2023 at 11:56)</a>:</h4>
<p>I've been looking for a small typed language that I could embed in rust, I'm aware gluon exists but I'd like it to be compiled and interop easily with rust. Could that be possible with roc? And if so where would I start looking to make it happen?</p>



<a name="399048359"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Embedding%20roc/near/399048359" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Carroll <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Embedding.20roc.html#399048359">(Oct 28 2023 at 12:54)</a>:</h4>
<p>Yes! We have a "platforms and applications" model where Roc is the application and Rust can implement the platform. In fact it's the most common choice.<br>
Have a look in the examples directory in the main Roc repo. And the basic-cli repo. Both under roc-lang on GitHub.</p>



<a name="399050440"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Embedding%20roc/near/399050440" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Embedding.20roc.html#399050440">(Oct 28 2023 at 13:18)</a>:</h4>
<p>yeah roc is designed to be easy to call from other languages, and actually Rust is currently the best-supported one <span aria-label="smiley" class="emoji emoji-1f603" role="img" title="smiley">:smiley:</span></p>



<a name="399050482"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Embedding%20roc/near/399050482" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Embedding.20roc.html#399050482">(Oct 28 2023 at 13:19)</a>:</h4>
<p>we don't yet have good documentation on how to do it, though - but happy to answer questions here and help you get started!</p>



<a name="399055988"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Embedding%20roc/near/399055988" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Murariu Fabian <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Embedding.20roc.html#399055988">(Oct 28 2023 at 14:26)</a>:</h4>
<p>I am a bit confused about the starting point, I'd like to start from rust and generate at runtime a roc program that I can then compile and execute. I'm aware roc has great interop and the notion of platform which fits perfectly with my needs. But I don't see how I could create a roc compiler at runtime from rust then get something like a function that I could call</p>



<a name="399056380"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Embedding%20roc/near/399056380" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Embedding.20roc.html#399056380">(Oct 28 2023 at 14:31)</a>:</h4>
<p>can you say more about what you're building? I'd love to learn more about where the roc program is being generated from!</p>



<a name="399056970"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Embedding%20roc/near/399056970" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Murariu Fabian <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Embedding.20roc.html#399056970">(Oct 28 2023 at 14:38)</a>:</h4>
<p>I'd like to drive query execution from roc, where I'd convert something like Cypher or SQL into roc code. I'd like to avoid having to go as low as LLVM. Admittedly I don't know if there are any advantages vs just vectorised execution. I suppose with roc I'd go via a hybrid approach where roc would drive the underlying rust calls to vectorised functions</p>



<a name="399061531"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Embedding%20roc/near/399061531" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Embedding.20roc.html#399061531">(Oct 28 2023 at 15:28)</a>:</h4>
<p>I'm not familiar with Cypher, but in the case of SQL - would the Rust program be converting SQL into Roc code at runtime and then executing the Roc code on a database?</p>



<a name="399062318"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Embedding%20roc/near/399062318" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Murariu Fabian <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Embedding.20roc.html#399062318">(Oct 28 2023 at 15:39)</a>:</h4>
<p>That's the idea</p>



<a name="399063123"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Embedding%20roc/near/399063123" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Embedding.20roc.html#399063123">(Oct 28 2023 at 15:53)</a>:</h4>
<p>interesting! So what would be the advantage of having generated Roc running on the database instead of SQL? Is the idea that you'd mix handwritten Roc code with Roc code generated from SQL, and run both on the same database?</p>



<a name="399068208"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Embedding%20roc/near/399068208" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Murariu Fabian <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Embedding.20roc.html#399068208">(Oct 28 2023 at 17:07)</a>:</h4>
<p>I think you misunderstood, I'm building a database from scratch and there are 2 ways for query execution (that I care about) one is building an AST from the physical operators and just executing it by tree walking. The other way is compile the physical operators into code that represents what the query needs doing, like <a href="https://15721.courses.cs.cmu.edu/spring2019/papers/19-compilation/p539-neumann.pdf">this</a> or like <a href="https://www.cs.purdue.edu/homes/rompf/papers/tahboub-sigmod18.pdf">this</a></p>



<a name="399069948"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Embedding%20roc/near/399069948" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Embedding.20roc.html#399069948">(Oct 28 2023 at 17:36)</a>:</h4>
<p>Interesting, this definitely could be done with roc, but I am not sure how smoothly it would work currently. Essentially, you would generate the roc code (It would always references the same platform primitives, which is your database). Then you would compile the code to a shared library and load it. Finally, you would just call into/run it.</p>



<a name="399069984"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Embedding%20roc/near/399069984" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Embedding.20roc.html#399069984">(Oct 28 2023 at 17:37)</a>:</h4>
<p>This could be done with the dev backend to avoid llvm, though not sure it would be faster than a tree walking interpretter.</p>



<a name="399070001"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Embedding%20roc/near/399070001" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Embedding.20roc.html#399070001">(Oct 28 2023 at 17:37)</a>:</h4>
<p>Otherwise, you could run llvm fully. That would get you perf, but compilation time may be too long in many cases.</p>



<a name="399070970"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Embedding%20roc/near/399070970" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Murariu Fabian <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Embedding.20roc.html#399070970">(Oct 28 2023 at 17:53)</a>:</h4>
<p>I'm looking at large datasets some queries could take minutes, the reason I'm looking at roc is because I don't want to build the entire thing from scratch just with LLVM</p>



<a name="399071886"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Embedding%20roc/near/399071886" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Embedding.20roc.html#399071886">(Oct 28 2023 at 18:05)</a>:</h4>
<p>Ah, if these queries are super long, then yeah, compilation time shouldn't matter much. Definitely seems doable.</p>



<a name="399073031"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Embedding%20roc/near/399073031" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Murariu Fabian <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Embedding.20roc.html#399073031">(Oct 28 2023 at 18:24)</a>:</h4>
<p>cool, where about would I look to get this going?</p>



<a name="399073050"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Embedding%20roc/near/399073050" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Murariu Fabian <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Embedding.20roc.html#399073050">(Oct 28 2023 at 18:25)</a>:</h4>
<p>as in the roc codebase</p>



<a name="399074064"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Embedding%20roc/near/399074064" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Carroll <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Embedding.20roc.html#399074064">(Oct 28 2023 at 18:41)</a>:</h4>
<p>I think the only thing we have that generates Roc source code is the formatter. It uses the AST which you would need too.</p>



<a name="399074073"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Embedding%20roc/near/399074073" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Carroll <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Embedding.20roc.html#399074073">(Oct 28 2023 at 18:41)</a>:</h4>
<p>I'll try to find some links for you</p>



<a name="399074161"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Embedding%20roc/near/399074161" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Carroll <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Embedding.20roc.html#399074161">(Oct 28 2023 at 18:42)</a>:</h4>
<p><a href="https://github.com/roc-lang/roc/blob/main/crates/cli/src/format.rs">https://github.com/roc-lang/roc/blob/main/crates/cli/src/format.rs</a></p>



<a name="399074409"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Embedding%20roc/near/399074409" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Carroll <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Embedding.20roc.html#399074409">(Oct 28 2023 at 18:46)</a>:</h4>
<p><a href="https://github.com/roc-lang/roc/blob/main/crates/compiler/fmt/src/lib.rs">https://github.com/roc-lang/roc/blob/main/crates/compiler/fmt/src/lib.rs</a></p>



<a name="399074504"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Embedding%20roc/near/399074504" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Carroll <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Embedding.20roc.html#399074504">(Oct 28 2023 at 18:48)</a>:</h4>
<p><a href="https://github.com/roc-lang/roc/blob/main/crates/compiler/parse/src/lib.rs">https://github.com/roc-lang/roc/blob/main/crates/compiler/parse/src/lib.rs</a></p>



<a name="399075582"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Embedding%20roc/near/399075582" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Embedding.20roc.html#399075582">(Oct 28 2023 at 19:05)</a>:</h4>
<p>Oh, I was thinking he would just textually generate roc source code in rust, but I guess it could also be done in a more structured way</p>



<a name="399075649"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Embedding%20roc/near/399075649" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Embedding.20roc.html#399075649">(Oct 28 2023 at 19:06)</a>:</h4>
<p>As for the other stuff, I think the closest we have to an example currently is in tests. In some tests we compile to a shared library and loading in rust to text the roc compiler is working.</p>



<a name="399075706"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Embedding%20roc/near/399075706" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Embedding.20roc.html#399075706">(Oct 28 2023 at 19:07)</a>:</h4>
<p>But fundamentally you would be compiling roc with <code>--lib</code> and directly using the shared library</p>



<a name="399076472"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Embedding%20roc/near/399076472" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Embedding.20roc.html#399076472">(Oct 28 2023 at 19:20)</a>:</h4>
<p>In general, I would advise first making sure you know how to use <code>libloading</code> and executing code from a shared library in rust.</p>



<a name="399076479"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Embedding%20roc/near/399076479" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Embedding.20roc.html#399076479">(Oct 28 2023 at 19:20)</a>:</h4>
<p>Then switch to using a roc shared library</p>



<a name="399076488"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Embedding%20roc/near/399076488" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Embedding.20roc.html#399076488">(Oct 28 2023 at 19:20)</a>:</h4>
<p>then add in the roc codegen part.</p>



<a name="399077489"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Embedding%20roc/near/399077489" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Murariu Fabian <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Embedding.20roc.html#399077489">(Oct 28 2023 at 19:38)</a>:</h4>
<p>thanks, I'll have a look at the AST, I was hoping to find some tests that use the AST, <code>libloading</code> is still a mystery to me</p>



<hr><p>Last updated: Mar 01 2026 at 12:20 UTC</p>
</html>