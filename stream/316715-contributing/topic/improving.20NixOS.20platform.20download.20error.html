<html>
<head><meta charset="utf-8"><title>improving NixOS platform download error · contributing · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/index.html">contributing</a></h2>
<h3>Topic: <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/improving.20NixOS.20platform.20download.20error.html">improving NixOS platform download error</a></h3>

<hr>

<base href="https://roc.zulipchat.com">

<head><link href="https://roc-lang.github.io/zulip-export/style.css" rel="stylesheet"></head>

<a name="323686287"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/improving%20NixOS%20platform%20download%20error/near/323686287" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> dank <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/improving.20NixOS.20platform.20download.20error.html#323686287">(Jan 26 2023 at 10:43)</a>:</h4>
<p>Heyy, I want to make my first contribution. I went through the good-first-issues and saw <a href="https://github.com/roc-lang/roc/issues/4751">https://github.com/roc-lang/roc/issues/4751</a> which I think is fitting (this is even the one of the first issues I ran into as a NixOS user lol).</p>
<p>So my main question is about error reporting; I see a lot of stuff in the reporting crate but not sure- should I use some custom error or just eprintln my error and exit process with code 1?</p>
<p>And also as a sanity check question- my plan is to check if cfg unix, if it is then check if NixOS is in uname -a, if so exit with &lt;maybe custom roc error&gt;, is that ok?</p>



<a name="323715845"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/improving%20NixOS%20platform%20download%20error/near/323715845" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/improving.20NixOS.20platform.20download.20error.html#323715845">(Jan 26 2023 at 13:17)</a>:</h4>
<p>hm I think that issue may be obsolete, since we figured out a way to make them work (at least in theory - haven't applied it yet!)</p>



<a name="323716192"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/improving%20NixOS%20platform%20download%20error/near/323716192" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/improving.20NixOS.20platform.20download.20error.html#323716192">(Jan 26 2023 at 13:18)</a>:</h4>
<p>but <span class="user-mention" data-user-id="583319">@dank</span> maybe you'd like to give the fix a shot? The idea is to have the <code>basic-cli</code> platform statically link musl instead of dynamically linking glibc on Linux, which should make it work on Nix</p>



<a name="323722011"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/improving%20NixOS%20platform%20download%20error/near/323722011" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> dank <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/improving.20NixOS.20platform.20download.20error.html#323722011">(Jan 26 2023 at 13:43)</a>:</h4>
<p>Ah yes I would. I hope I wont get in over my head but I'll give it a shot <span aria-label="+1" class="emoji emoji-1f44d" role="img" title="+1">:+1:</span></p>



<a name="323725569"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/improving%20NixOS%20platform%20download%20error/near/323725569" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> dank <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/improving.20NixOS.20platform.20download.20error.html#323725569">(Jan 26 2023 at 13:58)</a>:</h4>
<p><span class="user-mention" data-user-id="281383">@Richard Feldman</span> wyt about using fhs (<a href="https://nixos.org/manual/nixpkgs/stable/#sec-fhs-environments">https://nixos.org/manual/nixpkgs/stable/#sec-fhs-environments</a>)?</p>



<a name="323745269"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/improving%20NixOS%20platform%20download%20error/near/323745269" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/improving.20NixOS.20platform.20download.20error.html#323745269">(Jan 26 2023 at 15:14)</a>:</h4>
<p>so ideally I'd like to have Roc work the same way on NixOS as it does on other Linux distros, without needing Roc itself to be coupled to nix</p>



<a name="323745420"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/improving%20NixOS%20platform%20download%20error/near/323745420" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/improving.20NixOS.20platform.20download.20error.html#323745420">(Jan 26 2023 at 15:15)</a>:</h4>
<p>as far as I can tell, the best way to achieve that is to have <code>build-cli</code> (and other platforms that want to work on NixOS) use musl instead of glibc!</p>



<a name="323747229"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/improving%20NixOS%20platform%20download%20error/near/323747229" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> dank <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/improving.20NixOS.20platform.20download.20error.html#323747229">(Jan 26 2023 at 15:23)</a>:</h4>
<p>yes tbh you're right it is cleaner</p>



<a name="323749175"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/improving%20NixOS%20platform%20download%20error/near/323749175" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> dank <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/improving.20NixOS.20platform.20download.20error.html#323749175">(Jan 26 2023 at 15:31)</a>:</h4>
<p>So the technical process would be adding musl as a cargo.toml dep on compiler build crate/ making it a target in <a href="https://github.com/roc-lang/roc/blob/main/crates/compiler/build/src/link.rs">https://github.com/roc-lang/roc/blob/main/crates/compiler/build/src/link.rs</a> ? (still finding my way in the codebase)</p>



<a name="323915558"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/improving%20NixOS%20platform%20download%20error/near/323915558" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/improving.20NixOS.20platform.20download.20error.html#323915558">(Jan 26 2023 at 21:48)</a>:</h4>
<p>it should be doable completely in the <a href="https://github.com/roc-lang/basic-cli">https://github.com/roc-lang/basic-cli</a> repo - and yeah something to do with the cargo.toml in there, but I personally don't have any experience setting up a Rust project to use musl, so I don't know exactly what the steps are! (I believe <span class="user-mention" data-user-id="454654">@Ayaz Hafiz</span> has done it before and might have tips?)</p>



<a name="323918454"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/improving%20NixOS%20platform%20download%20error/near/323918454" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ayaz Hafiz <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/improving.20NixOS.20platform.20download.20error.html#323918454">(Jan 26 2023 at 22:08)</a>:</h4>
<p>You have to ask rust to please compile against a musl target (e.g. <code>x86_64-unknown-linux-musl</code>). I don't know the right incantations nix needs in order to do so, afaik basic-cli is build with nix. But yeah if you want to build a musl x86-64 linux binary, it's enough to get on a x86 linux box and do</p>
<div class="codehilite"><pre><span></span><code>cargo build --target x86_64-unknown-linux-musl
</code></pre></div>
<p>You need to do it at the rustc level because you need the musl standard library linked in</p>



<a name="323920088"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/improving%20NixOS%20platform%20download%20error/near/323920088" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> dank <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/improving.20NixOS.20platform.20download.20error.html#323920088">(Jan 26 2023 at 22:19)</a>:</h4>
<p><span class="user-mention silent" data-user-id="454654">Ayaz Hafiz</span> <a href="#narrow/stream/316715-contributing/topic/improving.20NixOS.20platform.20download.20error/near/323918454">said</a>:</p>
<blockquote>
<p>You have to ask rust to please compile against a musl target (e.g. <code>x86_64-unknown-linux-musl</code>). I don't know the right incantations nix needs in order to do so, afaik basic-cli is build with nix. But yeah if you want to build a musl x86-64 linux binary, it's enough to get on a x86 linux box and do</p>
<div class="codehilite"><pre><span></span><code>cargo build --target x86_64-unknown-linux-musl
</code></pre></div>
<p>You need to do it at the rustc level because you need the musl standard library linked in</p>
</blockquote>
<p>yes and I believe you need to first <code>rustup target add x86_64-unknown-linux-musl</code><br>
i saw a way to do that in cargo.toml but it's in unstable : \ <a href="https://doc.rust-lang.org/cargo/reference/unstable.html#per-package-target">https://doc.rust-lang.org/cargo/reference/unstable.html#per-package-target</a></p>



<a name="323939633"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/improving%20NixOS%20platform%20download%20error/near/323939633" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/improving.20NixOS.20platform.20download.20error.html#323939633">(Jan 27 2023 at 01:03)</a>:</h4>
<p>we can make <code>basic-cli</code> use nightly if that's the only way to get musl!</p>



<a name="323989512"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/improving%20NixOS%20platform%20download%20error/near/323989512" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anton <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/improving.20NixOS.20platform.20download.20error.html#323989512">(Jan 27 2023 at 08:31)</a>:</h4>
<p>I believe it should be enough to set the target in <code>basic-cli/src/rust-toolchain.toml</code>.<br>
Exactly like we set the targets value in the roc repo <a href="https://github.com/roc-lang/roc/blob/main/rust-toolchain.toml">here</a>.</p>



<a name="324101490"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/improving%20NixOS%20platform%20download%20error/near/324101490" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> dank <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/improving.20NixOS.20platform.20download.20error.html#324101490">(Jan 27 2023 at 16:43)</a>:</h4>
<p><span class="user-mention silent" data-user-id="361169">Anton</span> <a href="#narrow/stream/316715-contributing/topic/improving.20NixOS.20platform.20download.20error/near/323989512">said</a>:</p>
<blockquote>
<p>I believe it should be enough to set the target in <code>basic-cli/src/rust-toolchain.toml</code>.<br>
Exactly like we set the targets value in the roc repo <a href="https://github.com/roc-lang/roc/blob/main/rust-toolchain.toml">here</a>.</p>
</blockquote>
<p>Thanks. I'm trying to test it. But first can u explain a bit on how you build your <a href="http://tar.br">tar.br</a>?<br>
compressed with brotli right? but how did you build it from the repo?</p>



<a name="324102254"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/improving%20NixOS%20platform%20download%20error/near/324102254" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anton <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/improving.20NixOS.20platform.20download.20error.html#324102254">(Jan 27 2023 at 16:46)</a>:</h4>
<p>Sure :)<br>
You can find the full build process in <a href="https://github.com/roc-lang/roc/blob/main/.github/workflows/basic_cli_build_release.yml">this file</a>.</p>



<a name="324103151"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/improving%20NixOS%20platform%20download%20error/near/324103151" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/improving.20NixOS.20platform.20download.20error.html#324103151">(Jan 27 2023 at 16:50)</a>:</h4>
<p>specifically <code>roc build --bundle=.tar.br</code> is what creates it - <a href="https://github.com/roc-lang/roc/blob/99050956d353aa544a97912bd2f664ab19c9ff98/.github/workflows/basic_cli_build_release.yml#L121">https://github.com/roc-lang/roc/blob/99050956d353aa544a97912bd2f664ab19c9ff98/.github/workflows/basic_cli_build_release.yml#L121</a> - and everything before that is just getting all the files in the same directory so <code>roc build</code> can find them!</p>



<a name="324103460"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/improving%20NixOS%20platform%20download%20error/near/324103460" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/improving.20NixOS.20platform.20download.20error.html#324103460">(Jan 27 2023 at 16:51)</a>:</h4>
<p>you want to use <code>roc build</code> because it also takes care of hashing the .tar.br file at the end, and that hash has to be the filename of the .tar.br file in the URL or else roc won't download it</p>



<a name="324103645"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/improving%20NixOS%20platform%20download%20error/near/324103645" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/improving.20NixOS.20platform.20download.20error.html#324103645">(Jan 27 2023 at 16:52)</a>:</h4>
<p>(it's a hash of the contents of the file and is used as an integrity check to make sure the file hasn't been tampered with in case the URL later gets compromised)</p>



<a name="324104020"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/improving%20NixOS%20platform%20download%20error/near/324104020" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> dank <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/improving.20NixOS.20platform.20download.20error.html#324104020">(Jan 27 2023 at 16:54)</a>:</h4>
<p>thanks!!</p>



<a name="324106065"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/improving%20NixOS%20platform%20download%20error/near/324106065" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anton <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/improving.20NixOS.20platform.20download.20error.html#324106065">(Jan 27 2023 at 17:02)</a>:</h4>
<p>For quick initial testing you probably want to avoid going through the whole bundling process.<br>
Using the basic-cli platform through the path like <a href="https://github.com/roc-lang/roc/blob/99050956d353aa544a97912bd2f664ab19c9ff98/examples/cli/echo.roc#L2">here</a> should work.<br>
I also think we'll need to make a change somewhere in the roc codebase so that the musl target is used to compile the platform, I'm going to check that after dinner.</p>



<a name="324122935"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/improving%20NixOS%20platform%20download%20error/near/324122935" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anton <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/improving.20NixOS.20platform.20download.20error.html#324122935">(Jan 27 2023 at 18:14)</a>:</h4>
<p>So, for testing I think that adding <code>.cargo/config</code> to <code>basic-cli/src</code> should be all that remains, the contents of the file should be:</p>
<div class="codehilite"><pre><span></span><code>[build]
target = &quot;x86_64-unknown-linux-musl&quot;
</code></pre></div>
<p>This will require no changes to the roc codebase.</p>



<a name="324178169"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/improving%20NixOS%20platform%20download%20error/near/324178169" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> dank <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/improving.20NixOS.20platform.20download.20error.html#324178169">(Jan 27 2023 at 23:15)</a>:</h4>
<p><span class="user-mention silent" data-user-id="361169">Anton</span> <a href="#narrow/stream/316715-contributing/topic/improving.20NixOS.20platform.20download.20error/near/324106065">said</a>:</p>
<blockquote>
<p>For quick initial testing you probably want to avoid going through the whole bundling process.<br>
Using the basic-cli platform through the path like <a href="https://github.com/roc-lang/roc/blob/99050956d353aa544a97912bd2f664ab19c9ff98/examples/cli/echo.roc#L2">here</a> should work.<br>
I also think we'll need to make a change somewhere in the roc codebase so that the musl target is used to compile the platform, I'm going to check that after dinner.</p>
</blockquote>
<p>so  I think it's alright and working locally<br>
but I just can't get the ci tests working<br>
 is the build script (ci/build_basic_cli.sh) not working atm or am I doing something dumb<br>
failing with some path caused issues it seems. maybe something's different cz  it's a fork</p>



<a name="324264036"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/improving%20NixOS%20platform%20download%20error/near/324264036" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anton <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/improving.20NixOS.20platform.20download.20error.html#324264036">(Jan 28 2023 at 11:02)</a>:</h4>
<p>I'll take a look today</p>



<a name="324312774"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/improving%20NixOS%20platform%20download%20error/near/324312774" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anton <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/improving.20NixOS.20platform.20download.20error.html#324312774">(Jan 28 2023 at 15:43)</a>:</h4>
<p>@dank, <a href="https://github.com/roc-lang/roc/blob/7a20dfd63088626fee80a5319356f0ce2d6291ff/ci/build_basic_cli.sh">this modified build_basic_cli.sh</a> should work.</p>



<a name="324318030"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/improving%20NixOS%20platform%20download%20error/near/324318030" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> dank <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/improving.20NixOS.20platform.20download.20error.html#324318030">(Jan 28 2023 at 16:18)</a>:</h4>
<p><span class="user-mention silent" data-user-id="361169">Anton</span> <a href="#narrow/stream/316715-contributing/topic/improving.20NixOS.20platform.20download.20error/near/324312774">said</a>:</p>
<blockquote>
<p>@dank, <a href="https://github.com/roc-lang/roc/blob/7a20dfd63088626fee80a5319356f0ce2d6291ff/ci/build_basic_cli.sh">this modified build_basic_cli.sh</a> should work.</p>
</blockquote>
<p>thanks looks good ill test</p>



<a name="324320741"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/improving%20NixOS%20platform%20download%20error/near/324320741" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> dank <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/improving.20NixOS.20platform.20download.20error.html#324320741">(Jan 28 2023 at 16:36)</a>:</h4>
<p><span class="user-mention" data-user-id="361169">@Anton</span> are you sure that <code>[self-hosted, macOS, ARM64]</code> is valid? i suspect  not and that's why it hangs now looking for a runner<br>
(first 2 jobs went great tho)</p>



<a name="324322394"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/improving%20NixOS%20platform%20download%20error/near/324322394" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anton <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/improving.20NixOS.20platform.20download.20error.html#324322394">(Jan 28 2023 at 16:48)</a>:</h4>
<p>That runner is busy with a job of mine, it will probably start on yours after it's done.</p>



<a name="324322700"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/improving%20NixOS%20platform%20download%20error/near/324322700" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> dank <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/improving.20NixOS.20platform.20download.20error.html#324322700">(Jan 28 2023 at 16:50)</a>:</h4>
<p>ohh alright</p>



<a name="324322762"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/improving%20NixOS%20platform%20download%20error/near/324322762" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anton <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/improving.20NixOS.20platform.20download.20error.html#324322762">(Jan 28 2023 at 16:50)</a>:</h4>
<p>Because it is a self-hosted server it can only run on a PR on roc-lang/roc though, where are you running the tests now?</p>



<a name="324329824"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/improving%20NixOS%20platform%20download%20error/near/324329824" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> dank <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/improving.20NixOS.20platform.20download.20error.html#324329824">(Jan 28 2023 at 17:48)</a>:</h4>
<p><span class="user-mention silent" data-user-id="361169">Anton</span> <a href="#narrow/stream/316715-contributing/topic/improving.20NixOS.20platform.20download.20error/near/324322762">said</a>:</p>
<blockquote>
<p>Because it is a self-hosted server it can only run on a PR on roc-lang/roc though, where are you running the tests now?</p>
</blockquote>
<p>hm i changed it to <code>on: [workflow_dispatch]</code> and ran on my roc fork actions</p>



<a name="324329886"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/improving%20NixOS%20platform%20download%20error/near/324329886" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> dank <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/improving.20NixOS.20platform.20download.20error.html#324329886">(Jan 28 2023 at 17:49)</a>:</h4>
<p>can it not just upload it as a release on my fork</p>



<a name="324333188"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/improving%20NixOS%20platform%20download%20error/near/324333188" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anton <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/improving.20NixOS.20platform.20download.20error.html#324333188">(Jan 28 2023 at 18:17)</a>:</h4>
<p>If you have an apple silicon device, you can set it up as an action-runner for your repo. But it'll probably be faster for me to test it. Should I test the main branch on <a href="https://github.com/dankeyy/basic-cli">https://github.com/dankeyy/basic-cli</a>?</p>



<a name="324333396"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/improving%20NixOS%20platform%20download%20error/near/324333396" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> dank <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/improving.20NixOS.20platform.20download.20error.html#324333396">(Jan 28 2023 at 18:19)</a>:</h4>
<p><span class="user-mention silent" data-user-id="361169">Anton</span> <a href="#narrow/stream/316715-contributing/topic/improving.20NixOS.20platform.20download.20error/near/324333188">said</a>:</p>
<blockquote>
<p>If you have an apple silicon device, you can set it up as an action-runner for your repo. But it'll probably be faster for me to test it. Should I test the main branch on <a href="https://github.com/dankeyy/basic-cli">https://github.com/dankeyy/basic-cli</a>?</p>
</blockquote>
<p>yea thanks</p>



<a name="324338559"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/improving%20NixOS%20platform%20download%20error/near/324338559" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anton <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/improving.20NixOS.20platform.20download.20error.html#324338559">(Jan 28 2023 at 19:07)</a>:</h4>
<p>The test started in <a href="https://github.com/roc-lang/roc/pull/4980">https://github.com/roc-lang/roc/pull/4980</a></p>



<a name="324343940"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/improving%20NixOS%20platform%20download%20error/near/324343940" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> dank <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/improving.20NixOS.20platform.20download.20error.html#324343940">(Jan 28 2023 at 20:02)</a>:</h4>
<p>ok so bad news that did not work<br>
sure no change is required from the roc side?</p>



<a name="324344122"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/improving%20NixOS%20platform%20download%20error/near/324344122" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> dank <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/improving.20NixOS.20platform.20download.20error.html#324344122">(Jan 28 2023 at 20:05)</a>:</h4>
<p>cc <span class="user-mention" data-user-id="361169">@Anton</span></p>



<a name="324344399"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/improving%20NixOS%20platform%20download%20error/near/324344399" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> dank <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/improving.20NixOS.20platform.20download.20error.html#324344399">(Jan 28 2023 at 20:08)</a>:</h4>
<p>ohhh I fucked it up lol I put it in the second src<br>
fixed it, you can run again sry anton</p>



<a name="324401721"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/improving%20NixOS%20platform%20download%20error/near/324401721" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anton <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/improving.20NixOS.20platform.20download.20error.html#324401721">(Jan 29 2023 at 08:53)</a>:</h4>
<p>No problem, I started a new run</p>



<a name="324402114"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/improving%20NixOS%20platform%20download%20error/near/324402114" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anton <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/improving.20NixOS.20platform.20download.20error.html#324402114">(Jan 29 2023 at 08:57)</a>:</h4>
<p>There's a failure on macos aarch64, It's trying to use the <code>x86_64-unknown-linux-musl</code> target there too, so we'll have to detect when we are on x86_64 linux and only then apply the target. No need to rush to fix this though, feel free to get to it when you like :)</p>



<a name="324416598"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/improving%20NixOS%20platform%20download%20error/near/324416598" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> dank <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/improving.20NixOS.20platform.20download.20error.html#324416598">(Jan 29 2023 at 11:06)</a>:</h4>
<p><span class="user-mention silent" data-user-id="361169">Anton</span> <a href="#narrow/stream/316715-contributing/topic/improving.20NixOS.20platform.20download.20error/near/324402114">said</a>:</p>
<blockquote>
<p>There's a failure on macos aarch64, It's trying to use the <code>x86_64-unknown-linux-musl</code> target there too, so we'll have to detect when we are on x86_64 linux and only then apply the target. No need to rush to fix this though, feel free to get to it when you like :)</p>
</blockquote>
<p>ah right. so for aarch can't we use <code>aarch64-unknown-linux-musl</code> in some form of conditional targeting?<br>
unless you really want it to target musl only on x86</p>



<a name="324421861"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/improving%20NixOS%20platform%20download%20error/near/324421861" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> dank <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/improving.20NixOS.20platform.20download.20error.html#324421861">(Jan 29 2023 at 11:48)</a>:</h4>
<p>looking into it now, the x86 failed too, with<br>
<a href="https://github.com/roc-lang/roc/actions/runs/4035991075/jobs/6938275625#step:4:385">https://github.com/roc-lang/roc/actions/runs/4035991075/jobs/6938275625#step:4:385</a><br>
not sure why's that <span aria-label="thinking" class="emoji emoji-1f914" role="img" title="thinking">:thinking:</span></p>



<a name="324552361"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/improving%20NixOS%20platform%20download%20error/near/324552361" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anton <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/improving.20NixOS.20platform.20download.20error.html#324552361">(Jan 30 2023 at 08:44)</a>:</h4>
<blockquote>
<p>ah right. so for aarch can't we use aarch64-unknown-linux-musl in some form of conditional targeting?</p>
</blockquote>
<p>That actually does sound like a good idea, we don't do CI tests yet on aarch64 linux but it would be good to have that ready.</p>



<a name="324553277"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/improving%20NixOS%20platform%20download%20error/near/324553277" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anton <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/improving.20NixOS.20platform.20download.20error.html#324553277">(Jan 30 2023 at 08:50)</a>:</h4>
<p>I believe the error on linux x86 is because musl-gcc is not installed on the ci machine, I'll take care of that</p>



<a name="324790460"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/improving%20NixOS%20platform%20download%20error/near/324790460" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> dank <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/improving.20NixOS.20platform.20download.20error.html#324790460">(Jan 30 2023 at 22:32)</a>:</h4>
<p><span class="user-mention silent" data-user-id="361169">Anton</span> <a href="#narrow/stream/316715-contributing/topic/improving.20NixOS.20platform.20download.20error/near/324553277">said</a>:</p>
<blockquote>
<p>I believe the error on linux x86 is because musl-gcc is not installed on the ci machine, I'll take care of that</p>
</blockquote>
<p>alright. anything else u want me to look into?<br>
(i can take on other issues)</p>



<a name="324858093"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/improving%20NixOS%20platform%20download%20error/near/324858093" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anton <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/improving.20NixOS.20platform.20download.20error.html#324858093">(Jan 31 2023 at 09:07)</a>:</h4>
<p>Cool :) , <a href="https://github.com/roc-lang/roc/issues/4751">#4751</a> is still an issue that can come up, I've edited the issue to improve it. Would you be interested in tackling it?</p>



<a name="324868561"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/improving%20NixOS%20platform%20download%20error/near/324868561" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> dank <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/improving.20NixOS.20platform.20download.20error.html#324868561">(Jan 31 2023 at 10:01)</a>:</h4>
<p><span class="user-mention silent" data-user-id="361169">Anton</span> <a href="#narrow/stream/316715-contributing/topic/improving.20NixOS.20platform.20download.20error/near/324858093">said</a>:</p>
<blockquote>
<p>Cool :) , <a href="https://github.com/roc-lang/roc/issues/4751">#4751</a> is still an issue that can come up, I've edited the issue to improve it. Would you be interested in tackling it?</p>
</blockquote>
<p>uh sure if that's what you want. but at this point we can just solve it, no?<br>
isn't the only thing missing musl for aarch64 which we can target aswell?</p>



<a name="324873779"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/improving%20NixOS%20platform%20download%20error/near/324873779" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anton <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/improving.20NixOS.20platform.20download.20error.html#324873779">(Jan 31 2023 at 10:27)</a>:</h4>
<blockquote>
<p>but at this point we can just solve it, no?</p>
</blockquote>
<p>Even after we solve it, this case can still come up. We shouldn't force the platform to be dynamically linked when bundle-ing the <a href="http://tar.br">tar.br</a> because it is necessary for some graphical platforms. Eventually we want to include a flake in the <a href="http://tar.br">tar.br</a> as well for this case, but due to the comparatively small userbase of NixOS I don't want to force this on platform authors either.</p>



<a name="324989678"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/improving%20NixOS%20platform%20download%20error/near/324989678" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> dank <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/improving.20NixOS.20platform.20download.20error.html#324989678">(Jan 31 2023 at 18:48)</a>:</h4>
<p>Got you. on it, will pr soon</p>



<a name="324993926"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/improving%20NixOS%20platform%20download%20error/near/324993926" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> dank <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/improving.20NixOS.20platform.20download.20error.html#324993926">(Jan 31 2023 at 19:09)</a>:</h4>
<p>hold up. how come basic_cli's linux-x86_64.o doesnt contain dynamic sections?</p>
<div class="codehilite"><pre><span></span><code>❯ readelf -d /home/dankey/.cache/roc/packages/github.com/roc-lang/basic-cli/releases/download/0.2.0/8tCohJeXMBUnjo_zdMq0jSaqdYoCWJkWazBd4wa8cQU/linux-x86_64.o

There is no dynamic section in this file.
</code></pre></div>



<a name="325001377"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/improving%20NixOS%20platform%20download%20error/near/325001377" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> dank <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/improving.20NixOS.20platform.20download.20error.html#325001377">(Jan 31 2023 at 19:46)</a>:</h4>
<p>so wait what does this mean<br>
<a href="https://gist.githubusercontent.com/dankeyy/34e25e2f5f2cadf858ee7579bc393b6d/raw/9fe946e51a42a6ed117aa1e6618768c02e83fdc4/traceback.txt">https://gist.githubusercontent.com/dankeyy/34e25e2f5f2cadf858ee7579bc393b6d/raw/9fe946e51a42a6ed117aa1e6618768c02e83fdc4/traceback.txt</a></p>



<a name="325002936"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/improving%20NixOS%20platform%20download%20error/near/325002936" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/improving.20NixOS.20platform.20download.20error.html#325002936">(Jan 31 2023 at 19:55)</a>:</h4>
<p>Can you try just building (<code>roc build ...</code>) instead of building and running?</p>



<a name="325002969"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/improving%20NixOS%20platform%20download%20error/near/325002969" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/improving.20NixOS.20platform.20download.20error.html#325002969">(Jan 31 2023 at 19:55)</a>:</h4>
<p>Might give a better error here.</p>



<a name="325004300"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/improving%20NixOS%20platform%20download%20error/near/325004300" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> dank <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/improving.20NixOS.20platform.20download.20error.html#325004300">(Jan 31 2023 at 20:01)</a>:</h4>
<p><span class="user-mention silent" data-user-id="343810">Brendan Hansknecht</span> <a href="#narrow/stream/316715-contributing/topic/improving.20NixOS.20platform.20download.20error/near/325002936">said</a>:</p>
<blockquote>
<p>Can you try just building (<code>roc build ...</code>) instead of building and running?</p>
</blockquote>
<p>quite the opposite</p>
<div class="codehilite"><pre><span></span><code>❯ RUST_BACKTRACE=FULL ~/dev/roc/target/debug/roc build

There is no dynamic section in this file.

0 errors and 0 warnings found in 585 ms while successfully building:

    hello
</code></pre></div>
<p>well makes sense  it's just not observed until runtime</p>
<p>this is dev which is way less descriptive</p>
<div class="codehilite"><pre><span></span><code>❯ RUST_BACKTRACE=FULL ~/dev/roc/target/debug/roc dev

There is no dynamic section in this file.

Error Os { code: 2, kind: NotFound, message: &quot;No such file or directory&quot; }
</code></pre></div>



<a name="325004595"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/improving%20NixOS%20platform%20download%20error/near/325004595" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Carroll <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/improving.20NixOS.20platform.20download.20error.html#325004595">(Jan 31 2023 at 20:03)</a>:</h4>
<p>You're missing the .roc file argument</p>



<a name="325004647"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/improving%20NixOS%20platform%20download%20error/near/325004647" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> dank <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/improving.20NixOS.20platform.20download.20error.html#325004647">(Jan 31 2023 at 20:03)</a>:</h4>
<p>(The "There is no dynamic section in this file." i printed myself ofc)</p>



<a name="325004720"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/improving%20NixOS%20platform%20download%20error/near/325004720" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> dank <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/improving.20NixOS.20platform.20download.20error.html#325004720">(Jan 31 2023 at 20:03)</a>:</h4>
<p><span class="user-mention silent" data-user-id="431893">Brian Carroll</span> <a href="#narrow/stream/316715-contributing/topic/improving.20NixOS.20platform.20download.20error/near/325004595">said</a>:</p>
<blockquote>
<p>You're missing the .roc file argument</p>
</blockquote>
<p>it's main.roc by default tho</p>



<a name="325004857"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/improving%20NixOS%20platform%20download%20error/near/325004857" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> dank <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/improving.20NixOS.20platform.20download.20error.html#325004857">(Jan 31 2023 at 20:04)</a>:</h4>
<p>which i do have (that says hello world)</p>



<a name="325011976"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/improving%20NixOS%20platform%20download%20error/near/325011976" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/improving.20NixOS.20platform.20download.20error.html#325011976">(Jan 31 2023 at 20:44)</a>:</h4>
<p>So the build succeeded, what do you get from <code>./hello</code>?</p>



<a name="325013161"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/improving%20NixOS%20platform%20download%20error/near/325013161" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> dank <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/improving.20NixOS.20platform.20download.20error.html#325013161">(Jan 31 2023 at 20:51)</a>:</h4>
<p><span class="user-mention silent" data-user-id="343810">Brendan Hansknecht</span> <a href="#narrow/stream/316715-contributing/topic/improving.20NixOS.20platform.20download.20error/near/325011976">said</a>:</p>
<blockquote>
<p>So the build succeeded, what do you get from <code>./hello</code>?</p>
</blockquote>
<p><code>exec: Failed to execute process '/home/dankey/testing/roctests/hello': The file exists and is executable. Check the interpreter or linker?</code></p>



<a name="325016499"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/improving%20NixOS%20platform%20download%20error/near/325016499" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/improving.20NixOS.20platform.20download.20error.html#325016499">(Jan 31 2023 at 21:10)</a>:</h4>
<p>Interesting. I guess for completeness. What do you get with <code>roc --linker=legacy dev</code>?</p>



<a name="325017369"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/improving%20NixOS%20platform%20download%20error/near/325017369" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> dank <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/improving.20NixOS.20platform.20download.20error.html#325017369">(Jan 31 2023 at 21:15)</a>:</h4>
<p>same as without the flag <code>Error Os { code: 2, kind: NotFound, message: "No such file or directory" }</code></p>



<a name="325017455"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/improving%20NixOS%20platform%20download%20error/near/325017455" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> dank <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/improving.20NixOS.20platform.20download.20error.html#325017455">(Jan 31 2023 at 21:16)</a>:</h4>
<p>this is ldd output btw</p>
<div class="codehilite"><pre><span></span><code>❯ ldd hello
        linux-vdso.so.1 (0x00007ffe00768000)
        libgcc_s.so.1 =&gt; /nix/store/9xfad3b5z4y00mzmk2wnn4900q0qmxns-glibc-2.35-224/lib/libgcc_s.so.1 (0x00007fb45281a000)
        librt.so.1 =&gt; /nix/store/9xfad3b5z4y00mzmk2wnn4900q0qmxns-glibc-2.35-224/lib/librt.so.1 (0x00007fb452815000)
        libpthread.so.0 =&gt; /nix/store/9xfad3b5z4y00mzmk2wnn4900q0qmxns-glibc-2.35-224/lib/libpthread.so.0 (0x00007fb452810000)
        libm.so.6 =&gt; /nix/store/9xfad3b5z4y00mzmk2wnn4900q0qmxns-glibc-2.35-224/lib/libm.so.6 (0x00007fb452730000)
        libdl.so.2 =&gt; /nix/store/9xfad3b5z4y00mzmk2wnn4900q0qmxns-glibc-2.35-224/lib/libdl.so.2 (0x00007fb45272b000)
        libc.so.6 =&gt; /nix/store/9xfad3b5z4y00mzmk2wnn4900q0qmxns-glibc-2.35-224/lib/libc.so.6 (0x00007fb452520000)
        /lib64/ld-linux-x86-64.so.2 =&gt; /nix/store/9xfad3b5z4y00mzmk2wnn4900q0qmxns-glibc-2.35-224/lib64/ld-linux-x86-64.so.2 (0x00007fb453ae6000)
</code></pre></div>



<a name="325022246"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/improving%20NixOS%20platform%20download%20error/near/325022246" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> dank <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/improving.20NixOS.20platform.20download.20error.html#325022246">(Jan 31 2023 at 21:43)</a>:</h4>
<p>so anyways back to the point<br>
<a href="https://github.com/roc-lang/roc/issues/4751">https://github.com/roc-lang/roc/issues/4751</a><br>
the object file could have no dynamic section and still be linked dynamically cause it would just contains arbitrary symbols that should be resolved at linkage time right</p>
<p>so firstly readelf -d wouldnt suffice right<br>
and second i still dont really understand that messy panic</p>



<a name="325022710"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/improving%20NixOS%20platform%20download%20error/near/325022710" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> dank <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/improving.20NixOS.20platform.20download.20error.html#325022710">(Jan 31 2023 at 21:46)</a>:</h4>
<p>cc <span class="user-mention" data-user-id="361169">@Anton</span></p>



<a name="325127760"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/improving%20NixOS%20platform%20download%20error/near/325127760" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anton <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/improving.20NixOS.20platform.20download.20error.html#325127760">(Feb 01 2023 at 11:20)</a>:</h4>
<p>I've looked into it and we can use ldd on the rh1 file instead:</p>
<div class="codehilite"><pre><span></span><code>ldd linux-x86_64.rh*
ldd: warning: you do not have execution permission for `./linux-x86_64.rh1&#39;
        statically linked
</code></pre></div>
<p>So we'll want to look for <code>statically linked</code> in the output of that command.</p>
<p>Note the <code>rh*</code> to support <code>rh1, rh2...</code></p>



<a name="325128207"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/improving%20NixOS%20platform%20download%20error/near/325128207" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anton <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/improving.20NixOS.20platform.20download.20error.html#325128207">(Feb 01 2023 at 11:22)</a>:</h4>
<p><span class="user-mention" data-user-id="583319">@dank</span> what command generated that panic?</p>



<a name="325136115"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/improving%20NixOS%20platform%20download%20error/near/325136115" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> dank <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/improving.20NixOS.20platform.20download.20error.html#325136115">(Feb 01 2023 at 11:57)</a>:</h4>
<p><span class="user-mention silent" data-user-id="361169">Anton</span> <a href="#narrow/stream/316715-contributing/topic/improving.20NixOS.20platform.20download.20error/near/325128207">said</a>:</p>
<blockquote>
<p><span class="user-mention silent" data-user-id="583319">dank</span> what command generated that panic?</p>
</blockquote>
<p>running roc run on a main.roc with a dynamically linked platform<br>
doesnt really matter now. it is bc of the dynamic linking. just weird how non descriptive some of those panics gets</p>
<p>anyways yea so I'll just do ldd on rh1 file <span aria-label="+1" class="emoji emoji-1f44d" role="img" title="+1">:+1:</span></p>



<a name="325256830"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/improving%20NixOS%20platform%20download%20error/near/325256830" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> dank <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/improving.20NixOS.20platform.20download.20error.html#325256830">(Feb 01 2023 at 20:02)</a>:</h4>
<p>PR's up</p>



<a name="325344134"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/improving%20NixOS%20platform%20download%20error/near/325344134" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anton <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/improving.20NixOS.20platform.20download.20error.html#325344134">(Feb 02 2023 at 09:02)</a>:</h4>
<p>Thanks :) , I'll review tomorrow!</p>



<hr><p>Last updated: Mar 01 2026 at 12:20 UTC</p>
</html>