<html>
<head><meta charset="utf-8"><title>Glue generate Types in JSON · contributing · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/index.html">contributing</a></h2>
<h3>Topic: <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Glue.20generate.20Types.20in.20JSON.html">Glue generate Types in JSON</a></h3>

<hr>

<base href="https://roc.zulipchat.com">

<head><link href="https://roc-lang.github.io/zulip-export/style.css" rel="stylesheet"></head>

<a name="434573060"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Glue%20generate%20Types%20in%20JSON/near/434573060" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Glue.20generate.20Types.20in.20JSON.html#434573060">(Apr 21 2024 at 09:02)</a>:</h4>
<p>Is this useful for others? Is it worth adding in a PR? </p>
<p>My goal was to understand the platform types better.</p>
<p>For example if I run <code>roc glue JsonGlue.roc test-glue/  main.roc</code> on the following, i get the below JSON. Note I had to add <code>Encoding</code> ability to the <code>Types</code> which was an extremely minor addition.</p>
<div class="codehilite" data-code-language="roc"><pre><span></span><code>platform "test"
    requires {} { main : Foo }
    exposes []
    packages {}
    imports []
    provides [mainForHost]

Foo := [Number U8, String Str]

mainForHost : Foo
mainForHost = main
</code></pre></div>
<p>Generates <code>types.json</code></p>
<div class="codehilite" data-code-language="JSON"><pre><span></span><code><span class="p">{</span>
<span class="w">    </span><span class="nt">"aligns"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">8</span><span class="p">,</span><span class="w"> </span><span class="mi">8</span><span class="p">],</span>
<span class="w">    </span><span class="nt">"deps"</span><span class="p">:</span><span class="w"> </span><span class="p">[],</span>
<span class="w">    </span><span class="nt">"entrypoints"</span><span class="p">:</span><span class="w"> </span><span class="p">[{</span><span class="w"> </span><span class="nt">"T"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"mainForHost"</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">]</span><span class="w"> </span><span class="p">}],</span>
<span class="w">    </span><span class="nt">"sizes"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">24</span><span class="p">,</span><span class="w"> </span><span class="mi">32</span><span class="p">],</span>
<span class="w">    </span><span class="nt">"target"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nt">"architecture"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nt">"X86x64"</span><span class="p">:</span><span class="w"> </span><span class="p">[]</span><span class="w"> </span><span class="p">},</span>
<span class="w">        </span><span class="nt">"operatingSystem"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nt">"Mac"</span><span class="p">:</span><span class="w"> </span><span class="p">[]</span><span class="w"> </span><span class="p">}</span>
<span class="w">    </span><span class="p">},</span>
<span class="w">    </span><span class="nt">"types"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">        </span><span class="p">{</span><span class="w"> </span><span class="nt">"Unit"</span><span class="p">:</span><span class="w"> </span><span class="p">[]</span><span class="w"> </span><span class="p">},</span>
<span class="w">        </span><span class="p">{</span><span class="w"> </span><span class="nt">"Num"</span><span class="p">:</span><span class="w"> </span><span class="p">[{</span><span class="w"> </span><span class="nt">"U8"</span><span class="p">:</span><span class="w"> </span><span class="p">[]</span><span class="w"> </span><span class="p">}]</span><span class="w"> </span><span class="p">},</span>
<span class="w">        </span><span class="p">{</span><span class="w"> </span><span class="nt">"RocStr"</span><span class="p">:</span><span class="w"> </span><span class="p">[]</span><span class="w"> </span><span class="p">},</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="nt">"TagUnion"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">                </span><span class="p">{</span>
<span class="w">                    </span><span class="nt">"NonRecursive"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">                        </span><span class="p">{</span>
<span class="w">                            </span><span class="nt">"discriminantOffset"</span><span class="p">:</span><span class="w"> </span><span class="mi">24</span><span class="p">,</span>
<span class="w">                            </span><span class="nt">"discriminantSize"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span>
<span class="w">                            </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Foo"</span><span class="p">,</span>
<span class="w">                            </span><span class="nt">"tags"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">                                </span><span class="p">{</span>
<span class="w">                                    </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Number"</span><span class="p">,</span>
<span class="w">                                    </span><span class="nt">"payload"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nt">"Some"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="p">}</span>
<span class="w">                                </span><span class="p">},</span>
<span class="w">                                </span><span class="p">{</span><span class="w"> </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"String"</span><span class="p">,</span><span class="w"> </span><span class="nt">"payload"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nt">"Some"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">}</span>
<span class="w">                            </span><span class="p">]</span>
<span class="w">                        </span><span class="p">}</span>
<span class="w">                    </span><span class="p">]</span>
<span class="w">                </span><span class="p">}</span>
<span class="w">            </span><span class="p">]</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">],</span>
<span class="w">    </span><span class="nt">"typesByName"</span><span class="p">:</span><span class="w"> </span><span class="p">[{</span><span class="w"> </span><span class="nt">"T"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"Foo"</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">]</span><span class="w"> </span><span class="p">}]</span>
<span class="p">}</span>
</code></pre></div>
<p>I tested <code>Inspect</code> out too, which works well, but I just wanted a format that I could read in my editor and easily format with newlines etc.</p>



<a name="434573107"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Glue%20generate%20Types%20in%20JSON/near/434573107" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Glue.20generate.20Types.20in.20JSON.html#434573107">(Apr 21 2024 at 09:03)</a>:</h4>
<div class="codehilite" data-code-language="Haskell"><pre><span></span><code><span class="nf">app</span><span class="w"> </span><span class="s">"json-glue"</span>
<span class="w">    </span><span class="n">packages</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">pf</span><span class="kt">:</span><span class="w"> </span><span class="s">"../platform/main.roc"</span><span class="p">,</span>
<span class="w">        </span><span class="n">json</span><span class="kt">:</span><span class="w"> </span><span class="s">"https://github.com/lukewilliamboswell/roc-json/releases/download/0.7.0/xuaMzXRVG_SEhOFZucS3iBozlRdObWsfKaYZMHVE_q0.tar.br"</span><span class="p">,</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="n">imports</span><span class="w"> </span><span class="p">[</span>
<span class="w">        </span><span class="n">pf</span><span class="o">.</span><span class="kt">Types</span><span class="o">.</span><span class="p">{</span><span class="w"> </span><span class="kt">Types</span><span class="w"> </span><span class="p">},</span>
<span class="w">        </span><span class="n">pf</span><span class="o">.</span><span class="kt">File</span><span class="o">.</span><span class="p">{</span><span class="w"> </span><span class="kt">File</span><span class="w"> </span><span class="p">},</span>
<span class="w">        </span><span class="n">json</span><span class="o">.</span><span class="kt">Core</span><span class="o">.</span><span class="p">{</span><span class="n">json</span><span class="p">},</span>
<span class="w">    </span><span class="p">]</span>
<span class="w">    </span><span class="n">provides</span><span class="w"> </span><span class="p">[</span><span class="n">makeGlue</span><span class="p">]</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">pf</span>

<span class="nf">makeGlue</span><span class="w"> </span><span class="kt">:</span><span class="w"> </span><span class="kt">List</span><span class="w"> </span><span class="kt">Types</span><span class="w"> </span><span class="ow">-&gt;</span><span class="w"> </span><span class="kt">Result</span><span class="w"> </span><span class="p">(</span><span class="kt">List</span><span class="w"> </span><span class="kt">File</span><span class="p">)</span><span class="w"> </span><span class="kt">Str</span>
<span class="nf">makeGlue</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="nf">\</span><span class="n">typesByArch</span><span class="w"> </span><span class="ow">-&gt;</span>
<span class="w">    </span><span class="n">typesByArch</span>
<span class="w">    </span><span class="o">|&gt;</span><span class="w"> </span><span class="kt">List</span><span class="o">.</span><span class="n">map</span><span class="w"> </span><span class="n">convertTypesToFile</span>
<span class="w">    </span><span class="o">|&gt;</span><span class="w"> </span><span class="kt">List</span><span class="o">.</span><span class="n">concat</span><span class="w"> </span><span class="n">staticFiles</span>
<span class="w">    </span><span class="o">|&gt;</span><span class="w"> </span><span class="kt">Ok</span>

<span class="nf">staticFiles</span><span class="w"> </span><span class="kt">:</span><span class="w"> </span><span class="kt">List</span><span class="w"> </span><span class="kt">File</span>
<span class="nf">staticFiles</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="kt">[]</span>

<span class="nf">convertTypesToFile</span><span class="w"> </span><span class="kt">:</span><span class="w"> </span><span class="kt">Types</span><span class="w"> </span><span class="ow">-&gt;</span><span class="w"> </span><span class="kt">File</span>
<span class="nf">convertTypesToFile</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="nf">\</span><span class="n">types</span><span class="w"> </span><span class="ow">-&gt;</span>

<span class="w">    </span><span class="n">content</span><span class="w"> </span><span class="ow">=</span>
<span class="w">        </span><span class="kt">Encode</span><span class="o">.</span><span class="n">toBytes</span><span class="w"> </span><span class="n">types</span><span class="w"> </span><span class="n">json</span>
<span class="w">        </span><span class="o">|&gt;</span><span class="w"> </span><span class="kt">Str</span><span class="o">.</span><span class="n">fromUtf8</span>
<span class="w">        </span><span class="o">|&gt;</span><span class="w"> </span><span class="kt">Result</span><span class="o">.</span><span class="n">withDefault</span><span class="w"> </span><span class="s">"INVALID UTF8 ENCODED FROM JSON"</span>

<span class="w">    </span><span class="p">{</span><span class="w"> </span><span class="n">name</span><span class="kt">:</span><span class="w"> </span><span class="s">"types.json"</span><span class="p">,</span><span class="w"> </span><span class="n">content</span><span class="w">  </span><span class="p">}</span>
</code></pre></div>



<a name="434701704"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Glue%20generate%20Types%20in%20JSON/near/434701704" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anton <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Glue.20generate.20Types.20in.20JSON.html#434701704">(Apr 22 2024 at 09:36)</a>:</h4>
<p>Perhaps a good fit for the examples repo?</p>



<a name="435078264"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Glue%20generate%20Types%20in%20JSON/near/435078264" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Glue.20generate.20Types.20in.20JSON.html#435078264">(Apr 23 2024 at 22:39)</a>:</h4>
<p>Given it's a super small change, and this might help others. I'll make a quick PR to add the Encoding, and Inspect abilities to the Types so others can do this without changing the compiler.</p>



<a name="435079066"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Glue%20generate%20Types%20in%20JSON/near/435079066" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Glue.20generate.20Types.20in.20JSON.html#435079066">(Apr 23 2024 at 22:47)</a>:</h4>
<p>Ok PR is <a href="https://github.com/roc-lang/roc/pull/6670">https://github.com/roc-lang/roc/pull/6670</a></p>



<hr><p>Last updated: Mar 01 2026 at 12:20 UTC</p>
</html>