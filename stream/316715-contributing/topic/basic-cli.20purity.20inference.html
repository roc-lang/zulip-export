<html>
<head><meta charset="utf-8"><title>basic-cli purity inference · contributing · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/index.html">contributing</a></h2>
<h3>Topic: <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html">basic-cli purity inference</a></h3>

<hr>

<base href="https://roc.zulipchat.com">

<head><link href="https://roc-lang.github.io/zulip-export/style.css" rel="stylesheet"></head>

<a name="481434793"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/481434793" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#481434793">(Nov 09 2024 at 06:48)</a>:</h4>
<p>Just wanted to give an update on the progress with purity inference upgrade for basic-cli <a href="https://github.com/roc-lang/basic-cli/pull/257">PR#257</a></p>
<p>The host, platform, and all of the examples have been upgraded -- it's working well <span aria-label="smiley" class="emoji emoji-1f603" role="img" title="smiley">:smiley:</span> </p>
<p>The following examples have a bug. I've logged issues for each of these.</p>
<p>$ roc examples/args.roc</p>
<div class="codehilite"><pre><span></span><code>thread &#39;main&#39; panicked at crates/compiler/gen_llvm/src/llvm/build.rs:5748:19:
Error in alias analysis: error in module ModName(&quot;UserApp&quot;), function definition FuncName(&quot;\x11\x00\x00\x00\x00\x00\x00\x80\xe0{\x02\xeaI\xd4\xd7?&quot;), definition of value binding ValueId(54): expected type &#39;union { (((heap_cell,), ()),), ((),) }&#39;, found type &#39;union { (), (), ((heap_cell,),), (), (), (), () }&#39;
</code></pre></div>
<p>$ roc examples/task-list.roc</p>
<div class="codehilite"><pre><span></span><code>thread &#39;main&#39; panicked at crates/compiler/gen_llvm/src/llvm/build.rs:5748:19:
Error in alias analysis: error in module ModName(&quot;UserApp&quot;), function definition FuncName(&quot;\x11\x00\x00\x00\x04\x00\x00\x80\x16\x02|\xef\xcd\x95Y\xbd&quot;), definition of value binding ValueId(42): expected type &#39;union { (union { ((heap_cell,), ()), (union { (), (), ((heap_cell,),), (), (), (), () },) },), ((),) }&#39;, found type &#39;union { ((heap_cell,), ()), (union { (), (), ((heap_cell,),), (), (), (), () },) }&#39;
</code></pre></div>
<p>$ roc examples/tcp-client.roc</p>
<div class="codehilite"><pre><span></span><code>thread &#39;&lt;unnamed&gt;&#39; panicked at crates/compiler/mono/src/ir.rs:6191:56:
called `Option::unwrap()` on a `None` value
note: run with `RUST_BACKTRACE=1` environment variable to display a backtrace
</code></pre></div>
<p>I've also switched us over to the Weaver package and removed the Arg parser from basic-cli. </p>
<p>We can put this back if anyone has an issue with this, but we discussed eventually pointing people towards the packages as that keeps the platform simple, and I think now is a good time.</p>
<p>Next up is updating/checking all of the expect tests to get CI back online. I've also temporarily disabled the <code>pull_request</code> trigger in the yaml files so I don't get spammed on every push, but we can restore this once we have that working locally.</p>



<a name="481451812"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/481451812" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anton <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#481451812">(Nov 09 2024 at 11:22)</a>:</h4>
<blockquote>
<p>I've also switched us over to the Weaver package and removed the Arg parser from basic-cli.</p>
<p>We can put this back if anyone has an issue with this, but we discussed eventually pointing people towards the packages as that keeps the platform simple, and I think now is a good time.</p>
</blockquote>
<p>Could we stick to very simple arg handling like <a href="https://github.com/roc-lang/examples/blob/main/examples/CommandLineArgs/main.roc">here</a> and link to weaver in a comment? I want to avoid being blocked on needing to upgrade weaver in case of breaking roc changes.</p>



<a name="481452001"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/481452001" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#481452001">(Nov 09 2024 at 11:24)</a>:</h4>
<p>That works <span aria-label="+1" class="emoji emoji-1f44d" role="img" title="+1">:+1:</span></p>



<a name="481455140"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/481455140" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Agus Zubiaga <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#481455140">(Nov 09 2024 at 12:10)</a>:</h4>
<p>Thanks Luke!! I’ll look into the failing cases today</p>



<a name="481506264"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/481506264" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Agus Zubiaga <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#481506264">(Nov 09 2024 at 23:55)</a>:</h4>
<p>It looks like the <code>tcp-client</code> example issue is caused by the <code>return</code> issue that Sam is already looking into. I inlined all <code>try</code> without using <code>return</code> and it run properly:<br>
<a href="/user_uploads/22008/FINS5vQvxHST6H-TO-e6Nq12/Screenshot-2024-11-09-at-8.55.01PM.png">Screenshot 2024-11-09 at 8.55.01 PM.png</a></p>
<div class="message_inline_image"><a href="/user_uploads/22008/FINS5vQvxHST6H-TO-e6Nq12/Screenshot-2024-11-09-at-8.55.01PM.png" title="Screenshot 2024-11-09 at 8.55.01 PM.png"><img data-original-dimensions="2602x846" src="/user_uploads/thumbnail/22008/FINS5vQvxHST6H-TO-e6Nq12/Screenshot-2024-11-09-at-8.55.01PM.png/840x560.webp"></a></div>



<a name="481506356"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/481506356" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Agus Zubiaga <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#481506356">(Nov 09 2024 at 23:56)</a>:</h4>
<p><span class="user-mention" data-user-id="515757">@Luke Boswell</span> so if you made an issue for that one, I think we can close it as a dupe</p>



<a name="481506427"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/481506427" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Agus Zubiaga <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#481506427">(Nov 09 2024 at 23:57)</a>:</h4>
<p>Actually, same with <code>args.roc</code></p>



<a name="481506468"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/481506468" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Agus Zubiaga <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#481506468">(Nov 09 2024 at 23:58)</a>:</h4>
<p>checking <code>task-list.roc</code> now</p>



<a name="481506475"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/481506475" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Agus Zubiaga <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#481506475">(Nov 09 2024 at 23:58)</a>:</h4>
<p>yep, same</p>



<a name="481506483"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/481506483" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Agus Zubiaga <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#481506483">(Nov 09 2024 at 23:58)</a>:</h4>
<p>so these are all down to the same issue <span aria-label="smile" class="emoji emoji-1f642" role="img" title="smile">:smile:</span></p>



<a name="481506535"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/481506535" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Agus Zubiaga <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#481506535">(Nov 09 2024 at 23:59)</a>:</h4>
<p>We should hold the release until we fix it, because not having <code>try</code> is really painful</p>



<a name="481507840"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/481507840" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#481507840">(Nov 10 2024 at 00:17)</a>:</h4>
<p>This is great news. Thanks for investigating those. <span aria-label="smiley" class="emoji emoji-1f603" role="img" title="smiley">:smiley:</span> </p>
<p>No pressure <span class="user-mention" data-user-id="461444">@Sam Mohr</span> <span aria-label="sweat smile" class="emoji emoji-1f605" role="img" title="sweat smile">:sweat_smile:</span></p>



<a name="481511916"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/481511916" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#481511916">(Nov 10 2024 at 01:22)</a>:</h4>
<p>I'll look tonight. The fix is in theory ready to go in <a href="https://github.com/roc-lang/roc/pull/7204">https://github.com/roc-lang/roc/pull/7204</a>, but I'm hitting some weird codegen error</p>



<a name="481511962"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/481511962" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#481511962">(Nov 10 2024 at 01:22)</a>:</h4>
<p>Once that's fixed, we're ready to go</p>



<a name="481512114"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/481512114" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#481512114">(Nov 10 2024 at 01:24)</a>:</h4>
<div class="codehilite"><pre><span></span><code>--- STDOUT: test_gen::test_gen gen_return::early_return_annotated_function ---

running 1 test

--- STDERR: test_gen::test_gen gen_return::early_return_annotated_function ---

An internal compiler expectation was broken.

This is definitely a compiler bug.

Please file an issue here: &lt;https://github.com/roc-lang/roc/issues/new/choose&gt;

single register layouts are not complex symbols

Location: crates/compiler/gen_dev/src/generic64/x86_64.rs:355:17
</code></pre></div>



<a name="481512165"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/481512165" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#481512165">(Nov 10 2024 at 01:25)</a>:</h4>
<p><a href="https://github.com/roc-lang/roc/blob/b7c2cb084e15a56320e652ad3c77fdb8262bc1a4/crates/compiler/gen_dev/src/generic64/x86_64.rs#L355">https://github.com/roc-lang/roc/blob/b7c2cb084e15a56320e652ad3c77fdb8262bc1a4/crates/compiler/gen_dev/src/generic64/x86_64.rs#L355</a></p>



<a name="481512220"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/481512220" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#481512220">(Nov 10 2024 at 01:26)</a>:</h4>
<p>Off to hang with a friend, I'll update when I get to a keyboard in like 5 hours or so</p>



<a name="483830084"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/483830084" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#483830084">(Nov 22 2024 at 03:32)</a>:</h4>
<p>I think we're pretty much done. </p>
<p>If you are able, can you please give <a href="https://github.com/roc-lang/basic-cli/pull/257">basic-cli purity inference upgrade</a> a test, or to skim through the changes and see if we've missed anything obvious. </p>
<p>CI failures for native are to be expected until the new nightly which includes Sam's <a href="https://github.com/roc-lang/roc/issues/7204">#7204</a> fix</p>
<p>The CI nix failures need investigation.. I'm not sure what's going wrong yet. </p>
<p>I'm hoping the euro-roc-stars can take it from here... I think I'm pretty much done for today. Still hopeful we can land this in time for AoC <span aria-label="fingers crossed" class="emoji emoji-1f91e" role="img" title="fingers crossed">:fingers_crossed:</span></p>



<a name="484022876"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/484022876" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#484022876">(Nov 23 2024 at 02:30)</a>:</h4>
<p>Ok, I've only started to investigate... but I think that latest fix <span class="user-mention" data-user-id="461444">@Sam Mohr</span>  or something has broken hello world on basic-cli purity inference. </p>
<p>It doesn't make any sense to me right now, but hello world exits with a non-zero exit code. </p>
<p><a href="https://github.com/roc-lang/basic-cli/pull/257">https://github.com/roc-lang/basic-cli/pull/257</a></p>
<p>Trying to figure out how that could happen. It's odd, that it's happening on literally the most simple program.</p>



<a name="484022913"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/484022913" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#484022913">(Nov 23 2024 at 02:31)</a>:</h4>
<p>Uh oh</p>



<a name="484022938"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/484022938" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#484022938">(Nov 23 2024 at 02:31)</a>:</h4>
<p>I can check it out in an hour when I get home</p>



<a name="484023253"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/484023253" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#484023253">(Nov 23 2024 at 02:35)</a>:</h4>
<p>Hm... I think I found a workaround.</p>



<a name="484023375"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/484023375" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#484023375">(Nov 23 2024 at 02:37)</a>:</h4>
<h2>works</h2>
<div class="codehilite"><pre><span></span><code>mainForHost! : I32 =&gt; Result {} I32
mainForHost! = \_ -&gt;
    when main! {} is
        Ok {} -&gt; Ok {}
        Err (Exit code msg) -&gt;
</code></pre></div>
<h2>broken</h2>
<div class="codehilite"><pre><span></span><code>mainForHost! : I32 =&gt; Result {} I32
mainForHost! = \_ -&gt;
    main! {}
    |&gt; \result -&gt;
        when result is
            Ok {} -&gt; Ok {}
</code></pre></div>



<a name="484028349"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/484028349" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#484028349">(Nov 23 2024 at 03:55)</a>:</h4>
<p>Okay, looking into it now</p>



<a name="484032119"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/484032119" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#484032119">(Nov 23 2024 at 04:53)</a>:</h4>
<p>So when I log before and after running <code>mainForHost!</code> in the Rust host code, I get this:</p>
<div class="codehilite"><pre><span></span><code>before running mainForHost!
Hello, World!
main! returned Ok {}
after mainForHost! exit_code = 1875841744
</code></pre></div>



<a name="484032297"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/484032297" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#484032297">(Nov 23 2024 at 04:56)</a>:</h4>
<p>So this means we successfully run <code>mainForHost!</code> and <code>main!</code> inside it, but the exit code is wrong.</p>



<a name="484032339"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/484032339" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#484032339">(Nov 23 2024 at 04:56)</a>:</h4>
<p>Not only that, but it's a seemingly random number each time</p>



<a name="484032362"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/484032362" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#484032362">(Nov 23 2024 at 04:56)</a>:</h4>
<p>Which smells to me like we're reading past our memory when detecting the exit code</p>



<a name="484033444"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/484033444" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#484033444">(Nov 23 2024 at 05:12)</a>:</h4>
<p>Okay, im tired and will pick this up tomorrow</p>



<a name="484039486"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/484039486" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#484039486">(Nov 23 2024 at 06:59)</a>:</h4>
<p>is this a general bug or surgical linker specific</p>



<a name="484039494"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/484039494" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#484039494">(Nov 23 2024 at 06:59)</a>:</h4>
<p>Also, this smells of an old bug we never figured out but seemed to have gone away</p>



<a name="484039593"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/484039593" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#484039593">(Nov 23 2024 at 07:00)</a>:</h4>
<p>Im on mac, so it's happening with the legacy linker.</p>



<a name="484040172"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/484040172" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#484040172">(Nov 23 2024 at 07:10)</a>:</h4>
<p><a href="https://github.com/roc-lang/roc/issues/6121">https://github.com/roc-lang/roc/issues/6121</a></p>



<a name="484106581"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/484106581" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#484106581">(Nov 24 2024 at 00:02)</a>:</h4>
<p>We have some green shoots <span aria-label="tada" class="emoji emoji-1f389" role="img" title="tada">:tada:</span> </p>
<p><a href="/user_uploads/22008/MeKhh-IMg9n9rYIftSxXP5jm/Screenshot-2024-11-24-at-11.00.27.png">Screenshot 2024-11-24 at 11.00.27.png</a></p>
<div class="message_inline_image"><a href="/user_uploads/22008/MeKhh-IMg9n9rYIftSxXP5jm/Screenshot-2024-11-24-at-11.00.27.png" title="Screenshot 2024-11-24 at 11.00.27.png"><img data-original-dimensions="696x306" src="/user_uploads/thumbnail/22008/MeKhh-IMg9n9rYIftSxXP5jm/Screenshot-2024-11-24-at-11.00.27.png/840x560.webp"></a></div><p>Now to figure out why linux isn't happy... anyone with a linux machine feel like helping? feel free to jump in</p>



<a name="484107285"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/484107285" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#484107285">(Nov 24 2024 at 00:13)</a>:</h4>
<p>I can help in 2 or so hours</p>



<a name="484108267"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/484108267" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#484108267">(Nov 24 2024 at 00:32)</a>:</h4>
<p>I found a bunch of places where the host fx type was returning a RocResult, but the PlatformTask was something like <code>{} =&gt; {}</code>.</p>



<a name="484108312"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/484108312" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#484108312">(Nov 24 2024 at 00:33)</a>:</h4>
<p>The current issue looks to be the non-zero exit code... and I suspect it may be related to the types for our Fx's not matching perfectly with what roc expects. My current hypothesis is that is we return a unit <code>()</code> to roc i.e. <code>{}</code> in rust that maybe that is sized or aligned differently.</p>



<a name="484108394"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/484108394" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#484108394">(Nov 24 2024 at 00:35)</a>:</h4>
<p>Need to dig into the LLVM IR maybe. Possible workaround might be to use a RocResult for everything across the host boundary which will ensure the correct alignment etc, and then just use a <code>crash "unreachable"</code> in the platform for those effects that cannot fail (or rust host never provides an RocResult::Err(..) value).</p>



<a name="484108406"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/484108406" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#484108406">(Nov 24 2024 at 00:35)</a>:</h4>
<p>Linux definitely seems to be more picky about this stuff than macos for some reason.</p>



<a name="484109476"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/484109476" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#484109476">(Nov 24 2024 at 00:56)</a>:</h4>
<p>Do we generate size functions for fx's? It would be good to add a debug_assert that calls that and verifies the size of the return value in each effect is what roc expects.</p>



<a name="484112257"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/484112257" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#484112257">(Nov 24 2024 at 01:51)</a>:</h4>
<p>I would expect more issues with roc result than without</p>



<a name="484112277"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/484112277" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#484112277">(Nov 24 2024 at 01:52)</a>:</h4>
<p>Switching from effect to task (aka no result to result) lead to a lot of random issues</p>



<a name="484112315"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/484112315" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#484112315">(Nov 24 2024 at 01:52)</a>:</h4>
<p>So I would try to avoid results where not needed</p>



<a name="484112320"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/484112320" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#484112320">(Nov 24 2024 at 01:52)</a>:</h4>
<p>We do not generate size functions for effects</p>



<a name="484112334"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/484112334" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#484112334">(Nov 24 2024 at 01:53)</a>:</h4>
<p>Linux probably isn't more picky. Probably would be an arm vs x86 c abi thing</p>



<a name="484112341"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/484112341" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#484112341">(Nov 24 2024 at 01:53)</a>:</h4>
<p>I know we have bugs in our c abi handling</p>



<a name="484112346"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/484112346" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#484112346">(Nov 24 2024 at 01:53)</a>:</h4>
<p>Also, unit is just void</p>



<a name="484112355"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/484112355" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#484112355">(Nov 24 2024 at 01:53)</a>:</h4>
<p>So should be trivial and just always work</p>



<a name="484112361"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/484112361" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#484112361">(Nov 24 2024 at 01:53)</a>:</h4>
<p>No alignment. No data at all</p>



<a name="484113630"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/484113630" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#484113630">(Nov 24 2024 at 02:17)</a>:</h4>
<p>Something really fishy is going on... on this commit <a href="https://github.com/roc-lang/basic-cli/tree/86eca456539547b3720a0b1dc45ed967a6d76a7d">86eca456539547b3720a0b1dc45ed967a6d76a7d</a></p>
<p>Just looking at the LLVM IR, not even the host, roc isn't generating anything for the effect <code>PlatformTasks.currentArchOS!</code>, which is really strange. I modified <code>hello-world.roc</code> to use this effect but for some reason roc isnt generating anything for it. </p>
<p>I've tried all kind of different things, like changing the interface, with and without Result, making it larger, random things... real head scratcher</p>



<a name="485175180"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/485175180" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#485175180">(Nov 30 2024 at 00:09)</a>:</h4>
<p><span class="user-mention" data-user-id="343810">@Brendan Hansknecht</span> are you able to look at this? any thoughts on why this wouldn't be generating the effect?</p>



<a name="485189709"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/485189709" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#485189709">(Nov 30 2024 at 03:47)</a>:</h4>
<p>I'll take a look tomorrow</p>



<a name="485250642"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/485250642" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#485250642">(Nov 30 2024 at 18:15)</a>:</h4>
<p>Is the issue platform specific. Works for me</p>



<a name="485250693"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/485250693" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#485250693">(Nov 30 2024 at 18:16)</a>:</h4>
<div class="codehilite" data-code-language="Bash"><pre><span></span><code>$<span class="w"> </span>roc<span class="w"> </span>examples/hello-world.roc
<span class="o">{</span>arch:<span class="w"> </span>AARCH64,<span class="w"> </span>os:<span class="w"> </span>MACOS<span class="o">}</span>
<span class="o">[</span>crates/roc_host/src/lib.rs:350:5<span class="o">]</span><span class="w"> </span><span class="nv">exit_code</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0</span>
</code></pre></div>



<a name="485250734"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/485250734" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#485250734">(Nov 30 2024 at 18:16)</a>:</h4>
<p>To get things building correctly, I had to <code>rm platform/*.{a,rh}</code> then run <code>./jump-start.sh</code> again.</p>



<a name="485250751"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/485250751" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#485250751">(Nov 30 2024 at 18:17)</a>:</h4>
<p>This is on latest main for roc.</p>



<a name="485250881"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/485250881" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#485250881">(Nov 30 2024 at 18:19)</a>:</h4>
<p>Continues to just work when changing <code>glue::ReturnArchOS</code> to only contain arch and os.</p>



<a name="485252659"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/485252659" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#485252659">(Nov 30 2024 at 18:47)</a>:</h4>
<p>Was this your linux machine?</p>



<a name="485252724"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/485252724" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#485252724">(Nov 30 2024 at 18:48)</a>:</h4>
<p>No, mac. Is it only broken on linux?</p>



<a name="485252843"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/485252843" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#485252843">(Nov 30 2024 at 18:50)</a>:</h4>
<p>Yes, only broken on linux afaik</p>



<a name="485252895"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/485252895" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#485252895">(Nov 30 2024 at 18:51)</a>:</h4>
<p>Ah, ok. Will check</p>



<a name="485252909"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/485252909" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#485252909">(Nov 30 2024 at 18:51)</a>:</h4>
<p>Could be intel macs too though.</p>



<a name="485254199"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/485254199" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#485254199">(Nov 30 2024 at 19:10)</a>:</h4>
<p>Should be fixed now</p>



<a name="485254212"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/485254212" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#485254212">(Nov 30 2024 at 19:11)</a>:</h4>
<p>Issue was the return type for mainForHost not matching between Rust and Roc.</p>



<a name="485254312"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/485254312" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#485254312">(Nov 30 2024 at 19:12)</a>:</h4>
<p>Thank you <span aria-label="partying face" class="emoji emoji-1f973" role="img" title="partying face">:partying_face:</span></p>



<a name="485415300"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/485415300" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#485415300">(Nov 30 2024 at 19:48)</a>:</h4>
<p>Almost all passing. <code>build-and-test-native</code> is failing with a segfault in <code>examples/arg.roc</code>. Anyone have a native (not using nix) linux setup they can run the tests on? I assume running with valgrind will reveal the issue.</p>



<a name="485415357"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/485415357" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#485415357">(Nov 30 2024 at 19:49)</a>:</h4>
<p>I guess this is probably a musl specific issue.</p>



<a name="485415844"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/485415844" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jan kili <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#485415844">(Nov 30 2024 at 19:56)</a>:</h4>
<p>In a half hour, I can run on native 2021-era Fedora and/or Debian 12, though I may be unclear how to run it</p>



<a name="485416246"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/485416246" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#485416246">(Nov 30 2024 at 20:02)</a>:</h4>
<p>Actually, I realized I can just download the nightly to get out of nix. Don't have to deal with all of the dependency and what not. So I can test.</p>



<a name="485416428"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/485416428" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#485416428">(Nov 30 2024 at 20:05)</a>:</h4>
<p>Though I can't repro...</p>



<a name="485416440"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/485416440" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#485416440">(Nov 30 2024 at 20:05)</a>:</h4>
<p>Just built everything outside of nix with roc nightly and musl, no segfault or failures.</p>



<a name="485417729"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/485417729" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#485417729">(Nov 30 2024 at 20:24)</a>:</h4>
<p>So if anyone else wants to try and repro, that would be great.</p>



<a name="485417742"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/485417742" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#485417742">(Nov 30 2024 at 20:24)</a>:</h4>
<p>Commands to repro on ubuntu: <a href="https://github.com/roc-lang/basic-cli/blob/purity-inference/.github/workflows/ci.yml">https://github.com/roc-lang/basic-cli/blob/purity-inference/.github/workflows/ci.yml</a></p>



<a name="485417844"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/485417844" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#485417844">(Nov 30 2024 at 20:26)</a>:</h4>
<p>Everything is passing in nix, so I think this is the last piece to have fully working basic cli with purity inference.</p>



<a name="485423555"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/485423555" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jan kili <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#485423555">(Nov 30 2024 at 21:55)</a>:</h4>
<p>Update: on a relatively clean native Debian 12 setup, I haven't figured out basic-cli local execution yet - <del>debugging with Brendan in DMs</del> suggestions welcome<br>
After successful <code>./jump-start.sh</code>:</p>
<div class="codehilite"><pre><span></span><code>jan@lenny:~/_roc/basic-cli$ roc build.roc
LinkingStrategy was set to Surgical (default), but I tried to find the surgical host at any of these paths Either the generic host files or the surgical host files must exist. File status: Generic host (platform/host.rh): missing, Generic metadata (platform/metadata_host.rm): missing, Surgical host (platform/linux-x64.rh): missing, Surgical metadata (platform/metadata_linux-x64.rm): missing but it does not exist.
jan@lenny:~/_roc/basic-cli$ roc examples/hello-world.roc
LinkingStrategy was set to Surgical (default), but I tried to find the surgical host at any of these paths Either the generic host files or the surgical host files must exist. File status: Generic host (examples/../platform/host.rh): missing, Generic metadata (examples/../platform/metadata_host.rm): missing, Surgical host (examples/../platform/linux-x64.rh): missing, Surgical metadata (examples/../platform/metadata_linux-x64.rm): missing but it does not exist.
jan@lenny:~/_roc/basic-cli$
</code></pre></div>



<a name="485423967"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/485423967" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#485423967">(Nov 30 2024 at 22:01)</a>:</h4>
<p>Strange. I thought <code>roc build.roc</code> would have given you the surgical host... does it work if you add <code>--linker legacy</code>?</p>



<a name="485424079"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/485424079" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#485424079">(Nov 30 2024 at 22:02)</a>:</h4>
<p>Can you share <code>$ ls -hl platform/</code>?</p>



<a name="485424095"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/485424095" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jan kili <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#485424095">(Nov 30 2024 at 22:02)</a>:</h4>
<div class="codehilite"><pre><span></span><code>jan@lenny:~/_roc/basic-cli$ ls -hl platform/
total 15M
drwxr-xr-x 2 jan jan 4.0K Nov 30 14:38 Arg
-rw-r--r-- 1 jan jan 3.3K Nov 30 14:38 Arg.roc
-rw-r--r-- 1 jan jan 4.1K Nov 30 14:38 Cmd.roc
-rw-r--r-- 1 jan jan 2.6K Nov 30 14:38 Dir.roc
-rw-r--r-- 1 jan jan 4.5K Nov 30 14:38 EnvDecoding.roc
-rw-r--r-- 1 jan jan 7.2K Nov 30 14:38 Env.roc
-rw-r--r-- 1 jan jan 1.3K Nov 30 14:38 FileMetadata.roc
-rw-r--r-- 1 jan jan 9.8K Nov 30 14:38 File.roc
-rw-r--r-- 1 jan jan  399 Nov 30 14:38 glue.roc
-rw-r--r-- 1 jan jan 4.8K Nov 30 14:38 Http.roc
-rw-r--r-- 1 jan jan  813 Nov 30 14:38 InternalCommand.roc
-rw-r--r-- 1 jan jan 1.4K Nov 30 14:38 InternalFile.roc
-rw-r--r-- 1 jan jan 1.8K Nov 30 14:38 InternalHttp.roc
-rw-r--r-- 1 jan jan 3.6K Nov 30 14:38 InternalPath.roc
-rw-r--r-- 1 jan jan  263 Nov 30 14:38 libapp.roc
-rwxr-xr-x 1 jan jan  63K Nov 30 14:54 libapp.so
-rw-r--r-- 1 jan jan  14M Nov 30 14:54 libhost.a
-rw-r--r-- 1 jan jan  600 Nov 30 14:38 Locale.roc
-rw-r--r-- 1 jan jan 1.3K Nov 30 14:38 main.roc
-rw-r--r-- 1 jan jan  31K Nov 30 14:38 Path.roc
-rw-r--r-- 1 jan jan 3.1K Nov 30 14:38 PlatformTasks.roc
-rw-r--r-- 1 jan jan  310 Nov 30 14:38 Sleep.roc
-rw-r--r-- 1 jan jan 2.5K Nov 30 14:38 Stderr.roc
-rw-r--r-- 1 jan jan 4.1K Nov 30 14:38 Stdin.roc
-rw-r--r-- 1 jan jan 2.5K Nov 30 14:38 Stdout.roc
-rw-r--r-- 1 jan jan 6.4K Nov 30 14:38 Tcp.roc
-rw-r--r-- 1 jan jan 1.2K Nov 30 14:38 Tty.roc
-rw-r--r-- 1 jan jan  16K Nov 30 14:38 Url.roc
-rw-r--r-- 1 jan jan 2.4K Nov 30 14:38 Utc.roc
jan@lenny:~/_roc/basic-cli$
</code></pre></div>



<a name="485424114"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/485424114" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#485424114">(Nov 30 2024 at 22:03)</a>:</h4>
<p>An you've ran <code>roc build.roc</code> or just jumpstart?</p>



<a name="485424117"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/485424117" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jan kili <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#485424117">(Nov 30 2024 at 22:03)</a>:</h4>
<p>Oops, yeah I wanted legacy, Brendan mentioned that</p>
<div class="codehilite"><pre><span></span><code>jan@lenny:~/_roc/basic-cli$ roc build.roc --linker=legacy
INFO: Checking provided roc; executing `roc version`:
roc nightly pre-release, built from commit d72da8e on Fr 29 Nov 2024 09:11:57 UTC
INFO: Getting the native operating system and architecture ...
INFO: Building stubbed app shared library ...
0 errors and 0 warnings found in 336 ms
 while successfully building:

    platform/libapp.so
INFO: Building rust host ...
warning: skipping duplicate package `host` found at `/home/jan/.cargo/git/checkouts/roc-f2007fde281427d6/8c73786/examples/glue/rust-platform`
warning: skipping duplicate package `host` found at `/home/jan/.cargo/git/checkouts/roc-f2007fde281427d6/8c73786/examples/cli/false-interpreter/platform`
warning: skipping duplicate package `host` found at `/home/jan/.cargo/git/checkouts/roc-f2007fde281427d6/8c73786/crates/glue/tests/fixture-templates/rust`
    Finished `release` profile [optimized] target(s) in 0.37s
INFO: Failed to get env var CARGO_BUILD_TARGET with error VarNotFound. Assuming default CARGO_BUILD_TARGET (native)...
INFO: Moving the prebuilt binary from target/release/libhost.a to platform/linux-x64.a ...
INFO: Preprocessing surgical host ...
INFO: Successfully built platform files!
jan@lenny:~/_roc/basic-cli$
</code></pre></div>



<a name="485424141"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/485424141" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jan kili <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#485424141">(Nov 30 2024 at 22:03)</a>:</h4>
<p><span aria-label="tada" class="emoji emoji-1f389" role="img" title="tada">:tada:</span> <span aria-label="question" class="emoji emoji-2753" role="img" title="question">:question:</span> </p>
<div class="codehilite"><pre><span></span><code>jan@lenny:~/_roc/basic-cli$ roc examples/hello-world.roc
Hello, World!
jan@lenny:~/_roc/basic-cli$
</code></pre></div>



<a name="485424194"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/485424194" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#485424194">(Nov 30 2024 at 22:04)</a>:</h4>
<p>Nice</p>



<a name="485424208"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/485424208" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#485424208">(Nov 30 2024 at 22:04)</a>:</h4>
<p>Another data point for defaulting to linker legacy if it's available and the flag isn't provided</p>



<a name="485424226"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/485424226" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#485424226">(Nov 30 2024 at 22:05)</a>:</h4>
<p>I keep forgetting to make a PR for that</p>



<a name="485424237"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/485424237" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jan kili <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#485424237">(Nov 30 2024 at 22:05)</a>:</h4>
<div class="codehilite"><pre><span></span><code>jan@lenny:~/_roc/basic-cli$ does that mean purity inference is fully working in basic-cli@0.17.0?
bash: does: command not found
jan@lenny:~/_roc/basic-cli$
</code></pre></div>



<a name="485425077"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/485425077" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jan kili <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#485425077">(Nov 30 2024 at 22:19)</a>:</h4>
<p><span aria-label="stuck out tongue wink" class="emoji emoji-1f61c" role="img" title="stuck out tongue wink">:stuck_out_tongue_wink:</span> but really though, happy to run any other commands to help validate PI-in-BC</p>



<a name="485426605"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/485426605" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#485426605">(Nov 30 2024 at 22:45)</a>:</h4>
<p>You might need to install a few more deps, but can you run the CI test script</p>



<a name="485426706"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/485426706" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#485426706">(Nov 30 2024 at 22:46)</a>:</h4>
<p>If you could work through the commands here, it would be useful validation: <a href="https://github.com/roc-lang/basic-cli/blob/purity-inference/.github/workflows/ci.yml">https://github.com/roc-lang/basic-cli/blob/purity-inference/.github/workflows/ci.yml</a></p>



<a name="485426975"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/485426975" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jan kili <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#485426975">(Nov 30 2024 at 22:51)</a>:</h4>
<div class="codehilite"><pre><span></span><code>jan@lenny:~/_roc/basic-cli$ cat platform/src/lib.rs | grep -oP &#39;roc_fx_[^(\s]*&#39; | sort | uniq -u | grep -q .
cat: platform/src/lib.rs: No such file or directory
jan@lenny:~/_roc/basic-cli$ curl -fOL https://github.com/roc-lang/roc/releases/download/nightly/roc_nightly-linux_x86_64-TESTING.tar.gz
  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
  0     9    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0
curl: (22) The requested URL returned error: 404
jan@lenny:~/_roc/basic-cli$ curl -fOL https://github.com/roc-lang/roc/releases/download/nightly/roc_nightly-linux_x86_64-latest.tar.gz
  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0
100 34.1M  100 34.1M    0     0  14.0M      0  0:00:02  0:00:02 --:--:-- 21.2M
jan@lenny:~/_roc/basic-cli$ mv $(ls | grep &quot;roc_nightly.*tar\.gz&quot;) roc_nightly.tar.gz
jan@lenny:~/_roc/basic-cli$ tar -xzf roc_nightly.tar.gz
jan@lenny:~/_roc/basic-cli$ rm roc_nightly.tar.gz
jan@lenny:~/_roc/basic-cli$ mv roc_nightly* roc_nightly
jan@lenny:~/_roc/basic-cli$ ./roc_nightly/roc version
roc nightly pre-release, built from commit d72da8e on Fr 29 Nov 2024 09:11:57 UTC
jan@lenny:~/_roc/basic-cli$ sudo apt install -y expect ncat
[sudo] password for jan:
Reading package lists... Done
Building dependency tree... Done
Reading state information... Done
The following additional packages will be installed:
  liblua5.3-0 libtcl8.6 tcl-expect tcl8.6
Suggested packages:
  tk8.6 tcl-tclreadline
The following NEW packages will be installed:
  expect liblua5.3-0 libtcl8.6 ncat tcl-expect tcl8.6
0 upgraded, 6 newly installed, 0 to remove and 0 not upgraded.
Need to get 1,961 kB of archives.
After this operation, 6,186 kB of additional disk space will be used.
Get:1 http://deb.debian.org/debian bookworm/main amd64 libtcl8.6 amd64 8.6.13+dfsg-2 [1,035 kB]
Get:2 http://deb.debian.org/debian bookworm/main amd64 tcl8.6 amd64 8.6.13+dfsg-2 [120 kB]
Get:3 http://deb.debian.org/debian bookworm/main amd64 tcl-expect amd64 5.45.4-2+b1 [133 kB]
Get:4 http://deb.debian.org/debian bookworm/main amd64 expect amd64 5.45.4-2+b1 [166 kB]
Get:5 http://deb.debian.org/debian bookworm/main amd64 liblua5.3-0 amd64 5.3.6-2 [123 kB]
Get:6 http://deb.debian.org/debian bookworm/main amd64 ncat amd64 7.93+dfsg1-1 [384 kB]
Fetched 1,961 kB in 0s (6,665 kB/s)
Selecting previously unselected package libtcl8.6:amd64.
(Reading database ... 185306 files and directories currently installed.)
Preparing to unpack .../0-libtcl8.6_8.6.13+dfsg-2_amd64.deb ...
Unpacking libtcl8.6:amd64 (8.6.13+dfsg-2) ...
Selecting previously unselected package tcl8.6.
Preparing to unpack .../1-tcl8.6_8.6.13+dfsg-2_amd64.deb ...
Unpacking tcl8.6 (8.6.13+dfsg-2) ...
Selecting previously unselected package tcl-expect:amd64.
Preparing to unpack .../2-tcl-expect_5.45.4-2+b1_amd64.deb ...
Unpacking tcl-expect:amd64 (5.45.4-2+b1) ...
Selecting previously unselected package expect.
Preparing to unpack .../3-expect_5.45.4-2+b1_amd64.deb ...
Unpacking expect (5.45.4-2+b1) ...
Selecting previously unselected package liblua5.3-0:amd64.
Preparing to unpack .../4-liblua5.3-0_5.3.6-2_amd64.deb ...
Unpacking liblua5.3-0:amd64 (5.3.6-2) ...
Selecting previously unselected package ncat.
Preparing to unpack .../5-ncat_7.93+dfsg1-1_amd64.deb ...
Unpacking ncat (7.93+dfsg1-1) ...
Setting up libtcl8.6:amd64 (8.6.13+dfsg-2) ...
Setting up liblua5.3-0:amd64 (5.3.6-2) ...
Setting up tcl8.6 (8.6.13+dfsg-2) ...
Setting up tcl-expect:amd64 (5.45.4-2+b1) ...
Setting up ncat (7.93+dfsg1-1) ...
update-alternatives: using /usr/bin/ncat to provide /bin/nc (nc) in auto mode
Setting up expect (5.45.4-2+b1) ...
Processing triggers for man-db (2.11.2-2) ...
Processing triggers for libc-bin (2.36-9+deb12u9) ...
jan@lenny:~/_roc/basic-cli$ expect -v
expect version 5.45.4
</code></pre></div>



<a name="485427301"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/485427301" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jan kili <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#485427301">(Nov 30 2024 at 22:57)</a>:</h4>
<div class="codehilite"><pre><span></span><code>jan@lenny:~/_roc/basic-cli$ ROC=./roc_nightly/roc EXAMPLES_DIR=./examples/ ./ci/all_tests.sh &gt; pasteme.txt 2&gt;&amp;1
jan@lenny:~/_roc/basic-cli$
</code></pre></div>
<p><a href="https://pastebin.com/V5kGW7f9">https://pastebin.com/V5kGW7f9</a></p>



<a name="485427419"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/485427419" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jan kili <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#485427419">(Nov 30 2024 at 22:59)</a>:</h4>
<div class="codehilite"><pre><span></span><code>jan@lenny:~/_roc/basic-cli$ grep -zqv &quot;crashed&quot; pasteme.txt
jan@lenny:~/_roc/basic-cli$ sudo apt-get install -y musl-tools
Reading package lists... Done
Building dependency tree... Done
Reading state information... Done
The following additional packages will be installed:
  musl musl-dev
Recommended packages:
  linux-musl-dev
The following NEW packages will be installed:
  musl musl-dev musl-tools
0 upgraded, 3 newly installed, 0 to remove and 0 not upgraded.
Need to get 1,036 kB of archives.
After this operation, 3,954 kB of additional disk space will be used.
Get:1 http://deb.debian.org/debian bookworm/main amd64 musl amd64 1.2.3-1 [406 kB]
Get:2 http://deb.debian.org/debian bookworm/main amd64 musl-dev amd64 1.2.3-1 [587 kB]
Get:3 http://deb.debian.org/debian bookworm/main amd64 musl-tools amd64 1.2.3-1 [42.3 kB]
Fetched 1,036 kB in 0s (3,959 kB/s)
Selecting previously unselected package musl:amd64.
(Reading database ... 185670 files and directories currently installed.)
Preparing to unpack .../musl_1.2.3-1_amd64.deb ...
Unpacking musl:amd64 (1.2.3-1) ...
Selecting previously unselected package musl-dev:amd64.
Preparing to unpack .../musl-dev_1.2.3-1_amd64.deb ...
Unpacking musl-dev:amd64 (1.2.3-1) ...
Selecting previously unselected package musl-tools.
Preparing to unpack .../musl-tools_1.2.3-1_amd64.deb ...
Unpacking musl-tools (1.2.3-1) ...
Setting up musl:amd64 (1.2.3-1) ...
Setting up musl-dev:amd64 (1.2.3-1) ...
Setting up musl-tools (1.2.3-1) ...
Processing triggers for man-db (2.11.2-2) ...
jan@lenny:~/_roc/basic-cli$ rustup target add x86_64-unknown-linux-musl
info: downloading component &#39;rust-std&#39; for &#39;x86_64-unknown-linux-musl&#39;
info: installing component &#39;rust-std&#39; for &#39;x86_64-unknown-linux-musl&#39;
 33.0 MiB /  33.0 MiB (100 %)  15.0 MiB/s in  2s ETA:  0s
jan@lenny:~/_roc/basic-cli$ ROC=./roc_nightly/roc CARGO_BUILD_TARGET=x86_64-unknown-linux-musl ./roc_nightly/roc build.roc
INFO: Checking provided roc; executing `roc version`:
roc nightly pre-release, built from commit d72da8e on Fr 29 Nov 2024 09:11:57 UTC
INFO: Getting the native operating system and architecture ...
INFO: Building stubbed app shared library ...
0 errors and 0 warnings found in 425 ms
 while successfully building:

    platform/libapp.so
INFO: Building rust host ...
warning: skipping duplicate package `host` found at `/home/jan/.cargo/git/checkouts/roc-f2007fde281427d6/8c73786/examples/glue/rust-platform`
warning: skipping duplicate package `host` found at `/home/jan/.cargo/git/checkouts/roc-f2007fde281427d6/8c73786/examples/cli/false-interpreter/platform`
warning: skipping duplicate package `host` found at `/home/jan/.cargo/git/checkouts/roc-f2007fde281427d6/8c73786/crates/glue/tests/fixture-templates/rust`
   Compiling libc v0.2.155
   Compiling cfg-if v1.0.0
...
   Compiling roc_host_bin v0.0.1 (/home/jan/_roc/basic-cli/crates/roc_host_bin)
   Compiling host v0.0.1 (/home/jan/_roc/basic-cli/crates/roc_host_lib)
    Finished `release` profile [optimized] target(s) in 31.42s
INFO: Moving the prebuilt binary from target/x86_64-unknown-linux-musl/release/libhost.a to platform/linux-x64.a ...
INFO: Preprocessing surgical host ...
INFO: Successfully built platform files!
jan@lenny:~/_roc/basic-cli$
</code></pre></div>



<a name="485427536"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/485427536" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jan kili <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#485427536">(Nov 30 2024 at 23:01)</a>:</h4>
<div class="codehilite"><pre><span></span><code>jan@lenny:~/_roc/basic-cli$ NO_BUILD=1 ROC=./roc_nightly/roc EXAMPLES_DIR=./examples/ ./ci/all_tests.sh &gt; pasteme2.txt 2&gt;&amp;1
jan@lenny:~/_roc/basic-cli$
</code></pre></div>
<p><a href="https://pastebin.com/AWAaggwa">https://pastebin.com/AWAaggwa</a></p>



<a name="485427561"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/485427561" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jan kili <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#485427561">(Nov 30 2024 at 23:01)</a>:</h4>
<div class="codehilite"><pre><span></span><code>jan@lenny:~/_roc/basic-cli$ grep -zqv &quot;crashed&quot; pasteme2.txt
jan@lenny:~/_roc/basic-cli$ I think I did it!
bash: I: command not found
jan@lenny:~/_roc/basic-cli$
</code></pre></div>



<a name="485430118"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/485430118" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#485430118">(Nov 30 2024 at 23:47)</a>:</h4>
<p>Yay, but also <span aria-label="sad" class="emoji emoji-2639" role="img" title="sad">:sad:</span></p>



<a name="485430122"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/485430122" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#485430122">(Nov 30 2024 at 23:47)</a>:</h4>
<p>It's tricky to repro</p>



<a name="485435673"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/485435673" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#485435673">(Dec 01 2024 at 01:23)</a>:</h4>
<p>So no repro yet? I don't think I saw a segfualt anywhere above. I wonder if it is Ubuntu 20.04 specific. <span class="user-mention" data-user-id="361169">@Anton</span> any chance you can try to repro on something identical to CI?</p>
<p>Maybe I can just install Valgrind in CI and run with Valgrind?</p>



<a name="485440487"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/485440487" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#485440487">(Dec 01 2024 at 02:45)</a>:</h4>
<p>I can't repro it on my linux machine running native either. I'm going to restart that CI and see if that changes anything</p>



<a name="485440577"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/485440577" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jan kili <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#485440577">(Dec 01 2024 at 02:46)</a>:</h4>
<p>Is anyone hoping this goes green tonight to greenlight PI for AoC newcomers?</p>



<a name="485440670"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/485440670" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#485440670">(Dec 01 2024 at 02:48)</a>:</h4>
<p>I'd like to have it done, but I don't think we're in any rush to upgrade it to the latest supported release. Maybe make a pre-release sometime soon for those game to use it and not wanting to build from source.</p>



<a name="485440698"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/485440698" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#485440698">(Dec 01 2024 at 02:48)</a>:</h4>
<p>If we rush it, we're just likely to cause a lot of confusion and mess things up for people.</p>



<a name="485440927"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/485440927" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#485440927">(Dec 01 2024 at 02:53)</a>:</h4>
<p>I can make a pre-release "purity-inference" version of my AoC template in case anyone wants to use it and builds basic-cli from source.</p>



<a name="485440995"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/485440995" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#485440995">(Dec 01 2024 at 02:54)</a>:</h4>
<p>Added bonus if someone uses it and finds the bug that's blocking CI... we have a reproduction that we can glean some information from.</p>



<a name="485441898"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/485441898" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#485441898">(Dec 01 2024 at 03:10)</a>:</h4>
<p>I don't think I can make the template work with purity inference. <span class="user-mention" data-user-id="489294">@Agus Zubiaga</span> I might need your assistance to figure out if it's a me thing or something is broken</p>



<a name="485442008"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/485442008" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#485442008">(Dec 01 2024 at 03:11)</a>:</h4>
<p>I think I'm stuck on this error</p>
<div class="codehilite"><pre><span></span><code>$ roc check examples/2020/01.roc

── MODULE PARAMS MISMATCH in examples/2020/01.roc ──────────────────────────────

Something is off with the params provided by this import:

 9│&gt;  import aoc.AoC {
10│&gt;      stdin!: Stdin.bytes!,
11│&gt;      stdout!: Stdout.write!,
12│&gt;      time!: \{} -&gt; Utc.now! {} |&gt; Utc.toMillisSinceEpoch,
13│&gt;  }

This is the type I inferred:

    { stdin! : {} =&gt; Result (List U8) [
        EndOfFile,
        StdinErr [
            AlreadyExists,
            BrokenPipe,
            Interrupted,
            NotFound,
            Other Str,
            OutOfMemory,
            PermissionDenied,
            Unsupported,
        ],
    ], … }

However, AoC expects:

    { stdin! : effectful function, … }

────────────────────────────────────────────────────────────────────────────────

1 error and 4 warnings found in 20 ms
</code></pre></div>



<a name="485442083"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/485442083" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#485442083">(Dec 01 2024 at 03:13)</a>:</h4>
<p><a href="https://github.com/lukewilliamboswell/aoc-template/pull/5">https://github.com/lukewilliamboswell/aoc-template/pull/5</a></p>



<a name="485442198"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/485442198" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#485442198">(Dec 01 2024 at 03:15)</a>:</h4>
<p>Stripping it back to </p>
<div class="codehilite"><pre><span></span><code>module { stdin!, stdout!, time! } -&gt; [Solution, solve!]

Solution err : {
    year : U64,
    day : U64,
    title : Str,
    part1 : Str -&gt; Result Str err,
    part2 : Str -&gt; Result Str err,
} where err implements Inspect

solve! : Solution err =&gt; Result {} _
solve! = \{ year, day, title, part1, part2 } -&gt;
    Ok {}
</code></pre></div>
<p>I get the following error... </p>
<div class="codehilite"><pre><span></span><code>$ roc check examples/2020/01.roc

── MODULE PARAMS MISMATCH in examples/2020/01.roc ──────────────────────────────

Something is off with the params provided by this import:

 9│&gt;  import aoc.AoC {
10│&gt;      stdin!: Stdin.bytes!,
11│&gt;      stdout!: Stdout.write!,
12│&gt;      time!: \{} -&gt; Utc.now! {} |&gt; Utc.toMillisSinceEpoch,
13│&gt;  }

This is the type I inferred:

    {
        stdin! : {} =&gt; Result (List U8) [
            EndOfFile,
            StdinErr [
                AlreadyExists,
                BrokenPipe,
                Interrupted,
                NotFound,
                Other Str,
                OutOfMemory,
                PermissionDenied,
                Unsupported,
            ],
        ],
        stdout! : Str =&gt; Result {} [StdoutErr [
            AlreadyExists,
            BrokenPipe,
            Interrupted,
            NotFound,
            Other Str,
            OutOfMemory,
            PermissionDenied,
            Unsupported,
        ]],
        time! : {}e =&gt; I128,
    }

However, AoC expects:

    {
        stdin! : effectful function,
        stdout! : effectful function,
        time! : effectful function,
    }

────────────────────────────────────────────────────────────────────────────────

1 error and 8 warnings found in 20 ms
</code></pre></div>



<a name="485442315"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/485442315" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Agus Zubiaga <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#485442315">(Dec 01 2024 at 03:17)</a>:</h4>
<p>Interesting. That looks like we’re not constraining the module with params enough. <code>effectful function</code> means we only inferred it’s effectful from the name of the field, but we don’t know anything about the arguments or return type.</p>



<a name="485442337"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/485442337" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Agus Zubiaga <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#485442337">(Dec 01 2024 at 03:18)</a>:</h4>
<p>Unfortunately, I’m moving this whole weekend so I probably won’t have time to look at this until Monday</p>



<a name="485442420"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/485442420" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Agus Zubiaga <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#485442420">(Dec 01 2024 at 03:19)</a>:</h4>
<p>Are we planning to use purity inference for AoC?</p>



<a name="485442423"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/485442423" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#485442423">(Dec 01 2024 at 03:19)</a>:</h4>
<p>No</p>



<a name="485442427"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/485442427" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Agus Zubiaga <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#485442427">(Dec 01 2024 at 03:19)</a>:</h4>
<p>Ok, good <span aria-label="sweat smile" class="emoji emoji-1f605" role="img" title="sweat smile">:sweat_smile:</span></p>



<a name="485450730"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/485450730" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jan kili <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#485450730">(Dec 01 2024 at 05:47)</a>:</h4>
<p>I just jumped out of bed realizing everything I did above was on the <code>main</code> branch and y'all were probably wondering about the <code>purity-inference</code> branch.</p>



<a name="485450791"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/485450791" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jan kili <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#485450791">(Dec 01 2024 at 05:48)</a>:</h4>
<p><span class="user-mention" data-user-id="343810">@Brendan Hansknecht</span> does this look more like what you expected?</p>
<div class="codehilite"><pre><span></span><code>[jan@framey basic-cli]$ git status
On branch purity-inference
Your branch is up to date with &#39;origin/purity-inference&#39;.

nothing to commit, working tree clean
[jan@framey basic-cli]$ roc build.roc
roc: /lib64/libtinfo.so.6: no version information available (required by roc)
Error:

        Function, roc__mainForHost_0_caller, was not defined by the app.

Potential causes:

        - because the platform was built with a non-compatible version of roc compared to the one you are running.

                solutions:
                        + Downgrade your roc version to the one that was used to build the platform.
                        + Or ask the platform author to release a new version of the platform using a current roc release.

        - This can also occur due to a bug in the compiler. In that case, file an issue here: https://github.com/roc-lang/roc/issues/new/choose
[jan@framey basic-cli]$
</code></pre></div>
<p>(on Fedora 40 now, not at my Debian 12 machine until tomorrow)</p>



<a name="485450958"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/485450958" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jan kili <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#485450958">(Dec 01 2024 at 05:52)</a>:</h4>
<div class="codehilite"><pre><span></span><code>[jan@framey basic-cli]$ ./jump-start.sh
+ &#39;[&#39; -z &#39;&#39; &#39;]&#39;
+ echo &#39;Warning: ROC environment variable is not set... I&#39;\&#39;&#39;ll try with just &#39;\&#39;&#39;roc&#39;\&#39;&#39;.&#39;
Warning: ROC environment variable is not set... I&#39;ll try with just &#39;roc&#39;.
+ ROC=roc
+ roc build --lib ./platform/libapp.roc
roc: /lib64/libtinfo.so.6: no version information available (required by roc)
0 errors and 0 warnings found in 360 ms
 while successfully building:

    ./platform/libapp
+ cargo build --release
    Finished `release` profile [optimized] target(s) in 0.16s
+ &#39;[&#39; -n &#39;&#39; &#39;]&#39;
+ cp target/release/libhost.a ./platform/libhost.a
+ roc build --linker=legacy build.roc
roc: /lib64/libtinfo.so.6: no version information available (required by roc)
ld: platform/linux-x64.a(host-e4e7228faf4c51e3.host.62e8b11d478b1302-cgu.0.rcgu.o): in function `rust_main&#39;:
host.62e8b11d478b1302-cgu.0:(.text.rust_main+0x88): undefined reference to `roc__mainForHost_0_caller&#39;
ld: host.62e8b11d478b1302-cgu.0:(.text.rust_main+0xc2): undefined reference to `roc__mainForHost_0_caller&#39;
thread &#39;main&#39; panicked at crates/compiler/build/src/program.rs:1058:17:
not yet implemented: linker failed with exit code Some(1)
note: run with `RUST_BACKTRACE=1` environment variable to display a backtrace
[jan@framey basic-cli]$ roc build.roc --linker=legacy
roc: /lib64/libtinfo.so.6: no version information available (required by roc)
ld: platform/linux-x64.a(host-e4e7228faf4c51e3.host.62e8b11d478b1302-cgu.0.rcgu.o): in function `rust_main&#39;:
host.62e8b11d478b1302-cgu.0:(.text.rust_main+0x88): undefined reference to `roc__mainForHost_0_caller&#39;
ld: host.62e8b11d478b1302-cgu.0:(.text.rust_main+0xc2): undefined reference to `roc__mainForHost_0_caller&#39;
thread &#39;main&#39; panicked at crates/compiler/build/src/program.rs:1058:17:
not yet implemented: linker failed with exit code Some(1)
note: run with `RUST_BACKTRACE=1` environment variable to display a backtrace
[jan@framey basic-cli]$
[jan@framey basic-cli]$ roc build.roc --linker=legacy
roc: /lib64/libtinfo.so.6: no version information available (required by roc)
ld: platform/linux-x64.a(host-e4e7228faf4c51e3.host.62e8b11d478b1302-cgu.0.rcgu.o): in function `rust_main&#39;:
host.62e8b11d478b1302-cgu.0:(.text.rust_main+0x88): undefined reference to `roc__mainForHost_0_caller&#39;
ld: host.62e8b11d478b1302-cgu.0:(.text.rust_main+0xc2): undefined reference to `roc__mainForHost_0_caller&#39;
thread &#39;main&#39; panicked at crates/compiler/build/src/program.rs:1058:17:
not yet implemented: linker failed with exit code Some(1)
note: run with `RUST_BACKTRACE=1` environment variable to display a backtrace
[jan@framey basic-cli]$
</code></pre></div>



<a name="485451015"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/485451015" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#485451015">(Dec 01 2024 at 05:52)</a>:</h4>
<p>That is likely different. Probably from a stale <code>platform/linux_x64.a</code> (not sure I got that file name quite right). If you <code>rm platform/*.a</code> then <code>./jump-start.sh</code> again,what do you get?</p>



<a name="485451055"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/485451055" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jan kili <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#485451055">(Dec 01 2024 at 05:53)</a>:</h4>
<div class="codehilite"><pre><span></span><code>[jan@framey basic-cli]$ rm platform/*.a
[jan@framey basic-cli]$ ./jump-start.sh
+ &#39;[&#39; -z &#39;&#39; &#39;]&#39;
+ echo &#39;Warning: ROC environment variable is not set... I&#39;\&#39;&#39;ll try with just &#39;\&#39;&#39;roc&#39;\&#39;&#39;.&#39;
Warning: ROC environment variable is not set... I&#39;ll try with just &#39;roc&#39;.
+ ROC=roc
+ roc build --lib ./platform/libapp.roc
roc: /lib64/libtinfo.so.6: no version information available (required by roc)
0 errors and 0 warnings found in 351 ms
 while successfully building:

    ./platform/libapp
+ cargo build --release
    Finished `release` profile [optimized] target(s) in 0.18s
+ &#39;[&#39; -n &#39;&#39; &#39;]&#39;
+ cp target/release/libhost.a ./platform/libhost.a
+ roc build --linker=legacy build.roc
roc: /lib64/libtinfo.so.6: no version information available (required by roc)
0 errors and 0 warnings found in 986 ms
 while successfully building:

    build
[jan@framey basic-cli]$ roc build.roc
roc: /lib64/libtinfo.so.6: no version information available (required by roc)
Error:

        Function, roc__mainForHost_0_caller, was not defined by the app.

Potential causes:

        - because the platform was built with a non-compatible version of roc compared to the one you are running.

                solutions:
                        + Downgrade your roc version to the one that was used to build the platform.
                        + Or ask the platform author to release a new version of the platform using a current roc release.

        - This can also occur due to a bug in the compiler. In that case, file an issue here: https://github.com/roc-lang/roc/issues/new/choose
[jan@framey basic-cli]$ roc build.roc --linker=legacy
roc: /lib64/libtinfo.so.6: no version information available (required by roc)
INFO: Checking provided roc; executing `roc version`:
roc: /lib64/libtinfo.so.6: no version information available (required by roc)
roc nightly pre-release, built from commit d72da8e on Fr 29 Nov 2024 09:11:57 UTC
INFO: Getting the native operating system and architecture ...
INFO: Building stubbed app shared library ...
roc: /lib64/libtinfo.so.6: no version information available (required by roc)
0 errors and 0 warnings found in 949 ms
 while successfully building:

    platform/libapp.so
INFO: Building rust host ...
    Finished `release` profile [optimized] target(s) in 0.20s
INFO: Failed to get env var CARGO_BUILD_TARGET with error VarNotFound. Assuming default CARGO_BUILD_TARGET (native)...
INFO: Moving the prebuilt binary from target/release/libhost.a to platform/linux-x64.a ...
INFO: Preprocessing surgical host ...
roc: /lib64/libtinfo.so.6: no version information available (required by roc)
INFO: Successfully built platform files!
[jan@framey basic-cli]$ roc examples/hello-world.roc
roc: /lib64/libtinfo.so.6: no version information available (required by roc)
Hello, World!
[jan@framey basic-cli]$
</code></pre></div>



<a name="485451102"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/485451102" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eli Dowling <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#485451102">(Dec 01 2024 at 05:54)</a>:</h4>
<p>I also looked into this, I was able to get purity inference basic cli to build fine (I had to use the jumpstart.s,)  I'm on nixos.</p>
<p>I also tried fixing the AOC template:<br>
I learned a few things</p>
<ol>
<li>The  type checking of modules  isn't correctly detecting whether it should enable purity inference or tasks effect mode. I had a bunch of errors saying "stdout" isn't a function because it was looking for that rather than "stout!" I fixed this temporarily by modifying the compiler to always use purity inference mode.</li>
<li>That change doesn't help the overall AOC template issue <span aria-label="sweat smile" class="emoji emoji-1f605" role="img" title="sweat smile">:sweat_smile:</span></li>
</ol>



<a name="485451244"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/485451244" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jan kili <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#485451244">(Dec 01 2024 at 05:57)</a>:</h4>
<p>Looks like the above is green (on Fedora 40)</p>



<a name="485451339"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/485451339" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jan kili <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#485451339">(Dec 01 2024 at 05:58)</a>:</h4>
<p><span aria-label="salute" class="emoji emoji-1fae1" role="img" title="salute">:salute:</span> back to bed for me then</p>



<a name="485451960"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/485451960" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eli Dowling <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#485451960">(Dec 01 2024 at 06:08)</a>:</h4>
<p>I fixed it!!</p>



<a name="485452496"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/485452496" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#485452496">(Dec 01 2024 at 06:18)</a>:</h4>
<p>I assume the aoc template not the basic CLI issue in ci</p>



<a name="485453518"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/485453518" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eli Dowling <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#485453518">(Dec 01 2024 at 06:36)</a>:</h4>
<p>Yeah, the template issue.<br>
I'm working on making a test and also fixing the type checking issue .<br>
The fix was:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="c1">// The existing effectul function unification function:</span>
<span class="w">        </span><span class="p">(</span><span class="n">EffectfulFunc</span><span class="p">,</span><span class="w"> </span><span class="n">Func</span><span class="p">(</span><span class="n">args</span><span class="p">,</span><span class="w"> </span><span class="n">closure</span><span class="p">,</span><span class="w"> </span><span class="n">ret</span><span class="p">,</span><span class="w"> </span><span class="n">fx</span><span class="p">))</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">outcome</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">unify_pool</span><span class="p">(</span><span class="n">env</span><span class="p">,</span><span class="w"> </span><span class="n">pool</span><span class="p">,</span><span class="w"> </span><span class="n">Variable</span><span class="p">::</span><span class="n">EFFECTFUL</span><span class="p">,</span><span class="w"> </span><span class="o">*</span><span class="n">fx</span><span class="p">,</span><span class="w"> </span><span class="n">ctx</span><span class="p">.</span><span class="n">mode</span><span class="p">);</span>

<span class="w">            </span><span class="n">outcome</span><span class="p">.</span><span class="k">union</span><span class="p">(</span><span class="n">merge</span><span class="p">(</span>
<span class="w">                </span><span class="n">env</span><span class="p">,</span>
<span class="w">                </span><span class="n">ctx</span><span class="p">,</span>
<span class="w">                </span><span class="n">Structure</span><span class="p">(</span><span class="n">Func</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span><span class="w"> </span><span class="o">*</span><span class="n">closure</span><span class="p">,</span><span class="w"> </span><span class="o">*</span><span class="n">ret</span><span class="p">,</span><span class="w"> </span><span class="n">Variable</span><span class="p">::</span><span class="n">EFFECTFUL</span><span class="p">)),</span>
<span class="w">            </span><span class="p">));</span>

<span class="w">            </span><span class="n">outcome</span>
<span class="w">        </span><span class="p">}</span>
<span class="c1">//I added this becasue it seemed to not be unifying properly and just leaving the function as effectful func so I assumed it never processed the oppisite case</span>
<span class="w">        </span><span class="p">(</span><span class="n">Func</span><span class="p">(</span><span class="n">args</span><span class="p">,</span><span class="w"> </span><span class="n">closure</span><span class="p">,</span><span class="w"> </span><span class="n">ret</span><span class="p">,</span><span class="w"> </span><span class="n">fx</span><span class="p">),</span><span class="w"> </span><span class="n">EffectfulFunc</span><span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">outcome</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">unify_pool</span><span class="p">(</span><span class="n">env</span><span class="p">,</span><span class="w"> </span><span class="n">pool</span><span class="p">,</span><span class="w"> </span><span class="o">*</span><span class="n">fx</span><span class="p">,</span><span class="w"> </span><span class="n">Variable</span><span class="p">::</span><span class="n">EFFECTFUL</span><span class="p">,</span><span class="w"> </span><span class="n">ctx</span><span class="p">.</span><span class="n">mode</span><span class="p">);</span>

<span class="w">            </span><span class="n">outcome</span><span class="p">.</span><span class="k">union</span><span class="p">(</span><span class="n">merge</span><span class="p">(</span>
<span class="w">                </span><span class="n">env</span><span class="p">,</span>
<span class="w">                </span><span class="n">ctx</span><span class="p">,</span>
<span class="w">                </span><span class="n">Structure</span><span class="p">(</span><span class="n">Func</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span><span class="w"> </span><span class="o">*</span><span class="n">closure</span><span class="p">,</span><span class="w"> </span><span class="o">*</span><span class="n">ret</span><span class="p">,</span><span class="w"> </span><span class="n">Variable</span><span class="p">::</span><span class="n">EFFECTFUL</span><span class="p">)),</span>
<span class="w">            </span><span class="p">));</span>

<span class="w">            </span><span class="n">outcome</span>
<span class="w">        </span><span class="p">}</span>
</code></pre></div>



<a name="485454408"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/485454408" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eli Dowling <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#485454408">(Dec 01 2024 at 06:50)</a>:</h4>
<p>I think the current method for detecting whether a module should be using purity inference or Task effects is kind of janky and error prone.<br>
For example if I require a record containing an effectful function it will break.<br>
But given I assume tasks will be removed soon I suppose it's okay</p>



<a name="485456384"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/485456384" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eli Dowling <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#485456384">(Dec 01 2024 at 07:23)</a>:</h4>
<p>Here is the PR fixing it:<br>
<a href="https://github.com/roc-lang/roc/pull/7285">https://github.com/roc-lang/roc/pull/7285</a></p>



<a name="485472328"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/485472328" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Agus Zubiaga <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#485472328">(Dec 01 2024 at 11:09)</a>:</h4>
<p>Awesome! Great catch</p>



<a name="485472603"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/485472603" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Agus Zubiaga <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#485472603">(Dec 01 2024 at 11:13)</a>:</h4>
<p>I guess the issue you found with the compiler not switching to purity inference mode was because you had no <code>main.roc</code>, so it wasn’t finding a <code>hosted</code> module on the platform with a <code>!</code>-suffixed function when you <code>roc check</code> a <code>module</code></p>



<a name="485473010"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/485473010" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Agus Zubiaga <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#485473010">(Dec 01 2024 at 11:19)</a>:</h4>
<p>That’s a tricky case to detect reliably, because we need to switch to the right mode before canonicalization, but I don’t know if we have the all the context from just the parser</p>



<a name="485473183"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/485473183" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Agus Zubiaga <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#485473183">(Dec 01 2024 at 11:21)</a>:</h4>
<p>Maybe we can visit all the exprs looking for <code>!</code>-suffixed defs and record fields (not call exprs because those could be tasks with the  <code>!</code> operator)</p>



<a name="485473298"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/485473298" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Agus Zubiaga <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#485473298">(Dec 01 2024 at 11:23)</a>:</h4>
<p>Using the platform is way easier to tell, but of course, we have no platform in this case</p>



<a name="485474267"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/485474267" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anton <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#485474267">(Dec 01 2024 at 11:37)</a>:</h4>
<blockquote>
<p>any chance you can try to repro on something identical to CI?</p>
</blockquote>
<p>It's using a github CI machine, I'm just going to try calling valgrind in the ci workflow</p>



<a name="485477816"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/485477816" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anton <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#485477816">(Dec 01 2024 at 12:33)</a>:</h4>
<div class="codehilite"><pre><span></span><code> + valgrind ./examples//args div -n 5 -d 20
==5956== Memcheck, a memory error detector
==5956== Copyright (C) 2002-2017, and GNU GPL&#39;d, by Julian Seward et al.
==5956== Using Valgrind-3.18.1 and LibVEX; rerun with -h for copyright info
==5956== Command: ./examples//args div -n 5 -d 20
==5956==
received argument: div
==5956== Can&#39;t extend stack to 0x4803138 during signal delivery for thread 1:
==5956==   no stack segment
==5956==
==5956== Process terminating with default action of signal 11 (SIGSEGV)
==5956==  Access not within mapped region at address 0x4803138
==5956==    at 0x2C1045: ??? (in /home/runner/work/basic-cli/basic-cli/examples/args)
==5956==    by 0x24AC63: ??? (in /home/runner/work/basic-cli/basic-cli/examples/args)
==5956==    by 0x12950D: ??? (in /home/runner/work/basic-cli/basic-cli/examples/args)
==5956==    by 0x480423F: ???
==5956==    by 0x1294F2: ??? (in /home/runner/work/basic-cli/basic-cli/examples/args)
==5956==    by 0x480423F: ???
==5956==    by 0x12981C: ??? (in /home/runner/work/basic-cli/basic-cli/examples/args)
==5956==    by 0x3E8: ???
==5956==    by 0x7E: ???
==5956==  If you believe this happened as a result of a stack
==5956==  overflow in your program&#39;s main thread (unlikely but
==5956==  possible), you can try to increase the size of the
==5956==  main thread stack using the --main-stacksize= flag.
==5956==  The main thread stack size used in this run was 16777216.
==5956==
==5956== HEAP SUMMARY:
==5956==     in use at exit: 0 bytes in 0 blocks
==5956==   total heap usage: 0 allocs, 0 frees, 0 bytes allocated
==5956==
==5956== All heap blocks were freed -- no leaks are possible
==5956==
==5956== For lists of detected and suppressed errors, rerun with: -s
==5956== ERROR SUMMARY: 0 errors from 0 contexts (suppressed: 0 from 0)
./ci/all_tests.sh: line 60:  5956 Segmentation fault      (core dumped) valgrind $EXAMPLES_DIR/args div -n 5 -d 20
</code></pre></div>
<p>I can try with the legacy linker tomorrow to clear up the <code>???</code></p>



<a name="485477938"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/485477938" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anton <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#485477938">(Dec 01 2024 at 12:34)</a>:</h4>
<p>This could be <a href="https://github.com/roc-lang/roc/issues/5924">#5924</a></p>



<a name="485478203"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/485478203" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anton <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#485478203">(Dec 01 2024 at 12:38)</a>:</h4>
<p>You can probably see the valgrind errors locally</p>



<a name="485479249"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/485479249" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anton <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#485479249">(Dec 01 2024 at 12:55)</a>:</h4>
<p>I made a small change and now I see <code>__run_exit_handlers</code> and <code>exit</code> in the valgrind output, so it is very likely <a href="https://github.com/roc-lang/roc/issues/5924">#5924</a></p>



<a name="485479927"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/485479927" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anton <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#485479927">(Dec 01 2024 at 13:04)</a>:</h4>
<p>btw if it is <a href="https://github.com/roc-lang/roc/issues/5924">#5924</a>, using the legacy linker will make the issue disappear</p>



<a name="485480010"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/485480010" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eli Dowling <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#485480010">(Dec 01 2024 at 13:05)</a>:</h4>
<p><span class="user-mention silent" data-user-id="489294">Agus Zubiaga</span> <a href="#narrow/stream/316715-contributing/topic/basic-cli.20purity.20inference/near/485473010">said</a>:</p>
<blockquote>
<p>That’s a tricky case to detect reliably, because we need to switch to the right mode before canonicalization, but I don’t know if we have the all the context from just the parser</p>
</blockquote>
<p>Does this, issue just kind of go away when we remove Tasks though? Like we can then not bother detecting if it's purity inference for tasks</p>



<a name="485480141"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/485480141" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eli Dowling <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#485480141">(Dec 01 2024 at 13:07)</a>:</h4>
<p>As in, the current solution is imperfect but also very temporary, so it's not a big deal.</p>



<a name="485480708"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/485480708" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Agus Zubiaga <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#485480708">(Dec 01 2024 at 13:16)</a>:</h4>
<p>Yeah, totally</p>



<a name="486160194"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/486160194" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anton <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#486160194">(Dec 04 2024 at 19:03)</a>:</h4>
<p>From my experience with <a href="https://github.com/roc-lang/roc/issues/5924">#5924</a>, we'll probably be good if we add or remove a roc_fx function from crates/roc_host/src/lib.rs, anybody any ideas for functionality we can add or leave out?</p>



<a name="486161108"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/486161108" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#486161108">(Dec 04 2024 at 19:09)</a>:</h4>
<p>Lol, I didn't realise this could be a workaround. I could add something random in that we don't need pretty easily.</p>



<a name="487106701"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/487106701" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#487106701">(Dec 09 2024 at 21:52)</a>:</h4>
<p>A minor addition would be adding <a href="https://doc.rust-lang.org/std/fs/fn.hard_link.html">https://doc.rust-lang.org/std/fs/fn.hard_link.html</a> but something more substantial could be a semaphore.</p>



<a name="487106762"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/487106762" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#487106762">(Dec 09 2024 at 21:52)</a>:</h4>
<p>I can start with hard linking, and then soft linking, and if those don't work we try something else?</p>



<a name="487106867"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/487106867" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#487106867">(Dec 09 2024 at 21:53)</a>:</h4>
<p><span class="user-mention" data-user-id="515757">@Luke Boswell</span> thoughts?</p>



<a name="487107255"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/487107255" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#487107255">(Dec 09 2024 at 21:55)</a>:</h4>
<p>Okay, I'll give that a go</p>



<a name="487120451"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/487120451" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#487120451">(Dec 09 2024 at 23:23)</a>:</h4>
<p>Adding hard link doesn't seem to have worked</p>



<a name="487150138"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/487150138" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#487150138">(Dec 10 2024 at 03:18)</a>:</h4>
<p>I'm thinking of merging <span class="user-mention" data-user-id="651372">@Eli Dowling</span>'s PR <a href="https://github.com/roc-lang/basic-cli/pull/278">https://github.com/roc-lang/basic-cli/pull/278</a> into the PI branch. We don't have CI oversight here, but we haven't got everything passing yet anyway, and I think we should include the changes.</p>



<a name="487150203"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/487150203" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#487150203">(Dec 10 2024 at 03:19)</a>:</h4>
<p>I'm not about the merge it rn, but if there's no objections I can do it tomorrow.</p>



<a name="487150751"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/487150751" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#487150751">(Dec 10 2024 at 03:23)</a>:</h4>
<p>Good idea!</p>



<a name="487150774"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/487150774" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#487150774">(Dec 10 2024 at 03:23)</a>:</h4>
<p>I'll review before then</p>



<a name="487208264"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/487208264" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anton <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#487208264">(Dec 10 2024 at 10:11)</a>:</h4>
<p>I do think we should make ci/all_tests.sh pass on <a href="https://github.com/roc-lang/basic-cli/pull/278">https://github.com/roc-lang/basic-cli/pull/278</a> before the merge, that just seems easier.</p>



<a name="487350379"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/487350379" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#487350379">(Dec 10 2024 at 22:18)</a>:</h4>
<p><span class="user-mention" data-user-id="461444">@Sam Mohr</span> did you make much progress? </p>
<p>I am just looking at CI and it looks like we've progressed significantly, it's only failing in native now.</p>



<a name="487350461"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/487350461" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#487350461">(Dec 10 2024 at 22:19)</a>:</h4>
<p><span class="user-mention" data-user-id="343810">@Brendan Hansknecht</span> or anyone familiar with valgrind... can we glean anything from this?</p>
<div class="codehilite"><pre><span></span><code>+ valgrind ./examples//args div -n 5 -d 20
==4550== Memcheck, a memory error detector
==4550== Copyright (C) 2002-2017, and GNU GPL&#39;d, by Julian Seward et al.
==4550== Using Valgrind-3.15.0 and LibVEX; rerun with -h for copyright info
==4550== Command: ./examples//args div -n 5 -d 20
==4550==
received argument: div
==4550== Can&#39;t extend stack to 0x484c138 during signal delivery for thread 1:
==4550==   no stack segment
==4550==
==4550== Process terminating with default action of signal 11 (SIGSEGV)
==4550==  Access not within mapped region at address 0x484C138
==4550==    at 0x2B0004: ??? (in /home/runner/work/basic-cli/basic-cli/examples/args)
==4550==    by 0x48EE8A6: __run_exit_handlers (exit.c:108)
==4550==    by 0x48EEA5F: exit (exit.c:139)
==4550==    by 0x2556C4: ??? (in /home/runner/work/basic-cli/basic-cli/examples/args)
==4550==    by 0x255653: ??? (in /home/runner/work/basic-cli/basic-cli/examples/args)
==4550==    by 0x12859D: ??? (in /home/runner/work/basic-cli/basic-cli/examples/args)
==4550==  If you believe this happened as a result of a stack
==4550==  overflow in your program&#39;s main thread (unlikely but
==4550==  possible), you can try to increase the size of the
==4550==  main thread stack using the --main-stacksize= flag.
==4550==  The main thread stack size used in this run was 16777216.
==4550== Invalid write of size 8
==4550==    at 0x4831134: _vgnU_freeres (in /usr/lib/x86_64-linux-gnu/valgrind/vgpreload_core-amd64-linux.so)
==4550==  Address 0x484cff8 is on thread 1&#39;s stack
==4550==
==4550==
==4550== Process terminating with default action of signal 11 (SIGSEGV)
==4550==  Access not within mapped region at address 0x484CFF8
==4550==    at 0x4831134: _vgnU_freeres (in /usr/lib/x86_64-linux-gnu/valgrind/vgpreload_core-amd64-linux.so)
==4550==  If you believe this happened as a result of a stack
==4550==  overflow in your program&#39;s main thread (unlikely but
==4550==  possible), you can try to increase the size of the
==4550==  main thread stack using the --main-stacksize= flag.
==4550==  The main thread stack size used in this run was 16777216.
==4550==
==4550== HEAP SUMMARY:
==4550==     in use at exit: 0 bytes in 0 blocks
==4550==   total heap usage: 16 allocs, 16 frees, 3,330 bytes allocated
==4550==
==4550== All heap blocks were freed -- no leaks are possible
==4550==
==4550== For lists of detected and suppressed errors, rerun with: -s
==4550== ERROR SUMMARY: 1 errors from 1 contexts (suppressed: 0 from 0)
./ci/all_tests.sh: line 60:  4550 Segmentation fault      (core dumped) valgrind $EXAMPLES_DIR/args div -n 5 -d 20
Error: Process completed with exit code 139.
</code></pre></div>



<a name="487351164"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/487351164" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#487351164">(Dec 10 2024 at 22:26)</a>:</h4>
<p>oh... I think I found something <span aria-label="fingers crossed" class="emoji emoji-1f91e" role="img" title="fingers crossed">:fingers_crossed:</span>  that is just completely wrong. The args example doesn't do that anymore!</p>



<a name="487351693"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/487351693" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#487351693">(Dec 10 2024 at 22:30)</a>:</h4>
<p>can you share what you found, I'm curious</p>



<a name="487351728"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/487351728" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#487351728">(Dec 10 2024 at 22:31)</a>:</h4>
<p><a href="https://github.com/roc-lang/basic-cli/pull/257/commits/cb9fface5c9aef5186b68d6e4be72e22ad36932f">https://github.com/roc-lang/basic-cli/pull/257/commits/cb9fface5c9aef5186b68d6e4be72e22ad36932f</a></p>



<a name="487351772"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/487351772" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#487351772">(Dec 10 2024 at 22:31)</a>:</h4>
<p>We were calling the args example <code>valgrind $EXAMPLES_DIR/args div -n 5 -d 20</code> but args has been dramatically simplified so we don't have a dependency on Weaver any more</p>



<a name="487352039"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/487352039" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#487352039">(Dec 10 2024 at 22:34)</a>:</h4>
<p>Ah, maybe that was just our setup for investigating the segfault...</p>



<a name="487352825"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/487352825" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#487352825">(Dec 10 2024 at 22:40)</a>:</h4>
<p>Added it back and getting the same segfault in CI. <span aria-label="sad" class="emoji emoji-2639" role="img" title="sad">:sad:</span></p>



<a name="487354714"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/487354714" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#487354714">(Dec 10 2024 at 22:56)</a>:</h4>
<p>I'm pretty sure the issue is related to ubuntu-20.04, I can't repro on my 22.04. I might try disabling that machine... just to confirm CI passes for 22.04 also.</p>



<a name="487356660"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/487356660" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#487356660">(Dec 10 2024 at 23:15)</a>:</h4>
<p>Is the failure with both surgical and legacy linker? Can we change ci test check?</p>



<a name="487360811"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/487360811" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#487360811">(Dec 10 2024 at 23:57)</a>:</h4>
<p>Ok, so using only legacy linker and valgrind is happy... </p>
<div class="codehilite"><pre><span></span><code>+ valgrind --main-stacksize=32777216 --track-origins=yes --leak-check=full --show-leak-kinds=all --verbose ./examples//args argument
==4639== Memcheck, a memory error detector
==4639== Copyright (C) 2002-2017, and GNU GPL&#39;d, by Julian Seward et al.
==4639== Using Valgrind-3.15.0-608cb11914-20190413 and LibVEX; rerun with -h for copyright info
==4639== Command: ./examples//args argument
--4639-- Reading syms from /usr/lib/x86_64-linux-gnu/libc-2.31.so
--4639--   Considering /usr/lib/debug/.build-id/07/02430aef5fa3dda43986563e9ffcc47efbd75e.debug ..
--4639--   .. build-id is valid
--4639-- Reading syms from /usr/lib/x86_64-linux-gnu/libm-2.31.so
--4639--   Considering /usr/lib/debug/.build-id/8d/2573eff281739f0e2b0eb710c860ce0b7261cf.debug ..
--4639--   .. build-id is valid
--4639-- Reading syms from /usr/lib/x86_64-linux-gnu/libpthread-2.31.so
--4639--   Considering /usr/lib/debug/.build-id/9a/65bb469e45a1c6fbcffae5b82a2fd7a69eb479.debug ..
--4639--   .. build-id is valid
--4639-- Reading syms from /usr/lib/x86_64-linux-gnu/libdl-2.31.so
--4639--   Considering /usr/lib/debug/.build-id/25/372f43dbcc661aa02020d0365c948e89f6e612.debug ..
--4639--   .. build-id is valid
--4639-- Reading syms from /usr/lib/x86_64-linux-gnu/librt-2.31.so
--4639--   Considering /usr/lib/debug/.build-id/fc/7c873442781f08af6bc88f1acac7ecccec7285.debug ..
--4639--   .. build-id is valid
--4639-- Reading syms from /usr/lib/x86_64-linux-gnu/libutil-2.31.so
--4639--   Considering /usr/lib/debug/.build-id/24/4c5140c0521c81914afe5d92ad5ccc954857d5.debug ..
--4639--   .. build-id is valid
--4639-- Reading syms from /usr/lib/x86_64-linux-gnu/libgcc_s.so.1
--4639--    object doesn&#39;t have a symbol table
--4639-- REDIR: 0x48fa480 (libc.so.6:memmove) redirected to 0x48311d0 (_vgnU_ifunc_wrapper)
--4639-- REDIR: 0x48f9780 (libc.so.6:strncpy) redirected to 0x48311d0 (_vgnU_ifunc_wrapper)
--4639-- REDIR: 0x48fa7b0 (libc.so.6:strcasecmp) redirected to 0x48311d0 (_vgnU_ifunc_wrapper)
--4639-- REDIR: 0x48f90a0 (libc.so.6:strcat) redirected to 0x48311d0 (_vgnU_ifunc_wrapper)
--4639-- REDIR: 0x48f97e0 (libc.so.6:rindex) redirected to 0x48311d0 (_vgnU_ifunc_wrapper)
--4639-- REDIR: 0x48fbc50 (libc.so.6:rawmemchr) redirected to 0x48311d0 (_vgnU_ifunc_wrapper)
--4639-- REDIR: 0x4916ce0 (libc.so.6:wmemchr) redirected to 0x48311d0 (_vgnU_ifunc_wrapper)
--4639-- REDIR: 0x4916820 (libc.so.6:wcscmp) redirected to 0x48311d0 (_vgnU_ifunc_wrapper)
--4639-- REDIR: 0x48fa5e0 (libc.so.6:mempcpy) redirected to 0x48311d0 (_vgnU_ifunc_wrapper)
--4639-- REDIR: 0x48fa410 (libc.so.6:bcmp) redirected to 0x48311d0 (_vgnU_ifunc_wrapper)
--4639-- REDIR: 0x48f9710 (libc.so.6:strncmp) redirected to 0x48311d0 (_vgnU_ifunc_wrapper)
--4639-- REDIR: 0x48f9150 (libc.so.6:strcmp) redirected to 0x48311d0 (_vgnU_ifunc_wrapper)
--4639-- REDIR: 0x48fa540 (libc.so.6:memset) redirected to 0x48311d0 (_vgnU_ifunc_wrapper)
--4639-- REDIR: 0x49167e0 (libc.so.6:wcschr) redirected to 0x48311d0 (_vgnU_ifunc_wrapper)
--4639-- REDIR: 0x48f9670 (libc.so.6:strnlen) redirected to 0x48311d0 (_vgnU_ifunc_wrapper)
--4639-- REDIR: 0x48f9230 (libc.so.6:strcspn) redirected to 0x48311d0 (_vgnU_ifunc_wrapper)
--4639-- REDIR: 0x48fa800 (libc.so.6:strncasecmp) redirected to 0x48311d0 (_vgnU_ifunc_wrapper)
--4639-- REDIR: 0x48f91d0 (libc.so.6:strcpy) redirected to 0x48311d0 (_vgnU_ifunc_wrapper)
--4639-- REDIR: 0x48fa950 (libc.so.6:memcpy@@GLIBC_2.14) redirected to 0x48311d0 (_vgnU_ifunc_wrapper)
--4639-- REDIR: 0x4917f50 (libc.so.6:wcsnlen) redirected to 0x48311d0 (_vgnU_ifunc_wrapper)
--4639-- REDIR: 0x4916860 (libc.so.6:wcscpy) redirected to 0x48311d0 (_vgnU_ifunc_wrapper)
--4639-- REDIR: 0x48f9820 (libc.so.6:strpbrk) redirected to 0x48311d0 (_vgnU_ifunc_wrapper)
--4639-- REDIR: 0x48f9100 (libc.so.6:index) redirected to 0x48311d0 (_vgnU_ifunc_wrapper)
--4639-- REDIR: 0x48f9630 (libc.so.6:strlen) redirected to 0x48311d0 (_vgnU_ifunc_wrapper)
--4639-- REDIR: 0x4902bb0 (libc.so.6:memrchr) redirected to 0x48311d0 (_vgnU_ifunc_wrapper)
--4639-- REDIR: 0x48fa850 (libc.so.6:strcasecmp_l) redirected to 0x48311d0 (_vgnU_ifunc_wrapper)
--4639-- REDIR: 0x48fa3d0 (libc.so.6:memchr) redirected to 0x48311d0 (_vgnU_ifunc_wrapper)
--4639-- REDIR: 0x4916930 (libc.so.6:wcslen) redirected to 0x48311d0 (_vgnU_ifunc_wrapper)
--4639-- REDIR: 0x48f9ae0 (libc.so.6:strspn) redirected to 0x48311d0 (_vgnU_ifunc_wrapper)
--4639-- REDIR: 0x48fa750 (libc.so.6:stpncpy) redirected to 0x48311d0 (_vgnU_ifunc_wrapper)
--4639-- REDIR: 0x48fa6f0 (libc.so.6:stpcpy) redirected to 0x48311d0 (_vgnU_ifunc_wrapper)
--4639-- REDIR: 0x48fbc90 (libc.so.6:strchrnul) redirected to 0x48311d0 (_vgnU_ifunc_wrapper)
--4639-- REDIR: 0x48fa8a0 (libc.so.6:strncasecmp_l) redirected to 0x48311d0 (_vgnU_ifunc_wrapper)
--4639-- REDIR: 0x49e2730 (libc.so.6:__strrchr_avx2) redirected to 0x483ea10 (rindex)
--4639-- REDIR: 0x48f40e0 (libc.so.6:malloc) redirected to 0x483b780 (malloc)
--4639-- REDIR: 0x49e2900 (libc.so.6:__strlen_avx2) redirected to 0x483ef40 (strlen)
--4639-- REDIR: 0x48f46d0 (libc.so.6:free) redirected to 0x483c9d0 (free)
--4639-- REDIR: 0x49de230 (libc.so.6:__strncmp_avx2) redirected to 0x483f670 (strncmp)
--4639-- REDIR: 0x48f5b10 (libc.so.6:calloc) redirected to 0x483dce0 (calloc)
received argument: argument
==4639==
==4639== HEAP SUMMARY:
==4639==     in use at exit: 0 bytes in 0 blocks
==4639==   total heap usage: 8 allocs, 8 frees, 1,320 bytes allocated
==4639==
==4639== All heap blocks were freed -- no leaks are possible
==4639==
==4639== ERROR SUMMARY: 0 errors from 0 contexts (suppressed: 0 from 0)
</code></pre></div>
<p>But, now CI is stopping on another thing... so need to investigate that also. It may be related. </p>
<div class="codehilite"><pre><span></span><code>+ ./roc_nightly/roc dev ./examples/command.roc
BAZ=DUCK
FOO=BAR
FOO=BAR
EXEC
Error: Process completed with exit code 1.
</code></pre></div>



<a name="487676799"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/487676799" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#487676799">(Dec 11 2024 at 00:24)</a>:</h4>
<p>Ok, we're down to the very last step, and we're failing specifically with x86_64-unknown-linux-musl and not getting any args... this is a known issue <a href="https://github.com/roc-lang/basic-cli/issues/82">https://github.com/roc-lang/basic-cli/issues/82</a> or at least feels very familiar</p>



<a name="487677016"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/487677016" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#487677016">(Dec 11 2024 at 00:27)</a>:</h4>
<p>Would we be happy if only the legacy linker was passing?</p>



<a name="487678998"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/487678998" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#487678998">(Dec 11 2024 at 00:48)</a>:</h4>
<p>Yes</p>



<a name="487679029"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/487679029" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#487679029">(Dec 11 2024 at 00:48)</a>:</h4>
<p>Things also make more sense now</p>



<a name="487679038"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/487679038" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#487679038">(Dec 11 2024 at 00:48)</a>:</h4>
<p>Yep</p>



<a name="487679204"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/487679204" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#487679204">(Dec 11 2024 at 00:50)</a>:</h4>
<p>There has been an uber long standing bug related to this. Sometimes it seemed to be surgical linker only. Other times it was clearly with the legacy linker. I thought we finally fixed it with the exit code fixed. I think it was actually two separate bugs. The exit code bug that affected both linkers and this bug which is surgical linker specific. Really intriguing it only affects the arg example. I wonder what makes that special. I guess arg is also the only example to break on musl so maybe how loading args happens is just brittle/more complex.</p>



<a name="487681248"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/487681248" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#487681248">(Dec 11 2024 at 01:11)</a>:</h4>
<p>Arg is just the first example</p>



<a name="487681305"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/487681305" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#487681305">(Dec 11 2024 at 01:11)</a>:</h4>
<p>I've been trying to get musl thing locally on my linux machine, and I can't even get rust to compile. I'm really confused</p>



<a name="487681386"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/487681386" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#487681386">(Dec 11 2024 at 01:12)</a>:</h4>
<p>Is there something in particular I can help with?</p>



<a name="487995229"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/487995229" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#487995229">(Dec 11 2024 at 01:18)</a>:</h4>
<p>I'm trying to get CI green, trying to figure out if we can keep the whole musl build and test thing</p>



<a name="487995246"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/487995246" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#487995246">(Dec 11 2024 at 01:18)</a>:</h4>
<p>If you have a linux machine, you could try running that step manually (build and run the tests using musl)</p>



<a name="487995324"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/487995324" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#487995324">(Dec 11 2024 at 01:19)</a>:</h4>
<p>For some reason that last CI run got stuck at an earlier point, just building the host using musl. The previous run got further and was stuck at running the examples. So not sure why that happened, seems odd -- because the things I changed between runs were only in the running part and shouldn't have affected the building.</p>



<a name="488000773"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/488000773" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#488000773">(Dec 11 2024 at 02:17)</a>:</h4>
<p>Trying this now</p>



<a name="488001261"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/488001261" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#488001261">(Dec 11 2024 at 02:23)</a>:</h4>
<p>Found something: So in <a href="https://github.com/rust-lang/rust/issues/124126">rust staticlibs and cdylibs using musl do not support init functions</a>. I'm not sure what all we interact with that uses the init array, but one piece that definitely uses the init array is args.</p>
<p>From what I can tell, we need get the args in main and then store them in a global or pass them into rust_main.</p>



<a name="488001350"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/488001350" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#488001350">(Dec 11 2024 at 02:24)</a>:</h4>
<p>Ok, sounds easy enough to change</p>



<a name="488001427"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/488001427" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#488001427">(Dec 11 2024 at 02:25)</a>:</h4>
<p>So I know it's a breaking change, but we're already requiring breaking for converting to <code>main!</code></p>



<a name="488001428"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/488001428" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#488001428">(Dec 11 2024 at 02:25)</a>:</h4>
<p>So the changes would be:</p>
<ol>
<li>take in argc and argv like a normal c main functions here: <a href="https://github.com/roc-lang/basic-cli/blob/de2ac5725018db05413392170b8821e755c334d0/crates/roc_host_lib/src/lib.rs#L2">https://github.com/roc-lang/basic-cli/blob/de2ac5725018db05413392170b8821e755c334d0/crates/roc_host_lib/src/lib.rs#L2</a></li>
<li>pass it into <code>rust_main</code></li>
<li>have <code>rust_main</code> save it to a global</li>
<li>also update <a href="https://github.com/roc-lang/basic-cli/blob/de2ac5725018db05413392170b8821e755c334d0/crates/roc_host_bin/src/main.rs#L2">this main</a> to grab the args (can use std::env::args) and pass them into <code>rust_main</code></li>
</ol>



<a name="488001438"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/488001438" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#488001438">(Dec 11 2024 at 02:25)</a>:</h4>
<p>I'll do that now as a helpful distraction from my musl pain</p>



<a name="488001461"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/488001461" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#488001461">(Dec 11 2024 at 02:26)</a>:</h4>
<p>oh, no change to the roc <code>main!</code> this is only the c program main that has to change</p>



<a name="488001467"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/488001467" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#488001467">(Dec 11 2024 at 02:26)</a>:</h4>
<p>Can we change the signature of <code>main!</code> to <code>List Str =&gt; Result {} _</code>?</p>



<a name="488001507"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/488001507" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#488001507">(Dec 11 2024 at 02:26)</a>:</h4>
<p>I know we don't have to do this</p>



<a name="488001514"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/488001514" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#488001514">(Dec 11 2024 at 02:26)</a>:</h4>
<p>Also, I'm wanting to change <code>PlatformTasks.roc</code> to <code>Host.roc</code> ... unless there's strong objection in the next few minutes <span aria-label="smiley" class="emoji emoji-1f603" role="img" title="smiley">:smiley:</span></p>



<a name="488001526"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/488001526" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#488001526">(Dec 11 2024 at 02:26)</a>:</h4>
<p>But it would be a good change IMO</p>



<a name="488001533"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/488001533" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#488001533">(Dec 11 2024 at 02:26)</a>:</h4>
<p>Do it Luke!</p>



<a name="488001536"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/488001536" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#488001536">(Dec 11 2024 at 02:26)</a>:</h4>
<p>Use the force (of being first)</p>



<a name="488001543"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/488001543" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#488001543">(Dec 11 2024 at 02:26)</a>:</h4>
<p>I prefer <code>Effects.roc</code></p>



<a name="488001550"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/488001550" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#488001550">(Dec 11 2024 at 02:26)</a>:</h4>
<p>but sure <code>Host.roc</code> is fine too</p>



<a name="488001591"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/488001591" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#488001591">(Dec 11 2024 at 02:27)</a>:</h4>
<p>I'm okay with either, but the benefit of <code>Host.roc</code> is that it implies you're calling the host/platform</p>



<a name="488001595"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/488001595" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#488001595">(Dec 11 2024 at 02:27)</a>:</h4>
<p>I was on the fence, I like <code>Effects.roc</code> ... but it's a <code>hosted</code> module type (which I don't think we're removing anytime soon. So..</p>



<a name="488001614"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/488001614" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#488001614">(Dec 11 2024 at 02:27)</a>:</h4>
<p><code>Effects.roc</code> feels like its good because it's plural and sounds like the old name</p>



<a name="488001629"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/488001629" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#488001629">(Dec 11 2024 at 02:27)</a>:</h4>
<p>It's where I like to keep all the functions and types that cross the boundary across to the host</p>



<a name="488001672"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/488001672" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#488001672">(Dec 11 2024 at 02:28)</a>:</h4>
<p>I mean it does hold all the effectful functions. also, why did we pick the name <code>hosted</code>? I never got that</p>



<a name="488001712"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/488001712" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#488001712">(Dec 11 2024 at 02:28)</a>:</h4>
<p>and either is fine luke. Pick what you like best</p>



<a name="488001743"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/488001743" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#488001743">(Dec 11 2024 at 02:28)</a>:</h4>
<p>Also, no idea if fixing this will fix the valgrind bug with args and musl, but it seems likely</p>



<a name="488001746"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/488001746" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#488001746">(Dec 11 2024 at 02:28)</a>:</h4>
<p>My thoughts are that <code>Host</code> is clearer for someone not very familiar with how it all connects together</p>



<a name="488001782"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/488001782" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#488001782">(Dec 11 2024 at 02:29)</a>:</h4>
<p>that is totally fair....<code>HostedEffects.roc</code>.....nah, too long</p>



<a name="488002038"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/488002038" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#488002038">(Dec 11 2024 at 02:32)</a>:</h4>
<p>Actually... I vaguely remember dealing with something about args and rust static libraries. There was a really deep rabbit hole I went down... trying to remember where that was.</p>



<a name="488002069"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/488002069" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#488002069">(Dec 11 2024 at 02:32)</a>:</h4>
<p>Rust doesn't like putting a <code>main</code> symbol in a static library</p>



<a name="488002412"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/488002412" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#488002412">(Dec 11 2024 at 02:37)</a>:</h4>
<p>yep</p>



<a name="488002437"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/488002437" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#488002437">(Dec 11 2024 at 02:37)</a>:</h4>
<p>That is why originally the lib version was wrapped by a c layer that was only a main function</p>



<a name="488002521"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/488002521" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#488002521">(Dec 11 2024 at 02:38)</a>:</h4>
<p>It was something like <a href="https://doc.rust-lang.org/beta/unstable-book/language-features/start.html">https://doc.rust-lang.org/beta/unstable-book/language-features/start.html</a></p>



<a name="488002622"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/488002622" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#488002622">(Dec 11 2024 at 02:39)</a>:</h4>
<p>That requires nightly though</p>



<a name="488002868"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/488002868" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#488002868">(Dec 11 2024 at 02:42)</a>:</h4>
<p>I don't think that matters in this case:<br>
this works just fine:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="cp">#[no_mangle]</span>
<span class="k">pub</span><span class="w"> </span><span class="k">extern</span><span class="w"> </span><span class="s">"C"</span><span class="w"> </span><span class="k">fn</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="n">argc</span><span class="p">:</span><span class="w"> </span><span class="kt">isize</span><span class="p">,</span><span class="w"> </span><span class="n">_argv</span><span class="p">:</span><span class="w"> </span><span class="o">*</span><span class="k">const</span><span class="w"> </span><span class="o">*</span><span class="k">const</span><span class="w"> </span><span class="kt">u8</span><span class="p">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="kt">i32</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="fm">dbg!</span><span class="p">(</span><span class="n">argc</span><span class="p">);</span>
<span class="w">    </span><span class="n">roc_host</span><span class="p">::</span><span class="n">rust_main</span><span class="p">()</span>
<span class="p">}</span>
</code></pre></div>



<a name="488002892"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/488002892" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#488002892">(Dec 11 2024 at 02:42)</a>:</h4>
<p>receives proper args</p>



<a name="488002926"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/488002926" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#488002926">(Dec 11 2024 at 02:42)</a>:</h4>
<p>just wiring that up now</p>



<a name="488002995"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/488002995" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#488002995">(Dec 11 2024 at 02:44)</a>:</h4>
<p>probably should just convert straight to a roc list of roc strings and pass that into <code>roc_host::rust_main()</code>. Then can store that in a global for later retrieval, that or change to passing it into mainforhost</p>



<a name="488003676"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/488003676" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#488003676">(Dec 11 2024 at 02:52)</a>:</h4>
<p>I'll reiterate my vote for the latter (passing args to main_for_host)</p>



<a name="488003717"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/488003717" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#488003717">(Dec 11 2024 at 02:53)</a>:</h4>
<p>Though there is probably value in continuing to make them available by saving them in a <a href="https://doc.rust-lang.org/std/cell/struct.OnceCell.html">https://doc.rust-lang.org/std/cell/struct.OnceCell.html</a></p>



<a name="488003739"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/488003739" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#488003739">(Dec 11 2024 at 02:53)</a>:</h4>
<p>My current thoughts </p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">use</span><span class="w"> </span><span class="n">std</span><span class="p">::</span><span class="n">cell</span><span class="p">::</span><span class="n">RefCell</span><span class="p">;</span>

<span class="fm">thread_local!</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">static</span><span class="w"> </span><span class="n">ARGS</span><span class="p">:</span><span class="w"> </span><span class="nc">RefCell</span><span class="o">&lt;</span><span class="nb">Vec</span><span class="o">&lt;</span><span class="nb">String</span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">RefCell</span><span class="p">::</span><span class="n">new</span><span class="p">(</span><span class="fm">vec!</span><span class="p">[])</span><span class="w"> </span><span class="p">};</span>
<span class="p">}</span>

<span class="k">pub</span><span class="w"> </span><span class="k">fn</span><span class="w"> </span><span class="nf">with</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="p">(</span><span class="n">f</span><span class="p">:</span><span class="w"> </span><span class="nc">impl</span><span class="w"> </span><span class="nb">FnOnce</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="nb">Vec</span><span class="o">&lt;</span><span class="nb">String</span><span class="o">&gt;</span><span class="p">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">T</span><span class="p">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">T</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">ARGS</span><span class="p">.</span><span class="n">with</span><span class="p">(</span><span class="o">|</span><span class="n">args</span><span class="o">|</span><span class="w"> </span><span class="n">f</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="n">args</span><span class="p">.</span><span class="n">borrow_mut</span><span class="p">()))</span>
<span class="p">}</span>
</code></pre></div>



<a name="488003743"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/488003743" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#488003743">(Dec 11 2024 at 02:53)</a>:</h4>




<a name="488003744"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/488003744" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#488003744">(Dec 11 2024 at 02:53)</a>:</h4>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="cp">#[no_mangle]</span>
<span class="k">pub</span><span class="w"> </span><span class="k">extern</span><span class="w"> </span><span class="s">"C"</span><span class="w"> </span><span class="k">fn</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="n">argc</span><span class="p">:</span><span class="w"> </span><span class="kt">isize</span><span class="p">,</span><span class="w"> </span><span class="n">argv</span><span class="p">:</span><span class="w"> </span><span class="o">*</span><span class="k">const</span><span class="w"> </span><span class="o">*</span><span class="k">const</span><span class="w"> </span><span class="kt">u8</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">roc_host</span><span class="p">::</span><span class="n">args</span><span class="p">::</span><span class="n">with</span><span class="p">(</span><span class="o">|</span><span class="n">args</span><span class="o">|</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="mi">0</span><span class="o">..</span><span class="n">argc</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">unsafe</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="kd">let</span><span class="w"> </span><span class="n">arg_ptr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">*</span><span class="n">argv</span><span class="p">.</span><span class="n">offset</span><span class="p">(</span><span class="n">i</span><span class="p">);</span>
<span class="w">                </span><span class="kd">let</span><span class="w"> </span><span class="n">arg</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="p">::</span><span class="n">ffi</span><span class="p">::</span><span class="n">CStr</span><span class="p">::</span><span class="n">from_ptr</span><span class="p">(</span><span class="n">arg_ptr</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="o">*</span><span class="k">const</span><span class="w"> </span><span class="kt">i8</span><span class="p">)</span>
<span class="w">                    </span><span class="p">.</span><span class="n">to_string_lossy</span><span class="p">()</span>
<span class="w">                    </span><span class="p">.</span><span class="n">into_owned</span><span class="p">();</span>

<span class="w">                </span><span class="n">args</span><span class="p">.</span><span class="n">push</span><span class="p">(</span><span class="n">arg</span><span class="p">);</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">});</span>

<span class="w">    </span><span class="n">roc_host</span><span class="p">::</span><span class="n">rust_main</span><span class="p">();</span>
<span class="p">}</span>
</code></pre></div>



<a name="488003821"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/488003821" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#488003821">(Dec 11 2024 at 02:54)</a>:</h4>
<p>It shouldn't be <code>thread_local!</code>, right?</p>



<a name="488003832"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/488003832" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#488003832">(Dec 11 2024 at 02:54)</a>:</h4>
<p>It should just be static</p>



<a name="488003839"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/488003839" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#488003839">(Dec 11 2024 at 02:54)</a>:</h4>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="cp">#[no_mangle]</span>
<span class="k">pub</span><span class="w"> </span><span class="k">extern</span><span class="w"> </span><span class="s">"C"</span><span class="w"> </span><span class="k">fn</span><span class="w"> </span><span class="nf">roc_fx_args</span><span class="p">()</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">RocList</span><span class="o">&lt;</span><span class="n">RocStr</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">args</span><span class="p">::</span><span class="n">with</span><span class="p">(</span><span class="o">|</span><span class="n">args</span><span class="o">|</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="n">vec_args</span><span class="p">:</span><span class="w"> </span><span class="nb">Vec</span><span class="o">&lt;</span><span class="n">RocStr</span><span class="o">&gt;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">args</span><span class="p">.</span><span class="n">into_iter</span><span class="p">().</span><span class="n">map</span><span class="p">(</span><span class="o">|</span><span class="n">s</span><span class="o">|</span><span class="w"> </span><span class="n">s</span><span class="p">.</span><span class="n">as_str</span><span class="p">().</span><span class="n">into</span><span class="p">()).</span><span class="n">collect</span><span class="p">();</span>
<span class="w">        </span><span class="n">vec_args</span><span class="p">.</span><span class="n">as_slice</span><span class="p">().</span><span class="n">into</span><span class="p">()</span>
<span class="w">    </span><span class="p">})</span>
<span class="p">}</span>
</code></pre></div>



<a name="488003864"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/488003864" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#488003864">(Dec 11 2024 at 02:54)</a>:</h4>
<div class="codehilite"><pre><span></span><code>rustc: `RefCell&lt;Vec&lt;String&gt;&gt;` cannot be shared between threads safely
the trait `Sync` is not implemented for `RefCell&lt;Vec&lt;String&gt;&gt;`
if you want to do aliasing and mutation between multiple threads, use `std::sync::RwLock` instead
shared static variables must have a type that implements `Sync`
</code></pre></div>



<a name="488003937"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/488003937" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#488003937">(Dec 11 2024 at 02:55)</a>:</h4>
<p>you can store as a constant roc list</p>



<a name="488003987"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/488003987" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#488003987">(Dec 11 2024 at 02:56)</a>:</h4>
<p>will be thread safe</p>



<a name="488004032"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/488004032" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#488004032">(Dec 11 2024 at 02:56)</a>:</h4>
<div class="codehilite"><pre><span></span><code>rustc: cannot call non-const fn `RocList::&lt;RocStr&gt;::empty` in constants
calls in constants are limited to constant functions, tuple structs and tuple variants
</code></pre></div>



<a name="488004035"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/488004035" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#488004035">(Dec 11 2024 at 02:56)</a>:</h4>
<p>How do I do that?</p>



<a name="488004052"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/488004052" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#488004052">(Dec 11 2024 at 02:57)</a>:</h4>
<p>can make it read only and then convert it to a <code>SendSafeRocList</code></p>



<a name="488004070"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/488004070" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#488004070">(Dec 11 2024 at 02:57)</a>:</h4>
<p>change the glue to make the necessary <code>RocList</code> functions constant</p>



<a name="488004090"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/488004090" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#488004090">(Dec 11 2024 at 02:57)</a>:</h4>
<div class="codehilite"><pre><span></span><code>original_list.set_readonly()
SendSafeRocList(original_list)
</code></pre></div>



<a name="488004188"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/488004188" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#488004188">(Dec 11 2024 at 02:58)</a>:</h4>
<p><span class="user-mention" data-user-id="343810">@Brendan Hansknecht</span> it might be easier if you put something together... I'm going in circles a bit here</p>



<a name="488004246"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/488004246" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#488004246">(Dec 11 2024 at 02:59)</a>:</h4>
<p>Also, what are the thoughts on removing args and just passing the args into main? If we do that, we can skip all the globals in general?</p>



<a name="488004327"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/488004327" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#488004327">(Dec 11 2024 at 03:00)</a>:</h4>
<p>I agree with Sam that it sounds pretty reasonable to just do</p>



<a name="488004345"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/488004345" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#488004345">(Dec 11 2024 at 03:00)</a>:</h4>
<p>I suggested that... but I think Richard wanted to keep the API simpler</p>



<a name="488004383"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/488004383" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#488004383">(Dec 11 2024 at 03:00)</a>:</h4>
<p>Thought that was in a Task based world... with PI I think it might be different</p>



<a name="488004464"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/488004464" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#488004464">(Dec 11 2024 at 03:01)</a>:</h4>
<p>eh:</p>
<div class="codehilite"><pre><span></span><code>main! = \{} -&gt;
    Stdout.line! &quot;Hello, World!&quot;
</code></pre></div>
<p>vs</p>
<div class="codehilite"><pre><span></span><code>main! = \_args -&gt;
    Stdout.line! &quot;Hello, World!&quot;
</code></pre></div>



<a name="488004469"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/488004469" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#488004469">(Dec 11 2024 at 03:01)</a>:</h4>
<p>We could have all the "global" environment type information passed in then, like the <code>Env.platform! : {} =&gt; { arch : ARCH, os : OS }</code> instead</p>



<a name="488004499"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/488004499" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#488004499">(Dec 11 2024 at 03:01)</a>:</h4>
<p>I think that is more useful as an effect</p>



<a name="488004501"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/488004501" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#488004501">(Dec 11 2024 at 03:01)</a>:</h4>
<div class="codehilite"><pre><span></span><code>main! = \{args} -&gt;
    Stdout.line! &quot;Got $(Inspect.toStr args)&quot;
</code></pre></div>



<a name="488004531"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/488004531" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#488004531">(Dec 11 2024 at 03:02)</a>:</h4>
<p>You could ignore all the stuff if you want and not destructure it</p>



<a name="488004572"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/488004572" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#488004572">(Dec 11 2024 at 03:02)</a>:</h4>
<p>cause it may be wanted in a deeply nested state where it is convenient to just grab. Vs args are essentially only ever wanted at the top level</p>



<a name="488004621"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/488004621" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#488004621">(Dec 11 2024 at 03:02)</a>:</h4>
<p>anyway, for now, let me try to fix without changing the api at all</p>



<a name="488007710"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/488007710" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#488007710">(Dec 11 2024 at 03:35)</a>:</h4>
<p>So roc_std is missing some functionality that we need: <a href="https://github.com/roc-lang/roc/pull/7330">https://github.com/roc-lang/roc/pull/7330</a></p>



<a name="488007796"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/488007796" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#488007796">(Dec 11 2024 at 03:36)</a>:</h4>
<p>approved</p>



<a name="488008182"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/488008182" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#488008182">(Dec 11 2024 at 03:40)</a>:</h4>
<p>git gud luke</p>



<a name="488008238"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/488008238" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#488008238">(Dec 11 2024 at 03:40)</a>:</h4>
<p>I like to be thorough with my reviews <span aria-label="stuck out tongue" class="emoji emoji-1f61b" role="img" title="stuck out tongue">:stuck_out_tongue:</span></p>



<a name="488008747"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/488008747" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#488008747">(Dec 11 2024 at 03:46)</a>:</h4>
<p>rust traits are a pain even if they are technically safe........</p>



<a name="488008761"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/488008761" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#488008761">(Dec 11 2024 at 03:46)</a>:</h4>
<p>just realized that <code>Send</code> isn't enough, I need <code>Sync</code></p>



<a name="488008771"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/488008771" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#488008771">(Dec 11 2024 at 03:46)</a>:</h4>
<p>Technically a read only roc list is sync</p>



<a name="488008815"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/488008815" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#488008815">(Dec 11 2024 at 03:47)</a>:</h4>
<p>but <code>SendSafeRocList</code> is not <code>Sync</code> cause it also includes unique roc lists, which are <code>Send</code> but not <code>Sync</code></p>



<a name="488008845"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/488008845" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#488008845">(Dec 11 2024 at 03:47)</a>:</h4>
<p>So I also need <code>ReadOnlyRocList/SyncSafeRocList</code></p>



<a name="488008850"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/488008850" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#488008850">(Dec 11 2024 at 03:47)</a>:</h4>
<p>Can you rename it to <code>SendAndSyncSafeRocList</code> ? or <code>DefinitelySendAndSyncSafeRocListBecauseItsReadOnly</code></p>



<a name="488008879"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/488008879" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#488008879">(Dec 11 2024 at 03:47)</a>:</h4>
<p>It isn't <code>SendAndSyncSafeRocList</code> cause a unique list is send but not sync. Only a readonly list is send and sync.</p>



<a name="488008897"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/488008897" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#488008897">(Dec 11 2024 at 03:48)</a>:</h4>
<p>So they are two different wrapper types.</p>



<a name="488009069"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/488009069" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#488009069">(Dec 11 2024 at 03:48)</a>:</h4>
<p>You could just store the args as <code>Vec&lt;String&gt;</code> and convert every time, not as performant but it won't matter because it's just CLI args</p>



<a name="488009110"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/488009110" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#488009110">(Dec 11 2024 at 03:48)</a>:</h4>
<p>I could also just wrap in a mutex</p>



<a name="488009119"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/488009119" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#488009119">(Dec 11 2024 at 03:48)</a>:</h4>
<p>That'd be fine</p>



<a name="488009136"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/488009136" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#488009136">(Dec 11 2024 at 03:48)</a>:</h4>
<p>RwLock is probably better here</p>



<a name="488009139"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/488009139" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#488009139">(Dec 11 2024 at 03:48)</a>:</h4>
<p>Would allow for concurrent reads</p>



<a name="488009151"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/488009151" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#488009151">(Dec 11 2024 at 03:49)</a>:</h4>
<p>That still needs <code>Send</code>/<code>Sync</code></p>



<a name="488009304"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/488009304" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#488009304">(Dec 11 2024 at 03:50)</a>:</h4>
<p>let me make the proper fix, won't take long and is still wanted for other future usages.</p>



<a name="488010579"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/488010579" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#488010579">(Dec 11 2024 at 04:04)</a>:</h4>
<p>ReadOnly types added to the PR: <a href="https://github.com/roc-lang/roc/pull/7330">https://github.com/roc-lang/roc/pull/7330</a></p>



<a name="488013149"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/488013149" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#488013149">(Dec 11 2024 at 04:30)</a>:</h4>
<p>Just got everything working locally with musl!!!</p>



<a name="488013209"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/488013209" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#488013209">(Dec 11 2024 at 04:30)</a>:</h4>
<p>Will push to purity inference soon, though I guess <a href="https://github.com/roc-lang/roc/pull/7330">https://github.com/roc-lang/roc/pull/7330</a> has to land first</p>



<a name="488013225"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/488013225" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#488013225">(Dec 11 2024 at 04:30)</a>:</h4>
<p>Also, had to push one more fix around small strings to <a href="https://github.com/roc-lang/roc/pull/7330">https://github.com/roc-lang/roc/pull/7330</a></p>



<a name="488013270"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/488013270" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#488013270">(Dec 11 2024 at 04:31)</a>:</h4>
<p><span class="user-mention silent" data-user-id="343810">Brendan Hansknecht</span> <a href="#narrow/channel/316715-contributing/topic/basic-cli.20purity.20inference/near/488013209">said</a>:</p>
<blockquote>
<p>Will push to purity inference soon, though I guess <a href="https://github.com/roc-lang/roc/pull/7330">https://github.com/roc-lang/roc/pull/7330</a> has to land first</p>
</blockquote>
<p>Yeah, and then we need to add another commit with <code>nix flake update</code> in it</p>



<a name="488013409"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/488013409" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#488013409">(Dec 11 2024 at 04:32)</a>:</h4>
<p>Also, I'll be curious if everything works with both surgical and legacy linkers</p>



<a name="488013511"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/488013511" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#488013511">(Dec 11 2024 at 04:33)</a>:</h4>
<p>Feel free to revert or remove all the hacks in <code>ci/all_tests.sh</code>; we've left comments so it's easy to delete the relevant parts</p>



<a name="488013534"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/488013534" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#488013534">(Dec 11 2024 at 04:33)</a>:</h4>
<p>It'd be really nice if this was the issue</p>



<a name="488013747"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/488013747" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#488013747">(Dec 11 2024 at 04:35)</a>:</h4>
<p>from local testing, everything looks to be passing with both linkers for both musl and glibc</p>



<a name="488013921"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/488013921" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#488013921">(Dec 11 2024 at 04:38)</a>:</h4>
<p>Wow, this is awesome.</p>



<a name="488014008"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/488014008" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#488014008">(Dec 11 2024 at 04:38)</a>:</h4>
<p>I pushed my work, once <a href="https://github.com/roc-lang/roc/pull/7330">https://github.com/roc-lang/roc/pull/7330</a> is landed, we can pull that in and cleanup any workarounds.</p>



<a name="488014030"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/488014030" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#488014030">(Dec 11 2024 at 04:38)</a>:</h4>
<p>Thought it would be best to push now so either of you can take over later if I am not around</p>



<a name="488014695"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/488014695" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#488014695">(Dec 11 2024 at 04:47)</a>:</h4>
<p>Thank you, Brendan!</p>



<a name="488014740"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/488014740" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#488014740">(Dec 11 2024 at 04:47)</a>:</h4>
<p>I will be around</p>



<a name="488014749"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/488014749" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#488014749">(Dec 11 2024 at 04:47)</a>:</h4>
<p>After Advent of Code ofc... <span aria-label="smiley" class="emoji emoji-1f603" role="img" title="smiley">:smiley:</span></p>



<a name="488017337"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/488017337" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#488017337">(Dec 11 2024 at 05:14)</a>:</h4>
<p><span class="user-mention silent" data-user-id="343810">Brendan Hansknecht</span> <a href="#narrow/channel/316715-contributing/topic/basic-cli.20purity.20inference/near/488004246">said</a>:</p>
<blockquote>
<p>Also, what are the thoughts on removing args and just passing the args into main? If we do that, we can skip all the globals in general?</p>
</blockquote>
<p>my original reasoning (although we never actually did this) is that the OS doesn't require that the args be valid UTF-8, and if you silently replace invalid UTF-8 sequences with the Unicode Replacement Character, then you've lost information and there becomes no way to access the actual original args that were passed into the process</p>



<a name="488017367"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/488017367" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#488017367">(Dec 11 2024 at 05:15)</a>:</h4>
<p>but maybe for <code>basic-cli</code> it's fine haha</p>



<a name="488017371"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/488017371" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#488017371">(Dec 11 2024 at 05:15)</a>:</h4>
<p>perhaps a more advanced cli platform can offer that functionality</p>



<a name="488017386"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/488017386" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#488017386">(Dec 11 2024 at 05:15)</a>:</h4>
<p>anyway, the main point is that THIS IS AWESOME!!!! <span aria-label="heart eyes" class="emoji emoji-1f60d" role="img" title="heart eyes">:heart_eyes:</span> <span aria-label="heart eyes" class="emoji emoji-1f60d" role="img" title="heart eyes">:heart_eyes:</span> <span aria-label="heart eyes" class="emoji emoji-1f60d" role="img" title="heart eyes">:heart_eyes:</span></p>



<a name="488017707"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/488017707" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#488017707">(Dec 11 2024 at 05:19)</a>:</h4>
<blockquote>
<p>if you silently replace invalid UTF-8 sequences with the Unicode Replacement Character, then you've lost information</p>
</blockquote>
<p>We were already doing this. Given we have <code>?</code> and <code>try</code> now, maybe it would be best to change to returning a result.</p>



<a name="488017734"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/488017734" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#488017734">(Dec 11 2024 at 05:20)</a>:</h4>
<p>but yeah, in practice, I would guess replacement is just fine for basic cli</p>



<a name="488018239"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/488018239" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#488018239">(Dec 11 2024 at 05:26)</a>:</h4>
<p>yeah I assume that's what Java does</p>



<a name="488018257"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/488018257" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#488018257">(Dec 11 2024 at 05:26)</a>:</h4>
<p>another thing we could do is to do that for you automatically, and then have a separate way to opt into going and getting the originals if you really want to</p>



<a name="488018270"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/488018270" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#488018270">(Dec 11 2024 at 05:26)</a>:</h4>
<p>if there's demand in practice, we could introduce that as a nonbreaking change later</p>



<a name="488022928"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/488022928" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#488022928">(Dec 11 2024 at 06:13)</a>:</h4>
<p>kk, I've kicked off CI now with the changes... and then I remember that we need to wait for the new nightly to land <span aria-label="tear" class="emoji emoji-1f972" role="img" title="tear">:tear:</span> </p>
<p><span class="user-mention" data-user-id="361169">@Anton</span> we think this should be good to go. I've reverted the legacy linker and other debugging stuff we had in <code>all_tests.sh</code> so should be just the nightly I think <span aria-label="fingers crossed" class="emoji emoji-1f91e" role="img" title="fingers crossed">:fingers_crossed:</span></p>



<a name="488022993"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/488022993" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#488022993">(Dec 11 2024 at 06:14)</a>:</h4>
<p>We don't need the new nightly</p>



<a name="488023000"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/488023000" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#488023000">(Dec 11 2024 at 06:14)</a>:</h4>
<p>Just update the flake and the cargo lockfile</p>



<a name="488023092"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/488023092" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#488023092">(Dec 11 2024 at 06:15)</a>:</h4>
<p>I can push the lockfile update if you want</p>



<a name="488023170"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/488023170" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#488023170">(Dec 11 2024 at 06:16)</a>:</h4>
<p>I just pushed it I think</p>



<a name="488023272"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/488023272" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#488023272">(Dec 11 2024 at 06:17)</a>:</h4>
<p>How many engineers to land a PR? <span aria-label="smiley" class="emoji emoji-1f603" role="img" title="smiley">:smiley:</span> </p>
<p><a href="/user_uploads/22008/R_9W_c9c4ELfYxrCzJx3uWuJ/Screenshot-2024-12-11-at-17.17.38.png">Screenshot 2024-12-11 at 17.17.38.png</a></p>
<div class="message_inline_image"><a href="/user_uploads/22008/R_9W_c9c4ELfYxrCzJx3uWuJ/Screenshot-2024-12-11-at-17.17.38.png" title="Screenshot 2024-12-11 at 17.17.38.png"><img data-original-dimensions="352x152" src="/user_uploads/thumbnail/22008/R_9W_c9c4ELfYxrCzJx3uWuJ/Screenshot-2024-12-11-at-17.17.38.png/840x560.webp"></a></div>



<a name="488023376"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/488023376" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#488023376">(Dec 11 2024 at 06:18)</a>:</h4>
<p>Been a massive effort, but feels like we're on the home stretch now.</p>



<a name="488023576"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/488023576" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#488023576">(Dec 11 2024 at 06:21)</a>:</h4>
<p>Yeah, and if this passes ci with both the legacy and surgical linker, it will mean that we fixed some major platform bugs and don't have a hard to debug/fix surgical linker bug.</p>



<a name="488023586"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/488023586" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#488023586">(Dec 11 2024 at 06:21)</a>:</h4>
<p>And we have <span aria-label="check" class="emoji emoji-2705" role="img" title="check">:check:</span> on native <span aria-label="tada" class="emoji emoji-1f389" role="img" title="tada">:tada:</span></p>



<a name="488023603"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/488023603" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#488023603">(Dec 11 2024 at 06:21)</a>:</h4>
<p>Yay!</p>



<a name="488023714"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/488023714" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#488023714">(Dec 11 2024 at 06:22)</a>:</h4>
<p>Can we pull legacy linker changes to the test script and run it with surgical then?</p>



<a name="488023773"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/488023773" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#488023773">(Dec 11 2024 at 06:23)</a>:</h4>
<p>It's running with surgical now</p>



<a name="488023780"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/488023780" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#488023780">(Dec 11 2024 at 06:23)</a>:</h4>
<p>Oh, epic!</p>



<a name="488023805"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/488023805" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#488023805">(Dec 11 2024 at 06:23)</a>:</h4>
<p>Nix macos failed though... seems odd it passed for me locally, probably a CI thing</p>



<a name="488023807"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/488023807" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#488023807">(Dec 11 2024 at 06:24)</a>:</h4>
<p>So that means it should be ready to land?</p>



<a name="488024105"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/488024105" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#488024105">(Dec 11 2024 at 06:26)</a>:</h4>
<p>If the other nix machines pass, I'll restart it. I suspect it's a cache thing</p>



<a name="488024157"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/488024157" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#488024157">(Dec 11 2024 at 06:27)</a>:</h4>
<p>I'll run locally in <code>nix develop</code> to double check</p>



<a name="488025901"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/488025901" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#488025901">(Dec 11 2024 at 06:41)</a>:</h4>
<p><a href="/user_uploads/22008/T13FT7ETijFaWOKE2d90pVq-/Screenshot-2024-12-11-at-17.41.17.png">Screenshot 2024-12-11 at 17.41.17.png</a></p>
<div class="message_inline_image"><a href="/user_uploads/22008/T13FT7ETijFaWOKE2d90pVq-/Screenshot-2024-12-11-at-17.41.17.png" title="Screenshot 2024-12-11 at 17.41.17.png"><img data-original-dimensions="1728x544" src="/user_uploads/thumbnail/22008/T13FT7ETijFaWOKE2d90pVq-/Screenshot-2024-12-11-at-17.41.17.png/840x560.webp"></a></div><p>Getting close</p>



<a name="488026797"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/488026797" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#488026797">(Dec 11 2024 at 06:48)</a>:</h4>
<p>Think it will pass on rerun?</p>



<a name="488026843"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/488026843" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#488026843">(Dec 11 2024 at 06:48)</a>:</h4>
<p>Yeah, it's looking good</p>



<a name="488027444"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/488027444" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#488027444">(Dec 11 2024 at 06:53)</a>:</h4>
<p><a href="/user_uploads/22008/SOhQVW-HKJIQfGP9dOIAGJnQ/Screenshot-2024-12-11-at-17.53.24.png">Screenshot 2024-12-11 at 17.53.24.png</a></p>
<div class="message_inline_image"><a href="/user_uploads/22008/SOhQVW-HKJIQfGP9dOIAGJnQ/Screenshot-2024-12-11-at-17.53.24.png" title="Screenshot 2024-12-11 at 17.53.24.png"><img data-original-dimensions="1854x684" src="/user_uploads/thumbnail/22008/SOhQVW-HKJIQfGP9dOIAGJnQ/Screenshot-2024-12-11-at-17.53.24.png/840x560.webp"></a></div>



<a name="488027457"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/488027457" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#488027457">(Dec 11 2024 at 06:53)</a>:</h4>
<p>Can anyone help a brother out?</p>



<a name="488027485"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/488027485" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#488027485">(Dec 11 2024 at 06:53)</a>:</h4>
<p><span class="user-mention" data-user-id="461444">@Sam Mohr</span> how about one of those speedy reviews</p>



<a name="488028228"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/488028228" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#488028228">(Dec 11 2024 at 07:00)</a>:</h4>
<p>Ok, I've left a few comments, nothing blocking in my opinion so I'm going to merge this. Thank you <span aria-label="smiley" class="emoji emoji-1f603" role="img" title="smiley">:smiley:</span></p>



<a name="488028473"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/488028473" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#488028473">(Dec 11 2024 at 07:02)</a>:</h4>
<p>On it!</p>



<a name="488028501"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/488028501" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#488028501">(Dec 11 2024 at 07:02)</a>:</h4>
<p>Not fast enough haha</p>



<a name="488028508"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/488028508" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#488028508">(Dec 11 2024 at 07:02)</a>:</h4>
<p>Haha, too slow</p>



<a name="488060653"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/488060653" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Kilian Vounckx <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#488060653">(Dec 11 2024 at 10:12)</a>:</h4>
<p>This is awesome!! Good work to everyone who worked on this!<br>
When will there be a release so it can be used without cloning the repo?</p>



<a name="488065178"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/488065178" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anton <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#488065178">(Dec 11 2024 at 10:36)</a>:</h4>
<p>I'm going to bundle in the required changes for <a href="https://github.com/roc-lang/roc/pull/7321">https://github.com/roc-lang/roc/pull/7321</a> in the next basic-cli release, that is a widely used function but probably few things will actually break because of that change. The new release will probably be available next week.</p>



<a name="488065503"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/488065503" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Kilian Vounckx <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#488065503">(Dec 11 2024 at 10:37)</a>:</h4>
<p>Cool, can't wait. For now I'll just clone then</p>



<a name="489552963"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/489552963" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#489552963">(Dec 17 2024 at 19:00)</a>:</h4>
<p>Before the PI release, can we change <code>main! : {} =&gt; Result {} _</code> to <code>main! : List Str =&gt; Result {} _</code> to put all of the breaking changes together</p>



<a name="489552994"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/489552994" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#489552994">(Dec 17 2024 at 19:01)</a>:</h4>
<p>Or did we not like the idea of that</p>



<a name="489553270"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/489553270" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#489553270">(Dec 17 2024 at 19:02)</a>:</h4>
<p>From memory <span class="user-mention" data-user-id="281383">@Richard Feldman</span> didn't like it</p>



<a name="489553288"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/489553288" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#489553288">(Dec 17 2024 at 19:02)</a>:</h4>
<p>Sounds fine. Args seem fine to be main down</p>



<a name="489553423"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/489553423" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#489553423">(Dec 17 2024 at 19:03)</a>:</h4>
<p>I personally don't want it any more complex than a list of strings.</p>



<a name="489553450"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/489553450" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#489553450">(Dec 17 2024 at 19:03)</a>:</h4>
<p>Or maybe it was my larger suggestion of providing all the envrionment stuff in an record that could be destructured.</p>



<a name="489553603"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/489553603" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#489553603">(Dec 17 2024 at 19:04)</a>:</h4>
<p>I think Richard commented about wanting it to be a zero arg function for max simplicity when teaching a new user. Though ignoring one arg sounds fine to teach a new user as well.</p>



<a name="489553933"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/489553933" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#489553933">(Dec 17 2024 at 19:06)</a>:</h4>
<p>I can certainly make the change today. I would like to merge that refactor PR, and can add this in. I think were really close to getting cli/server/ssg all passong CI. </p>
<p>I might be getting ahead of myself, but I'm even thinking of bringing most of the basic-cli API across to ssg too.</p>



<a name="489554055"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/489554055" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#489554055">(Dec 17 2024 at 19:07)</a>:</h4>
<p>*passing CI -- i mean ready for consumption</p>



<a name="489554749"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/489554749" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#489554749">(Dec 17 2024 at 19:11)</a>:</h4>
<p>That's my thought. And I think every beginner will know what args are (they're what you pass to roc to use it!)</p>



<a name="489555055"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/489555055" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#489555055">(Dec 17 2024 at 19:13)</a>:</h4>
<p>Args are always valid utf8? there's not strange OS things lurking there?</p>



<a name="489555401"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/489555401" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ayaz Hafiz <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#489555401">(Dec 17 2024 at 19:16)</a>:</h4>
<p>they don’t have to be utf8. they get be whatever at least on unix</p>



<a name="489555466"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/489555466" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#489555466">(Dec 17 2024 at 19:16)</a>:</h4>
<p><a href="https://stackoverflow.com/questions/5408730/what-is-the-encoding-of-argv">They aren't</a>, but we currently coerce them to UTF-8 anyway: <a href="https://github.com/roc-lang/basic-cli/blob/fbdd5e68fe286ae7f999d549d0e761df0b3773cf/crates/roc_host_bin/src/main.rs#L7">https://github.com/roc-lang/basic-cli/blob/fbdd5e68fe286ae7f999d549d0e761df0b3773cf/crates/roc_host_bin/src/main.rs#L7</a></p>



<a name="489555493"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/489555493" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#489555493">(Dec 17 2024 at 19:16)</a>:</h4>
<p>So we're already committed to adding just a bit of sanity</p>



<a name="489555888"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/489555888" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#489555888">(Dec 17 2024 at 19:19)</a>:</h4>
<p>I think it is fine to default to utf-8 and if we really want, we can add a fallback when a user requests/needs it.</p>



<a name="489555958"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/489555958" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#489555958">(Dec 17 2024 at 19:19)</a>:</h4>
<p>Basic CLI may turn out to be ok with coercion always</p>



<a name="489557854"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/489557854" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#489557854">(Dec 17 2024 at 19:30)</a>:</h4>
<p>My concern is the silent nature of that, would people assume something and then it causes a bug. Maybe we detect non-utf8 args and crash, or instead provide zero args so it's easy to ignfore and then read args using an effect that gives <code>List U8</code>.</p>



<a name="489558000"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/489558000" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#489558000">(Dec 17 2024 at 19:31)</a>:</h4>
<p>Even Rust panics on non-UTF8 args: <a href="https://doc.rust-lang.org/beta/std/env/fn.args.html#panics">https://doc.rust-lang.org/beta/std/env/fn.args.html#panics</a></p>



<a name="489558062"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/489558062" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#489558062">(Dec 17 2024 at 19:31)</a>:</h4>
<p>I'm down for the crash, but <em>no one</em> wants to handle non-UTF-8 except for a very small contingent</p>



<a name="489558282"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/489558282" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#489558282">(Dec 17 2024 at 19:33)</a>:</h4>
<p>Yeah, I agree. I think crashing is the way to go.</p>



<a name="489558295"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/489558295" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#489558295">(Dec 17 2024 at 19:33)</a>:</h4>
<p>Rust has <code>args_os</code> as the fallback</p>



<a name="489558953"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/489558953" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#489558953">(Dec 17 2024 at 19:37)</a>:</h4>
<p>We're aiming for higher level use cases. If someone needs non-utf8 args they're probably in the write or customise a platform space.</p>



<a name="489559213"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/489559213" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#489559213">(Dec 17 2024 at 19:39)</a>:</h4>
<p>We still want to keep the effect for reading Args, so it's easier to get from within the app without having to thread apl the way through? Just checking.</p>



<a name="489559465"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/489559465" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#489559465">(Dec 17 2024 at 19:40)</a>:</h4>
<p>I'd say yes</p>



<a name="489559583"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/489559583" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#489559583">(Dec 17 2024 at 19:41)</a>:</h4>
<p>Eh</p>



<a name="489559588"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/489559588" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#489559588">(Dec 17 2024 at 19:41)</a>:</h4>
<p>I would say pick just one way</p>



<a name="489559589"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/489559589" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#489559589">(Dec 17 2024 at 19:41)</a>:</h4>
<p>Eh</p>



<a name="489559590"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/489559590" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#489559590">(Dec 17 2024 at 19:41)</a>:</h4>
<p>I would say pick just one way</p>



<a name="489559591"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/489559591" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#489559591">(Dec 17 2024 at 19:41)</a>:</h4>
<p>Eh</p>



<a name="489559593"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/489559593" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#489559593">(Dec 17 2024 at 19:41)</a>:</h4>
<p>Both feels silly to me</p>



<a name="489559687"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/489559687" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#489559687">(Dec 17 2024 at 19:42)</a>:</h4>
<p>I have bad Internet rn and I think Zulip does not like that</p>



<a name="489560834"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/489560834" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#489560834">(Dec 17 2024 at 19:49)</a>:</h4>
<p>May as well try just passing it in, and see how that goes. It's easy enough to add back if people have issues.</p>



<a name="489560929"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/489560929" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#489560929">(Dec 17 2024 at 19:49)</a>:</h4>
<p>Most cli apps are probably feeding it straight into weaver and parsing anyways</p>



<a name="489561412"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/489561412" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#489561412">(Dec 17 2024 at 19:52)</a>:</h4>
<p>I'm working on this now</p>



<a name="489568640"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/489568640" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#489568640">(Dec 17 2024 at 20:42)</a>:</h4>
<p>the only thing I strongly think we shouldn't do for sure is have the platform <code>crash</code> based on what args are provided <span aria-label="laughing" class="emoji emoji-1f606" role="img" title="laughing">:laughing:</span></p>



<a name="489568689"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/489568689" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#489568689">(Dec 17 2024 at 20:43)</a>:</h4>
<p>So we should continue to lossily convert them to UTF-8?</p>



<a name="489568770"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/489568770" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#489568770">(Dec 17 2024 at 20:43)</a>:</h4>
<p>we could do that, or if we wanted to be fancy we could do like <code>main : Result (List Str) [NonUnicodeArgs] -&gt; ...</code></p>



<a name="489568816"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/489568816" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#489568816">(Dec 17 2024 at 20:44)</a>:</h4>
<p>but <code>basic-cli</code> probably shouldn't be fancy</p>



<a name="489568837"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/489568837" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#489568837">(Dec 17 2024 at 20:44)</a>:</h4>
<p>I vote stupid</p>



<a name="489568855"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/489568855" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#489568855">(Dec 17 2024 at 20:44)</a>:</h4>
<p>I'll change it back to lossy conversion</p>



<a name="489569183"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/489569183" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#489569183">(Dec 17 2024 at 20:47)</a>:</h4>
<p><a href="https://github.com/roc-lang/basic-cli/pull/289">https://github.com/roc-lang/basic-cli/pull/289</a></p>



<a name="489569457"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/489569457" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#489569457">(Dec 17 2024 at 20:48)</a>:</h4>
<p>the scenario I can think of where it could matter is that you have some non-utf8 filenames, and you want to pass those in as arguments</p>



<a name="489569518"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/489569518" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#489569518">(Dec 17 2024 at 20:49)</a>:</h4>
<p>I'd say "don't do that" haha</p>



<a name="489569613"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/489569613" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#489569613">(Dec 17 2024 at 20:49)</a>:</h4>
<p>the thing that bothers me about that is that we're now creating a situation where application authors are by default telling their users "don't have this use case"</p>



<a name="489569626"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/489569626" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#489569626">(Dec 17 2024 at 20:49)</a>:</h4>
<p>This doesn't make <code>basic-cli</code> unusable, it just means you need to pass the file via env var or something</p>



<a name="489569725"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/489569725" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#489569725">(Dec 17 2024 at 20:50)</a>:</h4>
<p>That's fair</p>



<a name="489569785"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/489569785" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#489569785">(Dec 17 2024 at 20:50)</a>:</h4>
<p>what will happen in practice is that people will use the most convenient API, namely the <code>List Str</code> you get for free, and which doesn't handle this edge case, and then if end users have files they need to pass in that way, they just won't be able to do that</p>



<a name="489569855"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/489569855" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#489569855">(Dec 17 2024 at 20:51)</a>:</h4>
<p>my hope with things like this is that if you're using a CLI arg parser like weaver anyway, then it can be actually very easy to handle that scenario</p>



<a name="489569887"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/489569887" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#489569887">(Dec 17 2024 at 20:51)</a>:</h4>
<p>because weaver works on <code>List U8</code> and provides a convenient interface to the app author anyway</p>



<a name="489569913"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/489569913" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#489569913">(Dec 17 2024 at 20:51)</a>:</h4>
<p>Weaver uses List Str</p>



<a name="489569950"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/489569950" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#489569950">(Dec 17 2024 at 20:52)</a>:</h4>
<p>and then if at some point I want to be like "oh just this one particular thing takes <code>List U8</code> instead of <code>Str</code>" then I only have to change it in one place</p>



<a name="489570034"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/489570034" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#489570034">(Dec 17 2024 at 20:52)</a>:</h4>
<p>But we could change <code>basic-cli</code> to use <code>List (List U8)</code> and Weaver to do the same, and have Weaver handle encoding errors</p>



<a name="489570054"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/489570054" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#489570054">(Dec 17 2024 at 20:52)</a>:</h4>
<p>oh, interesting...I mean, ideally it wouldn't <span aria-label="sweat smile" class="emoji emoji-1f605" role="img" title="sweat smile">:sweat_smile:</span></p>



<a name="489570078"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/489570078" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#489570078">(Dec 17 2024 at 20:52)</a>:</h4>
<p>yeah, that! <span aria-label="point up" class="emoji emoji-1f446" role="img" title="point up">:point_up:</span></p>



<a name="489570167"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/489570167" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#489570167">(Dec 17 2024 at 20:53)</a>:</h4>
<p>Okay, then I'll change this PR to make basic-cli do <code>List (List U8)</code> and update Weaver later</p>



<a name="489570196"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/489570196" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#489570196">(Dec 17 2024 at 20:53)</a>:</h4>
<p>that works for me! <span aria-label="thumbs up" class="emoji emoji-1f44d" role="img" title="thumbs up">:thumbs_up:</span></p>



<a name="489570342"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/489570342" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#489570342">(Dec 17 2024 at 20:54)</a>:</h4>
<p>For now, people can do <code>validArgs = List.map args \arg -&gt; Str.fromUtf8 arg |&gt; Result.withDefault ""</code></p>



<a name="489570374"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/489570374" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#489570374">(Dec 17 2024 at 20:54)</a>:</h4>
<p>And pass <code>validArgs</code> to Weaver</p>



<a name="489570696"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/489570696" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#489570696">(Dec 17 2024 at 20:56)</a>:</h4>
<p><span class="user-mention" data-user-id="281383">@Richard Feldman</span> currently, Arg.list! returns <code>List Str</code>. Would you vote for:</p>
<ul>
<li>Keeping it as <code>Arg.list! : {} =&gt; List Str</code> and making it lossy</li>
<li>Keeping it and also adding <code>Arg.listBytes : {} =&gt; List (List U8)</code></li>
<li>Changing it to just <code>Arg.list! : {} =&gt; List (List U8)</code> for Weaver compat</li>
<li>Something else</li>
</ul>



<a name="489571159"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/489571159" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#489571159">(Dec 17 2024 at 20:59)</a>:</h4>
<p>Since apps will be handling stuff with Weaver primarily, I vote just changing <code>Arg.list!</code> to <code>{} =&gt; List (List U8)</code></p>



<a name="489571942"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/489571942" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#489571942">(Dec 17 2024 at 21:04)</a>:</h4>
<p>Would it still be passed into main?</p>



<a name="489571968"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/489571968" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#489571968">(Dec 17 2024 at 21:04)</a>:</h4>
<p>Or just the arg list effect?</p>



<a name="489572044"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/489572044" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#489572044">(Dec 17 2024 at 21:05)</a>:</h4>
<p>It seems like Richard's main want is <code>main! : List (List U8) =&gt; Result {} _</code></p>



<a name="489572099"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/489572099" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#489572099">(Dec 17 2024 at 21:05)</a>:</h4>
<p>And to match with that, we should just convert <code>Arg.list!</code> to <code>{} =&gt; List (List U8)</code></p>



<a name="489572223"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/489572223" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#489572223">(Dec 17 2024 at 21:06)</a>:</h4>
<p>Can we please remove arg list if we change main?</p>



<a name="489572817"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/489572817" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#489572817">(Dec 17 2024 at 21:10)</a>:</h4>
<p><span class="user-mention silent" data-user-id="343810">Brendan Hansknecht</span> <a href="#narrow/channel/316715-contributing/topic/basic-cli.20purity.20inference/near/489572223">said</a>:</p>
<blockquote>
<p>Can we please remove arg list if we change main?</p>
</blockquote>
<p>What if you want the arg list halfway through the program? Should you have to thread the args through the program?</p>



<a name="489573171"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/489573171" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#489573171">(Dec 17 2024 at 21:13)</a>:</h4>
<p>I'm okay with that, just asking</p>



<a name="489573368"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/489573368" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#489573368">(Dec 17 2024 at 21:15)</a>:</h4>
<p>I think it's fine. I personally just want one way. I think it is most common to use at the top, so forcing threading down sounds fine.</p>



<a name="489573396"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/489573396" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#489573396">(Dec 17 2024 at 21:15)</a>:</h4>
<p>Okay, removing <code>Arg.list!</code></p>



<a name="489574278"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/489574278" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#489574278">(Dec 17 2024 at 21:22)</a>:</h4>
<p>yeah <code>main! : List (List U8) =&gt; ...</code> sounds fine to me!</p>



<a name="489574300"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/489574300" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#489574300">(Dec 17 2024 at 21:22)</a>:</h4>
<p>wait, crap</p>



<a name="489574317"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/489574317" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#489574317">(Dec 17 2024 at 21:23)</a>:</h4>
<p>Windows <span aria-label="confounded" class="emoji emoji-1f616" role="img" title="confounded">:confounded:</span></p>



<a name="489574338"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/489574338" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#489574338">(Dec 17 2024 at 21:23)</a>:</h4>
<p>on Windows they're <code>U16</code>s</p>



<a name="489574356"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/489574356" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#489574356">(Dec 17 2024 at 21:23)</a>:</h4>
<p>I'm gonna cry</p>



<a name="489574412"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/489574412" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#489574412">(Dec 17 2024 at 21:23)</a>:</h4>
<p>There has to be a line somewhere</p>



<a name="489574490"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/489574490" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#489574490">(Dec 17 2024 at 21:24)</a>:</h4>
<p>Do any other languages make users handle UTF-16?</p>



<a name="489574666"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/489574666" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#489574666">(Dec 17 2024 at 21:25)</a>:</h4>
<p>C and C++ are <code>main (int argc, char **argv)</code></p>



<a name="489574676"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/489574676" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#489574676">(Dec 17 2024 at 21:25)</a>:</h4>
<p>I wonder if this use case was what caused Rust to introduce OsStr</p>



<a name="489574736"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/489574736" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#489574736">(Dec 17 2024 at 21:26)</a>:</h4>
<p>That sounds exactly correct</p>



<a name="489574742"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/489574742" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#489574742">(Dec 17 2024 at 21:26)</a>:</h4>
<p>yeah but they let you cast those pointers to u16 on Windows</p>



<a name="489574752"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/489574752" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#489574752">(Dec 17 2024 at 21:26)</a>:</h4>
<p>Oh, I see</p>



<a name="489574775"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/489574775" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#489574775">(Dec 17 2024 at 21:26)</a>:</h4>
<p>Why did Roc get rid of Nat?</p>



<a name="489574789"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/489574789" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#489574789">(Dec 17 2024 at 21:26)</a>:</h4>
<p>that wouldn't help here</p>



<a name="489574831"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/489574831" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#489574831">(Dec 17 2024 at 21:26)</a>:</h4>
<p>Presumably because the core language doesn't want to be OS-specific?</p>



<a name="489574836"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/489574836" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#489574836">(Dec 17 2024 at 21:27)</a>:</h4>
<p>but the main reason was wanting to get to a state where no matter what target you run it on, all pure functions give the same answers given the same arguments</p>



<a name="489574854"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/489574854" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#489574854">(Dec 17 2024 at 21:27)</a>:</h4>
<p>I agree it wouldn't help here</p>



<a name="489574872"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/489574872" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#489574872">(Dec 17 2024 at 21:27)</a>:</h4>
<p>So OsStr would break that, right?</p>



<a name="489574886"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/489574886" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#489574886">(Dec 17 2024 at 21:27)</a>:</h4>
<p>not necessarily, depends on the API</p>



<a name="489574929"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/489574929" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#489574929">(Dec 17 2024 at 21:27)</a>:</h4>
<p>like <code>OsStr.display : OsStr -&gt; Str</code> would be fine</p>



<a name="489574956"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/489574956" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#489574956">(Dec 17 2024 at 21:28)</a>:</h4>
<p>Or maybe <code>roc-lang/path</code></p>



<a name="489575014"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/489575014" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#489575014">(Dec 17 2024 at 21:28)</a>:</h4>
<p>also <code>OsStr.to_list : OsStr -&gt; [Windows (List U16), Unix (List U8)]</code> would be fine</p>



<a name="489575016"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/489575016" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#489575016">(Dec 17 2024 at 21:28)</a>:</h4>
<p>Ok, if we can't crash (for reasons Richard outline above), what about my other option?</p>



<a name="489575155"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/489575155" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#489575155">(Dec 17 2024 at 21:29)</a>:</h4>
<p>We check if it's valid UTF-8, if not, we provide an empty list for args. Then keep a  <code>Args.unix! : {} -&gt; List (List  U8)</code> and a <code>Args.windows! : {} -&gt; List (List U16)</code> .. at least until we implement roc-lang/path</p>



<a name="489575301"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/489575301" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#489575301">(Dec 17 2024 at 21:30)</a>:</h4>
<p>That's probably just making things worse though... because people aren't going to pre-emptively check for empty args</p>



<a name="489575321"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/489575321" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#489575321">(Dec 17 2024 at 21:30)</a>:</h4>
<p>So I also don't think that's a workable solution</p>



<a name="489575553"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/489575553" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#489575553">(Dec 17 2024 at 21:32)</a>:</h4>
<p>What about unicode replacement characters?</p>



<a name="489575575"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/489575575" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#489575575">(Dec 17 2024 at 21:32)</a>:</h4>
<p>That's the Rust approach</p>



<a name="489575593"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/489575593" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#489575593">(Dec 17 2024 at 21:32)</a>:</h4>
<p><span class="user-mention silent" data-user-id="281383">Richard Feldman</span> <a href="#narrow/channel/316715-contributing/topic/basic-cli.20purity.20inference/near/489574836">said</a>:</p>
<blockquote>
<p>but the main reason was wanting to get to a state where no matter what target you run it on, all pure functions give the same answers given the same arguments</p>
</blockquote>
<p>We could still maintain this property?</p>



<a name="489575620"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/489575620" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#489575620">(Dec 17 2024 at 21:32)</a>:</h4>
<p>yeah we have that property now because we removed <code>Nat</code></p>



<a name="489575625"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/489575625" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#489575625">(Dec 17 2024 at 21:32)</a>:</h4>
<p>and this wouldn't change that</p>



<a name="489575664"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/489575664" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#489575664">(Dec 17 2024 at 21:33)</a>:</h4>
<p>the only way to change that would be to change something in builtins, which this wouldn't do regardless <span aria-label="big smile" class="emoji emoji-1f604" role="img" title="big smile">:big_smile:</span></p>



<a name="489575728"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/489575728" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#489575728">(Dec 17 2024 at 21:34)</a>:</h4>
<p><span class="user-mention silent" data-user-id="515757">Luke Boswell</span> <a href="#narrow/channel/316715-contributing/topic/basic-cli.20purity.20inference/near/489575553">said</a>:</p>
<blockquote>
<p>What about unicode replacement characters?</p>
</blockquote>
<p>if we're ok with those, then we should just go back to <code>main : List Str =&gt; ...</code></p>



<a name="489575824"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/489575824" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#489575824">(Dec 17 2024 at 21:34)</a>:</h4>
<p>the downside there is that if you actually have an end user who has a file with invalid unicode in its path, and wants to pass it into a cli made with <code>basic-cli</code>, it will be impossible</p>



<a name="489575864"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/489575864" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#489575864">(Dec 17 2024 at 21:35)</a>:</h4>
<p>so basically if we go with the Unicode replacement character route, we're choosing to have those edge cases never work correctly in <code>basic-cli</code></p>



<a name="489575932"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/489575932" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#489575932">(Dec 17 2024 at 21:35)</a>:</h4>
<p>I dislike the silent nature of unicode replacment.. I'd prefer crashing and keeping <code>main! : List Str =&gt; ...</code></p>



<a name="489575933"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/489575933" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#489575933">(Dec 17 2024 at 21:35)</a>:</h4>
<p>which feels like a bit of a shame if people are just going to use a cli parser anyway, and could just say "hey this arg is a Path" (for example)</p>



<a name="489575945"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/489575945" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#489575945">(Dec 17 2024 at 21:35)</a>:</h4>
<p>You'd probably have something like</p>
<div class="codehilite" data-code-language="Elm"><pre><span></span><code><span class="kt">OsStr</span><span class="w"> </span><span class="nf">:=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nv">bytes</span><span class="w"> </span><span class="nf">:</span><span class="w"> </span><span class="kt">List</span><span class="w"> </span><span class="kt">U8</span><span class="p">,</span><span class="w"> </span><span class="nv">os</span><span class="nf">:</span><span class="w"> </span><span class="p">[</span><span class="kt">Unix</span><span class="p">,</span><span class="w"> </span><span class="kt">Windows</span><span class="p">]</span><span class="w"> </span><span class="p">}</span>

<span class="kt">OsStr</span><span class="nf">.</span><span class="nv">bytes</span><span class="w"> </span><span class="nf">=</span><span class="w"> </span><span class="nv">os_str</span><span class="w"> </span><span class="nf">-&gt;</span>
<span class="w">    </span><span class="nv">when</span><span class="w"> </span><span class="nv">os</span><span class="w"> </span><span class="nv">is</span>
<span class="w">        </span><span class="kt">Unix</span><span class="w"> </span><span class="nf">-&gt;</span><span class="w"> </span><span class="nv">os_str</span><span class="nf">.</span><span class="nv">bytes</span>
<span class="w">        </span><span class="kt">Windows</span><span class="w"> </span><span class="nf">-&gt;</span>
<span class="w">            </span><span class="nv">os_str</span><span class="nf">.</span><span class="nv">bytes</span>
<span class="w">                </span><span class="nf">.</span><span class="nv">chunks</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<span class="w">                </span><span class="nf">.</span><span class="nv">map</span><span class="p">(</span><span class="nv">left</span><span class="p">,</span><span class="w"> </span><span class="nv">right</span><span class="w"> </span><span class="nf">-&gt;</span><span class="w"> </span><span class="nv">left</span><span class="nf">.</span><span class="nv">shift_left</span><span class="p">(</span><span class="mi">8</span><span class="p">)</span><span class="w"> </span><span class="nf">+</span><span class="w"> </span><span class="nv">right</span><span class="p">)</span>
</code></pre></div>



<a name="489576022"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/489576022" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#489576022">(Dec 17 2024 at 21:36)</a>:</h4>
<p>if we crash, this statement is still equally true:</p>
<p><span class="user-mention silent" data-user-id="281383">Richard Feldman</span> <a href="#narrow/channel/316715-contributing/topic/basic-cli.20purity.20inference/near/489575824">said</a>:</p>
<blockquote>
<p>the downside there is that if you actually have an end user who has a file with invalid unicode in its path, and wants to pass it into a cli made with <code>basic-cli</code>, it will be impossible</p>
</blockquote>



<a name="489576053"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/489576053" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#489576053">(Dec 17 2024 at 21:36)</a>:</h4>
<p><span class="user-mention silent" data-user-id="461444">Sam Mohr</span> <a href="#narrow/channel/316715-contributing/topic/basic-cli.20purity.20inference/near/489575945">said</a>:</p>
<blockquote>
<p>You'd probably have something like</p>
<p><div class="codehilite" data-code-language="Elm"><pre><span></span><code><span class="kt">OsStr</span><span class="w"> </span><span class="nf">:=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nv">bytes</span><span class="w"> </span><span class="nf">:</span><span class="w"> </span><span class="kt">List</span><span class="w"> </span><span class="kt">U8</span><span class="p">,</span><span class="w"> </span><span class="nv">os</span><span class="nf">:</span><span class="w"> </span><span class="p">[</span><span class="kt">Unix</span><span class="p">,</span><span class="w"> </span><span class="kt">Windows</span><span class="p">]</span><span class="w"> </span><span class="p">}</span>

<span class="kt">OsStr</span><span class="nf">.</span><span class="nv">bytes</span><span class="w"> </span><span class="nf">=</span><span class="w"> </span><span class="nv">os_str</span><span class="w"> </span><span class="nf">-&gt;</span>
<span class="w">    </span><span class="nv">when</span><span class="w"> </span><span class="nv">os</span><span class="w"> </span><span class="nv">is</span>
<span class="w">        </span><span class="kt">Unix</span><span class="w"> </span><span class="nf">-&gt;</span><span class="w"> </span><span class="nv">os_str</span><span class="nf">.</span><span class="nv">bytes</span>
<span class="w">        </span><span class="kt">Windows</span><span class="w"> </span><span class="nf">-&gt;</span>
<span class="w">            </span><span class="nv">os_str</span><span class="nf">.</span><span class="nv">bytes</span>
<span class="w">                </span><span class="nf">.</span><span class="nv">chunks</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<span class="w">                </span><span class="nf">.</span><span class="nv">map</span><span class="p">(</span><span class="nv">left</span><span class="p">,</span><span class="w"> </span><span class="nv">right</span><span class="w"> </span><span class="nf">-&gt;</span><span class="w"> </span><span class="nv">left</span><span class="nf">.</span><span class="nv">shift_left</span><span class="p">(</span><span class="mi">8</span><span class="p">)</span><span class="w"> </span><span class="nf">+</span><span class="w"> </span><span class="nv">right</span><span class="p">)</span>
</code></pre></div><br>
</p>
</blockquote>
<p>Why not something like this <a href="https://github.com/roc-lang/path/blob/14b5fa518d13abb5012bcaa6809f7259e912eaeb/package/Path.roc#L24">https://github.com/roc-lang/path/blob/14b5fa518d13abb5012bcaa6809f7259e912eaeb/package/Path.roc#L24</a></p>



<a name="489576096"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/489576096" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#489576096">(Dec 17 2024 at 21:36)</a>:</h4>
<p>That works too</p>



<a name="489576138"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/489576138" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#489576138">(Dec 17 2024 at 21:37)</a>:</h4>
<p>yeah <code>U16</code> differs in alignment too</p>



<a name="489576162"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/489576162" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#489576162">(Dec 17 2024 at 21:37)</a>:</h4>
<p><span class="user-mention silent" data-user-id="281383">Richard Feldman</span> <a href="#narrow/channel/316715-contributing/topic/basic-cli.20purity.20inference/near/489575824">said</a>:</p>
<blockquote>
<p>the downside there is that if you actually have an end user who has a file with invalid unicode in its path, and wants to pass it into a cli made with <code>basic-cli</code>, it will be impossible</p>
</blockquote>
<p>But in this case, people know they can't, and can reach for another program to convert the file names. </p>
<p>I don't know how niche a thing this is.</p>



<a name="489576238"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/489576238" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#489576238">(Dec 17 2024 at 21:37)</a>:</h4>
<p>I'm sure it's very niche haha</p>



<a name="489576243"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/489576243" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#489576243">(Dec 17 2024 at 21:37)</a>:</h4>
<p>Just a point of pedantry, a <code>Path</code> is an <code>OsStr</code>, but an argument is not a <code>Path</code> necessarily, it's an <code>OsStr</code>. So <code>OsStr</code> is the real type at play</p>



<a name="489576263"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/489576263" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#489576263">(Dec 17 2024 at 21:38)</a>:</h4>
<p>right</p>



<a name="489576598"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/489576598" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#489576598">(Dec 17 2024 at 21:40)</a>:</h4>
<p>So I'm okay with <code>main! : List (List U8) =&gt; Result {} _</code> because Weaver makes the user experience not really impeded, but if Weaver and basic-cli now depend of <code>roc-lang/path</code> for some <code>OsStr</code> type, now versioning is weird. This is a lot of weirdness eaten right at the start of "hello world" for a very niche problem</p>



<a name="489576673"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/489576673" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#489576673">(Dec 17 2024 at 21:41)</a>:</h4>
<p>(not trying to do "hello world"-driven dev, just saying this would probably turn off beginners)</p>



<a name="489576786"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/489576786" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#489576786">(Dec 17 2024 at 21:42)</a>:</h4>
<p>the problem with <code>main! : List (List U8) =&gt; Result {} _</code> is that Windows will use u16s, not u8s</p>



<a name="489576807"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/489576807" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#489576807">(Dec 17 2024 at 21:42)</a>:</h4>
<p>and weaver won't have any way of telling which one it's getting if we convert them all to u8</p>



<a name="489576923"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/489576923" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#489576923">(Dec 17 2024 at 21:43)</a>:</h4>
<p>oh, here's a fairly straightforward idea</p>



<a name="489576945"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/489576945" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#489576945">(Dec 17 2024 at 21:43)</a>:</h4>
<p>we could have <code>main! : List Arg =&gt; Result {} _</code></p>



<a name="489577005"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/489577005" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#489577005">(Dec 17 2024 at 21:44)</a>:</h4>
<p><code>Arg</code> works the same way as the <code>OsStr</code> we've been talking about</p>



<a name="489577017"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/489577017" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#489577017">(Dec 17 2024 at 21:44)</a>:</h4>
<p>but it's more self-descriptive and beginner-friendly imo</p>



<a name="489577030"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/489577030" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#489577030">(Dec 17 2024 at 21:44)</a>:</h4>
<p>like "oh, this is a command-line arg"</p>



<a name="489577045"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/489577045" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#489577045">(Dec 17 2024 at 21:44)</a>:</h4>
<p>"what can I do with one of those?"</p>



<a name="489577070"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/489577070" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#489577070">(Dec 17 2024 at 21:44)</a>:</h4>
<p>and the most straightforward thing you can do is give them to <code>Arg.weave</code> (or whatever)</p>



<a name="489577081"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/489577081" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#489577081">(Dec 17 2024 at 21:44)</a>:</h4>
<div class="codehilite"><pre><span></span><code>Arg.display : Arg -&gt; Result Str [InvalidUtf8]
</code></pre></div>



<a name="489577112"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/489577112" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#489577112">(Dec 17 2024 at 21:45)</a>:</h4>
<p>yeah, exactly - stuff like that</p>



<a name="489577113"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/489577113" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#489577113">(Dec 17 2024 at 21:45)</a>:</h4>
<p>How does Weaver engage with this? Does Weaver have <code>basic-cli</code> as a dep?</p>



<a name="489577126"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/489577126" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#489577126">(Dec 17 2024 at 21:45)</a>:</h4>
<p>although in this case it'd be <code>InvalidUnicode</code> because on Windows they aren't UTF-8 <span aria-label="big smile" class="emoji emoji-1f604" role="img" title="big smile">:big_smile:</span></p>



<a name="489577144"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/489577144" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#489577144">(Dec 17 2024 at 21:45)</a>:</h4>
<p>maybe the other way around</p>



<a name="489577182"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/489577182" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#489577182">(Dec 17 2024 at 21:45)</a>:</h4>
<p>we'd previously talked about having <code>basic-cli</code> ship with Weaver,  right?</p>



<a name="489577238"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/489577238" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#489577238">(Dec 17 2024 at 21:46)</a>:</h4>
<p>maybe this is a reason to do that</p>



<a name="489577246"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/489577246" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#489577246">(Dec 17 2024 at 21:46)</a>:</h4>
<p>It used to until very recently</p>



<a name="489577254"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/489577254" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#489577254">(Dec 17 2024 at 21:46)</a>:</h4>
<p>As embedded code</p>



<a name="489577259"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/489577259" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#489577259">(Dec 17 2024 at 21:46)</a>:</h4>
<p>I'd be okay with that</p>



<a name="489577292"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/489577292" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#489577292">(Dec 17 2024 at 21:46)</a>:</h4>
<p>Especially now that I'm not the only person with write access to Weaver</p>



<a name="489577295"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/489577295" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#489577295">(Dec 17 2024 at 21:46)</a>:</h4>
<p><span class="user-mention" data-user-id="461444">@Sam Mohr</span> </p>
<p>For Weaver there should be a</p>
<div class="codehilite"><pre><span></span><code>Arg.to_raw : Arg -&gt; [Unix (List U8), Windows (List U16)]
</code></pre></div>



<a name="489577360"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/489577360" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#489577360">(Dec 17 2024 at 21:47)</a>:</h4>
<p>So that could be a module parameter for Weaver</p>



<a name="489577399"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/489577399" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#489577399">(Dec 17 2024 at 21:47)</a>:</h4>
<p>I don't think it needs to be a module param</p>



<a name="489577444"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/489577444" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#489577444">(Dec 17 2024 at 21:47)</a>:</h4>
<p>just pass it into <code>weave</code>?</p>



<a name="489577452"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/489577452" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#489577452">(Dec 17 2024 at 21:47)</a>:</h4>
<p>Weaver should just expose a module <code>weaver.Arg</code> that exposes <code>Arg</code></p>



<a name="489577543"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/489577543" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#489577543">(Dec 17 2024 at 21:48)</a>:</h4>
<p>yeah but just seems simpler to have <code>basic-cli</code> ship with it</p>



<a name="489577557"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/489577557" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#489577557">(Dec 17 2024 at 21:48)</a>:</h4>
<p>then we have a coherent story around it</p>



<a name="489577579"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/489577579" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#489577579">(Dec 17 2024 at 21:48)</a>:</h4>
<p>With <code>Arg</code> you mean</p>



<a name="489577580"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/489577580" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#489577580">(Dec 17 2024 at 21:48)</a>:</h4>
<p>"main gets a <code>List Arg</code> and here is a nice way to turn that into a good experience for people"</p>



<a name="489577642"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/489577642" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#489577642">(Dec 17 2024 at 21:49)</a>:</h4>
<p><span class="user-mention silent" data-user-id="461444">Sam Mohr</span> <a href="#narrow/channel/316715-contributing/topic/basic-cli.20purity.20inference/near/489577113">said</a>:</p>
<blockquote>
<p>How does Weaver engage with this? Does Weaver have <code>basic-cli</code> as a dep?</p>
</blockquote>
<p>Then we're back here</p>



<a name="489577653"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/489577653" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#489577653">(Dec 17 2024 at 21:49)</a>:</h4>
<p>I'd prefer we tell Weaver how to "decode" an <code>Arg</code> that comes from the platform. Other people may come up with Weaver 2.0's in future</p>



<a name="489577674"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/489577674" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#489577674">(Dec 17 2024 at 21:49)</a>:</h4>
<p>Module params are our friend</p>



<a name="489577678"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/489577678" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#489577678">(Dec 17 2024 at 21:49)</a>:</h4>
<p>that works</p>



<a name="489577686"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/489577686" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#489577686">(Dec 17 2024 at 21:49)</a>:</h4>
<p>Oh, I see!</p>



<a name="489577813"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/489577813" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#489577813">(Dec 17 2024 at 21:50)</a>:</h4>
<p>heh, and actually in the static dispatch future, <code>weave</code> can just ask for something that has a <code>to_raw</code> method of the appropriate type <span aria-label="big smile" class="emoji emoji-1f604" role="img" title="big smile">:big_smile:</span></p>



<a name="489577824"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/489577824" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#489577824">(Dec 17 2024 at 21:50)</a>:</h4>
<p>then it doesn't even need an extra arg!</p>



<a name="489577925"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/489577925" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#489577925">(Dec 17 2024 at 21:51)</a>:</h4>
<p>Weaver has in Cli.roc:</p>
<div class="codehilite" data-code-language="Elm"><pre><span></span><code><span class="kn">module</span><span class="w"> </span><span class="err">[</span><span class="nc">parseArgs</span><span class="p">]</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nv">decodeArg</span><span class="w"> </span><span class="nf">:</span><span class="w"> </span><span class="nv">a</span><span class="w"> </span><span class="nf">-&gt;</span><span class="w"> </span><span class="kt">Result</span><span class="w"> </span><span class="kt">WeaverArg</span><span class="w"> </span><span class="nv">_</span><span class="w"> </span><span class="p">}</span>

<span class="kt">WeaverArg</span><span class="w"> </span><span class="nf">:</span><span class="w"> </span><span class="p">[</span><span class="kt">Unix</span><span class="w"> </span><span class="p">(</span><span class="kt">List</span><span class="w"> </span><span class="kt">U8</span><span class="p">),</span><span class="w"> </span><span class="kt">Windows</span><span class="w"> </span><span class="p">(</span><span class="kt">List</span><span class="w"> </span><span class="kt">U16</span><span class="p">)]</span>

<span class="nv">parseArgs</span><span class="w"> </span><span class="nf">:</span><span class="w"> </span><span class="kt">List</span><span class="w"> </span><span class="kt">WeaverArg</span><span class="w"> </span><span class="nf">-&gt;</span><span class="w"> </span><span class="kt">Result</span><span class="w"> </span><span class="nv">_</span><span class="w"> </span><span class="nv">_</span>
</code></pre></div>



<a name="489577948"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/489577948" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#489577948">(Dec 17 2024 at 21:51)</a>:</h4>
<p>Maybe we should spin this off into another thread... but, would we be picking a name for that?</p>
<p>Like, anything with the shape <code>to_os_str : thing -&gt; [Unix _, Windows _] where ...</code> etc</p>



<a name="489578065"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/489578065" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#489578065">(Dec 17 2024 at 21:52)</a>:</h4>
<p>I haven't fully digested static dispatch so ^^ may not be aligned with that worldview</p>



<a name="489578088"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/489578088" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#489578088">(Dec 17 2024 at 21:52)</a>:</h4>
<p>Which for now would have people importing it as</p>
<div class="codehilite" data-code-language="Elm"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nc">weaver.Cli</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nv">decodeArg</span><span class="w"> </span><span class="nf">:</span><span class="w"> </span><span class="kt">Arg</span><span class="nf">.</span><span class="nv">to_raw</span><span class="w"> </span><span class="p">}</span>
</code></pre></div>



<a name="489578180"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/489578180" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#489578180">(Dec 17 2024 at 21:53)</a>:</h4>
<p>Not a huge fan of this, but it solves 100% of Bill Gates past mistakes</p>



<a name="489578209"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/489578209" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#489578209">(Dec 17 2024 at 21:53)</a>:</h4>
<p>And it'll be better in static dispatch world</p>



<a name="489578212"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/489578212" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#489578212">(Dec 17 2024 at 21:53)</a>:</h4>
<p>I like the idea of passing it to <code>weave</code></p>



<a name="489578221"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/489578221" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#489578221">(Dec 17 2024 at 21:53)</a>:</h4>
<p>as opposed to a module param</p>



<a name="489578291"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/489578291" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#489578291">(Dec 17 2024 at 21:54)</a>:</h4>
<p>because that's the only place where it's relevant, and in the static dispatch world we can drop the extra <code>weave</code> argument</p>



<a name="489578315"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/489578315" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#489578315">(Dec 17 2024 at 21:54)</a>:</h4>
<p>Oh yeah, that works now, true</p>



<a name="489578367"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/489578367" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#489578367">(Dec 17 2024 at 21:54)</a>:</h4>
<div class="codehilite"><pre><span></span><code>{ Cli.weave Args.to_os_raw &lt;-
    alpha: Opt.u64 { short: &quot;a&quot;, help: &quot;Set the alpha level&quot; },
    verbosity: Opt.count { short: &quot;v&quot;, long: &quot;verbose&quot;, help: &quot;How loud we should be.&quot; },
    files: Param.strList { name: &quot;files&quot;, help: &quot;The files to process.&quot; },
}
</code></pre></div>



<a name="489578649"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/489578649" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#489578649">(Dec 17 2024 at 21:57)</a>:</h4>
<p>We have nice things now... I love roc <span aria-label="heart" class="emoji emoji-2764" role="img" title="heart">:heart:</span></p>



<a name="489578693"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/489578693" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#489578693">(Dec 17 2024 at 21:57)</a>:</h4>
<p>oh actually I think it might be <code>finish</code> that needs it, not <code>weave</code></p>



<a name="489578721"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/489578721" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#489578721">(Dec 17 2024 at 21:57)</a>:</h4>
<p>Finish works</p>



<a name="489578722"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/489578722" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#489578722">(Dec 17 2024 at 21:57)</a>:</h4>
<p>but yeah, one or the other</p>



<a name="489578811"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/489578811" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#489578811">(Dec 17 2024 at 21:58)</a>:</h4>
<p>Since static dispatch doesn't allow implementing methods outside of the defining module for a type, I presume that once Weaver has converter your args to <code>WeaverArg</code>, the user wouldn't be able to get a method on <code>WeaverArg</code> to convert it to a <code>roc-lang/path</code> data type.</p>



<a name="489578824"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/489578824" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#489578824">(Dec 17 2024 at 21:58)</a>:</h4>
<p>But there's pass_to</p>



<a name="489578832"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/489578832" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#489578832">(Dec 17 2024 at 21:58)</a>:</h4>
<p>So it's fine</p>



<a name="489578873"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/489578873" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#489578873">(Dec 17 2024 at 21:58)</a>:</h4>
<p>yeah I think this plan should work!</p>



<a name="489578910"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/489578910" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#489578910">(Dec 17 2024 at 21:58)</a>:</h4>
<p>In the long run, this kind of data type is in std or a parent lib, but we're way out from that, and this is still 90% as nice for the end user</p>



<a name="489578929"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/489578929" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#489578929">(Dec 17 2024 at 21:59)</a>:</h4>
<p><code>Arg</code> and <code>WeaverArg</code> can't be opaque</p>



<a name="489578932"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/489578932" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#489578932">(Dec 17 2024 at 21:59)</a>:</h4>
<p>oh wait, <code>parseOrDisplayMessage</code> has to be the answer <span aria-label="laughing" class="emoji emoji-1f606" role="img" title="laughing">:laughing:</span></p>



<a name="489578948"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/489578948" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#489578948">(Dec 17 2024 at 21:59)</a>:</h4>
<p>that's the one that takes <code>args</code></p>



<a name="489578954"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/489578954" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#489578954">(Dec 17 2024 at 21:59)</a>:</h4>
<p>so it's the one that needs to know what to do with them</p>



<a name="489578958"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/489578958" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#489578958">(Dec 17 2024 at 21:59)</a>:</h4>
<p>For args, why do we need to support utf16? All utf16 can be converted to utf-8. Why not just always losslessly convert to list u8?</p>



<a name="489579013"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/489579013" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#489579013">(Dec 17 2024 at 21:59)</a>:</h4>
<p>in Windows the args aren't necessarily valid utf-16</p>



<a name="489579021"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/489579021" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#489579021">(Dec 17 2024 at 21:59)</a>:</h4>
<p>and on Unix they aren't necessarily valid utf-8</p>



<a name="489579022"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/489579022" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#489579022">(Dec 17 2024 at 21:59)</a>:</h4>
<div class="message_inline_image"><a href="https://media0.giphy.com/media/YOqbsB7Ega18s/giphy.gif?cid=c623cb35k9i7nos3ha6n81jqpqjwqwnczhfo2iu8sx8afyrh&amp;ep=v1_gifs_search&amp;rid=giphy.gif&amp;ct=g"><img src="https://uploads.zulipusercontent.net/76cd4578289c4f4de3bb0f5a3549f6fcf0730e0f/68747470733a2f2f6d65646961302e67697068792e636f6d2f6d656469612f594f71627342374567613138732f67697068792e6769663f6369643d63363233636233356b3969376e6f73336861366e38316a7170716a7771776e637a68666f3269753873783861667972682665703d76315f676966735f736561726368267269643d67697068792e6769662663743d67"></a></div><p>Brendan rn</p>



<a name="489579034"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/489579034" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#489579034">(Dec 17 2024 at 21:59)</a>:</h4>
<p>The only issue is with non Unicode args which is ever rarer</p>



<a name="489579131"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/489579131" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#489579131">(Dec 17 2024 at 22:00)</a>:</h4>
<p>I need to read up more on os strings</p>



<a name="489579169"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/489579169" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#489579169">(Dec 17 2024 at 22:00)</a>:</h4>
<p>yeah, the point is that if people are just going to be using Weaver anyway, we can handle those edge cases naturally</p>



<a name="489579192"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/489579192" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#489579192">(Dec 17 2024 at 22:00)</a>:</h4>
<p>without people needing to know about all this</p>



<a name="489579209"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/489579209" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#489579209">(Dec 17 2024 at 22:00)</a>:</h4>
<p>Yeah, we're not talking about path's any longer... this goes deep</p>



<a name="489579220"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/489579220" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#489579220">(Dec 17 2024 at 22:00)</a>:</h4>
<p>in other words, we can create a pit of success for application authors</p>



<a name="489579266"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/489579266" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#489579266">(Dec 17 2024 at 22:01)</a>:</h4>
<p>Richard has been down there, and survived to tell the story</p>



<a name="489579500"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/489579500" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#489579500">(Dec 17 2024 at 22:02)</a>:</h4>
<p>Ah, windows is U16, but not necessarily utf16....why do os apis have to suck?</p>



<a name="489579571"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/489579571" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#489579571">(Dec 17 2024 at 22:03)</a>:</h4>
<p><span class="user-mention silent" data-user-id="343810">Brendan Hansknecht</span> <a href="#narrow/channel/316715-contributing/topic/basic-cli.20purity.20inference/near/489579500">said</a>:</p>
<blockquote>
<p>Ah, windows is U16, but not necessarily utf16....why do os apis have to suck?</p>
</blockquote>
<p>It's ok, <span class="user-mention" data-user-id="461444">@Sam Mohr</span> has volunteered to handle all the edge cases in Weaver <span aria-label="cross" class="emoji emoji-271d" role="img" title="cross">:cross:</span></p>



<a name="489579619"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/489579619" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#489579619">(Dec 17 2024 at 22:03)</a>:</h4>
<p>Yes, that's the martyr emoji isn't it</p>



<a name="489579812"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/489579812" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#489579812">(Dec 17 2024 at 22:04)</a>:</h4>
<p>So Weaver will implement utf16 so it can parse windows CLI args? And it will be able to parse both utf-8 and utf16. It also will be able to collect args that aren't valid utf-8/16 for use as paths and such</p>



<a name="489579824"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/489579824" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#489579824">(Dec 17 2024 at 22:04)</a>:</h4>
<p>Is that the summary</p>



<a name="489579888"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/489579888" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#489579888">(Dec 17 2024 at 22:05)</a>:</h4>
<p>haha, oh dear</p>



<a name="489580051"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/489580051" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#489580051">(Dec 17 2024 at 22:06)</a>:</h4>
<p>I guess my biggest comment is that I really like being able to use simple args and keep the lie (of everything just working as utf-8). I find it very convenient for "basic" CLI. I personally don't generally use tools like Weaver (but maybe I should).</p>



<a name="489580140"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/489580140" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#489580140">(Dec 17 2024 at 22:07)</a>:</h4>
<p>Maybe we want something to keep things more sane (only use the others for non-utf8 things)</p>
<div class="codehilite"><pre><span></span><code>Arg.as_os : Arg -&gt; [ Utf8 Str, Unix (List U8), Windows (List U16) ]
</code></pre></div>



<a name="489580243"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/489580243" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#489580243">(Dec 17 2024 at 22:08)</a>:</h4>
<p>Instead of handling every arg as <code>Str</code>, it's gonna use <code>WeaverArg</code>. For each arg, it'll attempt to parse to the right type from <code>WeaverArg</code>, be that:</p>
<ul>
<li>numbers</li>
<li>strings</li>
<li>bytestrings (List U8)</li>
<li>paths (alias for WeaverArg?)</li>
</ul>



<a name="489580329"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/489580329" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#489580329">(Dec 17 2024 at 22:08)</a>:</h4>
<p>yeah I think we can offer a "quick and dirty" thing you can use e.g. if you're just making a quick script for yourself and don't want to build out a full set of args with help docs and all that</p>



<a name="489580417"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/489580417" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#489580417">(Dec 17 2024 at 22:09)</a>:</h4>
<p>but have it be opt in</p>



<a name="489580463"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/489580463" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#489580463">(Dec 17 2024 at 22:09)</a>:</h4>
<p>rather than part of of <code>main</code>'s type</p>



<a name="489580491"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/489580491" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#489580491">(Dec 17 2024 at 22:09)</a>:</h4>
<p>Maybe Weaver could even offer that?</p>



<a name="489580624"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/489580624" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#489580624">(Dec 17 2024 at 22:10)</a>:</h4>
<p>Which guides people away from saying "I'll just use the built-in thing"</p>



<a name="489580627"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/489580627" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#489580627">(Dec 17 2024 at 22:10)</a>:</h4>
<p>also possible, but if I'm just making a quick script for myself and don't want to bother with edge cases, I probably don't want to bother with dependencies either <span aria-label="big smile" class="emoji emoji-1f604" role="img" title="big smile">:big_smile:</span></p>



<a name="489580636"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/489580636" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#489580636">(Dec 17 2024 at 22:10)</a>:</h4>
<p>Agreed</p>



<a name="489580663"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/489580663" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#489580663">(Dec 17 2024 at 22:10)</a>:</h4>
<p>Though you always need a platform</p>



<a name="489580704"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/489580704" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#489580704">(Dec 17 2024 at 22:11)</a>:</h4>
<p>There's no such thing as a CLI in Roc without deps</p>



<a name="489580719"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/489580719" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#489580719">(Dec 17 2024 at 22:11)</a>:</h4>
<p>sure</p>



<a name="489580738"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/489580738" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#489580738">(Dec 17 2024 at 22:11)</a>:</h4>
<p><span aria-label="shrug" class="emoji emoji-1f937" role="img" title="shrug">:shrug:</span></p>



<a name="489580742"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/489580742" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#489580742">(Dec 17 2024 at 22:11)</a>:</h4>
<p>I just mean adding another one</p>



<a name="489580860"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/489580860" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#489580860">(Dec 17 2024 at 22:12)</a>:</h4>
<p>I think API design decisions like this are really worthwhile</p>



<a name="489580897"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/489580897" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#489580897">(Dec 17 2024 at 22:12)</a>:</h4>
<p>I just don't know what "quick and dirty args" will look like without giving users a footgun that this whole discussion just attempted to avoid</p>



<a name="489580911"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/489580911" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#489580911">(Dec 17 2024 at 22:12)</a>:</h4>
<p>I'd be happy to see one, though!</p>



<a name="489580917"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/489580917" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#489580917">(Dec 17 2024 at 22:12)</a>:</h4>
<p>So we have the "pit-of-success" but somewhat complicated default for <code>main! : List Arg -&gt; ...</code>, and then also provde a quick and dirty <code>Arg.list! : {} =&gt; List Str</code> which might crash on invalid utf8</p>



<a name="489580952"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/489580952" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#489580952">(Dec 17 2024 at 22:13)</a>:</h4>
<p>Maybe <code>Arg.lossyList!</code>?</p>



<a name="489580960"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/489580960" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#489580960">(Dec 17 2024 at 22:13)</a>:</h4>
<p>If we make Weaver part of basic CLI, I would be happy with it exposing a method to just convert all args to utf8</p>



<a name="489581025"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/489581025" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#489581025">(Dec 17 2024 at 22:13)</a>:</h4>
<p>it's the difference between people being unpleasantly surprised when things don't work in unusual circumstances vs being like "hey the equivalent tool written in Roc works fine in this scenario, how come yours crashes, Non Roc Program?"</p>



<a name="489581030"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/489581030" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#489581030">(Dec 17 2024 at 22:13)</a>:</h4>
<p>Otherwise yeah, effect is fine.</p>



<a name="489581043"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/489581043" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#489581043">(Dec 17 2024 at 22:13)</a>:</h4>
<p>For the quick and dirty... you just ignore the args in main, and use the Effect</p>



<a name="489581148"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/489581148" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#489581148">(Dec 17 2024 at 22:14)</a>:</h4>
<p><span class="user-mention silent" data-user-id="281383">Richard Feldman</span> <a href="#narrow/channel/316715-contributing/topic/basic-cli.20purity.20inference/near/489581025">said</a>:</p>
<blockquote>
<p>it's the difference between people being unpleasantly surprised when things don't work in unusual circumstances vs being like "hey the equivalent tool written in Roc works fine in this scenario, how come yours crashes, Non Roc Program?"</p>
</blockquote>
<p>You really targeted my anti-Python CLI bias right there</p>



<a name="489581192"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/489581192" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#489581192">(Dec 17 2024 at 22:14)</a>:</h4>
<p>or we could have <code>Arg.display : Arg -&gt; Str</code></p>



<a name="489581197"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/489581197" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#489581197">(Dec 17 2024 at 22:14)</a>:</h4>
<p>"Ranger is the most popular TUI file manager, it's gotta be battle tested!"</p>



<a name="489581209"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/489581209" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#489581209">(Dec 17 2024 at 22:14)</a>:</h4>
<p>And it is, but it still broke a bunch when I used it</p>



<a name="489581273"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/489581273" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#489581273">(Dec 17 2024 at 22:15)</a>:</h4>
<p>and then you can just <code>map</code> over them to get a <code>List Str</code></p>



<a name="489581363"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/489581363" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#489581363">(Dec 17 2024 at 22:15)</a>:</h4>
<p>also this discussion (and <code>Path</code>) are good examples of why having a pit of success is so important</p>



<a name="489581457"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/489581457" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#489581457">(Dec 17 2024 at 22:16)</a>:</h4>
<p>how many application authors are gonna go far enough down the OS rabbit hole to know about these things?</p>



<a name="489581533"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/489581533" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#489581533">(Dec 17 2024 at 22:17)</a>:</h4>
<p>negative five percent</p>



<a name="489581548"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/489581548" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#489581548">(Dec 17 2024 at 22:17)</a>:</h4>
<p>finding an API where if they use it and naturally end up with edge cases Just Working is awesome</p>



<a name="489581659"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/489581659" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#489581659">(Dec 17 2024 at 22:18)</a>:</h4>
<p><span class="user-mention silent" data-user-id="281383">Richard Feldman</span> <a href="#narrow/stream/316715-contributing/topic/basic-cli.20purity.20inference/near/489581192">said</a>:</p>
<blockquote>
<p>or we could have <code>Arg.display : Arg -&gt; Str</code></p>
</blockquote>
<p>Yeah, I vote for this. Or if we want to be more explicit <code>Arg.toStrLossy</code></p>



<a name="489581708"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/489581708" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#489581708">(Dec 17 2024 at 22:18)</a>:</h4>
<p>Or similar name</p>



<a name="489581744"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/489581744" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#489581744">(Dec 17 2024 at 22:18)</a>:</h4>
<p>Yep, having "lossy" in the name is really good IMO</p>



<a name="489581878"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/489581878" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#489581878">(Dec 17 2024 at 22:19)</a>:</h4>
<p>C'mon guys... <code>Arg.to_str_lossy</code></p>



<a name="489581961"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/489581961" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#489581961">(Dec 17 2024 at 22:20)</a>:</h4>
<p>Yeah, I like where this design is reaching overall. Essentially main gets OsString args. Weaver knows how to handle them well. Otherwise, users can opt into the naive thing and the name calls out it is naive.</p>



<a name="489581964"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/489581964" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#489581964">(Dec 17 2024 at 22:20)</a>:</h4>
<p>Steve Irwin over here with his love of reptiles</p>



<a name="489582062"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/489582062" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#489582062">(Dec 17 2024 at 22:21)</a>:</h4>
<p>So I'm busy for 1.5 hours at work, I'll add <code>Arg := [Unix (List U8), Windows (List U16)]</code> after that to the basic-cli PR</p>



<a name="489582075"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/489582075" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#489582075">(Dec 17 2024 at 22:21)</a>:</h4>
<p>And then update Weaver later</p>



<a name="489582175"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/489582175" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#489582175">(Dec 17 2024 at 22:22)</a>:</h4>
<p>While you're at it, feel like adding <code>Str.from_utf16</code> to the builtins? <span aria-label="sweat smile" class="emoji emoji-1f605" role="img" title="sweat smile">:sweat_smile:</span></p>



<a name="489582203"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/489582203" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#489582203">(Dec 17 2024 at 22:22)</a>:</h4>
<p>That'd be great</p>



<a name="489582223"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/489582223" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#489582223">(Dec 17 2024 at 22:22)</a>:</h4>
<p>New thread time</p>



<a name="489582315"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/489582315" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#489582315">(Dec 17 2024 at 22:23)</a>:</h4>
<p>That is also needed for js, right?</p>



<a name="489582355"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/489582355" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#489582355">(Dec 17 2024 at 22:23)</a>:</h4>
<p>I feel like I remember this coming up in wasm land</p>



<a name="489582686"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/489582686" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#489582686">(Dec 17 2024 at 22:26)</a>:</h4>
<p>Oh man, you're right, JS uses UTF-16 for strings</p>



<a name="489583271"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/489583271" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#489583271">(Dec 17 2024 at 22:31)</a>:</h4>
<p>Yep, both JS and Dart used UCS-2 (and UTF16 in modern implementations)</p>



<a name="489583945"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/489583945" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#489583945">(Dec 17 2024 at 22:37)</a>:</h4>
<p>Java too</p>



<a name="489584134"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/489584134" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#489584134">(Dec 17 2024 at 22:38)</a>:</h4>
<p>although I think Java might use one of the custom encodings that disallows zeros, I forget</p>



<a name="489584179"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/489584179" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#489584179">(Dec 17 2024 at 22:39)</a>:</h4>
<p>but yeah <code>Str.from_utf16</code> seems like a good idea! <span aria-label="+1" class="emoji emoji-1f44d" role="img" title="+1">:+1:</span></p>



<a name="489584250"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/489584250" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#489584250">(Dec 17 2024 at 22:39)</a>:</h4>
<p>Great! Discussion happening <a href="#narrow/channel/383402-API-design/topic/Lossy.20unicode.20conversion.20builtins/near/489582492">here</a> for the onlookers</p>



<a name="489584587"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/489584587" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jan kili <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#489584587">(Dec 17 2024 at 22:42)</a>:</h4>
<p>👏🏼 love to see 242 unreads in a juicy topic</p>



<a name="489584769"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/489584769" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#489584769">(Dec 17 2024 at 22:44)</a>:</h4>
<p><span class="user-mention silent" data-user-id="462053">JanCVanB</span> <a href="#narrow/channel/316715-contributing/topic/basic-cli.20purity.20inference/near/489584587">said</a>:</p>
<blockquote>
<p>👏🏼 love to see 242 unreads in a juicy topic</p>
</blockquote>
<p>Make sure to wear a helmet</p>



<a name="490303566"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/490303566" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anton <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#490303566">(Dec 21 2024 at 14:37)</a>:</h4>
<blockquote>
<p>The new release will probably be available next week.</p>
</blockquote>
<p><span class="user-mention" data-user-id="497765">@Kilian Vounckx</span> we're still getting in some final changes, so should be next week</p>



<a name="490310340"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/490310340" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Kilian Vounckx <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#490310340">(Dec 21 2024 at 16:10)</a>:</h4>
<p>No problems, take all the time you need</p>



<a name="491108079"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/491108079" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anton <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#491108079">(Dec 28 2024 at 17:42)</a>:</h4>
<p><span class="user-mention" data-user-id="497765">@Kilian Vounckx</span>  The pre-release for basic-cli 0.18.0 is <a href="https://github.com/roc-lang/basic-cli/releases/tag/0.18.0">availabe</a> :)</p>



<a name="491112565"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/491112565" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Kilian Vounckx <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#491112565">(Dec 28 2024 at 18:58)</a>:</h4>
<p>Awesome! Thanks for the tag <span aria-label="big smile" class="emoji emoji-1f604" role="img" title="big smile">:big_smile:</span></p>



<a name="491465837"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20purity%20inference/near/491465837" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jan kili <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20purity.20inference.html#491465837">(Jan 01 2025 at 03:36)</a>:</h4>
<p>Today I successfully manually merged that pre-release into my downstream "fork" roc-on - <span class="user-mention" data-user-id="515757">@Luke Boswell</span> I loooooove the glue splitting, I refactored my codegen pipeline to populate a new crate <code>roc_midi</code></p>



<hr><p>Last updated: Mar 01 2026 at 12:20 UTC</p>
</html>