<html>
<head><meta charset="utf-8"><title>Integers misbehaving in interpreter · contributing · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/index.html">contributing</a></h2>
<h3>Topic: <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Integers.20misbehaving.20in.20interpreter.html">Integers misbehaving in interpreter</a></h3>

<hr>

<base href="https://roc.zulipchat.com">

<head><link href="https://roc-lang.github.io/zulip-export/style.css" rel="stylesheet"></head>

<a name="560622250"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Integers%20misbehaving%20in%20interpreter/near/560622250" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthieu Pizenberg <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Integers.20misbehaving.20in.20interpreter.html#560622250">(Nov 27 2025 at 15:20)</a>:</h4>
<p>The following code works well in a regular program in the <code>test/fx/</code> directory for example, but when evaluating with the interpreter tests in src/eval/test/low_level_interp_test.zig , it fails.</p>
<div class="codehilite" data-code-language="Ruby"><pre><span></span><code><span class="nb">test</span><span class="w"> </span><span class="s2">"e_low_level_lambda - U8.plus basic"</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">const</span><span class="w"> </span><span class="n">src</span><span class="w"> </span><span class="o">=</span>
<span class="w">        </span><span class="p">\\</span><span class="n">a</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="no">U8</span>
<span class="w">        </span><span class="p">\\</span><span class="n">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">5</span>
<span class="w">        </span><span class="p">\\</span><span class="n">b</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="no">U8</span>
<span class="w">        </span><span class="p">\\</span><span class="n">b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">3</span>
<span class="w">        </span><span class="p">\\</span><span class="n">x</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="no">U8</span>
<span class="w">        </span><span class="p">\\</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="no">U8</span><span class="o">.</span><span class="n">plus</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">)</span>
<span class="w">    </span><span class="p">;</span>
<span class="w">    </span><span class="n">const</span><span class="w"> </span><span class="n">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">try</span><span class="w"> </span><span class="n">evalModuleAndGetInt</span><span class="p">(</span><span class="n">src</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">);</span>
<span class="w">    </span><span class="n">try</span><span class="w"> </span><span class="n">testing</span><span class="o">.</span><span class="n">expectEqual</span><span class="p">(</span><span class="vi">@as</span><span class="p">(</span><span class="n">i128</span><span class="p">,</span><span class="w"> </span><span class="mi">8</span><span class="p">),</span><span class="w"> </span><span class="n">value</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>
<p>I’ve tried a few variations of this example, and the <code>TypeMismatch</code> is the one that comes back most of the time.</p>
<div class="codehilite"><pre><span></span><code>❯ zig build test
test
└─ tests_summary
   └─ run test eval 537/538 passed, 1 failed
error: &#39;test.low_level_interp_test.test.e_low_level_lambda - U8.plus basic&#39; failed: /Users/piz/git/roc-lang/roc/src/eval/interpreter.zig:2199:21: 0x1020745af in evalExprMinimal (eval)
                    return error.TypeMismatch;
                    ^
/Users/piz/git/roc-lang/roc/src/eval/interpreter.zig:357:16: 0x102034387 in evalMinimal (eval)
        return try self.evalExprMinimal(expr_idx, roc_ops, null);
               ^
/Users/piz/git/roc-lang/roc/src/eval/test/low_level_interp_test.zig:138:29: 0x10243c637 in evalModuleAndGetInt (eval)
        const stack_value = try result.evaluator.interpreter.evalMinimal(def.expr, ops);
                            ^
/Users/piz/git/roc-lang/roc/src/eval/test/low_level_interp_test.zig:1135:19: 0x10244145f in test.e_low_level_lambda - U8.plus basic (eval)
    const value = try evalModuleAndGetInt(src, 2);
                  ^
error: while executing test &#39;test.list_refcount_builtins.test.list refcount builtins - phase 12 limitation documented&#39;, the following test command failed:
./.zig-cache/o/043f7b958e657d15765bf3cb0f00af62/eval --cache-dir=./.zig-cache --seed=0x9302518d --listen=-

Build Summary: 54/57 steps succeeded; 1 failed; 1616/1617 tests passed; 1 failed
test transitive failure
└─ tests_summary transitive failure
   └─ run test eval 537/538 passed, 1 failed

error: the following build command failed with exit code 1:
.zig-cache/o/60d699020c5a472d82aa95da80b88525/build /opt/homebrew/Cellar/zig/0.15.2/bin/zig /opt/homebrew/Cellar/zig/0.15.2/lib/zig /Users/piz/git/roc-lang/roc .zig-cache /Users/piz/.cache/zig --seed 0x9302518d -Zcb2427e166fa2426 test
</code></pre></div>
<p>And using <code>a.plus(b)</code> instead of <code>U8.plus(a,b)</code> get us a panic.</p>



<hr><p>Last updated: Mar 01 2026 at 12:20 UTC</p>
</html>