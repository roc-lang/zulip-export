<html>
<head><meta charset="utf-8"><title>basic-cli reqwest lib size · contributing · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/index.html">contributing</a></h2>
<h3>Topic: <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20reqwest.20lib.20size.html">basic-cli reqwest lib size</a></h3>

<hr>

<base href="https://roc.zulipchat.com">

<head><link href="https://roc-lang.github.io/zulip-export/style.css" rel="stylesheet"></head>

<a name="402337156"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20reqwest%20lib%20size/near/402337156" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20reqwest.20lib.20size.html#402337156">(Nov 15 2023 at 22:13)</a>:</h4>
<p>Circling back on basic cli size. Just pulled current basic cli sizes.</p>
<p>With the reqwest library: <code>6.7MB</code><br>
Without the reqwest library: <code>1.1MB</code></p>



<a name="402337249"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20reqwest%20lib%20size/near/402337249" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20reqwest.20lib.20size.html#402337249">(Nov 15 2023 at 22:14)</a>:</h4>
<p>After that, backtraces are the next biggest contributor to bloat.</p>



<a name="402338426"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20reqwest%20lib%20size/near/402338426" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20reqwest.20lib.20size.html#402338426">(Nov 15 2023 at 22:24)</a>:</h4>
<p>wow, is there any way to make reqwest smaller? <span aria-label="sweat smile" class="emoji emoji-1f605" role="img" title="sweat smile">:sweat_smile:</span></p>



<a name="402338961"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20reqwest%20lib%20size/near/402338961" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20reqwest.20lib.20size.html#402338961">(Nov 15 2023 at 22:28)</a>:</h4>
<p>We could try <code>ureq</code> or similar if we can make it fit a nice API.</p>



<a name="402339008"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20reqwest%20lib%20size/near/402339008" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20reqwest.20lib.20size.html#402339008">(Nov 15 2023 at 22:29)</a>:</h4>
<p>I think ureq is synchronous only</p>



<a name="402339544"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20reqwest%20lib%20size/near/402339544" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20reqwest.20lib.20size.html#402339544">(Nov 15 2023 at 22:33)</a>:</h4>
<p>We only use it synchronously currently, but i guess that will change in the future? Actually, I don't think that will change for basic cli</p>



<a name="402339586"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20reqwest%20lib%20size/near/402339586" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20reqwest.20lib.20size.html#402339586">(Nov 15 2023 at 22:33)</a>:</h4>
<p>Otherwise, maybe <code>attohttpc</code></p>



<a name="402339954"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20reqwest%20lib%20size/near/402339954" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20reqwest.20lib.20size.html#402339954">(Nov 15 2023 at 22:37)</a>:</h4>
<p>We also could try to user <code>hyper</code> directly. Not sure how low level it actually is.</p>



<a name="402341267"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20reqwest%20lib%20size/near/402341267" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20reqwest.20lib.20size.html#402341267">(Nov 15 2023 at 22:48)</a>:</h4>
<p>I think we'll want to use async once we have Task.map2</p>



<a name="402341335"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20reqwest%20lib%20size/near/402341335" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20reqwest.20lib.20size.html#402341335">(Nov 15 2023 at 22:49)</a>:</h4>
<p>basic-webserver uses hyper for receiving requests and it's totally fine</p>



<a name="402341345"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20reqwest%20lib%20size/near/402341345" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20reqwest.20lib.20size.html#402341345">(Nov 15 2023 at 22:49)</a>:</h4>
<p>haven't tried it for making requests</p>



<a name="402341445"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20reqwest%20lib%20size/near/402341445" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20reqwest.20lib.20size.html#402341445">(Nov 15 2023 at 22:50)</a>:</h4>
<p>but seems plausible since all we do is <code>List U8</code> anyway!</p>



<a name="402341678"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20reqwest%20lib%20size/near/402341678" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20reqwest.20lib.20size.html#402341678">(Nov 15 2023 at 22:52)</a>:</h4>
<p>Ah, fair. Was thinking that basic CLI would always be single threaded, but it may be truly async with map2</p>



<a name="402342014"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20reqwest%20lib%20size/near/402342014" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20reqwest.20lib.20size.html#402342014">(Nov 15 2023 at 22:55)</a>:</h4>
<p>Also, I think the one called concern with hyper as an http client is that I don't think it deals with tls</p>



<a name="402342151"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20reqwest%20lib%20size/near/402342151" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20reqwest.20lib.20size.html#402342151">(Nov 15 2023 at 22:56)</a>:</h4>
<p>Oh wait, there is <code>hyper-tls</code></p>



<a name="402342203"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20reqwest%20lib%20size/near/402342203" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20reqwest.20lib.20size.html#402342203">(Nov 15 2023 at 22:57)</a>:</h4>
<p>So yeah, looks simple enough to try hyper directly</p>



<a name="402472532"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20reqwest%20lib%20size/near/402472532" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Pearce Keesling <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20reqwest.20lib.20size.html#402472532">(Nov 16 2023 at 13:42)</a>:</h4>
<p>Are platform (in this case rust) features something that's on the table? For example if someone is making a cli that does not use networking they can save lots of binary size.</p>



<a name="402512900"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20reqwest%20lib%20size/near/402512900" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Agus Zubiaga <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20reqwest.20lib.20size.html#402512900">(Nov 16 2023 at 16:47)</a>:</h4>
<p>Maybe linking with <code>—gc-sections</code> is enough?</p>



<a name="402513100"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20reqwest%20lib%20size/near/402513100" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Agus Zubiaga <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20reqwest.20lib.20size.html#402513100">(Nov 16 2023 at 16:48)</a>:</h4>
<p>It’s still nice to have a small http lib for when you do use it, though</p>



<a name="402581125"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20reqwest%20lib%20size/near/402581125" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20reqwest.20lib.20size.html#402581125">(Nov 17 2023 at 00:10)</a>:</h4>
<p>So we totally could do something akin to rust features, but how Roc plans to distribute platforms, this is not really possible. In the Roc model, the entire platform is precompiled and distributed. So having some form of feature selection is not possible unless we either:</p>
<ol>
<li>Stop precompiling platforms</li>
<li>Build a special system to enable opting into compiling a platform locally with certain features disabled</li>
<li>Distribute 2^n binaries for each of the n features a platform has</li>
</ol>



<a name="402581820"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20reqwest%20lib%20size/near/402581820" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20reqwest.20lib.20size.html#402581820">(Nov 17 2023 at 00:16)</a>:</h4>
<p>Also, I'm pretty sure gc-sections won't change anything. We have a reference to the http function and it references another 5MB of code. So nothing for GC sections to do.</p>



<a name="402582795"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20reqwest%20lib%20size/near/402582795" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Elias Mulhall <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20reqwest.20lib.20size.html#402582795">(Nov 17 2023 at 00:23)</a>:</h4>
<p>That is a pickle</p>
<p>Where does the effect interpreter live, is it implemented by hand per-platform?</p>



<a name="402583043"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20reqwest%20lib%20size/near/402583043" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20reqwest.20lib.20size.html#402583043">(Nov 17 2023 at 00:25)</a>:</h4>
<p>Yep. Or it will once we switch to that. Currently, it is technically all generated on the roc side and more adhoc, but that is changing</p>



<a name="402589883"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20reqwest%20lib%20size/near/402589883" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Notification Bot <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20reqwest.20lib.20size.html#402589883">(Nov 17 2023 at 01:04)</a>:</h4>
<p>23 messages were moved here from <a class="stream-topic" data-stream-id="316715" href="/#narrow/stream/316715-contributing/topic/contributor.20coordination.20meeting">#contributing &gt; contributor coordination meeting</a> by <span class="user-mention silent" data-user-id="343810">Brendan Hansknecht</span>.</p>



<a name="402590534"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20reqwest%20lib%20size/near/402590534" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20reqwest.20lib.20size.html#402590534">(Nov 17 2023 at 01:09)</a>:</h4>
<p>Just as a validation test, I made a basically empty rust binary (no roc involved) that uses reqwest to do a get request. That binary is 4.8MB.</p>



<a name="402590684"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20reqwest%20lib%20size/near/402590684" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20reqwest.20lib.20size.html#402590684">(Nov 17 2023 at 01:10)</a>:</h4>
<p>Oh, with lto, it drops to 3.0MB. That's a nice gain.</p>



<a name="402591812"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20reqwest%20lib%20size/near/402591812" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20reqwest.20lib.20size.html#402591812">(Nov 17 2023 at 01:19)</a>:</h4>
<p>Are you still thinking about using hyper? Is that much smaller?</p>



<a name="402592196"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20reqwest%20lib%20size/near/402592196" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20reqwest.20lib.20size.html#402592196">(Nov 17 2023 at 01:22)</a>:</h4>
<p>about to test</p>



<a name="402592238"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20reqwest%20lib%20size/near/402592238" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20reqwest.20lib.20size.html#402592238">(Nov 17 2023 at 01:23)</a>:</h4>
<p>Though I don't expect it to be much smaller, reqwest is just a wrapper for hyper</p>



<a name="402592558"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20reqwest%20lib%20size/near/402592558" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Agus Zubiaga <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20reqwest.20lib.20size.html#402592558">(Nov 17 2023 at 01:25)</a>:</h4>
<p><span class="user-mention silent" data-user-id="343810">Brendan Hansknecht</span> <a href="#narrow/stream/316715-contributing/topic/basic-cli.20reqwest.20lib.20size/near/402581820">said</a>:</p>
<blockquote>
<p>We have a reference to the http function and it references another 5MB of code.</p>
</blockquote>
<p>Even when no Roc code calls the effect function?</p>



<a name="402593193"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20reqwest%20lib%20size/near/402593193" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Agus Zubiaga <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20reqwest.20lib.20size.html#402593193">(Nov 17 2023 at 01:30)</a>:</h4>
<p>I may have a bad understanding of how the platform and app are linked. I thought the platform just exposed C-like functions and roc would generate code that calls them directly. But I guess there’s some sort of switch on effect type that dispatches to the right function?</p>



<a name="402594703"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20reqwest%20lib%20size/near/402594703" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20reqwest.20lib.20size.html#402594703">(Nov 17 2023 at 01:43)</a>:</h4>
<blockquote>
<p>But I guess there’s some sort of switch on effect type that dispatches to the right function?</p>
</blockquote>
<p>Technically it isn't this yet, but it will be in the future. So I would just work under that assumption. Even without this all of the notes on precompilation apply here (plus surgical linking) and clean up is not a simple task.</p>



<a name="402594854"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20reqwest%20lib%20size/near/402594854" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20reqwest.20lib.20size.html#402594854">(Nov 17 2023 at 01:44)</a>:</h4>
<blockquote>
<p>Are you still thinking about using hyper?</p>
</blockquote>
<p>Initial tests with hyper seem promising (but I haven't wired up most of the features), I will try to update the platform as a whole.</p>



<a name="402792854"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20reqwest%20lib%20size/near/402792854" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20reqwest.20lib.20size.html#402792854">(Nov 17 2023 at 22:58)</a>:</h4>
<p>So removing <code>reqwest</code> and directly using <code>hyper</code> saved about 700KB.</p>
<p>Our hello world with basic-cli is now 3.0MB on my linux machine. Of that, I think 2.1MB comes from hyper, tokio, rusttls, etc to support http requests. The other 0.9MB is other libraries and rust code.</p>



<a name="402794149"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20reqwest%20lib%20size/near/402794149" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20reqwest.20lib.20size.html#402794149">(Nov 17 2023 at 23:07)</a>:</h4>
<p>general question, does basic cli need to support http2 for web requests? Given it is just directly requesting webpages and not doing anything with keep alive, I assume that 1 vs 2 shouldn't matter much?</p>
<p>But honestly I don't mess with web that much anymore, so not sure if I am missing something. Removing http2 save another 400KB.</p>



<a name="402798654"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20reqwest%20lib%20size/near/402798654" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20reqwest.20lib.20size.html#402798654">(Nov 17 2023 at 23:49)</a>:</h4>
<p>I am just gonna remove http2 for now. Can be added back in later if someone has an explicit need PR now up: <a href="https://github.com/roc-lang/basic-cli/pull/130">https://github.com/roc-lang/basic-cli/pull/130</a></p>



<a name="402800815"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20reqwest%20lib%20size/near/402800815" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20reqwest.20lib.20size.html#402800815">(Nov 18 2023 at 00:08)</a>:</h4>
<p>Makes sense, this is basic-cli right. That sounds like a good candidate for more-advanced-cli</p>



<a name="403696559"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20reqwest%20lib%20size/near/403696559" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20reqwest.20lib.20size.html#403696559">(Nov 23 2023 at 02:52)</a>:</h4>
<p>hm, this made it into 0.6.0, right? I just saw <a href="https://www.reddit.com/r/ProgrammingLanguages/comments/17zp4m7/comment/ka5akck/">https://www.reddit.com/r/ProgrammingLanguages/comments/17zp4m7/comment/ka5akck/</a> and tried it out locally on macOS; when I build helloWorld.roc (which is using 0.6.0 for its platform) I'm seeing:</p>
<div class="codehilite"><pre><span></span><code>$ du -h helloWorld
 23M    helloWorld
</code></pre></div>
<p>is it a lot smaller on Linux? <span aria-label="thinking" class="emoji emoji-1f914" role="img" title="thinking">:thinking:</span></p>



<a name="403710354"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20reqwest%20lib%20size/near/403710354" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20reqwest.20lib.20size.html#403710354">(Nov 23 2023 at 04:19)</a>:</h4>
<p>Would make sense for Linux to be smaller, when building a binary, rust and friends build something a lot slimmer than for an object file</p>



<a name="403711632"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20reqwest%20lib%20size/near/403711632" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20reqwest.20lib.20size.html#403711632">(Nov 23 2023 at 04:28)</a>:</h4>
<p>Also, have the size can be stripped away, probably debug info. Is basic cli release in debug instead of release for some reason?</p>



<a name="403712009"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20reqwest%20lib%20size/near/403712009" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20reqwest.20lib.20size.html#403712009">(Nov 23 2023 at 04:32)</a>:</h4>
<p>Yeah, pretty sure our basic cli package is a debug build and that is the issue.</p>



<a name="403712075"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20reqwest%20lib%20size/near/403712075" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20reqwest.20lib.20size.html#403712075">(Nov 23 2023 at 04:32)</a>:</h4>
<p>I just built from source with <code>--optimize</code> and it is <code>6.5MB</code> on macos</p>



<a name="403712091"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20reqwest%20lib%20size/near/403712091" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20reqwest.20lib.20size.html#403712091">(Nov 23 2023 at 04:32)</a>:</h4>
<p>yep and debug is <code>23MB</code></p>



<a name="403712128"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20reqwest%20lib%20size/near/403712128" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20reqwest.20lib.20size.html#403712128">(Nov 23 2023 at 04:33)</a>:</h4>
<p>so we need to cut a new package release that is actually an optimized build. That is the root issue.</p>



<a name="403712536"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20reqwest%20lib%20size/near/403712536" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20reqwest.20lib.20size.html#403712536">(Nov 23 2023 at 04:37)</a>:</h4>
<p>As a note, this probably affects basic-webserver as well, so they probably both need to cut a new release that is an optimized build.</p>



<a name="403712673"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20reqwest%20lib%20size/near/403712673" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20reqwest.20lib.20size.html#403712673">(Nov 23 2023 at 04:38)</a>:</h4>
<p>Nice pick up</p>



<a name="403947682"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20reqwest%20lib%20size/near/403947682" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anton <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20reqwest.20lib.20size.html#403947682">(Nov 24 2023 at 11:16)</a>:</h4>
<p>Fixed in <a href="https://github.com/roc-lang/roc/pull/6078">PR#6078</a></p>



<a name="404037896"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20reqwest%20lib%20size/near/404037896" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20reqwest.20lib.20size.html#404037896">(Nov 25 2023 at 00:53)</a>:</h4>
<p><span class="user-mention silent" data-user-id="343810">Brendan Hansknecht</span> <a href="#narrow/stream/316715-contributing/topic/basic-cli.20reqwest.20lib.20size/near/403712075">said</a>:</p>
<blockquote>
<p>I just built from source with <code>--optimize</code> and it is <code>6.5MB</code> on macos</p>
</blockquote>
<p>do you mean using <code>cargo build --release</code> on the <code>basic-cli</code> Rust host?</p>
<p>I tried adding <code>--optimize</code> to <code>roc build</code> on macOS and it didn't make a difference for me <span aria-label="thinking" class="emoji emoji-1f914" role="img" title="thinking">:thinking:</span></p>



<a name="404044086"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20reqwest%20lib%20size/near/404044086" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20reqwest.20lib.20size.html#404044086">(Nov 25 2023 at 01:57)</a>:</h4>
<p><code>roc build --optimize</code> but on an example that will build <code>basic-cli</code> from source which will use <code>--release</code>. this hasn't made it to the url package yet</p>



<a name="404044106"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20reqwest%20lib%20size/near/404044106" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20reqwest.20lib.20size.html#404044106">(Nov 25 2023 at 01:57)</a>:</h4>
<p>Will require a new release with Anton's pr</p>



<a name="404088027"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20reqwest%20lib%20size/near/404088027" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anton <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20reqwest.20lib.20size.html#404088027">(Nov 25 2023 at 09:41)</a>:</h4>
<p>I'll start building 0.6.2 after today's nightlies are up</p>



<a name="404111263"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20reqwest%20lib%20size/near/404111263" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anton <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20reqwest.20lib.20size.html#404111263">(Nov 25 2023 at 13:17)</a>:</h4>
<p><a href="https://github.com/roc-lang/basic-cli/releases/tag/0.6.2">Here it is</a>.</p>



<a name="404283698"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20reqwest%20lib%20size/near/404283698" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20reqwest.20lib.20size.html#404283698">(Nov 26 2023 at 19:26)</a>:</h4>
<p>I can't believe I didn't think of this until just now, but an obvious way to shrink the binary size here is for someone to implement http 1.1 in Roc</p>



<a name="404283718"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20reqwest%20lib%20size/near/404283718" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20reqwest.20lib.20size.html#404283718">(Nov 26 2023 at 19:26)</a>:</h4>
<p>then basic-cli doesn't need any host libraries at all to do http, just tcp (which comes from the OS anyway)</p>



<a name="404283772"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20reqwest%20lib%20size/near/404283772" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20reqwest.20lib.20size.html#404283772">(Nov 26 2023 at 19:27)</a>:</h4>
<p>and any http logic that isn't used by a given roc application will be dead code eliminated anyway!</p>



<a name="404283871"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20reqwest%20lib%20size/near/404283871" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20reqwest.20lib.20size.html#404283871">(Nov 26 2023 at 19:28)</a>:</h4>
<p>http 1.1 is also ridiculously simple (http2 not so much)</p>



<a name="404283885"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20reqwest%20lib%20size/near/404283885" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20reqwest.20lib.20size.html#404283885">(Nov 26 2023 at 19:29)</a>:</h4>
<p>I guess tls would also probably need to be in the host for now</p>



<a name="404283896"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20reqwest%20lib%20size/near/404283896" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20reqwest.20lib.20size.html#404283896">(Nov 26 2023 at 19:29)</a>:</h4>
<p>but I'm not sure how big that is relative to all of <code>hyper</code></p>



<a name="404285225"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20reqwest%20lib%20size/near/404285225" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Carroll <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20reqwest.20lib.20size.html#404285225">(Nov 26 2023 at 19:52)</a>:</h4>
<p>I wrote a HTTP 1.1 parser in Roc and it's in the repo already. Could be something to build on.</p>
<p><a href="https://github.com/roc-lang/roc/blob/main/examples/parser/Parser/Http.roc">https://github.com/roc-lang/roc/blob/main/examples/parser/Parser/Http.roc</a></p>



<a name="404286484"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20reqwest%20lib%20size/near/404286484" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Pearce Keesling <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20reqwest.20lib.20size.html#404286484">(Nov 26 2023 at 20:12)</a>:</h4>
<p>Is dynamic linking an option for something like tls? Or do platforms need to be totally static?</p>



<a name="404287540"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20reqwest%20lib%20size/near/404287540" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20reqwest.20lib.20size.html#404287540">(Nov 26 2023 at 20:28)</a>:</h4>
<p>they don't need to be, but I think static is the best user experience for end users of the compiled program! <span aria-label="big smile" class="emoji emoji-1f604" role="img" title="big smile">:big_smile:</span></p>



<a name="404290298"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20reqwest%20lib%20size/near/404290298" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20reqwest.20lib.20size.html#404290298">(Nov 26 2023 at 21:04)</a>:</h4>
<p>I think about 1-2MB of the 5MB of extra size is from rustls. Most of the rest is from hyper and Tokio. If we build own on http on top of the current tcp I'm not sure exactly how much we will gain. Also, if we later switch to async tcp, that might readd a lot of the costs from Tokio.</p>



<a name="404294089"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20reqwest%20lib%20size/near/404294089" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20reqwest.20lib.20size.html#404294089">(Nov 26 2023 at 22:03)</a>:</h4>
<p>interesting, good to know!</p>



<a name="404297084"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20reqwest%20lib%20size/near/404297084" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20reqwest.20lib.20size.html#404297084">(Nov 26 2023 at 22:54)</a>:</h4>
<p>a little off topic, but I was reading about some of the developments with WASM runtimes, and it seems a lot of these primitives are being developed into these runtimes pretty quickly, so I don't think it will be long and I can imagine a Roc platform that is almost zero overhead and provides a lot of functionality. See interface proposals like <a href="https://github.com/WebAssembly/wasi-http">wasm-http</a> and <a href="https://github.com/WebAssembly/wasi-filesystem">wasi-filesystem</a>. I'm keen to work on something like this, but maybe that is a Post-AoC thing.</p>



<a name="404297349"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/basic-cli%20reqwest%20lib%20size/near/404297349" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/basic-cli.20reqwest.20lib.20size.html#404297349">(Nov 26 2023 at 22:59)</a>:</h4>
<p>I mean on the order of the next few years*</p>



<hr><p>Last updated: Mar 01 2026 at 12:20 UTC</p>
</html>