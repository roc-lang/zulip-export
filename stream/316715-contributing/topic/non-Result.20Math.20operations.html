<html>
<head><meta charset="utf-8"><title>non-Result Math operations · contributing · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/index.html">contributing</a></h2>
<h3>Topic: <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/non-Result.20Math.20operations.html">non-Result Math operations</a></h3>

<hr>

<base href="https://roc.zulipchat.com">

<head><link href="https://roc-lang.github.io/zulip-export/style.css" rel="stylesheet"></head>

<a name="278474999"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/non-Result%20Math%20operations/near/278474999" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nikita Mounier <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/non-Result.20Math.20operations.html#278474999">(Apr 10 2022 at 15:52)</a>:</h4>
<p>Hi everyone!<br>
<span class="user-mention" data-user-id="483789">@Kevin Gillette</span> and I are going to work on making math operations no longer return <code>Result</code>. Specifically, these functions are: <code>div</code>, <code>divFloor</code>, <code>divCeil</code>, <code>mod</code>, <code>rem</code>, <code>log</code>, and <code>sqrt</code>. <br>
Here's the corresponding GitHub issue: <a href="https://github.com/rtfeldman/roc/issues/2826">https://github.com/rtfeldman/roc/issues/2826</a></p>



<a name="278475037"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/non-Result%20Math%20operations/near/278475037" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Kevin Gillette <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/non-Result.20Math.20operations.html#278475037">(Apr 10 2022 at 15:53)</a>:</h4>
<p><span class="user-mention" data-user-id="492598">@Nikita Mounier</span> so we can divide work, which functions are you considering to be div-related?</p>



<a name="278475125"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/non-Result%20Math%20operations/near/278475125" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nikita Mounier <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/non-Result.20Math.20operations.html#278475125">(Apr 10 2022 at 15:55)</a>:</h4>
<p>Sorry you're right, I meant <code>div</code>, <code>divFloor</code>, and <code>divCeil</code>. It's true that <code>mod</code> and <code>rem</code> are also division-related.</p>



<a name="278475138"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/non-Result%20Math%20operations/near/278475138" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nikita Mounier <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/non-Result.20Math.20operations.html#278475138">(Apr 10 2022 at 15:55)</a>:</h4>
<blockquote>
<p>so we can divide work</p>
</blockquote>
<p>I see what you did there</p>



<a name="278475195"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/non-Result%20Math%20operations/near/278475195" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Kevin Gillette <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/non-Result.20Math.20operations.html#278475195">(Apr 10 2022 at 15:56)</a>:</h4>
<p>Yes, I <em>completely</em> meant that as a joke. That I thought about ahead of time. Indeed.</p>



<a name="278475300"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/non-Result%20Math%20operations/near/278475300" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Kevin Gillette <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/non-Result.20Math.20operations.html#278475300">(Apr 10 2022 at 15:58)</a>:</h4>
<p>Okay, sounds good. So you'll handle <code>div</code>, <code>divFloor</code>, and <code>divCeil</code>, and I'll handle <code>mod</code>, <code>rem</code>, <code>log</code>, and <code>sqrt</code>?</p>
<p>Are you planning to rename the existing functions to <code>divChecked</code> and so on, per <a href="https://github.com/rtfeldman/roc/issues/2826#issuecomment-1094166537">https://github.com/rtfeldman/roc/issues/2826#issuecomment-1094166537</a>, and then produce panicking versions using the original versions?</p>



<a name="278475616"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/non-Result%20Math%20operations/near/278475616" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nikita Mounier <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/non-Result.20Math.20operations.html#278475616">(Apr 10 2022 at 16:05)</a>:</h4>
<p>Sure, if everyone else is cool with that.</p>



<a name="278475675"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/non-Result%20Math%20operations/near/278475675" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nikita Mounier <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/non-Result.20Math.20operations.html#278475675">(Apr 10 2022 at 16:06)</a>:</h4>
<p>Should the panic be at the zig level (using the `@panic("...") builtin function I saw elsewhere?</p>



<a name="278475797"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/non-Result%20Math%20operations/near/278475797" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nikita Mounier <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/non-Result.20Math.20operations.html#278475797">(Apr 10 2022 at 16:09)</a>:</h4>
<p><a href="https://github.com/rtfeldman/roc/blob/trunk/compiler/builtins/bitcode/src/dec.zig#L312-L316">This is how</a> the <code>div</code> function inside <code>builtins/bitcode/src/dec.zig</code> handles denominators equal to 0:</p>
<div class="codehilite" data-code-language="CoffeeScript"><pre><span></span><code><span class="k">if</span> <span class="p">(</span><span class="nx">denominator_i128</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
    <span class="o">//</span> <span class="nx">The</span> <span class="nx">compiler</span> <span class="nx">frontend</span> <span class="nx">does</span> <span class="nx">the</span> <span class="o">`</span><span class="nx">denominator</span> <span class="o">==</span> <span class="mi">0</span><span class="o">`</span> <span class="nx">check</span> <span class="k">for</span> <span class="nx">us</span><span class="p">,</span>
    <span class="o">//</span> <span class="nx">therefore</span> <span class="k">this</span> <span class="nx">case</span> <span class="o">is</span> <span class="nx">unreachable</span> <span class="nx">from</span> <span class="nx">roc</span> <span class="nx">user</span> <span class="nx">code</span>
    <span class="nx">unreachable</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<p>So should I remove the compiler frontend check and instead have zig panic? Or should the panic be higher up?</p>



<a name="278475878"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/non-Result%20Math%20operations/near/278475878" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/non-Result.20Math.20operations.html#278475878">(Apr 10 2022 at 16:11)</a>:</h4>
<p>no a zig panic is quite different</p>



<a name="278475952"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/non-Result%20Math%20operations/near/278475952" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/non-Result.20Math.20operations.html#278475952">(Apr 10 2022 at 16:12)</a>:</h4>
<p>oh, actually</p>



<a name="278475956"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/non-Result%20Math%20operations/near/278475956" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/non-Result.20Math.20operations.html#278475956">(Apr 10 2022 at 16:12)</a>:</h4>
<p>we overload zig's <code>@panic</code> with our <code>roc_panic</code></p>



<a name="278475961"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/non-Result%20Math%20operations/near/278475961" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/non-Result.20Math.20operations.html#278475961">(Apr 10 2022 at 16:13)</a>:</h4>
<p>so I guess indeed you can do a <code>@panic("some message")</code> there</p>



<a name="278475970"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/non-Result%20Math%20operations/near/278475970" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nikita Mounier <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/non-Result.20Math.20operations.html#278475970">(Apr 10 2022 at 16:13)</a>:</h4>
<p>Right, I saw <code>@panic</code> being used for overflow which feels similar to dividing by 0. Cool!</p>



<a name="278476019"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/non-Result%20Math%20operations/near/278476019" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Kevin Gillette <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/non-Result.20Math.20operations.html#278476019">(Apr 10 2022 at 16:14)</a>:</h4>
<p>Okay, so an <code>@panic</code> in Zig will compile to a <code>roc_panic</code> call?</p>



<a name="278476025"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/non-Result%20Math%20operations/near/278476025" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nikita Mounier <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/non-Result.20Math.20operations.html#278476025">(Apr 10 2022 at 16:14)</a>:</h4>
<p>Could you point me to the directory where the compiler frontend would do the <code>denominator == 0</code> check? I'm still not super familiar with the codebase structure</p>



<a name="278476144"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/non-Result%20Math%20operations/near/278476144" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ayaz Hafiz <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/non-Result.20Math.20operations.html#278476144">(Apr 10 2022 at 16:16)</a>:</h4>
<p>here's an example <a href="https://github.com/rtfeldman/roc/blob/e477813be41eed53a8df6e517fbbae8d01088dee/compiler/can/src/builtins.rs#L4298-L4362">https://github.com/rtfeldman/roc/blob/e477813be41eed53a8df6e517fbbae8d01088dee/compiler/can/src/builtins.rs#L4298-L4362</a></p>



<a name="278476162"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/non-Result%20Math%20operations/near/278476162" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nikita Mounier <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/non-Result.20Math.20operations.html#278476162">(Apr 10 2022 at 16:17)</a>:</h4>
<blockquote>
<p>Okay, so an <code>@panic</code> in Zig will compile to a <code>roc_panic</code> call?</p>
</blockquote>
<p>Looks like it</p>



<a name="278476169"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/non-Result%20Math%20operations/near/278476169" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nikita Mounier <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/non-Result.20Math.20operations.html#278476169">(Apr 10 2022 at 16:17)</a>:</h4>
<p>Great, that's what I was looking for. Thanks!</p>



<a name="278476947"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/non-Result%20Math%20operations/near/278476947" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Kevin Gillette <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/non-Result.20Math.20operations.html#278476947">(Apr 10 2022 at 16:31)</a>:</h4>
<p>What are people's thoughts about the wording of the panics. It looks like all <code>@panic</code> calls within latest trunk start with the word "TODO". It also doesn't look like there are any explicit panics for integer overflow to reference (are those handled by rust/zig intrinsics)?</p>



<a name="278477128"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/non-Result%20Math%20operations/near/278477128" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Kevin Gillette <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/non-Result.20Math.20operations.html#278477128">(Apr 10 2022 at 16:34)</a>:</h4>
<p>Oh, I see. It's handled via <code>throw_on_overflow</code></p>



<a name="278478405"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/non-Result%20Math%20operations/near/278478405" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nikita Mounier <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/non-Result.20Math.20operations.html#278478405">(Apr 10 2022 at 17:00)</a>:</h4>
<p>Btw it might be a good idea if we were to both put all the checked variants inside <a href="https://github.com/rtfeldman/roc/blob/e477813be41eed53a8df6e517fbbae8d01088dee/compiler/module/src/symbol.rs#L908-L1059"><code>compiler/module/src/symbol.rs</code></a>, where all the symbols are listed in a macro with a number followed by its name followed by the corresponding function. <br>
For instance, there's:</p>
<div class="codehilite" data-code-language="CoffeeScript"><pre><span></span><code><span class="mi">39</span> <span class="nv">NUM_DIV_FLOAT: </span><span class="s">"div"</span>
<span class="mi">40</span> <span class="nv">NUM_DIV_INT: </span><span class="s">"divFloor"</span>
</code></pre></div>
<p>Which we'd want to turn into:</p>
<div class="codehilite" data-code-language="CoffeeScript"><pre><span></span><code><span class="mi">39</span> <span class="nv">NUM_DIV_FLOAT: </span><span class="s">"div"</span>
<span class="mi">40</span> <span class="nv">NUM_DIV_FLOAT_CHECKED: </span><span class="s">"divChecked"</span>
<span class="mi">41</span> <span class="nv">NUM_DIV_INT: </span><span class="s">"divFloor"</span>
<span class="mi">42</span> <span class="nv">NUM_DIV_INT_CHECKED: </span><span class="s">"divFloorChecked"</span>
</code></pre></div>
<p>Since we gotta offset the number on the left each time we add a new symbol, we might get some nasty merge conflicts if we don't take each others' checked functions into account. Do you see where I'm coming from?</p>



<a name="278478868"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/non-Result%20Math%20operations/near/278478868" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/non-Result.20Math.20operations.html#278478868">(Apr 10 2022 at 17:09)</a>:</h4>
<p>that's hard to prevent</p>



<a name="278478909"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/non-Result%20Math%20operations/near/278478909" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/non-Result.20Math.20operations.html#278478909">(Apr 10 2022 at 17:10)</a>:</h4>
<p>because there cannot be gaps in those lists</p>



<a name="278479101"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/non-Result%20Math%20operations/near/278479101" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Kevin Gillette <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/non-Result.20Math.20operations.html#278479101">(Apr 10 2022 at 17:14)</a>:</h4>
<p>I follow. I'm reading through <code>compiler/builtins/README.md</code> now.</p>
<p>Side note: are the integers critical for humans to manage (is there any bespoke "42ness" to "42"), or does other human-managed code refer to the ID by number instead of symbol? At some point could those integer identifiers by assigned by position, thus minimizing conflicts?</p>



<a name="278479412"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/non-Result%20Math%20operations/near/278479412" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nikita Mounier <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/non-Result.20Math.20operations.html#278479412">(Apr 10 2022 at 17:20)</a>:</h4>
<p>Here, I've created a gist with the symbol list so that you don't need to go through the same time-consuming process: <a href="https://gist.github.com/nikitamounier/776a49dfc84d07347d7669b80775c030">https://gist.github.com/nikitamounier/776a49dfc84d07347d7669b80775c030</a></p>



<a name="278479423"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/non-Result%20Math%20operations/near/278479423" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nikita Mounier <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/non-Result.20Math.20operations.html#278479423">(Apr 10 2022 at 17:20)</a>:</h4>
<p>Lmk if there's anything missing or if you notice any gaps</p>



<a name="278480471"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/non-Result%20Math%20operations/near/278480471" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Kevin Gillette <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/non-Result.20Math.20operations.html#278480471">(Apr 10 2022 at 17:40)</a>:</h4>
<p>Thanks! I've got some stuff to take care of over the next several hours, so it sounds like you may well have code I can reference (or at least will touch relevant files before I do).</p>
<p>Something that's not entirely clear to me at this time: why do some operations have <code>_INT</code> or <code>_FLOAT</code> suffices? <code>NUM_DIV_INT</code> makes sense to me, given that it is, iirc, a separate operator, but <code>NUM_MOD_INT</code> vs <code>NUM_MOD_FLOAT</code> is not clear to me given that <code>NUM_REM</code> has no such variants.</p>



<a name="278482579"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/non-Result%20Math%20operations/near/278482579" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nikita Mounier <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/non-Result.20Math.20operations.html#278482579">(Apr 10 2022 at 18:25)</a>:</h4>
<blockquote>
<p>Thanks! I've got some stuff to take care of over the next several hours, so it sounds like you may well have code I can reference (or at least will touch relevant files before I do).</p>
</blockquote>
<p>Sure! I can already tell you that some of the files you'll want to modify are <code>compiler/builtins/roc/Num.roc</code>, <code>compiler/builtins/bitcode/src/num.zig</code>, <code>compiler/builtins/bitcode/src/dec.zig</code>, <code>compiler/can/src/builtins.rs</code>, <code>compiler/module/src/low_level.rs</code>, <code>compiler/module/src/symbol.rs</code>, and <code>compiler/builtins/src/std.rs</code></p>



<a name="278483884"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/non-Result%20Math%20operations/near/278483884" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nikita Mounier <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/non-Result.20Math.20operations.html#278483884">(Apr 10 2022 at 18:57)</a>:</h4>
<p>There's one thing I'm slightly confused by, if anyone could give me some context. From <a href="https://github.com/rtfeldman/roc/blob/trunk/compiler/module/src/symbol.rs#L949"><code>compiler/module/src/symbol.rs</code></a>, <code>divFloor</code> is associated to the symbol <code>NUM_DIV_INT</code>. However, in <a href="https://github.com/rtfeldman/roc/blob/trunk/compiler/can/src/builtins.rs#L198"><code>compiler/can/src/builtins.src</code></a>,  <code>NUM_DIV_INT</code> is associated to the <code>num_div_int</code> function, which, in the <a href="https://github.com/rtfeldman/roc/blob/trunk/compiler/can/src/builtins.rs#L4403-L4410">branch where the denominator is not equal to 0</a>, is identical to <code>num_div_float</code>'s success branch. What's weirder, the comment above <code>num_div_int</code> defines it as:</p>
<div class="codehilite" data-code-language="CoffeeScript"><pre><span></span><code><span class="sr">/// Num.div : Int a , Int a -&gt; Result (Int a) [ DivByZero ]*</span>
</code></pre></div>
<p>Instead of what should logically be:</p>
<div class="codehilite" data-code-language="CoffeeScript"><pre><span></span><code><span class="sr">/// Num.divFloor: Int a , Int a -&gt; Result (Int a) [ DivByZero ]*</span>
</code></pre></div>
<p>Any idea what I'm missing here?</p>



<a name="278484170"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/non-Result%20Math%20operations/near/278484170" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nikita Mounier <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/non-Result.20Math.20operations.html#278484170">(Apr 10 2022 at 19:02)</a>:</h4>
<p><span class="user-mention silent" data-user-id="483789">Kevin Gillette</span> <a href="#narrow/stream/316715-contributing/topic/non-Result.20Math.20operations/near/278480471">said</a>:</p>
<blockquote>
<p><code>NUM_DIV_INT</code> makes sense to me, given that it is, iirc, a separate operator, but <code>NUM_MOD_INT</code> vs <code>NUM_MOD_FLOAT</code> is not clear to me given that <code>NUM_REM</code> has no such variants.</p>
</blockquote>
<p>IIRC, modulus for integer and modulus for floats works quite differently. For instance, C++ has <code>%</code> for integer modulus and <code>fmod</code> for floating-point modulus. Most newer languages unified the two though, even though the implementation works differently under the hood whether it's integer or float.</p>



<a name="278484871"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/non-Result%20Math%20operations/near/278484871" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/non-Result.20Math.20operations.html#278484871">(Apr 10 2022 at 19:16)</a>:</h4>
<p>I haven't looked at it, but their is a chance that float div is just a generic llvm division and not actually specific to floating point, thus int can call it</p>



<a name="278484879"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/non-Result%20Math%20operations/near/278484879" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/non-Result.20Math.20operations.html#278484879">(Apr 10 2022 at 19:16)</a>:</h4>
<p>Also, I think our modulus only works with ints.</p>



<a name="278485061"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/non-Result%20Math%20operations/near/278485061" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/non-Result.20Math.20operations.html#278485061">(Apr 10 2022 at 19:20)</a>:</h4>
<p>Also int division is like normal int division in other languages where it is not a floor. It also goes towards zero. Floor goes towards -infinity</p>



<a name="278485243"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/non-Result%20Math%20operations/near/278485243" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nikita Mounier <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/non-Result.20Math.20operations.html#278485243">(Apr 10 2022 at 19:24)</a>:</h4>
<p><span class="user-mention silent" data-user-id="343810">Brendan Hansknecht</span> <a href="#narrow/stream/316715-contributing/topic/non-Result.20Math.20operations/near/278485061">said</a>:</p>
<blockquote>
<p>Also int division is like normal int division in other languages where it is not a floor. It also goes towards zero. Floor goes towards -infinity</p>
</blockquote>
<p>Got it. So why is <code>NUM_DIV_INT</code> associated to <code>"divFloor"</code> here? <a href="https://github.com/rtfeldman/roc/blob/trunk/compiler/module/src/symbol.rs#L949">https://github.com/rtfeldman/roc/blob/trunk/compiler/module/src/symbol.rs#L949</a></p>



<a name="278486073"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/non-Result%20Math%20operations/near/278486073" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Kevin Gillette <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/non-Result.20Math.20operations.html#278486073">(Apr 10 2022 at 19:41)</a>:</h4>
<p><span class="user-mention" data-user-id="492598">@Nikita Mounier</span> my guess is that this is the difference between the <code>/</code> operator (floating point division) and the <code>//</code> operator (flooring division).</p>



<a name="278487420"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/non-Result%20Math%20operations/near/278487420" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/non-Result.20Math.20operations.html#278487420">(Apr 10 2022 at 20:12)</a>:</h4>
<blockquote>
<p>Got it. So why is <code>NUM_DIV_INT</code> associated to <code>"divFloor"</code> here?</p>
</blockquote>
<p>Bug? Differing opinion around rounding direction? <span aria-label="shrug" class="emoji emoji-1f937" role="img" title="shrug">:shrug:</span> <br>
Probably just wasn't thought about.</p>



<a name="278487448"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/non-Result%20Math%20operations/near/278487448" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/non-Result.20Math.20operations.html#278487448">(Apr 10 2022 at 20:13)</a>:</h4>
<p>A lot of the symbols were added just to give standard features, they may not be fully correct/thought through. For example, we recently had a large discussion about bit shifting</p>



<a name="278495449"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/non-Result%20Math%20operations/near/278495449" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nikita Mounier <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/non-Result.20Math.20operations.html#278495449">(Apr 10 2022 at 23:31)</a>:</h4>
<p>Alrighty, I've made a WIP pull request, let me know what you think:<br>
<a href="https://github.com/rtfeldman/roc/pull/2832">https://github.com/rtfeldman/roc/pull/2832</a></p>



<a name="278601325"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/non-Result%20Math%20operations/near/278601325" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nikita Mounier <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/non-Result.20Math.20operations.html#278601325">(Apr 11 2022 at 18:59)</a>:</h4>
<p>I'm not sure I fully understand <a href="https://github.com/rtfeldman/roc/runs/5977398384?check_suite_focus=true#step:4:2891">the test error CI is giving me</a> about <code>f64</code> not implementing <code>PartialEq&lt;{integer}</code>.  What do you think?</p>



<a name="278601672"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/non-Result%20Math%20operations/near/278601672" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ayaz Hafiz <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/non-Result.20Math.20operations.html#278601672">(Apr 11 2022 at 19:01)</a>:</h4>
<p>In Rust, you can't compare two floats via equality</p>



<a name="278601782"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/non-Result%20Math%20operations/near/278601782" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ayaz Hafiz <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/non-Result.20Math.20operations.html#278601782">(Apr 11 2022 at 19:02)</a>:</h4>
<p>oh wait nvm that's not it</p>



<a name="278601897"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/non-Result%20Math%20operations/near/278601897" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ayaz Hafiz <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/non-Result.20Math.20operations.html#278601897">(Apr 11 2022 at 19:03)</a>:</h4>
<p>Try making it <code>-1.0</code> rather than <code>-1</code> in the test. I think otherwise Rust infers it to be an integer</p>



<a name="278606571"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/non-Result%20Math%20operations/near/278606571" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nikita Mounier <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/non-Result.20Math.20operations.html#278606571">(Apr 11 2022 at 19:44)</a>:</h4>
<p>Yeah you're probably right. Let's see what CI says...</p>



<a name="278642993"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/non-Result%20Math%20operations/near/278642993" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Kevin Gillette <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/non-Result.20Math.20operations.html#278642993">(Apr 12 2022 at 03:04)</a>:</h4>
<p><span class="user-mention silent" data-user-id="343810">Brendan Hansknecht</span> <a href="#narrow/stream/316715-contributing/topic/non-Result.20Math.20operations/near/278484879">said</a>:</p>
<blockquote>
<p>Also, I think our modulus only works with ints.</p>
</blockquote>
<p>Direction-wise, is this the design intent, or something we intend to change? As I'm working on a PR to handle make mod panic, I might as well either get rid of float mod, or alternatively look into implementing it for floats (or at least add clarifying comments in the code) depending on the answer to this question.</p>



<a name="278647185"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/non-Result%20Math%20operations/near/278647185" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Kevin Gillette <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/non-Result.20Math.20operations.html#278647185">(Apr 12 2022 at 04:28)</a>:</h4>
<p>A bit more clarity needed: <code>%</code> and <code>%%</code> each appear to inconsistently be referred to as <code>mod</code> and <code>rem</code>/<code>modFloor</code>.</p>
<div class="codehilite"><pre><span></span><code>| `a % b`           | `Num.rem a b`    |
| `a %% b`          | `Num.mod a b`    |
</code></pre></div>
<p><a href="https://github.com/rtfeldman/roc/blob/a7c37a4b7a635cb6122234f67d03669d71c87c09/TUTORIAL.md?plain=1#L1946-L1947">https://github.com/rtfeldman/roc/blob/a7c37a4b7a635cb6122234f67d03669d71c87c09/TUTORIAL.md?plain=1#L1946-L1947</a></p>
<hr>
<div class="codehilite"><pre><span></span><code>`a % b` is shorthand for `Num.mod a b`.
</code></pre></div>
<p><a href="https://github.com/rtfeldman/roc/blob/a7c37a4b7a635cb6122234f67d03669d71c87c09/compiler/builtins/docs/Num.roc#L1104">https://github.com/rtfeldman/roc/blob/a7c37a4b7a635cb6122234f67d03669d71c87c09/compiler/builtins/docs/Num.roc#L1104</a></p>
<hr>
<div class="codehilite"><pre><span></span><code>`a %% b` is shorthand for `Int.modFloor a b`.
</code></pre></div>
<p><a href="https://github.com/rtfeldman/roc/blob/a7c37a4b7a635cb6122234f67d03669d71c87c09/compiler/builtins/docs/Num.roc#L818">https://github.com/rtfeldman/roc/blob/a7c37a4b7a635cb6122234f67d03669d71c87c09/compiler/builtins/docs/Num.roc#L818</a></p>
<hr>
<p>iiuc, the primary difference between integer <code>rem</code> and <code>mod</code> is in the handling of negative operands. Is that Roc's interpretation as well? What then is the intended behavior of <code>modFloor</code> as defined on integers (should it be called <code>mod</code> or <code>rem</code> instead)? And which operator is truly meant to correspond to which named function?</p>



<a name="278707648"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/non-Result%20Math%20operations/near/278707648" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/non-Result.20Math.20operations.html#278707648">(Apr 12 2022 at 15:14)</a>:</h4>
<blockquote>
<p>Direction-wise, is this the design intent, or something we intend to change? </p>
</blockquote>
<p>Mostly my assumption that could be wrong. I personally don't think it should work with floats. They can produce quite surprising results when you use mod due to their inaccuracies. I think that in many languages, <code>%</code> doesn't work with float types, but they still have an explicity <code>fmod</code> function somewhere in the standard library.</p>



<a name="278717002"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/non-Result%20Math%20operations/near/278717002" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nikita Mounier <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/non-Result.20Math.20operations.html#278717002">(Apr 12 2022 at 16:25)</a>:</h4>
<p>Hmmmmm, I'm getting a very weird test failure:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">fn</span> <span class="nf">gen_div_checked_by_zero_dec</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="n">assert_evals_to</span><span class="o">!</span><span class="p">(</span><span class="w"></span>
<span class="w">        </span><span class="n">indoc</span><span class="o">!</span><span class="p">(</span><span class="w"></span>
<span class="w">            </span><span class="s">r#"</span>
<span class="s">                    x : Dec</span>
<span class="s">                    x = 10</span>

<span class="s">                    y : Dec</span>
<span class="s">                    y = 0</span>

<span class="s">                    when Num.divChecked x y is</span>
<span class="s">                        Ok val -&gt; val</span>
<span class="s">                        Err _ -&gt; -1</span>
<span class="s">                "#</span><span class="w"></span>
<span class="w">        </span><span class="p">),</span><span class="w"></span>
<span class="w">        </span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="kt">i128</span><span class="w"></span>
<span class="w">    </span><span class="p">);</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>
<p>CI says it's returning <code>-1000000000000000000</code> instead of <code>-1</code>. Any idea why that could be happening?</p>



<a name="278717309"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/non-Result%20Math%20operations/near/278717309" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/non-Result.20Math.20operations.html#278717309">(Apr 12 2022 at 16:27)</a>:</h4>
<p>A dec is an int value times <code>10^-18</code></p>



<a name="278717385"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/non-Result%20Math%20operations/near/278717385" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/non-Result.20Math.20operations.html#278717385">(Apr 12 2022 at 16:28)</a>:</h4>
<p>In rust you are viewing the raw dec value, so it it <code>10^18</code> times bigger than you expect.</p>



<a name="278717963"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/non-Result%20Math%20operations/near/278717963" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nikita Mounier <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/non-Result.20Math.20operations.html#278717963">(Apr 12 2022 at 16:33)</a>:</h4>
<p>I see – should I replace <code>-1</code> with something like <code>RocDec::from_str_to_i128_unsafe("-1")</code> then?</p>



<a name="278718046"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/non-Result%20Math%20operations/near/278718046" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/non-Result.20Math.20operations.html#278718046">(Apr 12 2022 at 16:33)</a>:</h4>
<p>Yeah, that or the explicit value. I would just follow whatever other dec tests do.</p>



<a name="278718377"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/non-Result%20Math%20operations/near/278718377" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nikita Mounier <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/non-Result.20Math.20operations.html#278718377">(Apr 12 2022 at 16:36)</a>:</h4>
<p>Yeah, the other dec tests do <code>RocDec::from_str_to_i128_unsafe</code> so I'll just stick with that. Thanks!</p>



<a name="278723608"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/non-Result%20Math%20operations/near/278723608" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/non-Result.20Math.20operations.html#278723608">(Apr 12 2022 at 17:16)</a>:</h4>
<p>I spent a bunch of time looking into remainder and mod at some point; let me look some things up to refresh my memory on the subject <span aria-label="big smile" class="emoji emoji-1f604" role="img" title="big smile">:big_smile:</span></p>



<a name="278723927"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/non-Result%20Math%20operations/near/278723927" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/non-Result.20Math.20operations.html#278723927">(Apr 12 2022 at 17:19)</a>:</h4>
<p>so one of my goals for Roc in general is to try to have the "performance ceiling" be as high as possible without breaking referential transparency or memory safety. That is, try to make there be <em>some</em> way to get the fastest combination of machine instructions into the binary, so that if you find that your Roc program isn't running fast enough, you have <em>some</em> way to solve that problem - even if it involves writing code in a way you normally wouldn't</p>



<a name="278724074"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/non-Result%20Math%20operations/near/278724074" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/non-Result.20Math.20operations.html#278724074">(Apr 12 2022 at 17:20)</a>:</h4>
<p>that goal guides builtin design; for example, if the CPU supports a particular arithmetic operation (like float mod), by default I want to expose that as a primitive so that if someone really needs that for their particular use case to run fast, they have access to it</p>



<a name="278724138"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/non-Result%20Math%20operations/near/278724138" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/non-Result.20Math.20operations.html#278724138">(Apr 12 2022 at 17:20)</a>:</h4>
<p>because if the operation isn't an effect and isn't exposed in the builtins, there's really no other way to access it</p>



<a name="278724340"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/non-Result%20Math%20operations/near/278724340" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/non-Result.20Math.20operations.html#278724340">(Apr 12 2022 at 17:22)</a>:</h4>
<p>so if mod didn't accept <code>Num</code>, then I'd want to have a separate <code>modFloat</code> that only works on floats...which maybe is fine, if mod on floats is indeed a footgun, but it would have the downside that you could no longer do mod on floats using an infix operator, so I'd want to learn more about that before splitting one function into two! <span aria-label="big smile" class="emoji emoji-1f604" role="img" title="big smile">:big_smile:</span></p>



<a name="278726308"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/non-Result%20Math%20operations/near/278726308" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/non-Result.20Math.20operations.html#278726308">(Apr 12 2022 at 17:37)</a>:</h4>
<p>ok, looking it up, it appears that there actually is no CPU instruction for modulo or remainder for floats, so let's drop that operation for now <span aria-label="thumbs up" class="emoji emoji-1f44d" role="img" title="thumbs up">:thumbs_up:</span> - we can revisit adding it again in the future if there's demand, and discuss the pros/cons then</p>



<a name="278726467"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/non-Result%20Math%20operations/near/278726467" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/non-Result.20Math.20operations.html#278726467">(Apr 12 2022 at 17:38)</a>:</h4>
<p>so basically:</p>
<ul>
<li>let's change <code>rem</code> to <code>Num.rem : Int a, Int a -&gt; Int a</code> and then also have a <code>Num.remChecked : Int a, Int a -&gt; Result (Int a) [ DivByZero ]*</code></li>
<li>let's delete all mentions of <code>%%</code> and <code>modFloor</code> in the docs</li>
</ul>



<a name="278726481"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/non-Result%20Math%20operations/near/278726481" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/non-Result.20Math.20operations.html#278726481">(Apr 12 2022 at 17:38)</a>:</h4>
<p>sound good?</p>



<a name="278736569"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/non-Result%20Math%20operations/near/278736569" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nikita Mounier <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/non-Result.20Math.20operations.html#278736569">(Apr 12 2022 at 18:51)</a>:</h4>
<p>All tests passed <span aria-label="tada" class="emoji emoji-1f389" role="img" title="tada">:tada:</span><span aria-label="tada" class="emoji emoji-1f389" role="img" title="tada">:tada:</span><span aria-label="champagne" class="emoji emoji-1f37e" role="img" title="champagne">:champagne:</span>!</p>



<a name="278736798"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/non-Result%20Math%20operations/near/278736798" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nikita Mounier <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/non-Result.20Math.20operations.html#278736798">(Apr 12 2022 at 18:53)</a>:</h4>
<p>Now I can take off the [WIP] from my PR <span aria-label="sunglasses" class="emoji emoji-1f60e" role="img" title="sunglasses">:sunglasses:</span></p>



<a name="278736855"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/non-Result%20Math%20operations/near/278736855" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nikita Mounier <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/non-Result.20Math.20operations.html#278736855">(Apr 12 2022 at 18:53)</a>:</h4>
<p>I'll make the necessary changes to the documentation, then I think it's ready to merge...</p>



<a name="278738000"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/non-Result%20Math%20operations/near/278738000" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nikita Mounier <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/non-Result.20Math.20operations.html#278738000">(Apr 12 2022 at 19:01)</a>:</h4>
<p>Actually looks like there's nothing else to change in the docs! Merge away</p>



<a name="278752844"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/non-Result%20Math%20operations/near/278752844" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Kevin Gillette <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/non-Result.20Math.20operations.html#278752844">(Apr 12 2022 at 21:02)</a>:</h4>
<p><span class="user-mention" data-user-id="281383">@Richard Feldman</span> so that means Roc will no longer have an <code>%%</code> operator? <code>%</code> will desugar to <code>Num.rem</code>, and <code>Num.mod</code> is only available by name?</p>



<a name="278752988"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/non-Result%20Math%20operations/near/278752988" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/non-Result.20Math.20operations.html#278752988">(Apr 12 2022 at 21:04)</a>:</h4>
<p>right!</p>



<a name="278760141"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/non-Result%20Math%20operations/near/278760141" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jared Cone <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/non-Result.20Math.20operations.html#278760141">(Apr 12 2022 at 22:06)</a>:</h4>
<p>Just wanted to mention some inconsistency that <code>/</code> does float division and <code>//</code> does integer division, but <code>%</code> does int remainder with this proposal?</p>



<a name="278762112"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/non-Result%20Math%20operations/near/278762112" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/non-Result.20Math.20operations.html#278762112">(Apr 12 2022 at 22:28)</a>:</h4>
<p>Just wondering, does <code>/</code> ever cast int to floats, or is it always float division with float inputs. If it never casts, can't we just have <code>/</code> for both float and int division. It will just fail to type check if you use and int with a float?</p>



<a name="278766567"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/non-Result%20Math%20operations/near/278766567" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Kevin Gillette <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/non-Result.20Math.20operations.html#278766567">(Apr 12 2022 at 23:28)</a>:</h4>
<p>Python 3 broke compatibility with Python 2 by changing <code>/</code> to always mean "float division" (previously it mean "flooring division" for ints and "regular division" for floats), while <code>//</code> was introduced to always mean "flooring division". I feel this clarity makes sense.</p>
<p>In Python 3 the types are preserved though for <code>//</code>, such that <code>3.0 // 2.0</code> yields <code>1.0</code>, yet <code>/</code> always produces a float even from int inputs.</p>
<p>I'm not sure about what typing choice is reasonable for Roc. For Elm's tradeoffs (less concerned with access to low-level performance control), I'd think <code>(//) : Num, Num -&gt; Int</code> makes sense, but for Roc, it's not clear how to turn a <code>Num a</code> into an <code>Int b</code>. Also, if someone doing performance sensitive floating point code wanted a truncated float result, forcing them to explicitly convert back to float would be undesirable (even if LLVM could optimize that into remaining a float the whole time).</p>
<p>I would expect <code>divFloor : Num a, Num a -&gt; Num a</code> is reasonable (no type changes).</p>
<p>I don't know what to think about the result type of <code>div</code> however due to the type correspondence question. Do we just prohibit <code>div</code> and <code>/</code> on integers?</p>



<a name="278766620"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/non-Result%20Math%20operations/near/278766620" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Kevin Gillette <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/non-Result.20Math.20operations.html#278766620">(Apr 12 2022 at 23:29)</a>:</h4>
<p>(and does that imply that a function operating on <code>Num</code> can't access <code>/</code>, since not every <code>Num</code> variant would have access to non-flooring division?)</p>



<a name="278772417"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/non-Result%20Math%20operations/near/278772417" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/non-Result.20Math.20operations.html#278772417">(Apr 13 2022 at 00:59)</a>:</h4>
<p>the main motivation for that split is that it's easy to get surprising answers with int division</p>



<a name="278772564"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/non-Result%20Math%20operations/near/278772564" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/non-Result.20Math.20operations.html#278772564">(Apr 13 2022 at 01:00)</a>:</h4>
<p>e.g. in <code>x / y</code>, if <code>x</code> is 3 and <code>y</code> is 2, then if they're both floats the answer is 1.5 but if they're both ints the answer is 1</p>



<a name="278772592"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/non-Result%20Math%20operations/near/278772592" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/non-Result.20Math.20operations.html#278772592">(Apr 13 2022 at 01:01)</a>:</h4>
<p>and <code>3 / 2</code> returning 1 is a surprising result because that's not what it is in math</p>



<a name="278772663"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/non-Result%20Math%20operations/near/278772663" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/non-Result.20Math.20operations.html#278772663">(Apr 13 2022 at 01:02)</a>:</h4>
<p><code>3 // 2</code> is a visual indicator that it's not doing normal division</p>



<a name="278772669"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/non-Result%20Math%20operations/near/278772669" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/non-Result.20Math.20operations.html#278772669">(Apr 13 2022 at 01:02)</a>:</h4>
<p>so it's less error prone</p>



<a name="278783346"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/non-Result%20Math%20operations/near/278783346" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Kevin Gillette <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/non-Result.20Math.20operations.html#278783346">(Apr 13 2022 at 04:39)</a>:</h4>
<p>Looking through some of the code, I see:</p>
<div class="codehilite"><pre><span></span><code>I128 : Num (Integer Signed128)
I64 : Num (Integer Signed64)
I32 : Num (Integer Signed32)
I16 : Num (Integer Signed16)
I8 : Int Signed8
</code></pre></div>
<p><a href="https://github.com/rtfeldman/roc/blob/f39f7eda03a2488c1a89ee2b58ab3c6ca97ccaee/compiler/builtins/roc/Num.roc#L169-L173">https://github.com/rtfeldman/roc/blob/f39f7eda03a2488c1a89ee2b58ab3c6ca97ccaee/compiler/builtins/roc/Num.roc#L169-L173</a></p>
<p>Of these two styles, which is preferred? It looks like the <code>I8</code> style was introduced more recently. Would it be desirable to align these declarations on one style or another?</p>



<a name="278784061"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/non-Result%20Math%20operations/near/278784061" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ayaz Hafiz <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/non-Result.20Math.20operations.html#278784061">(Apr 13 2022 at 04:55)</a>:</h4>
<p>They resolve to the same underlying type (<code>Int</code> is <code>Int a : Num (Integer a)</code>), so there is no functional difference, also because the end user will only ever see <code>I8</code> or <code>I16</code> anyway, not the whole expanded type.</p>
<p>In any case these definitions will change relatively soon with opaque types and abilities.</p>



<hr><p>Last updated: Nov 01 2025 at 12:13 UTC</p>
</html>