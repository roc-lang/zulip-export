<html>
<head><meta charset="utf-8"><title>Debugging re-formatting stability · contributing · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/index.html">contributing</a></h2>
<h3>Topic: <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Debugging.20re-formatting.20stability.html">Debugging re-formatting stability</a></h3>

<hr>

<base href="https://roc.zulipchat.com">

<head><link href="https://roc-lang.github.io/zulip-export/style.css" rel="stylesheet"></head>

<a name="492973798"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Debugging%20re-formatting%20stability/near/492973798" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Debugging.20re-formatting.20stability.html#492973798">(Jan 10 2025 at 15:32)</a>:</h4>
<p>I have one snapshot test failing on re-formatting and I honestly just don't understand the progression.  I've updated the output of the case to be helpful, but here are the original/formatted/reformatted asts (with the source code below).  I've lined up the relevant nodes with each other</p>
<p><a href="/user_uploads/22008/2OMC5165sTAE76eDuamt6TxK/Screenshot-2025-01-10-at-9.28.32-AM.png">Screenshot 2025-01-10 at 9.28.32 AM.png</a></p>
<div class="message_inline_image"><a href="/user_uploads/22008/2OMC5165sTAE76eDuamt6TxK/Screenshot-2025-01-10-at-9.28.32-AM.png" title="Screenshot 2025-01-10 at 9.28.32 AM.png"><img data-original-dimensions="1832x1462" src="/user_uploads/thumbnail/22008/2OMC5165sTAE76eDuamt6TxK/Screenshot-2025-01-10-at-9.28.32-AM.png/840x560.webp"></a></div><p>For those like <span class="user-mention" data-user-id="453336">@Joshua Warner</span> or <span class="user-mention" data-user-id="461444">@Sam Mohr</span> who are familiar with this where do you think this SpaceAfter comes from around the PncApply in the reformatted AST?</p>



<a name="492974177"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Debugging%20re-formatting%20stability/near/492974177" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Debugging.20re-formatting.20stability.html#492974177">(Jan 10 2025 at 15:34)</a>:</h4>
<p>Can you paste the source code?</p>



<a name="492974212"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Debugging%20re-formatting%20stability/near/492974212" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Debugging.20re-formatting.20stability.html#492974212">(Jan 10 2025 at 15:34)</a>:</h4>
<p>Oh, I see it</p>



<a name="492974232"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Debugging%20re-formatting%20stability/near/492974232" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Debugging.20re-formatting.20stability.html#492974232">(Jan 10 2025 at 15:34)</a>:</h4>
<p>In the bottom of the image</p>



<a name="492974383"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Debugging%20re-formatting%20stability/near/492974383" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Debugging.20re-formatting.20stability.html#492974383">(Jan 10 2025 at 15:35)</a>:</h4>
<p>Yeah so the extra newline coming in is what is perplexing, and what makes the formatting so terrible</p>



<a name="492974451"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Debugging%20re-formatting%20stability/near/492974451" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Debugging.20re-formatting.20stability.html#492974451">(Jan 10 2025 at 15:35)</a>:</h4>
<p>Yep, the formatting that comes as "step 2" here makes sense to me</p>



<a name="492974530"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Debugging%20re-formatting%20stability/near/492974530" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Debugging.20re-formatting.20stability.html#492974530">(Jan 10 2025 at 15:36)</a>:</h4>
<p>The re-formatting is weird indeed</p>



<a name="492974567"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Debugging%20re-formatting%20stability/near/492974567" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Debugging.20re-formatting.20stability.html#492974567">(Jan 10 2025 at 15:36)</a>:</h4>
<p>But I think it comes from how we format patterns</p>



<a name="492974636"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Debugging%20re-formatting%20stability/near/492974636" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Debugging.20re-formatting.20stability.html#492974636">(Jan 10 2025 at 15:36)</a>:</h4>
<p>But I think it's the parsing of the formatted AST</p>



<a name="492974715"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Debugging%20re-formatting%20stability/near/492974715" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Debugging.20re-formatting.20stability.html#492974715">(Jan 10 2025 at 15:37)</a>:</h4>
<p>Or I guess not</p>



<a name="492974754"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Debugging%20re-formatting%20stability/near/492974754" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Debugging.20re-formatting.20stability.html#492974754">(Jan 10 2025 at 15:37)</a>:</h4>
<p>If you look at the docs for <a href="https://www.roc-lang.org/builtins/Str#walkUtf8">Str.walkUtf8</a>, whenever we have a multiline function type, we make sure the arrow is indented</p>



<a name="492974758"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Debugging%20re-formatting%20stability/near/492974758" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Debugging.20re-formatting.20stability.html#492974758">(Jan 10 2025 at 15:37)</a>:</h4>
<p>It would be the formatted of the formatted ast</p>



<a name="492974771"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Debugging%20re-formatting%20stability/near/492974771" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Debugging.20re-formatting.20stability.html#492974771">(Jan 10 2025 at 15:37)</a>:</h4>
<p>Which makes sense for types</p>



<a name="492974800"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Debugging%20re-formatting%20stability/near/492974800" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Debugging.20re-formatting.20stability.html#492974800">(Jan 10 2025 at 15:37)</a>:</h4>
<p>But this is a value, right?</p>



<a name="492974843"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Debugging%20re-formatting%20stability/near/492974843" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Debugging.20re-formatting.20stability.html#492974843">(Jan 10 2025 at 15:37)</a>:</h4>
<p>This is a value, you can see the top level node is an Expr</p>



<a name="492974913"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Debugging%20re-formatting%20stability/near/492974913" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Debugging.20re-formatting.20stability.html#492974913">(Jan 10 2025 at 15:38)</a>:</h4>
<p>So either our formatting for PNC patterns has some artifacts from formatting multiline spaced patterns</p>



<a name="492975001"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Debugging%20re-formatting%20stability/near/492975001" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Debugging.20re-formatting.20stability.html#492975001">(Jan 10 2025 at 15:38)</a>:</h4>
<p>So it's an Expr::Closure, and the first list is a [Pattern&lt;'_&gt;]</p>



<a name="492975063"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Debugging%20re-formatting%20stability/near/492975063" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Debugging.20re-formatting.20stability.html#492975063">(Jan 10 2025 at 15:39)</a>:</h4>
<p>I'll look at the code in a few minutes</p>



<a name="492975118"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Debugging%20re-formatting%20stability/near/492975118" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Debugging.20re-formatting.20stability.html#492975118">(Jan 10 2025 at 15:39)</a>:</h4>
<p>It's on my branch, maybe I did something goofy aligning it with Expr formatting</p>



<a name="492975145"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Debugging%20re-formatting%20stability/near/492975145" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Debugging.20re-formatting.20stability.html#492975145">(Jan 10 2025 at 15:39)</a>:</h4>
<p>Trying to finish up this invalid ident warning code</p>



<a name="492975290"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Debugging%20re-formatting%20stability/near/492975290" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Debugging.20re-formatting.20stability.html#492975290">(Jan 10 2025 at 15:40)</a>:</h4>
<p>No worries.  I have to go to work and write and test some Java.</p>



<a name="492975309"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Debugging%20re-formatting%20stability/near/492975309" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Debugging.20re-formatting.20stability.html#492975309">(Jan 10 2025 at 15:40)</a>:</h4>
<p>Shed a tear for me</p>



<a name="492981479"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Debugging%20re-formatting%20stability/near/492981479" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Warner <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Debugging.20re-formatting.20stability.html#492981479">(Jan 10 2025 at 16:13)</a>:</h4>
<p>Historically this sort of thing happened when <code>is_multiline</code> or one of the matches in the outer scopes differed slightly in details from how the child is actually formatted (e.g. adding/removing parens).</p>
<p>Now, these bugs have generally been pushed into <code>&lt;&gt;.to_node()</code>, <code>expr_lift_spaces</code>, <code>pattern_lift_spaces</code>, etc. in such a way that those functions are not sufficiently "normalizing".</p>
<p>In the initial formatted version (the middle column of your screenshot), it looks to me like the closure is for some reason incorrectly thinking that the arg list is _not_ multiline - and then it turning out it actually is when formatted.</p>



<a name="493023480"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Debugging%20re-formatting%20stability/near/493023480" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Debugging.20re-formatting.20stability.html#493023480">(Jan 10 2025 at 20:49)</a>:</h4>
<p>I think this is the issue:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="w">   </span><span class="n">buf</span><span class="p">.</span><span class="n">push</span><span class="p">(</span><span class="sc">'\\'</span><span class="p">);</span>

<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">arguments_are_multiline</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">loc_patterns</span>
<span class="w">        </span><span class="p">.</span><span class="n">iter</span><span class="p">()</span>
<span class="w">        </span><span class="p">.</span><span class="n">any</span><span class="p">(</span><span class="o">|</span><span class="n">loc_pattern</span><span class="o">|</span><span class="w"> </span><span class="n">loc_pattern</span><span class="p">.</span><span class="n">is_multiline</span><span class="p">());</span>

<span class="w">    </span><span class="c1">// If the arguments are multiline, go down a line and indent.</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">indent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">arguments_are_multiline</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">indent</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">INDENT</span>
<span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">indent</span>
<span class="w">    </span><span class="p">};</span>

<span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">first</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span><span class="p">;</span>

<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="n">loc_pattern</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">loc_patterns</span><span class="p">.</span><span class="n">iter</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="o">!</span><span class="n">first</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">buf</span><span class="p">.</span><span class="n">indent</span><span class="p">(</span><span class="n">indent</span><span class="p">);</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="n">arguments_are_multiline</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="n">buf</span><span class="p">.</span><span class="n">push</span><span class="p">(</span><span class="sc">','</span><span class="p">);</span>
<span class="w">                </span><span class="n">buf</span><span class="p">.</span><span class="n">newline</span><span class="p">();</span>
<span class="w">            </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="n">buf</span><span class="p">.</span><span class="n">push_str</span><span class="p">(</span><span class="s">","</span><span class="p">);</span>
<span class="w">                </span><span class="n">buf</span><span class="p">.</span><span class="n">spaces</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="n">first</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">false</span><span class="p">;</span>

<span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="n">arg</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pattern_lift_spaces</span><span class="p">(</span><span class="n">buf</span><span class="p">.</span><span class="n">text</span><span class="p">.</span><span class="n">bump</span><span class="p">(),</span><span class="w"> </span><span class="o">&amp;</span><span class="n">loc_pattern</span><span class="p">.</span><span class="n">value</span><span class="p">);</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="o">!</span><span class="n">arg</span><span class="p">.</span><span class="n">before</span><span class="p">.</span><span class="n">is_empty</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">fmt_comments_only</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span><span class="w"> </span><span class="n">arg</span><span class="p">.</span><span class="n">before</span><span class="p">.</span><span class="n">iter</span><span class="p">(),</span><span class="w"> </span><span class="n">NewlineAt</span><span class="p">::</span><span class="n">Bottom</span><span class="p">,</span><span class="w"> </span><span class="n">indent</span><span class="p">)</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="n">arg</span><span class="p">.</span><span class="n">item</span>
<span class="w">            </span><span class="p">.</span><span class="n">format_with_options</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span><span class="w"> </span><span class="n">Parens</span><span class="p">::</span><span class="n">InClosurePattern</span><span class="p">,</span><span class="w"> </span><span class="n">Newlines</span><span class="p">::</span><span class="n">No</span><span class="p">,</span><span class="w"> </span><span class="n">indent</span><span class="p">);</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="o">!</span><span class="n">arg</span><span class="p">.</span><span class="n">after</span><span class="p">.</span><span class="n">is_empty</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="n">starts_with_inline_comment</span><span class="p">(</span><span class="n">arg</span><span class="p">.</span><span class="n">after</span><span class="p">.</span><span class="n">iter</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="n">buf</span><span class="p">.</span><span class="n">spaces</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">            </span><span class="n">fmt_comments_only</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span><span class="w"> </span><span class="n">arg</span><span class="p">.</span><span class="n">after</span><span class="p">.</span><span class="n">iter</span><span class="p">(),</span><span class="w"> </span><span class="n">NewlineAt</span><span class="p">::</span><span class="n">Bottom</span><span class="p">,</span><span class="w"> </span><span class="n">indent</span><span class="p">)</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
</code></pre></div>



<a name="493023649"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Debugging%20re-formatting%20stability/near/493023649" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Debugging.20re-formatting.20stability.html#493023649">(Jan 10 2025 at 20:50)</a>:</h4>
<p>The comment doesn't tell the truth</p>



<a name="493023673"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Debugging%20re-formatting%20stability/near/493023673" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Debugging.20re-formatting.20stability.html#493023673">(Jan 10 2025 at 20:50)</a>:</h4>
<p>Nor is it correct - in my opinion</p>



<a name="493023698"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Debugging%20re-formatting%20stability/near/493023698" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Debugging.20re-formatting.20stability.html#493023698">(Jan 10 2025 at 20:50)</a>:</h4>
<p>We do not go down a line and indent.  We just increase the indent</p>



<a name="493023743"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Debugging%20re-formatting%20stability/near/493023743" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Debugging.20re-formatting.20stability.html#493023743">(Jan 10 2025 at 20:51)</a>:</h4>
<p>And I'm not sure we should do that at all for a single multi-line pattern</p>



<a name="493023952"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Debugging%20re-formatting%20stability/near/493023952" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Debugging.20re-formatting.20stability.html#493023952">(Jan 10 2025 at 20:53)</a>:</h4>
<p>I think I'm going to say "If arguments_are_multiline AND there are more than 1 argument - actually go down a line and indent with an increased indent.  otherwise keep the same indent and have the arrow be on the same line as the end of the arg pattern.</p>



<a name="493023958"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Debugging%20re-formatting%20stability/near/493023958" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Debugging.20re-formatting.20stability.html#493023958">(Jan 10 2025 at 20:53)</a>:</h4>
<p>Does this sound correct?</p>



<a name="493024011"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Debugging%20re-formatting%20stability/near/493024011" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Debugging.20re-formatting.20stability.html#493024011">(Jan 10 2025 at 20:53)</a>:</h4>
<p>That <em>sounds</em> correct, but I'd have to see examples get formatted in the PR</p>



<a name="493024164"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Debugging%20re-formatting%20stability/near/493024164" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Debugging.20re-formatting.20stability.html#493024164">(Jan 10 2025 at 20:55)</a>:</h4>
<p>So:</p>
<div class="codehilite" data-code-language="Elm"><pre><span></span><code><span class="nf">\</span>
<span class="w">    </span><span class="kt">SomeThing</span><span class="p">({</span>
<span class="w">        </span><span class="nv">with</span><span class="nf">:</span><span class="w"> </span><span class="nf">'</span><span class="nv">multilining'</span><span class="p">,</span>
<span class="w">        </span><span class="nv">more</span><span class="nf">:</span><span class="w"> </span><span class="nf">'</span><span class="nv">args'</span><span class="p">,</span>
<span class="w">    </span><span class="p">}),</span>
<span class="w">    </span><span class="nv">foo</span>
<span class="w">    </span><span class="nf">-&gt;</span><span class="w"> </span><span class="nf">....</span>
</code></pre></div>
<p>But:</p>
<div class="codehilite" data-code-language="Elm"><pre><span></span><code><span class="nf">\</span><span class="kt">L</span><span class="p">(</span>
<span class="w">    </span><span class="nv">z</span><span class="p">,</span><span class="w"> </span><span class="err">#</span><span class="w"> </span><span class="kt">This</span><span class="w"> </span><span class="nv">is</span><span class="w"> </span><span class="nv">multiline</span>
<span class="p">)</span><span class="w"> </span><span class="nf">-&gt;</span><span class="w"> </span><span class="nf">....</span>
</code></pre></div>



<a name="493024295"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Debugging%20re-formatting%20stability/near/493024295" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Debugging.20re-formatting.20stability.html#493024295">(Jan 10 2025 at 20:56)</a>:</h4>
<p>That works for now. I don't like the <code>\</code> being on a different line, but we're killing it soon, so <span aria-label="shrug" class="emoji emoji-1f937" role="img" title="shrug">:shrug:</span></p>



<a name="493024307"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Debugging%20re-formatting%20stability/near/493024307" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Debugging.20re-formatting.20stability.html#493024307">(Jan 10 2025 at 20:56)</a>:</h4>
<p>But maybe we also want:</p>
<div class="codehilite" data-code-language="Elm"><pre><span></span><code><span class="nf">\</span><span class="nv">foo</span><span class="p">,</span><span class="w"> </span><span class="kt">L</span><span class="p">(</span>
<span class="w">    </span><span class="nv">z</span><span class="p">,</span><span class="w"> </span><span class="err">#</span><span class="w"> </span><span class="kt">This</span><span class="w"> </span><span class="nv">is</span><span class="w"> </span><span class="nv">multiline</span>
<span class="p">)</span><span class="w"> </span><span class="nf">-&gt;</span><span class="w"> </span><span class="nf">....</span>
</code></pre></div>



<a name="493024324"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Debugging%20re-formatting%20stability/near/493024324" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Debugging.20re-formatting.20stability.html#493024324">(Jan 10 2025 at 20:56)</a>:</h4>
<p>Yeah</p>



<a name="493024379"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Debugging%20re-formatting%20stability/near/493024379" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Debugging.20re-formatting.20stability.html#493024379">(Jan 10 2025 at 20:56)</a>:</h4>
<div class="codehilite" data-code-language="Ruby"><pre><span></span><code><span class="o">|</span>
<span class="w">    </span><span class="no">SomeThing</span><span class="p">({</span>
<span class="w">        </span><span class="ss">with</span><span class="p">:</span><span class="w"> </span><span class="s1">'multilining'</span><span class="p">,</span>
<span class="w">        </span><span class="ss">more</span><span class="p">:</span><span class="w"> </span><span class="s1">'args'</span><span class="p">,</span>
<span class="w">    </span><span class="p">}),</span>
<span class="w">    </span><span class="n">foo</span>
<span class="o">|</span><span class="w">  </span><span class="o">....</span>
</code></pre></div>
<p>looks better I guess?</p>



<a name="493024424"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Debugging%20re-formatting%20stability/near/493024424" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Debugging.20re-formatting.20stability.html#493024424">(Jan 10 2025 at 20:57)</a>:</h4>
<p>Not <em>great</em>, but better</p>



<a name="493024437"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Debugging%20re-formatting%20stability/near/493024437" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Debugging.20re-formatting.20stability.html#493024437">(Jan 10 2025 at 20:57)</a>:</h4>
<p>I don't think we can do better than that, though, so it's good</p>



<a name="493024459"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Debugging%20re-formatting%20stability/near/493024459" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Debugging.20re-formatting.20stability.html#493024459">(Jan 10 2025 at 20:57)</a>:</h4>
<p>So I think the rule is if there is a multiline arg _before the last arg_, then we do the whole outdenting thing</p>



<a name="493024668"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Debugging%20re-formatting%20stability/near/493024668" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Debugging.20re-formatting.20stability.html#493024668">(Jan 10 2025 at 20:59)</a>:</h4>
<p>Hmmm...thinking.  That would mean with <code>||</code> syntax:</p>
<div class="codehilite" data-code-language="Ruby"><pre><span></span><code><span class="o">|</span><span class="n">foo</span><span class="p">,</span><span class="w"> </span><span class="no">SomeThing</span><span class="p">(</span>
<span class="w">    </span><span class="n">z</span><span class="p">,</span><span class="w"> </span><span class="c1"># This is multiline</span>
<span class="p">)</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="o">....</span>
</code></pre></div>
<p>Is that better than:</p>
<div class="codehilite" data-code-language="Ruby"><pre><span></span><code><span class="o">|</span>
<span class="w">    </span><span class="n">foo</span><span class="p">,</span>
<span class="w">    </span><span class="no">SomeThing</span><span class="p">(</span>
<span class="w">        </span><span class="n">z</span><span class="p">,</span><span class="w"> </span><span class="c1"># This is multiline</span>
<span class="w">    </span><span class="p">),</span>
<span class="o">|</span><span class="w"> </span><span class="o">....</span>
</code></pre></div>
<p>?</p>



<a name="493024896"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Debugging%20re-formatting%20stability/near/493024896" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Debugging.20re-formatting.20stability.html#493024896">(Jan 10 2025 at 21:00)</a>:</h4>
<p>I like symmetry, so I vote 2</p>



<a name="493024905"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Debugging%20re-formatting%20stability/near/493024905" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Debugging.20re-formatting.20stability.html#493024905">(Jan 10 2025 at 21:00)</a>:</h4>
<p>Maybe that's just me</p>



<a name="493024954"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Debugging%20re-formatting%20stability/near/493024954" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Debugging.20re-formatting.20stability.html#493024954">(Jan 10 2025 at 21:01)</a>:</h4>
<p>Function args have different aesthetic rules than function bodies</p>



<a name="493024961"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Debugging%20re-formatting%20stability/near/493024961" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Warner <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Debugging.20re-formatting.20stability.html#493024961">(Jan 10 2025 at 21:01)</a>:</h4>
<p>I agree that comment doesn't match the code, and that the current formatting is not ideal - but I'm not sure that's the cause of the bug you're looking at</p>



<a name="493025068"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Debugging%20re-formatting%20stability/near/493025068" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Debugging.20re-formatting.20stability.html#493025068">(Jan 10 2025 at 21:02)</a>:</h4>
<p>Ok, So for now I'll do if more than one arg do the outdent.  But with <code>||</code> I'll go back to doing it for any number of args that are multiline</p>



<a name="493025098"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Debugging%20re-formatting%20stability/near/493025098" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Debugging.20re-formatting.20stability.html#493025098">(Jan 10 2025 at 21:02)</a>:</h4>
<p><span class="user-mention silent" data-user-id="453336">Joshua Warner</span> <a href="#narrow/channel/316715-contributing/topic/Debugging.20re-formatting.20stability/near/493024961">said</a>:</p>
<blockquote>
<p>I agree that comment doesn't match the code, and that the current formatting is not ideal - but I'm not sure that's the cause of the bug you're looking at</p>
</blockquote>
<p>We'll find out soon</p>



<a name="493025119"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Debugging%20re-formatting%20stability/near/493025119" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Debugging.20re-formatting.20stability.html#493025119">(Jan 10 2025 at 21:02)</a>:</h4>
<p>But I have some other things to do first</p>



<hr><p>Last updated: Mar 01 2026 at 12:20 UTC</p>
</html>