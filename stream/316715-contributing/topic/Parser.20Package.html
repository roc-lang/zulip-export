<html>
<head><meta charset="utf-8"><title>Parser Package · contributing · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/index.html">contributing</a></h2>
<h3>Topic: <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Parser.20Package.html">Parser Package</a></h3>

<hr>

<base href="https://roc.zulipchat.com">

<head><link href="https://roc-lang.github.io/zulip-export/style.css" rel="stylesheet"></head>

<a name="321691505"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Parser%20Package/near/321691505" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Parser.20Package.html#321691505">(Jan 16 2023 at 17:44)</a>:</h4>
<p>I have been trying to write tests and examples for the Parser example. I was hoping to use this to demonstrate basic packages functionality. I managed to get it working ok; but came across the following <a href="https://github.com/roc-lang/roc/issues/4904">issue#4904</a> when using <code>Parser.Core.{ many }</code>. I'm reasonably confident I am doing things correctly there, so there is a bug in the compiler somewhere.</p>
<p>My idea was to write more tests/examples to demonstrate the parsers. Would it make sense to refactor this example to make the Parser into a package instead of having it's own platform? We can then have a number of different examples perhaps using the basic-cli URL package if required? In the future we could even have CI build the Parser package to provide a URL perhaps?</p>
<p>Following is an example header using which uses basic packages functionality. It works when I include a package module declaration as below at <code>roc/examples/parser/main.roc</code>.</p>
<div class="codehilite" data-code-language="Elixir"><pre><span></span><code><span class="n">app</span><span class="w"> </span><span class="s2">"example"</span><span class="w"></span>
<span class="w">    </span><span class="n">packages</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="ss">cli</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://github.com/roc-lang/basic-cli/releases/download/0.1.2/3bKbbmgtIfOyC6FviJ9o8F8xqKutmXgjCJx3bMfVTSo.tar.br"</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="ss">parser</span><span class="p">:</span><span class="w"> </span><span class="s2">"main.roc"</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="n">imports</span><span class="w"> </span><span class="p">[</span><span class="w"></span>
<span class="w">        </span><span class="n">cli</span><span class="o">.</span><span class="nc">Stdout</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="n">parser</span><span class="o">.</span><span class="nc">Parser.Core</span><span class="o">.</span><span class="p">{</span><span class="w"> </span><span class="nc">Parser</span><span class="p">,</span><span class="w"> </span><span class="n">parsePartial</span><span class="p">,</span><span class="w"> </span><span class="n">buildPrimitiveParser</span><span class="p">,</span><span class="w"> </span><span class="n">many</span><span class="w"> </span><span class="p">},</span><span class="w"></span>
<span class="w">    </span><span class="p">]</span><span class="w"></span>
<span class="w">    </span><span class="n">provides</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="n">main</span><span class="w"> </span><span class="p">]</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">cli</span><span class="w"></span>
</code></pre></div>
<div class="codehilite" data-code-language="Elixir"><pre><span></span><code><span class="n">package</span><span class="w"> </span><span class="s2">"parser"</span><span class="w"></span>
<span class="w">    </span><span class="n">exposes</span><span class="w"> </span><span class="p">[</span><span class="w"></span>
<span class="w">        </span><span class="nc">Parser.Core</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="nc">Parser.CSV</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="nc">Parser.Str</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="nc">Parser.Http</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="p">]</span><span class="w"></span>
<span class="w">    </span><span class="n">packages</span><span class="w"> </span><span class="p">{}</span><span class="w"></span>
</code></pre></div>



<a name="321691967"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Parser%20Package/near/321691967" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Parser.20Package.html#321691967">(Jan 16 2023 at 17:48)</a>:</h4>
<p>I am pretty sure that feature simply isn't implemented yet, but I totally could be wrong. I haven't tested/look at this in a long while. So it very well could have changed.</p>



<a name="321691978"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Parser%20Package/near/321691978" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Parser.20Package.html#321691978">(Jan 16 2023 at 17:48)</a>:</h4>
<p>Note that if we made it a package, we can remove the redundant "Parser" in the imports.</p>



<a name="321692109"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Parser%20Package/near/321692109" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Parser.20Package.html#321692109">(Jan 16 2023 at 17:49)</a>:</h4>
<p>Yeah it works. <a href="https://github.com/roc-lang/roc/pull/4736">PR#4736</a> was what inspired me to start playing with it.</p>



<a name="321692165"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Parser%20Package/near/321692165" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anton <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Parser.20Package.html#321692165">(Jan 16 2023 at 17:49)</a>:</h4>
<p>I think <span class="user-mention" data-user-id="281383">@Richard Feldman</span> already implemented URL packages but there was some caveat I forgot about.</p>



<a name="321692175"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Parser%20Package/near/321692175" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Carroll <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Parser.20Package.html#321692175">(Jan 16 2023 at 17:49)</a>:</h4>
<p>Yeah that makes loads of sense! The only reason it has its own platform is that, when it was written, that was the only way we could do things. But your proposed structure would be much better. And it's good for the examples to show off things like this.</p>



<a name="321692974"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Parser%20Package/near/321692974" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Carroll <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Parser.20Package.html#321692974">(Jan 16 2023 at 17:54)</a>:</h4>
<p>Luke if you have managed to get this working, I think it would be an excellent contribution to the repo! I'd be happy to help or review, and I'm sure others here would too.</p>



<a name="321693068"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Parser%20Package/near/321693068" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Carroll <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Parser.20Package.html#321693068">(Jan 16 2023 at 17:55)</a>:</h4>
<p>oh wait you said there's a compiler bug</p>



<a name="321693203"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Parser%20Package/near/321693203" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Carroll <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Parser.20Package.html#321693203">(Jan 16 2023 at 17:56)</a>:</h4>
<p>Can you make a PR out of your branch so that people can pull it and try to help fix it?</p>



<a name="321694147"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Parser%20Package/near/321694147" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Carroll <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Parser.20Package.html#321694147">(Jan 16 2023 at 18:02)</a>:</h4>
<p>I use the <code>many</code> combinator in the Http parser for headers and it works OK there</p>



<a name="321694263"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Parser%20Package/near/321694263" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Carroll <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Parser.20Package.html#321694263">(Jan 16 2023 at 18:03)</a>:</h4>
<p>I notice you're using <code>parsePartial</code> rather than making it parse the whole input. So I'm wondering if that doesn't work well in combination with <code>many</code>.</p>



<a name="321695057"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Parser%20Package/near/321695057" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Parser.20Package.html#321695057">(Jan 16 2023 at 18:09)</a>:</h4>
<p>Sure thing! </p>
<p>I created a draft <a href="https://github.com/roc-lang/roc/pull/4906/files">PR#4906</a> here with what I have so far. I'm heading out for dinner now, but happy to continue plugging away at it tomorrow.</p>



<a name="321695612"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Parser%20Package/near/321695612" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Carroll <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Parser.20Package.html#321695612">(Jan 16 2023 at 18:13)</a>:</h4>
<p>OK so <code>many</code> calls <code>manyImpl</code> which is recursive, and the recursion terminates when the parser fails. But your parser never fails. So that could be the issue.</p>



<a name="321695693"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Parser%20Package/near/321695693" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Carroll <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Parser.20Package.html#321695693">(Jan 16 2023 at 18:13)</a>:</h4>
<p>I suppose all parsers should fail when the input is exhausted though. But maybe that's not implemented correctly in the library.</p>



<a name="321695762"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Parser%20Package/near/321695762" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Carroll <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Parser.20Package.html#321695762">(Jan 16 2023 at 18:14)</a>:</h4>
<p>Anyway I'm not convinced this is a compiler issue, I think it's more likely a library issue.</p>



<a name="321695935"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Parser%20Package/near/321695935" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Carroll <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Parser.20Package.html#321695935">(Jan 16 2023 at 18:15)</a>:</h4>
<p>yes that's it. <code>manyImpl</code> handles all errors the same in a branch with <code>Err _ -&gt;</code>. But it should have a special case for the error where we ran out of characters to parse!</p>



<a name="321695970"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Parser%20Package/near/321695970" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Carroll <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Parser.20Package.html#321695970">(Jan 16 2023 at 18:15)</a>:</h4>
<p>..I think</p>



<a name="321719455"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Parser%20Package/near/321719455" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Parser.20Package.html#321719455">(Jan 16 2023 at 21:21)</a>:</h4>
<p>the only caveat I know about with packages right now is that I haven't yet implemented packages which depend on other packages - there's some more work that needs to be done to support that use case</p>



<a name="321719514"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Parser%20Package/near/321719514" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Parser.20Package.html#321719514">(Jan 16 2023 at 21:22)</a>:</h4>
<p>it might also apply to platforms which depend on packages - I forget</p>



<a name="321719541"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Parser%20Package/near/321719541" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Parser.20Package.html#321719541">(Jan 16 2023 at 21:22)</a>:</h4>
<p>but either way, applications depending directly on packages - URL or otherwise - should work fine!</p>



<a name="321775406"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Parser%20Package/near/321775406" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Carroll <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Parser.20Package.html#321775406">(Jan 17 2023 at 08:23)</a>:</h4>
<p><span class="user-mention" data-user-id="515757">@Luke Boswell</span> , there's actually an infinite loop in your program!<br>
The <code>many</code> combinator keeps recursing until the inner parser fails. But your <code>letterParser</code> does not explicitly handle the case where <code>input</code> is empty, so it actually succeeds, and returns <code>Ok { val: Other, input: [] }</code>.<br>
This means the inner parser never fails. It just keeps returning <code>Other</code> forever, so the <code>many</code> recursion keeps going, and the program hangs.</p>



<a name="321781212"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Parser%20Package/near/321781212" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Parser.20Package.html#321781212">(Jan 17 2023 at 09:00)</a>:</h4>
<p>Thank you, I'll keep working on these examples/tests and see if I can propose a sensible refactor based on similar libraries. <span class="user-mention" data-user-id="361169">@Anton</span> does it make sense to have tests that can or should be run in CI or sometime? I'm not sure of the best way to do that. I was thinking of writing example apps and then writing <code>expect</code>s in them, which we can run <code>roc test</code> on maybe.</p>



<a name="321782326"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Parser%20Package/near/321782326" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anton <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Parser.20Package.html#321782326">(Jan 17 2023 at 09:06)</a>:</h4>
<blockquote>
<p>@Anton does it make sense to have tests that can or should be run in CI or sometime? I'm not sure of the best way to do that. I was thinking of writing example apps and then writing expects in them, which we can run roc test on maybe.</p>
</blockquote>
<p>Yeah, that sounds great <span class="user-mention" data-user-id="515757">@Luke Boswell</span>. We can use a similar setup like with the basic-cli repo. I'd say we probably also want a separate repo for this parser package.</p>



<a name="321833030"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Parser%20Package/near/321833030" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Carroll <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Parser.20Package.html#321833030">(Jan 17 2023 at 13:44)</a>:</h4>
<p>We have a set of Rust tests that test every example app . Recently I added <a href="https://github.com/roc-lang/roc/blob/2b429d35f619ff95b6ae1976d470de4dffd2049e/crates/cli/tests/cli_run.rs#L873">a new variant</a> that can run <code>roc check</code> on a library module like <code>Parser.Http</code> too.</p>



<a name="321833382"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Parser%20Package/near/321833382" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Carroll <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Parser.20Package.html#321833382">(Jan 17 2023 at 13:46)</a>:</h4>
<p>But if we're making it external then maybe it's better to follow how basic-cli does it</p>



<hr><p>Last updated: Mar 01 2026 at 12:20 UTC</p>
</html>