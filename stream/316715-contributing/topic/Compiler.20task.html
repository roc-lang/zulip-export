<html>
<head><meta charset="utf-8"><title>Compiler task · contributing · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/index.html">contributing</a></h2>
<h3>Topic: <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Compiler.20task.html">Compiler task</a></h3>

<hr>

<base href="https://roc.zulipchat.com">

<head><link href="https://roc-lang.github.io/zulip-export/style.css" rel="stylesheet"></head>

<a name="554498584"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Compiler%20task/near/554498584" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anton <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Compiler.20task.html#554498584">(Nov 08 2025 at 17:36)</a>:</h4>
<p>I'm ready for a main quest compiler task (on Monday), what's available?</p>



<a name="554502302"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Compiler%20task/near/554502302" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Compiler.20task.html#554502302">(Nov 08 2025 at 18:37)</a>:</h4>
<p>builtins! <span aria-label="smiley" class="emoji emoji-1f603" role="img" title="smiley">:smiley:</span></p>



<a name="554502325"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Compiler%20task/near/554502325" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Compiler.20task.html#554502325">(Nov 08 2025 at 18:38)</a>:</h4>
<p>any interest in fleshing those out?</p>



<a name="554515407"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Compiler%20task/near/554515407" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Compiler.20task.html#554515407">(Nov 08 2025 at 22:30)</a>:</h4>
<p>We can add those piecemeal right? Like add a new builtin fn, add some tests etc and that's a PR</p>



<a name="554515841"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Compiler%20task/near/554515841" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Compiler.20task.html#554515841">(Nov 08 2025 at 22:38)</a>:</h4>
<p>yep! Once this PR for lists lands</p>



<a name="554646805"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Compiler%20task/near/554646805" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anton <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Compiler.20task.html#554646805">(Nov 10 2025 at 08:55)</a>:</h4>
<p><span class="user-mention silent" data-user-id="281383">Richard Feldman</span> <a href="#narrow/channel/316715-contributing/topic/Compiler.20task/near/554502302">said</a>:</p>
<blockquote>
<p>builtins! <span aria-label="smiley" class="emoji emoji-1f603" role="img" title="smiley">:smiley:</span></p>
</blockquote>
<p>Perfect :)</p>



<a name="555245694"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Compiler%20task/near/555245694" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dan G Knutson <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Compiler.20task.html#555245694">(Nov 13 2025 at 00:13)</a>:</h4>
<p>I'm interested in working on the string builtins, but it seemed like the low_level_interp tests weren't running when I messed around with them. Are those in a ready-to-get-picked-up state?</p>



<a name="555257982"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Compiler%20task/near/555257982" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Compiler.20task.html#555257982">(Nov 13 2025 at 02:44)</a>:</h4>
<p>I think <span class="user-mention" data-user-id="361169">@Anton</span> recently fixed that!</p>



<a name="555293001"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Compiler%20task/near/555293001" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anton <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Compiler.20task.html#555293001">(Nov 13 2025 at 08:33)</a>:</h4>
<p>No, the low_level_interp_test.zig is <a href="https://github.com/roc-lang/roc/blob/cea6d56329a52c941f752055b48c785655a17fdd/ci/check_test_wiring.zig#L17">an exception to the new CI test check</a>. I was not able to debug it to get it working again on the first try, but I can focus on that today.</p>



<a name="555305008"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Compiler%20task/near/555305008" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anton <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Compiler.20task.html#555305008">(Nov 13 2025 at 09:29)</a>:</h4>
<p>Feel free to go ahead with string builtins without adding a test in low_level_interp_test.zig. Please share the specific builtin you want to add here before starting to avoid double work <span class="user-mention" data-user-id="430894">@Dan G Knutson</span> <span class="user-mention" data-user-id="986975">@Edwin Santos</span>.</p>



<a name="555325232"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Compiler%20task/near/555325232" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anton <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Compiler.20task.html#555325232">(Nov 13 2025 at 11:01)</a>:</h4>
<p>I will do <code>Str.concat</code></p>



<a name="555343925"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Compiler%20task/near/555343925" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Compiler.20task.html#555343925">(Nov 13 2025 at 12:38)</a>:</h4>
<p>oh ok I'll take care of that test then</p>



<a name="555343986"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Compiler%20task/near/555343986" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Compiler.20task.html#555343986">(Nov 13 2025 at 12:38)</a>:</h4>
<p>I have a bunch of changes on my current branch that will affect it</p>



<a name="555398009"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Compiler%20task/near/555398009" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anton <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Compiler.20task.html#555398009">(Nov 13 2025 at 16:09)</a>:</h4>
<p><span class="user-mention silent" data-user-id="281383">Richard Feldman</span> <a href="#narrow/channel/316715-contributing/topic/Compiler.20task/near/555343925">said</a>:</p>
<blockquote>
<p>oh ok I'll take care of that test then</p>
</blockquote>
<p><span class="user-mention" data-user-id="281383">@Richard Feldman</span> I already fixed some Str.is_empty test failures when you sent this and I thought I was close to finishing the whole thing so I continued :p Several hours later all low_level_interp_tests pass now. I'm not sure about the branches I added to src/eval/interpreter.zig though (<a href="https://github.com/roc-lang/roc/pull/8378">PR#8378</a>). Anyway, I basically just put it for inspiration, feel free to do with it what you like :)</p>



<a name="555424060"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Compiler%20task/near/555424060" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Edwin Santos <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Compiler.20task.html#555424060">(Nov 13 2025 at 17:57)</a>:</h4>
<p>Essentially any methods in the String documentation which aren't part of RocStr in builtins/str.zig are up for grabs correct? If so I'll start on <code>Str.repeat</code> then!</p>



<a name="555424832"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Compiler%20task/near/555424832" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anton <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Compiler.20task.html#555424832">(Nov 13 2025 at 18:01)</a>:</h4>
<p>Yes, go ahead :)</p>



<a name="555472807"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Compiler%20task/near/555472807" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Norbert Hajagos <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Compiler.20task.html#555472807">(Nov 13 2025 at 22:50)</a>:</h4>
<p>Reading some of the messages about trying to get the compiler ready before AoC.. I just can't sit on the sidelines! I was eying with strCaselessAsciiEquals, strWithAsciiLowercased, strWithAsciiUppercased, because I've made them for the rust compiler, so I can probably figure them out for the new one, though I haven't really touched it yet. Is following your footsteps on <a href="https://github.com/roc-lang/roc/issues/8380">#8380</a> a good way <span class="user-mention" data-user-id="361169">@Anton</span>?</p>



<a name="555476773"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Compiler%20task/near/555476773" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Edwin Santos <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Compiler.20task.html#555476773">(Nov 13 2025 at 23:25)</a>:</h4>
<p>Hey y'all, an implementation for Repeat is already in builtins/str.zig, does this mean that integration into build/roc/Builtin.roc and testing is all that's left to complete adding this builtin? I'll finish that stuff up if so.</p>
<p>I'll also start on Str.with_prefix  since that doesn't have an implementation yet.</p>



<a name="555543451"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Compiler%20task/near/555543451" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anton <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Compiler.20task.html#555543451">(Nov 14 2025 at 09:43)</a>:</h4>
<p>Thanks for helping out <span class="user-mention" data-user-id="577599">@Norbert Hajagos</span>, yes <a href="https://github.com/roc-lang/roc/issues/8380">#8380</a> should be a good guide. A bunch of tests will not work but just filling things out and making a draft PR is already helpful. Once we get a nice fix for low_level_interp_test in place we can fix up all the builtin PRs.</p>



<a name="555544947"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Compiler%20task/near/555544947" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anton <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Compiler.20task.html#555544947">(Nov 14 2025 at 09:51)</a>:</h4>
<blockquote>
<p>an implementation for Repeat is already in builtins/str.zig</p>
</blockquote>
<p>So builtins/str.zig is for use in compiled Roc binaries (so not used by the interpreter). I did notice <code>repeatC</code> does not have a unit test in that file yet, can you add one <span class="user-mention" data-user-id="986975">@Edwin Santos</span>?</p>



<a name="555545038"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Compiler%20task/near/555545038" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anton <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Compiler.20task.html#555545038">(Nov 14 2025 at 09:51)</a>:</h4>
<blockquote>
<p>So builtins/str.zig is for use in compiler Roc binaries.</p>
</blockquote>
<p>See <a href="https://github.com/roc-lang/roc/issues/8380">#8380</a> for which files you need to later to provide the implementation for the interpreter.</p>



<a name="555545676"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Compiler%20task/near/555545676" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anton <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Compiler.20task.html#555545676">(Nov 14 2025 at 09:55)</a>:</h4>
<p>Some builtins can be implemented in Roc (like <code>fold</code> in src/build/roc/Builtin.roc) whereas others should be implemented in <a href="https://github.com/roc-lang/roc/blob/3e9c0de4c2666391fac4db950234432112001b35/src/eval/interpreter.zig#L2358">interpreter.zig</a>. How should this decision be made <span class="user-mention" data-user-id="281383">@Richard Feldman</span>?</p>



<a name="555547587"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Compiler%20task/near/555547587" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Norbert Hajagos <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Compiler.20task.html#555547587">(Nov 14 2025 at 10:04)</a>:</h4>
<p>Like I said, new to this compiler. Is there a reason we have 2 implementation for the builtins, one for the interpreter, one fore the compiler? Skimming your PR, it seems the compiled version does extra uniqueness checks to reuse one of the strings if possible for performace reasons, and the interpreted version does not. Is there a reason the interpreted doesn't import the builtins from the compiled version and wraps them with some interpreter-specific work, like allocating the result on the stack?</p>



<a name="555549772"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Compiler%20task/near/555549772" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anton <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Compiler.20task.html#555549772">(Nov 14 2025 at 10:15)</a>:</h4>
<p>Good question! I actually don't know, can one of you provide the answer <span class="user-mention" data-user-id="281383">@Richard Feldman</span> <span class="user-mention" data-user-id="341568">@Jared Ramirez</span> <span class="user-mention" data-user-id="515757">@Luke Boswell</span>?</p>



<a name="555550390"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Compiler%20task/near/555550390" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Norbert Hajagos <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Compiler.20task.html#555550390">(Nov 14 2025 at 10:18)</a>:</h4>
<p>I am checking the src right now. It seems some functions are actually reused, like <a href="https://github.com/roc-lang/roc/blob/b69a3c8a980f05544832fd768c0818aaf0158104/src/eval/interpreter.zig#L2436">builtins.list.listGetUnsafe</a>, so I think you can safely reuse your more performant implementation as well.</p>



<a name="555551655"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Compiler%20task/near/555551655" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Norbert Hajagos <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Compiler.20task.html#555551655">(Nov 14 2025 at 10:24)</a>:</h4>
<p>Yes, looking more thoroughly there are a bunch of cases like this. builtins.list.listIsEmpty, builtins.list.listLen, builtins.list.listConcat, etc...<br>
Didn't mean to turn this into a code review, I'm grateful that you've made such an atomic change I can base my work on  <span aria-label="sweat smile" class="emoji emoji-1f605" role="img" title="sweat smile">:sweat_smile:</span></p>



<a name="555551915"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Compiler%20task/near/555551915" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anton <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Compiler.20task.html#555551915">(Nov 14 2025 at 10:26)</a>:</h4>
<p>Yeah, you are correct <span aria-label="check" class="emoji emoji-2705" role="img" title="check">:check:</span> I implemented things in a different order and forgot to update my original implementation.</p>



<a name="555552311"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Compiler%20task/near/555552311" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anton <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Compiler.20task.html#555552311">(Nov 14 2025 at 10:27)</a>:</h4>
<p>I'll fix it</p>



<a name="555553970"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Compiler%20task/near/555553970" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anton <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Compiler.20task.html#555553970">(Nov 14 2025 at 10:35)</a>:</h4>
<p>I know why I did not call builtins.str.strConcat, I removed the call to builtins.list.listConcat in my hacky fix branch fix-low-level-interp-failures to make it work.</p>



<a name="555554072"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Compiler%20task/near/555554072" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anton <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Compiler.20task.html#555554072">(Nov 14 2025 at 10:36)</a>:</h4>
<p>Let's pause the addition of builtins until <span class="user-mention" data-user-id="281383">@Richard Feldman</span> can get a proper fix for src/eval/test/low_level_interp_test.zig in place.</p>



<a name="555559714"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Compiler%20task/near/555559714" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Norbert Hajagos <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Compiler.20task.html#555559714">(Nov 14 2025 at 11:01)</a>:</h4>
<p>I'm planning to work on builtins after work hours today. Is this a blocker because tests can't pass, or something more fundamental?</p>



<a name="555565079"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Compiler%20task/near/555565079" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anton <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Compiler.20task.html#555565079">(Nov 14 2025 at 11:31)</a>:</h4>
<p>Adding implementations to the interpreter using the existing ones as a guide seems counterproductive given that the existing ones do not work.</p>



<a name="555579837"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Compiler%20task/near/555579837" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Norbert Hajagos <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Compiler.20task.html#555579837">(Nov 14 2025 at 12:52)</a>:</h4>
<p>I see. Will just poke the compiler here and there to see how things work.</p>



<a name="556894673"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Compiler%20task/near/556894673" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Edwin Santos <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Compiler.20task.html#556894673">(Nov 17 2025 at 17:44)</a>:</h4>
<p>Hi, just wanted to update that I'm currently working on implementations/tests for:<br>
Str.repeat<br>
Str.with_suffix<br>
Str.drop_suffix<br>
Str.drop_prefix</p>
<p>Will just tinker with other stuff while waiting for the low level interpreter tests to be unblocked.</p>



<a name="556897254"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Compiler%20task/near/556897254" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Edwin Santos <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Compiler.20task.html#556897254">(Nov 17 2025 at 17:57)</a>:</h4>
<p>2 Questions:</p>
<p>I've noticed that for a lot of the string functions, Str.decref is called on certain paths but not on others, and .incref is seldom called (in str.zig, just in strSplitOnHelp). Could someone explain a bit what the procedure is for handling the refcount? I understand not needing to alter it when you're returning newly allocated strings for example, but some which return slices like the trim methods don't seem to be explicitly increasing the refcount which i'm a lil confused about.</p>
<p>2nd question, is it safe if you uniquely hold a string to shift it's bytes pointer and decrease it's capacity to shorten the string's "window" from the front?  strTrimStart trims the front by creating a new RocStr with a shifted bytes pointer (but the capacity_or_alloc_ptr is the original one). Shifting the pointer and decreasing the capacity accordingly if the string is unique and not a slice and returning the same input string seems like a viable route on my naive understanding. Not ultra familiar with low-level so not sure if that's dangerous tho <span aria-label="sweat smile" class="emoji emoji-1f605" role="img" title="sweat smile">:sweat_smile:</span></p>



<a name="556898986"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Compiler%20task/near/556898986" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Norbert Hajagos <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Compiler.20task.html#556898986">(Nov 17 2025 at 18:05)</a>:</h4>
<p>I'm not familiar with low level as well, but from what I understand, as long as the refcount is 1, you can do whatever you want with it. So yeah, I think you got q2 nailed down. I need to run and I don't have an immadiate answer to q1.</p>



<a name="556900245"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Compiler%20task/near/556900245" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Edwin Santos <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Compiler.20task.html#556900245">(Nov 17 2025 at 18:13)</a>:</h4>
<p>Yeah, I assume that my idea from q2 from shifting the bytes pointer + changing the capacity when RocStr is Unique + not a slice is probably not that much faster than allocating a RocStr with those couple pointers but if this is sound/not dangerous it'd be good to throw in. Mostly wasn't sure if this would actually set off a grenade or something haha.</p>



<a name="556901467"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Compiler%20task/near/556901467" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Edwin Santos <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Compiler.20task.html#556901467">(Nov 17 2025 at 18:19)</a>:</h4>
<p>Also on q1 when someone has a chance to give a definitive answer, are increments happening before calling these functions and decrements happening inside the functions (under the right circumstances)? I'm thinking of something like strTrim where if the entire string would be trimmed (in the first couple lines), an empty string is returned and the input string is decref'd. This makes sense to me if the string's refcount is incremented prior to it being passed to the function (the function doesn't increment the refcount beforehand), but if not then I'm a little lost why the function would decrement the refcount on that path.</p>
<p>Increments before being passed into functions or auto-refcounting like a Rust RC pointer was my hypothesis on why there's so many decrefs without increfs but wanted to check if this is on the right track.</p>



<a name="556911798"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Compiler%20task/near/556911798" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Norbert Hajagos <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Compiler.20task.html#556911798">(Nov 17 2025 at 19:16)</a>:</h4>
<p>1 thing I'm not sure about is whether that would lead to problems when we are freeing the str. I don't have time today, sorry for just dropping in vague advices. Follow the decref method in RocStr and see if it would cause problems that the bytes pointer points to further ahead than the original allocation.</p>



<a name="556931931"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Compiler%20task/near/556931931" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Compiler.20task.html#556931931">(Nov 17 2025 at 21:16)</a>:</h4>
<p>I should be able to give answers, just don't have time right now. Will try to loop back in a few hours</p>



<a name="556933249"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Compiler%20task/near/556933249" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Edwin Santos <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Compiler.20task.html#556933249">(Nov 17 2025 at 21:26)</a>:</h4>
<p>Thanks! No rush, was just asking questions on my lunch break haha.</p>



<a name="556965796"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Compiler%20task/near/556965796" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Compiler.20task.html#556965796">(Nov 18 2025 at 02:17)</a>:</h4>
<blockquote>
<p>I've noticed that for a lot of the string functions, Str.decref is called on certain paths but not on others, and .incref is seldom called (in str.zig, just in strSplitOnHelp).</p>
</blockquote>
<p>In roc, each builtin low level function specifies whether or not it takes the input <a href="https://github.com/roc-lang/roc/blob/6e50ca09fa8c0485cabe85b39a886228c80008ee/crates/compiler/mono/src/inc_dec.rs#L1260-L1368">via ownership or via reference</a> (only implemented in the old compiler currently).</p>
<p>Generally speaking, if there is any chance of mutation, they pick ownership. The roc compiler we automatically generate <code>incref</code> calls before calling the function if needed. This enables the compiler to automatically optimize away incref calls if they aren't needed. <br>
Instead of:</p>
<div class="codehilite" data-code-language="Ruby"><pre><span></span><code><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"some long string with refcount"</span>
<span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">call_builtin</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="c1"># builtin internally calls incref</span>
<span class="n">decref</span><span class="w"> </span><span class="n">x</span>
</code></pre></div>
<p>we generate:</p>
<div class="codehilite" data-code-language="Ruby"><pre><span></span><code><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"some long string with refcount"</span>
<span class="c1"># Already unique ownership, no need to call incref here</span>
<span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">call_builtin</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="c1"># Builtin took ownership (and maybe called decref), no need to call decref here</span>
</code></pre></div>



<a name="556965876"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Compiler%20task/near/556965876" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Compiler.20task.html#556965876">(Nov 18 2025 at 02:18)</a>:</h4>
<blockquote>
<p>Could someone explain a bit what the procedure is for handling the refcount?</p>
</blockquote>
<p>I am not sure how things are wired into the interpreter, currently, but likely, it should follow a similar partern. Explicitly have a list of functions that take the RocStr by ownership and for that list call incref before calling the builtin low level function. This will avoid needing two versions of the builtins (one for the interpreter and one for linking to compiled applications)</p>



<a name="556965977"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Compiler%20task/near/556965977" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Compiler.20task.html#556965977">(Nov 18 2025 at 02:20)</a>:</h4>
<blockquote>
<p>but some which return slices like the trim methods don't seem to be explicitly increasing the refcount which i'm a lil confused about.</p>
</blockquote>
<p>Yeah, given trim expects to mutate it takes by ownership. Then it trims and returns a slice (which just passes on the ownership).</p>



<a name="556966459"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Compiler%20task/near/556966459" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Compiler.20task.html#556966459">(Nov 18 2025 at 02:24)</a>:</h4>
<blockquote>
<p>2nd question, is it safe if you uniquely hold a string to shift it's bytes pointer and decrease it's capacity to shorten the string's "window" from the front?</p>
</blockquote>
<p>No. Cause when you go to free the string you would free the wrong bytes.</p>
<blockquote>
<p>strTrimStart trims the front by creating a new RocStr with a shifted bytes pointer (but the capacity_or_alloc_ptr is the original one).</p>
</blockquote>
<p>If I understand your comment correctly, that is not actually a new RocStr. That is a seamless slice. Essentially, it is a reference to the original string that still knows about the original allocation so it can free it.</p>
<p>The other option would be to keep it as a regular string but memcpy the entire string over to remove the trimmed bytes.</p>
<p>That said, I didn't double check the code here, so I may be missing something with how it is setup currently.</p>



<a name="556966636"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Compiler%20task/near/556966636" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Compiler.20task.html#556966636">(Nov 18 2025 at 02:26)</a>:</h4>
<p>Yeah, I'm pretty sure from a quick skim of the code that StrTrimStart will never allocate. It will return a shifted small string or a seamless slice. Technically if the string is unique, we could shift it instead of creating a seamless slice, but that is not clearly worth it.</p>



<a name="556966770"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Compiler%20task/near/556966770" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Compiler.20task.html#556966770">(Nov 18 2025 at 02:28)</a>:</h4>
<blockquote>
<p>Also on q1 when someone has a chance to give a definitive answer, are increments happening before calling these functions and decrements happening inside the functions (under the right circumstances)?</p>
</blockquote>
<p>Yep, exactly. Not actually sure the state of this in the interpreter though. But we need to add it if it is not currently working.</p>



<a name="556966813"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Compiler%20task/near/556966813" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Compiler.20task.html#556966813">(Nov 18 2025 at 02:29)</a>:</h4>
<p>Hopefully that gives some base answers.</p>



<a name="556966822"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Compiler%20task/near/556966822" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Compiler.20task.html#556966822">(Nov 18 2025 at 02:29)</a>:</h4>
<p>Feel free to ask more questions or for clarifications.</p>



<a name="556969950"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Compiler%20task/near/556969950" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Compiler.20task.html#556969950">(Nov 18 2025 at 03:11)</a>:</h4>
<p>Have we got these builtins wired into the interpreter yet? It's been a few weeks since I checked, but I thought that was what Richard is currently working on</p>



<a name="556970084"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Compiler%20task/near/556970084" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Compiler.20task.html#556970084">(Nov 18 2025 at 03:13)</a>:</h4>
<p>I'm not sure the exact state. I know richard was working on getting the infrastructure in to add builtins. Then he want other folks to add more builtins.</p>



<a name="556970263"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Compiler%20task/near/556970263" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Compiler.20task.html#556970263">(Nov 18 2025 at 03:15)</a>:</h4>
<p>Ahk, cool. I can see we are using these builtins already in some places.</p>



<a name="556970321"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Compiler%20task/near/556970321" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Compiler.20task.html#556970321">(Nov 18 2025 at 03:16)</a>:</h4>
<p>All the action is in <code>callLowLevelBuiltin</code> in src/eval/interpreter.zig</p>



<a name="557995341"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Compiler%20task/near/557995341" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Edwin Santos <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Compiler.20task.html#557995341">(Nov 18 2025 at 17:08)</a>:</h4>
<p><span class="user-mention" data-user-id="343810">@Brendan Hansknecht</span> Thanks so much for the explanation, this clarifies a lot. Also currently it looks like most of the standard lib str functions are taking RocStr by value instead of by reference. Also yeah I was thinking that changing the pointer to the original allocation might end up mucking something up when memory is being freed, I guess one way to put it is that there always needs to be a pointer to the beginning of the original allocation to ensure it's eventually correctly deallocated. Super helpful!</p>



<a name="557995690"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Compiler%20task/near/557995690" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Edwin Santos <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Compiler.20task.html#557995690">(Nov 18 2025 at 17:09)</a>:</h4>
<p><span class="user-mention silent" data-user-id="515757">Luke Boswell</span> <a href="#narrow/channel/316715-contributing/topic/Compiler.20task/near/556969950">said</a>:</p>
<blockquote>
<p>Have we got these builtins wired into the interpreter yet? It's been a few weeks since I checked, but I thought that was what Richard is currently working on</p>
</blockquote>
<p>Currently I think we're waiting on some failing tests for low_level_interp to be fixed, we're starting to work out the actual functions in builtins/ but integrating them with the interpreter is the main blocker before we can PR additions to the builtins.</p>



<a name="557996467"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Compiler%20task/near/557996467" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Edwin Santos <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Compiler.20task.html#557996467">(Nov 18 2025 at 17:13)</a>:</h4>
<p>One more quick question, if you have a function returning a substring from a RocStr (any of them like drop_prefix, trim, etc), do y'all think it'd be more optimal to return a smallstr instead of a seamless slice if the string would fit into a smallstr? Currently the trim functions for example are mostly returning slices but wasn't sure if it might be a little better to try to pack them into smallstr's if possible since the resulting RocStr would be fully on stack. Maybe the memcopy is such that this wouldn't make a huge difference tho.</p>



<a name="558005362"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Compiler%20task/near/558005362" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Norbert Hajagos <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Compiler.20task.html#558005362">(Nov 18 2025 at 17:50)</a>:</h4>
<p>I think if it fits into a small string then it should be that. No extra pointer chasing when accessing it. I assume the time saved to access those strings possibly multiple times outweighs the cost of creating them.</p>
<p>It also unlocks further optimizations later, . Example: <br>
The program can call <code>my_small_str.with_acsii_bytes_uppercased()</code> and when that built-in sees a small string, it will uppercase the bytes and return a small string. When it sees a non-small string, it will not assume that it could return a small string after uppercasing, since that function does not reduce the size of the string.</p>



<a name="558011553"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Compiler%20task/near/558011553" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Compiler.20task.html#558011553">(Nov 18 2025 at 18:16)</a>:</h4>
<blockquote>
<p>RocStr by value instead of by reference</p>
</blockquote>
<p>So this is where wording is a bit confusing cause there is value/reference as in <code>RocStr</code>/<code>&amp;RocStr</code>. and there is owned/reference as in calling <code>incref</code> before calling a function or just calling the function.</p>
<p>In general <code>RocStr</code> should always be passed by value as <code>RocStr</code> instead of <code>&amp;RocStr</code> or <code>*RocStr</code>.</p>
<p>When it comes to owned/reference, that is what depends on the specific function. If the function is read only. (like Str.len), it should be by reference. If the function wants to mutate (or return a referencing subslice), it should be owned.</p>



<a name="558012535"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Compiler%20task/near/558012535" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Compiler.20task.html#558012535">(Nov 18 2025 at 18:21)</a>:</h4>
<blockquote>
<p>I guess one way to put it is that there always needs to be a pointer to the beginning of the original allocation to ensure it's eventually correctly deallocated</p>
</blockquote>
<p>Exactly</p>



<a name="558013344"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Compiler%20task/near/558013344" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Compiler.20task.html#558013344">(Nov 18 2025 at 18:25)</a>:</h4>
<blockquote>
<p>if you have a function returning a substring from a RocStr (any of them like drop_prefix, trim, etc), do y'all think it'd be more optimal to return a smallstr instead of a seamless slice if the string would fit into a smallstr?</p>
</blockquote>
<p>The answer is sadly, "it depends" in my testing.</p>
<p>A lot of times, the substring is used in a way that the copy is not worth it. It is short lifetime and the main string is still in cache. From my limited testing, this is most common. So the copy is not worth it.</p>
<p>The longer the slice stays around the more it is worthwhile to copy. Copying means you might be able to free the original string (reduced memory overhead); you don't have to worry about things falling out of cache; and you avoid a pointer round trip.</p>
<p>Especially with the functions that return many strings (like splitting by spaces), I saw returning slices as a really large gain in genereal. For the trim and drop functions... I'm not really sure what is best. This is where you would really prefer to have tons of real world cases running in CI on a lot of different hardware to measure.</p>



<a name="558013686"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Compiler%20task/near/558013686" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Compiler.20task.html#558013686">(Nov 18 2025 at 18:27)</a>:</h4>
<blockquote>
<p>my_small_str.with_acsii_bytes_uppercased()</p>
</blockquote>
<p>If it sees a slice. It should first make the slice unique. Which will turn it into a small string. Then it will uppercase. So it really is just a lazy copy instead of a copy right at the beginning. That said, in a perfect world, it would see the slice and then generate a new small string that uppercases as it copies and would perform one less iteration overall. So I think (ignoring a cache miss), the slice has more opportunities to be performant than creating a small string first.</p>



<a name="558014196"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Compiler%20task/near/558014196" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Compiler.20task.html#558014196">(Nov 18 2025 at 18:30)</a>:</h4>
<p>Yeah, looks like that function technically has an extra iteration right now that we could avoid. It first copies then it uppercases. It could do both at the same time.</p>



<a name="558022284"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Compiler%20task/near/558022284" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Norbert Hajagos <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Compiler.20task.html#558022284">(Nov 18 2025 at 19:11)</a>:</h4>
<p>Where'd we be without you Brendan? <span aria-label="smile" class="emoji emoji-1f604" role="img" title="smile">:smile:</span> Always a pleasure to read your performance insights.</p>



<a name="558099199"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Compiler%20task/near/558099199" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Compiler.20task.html#558099199">(Nov 19 2025 at 01:43)</a>:</h4>
<p>I'm glad I can at least answer questions even if not contributing to roc significantly in code.</p>



<a name="558929850"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Compiler%20task/near/558929850" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Compiler.20task.html#558929850">(Nov 23 2025 at 23:14)</a>:</h4>
<p>ok I just got low_level_interp fixed finally - that took way longer than anticipated! <span aria-label="sweat smile" class="emoji emoji-1f605" role="img" title="sweat smile">:sweat_smile:</span></p>



<a name="558929863"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Compiler%20task/near/558929863" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Compiler.20task.html#558929863">(Nov 23 2025 at 23:15)</a>:</h4>
<p>I believe adding more builtins should now be unblocked but lmk if you hit anything!</p>



<a name="558930033"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Compiler%20task/near/558930033" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Compiler.20task.html#558930033">(Nov 23 2025 at 23:19)</a>:</h4>
<p>I want to try and get my zig template online... that should be nice an minimal</p>



<a name="558993200"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Compiler%20task/near/558993200" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anton <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Compiler.20task.html#558993200">(Nov 24 2025 at 09:45)</a>:</h4>
<p>Is that the zig platform template?</p>



<a name="558998993"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Compiler%20task/near/558998993" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Compiler.20task.html#558998993">(Nov 24 2025 at 10:09)</a>:</h4>
<p>Yup, that's the one</p>



<a name="558999168"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Compiler%20task/near/558999168" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Compiler.20task.html#558999168">(Nov 24 2025 at 10:10)</a>:</h4>
<p>I've been getting distracted just trying out the new compiler with that fx test platform... so cool</p>



<a name="559094312"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Compiler%20task/near/559094312" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anton <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Compiler.20task.html#559094312">(Nov 24 2025 at 16:29)</a>:</h4>
<p>Str.concat is <a href="https://github.com/roc-lang/roc/commit/977a26b7036479789d583744ff86f80a0adfc714">done</a></p>



<a name="559095440"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Compiler%20task/near/559095440" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Compiler.20task.html#559095440">(Nov 24 2025 at 16:33)</a>:</h4>
<p>nice, that's a very nice template for other things people might want to add <span aria-label="smiley" class="emoji emoji-1f603" role="img" title="smiley">:smiley:</span></p>



<a name="560051708"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Compiler%20task/near/560051708" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dan G Knutson <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Compiler.20task.html#560051708">(Nov 25 2025 at 01:29)</a>:</h4>
<p>I've got a version of Str.trim on a branch following that formula. Could I get permissions to push a branch? I had them on a previous OS/gpg key, but haven't contributed in a while. I'm 'giesch' on github.</p>



<a name="560052126"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Compiler%20task/near/560052126" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Compiler.20task.html#560052126">(Nov 25 2025 at 01:34)</a>:</h4>
<p>Hey <span class="user-mention" data-user-id="430894">@Dan G Knutson</span> great to see you again -- hyped to update our graphics / gaming platform soon <span aria-label="smiley" class="emoji emoji-1f603" role="img" title="smiley">:smiley:</span></p>



<a name="560265679"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Compiler%20task/near/560265679" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthieu Pizenberg <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Compiler.20task.html#560265679">(Nov 25 2025 at 22:48)</a>:</h4>
<p>Hi, is this a good minimal PR to look at to learn how to add a builtin? <a href="https://github.com/roc-lang/roc/pull/8436">https://github.com/roc-lang/roc/pull/8436</a><br>
Any documentation elsewhere? I might look into adding builtins for integers if I get the time.</p>



<a name="560265711"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Compiler%20task/near/560265711" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Compiler.20task.html#560265711">(Nov 25 2025 at 22:48)</a>:</h4>
<p>Yes I think so</p>



<a name="560277912"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Compiler%20task/near/560277912" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Edwin Santos <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Compiler.20task.html#560277912">(Nov 26 2025 at 00:50)</a>:</h4>
<p>Hi y'all, in a bit I'm going to setup a PR for Str.drop_prefix, drop_suffix, repeat, and with_prefix. Could someone give it a review once it's up? On drop_prefix specifically I'm getting an issue with the refcount I think that's causing a segfault and Not sure what to do. I structured drop_prefix like the Trim functions so I'm having a hard time debugging what could be going wrong.</p>
<p>Will put up a PR soon!</p>



<a name="560277954"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Compiler%20task/near/560277954" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Compiler.20task.html#560277954">(Nov 26 2025 at 00:50)</a>:</h4>
<p>I've got a draft PR up with those <a href="https://github.com/roc-lang/roc/pull/8440">https://github.com/roc-lang/roc/pull/8440</a></p>



<a name="560278022"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Compiler%20task/near/560278022" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Compiler.20task.html#560278022">(Nov 26 2025 at 00:51)</a>:</h4>
<p>ahk haven't pushed all of those yet</p>



<a name="560278074"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Compiler%20task/near/560278074" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Edwin Santos <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Compiler.20task.html#560278074">(Nov 26 2025 at 00:51)</a>:</h4>
<p>Should I keep going with my implementation or just leave it to you?</p>



<a name="560278137"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Compiler%20task/near/560278137" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Compiler.20task.html#560278137">(Nov 26 2025 at 00:52)</a>:</h4>
<p>Well Claude and I will probably be done in like 5 mins -- would you be happy to give it a review?</p>



<a name="560278244"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Compiler%20task/near/560278244" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Edwin Santos <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Compiler.20task.html#560278244">(Nov 26 2025 at 00:53)</a>:</h4>
<p>I'd be happy to give it a review, I don't know if I have permissions to approve PRs into main tho.</p>



<a name="560278286"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Compiler%20task/near/560278286" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Compiler.20task.html#560278286">(Nov 26 2025 at 00:53)</a>:</h4>
<p>That's ok, just leave a comment if you seen anything strange or if you think it looks good</p>



<a name="560278351"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Compiler%20task/near/560278351" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Edwin Santos <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Compiler.20task.html#560278351">(Nov 26 2025 at 00:54)</a>:</h4>
<p>Sure!</p>



<a name="560278378"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Compiler%20task/near/560278378" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Compiler.20task.html#560278378">(Nov 26 2025 at 00:54)</a>:</h4>
<p>I think that PR is good for a review now, I'm going to start on the other <code>Str</code> builtins in another PR now</p>



<a name="560280613"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Compiler%20task/near/560280613" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Edwin Santos <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Compiler.20task.html#560280613">(Nov 26 2025 at 01:15)</a>:</h4>
<p>Other than string builtins are there any other builtins or core compiler functions to build out before December 1st?</p>



<a name="560282654"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Compiler%20task/near/560282654" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Compiler.20task.html#560282654">(Nov 26 2025 at 01:35)</a>:</h4>
<p>Yeah there's a lot, like <code>Set</code> <code>Dict</code> lots of <code>List</code> ones</p>



<a name="560282745"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Compiler%20task/near/560282745" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Compiler.20task.html#560282745">(Nov 26 2025 at 01:36)</a>:</h4>
<p>We had a loose coordination thing going for a while where we all posted in the <a class="stream-topic" data-stream-id="316715" href="/#narrow/channel/316715-contributing/topic/Worklog.20.28Draft.20PRs.20and.20coordination.29/with/560271500">#contributing &gt; Worklog (Draft PRs and coordination)</a> channel before starting work, and make a draft PR</p>



<a name="560282803"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Compiler%20task/near/560282803" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Compiler.20task.html#560282803">(Nov 26 2025 at 01:37)</a>:</h4>
<p>But for a little while now it's only really been a smaller handful of people contributing so that practice dropped off a little</p>



<a name="560282897"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Compiler%20task/near/560282897" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Compiler.20task.html#560282897">(Nov 26 2025 at 01:37)</a>:</h4>
<p>My approach is looking at the old docs <a href="https://www.roc-lang.org/builtins">https://www.roc-lang.org/builtins</a> and then diffing against the src/build/roc/Builtin.roc implementations.</p>



<a name="560283026"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Compiler%20task/near/560283026" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Compiler.20task.html#560283026">(Nov 26 2025 at 01:39)</a>:</h4>
<p>Will set and dict not just stay in pure roc (at least for now, built on top of list).</p>



<a name="560283060"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Compiler%20task/near/560283060" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Compiler.20task.html#560283060">(Nov 26 2025 at 01:39)</a>:</h4>
<p>I guess so?? I haven't looked at them yet</p>



<a name="560283094"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Compiler%20task/near/560283094" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Compiler.20task.html#560283094">(Nov 26 2025 at 01:39)</a>:</h4>
<p>There's a body of work there I guess to translate that implementation over then?</p>



<a name="560283114"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Compiler%20task/near/560283114" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Compiler.20task.html#560283114">(Nov 26 2025 at 01:39)</a>:</h4>
<p>Yeah. Makes sense</p>



<a name="560283156"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Compiler%20task/near/560283156" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Compiler.20task.html#560283156">(Nov 26 2025 at 01:40)</a>:</h4>
<p>From e.g. crates/compiler/builtins/roc/Dict.roc and crates/compiler/builtins/roc/Set.roc</p>



<a name="560283235"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Compiler%20task/near/560283235" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Compiler.20task.html#560283235">(Nov 26 2025 at 01:40)</a>:</h4>
<p>I guess it does require a few different pieces. List has to have enough buiiltins complete. Hash needs to be implemented (which may require compiler magic). Eq has to be implemented as well if it doesn't already auto derive.</p>



<a name="560283264"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Compiler%20task/near/560283264" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Compiler.20task.html#560283264">(Nov 26 2025 at 01:41)</a>:</h4>
<p>So might be a few steps, but core work will be porting otherwise.</p>



<a name="560283307"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Compiler%20task/near/560283307" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Compiler.20task.html#560283307">(Nov 26 2025 at 01:41)</a>:</h4>
<p>I think <span class="user-mention" data-user-id="281383">@Richard Feldman</span> is fixing Eq as we speak</p>



<a name="560288187"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Compiler%20task/near/560288187" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Compiler.20task.html#560288187">(Nov 26 2025 at 02:28)</a>:</h4>
<p>yep!</p>



<a name="560288240"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Compiler%20task/near/560288240" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Compiler.20task.html#560288240">(Nov 26 2025 at 02:29)</a>:</h4>
<p>I haven't done anything with hash or sort</p>



<a name="560289555"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Compiler%20task/near/560289555" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Compiler.20task.html#560289555">(Nov 26 2025 at 02:43)</a>:</h4>
<p>If Eq works, I assume those should be similar to implement at least.</p>



<a name="560322089"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Compiler%20task/near/560322089" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Devin Prothero <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Compiler.20task.html#560322089">(Nov 26 2025 at 07:39)</a>:</h4>
<p>Hey I was trying to run a little fibonacci function and got a crash.<br>
Looks like some kind of stack overflow exception is thrown for fib(N) where N &gt; 5</p>
<div class="codehilite"><pre><span></span><code>fib = |n|
    if n &lt;= 1 {
        n
    } else {
        fib(n - 1) + fib(n - 2)
    }
</code></pre></div>
<p>Is it alright if I look into this further. I don't want to step on any toes if someone is already working on stuff related to this. I can also open an issue.</p>



<a name="560350385"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Compiler%20task/near/560350385" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anton <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Compiler.20task.html#560350385">(Nov 26 2025 at 10:08)</a>:</h4>
<blockquote>
<p>Is it alright if I look into this further.</p>
</blockquote>
<p>Go ahead :)</p>
<blockquote>
<p>I can also open an issue.</p>
</blockquote>
<p>Yes, that's handy for tracking. I recommend starting with getting a backtrace with gdb, that will show you the function call chain that triggered the segfault.</p>



<a name="560353251"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Compiler%20task/near/560353251" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Compiler.20task.html#560353251">(Nov 26 2025 at 10:22)</a>:</h4>
<p>We dont have tail call optimisation yet  I think the plan is to implement trmc again</p>



<a name="560353369"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Compiler%20task/near/560353369" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Compiler.20task.html#560353369">(Nov 26 2025 at 10:22)</a>:</h4>
<p>There might be some hardcoded limit in the interpreter that's like way off</p>



<a name="560497010"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Compiler%20task/near/560497010" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Compiler.20task.html#560497010">(Nov 27 2025 at 00:17)</a>:</h4>
<p><code>List</code> builtins are open if anyone's interested - and also a ton of them can be implemented without needing to write any Zig logic (other than maybe some boilerplate you can copy/paste from other example PRs)</p>



<a name="560500338"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Compiler%20task/near/560500338" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Andres Villegas <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Compiler.20task.html#560500338">(Nov 27 2025 at 01:08)</a>:</h4>
<p>Is the idea to implement all the missing function in <a href="https://www.roc-lang.org/builtins/alpha4/List/">https://www.roc-lang.org/builtins/alpha4/List/</a>? I think I could take some of them but I am unsure which ones to implement, including the ones that require Zig</p>



<a name="560500371"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Compiler%20task/near/560500371" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Compiler.20task.html#560500371">(Nov 27 2025 at 01:08)</a>:</h4>
<p>Yeah basically -- there are some differences like Numbers have changed significantly</p>



<a name="560500403"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Compiler%20task/near/560500403" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Compiler.20task.html#560500403">(Nov 27 2025 at 01:08)</a>:</h4>
<p>I think with static dispatch the way we do encoding and decoding also changes a lot</p>



<a name="560500438"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Compiler%20task/near/560500438" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Compiler.20task.html#560500438">(Nov 27 2025 at 01:09)</a>:</h4>
<p>Ah, for List I think it's pretty much 1-1</p>



<a name="560500486"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Compiler%20task/near/560500486" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Andres Villegas <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Compiler.20task.html#560500486">(Nov 27 2025 at 01:10)</a>:</h4>
<p>Also, from one recent video I saw on roc, I guess walk and what not is not necessary? and will be replaced by just "for loops"?</p>



<a name="560500530"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Compiler%20task/near/560500530" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Andres Villegas <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Compiler.20task.html#560500530">(Nov 27 2025 at 01:10)</a>:</h4>
<p>Will try to spend most of tomorrow and friday implementing some</p>



<a name="560501234"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Compiler%20task/near/560501234" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Compiler.20task.html#560501234">(Nov 27 2025 at 01:20)</a>:</h4>
<p>yeah we already have <code>fold</code> and will get <code>fold_rev</code> (aka <code>foldr</code>) and that's it</p>



<a name="560512586"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Compiler%20task/near/560512586" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Edwin Santos <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Compiler.20task.html#560512586">(Nov 27 2025 at 04:02)</a>:</h4>
<p>Hey y'all, I'm trying to implement List.any and with the following</p>
<blockquote>
<div class="codehilite"><pre><span></span><code>    any : List(a), (a -&gt; Bool) -&gt; Bool
    any = |list, predicate| {
        for item in list {
            if predicate(item) {
                return True
            }
        }
        False
    }
</code></pre></div>

</blockquote>
<p>But am getting the following compiler error:</p>
<blockquote>
<p>This if has no else branch, but it's being used as an expression (assigned to a variable, passed to a function, etc.).</p>
<p>You can only use if without else when it's a statement. When if is used as an expression that evaluates to a value, else is required because otherwise there wouldn't always be a value available.</p>
<p>Either add an else branch, or use this if as a standalone statement.</p>
</blockquote>
<p>Are early returns not supposed to be used this way? I tried to look for other examples of early returns in .roc files in the code base but i don't think there were any. I had a working version of List.any using fold but thought this would be preferable if early return is working.</p>



<a name="560512950"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Compiler%20task/near/560512950" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Compiler.20task.html#560512950">(Nov 27 2025 at 04:08)</a>:</h4>
<p>that code ought to work</p>



<a name="560512970"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Compiler%20task/near/560512970" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Compiler.20task.html#560512970">(Nov 27 2025 at 04:08)</a>:</h4>
<p>looks like a compiler bug! I'll dig into this tomorrow</p>



<a name="560513592"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Compiler%20task/near/560513592" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Edwin Santos <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Compiler.20task.html#560513592">(Nov 27 2025 at 04:18)</a>:</h4>
<p>Sounds good! Thought something might be awry.</p>



<a name="560517129"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Compiler%20task/near/560517129" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Compiler.20task.html#560517129">(Nov 27 2025 at 05:04)</a>:</h4>
<p><span class="user-mention" data-user-id="986975">@Edwin Santos</span> <a href="https://github.com/roc-lang/roc/pull/8468">https://github.com/roc-lang/roc/pull/8468</a> fixes this</p>



<a name="560522107"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Compiler%20task/near/560522107" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Andres Villegas <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Compiler.20task.html#560522107">(Nov 27 2025 at 06:15)</a>:</h4>
<p>Dig a bit on the code, are the built-ins only implemented for the "interpreter" backend at the moment? For example, If I want to expose, <code>List.with_capacity</code> I will need to make sure it is implemented in <code>src/builtins/list.zig</code> (it is), then it is added to roc/Builtin.roc, added it to the low_level_map on the build/builtin_compiler, and then do its implementation in <code>src/eval/interpreter.zig</code>?</p>



<a name="560522204"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Compiler%20task/near/560522204" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Compiler.20task.html#560522204">(Nov 27 2025 at 06:16)</a>:</h4>
<p>Yeah that sounds right</p>



<a name="560522222"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Compiler%20task/near/560522222" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Compiler.20task.html#560522222">(Nov 27 2025 at 06:17)</a>:</h4>
<p>We aren't lowering to machine code yet</p>



<a name="560587448"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Compiler%20task/near/560587448" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Compiler.20task.html#560587448">(Nov 27 2025 at 12:40)</a>:</h4>
<p>yeah we explicitly decided to wait until 2026 to do that, since there was no chance we'd have anything working for Advent of Code if machine code were in scope <span aria-label="smile" class="emoji emoji-1f604" role="img" title="smile">:smile:</span></p>



<a name="560649330"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Compiler%20task/near/560649330" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Andres Villegas <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Compiler.20task.html#560649330">(Nov 27 2025 at 17:50)</a>:</h4>
<p>How would you test that List.with_capacity does the right thing in an integration test. is there a way to get the capacity of a list, or should I have a private builtin like <code>list_get_capacity_unsafe</code> to be able to test?</p>



<a name="560652810"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Compiler%20task/near/560652810" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anton <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Compiler.20task.html#560652810">(Nov 27 2025 at 18:13)</a>:</h4>
<p>Good question! Personally, I would verify that the capacity is correct in a unit test and in the integration test I would just check that you get back an empty list.</p>



<a name="560654359"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Compiler%20task/near/560654359" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Compiler.20task.html#560654359">(Nov 27 2025 at 18:27)</a>:</h4>
<p>The best way to test it (in my opinion) would be with an instrumented roc alloc. Since we have to pass it into roc anyway, we could modify it to validate the allocation.</p>
<p>Not sure if our tests are setup for that though. Would have to be a special test, not just something run with <code>roc test</code>.</p>
<hr>
<p>But yeah, a zig level unit test is probably best otherwise.</p>



<a name="560664383"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Compiler%20task/near/560664383" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Edwin Santos <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Compiler.20task.html#560664383">(Nov 27 2025 at 19:56)</a>:</h4>
<p>Hey, taking a look at implementing List.append in Zig, is there a preference to base it off ListAppend or PushInPlace from list.zig? Looks like it could be either.<br>
<a href="/user_uploads/22008/StvXAcmb2jZy7aiw1jbtzZvP/image.png">image.png</a></p>
<div class="message_inline_image"><a href="/user_uploads/22008/StvXAcmb2jZy7aiw1jbtzZvP/image.png" title="image.png"><img data-original-content-type="image/png" data-original-dimensions="1098x985" src="/user_uploads/thumbnail/22008/StvXAcmb2jZy7aiw1jbtzZvP/image.png/840x560.webp"></a></div>



<a name="560668108"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Compiler%20task/near/560668108" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Andres Villegas <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Compiler.20task.html#560668108">(Nov 27 2025 at 20:36)</a>:</h4>
<p>Will try to tackle List.reserve next</p>



<a name="560672061"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Compiler%20task/near/560672061" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Compiler.20task.html#560672061">(Nov 27 2025 at 21:19)</a>:</h4>
<p><span class="user-mention" data-user-id="986975">@Edwin Santos</span> I would guess ListAppend if that's in list.zig</p>



<a name="560694900"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Compiler%20task/near/560694900" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Compiler.20task.html#560694900">(Nov 28 2025 at 02:03)</a>:</h4>
<p><span class="user-mention" data-user-id="571445">@Andres Villegas</span> <span class="user-mention" data-user-id="986975">@Edwin Santos</span>  can you base your changes on <a href="https://github.com/roc-lang/roc/pull/8477">https://github.com/roc-lang/roc/pull/8477</a> if it hasn't merged yet? I'm gonna try to merge it ASAP because it's a big change that's very prone to merge conflicts <span aria-label="smile" class="emoji emoji-1f604" role="img" title="smile">:smile:</span></p>



<a name="560927604"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Compiler%20task/near/560927604" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Edwin Santos <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Compiler.20task.html#560927604">(Nov 29 2025 at 16:28)</a>:</h4>
<p>Going to add List.drop_at to builtins next.</p>



<a name="560927905"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Compiler%20task/near/560927905" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Edwin Santos <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Compiler.20task.html#560927905">(Nov 29 2025 at 16:32)</a>:</h4>
<p>Also small question, is the goal (in 2026) for al of the builtins in Roc to be rewritten in Zig? Or will some builtin functionality remain in Roc while some remains in Zig? Not sure if that was what the not yet lowering to machine code discussion was about earlier.</p>
<p>Also is <a href="http://List.map">List.map</a> implemented yet?</p>



<a name="560931249"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Compiler%20task/near/560931249" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Compiler.20task.html#560931249">(Nov 29 2025 at 17:26)</a>:</h4>
<p>I just opened a PR for <a href="http://List.map">List.map</a></p>



<a name="560932622"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Compiler%20task/near/560932622" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Compiler.20task.html#560932622">(Nov 29 2025 at 17:47)</a>:</h4>
<p>also another for keep_if/drop_if</p>



<a name="560935690"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Compiler%20task/near/560935690" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Edwin Santos <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Compiler.20task.html#560935690">(Nov 29 2025 at 18:36)</a>:</h4>
<p><span class="user-mention silent" data-user-id="986975">Edwin Santos</span> <a href="#narrow/channel/316715-contributing/topic/Compiler.20task/near/560927604">said</a>:</p>
<blockquote>
<p>Going to add List.drop_at to builtins next.</p>
</blockquote>
<p>Going to tack on List.sublist and a couple other functions to this.</p>



<a name="560950655"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Compiler%20task/near/560950655" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Edwin Santos <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Compiler.20task.html#560950655">(Nov 29 2025 at 22:44)</a>:</h4>
<p>Does anyone have suggestions for handling Records in the interpreter? I tried following what Richard did in the Str.from_utf8 PR by adding identifiers to cannonicalize/ModuleEnv.zig but that resulted in something unrelated failing to deserialize properly. I also tried reading the bytes directly from the record ({start: U64, len: U64}) as is done when creating records in the numeric conversion fns and it works, but it's actually laid out such that len comes before start on StackValue.ptr.*. That route feels brittle but the first is causing unrelated tests to fail so wanted to check if we have a better way of handling Records in StackValues.</p>



<a name="560950804"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Compiler%20task/near/560950804" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Compiler.20task.html#560950804">(Nov 29 2025 at 22:47)</a>:</h4>
<p>Have you seen the <code>RecordAccessor</code> in src/eval/StackValue.zig, maybe that helps?</p>
<div class="codehilite" data-code-language="Zig"><pre><span></span><code><span class="c1">/// Safe accessor for record fields with bounds checking and proper memory management</span>
<span class="kr">pub</span><span class="w"> </span><span class="kr">const</span><span class="w"> </span><span class="n">RecordAccessor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="p">{</span>
</code></pre></div>



<a name="560950902"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Compiler%20task/near/560950902" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Edwin Santos <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Compiler.20task.html#560950902">(Nov 29 2025 at 22:49)</a>:</h4>
<p>Yeah I tried that first but you need a U64 index or Ident.Idx to retrieve the field. When I was searching through Interpreter.zig most of the time the index was retrieved using the Ident.Idx, which is why I tried adding start/len field names to ModuleEnv as Ident.Idx's but that started causing some tests to fail.</p>



<a name="560951106"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Compiler%20task/near/560951106" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Compiler.20task.html#560951106">(Nov 29 2025 at 22:53)</a>:</h4>
<p>Field names are sorted alphabetically I think</p>



<a name="560951154"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Compiler%20task/near/560951154" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Compiler.20task.html#560951154">(Nov 29 2025 at 22:54)</a>:</h4>
<p>I'm not sure what the question is... is the RecordAccessor broken or not consistently used?</p>



<a name="560951285"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Compiler%20task/near/560951285" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Edwin Santos <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Compiler.20task.html#560951285">(Nov 29 2025 at 22:56)</a>:</h4>
<p>Most of the time I've seen values fetched from it, they're fetched out via an Ident.Idx or a index value retrieved from an Indent.Idx, so I wanted to make sure I was handling it correctly and not just putting in indices that seemed right.</p>



<a name="560952219"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Compiler%20task/near/560952219" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Compiler.20task.html#560952219">(Nov 29 2025 at 23:10)</a>:</h4>
<p>If you can test any implementations with <a href="https://github.com/lukewilliamboswell/roc-platform-template-zig">https://github.com/lukewilliamboswell/roc-platform-template-zig</a> I think that would be good. Our fx test platform uses an arena so dealloc's are a noop, while that platform uses a zig gpa -- and reports leaks. I've been hunting down memory leaks and use after frees ect from our builtin implementations</p>



<a name="560952517"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Compiler%20task/near/560952517" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Compiler.20task.html#560952517">(Nov 29 2025 at 23:15)</a>:</h4>
<p>I might look at changing the fx test platform to use a gpa and report leaks also</p>



<a name="560953351"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Compiler%20task/near/560953351" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Compiler.20task.html#560953351">(Nov 29 2025 at 23:34)</a>:</h4>
<p>Basically I think the more tests we can have that exercise refcounting in the interpreter with good debug info etc the better. It's complicated to get that right for every possible combination.</p>



<a name="560954622"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Compiler%20task/near/560954622" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Compiler.20task.html#560954622">(Nov 29 2025 at 23:59)</a>:</h4>
<p>I'm exploring a new build/compile time flag like trace-eval but for tracing refcounts (basically whenever we allocate or dealloc a value we can trace that -- only really to be used for small test programs to help isolate bugs.</p>



<a name="560955359"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Compiler%20task/near/560955359" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Compiler.20task.html#560955359">(Nov 30 2025 at 00:10)</a>:</h4>
<p>added in <a href="https://github.com/roc-lang/roc/pull/8505">https://github.com/roc-lang/roc/pull/8505</a> -- and almost immediately highlighted the issue I was trying to find <span aria-label="smiley" class="emoji emoji-1f603" role="img" title="smiley">:smiley:</span></p>



<a name="560955697"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Compiler%20task/near/560955697" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Compiler.20task.html#560955697">(Nov 30 2025 at 00:17)</a>:</h4>
<p>Fixed the double free <span aria-label="tada" class="emoji emoji-1f389" role="img" title="tada">:tada:</span></p>



<a name="560975258"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Compiler%20task/near/560975258" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Andres Villegas <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Compiler.20task.html#560975258">(Nov 30 2025 at 06:51)</a>:</h4>
<p>Is there some guidance on how to test Builtins. Some Builtins only have snapshot tests, other only e_low_level tests and others only have test in intepreter_style_tests. Is there a rule of thumb of which goes where and why?</p>



<a name="560975439"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Compiler%20task/near/560975439" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Andres Villegas <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Compiler.20task.html#560975439">(Nov 30 2025 at 06:54)</a>:</h4>
<p>BTW I am working on List.last and List.single, just figuring out the tests, seems like anonymous Tags are not supported in the interpreter style tests or I am holding it wrong somehow. I am able to test them using snapshot tests though</p>



<a name="560975738"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Compiler%20task/near/560975738" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Compiler.20task.html#560975738">(Nov 30 2025 at 07:01)</a>:</h4>
<p>I don't think there's any guidance around. I'd say we want some decent coverage. The snapshot tests are really useful because they have the <code>trace-eval</code> which can give you more detailed explanation of what the interpreter is seeing, they're very fast, and offer a more human readable explanation of each compiler stage. The low_level tests are useful because they're in pure zig, but their scope is much more limited in some ways, though they can assert some characteristics the snapshots cant. Finally and probably less preferable is the fx/integration type tests.</p>



<a name="560975831"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Compiler%20task/near/560975831" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Compiler.20task.html#560975831">(Nov 30 2025 at 07:03)</a>:</h4>
<p>So as a general rule I'd say add lots of snapshot tests, some low_level where you need to, and sparingly the integration tests</p>



<hr><p>Last updated: Mar 01 2026 at 12:20 UTC</p>
</html>