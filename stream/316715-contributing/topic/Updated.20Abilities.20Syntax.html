<html>
<head><meta charset="utf-8"><title>Updated Abilities Syntax · contributing · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/index.html">contributing</a></h2>
<h3>Topic: <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Updated.20Abilities.20Syntax.html">Updated Abilities Syntax</a></h3>

<hr>

<base href="https://roc.zulipchat.com">

<head><link href="https://roc-lang.github.io/zulip-export/style.css" rel="stylesheet"></head>

<a name="359382490"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Updated%20Abilities%20Syntax/near/359382490" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bryce Miller <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Updated.20Abilities.20Syntax.html#359382490">(May 18 2023 at 12:30)</a>:</h4>
<p>Over the last couple days I started poking around the compiler to see if I could figure out how to update the abilities syntax. I think I need a hint <span aria-label="upside down" class="emoji emoji-1f643" role="img" title="upside down">:upside_down:</span></p>
<p>Specifically, what part of the compiler identifies specific character sequences in the source file and translates them to AST nodes?</p>



<a name="359397157"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Updated%20Abilities%20Syntax/near/359397157" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Agus Zubiaga <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Updated.20Abilities.20Syntax.html#359397157">(May 18 2023 at 13:29)</a>:</h4>
<p>What you describe is the <code>parse</code> crate in general. I don't know the specifics about the abilities parser but I would start at the <a href="https://github.com/roc-lang/roc/blob/main/crates/compiler/parse/src/type_annotation.rs"><code>type_annotations</code> module</a>.</p>



<a name="359397429"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Updated%20Abilities%20Syntax/near/359397429" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Agus Zubiaga <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Updated.20Abilities.20Syntax.html#359397429">(May 18 2023 at 13:30)</a>:</h4>
<p>For example, <a href="https://github.com/roc-lang/roc/blob/69a487a96afa0a4b2cc0eccbd0592ef10316e00c/crates/compiler/parse/src/type_annotation.rs#L447-L479">here's</a> how the <code>has</code> clause is parsed</p>



<a name="359400150"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Updated%20Abilities%20Syntax/near/359400150" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Agus Zubiaga <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Updated.20Abilities.20Syntax.html#359400150">(May 18 2023 at 13:40)</a>:</h4>
<p>Which is used by <a href="https://github.com/roc-lang/roc/blob/69a487a96afa0a4b2cc0eccbd0592ef10316e00c/crates/compiler/parse/src/type_annotation.rs#L484-L507"><code>has_clause_chain</code></a> to parse <a href="https://github.com/roc-lang/roc/blob/69a487a96afa0a4b2cc0eccbd0592ef10316e00c/crates/compiler/parse/src/type_annotation.rs#L491-L499">one or more of them</a>.</p>



<a name="359400443"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Updated%20Abilities%20Syntax/near/359400443" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Agus Zubiaga <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Updated.20Abilities.20Syntax.html#359400443">(May 18 2023 at 13:41)</a>:</h4>
<p>You can also see the <code>|</code> char <a href="https://github.com/roc-lang/roc/blob/69a487a96afa0a4b2cc0eccbd0592ef10316e00c/crates/compiler/parse/src/type_annotation.rs#LL488C55-L488C59">here</a> which we want to replace by <code>where</code></p>



<a name="359401846"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Updated%20Abilities%20Syntax/near/359401846" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bryce Miller <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Updated.20Abilities.20Syntax.html#359401846">(May 18 2023 at 13:47)</a>:</h4>
<p>Ah ha! I did spend some time digging around in the <code>parse</code> crate, but not quite enough by the looks of it.</p>



<a name="359402392"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Updated%20Abilities%20Syntax/near/359402392" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bryce Miller <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Updated.20Abilities.20Syntax.html#359402392">(May 18 2023 at 13:49)</a>:</h4>
<p>This is very helpful, I think I can change the behavior of the parser now. Once I have that working, I’ll update the various types <code>s/Has/Implements/g</code> Then I can update tests, comments, etc.</p>



<a name="359402799"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Updated%20Abilities%20Syntax/near/359402799" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bryce Miller <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Updated.20Abilities.20Syntax.html#359402799">(May 18 2023 at 13:51)</a>:</h4>
<p>I realize we also want to require curly brackets for new ability definitions but I’m hoping I can make that a separate PR.</p>



<a name="359403264"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Updated%20Abilities%20Syntax/near/359403264" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bryce Miller <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Updated.20Abilities.20Syntax.html#359403264">(May 18 2023 at 13:53)</a>:</h4>
<p>Thanks <span class="user-mention" data-user-id="489294">@Agus Zubiaga</span> !</p>



<a name="359403519"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Updated%20Abilities%20Syntax/near/359403519" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Agus Zubiaga <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Updated.20Abilities.20Syntax.html#359403519">(May 18 2023 at 13:54)</a>:</h4>
<p>Sounds good! Happy to help if you have more specific questions later :)</p>



<a name="359404384"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Updated%20Abilities%20Syntax/near/359404384" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Agus Zubiaga <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Updated.20Abilities.20Syntax.html#359404384">(May 18 2023 at 13:57)</a>:</h4>
<p>As you reading more of the parsing code you'll start to notice some of these helpers everywhere: <code>and!</code>, <code>loc!</code>,<code>wordN</code>, <code>map!</code>, etc.  </p>
<p>These are defined in <a href="https://github.com/roc-lang/roc/blob/main/crates/compiler/parse/src/parser.rs">parser.rs</a>. Looking at how these are implemented really helped me demystify them.</p>



<a name="359408492"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Updated%20Abilities%20Syntax/near/359408492" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Agus Zubiaga <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Updated.20Abilities.20Syntax.html#359408492">(May 18 2023 at 14:12)</a>:</h4>
<p>Oh, also! You can find where things are parsed by opening <a href="https://github.com/roc-lang/roc/blob/main/crates/compiler/parse/src/ast.rs">parse/src/ast.rs</a> and using your editor's <code>Go to References</code> feature. Look at those under <code>crates/compiler/parse/src</code> and you'll find where the AST node is created:</p>
<p><a href="/user_uploads/22008/Edl8XzoXv79d-mjUmWOj9BOF/CleanShot-2023-05-18-at-11.07.472x.png">CleanShot-2023-05-18-at-11.07.472x.png</a></p>
<div class="message_inline_image"><a href="/user_uploads/22008/Edl8XzoXv79d-mjUmWOj9BOF/CleanShot-2023-05-18-at-11.07.472x.png" title="CleanShot-2023-05-18-at-11.07.472x.png"><img src="/user_uploads/22008/Edl8XzoXv79d-mjUmWOj9BOF/CleanShot-2023-05-18-at-11.07.472x.png"></a></div>



<a name="359459069"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Updated%20Abilities%20Syntax/near/359459069" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bryce Miller <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Updated.20Abilities.20Syntax.html#359459069">(May 18 2023 at 17:41)</a>:</h4>
<p>Ok, looks like it’s time for me to bite the bullet and  learn how macros are defined in Rust. This day was bound to arrive eventually.</p>



<a name="359459327"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Updated%20Abilities%20Syntax/near/359459327" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bryce Miller <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Updated.20Abilities.20Syntax.html#359459327">(May 18 2023 at 17:42)</a>:</h4>
<p>I did use the go to references feature in my editor, but I’m pretty sure I was looking at references to the wrong symbols or that I just missed the key references I needed.</p>



<a name="359459481"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Updated%20Abilities%20Syntax/near/359459481" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bryce Miller <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Updated.20Abilities.20Syntax.html#359459481">(May 18 2023 at 17:43)</a>:</h4>
<p>I also just realized there’s an entire README in the compiler crate that I missed. I guess being productive on a plane is harder than I thought lol.</p>



<a name="359459513"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Updated%20Abilities%20Syntax/near/359459513" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bryce Miller <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Updated.20Abilities.20Syntax.html#359459513">(May 18 2023 at 17:43)</a>:</h4>
<p>Thanks for the pointers, this helps a lot!</p>



<a name="359975360"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Updated%20Abilities%20Syntax/near/359975360" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bryce Miller <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Updated.20Abilities.20Syntax.html#359975360">(May 21 2023 at 00:50)</a>:</h4>
<p>For the <code>Set</code> builtin I had to change</p>
<div class="codehilite" data-code-language="roc"><pre><span></span><code>Set k := Dict.Dict k {}
     has [
         Eq {
             isEq,
         },
     ]
</code></pre></div>
<p>to </p>
<div class="codehilite"><pre><span></span><code>Set k := Dict.Dict k {} | k implements Hash &amp; Eq
     implements [
         Eq {
             isEq,
         },
     ]
</code></pre></div>
<p>in order to make the compiler happy. Is this correct?</p>
<p><span class="user-mention" data-user-id="343810">@Brendan Hansknecht</span> You left a comment here a while back (<a href="https://github.com/roc-lang/roc/blob/28e56937ccab4da5792fa9779bb3779063a2f9f5/crates/compiler/builtins/roc/Set.roc#L26">https://github.com/roc-lang/roc/blob/28e56937ccab4da5792fa9779bb3779063a2f9f5/crates/compiler/builtins/roc/Set.roc#L26</a>)</p>



<a name="359975396"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Updated%20Abilities%20Syntax/near/359975396" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bryce Miller <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Updated.20Abilities.20Syntax.html#359975396">(May 21 2023 at 00:51)</a>:</h4>
<p>Note: I'm only working on <code>s/has/implements/g</code> for now.</p>



<a name="359975659"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Updated%20Abilities%20Syntax/near/359975659" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Updated.20Abilities.20Syntax.html#359975659">(May 21 2023 at 00:55)</a>:</h4>
<p>Assuming it doesn't break the formatter anymore, that is a valid change. Just is clearer specification of the type.</p>



<a name="359975674"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Updated%20Abilities%20Syntax/near/359975674" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Updated.20Abilities.20Syntax.html#359975674">(May 21 2023 at 00:55)</a>:</h4>
<p>Not sure why just a naming change would make it required though</p>



<a name="359976371"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Updated%20Abilities%20Syntax/near/359976371" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bryce Miller <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Updated.20Abilities.20Syntax.html#359976371">(May 21 2023 at 01:06)</a>:</h4>
<p>Yeah, it makes me wonder if I did something wrong in my changes to the parser.</p>



<a name="359979565"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Updated%20Abilities%20Syntax/near/359979565" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ayaz Hafiz <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Updated.20Abilities.20Syntax.html#359979565">(May 21 2023 at 01:57)</a>:</h4>
<p>Yeah the constraint on <code>k</code> should not be required. Did the definition of Dict change in a similar way?</p>



<a name="360128358"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Updated%20Abilities%20Syntax/near/360128358" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bryce Miller <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Updated.20Abilities.20Syntax.html#360128358">(May 21 2023 at 22:31)</a>:</h4>
<p>All that changed for the constraint on <code>k</code> in <code>Dict</code> is the keyword <code>has</code> changing to <code>implements</code></p>



<a name="360128370"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Updated%20Abilities%20Syntax/near/360128370" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bryce Miller <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Updated.20Abilities.20Syntax.html#360128370">(May 21 2023 at 22:31)</a>:</h4>
<p>Draft PR is <a href="https://github.com/roc-lang/roc/issues/5426">#5426</a></p>



<a name="360128481"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Updated%20Abilities%20Syntax/near/360128481" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bryce Miller <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Updated.20Abilities.20Syntax.html#360128481">(May 21 2023 at 22:33)</a>:</h4>
<p>When Set is defined as:</p>
<div class="codehilite"><pre><span></span><code>Set k := Dict.Dict k {}
     implements [
         Eq {
             isEq,
         },
     ]
</code></pre></div>
<p>Compilation fails with this error (followed by a huge string of others):</p>
<div class="codehilite"><pre><span></span><code> ── TOO MANY TYPE ARGUMENTS ─────────────────────────────────────────── Set.roc ─

  The Dict opaque expects 2 type arguments, but it got 4 instead:

  31│&gt;  Set k := Dict.Dict k {}
  32│&gt;       implements [
  33│&gt;           Eq {
  34│&gt;               isEq,
  35│&gt;           },
  36│&gt;       ]

  Are there missing parentheses?
</code></pre></div>



<a name="360128636"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Updated%20Abilities%20Syntax/near/360128636" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bryce Miller <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Updated.20Abilities.20Syntax.html#360128636">(May 21 2023 at 22:35)</a>:</h4>
<p>But defined like this:</p>
<div class="codehilite"><pre><span></span><code>Set k := Dict.Dict k {} | k implements Hash &amp; Eq
     implements [
         Eq {
             isEq,
         },
     ]
</code></pre></div>
<p>The formatter fails:</p>
<div class="codehilite"><pre><span></span><code>An internal compiler expectation was broken.
This is definitely a compiler bug.
Please file an issue here: https://github.com/roc-lang/roc/issues/new/choose
thread &#39;main&#39; panicked at &#39;Formatting bug; formatted code isn&#39;t valid

I wrote the incorrect result to this file for debugging purposes:
crates/compiler/builtins/roc/Set.roc-format-failed

Parse error was: NotEndOfFile(@686)

&#39;, crates/cli/src/format.rs:79:13
</code></pre></div>



<a name="360128901"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Updated%20Abilities%20Syntax/near/360128901" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bryce Miller <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Updated.20Abilities.20Syntax.html#360128901">(May 21 2023 at 22:39)</a>:</h4>
<p>Hmm</p>
<div class="codehilite"><pre><span></span><code>#  crates/compiler/builtins/roc/Set.roc-format-failed

## Provides a [set](https://en.wikipedia.org/wiki/Set_(abstract_data_type))
## type which stores a collection of unique values, without any ordering
Set k := Dict.Dict k {} | k has Hash &amp; Eq
     has [
         Eq {
             isEq,
         },
     ]
</code></pre></div>



<a name="360129007"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Updated%20Abilities%20Syntax/near/360129007" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bryce Miller <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Updated.20Abilities.20Syntax.html#360129007">(May 21 2023 at 22:40)</a>:</h4>
<p>Are the builtins formatted during the build process? Looks like I failed to update the formatter.</p>



<a name="360129733"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Updated%20Abilities%20Syntax/near/360129733" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bryce Miller <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Updated.20Abilities.20Syntax.html#360129733">(May 21 2023 at 22:52)</a>:</h4>
<p>after fixing the formatter, it seems to be working fine as long as I keep the constraint on <code>k</code> for <code>Set</code></p>



<a name="360130045"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Updated%20Abilities%20Syntax/near/360130045" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bryce Miller <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Updated.20Abilities.20Syntax.html#360130045">(May 21 2023 at 22:57)</a>:</h4>
<p>However, it still seems to be broken if I don't include the constraint on <code>k</code></p>



<a name="360130181"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Updated%20Abilities%20Syntax/near/360130181" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bryce Miller <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Updated.20Abilities.20Syntax.html#360130181">(May 21 2023 at 22:59)</a>:</h4>
<p>I'm also getting some weird failures on reporting tests. for example, <code>cargo test --package roc_reporting --test test_reporting -- test_reporting::ability_first_demand_not_indented_enough</code> gives me:</p>
<div class="codehilite"><pre><span></span><code>-old snapshot
+new results
────────────┬──────────────────────────────────────────────────────────────────────────────────
    0       │-── UNFINISHED ABILITY ── tmp/ability_first_demand_not_indented_enough/Test.roc ─␊
          0 │+── SYNTAX PROBLEM ──────────────────────────────────────── /code/proj/Main.roc ─␊

...
</code></pre></div>



<a name="360130270"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Updated%20Abilities%20Syntax/near/360130270" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bryce Miller <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Updated.20Abilities.20Syntax.html#360130270">(May 21 2023 at 23:00)</a>:</h4>
<p>Not the sort of failure I would expect.</p>



<a name="360133047"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Updated%20Abilities%20Syntax/near/360133047" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bryce Miller <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Updated.20Abilities.20Syntax.html#360133047">(May 21 2023 at 23:42)</a>:</h4>
<p>This seems to me to be a strong indicator that I either introduced or uncovered a bug when making changes to the parsing logic.</p>



<a name="360133476"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Updated%20Abilities%20Syntax/near/360133476" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bryce Miller <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Updated.20Abilities.20Syntax.html#360133476">(May 21 2023 at 23:50)</a>:</h4>
<p>I have two questions: </p>
<ol>
<li>Would someone be willing to take a look at my changes to the parser and check for errors? </li>
<li>How do you feel about the size of my PR? Too many changes? I renamed a lot of types which makes the diff a lot bigger. I was torn between leaving those changes for a separate PR to keep the PRs smaller, and including them in this PR to reduce  possible confusion. What is the general preference for this project?</li>
</ol>



<a name="360135719"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Updated%20Abilities%20Syntax/near/360135719" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ayaz Hafiz <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Updated.20Abilities.20Syntax.html#360135719">(May 22 2023 at 00:23)</a>:</h4>
<p>I’ll take a look in a few minutes. I think larger sized PRs are fine for this kind of thing, namely an atomic refactor of the language. I think we should figure out why the type definitions changed though, that should not be necessary.</p>



<a name="360137015"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Updated%20Abilities%20Syntax/near/360137015" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bryce Miller <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Updated.20Abilities.20Syntax.html#360137015">(May 22 2023 at 00:42)</a>:</h4>
<p>The type changes were things such as <code>ast::Has</code> -&gt; <code>ast::Implements</code>,  <code>ast::HasClause</code> -&gt; <code>ast::ImplementsClause</code>, etc. My thought was that like leaving them as-is could be a source of confusion in the future.</p>



<a name="360137262"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Updated%20Abilities%20Syntax/near/360137262" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ayaz Hafiz <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Updated.20Abilities.20Syntax.html#360137262">(May 22 2023 at 00:45)</a>:</h4>
<p>The PR LGTM so far! Left a couple comments.</p>



<a name="360142471"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Updated%20Abilities%20Syntax/near/360142471" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bryce Miller <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Updated.20Abilities.20Syntax.html#360142471">(May 22 2023 at 01:56)</a>:</h4>
<p>Sweet thanks!</p>



<a name="360579145"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Updated%20Abilities%20Syntax/near/360579145" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bryce Miller <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Updated.20Abilities.20Syntax.html#360579145">(May 23 2023 at 16:14)</a>:</h4>
<p>I noticed that <code>has</code> was not defined as a constant in <code>roc_parse::keywords</code> is there a specific reason for this, or is it ok if I add a new constant there for <code>implements</code> and replace the various string literals?</p>



<a name="360579493"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Updated%20Abilities%20Syntax/near/360579493" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bryce Miller <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Updated.20Abilities.20Syntax.html#360579493">(May 23 2023 at 16:16)</a>:</h4>
<p>(I definitely did not spend hours troubleshooting a simple failure to find and replace. Not me. Why would you think that?)</p>



<a name="360609320"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Updated%20Abilities%20Syntax/near/360609320" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Updated.20Abilities.20Syntax.html#360609320">(May 23 2023 at 18:23)</a>:</h4>
<p><span class="user-mention silent" data-user-id="522634">Bryce Miller</span> <a href="#narrow/stream/316715-contributing/topic/Updated.20Abilities.20Syntax/near/360579145">said</a>:</p>
<blockquote>
<p>I noticed that <code>has</code> was not defined as a constant in <code>roc_parse::keywords</code> is there a specific reason for this, or is it ok if I add a new constant there for <code>implements</code> and replace the various string literals?</p>
</blockquote>
<p>we should probably rename that - it's just for reserved keywords in <em>expressions</em> specifically</p>



<a name="360609455"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Updated%20Abilities%20Syntax/near/360609455" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Updated.20Abilities.20Syntax.html#360609455">(May 23 2023 at 18:24)</a>:</h4>
<p>so <code>implements</code> is only reserved in type annotations and ability definitions</p>



<a name="360609511"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Updated%20Abilities%20Syntax/near/360609511" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Updated.20Abilities.20Syntax.html#360609511">(May 23 2023 at 18:24)</a>:</h4>
<p>really, what we should do is have a separate list of keywords that are reserved in expressions vs in types!</p>



<a name="360627078"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Updated%20Abilities%20Syntax/near/360627078" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Kilian Vounckx <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Updated.20Abilities.20Syntax.html#360627078">(May 23 2023 at 19:54)</a>:</h4>
<p><span class="user-mention silent" data-user-id="281383">Richard Feldman</span> <a href="#narrow/stream/316715-contributing/topic/Updated.20Abilities.20Syntax/near/360609511">said</a>:</p>
<blockquote>
<p>really, what we should do is have a separate list of keywords that are reserved in expressions vs in types!</p>
</blockquote>
<p>If we did that, would that mean you could use type keywords in expressions and vice versa? E.g. Could you have a type signature <code>List if -&gt; List if</code>? Not saying anyone would do this, but would that change make it possible?</p>



<a name="360628461"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Updated%20Abilities%20Syntax/near/360628461" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Updated.20Abilities.20Syntax.html#360628461">(May 23 2023 at 20:02)</a>:</h4>
<p>heh, I guess? Seems like a bad idea, of course <span aria-label="sweat smile" class="emoji emoji-1f605" role="img" title="sweat smile">:sweat_smile:</span></p>



<a name="360628535"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Updated%20Abilities%20Syntax/near/360628535" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Updated.20Abilities.20Syntax.html#360628535">(May 23 2023 at 20:03)</a>:</h4>
<p>to be honest, that does make a decent argument for unifying the keywords list just to make the rules easier to understand <span aria-label="thinking" class="emoji emoji-1f914" role="img" title="thinking">:thinking:</span></p>



<a name="360639525"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Updated%20Abilities%20Syntax/near/360639525" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bryce Miller <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Updated.20Abilities.20Syntax.html#360639525">(May 23 2023 at 21:11)</a>:</h4>
<p>Ohh, are the strings in the <code>keywords</code> array automatically allowed in expressions? I was wondering what that was for.</p>



<a name="360639577"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Updated%20Abilities%20Syntax/near/360639577" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bryce Miller <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Updated.20Abilities.20Syntax.html#360639577">(May 23 2023 at 21:11)</a>:</h4>
<p>All I really wanted was a const</p>



<a name="360640579"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Updated%20Abilities%20Syntax/near/360640579" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bryce Miller <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Updated.20Abilities.20Syntax.html#360640579">(May 23 2023 at 21:18)</a>:</h4>
<p>How would a separate list of keywords reserved in types allow keywords from the other list to be used in types?</p>



<a name="361474203"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Updated%20Abilities%20Syntax/near/361474203" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bryce Miller <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Updated.20Abilities.20Syntax.html#361474203">(May 27 2023 at 03:44)</a>:</h4>
<p>Aside from names changing in the AST files for <code>test_snapshots</code>,  would changes to regions also be expected?</p>



<a name="361474433"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Updated%20Abilities%20Syntax/near/361474433" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bryce Miller <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Updated.20Abilities.20Syntax.html#361474433">(May 27 2023 at 03:48)</a>:</h4>
<p>I'd also like to confirm whether you want me to keep the changes I made to names of types, functions, values, etc. I could revert those changes so that this PR contains only functional changes. Then make another PR changing the names of things to reflect the new syntax.</p>



<a name="361474569"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Updated%20Abilities%20Syntax/near/361474569" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bryce Miller <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Updated.20Abilities.20Syntax.html#361474569">(May 27 2023 at 03:50)</a>:</h4>
<p>The PR is already at +665 −617 and I haven't changed <code>|</code> to <code>where</code> or added the brackets for ability definitions yet.</p>



<a name="361550230"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Updated%20Abilities%20Syntax/near/361550230" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Updated.20Abilities.20Syntax.html#361550230">(May 27 2023 at 11:40)</a>:</h4>
<p>I just took a look through it and it looks fantastic!!! <span aria-label="heart eyes" class="emoji emoji-1f60d" role="img" title="heart eyes">:heart_eyes:</span></p>



<a name="361550332"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Updated%20Abilities%20Syntax/near/361550332" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Updated.20Abilities.20Syntax.html#361550332">(May 27 2023 at 11:41)</a>:</h4>
<blockquote>
<p>I could revert those changes so that this PR contains only functional changes. Then make another PR changing the names of things to reflect the new syntax.</p>
</blockquote>
<p>I don't think that's necessary; I think it's fine if both changes are in the same PR <span aria-label="thumbs up" class="emoji emoji-1f44d" role="img" title="thumbs up">:thumbs_up:</span></p>



<a name="361551736"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Updated%20Abilities%20Syntax/near/361551736" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Updated.20Abilities.20Syntax.html#361551736">(May 27 2023 at 11:47)</a>:</h4>
<blockquote>
<p>Aside from names changing in the AST files for <code>test_snapshots</code>, would changes to regions also be expected?</p>
</blockquote>
<p>I'd expect regions to change if keywords change lengths, so yeah I'd assume there would be some region changes here!</p>



<a name="361552031"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Updated%20Abilities%20Syntax/near/361552031" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Updated.20Abilities.20Syntax.html#361552031">(May 27 2023 at 11:48)</a>:</h4>
<blockquote>
<p>How would a separate list of keywords reserved in types allow keywords from the other list to be used in types?</p>
</blockquote>
<p>if we only give errors for identifiers from one list vs the other depending on whether we're parsing a type vs an expression</p>



<a name="361552107"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Updated%20Abilities%20Syntax/near/361552107" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Updated.20Abilities.20Syntax.html#361552107">(May 27 2023 at 11:49)</a>:</h4>
<p>but honestly based on this discussion I think we should unify those lists and just have one list of reserved keywords for both types and expressions <span aria-label="big smile" class="emoji emoji-1f604" role="img" title="big smile">:big_smile:</span></p>



<a name="361580180"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Updated%20Abilities%20Syntax/near/361580180" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bryce Miller <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Updated.20Abilities.20Syntax.html#361580180">(May 27 2023 at 13:52)</a>:</h4>
<p><span class="user-mention silent" data-user-id="281383">Richard Feldman</span> <a href="#narrow/stream/316715-contributing/topic/Updated.20Abilities.20Syntax/near/361552031">said</a>:</p>
<blockquote>
<blockquote>
<p>How would a separate list of keywords reserved in types allow keywords from the other list to be used in types?</p>
</blockquote>
<p>if we only give errors for identifiers from one list vs the other depending on whether we're parsing a type vs an expression</p>
</blockquote>
<p>Ohhh I think I understand now.</p>



<a name="361581111"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Updated%20Abilities%20Syntax/near/361581111" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bryce Miller <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Updated.20Abilities.20Syntax.html#361581111">(May 27 2023 at 13:56)</a>:</h4>
<p><span class="user-mention silent" data-user-id="281383">Richard Feldman</span> <a href="#narrow/stream/316715-contributing/topic/Updated.20Abilities.20Syntax/near/361551736">said</a>:</p>
<blockquote>
<blockquote>
<p>Aside from names changing in the AST files for <code>test_snapshots</code>, would changes to regions also be expected?</p>
</blockquote>
<p>I'd expect regions to change if keywords change lengths, so yeah I'd assume there would be some region changes here!</p>
</blockquote>
<p>Ah ha, right. So it looks like the only changes to these ASTs are names and regions. Would it make sense to just overwrite the old AST files with the new output? And if so, is there a script somewhere to do that?</p>



<a name="361581985"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Updated%20Abilities%20Syntax/near/361581985" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bryce Miller <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Updated.20Abilities.20Syntax.html#361581985">(May 27 2023 at 14:00)</a>:</h4>
<p>Speaking of ASTs, while I was looking at the code I was kinda wondering why most nodes included a reference to a <code>Loc</code>. It just occurred to me that that’s probably there to facilitate error messages. Is that correct?</p>



<a name="361918942"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Updated%20Abilities%20Syntax/near/361918942" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bryce Miller <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Updated.20Abilities.20Syntax.html#361918942">(May 29 2023 at 11:04)</a>:</h4>
<p>I'm running into <code>thread 'gen_abilities::encode_derive_to_encoder_for_opaque' has overflowed its stack</code><br>
Ignoring that test results in a failure for the next test that uses derived abilities. </p>
<p>Any suggestions on where to check for the problem?</p>



<a name="361929112"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Updated%20Abilities%20Syntax/near/361929112" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bryce Miller <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Updated.20Abilities.20Syntax.html#361929112">(May 29 2023 at 11:51)</a>:</h4>
<p>It's looking as though merging main has fixed the problem</p>



<a name="361930488"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Updated%20Abilities%20Syntax/near/361930488" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bryce Miller <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Updated.20Abilities.20Syntax.html#361930488">(May 29 2023 at 11:57)</a>:</h4>
<p>now <code>gen_tags::issue_5162_recast_nested_nullable_unwrapped_layout</code> is failing with a stack overflow, but we've made progress</p>



<a name="361944981"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Updated%20Abilities%20Syntax/near/361944981" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ayaz Hafiz <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Updated.20Abilities.20Syntax.html#361944981">(May 29 2023 at 12:59)</a>:</h4>
<p>Does it fail in release mode?</p>



<a name="361954426"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Updated%20Abilities%20Syntax/near/361954426" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bryce Miller <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Updated.20Abilities.20Syntax.html#361954426">(May 29 2023 at 13:38)</a>:</h4>
<p>I’ll try that</p>



<a name="362152682"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Updated%20Abilities%20Syntax/near/362152682" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bryce Miller <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Updated.20Abilities.20Syntax.html#362152682">(May 30 2023 at 11:29)</a>:</h4>
<p>Yeah that one seems to pass in release mode</p>



<a name="362175041"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Updated%20Abilities%20Syntax/near/362175041" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ayaz Hafiz <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Updated.20Abilities.20Syntax.html#362175041">(May 30 2023 at 12:57)</a>:</h4>
<p>okay then you will want to use the with_larger_stack helper to increase the test stack size in debug mode</p>



<a name="363027990"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Updated%20Abilities%20Syntax/near/363027990" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bryce Miller <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Updated.20Abilities.20Syntax.html#363027990">(Jun 02 2023 at 12:16)</a>:</h4>
<p>That worked. Thanks!</p>



<a name="365172051"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Updated%20Abilities%20Syntax/near/365172051" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bryce Miller <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Updated.20Abilities.20Syntax.html#365172051">(Jun 10 2023 at 18:03)</a>:</h4>
<p>I have completed <code>s/has/implements/g</code> and <code>s/|/where/g</code>. I'm now working on adding the braces around ability members in ability definitions. </p>
<div class="codehilite"><pre><span></span><code>## Definition of the [DecoderFormatting] ability
DecoderFormatting implements {
    u8 : Decoder U8 fmt where fmt implements DecoderFormatting,
    u16 : Decoder U16 fmt where fmt implements DecoderFormatting,
    u32 : Decoder U32 fmt where fmt implements DecoderFormatting,
}
</code></pre></div>
<p>Does the following approach make sense?</p>
<ol>
<li>change <code>roc_parse::ast::TypeDef::Ability</code> from</li>
</ol>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">Ability</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">header</span>: <span class="nc">TypeHeader</span><span class="o">&lt;'</span><span class="na">a</span><span class="o">&gt;</span><span class="p">,</span>
<span class="w">        </span><span class="n">loc_implements</span>: <span class="nc">Loc</span><span class="o">&lt;</span><span class="n">Implements</span><span class="o">&lt;'</span><span class="na">a</span><span class="o">&gt;&gt;</span><span class="p">,</span>
<span class="w">        </span><span class="n">members</span>: <span class="kp">&amp;</span><span class="o">'</span><span class="na">a</span> <span class="p">[</span><span class="n">AbilityMember</span><span class="o">&lt;'</span><span class="na">a</span><span class="o">&gt;</span><span class="p">],</span>
<span class="p">},</span>
</code></pre></div>
<p>to something like </p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">Ability</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">header</span>: <span class="nc">TypeHeader</span><span class="o">&lt;'</span><span class="na">a</span><span class="o">&gt;</span><span class="p">,</span>
<span class="w">        </span><span class="n">loc_implements</span>: <span class="nc">Loc</span><span class="o">&lt;</span><span class="n">Implements</span><span class="o">&lt;'</span><span class="na">a</span><span class="o">&gt;&gt;</span><span class="p">,</span>
<span class="w">        </span><span class="n">ann</span>: <span class="nc">Loc</span><span class="o">&lt;</span><span class="n">TypeAnnotation</span><span class="o">&lt;'</span><span class="na">a</span><span class="o">&gt;&gt;</span><span class="p">,</span>
<span class="p">},</span>
</code></pre></div>
<ol start="2">
<li>Add a new function in <code>roc_parse::type_annotation</code> to parse the text following the <code>implements</code> keyword</li>
</ol>



<a name="365172567"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Updated%20Abilities%20Syntax/near/365172567" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bryce Miller <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Updated.20Abilities.20Syntax.html#365172567">(Jun 10 2023 at 18:06)</a>:</h4>
<p>I noticed that the <code>implements</code> keyword plays the same role as <code>:</code> or <code>:=</code> in alias or opaque type definitions, but is the only type definition that maintains the location of that sequence in the AST.</p>



<a name="365173141"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Updated%20Abilities%20Syntax/near/365173141" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bryce Miller <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Updated.20Abilities.20Syntax.html#365173141">(Jun 10 2023 at 18:10)</a>:</h4>
<p>An alternative I see to the above approach is to parse the braces in <code>roc_parse::expr::finish_parsing_ability_def_help</code></p>



<a name="365174589"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Updated%20Abilities%20Syntax/near/365174589" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bryce Miller <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Updated.20Abilities.20Syntax.html#365174589">(Jun 10 2023 at 18:20)</a>:</h4>
<p>I was planning to bring this up later, but I wonder if there is any merit to using something other than the <code>implements</code> keyword for ability definitions. In this context, it has a different meaning than it does in other contexts. </p>
<p>In the the following contexts,  the <code>implements</code> keyword means "the preceding type implements the following ability":</p>
<div class="codehilite" data-code-language="roc"><pre><span></span><code># Type annotations:
foo : a -&gt; Str where a implements Bar

# Implementing abilities for opaque types:
Foo := U64 implements [Eq]
</code></pre></div>
<p>In the context of an ability definition, the <code>implements</code> keyword means "The preceding name identifies an ability which can be implemented by providing the following functions"</p>



<a name="365174749"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Updated%20Abilities%20Syntax/near/365174749" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bryce Miller <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Updated.20Abilities.20Syntax.html#365174749">(Jun 10 2023 at 18:21)</a>:</h4>
<p>One idea I had for disambiguating these use cases was to reserve a new keyword such as <code>implemented-with</code> to use instead of <code>implements</code> in ability definitions. I don't like reserving another keyword though, and that one is long and cumbersome.</p>



<a name="365175322"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Updated%20Abilities%20Syntax/near/365175322" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bryce Miller <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Updated.20Abilities.20Syntax.html#365175322">(Jun 10 2023 at 18:24)</a>:</h4>
<p>It occurred to me today that perhaps another approach would be to use a symbol or set of symbols, like all other type and value definitions use:</p>
<div class="codehilite"><pre><span></span><code># Value Def
nice = 69

# Type Def (alias)
Foo : { bar : U64 }

# Type Def (opaque)
Baz := U64

# Ability Def (???)
SomeAbility :@ {
    foo : a -&gt; Str where a implements SomeAbility,
}
</code></pre></div>



<a name="365175698"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Updated%20Abilities%20Syntax/near/365175698" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bryce Miller <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Updated.20Abilities.20Syntax.html#365175698">(Jun 10 2023 at 18:27)</a>:</h4>
<p>This seemed relevant to me because I think the first approach I suggested for implementing the braces requirement would make more sense if ability defs looked more like the other type annotations whose parsers live in <code>type_annotation.rs</code></p>



<a name="365175953"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Updated%20Abilities%20Syntax/near/365175953" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bryce Miller <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Updated.20Abilities.20Syntax.html#365175953">(Jun 10 2023 at 18:29)</a>:</h4>
<p>Anyway, the last few messages should probably be moved to #ideas &gt; Abilities Syntax. I wasn't even planning to bring that up until after we had a chance to use the new syntax for a while.</p>



<a name="365176826"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Updated%20Abilities%20Syntax/near/365176826" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bryce Miller <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Updated.20Abilities.20Syntax.html#365176826">(Jun 10 2023 at 18:34)</a>:</h4>
<p>Possibly related: </p>
<p>When I add the <code>implements</code> keyword to <code>roc_parse::keyword::KEYWORDS</code>, the compiler chokes on ability definitions in the builtins.</p>



<a name="365605276"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Updated%20Abilities%20Syntax/near/365605276" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bryce Miller <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Updated.20Abilities.20Syntax.html#365605276">(Jun 12 2023 at 15:44)</a>:</h4>
<p>Does anybody have any advice on which direction to go in regards to parsing the braces? I’m not liking my first idea because an ability definition really isn’t a type annotation. I know I will also need to provide error messages for missing braces.</p>



<a name="365605745"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Updated%20Abilities%20Syntax/near/365605745" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bryce Miller <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Updated.20Abilities.20Syntax.html#365605745">(Jun 12 2023 at 15:46)</a>:</h4>
<p>I apologize for the parsing questions. I think I’d be much better off here if I had experience implementing a parser for a toy language. I suspect I’m getting a little tripped up simply because I haven’t worked with parsers before.</p>



<a name="365837291"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Updated%20Abilities%20Syntax/near/365837291" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Updated.20Abilities.20Syntax.html#365837291">(Jun 13 2023 at 11:32)</a>:</h4>
<p>have you taken a look at the <code>record!</code> macro in the parser? there are various places which use it, and I think that's what I would use here!</p>



<a name="365852040"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Updated%20Abilities%20Syntax/near/365852040" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bryce Miller <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Updated.20Abilities.20Syntax.html#365852040">(Jun 13 2023 at 12:26)</a>:</h4>
<p>Thanks for the lead! I’ll take a look!</p>



<a name="365860205"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Updated%20Abilities%20Syntax/near/365860205" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Updated.20Abilities.20Syntax.html#365860205">(Jun 13 2023 at 12:58)</a>:</h4>
<p>cool, happy to help! <span aria-label="smiley" class="emoji emoji-1f603" role="img" title="smiley">:smiley:</span></p>



<a name="367687219"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Updated%20Abilities%20Syntax/near/367687219" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bryce Miller <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Updated.20Abilities.20Syntax.html#367687219">(Jun 19 2023 at 15:55)</a>:</h4>
<p>I’ve noticed special treatment of indentation for ability definitions. For example, <code>ability::demand_parser</code> takes an <code>ability::IndentLevel</code> and returns a parser which produces a <code>(u32, AbilityDemand)</code> value.</p>



<a name="367687753"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Updated%20Abilities%20Syntax/near/367687753" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bryce Miller <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Updated.20Abilities.20Syntax.html#367687753">(Jun 19 2023 at 15:57)</a>:</h4>
<p>Does adding braces around the list of demands change how we treat indentation here?</p>



<a name="367688380"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Updated%20Abilities%20Syntax/near/367688380" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bryce Miller <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Updated.20Abilities.20Syntax.html#367688380">(Jun 19 2023 at 15:59)</a>:</h4>
<p>It looks like I’m going to have to make more than a couple tweaks to get the types to work out for the <code>record!</code> macro, because the parsing logic for ability definitions seems different from most of the rest of the parsing logic.</p>



<a name="367700571"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Updated%20Abilities%20Syntax/near/367700571" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Updated.20Abilities.20Syntax.html#367700571">(Jun 19 2023 at 16:48)</a>:</h4>
<p><span class="user-mention silent" data-user-id="522634">Bryce Miller</span> <a href="#narrow/stream/316715-contributing/topic/Updated.20Abilities.20Syntax/near/367687753">said</a>:</p>
<blockquote>
<p>Does adding braces around the list of demands change how we treat indentation here?</p>
</blockquote>
<p>yeah I don't think we should have to care about indentation anymore after introducing the record literal <span aria-label="thumbs up" class="emoji emoji-1f44d" role="img" title="thumbs up">:thumbs_up:</span></p>



<a name="384092364"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Updated%20Abilities%20Syntax/near/384092364" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bryce Miller <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Updated.20Abilities.20Syntax.html#384092364">(Aug 11 2023 at 21:02)</a>:</h4>
<p>I see <span class="user-mention" data-user-id="281383">@Richard Feldman</span>  and <span class="user-mention" data-user-id="361169">@Anton</span>  have merged my branch into main. I feel I owe you all a status update, and regret that I haven't done so before now. </p>
<p>As you can see, I completed the <code>|</code> -&gt; <code>where</code> and <code>has</code> -&gt; <code>implements</code> changes. I have not yet completed the proposed addition of curly braces in ability definitions.  This is because I was getting tripped up  a lot in my attempts to implement the change, and my personal life has also been hairy. </p>
<p>Realistically, I don't think I'll be able to implement the last part of the proposal. I apologize for not recognizing this and letting you know sooner.  I kept thinking that I might be able to try again and get it, so that we would have only one breaking syntax change instead of two. But alas, weeks have passed and nothing of the sort has happened.</p>
<p>I could possibly manage it with a pairing session, but anyone who would pair with me on this could probably get it done faster alone.  I don't want to take anyone away from the other important things they are doing to make Roc awesome. Ergo, I think I'm going to need to pass the torch.</p>



<a name="384095241"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Updated%20Abilities%20Syntax/near/384095241" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Updated.20Abilities.20Syntax.html#384095241">(Aug 11 2023 at 21:18)</a>:</h4>
<p>hey no worries! I really appreciate all the work you did on it - you got the most valuable part done for sure!</p>



<a name="384116255"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Updated%20Abilities%20Syntax/near/384116255" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bryce Miller <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Updated.20Abilities.20Syntax.html#384116255">(Aug 12 2023 at 00:14)</a>:</h4>
<p>Glad I was able to help a little!</p>



<a name="384116430"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Updated%20Abilities%20Syntax/near/384116430" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Updated.20Abilities.20Syntax.html#384116430">(Aug 12 2023 at 00:15)</a>:</h4>
<p>I would say a lot! <span aria-label="smiley" class="emoji emoji-1f603" role="img" title="smiley">:smiley:</span></p>



<a name="384116443"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/316715-contributing/topic/Updated%20Abilities%20Syntax/near/384116443" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/316715-contributing/topic/Updated.20Abilities.20Syntax.html#384116443">(Aug 12 2023 at 00:15)</a>:</h4>
<p>thanks again!</p>



<hr><p>Last updated: Nov 01 2025 at 12:13 UTC</p>
</html>