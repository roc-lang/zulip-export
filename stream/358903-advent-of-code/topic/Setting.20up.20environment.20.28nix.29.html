<html>
<head><meta charset="utf-8"><title>Setting up environment (nix) · advent of code · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://roc-lang.github.io/zulip-export/stream/358903-advent-of-code/index.html">advent of code</a></h2>
<h3>Topic: <a href="https://roc-lang.github.io/zulip-export/stream/358903-advent-of-code/topic/Setting.20up.20environment.20.28nix.29.html">Setting up environment (nix)</a></h3>

<hr>

<base href="https://roc.zulipchat.com">

<head><link href="https://roc-lang.github.io/zulip-export/style.css" rel="stylesheet"></head>

<a name="313285624"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/358903-advent%20of%20code/topic/Setting%20up%20environment%20%28nix%29/near/313285624" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Juliano <a href="https://roc-lang.github.io/zulip-export/stream/358903-advent-of-code/topic/Setting.20up.20environment.20.28nix.29.html#313285624">(Dec 01 2022 at 14:00)</a>:</h4>
<p>anyone able to set up a nix shell with the latest main? i tried and it's complaining that</p>
<blockquote>
<p>The package requires the Cargo feature called <code>workspace-inheritance</code>, but that feature is not stabilized in this version of Cargo (1.62.0).</p>
</blockquote>
<p>what's weird is I tried to use nixpkgs-22.05 and nixpkgs-22.11 and both times it said Cargo 1.62 in the error. 22.05 had cargo 1.60, 22.11 has 1.64</p>



<a name="313285784"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/358903-advent%20of%20code/topic/Setting%20up%20environment%20%28nix%29/near/313285784" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Juliano <a href="https://roc-lang.github.io/zulip-export/stream/358903-advent-of-code/topic/Setting.20up.20environment.20.28nix.29.html#313285784">(Dec 01 2022 at 14:00)</a>:</h4>
<p>my very naive attempt so far <a href="https://github.com/omnibs/aoc22/blob/7b4917904c7742f32082b8f5f4dfebf6f43e8f9f/shell.nix">https://github.com/omnibs/aoc22/blob/7b4917904c7742f32082b8f5f4dfebf6f43e8f9f/shell.nix</a></p>
<p>i had this working for an older version of main, but i want <code>dbg</code> :3</p>



<a name="313288773"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/358903-advent%20of%20code/topic/Setting%20up%20environment%20%28nix%29/near/313288773" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Juliano <a href="https://roc-lang.github.io/zulip-export/stream/358903-advent-of-code/topic/Setting.20up.20environment.20.28nix.29.html#313288773">(Dec 01 2022 at 14:13)</a>:</h4>
<p>ohh ok so the derivation for roc uses <a href="https://github.com/roc-lang/roc/blob/2a27d3c05f7974adf87e782704eab8d43c80652e/default.nix#L2-L4">a pinned version of nixpkgs</a>, but we can override it!</p>



<a name="313290118"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/358903-advent%20of%20code/topic/Setting%20up%20environment%20%28nix%29/near/313290118" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Juliano <a href="https://roc-lang.github.io/zulip-export/stream/358903-advent-of-code/topic/Setting.20up.20environment.20.28nix.29.html#313290118">(Dec 01 2022 at 14:18)</a>:</h4>
<p>ok overriding nixpkgs with 22.11 got me past that, but now I hit:</p>
<blockquote>
<p>Compiling roc_docs v0.0.1 (/tmp/nix-build-roc-0.0.1.drv-0/2234iib1nswkawkigmaij7lg4gaf1fpp-roc-src/crates/docs)<br>
   Compiling roc_docs_cli v0.0.1 (/tmp/nix-build-roc-0.0.1.drv-0/2234iib1nswkawkigmaij7lg4gaf1fpp-roc-src/crates/docs_cli)<br>
    Finished release [optimized] target(s) in 2m 06s<br>
Executing cargoInstallPostBuildHook<br>
Finished cargoInstallPostBuildHook<br>
Finished cargoBuildHook<br>
buildPhase completed in 2 minutes 7 seconds<br>
installing<br>
Executing cargoInstallHook<br>
cp: cannot stat 'target/x86_64-unknown-linux-gnu/release/lib/.': No such file or directory</p>
</blockquote>



<a name="313294704"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/358903-advent%20of%20code/topic/Setting%20up%20environment%20%28nix%29/near/313294704" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Juliano <a href="https://roc-lang.github.io/zulip-export/stream/358903-advent-of-code/topic/Setting.20up.20environment.20.28nix.29.html#313294704">(Dec 01 2022 at 14:39)</a>:</h4>
<p>this seems to come from <a href="https://github.com/roc-lang/roc/blob/2a27d3c05f7974adf87e782704eab8d43c80652e/default.nix#L81-L84">this postInstall override</a></p>



<a name="313299072"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/358903-advent%20of%20code/topic/Setting%20up%20environment%20%28nix%29/near/313299072" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Juliano <a href="https://roc-lang.github.io/zulip-export/stream/358903-advent-of-code/topic/Setting.20up.20environment.20.28nix.29.html#313299072">(Dec 01 2022 at 14:58)</a>:</h4>
<p>yeah, i don't have a lib/ dir at all<br>
ive hundreds of files and a few other dirs, but no lib :S</p>



<a name="313299134"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/358903-advent%20of%20code/topic/Setting%20up%20environment%20%28nix%29/near/313299134" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Juliano <a href="https://roc-lang.github.io/zulip-export/stream/358903-advent-of-code/topic/Setting.20up.20environment.20.28nix.29.html#313299134">(Dec 01 2022 at 14:59)</a>:</h4>
<p>i think i recall richard mentioning something about a change to ship stdlib along with roc, maybe this postInstall was a part of that? no idea</p>



<a name="313299694"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/358903-advent%20of%20code/topic/Setting%20up%20environment%20%28nix%29/near/313299694" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Juliano <a href="https://roc-lang.github.io/zulip-export/stream/358903-advent-of-code/topic/Setting.20up.20environment.20.28nix.29.html#313299694">(Dec 01 2022 at 15:01)</a>:</h4>
<p>or unrelated, this postinstall seems pretty old</p>



<a name="313300936"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/358903-advent%20of%20code/topic/Setting%20up%20environment%20%28nix%29/near/313300936" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/358903-advent-of-code/topic/Setting.20up.20environment.20.28nix.29.html#313300936">(Dec 01 2022 at 15:07)</a>:</h4>
<p>I don't think this <code>lib</code> dir is related to that one, but I could be wrong!</p>



<a name="313301198"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/358903-advent%20of%20code/topic/Setting%20up%20environment%20%28nix%29/near/313301198" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Juliano <a href="https://roc-lang.github.io/zulip-export/stream/358903-advent-of-code/topic/Setting.20up.20environment.20.28nix.29.html#313301198">(Dec 01 2022 at 15:08)</a>:</h4>
<p>i removed the <code>cp</code> line and it built, but running the hello world app fails :S</p>
<div class="codehilite"><pre><span></span><code>Downloading https://github.com/roc-lang/basic-cli/releases/download/0.1.1/zAoiC9xtQPHywYk350_b7ust04BmWLW00sjb9ZPtSQk.tar.br
    into /home/juliano/.cache/roc/packages

thread &#39;main&#39; panicked at &#39;not yet implemented: TODO gracefully handle package install error IoErr(Os { code: 18, kind: CrossesDevices, message: &quot;Invalid cross-device link&quot; })&#39;, crates/compiler/load_internal/src/file.rs:3856:37
note: run with `RUST_BACKTRACE=1` environment variable to display a backtrace
</code></pre></div>
<p>not sure what's the deal with cross-device. im on x86 linux building for x86 linux</p>
<p>unless somehow it's trying to link against a non-x86-linux platform??</p>



<a name="313301409"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/358903-advent%20of%20code/topic/Setting%20up%20environment%20%28nix%29/near/313301409" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Juliano <a href="https://roc-lang.github.io/zulip-export/stream/358903-advent-of-code/topic/Setting.20up.20environment.20.28nix.29.html#313301409">(Dec 01 2022 at 15:09)</a>:</h4>
<p>i pushed what i got to <a href="https://github.com/omnibs/aoc22/">https://github.com/omnibs/aoc22/</a>, need to bail now! will keep trying later tonight but welcome any help/contributions!</p>



<a name="313332971"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/358903-advent%20of%20code/topic/Setting%20up%20environment%20%28nix%29/near/313332971" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Héctor Ramón <a href="https://roc-lang.github.io/zulip-export/stream/358903-advent-of-code/topic/Setting.20up.20environment.20.28nix.29.html#313332971">(Dec 01 2022 at 17:29)</a>:</h4>
<p><span class="user-mention" data-user-id="524658">@Juliano</span> I hit this error today as well. I believe <code>fs::rename</code> is erroring because <code>from</code> and <code>to</code> are on different filesystems: <a href="https://doc.rust-lang.org/std/fs/fn.rename.html#errors">https://doc.rust-lang.org/std/fs/fn.rename.html#errors</a></p>



<a name="313333430"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/358903-advent%20of%20code/topic/Setting%20up%20environment%20%28nix%29/near/313333430" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Héctor Ramón <a href="https://roc-lang.github.io/zulip-export/stream/358903-advent-of-code/topic/Setting.20up.20environment.20.28nix.29.html#313333430">(Dec 01 2022 at 17:31)</a>:</h4>
<p>I believe this is the cause: <a href="https://github.com/roc-lang/roc/blob/2a27d3c05f7974adf87e782704eab8d43c80652e/crates/packaging/src/cache.rs#L74">https://github.com/roc-lang/roc/blob/2a27d3c05f7974adf87e782704eab8d43c80652e/crates/packaging/src/cache.rs#L74</a></p>



<a name="313342241"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/358903-advent%20of%20code/topic/Setting%20up%20environment%20%28nix%29/near/313342241" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/358903-advent-of-code/topic/Setting.20up.20environment.20.28nix.29.html#313342241">(Dec 01 2022 at 18:12)</a>:</h4>
<p>huh, interesting! I'm not sure what we want to do instead to make things work nicely with Nix here <span aria-label="thinking" class="emoji emoji-1f914" role="img" title="thinking">:thinking:</span></p>



<a name="313342385"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/358903-advent%20of%20code/topic/Setting%20up%20environment%20%28nix%29/near/313342385" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/358903-advent-of-code/topic/Setting.20up.20environment.20.28nix.29.html#313342385">(Dec 01 2022 at 18:13)</a>:</h4>
<p>basically we want to download the package to a tempdir, then if it passes hash verification, <code>mv</code> it to <code>~/.cache/roc</code></p>



<a name="313342549"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/358903-advent%20of%20code/topic/Setting%20up%20environment%20%28nix%29/near/313342549" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/358903-advent-of-code/topic/Setting.20up.20environment.20.28nix.29.html#313342549">(Dec 01 2022 at 18:14)</a>:</h4>
<p>I guess we could detect that specific error and <code>cp</code> instead in that case?</p>



<a name="313352223"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/358903-advent%20of%20code/topic/Setting%20up%20environment%20%28nix%29/near/313352223" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Héctor Ramón <a href="https://roc-lang.github.io/zulip-export/stream/358903-advent-of-code/topic/Setting.20up.20environment.20.28nix.29.html#313352223">(Dec 01 2022 at 18:58)</a>:</h4>
<p>Yes, that's what I was thinking as well.</p>



<a name="313359505"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/358903-advent%20of%20code/topic/Setting%20up%20environment%20%28nix%29/near/313359505" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/358903-advent-of-code/topic/Setting.20up.20environment.20.28nix.29.html#313359505">(Dec 01 2022 at 19:35)</a>:</h4>
<p><span class="user-mention" data-user-id="471692">@Héctor Ramón</span> if you already have it building from source locally, can you confirm if replacing the rename with a <code>cp</code> fixes it?</p>



<a name="313404167"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/358903-advent%20of%20code/topic/Setting%20up%20environment%20%28nix%29/near/313404167" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Juliano <a href="https://roc-lang.github.io/zulip-export/stream/358903-advent-of-code/topic/Setting.20up.20environment.20.28nix.29.html#313404167">(Dec 02 2022 at 00:18)</a>:</h4>
<p>im sloooowly trying to fix it with <a href="https://docs.rs/fs_extra/1.2.0/fs_extra/dir/fn.move_dir.html">https://docs.rs/fs_extra/1.2.0/fs_extra/dir/fn.move_dir.html</a></p>



<a name="313404932"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/358903-advent%20of%20code/topic/Setting%20up%20environment%20%28nix%29/near/313404932" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Héctor Ramón <a href="https://roc-lang.github.io/zulip-export/stream/358903-advent-of-code/topic/Setting.20up.20environment.20.28nix.29.html#313404932">(Dec 02 2022 at 00:26)</a>:</h4>
<p>Yeah, <code>fs::copy</code> works only with files.</p>



<a name="313407881"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/358903-advent%20of%20code/topic/Setting%20up%20environment%20%28nix%29/near/313407881" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Juliano <a href="https://roc-lang.github.io/zulip-export/stream/358903-advent-of-code/topic/Setting.20up.20environment.20.28nix.29.html#313407881">(Dec 02 2022 at 00:49)</a>:</h4>
<p>i got past that error but im getting</p>
<div class="codehilite"><pre><span></span><code>Error Os { code: 2, kind: NotFound, message: &quot;No such file or directory&quot; }
</code></pre></div>
<p>no idea where in the call stack</p>



<a name="313407909"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/358903-advent%20of%20code/topic/Setting%20up%20environment%20%28nix%29/near/313407909" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Juliano <a href="https://roc-lang.github.io/zulip-export/stream/358903-advent-of-code/topic/Setting.20up.20environment.20.28nix.29.html#313407909">(Dec 02 2022 at 00:49)</a>:</h4>
<p>still hunting</p>



<a name="313409125"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/358903-advent%20of%20code/topic/Setting%20up%20environment%20%28nix%29/near/313409125" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Juliano <a href="https://roc-lang.github.io/zulip-export/stream/358903-advent-of-code/topic/Setting.20up.20environment.20.28nix.29.html#313409125">(Dec 02 2022 at 01:02)</a>:</h4>
<p>so i randomly noticed i got a <code>hello</code> executable after running <code>cargo run hello.roc</code> on <a href="https://www.roc-lang.org/tutorial#building-an-application">the first basic-cli example in the tutorial</a></p>
<p>and trying to run that executable i get <code>bash: ./hello: No such file or directory</code> which may be where that error is coming from</p>
<div class="codehilite"><pre><span></span><code>$ ls -l hello
-rwxrwxr-x 1 juliano users 20419168 Dec  1 21:51 hello
$ file hello
hello: ELF 64-bit LSB pie executable, x86-64, version 1 (SYSV), dynamically linked, interpreter /lib64/ld-linux-x86-64.so.2, BuildID[sha1]=61e0eead3cc4b065c941ea6fdb611db808a3e389, for GNU/Linux 3.2.0, with debug_info, not stripped
</code></pre></div>
<p>i am on x86-64 linux, so im puzzled why this executable is not running</p>



<a name="313409484"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/358903-advent%20of%20code/topic/Setting%20up%20environment%20%28nix%29/near/313409484" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Juliano <a href="https://roc-lang.github.io/zulip-export/stream/358903-advent-of-code/topic/Setting.20up.20environment.20.28nix.29.html#313409484">(Dec 02 2022 at 01:06)</a>:</h4>
<p>time for bed! my changes so far are in <a href="https://github.com/NoRedInk/roc/tree/fix-default-nix">https://github.com/NoRedInk/roc/tree/fix-default-nix</a></p>



<a name="313420053"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/358903-advent%20of%20code/topic/Setting%20up%20environment%20%28nix%29/near/313420053" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/358903-advent-of-code/topic/Setting.20up.20environment.20.28nix.29.html#313420053">(Dec 02 2022 at 03:20)</a>:</h4>
<p>oof, <a href="https://doc.rust-lang.org/std/io/enum.ErrorKind.html#variant.CrossesDevices"><code>CrossesDevices</code> is only available on Nightly Rust</a></p>



<a name="313421524"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/358903-advent%20of%20code/topic/Setting%20up%20environment%20%28nix%29/near/313421524" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/358903-advent-of-code/topic/Setting.20up.20environment.20.28nix.29.html#313421524">(Dec 02 2022 at 03:41)</a>:</h4>
<p>PR to fix it: <a href="https://github.com/roc-lang/roc/pull/4653">https://github.com/roc-lang/roc/pull/4653</a></p>



<a name="313421527"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/358903-advent%20of%20code/topic/Setting%20up%20environment%20%28nix%29/near/313421527" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/358903-advent-of-code/topic/Setting.20up.20environment.20.28nix.29.html#313421527">(Dec 02 2022 at 03:41)</a>:</h4>
<p>I just had it always try a deep copy if the rename fails for any reason</p>



<a name="313421594"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/358903-advent%20of%20code/topic/Setting%20up%20environment%20%28nix%29/near/313421594" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/358903-advent-of-code/topic/Setting.20up.20environment.20.28nix.29.html#313421594">(Dec 02 2022 at 03:42)</a>:</h4>
<p>I went with copy rather than rename because I think it should be less work; either way it has to copy the files, this way it just doesn't have to delete them one by one from the source directory - which is a tempdir, so the OS can probably clean it up more quickly than that regardless</p>



<a name="313421608"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/358903-advent%20of%20code/topic/Setting%20up%20environment%20%28nix%29/near/313421608" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/358903-advent-of-code/topic/Setting.20up.20environment.20.28nix.29.html#313421608">(Dec 02 2022 at 03:42)</a>:</h4>
<p>lmk if that branch works for you!</p>



<a name="313459615"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/358903-advent%20of%20code/topic/Setting%20up%20environment%20%28nix%29/near/313459615" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Juliano <a href="https://roc-lang.github.io/zulip-export/stream/358903-advent-of-code/topic/Setting.20up.20environment.20.28nix.29.html#313459615">(Dec 02 2022 at 09:39)</a>:</h4>
<p>your branch works, but somehow it still produces an executable i can't run!</p>



<a name="313460513"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/358903-advent%20of%20code/topic/Setting%20up%20environment%20%28nix%29/near/313460513" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/358903-advent-of-code/topic/Setting.20up.20environment.20.28nix.29.html#313460513">(Dec 02 2022 at 09:44)</a>:</h4>
<p>any errors?</p>



<a name="313460838"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/358903-advent%20of%20code/topic/Setting%20up%20environment%20%28nix%29/near/313460838" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Juliano <a href="https://roc-lang.github.io/zulip-export/stream/358903-advent-of-code/topic/Setting.20up.20environment.20.28nix.29.html#313460838">(Dec 02 2022 at 09:47)</a>:</h4>
<p><span class="user-mention" data-user-id="281543">@Folkert de Vries</span> the "no such file or directory" above</p>



<a name="313460924"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/358903-advent%20of%20code/topic/Setting%20up%20environment%20%28nix%29/near/313460924" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Juliano <a href="https://roc-lang.github.io/zulip-export/stream/358903-advent-of-code/topic/Setting.20up.20environment.20.28nix.29.html#313460924">(Dec 02 2022 at 09:47)</a>:</h4>
<p><a href="#narrow/stream/358903-Advent-of-Code/topic/Setting.20up.20environment.20.28nix.29/near/313409125">this</a></p>



<a name="313461237"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/358903-advent%20of%20code/topic/Setting%20up%20environment%20%28nix%29/near/313461237" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/358903-advent-of-code/topic/Setting.20up.20environment.20.28nix.29.html#313461237">(Dec 02 2022 at 09:49)</a>:</h4>
<p>ok, did we narrow down where that error originates?</p>



<a name="313461472"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/358903-advent%20of%20code/topic/Setting%20up%20environment%20%28nix%29/near/313461472" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Juliano <a href="https://roc-lang.github.io/zulip-export/stream/358903-advent-of-code/topic/Setting.20up.20environment.20.28nix.29.html#313461472">(Dec 02 2022 at 09:51)</a>:</h4>
<p>which error? the no such file or directory? or the one richard patched?</p>
<p>the one richard patched we narrowed down and it seems fixed</p>
<p>the no such file, i've no idea what up :&lt;</p>



<a name="313461540"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/358903-advent%20of%20code/topic/Setting%20up%20environment%20%28nix%29/near/313461540" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Juliano <a href="https://roc-lang.github.io/zulip-export/stream/358903-advent-of-code/topic/Setting.20up.20environment.20.28nix.29.html#313461540">(Dec 02 2022 at 09:51)</a>:</h4>
<p>i read around the web no such file can happen when you have an incorrect arch executable, but it doesn't seem to be the case</p>



<a name="313461645"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/358903-advent%20of%20code/topic/Setting%20up%20environment%20%28nix%29/near/313461645" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/358903-advent-of-code/topic/Setting.20up.20environment.20.28nix.29.html#313461645">(Dec 02 2022 at 09:52)</a>:</h4>
<p>right I'd like to get a backtrace for it. did you set the <code>RUST_BACKTRACE</code> variable?</p>



<a name="313461831"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/358903-advent%20of%20code/topic/Setting%20up%20environment%20%28nix%29/near/313461831" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Juliano <a href="https://roc-lang.github.io/zulip-export/stream/358903-advent-of-code/topic/Setting.20up.20environment.20.28nix.29.html#313461831">(Dec 02 2022 at 09:53)</a>:</h4>
<div class="codehilite"><pre><span></span><code>$ RUST_BACKTRACE=1 cargo run a.roc
    Finished dev [unoptimized + debuginfo] target(s) in 0.16s
     Running `target/debug/roc a.roc`
Error Os { code: 2, kind: NotFound, message: &quot;No such file or directory&quot; }
</code></pre></div>



<a name="313461861"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/358903-advent%20of%20code/topic/Setting%20up%20environment%20%28nix%29/near/313461861" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/358903-advent-of-code/topic/Setting.20up.20environment.20.28nix.29.html#313461861">(Dec 02 2022 at 09:53)</a>:</h4>
<p>ah I see, the problem is in the platform, not in the compiler</p>



<a name="313461952"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/358903-advent%20of%20code/topic/Setting%20up%20environment%20%28nix%29/near/313461952" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/358903-advent-of-code/topic/Setting.20up.20environment.20.28nix.29.html#313461952">(Dec 02 2022 at 09:54)</a>:</h4>
<p>you're using the cli platform?</p>



<a name="313461969"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/358903-advent%20of%20code/topic/Setting%20up%20environment%20%28nix%29/near/313461969" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Juliano <a href="https://roc-lang.github.io/zulip-export/stream/358903-advent-of-code/topic/Setting.20up.20environment.20.28nix.29.html#313461969">(Dec 02 2022 at 09:54)</a>:</h4>
<p>yeah</p>



<a name="313462123"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/358903-advent%20of%20code/topic/Setting%20up%20environment%20%28nix%29/near/313462123" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Juliano <a href="https://roc-lang.github.io/zulip-export/stream/358903-advent-of-code/topic/Setting.20up.20environment.20.28nix.29.html#313462123">(Dec 02 2022 at 09:55)</a>:</h4>
<p>so another weird data point, the nightly linux x86-64 is behaving the same for me</p>
<div class="codehilite"><pre><span></span><code>[nix-shell:~/git/roc]$ ./roc dev
bash: ./roc: No such file or directory

[nix-shell:~/git/roc]$ file roc
roc: ELF 64-bit LSB pie executable, x86-64, version 1 (SYSV), dynamically linked, interpreter /lib64/ld-linux-x86-64.so.2, BuildID[sha1]=489d7a87d7eadbd6804a2f3edacf8022e9a08ea5, for GNU/Linux 3.2.0, with debug_info, not stripped

[nix-shell:~/git/roc]$ ls -l roc
-rwxr-xr-x 1 juliano users 84308912 Dec  1 06:27 roc
</code></pre></div>



<a name="313462198"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/358903-advent%20of%20code/topic/Setting%20up%20environment%20%28nix%29/near/313462198" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/358903-advent-of-code/topic/Setting.20up.20environment.20.28nix.29.html#313462198">(Dec 02 2022 at 09:55)</a>:</h4>
<p>can you try the rust_backtrace thing there?</p>



<a name="313462242"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/358903-advent%20of%20code/topic/Setting%20up%20environment%20%28nix%29/near/313462242" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/358903-advent-of-code/topic/Setting.20up.20environment.20.28nix.29.html#313462242">(Dec 02 2022 at 09:56)</a>:</h4>
<p>it should print more, really</p>



<a name="313462308"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/358903-advent%20of%20code/topic/Setting%20up%20environment%20%28nix%29/near/313462308" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/358903-advent-of-code/topic/Setting.20up.20environment.20.28nix.29.html#313462308">(Dec 02 2022 at 09:56)</a>:</h4>
<p>also what roc program are you running?</p>



<a name="313462352"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/358903-advent%20of%20code/topic/Setting%20up%20environment%20%28nix%29/near/313462352" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Juliano <a href="https://roc-lang.github.io/zulip-export/stream/358903-advent-of-code/topic/Setting.20up.20environment.20.28nix.29.html#313462352">(Dec 02 2022 at 09:56)</a>:</h4>
<p>the first basic-cli example in the tutorial</p>



<a name="313462387"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/358903-advent%20of%20code/topic/Setting%20up%20environment%20%28nix%29/near/313462387" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Juliano <a href="https://roc-lang.github.io/zulip-export/stream/358903-advent-of-code/topic/Setting.20up.20environment.20.28nix.29.html#313462387">(Dec 02 2022 at 09:56)</a>:</h4>
<p>sorry, try RUST_BACKTRACE=1 where this time?</p>



<a name="313462447"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/358903-advent%20of%20code/topic/Setting%20up%20environment%20%28nix%29/near/313462447" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Juliano <a href="https://roc-lang.github.io/zulip-export/stream/358903-advent-of-code/topic/Setting.20up.20environment.20.28nix.29.html#313462447">(Dec 02 2022 at 09:57)</a>:</h4>
<p>the contents of a.roc:</p>
<div class="codehilite"><pre><span></span><code>app &quot;hello&quot;
    packages { pf: &quot;https://github.com/roc-lang/basic-cli/releases/download/0.1.1/zAoiC9xtQPHywYk350_b7ust04BmWLW00sjb9ZPtSQk.tar.br&quot; }
    imports [pf.Stdout]
    provides [main] to pf

main =
    Stdout.line &quot;I&#39;m a Roc application!&quot;
</code></pre></div>



<a name="313462634"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/358903-advent%20of%20code/topic/Setting%20up%20environment%20%28nix%29/near/313462634" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/358903-advent-of-code/topic/Setting.20up.20environment.20.28nix.29.html#313462634">(Dec 02 2022 at 09:58)</a>:</h4>
<p>on linux</p>



<a name="313462657"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/358903-advent%20of%20code/topic/Setting%20up%20environment%20%28nix%29/near/313462657" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Juliano <a href="https://roc-lang.github.io/zulip-export/stream/358903-advent-of-code/topic/Setting.20up.20environment.20.28nix.29.html#313462657">(Dec 02 2022 at 09:58)</a>:</h4>
<p>oh, all of this is on linux</p>



<a name="313462675"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/358903-advent%20of%20code/topic/Setting%20up%20environment%20%28nix%29/near/313462675" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/358903-advent-of-code/topic/Setting.20up.20environment.20.28nix.29.html#313462675">(Dec 02 2022 at 09:58)</a>:</h4>
<p>ok</p>



<a name="313462697"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/358903-advent%20of%20code/topic/Setting%20up%20environment%20%28nix%29/near/313462697" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/358903-advent-of-code/topic/Setting.20up.20environment.20.28nix.29.html#313462697">(Dec 02 2022 at 09:58)</a>:</h4>
<p>well, that program should hit this piece of rust code</p>



<a name="313462764"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/358903-advent%20of%20code/topic/Setting%20up%20environment%20%28nix%29/near/313462764" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/358903-advent-of-code/topic/Setting.20up.20environment.20.28nix.29.html#313462764">(Dec 02 2022 at 09:59)</a>:</h4>
<div class="codehilite"><pre><span></span><code>#[no_mangle]
pub extern &quot;C&quot; fn roc_fx_stdoutLine(line: &amp;RocStr) {
    let string = line.as_str();
    println!(&quot;{}&quot;, string);
}
</code></pre></div>



<a name="313462797"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/358903-advent%20of%20code/topic/Setting%20up%20environment%20%28nix%29/near/313462797" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/358903-advent-of-code/topic/Setting.20up.20environment.20.28nix.29.html#313462797">(Dec 02 2022 at 09:59)</a>:</h4>
<p>and nothing can really go wrong there, no file IO happens</p>



<a name="313462877"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/358903-advent%20of%20code/topic/Setting%20up%20environment%20%28nix%29/near/313462877" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/358903-advent-of-code/topic/Setting.20up.20environment.20.28nix.29.html#313462877">(Dec 02 2022 at 09:59)</a>:</h4>
<p>hmm it must be in the compiler itself then</p>



<a name="313462944"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/358903-advent%20of%20code/topic/Setting%20up%20environment%20%28nix%29/near/313462944" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Juliano <a href="https://roc-lang.github.io/zulip-export/stream/358903-advent-of-code/topic/Setting.20up.20environment.20.28nix.29.html#313462944">(Dec 02 2022 at 10:00)</a>:</h4>
<p>what i think is happening:</p>
<ul>
<li>some bit of <code>cargo run</code> compiles <code>a.roc</code> into <code>hello</code></li>
<li>some other bit just launches the executable</li>
</ul>
<p>the 2nd part is failing bc linux is refusing to run the executable itself, at all</p>
<p>i read around the web this can happen when you have an incorrect arch binary, but it doesn't seem to be the case</p>



<a name="313463020"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/358903-advent%20of%20code/topic/Setting%20up%20environment%20%28nix%29/near/313463020" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/358903-advent-of-code/topic/Setting.20up.20environment.20.28nix.29.html#313463020">(Dec 02 2022 at 10:00)</a>:</h4>
<p>can you try just running the executable then, without invoking roc itself</p>



<a name="313463276"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/358903-advent%20of%20code/topic/Setting%20up%20environment%20%28nix%29/near/313463276" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Juliano <a href="https://roc-lang.github.io/zulip-export/stream/358903-advent-of-code/topic/Setting.20up.20environment.20.28nix.29.html#313463276">(Dec 02 2022 at 10:01)</a>:</h4>
<p>yeah, that's what i did <a href="#narrow/stream/358903-Advent-of-Code/topic/Setting.20up.20environment.20.28nix.29/near/313409125">here</a>, and i get:</p>
<div class="codehilite"><pre><span></span><code>bash: ./hello: No such file or directory
</code></pre></div>
<p>even tho it has execute permissions, is an ELF 64bit executable which matches my OS, etc</p>



<a name="313463392"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/358903-advent%20of%20code/topic/Setting%20up%20environment%20%28nix%29/near/313463392" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/358903-advent-of-code/topic/Setting.20up.20environment.20.28nix.29.html#313463392">(Dec 02 2022 at 10:02)</a>:</h4>
<p>and the file is here?</p>



<a name="313463397"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/358903-advent%20of%20code/topic/Setting%20up%20environment%20%28nix%29/near/313463397" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Juliano <a href="https://roc-lang.github.io/zulip-export/stream/358903-advent-of-code/topic/Setting.20up.20environment.20.28nix.29.html#313463397">(Dec 02 2022 at 10:02)</a>:</h4>
<p>yep</p>



<a name="313463401"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/358903-advent%20of%20code/topic/Setting%20up%20environment%20%28nix%29/near/313463401" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Juliano <a href="https://roc-lang.github.io/zulip-export/stream/358903-advent-of-code/topic/Setting.20up.20environment.20.28nix.29.html#313463401">(Dec 02 2022 at 10:02)</a>:</h4>
<p>bizarre</p>



<a name="313463443"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/358903-advent%20of%20code/topic/Setting%20up%20environment%20%28nix%29/near/313463443" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/358903-advent-of-code/topic/Setting.20up.20environment.20.28nix.29.html#313463443">(Dec 02 2022 at 10:02)</a>:</h4>
<p>yeah that is kind of wild</p>



<a name="313463495"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/358903-advent%20of%20code/topic/Setting%20up%20environment%20%28nix%29/near/313463495" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Juliano <a href="https://roc-lang.github.io/zulip-export/stream/358903-advent-of-code/topic/Setting.20up.20environment.20.28nix.29.html#313463495">(Dec 02 2022 at 10:02)</a>:</h4>
<p>i get the same on the roc binary in the nightly</p>



<a name="313463598"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/358903-advent%20of%20code/topic/Setting%20up%20environment%20%28nix%29/near/313463598" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Juliano <a href="https://roc-lang.github.io/zulip-export/stream/358903-advent-of-code/topic/Setting.20up.20environment.20.28nix.29.html#313463598">(Dec 02 2022 at 10:03)</a>:</h4>
<p>file is there, <code>file roc</code> says all the right things, <code>ldd roc</code> shows my nix store stuff, +x is there, but <code>./roc</code> gives me <code>No such file or directory</code></p>



<a name="313464798"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/358903-advent%20of%20code/topic/Setting%20up%20environment%20%28nix%29/near/313464798" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Juliano <a href="https://roc-lang.github.io/zulip-export/stream/358903-advent-of-code/topic/Setting.20up.20environment.20.28nix.29.html#313464798">(Dec 02 2022 at 10:10)</a>:</h4>
<div class="codehilite"><pre><span></span><code>$ file target/debug/roc
target/debug/roc: ELF 64-bit LSB pie executable, x86-64, version 1 (GNU/Linux), dynamically linked, interpreter /nix/store/ynn1by1qdl16q6qwwh2h7zkgrn36c6i8-glibc-2.35-163/lib/ld-linux-x86-64.so.2, for GNU/Linux 2.6.32, with debug_info, not stripped

$ file ~/Downloads/roc/roc
/home/juliano/Downloads/roc/roc: ELF 64-bit LSB pie executable, x86-64, version 1 (SYSV), dynamically linked, interpreter /lib64/ld-linux-x86-64.so.2, BuildID[sha1]=489d7a87d7eadbd6804a2f3edacf8022e9a08ea5, for GNU/Linux 3.2.0, with debug_info, not stripped
</code></pre></div>
<p>so the first one is the roc built by cargo, which is a valid executable on my system (i can launch it just fine, it just produces executables i can't launch)</p>
<p>the second is the nightly binary that my system refuses to run</p>



<a name="313465388"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/358903-advent%20of%20code/topic/Setting%20up%20environment%20%28nix%29/near/313465388" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Juliano <a href="https://roc-lang.github.io/zulip-export/stream/358903-advent-of-code/topic/Setting.20up.20environment.20.28nix.29.html#313465388">(Dec 02 2022 at 10:13)</a>:</h4>
<p>differences:</p>
<ul>
<li>local binary says GNU/Linux, nightly says SYSV</li>
<li>local binary's interpreter is glibc in the nix store, nightly binary is some missing /lib64 path<ul>
<li><code>ldd</code> on the nightly binary points <code>ld-linux-x86-64.so.2</code> to the nix store tho, so this might be a red herring</li>
</ul>
</li>
<li>local binary is "for GNU/Linux 2.6.32", nightly is "for GNU/Linux 3.2.0"</li>
</ul>



<a name="313466393"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/358903-advent%20of%20code/topic/Setting%20up%20environment%20%28nix%29/near/313466393" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Juliano <a href="https://roc-lang.github.io/zulip-export/stream/358903-advent-of-code/topic/Setting.20up.20environment.20.28nix.29.html#313466393">(Dec 02 2022 at 10:19)</a>:</h4>
<p>what is curious is the locally built roc binary works, but the stuff it produces, when the basic-cli platform is involved, won't launch</p>
<p>is it possible whatever is making the nightly binary an invalid executable on my system is also making any platform-specific binary styff in the platform invalid?</p>



<a name="313467056"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/358903-advent%20of%20code/topic/Setting%20up%20environment%20%28nix%29/near/313467056" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Juliano <a href="https://roc-lang.github.io/zulip-export/stream/358903-advent-of-code/topic/Setting.20up.20environment.20.28nix.29.html#313467056">(Dec 02 2022 at 10:23)</a>:</h4>
<p>i can repro on the nightly binary in a cloud bastion from work, also running nixos 22.05</p>



<a name="313467557"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/358903-advent%20of%20code/topic/Setting%20up%20environment%20%28nix%29/near/313467557" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Juliano <a href="https://roc-lang.github.io/zulip-export/stream/358903-advent-of-code/topic/Setting.20up.20environment.20.28nix.29.html#313467557">(Dec 02 2022 at 10:26)</a>:</h4>
<div class="codehilite"><pre><span></span><code>$ tar -zxvf roc_nightly-linux_x86_64-2022-12-01-d2d8511.tar.gz
...
$ ls -l roc
-rwxr-xr-x 1 juliano users 84308912 Dec  1 09:27 roc
$ file roc
roc: ELF 64-bit LSB pie executable, x86-64, version 1 (SYSV), dynamically linked, interpreter /lib64/ld-linux-x86-64.so.2, BuildID[sha1]=489d7a87d7eadbd6804a2f3edacf8022e9a08ea5, for GNU/Linux 3.2.0, with debug_info, not stripped
$ ./roc
bash: ./roc: No such file or directory
$ uname -a
Linux bastion 5.10.126 #1-NixOS SMP Mon Jun 27 07:41:01 UTC 2022 x86_64 GNU/Linux
</code></pre></div>



<a name="313474874"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/358903-advent%20of%20code/topic/Setting%20up%20environment%20%28nix%29/near/313474874" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anton <a href="https://roc-lang.github.io/zulip-export/stream/358903-advent-of-code/topic/Setting.20up.20environment.20.28nix.29.html#313474874">(Dec 02 2022 at 11:06)</a>:</h4>
<p>Hi <span class="user-mention" data-user-id="524658">@Juliano</span>, I'm also on NixOS 22.05. The linux nightly does not work on NixOS but you can clone the repo and run:</p>
<div class="codehilite"><pre><span></span><code>nix develop
cargo build --release
</code></pre></div>
<p>Once that is done you can use: </p>
<div class="codehilite"><pre><span></span><code>./target/release/roc ~/myRocProject/main.roc
</code></pre></div>
<p>I'll make sure to mention this workaround for NixOS in the documentation</p>



<a name="313475608"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/358903-advent%20of%20code/topic/Setting%20up%20environment%20%28nix%29/near/313475608" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Juliano <a href="https://roc-lang.github.io/zulip-export/stream/358903-advent-of-code/topic/Setting.20up.20environment.20.28nix.29.html#313475608">(Dec 02 2022 at 11:10)</a>:</h4>
<p><span class="user-mention" data-user-id="361169">@Anton</span> thanks for confirming!</p>
<p>this also means we can't link to published platforms on NixOS, right?</p>
<p>if you try to compile a roc app with, say, <code>packages { pf: "https://github.com/roc-lang/basic-cli/releases/download/0.1.1/zAoiC9xtQPHywYk350_b7ust04BmWLW00sjb9ZPtSQk.tar.br" }</code>, the resulting binary will not run</p>



<a name="313476261"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/358903-advent%20of%20code/topic/Setting%20up%20environment%20%28nix%29/near/313476261" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anton <a href="https://roc-lang.github.io/zulip-export/stream/358903-advent-of-code/topic/Setting.20up.20environment.20.28nix.29.html#313476261">(Dec 02 2022 at 11:15)</a>:</h4>
<p>Ah yes, I hadn't realized that yet but it makes sense.<br>
I'll make a note to resolve that.<br>
As a workaround; you can clone the <a href="https://github.com/roc-lang/basic-cli">basic-cli repo</a> locally and use a path instead of a URL at <code>pf:</code>.</p>



<a name="313477327"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/358903-advent%20of%20code/topic/Setting%20up%20environment%20%28nix%29/near/313477327" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Juliano <a href="https://roc-lang.github.io/zulip-export/stream/358903-advent-of-code/topic/Setting.20up.20environment.20.28nix.29.html#313477327">(Dec 02 2022 at 11:22)</a>:</h4>
<p>thank you! that'll get me going :D</p>



<a name="313477400"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/358903-advent%20of%20code/topic/Setting%20up%20environment%20%28nix%29/near/313477400" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Juliano <a href="https://roc-lang.github.io/zulip-export/stream/358903-advent-of-code/topic/Setting.20up.20environment.20.28nix.29.html#313477400">(Dec 02 2022 at 11:22)</a>:</h4>
<p>btw, for my own learning, do you know what makes these binaries incompatible with nixos?</p>



<a name="313477532"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/358903-advent%20of%20code/topic/Setting%20up%20environment%20%28nix%29/near/313477532" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anton <a href="https://roc-lang.github.io/zulip-export/stream/358903-advent-of-code/topic/Setting.20up.20environment.20.28nix.29.html#313477532">(Dec 02 2022 at 11:23)</a>:</h4>
<p>I'd suspect libraries that are dynamically linked in the nightly roc binary.</p>



<a name="313845246"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/358903-advent%20of%20code/topic/Setting%20up%20environment%20%28nix%29/near/313845246" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Georges Boris <a href="https://roc-lang.github.io/zulip-export/stream/358903-advent-of-code/topic/Setting.20up.20environment.20.28nix.29.html#313845246">(Dec 04 2022 at 18:53)</a>:</h4>
<p>Folks, I see we're not yet supporting MacOS 13 (Ventura) on the nightly releases so I decided to try and recompile Roc using nix from scratch (just to see how the current experience is going).</p>



<a name="313845331"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/358903-advent%20of%20code/topic/Setting%20up%20environment%20%28nix%29/near/313845331" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Georges Boris <a href="https://roc-lang.github.io/zulip-export/stream/358903-advent-of-code/topic/Setting.20up.20environment.20.28nix.29.html#313845331">(Dec 04 2022 at 18:54)</a>:</h4>
<p>I'm running into these issues:</p>
<div class="codehilite"><pre><span></span><code>error: failed to run custom build command for `roc_builtins v0.0.1 (/Users/georgesboris/code/roc/roc/crates/compiler/builtins)`

Caused by:
  process didn&#39;t exit successfully: `/Users/georgesboris/code/roc/roc/target/release/build/roc_builtins-a04181892e74d4fd/build-script-build` (exit status: 101)
  --- stdout
  cargo:rerun-if-changed=build.rs
  Compiling host ir to: /Users/georgesboris/code/roc/roc/crates/compiler/builtins/bitcode/builtins-host.ll
  Compiling 64-bit bitcode to: /Users/georgesboris/code/roc/roc/crates/compiler/builtins/bitcode/builtins-host.bc

  --- stderr
  thread &#39;main&#39; panicked at &#39;&quot;zig&quot; &quot;build&quot; &quot;ir&quot; &quot;-Drelease=true&quot; failed with:

    thread 155033 panic: Darwin is handled separately via std.zig.system.darwin module
  Unable to dump stack trace: debug info stripped

  &#39;, crates/compiler/builtins/build.rs:223:21
  note: run with `RUST_BACKTRACE=1` environment variable to display a backtrace
warning: build failed, waiting for other jobs to finish...
error: failed to run custom build command for `roc_builtins v0.0.1 (/Users/georgesboris/code/roc/roc/crates/compiler/builtins)`

Caused by:
  process didn&#39;t exit successfully: `/Users/georgesboris/code/roc/roc/target/release/build/roc_builtins-a04181892e74d4fd/build-script-build` (exit status: 101)
  --- stdout
  cargo:rerun-if-changed=build.rs
  Compiling host ir to: /Users/georgesboris/code/roc/roc/crates/compiler/builtins/bitcode/builtins-host.ll
  Compiling 64-bit bitcode to: /Users/georgesboris/code/roc/roc/crates/compiler/builtins/bitcode/builtins-host.bc

  --- stderr
  thread &#39;main&#39; panicked at &#39;&quot;zig&quot; &quot;build&quot; &quot;ir&quot; &quot;-Drelease=true&quot; failed with:

    thread 155060 panic: Darwin is handled separately via std.zig.system.darwin module
  Unable to dump stack trace: debug info stripped

  &#39;, crates/compiler/builtins/build.rs:223:21
  note: run with `RUST_BACKTRACE=1` environment variable to display a backtrace
</code></pre></div>



<a name="313845446"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/358903-advent%20of%20code/topic/Setting%20up%20environment%20%28nix%29/near/313845446" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Georges Boris <a href="https://roc-lang.github.io/zulip-export/stream/358903-advent-of-code/topic/Setting.20up.20environment.20.28nix.29.html#313845446">(Dec 04 2022 at 18:56)</a>:</h4>
<p>being a Rust (a Nix) noob - I wonder if there is a quickfix I'm missing? I've reinstalled nix and running <code>nix develop</code> appears to work fine. Roc is freshly cloned.</p>



<a name="313845486"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/358903-advent%20of%20code/topic/Setting%20up%20environment%20%28nix%29/near/313845486" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Georges Boris <a href="https://roc-lang.github.io/zulip-export/stream/358903-advent-of-code/topic/Setting.20up.20environment.20.28nix.29.html#313845486">(Dec 04 2022 at 18:56)</a>:</h4>
<p>I'm running on an Intel macbook pro, not using the "new" ARM stuff.</p>



<a name="313845505"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/358903-advent%20of%20code/topic/Setting%20up%20environment%20%28nix%29/near/313845505" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/358903-advent-of-code/topic/Setting.20up.20environment.20.28nix.29.html#313845505">(Dec 04 2022 at 18:57)</a>:</h4>
<p>I don't think it is a rust issue. I think it is a zig version issue. We don't yet support zig 0.10.0 which I believe is required for macos 13</p>



<a name="313845546"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/358903-advent%20of%20code/topic/Setting%20up%20environment%20%28nix%29/near/313845546" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/358903-advent-of-code/topic/Setting.20up.20environment.20.28nix.29.html#313845546">(Dec 04 2022 at 18:57)</a>:</h4>
<p>I could be wrong, but my understanding is that it can't work on macos 13 until we upgrade zig, which also requires updating llvm and inkwell, which is a larger task in general.</p>



<a name="313845666"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/358903-advent%20of%20code/topic/Setting%20up%20environment%20%28nix%29/near/313845666" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Georges Boris <a href="https://roc-lang.github.io/zulip-export/stream/358903-advent-of-code/topic/Setting.20up.20environment.20.28nix.29.html#313845666">(Dec 04 2022 at 18:58)</a>:</h4>
<p>oh - so Roc is currently incompatible with macos 13 no matter what (and it will probably take a while before that changes)</p>



<a name="313845681"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/358903-advent%20of%20code/topic/Setting%20up%20environment%20%28nix%29/near/313845681" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Georges Boris <a href="https://roc-lang.github.io/zulip-export/stream/358903-advent-of-code/topic/Setting.20up.20environment.20.28nix.29.html#313845681">(Dec 04 2022 at 18:59)</a>:</h4>
<p>that's correct?</p>



<a name="313845831"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/358903-advent%20of%20code/topic/Setting%20up%20environment%20%28nix%29/near/313845831" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/358903-advent-of-code/topic/Setting.20up.20environment.20.28nix.29.html#313845831">(Dec 04 2022 at 19:00)</a>:</h4>
<p>That's my understanding. I think the current discussion was talking about targeting January for the change because this update could break things and we don't want to mess up advent of code.</p>



<a name="313848834"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/358903-advent%20of%20code/topic/Setting%20up%20environment%20%28nix%29/near/313848834" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/358903-advent-of-code/topic/Setting.20up.20environment.20.28nix.29.html#313848834">(Dec 04 2022 at 19:34)</a>:</h4>
<p>yeah also llvm made a big breaking change, and the Rust library we use for llvm hasn't landed support for it quite yet: <a href="https://github.com/TheDan64/inkwell/pull/383">https://github.com/TheDan64/inkwell/pull/383</a> - that PR was approved at one point but hasn't gotten merged yet</p>



<a name="313848872"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/358903-advent%20of%20code/topic/Setting%20up%20environment%20%28nix%29/near/313848872" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Georges Boris <a href="https://roc-lang.github.io/zulip-export/stream/358903-advent-of-code/topic/Setting.20up.20environment.20.28nix.29.html#313848872">(Dec 04 2022 at 19:35)</a>:</h4>
<p>I guess I'm gonna do AoC entirely in our web REPL <span aria-label="nerd" class="emoji emoji-1f913" role="img" title="nerd">:nerd:</span></p>



<a name="313848965"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/358903-advent%20of%20code/topic/Setting%20up%20environment%20%28nix%29/near/313848965" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Georges Boris <a href="https://roc-lang.github.io/zulip-export/stream/358903-advent-of-code/topic/Setting.20up.20environment.20.28nix.29.html#313848965">(Dec 04 2022 at 19:36)</a>:</h4>
<p>Is the wasm repl up-to-date with nightly?</p>



<a name="313851507"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/358903-advent%20of%20code/topic/Setting%20up%20environment%20%28nix%29/near/313851507" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michael Glass <a href="https://roc-lang.github.io/zulip-export/stream/358903-advent-of-code/topic/Setting.20up.20environment.20.28nix.29.html#313851507">(Dec 04 2022 at 20:07)</a>:</h4>
<p><span class="user-mention" data-user-id="364014">@Georges Boris</span> I'm doing it in a docker container. <a href="https://github.com/michaelglass/advent-roc">https://github.com/michaelglass/advent-roc</a></p>



<a name="313857517"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/358903-advent%20of%20code/topic/Setting%20up%20environment%20%28nix%29/near/313857517" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Marten <a href="https://roc-lang.github.io/zulip-export/stream/358903-advent-of-code/topic/Setting.20up.20environment.20.28nix.29.html#313857517">(Dec 04 2022 at 21:34)</a>:</h4>
<p>I've been using a nightly macos 12  release on M1 with Ventura via <a href="https://github.com/WhileTruu/advent-of-code/blob/main/flake.nix">nix</a></p>



<a name="313866543"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/358903-advent%20of%20code/topic/Setting%20up%20environment%20%28nix%29/near/313866543" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Georges Boris <a href="https://roc-lang.github.io/zulip-export/stream/358903-advent-of-code/topic/Setting.20up.20environment.20.28nix.29.html#313866543">(Dec 04 2022 at 23:39)</a>:</h4>
<p><span class="user-mention" data-user-id="478939">@Michael Glass</span> ha! That will do! Thank you</p>



<a name="314134108"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/358903-advent%20of%20code/topic/Setting%20up%20environment%20%28nix%29/near/314134108" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Carroll <a href="https://roc-lang.github.io/zulip-export/stream/358903-advent-of-code/topic/Setting.20up.20environment.20.28nix.29.html#314134108">(Dec 05 2022 at 22:10)</a>:</h4>
<p><span class="user-mention silent" data-user-id="364014">Georges Boris</span> <a href="#narrow/stream/358903-Advent-of-Code/topic/Setting.20up.20environment.20.28nix.29/near/313848965">said</a>:</p>
<blockquote>
<p>Is the wasm repl up-to-date with nightly?</p>
</blockquote>
<p>Yes, it's deployed as part of the nightly build. But maybe docker is handier for you.</p>



<hr><p>Last updated: Nov 01 2025 at 12:13 UTC</p>
</html>