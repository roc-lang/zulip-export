<html>
<head><meta charset="utf-8"><title>Day 12 · advent of code · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://roc-lang.github.io/zulip-export/stream/358903-advent-of-code/index.html">advent of code</a></h2>
<h3>Topic: <a href="https://roc-lang.github.io/zulip-export/stream/358903-advent-of-code/topic/Day.2012.html">Day 12</a></h3>

<hr>

<base href="https://roc.zulipchat.com">

<head><link href="https://roc-lang.github.io/zulip-export/style.css" rel="stylesheet"></head>

<a name="315491830"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/358903-advent%20of%20code/topic/Day%2012/near/315491830" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Shritesh Bhattarai <a href="https://roc-lang.github.io/zulip-export/stream/358903-advent-of-code/topic/Day.2012.html#315491830">(Dec 13 2022 at 00:43)</a>:</h4>
<p>It took me way too long to realize that the problem is not in my code but Dict is broken <span aria-label="smiling face with tear" class="emoji emoji-1f972" role="img" title="smiling face with tear">:smiling_face_with_tear:</span></p>



<a name="315499800"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/358903-advent%20of%20code/topic/Day%2012/near/315499800" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/358903-advent-of-code/topic/Day.2012.html#315499800">(Dec 13 2022 at 02:17)</a>:</h4>
<p>Any more details on how it is broken or a minimal repro if you have/can make one?</p>



<a name="315507329"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/358903-advent%20of%20code/topic/Day%2012/near/315507329" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Shritesh Bhattarai <a href="https://roc-lang.github.io/zulip-export/stream/358903-advent-of-code/topic/Day.2012.html#315507329">(Dec 13 2022 at 04:09)</a>:</h4>
<p>Min-repro’ing this is going to be really hard. My code works for the “example input”, and on the bigger input it crashes after many many iterations with an unwrap of KeyNotFound on a dict that IIUC has that key in there. <a href="https://github.com/shritesh/advent/blob/4995ae8d8bdc4d0ea11edce9555ccccc27707324/2022/12.roc#L36">https://github.com/shritesh/advent/blob/4995ae8d8bdc4d0ea11edce9555ccccc27707324/2022/12.roc#L36</a></p>



<a name="315507570"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/358903-advent%20of%20code/topic/Day%2012/near/315507570" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/358903-advent-of-code/topic/Day.2012.html#315507570">(Dec 13 2022 at 04:12)</a>:</h4>
<p>Is see. Yeah, may be quite hard to debug. Does dbg printing <code>Dict.keys</code> show the key?</p>



<a name="315507622"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/358903-advent%20of%20code/topic/Day%2012/near/315507622" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/358903-advent-of-code/topic/Day.2012.html#315507622">(Dec 13 2022 at 04:12)</a>:</h4>
<p>That will end up printing the underlying list. Would let us know if it is simply a bug in the hash lookup or if it is something else.</p>



<a name="315508321"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/358903-advent%20of%20code/topic/Day%2012/near/315508321" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Shritesh Bhattarai <a href="https://roc-lang.github.io/zulip-export/stream/358903-advent-of-code/topic/Day.2012.html#315508321">(Dec 13 2022 at 04:19)</a>:</h4>
<p>In the latest Apple Silicon nightly,  running <code>roc dev 12.roc</code> simply exits without doing anything if I put a dbg before the unwrap</p>



<a name="315508425"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/358903-advent%20of%20code/topic/Day%2012/near/315508425" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/358903-advent-of-code/topic/Day.2012.html#315508425">(Dec 13 2022 at 04:20)</a>:</h4>
<p>ok. sad</p>



<a name="315511325"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/358903-advent%20of%20code/topic/Day%2012/near/315511325" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/358903-advent-of-code/topic/Day.2012.html#315511325">(Dec 13 2022 at 04:57)</a>:</h4>
<p>Interesting. I can't seem to repro. It still fails, but it is hitting a <code>integer addition overflowed!</code> in the helper function Looks to be happening directly in the newHops List.walk lambda. (note, I am running from source, not from a nightly)</p>
<p>Oh, actually. it is specifically hitting it on <code>alt = currentHop + 1</code>. If I change that to <code>alt = Num.addWrap currentHop 1</code>, the code you linked will pass for me and print out a result.</p>



<a name="315601926"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/358903-advent%20of%20code/topic/Day%2012/near/315601926" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Shritesh Bhattarai <a href="https://roc-lang.github.io/zulip-export/stream/358903-advent-of-code/topic/Day.2012.html#315601926">(Dec 13 2022 at 14:20)</a>:</h4>
<p>nice. <code>roc dev</code> was taking too long for the full input so I was using optimize. Is integer overflow an undefined behavior in optimized roc programs?</p>



<a name="315602392"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/358903-advent%20of%20code/topic/Day%2012/near/315602392" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/358903-advent-of-code/topic/Day.2012.html#315602392">(Dec 13 2022 at 14:23)</a>:</h4>
<p>no we specifically do want it to panic in release builds</p>



<a name="315604416"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/358903-advent%20of%20code/topic/Day%2012/near/315604416" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Shritesh Bhattarai <a href="https://roc-lang.github.io/zulip-export/stream/358903-advent-of-code/topic/Day.2012.html#315604416">(Dec 13 2022 at 14:33)</a>:</h4>
<p>gotcha. I can repro different behaviors in the file linked above where <code>roc run</code> crashes with overflow while <code>roc run --optimize</code> essentially shows undefined behavior.</p>



<a name="315621484"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/358903-advent%20of%20code/topic/Day%2012/near/315621484" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/358903-advent-of-code/topic/Day.2012.html#315621484">(Dec 13 2022 at 15:46)</a>:</h4>
<p>Just a note, <code>roc dev --optimize</code> works. So you can have both</p>



<a name="315626056"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/358903-advent%20of%20code/topic/Day%2012/near/315626056" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Shritesh Bhattarai <a href="https://roc-lang.github.io/zulip-export/stream/358903-advent-of-code/topic/Day.2012.html#315626056">(Dec 13 2022 at 16:07)</a>:</h4>
<p>Huh. Only <code>roc run --optimize</code> manifests the "undefined behavior". <code>roc dev</code>, <code>roc dev --optimize</code> and <code>roc run</code> all result in the integer overflow.</p>



<a name="315627539"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/358903-advent%20of%20code/topic/Day%2012/near/315627539" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/358903-advent-of-code/topic/Day.2012.html#315627539">(Dec 13 2022 at 16:14)</a>:</h4>
<p>That's quite intriguing. Definitely something to investigate</p>



<a name="315635026"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/358903-advent%20of%20code/topic/Day%2012/near/315635026" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/358903-advent-of-code/topic/Day.2012.html#315635026">(Dec 13 2022 at 16:46)</a>:</h4>
<p>seems likely to be unrelated</p>



<a name="315635155"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/358903-advent%20of%20code/topic/Day%2012/near/315635155" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/358903-advent-of-code/topic/Day.2012.html#315635155">(Dec 13 2022 at 16:47)</a>:</h4>
<p>like there's an <code>--optimize</code> bug unrelated to overflow that's causing things to break in a way that means the overflow doesn't happen</p>



<a name="315635986"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/358903-advent%20of%20code/topic/Day%2012/near/315635986" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/358903-advent-of-code/topic/Day.2012.html#315635986">(Dec 13 2022 at 16:51)</a>:</h4>
<p>But only in <code>run --optimize</code> and not <code>dev --optimize</code>?</p>



<a name="315636327"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/358903-advent%20of%20code/topic/Day%2012/near/315636327" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/358903-advent-of-code/topic/Day.2012.html#315636327">(Dec 13 2022 at 16:52)</a>:</h4>
<p>Yeah, i see. I guess it means there is a compiler bug. Then there is also the bug with the example shared</p>



<a name="315662723"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/358903-advent%20of%20code/topic/Day%2012/near/315662723" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Shritesh Bhattarai <a href="https://roc-lang.github.io/zulip-export/stream/358903-advent-of-code/topic/Day.2012.html#315662723">(Dec 13 2022 at 18:58)</a>:</h4>
<p>Ok so this is definitely a compiler bug: I fixed the integer overflow error in my code. <code>roc run</code>, <code>roc dev</code> and <code>roc dev --optimize</code> all return the correct result. <code>roc run --optimize</code> crashes at that exact same point as before. <a href="https://github.com/shritesh/advent/blob/d021f18788fd46b12b485df7932fc5c8315c4e55/2022/12.roc">https://github.com/shritesh/advent/blob/d021f18788fd46b12b485df7932fc5c8315c4e55/2022/12.roc</a></p>



<a name="315663570"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/358903-advent%20of%20code/topic/Day%2012/near/315663570" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Shritesh Bhattarai <a href="https://roc-lang.github.io/zulip-export/stream/358903-advent-of-code/topic/Day.2012.html#315663570">(Dec 13 2022 at 19:02)</a>:</h4>
<p>moar: <code>roc build --optimize</code> is broken as well</p>



<a name="315663989"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/358903-advent%20of%20code/topic/Day%2012/near/315663989" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Shritesh Bhattarai <a href="https://roc-lang.github.io/zulip-export/stream/358903-advent-of-code/topic/Day.2012.html#315663989">(Dec 13 2022 at 19:04)</a>:</h4>
<p>even moar: the same holds true for <code>--opt-size</code> instead of <code>--optimize</code> for all the commands.</p>



<a name="315668436"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/358903-advent%20of%20code/topic/Day%2012/near/315668436" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Shritesh Bhattarai <a href="https://roc-lang.github.io/zulip-export/stream/358903-advent-of-code/topic/Day.2012.html#315668436">(Dec 13 2022 at 19:27)</a>:</h4>
<p>Opened up an issue: <a href="https://github.com/roc-lang/roc/issues/4756">https://github.com/roc-lang/roc/issues/4756</a></p>



<a name="315851758"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/358903-advent%20of%20code/topic/Day%2012/near/315851758" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Shritesh Bhattarai <a href="https://roc-lang.github.io/zulip-export/stream/358903-advent-of-code/topic/Day.2012.html#315851758">(Dec 14 2022 at 15:53)</a>:</h4>
<p>Anyway, <a href="https://github.com/shritesh/advent/blob/main/2022/12.roc">here's my final solution for Day 12</a>. I'm extremely pleased with the result. Implementing Dijkstra's in Roc forced me to truly internalize the algorithm while my previous understanding was a data structure centric one: "use a minimum priority queue, mark nodes as visited, etc.". Roc is turning into my favorite programming language by the day.</p>



<hr><p>Last updated: Nov 01 2025 at 12:13 UTC</p>
</html>