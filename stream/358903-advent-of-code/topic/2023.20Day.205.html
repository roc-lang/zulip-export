<html>
<head><meta charset="utf-8"><title>2023 Day 5 · advent of code · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://roc-lang.github.io/zulip-export/stream/358903-advent-of-code/index.html">advent of code</a></h2>
<h3>Topic: <a href="https://roc-lang.github.io/zulip-export/stream/358903-advent-of-code/topic/2023.20Day.205.html">2023 Day 5</a></h3>

<hr>

<base href="https://roc.zulipchat.com">

<head><link href="https://roc-lang.github.io/zulip-export/style.css" rel="stylesheet"></head>

<a name="406014387"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/358903-advent%20of%20code/topic/2023%20Day%205/near/406014387" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Fabian Schmalzried <a href="https://roc-lang.github.io/zulip-export/stream/358903-advent-of-code/topic/2023.20Day.205.html#406014387">(Dec 05 2023 at 09:41)</a>:</h4>
<p><a href="https://gist.github.com/FabHof/0d69430f0a55c8be9eaacb10433d1329">Here is my day 5</a>, but part 2 is way to slow. I'm still waiting for the output, but i get the feeling I will  have to optimize...</p>



<a name="406036595"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/358903-advent%20of%20code/topic/2023%20Day%205/near/406036595" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> joshi <a href="https://roc-lang.github.io/zulip-export/stream/358903-advent-of-code/topic/2023.20Day.205.html#406036595">(Dec 05 2023 at 11:31)</a>:</h4>
<p>Uh boy, this was quite something...<br>
I feel like "AoC is easier on workdays" might not quite be true <span aria-label="joy" class="emoji emoji-1f602" role="img" title="joy">:joy:</span></p>
<p>My part 2 takes 10 minutes to run, but this was still faster than me trying to come up and implement a smarter solution, so I guess I'm done?</p>
<div class="spoiler-block"><div class="spoiler-header">
<p>the smarter idea</p>
</div><div class="spoiler-content" aria-hidden="true">
<p>These maps are linear transformations from Nat -&gt; Nat, so according to math, there is way to combine those. And since they are linear, we can predict how they behave "in between", so we only need to look at the ends of each mapping. If we did this with all of them, we would have a single map seed-to-location. Using that map, we would no longer need to scan the entire seed range, we would just need to look up the critical points (whenever the mapping changes) and compare those, since we know that inside of a mapping, all values are monotonically increasing.</p>
<p>There is probably a very smart way of combining these maps with a bunch of math, but my idea would have been to sort them based on the middle value (so dest in the first map and src in the second map), and then look at the heads of those lists repeatedly, comparing the "ends" to generate new ranges..</p>
</div></div>
<p><a href="https://gitlab.com/arkandos/aoc/-/blob/2023/solutions/day5.roc?ref_type=heads">https://gitlab.com/arkandos/aoc/-/blob/2023/solutions/day5.roc?ref_type=heads</a></p>



<a name="406042520"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/358903-advent%20of%20code/topic/2023%20Day%205/near/406042520" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Fabian Schmalzried <a href="https://roc-lang.github.io/zulip-export/stream/358903-advent-of-code/topic/2023.20Day.205.html#406042520">(Dec 05 2023 at 12:09)</a>:</h4>
<p><a href="https://gist.github.com/FabHof/5d42ee02f04f55da7326cbef0cec42c2">Here is my new day 5</a>. It's super fast now, but could use some cleanup.</p>
<div class="spoiler-block"><div class="spoiler-header">
<p>How I did speed it up</p>
</div><div class="spoiler-content" aria-hidden="true">
<p>You don't have to transform every seed value in a range. You can just transform the start. You might have to split one seed range into sveral, when it overlaps with the transformation range.</p>
</div></div>



<a name="406058770"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/358903-advent%20of%20code/topic/2023%20Day%205/near/406058770" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Johan Lindskogen <a href="https://roc-lang.github.io/zulip-export/stream/358903-advent-of-code/topic/2023.20Day.205.html#406058770">(Dec 05 2023 at 13:41)</a>:</h4>
<p>Day 5! Runs in about 7 minutes :D <a href="https://github.com/lindskogen/advent-of-code-2023/blob/main/day05/main.roc">https://github.com/lindskogen/advent-of-code-2023/blob/main/day05/main.roc</a></p>



<a name="406123281"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/358903-advent%20of%20code/topic/2023%20Day%205/near/406123281" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Oskar Hahn <a href="https://roc-lang.github.io/zulip-export/stream/358903-advent-of-code/topic/2023.20Day.205.html#406123281">(Dec 05 2023 at 18:43)</a>:</h4>
<p>Here is mine: <a href="https://github.com/ostcar/aoc2023/blob/main/days/day05.roc">https://github.com/ostcar/aoc2023/blob/main/days/day05.roc</a></p>
<div class="codehilite"><pre><span></span><code>Part1 in 2.422ms:
XXX

Part2 in 98.236ms:
XXX
</code></pre></div>
<p>It is nice, that roc partly compiles. I implemented the type signatures and put them together like</p>
<div class="codehilite" data-code-language="roc"><pre><span></span><code>expect
  part1 exampleInput == "result"

part1 = \input -&gt;
  input
  |&gt; doSomething
  |&gt; somethingElse

doSomething : Input -&gt; Output
somethingElse : OtherInput -&gt; OtherOutput
</code></pre></div>
<p>Then I called <code>roc test day05.roc</code> and the compiler told my what to do next :)</p>
<p>The feature I missed today was to rename a deconstructed value. For example</p>
<div class="codehilite" data-code-language="roc"><pre><span></span><code>[first, .. as rest ] = mylist
</code></pre></div>
<p>or</p>
<div class="codehilite" data-code-language="roc"><pre><span></span><code>RecordOne : {first : Str, second : Str}
RecordTwo : {first : Str, second : Str}

myFunc : RecordOne, RecordTwo -&gt; Str
myFunc = \{first as first1, second as second1}, {first as first2, second as second2} -&gt;
  ...
</code></pre></div>
<p>The <code>as</code> keyword works in pattern matching. Would it be possible, that it would also work in the deconstructing a datastructure?</p>



<a name="406142857"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/358903-advent%20of%20code/topic/2023%20Day%205/near/406142857" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/358903-advent-of-code/topic/2023.20Day.205.html#406142857">(Dec 05 2023 at 19:13)</a>:</h4>
<p>Super lazy and just brute force walking everything: <a href="https://github.com/bhansconnect/roc-aoc-2023/blob/main/day5.roc">https://github.com/bhansconnect/roc-aoc-2023/blob/main/day5.roc</a></p>
<div class="spoiler-block"><div class="spoiler-header">
<p>Probably a smarter way to do things</p>
</div><div class="spoiler-content" aria-hidden="true">
<ol>
<li>collapse all dictionaries into 1 dictionary with more ranges</li>
<li>split the seed groups at the complete range boundaries</li>
<li>run through the smallest seed in each range</li>
</ol>
</div></div>



<a name="406148742"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/358903-advent%20of%20code/topic/2023%20Day%205/near/406148742" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Pearce Keesling <a href="https://roc-lang.github.io/zulip-export/stream/358903-advent-of-code/topic/2023.20Day.205.html#406148742">(Dec 05 2023 at 19:54)</a>:</h4>
<p>I'm really glad I'm not the only lazy soul who just waited 8 minutes for part 2 to run.<br>
<a href="https://github.com/keeslinp/AoC2023/blob/main/day5.roc">https://github.com/keeslinp/AoC2023/blob/main/day5.roc</a></p>
<p>I finally took the time to grok the parser lib and I think I've got the hang of it. <br>
I know there was some discussion around short-circuit conditionals a while back and I just ran into a sharp edge related to that. I had to do</p>
<div class="codehilite"><pre><span></span><code>            if location &gt;= source then
                if location - source &lt;= size then
                    Bool.true
                else
                    Bool.false
            else
                Bool.false
</code></pre></div>
<p>because<br>
<code> location &gt;= source &amp;&amp; location - source &lt;= size</code> caused underflow <span aria-label="disappointed" class="emoji emoji-1f61e" role="img" title="disappointed">:disappointed:</span> .</p>



<a name="406160935"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/358903-advent%20of%20code/topic/2023%20Day%205/near/406160935" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Axel <a href="https://roc-lang.github.io/zulip-export/stream/358903-advent-of-code/topic/2023.20Day.205.html#406160935">(Dec 05 2023 at 21:18)</a>:</h4>
<p>Also in camp brute force here with <a href="https://github.com/axelerator/aoc23/blob/main/05/main.roc">my solution</a>. <span aria-label="see no evil" class="emoji emoji-1f648" role="img" title="see no evil">:see_no_evil:</span></p>



<a name="406161803"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/358903-advent%20of%20code/topic/2023%20Day%205/near/406161803" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Asbjørn Olling <a href="https://roc-lang.github.io/zulip-export/stream/358903-advent-of-code/topic/2023.20Day.205.html#406161803">(Dec 05 2023 at 21:23)</a>:</h4>
<p>I <em>think</em> I solved part 1.. but I hit a compiler bug once I wrote the final line to my solution <span aria-label="cry" class="emoji emoji-1f622" role="img" title="cry">:cry:</span> </p>
<p><a href="https://gitlab.com/AsbjornOlling/aoc2023/-/blob/main/05/main.roc">https://gitlab.com/AsbjornOlling/aoc2023/-/blob/main/05/main.roc</a></p>
<p>I even tested everything with <code>expect</code>s as I built it, going bottom-up, and all the components work perfectly by themselves, so I'm pretty convinced that my solution works. It's just that my one line of top-level call panics the compiler.</p>
<div class="spoiler-block"><div class="spoiler-header">
<p>RUST_BACKTRACE=full</p>
</div><div class="spoiler-content" aria-hidden="true">
<p>thread 'main' panicked at 'Error in alias analysis: error in module ModName("UserApp"), function definition FuncName("\x07\x00\x00\x00\x05\x00\x00\x00\x0e\xa0\xc6\x8f\xe8\x93\x17N"), definition of value binding ValueId(14): expected type '((),)', found type '((), "UserApp"::"\x81\xcc+\xe5S\x0c\x05\xe0")'', crates/compiler/gen_llvm/src/llvm/build.rs:5657:19<br>
stack backtrace:<br>
   0:     0x55a9f0764db1 - &lt;std::sys_common::backtrace::_print::DisplayBacktrace as core::fmt::Display&gt;::fmt::hbd7d55b7108d2ab8<br>
   1:     0x55a9f079267f - core::fmt::write::h6d54cd7c9e155ec5<br>
   2:     0x55a9f0760511 - std::io::Write::write_fmt::h6a453a71c692f63b<br>
   3:     0x55a9f0764bc5 - std::sys_common::backtrace::print::h4ddf81241a51b337<br>
   4:     0x55a9f0766247 - std::panicking::default_hook::{{closure}}::hff91f1f484ade5cd<br>
   5:     0x55a9f0766034 - std::panicking::default_hook::h21f14afd59f7aef9<br>
   6:     0x55a9f07666fc - std::panicking::rust_panic_with_hook::h45f66047b14c555c<br>
   7:     0x55a9f07665f7 - std::panicking::begin_panic_handler::{{closure}}::h49d1a88ef0908eb4<br>
   8:     0x55a9f07651e6 - std::sys_common::backtrace::__rust_end_short_backtrace::hccebf9e57f8cc425<br>
   9:     0x55a9f0766342 - rust_begin_unwind<br>
  10:     0x55a9edbaffd3 - core::panicking::panic_fmt::h54ec9d0e3180a83d<br>
  11:     0x55a9edeb2a56 - roc_gen_llvm::llvm::build::build_procedures_help::h3bdbf853df53af30<br>
  12:     0x55a9edeabbc6 - roc_gen_llvm::llvm::build::build_procedures::hf6aa704b1457d960<br>
  13:     0x55a9ede3fffb - roc_build::program::gen_from_mono_module::hd8aa38f35064a0fa<br>
  14:     0x55a9ede43bca - roc_build::program::build_loaded_file::h7f4fcbda2c49fd48<br>
  15:     0x55a9ede42ce7 - roc_build::program::build_file::h56efdeac74910bed<br>
  16:     0x55a9eddae4ff - roc_cli::build::hf61cc95ee731e1c7<br>
  17:     0x55a9edc95676 - roc::main::h8c0286bbf2fcf86b<br>
  18:     0x55a9edc8b823 - std::sys_common::backtrace::__rust_begin_short_backtrace::ha2e31af2549d8703<br>
  19:     0x55a9edc8b8e3 - std::rt::lang_start::{{closure}}::h1a31ddf22b52a3d4<br>
  20:     0x55a9f0757025 - std::rt::lang_start_internal::hf502095b101390bb<br>
  21:     0x55a9edc984e5 - main<br>
  22:     0x7f5ccd83dace - __libc_start_call_main<br>
  23:     0x7f5ccd83db89 - __libc_start_main@@GLIBC_2.34<br>
  24:     0x55a9edc8a625 - _start<br>
  25:                0x0 - &lt;unknown&gt;</p>
</div></div>
<p>I'm not sure what to do. I guess I'll try rewriting it in a different way, and hope to avoid the crash condition - but (what seems to be) the offending line is just a straightforward <code>List.map</code> call, so it's gonna be a bit obtuse.</p>



<a name="406162734"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/358903-advent%20of%20code/topic/2023%20Day%205/near/406162734" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/358903-advent-of-code/topic/2023.20Day.205.html#406162734">(Dec 05 2023 at 21:30)</a>:</h4>
<p><code>List.walk</code> building a chain of closures.</p>



<a name="406162767"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/358903-advent%20of%20code/topic/2023%20Day%205/near/406162767" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Asbjørn Olling <a href="https://roc-lang.github.io/zulip-export/stream/358903-advent-of-code/topic/2023.20Day.205.html#406162767">(Dec 05 2023 at 21:30)</a>:</h4>
<p>lol yes <span aria-label="rolling on the floor laughing" class="emoji emoji-1f923" role="img" title="rolling on the floor laughing">:rolling_on_the_floor_laughing:</span></p>



<a name="406162777"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/358903-advent%20of%20code/topic/2023%20Day%205/near/406162777" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/358903-advent-of-code/topic/2023.20Day.205.html#406162777">(Dec 05 2023 at 21:30)</a>:</h4>
<p>That probably is somehow the root cause of the crash</p>



<a name="406162822"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/358903-advent%20of%20code/topic/2023%20Day%205/near/406162822" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/358903-advent-of-code/topic/2023.20Day.205.html#406162822">(Dec 05 2023 at 21:31)</a>:</h4>
<p>Lambda sets sadly have some bugs and you are probably hitting one...but that's just a guess</p>



<a name="406162824"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/358903-advent%20of%20code/topic/2023%20Day%205/near/406162824" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Asbjørn Olling <a href="https://roc-lang.github.io/zulip-export/stream/358903-advent-of-code/topic/2023.20Day.205.html#406162824">(Dec 05 2023 at 21:31)</a>:</h4>
<p>funkily enough, I do that twice in my program, but the other instance worked</p>



<a name="406162982"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/358903-advent%20of%20code/topic/2023%20Day%205/near/406162982" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Asbjørn Olling <a href="https://roc-lang.github.io/zulip-export/stream/358903-advent-of-code/topic/2023.20Day.205.html#406162982">(Dec 05 2023 at 21:32)</a>:</h4>
<p>Ha just before beginning todays aoc, I was listening to the Software Unscripted episode with Casey Muratori,<br>
and rtfeldman mentioned exactly that lambda sets are often the cause <span aria-label="sweat smile" class="emoji emoji-1f605" role="img" title="sweat smile">:sweat_smile:</span></p>



<a name="406168412"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/358903-advent%20of%20code/topic/2023%20Day%205/near/406168412" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Asbjørn Olling <a href="https://roc-lang.github.io/zulip-export/stream/358903-advent-of-code/topic/2023.20Day.205.html#406168412">(Dec 05 2023 at 22:14)</a>:</h4>
<p>heyy I rewrote it into something that works</p>



<a name="406168479"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/358903-advent%20of%20code/topic/2023%20Day%205/near/406168479" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Asbjørn Olling <a href="https://roc-lang.github.io/zulip-export/stream/358903-advent-of-code/topic/2023.20Day.205.html#406168479">(Dec 05 2023 at 22:14)</a>:</h4>
<p>..and then I found out that I had understood the task wrong <span aria-label="sweat smile" class="emoji emoji-1f605" role="img" title="sweat smile">:sweat_smile:</span>  typical</p>



<a name="406169043"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/358903-advent%20of%20code/topic/2023%20Day%205/near/406169043" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Asbjørn Olling <a href="https://roc-lang.github.io/zulip-export/stream/358903-advent-of-code/topic/2023.20Day.205.html#406169043">(Dec 05 2023 at 22:19)</a>:</h4>
<p>luckily it was just a matter of using the wrong order of (outrange, inrange, len)</p>



<a name="406212449"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/358903-advent%20of%20code/topic/2023%20Day%205/near/406212449" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jason Hobbs <a href="https://roc-lang.github.io/zulip-export/stream/358903-advent-of-code/topic/2023.20Day.205.html#406212449">(Dec 06 2023 at 03:25)</a>:</h4>
<p>I managed to solve Part 1, but not Part 2... </p>
<div class="spoiler-block"><div class="spoiler-header">
<p>Part 1</p>
</div><div class="spoiler-content" aria-hidden="true">
<div class="codehilite" data-code-language="Elm"><pre><span></span><code><span class="nv">app</span><span class="w"> </span><span class="s">"hello"</span>
<span class="w">    </span><span class="nv">packages</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="nv">pf</span><span class="nf">:</span><span class="w"> </span><span class="s">"https://github.com/roc-lang/basic-cli/releases/download/0.7.0/bkGby8jb0tmZYsy2hg1E_B2QrCgcSTxdUlHtETwm5m4.tar.br"</span><span class="p">,</span>
<span class="w">        </span><span class="nv">parser</span><span class="nf">:</span><span class="w"> </span><span class="s">"https://github.com/lukewilliamboswell/roc-parser/releases/download/0.3.0/-e3ebWWmlFPfe9fYrr2z1urfslzygbtQQsl69iH1qzQ.tar.br"</span><span class="p">,</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="nv">imports</span>
<span class="w">    </span><span class="p">[</span>
<span class="w">        </span><span class="nv">pf</span><span class="nf">.</span><span class="kt">Stdout</span><span class="p">,</span>
<span class="w">        </span><span class="nv">pf</span><span class="nf">.</span><span class="kt">Task</span><span class="p">,</span>
<span class="w">        </span><span class="s">"./day5-input.txt"</span><span class="w"> </span><span class="kr">as</span><span class="w"> </span><span class="nv">input</span><span class="w"> </span><span class="nf">:</span><span class="w"> </span><span class="kt">Str</span><span class="p">,</span>
<span class="w">        </span><span class="nv">parser</span><span class="nf">.</span><span class="kt">Core</span><span class="nf">.</span><span class="p">{</span><span class="w"> </span><span class="kt">Parser</span><span class="p">,</span><span class="w"> </span><span class="nv">const</span><span class="p">,</span><span class="w"> </span><span class="nv">keep</span><span class="p">,</span><span class="w"> </span><span class="nv">skip</span><span class="p">,</span><span class="w"> </span><span class="nv">map</span><span class="p">,</span><span class="w"> </span><span class="nv">oneOrMore</span><span class="p">,</span><span class="w"> </span><span class="nv">sepBy</span><span class="w"> </span><span class="p">},</span>
<span class="w">        </span><span class="nv">parser</span><span class="nf">.</span><span class="kt">String</span><span class="nf">.</span><span class="p">{</span><span class="w"> </span><span class="nv">anyCodeunit</span><span class="p">,</span><span class="w"> </span><span class="nv">digits</span><span class="p">,</span><span class="w"> </span><span class="nv">oneOf</span><span class="p">,</span><span class="w"> </span><span class="nv">parseStr</span><span class="p">,</span><span class="w"> </span><span class="nv">parseStrPartial</span><span class="p">,</span><span class="w"> </span><span class="nv">string</span><span class="w"> </span><span class="p">},</span>
<span class="w">    </span><span class="p">]</span>
<span class="w">    </span><span class="nv">provides</span><span class="w"> </span><span class="p">[</span><span class="nv">main</span><span class="p">]</span><span class="w"> </span><span class="nv">to</span><span class="w"> </span><span class="nv">pf</span>

<span class="kr">main </span><span class="nf">=</span>
<span class="w">    </span><span class="p">{}</span><span class="w"> </span><span class="nf">&lt;-</span><span class="w"> </span><span class="kt">Stdout</span><span class="nf">.</span><span class="nv">line</span><span class="w"> </span><span class="s">"The lowest location is \(part1 input)"</span><span class="w"> </span><span class="nf">|&gt;</span><span class="w"> </span><span class="kt">Task</span><span class="nf">.</span><span class="nv">await</span>
<span class="w">    </span><span class="err">#</span><span class="w"> </span><span class="p">{}</span><span class="w"> </span><span class="nf">&lt;-</span><span class="w"> </span><span class="kt">Stdout</span><span class="nf">.</span><span class="nv">line</span><span class="w"> </span><span class="s">"The gear ratios are \(part2 input)"</span><span class="w"> </span><span class="nf">|&gt;</span><span class="w"> </span><span class="kt">Task</span><span class="nf">.</span><span class="nv">await</span>
<span class="w">    </span><span class="kt">Task</span><span class="nf">.</span><span class="nv">ok</span><span class="w"> </span><span class="p">{}</span>

<span class="nv">part1</span><span class="w"> </span><span class="nf">:</span><span class="w"> </span><span class="kt">Str</span><span class="w"> </span><span class="nf">-&gt;</span><span class="w"> </span><span class="kt">Str</span>
<span class="nv">part1</span><span class="w"> </span><span class="nf">=</span><span class="w"> </span><span class="nf">\</span><span class="nv">almanac</span><span class="w"> </span><span class="nf">-&gt;</span>
<span class="w">    </span><span class="nv">parsedAlmanac</span><span class="w"> </span><span class="nf">=</span>
<span class="w">        </span><span class="nv">almanac</span>
<span class="w">        </span><span class="nf">|&gt;</span><span class="w"> </span><span class="nv">parseSeeds</span>
<span class="w">        </span><span class="nf">|&gt;</span><span class="w"> </span><span class="nv">almanacMap</span><span class="w"> </span><span class="s">"seed-to-soil"</span>
<span class="w">        </span><span class="nf">|&gt;</span><span class="w"> </span><span class="nv">almanacMap</span><span class="w"> </span><span class="s">"soil-to-fertilizer"</span>
<span class="w">        </span><span class="nf">|&gt;</span><span class="w"> </span><span class="nv">almanacMap</span><span class="w"> </span><span class="s">"fertilizer-to-water"</span>
<span class="w">        </span><span class="nf">|&gt;</span><span class="w"> </span><span class="nv">almanacMap</span><span class="w"> </span><span class="s">"water-to-light"</span>
<span class="w">        </span><span class="nf">|&gt;</span><span class="w"> </span><span class="nv">almanacMap</span><span class="w"> </span><span class="s">"light-to-temperature"</span>
<span class="w">        </span><span class="nf">|&gt;</span><span class="w"> </span><span class="nv">almanacMap</span><span class="w"> </span><span class="s">"temperature-to-humidity"</span>
<span class="w">        </span><span class="nf">|&gt;</span><span class="w"> </span><span class="nv">almanacMap</span><span class="w"> </span><span class="s">"humidity-to-location"</span>

<span class="w">    </span><span class="kt">List</span><span class="nf">.</span><span class="nv">min</span><span class="w"> </span><span class="nv">parsedAlmanac</span><span class="nf">.</span><span class="nv">list</span>
<span class="w">    </span><span class="nf">|&gt;</span><span class="w"> </span><span class="nf">\</span><span class="nv">result</span><span class="w"> </span><span class="nf">-&gt;</span>
<span class="w">        </span><span class="nv">when</span><span class="w"> </span><span class="nv">result</span><span class="w"> </span><span class="nv">is</span>
<span class="w">            </span><span class="kt">Ok</span><span class="w"> </span><span class="nv">num</span><span class="w"> </span><span class="nf">-&gt;</span><span class="w"> </span><span class="kt">Num</span><span class="nf">.</span><span class="nv">toStr</span><span class="w"> </span><span class="nv">num</span>
<span class="w">            </span><span class="kt">Err</span><span class="w"> </span><span class="nv">_</span><span class="w"> </span><span class="nf">-&gt;</span><span class="w"> </span><span class="s">"Unknown"</span>


<span class="kt">AlmanacList</span><span class="w"> </span><span class="nf">:</span><span class="w"> </span><span class="kt">List</span><span class="w"> </span><span class="kt">U64</span>

<span class="kt">ParsedAlmanac</span><span class="w"> </span><span class="nf">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nv">almanac</span><span class="w"> </span><span class="nf">:</span><span class="w"> </span><span class="kt">Str</span><span class="p">,</span><span class="w"> </span><span class="nv">list</span><span class="w"> </span><span class="nf">:</span><span class="w"> </span><span class="kt">AlmanacList</span><span class="w"> </span><span class="p">}</span>

<span class="nv">seedParserMapper</span><span class="w"> </span><span class="nf">:</span><span class="w"> </span><span class="kt">List</span><span class="w"> </span><span class="kt">Nat</span><span class="w"> </span><span class="nf">-&gt;</span><span class="w"> </span><span class="kt">List</span><span class="w"> </span><span class="kt">U64</span>
<span class="nv">seedParserMapper</span><span class="w"> </span><span class="nf">=</span><span class="w"> </span><span class="nf">\</span><span class="nv">i</span><span class="w"> </span><span class="nf">-&gt;</span><span class="w"> </span><span class="kt">List</span><span class="nf">.</span><span class="nv">map</span><span class="w"> </span><span class="nv">i</span><span class="w"> </span><span class="kt">Num</span><span class="nf">.</span><span class="nv">toU64</span>

<span class="nv">seedParser</span><span class="w"> </span><span class="nf">:</span><span class="w"> </span><span class="kt">Parser</span><span class="w"> </span><span class="p">(</span><span class="kt">List</span><span class="w"> </span><span class="kt">U8</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="kt">List</span><span class="w"> </span><span class="kt">U64</span><span class="p">)</span>
<span class="nv">seedParser</span><span class="w"> </span><span class="nf">=</span>
<span class="w">  </span><span class="nv">const</span><span class="w"> </span><span class="p">(</span><span class="nv">seedParserMapper</span><span class="p">)</span>
<span class="w">  </span><span class="nf">|&gt;</span><span class="w"> </span><span class="nv">skip</span><span class="w"> </span><span class="p">(</span><span class="nv">string</span><span class="w"> </span><span class="s">"seeds: "</span><span class="p">)</span>
<span class="w">  </span><span class="nf">|&gt;</span><span class="w"> </span><span class="nv">keep</span><span class="w"> </span><span class="p">(</span><span class="nv">digits</span><span class="w"> </span><span class="nf">|&gt;</span><span class="w"> </span><span class="nv">sepBy</span><span class="w"> </span><span class="p">(</span><span class="nv">string</span><span class="w"> </span><span class="s">" "</span><span class="p">))</span>
<span class="w">  </span><span class="nf">|&gt;</span><span class="w"> </span><span class="nv">skip</span><span class="w"> </span><span class="nv">anyCodeunit</span>

<span class="nv">parseSeeds</span><span class="w"> </span><span class="nf">:</span><span class="w"> </span><span class="kt">Str</span><span class="w"> </span><span class="nf">-&gt;</span><span class="w"> </span><span class="kt">ParsedAlmanac</span>
<span class="nv">parseSeeds</span><span class="w"> </span><span class="nf">=</span><span class="w"> </span><span class="nf">\</span><span class="nv">almanac</span><span class="w"> </span><span class="nf">-&gt;</span>
<span class="w">    </span><span class="nv">seeds</span><span class="w"> </span><span class="nf">=</span><span class="w"> </span><span class="nv">parseStrPartial</span><span class="w"> </span><span class="nv">seedParser</span><span class="w"> </span><span class="nv">almanac</span>

<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="nv">almanac</span><span class="nf">:</span><span class="w"> </span><span class="nv">almanac</span><span class="p">,</span>
<span class="w">        </span><span class="nv">list</span><span class="nf">:</span>
<span class="w">            </span><span class="nv">when</span><span class="w"> </span><span class="nv">seeds</span><span class="w"> </span><span class="nv">is</span>
<span class="w">                </span><span class="kt">Ok</span><span class="w"> </span><span class="nv">r</span><span class="w"> </span><span class="nf">-&gt;</span><span class="w"> </span><span class="nv">r</span><span class="nf">.</span><span class="nv">val</span>
<span class="w">                </span><span class="kt">Err</span><span class="w"> </span><span class="nv">_</span><span class="w"> </span><span class="nf">-&gt;</span><span class="w"> </span><span class="p">[]</span>
<span class="w">    </span><span class="p">}</span>

<span class="nv">parseMap</span><span class="w"> </span><span class="nf">=</span><span class="w"> </span><span class="nf">\</span><span class="nv">almanac</span><span class="p">,</span><span class="w"> </span><span class="nv">section</span><span class="w"> </span><span class="nf">-&gt;</span>
<span class="w">    </span><span class="nv">mapValues</span><span class="w"> </span><span class="nf">=</span>
<span class="w">        </span><span class="kt">Str</span><span class="nf">.</span><span class="nv">split</span><span class="w"> </span><span class="nv">almanac</span><span class="w"> </span><span class="p">(</span><span class="kt">Str</span><span class="nf">.</span><span class="nv">concat</span><span class="w"> </span><span class="nv">section</span><span class="w"> </span><span class="s">" map:</span><span class="se">\n</span><span class="s">"</span><span class="p">)</span>
<span class="w">        </span><span class="nf">|&gt;</span><span class="w"> </span><span class="kt">List</span><span class="nf">.</span><span class="nv">get</span><span class="w"> </span><span class="mi">1</span>
<span class="w">        </span><span class="nf">|&gt;</span><span class="w"> </span><span class="kt">Result</span><span class="nf">.</span><span class="nv">withDefault</span><span class="w"> </span><span class="s">""</span>
<span class="w">        </span><span class="nf">|&gt;</span><span class="w"> </span><span class="kt">Str</span><span class="nf">.</span><span class="nv">split</span><span class="w"> </span><span class="s">"</span><span class="se">\n\n</span><span class="s">"</span>
<span class="w">        </span><span class="nf">|&gt;</span><span class="w"> </span><span class="kt">List</span><span class="nf">.</span><span class="nv">get</span><span class="w"> </span><span class="mi">0</span>
<span class="w">        </span><span class="nf">|&gt;</span><span class="w"> </span><span class="kt">Result</span><span class="nf">.</span><span class="nv">withDefault</span><span class="w"> </span><span class="s">""</span>

<span class="w">    </span><span class="kt">Str</span><span class="nf">.</span><span class="nv">split</span><span class="w"> </span><span class="nv">mapValues</span><span class="w"> </span><span class="s">"</span><span class="se">\n</span><span class="s">"</span>
<span class="w">    </span><span class="nf">|&gt;</span><span class="w"> </span><span class="kt">List</span><span class="nf">.</span><span class="nv">map</span><span class="w"> </span><span class="nf">\</span><span class="nv">lines</span><span class="w"> </span><span class="nf">-&gt;</span><span class="w"> </span><span class="kt">Str</span><span class="nf">.</span><span class="nv">split</span><span class="w"> </span><span class="nv">lines</span><span class="w"> </span><span class="s">" "</span>
<span class="w">    </span><span class="nf">|&gt;</span><span class="w"> </span><span class="kt">List</span><span class="nf">.</span><span class="nv">map</span><span class="w"> </span><span class="nf">\</span><span class="nv">lines</span><span class="w"> </span><span class="nf">-&gt;</span><span class="w"> </span><span class="kt">List</span><span class="nf">.</span><span class="nv">map</span><span class="w"> </span><span class="nv">lines</span><span class="w"> </span><span class="nf">\</span><span class="nv">line</span><span class="w"> </span><span class="nf">-&gt;</span><span class="w"> </span><span class="p">(</span><span class="kt">Str</span><span class="nf">.</span><span class="nv">toU64</span><span class="w"> </span><span class="nv">line</span><span class="w"> </span><span class="nf">|&gt;</span><span class="w"> </span><span class="kt">Result</span><span class="nf">.</span><span class="nv">withDefault</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
<span class="w">    </span><span class="nf">|&gt;</span><span class="w"> </span><span class="kt">List</span><span class="nf">.</span><span class="nv">map</span><span class="w"> </span><span class="nf">\</span><span class="nv">lines</span><span class="w"> </span><span class="nf">-&gt;</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="nv">destination</span><span class="nf">:</span><span class="w"> </span><span class="kt">List</span><span class="nf">.</span><span class="nv">get</span><span class="w"> </span><span class="nv">lines</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="nf">|&gt;</span><span class="w"> </span><span class="kt">Result</span><span class="nf">.</span><span class="nv">withDefault</span><span class="w"> </span><span class="p">(</span><span class="kt">Num</span><span class="nf">.</span><span class="nv">toU64</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">,</span>
<span class="w">            </span><span class="nv">source</span><span class="nf">:</span><span class="w"> </span><span class="kt">List</span><span class="nf">.</span><span class="nv">get</span><span class="w"> </span><span class="nv">lines</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="nf">|&gt;</span><span class="w"> </span><span class="kt">Result</span><span class="nf">.</span><span class="nv">withDefault</span><span class="w"> </span><span class="p">(</span><span class="kt">Num</span><span class="nf">.</span><span class="nv">toU64</span><span class="w"> </span><span class="mi">0</span><span class="p">),</span>
<span class="w">            </span><span class="nv">range</span><span class="nf">:</span><span class="w"> </span><span class="kt">List</span><span class="nf">.</span><span class="nv">get</span><span class="w"> </span><span class="nv">lines</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="nf">|&gt;</span><span class="w"> </span><span class="kt">Result</span><span class="nf">.</span><span class="nv">withDefault</span><span class="w"> </span><span class="p">(</span><span class="kt">Num</span><span class="nf">.</span><span class="nv">toU64</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
<span class="w">        </span><span class="p">}</span>


<span class="nv">almanacMap</span><span class="w"> </span><span class="nf">:</span><span class="w"> </span><span class="kt">ParsedAlmanac</span><span class="p">,</span><span class="w"> </span><span class="kt">Str</span><span class="w"> </span><span class="nf">-&gt;</span><span class="w"> </span><span class="kt">ParsedAlmanac</span>
<span class="nv">almanacMap</span><span class="w"> </span><span class="nf">=</span><span class="w"> </span><span class="nf">\</span><span class="nv">parsedAlmanac</span><span class="p">,</span><span class="w"> </span><span class="nv">section</span><span class="w"> </span><span class="nf">-&gt;</span>
<span class="w">    </span><span class="nv">mapper</span><span class="w"> </span><span class="nf">=</span><span class="w"> </span><span class="nv">parseMap</span><span class="w"> </span><span class="nv">parsedAlmanac</span><span class="nf">.</span><span class="nv">almanac</span><span class="w"> </span><span class="nv">section</span>
<span class="w">    </span><span class="nv">list</span><span class="w"> </span><span class="nf">=</span><span class="w"> </span><span class="kt">List</span><span class="nf">.</span><span class="nv">map</span><span class="w"> </span><span class="nv">parsedAlmanac</span><span class="nf">.</span><span class="nv">list</span><span class="w"> </span><span class="nf">\</span><span class="nv">source</span><span class="w"> </span><span class="nf">-&gt;</span><span class="w"> </span><span class="p">(</span><span class="nv">mapLocation</span><span class="w"> </span><span class="nv">source</span><span class="w"> </span><span class="nv">mapper</span><span class="p">)</span>

<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="nv">almanac</span><span class="nf">:</span><span class="w"> </span><span class="nv">parsedAlmanac</span><span class="nf">.</span><span class="nv">almanac</span><span class="p">,</span>
<span class="w">        </span><span class="nv">list</span><span class="nf">:</span><span class="w"> </span><span class="nv">list</span>
<span class="w">    </span><span class="p">}</span>

<span class="nv">mapLocation</span><span class="w"> </span><span class="nf">:</span><span class="w"> </span><span class="kt">U64</span><span class="p">,</span><span class="w"> </span><span class="kt">List</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nv">destination</span><span class="nf">:</span><span class="w"> </span><span class="kt">U64</span><span class="p">,</span><span class="w"> </span><span class="nv">source</span><span class="nf">:</span><span class="w"> </span><span class="kt">U64</span><span class="p">,</span><span class="w"> </span><span class="nv">range</span><span class="nf">:</span><span class="w"> </span><span class="kt">U64</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="nf">-&gt;</span><span class="w"> </span><span class="kt">U64</span>
<span class="nv">mapLocation</span><span class="w"> </span><span class="nf">=</span><span class="w"> </span><span class="nf">\</span><span class="nv">source</span><span class="p">,</span><span class="w"> </span><span class="nv">mapper</span><span class="w"> </span><span class="nf">-&gt;</span>
<span class="w">    </span><span class="nv">location</span><span class="w"> </span><span class="nf">=</span>
<span class="w">        </span><span class="kt">List</span><span class="nf">.</span><span class="nv">keepIf</span><span class="w"> </span><span class="nv">mapper</span><span class="w"> </span><span class="nf">\</span><span class="nv">m</span><span class="w"> </span><span class="nf">-&gt;</span><span class="w"> </span><span class="p">(</span><span class="nv">m</span><span class="nf">.</span><span class="nv">source</span><span class="w"> </span><span class="nf">+</span><span class="w"> </span><span class="nv">m</span><span class="nf">.</span><span class="nv">range</span><span class="w"> </span><span class="nf">-</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="nf">&gt;=</span><span class="w"> </span><span class="nv">source</span><span class="w"> </span><span class="nf">&amp;&amp;</span><span class="w"> </span><span class="nv">source</span><span class="w"> </span><span class="nf">&gt;=</span><span class="w"> </span><span class="nv">m</span><span class="nf">.</span><span class="nv">source</span>
<span class="w">        </span><span class="nf">|&gt;</span><span class="w"> </span><span class="kt">List</span><span class="nf">.</span><span class="nv">get</span><span class="w"> </span><span class="mi">0</span>
<span class="w">        </span><span class="nf">|&gt;</span><span class="w"> </span><span class="kt">Result</span><span class="nf">.</span><span class="nv">withDefault</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nv">destination</span><span class="nf">:</span><span class="w"> </span><span class="nv">source</span><span class="p">,</span><span class="w"> </span><span class="nv">source</span><span class="nf">:</span><span class="w"> </span><span class="nv">source</span><span class="p">,</span><span class="w"> </span><span class="nv">range</span><span class="nf">:</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">}</span>

<span class="w">    </span><span class="nv">location</span><span class="nf">.</span><span class="nv">destination</span><span class="w"> </span><span class="nf">+</span><span class="w"> </span><span class="p">(</span><span class="nv">source</span><span class="w"> </span><span class="nf">-</span><span class="w"> </span><span class="nv">location</span><span class="nf">.</span><span class="nv">source</span><span class="p">)</span>

<span class="nv">exampleInput</span><span class="w"> </span><span class="nf">=</span>
<span class="w">    </span><span class="s">"""</span>
<span class="s">    seeds: 79 14 55 13</span>

<span class="s">    seed-to-soil map:</span>
<span class="s">    50 98 2</span>
<span class="s">    52 50 48</span>

<span class="s">    soil-to-fertilizer map:</span>
<span class="s">    0 15 37</span>
<span class="s">    37 52 2</span>
<span class="s">    39 0 15</span>

<span class="s">    fertilizer-to-water map:</span>
<span class="s">    49 53 8</span>
<span class="s">    0 11 42</span>
<span class="s">    42 0 7</span>
<span class="s">    57 7 4</span>

<span class="s">    water-to-light map:</span>
<span class="s">    88 18 7</span>
<span class="s">    18 25 70</span>

<span class="s">    light-to-temperature map:</span>
<span class="s">    45 77 23</span>
<span class="s">    81 45 19</span>
<span class="s">    68 64 13</span>

<span class="s">    temperature-to-humidity map:</span>
<span class="s">    0 69 1</span>
<span class="s">    1 0 69</span>

<span class="s">    humidity-to-location map:</span>
<span class="s">    60 56 37</span>
<span class="s">    56 93 4</span>
<span class="s">    """</span>
<span class="w">    </span><span class="nf">|&gt;</span><span class="w"> </span><span class="kt">Str</span><span class="nf">.</span><span class="nv">trim</span>

<span class="nv">debug</span><span class="w"> </span><span class="nf">=</span><span class="w"> </span><span class="nf">\</span><span class="nv">v</span><span class="p">,</span><span class="w"> </span><span class="nv">ctx</span><span class="w"> </span><span class="nf">-&gt;</span>
<span class="w">    </span><span class="nv">dbg</span>
<span class="w">        </span><span class="nv">ctx</span>

<span class="w">    </span><span class="nv">dbg</span>
<span class="w">        </span><span class="nv">v</span><span class="nf">.</span><span class="nv">list</span>

<span class="w">    </span><span class="nv">v</span>
</code></pre></div>
</div></div>



<a name="406212511"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/358903-advent%20of%20code/topic/2023%20Day%205/near/406212511" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jason Hobbs <a href="https://roc-lang.github.io/zulip-export/stream/358903-advent-of-code/topic/2023.20Day.205.html#406212511">(Dec 06 2023 at 03:25)</a>:</h4>
<p>I think my Part 2 would work if my computer had a trillion more resources:</p>
<div class="spoiler-block"><div class="spoiler-header">
<p>My Part 2 - Success on example input only</p>
</div><div class="spoiler-content" aria-hidden="true">
<div class="codehilite" data-code-language="Elm"><pre><span></span><code><span class="nv">app</span><span class="w"> </span><span class="s">"hello"</span>
<span class="w">    </span><span class="nv">packages</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="nv">pf</span><span class="nf">:</span><span class="w"> </span><span class="s">"https://github.com/roc-lang/basic-cli/releases/download/0.7.0/bkGby8jb0tmZYsy2hg1E_B2QrCgcSTxdUlHtETwm5m4.tar.br"</span><span class="p">,</span>
<span class="w">        </span><span class="nv">parser</span><span class="nf">:</span><span class="w"> </span><span class="s">"https://github.com/lukewilliamboswell/roc-parser/releases/download/0.3.0/-e3ebWWmlFPfe9fYrr2z1urfslzygbtQQsl69iH1qzQ.tar.br"</span><span class="p">,</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="nv">imports</span>
<span class="w">    </span><span class="p">[</span>
<span class="w">        </span><span class="nv">pf</span><span class="nf">.</span><span class="kt">Stdout</span><span class="p">,</span>
<span class="w">        </span><span class="nv">pf</span><span class="nf">.</span><span class="kt">Task</span><span class="p">,</span>
<span class="w">        </span><span class="s">"./day5-input.txt"</span><span class="w"> </span><span class="kr">as</span><span class="w"> </span><span class="nv">input</span><span class="w"> </span><span class="nf">:</span><span class="w"> </span><span class="kt">Str</span><span class="p">,</span>
<span class="w">        </span><span class="nv">parser</span><span class="nf">.</span><span class="kt">Core</span><span class="nf">.</span><span class="p">{</span><span class="w"> </span><span class="kt">Parser</span><span class="p">,</span><span class="w"> </span><span class="nv">const</span><span class="p">,</span><span class="w"> </span><span class="nv">keep</span><span class="p">,</span><span class="w"> </span><span class="nv">skip</span><span class="p">,</span><span class="w"> </span><span class="nv">map</span><span class="p">,</span><span class="w"> </span><span class="nv">oneOrMore</span><span class="p">,</span><span class="w"> </span><span class="nv">sepBy</span><span class="w"> </span><span class="p">},</span>
<span class="w">        </span><span class="nv">parser</span><span class="nf">.</span><span class="kt">String</span><span class="nf">.</span><span class="p">{</span><span class="w"> </span><span class="nv">anyCodeunit</span><span class="p">,</span><span class="w"> </span><span class="nv">digits</span><span class="p">,</span><span class="w"> </span><span class="nv">oneOf</span><span class="p">,</span><span class="w"> </span><span class="nv">parseStr</span><span class="p">,</span><span class="w"> </span><span class="nv">parseStrPartial</span><span class="p">,</span><span class="w"> </span><span class="nv">string</span><span class="w"> </span><span class="p">},</span>
<span class="w">    </span><span class="p">]</span>
<span class="w">    </span><span class="nv">provides</span><span class="w"> </span><span class="p">[</span><span class="nv">main</span><span class="p">]</span><span class="w"> </span><span class="nv">to</span><span class="w"> </span><span class="nv">pf</span>

<span class="kr">main </span><span class="nf">=</span>
<span class="w">    </span><span class="err">#</span><span class="w"> </span><span class="p">{}</span><span class="w"> </span><span class="nf">&lt;-</span><span class="w"> </span><span class="kt">Stdout</span><span class="nf">.</span><span class="nv">line</span><span class="w"> </span><span class="s">"The lowest location is \(part1 input)"</span><span class="w"> </span><span class="nf">|&gt;</span><span class="w"> </span><span class="kt">Task</span><span class="nf">.</span><span class="nv">await</span>
<span class="w">    </span><span class="p">{}</span><span class="w"> </span><span class="nf">&lt;-</span><span class="w"> </span><span class="kt">Stdout</span><span class="nf">.</span><span class="nv">line</span><span class="w"> </span><span class="s">"The gear ratios are \(part2 input)"</span><span class="w"> </span><span class="nf">|&gt;</span><span class="w"> </span><span class="kt">Task</span><span class="nf">.</span><span class="nv">await</span>
<span class="w">    </span><span class="kt">Task</span><span class="nf">.</span><span class="nv">ok</span><span class="w"> </span><span class="p">{}</span>

<span class="nv">part1</span><span class="w"> </span><span class="nf">:</span><span class="w"> </span><span class="kt">Str</span><span class="w"> </span><span class="nf">-&gt;</span><span class="w"> </span><span class="kt">Str</span>
<span class="nv">part1</span><span class="w"> </span><span class="nf">=</span><span class="w"> </span><span class="nf">\</span><span class="nv">almanac</span><span class="w"> </span><span class="nf">-&gt;</span>
<span class="w">    </span><span class="nv">parsedAlmanac</span><span class="w"> </span><span class="nf">=</span>
<span class="w">        </span><span class="nv">almanac</span>
<span class="w">        </span><span class="nf">|&gt;</span><span class="w"> </span><span class="nv">parseSeeds</span>
<span class="w">        </span><span class="nf">|&gt;</span><span class="w"> </span><span class="nv">almanacMap</span><span class="w"> </span><span class="s">"seed-to-soil"</span>
<span class="w">        </span><span class="nf">|&gt;</span><span class="w"> </span><span class="nv">almanacMap</span><span class="w"> </span><span class="s">"soil-to-fertilizer"</span>
<span class="w">        </span><span class="nf">|&gt;</span><span class="w"> </span><span class="nv">almanacMap</span><span class="w"> </span><span class="s">"fertilizer-to-water"</span>
<span class="w">        </span><span class="nf">|&gt;</span><span class="w"> </span><span class="nv">almanacMap</span><span class="w"> </span><span class="s">"water-to-light"</span>
<span class="w">        </span><span class="nf">|&gt;</span><span class="w"> </span><span class="nv">almanacMap</span><span class="w"> </span><span class="s">"light-to-temperature"</span>
<span class="w">        </span><span class="nf">|&gt;</span><span class="w"> </span><span class="nv">almanacMap</span><span class="w"> </span><span class="s">"temperature-to-humidity"</span>
<span class="w">        </span><span class="nf">|&gt;</span><span class="w"> </span><span class="nv">almanacMap</span><span class="w"> </span><span class="s">"humidity-to-location"</span>

<span class="w">    </span><span class="kt">List</span><span class="nf">.</span><span class="nv">min</span><span class="w"> </span><span class="nv">parsedAlmanac</span><span class="nf">.</span><span class="nv">list</span>
<span class="w">    </span><span class="nf">|&gt;</span><span class="w"> </span><span class="nf">\</span><span class="nv">result</span><span class="w"> </span><span class="nf">-&gt;</span>
<span class="w">        </span><span class="nv">when</span><span class="w"> </span><span class="nv">result</span><span class="w"> </span><span class="nv">is</span>
<span class="w">            </span><span class="kt">Ok</span><span class="w"> </span><span class="nv">num</span><span class="w"> </span><span class="nf">-&gt;</span><span class="w"> </span><span class="kt">Num</span><span class="nf">.</span><span class="nv">toStr</span><span class="w"> </span><span class="nv">num</span>
<span class="w">            </span><span class="kt">Err</span><span class="w"> </span><span class="nv">_</span><span class="w"> </span><span class="nf">-&gt;</span><span class="w"> </span><span class="s">"Unknown"</span>


<span class="kt">Seen</span><span class="w"> </span><span class="nf">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="kt">Nothing</span><span class="p">,</span><span class="w"> </span><span class="kt">Location</span><span class="w"> </span><span class="kt">U64</span><span class="w"> </span><span class="p">]</span>

<span class="nv">part2</span><span class="w"> </span><span class="nf">:</span><span class="w"> </span><span class="kt">Str</span><span class="w"> </span><span class="nf">-&gt;</span><span class="w"> </span><span class="kt">Str</span>
<span class="nv">part2</span><span class="w"> </span><span class="nf">=</span><span class="w"> </span><span class="nf">\</span><span class="nv">almanac</span><span class="w"> </span><span class="nf">-&gt;</span>
<span class="w">    </span><span class="nv">seeds</span><span class="w"> </span><span class="nf">=</span><span class="w"> </span><span class="nv">parseStrPartial</span><span class="w"> </span><span class="nv">seedPairParser</span><span class="w"> </span><span class="nv">almanac</span>

<span class="w">    </span><span class="nv">x</span><span class="w"> </span><span class="nf">=</span><span class="w"> </span><span class="nv">when</span><span class="w"> </span><span class="nv">seeds</span><span class="w"> </span><span class="nv">is</span>
<span class="w">        </span><span class="kt">Ok</span><span class="w"> </span><span class="nv">res</span><span class="w"> </span><span class="nf">-&gt;</span><span class="w"> </span><span class="nv">res</span><span class="nf">.</span><span class="nv">val</span>
<span class="w">        </span><span class="kt">Err</span><span class="w"> </span><span class="nv">_</span><span class="w">  </span><span class="nf">-&gt;</span><span class="w"> </span><span class="p">[]</span>

<span class="w">    </span><span class="nv">first</span><span class="w"> </span><span class="nf">=</span><span class="w"> </span><span class="kt">List</span><span class="nf">.</span><span class="nv">first</span><span class="w"> </span><span class="nv">x</span>
<span class="w">    </span><span class="nv">rest</span><span class="w"> </span><span class="nf">=</span><span class="w"> </span><span class="kt">List</span><span class="nf">.</span><span class="nv">dropFirst</span><span class="w"> </span><span class="nv">x</span><span class="w"> </span><span class="mi">1</span>

<span class="w">    </span><span class="nv">when</span><span class="w"> </span><span class="nv">first</span><span class="w"> </span><span class="nv">is</span>
<span class="w">        </span><span class="kt">Ok</span><span class="w"> </span><span class="p">(</span><span class="kt">Pair</span><span class="w"> </span><span class="nv">num</span><span class="w"> </span><span class="nv">range</span><span class="p">)</span><span class="w"> </span><span class="nf">-&gt;</span>
<span class="w">            </span><span class="nv">solvePart2</span>
<span class="w">                </span><span class="p">{</span>
<span class="w">                    </span><span class="nv">almanac</span><span class="nf">:</span><span class="w"> </span><span class="nv">almanac</span><span class="p">,</span>
<span class="w">                    </span><span class="nv">pairs</span><span class="nf">:</span><span class="w"> </span><span class="nv">rest</span><span class="p">,</span>
<span class="w">                    </span><span class="nv">minSeen</span><span class="nf">:</span><span class="w"> </span><span class="kt">NothingYet</span><span class="p">,</span>
<span class="w">                    </span><span class="nv">currentNum</span><span class="nf">:</span><span class="w"> </span><span class="kt">Num</span><span class="nf">.</span><span class="nv">toU64</span><span class="w"> </span><span class="nv">num</span><span class="p">,</span>
<span class="w">                    </span><span class="nv">currentRange</span><span class="nf">:</span><span class="w"> </span><span class="kt">Range</span><span class="w"> </span><span class="p">(</span><span class="kt">Num</span><span class="nf">.</span><span class="nv">toU64</span><span class="w"> </span><span class="nv">range</span><span class="p">)</span>
<span class="w">                </span><span class="p">}</span>
<span class="w">            </span><span class="nf">|&gt;</span><span class="w"> </span><span class="kt">Num</span><span class="nf">.</span><span class="nv">toStr</span>

<span class="w">        </span><span class="nv">_</span><span class="w"> </span><span class="nf">-&gt;</span><span class="w"> </span><span class="s">"Unknown"</span>

<span class="nv">solvePart2</span><span class="w"> </span><span class="nf">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nv">almanac</span><span class="nf">:</span><span class="w"> </span><span class="kt">Str</span><span class="p">,</span><span class="w"> </span><span class="nv">pairs</span><span class="nf">:</span><span class="w"> </span><span class="kt">List</span><span class="w"> </span><span class="p">[</span><span class="kt">Pair</span><span class="w"> </span><span class="kt">Nat</span><span class="w"> </span><span class="kt">Nat</span><span class="p">],</span><span class="w"> </span><span class="nv">minSeen</span><span class="nf">:</span><span class="w"> </span><span class="p">[</span><span class="kt">NothingYet</span><span class="p">,</span><span class="w"> </span><span class="kt">Seen</span><span class="w"> </span><span class="kt">U64</span><span class="p">],</span><span class="w"> </span><span class="nv">currentNum</span><span class="nf">:</span><span class="w"> </span><span class="kt">U64</span><span class="p">,</span><span class="w"> </span><span class="nv">currentRange</span><span class="nf">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="kt">NextPair</span><span class="p">,</span><span class="w"> </span><span class="kt">Range</span><span class="w"> </span><span class="kt">U64</span><span class="w"> </span><span class="p">]</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="nf">-&gt;</span><span class="w"> </span><span class="kt">U64</span>
<span class="nv">solvePart2</span><span class="w"> </span><span class="nf">=</span><span class="w"> </span><span class="nf">\</span><span class="nv">progress</span><span class="w"> </span><span class="nf">-&gt;</span>
<span class="w">    </span><span class="nv">when</span><span class="w"> </span><span class="nv">progress</span><span class="nf">.</span><span class="nv">currentRange</span><span class="w"> </span><span class="nv">is</span>
<span class="w">        </span><span class="kt">NextPair</span><span class="w"> </span><span class="nf">-&gt;</span>
<span class="w">            </span><span class="nv">dbg</span><span class="w"> </span><span class="s">"NextPair"</span>

<span class="w">            </span><span class="nv">first</span><span class="w"> </span><span class="nf">=</span><span class="w"> </span><span class="kt">List</span><span class="nf">.</span><span class="nv">first</span><span class="w"> </span><span class="nv">progress</span><span class="nf">.</span><span class="nv">pairs</span>
<span class="w">            </span><span class="nv">rest</span><span class="w"> </span><span class="nf">=</span><span class="w"> </span><span class="kt">List</span><span class="nf">.</span><span class="nv">dropFirst</span><span class="w"> </span><span class="nv">progress</span><span class="nf">.</span><span class="nv">pairs</span><span class="w"> </span><span class="mi">1</span>

<span class="w">            </span><span class="nv">when</span><span class="w"> </span><span class="nv">first</span><span class="w"> </span><span class="nv">is</span>
<span class="w">                </span><span class="kt">Ok</span><span class="w"> </span><span class="p">(</span><span class="kt">Pair</span><span class="w"> </span><span class="nv">num</span><span class="w"> </span><span class="nv">range</span><span class="p">)</span><span class="w"> </span><span class="nf">-&gt;</span>
<span class="w">                    </span><span class="nv">solvePart2</span>
<span class="w">                        </span><span class="p">{</span>
<span class="w">                            </span><span class="nv">almanac</span><span class="nf">:</span><span class="w"> </span><span class="nv">progress</span><span class="nf">.</span><span class="nv">almanac</span><span class="p">,</span>
<span class="w">                            </span><span class="nv">pairs</span><span class="nf">:</span><span class="w"> </span><span class="nv">rest</span><span class="p">,</span>
<span class="w">                            </span><span class="nv">minSeen</span><span class="nf">:</span><span class="w"> </span><span class="nv">progress</span><span class="nf">.</span><span class="nv">minSeen</span><span class="p">,</span>
<span class="w">                            </span><span class="nv">currentNum</span><span class="nf">:</span><span class="w"> </span><span class="kt">Num</span><span class="nf">.</span><span class="nv">toU64</span><span class="w"> </span><span class="nv">num</span><span class="p">,</span>
<span class="w">                            </span><span class="nv">currentRange</span><span class="nf">:</span><span class="w"> </span><span class="kt">Range</span><span class="w"> </span><span class="p">(</span><span class="kt">Num</span><span class="nf">.</span><span class="nv">toU64</span><span class="w"> </span><span class="nv">range</span><span class="p">)</span>
<span class="w">                        </span><span class="p">}</span>

<span class="w">                </span><span class="nv">_</span><span class="w"> </span><span class="nf">-&gt;</span>
<span class="w">                    </span><span class="nv">when</span><span class="w"> </span><span class="nv">progress</span><span class="nf">.</span><span class="nv">minSeen</span><span class="w"> </span><span class="nv">is</span>
<span class="w">                        </span><span class="kt">NothingYet</span><span class="w"> </span><span class="nf">-&gt;</span><span class="w"> </span><span class="mi">0</span>
<span class="w">                        </span><span class="kt">Seen</span><span class="w"> </span><span class="nv">num</span><span class="w"> </span><span class="nf">-&gt;</span><span class="w"> </span><span class="nv">num</span>
<span class="w">        </span><span class="kt">Range</span><span class="w"> </span><span class="nv">range</span><span class="w"> </span><span class="nf">-&gt;</span>
<span class="w">            </span><span class="nv">currentLocation</span><span class="w"> </span><span class="nf">=</span>
<span class="w">                </span><span class="p">{</span>
<span class="w">                    </span><span class="nv">almanac</span><span class="nf">:</span><span class="w"> </span><span class="nv">progress</span><span class="nf">.</span><span class="nv">almanac</span><span class="p">,</span>
<span class="w">                    </span><span class="nv">source</span><span class="nf">:</span><span class="w"> </span><span class="nv">progress</span><span class="nf">.</span><span class="nv">currentNum</span>
<span class="w">                </span><span class="p">}</span>
<span class="w">                </span><span class="nf">|&gt;</span><span class="w"> </span><span class="nv">almanacMapSingle</span><span class="w"> </span><span class="s">"seed-to-soil"</span>
<span class="w">                </span><span class="nf">|&gt;</span><span class="w"> </span><span class="nv">almanacMapSingle</span><span class="w"> </span><span class="s">"soil-to-fertilizer"</span>
<span class="w">                </span><span class="nf">|&gt;</span><span class="w"> </span><span class="nv">almanacMapSingle</span><span class="w"> </span><span class="s">"fertilizer-to-water"</span>
<span class="w">                </span><span class="nf">|&gt;</span><span class="w"> </span><span class="nv">almanacMapSingle</span><span class="w"> </span><span class="s">"water-to-light"</span>
<span class="w">                </span><span class="nf">|&gt;</span><span class="w"> </span><span class="nv">almanacMapSingle</span><span class="w"> </span><span class="s">"light-to-temperature"</span>
<span class="w">                </span><span class="nf">|&gt;</span><span class="w"> </span><span class="nv">almanacMapSingle</span><span class="w"> </span><span class="s">"temperature-to-humidity"</span>
<span class="w">                </span><span class="nf">|&gt;</span><span class="w"> </span><span class="nv">almanacMapSingle</span><span class="w"> </span><span class="s">"humidity-to-location"</span>
<span class="w">                </span><span class="nf">|&gt;</span><span class="w"> </span><span class="nf">.</span><span class="nv">source</span>

<span class="w">            </span><span class="nv">minSeen</span><span class="w"> </span><span class="nf">=</span><span class="w"> </span><span class="nv">when</span><span class="w"> </span><span class="nv">progress</span><span class="nf">.</span><span class="nv">minSeen</span><span class="w"> </span><span class="nv">is</span>
<span class="w">                </span><span class="kt">NothingYet</span><span class="w"> </span><span class="nf">-&gt;</span><span class="w"> </span><span class="nv">currentLocation</span>
<span class="w">                </span><span class="kt">Seen</span><span class="w"> </span><span class="nv">s</span><span class="w"> </span><span class="nf">-&gt;</span><span class="w"> </span><span class="kr">if</span><span class="w"> </span><span class="nv">currentLocation</span><span class="w"> </span><span class="nf">&lt;</span><span class="w"> </span><span class="nv">s</span><span class="w"> </span><span class="kr">then</span><span class="w"> </span><span class="nv">currentLocation</span><span class="w"> </span><span class="kr">else</span><span class="w"> </span><span class="nv">s</span>

<span class="w">            </span><span class="nv">solvePart2</span>
<span class="w">                </span><span class="p">{</span>
<span class="w">                    </span><span class="nv">almanac</span><span class="nf">:</span><span class="w"> </span><span class="nv">progress</span><span class="nf">.</span><span class="nv">almanac</span><span class="p">,</span>
<span class="w">                    </span><span class="nv">pairs</span><span class="nf">:</span><span class="w"> </span><span class="nv">progress</span><span class="nf">.</span><span class="nv">pairs</span><span class="p">,</span>
<span class="w">                    </span><span class="nv">minSeen</span><span class="nf">:</span><span class="w"> </span><span class="kt">Seen</span><span class="w"> </span><span class="nv">minSeen</span><span class="p">,</span>
<span class="w">                    </span><span class="nv">currentNum</span><span class="nf">:</span><span class="w"> </span><span class="nv">progress</span><span class="nf">.</span><span class="nv">currentNum</span><span class="w"> </span><span class="nf">+</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span>
<span class="w">                    </span><span class="nv">currentRange</span><span class="nf">:</span><span class="w"> </span><span class="kr">if</span><span class="w"> </span><span class="nv">range</span><span class="w"> </span><span class="nf">==</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="kr">then</span><span class="w"> </span><span class="kt">NextPair</span><span class="w"> </span><span class="kr">else</span><span class="w"> </span><span class="kt">Range</span><span class="w"> </span><span class="p">(</span><span class="nv">range</span><span class="w"> </span><span class="nf">-</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span>
<span class="w">                </span><span class="p">}</span>


<span class="kt">AlmanacList</span><span class="w"> </span><span class="nf">:</span><span class="w"> </span><span class="kt">List</span><span class="w"> </span><span class="kt">U64</span>

<span class="kt">ParsedAlmanac</span><span class="w"> </span><span class="nf">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nv">almanac</span><span class="w"> </span><span class="nf">:</span><span class="w"> </span><span class="kt">Str</span><span class="p">,</span><span class="w"> </span><span class="nv">list</span><span class="w"> </span><span class="nf">:</span><span class="w"> </span><span class="kt">AlmanacList</span><span class="w"> </span><span class="p">}</span>

<span class="kt">SeedPair</span><span class="w"> </span><span class="nf">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="kt">Pair</span><span class="w"> </span><span class="kt">Nat</span><span class="w"> </span><span class="kt">Nat</span><span class="w"> </span><span class="p">]</span>

<span class="nv">seedPairParser</span><span class="w"> </span><span class="nf">:</span><span class="w"> </span><span class="kt">Parser</span><span class="w"> </span><span class="p">(</span><span class="kt">List</span><span class="w"> </span><span class="kt">U8</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="kt">List</span><span class="w"> </span><span class="p">[</span><span class="kt">Pair</span><span class="w"> </span><span class="kt">Nat</span><span class="w"> </span><span class="kt">Nat</span><span class="p">])</span>
<span class="nv">seedPairParser</span><span class="w"> </span><span class="nf">=</span>
<span class="w">    </span><span class="nv">pair</span><span class="w"> </span><span class="nf">=</span><span class="w"> </span><span class="nv">const</span><span class="w"> </span><span class="p">(</span><span class="nf">\</span><span class="nv">x</span><span class="w"> </span><span class="nf">-&gt;</span><span class="w"> </span><span class="nf">\</span><span class="nv">y</span><span class="w"> </span><span class="nf">-&gt;</span><span class="w"> </span><span class="kt">Pair</span><span class="w"> </span><span class="nv">x</span><span class="w"> </span><span class="nv">y</span><span class="p">)</span>
<span class="w">            </span><span class="nf">|&gt;</span><span class="w"> </span><span class="nv">keep</span><span class="w"> </span><span class="nv">digits</span>
<span class="w">            </span><span class="nf">|&gt;</span><span class="w"> </span><span class="nv">skip</span><span class="w"> </span><span class="p">(</span><span class="nv">string</span><span class="w"> </span><span class="s">" "</span><span class="p">)</span>
<span class="w">            </span><span class="nf">|&gt;</span><span class="w"> </span><span class="nv">keep</span><span class="w"> </span><span class="nv">digits</span>

<span class="w">    </span><span class="nv">seedPair</span><span class="w"> </span><span class="nf">:</span><span class="w"> </span><span class="kt">Parser</span><span class="w"> </span><span class="nv">_</span><span class="w"> </span><span class="p">(</span><span class="kt">List</span><span class="w"> </span><span class="p">[</span><span class="kt">Pair</span><span class="w"> </span><span class="kt">Nat</span><span class="w"> </span><span class="kt">Nat</span><span class="p">])</span>
<span class="w">    </span><span class="nv">seedPair</span><span class="w"> </span><span class="nf">=</span><span class="w"> </span><span class="nv">pair</span><span class="w"> </span><span class="nf">|&gt;</span><span class="w"> </span><span class="nv">sepBy</span><span class="w"> </span><span class="p">(</span><span class="nv">string</span><span class="w"> </span><span class="s">" "</span><span class="p">)</span>

<span class="w">    </span><span class="nv">const</span><span class="w"> </span><span class="p">(</span><span class="nf">\</span><span class="nv">i</span><span class="w"> </span><span class="nf">-&gt;</span><span class="w"> </span><span class="nv">i</span><span class="p">)</span>
<span class="w">    </span><span class="nf">|&gt;</span><span class="w"> </span><span class="nv">skip</span><span class="w"> </span><span class="p">(</span><span class="nv">string</span><span class="w"> </span><span class="s">"seeds: "</span><span class="p">)</span>
<span class="w">    </span><span class="nf">|&gt;</span><span class="w"> </span><span class="nv">keep</span><span class="w"> </span><span class="nv">seedPair</span>
<span class="w">    </span><span class="nf">|&gt;</span><span class="w"> </span><span class="nv">skip</span><span class="w"> </span><span class="nv">anyCodeunit</span>


<span class="nv">seedParserMapper</span><span class="w"> </span><span class="nf">:</span><span class="w"> </span><span class="kt">List</span><span class="w"> </span><span class="kt">Nat</span><span class="w"> </span><span class="nf">-&gt;</span><span class="w"> </span><span class="kt">List</span><span class="w"> </span><span class="kt">U64</span>
<span class="nv">seedParserMapper</span><span class="w"> </span><span class="nf">=</span><span class="w"> </span><span class="nf">\</span><span class="nv">i</span><span class="w"> </span><span class="nf">-&gt;</span><span class="w"> </span><span class="kt">List</span><span class="nf">.</span><span class="nv">map</span><span class="w"> </span><span class="nv">i</span><span class="w"> </span><span class="kt">Num</span><span class="nf">.</span><span class="nv">toU64</span>

<span class="nv">seedParser</span><span class="w"> </span><span class="nf">:</span><span class="w"> </span><span class="kt">Parser</span><span class="w"> </span><span class="p">(</span><span class="kt">List</span><span class="w"> </span><span class="kt">U8</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="kt">List</span><span class="w"> </span><span class="kt">U64</span><span class="p">)</span>
<span class="nv">seedParser</span><span class="w"> </span><span class="nf">=</span>
<span class="w">  </span><span class="nv">const</span><span class="w"> </span><span class="p">(</span><span class="nv">seedParserMapper</span><span class="p">)</span>
<span class="w">  </span><span class="nf">|&gt;</span><span class="w"> </span><span class="nv">skip</span><span class="w"> </span><span class="p">(</span><span class="nv">string</span><span class="w"> </span><span class="s">"seeds: "</span><span class="p">)</span>
<span class="w">  </span><span class="nf">|&gt;</span><span class="w"> </span><span class="nv">keep</span><span class="w"> </span><span class="p">(</span><span class="nv">digits</span><span class="w"> </span><span class="nf">|&gt;</span><span class="w"> </span><span class="nv">sepBy</span><span class="w"> </span><span class="p">(</span><span class="nv">string</span><span class="w"> </span><span class="s">" "</span><span class="p">))</span>
<span class="w">  </span><span class="nf">|&gt;</span><span class="w"> </span><span class="nv">skip</span><span class="w"> </span><span class="nv">anyCodeunit</span>

<span class="nv">parseSeeds</span><span class="w"> </span><span class="nf">:</span><span class="w"> </span><span class="kt">Str</span><span class="w"> </span><span class="nf">-&gt;</span><span class="w"> </span><span class="kt">ParsedAlmanac</span>
<span class="nv">parseSeeds</span><span class="w"> </span><span class="nf">=</span><span class="w"> </span><span class="nf">\</span><span class="nv">almanac</span><span class="w"> </span><span class="nf">-&gt;</span>
<span class="w">    </span><span class="nv">seeds</span><span class="w"> </span><span class="nf">=</span><span class="w"> </span><span class="nv">parseStrPartial</span><span class="w"> </span><span class="nv">seedParser</span><span class="w"> </span><span class="nv">almanac</span>

<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="nv">almanac</span><span class="nf">:</span><span class="w"> </span><span class="nv">almanac</span><span class="p">,</span>
<span class="w">        </span><span class="nv">list</span><span class="nf">:</span>
<span class="w">            </span><span class="nv">when</span><span class="w"> </span><span class="nv">seeds</span><span class="w"> </span><span class="nv">is</span>
<span class="w">                </span><span class="kt">Ok</span><span class="w"> </span><span class="nv">r</span><span class="w"> </span><span class="nf">-&gt;</span><span class="w"> </span><span class="nv">r</span><span class="nf">.</span><span class="nv">val</span>
<span class="w">                </span><span class="kt">Err</span><span class="w"> </span><span class="nv">_</span><span class="w"> </span><span class="nf">-&gt;</span><span class="w"> </span><span class="p">[]</span>
<span class="w">    </span><span class="p">}</span>

<span class="nv">parseMap</span><span class="w"> </span><span class="nf">=</span><span class="w"> </span><span class="nf">\</span><span class="nv">almanac</span><span class="p">,</span><span class="w"> </span><span class="nv">section</span><span class="w"> </span><span class="nf">-&gt;</span>
<span class="w">    </span><span class="nv">mapValues</span><span class="w"> </span><span class="nf">=</span>
<span class="w">        </span><span class="kt">Str</span><span class="nf">.</span><span class="nv">split</span><span class="w"> </span><span class="nv">almanac</span><span class="w"> </span><span class="p">(</span><span class="kt">Str</span><span class="nf">.</span><span class="nv">concat</span><span class="w"> </span><span class="nv">section</span><span class="w"> </span><span class="s">" map:</span><span class="se">\n</span><span class="s">"</span><span class="p">)</span>
<span class="w">        </span><span class="nf">|&gt;</span><span class="w"> </span><span class="kt">List</span><span class="nf">.</span><span class="nv">get</span><span class="w"> </span><span class="mi">1</span>
<span class="w">        </span><span class="nf">|&gt;</span><span class="w"> </span><span class="kt">Result</span><span class="nf">.</span><span class="nv">withDefault</span><span class="w"> </span><span class="s">""</span>
<span class="w">        </span><span class="nf">|&gt;</span><span class="w"> </span><span class="kt">Str</span><span class="nf">.</span><span class="nv">split</span><span class="w"> </span><span class="s">"</span><span class="se">\n\n</span><span class="s">"</span>
<span class="w">        </span><span class="nf">|&gt;</span><span class="w"> </span><span class="kt">List</span><span class="nf">.</span><span class="nv">get</span><span class="w"> </span><span class="mi">0</span>
<span class="w">        </span><span class="nf">|&gt;</span><span class="w"> </span><span class="kt">Result</span><span class="nf">.</span><span class="nv">withDefault</span><span class="w"> </span><span class="s">""</span>

<span class="w">    </span><span class="kt">Str</span><span class="nf">.</span><span class="nv">split</span><span class="w"> </span><span class="nv">mapValues</span><span class="w"> </span><span class="s">"</span><span class="se">\n</span><span class="s">"</span>
<span class="w">    </span><span class="nf">|&gt;</span><span class="w"> </span><span class="kt">List</span><span class="nf">.</span><span class="nv">map</span><span class="w"> </span><span class="nf">\</span><span class="nv">lines</span><span class="w"> </span><span class="nf">-&gt;</span><span class="w"> </span><span class="kt">Str</span><span class="nf">.</span><span class="nv">split</span><span class="w"> </span><span class="nv">lines</span><span class="w"> </span><span class="s">" "</span>
<span class="w">    </span><span class="nf">|&gt;</span><span class="w"> </span><span class="kt">List</span><span class="nf">.</span><span class="nv">map</span><span class="w"> </span><span class="nf">\</span><span class="nv">lines</span><span class="w"> </span><span class="nf">-&gt;</span><span class="w"> </span><span class="kt">List</span><span class="nf">.</span><span class="nv">map</span><span class="w"> </span><span class="nv">lines</span><span class="w"> </span><span class="nf">\</span><span class="nv">line</span><span class="w"> </span><span class="nf">-&gt;</span><span class="w"> </span><span class="p">(</span><span class="kt">Str</span><span class="nf">.</span><span class="nv">toU64</span><span class="w"> </span><span class="nv">line</span><span class="w"> </span><span class="nf">|&gt;</span><span class="w"> </span><span class="kt">Result</span><span class="nf">.</span><span class="nv">withDefault</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
<span class="w">    </span><span class="nf">|&gt;</span><span class="w"> </span><span class="kt">List</span><span class="nf">.</span><span class="nv">map</span><span class="w"> </span><span class="nf">\</span><span class="nv">lines</span><span class="w"> </span><span class="nf">-&gt;</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="nv">destination</span><span class="nf">:</span><span class="w"> </span><span class="kt">List</span><span class="nf">.</span><span class="nv">get</span><span class="w"> </span><span class="nv">lines</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="nf">|&gt;</span><span class="w"> </span><span class="kt">Result</span><span class="nf">.</span><span class="nv">withDefault</span><span class="w"> </span><span class="p">(</span><span class="kt">Num</span><span class="nf">.</span><span class="nv">toU64</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">,</span>
<span class="w">            </span><span class="nv">source</span><span class="nf">:</span><span class="w"> </span><span class="kt">List</span><span class="nf">.</span><span class="nv">get</span><span class="w"> </span><span class="nv">lines</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="nf">|&gt;</span><span class="w"> </span><span class="kt">Result</span><span class="nf">.</span><span class="nv">withDefault</span><span class="w"> </span><span class="p">(</span><span class="kt">Num</span><span class="nf">.</span><span class="nv">toU64</span><span class="w"> </span><span class="mi">0</span><span class="p">),</span>
<span class="w">            </span><span class="nv">range</span><span class="nf">:</span><span class="w"> </span><span class="kt">List</span><span class="nf">.</span><span class="nv">get</span><span class="w"> </span><span class="nv">lines</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="nf">|&gt;</span><span class="w"> </span><span class="kt">Result</span><span class="nf">.</span><span class="nv">withDefault</span><span class="w"> </span><span class="p">(</span><span class="kt">Num</span><span class="nf">.</span><span class="nv">toU64</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
<span class="w">        </span><span class="p">}</span>


<span class="nv">almanacMapSingle</span><span class="w"> </span><span class="nf">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nv">source</span><span class="nf">:</span><span class="w"> </span><span class="kt">U64</span><span class="p">,</span><span class="w"> </span><span class="nv">almanac</span><span class="nf">:</span><span class="w"> </span><span class="kt">Str</span><span class="w"> </span><span class="p">},</span><span class="w"> </span><span class="kt">Str</span><span class="w"> </span><span class="nf">-&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nv">source</span><span class="nf">:</span><span class="w"> </span><span class="kt">U64</span><span class="p">,</span><span class="w"> </span><span class="nv">almanac</span><span class="nf">:</span><span class="w"> </span><span class="kt">Str</span><span class="w"> </span><span class="p">}</span>
<span class="nv">almanacMapSingle</span><span class="w"> </span><span class="nf">=</span><span class="w"> </span><span class="nf">\</span><span class="nv">data</span><span class="p">,</span><span class="w"> </span><span class="nv">section</span><span class="w"> </span><span class="nf">-&gt;</span>
<span class="w">    </span><span class="nv">mapper</span><span class="w"> </span><span class="nf">=</span><span class="w"> </span><span class="nv">parseMap</span><span class="w"> </span><span class="nv">data</span><span class="nf">.</span><span class="nv">almanac</span><span class="w"> </span><span class="nv">section</span>

<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="nv">almanac</span><span class="nf">:</span><span class="w"> </span><span class="nv">data</span><span class="nf">.</span><span class="nv">almanac</span><span class="p">,</span>
<span class="w">        </span><span class="nv">source</span><span class="nf">:</span><span class="w"> </span><span class="nv">mapLocation</span><span class="w"> </span><span class="nv">data</span><span class="nf">.</span><span class="nv">source</span><span class="w"> </span><span class="nv">mapper</span>
<span class="w">    </span><span class="p">}</span>

<span class="nv">almanacMap</span><span class="w"> </span><span class="nf">:</span><span class="w"> </span><span class="kt">ParsedAlmanac</span><span class="p">,</span><span class="w"> </span><span class="kt">Str</span><span class="w"> </span><span class="nf">-&gt;</span><span class="w"> </span><span class="kt">ParsedAlmanac</span>
<span class="nv">almanacMap</span><span class="w"> </span><span class="nf">=</span><span class="w"> </span><span class="nf">\</span><span class="nv">parsedAlmanac</span><span class="p">,</span><span class="w"> </span><span class="nv">section</span><span class="w"> </span><span class="nf">-&gt;</span>
<span class="w">    </span><span class="nv">mapper</span><span class="w"> </span><span class="nf">=</span><span class="w"> </span><span class="nv">parseMap</span><span class="w"> </span><span class="nv">parsedAlmanac</span><span class="nf">.</span><span class="nv">almanac</span><span class="w"> </span><span class="nv">section</span>
<span class="w">    </span><span class="nv">list</span><span class="w"> </span><span class="nf">=</span><span class="w"> </span><span class="kt">List</span><span class="nf">.</span><span class="nv">map</span><span class="w"> </span><span class="nv">parsedAlmanac</span><span class="nf">.</span><span class="nv">list</span><span class="w"> </span><span class="nf">\</span><span class="nv">source</span><span class="w"> </span><span class="nf">-&gt;</span><span class="w"> </span><span class="p">(</span><span class="nv">mapLocation</span><span class="w"> </span><span class="nv">source</span><span class="w"> </span><span class="nv">mapper</span><span class="p">)</span>

<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="nv">almanac</span><span class="nf">:</span><span class="w"> </span><span class="nv">parsedAlmanac</span><span class="nf">.</span><span class="nv">almanac</span><span class="p">,</span>
<span class="w">        </span><span class="nv">list</span><span class="nf">:</span><span class="w"> </span><span class="nv">list</span>
<span class="w">    </span><span class="p">}</span>

<span class="nv">mapLocation</span><span class="w"> </span><span class="nf">:</span><span class="w"> </span><span class="kt">U64</span><span class="p">,</span><span class="w"> </span><span class="kt">List</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nv">destination</span><span class="nf">:</span><span class="w"> </span><span class="kt">U64</span><span class="p">,</span><span class="w"> </span><span class="nv">source</span><span class="nf">:</span><span class="w"> </span><span class="kt">U64</span><span class="p">,</span><span class="w"> </span><span class="nv">range</span><span class="nf">:</span><span class="w"> </span><span class="kt">U64</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="nf">-&gt;</span><span class="w"> </span><span class="kt">U64</span>
<span class="nv">mapLocation</span><span class="w"> </span><span class="nf">=</span><span class="w"> </span><span class="nf">\</span><span class="nv">source</span><span class="p">,</span><span class="w"> </span><span class="nv">mapper</span><span class="w"> </span><span class="nf">-&gt;</span>
<span class="w">    </span><span class="nv">location</span><span class="w"> </span><span class="nf">=</span>
<span class="w">        </span><span class="kt">List</span><span class="nf">.</span><span class="nv">keepIf</span><span class="w"> </span><span class="nv">mapper</span><span class="w"> </span><span class="nf">\</span><span class="nv">m</span><span class="w"> </span><span class="nf">-&gt;</span><span class="w"> </span><span class="p">(</span><span class="nv">m</span><span class="nf">.</span><span class="nv">source</span><span class="w"> </span><span class="nf">+</span><span class="w"> </span><span class="nv">m</span><span class="nf">.</span><span class="nv">range</span><span class="w"> </span><span class="nf">-</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="nf">&gt;=</span><span class="w"> </span><span class="nv">source</span><span class="w"> </span><span class="nf">&amp;&amp;</span><span class="w"> </span><span class="nv">source</span><span class="w"> </span><span class="nf">&gt;=</span><span class="w"> </span><span class="nv">m</span><span class="nf">.</span><span class="nv">source</span>
<span class="w">        </span><span class="nf">|&gt;</span><span class="w"> </span><span class="kt">List</span><span class="nf">.</span><span class="nv">get</span><span class="w"> </span><span class="mi">0</span>
<span class="w">        </span><span class="nf">|&gt;</span><span class="w"> </span><span class="kt">Result</span><span class="nf">.</span><span class="nv">withDefault</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nv">destination</span><span class="nf">:</span><span class="w"> </span><span class="nv">source</span><span class="p">,</span><span class="w"> </span><span class="nv">source</span><span class="nf">:</span><span class="w"> </span><span class="nv">source</span><span class="p">,</span><span class="w"> </span><span class="nv">range</span><span class="nf">:</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">}</span>

<span class="w">    </span><span class="nv">location</span><span class="nf">.</span><span class="nv">destination</span><span class="w"> </span><span class="nf">+</span><span class="w"> </span><span class="p">(</span><span class="nv">source</span><span class="w"> </span><span class="nf">-</span><span class="w"> </span><span class="nv">location</span><span class="nf">.</span><span class="nv">source</span><span class="p">)</span>

<span class="nv">exampleInput</span><span class="w"> </span><span class="nf">=</span>
<span class="w">    </span><span class="s">"""</span>
<span class="s">    seeds: 79 14 55 13</span>

<span class="s">    seed-to-soil map:</span>
<span class="s">    50 98 2</span>
<span class="s">    52 50 48</span>

<span class="s">    soil-to-fertilizer map:</span>
<span class="s">    0 15 37</span>
<span class="s">    37 52 2</span>
<span class="s">    39 0 15</span>

<span class="s">    fertilizer-to-water map:</span>
<span class="s">    49 53 8</span>
<span class="s">    0 11 42</span>
<span class="s">    42 0 7</span>
<span class="s">    57 7 4</span>

<span class="s">    water-to-light map:</span>
<span class="s">    88 18 7</span>
<span class="s">    18 25 70</span>

<span class="s">    light-to-temperature map:</span>
<span class="s">    45 77 23</span>
<span class="s">    81 45 19</span>
<span class="s">    68 64 13</span>

<span class="s">    temperature-to-humidity map:</span>
<span class="s">    0 69 1</span>
<span class="s">    1 0 69</span>

<span class="s">    humidity-to-location map:</span>
<span class="s">    60 56 37</span>
<span class="s">    56 93 4</span>
<span class="s">    """</span>
<span class="w">    </span><span class="nf">|&gt;</span><span class="w"> </span><span class="kt">Str</span><span class="nf">.</span><span class="nv">trim</span>

<span class="nv">debug</span><span class="w"> </span><span class="nf">=</span><span class="w"> </span><span class="nf">\</span><span class="nv">v</span><span class="p">,</span><span class="w"> </span><span class="nv">ctx</span><span class="w"> </span><span class="nf">-&gt;</span>
<span class="w">    </span><span class="nv">dbg</span>
<span class="w">        </span><span class="nv">ctx</span>

<span class="w">    </span><span class="nv">dbg</span>
<span class="w">        </span><span class="nv">v</span>

<span class="w">    </span><span class="nv">v</span>
</code></pre></div>
</div></div>



<a name="406220247"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/358903-advent%20of%20code/topic/2023%20Day%205/near/406220247" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ayaz Hafiz <a href="https://roc-lang.github.io/zulip-export/stream/358903-advent-of-code/topic/2023.20Day.205.html#406220247">(Dec 06 2023 at 04:11)</a>:</h4>
<p>Also brute forced this one because efficiency is boring <a href="https://gist.github.com/ayazhafiz/9adbb083f965bcad18c2b5754b00b51b">https://gist.github.com/ayazhafiz/9adbb083f965bcad18c2b5754b00b51b</a></p>



<a name="406248881"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/358903-advent%20of%20code/topic/2023%20Day%205/near/406248881" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ryan Bates <a href="https://roc-lang.github.io/zulip-export/stream/358903-advent-of-code/topic/2023.20Day.205.html#406248881">(Dec 06 2023 at 07:41)</a>:</h4>
<p>Here's my solution for both parts.<br>
<a href="https://github.com/ryanb/advent-2023-roc/blob/main/day05/main.roc">https://github.com/ryanb/advent-2023-roc/blob/main/day05/main.roc</a></p>
<div class="spoiler-block"><div class="spoiler-header">
<p>Part 2 Spoiler</p>
</div><div class="spoiler-content" aria-hidden="true">
<p>Keeping the values in ranges is key for performance on Part 2. It was just a bit tricky to split the ranges when they partially overlapped.</p>
<p>Despite the challenges of these, I'm enjoying Roc!</p>
</div></div>



<a name="406392807"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/358903-advent%20of%20code/topic/2023%20Day%205/near/406392807" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> LoipesMas <a href="https://roc-lang.github.io/zulip-export/stream/358903-advent-of-code/topic/2023.20Day.205.html#406392807">(Dec 06 2023 at 21:35)</a>:</h4>
<p>My solution: <a href="https://github.com/LoipesMas/roc-aoc2023/blob/main/5/main.roc">https://github.com/LoipesMas/roc-aoc2023/blob/main/5/main.roc</a><br>
For part 2, after the obvious attempt was obviously too slow, I had a <del>stupid</del> <em>unique</em> idea to flip the problem backwards: instead of going from seed to location, I went with locations going from 0, converting them to seeds and checking if the seed is in provided range. It's O(n) where n is your result ;] <br>
With <code>--optimized</code> it's not even that bad! Only ~12 seconds to find location <code>15_880_236</code>. Around a minute for an unoptimized build</p>



<a name="406969761"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/358903-advent%20of%20code/topic/2023%20Day%205/near/406969761" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> timotree <a href="https://roc-lang.github.io/zulip-export/stream/358903-advent-of-code/topic/2023.20Day.205.html#406969761">(Dec 09 2023 at 20:44)</a>:</h4>
<p>My solution: <a href="https://github.com/timotree3/aoc2023/blob/main/roc/day5.roc">https://github.com/timotree3/aoc2023/blob/main/roc/day5.roc</a><br>
Takes less than a few ms on my machine.</p>
<div class="spoiler-block"><div class="spoiler-header">
<p>Approach</p>
</div><div class="spoiler-content" aria-hidden="true">
<p>I propagated lists of ranges across the maps, splitting the ranges into multiple when partially mapped. Also, in order to apply the maps more efficiently, I sorted them and used binary search to find the relevant ranges.</p>
</div></div>



<a name="421504613"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/358903-advent%20of%20code/topic/2023%20Day%205/near/421504613" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jonas Schell <a href="https://roc-lang.github.io/zulip-export/stream/358903-advent-of-code/topic/2023.20Day.205.html#421504613">(Feb 14 2024 at 18:15)</a>:</h4>
<p>My solutions for day 5: <a href="https://github.com/Ocupe/advent-of-code-2023/tree/main/day_05">https://github.com/Ocupe/advent-of-code-2023/tree/main/day_05</a></p>
<p>My solution for part 2 took around 13 hours to finish <span aria-label="snail" class="emoji emoji-1f40c" role="img" title="snail">:snail:</span><br>
How do they say: Make it work, then make it fast. I guess I'm okay with just getting the first thing done - especially after I already got the second star :P</p>



<hr><p>Last updated: Nov 01 2025 at 12:13 UTC</p>
</html>