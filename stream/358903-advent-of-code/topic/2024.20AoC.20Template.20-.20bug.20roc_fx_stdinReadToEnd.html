<html>
<head><meta charset="utf-8"><title>2024 AoC Template - bug roc_fx_stdinReadToEnd · advent of code · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://roc-lang.github.io/zulip-export/stream/358903-advent-of-code/index.html">advent of code</a></h2>
<h3>Topic: <a href="https://roc-lang.github.io/zulip-export/stream/358903-advent-of-code/topic/2024.20AoC.20Template.20-.20bug.20roc_fx_stdinReadToEnd.html">2024 AoC Template - bug roc_fx_stdinReadToEnd</a></h3>

<hr>

<base href="https://roc.zulipchat.com">

<head><link href="https://roc-lang.github.io/zulip-export/style.css" rel="stylesheet"></head>

<a name="482896247"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/358903-advent%20of%20code/topic/2024%20AoC%20Template%20-%20bug%20roc_fx_stdinReadToEnd/near/482896247" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Scally <a href="https://roc-lang.github.io/zulip-export/stream/358903-advent-of-code/topic/2024.20AoC.20Template.20-.20bug.20roc_fx_stdinReadToEnd.html#482896247">(Nov 17 2024 at 21:04)</a>:</h4>
<p>FYI I tried it today pretty much with the code you've provided and some simple returns in part1 and part2 and it crashed with </p>
<div class="codehilite"><pre><span></span><code>thread &#39;&lt;unnamed&gt;&#39; panicked at crates/compiler/mono/src/ir.rs:6162:56:
called `Option::unwrap()` on a `None` value
stack backtrace:
   0:     0x619d6db6a8ab - &lt;unknown&gt;
   1:     0x619d6ce2c1e0 - &lt;unknown&gt;
   2:     0x619d6db66113 - &lt;unknown&gt;
   3:     0x619d6db6a644 - &lt;unknown&gt;
   4:     0x619d6db6c1a0 - &lt;unknown&gt;
   5:     0x619d6db6bebf - &lt;unknown&gt;
   6:     0x619d6db6c6be - &lt;unknown&gt;
   7:     0x619d6db6c589 - &lt;unknown&gt;
   8:     0x619d6db6ada6 - &lt;unknown&gt;
   9:     0x619d6db6c324 - &lt;unknown&gt;
  10:     0x619d6cd21e75 - &lt;unknown&gt;
  11:     0x619d6cd21f33 - &lt;unknown&gt;
  12:     0x619d6cd21dc6 - &lt;unknown&gt;
  13:     0x619d6d699d75 - &lt;unknown&gt;
  14:     0x619d6d68ce14 - &lt;unknown&gt;
  15:     0x619d6d67b442 - &lt;unknown&gt;
  16:     0x619d6d6a8339 - &lt;unknown&gt;
  17:     0x619d6d68a44e - &lt;unknown&gt;
  18:     0x619d6d6b8330 - &lt;unknown&gt;
  19:     0x619d6d68f6cf - &lt;unknown&gt;
  20:     0x619d6d6b5ac2 - &lt;unknown&gt;
  21:     0x619d6d6b6306 - &lt;unknown&gt;
  22:     0x619d6d6b94f7 - &lt;unknown&gt;
  23:     0x619d6d6b8661 - &lt;unknown&gt;
  24:     0x619d6d68f6cf - &lt;unknown&gt;
  25:     0x619d6d6a85de - &lt;unknown&gt;
  26:     0x619d6d68a44e - &lt;unknown&gt;
  27:     0x619d6d6832fa - &lt;unknown&gt;
  28:     0x619d6d6809b7 - &lt;unknown&gt;
  29:     0x619d6d585444 - &lt;unknown&gt;
  30:     0x619d6d50e2c6 - &lt;unknown&gt;
  31:     0x619d6d503c0e - &lt;unknown&gt;
  32:     0x619d6d50f535 - &lt;unknown&gt;
  33:     0x619d6db71f05 - &lt;unknown&gt;
  34:     0x782ff1ea339d - &lt;unknown&gt;
  35:     0x782ff1f2849c - &lt;unknown&gt;
  36:                0x0 - &lt;unknown&gt;
</code></pre></div>
<p>When not calling <code>AoC.solve</code> it works just fine</p>



<a name="482908624"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/358903-advent%20of%20code/topic/2024%20AoC%20Template%20-%20bug%20roc_fx_stdinReadToEnd/near/482908624" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/358903-advent-of-code/topic/2024.20AoC.20Template.20-.20bug.20roc_fx_stdinReadToEnd.html#482908624">(Nov 18 2024 at 00:18)</a>:</h4>
<p>Can you share the code you used? I'd like to repro if I can</p>



<a name="482908649"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/358903-advent%20of%20code/topic/2024%20AoC%20Template%20-%20bug%20roc_fx_stdinReadToEnd/near/482908649" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/358903-advent-of-code/topic/2024.20AoC.20Template.20-.20bug.20roc_fx_stdinReadToEnd.html#482908649">(Nov 18 2024 at 00:19)</a>:</h4>
<p>It'd be nice to give a better error message than a rust panic</p>



<a name="482909282"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/358903-advent%20of%20code/topic/2024%20AoC%20Template%20-%20bug%20roc_fx_stdinReadToEnd/near/482909282" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Scally <a href="https://roc-lang.github.io/zulip-export/stream/358903-advent-of-code/topic/2024.20AoC.20Template.20-.20bug.20roc_fx_stdinReadToEnd.html#482909282">(Nov 18 2024 at 00:28)</a>:</h4>
<p>Running the exact code you've sent results in </p>
<div class="codehilite"><pre><span></span><code>An internal compiler expectation was broken.
This is definitely a compiler bug.
Please file an issue here: &lt;https://github.com/roc-lang/roc/issues/new/choose&gt;
Undefined Symbol in relocation, (+e2a2, Relocation { kind: PltRelative, encoding: Generic, size: +20, target: Symbol(SymbolIndex(+e5)), addend: +fffffffffffffffc, implicit_addend: false }): Ok(Symbol { name: &quot;roc_fx_stdinReadToEnd&quot;, address: +0, size: +0, kind: Unknown, section: Undefined, scope: Unknown, weak: false, flags: Elf { st_info: +10, st_other: +0 } })
Location: crates/linker/src/elf.rs:1452:25
</code></pre></div>
<p>Changing the bottom lines to</p>
<div class="codehilite"><pre><span></span><code>part1 : Str -&gt; Result Str _
part1 = \_ -&gt; Ok &quot;Foo&quot;

part2 : Str -&gt; Result Str _
part2 = \_ -&gt; Ok &quot;Bar&quot;
</code></pre></div>
<p>Results in the error provided above.</p>
<p>I didn't share code because it's pretty much exactly the code you've sent <span aria-label="sweat smile" class="emoji emoji-1f605" role="img" title="sweat smile">:sweat_smile:</span></p>



<a name="482909313"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/358903-advent%20of%20code/topic/2024%20AoC%20Template%20-%20bug%20roc_fx_stdinReadToEnd/near/482909313" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/358903-advent-of-code/topic/2024.20AoC.20Template.20-.20bug.20roc_fx_stdinReadToEnd.html#482909313">(Nov 18 2024 at 00:29)</a>:</h4>
<p>Ok, this looks like an issue with the new <code>roc_fx_stdinReadToEnd</code> I just added.</p>



<a name="482909406"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/358903-advent%20of%20code/topic/2024%20AoC%20Template%20-%20bug%20roc_fx_stdinReadToEnd/near/482909406" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/358903-advent-of-code/topic/2024.20AoC.20Template.20-.20bug.20roc_fx_stdinReadToEnd.html#482909406">(Nov 18 2024 at 00:30)</a>:</h4>
<p>I think I know what it is...</p>



<a name="482909527"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/358903-advent%20of%20code/topic/2024%20AoC%20Template%20-%20bug%20roc_fx_stdinReadToEnd/near/482909527" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/358903-advent-of-code/topic/2024.20AoC.20Template.20-.20bug.20roc_fx_stdinReadToEnd.html#482909527">(Nov 18 2024 at 00:32)</a>:</h4>
<p>I didn't add <code>roc_fx_stdinReadToEnd</code> to our <code>pub fn init() {</code> thing which protects the vicious rust GC from removing what it thinks is dead code. That must only be relevant for Linux, and doesn't materialise as an issue on Macos. I didn't add an integration test for it, so we didn't pick it up in CI <span aria-label="man facepalming" class="emoji emoji-1f926-200d-2642" role="img" title="man facepalming">:man_facepalming:</span>.</p>



<a name="482909561"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/358903-advent%20of%20code/topic/2024%20AoC%20Template%20-%20bug%20roc_fx_stdinReadToEnd/near/482909561" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/358903-advent-of-code/topic/2024.20AoC.20Template.20-.20bug.20roc_fx_stdinReadToEnd.html#482909561">(Nov 18 2024 at 00:33)</a>:</h4>
<p>Would you be interested in trying a fix for me? if you add <code>roc_fx_stdinReadToEnd</code> and then build basic-cli locally, does it still give you this error?</p>



<a name="482909571"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/358903-advent%20of%20code/topic/2024%20AoC%20Template%20-%20bug%20roc_fx_stdinReadToEnd/near/482909571" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Scally <a href="https://roc-lang.github.io/zulip-export/stream/358903-advent-of-code/topic/2024.20AoC.20Template.20-.20bug.20roc_fx_stdinReadToEnd.html#482909571">(Nov 18 2024 at 00:33)</a>:</h4>
<p><span aria-label="salute" class="emoji emoji-1fae1" role="img" title="salute">:salute:</span> <span aria-label="sweat smile" class="emoji emoji-1f605" role="img" title="sweat smile">:sweat_smile:</span> always happy to dig up bugs <span aria-label="laughter tears" class="emoji emoji-1f602" role="img" title="laughter tears">:laughter_tears:</span></p>



<a name="482909588"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/358903-advent%20of%20code/topic/2024%20AoC%20Template%20-%20bug%20roc_fx_stdinReadToEnd/near/482909588" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/358903-advent-of-code/topic/2024.20AoC.20Template.20-.20bug.20roc_fx_stdinReadToEnd.html#482909588">(Nov 18 2024 at 00:33)</a>:</h4>
<p>You can build basic-cli using <code>roc build.roc</code>... but then you will need to use a relative path to <code>platform/main.roc</code> instead of a URL for the platform.</p>



<a name="482909800"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/358903-advent%20of%20code/topic/2024%20AoC%20Template%20-%20bug%20roc_fx_stdinReadToEnd/near/482909800" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Notification Bot <a href="https://roc-lang.github.io/zulip-export/stream/358903-advent-of-code/topic/2024.20AoC.20Template.20-.20bug.20roc_fx_stdinReadToEnd.html#482909800">(Nov 18 2024 at 00:37)</a>:</h4>
<p>10 messages were moved here from <a class="stream-topic" data-stream-id="358903" href="/#narrow/channel/358903-advent-of-code/topic/2024.20AoC.20Template">#advent of code &gt; 2024 AoC Template</a> by <span class="user-mention silent" data-user-id="515757">Luke Boswell</span>.</p>



<a name="482910720"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/358903-advent%20of%20code/topic/2024%20AoC%20Template%20-%20bug%20roc_fx_stdinReadToEnd/near/482910720" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Scally <a href="https://roc-lang.github.io/zulip-export/stream/358903-advent-of-code/topic/2024.20AoC.20Template.20-.20bug.20roc_fx_stdinReadToEnd.html#482910720">(Nov 18 2024 at 00:51)</a>:</h4>
<p>I'll try in a bit or tomorrow</p>



<a name="483300824"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/358903-advent%20of%20code/topic/2024%20AoC%20Template%20-%20bug%20roc_fx_stdinReadToEnd/near/483300824" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anton <a href="https://roc-lang.github.io/zulip-export/stream/358903-advent-of-code/topic/2024.20AoC.20Template.20-.20bug.20roc_fx_stdinReadToEnd.html#483300824">(Nov 19 2024 at 16:14)</a>:</h4>
<p>I plan to do a new basic-cli release this week, so I've gone ahead and put up a fix in <a href="https://github.com/roc-lang/basic-cli/pull/268">https://github.com/roc-lang/basic-cli/pull/268</a>,</p>



<hr><p>Last updated: Nov 01 2025 at 12:13 UTC</p>
</html>