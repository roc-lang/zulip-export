<html>
<head><meta charset="utf-8"><title>wasm without a host · show and tell · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://roc-lang.github.io/zulip-export/stream/304902-show-and-tell/index.html">show and tell</a></h2>
<h3>Topic: <a href="https://roc-lang.github.io/zulip-export/stream/304902-show-and-tell/topic/wasm.20without.20a.20host.html">wasm without a host</a></h3>

<hr>

<base href="https://roc.zulipchat.com">

<head><link href="https://roc-lang.github.io/zulip-export/style.css" rel="stylesheet"></head>

<a name="355294010"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/304902-show%20and%20tell/topic/wasm%20without%20a%20host/near/355294010" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/304902-show-and-tell/topic/wasm.20without.20a.20host.html#355294010">(May 03 2023 at 01:12)</a>:</h4>
<p>I implemented a wasm example (running on Node.js, but could just as easily be in the browser) that doesn't have a host! <a href="https://github.com/roc-lang/roc/blob/4cb02f1d04e5f458389e44a78c542e497f589266/examples/nodejs-interop/wasm/hello.js#L59">https://github.com/roc-lang/roc/blob/4cb02f1d04e5f458389e44a78c542e497f589266/examples/nodejs-interop/wasm/hello.js#L59</a></p>



<a name="355294029"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/304902-show%20and%20tell/topic/wasm%20without%20a%20host/near/355294029" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/304902-show-and-tell/topic/wasm.20without.20a.20host.html#355294029">(May 03 2023 at 01:13)</a>:</h4>
<p>so there's no dependency on Zig or clang or Rust or anything - all you need to build and run the example is <code>roc</code> and <code>node</code></p>



<a name="355294041"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/304902-show%20and%20tell/topic/wasm%20without%20a%20host/near/355294041" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/304902-show-and-tell/topic/wasm.20without.20a.20host.html#355294041">(May 03 2023 at 01:13)</a>:</h4>
<p>(or <code>roc</code> and a browser)</p>



<a name="355294117"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/304902-show%20and%20tell/topic/wasm%20without%20a%20host/near/355294117" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/304902-show-and-tell/topic/wasm.20without.20a.20host.html#355294117">(May 03 2023 at 01:14)</a>:</h4>
<p>it works by implementing <code>roc_alloc</code> and such directly in JS, working with the WebAssembly's raw byte array representation of memory using JS commands instead of C commands</p>



<a name="355294169"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/304902-show%20and%20tell/topic/wasm%20without%20a%20host/near/355294169" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/304902-show-and-tell/topic/wasm.20without.20a.20host.html#355294169">(May 03 2023 at 01:14)</a>:</h4>
<p>(thanks to <span class="user-mention" data-user-id="431893">@Brian Carroll</span> for explaining to me how all that works in wasm!)</p>



<a name="355294247"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/304902-show%20and%20tell/topic/wasm%20without%20a%20host/near/355294247" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/304902-show-and-tell/topic/wasm.20without.20a.20host.html#355294247">(May 03 2023 at 01:15)</a>:</h4>
<p>Awesome!!!</p>



<a name="355294288"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/304902-show%20and%20tell/topic/wasm%20without%20a%20host/near/355294288" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/304902-show-and-tell/topic/wasm.20without.20a.20host.html#355294288">(May 03 2023 at 01:15)</a>:</h4>
<p>That is actually really exciting. Gets rid of a whole layer of wrapping and dependencies.</p>



<a name="355294421"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/304902-show%20and%20tell/topic/wasm%20without%20a%20host/near/355294421" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/304902-show-and-tell/topic/wasm.20without.20a.20host.html#355294421">(May 03 2023 at 01:17)</a>:</h4>
<p>yeah! I'm not sure what the runtime performance implications are; presumably writing JS code instead of wasm code is slower in the general case, but in this case is it noticeable? I very much doubt it, but I don't really know <span aria-label="big smile" class="emoji emoji-1f604" role="img" title="big smile">:big_smile:</span></p>



<a name="355295225"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/304902-show%20and%20tell/topic/wasm%20without%20a%20host/near/355295225" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/304902-show-and-tell/topic/wasm.20without.20a.20host.html#355295225">(May 03 2023 at 01:24)</a>:</h4>
<p>I guess it depends how much you delegate to roc vs run in js. Given most stuff we are talking about here is just thin wrapper, I don't think it should make a tangible difference, but I haven't dug into anything here.</p>



<a name="355295242"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/304902-show%20and%20tell/topic/wasm%20without%20a%20host/near/355295242" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/304902-show-and-tell/topic/wasm.20without.20a.20host.html#355295242">(May 03 2023 at 01:24)</a>:</h4>
<p>I could try porting my old wasm cpu example to this to see the perf diff.</p>



<a name="355295497"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/304902-show%20and%20tell/topic/wasm%20without%20a%20host/near/355295497" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Agus Zubiaga <a href="https://roc-lang.github.io/zulip-export/stream/304902-show-and-tell/topic/wasm.20without.20a.20host.html#355295497">(May 03 2023 at 01:28)</a>:</h4>
<p>These thin functions around <code>Uint8Array</code> / <code>DataView</code> probably optimize well</p>



<a name="355298742"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/304902-show%20and%20tell/topic/wasm%20without%20a%20host/near/355298742" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/304902-show-and-tell/topic/wasm.20without.20a.20host.html#355298742">(May 03 2023 at 02:01)</a>:</h4>
<p>When I saw that last commit I thought it was super cool.  I'm very interested to play with this some more and see what I can build with it. Are you thinking of going this direction for the Node TS integration?</p>



<a name="355300288"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/304902-show%20and%20tell/topic/wasm%20without%20a%20host/near/355300288" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/304902-show-and-tell/topic/wasm.20without.20a.20host.html#355300288">(May 03 2023 at 02:19)</a>:</h4>
<p>yep, exactly!</p>



<a name="355300412"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/304902-show%20and%20tell/topic/wasm%20without%20a%20host/near/355300412" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/304902-show-and-tell/topic/wasm.20without.20a.20host.html#355300412">(May 03 2023 at 02:21)</a>:</h4>
<p>at Vendr we're planning to introduce Roc in multiple places in the code base using calls to small Roc functions (at first, then more and more Roc over time), which means it will be common to rebuild the platform</p>



<a name="355300497"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/304902-show%20and%20tell/topic/wasm%20without%20a%20host/near/355300497" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/304902-show-and-tell/topic/wasm.20without.20a.20host.html#355300497">(May 03 2023 at 02:22)</a>:</h4>
<p>I want to make that rebuild as fast as possible, so taking out the step of building and linking the host (even if it's <code>zig</code> doing the build and <code>wasm-ld</code> instead of <code>ld</code>) will get multiplied by the number of different entrypoints we have</p>



<a name="355300623"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/304902-show%20and%20tell/topic/wasm%20without%20a%20host/near/355300623" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/304902-show-and-tell/topic/wasm.20without.20a.20host.html#355300623">(May 03 2023 at 02:22)</a>:</h4>
<p>also, it means I don't have to introduce a <code>zig</code> dependency for everyone (nontrivial; we aren't currently using Nix, but rather Homebrew on Mac and Docker on Linux)</p>



<a name="355300673"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/304902-show%20and%20tell/topic/wasm%20without%20a%20host/near/355300673" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/304902-show-and-tell/topic/wasm.20without.20a.20host.html#355300673">(May 03 2023 at 02:23)</a>:</h4>
<p>(well I guess introducing it is fairly trivial, but people have to run a manual command to get it, and then the versions have to be kept in sync, which requires re-running that command, etc. etc.)</p>



<a name="355301073"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/304902-show%20and%20tell/topic/wasm%20without%20a%20host/near/355301073" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/304902-show-and-tell/topic/wasm.20without.20a.20host.html#355301073">(May 03 2023 at 02:27)</a>:</h4>
<blockquote>
<p>I could try porting my old wasm cpu example to this to see the perf diff.</p>
</blockquote>
<p>Actually that won't be useful. It currently never allocates, that said, it is using effects that directly call into JS just like your JS host is doing. And it was way faster than the JS only version, so at least that is a good sign. It has to call into JS for every memory read and write that the cpu does. So essentially they are super thin functions that just wrap array access. So you would think the overhead of function calls could matter a lot in that case, but it doesn't seem to.</p>



<a name="355301485"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/304902-show%20and%20tell/topic/wasm%20without%20a%20host/near/355301485" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/304902-show-and-tell/topic/wasm.20without.20a.20host.html#355301485">(May 03 2023 at 02:33)</a>:</h4>
<p>Also, I wonder what the perf cost of having JS do memory management would be. As in alloc would essentially be a wrapper around <code> new Uint8Array(requestedBytes)</code>. dealloc would be <code>delete mem</code> or a noop.</p>



<a name="355302936"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/304902-show%20and%20tell/topic/wasm%20without%20a%20host/near/355302936" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/304902-show-and-tell/topic/wasm.20without.20a.20host.html#355302936">(May 03 2023 at 02:49)</a>:</h4>
<p>whoa, I didn't even think of that! Although I don't know if wasm can "see" those bytes <span aria-label="thinking" class="emoji emoji-1f914" role="img" title="thinking">:thinking:</span></p>



<a name="355302959"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/304902-show%20and%20tell/topic/wasm%20without%20a%20host/near/355302959" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/304902-show-and-tell/topic/wasm.20without.20a.20host.html#355302959">(May 03 2023 at 02:49)</a>:</h4>
<p>like I don't know if it can address into them</p>



<a name="355302971"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/304902-show%20and%20tell/topic/wasm%20without%20a%20host/near/355302971" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/304902-show-and-tell/topic/wasm.20without.20a.20host.html#355302971">(May 03 2023 at 02:49)</a>:</h4>
<p>but if so, that would be really cool!</p>



<a name="355305742"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/304902-show%20and%20tell/topic/wasm%20without%20a%20host/near/355305742" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/304902-show-and-tell/topic/wasm.20without.20a.20host.html#355305742">(May 03 2023 at 03:10)</a>:</h4>
<p>Ah, sounds like no</p>



<a name="355305827"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/304902-show%20and%20tell/topic/wasm%20without%20a%20host/near/355305827" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/304902-show-and-tell/topic/wasm.20without.20a.20host.html#355305827">(May 03 2023 at 03:11)</a>:</h4>
<p>Wasm has a buffer that js can read and write to, but wasm can't access js memory</p>



<a name="355305846"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/304902-show%20and%20tell/topic/wasm%20without%20a%20host/near/355305846" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/304902-show-and-tell/topic/wasm.20without.20a.20host.html#355305846">(May 03 2023 at 03:11)</a>:</h4>
<p>I guess this is where the wasm GC proposal should help in the future, iirc.</p>



<a name="355320598"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/304902-show%20and%20tell/topic/wasm%20without%20a%20host/near/355320598" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/304902-show-and-tell/topic/wasm.20without.20a.20host.html#355320598">(May 03 2023 at 05:18)</a>:</h4>
<p>Yeah, looked into this again.the new wasm GC stuff should resolve this. Discussed some in this talk: <a href="https://youtu.be/Nkjc9r0WDNo?t=855s">https://youtu.be/Nkjc9r0WDNo?t=855s</a></p>
<div class="youtube-video message_inline_image"><a data-id="Nkjc9r0WDNo" href="https://youtu.be/Nkjc9r0WDNo?t=855s"><img src="https://uploads.zulipusercontent.net/e1889906ca8c3c9581bb9732352c74083a2ab21c/68747470733a2f2f692e7974696d672e636f6d2f76692f4e6b6a6339723057444e6f2f64656661756c742e6a7067"></a></div>



<a name="355320773"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/304902-show%20and%20tell/topic/wasm%20without%20a%20host/near/355320773" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/304902-show-and-tell/topic/wasm.20without.20a.20host.html#355320773">(May 03 2023 at 05:19)</a>:</h4>
<p>Specifically for this, it adds reference types to wasm that can reference host data.</p>



<a name="355607407"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/304902-show%20and%20tell/topic/wasm%20without%20a%20host/near/355607407" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Carroll <a href="https://roc-lang.github.io/zulip-export/stream/304902-show-and-tell/topic/wasm.20without.20a.20host.html#355607407">(May 03 2023 at 21:02)</a>:</h4>
<p>Wow this is a really interesting idea!<br>
I bet JS is plenty fast enough. These functions will be called a <em>lot</em> so v8 will optimise the heck out of them. Especially since they're doing low-level things with numbers and byte arrays.</p>



<a name="355607868"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/304902-show%20and%20tell/topic/wasm%20without%20a%20host/near/355607868" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Carroll <a href="https://roc-lang.github.io/zulip-export/stream/304902-show-and-tell/topic/wasm.20without.20a.20host.html#355607868">(May 03 2023 at 21:06)</a>:</h4>
<p><code>new Uint8Array</code> won't work for memory management though. The Wasm module has a single <code>Uint8Array</code> and "allocation" means dividing it up into chunks on demand, and keeping track of each chunk so that you can free it and then hand it out to someone else again. In other words you are writing an allocator in JS. You cannot build on top of the JS allocator.</p>



<a name="355607977"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/304902-show%20and%20tell/topic/wasm%20without%20a%20host/near/355607977" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Carroll <a href="https://roc-lang.github.io/zulip-export/stream/304902-show-and-tell/topic/wasm.20without.20a.20host.html#355607977">(May 03 2023 at 21:07)</a>:</h4>
<p>In other words you are <em>sub-dividing</em> the piece of memory that JS has already allocated to Wasm.</p>



<a name="355607986"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/304902-show%20and%20tell/topic/wasm%20without%20a%20host/near/355607986" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Carroll <a href="https://roc-lang.github.io/zulip-export/stream/304902-show-and-tell/topic/wasm.20without.20a.20host.html#355607986">(May 03 2023 at 21:07)</a>:</h4>
<p>And growing it and so on</p>



<a name="355608025"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/304902-show%20and%20tell/topic/wasm%20without%20a%20host/near/355608025" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Carroll <a href="https://roc-lang.github.io/zulip-export/stream/304902-show-and-tell/topic/wasm.20without.20a.20host.html#355608025">(May 03 2023 at 21:07)</a>:</h4>
<p>you can't grab more memory and shove it in there</p>



<a name="355616883"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/304902-show%20and%20tell/topic/wasm%20without%20a%20host/near/355616883" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/304902-show-and-tell/topic/wasm.20without.20a.20host.html#355616883">(May 03 2023 at 22:15)</a>:</h4>
<p>Yeah, makes sense. Though i guess you could implement the malloc algorithm that sub divides in js if wanted.</p>



<a name="355617046"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/304902-show%20and%20tell/topic/wasm%20without%20a%20host/near/355617046" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/304902-show-and-tell/topic/wasm.20without.20a.20host.html#355617046">(May 03 2023 at 22:17)</a>:</h4>
<p>Otherwise, more convenient apis should be possible once the reference types proposal is implemented (apparently it was split out of the wasm GC proposal and is already implemented in wasmtime)</p>



<a name="355617518"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/304902-show%20and%20tell/topic/wasm%20without%20a%20host/near/355617518" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/304902-show-and-tell/topic/wasm.20without.20a.20host.html#355617518">(May 03 2023 at 22:20)</a>:</h4>
<p>Oh, actually it looks like the host references will be opaque to wasm, so this still doesn't help here. Wasm can't twiddle the bytes.</p>



<a name="355617787"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/304902-show%20and%20tell/topic/wasm%20without%20a%20host/near/355617787" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/304902-show-and-tell/topic/wasm.20without.20a.20host.html#355617787">(May 03 2023 at 22:23)</a>:</h4>
<p>Also, found an interesting related read: <a href="https://fitzgeraldnick.com/2020/08/27/reference-types-in-wasmtime.html">https://fitzgeraldnick.com/2020/08/27/reference-types-in-wasmtime.html</a></p>



<a name="355843414"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/304902-show%20and%20tell/topic/wasm%20without%20a%20host/near/355843414" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Carroll <a href="https://roc-lang.github.io/zulip-export/stream/304902-show-and-tell/topic/wasm.20without.20a.20host.html#355843414">(May 04 2023 at 17:32)</a>:</h4>
<p>That's right. When you hear that some GC feature is coming to Wasm, you naturally think it sounds related to this and really useful. But in fact it has zero relevance to implementing roc_alloc. What is needed is a malloc implementation written in JS that manipulates a UInt8Array.</p>



<a name="355845090"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/304902-show%20and%20tell/topic/wasm%20without%20a%20host/near/355845090" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Carroll <a href="https://roc-lang.github.io/zulip-export/stream/304902-show-and-tell/topic/wasm.20without.20a.20host.html#355845090">(May 04 2023 at 17:39)</a>:</h4>
<p>So one approach would be to try to find a simple open source allocator in C or Zig and translate it line by line to JS. I know the Zig folks have a small-code-size allocator that they use for Wasm. Can't remember the name of it.</p>



<hr><p>Last updated: Mar 01 2026 at 12:20 UTC</p>
</html>