<html>
<head><meta charset="utf-8"><title>Raytracing in one weekend · show and tell · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://roc-lang.github.io/zulip-export/stream/304902-show-and-tell/index.html">show and tell</a></h2>
<h3>Topic: <a href="https://roc-lang.github.io/zulip-export/stream/304902-show-and-tell/topic/Raytracing.20in.20one.20weekend.html">Raytracing in one weekend</a></h3>

<hr>

<base href="https://roc.zulipchat.com">

<head><link href="https://roc-lang.github.io/zulip-export/style.css" rel="stylesheet"></head>

<a name="317569062"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/304902-show%20and%20tell/topic/Raytracing%20in%20one%20weekend/near/317569062" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Shritesh Bhattarai <a href="https://roc-lang.github.io/zulip-export/stream/304902-show-and-tell/topic/Raytracing.20in.20one.20weekend.html#317569062">(Dec 23 2022 at 13:38)</a>:</h4>
<p><a href="/user_uploads/22008/AWVSvpTs41lI6c7v91QdTT1v/Screenshot-2022-12-23-at-5.10.06-AM.png">image.ppm.png</a> </p>
<div class="message_inline_image"><a href="/user_uploads/22008/AWVSvpTs41lI6c7v91QdTT1v/Screenshot-2022-12-23-at-5.10.06-AM.png" title="image.ppm.png"><img src="/user_uploads/22008/AWVSvpTs41lI6c7v91QdTT1v/Screenshot-2022-12-23-at-5.10.06-AM.png"></a></div><p>I implemented Perter Shirley's <a href="https://raytracing.github.io">Ray Tracing in One Weekend</a> in Roc. This is the final image from the first book and the repo is at <a href="https://github.com/shritesh/raytrace.roc">https://github.com/shritesh/raytrace.roc</a> </p>
<ul>
<li>Ray tracing is an embarrassingly parallel problem. So I created a platform in Rust that uses Rayon to call in parallel the <code>render</code> function implemented in Roc. It gave me a 10x speedup on my M1 Max. </li>
<li>I needed a Random Number Generator. I initially tried to implement it as an effect in the Rust host but it <a href="#narrow/stream/231634-beginners/topic/convert.20list.20of.20task.20to.20task.20of.20list">overflowed the stack</a>. So, I instead <a href="https://github.com/shritesh/raytrace.roc/blob/main/RNG.roc">implemented a simple Linear congruential generator in Roc</a> and threaded it throughout the program. Backpassing makes the API really nice to use.</li>
<li>The book uses two different object-oriented interfaces for Ray-Object intersection and Materials. I first started modeling the same with Abilities. It was a fun exercise and <a href="https://github.com/shritesh/raytrace.roc/commit/668f43c66f362f6755c6b2e62abbf46aa020c5f0#diff-743f633f133e1b93eb4d657ca00e42f99e5070a59405fb9ee16d2462035ced44">I got far</a> but the codegen would panic once things got more complex. I switched over to simple tagged unions and I think it is a much better solution anyway.</li>
<li>Currently I multisample 500 times per pixel and generate a final .ppm image file. I will soon modify the host to make the multisampling happen inside a GUI "in real time" and maybe even port this to wasm on the web. I also intend to implement an elm-style {init, update, render} platform to clean things up and make the platform reusable.</li>
</ul>



<a name="317570559"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/304902-show%20and%20tell/topic/Raytracing%20in%20one%20weekend/near/317570559" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anton <a href="https://roc-lang.github.io/zulip-export/stream/304902-show-and-tell/topic/Raytracing.20in.20one.20weekend.html#317570559">(Dec 23 2022 at 13:46)</a>:</h4>
<p>Wow, super cool <span class="user-mention" data-user-id="452038">@Shritesh Bhattarai</span>! The image looks beautiful :)</p>



<a name="317575431"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/304902-show%20and%20tell/topic/Raytracing%20in%20one%20weekend/near/317575431" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/304902-show-and-tell/topic/Raytracing.20in.20one.20weekend.html#317575431">(Dec 23 2022 at 14:12)</a>:</h4>
<p>yoooo this is amazing!!! <span aria-label="heart eyes" class="emoji emoji-1f60d" role="img" title="heart eyes">:heart_eyes:</span></p>



<a name="317904925"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/304902-show%20and%20tell/topic/Raytracing%20in%20one%20weekend/near/317904925" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Shritesh Bhattarai <a href="https://roc-lang.github.io/zulip-export/stream/304902-show-and-tell/topic/Raytracing.20in.20one.20weekend.html#317904925">(Dec 26 2022 at 04:20)</a>:</h4>
<p><a href="/user_uploads/22008/h3BtGOUXkXmYwws0QeTIKZe0/Final-Loop.gif">Final-Loop.gif</a></p>
<div class="message_inline_image"><a href="/user_uploads/22008/h3BtGOUXkXmYwws0QeTIKZe0/Final-Loop.gif" title="Final-Loop.gif"><img src="/user_uploads/22008/h3BtGOUXkXmYwws0QeTIKZe0/Final-Loop.gif"></a></div><p>I have now implemented an elm-style <code>{init, update, render}</code> platform. The init is called with the host provided <code>{width, height, x,y}</code> values for every pixel in parallel (using Rust's Rayon). Then the update and render functions are repeatedly called (again in parallel) to update the state and draw the screen. <a href="https://github.com/shritesh/raytrace.roc/blob/main/platform/main.roc">https://github.com/shritesh/raytrace.roc/blob/main/platform/main.roc</a> </p>
<p>I am calling this learning exercise "complete". It was really fun and helped me understand where Roc excels at and the current limitations. The clean separation of platform and application is a huge effing deal and changes the way you think about programming. I'm doubling down on Roc+Rust being my default stack of choice.</p>



<hr><p>Last updated: Nov 01 2025 at 12:13 UTC</p>
</html>