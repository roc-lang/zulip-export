<html>
<head><meta charset="utf-8"><title>roc-lang/http package · show and tell · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://roc-lang.github.io/zulip-export/stream/304902-show-and-tell/index.html">show and tell</a></h2>
<h3>Topic: <a href="https://roc-lang.github.io/zulip-export/stream/304902-show-and-tell/topic/roc-lang.2Fhttp.20package.html">roc-lang/http package</a></h3>

<hr>

<base href="https://roc.zulipchat.com">

<head><link href="https://roc-lang.github.io/zulip-export/style.css" rel="stylesheet"></head>

<a name="494072340"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/304902-show%20and%20tell/topic/roc-lang/http%20package/near/494072340" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/304902-show-and-tell/topic/roc-lang.2Fhttp.20package.html#494072340">(Jan 16 2025 at 05:59)</a>:</h4>
<p>I just made a repo for a platform-agnostic <a href="https://github.com/roc-lang/http">roc-lang/http</a> package that <code>basic-cli</code> and <code>basic-webserver</code> can depend on, such that they no longer need publicly exposed <code>Request</code> and <code>Response</code> modules, and can instead just offer effectful functions like <code>Http.send!</code> (and similar) and then have some internal functions which handle translating these <code>Request</code> and <code>Response</code> types to/from host types</p>



<a name="494072456"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/304902-show%20and%20tell/topic/roc-lang/http%20package/near/494072456" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/304902-show-and-tell/topic/roc-lang.2Fhttp.20package.html#494072456">(Jan 16 2025 at 06:00)</a>:</h4>
<p>right now I mainly wanted to share the design and get thoughts/feedback/questions on it at this point; I figure it can be productionalized later <span aria-label="big smile" class="emoji emoji-1f604" role="img" title="big smile">:big_smile:</span></p>



<a name="494072507"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/304902-show%20and%20tell/topic/roc-lang/http%20package/near/494072507" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/304902-show-and-tell/topic/roc-lang.2Fhttp.20package.html#494072507">(Jan 16 2025 at 06:00)</a>:</h4>
<p>(productionalized in the sense of setting up the publishing workflow, docs, CI, actually using it in <code>basic-cli</code> and <code>basic-webserver</code>, etc.)</p>



<a name="494072628"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/304902-show%20and%20tell/topic/roc-lang/http%20package/near/494072628" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/304902-show-and-tell/topic/roc-lang.2Fhttp.20package.html#494072628">(Jan 16 2025 at 06:01)</a>:</h4>
<p>unlike <a href="https://github.com/roc-lang/path">roc-lang/path</a>, as far as I know this is actually ready to use right now</p>



<a name="494072678"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/304902-show%20and%20tell/topic/roc-lang/http%20package/near/494072678" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/304902-show-and-tell/topic/roc-lang.2Fhttp.20package.html#494072678">(Jan 16 2025 at 06:02)</a>:</h4>
<p>there are zero tests, but also there's almost nothing to test <span aria-label="laughing" class="emoji emoji-1f606" role="img" title="laughing">:laughing:</span></p>



<a name="494072720"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/304902-show%20and%20tell/topic/roc-lang/http%20package/near/494072720" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/304902-show-and-tell/topic/roc-lang.2Fhttp.20package.html#494072720">(Jan 16 2025 at 06:02)</a>:</h4>
<p>in terms of logic that is</p>



<a name="494072762"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/304902-show%20and%20tell/topic/roc-lang/http%20package/near/494072762" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/304902-show-and-tell/topic/roc-lang.2Fhttp.20package.html#494072762">(Jan 16 2025 at 06:02)</a>:</h4>
<p>Is it just lifted from basic-cli?</p>



<a name="494072772"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/304902-show%20and%20tell/topic/roc-lang/http%20package/near/494072772" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/304902-show-and-tell/topic/roc-lang.2Fhttp.20package.html#494072772">(Jan 16 2025 at 06:02)</a>:</h4>
<p>no, I made some API changes</p>



<a name="494072783"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/304902-show%20and%20tell/topic/roc-lang/http%20package/near/494072783" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/304902-show-and-tell/topic/roc-lang.2Fhttp.20package.html#494072783">(Jan 16 2025 at 06:03)</a>:</h4>
<p>I explained the overall design philosophy in the readme</p>



<a name="494072813"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/304902-show%20and%20tell/topic/roc-lang/http%20package/near/494072813" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/304902-show-and-tell/topic/roc-lang.2Fhttp.20package.html#494072813">(Jan 16 2025 at 06:03)</a>:</h4>
<p>I think backwards compatibility is important in a package like this that's likely to be depended on by a good chunk of the ecosystem</p>



<a name="494072833"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/304902-show%20and%20tell/topic/roc-lang/http%20package/near/494072833" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/304902-show-and-tell/topic/roc-lang.2Fhttp.20package.html#494072833">(Jan 16 2025 at 06:03)</a>:</h4>
<p>and this is more focused on backwards compatibility than the current basic-cli one is</p>



<a name="494082363"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/304902-show%20and%20tell/topic/roc-lang/http%20package/near/494082363" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jasper Woudenberg <a href="https://roc-lang.github.io/zulip-export/stream/304902-show-and-tell/topic/roc-lang.2Fhttp.20package.html#494082363">(Jan 16 2025 at 07:38)</a>:</h4>
<p>Is the idea that app authors would use these API's directly, or are these intended to be exclusively platform-author-facing?</p>
<p>If the app author is going to be using these directly, I've some concerns about how nice the documentation can be. The app author will either be making http requests and need an http client, or handling http requests and need an http server. Depending on that they need request getters and response setters or vice-versa. In this design both modules offer part of the API you need for both http clients and servers.</p>
<div class="codehilite"><pre><span></span><code>|          | Setters | Getters |
| Request  | client  | server  |
| Response | server  | client  |
</code></pre></div>
<p>I think that will make it hard to tell the story of, say, making an http request as a client, in a single place and without distraction.</p>



<a name="494083790"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/304902-show%20and%20tell/topic/roc-lang/http%20package/near/494083790" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jasper Woudenberg <a href="https://roc-lang.github.io/zulip-export/stream/304902-show-and-tell/topic/roc-lang.2Fhttp.20package.html#494083790">(Jan 16 2025 at 07:50)</a>:</h4>
<p>Separately, still assuming (part of) this API is intended to be app-author-facing, I've been thinking about whether as a platform author I'd want core functionality from the platform to be provided by external libraries. For instance, the static site generator platform I'm working on has a module for constructing <code>Html</code>, and though we have a nice library for that available, I still decided to do a platform-custom implementation of the same, for these reasons:</p>
<ul>
<li>
<p>By doing a custom implementation I'm able to optimize the underlying opaque <code>Html</code> type for how the platform consumes it.<br>
  This argument I can imagine existing around http requests/responses as well. Maybe a platform author would like the <code>Request</code> type internally to be a bytestring builder for instance and not allocate an intermediate data structure. Or the platform separately offering a web sockets API pushes into the design of simple http requests as well, to make both options part of a single cohesive design.</p>
</li>
<li>
<p>I really dislike the idea that an application author would need to go look up sepate documentation for core platform functionality. It seems at odds with the 'batteries included' approach I want to take with the platform.</p>
</li>
<li>For core platform functionality I don't want a dependency that I can't swap out without making a breaking change. Given it's core functionality I'm opinionated about the API, versioning strategy, documentation, etc. I might decide to incorporate <code>elm-css</code>like styling functionality for instance.</li>
</ul>



<a name="494088218"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/304902-show%20and%20tell/topic/roc-lang/http%20package/near/494088218" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Kilian Vounckx <a href="https://roc-lang.github.io/zulip-export/stream/304902-show-and-tell/topic/roc-lang.2Fhttp.20package.html#494088218">(Jan 16 2025 at 08:21)</a>:</h4>
<p>Do we want a custom URI type as well? I find it really handy to be able to do something like</p>
<div class="codehilite"><pre><span></span><code>uri.from_str(&quot;https://example.com&quot;)?
    .addPath(&quot;foo&quot;)
    .addPath(&quot;bar&quot;)
    .addFragment(&quot;frag&quot;)
    .addQuery(&quot;name&quot;, &quot;Frodo&quot;)
    .addQuery(&quot;age&quot;, &quot;50&quot;)
</code></pre></div>
<p>And having it be resolved to <code>"https://example.com/foo/bar?name=Frodo&amp;age=50#frag"</code>. I'm not even sure if the fragment should be before or after the queries, but that is exactly why I want such an api. It would also take care of url encoding. Especially nice when some parts are user input.</p>
<p>If we do want something like this, should it be another package?</p>



<a name="494088794"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/304902-show%20and%20tell/topic/roc-lang/http%20package/near/494088794" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/304902-show-and-tell/topic/roc-lang.2Fhttp.20package.html#494088794">(Jan 16 2025 at 08:25)</a>:</h4>
<p>I already have some work for a URL package</p>



<a name="494088824"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/304902-show%20and%20tell/topic/roc-lang/http%20package/near/494088824" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/304902-show-and-tell/topic/roc-lang.2Fhttp.20package.html#494088824">(Jan 16 2025 at 08:25)</a>:</h4>
<p>I can try to clean it up soon and get that published</p>



<a name="494144968"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/304902-show%20and%20tell/topic/roc-lang/http%20package/near/494144968" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/304902-show-and-tell/topic/roc-lang.2Fhttp.20package.html#494144968">(Jan 16 2025 at 13:22)</a>:</h4>
<p><span class="user-mention silent" data-user-id="477725">Jasper Woudenberg</span> <a href="#narrow/channel/304902-show-and-tell/topic/roc-lang.2Fhttp.20package/near/494082363">said</a>:</p>
<blockquote>
<p>Is the idea that app authors would use these API's directly, or are these intended to be exclusively platform-author-facing?</p>
<p>If the app author is going to be using these directly, I've some concerns about how nice the documentation can be. The app author will either be making http requests and need an http client, or handling http requests and need an http server. Depending on that they need request getters and response setters or vice-versa. In this design both modules offer part of the API you need for both http clients and servers.</p>
<div class="codehilite"><pre><span></span><code>|          | Setters | Getters |
| Request  | client  | server  |
| Response | server  | client  |
</code></pre></div>
<p>I think that will make it hard to tell the story of, say, making an http request as a client, in a single place and without distraction.</p>
</blockquote>
<p>I think everybody needs both for simulating HTTP roundtrips in testing. Even if I'm only using a client, I still want to be able to write tests which simulate a server making a certain response (e.g. a 500 error or a 403 vs 401), which in turn means I need access to both. Similarly, if I'm writing a server, I want to be able to simulate certain shapes of requests coming in! <span aria-label="big smile" class="emoji emoji-1f604" role="img" title="big smile">:big_smile:</span></p>



<a name="494145369"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/304902-show%20and%20tell/topic/roc-lang/http%20package/near/494145369" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/304902-show-and-tell/topic/roc-lang.2Fhttp.20package.html#494145369">(Jan 16 2025 at 13:23)</a>:</h4>
<p><span class="user-mention silent" data-user-id="477725">Jasper Woudenberg</span> <a href="#narrow/channel/304902-show-and-tell/topic/roc-lang.2Fhttp.20package/near/494083790">said</a>:</p>
<blockquote>
<p>Separately, still assuming (part of) this API is intended to be app-author-facing, I've been thinking about whether as a platform author I'd want core functionality from the platform to be provided by external libraries. For instance, the static site generator platform I'm working on has a module for constructing <code>Html</code>, and though we have a nice library for that available, I still decided to do a platform-custom implementation of the same [...]</p>
</blockquote>
<p>this is an interesting tradeoff! I think the main question here is about code sharing across the ecosystem</p>



<a name="494153135"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/304902-show%20and%20tell/topic/roc-lang/http%20package/near/494153135" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/304902-show-and-tell/topic/roc-lang.2Fhttp.20package.html#494153135">(Jan 16 2025 at 13:59)</a>:</h4>
<p>so for example, let's say there's a platform-agnostic <code>html</code> library</p>



<a name="494153354"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/304902-show%20and%20tell/topic/roc-lang/http%20package/near/494153354" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/304902-show-and-tell/topic/roc-lang.2Fhttp.20package.html#494153354">(Jan 16 2025 at 14:00)</a>:</h4>
<p>and all it does is to basically define a <code>Node</code> type where each node is either text or a list of child nodes and attributes</p>



<a name="494153446"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/304902-show%20and%20tell/topic/roc-lang/http%20package/near/494153446" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/304902-show-and-tell/topic/roc-lang.2Fhttp.20package.html#494153446">(Jan 16 2025 at 14:00)</a>:</h4>
<p>in other words, essentially the "builder" part of things</p>



<a name="494153606"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/304902-show%20and%20tell/topic/roc-lang/http%20package/near/494153606" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/304902-show-and-tell/topic/roc-lang.2Fhttp.20package.html#494153606">(Jan 16 2025 at 14:01)</a>:</h4>
<p>I could be wrong, but I don't think any platform would benefit significantly from using a different data structure to represent HTML</p>



<a name="494153826"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/304902-show%20and%20tell/topic/roc-lang/http%20package/near/494153826" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/304902-show-and-tell/topic/roc-lang.2Fhttp.20package.html#494153826">(Jan 16 2025 at 14:02)</a>:</h4>
<p>so if that package exists, then anyone can build reusable platform-agnostic html packages with it</p>



<a name="494154132"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/304902-show%20and%20tell/topic/roc-lang/http%20package/near/494154132" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/304902-show-and-tell/topic/roc-lang.2Fhttp.20package.html#494154132">(Jan 16 2025 at 14:04)</a>:</h4>
<p>but at the same time, any platform can also offer its own batteries-included API for actually building and using these things, including exposing a type alias to <code>Node</code> so users of the API don't necessarily even need to realize that type is defined in another package</p>



<a name="494155158"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/304902-show%20and%20tell/topic/roc-lang/http%20package/near/494155158" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/304902-show-and-tell/topic/roc-lang.2Fhttp.20package.html#494155158">(Jan 16 2025 at 14:08)</a>:</h4>
<p>so at that point, the delta between doing absolutely everything in the platform and using the platform-agnostic html package becomes:</p>
<ul>
<li>application authors have a new indirect dependency, but they never really interact with it because its one type is provided as an alias in the platform anyway</li>
<li>now application authors can access an ecosystem of platform-agnostic html packages</li>
</ul>



<a name="494155699"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/304902-show%20and%20tell/topic/roc-lang/http%20package/near/494155699" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/304902-show-and-tell/topic/roc-lang.2Fhttp.20package.html#494155699">(Jan 16 2025 at 14:10)</a>:</h4>
<p>to me this seems like a pretty minor cost to get the ecosystem benefit, but I think it's also reasonable for a platform to go the other way and prioritize having fewer dependencies over ecosystem code sharing</p>



<a name="494156507"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/304902-show%20and%20tell/topic/roc-lang/http%20package/near/494156507" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/304902-show-and-tell/topic/roc-lang.2Fhttp.20package.html#494156507">(Jan 16 2025 at 14:14)</a>:</h4>
<p>the pattern between this example and http is that the platform-agnostic package is basically just "here's the common data we need to share if we're going to interoperate"</p>



<a name="494156618"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/304902-show%20and%20tell/topic/roc-lang/http%20package/near/494156618" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/304902-show-and-tell/topic/roc-lang.2Fhttp.20package.html#494156618">(Jan 16 2025 at 14:15)</a>:</h4>
<p>so headers and urls and whatnot in the case of http, and node tree structure in the case of html</p>



<a name="494156808"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/304902-show%20and%20tell/topic/roc-lang/http%20package/near/494156808" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/304902-show-and-tell/topic/roc-lang.2Fhttp.20package.html#494156808">(Jan 16 2025 at 14:16)</a>:</h4>
<p>but everything else, including the APIs for how to assemble and manipulate that data, can be customized as much as desired without sacrificing interoperability!</p>



<a name="494172253"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/304902-show%20and%20tell/topic/roc-lang/http%20package/near/494172253" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/304902-show-and-tell/topic/roc-lang.2Fhttp.20package.html#494172253">(Jan 16 2025 at 15:19)</a>:</h4>
<p>I think Platforms as a concept is unworkable at scale without packages like these coming from roc-lang and developed by the community.  And the community coalescing around them</p>



<a name="494172511"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/304902-show%20and%20tell/topic/roc-lang/http%20package/near/494172511" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/304902-show-and-tell/topic/roc-lang.2Fhttp.20package.html#494172511">(Jan 16 2025 at 15:20)</a>:</h4>
<p>Or I’d want platforms to expose way more low level abstractions</p>



<a name="494191415"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/304902-show%20and%20tell/topic/roc-lang/http%20package/near/494191415" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jasper Woudenberg <a href="https://roc-lang.github.io/zulip-export/stream/304902-show-and-tell/topic/roc-lang.2Fhttp.20package.html#494191415">(Jan 16 2025 at 16:46)</a>:</h4>
<p><span class="user-mention silent" data-user-id="281383">Richard Feldman</span> <a href="#narrow/channel/304902-show-and-tell/topic/roc-lang.2Fhttp.20package/near/494144968">said</a>:</p>
<blockquote>
<p>I think everybody needs both for simulating HTTP roundtrips in testing. Even if I'm only using a client, I still want to be able to write tests which simulate a server making a certain response (e.g. a 500 error or a 403 vs 401), which in turn means I need access to both. Similarly, if I'm writing a server, I want to be able to simulate certain shapes of requests coming in!</p>
</blockquote>
<p>Fair point, I hadn't considered the testing angle!</p>
<p>I'm still wondering if for my ideal Roc Http client I wouldn't want the docs to be written, not in terms of generic setters and getters, but more like "here are funcctions for making an http request, and here's some helpers testing that logic".</p>
<p>Separately, but this might be more of a static dispatch thing, if I'm writing a platform with support for sending http requests, I can't really see myself being happy with an API that requires multiple import statements to use, and/or of which the documentation is spread across &gt;=3 separate modules. Maybe that's a matter of getting used to SD more, but I really think I'd want to tweak that a bit more to try make it nicer.</p>



<a name="494191840"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/304902-show%20and%20tell/topic/roc-lang/http%20package/near/494191840" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jasper Woudenberg <a href="https://roc-lang.github.io/zulip-export/stream/304902-show-and-tell/topic/roc-lang.2Fhttp.20package.html#494191840">(Jan 16 2025 at 16:49)</a>:</h4>
<p>What I have an easier time imagining is writing a platform that provides custom Request/Response APIs, but offers support for external middlewares using the shared <code>Request</code>/<code>Response</code> types, a bit like the role <code>wai</code> plays in the Haskell ecosystem. I might do something like that if that hooked into an existing ecosystem of middlewares. That said, such middlewares almost certainly need to perform effects, so it might end up being integrated in the platform after all <span aria-label="shrug" class="emoji emoji-1f937" role="img" title="shrug">:shrug:</span>.</p>



<a name="494191928"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/304902-show%20and%20tell/topic/roc-lang/http%20package/near/494191928" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jasper Woudenberg <a href="https://roc-lang.github.io/zulip-export/stream/304902-show-and-tell/topic/roc-lang.2Fhttp.20package.html#494191928">(Jan 16 2025 at 16:49)</a>:</h4>
<p><span class="user-mention silent" data-user-id="281383">Richard Feldman</span> <a href="#narrow/channel/304902-show-and-tell/topic/roc-lang.2Fhttp.20package/near/494154132">said</a>:</p>
<blockquote>
<p>but at the same time, any platform can also offer its own batteries-included API for actually building and using these things, including exposing a type alias to <code>Node</code> so users of the API don't necessarily even need to realize that type is defined in another package</p>
</blockquote>
<p>If as a platform owner you'd like your own API for a type to be the default one, I don't think you have a choice but to define your own opaque type. A type alias is going to get it's methods from the module that defines it, and any API you layer on top is going to be second-class.</p>



<a name="494192736"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/304902-show%20and%20tell/topic/roc-lang/http%20package/near/494192736" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jasper Woudenberg <a href="https://roc-lang.github.io/zulip-export/stream/304902-show-and-tell/topic/roc-lang.2Fhttp.20package.html#494192736">(Jan 16 2025 at 16:53)</a>:</h4>
<p><span class="user-mention silent" data-user-id="281383">Richard Feldman</span> <a href="#narrow/channel/304902-show-and-tell/topic/roc-lang.2Fhttp.20package/near/494153606">said</a>:</p>
<blockquote>
<p>I could be wrong, but I don't think any platform would benefit significantly from using a different data structure to represent HTML</p>
</blockquote>
<p>I have a custom <code>Html</code> type like that for my static site generator platform currently. It looks like this:</p>
<div class="codehilite" data-code-language="Elm"><pre><span></span><code><span class="kt">Xml</span><span class="w"> </span><span class="nf">:</span><span class="w"> </span><span class="kt">List</span>
<span class="w">        </span><span class="p">[</span>
<span class="w">            </span><span class="kt">FromSource</span><span class="w"> </span><span class="kt">SourceLoc</span><span class="p">,</span>
<span class="w">            </span><span class="kt">RocGenerated</span><span class="w"> </span><span class="p">(</span><span class="kt">List</span><span class="w"> </span><span class="kt">U8</span><span class="p">),</span>
<span class="w">        </span><span class="p">]</span>

<span class="kt">SourceLoc</span><span class="w"> </span><span class="nf">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nv">start</span><span class="w"> </span><span class="nf">:</span><span class="w"> </span><span class="kt">U32</span><span class="p">,</span>
<span class="w">    </span><span class="nv">end</span><span class="w"> </span><span class="nf">:</span><span class="w"> </span><span class="kt">U32</span><span class="p">,</span>
<span class="p">}</span>
</code></pre></div>
<p>This being static site generation, the output HTML might be a mix of Html generated by a Roc <code>Html.*</code> module, mixed with slices from <code>.html</code> source files, mixed with Html output from <code>libcmark</code>. The above type allows me to mix raw Html from other sources into snippets generated from Roc without having to parse it first. Less importantly, the relatively flat representation makes it a relatively easy type to pass between host and platform.</p>



<a name="494193026"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/304902-show%20and%20tell/topic/roc-lang/http%20package/near/494193026" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jasper Woudenberg <a href="https://roc-lang.github.io/zulip-export/stream/304902-show-and-tell/topic/roc-lang.2Fhttp.20package.html#494193026">(Jan 16 2025 at 16:55)</a>:</h4>
<p><span class="user-mention silent" data-user-id="781658">Anthony Bullard</span> <a href="#narrow/channel/304902-show-and-tell/topic/roc-lang.2Fhttp.20package/near/494172253">said</a>:</p>
<blockquote>
<p>I think Platforms as a concept is unworkable at scale without packages like these coming from roc-lang and developed by the community.  And the community coalescing around them</p>
</blockquote>
<p>My current perception of this type of code sharing is that it makes the platform authoring experience a bit nicer at the expense of making the app authoring experience a bit less nice. I think it's a tricky pitch, because I imagine the motivation for many platform authors is the exact opposite: to do the hard bits in the platform and create a super nice application writing experience. It is for me!</p>
<p>A type of code-sharing I can see working better for me, is one where I depend on some combination of a C-dependency with a Roc wrapper, and maybe I vendor that into the platform project.</p>
<p>All that said, the existence doesn't block a platform author from taking a different approach and I'm not against it existing. But given the goal of a shared <code>http</code> package like this might in part be to try for consistency across platforms I wanted to raise some obstacles I see to using a package like this in my own platform work.</p>



<a name="494195765"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/304902-show%20and%20tell/topic/roc-lang/http%20package/near/494195765" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/304902-show-and-tell/topic/roc-lang.2Fhttp.20package.html#494195765">(Jan 16 2025 at 17:09)</a>:</h4>
<p>good points! Another possible option is to have the platform do its own thing in terms of types, but then offer a conversion function to let you convert to/from another representation.</p>
<p>that would make code sharing still possible, just less convenient for the application author due to needing to do the conversion explicitly instead of having the shared code just drop right in</p>



<a name="494195820"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/304902-show%20and%20tell/topic/roc-lang/http%20package/near/494195820" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/304902-show-and-tell/topic/roc-lang.2Fhttp.20package.html#494195820">(Jan 16 2025 at 17:09)</a>:</h4>
<p>but maybe for some platforms that's the right tradeoff!</p>



<a name="494196462"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/304902-show%20and%20tell/topic/roc-lang/http%20package/near/494196462" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/304902-show-and-tell/topic/roc-lang.2Fhttp.20package.html#494196462">(Jan 16 2025 at 17:13)</a>:</h4>
<p>btw I also think regarding the ecosystem as a whole, it's both valuable to have a high-quality obvious default choice and yet also have it be possible for people to use alternatives with different tradeoffs</p>



<a name="494196635"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/304902-show%20and%20tell/topic/roc-lang/http%20package/near/494196635" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/304902-show-and-tell/topic/roc-lang.2Fhttp.20package.html#494196635">(Jan 16 2025 at 17:14)</a>:</h4>
<p>without the high-quality obvious default choice, you get the kind of fragmentation you see in the <code>npm</code> ecosystem where there are all these competing standards for how to do basic things</p>



<a name="494196708"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/304902-show%20and%20tell/topic/roc-lang/http%20package/near/494196708" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/304902-show-and-tell/topic/roc-lang.2Fhttp.20package.html#494196708">(Jan 16 2025 at 17:14)</a>:</h4>
<p>but without the ability for people to choose alternatives, whole categories of platform use cases (which are designed to be specializable!) would be ruled out</p>



<a name="494197021"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/304902-show%20and%20tell/topic/roc-lang/http%20package/near/494197021" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/304902-show-and-tell/topic/roc-lang.2Fhttp.20package.html#494197021">(Jan 16 2025 at 17:16)</a>:</h4>
<p>so I think the ideal distribution of how people use things is that there's this massive concentration of usage around the default, and then a ton of tiny niche bespoke things, none of which are anywhere remotely near the usage of the default thing on their own - so they're not competing standards, but rather intentionally special-case alternatives</p>



<a name="494197261"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/304902-show%20and%20tell/topic/roc-lang/http%20package/near/494197261" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/304902-show-and-tell/topic/roc-lang.2Fhttp.20package.html#494197261">(Jan 16 2025 at 17:17)</a>:</h4>
<p>as opposed to a concentration of several large competing alternatives, and then debates rage on endlessly about which http package is slightly better than the others, package authors have to decide which one they want to depend on, which makes the fragmentation spread further, etc. etc.</p>



<a name="494204412"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/304902-show%20and%20tell/topic/roc-lang/http%20package/near/494204412" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jasper Woudenberg <a href="https://roc-lang.github.io/zulip-export/stream/304902-show-and-tell/topic/roc-lang.2Fhttp.20package.html#494204412">(Jan 16 2025 at 17:59)</a>:</h4>
<p>Yeah, that's fair!</p>
<p>I think this might also come down to some platforms being super-opinionated and intentionally restricted to serve some narrow use cases really well, and more general less opinionated platforms that leave more open to the application author. Both are worth supporting, and they'll have different needs from the wider Roc ecosystem.</p>



<hr><p>Last updated: Nov 01 2025 at 12:13 UTC</p>
</html>