<html>
<head><meta charset="utf-8"><title>roc-pg new features and examples · show and tell · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://roc-lang.github.io/zulip-export/stream/304902-show-and-tell/index.html">show and tell</a></h2>
<h3>Topic: <a href="https://roc-lang.github.io/zulip-export/stream/304902-show-and-tell/topic/roc-pg.20new.20features.20and.20examples.html">roc-pg new features and examples</a></h3>

<hr>

<base href="https://roc.zulipchat.com">

<head><link href="https://roc-lang.github.io/zulip-export/style.css" rel="stylesheet"></head>

<a name="350203467"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/304902-show%20and%20tell/topic/roc-pg%20new%20features%20and%20examples/near/350203467" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Agus Zubiaga <a href="https://roc-lang.github.io/zulip-export/stream/304902-show-and-tell/topic/roc-pg.20new.20features.20and.20examples.html#350203467">(Apr 15 2023 at 18:38)</a>:</h4>
<p><code>roc-pg</code> has a nicer API for expecting results and can now do Prepared Statements and Pipelining.</p>
<p>I added examples to the README:<br>
<a href="https://github.com/agu-z/roc-pg">https://github.com/agu-z/roc-pg</a></p>



<a name="350206592"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/304902-show%20and%20tell/topic/roc-pg%20new%20features%20and%20examples/near/350206592" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Rene Mailaender <a href="https://roc-lang.github.io/zulip-export/stream/304902-show-and-tell/topic/roc-pg.20new.20features.20and.20examples.html#350206592">(Apr 15 2023 at 19:14)</a>:</h4>
<p>wow. very cool. i'll try this some time in the near future. <span aria-label="smile" class="emoji emoji-1f642" role="img" title="smile">:smile:</span></p>



<a name="350207046"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/304902-show%20and%20tell/topic/roc-pg%20new%20features%20and%20examples/near/350207046" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Rene Mailaender <a href="https://roc-lang.github.io/zulip-export/stream/304902-show-and-tell/topic/roc-pg.20new.20features.20and.20examples.html#350207046">(Apr 15 2023 at 19:19)</a>:</h4>
<p>i see you reference Task and Tcp in your Pg.Client: <code>pf.Task.{ Task, await, fail },</code><br>
is there any mechanism to assure a certian type exists on a platform? (or plans for such a mechanism?) otherwise using this package on a different platform would crash right? <span aria-label="thinking" class="emoji emoji-1f914" role="img" title="thinking">:thinking:</span></p>



<a name="350207219"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/304902-show%20and%20tell/topic/roc-pg%20new%20features%20and%20examples/near/350207219" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Agus Zubiaga <a href="https://roc-lang.github.io/zulip-export/stream/304902-show-and-tell/topic/roc-pg.20new.20features.20and.20examples.html#350207219">(Apr 15 2023 at 19:21)</a>:</h4>
<p>Correct.  For now, this only works with <code>basic-cli</code>. The plan is to make it platform agnostic but the current model of <code>hosted</code> modules and effects doesn't make that very convenient.</p>



<a name="350207677"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/304902-show%20and%20tell/topic/roc-pg%20new%20features%20and%20examples/near/350207677" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Agus Zubiaga <a href="https://roc-lang.github.io/zulip-export/stream/304902-show-and-tell/topic/roc-pg.20new.20features.20and.20examples.html#350207677">(Apr 15 2023 at 19:26)</a>:</h4>
<p>If I understood correctly, that will change relatively soon :)</p>



<a name="350208401"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/304902-show%20and%20tell/topic/roc-pg%20new%20features%20and%20examples/near/350208401" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Agus Zubiaga <a href="https://roc-lang.github.io/zulip-export/stream/304902-show-and-tell/topic/roc-pg.20new.20features.20and.20examples.html#350208401">(Apr 15 2023 at 19:34)</a>:</h4>
<p><a href="#narrow/stream/304641-ideas/topic/effects.20in.20packages">#ideas &gt; effects in packages</a> I think is the relevant conversation</p>



<a name="350209141"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/304902-show%20and%20tell/topic/roc-pg%20new%20features%20and%20examples/near/350209141" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Rene Mailaender <a href="https://roc-lang.github.io/zulip-export/stream/304902-show-and-tell/topic/roc-pg.20new.20features.20and.20examples.html#350209141">(Apr 15 2023 at 19:42)</a>:</h4>
<p>i see. and thanks for the link. :)</p>



<a name="350210118"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/304902-show%20and%20tell/topic/roc-pg%20new%20features%20and%20examples/near/350210118" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/304902-show-and-tell/topic/roc-pg.20new.20features.20and.20examples.html#350210118">(Apr 15 2023 at 19:55)</a>:</h4>
<p>yooooo, this is amazing!!! <span aria-label="heart eyes" class="emoji emoji-1f60d" role="img" title="heart eyes">:heart_eyes:</span></p>



<a name="350233566"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/304902-show%20and%20tell/topic/roc-pg%20new%20features%20and%20examples/near/350233566" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/304902-show-and-tell/topic/roc-pg.20new.20features.20and.20examples.html#350233566">(Apr 16 2023 at 00:52)</a>:</h4>
<p><span class="user-mention" data-user-id="489294">@Agus Zubiaga</span> this is super cool.</p>
<p>Are you referring to having <code>glue</code> support <code>Op</code> tag union for effects before you modify to make it platform agnostic? Do you think it will be difficult to achieve? I assume you need sockets support in a platform, what would the interface look between the package and platform? is that going to be more generic like a <code>List U8</code>? </p>
<p>You mention SSL and Connection pooling will require new platform primitives, what did you have in mind here. Is this also going to be achievable platform agnostic?</p>



<a name="350371252"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/304902-show%20and%20tell/topic/roc-pg%20new%20features%20and%20examples/near/350371252" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Agus Zubiaga <a href="https://roc-lang.github.io/zulip-export/stream/304902-show-and-tell/topic/roc-pg.20new.20features.20and.20examples.html#350371252">(Apr 16 2023 at 22:22)</a>:</h4>
<p>From what I heard from Richard, the idea was to have a common <code>Task</code> type with a 3rd type variable for effects. Which in this case would be something like <code>[ Tcp TcpEffect ]</code>, where <code>TcpEffect</code> encodes all the operations such as <code>connect</code>, <code>read</code>, and <code>write</code>. <br>
That should work as long as the platform either supports the exact type or there's a way to map it to its own type.</p>



<a name="350372180"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/304902-show%20and%20tell/topic/roc-pg%20new%20features%20and%20examples/near/350372180" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Agus Zubiaga <a href="https://roc-lang.github.io/zulip-export/stream/304902-show-and-tell/topic/roc-pg.20new.20features.20and.20examples.html#350372180">(Apr 16 2023 at 22:31)</a>:</h4>
<p>You could also provide these as functions to <code>Pg.Client.withConnect</code> and make it platform-agnostic that way. That'd work, but it would make the types complex and it means the user needs to take care of establishing the TCP connection and doing the SSL stuff, which might not be great for beginners.</p>



<a name="350372325"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/304902-show%20and%20tell/topic/roc-pg%20new%20features%20and%20examples/near/350372325" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Agus Zubiaga <a href="https://roc-lang.github.io/zulip-export/stream/304902-show-and-tell/topic/roc-pg.20new.20features.20and.20examples.html#350372325">(Apr 16 2023 at 22:32)</a>:</h4>
<p>I could be persuaded into that direction though</p>



<a name="350372691"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/304902-show%20and%20tell/topic/roc-pg%20new%20features%20and%20examples/near/350372691" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Agus Zubiaga <a href="https://roc-lang.github.io/zulip-export/stream/304902-show-and-tell/topic/roc-pg.20new.20features.20and.20examples.html#350372691">(Apr 16 2023 at 22:35)</a>:</h4>
<p>I haven't given much thought to Pooling because there isn't really a concurrency story yet. Although, I wonder if that could be provided by the platform or by a package that isn't specific to PostgreSQL.</p>



<a name="350372919"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/304902-show%20and%20tell/topic/roc-pg%20new%20features%20and%20examples/near/350372919" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Agus Zubiaga <a href="https://roc-lang.github.io/zulip-export/stream/304902-show-and-tell/topic/roc-pg.20new.20features.20and.20examples.html#350372919">(Apr 16 2023 at 22:37)</a>:</h4>
<p>I imagine a platform like Folkert's server might want to be involved in/manage that</p>



<a name="350373663"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/304902-show%20and%20tell/topic/roc-pg%20new%20features%20and%20examples/near/350373663" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Agus Zubiaga <a href="https://roc-lang.github.io/zulip-export/stream/304902-show-and-tell/topic/roc-pg.20new.20features.20and.20examples.html#350373663">(Apr 16 2023 at 22:42)</a>:</h4>
<p>It's a little early to know the right answer for all this stuff, but in the meantime I'm focusing on implementing the protocol, the API, and building things on top of it :)</p>



<a name="350380539"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/304902-show%20and%20tell/topic/roc-pg%20new%20features%20and%20examples/near/350380539" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Georges Boris <a href="https://roc-lang.github.io/zulip-export/stream/304902-show-and-tell/topic/roc-pg.20new.20features.20and.20examples.html#350380539">(Apr 16 2023 at 23:40)</a>:</h4>
<p>I'm so happy for this package to exist so soon <span aria-label="heart" class="emoji emoji-2764" role="img" title="heart">:heart:</span>️</p>
<p>Just a nit if you don't mind. On elixir's ecto we use <code>all</code> and <code>one</code> for the select functions instead of <code>expect1</code> and <code>expectN</code>. It is a bit unusual for me coming from Elm to see functions ending with 1/N.</p>
<p>I think the difference is that the expect is matching the return statement right? so it would work the same for insert/update/delete with returning?</p>
<p>just throwing random naming refactors here:</p>
<div class="codehilite"><pre><span></span><code>archiveUser : Str -&gt; Task {} PgErrors
archiveUser userId =
  query &quot;update users set archived = true where id == $1&quot;
  |&gt; withParams [ userId ]
  |&gt; returningNothing
</code></pre></div>
<div class="codehilite"><pre><span></span><code>archiveUser : Str -&gt; Task Str PgErrors
archiveUser userId =
  query &quot;update users set archived = true where id == $1 returning id&quot;
  |&gt; withParams [ userId ]
  |&gt; returningOne
</code></pre></div>
<div class="codehilite"><pre><span></span><code>archiveUsers : List Str -&gt; Task Str PgErrors
archiveUsers userIds =
  query &quot;update users set archived = true where id in $1 returning id&quot;
  |&gt; withParams [ userIds ]
  |&gt; returningMany
</code></pre></div>
<p>(btw - for this last use case we should probably have some way to bind lists without turning them into strings first? don't know if this is something already in the package! <span aria-label="grinning face with smiling eyes" class="emoji emoji-1f601" role="img" title="grinning face with smiling eyes">:grinning_face_with_smiling_eyes:</span>)</p>



<a name="350381153"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/304902-show%20and%20tell/topic/roc-pg%20new%20features%20and%20examples/near/350381153" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Agus Zubiaga <a href="https://roc-lang.github.io/zulip-export/stream/304902-show-and-tell/topic/roc-pg.20new.20features.20and.20examples.html#350381153">(Apr 16 2023 at 23:47)</a>:</h4>
<p>Oh, calling them “params” instead of “bindings” is a great suggestion! I went a bit too technical there</p>



<a name="350381350"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/304902-show%20and%20tell/topic/roc-pg%20new%20features%20and%20examples/near/350381350" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Agus Zubiaga <a href="https://roc-lang.github.io/zulip-export/stream/304902-show-and-tell/topic/roc-pg.20new.20features.20and.20examples.html#350381350">(Apr 16 2023 at 23:50)</a>:</h4>
<p>As per <code>query</code>, that’s what I started with and I don’t love it because I don’t think of <code>update</code> or <code>insert</code> as queries. So I went with “command” which is what Postgres uses in their  docs.</p>



<a name="350381450"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/304902-show%20and%20tell/topic/roc-pg%20new%20features%20and%20examples/near/350381450" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Agus Zubiaga <a href="https://roc-lang.github.io/zulip-export/stream/304902-show-and-tell/topic/roc-pg.20new.20features.20and.20examples.html#350381450">(Apr 16 2023 at 23:51)</a>:</h4>
<p>The passing lists as parameters is something I’d like to have but I haven't decided how I want to do it. We could expand a binding into many, but that'd require parsing the SQL in Roc. Although, we might want to do that anyway so we can also have named parameters in addition to positional ones (which are the only type natively supported by PostgreSQL).</p>



<a name="350381653"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/304902-show%20and%20tell/topic/roc-pg%20new%20features%20and%20examples/near/350381653" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Agus Zubiaga <a href="https://roc-lang.github.io/zulip-export/stream/304902-show-and-tell/topic/roc-pg.20new.20features.20and.20examples.html#350381653">(Apr 16 2023 at 23:54)</a>:</h4>
<p>I’ll have to think about the <code>returning</code> suggestion. I kinda prefer <code>expect</code> because I don’t want people to think that <code>roc-pg</code> is adding a <code>returning</code> clause for them.</p>



<a name="350381828"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/304902-show%20and%20tell/topic/roc-pg%20new%20features%20and%20examples/near/350381828" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Agus Zubiaga <a href="https://roc-lang.github.io/zulip-export/stream/304902-show-and-tell/topic/roc-pg.20new.20features.20and.20examples.html#350381828">(Apr 16 2023 at 23:56)</a>:</h4>
<p>I agree the <code>N</code> and <code>1</code> suffixes are a little uncommon. I did start with <code>Many</code> and <code>One</code> as you suggested. However, since <code>expectOne</code> asserts that at least one row is returned, it felt like a beginner might think <code>expectMany</code> would fail if &lt;2 rows were returned.</p>



<a name="350382046"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/304902-show%20and%20tell/topic/roc-pg%20new%20features%20and%20examples/near/350382046" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Agus Zubiaga <a href="https://roc-lang.github.io/zulip-export/stream/304902-show-and-tell/topic/roc-pg.20new.20features.20and.20examples.html#350382046">(Apr 16 2023 at 23:59)</a>:</h4>
<p><code>expectOne</code> / <code>expectAll</code> might work though</p>



<a name="350382566"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/304902-show%20and%20tell/topic/roc-pg%20new%20features%20and%20examples/near/350382566" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Agus Zubiaga <a href="https://roc-lang.github.io/zulip-export/stream/304902-show-and-tell/topic/roc-pg.20new.20features.20and.20examples.html#350382566">(Apr 17 2023 at 00:06)</a>:</h4>
<p><code>expectAll</code> makes sense because the argument it takes is a result decoder</p>



<a name="350382662"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/304902-show%20and%20tell/topic/roc-pg%20new%20features%20and%20examples/near/350382662" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Agus Zubiaga <a href="https://roc-lang.github.io/zulip-export/stream/304902-show-and-tell/topic/roc-pg.20new.20features.20and.20examples.html#350382662">(Apr 17 2023 at 00:08)</a>:</h4>
<p>We don’t need something like <code>returningNothing</code> because if you execute a command without an <code>expect</code>, you’ll just get the “undecoded” <code>Pg.Result</code> type which you can use for dynamic use cases</p>



<a name="350385203"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/304902-show%20and%20tell/topic/roc-pg%20new%20features%20and%20examples/near/350385203" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/304902-show-and-tell/topic/roc-pg.20new.20features.20and.20examples.html#350385203">(Apr 17 2023 at 00:38)</a>:</h4>
<p>Just a note: Fundamentally concurrency must be provided by the platform. So the story really has to be built out on platforms and not as part of the roc language. Of course, roc languages changes can make apis more convenient to use.</p>



<a name="350385580"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/304902-show%20and%20tell/topic/roc-pg%20new%20features%20and%20examples/near/350385580" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Agus Zubiaga <a href="https://roc-lang.github.io/zulip-export/stream/304902-show-and-tell/topic/roc-pg.20new.20features.20and.20examples.html#350385580">(Apr 17 2023 at 00:42)</a>:</h4>
<p>Agreed. I meant I haven't seen examples of platforms providing concurrency.</p>



<a name="350385683"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/304902-show%20and%20tell/topic/roc-pg%20new%20features%20and%20examples/near/350385683" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/304902-show-and-tell/topic/roc-pg.20new.20features.20and.20examples.html#350385683">(Apr 17 2023 at 00:43)</a>:</h4>
<p>Yeah, i think all i have seen is a webserver platform that i made a long time ago. It called into a roc request handling function from many threads, but the roc code was still fundamentally unaware of threading. I think we should soon have a lot more power with async rust hosts and the new formulation for hosts.</p>



<a name="350385695"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/304902-show%20and%20tell/topic/roc-pg%20new%20features%20and%20examples/near/350385695" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/304902-show-and-tell/topic/roc-pg.20new.20features.20and.20examples.html#350385695">(Apr 17 2023 at 00:43)</a>:</h4>
<p>But yeah, needs to be built out</p>



<a name="350386072"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/304902-show%20and%20tell/topic/roc-pg%20new%20features%20and%20examples/near/350386072" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Agus Zubiaga <a href="https://roc-lang.github.io/zulip-export/stream/304902-show-and-tell/topic/roc-pg.20new.20features.20and.20examples.html#350386072">(Apr 17 2023 at 00:47)</a>:</h4>
<p>Yeah, looking forward to all that!</p>



<a name="350386624"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/304902-show%20and%20tell/topic/roc-pg%20new%20features%20and%20examples/near/350386624" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/304902-show-and-tell/topic/roc-pg.20new.20features.20and.20examples.html#350386624">(Apr 17 2023 at 00:53)</a>:</h4>
<p>I might try to work on transforming a few platforms soon. Was debating between that or maybe zig glue. Updating platforms so exploration into multi threading and async can be done sounds likely more important. Though might need to expand rust glue before some of it works.</p>



<a name="350388200"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/304902-show%20and%20tell/topic/roc-pg%20new%20features%20and%20examples/near/350388200" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/304902-show-and-tell/topic/roc-pg.20new.20features.20and.20examples.html#350388200">(Apr 17 2023 at 01:09)</a>:</h4>
<p>I think Rust glue is there now, although there may still be a bug relevant to effect interpreters? I forget what the current status of that is, but I think <span class="user-mention" data-user-id="281543">@Folkert de Vries</span> knows!</p>



<a name="350389807"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/304902-show%20and%20tell/topic/roc-pg%20new%20features%20and%20examples/near/350389807" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/304902-show-and-tell/topic/roc-pg.20new.20features.20and.20examples.html#350389807">(Apr 17 2023 at 01:29)</a>:</h4>
<p>Did we finish porting all the tag stuff?</p>



<a name="350452192"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/304902-show%20and%20tell/topic/roc-pg%20new%20features%20and%20examples/near/350452192" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Georges Boris <a href="https://roc-lang.github.io/zulip-export/stream/304902-show-and-tell/topic/roc-pg.20new.20features.20and.20examples.html#350452192">(Apr 17 2023 at 09:18)</a>:</h4>
<p><span class="user-mention silent" data-user-id="489294">Agus Zubiaga</span> <a href="#narrow/stream/304902-show-and-tell/topic/roc-pg.20new.20features.20and.20examples/near/350382662">said</a>:</p>
<blockquote>
<p>We don’t need something like <code>returningNothing</code> because if you execute a command without an <code>expect</code>, you’ll just get the “undecoded” <code>Pg.Result</code> type which you can use for dynamic use cases</p>
</blockquote>
<p>Oh! So in this case the <code>expect</code> is more like a <code>map</code> over the success response?</p>



<a name="350456070"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/304902-show%20and%20tell/topic/roc-pg%20new%20features%20and%20examples/near/350456070" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/304902-show-and-tell/topic/roc-pg.20new.20features.20and.20examples.html#350456070">(Apr 17 2023 at 09:33)</a>:</h4>
<p><span class="user-mention" data-user-id="343810">@Brendan Hansknecht</span> "the tag stuff" is all there, but there is a bug in how we generate the data for glue which means it fails for more complex recursive structures. We also lack glue gen for unsized values. Not sure how big an issue that is right now though, I think we can already do a lot of task stuff without it</p>



<a name="350522732"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/304902-show%20and%20tell/topic/roc-pg%20new%20features%20and%20examples/near/350522732" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Agus Zubiaga <a href="https://roc-lang.github.io/zulip-export/stream/304902-show-and-tell/topic/roc-pg.20new.20features.20and.20examples.html#350522732">(Apr 17 2023 at 13:56)</a>:</h4>
<p><span class="user-mention silent" data-user-id="364014">Georges Boris</span> <a href="#narrow/stream/304902-show-and-tell/topic/roc-pg.20new.20features.20and.20examples/near/350452192">said</a>:</p>
<blockquote>
<p>Oh! So in this case the <code>expect</code> is more like a <code>map</code> over the success response?</p>
</blockquote>
<p>Yeah, somewhat like <code>map</code> but not quite. </p>
<p><code>Pg.Cmd.expect1</code> fails the <code>Task</code> if less than 1 row is returned and  instructs the database to return at most one row even if you didn't add a <code>LIMIT</code> clause (which we can do at the protocol level). </p>
<p>They also explicitly take <code>Pg.Result.Decode</code>, not just any function, I do have <code>Pg.Cmd.map</code> for that but I don't expect people to reach for that often.</p>
<p>The original idea came from <code>elm/http</code>'s <code>expect</code> but adapted to the needs of reading database query results.</p>



<a name="350526054"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/304902-show%20and%20tell/topic/roc-pg%20new%20features%20and%20examples/near/350526054" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Georges Boris <a href="https://roc-lang.github.io/zulip-export/stream/304902-show-and-tell/topic/roc-pg.20new.20features.20and.20examples.html#350526054">(Apr 17 2023 at 14:07)</a>:</h4>
<p>got it! the only that is weird about expect is that in Roc this word is also used for tests so the meaning becomes a bit tied to that imo.</p>



<a name="350527560"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/304902-show%20and%20tell/topic/roc-pg%20new%20features%20and%20examples/near/350527560" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Agus Zubiaga <a href="https://roc-lang.github.io/zulip-export/stream/304902-show-and-tell/topic/roc-pg.20new.20features.20and.20examples.html#350527560">(Apr 17 2023 at 14:13)</a>:</h4>
<p>Yeah, good point. I wonder which other word we could use:</p>
<ul>
<li><code>returning</code> makes it seem like it adds the <code>RETURNING</code> clause</li>
<li><code>decode</code> doesn't quite capture the special logic for <code>expect1</code></li>
</ul>



<a name="350528679"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/304902-show%20and%20tell/topic/roc-pg%20new%20features%20and%20examples/near/350528679" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Agus Zubiaga <a href="https://roc-lang.github.io/zulip-export/stream/304902-show-and-tell/topic/roc-pg.20new.20features.20and.20examples.html#350528679">(Apr 17 2023 at 14:16)</a>:</h4>
<p>Maybe <code>Pg.Cmd.takeOne</code> / <code>Pg.Cmd.takeAll</code>?</p>



<a name="350529307"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/304902-show%20and%20tell/topic/roc-pg%20new%20features%20and%20examples/near/350529307" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Agus Zubiaga <a href="https://roc-lang.github.io/zulip-export/stream/304902-show-and-tell/topic/roc-pg.20new.20features.20and.20examples.html#350529307">(Apr 17 2023 at 14:18)</a>:</h4>
<p>Side note: I wonder if we should have an <code>#api design</code> stream</p>



<a name="350535099"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/304902-show%20and%20tell/topic/roc-pg%20new%20features%20and%20examples/near/350535099" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/304902-show-and-tell/topic/roc-pg.20new.20features.20and.20examples.html#350535099">(Apr 17 2023 at 14:37)</a>:</h4>
<p>good idea! Now we do: <a class="stream" data-stream-id="383402" href="/#narrow/stream/383402-API-Design">#API Design</a></p>



<hr><p>Last updated: Nov 01 2025 at 12:13 UTC</p>
</html>