<html>
<head><meta charset="utf-8"><title>Are the collection types (List, Set, Dict) immutable? · beginners · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/index.html">beginners</a></h2>
<h3>Topic: <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Are.20the.20collection.20types.20.28List.2C.20Set.2C.20Dict.29.20immutable.3F.html">Are the collection types (List, Set, Dict) immutable?</a></h3>

<hr>

<base href="https://roc.zulipchat.com">

<head><link href="https://roc-lang.github.io/zulip-export/style.css" rel="stylesheet"></head>

<a name="441950584"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Are%20the%20collection%20types%20%28List%2C%20Set%2C%20Dict%29%20immutable%3F/near/441950584" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dimitrios Piliouras <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Are.20the.20collection.20types.20.28List.2C.20Set.2C.20Dict.29.20immutable.3F.html#441950584">(Jun 01 2024 at 19:16)</a>:</h4>
<p>Or where could I find more info about how they work/perform?</p>



<a name="441958096"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Are%20the%20collection%20types%20%28List%2C%20Set%2C%20Dict%29%20immutable%3F/near/441958096" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sven van Caem <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Are.20the.20collection.20types.20.28List.2C.20Set.2C.20Dict.29.20immutable.3F.html#441958096">(Jun 01 2024 at 20:17)</a>:</h4>
<p>I believe the important thing to know is that Roc will by default clone a collection when it is modified, unless the reference count is exactly 1, in which case it will mutate a collection in place. The Roc team is making the bet that the latter case will occur more often than the former. With this in mind, the List type (as I understand it) works just like a C++ vector/Rust Vec does, in that it allocates its elements contiguously on the heap instead of allocating each element separately in a linked list. The Dict and Set types are both index maps under the hood, backed by a List.</p>



<a name="441965430"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Are%20the%20collection%20types%20%28List%2C%20Set%2C%20Dict%29%20immutable%3F/near/441965430" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Are.20the.20collection.20types.20.28List.2C.20Set.2C.20Dict.29.20immutable.3F.html#441965430">(Jun 01 2024 at 21:17)</a>:</h4>
<p>That is a very good summary</p>



<a name="441969241"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Are%20the%20collection%20types%20%28List%2C%20Set%2C%20Dict%29%20immutable%3F/near/441969241" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dimitrios Piliouras <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Are.20the.20collection.20types.20.28List.2C.20Set.2C.20Dict.29.20immutable.3F.html#441969241">(Jun 01 2024 at 21:48)</a>:</h4>
<p>nice one thanks - just to clarify, when you say 'clone',  you mean a full/deep copy? no fancy structural-sharing  or anything, right?</p>



<a name="441969727"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Are%20the%20collection%20types%20%28List%2C%20Set%2C%20Dict%29%20immutable%3F/near/441969727" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Are.20the.20collection.20types.20.28List.2C.20Set.2C.20Dict.29.20immutable.3F.html#441969727">(Jun 01 2024 at 21:51)</a>:</h4>
<p>yep, deep copy.</p>



<a name="441969829"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Are%20the%20collection%20types%20%28List%2C%20Set%2C%20Dict%29%20immutable%3F/near/441969829" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Are.20the.20collection.20types.20.28List.2C.20Set.2C.20Dict.29.20immutable.3F.html#441969829">(Jun 01 2024 at 21:51)</a>:</h4>
<p>In practice when code is written well, this will almost never happen. That said, today, there are more sharp edges than we would like.</p>



<a name="441972150"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Are%20the%20collection%20types%20%28List%2C%20Set%2C%20Dict%29%20immutable%3F/near/441972150" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dimitrios Piliouras <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Are.20the.20collection.20types.20.28List.2C.20Set.2C.20Dict.29.20immutable.3F.html#441972150">(Jun 01 2024 at 22:04)</a>:</h4>
<p>this may be slightly off-topic, but if a web-server platform which depends on <code>tokio</code> can exist, I am wondering, can an immutable platform exist making use of something like <a href="https://docs.rs/im/latest/im/">this</a> ?</p>



<a name="441972220"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Are%20the%20collection%20types%20%28List%2C%20Set%2C%20Dict%29%20immutable%3F/near/441972220" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dimitrios Piliouras <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Are.20the.20collection.20types.20.28List.2C.20Set.2C.20Dict.29.20immutable.3F.html#441972220">(Jun 01 2024 at 22:04)</a>:</h4>
<p>ah nevermind, that's a stupid question...the platform is for side-effects</p>



<a name="441972306"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Are%20the%20collection%20types%20%28List%2C%20Set%2C%20Dict%29%20immutable%3F/near/441972306" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Are.20the.20collection.20types.20.28List.2C.20Set.2C.20Dict.29.20immutable.3F.html#441972306">(Jun 01 2024 at 22:05)</a>:</h4>
<p>One could build an immutable data structure library in roc using tags (many immutable data structures are really just forms of trees)</p>



<a name="441972511"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Are%20the%20collection%20types%20%28List%2C%20Set%2C%20Dict%29%20immutable%3F/near/441972511" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Are.20the.20collection.20types.20.28List.2C.20Set.2C.20Dict.29.20immutable.3F.html#441972511">(Jun 01 2024 at 22:06)</a>:</h4>
<p>So while roc doesn't have any of these today, and the standard library likely never will. Should be 100% supportable in userland</p>



<a name="441972928"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Are%20the%20collection%20types%20%28List%2C%20Set%2C%20Dict%29%20immutable%3F/near/441972928" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Are.20the.20collection.20types.20.28List.2C.20Set.2C.20Dict.29.20immutable.3F.html#441972928">(Jun 01 2024 at 22:09)</a>:</h4>
<p>Roc is intentionally testing a hypothesis that traditional mutable data structures can be performant in an immutable language due to most data being unique if it might be modified. If the data is shared, it is likely to not be modified.</p>
<p>This hypothesis is kinda tested by the rust borrow checker. Which is why we have reasonable faith that this should work out in practice (though maybe require some code rewriting to avoid accidental sharing of something that might be mutated)</p>



<a name="441973097"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Are%20the%20collection%20types%20%28List%2C%20Set%2C%20Dict%29%20immutable%3F/near/441973097" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Are.20the.20collection.20types.20.28List.2C.20Set.2C.20Dict.29.20immutable.3F.html#441973097">(Jun 01 2024 at 22:10)</a>:</h4>
<p>On top of that, many immutable data structures end up having a lot of costs that add up over time due to the large amount of extra pointer chancing and fragmentation. So a few dense copies might actually be faster than using an immutable data structure.</p>



<a name="441973288"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Are%20the%20collection%20types%20%28List%2C%20Set%2C%20Dict%29%20immutable%3F/near/441973288" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Are.20the.20collection.20types.20.28List.2C.20Set.2C.20Dict.29.20immutable.3F.html#441973288">(Jun 01 2024 at 22:12)</a>:</h4>
<p>Of course, there is a line here where at some point the number of copies ends up costing more than the cost of having an immutable data structure. Generally well written code can avoid essentially all copies. When that happens, we get significantly more perf than an immutable data structure could ever hope to accomplish.</p>



<a name="441973388"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Are%20the%20collection%20types%20%28List%2C%20Set%2C%20Dict%29%20immutable%3F/near/441973388" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Are.20the.20collection.20types.20.28List.2C.20Set.2C.20Dict.29.20immutable.3F.html#441973388">(Jun 01 2024 at 22:12)</a>:</h4>
<p>Of course roc is young and we still have many more sharp edges. For example, we currently have some known refcounting cases that totally destroy performance.</p>



<a name="441973693"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Are%20the%20collection%20types%20%28List%2C%20Set%2C%20Dict%29%20immutable%3F/near/441973693" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dimitrios Piliouras <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Are.20the.20collection.20types.20.28List.2C.20Set.2C.20Dict.29.20immutable.3F.html#441973693">(Jun 01 2024 at 22:15)</a>:</h4>
<p>sure, what you say is true, programs built around immutable data-structures aim mainly for correctness, rather than performance, however when you throw multi-threading into the mix the scales starts to shift.</p>



<a name="441973797"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Are%20the%20collection%20types%20%28List%2C%20Set%2C%20Dict%29%20immutable%3F/near/441973797" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dimitrios Piliouras <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Are.20the.20collection.20types.20.28List.2C.20Set.2C.20Dict.29.20immutable.3F.html#441973797">(Jun 01 2024 at 22:15)</a>:</h4>
<p>it actually more costly to copy or even lock/unlock a mutable data-structure across many threads</p>



<a name="441973931"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Are%20the%20collection%20types%20%28List%2C%20Set%2C%20Dict%29%20immutable%3F/near/441973931" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dimitrios Piliouras <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Are.20the.20collection.20types.20.28List.2C.20Set.2C.20Dict.29.20immutable.3F.html#441973931">(Jun 01 2024 at 22:16)</a>:</h4>
<p>anyway, I get your point - i don't want to side-track this thread</p>



<a name="441974170"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Are%20the%20collection%20types%20%28List%2C%20Set%2C%20Dict%29%20immutable%3F/near/441974170" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Are.20the.20collection.20types.20.28List.2C.20Set.2C.20Dict.29.20immutable.3F.html#441974170">(Jun 01 2024 at 22:18)</a>:</h4>
<p>No worries side tracking is great for discussion. And yeah, multithreading can get a lot more complex. Currently Roc has not really touched that world. Anything that exist today and is multithread (like basic webserver) basically spawn N unique roc threads with no way to share or communicate.</p>



<a name="441974260"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Are%20the%20collection%20types%20%28List%2C%20Set%2C%20Dict%29%20immutable%3F/near/441974260" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dimitrios Piliouras <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Are.20the.20collection.20types.20.28List.2C.20Set.2C.20Dict.29.20immutable.3F.html#441974260">(Jun 01 2024 at 22:18)</a>:</h4>
<p>oh i see</p>



<a name="441974695"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Are%20the%20collection%20types%20%28List%2C%20Set%2C%20Dict%29%20immutable%3F/near/441974695" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dimitrios Piliouras <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Are.20the.20collection.20types.20.28List.2C.20Set.2C.20Dict.29.20immutable.3F.html#441974695">(Jun 01 2024 at 22:21)</a>:</h4>
<p>well if you like discussion, I personally am 100% sold on immutability...of course, i do understand the performance cost, but I value the benefits so much more...and by the way, opportunistic mutation, can still be available.</p>



<a name="441974905"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Are%20the%20collection%20types%20%28List%2C%20Set%2C%20Dict%29%20immutable%3F/near/441974905" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dimitrios Piliouras <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Are.20the.20collection.20types.20.28List.2C.20Set.2C.20Dict.29.20immutable.3F.html#441974905">(Jun 01 2024 at 22:22)</a>:</h4>
<p>in fact with immutable data the opportunity for opportunistic mutation is much greater :)</p>



<a name="441975227"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Are%20the%20collection%20types%20%28List%2C%20Set%2C%20Dict%29%20immutable%3F/near/441975227" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Are.20the.20collection.20types.20.28List.2C.20Set.2C.20Dict.29.20immutable.3F.html#441975227">(Jun 01 2024 at 22:26)</a>:</h4>
<p>I'm curious the use case for a shared across threads immutable data structures. As in, if it is truly immutable data, then it really doesn't matter how it is stored. It is read only. If it needs global mutation that will be visible to all threads, I don't think immutable data structures allow for that. I guess you could modify then data structure in one thread and the message the updated data structure to all other threads? (that sounds like a big synchronization problem)</p>
<p>Generally speaking, I don't see many use cases where you have a global structure that every thread will have their own modified version of.</p>



<a name="441975592"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Are%20the%20collection%20types%20%28List%2C%20Set%2C%20Dict%29%20immutable%3F/near/441975592" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dimitrios Piliouras <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Are.20the.20collection.20types.20.28List.2C.20Set.2C.20Dict.29.20immutable.3F.html#441975592">(Jun 01 2024 at 22:29)</a>:</h4>
<p>immutable data is and stays immutable forever - 'changing' them produces a new value, so it doesn't matter which function or  thread you're in. You received an immutable vector as a param? You can be confident that it's not going to change under your feet...</p>



<a name="441975720"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Are%20the%20collection%20types%20%28List%2C%20Set%2C%20Dict%29%20immutable%3F/near/441975720" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Are.20the.20collection.20types.20.28List.2C.20Set.2C.20Dict.29.20immutable.3F.html#441975720">(Jun 01 2024 at 22:30)</a>:</h4>
<p>Yes, they are additive.</p>



<a name="441975726"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Are%20the%20collection%20types%20%28List%2C%20Set%2C%20Dict%29%20immutable%3F/near/441975726" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dimitrios Piliouras <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Are.20the.20collection.20types.20.28List.2C.20Set.2C.20Dict.29.20immutable.3F.html#441975726">(Jun 01 2024 at 22:30)</a>:</h4>
<p>now, if the opportunistic mutation bit confuses you, have a look at <a href="https://docs.rs/im/latest/im/#in-place-mutation">this</a></p>



<a name="441975788"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Are%20the%20collection%20types%20%28List%2C%20Set%2C%20Dict%29%20immutable%3F/near/441975788" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dimitrios Piliouras <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Are.20the.20collection.20types.20.28List.2C.20Set.2C.20Dict.29.20immutable.3F.html#441975788">(Jun 01 2024 at 22:30)</a>:</h4>
<p>basically, you can create a 'transient' version of them in constant time, mutate it to death, and 'commit' it</p>



<a name="441975825"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Are%20the%20collection%20types%20%28List%2C%20Set%2C%20Dict%29%20immutable%3F/near/441975825" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Are.20the.20collection.20types.20.28List.2C.20Set.2C.20Dict.29.20immutable.3F.html#441975825">(Jun 01 2024 at 22:31)</a>:</h4>
<p>I guess the general update structure would be that you are passed in the most up to date version of the immutable data structure. Then you can return a list of modifications and they will be synchronously applied to the data structure such then other threads can later see the change?</p>



<a name="441975858"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Are%20the%20collection%20types%20%28List%2C%20Set%2C%20Dict%29%20immutable%3F/near/441975858" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dimitrios Piliouras <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Are.20the.20collection.20types.20.28List.2C.20Set.2C.20Dict.29.20immutable.3F.html#441975858">(Jun 01 2024 at 22:31)</a>:</h4>
<p>no no no</p>



<a name="441975891"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Are%20the%20collection%20types%20%28List%2C%20Set%2C%20Dict%29%20immutable%3F/near/441975891" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dimitrios Piliouras <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Are.20the.20collection.20types.20.28List.2C.20Set.2C.20Dict.29.20immutable.3F.html#441975891">(Jun 01 2024 at 22:32)</a>:</h4>
<p>there are no updates that other threads can see</p>



<a name="441975964"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Are%20the%20collection%20types%20%28List%2C%20Set%2C%20Dict%29%20immutable%3F/near/441975964" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dimitrios Piliouras <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Are.20the.20collection.20types.20.28List.2C.20Set.2C.20Dict.29.20immutable.3F.html#441975964">(Jun 01 2024 at 22:32)</a>:</h4>
<p>in fact there is no update-in-place</p>



<a name="441975989"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Are%20the%20collection%20types%20%28List%2C%20Set%2C%20Dict%29%20immutable%3F/near/441975989" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dimitrios Piliouras <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Are.20the.20collection.20types.20.28List.2C.20Set.2C.20Dict.29.20immutable.3F.html#441975989">(Jun 01 2024 at 22:32)</a>:</h4>
<p>i see what confuses you</p>



<a name="441976014"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Are%20the%20collection%20types%20%28List%2C%20Set%2C%20Dict%29%20immutable%3F/near/441976014" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Are.20the.20collection.20types.20.28List.2C.20Set.2C.20Dict.29.20immutable.3F.html#441976014">(Jun 01 2024 at 22:32)</a>:</h4>
<p>I know that none of it is inplace. Just trying to understand how this fixes shared information across threads</p>



<a name="441976079"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Are%20the%20collection%20types%20%28List%2C%20Set%2C%20Dict%29%20immutable%3F/near/441976079" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Are.20the.20collection.20types.20.28List.2C.20Set.2C.20Dict.29.20immutable.3F.html#441976079">(Jun 01 2024 at 22:33)</a>:</h4>
<p>Generally speaking, there aren't many problems where I want every thread to have their own unique view of data. Generally at some point, I want the global view to be updated</p>



<a name="441976093"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Are%20the%20collection%20types%20%28List%2C%20Set%2C%20Dict%29%20immutable%3F/near/441976093" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dimitrios Piliouras <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Are.20the.20collection.20types.20.28List.2C.20Set.2C.20Dict.29.20immutable.3F.html#441976093">(Jun 01 2024 at 22:33)</a>:</h4>
<p>sharing information across threads is done by modelling time</p>



<a name="441976150"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Are%20the%20collection%20types%20%28List%2C%20Set%2C%20Dict%29%20immutable%3F/near/441976150" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dimitrios Piliouras <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Are.20the.20collection.20types.20.28List.2C.20Set.2C.20Dict.29.20immutable.3F.html#441976150">(Jun 01 2024 at 22:34)</a>:</h4>
<p>and time is best modelled by immutable data</p>



<a name="441976163"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Are%20the%20collection%20types%20%28List%2C%20Set%2C%20Dict%29%20immutable%3F/near/441976163" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dimitrios Piliouras <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Are.20the.20collection.20types.20.28List.2C.20Set.2C.20Dict.29.20immutable.3F.html#441976163">(Jun 01 2024 at 22:34)</a>:</h4>
<p>so that you can take stable snapshots</p>



<a name="441976232"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Are%20the%20collection%20types%20%28List%2C%20Set%2C%20Dict%29%20immutable%3F/near/441976232" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dimitrios Piliouras <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Are.20the.20collection.20types.20.28List.2C.20Set.2C.20Dict.29.20immutable.3F.html#441976232">(Jun 01 2024 at 22:35)</a>:</h4>
<p>this is the most concise sentence i can give you. For more information if that topic intrigues you, you really want to look at clojure's reference types</p>



<a name="441976265"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Are%20the%20collection%20types%20%28List%2C%20Set%2C%20Dict%29%20immutable%3F/near/441976265" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dimitrios Piliouras <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Are.20the.20collection.20types.20.28List.2C.20Set.2C.20Dict.29.20immutable.3F.html#441976265">(Jun 01 2024 at 22:35)</a>:</h4>
<p>these are constructs that model time</p>



<a name="441976359"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Are%20the%20collection%20types%20%28List%2C%20Set%2C%20Dict%29%20immutable%3F/near/441976359" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Are.20the.20collection.20types.20.28List.2C.20Set.2C.20Dict.29.20immutable.3F.html#441976359">(Jun 01 2024 at 22:36)</a>:</h4>
<p>Can we get concrete? What is a simple example of a threaded use case that benefits from immutable data structures?</p>



<a name="441976369"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Are%20the%20collection%20types%20%28List%2C%20Set%2C%20Dict%29%20immutable%3F/near/441976369" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dimitrios Piliouras <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Are.20the.20collection.20types.20.28List.2C.20Set.2C.20Dict.29.20immutable.3F.html#441976369">(Jun 01 2024 at 22:36)</a>:</h4>
<p>there are 4 of them with different semantics - e.g. synchronous, asynchronous, transactional etc</p>



<a name="441976662"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Are%20the%20collection%20types%20%28List%2C%20Set%2C%20Dict%29%20immutable%3F/near/441976662" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dimitrios Piliouras <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Are.20the.20collection.20types.20.28List.2C.20Set.2C.20Dict.29.20immutable.3F.html#441976662">(Jun 01 2024 at 22:39)</a>:</h4>
<p>the benefit is that you don't mutate the data-structure - you mutate the 'box' around it, and that is managed and comes with specific semantics and guarrantees that it couldn't make if the data was mutable</p>



<a name="441976799"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Are%20the%20collection%20types%20%28List%2C%20Set%2C%20Dict%29%20immutable%3F/near/441976799" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dimitrios Piliouras <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Are.20the.20collection.20types.20.28List.2C.20Set.2C.20Dict.29.20immutable.3F.html#441976799">(Jun 01 2024 at 22:40)</a>:</h4>
<p>this may not sound like much but it's actually profound, because as I said, it lets you model time, which is super important in a multi-threads situation</p>



<a name="441976892"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Are%20the%20collection%20types%20%28List%2C%20Set%2C%20Dict%29%20immutable%3F/near/441976892" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dimitrios Piliouras <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Are.20the.20collection.20types.20.28List.2C.20Set.2C.20Dict.29.20immutable.3F.html#441976892">(Jun 01 2024 at 22:41)</a>:</h4>
<p>there is no time in a pure function but there is time in real programs</p>



<a name="441977287"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Are%20the%20collection%20types%20%28List%2C%20Set%2C%20Dict%29%20immutable%3F/near/441977287" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Are.20the.20collection.20types.20.28List.2C.20Set.2C.20Dict.29.20immutable.3F.html#441977287">(Jun 01 2024 at 22:44)</a>:</h4>
<p>Ah, looking at <code>clojure.core/ref</code> in closure and <code>clojure.core/dosync</code> is making it clearer how closure decides to model things.</p>
<p>If I had a shared cache that was an immutable data structure represented as a ref. To read from the cache would be to deref and just directly use the data structure. To update the cache would be to additively change the data structure (because it is an immutable data structure that does not change inplace), then update all pointers to the data structure to the pointer to the new version. This can be done in an atomic commit to avoid other forms of thread synchronization.</p>



<a name="441977291"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Are%20the%20collection%20types%20%28List%2C%20Set%2C%20Dict%29%20immutable%3F/near/441977291" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dimitrios Piliouras <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Are.20the.20collection.20types.20.28List.2C.20Set.2C.20Dict.29.20immutable.3F.html#441977291">(Jun 01 2024 at 22:44)</a>:</h4>
<p>let me give you the simplest possible example - i will presume total unfamiliarity with clojure</p>



<a name="441977351"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Are%20the%20collection%20types%20%28List%2C%20Set%2C%20Dict%29%20immutable%3F/near/441977351" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dimitrios Piliouras <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Are.20the.20collection.20types.20.28List.2C.20Set.2C.20Dict.29.20immutable.3F.html#441977351">(Jun 01 2024 at 22:44)</a>:</h4>
<p>exactly! you picked the hardest one though which is rarely used</p>



<a name="441977420"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Are%20the%20collection%20types%20%28List%2C%20Set%2C%20Dict%29%20immutable%3F/near/441977420" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dimitrios Piliouras <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Are.20the.20collection.20types.20.28List.2C.20Set.2C.20Dict.29.20immutable.3F.html#441977420">(Jun 01 2024 at 22:45)</a>:</h4>
<p>the simplest one is the <code>atom</code>, which the standard way of achieving mutation</p>



<a name="441977490"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Are%20the%20collection%20types%20%28List%2C%20Set%2C%20Dict%29%20immutable%3F/near/441977490" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dimitrios Piliouras <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Are.20the.20collection.20types.20.28List.2C.20Set.2C.20Dict.29.20immutable.3F.html#441977490">(Jun 01 2024 at 22:45)</a>:</h4>
<p>atom comes with two guarrantees - atomicity + synchronicity (i.e. blocking)</p>



<a name="441977550"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Are%20the%20collection%20types%20%28List%2C%20Set%2C%20Dict%29%20immutable%3F/near/441977550" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Are.20the.20collection.20types.20.28List.2C.20Set.2C.20Dict.29.20immutable.3F.html#441977550">(Jun 01 2024 at 22:46)</a>:</h4>
<p>Are atoms limited to basic values like numbers or do they allow for more complex types?</p>



<a name="441977572"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Are%20the%20collection%20types%20%28List%2C%20Set%2C%20Dict%29%20immutable%3F/near/441977572" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dimitrios Piliouras <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Are.20the.20collection.20types.20.28List.2C.20Set.2C.20Dict.29.20immutable.3F.html#441977572">(Jun 01 2024 at 22:46)</a>:</h4>
<p>anything immutable goes</p>



<a name="441977588"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Are%20the%20collection%20types%20%28List%2C%20Set%2C%20Dict%29%20immutable%3F/near/441977588" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Are.20the.20collection.20types.20.28List.2C.20Set.2C.20Dict.29.20immutable.3F.html#441977588">(Jun 01 2024 at 22:46)</a>:</h4>
<p>ok</p>



<a name="441977590"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Are%20the%20collection%20types%20%28List%2C%20Set%2C%20Dict%29%20immutable%3F/near/441977590" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Are.20the.20collection.20types.20.28List.2C.20Set.2C.20Dict.29.20immutable.3F.html#441977590">(Jun 01 2024 at 22:46)</a>:</h4>
<p>interesting</p>



<a name="441977601"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Are%20the%20collection%20types%20%28List%2C%20Set%2C%20Dict%29%20immutable%3F/near/441977601" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dimitrios Piliouras <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Are.20the.20collection.20types.20.28List.2C.20Set.2C.20Dict.29.20immutable.3F.html#441977601">(Jun 01 2024 at 22:46)</a>:</h4>
<p>hasmaps, vectors etc</p>



<a name="441977624"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Are%20the%20collection%20types%20%28List%2C%20Set%2C%20Dict%29%20immutable%3F/near/441977624" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dimitrios Piliouras <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Are.20the.20collection.20types.20.28List.2C.20Set.2C.20Dict.29.20immutable.3F.html#441977624">(Jun 01 2024 at 22:46)</a>:</h4>
<p>deeply nested whatever</p>



<a name="441977643"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Are%20the%20collection%20types%20%28List%2C%20Set%2C%20Dict%29%20immutable%3F/near/441977643" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dimitrios Piliouras <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Are.20the.20collection.20types.20.28List.2C.20Set.2C.20Dict.29.20immutable.3F.html#441977643">(Jun 01 2024 at 22:46)</a>:</h4>
<p>they cost nothing to comapre</p>



<a name="441977742"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Are%20the%20collection%20types%20%28List%2C%20Set%2C%20Dict%29%20immutable%3F/near/441977742" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dimitrios Piliouras <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Are.20the.20collection.20types.20.28List.2C.20Set.2C.20Dict.29.20immutable.3F.html#441977742">(Jun 01 2024 at 22:47)</a>:</h4>
<p>in clojure, you really have to go out of your way to mutate something w/o some sort of synchronisation</p>



<a name="441977783"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Are%20the%20collection%20types%20%28List%2C%20Set%2C%20Dict%29%20immutable%3F/near/441977783" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dimitrios Piliouras <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Are.20the.20collection.20types.20.28List.2C.20Set.2C.20Dict.29.20immutable.3F.html#441977783">(Jun 01 2024 at 22:47)</a>:</h4>
<p>there is a way, but is more like the <code>Unsafe</code> in java</p>



<a name="441977854"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Are%20the%20collection%20types%20%28List%2C%20Set%2C%20Dict%29%20immutable%3F/near/441977854" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dimitrios Piliouras <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Are.20the.20collection.20types.20.28List.2C.20Set.2C.20Dict.29.20immutable.3F.html#441977854">(Jun 01 2024 at 22:48)</a>:</h4>
<p>highly discouraged</p>



<a name="441977881"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Are%20the%20collection%20types%20%28List%2C%20Set%2C%20Dict%29%20immutable%3F/near/441977881" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Are.20the.20collection.20types.20.28List.2C.20Set.2C.20Dict.29.20immutable.3F.html#441977881">(Jun 01 2024 at 22:48)</a>:</h4>
<p>Yeah, interesting that the closure swap for atoms takes a function.</p>



<a name="441977966"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Are%20the%20collection%20types%20%28List%2C%20Set%2C%20Dict%29%20immutable%3F/near/441977966" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dimitrios Piliouras <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Are.20the.20collection.20types.20.28List.2C.20Set.2C.20Dict.29.20immutable.3F.html#441977966">(Jun 01 2024 at 22:49)</a>:</h4>
<p>but guess what? very rarely you end up needing these types</p>



<a name="441978025"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Are%20the%20collection%20types%20%28List%2C%20Set%2C%20Dict%29%20immutable%3F/near/441978025" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dimitrios Piliouras <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Are.20the.20collection.20types.20.28List.2C.20Set.2C.20Dict.29.20immutable.3F.html#441978025">(Jun 01 2024 at 22:49)</a>:</h4>
<p>what else could it take? a function of the current value</p>



<a name="441978051"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Are%20the%20collection%20types%20%28List%2C%20Set%2C%20Dict%29%20immutable%3F/near/441978051" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Are.20the.20collection.20types.20.28List.2C.20Set.2C.20Dict.29.20immutable.3F.html#441978051">(Jun 01 2024 at 22:49)</a>:</h4>
<p>But I guess makes sense cause it can linearize calls for synchronoziation and avoid race conditions.</p>



<a name="441978179"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Are%20the%20collection%20types%20%28List%2C%20Set%2C%20Dict%29%20immutable%3F/near/441978179" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dimitrios Piliouras <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Are.20the.20collection.20types.20.28List.2C.20Set.2C.20Dict.29.20immutable.3F.html#441978179">(Jun 01 2024 at 22:50)</a>:</h4>
<p>exactly</p>



<a name="441978259"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Are%20the%20collection%20types%20%28List%2C%20Set%2C%20Dict%29%20immutable%3F/near/441978259" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Are.20the.20collection.20types.20.28List.2C.20Set.2C.20Dict.29.20immutable.3F.html#441978259">(Jun 01 2024 at 22:50)</a>:</h4>
<p>I think most of this could be represented in roc with a immutable data structure library built on tags. The only special part is that the atom/ref functions would be required to be implemented in the platform.</p>



<a name="441978321"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Are%20the%20collection%20types%20%28List%2C%20Set%2C%20Dict%29%20immutable%3F/near/441978321" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Are.20the.20collection.20types.20.28List.2C.20Set.2C.20Dict.29.20immutable.3F.html#441978321">(Jun 01 2024 at 22:51)</a>:</h4>
<p>So I think roc could have both.</p>



<a name="441978345"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Are%20the%20collection%20types%20%28List%2C%20Set%2C%20Dict%29%20immutable%3F/near/441978345" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dimitrios Piliouras <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Are.20the.20collection.20types.20.28List.2C.20Set.2C.20Dict.29.20immutable.3F.html#441978345">(Jun 01 2024 at 22:51)</a>:</h4>
<p>interesting</p>



<a name="441978531"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Are%20the%20collection%20types%20%28List%2C%20Set%2C%20Dict%29%20immutable%3F/near/441978531" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dimitrios Piliouras <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Are.20the.20collection.20types.20.28List.2C.20Set.2C.20Dict.29.20immutable.3F.html#441978531">(Jun 01 2024 at 22:53)</a>:</h4>
<p>just to clarify what i meant by modelling time</p>



<a name="441978550"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Are%20the%20collection%20types%20%28List%2C%20Set%2C%20Dict%29%20immutable%3F/near/441978550" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dimitrios Piliouras <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Are.20the.20collection.20types.20.28List.2C.20Set.2C.20Dict.29.20immutable.3F.html#441978550">(Jun 01 2024 at 22:53)</a>:</h4>
<p>the future is a function of the past, right?</p>



<a name="441978652"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Are%20the%20collection%20types%20%28List%2C%20Set%2C%20Dict%29%20immutable%3F/near/441978652" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dimitrios Piliouras <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Are.20the.20collection.20types.20.28List.2C.20Set.2C.20Dict.29.20immutable.3F.html#441978652">(Jun 01 2024 at 22:54)</a>:</h4>
<p>so you will notice that all reference types in clojure have some sort of update function associated with them, but they all look the same same in terms of function-signature</p>



<a name="441978720"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Are%20the%20collection%20types%20%28List%2C%20Set%2C%20Dict%29%20immutable%3F/near/441978720" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dimitrios Piliouras <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Are.20the.20collection.20types.20.28List.2C.20Set.2C.20Dict.29.20immutable.3F.html#441978720">(Jun 01 2024 at 22:54)</a>:</h4>
<p>they all take a function which accepts the current value (the past), and will produce the next value (the future)</p>



<a name="441978863"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Are%20the%20collection%20types%20%28List%2C%20Set%2C%20Dict%29%20immutable%3F/near/441978863" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dimitrios Piliouras <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Are.20the.20collection.20types.20.28List.2C.20Set.2C.20Dict.29.20immutable.3F.html#441978863">(Jun 01 2024 at 22:56)</a>:</h4>
<p>they all have different semantics with respect to their operation, but they all obey the epochal time model i mentioned above</p>



<a name="441978926"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Are%20the%20collection%20types%20%28List%2C%20Set%2C%20Dict%29%20immutable%3F/near/441978926" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dimitrios Piliouras <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Are.20the.20collection.20types.20.28List.2C.20Set.2C.20Dict.29.20immutable.3F.html#441978926">(Jun 01 2024 at 22:56)</a>:</h4>
<p>once you have a time model, multi-threading is a breeze</p>



<a name="441979046"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Are%20the%20collection%20types%20%28List%2C%20Set%2C%20Dict%29%20immutable%3F/near/441979046" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dimitrios Piliouras <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Are.20the.20collection.20types.20.28List.2C.20Set.2C.20Dict.29.20immutable.3F.html#441979046">(Jun 01 2024 at 22:58)</a>:</h4>
<p>hope that makes sense</p>



<a name="441979639"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Are%20the%20collection%20types%20%28List%2C%20Set%2C%20Dict%29%20immutable%3F/near/441979639" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dimitrios Piliouras <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Are.20the.20collection.20types.20.28List.2C.20Set.2C.20Dict.29.20immutable.3F.html#441979639">(Jun 01 2024 at 23:02)</a>:</h4>
<p>by the way, the stuff i said about transients earlier, don't apply to multi-threading at all! Mutating a transient value should only ever be done in one thread and should almost always be scoped  - i.e. not leak it for further mutation upstream, although  exceptions can exist.</p>



<a name="441980136"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Are%20the%20collection%20types%20%28List%2C%20Set%2C%20Dict%29%20immutable%3F/near/441980136" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Are.20the.20collection.20types.20.28List.2C.20Set.2C.20Dict.29.20immutable.3F.html#441980136">(Jun 01 2024 at 23:06)</a>:</h4>
<p>Yeah totally does.</p>
<p>Looking some at the underlying implementations, two main costs come to mind:</p>
<ol>
<li>lots of pointers and potentially scatter memory that mean more cache misses (not friendly to the cpu, but smarter immutable data structures do work to be at least slightly denser).</li>
<li>built on top of compare and swap atomics. In the bad case of atomic swap, the update function could be stuck running on repeat wasting a ton of extra cpu. If for example, 4 threads all try to swap the atomic at the same time with an expensive swap function, you will get a ton of wasted cpu. All 4 threads run the expensive function. only 1 succeeds and updates the underlying atomic references. Then the 3 remaining threads repeat. Then the remaining 2. Then the single final thread. So in the really pessimistic case instead of doing 4 updates worth of work, you have done 4 + 3 + 2 +1 = 10 updates worth of work.</li>
</ol>



<a name="441980554"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Are%20the%20collection%20types%20%28List%2C%20Set%2C%20Dict%29%20immutable%3F/near/441980554" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dimitrios Piliouras <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Are.20the.20collection.20types.20.28List.2C.20Set.2C.20Dict.29.20immutable.3F.html#441980554">(Jun 01 2024 at 23:09)</a>:</h4>
<p>yes indeed lock contention is always the problem isn't it? :) that's exactly why modelling time in a pluggable fashion is so important</p>



<a name="441980684"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Are%20the%20collection%20types%20%28List%2C%20Set%2C%20Dict%29%20immutable%3F/near/441980684" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dimitrios Piliouras <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Are.20the.20collection.20types.20.28List.2C.20Set.2C.20Dict.29.20immutable.3F.html#441980684">(Jun 01 2024 at 23:10)</a>:</h4>
<p>compare the difference between <code>atom</code> VS <code>agent</code> - different approaches: cas VS queueing</p>



<a name="441980737"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Are%20the%20collection%20types%20%28List%2C%20Set%2C%20Dict%29%20immutable%3F/near/441980737" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Are.20the.20collection.20types.20.28List.2C.20Set.2C.20Dict.29.20immutable.3F.html#441980737">(Jun 01 2024 at 23:11)</a>:</h4>
<p>This isn't technically lock contention, but yeah, just noting the edge cases.</p>



<a name="441980764"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Are%20the%20collection%20types%20%28List%2C%20Set%2C%20Dict%29%20immutable%3F/near/441980764" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Are.20the.20collection.20types.20.28List.2C.20Set.2C.20Dict.29.20immutable.3F.html#441980764">(Jun 01 2024 at 23:11)</a>:</h4>
<p>and general tradeoffs</p>



<a name="441980847"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Are%20the%20collection%20types%20%28List%2C%20Set%2C%20Dict%29%20immutable%3F/near/441980847" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dimitrios Piliouras <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Are.20the.20collection.20types.20.28List.2C.20Set.2C.20Dict.29.20immutable.3F.html#441980847">(Jun 01 2024 at 23:11)</a>:</h4>
<p>for sure - anything 'managed' comes with costs</p>



<a name="441980991"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Are%20the%20collection%20types%20%28List%2C%20Set%2C%20Dict%29%20immutable%3F/near/441980991" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dimitrios Piliouras <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Are.20the.20collection.20types.20.28List.2C.20Set.2C.20Dict.29.20immutable.3F.html#441980991">(Jun 01 2024 at 23:12)</a>:</h4>
<p>but i've personally come to conclude that 'data' and 'time' and pretty important aspects of programs</p>



<a name="441981007"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Are%20the%20collection%20types%20%28List%2C%20Set%2C%20Dict%29%20immutable%3F/near/441981007" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Are.20the.20collection.20types.20.28List.2C.20Set.2C.20Dict.29.20immutable.3F.html#441981007">(Jun 01 2024 at 23:12)</a>:</h4>
<p>Yep. I think roc's current setup is likely to match agent's better. We already live in what feels like a fully async world.</p>



<a name="441981220"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Are%20the%20collection%20types%20%28List%2C%20Set%2C%20Dict%29%20immutable%3F/near/441981220" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Are.20the.20collection.20types.20.28List.2C.20Set.2C.20Dict.29.20immutable.3F.html#441981220">(Jun 01 2024 at 23:14)</a>:</h4>
<p>For example in a webserver, if you want a global cache. That may work completely outside of roc only in the platform. Can be implemented in anyway the platform feels is best. Async with queuing, read write mutex, etc.</p>



<a name="441981307"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Are%20the%20collection%20types%20%28List%2C%20Set%2C%20Dict%29%20immutable%3F/near/441981307" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dimitrios Piliouras <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Are.20the.20collection.20types.20.28List.2C.20Set.2C.20Dict.29.20immutable.3F.html#441981307">(Jun 01 2024 at 23:14)</a>:</h4>
<p>cool</p>



<a name="441981316"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Are%20the%20collection%20types%20%28List%2C%20Set%2C%20Dict%29%20immutable%3F/near/441981316" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Are.20the.20collection.20types.20.28List.2C.20Set.2C.20Dict.29.20immutable.3F.html#441981316">(Jun 01 2024 at 23:15)</a>:</h4>
<p>So I think for a solid set of problems, the platform can define this api in a way that the roc author doesn't have to think how it is implemented. The platform author decides the transaction model.</p>



<a name="441981336"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Are%20the%20collection%20types%20%28List%2C%20Set%2C%20Dict%29%20immutable%3F/near/441981336" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Are.20the.20collection.20types.20.28List.2C.20Set.2C.20Dict.29.20immutable.3F.html#441981336">(Jun 01 2024 at 23:15)</a>:</h4>
<p>and underlying way of implementation.</p>



<a name="441981430"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Are%20the%20collection%20types%20%28List%2C%20Set%2C%20Dict%29%20immutable%3F/near/441981430" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Are.20the.20collection.20types.20.28List.2C.20Set.2C.20Dict.29.20immutable.3F.html#441981430">(Jun 01 2024 at 23:15)</a>:</h4>
<p>Definitely means that there would be less consistency from platform to platform though. So will be really interesting to see how this matures as roc grows.</p>



<hr><p>Last updated: Nov 01 2025 at 12:13 UTC</p>
</html>