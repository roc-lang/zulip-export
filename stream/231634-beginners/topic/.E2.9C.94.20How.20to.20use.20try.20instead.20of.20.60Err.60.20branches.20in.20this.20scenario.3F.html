<html>
<head><meta charset="utf-8"><title>✔ How to use try instead of `Err` branches in this scenario? · beginners · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/index.html">beginners</a></h2>
<h3>Topic: <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/.E2.9C.94.20How.20to.20use.20try.20instead.20of.20.60Err.60.20branches.20in.20this.20scenario.3F.html">✔ How to use try instead of `Err` branches in this scenario?</a></h3>

<hr>

<base href="https://roc.zulipchat.com">

<head><link href="https://roc-lang.github.io/zulip-export/style.css" rel="stylesheet"></head>

<a name="469752762"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/%E2%9C%94%20How%20to%20use%20try%20instead%20of%20%60Err%60%20branches%20in%20this%20scenario%3F/near/469752762" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Felipe Vogel <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/.E2.9C.94.20How.20to.20use.20try.20instead.20of.20.60Err.60.20branches.20in.20this.20scenario.3F.html#469752762">(Sep 12 2024 at 18:34)</a>:</h4>
<p>I'm trying to wrap my head around how results work, and how to work with them less verbosely. The <a href="https://github.com/roc-lang/examples/blob/main/examples/Results/main.roc">results example</a> is very helpful, but I still can't connect the dots in the CLI program below, which shows a menu of options and takes user input until a valid option number is inputted. (It actually doesn't compile due to a compiler bug, but that's not my question; I'll file the bug.)</p>
<div class="codehilite" data-code-language="Elm"><pre><span></span><code><span class="nv">app</span><span class="w"> </span><span class="p">[</span><span class="nv">main</span><span class="p">]</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nv">pf</span><span class="nf">:</span><span class="w"> </span><span class="nv">platform</span><span class="w"> </span><span class="s">"https://github.com/roc-lang/basic-cli/releases/download/0.15.0/SlwdbJ-3GR7uBWQo6zlmYWNYOxnvo8r6YABXD-45UOw.tar.br"</span><span class="w"> </span><span class="p">}</span>

<span class="kn">import</span><span class="w"> </span><span class="nc">pf.Stdout</span>
<span class="kn">import</span><span class="w"> </span><span class="nc">pf.Stdin</span>

<span class="kr">main </span><span class="nf">=</span><span class="w"> </span><span class="nv">getChoice</span>

<span class="nv">options</span><span class="w"> </span><span class="nf">=</span><span class="w"> </span><span class="p">[</span><span class="s">"parse"</span><span class="p">,</span><span class="w"> </span><span class="s">"validate"</span><span class="p">,</span><span class="w"> </span><span class="s">"analyze"</span><span class="p">,</span><span class="w"> </span><span class="s">"analyze and correct"</span><span class="p">]</span>

<span class="nv">exitInputs</span><span class="w"> </span><span class="nf">=</span><span class="w"> </span><span class="p">[</span><span class="s">"e"</span><span class="p">,</span><span class="w"> </span><span class="s">"exit"</span><span class="p">,</span><span class="w"> </span><span class="s">"q"</span><span class="p">,</span><span class="w"> </span><span class="s">"quit"</span><span class="p">]</span>

<span class="nv">menu</span><span class="w"> </span><span class="nf">=</span>
<span class="w">    </span><span class="nv">options</span>
<span class="w">    </span><span class="nf">|&gt;</span><span class="w"> </span><span class="kt">List</span><span class="nf">.</span><span class="nv">mapWithIndex</span><span class="w"> </span><span class="nf">\</span><span class="nv">option</span><span class="p">,</span><span class="w"> </span><span class="nv">index</span><span class="w"> </span><span class="nf">-&gt;</span>
<span class="w">        </span><span class="s">"$(Num.toStr (index + 1)). $(option)"</span>
<span class="w">    </span><span class="nf">|&gt;</span><span class="w"> </span><span class="kt">Str</span><span class="nf">.</span><span class="nv">joinWith</span><span class="w"> </span><span class="s">"</span><span class="se">\n</span><span class="s">"</span>

<span class="nv">getChoice</span><span class="w"> </span><span class="nf">=</span>
<span class="w">    </span><span class="kt">Stdout</span><span class="nf">.</span><span class="nv">line</span><span class="err">!</span><span class="w"> </span><span class="s">"</span><span class="se">\n</span><span class="s">Please enter a number for an option below:</span><span class="se">\n\n</span><span class="s">$(menu)"</span>
<span class="w">    </span><span class="kt">Stdout</span><span class="nf">.</span><span class="nv">write</span><span class="err">!</span><span class="w"> </span><span class="s">"</span><span class="se">\n</span><span class="s">&gt; "</span>
<span class="w">    </span><span class="nv">choice</span><span class="w"> </span><span class="nf">=</span><span class="w"> </span><span class="kt">Stdin</span><span class="nf">.</span><span class="nv">line</span><span class="err">!</span>

<span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nv">exitInputs</span><span class="w"> </span><span class="nf">|&gt;</span><span class="w"> </span><span class="kt">List</span><span class="nf">.</span><span class="nv">contains</span><span class="w"> </span><span class="nv">choice</span><span class="w"> </span><span class="kr">then</span>
<span class="w">        </span><span class="kt">Task</span><span class="nf">.</span><span class="nv">ok</span><span class="w"> </span><span class="p">{}</span>
<span class="w">    </span><span class="kr">else</span>
<span class="w">        </span><span class="nv">retry</span><span class="w"> </span><span class="nf">=</span>
<span class="w">            </span><span class="kt">Stdout</span><span class="nf">.</span><span class="nv">line</span><span class="err">!</span><span class="w"> </span><span class="s">"</span><span class="se">\n</span><span class="s">Oops, that's not an option."</span>
<span class="w">            </span><span class="nv">getChoice</span>

<span class="w">        </span><span class="nv">when</span><span class="w"> </span><span class="kt">Str</span><span class="nf">.</span><span class="nv">toU64</span><span class="w"> </span><span class="nv">choice</span><span class="w"> </span><span class="nv">is</span>
<span class="w">            </span><span class="kt">Ok</span><span class="w"> </span><span class="nv">choiceNum</span><span class="w"> </span><span class="nf">-&gt;</span>
<span class="w">                </span><span class="nv">when</span><span class="w"> </span><span class="nv">options</span><span class="w"> </span><span class="nf">|&gt;</span><span class="w"> </span><span class="kt">List</span><span class="nf">.</span><span class="nv">get</span><span class="w"> </span><span class="nv">choiceNum</span><span class="w"> </span><span class="nv">is</span>
<span class="w">                    </span><span class="kt">Ok</span><span class="w"> </span><span class="nv">option</span><span class="w"> </span><span class="nf">-&gt;</span>
<span class="w">                        </span><span class="kt">Stdout</span><span class="nf">.</span><span class="nv">line</span><span class="err">!</span><span class="w"> </span><span class="nv">option</span>

<span class="w">                    </span><span class="kt">Err</span><span class="w"> </span><span class="kt">OutOfBounds</span><span class="w"> </span><span class="nf">-&gt;</span><span class="w"> </span><span class="nv">retry</span>

<span class="w">            </span><span class="kt">Err</span><span class="w"> </span><span class="kt">InvalidNumStr</span><span class="w"> </span><span class="nf">-&gt;</span><span class="w"> </span><span class="nv">retry</span>
</code></pre></div>
<p>The double <code>when</code> with <code>Ok</code> and <code>Err</code> isn't too bad in this simple example, but I want to write it differently just to practice the "try" style. The closest I've gotten is to change the <code>else</code> branch to this:</p>
<div class="codehilite" data-code-language="Elm"><pre><span></span><code><span class="w">    </span><span class="kr">else</span>
<span class="w">        </span><span class="nv">retry</span><span class="w"> </span><span class="nf">=</span>
<span class="w">            </span><span class="kt">Stdout</span><span class="nf">.</span><span class="nv">line</span><span class="err">!</span><span class="w"> </span><span class="s">"</span><span class="se">\n</span><span class="s">Oops, that's not an option."</span>
<span class="w">            </span><span class="nv">getChoice</span>

<span class="w">        </span><span class="nv">choiceNum</span><span class="w"> </span><span class="nf">=</span>
<span class="w">            </span><span class="kt">Str</span><span class="nf">.</span><span class="nv">toU64</span><span class="w"> </span><span class="nv">choice</span>
<span class="w">                </span><span class="nf">|&gt;</span><span class="w"> </span><span class="kt">Result</span><span class="nf">.</span><span class="nv">mapErr</span><span class="err">?</span><span class="w"> </span><span class="nf">\</span><span class="nv">_</span><span class="w"> </span><span class="nf">-&gt;</span><span class="w"> </span><span class="nv">retry</span>
<span class="w">        </span><span class="nv">option</span><span class="w"> </span><span class="nf">=</span>
<span class="w">            </span><span class="nv">options</span>
<span class="w">                </span><span class="nf">|&gt;</span><span class="w"> </span><span class="kt">List</span><span class="nf">.</span><span class="nv">get</span><span class="w"> </span><span class="nv">choiceNum</span>
<span class="w">                </span><span class="nf">|&gt;</span><span class="w"> </span><span class="kt">Result</span><span class="nf">.</span><span class="nv">mapErr</span><span class="err">?</span><span class="w"> </span><span class="nf">\</span><span class="nv">_</span><span class="w"> </span><span class="nf">-&gt;</span><span class="w"> </span><span class="nv">retry</span>

<span class="w">        </span><span class="kt">Stdout</span><span class="nf">.</span><span class="nv">line</span><span class="err">!</span><span class="w"> </span><span class="nv">option</span>
</code></pre></div>
<p>But that gives me a type mismatch error, saying that the first branch has the type <code>Task {} *</code> and the <code>else</code> branch has a <code>Result</code> type.</p>
<p>Ideally I'm looking for how to avoid the repeated error handling altogether, and do something like this:</p>
<div class="codehilite" data-code-language="Elm"><pre><span></span><code><span class="w">    </span><span class="kr">else</span>
<span class="w">        </span><span class="nv">retry</span><span class="w"> </span><span class="nf">=</span>
<span class="w">            </span><span class="kt">Stdout</span><span class="nf">.</span><span class="nv">line</span><span class="err">!</span><span class="w"> </span><span class="s">"</span><span class="se">\n</span><span class="s">Oops, that's not an option."</span>
<span class="w">            </span><span class="nv">getChoice</span>

<span class="w">        </span><span class="nv">option</span><span class="w"> </span><span class="nf">=</span>
<span class="w">            </span><span class="nv">options</span>
<span class="w">                </span><span class="nf">|&gt;</span><span class="w"> </span><span class="kt">List</span><span class="nf">.</span><span class="nv">get</span><span class="w"> </span><span class="p">(</span><span class="kt">Str</span><span class="nf">.</span><span class="nv">toU64</span><span class="w"> </span><span class="nv">choice</span><span class="p">)</span>
<span class="w">                </span><span class="nf">|&gt;</span><span class="w"> </span><span class="kt">Result</span><span class="nf">.</span><span class="nv">mapErr</span><span class="err">?</span><span class="w"> </span><span class="nf">\</span><span class="nv">_</span><span class="w"> </span><span class="nf">-&gt;</span><span class="w"> </span><span class="nv">retry</span>

<span class="w">        </span><span class="kt">Stdout</span><span class="nf">.</span><span class="nv">line</span><span class="err">!</span><span class="w"> </span><span class="nv">option</span>
</code></pre></div>
<p>But that gives me yet another type mismatch error in the value of <code>option</code>.</p>
<p>Any pointers would be much appreciated.</p>



<a name="469760879"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/%E2%9C%94%20How%20to%20use%20try%20instead%20of%20%60Err%60%20branches%20in%20this%20scenario%3F/near/469760879" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/.E2.9C.94.20How.20to.20use.20try.20instead.20of.20.60Err.60.20branches.20in.20this.20scenario.3F.html#469760879">(Sep 12 2024 at 19:13)</a>:</h4>
<p>Not at my computer, but two immediate thoughts:</p>
<ol>
<li><code>getChoice</code> probably needs to be a function work correctly with the recursive definitions</li>
<li>Something like Task.loop would probably help here.</li>
</ol>



<a name="469761041"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/%E2%9C%94%20How%20to%20use%20try%20instead%20of%20%60Err%60%20branches%20in%20this%20scenario%3F/near/469761041" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/.E2.9C.94.20How.20to.20use.20try.20instead.20of.20.60Err.60.20branches.20in.20this.20scenario.3F.html#469761041">(Sep 12 2024 at 19:14)</a>:</h4>
<ol start="3">
<li><code>Result.try</code> and <code>Result.map</code> are your friend to avoid the nested error handling.</li>
</ol>



<a name="469761127"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/%E2%9C%94%20How%20to%20use%20try%20instead%20of%20%60Err%60%20branches%20in%20this%20scenario%3F/near/469761127" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/.E2.9C.94.20How.20to.20use.20try.20instead.20of.20.60Err.60.20branches.20in.20this.20scenario.3F.html#469761127">(Sep 12 2024 at 19:15)</a>:</h4>
<p>Let me grab a laptop to give a better answer</p>



<a name="469763521"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/%E2%9C%94%20How%20to%20use%20try%20instead%20of%20%60Err%60%20branches%20in%20this%20scenario%3F/near/469763521" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/.E2.9C.94.20How.20to.20use.20try.20instead.20of.20.60Err.60.20branches.20in.20this.20scenario.3F.html#469763521">(Sep 12 2024 at 19:29)</a>:</h4>
<p>I might do something like this, but not fully sold, feel like there is more cleanup here to do:</p>
<div class="spoiler-block"><div class="spoiler-header">
<p>code</p>
</div><div class="spoiler-content" aria-hidden="true">
<div class="codehilite" data-code-language="Elm"><pre><span></span><code><span class="nv">app</span><span class="w"> </span><span class="p">[</span><span class="nv">main</span><span class="p">]</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nv">pf</span><span class="nf">:</span><span class="w"> </span><span class="nv">platform</span><span class="w"> </span><span class="s">"https://github.com/roc-lang/basic-cli/releases/download/0.15.0/SlwdbJ-3GR7uBWQo6zlmYWNYOxnvo8r6YABXD-45UOw.tar.br"</span><span class="w"> </span><span class="p">}</span>

<span class="kn">import</span><span class="w"> </span><span class="nc">pf.Stdout</span>
<span class="kn">import</span><span class="w"> </span><span class="nc">pf.Stdin</span>

<span class="kr">main </span><span class="nf">=</span><span class="w"> </span><span class="nv">getChoice</span>

<span class="nv">options</span><span class="w"> </span><span class="nf">=</span><span class="w"> </span><span class="p">[</span><span class="s">"parse"</span><span class="p">,</span><span class="w"> </span><span class="s">"validate"</span><span class="p">,</span><span class="w"> </span><span class="s">"analyze"</span><span class="p">,</span><span class="w"> </span><span class="s">"analyze and correct"</span><span class="p">]</span>

<span class="nv">menu</span><span class="w"> </span><span class="nf">=</span>
<span class="w">    </span><span class="nv">options</span>
<span class="w">    </span><span class="nf">|&gt;</span><span class="w"> </span><span class="kt">List</span><span class="nf">.</span><span class="nv">mapWithIndex</span><span class="w"> </span><span class="nf">\</span><span class="nv">option</span><span class="p">,</span><span class="w"> </span><span class="nv">index</span><span class="w"> </span><span class="nf">-&gt;</span>
<span class="w">        </span><span class="s">"$(Num.toStr (index + 1)). $(option)"</span>
<span class="w">    </span><span class="nf">|&gt;</span><span class="w"> </span><span class="kt">Str</span><span class="nf">.</span><span class="nv">joinWith</span><span class="w"> </span><span class="s">"</span><span class="se">\n</span><span class="s">"</span>

<span class="nv">getChoice</span><span class="w"> </span><span class="nf">=</span>
<span class="w">    </span><span class="kt">Task</span><span class="nf">.</span><span class="nv">loop</span><span class="w"> </span><span class="p">{}</span><span class="w"> </span><span class="nf">\</span><span class="p">{}</span><span class="w"> </span><span class="nf">-&gt;</span>
<span class="w">        </span><span class="kt">Stdout</span><span class="nf">.</span><span class="nv">line</span><span class="err">!</span><span class="w"> </span><span class="s">"</span><span class="se">\n</span><span class="s">Please enter a number for an option below:</span><span class="se">\n\n</span><span class="s">$(menu)"</span>
<span class="w">        </span><span class="kt">Stdout</span><span class="nf">.</span><span class="nv">write</span><span class="err">!</span><span class="w"> </span><span class="s">"</span><span class="se">\n</span><span class="s">&gt; "</span>
<span class="w">        </span><span class="nv">choice</span><span class="w"> </span><span class="nf">=</span><span class="w"> </span><span class="kt">Stdin</span><span class="nf">.</span><span class="nv">line</span><span class="err">!</span>

<span class="w">        </span><span class="nv">optionRes</span><span class="w"> </span><span class="nf">=</span>
<span class="w">            </span><span class="nv">choiceNum</span><span class="w"> </span><span class="nf">=</span><span class="w"> </span><span class="kt">Str</span><span class="nf">.</span><span class="nv">toU64</span><span class="err">?</span><span class="w"> </span><span class="nv">choice</span>
<span class="w">            </span><span class="kt">List</span><span class="nf">.</span><span class="nv">get</span><span class="w"> </span><span class="nv">options</span><span class="w"> </span><span class="nv">choiceNum</span>

<span class="w">        </span><span class="nv">when</span><span class="w"> </span><span class="p">(</span><span class="nv">choice</span><span class="p">,</span><span class="w"> </span><span class="nv">optionRes</span><span class="p">)</span><span class="w"> </span><span class="nv">is</span>
<span class="w">            </span><span class="p">(</span><span class="s">"e"</span><span class="p">,</span><span class="w"> </span><span class="nv">_</span><span class="p">)</span><span class="w"> </span><span class="nf">|</span><span class="w"> </span><span class="p">(</span><span class="s">"exit"</span><span class="p">,</span><span class="w"> </span><span class="nv">_</span><span class="p">)</span><span class="w"> </span><span class="nf">|</span><span class="w"> </span><span class="p">(</span><span class="s">"q"</span><span class="p">,</span><span class="w"> </span><span class="nv">_</span><span class="p">)</span><span class="w"> </span><span class="nf">|</span><span class="w"> </span><span class="p">(</span><span class="s">"quit"</span><span class="p">,</span><span class="w"> </span><span class="nv">_</span><span class="p">)</span><span class="w"> </span><span class="nf">-&gt;</span>
<span class="w">                </span><span class="kt">Task</span><span class="nf">.</span><span class="nv">ok</span><span class="w"> </span><span class="p">(</span><span class="kt">Done</span><span class="w"> </span><span class="p">{})</span>

<span class="w">            </span><span class="p">(</span><span class="nv">_</span><span class="p">,</span><span class="w"> </span><span class="kt">Ok</span><span class="w"> </span><span class="nv">option</span><span class="p">)</span><span class="w"> </span><span class="nf">-&gt;</span>
<span class="w">                </span><span class="kt">Stdout</span><span class="nf">.</span><span class="nv">line</span><span class="err">!</span><span class="w"> </span><span class="nv">option</span>
<span class="w">                </span><span class="kt">Task</span><span class="nf">.</span><span class="nv">ok</span><span class="w"> </span><span class="p">(</span><span class="kt">Done</span><span class="w"> </span><span class="p">{})</span>

<span class="w">            </span><span class="p">(</span><span class="nv">_</span><span class="p">,</span><span class="w"> </span><span class="nv">_</span><span class="p">)</span><span class="w"> </span><span class="nf">-&gt;</span>
<span class="w">                </span><span class="kt">Stdout</span><span class="nf">.</span><span class="nv">line</span><span class="err">!</span><span class="w"> </span><span class="s">"</span><span class="se">\n</span><span class="s">Oops, that's not an option."</span>
<span class="w">                </span><span class="kt">Task</span><span class="nf">.</span><span class="nv">ok</span><span class="w"> </span><span class="p">(</span><span class="kt">Step</span><span class="w"> </span><span class="p">{})</span>
</code></pre></div>
</div></div>
<p>Edit: made it a bit better.</p>



<a name="469764972"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/%E2%9C%94%20How%20to%20use%20try%20instead%20of%20%60Err%60%20branches%20in%20this%20scenario%3F/near/469764972" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/.E2.9C.94.20How.20to.20use.20try.20instead.20of.20.60Err.60.20branches.20in.20this.20scenario.3F.html#469764972">(Sep 12 2024 at 19:38)</a>:</h4>
<p>If you specifically want to mix Results and Task in the "try" style, I think that you probably should convert the results to tasks via <code>Task.fromResult</code>.</p>
<p>Something roughly like:</p>
<div class="codehilite" data-code-language="Elm"><pre><span></span><code><span class="w">    </span><span class="kr">else</span>
<span class="w">        </span><span class="nv">retry</span><span class="w"> </span><span class="nf">=</span>
<span class="w">            </span><span class="kt">Stdout</span><span class="nf">.</span><span class="nv">line</span><span class="err">!</span><span class="w"> </span><span class="s">"</span><span class="se">\n</span><span class="s">Oops, that's not an option."</span>
<span class="w">            </span><span class="nv">getChoice</span>

<span class="w">        </span><span class="nv">choiceNum</span><span class="w"> </span><span class="nf">=</span>
<span class="w">            </span><span class="kt">Str</span><span class="nf">.</span><span class="nv">toU64</span><span class="w"> </span><span class="nv">choice</span>
<span class="w">                </span><span class="nf">|&gt;</span><span class="w"> </span><span class="kt">Task</span><span class="nf">.</span><span class="nv">fromResult</span>
<span class="w">                </span><span class="nf">|&gt;</span><span class="w"> </span><span class="kt">Task</span><span class="nf">.</span><span class="nv">onErr</span><span class="err">!</span><span class="w"> </span><span class="nf">\</span><span class="nv">_</span><span class="w"> </span><span class="nf">-&gt;</span><span class="w"> </span><span class="nv">retry</span>
<span class="w">        </span><span class="nv">option</span><span class="w"> </span><span class="nf">=</span>
<span class="w">            </span><span class="nv">options</span>
<span class="w">                </span><span class="nf">|&gt;</span><span class="w"> </span><span class="kt">List</span><span class="nf">.</span><span class="nv">get</span><span class="w"> </span><span class="nv">choiceNum</span>
<span class="w">                </span><span class="nf">|&gt;</span><span class="w"> </span><span class="kt">Task</span><span class="nf">.</span><span class="nv">fromResult</span>
<span class="w">                </span><span class="nf">|&gt;</span><span class="w"> </span><span class="kt">Task</span><span class="nf">.</span><span class="nv">onErr</span><span class="err">!</span><span class="w"> </span><span class="nf">\</span><span class="nv">_</span><span class="w"> </span><span class="nf">-&gt;</span><span class="w"> </span><span class="nv">retry</span>

<span class="w">        </span><span class="kt">Stdout</span><span class="nf">.</span><span class="nv">line</span><span class="err">!</span><span class="w"> </span><span class="nv">option</span>
</code></pre></div>
<p>That said, I don't expect that to compile today. I think to make this work today, <code>Task.loop</code> is required.</p>



<a name="469775257"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/%E2%9C%94%20How%20to%20use%20try%20instead%20of%20%60Err%60%20branches%20in%20this%20scenario%3F/near/469775257" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Felipe Vogel <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/.E2.9C.94.20How.20to.20use.20try.20instead.20of.20.60Err.60.20branches.20in.20this.20scenario.3F.html#469775257">(Sep 12 2024 at 20:30)</a>:</h4>
<p>Thank you! I ran across the <code>Task.loop</code> example too, but I thought, <em>"I don't think I need this because I won't be passing state between iterations. So I'll just call <code>getChoice</code> recursively."</em> But now I see that I can just pass an empty record.</p>
<p>I like your suggestion better than anything compilable that I've come up with, but I still wanted to take a stab at a solution that doesn't use <code>Task.loop</code> and this is the best I could get:</p>
<div class="codehilite" data-code-language="Elm"><pre><span></span><code><span class="nv">app</span><span class="w"> </span><span class="p">[</span><span class="nv">main</span><span class="p">]</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nv">pf</span><span class="nf">:</span><span class="w"> </span><span class="nv">platform</span><span class="w"> </span><span class="s">"https://github.com/roc-lang/basic-cli/releases/download/0.15.0/SlwdbJ-3GR7uBWQo6zlmYWNYOxnvo8r6YABXD-45UOw.tar.br"</span><span class="w"> </span><span class="p">}</span>

<span class="kn">import</span><span class="w"> </span><span class="nc">pf.Stdout</span>
<span class="kn">import</span><span class="w"> </span><span class="nc">pf.Stdin</span>

<span class="kr">main </span><span class="nf">=</span><span class="w"> </span><span class="nv">getChoice</span>

<span class="nv">options</span><span class="w"> </span><span class="nf">=</span><span class="w"> </span><span class="p">[</span><span class="s">"parse"</span><span class="p">,</span><span class="w"> </span><span class="s">"validate"</span><span class="p">,</span><span class="w"> </span><span class="s">"analyze"</span><span class="p">,</span><span class="w"> </span><span class="s">"analyze and correct"</span><span class="p">]</span>

<span class="nv">exitInputs</span><span class="w"> </span><span class="nf">=</span><span class="w"> </span><span class="p">[</span><span class="s">"e"</span><span class="p">,</span><span class="w"> </span><span class="s">"exit"</span><span class="p">,</span><span class="w"> </span><span class="s">"q"</span><span class="p">,</span><span class="w"> </span><span class="s">"quit"</span><span class="p">]</span>

<span class="nv">menu</span><span class="w"> </span><span class="nf">=</span>
<span class="w">    </span><span class="nv">options</span>
<span class="w">    </span><span class="nf">|&gt;</span><span class="w"> </span><span class="kt">List</span><span class="nf">.</span><span class="nv">mapWithIndex</span><span class="w"> </span><span class="nf">\</span><span class="nv">option</span><span class="p">,</span><span class="w"> </span><span class="nv">index</span><span class="w"> </span><span class="nf">-&gt;</span>
<span class="w">        </span><span class="s">"$(Num.toStr (index + 1)). $(option)"</span>
<span class="w">    </span><span class="nf">|&gt;</span><span class="w"> </span><span class="kt">Str</span><span class="nf">.</span><span class="nv">joinWith</span><span class="w"> </span><span class="s">"</span><span class="se">\n</span><span class="s">"</span>

<span class="nv">retry</span><span class="w"> </span><span class="nf">=</span>
<span class="w">    </span><span class="kt">Stdout</span><span class="nf">.</span><span class="nv">line</span><span class="err">!</span><span class="w"> </span><span class="s">"</span><span class="se">\n</span><span class="s">Oops, that's not an option."</span>
<span class="w">    </span><span class="nv">getChoice</span>

<span class="nv">getChoice</span><span class="w"> </span><span class="nf">=</span>
<span class="w">    </span><span class="kt">Stdout</span><span class="nf">.</span><span class="nv">line</span><span class="err">!</span><span class="w"> </span><span class="s">"</span><span class="se">\n</span><span class="s">Please enter a number for an option below:</span><span class="se">\n\n</span><span class="s">$(menu)"</span>
<span class="w">    </span><span class="kt">Stdout</span><span class="nf">.</span><span class="nv">write</span><span class="err">!</span><span class="w"> </span><span class="s">"</span><span class="se">\n</span><span class="s">&gt; "</span>
<span class="w">    </span><span class="nv">choice</span><span class="w"> </span><span class="nf">=</span><span class="w"> </span><span class="kt">Stdin</span><span class="nf">.</span><span class="nv">line</span><span class="err">!</span>

<span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nv">exitInputs</span><span class="w"> </span><span class="nf">|&gt;</span><span class="w"> </span><span class="kt">List</span><span class="nf">.</span><span class="nv">contains</span><span class="w"> </span><span class="nv">choice</span><span class="w"> </span><span class="kr">then</span>
<span class="w">        </span><span class="kt">Task</span><span class="nf">.</span><span class="nv">ok</span><span class="w"> </span><span class="p">{}</span>
<span class="w">    </span><span class="kr">else</span>
<span class="w">        </span><span class="nv">optionRes</span><span class="w"> </span><span class="nf">=</span>
<span class="w">            </span><span class="nv">choiceNum</span><span class="w"> </span><span class="nf">=</span><span class="w"> </span><span class="kt">Str</span><span class="nf">.</span><span class="nv">toU64</span><span class="err">?</span><span class="w"> </span><span class="nv">choice</span>
<span class="w">            </span><span class="kt">List</span><span class="nf">.</span><span class="nv">get</span><span class="w"> </span><span class="nv">options</span><span class="w"> </span><span class="p">(</span><span class="nv">choiceNum</span><span class="w"> </span><span class="nf">-</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span>

<span class="w">        </span><span class="nv">when</span><span class="w"> </span><span class="nv">optionRes</span><span class="w"> </span><span class="nv">is</span>
<span class="w">            </span><span class="kt">Ok</span><span class="w"> </span><span class="nv">option</span><span class="w"> </span><span class="nf">-&gt;</span><span class="w"> </span><span class="kt">Stdout</span><span class="nf">.</span><span class="nv">line</span><span class="err">!</span><span class="w"> </span><span class="nv">option</span>
<span class="w">            </span><span class="nv">_</span><span class="w"> </span><span class="nf">-&gt;</span><span class="w"> </span><span class="nv">retry</span>
</code></pre></div>
<p>There are some things I don't like about it, which boil down to: I wish I could just do the operations I need to do and stick a <code>|&gt; Result.mapErr</code> at the end of the pipeline where any errors can be produced, as in this example which I know is incorrect and produces a bunch of errors:</p>
<div class="codehilite" data-code-language="Elm"><pre><span></span><code><span class="w">    </span><span class="kr">else</span>
<span class="w">        </span><span class="nv">option</span><span class="w"> </span><span class="nf">=</span>
<span class="w">            </span><span class="nv">options</span>
<span class="w">                </span><span class="nf">|&gt;</span><span class="w"> </span><span class="kt">List</span><span class="nf">.</span><span class="nv">get</span><span class="w"> </span><span class="p">((</span><span class="kt">Str</span><span class="nf">.</span><span class="nv">toU64</span><span class="w"> </span><span class="nv">choice</span><span class="p">)</span><span class="w"> </span><span class="nf">-</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span>
<span class="w">                </span><span class="nf">|&gt;</span><span class="w"> </span><span class="kt">Result</span><span class="nf">.</span><span class="nv">mapErr</span><span class="err">?</span><span class="w"> </span><span class="nf">\</span><span class="nv">_</span><span class="w"> </span><span class="nf">-&gt;</span>
<span class="w">                    </span><span class="kt">Stdout</span><span class="nf">.</span><span class="nv">line</span><span class="err">!</span><span class="w"> </span><span class="s">"</span><span class="se">\n</span><span class="s">Oops, that's not an option."</span>
<span class="w">                    </span><span class="nv">getChoice</span>

<span class="w">        </span><span class="kt">Stdout</span><span class="nf">.</span><span class="nv">line</span><span class="err">!</span><span class="w"> </span><span class="nv">option</span>
</code></pre></div>
<p>I know that's not how <code>Result.mapErr</code> or <code>Result</code> works, but is there any way I can approximate this style in a correct way?</p>
<p>(I know this is not a recipe for very robust or self-documenting code; I'm just exploring possibilities for scripting, prototyping, etc.)</p>



<a name="469775799"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/%E2%9C%94%20How%20to%20use%20try%20instead%20of%20%60Err%60%20branches%20in%20this%20scenario%3F/near/469775799" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/.E2.9C.94.20How.20to.20use.20try.20instead.20of.20.60Err.60.20branches.20in.20this.20scenario.3F.html#469775799">(Sep 12 2024 at 20:34)</a>:</h4>
<p>Yeah, the issues of task and result not fully mixing. This all should change with some of the proposal in ideas rn. When task will go away and instead be represented by effectful functions returning results. That should make them mingle with result much better</p>



<a name="469777679"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/%E2%9C%94%20How%20to%20use%20try%20instead%20of%20%60Err%60%20branches%20in%20this%20scenario%3F/near/469777679" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Felipe Vogel <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/.E2.9C.94.20How.20to.20use.20try.20instead.20of.20.60Err.60.20branches.20in.20this.20scenario.3F.html#469777679">(Sep 12 2024 at 20:47)</a>:</h4>
<p>Gotcha, I will keep an eye out then. Thanks for your help!</p>



<a name="469782314"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/%E2%9C%94%20How%20to%20use%20try%20instead%20of%20%60Err%60%20branches%20in%20this%20scenario%3F/near/469782314" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Felipe Vogel <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/.E2.9C.94.20How.20to.20use.20try.20instead.20of.20.60Err.60.20branches.20in.20this.20scenario.3F.html#469782314">(Sep 12 2024 at 21:20)</a>:</h4>
<p>Another question: instead of outputting the chosen option at the end of <code>getChoice</code>, how can I return it so that it can be used in <code>main</code>? In the code below I'm still just printing it out, but the goal later is to take different actions based on the chosen option.</p>
<p>This is as far as I've gotten, but I'm getting a type mismatch error in <code>main</code>. I don't feel I understand Tasks or Results very well.</p>
<div class="spoiler-block"><div class="spoiler-header">
<p>code</p>
</div><div class="spoiler-content" aria-hidden="true">
<div class="codehilite" data-code-language="Elm"><pre><span></span><code><span class="nv">app</span><span class="w"> </span><span class="p">[</span><span class="nv">main</span><span class="p">]</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nv">pf</span><span class="nf">:</span><span class="w"> </span><span class="nv">platform</span><span class="w"> </span><span class="s">"https://github.com/roc-lang/basic-cli/releases/download/0.15.0/SlwdbJ-3GR7uBWQo6zlmYWNYOxnvo8r6YABXD-45UOw.tar.br"</span><span class="w"> </span><span class="p">}</span>

<span class="kn">import</span><span class="w"> </span><span class="nc">pf.Stdout</span>
<span class="kn">import</span><span class="w"> </span><span class="nc">pf.Stdin</span>

<span class="kr">main </span><span class="nf">=</span>
<span class="w">    </span><span class="nv">when</span><span class="w"> </span><span class="nv">getChoice</span><span class="w"> </span><span class="nv">is</span>
<span class="w">        </span><span class="kt">Task</span><span class="w"> </span><span class="p">(</span><span class="kt">Done</span><span class="w"> </span><span class="kt">Exit</span><span class="p">)</span><span class="w"> </span><span class="nf">-&gt;</span><span class="w"> </span><span class="kt">Task</span><span class="nf">.</span><span class="nv">ok</span><span class="w"> </span><span class="p">{}</span>
<span class="w">        </span><span class="kt">Task</span><span class="w"> </span><span class="p">(</span><span class="kt">Done</span><span class="w"> </span><span class="p">(</span><span class="kt">Choice</span><span class="w"> </span><span class="nv">option</span><span class="p">))</span><span class="w"> </span><span class="nf">-&gt;</span><span class="w"> </span><span class="kt">Stdout</span><span class="nf">.</span><span class="nv">line</span><span class="err">!</span><span class="w"> </span><span class="nv">option</span>

<span class="nv">options</span><span class="w"> </span><span class="nf">=</span><span class="w"> </span><span class="p">[</span><span class="s">"parse"</span><span class="p">,</span><span class="w"> </span><span class="s">"validate"</span><span class="p">,</span><span class="w"> </span><span class="s">"analyze"</span><span class="p">,</span><span class="w"> </span><span class="s">"analyze and correct"</span><span class="p">]</span>

<span class="nv">menu</span><span class="w"> </span><span class="nf">=</span>
<span class="w">    </span><span class="nv">options</span>
<span class="w">    </span><span class="nf">|&gt;</span><span class="w"> </span><span class="kt">List</span><span class="nf">.</span><span class="nv">mapWithIndex</span><span class="w"> </span><span class="nf">\</span><span class="nv">option</span><span class="p">,</span><span class="w"> </span><span class="nv">index</span><span class="w"> </span><span class="nf">-&gt;</span>
<span class="w">        </span><span class="s">"$(Num.toStr (index + 1)). $(option)"</span>
<span class="w">    </span><span class="nf">|&gt;</span><span class="w"> </span><span class="kt">Str</span><span class="nf">.</span><span class="nv">joinWith</span><span class="w"> </span><span class="s">"</span><span class="se">\n</span><span class="s">"</span>

<span class="nv">getChoice</span><span class="w"> </span><span class="nf">=</span>
<span class="w">    </span><span class="kt">Task</span><span class="nf">.</span><span class="nv">loop</span><span class="w"> </span><span class="p">{}</span><span class="w"> </span><span class="nf">\</span><span class="p">{}</span><span class="w"> </span><span class="nf">-&gt;</span>
<span class="w">        </span><span class="kt">Stdout</span><span class="nf">.</span><span class="nv">line</span><span class="err">!</span><span class="w"> </span><span class="s">"</span><span class="se">\n</span><span class="s">Please enter a number for an option below:</span><span class="se">\n\n</span><span class="s">$(menu)"</span>
<span class="w">        </span><span class="kt">Stdout</span><span class="nf">.</span><span class="nv">write</span><span class="err">!</span><span class="w"> </span><span class="s">"</span><span class="se">\n</span><span class="s">&gt; "</span>
<span class="w">        </span><span class="nv">choice</span><span class="w"> </span><span class="nf">=</span><span class="w"> </span><span class="kt">Stdin</span><span class="nf">.</span><span class="nv">line</span><span class="err">!</span>

<span class="w">        </span><span class="nv">optionRes</span><span class="w"> </span><span class="nf">=</span>
<span class="w">            </span><span class="nv">choiceNum</span><span class="w"> </span><span class="nf">=</span><span class="w"> </span><span class="kt">Str</span><span class="nf">.</span><span class="nv">toU64</span><span class="err">?</span><span class="w"> </span><span class="nv">choice</span>
<span class="w">            </span><span class="kt">List</span><span class="nf">.</span><span class="nv">get</span><span class="w"> </span><span class="nv">options</span><span class="w"> </span><span class="p">(</span><span class="nv">choiceNum</span><span class="w"> </span><span class="nf">-</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span>

<span class="w">        </span><span class="nv">when</span><span class="w"> </span><span class="p">(</span><span class="nv">choice</span><span class="p">,</span><span class="w"> </span><span class="nv">optionRes</span><span class="p">)</span><span class="w"> </span><span class="nv">is</span>
<span class="w">            </span><span class="p">(</span><span class="s">"e"</span><span class="p">,</span><span class="w"> </span><span class="nv">_</span><span class="p">)</span><span class="w"> </span><span class="nf">|</span><span class="w"> </span><span class="p">(</span><span class="s">"exit"</span><span class="p">,</span><span class="w"> </span><span class="nv">_</span><span class="p">)</span><span class="w"> </span><span class="nf">|</span><span class="w"> </span><span class="p">(</span><span class="s">"q"</span><span class="p">,</span><span class="w"> </span><span class="nv">_</span><span class="p">)</span><span class="w"> </span><span class="nf">|</span><span class="w"> </span><span class="p">(</span><span class="s">"quit"</span><span class="p">,</span><span class="w"> </span><span class="nv">_</span><span class="p">)</span><span class="w"> </span><span class="nf">-&gt;</span>
<span class="w">                </span><span class="kt">Task</span><span class="nf">.</span><span class="nv">ok</span><span class="w"> </span><span class="p">(</span><span class="kt">Done</span><span class="w"> </span><span class="kt">Exit</span><span class="p">)</span>

<span class="w">            </span><span class="p">(</span><span class="nv">_</span><span class="p">,</span><span class="w"> </span><span class="kt">Ok</span><span class="w"> </span><span class="nv">option</span><span class="p">)</span><span class="w"> </span><span class="nf">-&gt;</span>
<span class="w">                </span><span class="kt">Stdout</span><span class="nf">.</span><span class="nv">line</span><span class="err">!</span><span class="w"> </span><span class="nv">option</span>
<span class="w">                </span><span class="kt">Task</span><span class="nf">.</span><span class="nv">ok</span><span class="w"> </span><span class="p">(</span><span class="kt">Done</span><span class="w"> </span><span class="p">(</span><span class="kt">Choice</span><span class="w"> </span><span class="nv">option</span><span class="p">))</span>

<span class="w">            </span><span class="p">(</span><span class="nv">_</span><span class="p">,</span><span class="w"> </span><span class="nv">_</span><span class="p">)</span><span class="w"> </span><span class="nf">-&gt;</span>
<span class="w">                </span><span class="kt">Stdout</span><span class="nf">.</span><span class="nv">line</span><span class="err">!</span><span class="w"> </span><span class="s">"</span><span class="se">\n</span><span class="s">Oops, that's not an option."</span>
<span class="w">                </span><span class="kt">Task</span><span class="nf">.</span><span class="nv">ok</span><span class="w"> </span><span class="p">(</span><span class="kt">Step</span><span class="w"> </span><span class="p">{})</span>
</code></pre></div>
</div></div>



<a name="469786342"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/%E2%9C%94%20How%20to%20use%20try%20instead%20of%20%60Err%60%20branches%20in%20this%20scenario%3F/near/469786342" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/.E2.9C.94.20How.20to.20use.20try.20instead.20of.20.60Err.60.20branches.20in.20this.20scenario.3F.html#469786342">(Sep 12 2024 at 21:52)</a>:</h4>
<p>Ah yeah, you can simply match on a task. You have to await it and match on the result <code>getChoice!</code> and then match without the word <code>Task</code> and it should work I think</p>



<a name="469795457"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/%E2%9C%94%20How%20to%20use%20try%20instead%20of%20%60Err%60%20branches%20in%20this%20scenario%3F/near/469795457" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Felipe Vogel <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/.E2.9C.94.20How.20to.20use.20try.20instead.20of.20.60Err.60.20branches.20in.20this.20scenario.3F.html#469795457">(Sep 12 2024 at 22:41)</a>:</h4>
<p>Thanks, that worked!</p>



<a name="469824315"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/%E2%9C%94%20How%20to%20use%20try%20instead%20of%20%60Err%60%20branches%20in%20this%20scenario%3F/near/469824315" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Aurélien Geron <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/.E2.9C.94.20How.20to.20use.20try.20instead.20of.20.60Err.60.20branches.20in.20this.20scenario.3F.html#469824315">(Sep 13 2024 at 02:50)</a>:</h4>
<p>I also struggled to get <code>Task</code> and <code>Result</code> to play nicely together. <code>Task.fromResult</code> was the key. But I still felt it was a bit weird to have both <code>Task</code> and <code>Result</code>, I'm very glad to read Brendan's comment about the idea of getting rid of <code>Task</code>. <span aria-label="+1" class="emoji emoji-1f44d" role="img" title="+1">:+1:</span></p>



<a name="471062395"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/%E2%9C%94%20How%20to%20use%20try%20instead%20of%20%60Err%60%20branches%20in%20this%20scenario%3F/near/471062395" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Notification Bot <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/.E2.9C.94.20How.20to.20use.20try.20instead.20of.20.60Err.60.20branches.20in.20this.20scenario.3F.html#471062395">(Sep 17 2024 at 18:39)</a>:</h4>
<p><span class="user-mention silent" data-user-id="752978">Felipe Vogel</span> has marked this topic as resolved.</p>



<hr><p>Last updated: Nov 01 2025 at 12:13 UTC</p>
</html>