<html>
<head><meta charset="utf-8"><title>✔ Missing final expression / nested definition error · beginners · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/index.html">beginners</a></h2>
<h3>Topic: <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/.E2.9C.94.20Missing.20final.20expression.20.2F.20nested.20definition.20error.html">✔ Missing final expression / nested definition error</a></h3>

<hr>

<base href="https://roc.zulipchat.com">

<head><link href="https://roc-lang.github.io/zulip-export/style.css" rel="stylesheet"></head>

<a name="413046141"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/%E2%9C%94%20Missing%20final%20expression%20/%20nested%20definition%20error/near/413046141" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ian McLerran <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/.E2.9C.94.20Missing.20final.20expression.20.2F.20nested.20definition.20error.html#413046141">(Jan 15 2024 at 23:50)</a>:</h4>
<p>I have a roc function to traverse a binary tree in order. I need to get the value of the current node, which uses a method which returns a result, so I use an if statement instead of a when block to handle the result. </p>
<p>Thus I have <code>if resultVal == Ok val then</code>, to extract the named value from the Result tag. I wonder if this syntax is incorrect, and the <code>val</code> is being treated as a definition, thus causing the error I am getting? </p>
<p>Error and code below:</p>
<div class="codehilite"><pre><span></span><code>── MISSING FINAL EXPRESSION ───────────────────────────── InorderTraversal.roc ─

I am partway through parsing a definition, but I got stuck here:
25│              valsListWithCurrent = valsListWithLeft |&gt; List.append val
                                                                          ^
This definition is missing a final expression. A nested definition
must be followed by either another definition, or an expression

    x = 4
    y = 2

    x + y
</code></pre></div>
<div class="codehilite" data-code-language="CoffeeScript"><pre><span></span><code><span class="nv">inorderTraversalRecur</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="nx">Tree</span><span class="w"> </span><span class="nx">a</span><span class="p">,</span><span class="w"> </span><span class="nx">Nat</span><span class="p">,</span><span class="w"> </span><span class="nx">List</span><span class="w"> </span><span class="nx">a</span><span class="w"> </span><span class="nf">-&gt;</span><span class="w"> </span><span class="nx">List</span><span class="w"> </span><span class="nx">a</span>
<span class="nv">inorderTraversalRecur</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="err">\</span><span class="nx">tree</span><span class="p">,</span><span class="w"> </span><span class="nx">index</span><span class="p">,</span><span class="w"> </span><span class="nx">valsList</span><span class="w"> </span><span class="nf">-&gt;</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">hasLhs</span><span class="w"> </span><span class="nx">tree</span><span class="w"> </span><span class="nx">index</span><span class="w"> </span><span class="k">then</span><span class="w"> </span><span class="c1"># tree with left subtree</span>
<span class="w">        </span><span class="nv">valsListWithLeft</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">inorderTraversalRecur</span><span class="w"> </span><span class="nx">tree</span><span class="w"> </span><span class="p">(</span><span class="nx">getLhsIdx</span><span class="w"> </span><span class="nx">index</span><span class="p">)</span><span class="w"> </span><span class="nx">valsList</span>
<span class="w">        </span><span class="nv">resultVal</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">getValAtIdx</span><span class="w"> </span><span class="nx">tree</span><span class="w"> </span><span class="nx">index</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="nx">resultVal</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nx">Ok</span><span class="w"> </span><span class="nx">val</span><span class="w"> </span><span class="k">then</span><span class="w"> </span><span class="c1"># should always be true</span>
<span class="w">            </span><span class="nv">valsListWithCurrent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">valsListWithLeft</span><span class="w"> </span><span class="o">|&gt;</span><span class="w"> </span><span class="nx">List</span><span class="p">.</span><span class="nx">append</span><span class="w"> </span><span class="nx">val</span>
<span class="w">        </span><span class="k">else</span>
<span class="w">            </span><span class="nx">crash</span><span class="w"> </span><span class="s">"Expected a value at index \(index)"</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="nx">hasRhs</span><span class="w"> </span><span class="nx">tree</span><span class="w"> </span><span class="nx">index</span><span class="w"> </span><span class="k">then</span><span class="w"> </span><span class="c1"># tree with left and right subtree</span>
<span class="w">            </span><span class="nx">inorderTraversalRecur</span><span class="w"> </span><span class="nx">tree</span><span class="w"> </span><span class="p">(</span><span class="nx">getRhsIdx</span><span class="w"> </span><span class="nx">index</span><span class="p">)</span><span class="w"> </span><span class="nx">valsListWithCurrent</span>
<span class="w">        </span><span class="k">else</span>
<span class="w">            </span><span class="nx">valsListWithCurrent</span><span class="w"> </span><span class="c1"># tree with only left subtree</span>
<span class="w">    </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="nx">hasRhs</span><span class="w"> </span><span class="nx">tree</span><span class="w"> </span><span class="nx">index</span><span class="w"> </span><span class="k">then</span><span class="w"> </span><span class="c1"># tree with only right subtree</span>
<span class="w">        </span><span class="nv">resultVal</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">getValAtIdx</span><span class="w"> </span><span class="nx">tree</span><span class="w"> </span><span class="nx">index</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="nx">resultVal</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nx">Ok</span><span class="w"> </span><span class="nx">val</span><span class="w"> </span><span class="k">then</span><span class="w"> </span><span class="c1"># should always be true</span>
<span class="w">            </span><span class="nv">valsListWithCurrent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">valsList</span><span class="w"> </span><span class="o">|&gt;</span><span class="w"> </span><span class="nx">List</span><span class="p">.</span><span class="nx">append</span><span class="w"> </span><span class="nx">val</span>
<span class="w">        </span><span class="k">else</span>
<span class="w">            </span><span class="nx">crash</span><span class="w"> </span><span class="s">"Expected a value at index \(index)"</span>
<span class="w">        </span><span class="nx">inorderTraversalRecur</span><span class="w"> </span><span class="nx">tree</span><span class="w"> </span><span class="p">(</span><span class="nx">getRhsIdx</span><span class="w"> </span><span class="nx">index</span><span class="p">)</span><span class="w"> </span><span class="nx">valsListWithCurrent</span><span class="w"> </span><span class="c1"># finish right subtree</span>
<span class="w">    </span><span class="k">else</span>
<span class="w">        </span><span class="k">when</span><span class="w"> </span><span class="nx">getValAtIdx</span><span class="w"> </span><span class="nx">tree</span><span class="w"> </span><span class="nx">index</span><span class="w"> </span><span class="o">is</span><span class="w"> </span><span class="c1"># leaf node</span>
<span class="w">            </span><span class="nx">Ok</span><span class="w"> </span><span class="nx">val</span><span class="w"> </span><span class="nf">-&gt;</span><span class="w"> </span><span class="nx">valsList</span><span class="w"> </span><span class="o">|&gt;</span><span class="w"> </span><span class="nx">List</span><span class="p">.</span><span class="nx">append</span><span class="w"> </span><span class="nx">val</span><span class="w"> </span><span class="c1"># should always be Ok</span>
<span class="w">            </span><span class="nx">Err</span><span class="w"> </span><span class="nx">_</span><span class="w"> </span><span class="nf">-&gt;</span><span class="w"> </span><span class="nx">crash</span><span class="w"> </span><span class="s">"Expected a value at index \(index)"</span>
</code></pre></div>
<p>Full binary tree implementation <a href="https://github.com/imclerran/LeetCode-Roc/blob/main/RocUtils/BinaryTree.roc">here</a><br>
And full code for inorder traversal <a href="https://github.com/imclerran/LeetCode-Roc/blob/main/InorderTraversal.roc">here</a></p>



<a name="413047857"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/%E2%9C%94%20Missing%20final%20expression%20/%20nested%20definition%20error/near/413047857" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/.E2.9C.94.20Missing.20final.20expression.20.2F.20nested.20definition.20error.html#413047857">(Jan 16 2024 at 00:07)</a>:</h4>
<p>I don't think this work: <code>if resultVal == Ok val then</code>.</p>
<p>I think you have to use a <code>when ... is</code></p>
<div class="codehilite" data-code-language="Elm"><pre><span></span><code><span class="nv">when</span><span class="w"> </span><span class="nv">resultVal</span><span class="w"> </span><span class="nv">is</span>
<span class="w">    </span><span class="kt">Ok</span><span class="w"> </span><span class="nv">val</span><span class="w"> </span><span class="nf">-&gt;</span>
<span class="w">        </span><span class="nv">valsListWithCurrent</span><span class="w"> </span><span class="nf">=</span><span class="w"> </span><span class="nv">valsListWithLeft</span><span class="w"> </span><span class="nf">|&gt;</span><span class="w"> </span><span class="kt">List</span><span class="nf">.</span><span class="nv">append</span><span class="w"> </span><span class="nv">val</span>
<span class="w">    </span><span class="kt">Err</span><span class="w"> </span><span class="nv">_</span><span class="w"> </span><span class="nf">-&gt;</span>
<span class="w">        </span><span class="nv">crash</span><span class="w"> </span><span class="s">"Expected a value at index \(index)"</span>
</code></pre></div>



<a name="413047874"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/%E2%9C%94%20Missing%20final%20expression%20/%20nested%20definition%20error/near/413047874" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/.E2.9C.94.20Missing.20final.20expression.20.2F.20nested.20definition.20error.html#413047874">(Jan 16 2024 at 00:07)</a>:</h4>
<p>That said, this isn't the root of the specific error message linked above</p>



<a name="413047975"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/%E2%9C%94%20Missing%20final%20expression%20/%20nested%20definition%20error/near/413047975" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/.E2.9C.94.20Missing.20final.20expression.20.2F.20nested.20definition.20error.html#413047975">(Jan 16 2024 at 00:08)</a>:</h4>
<p>Roc <code>if ... then else ...</code> blocks are expressions, not statements.</p>



<a name="413048014"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/%E2%9C%94%20Missing%20final%20expression%20/%20nested%20definition%20error/near/413048014" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/.E2.9C.94.20Missing.20final.20expression.20.2F.20nested.20definition.20error.html#413048014">(Jan 16 2024 at 00:08)</a>:</h4>
<p>You can't set a value in an <code>if</code> and then use the value after the <code>if</code>. In fact, there is no "after" the <code>if</code></p>



<a name="413048105"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/%E2%9C%94%20Missing%20final%20expression%20/%20nested%20definition%20error/near/413048105" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/.E2.9C.94.20Missing.20final.20expression.20.2F.20nested.20definition.20error.html#413048105">(Jan 16 2024 at 00:09)</a>:</h4>
<p>For example, this chunk of code:</p>
<div class="codehilite" data-code-language="Elm"><pre><span></span><code><span class="w">    </span><span class="kr">else</span><span class="w"> </span><span class="kr">if</span><span class="w"> </span><span class="nv">hasRhs</span><span class="w"> </span><span class="nv">tree</span><span class="w"> </span><span class="nv">index</span><span class="w"> </span><span class="kr">then</span><span class="w"> </span><span class="err">#</span><span class="w"> </span><span class="nv">tree</span><span class="w"> </span><span class="nv">with</span><span class="w"> </span><span class="nv">only</span><span class="w"> </span><span class="nv">right</span><span class="w"> </span><span class="nv">subtree</span>
<span class="w">        </span><span class="kr">if</span><span class="w"> </span><span class="nv">resultVal</span><span class="w"> </span><span class="nf">==</span><span class="w"> </span><span class="kt">Ok</span><span class="w"> </span><span class="nv">val</span><span class="w"> </span><span class="kr">then</span><span class="w"> </span><span class="err">#</span><span class="w"> </span><span class="nv">should</span><span class="w"> </span><span class="nv">always</span><span class="w"> </span><span class="nv">be</span><span class="w"> </span><span class="nv">true</span>
<span class="w">            </span><span class="nv">valsListWithCurrent</span><span class="w"> </span><span class="nf">=</span><span class="w"> </span><span class="nv">valsList</span><span class="w"> </span><span class="nf">|&gt;</span><span class="w"> </span><span class="kt">List</span><span class="nf">.</span><span class="nv">append</span><span class="w"> </span><span class="nv">val</span>
<span class="w">        </span><span class="kr">else</span>
<span class="w">            </span><span class="nv">crash</span><span class="w"> </span><span class="s">"Expected a value at index \(index)"</span>
<span class="w">        </span><span class="nv">inorderTraversalRecur</span><span class="w"> </span><span class="nv">tree</span><span class="w"> </span><span class="p">(</span><span class="nv">getRhsIdx</span><span class="w"> </span><span class="nv">index</span><span class="p">)</span><span class="w"> </span><span class="nv">valsListWithCurrent</span><span class="w"> </span><span class="err">#</span><span class="w"> </span><span class="nv">finish</span><span class="w"> </span><span class="nv">right</span><span class="w"> </span><span class="nv">subtree</span>
</code></pre></div>
<p>Should probably be:</p>
<div class="codehilite" data-code-language="Elm"><pre><span></span><code><span class="w">    </span><span class="kr">else</span><span class="w"> </span><span class="kr">if</span><span class="w"> </span><span class="nv">hasRhs</span><span class="w"> </span><span class="nv">tree</span><span class="w"> </span><span class="nv">index</span><span class="w"> </span><span class="kr">then</span><span class="w"> </span><span class="err">#</span><span class="w"> </span><span class="nv">tree</span><span class="w"> </span><span class="nv">with</span><span class="w"> </span><span class="nv">only</span><span class="w"> </span><span class="nv">right</span><span class="w"> </span><span class="nv">subtree</span>
<span class="w">        </span><span class="kr">if</span><span class="w"> </span><span class="nv">resultVal</span><span class="w"> </span><span class="nf">==</span><span class="w"> </span><span class="kt">Ok</span><span class="w"> </span><span class="nv">val</span><span class="w"> </span><span class="kr">then</span><span class="w"> </span><span class="err">#</span><span class="w"> </span><span class="nv">should</span><span class="w"> </span><span class="nv">always</span><span class="w"> </span><span class="nv">be</span><span class="w"> </span><span class="nv">true</span>
<span class="w">            </span><span class="nv">valsListWithCurrent</span><span class="w"> </span><span class="nf">=</span><span class="w"> </span><span class="nv">valsList</span><span class="w"> </span><span class="nf">|&gt;</span><span class="w"> </span><span class="kt">List</span><span class="nf">.</span><span class="nv">append</span><span class="w"> </span><span class="nv">val</span>
<span class="w">            </span><span class="nv">inorderTraversalRecur</span><span class="w"> </span><span class="nv">tree</span><span class="w"> </span><span class="p">(</span><span class="nv">getRhsIdx</span><span class="w"> </span><span class="nv">index</span><span class="p">)</span><span class="w"> </span><span class="nv">valsListWithCurrent</span><span class="w"> </span><span class="err">#</span><span class="w"> </span><span class="nv">finish</span><span class="w"> </span><span class="nv">right</span><span class="w"> </span><span class="nv">subtree</span>
<span class="w">        </span><span class="kr">else</span>
<span class="w">            </span><span class="nv">crash</span><span class="w"> </span><span class="s">"Expected a value at index \(index)"</span>
</code></pre></div>



<a name="413048284"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/%E2%9C%94%20Missing%20final%20expression%20/%20nested%20definition%20error/near/413048284" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/.E2.9C.94.20Missing.20final.20expression.20.2F.20nested.20definition.20error.html#413048284">(Jan 16 2024 at 00:10)</a>:</h4>
<p>Another alternative would be to make the if expression return the value directly:</p>
<div class="codehilite" data-code-language="Elm"><pre><span></span><code><span class="w">    </span><span class="kr">else</span><span class="w"> </span><span class="kr">if</span><span class="w"> </span><span class="nv">hasRhs</span><span class="w"> </span><span class="nv">tree</span><span class="w"> </span><span class="nv">index</span><span class="w"> </span><span class="kr">then</span><span class="w"> </span><span class="err">#</span><span class="w"> </span><span class="nv">tree</span><span class="w"> </span><span class="nv">with</span><span class="w"> </span><span class="nv">only</span><span class="w"> </span><span class="nv">right</span><span class="w"> </span><span class="nv">subtree</span>
<span class="w">        </span><span class="nv">valsListWithCurrent</span><span class="w"> </span><span class="nf">=</span>
<span class="w">            </span><span class="kr">if</span><span class="w"> </span><span class="nv">resultVal</span><span class="w"> </span><span class="nf">==</span><span class="w"> </span><span class="kt">Ok</span><span class="w"> </span><span class="nv">val</span><span class="w"> </span><span class="kr">then</span><span class="w"> </span><span class="err">#</span><span class="w"> </span><span class="nv">should</span><span class="w"> </span><span class="nv">always</span><span class="w"> </span><span class="nv">be</span><span class="w"> </span><span class="nv">true</span>
<span class="w">                </span><span class="nv">valsList</span><span class="w"> </span><span class="nf">|&gt;</span><span class="w"> </span><span class="kt">List</span><span class="nf">.</span><span class="nv">append</span><span class="w"> </span><span class="nv">val</span>
<span class="w">            </span><span class="kr">else</span>
<span class="w">                </span><span class="nv">crash</span><span class="w"> </span><span class="s">"Expected a value at index \(index)"</span>
<span class="w">        </span><span class="nv">inorderTraversalRecur</span><span class="w"> </span><span class="nv">tree</span><span class="w"> </span><span class="p">(</span><span class="nv">getRhsIdx</span><span class="w"> </span><span class="nv">index</span><span class="p">)</span><span class="w"> </span><span class="nv">valsListWithCurrent</span><span class="w"> </span><span class="err">#</span><span class="w"> </span><span class="nv">finish</span><span class="w"> </span><span class="nv">right</span><span class="w"> </span><span class="nv">subtree</span>
</code></pre></div>



<a name="413048330"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/%E2%9C%94%20Missing%20final%20expression%20/%20nested%20definition%20error/near/413048330" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/.E2.9C.94.20Missing.20final.20expression.20.2F.20nested.20definition.20error.html#413048330">(Jan 16 2024 at 00:11)</a>:</h4>
<p>I feel like I need to figure out better wording to explain this, but hopefully the example helps</p>



<a name="413048483"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/%E2%9C%94%20Missing%20final%20expression%20/%20nested%20definition%20error/near/413048483" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/.E2.9C.94.20Missing.20final.20expression.20.2F.20nested.20definition.20error.html#413048483">(Jan 16 2024 at 00:12)</a>:</h4>
<p>Note: for those examples above, still need to change to a <code>when ... is</code> to get the value out of the tag union.</p>



<a name="413049011"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/%E2%9C%94%20Missing%20final%20expression%20/%20nested%20definition%20error/near/413049011" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ian McLerran <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/.E2.9C.94.20Missing.20final.20expression.20.2F.20nested.20definition.20error.html#413049011">(Jan 16 2024 at 00:16)</a>:</h4>
<p>No your explanation is perfect. I actually knew that, just completely spaced on the fact that if blocks are statements.</p>



<a name="413049051"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/%E2%9C%94%20Missing%20final%20expression%20/%20nested%20definition%20error/near/413049051" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ian McLerran <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/.E2.9C.94.20Missing.20final.20expression.20.2F.20nested.20definition.20error.html#413049051">(Jan 16 2024 at 00:16)</a>:</h4>
<p>When blocks are also statements, correct?</p>



<a name="413049199"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/%E2%9C%94%20Missing%20final%20expression%20/%20nested%20definition%20error/near/413049199" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/.E2.9C.94.20Missing.20final.20expression.20.2F.20nested.20definition.20error.html#413049199">(Jan 16 2024 at 00:17)</a>:</h4>
<p>Neither are statements, they are both expresssions.</p>
<p>So neither stands alone like in an imperative language. They are always returning some sort of value from each branch.</p>



<a name="413049542"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/%E2%9C%94%20Missing%20final%20expression%20/%20nested%20definition%20error/near/413049542" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ian McLerran <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/.E2.9C.94.20Missing.20final.20expression.20.2F.20nested.20definition.20error.html#413049542">(Jan 16 2024 at 00:19)</a>:</h4>
<p>Haha yes... dyslexic... "left = right", "expression = statement" <span aria-label="rolling eyes" class="emoji emoji-1f644" role="img" title="rolling eyes">:rolling_eyes:</span></p>



<a name="413050225"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/%E2%9C%94%20Missing%20final%20expression%20/%20nested%20definition%20error/near/413050225" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ian McLerran <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/.E2.9C.94.20Missing.20final.20expression.20.2F.20nested.20definition.20error.html#413050225">(Jan 16 2024 at 00:23)</a>:</h4>
<p>All issues fixed:</p>
<div class="codehilite" data-code-language="CoffeeScript"><pre><span></span><code><span class="nv">inorderTraversalRecur</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="nx">Tree</span><span class="w"> </span><span class="nx">a</span><span class="p">,</span><span class="w"> </span><span class="nx">Nat</span><span class="p">,</span><span class="w"> </span><span class="nx">List</span><span class="w"> </span><span class="nx">a</span><span class="w"> </span><span class="nf">-&gt;</span><span class="w"> </span><span class="nx">List</span><span class="w"> </span><span class="nx">a</span>
<span class="nv">inorderTraversalRecur</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="err">\</span><span class="nx">tree</span><span class="p">,</span><span class="w"> </span><span class="nx">index</span><span class="p">,</span><span class="w"> </span><span class="nx">valsList</span><span class="w"> </span><span class="nf">-&gt;</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">hasLhs</span><span class="w"> </span><span class="nx">tree</span><span class="w"> </span><span class="nx">index</span><span class="w"> </span><span class="k">then</span><span class="w"> </span><span class="c1"># tree with left subtree</span>
<span class="w">        </span><span class="nv">valsListWithLeft</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">inorderTraversalRecur</span><span class="w"> </span><span class="nx">tree</span><span class="w"> </span><span class="p">(</span><span class="nx">getLhsIdx</span><span class="w"> </span><span class="nx">index</span><span class="p">)</span><span class="w"> </span><span class="nx">valsList</span>
<span class="w">        </span><span class="k">when</span><span class="w"> </span><span class="nx">getValAtIdx</span><span class="w"> </span><span class="nx">tree</span><span class="w"> </span><span class="nx">index</span><span class="w"> </span><span class="o">is</span><span class="w"> </span><span class="c1"># should always be Ok</span>
<span class="w">            </span><span class="nx">Ok</span><span class="w"> </span><span class="nx">val</span><span class="w"> </span><span class="nf">-&gt;</span>
<span class="w">                </span><span class="nv">valsListWithCurrent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">valsListWithLeft</span><span class="w"> </span><span class="o">|&gt;</span><span class="w"> </span><span class="nx">List</span><span class="p">.</span><span class="nx">append</span><span class="w"> </span><span class="nx">val</span>
<span class="w">                </span><span class="k">if</span><span class="w"> </span><span class="nx">hasRhs</span><span class="w"> </span><span class="nx">tree</span><span class="w"> </span><span class="nx">index</span><span class="w"> </span><span class="k">then</span><span class="w"> </span><span class="c1"># tree with left and right subtree</span>
<span class="w">                    </span><span class="nx">inorderTraversalRecur</span><span class="w"> </span><span class="nx">tree</span><span class="w"> </span><span class="p">(</span><span class="nx">getRhsIdx</span><span class="w"> </span><span class="nx">index</span><span class="p">)</span><span class="w"> </span><span class="nx">valsListWithCurrent</span>
<span class="w">                </span><span class="k">else</span>
<span class="w">                    </span><span class="nx">valsListWithCurrent</span><span class="w"> </span><span class="c1"># tree with only left subtree</span>
<span class="w">            </span><span class="nx">Err</span><span class="w"> </span><span class="nx">_</span><span class="w"> </span><span class="nf">-&gt;</span><span class="w"> </span><span class="nx">crash</span><span class="w"> </span><span class="s">"Expected a value at index \(Num.toStr index)"</span>
<span class="w">    </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="nx">hasRhs</span><span class="w"> </span><span class="nx">tree</span><span class="w"> </span><span class="nx">index</span><span class="w"> </span><span class="k">then</span><span class="w"> </span><span class="c1"># tree with only right subtree</span>
<span class="w">        </span><span class="k">when</span><span class="w"> </span><span class="nx">getValAtIdx</span><span class="w"> </span><span class="nx">tree</span><span class="w"> </span><span class="nx">index</span><span class="w"> </span><span class="o">is</span><span class="w"> </span><span class="c1"># should always be Ok</span>
<span class="w">            </span><span class="nx">Ok</span><span class="w"> </span><span class="nx">val</span><span class="w"> </span><span class="nf">-&gt;</span>
<span class="w">                </span><span class="nv">valsListWithCurrent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">valsList</span><span class="w"> </span><span class="o">|&gt;</span><span class="w"> </span><span class="nx">List</span><span class="p">.</span><span class="nx">append</span><span class="w"> </span><span class="nx">val</span>
<span class="w">                </span><span class="nx">inorderTraversalRecur</span><span class="w"> </span><span class="nx">tree</span><span class="w"> </span><span class="p">(</span><span class="nx">getRhsIdx</span><span class="w"> </span><span class="nx">index</span><span class="p">)</span><span class="w"> </span><span class="nx">valsListWithCurrent</span><span class="w"> </span><span class="c1"># finish right subtree</span>
<span class="w">            </span><span class="nx">Err</span><span class="w"> </span><span class="nx">_</span><span class="w"> </span><span class="nf">-&gt;</span><span class="w"> </span><span class="nx">crash</span><span class="w"> </span><span class="s">"Expected a value at index \(Num.toStr index)"</span>
<span class="w">    </span><span class="k">else</span>
<span class="w">        </span><span class="k">when</span><span class="w"> </span><span class="nx">getValAtIdx</span><span class="w"> </span><span class="nx">tree</span><span class="w"> </span><span class="nx">index</span><span class="w"> </span><span class="o">is</span><span class="w"> </span><span class="c1"># leaf node</span>
<span class="w">            </span><span class="nx">Ok</span><span class="w"> </span><span class="nx">val</span><span class="w"> </span><span class="nf">-&gt;</span><span class="w"> </span><span class="nx">valsList</span><span class="w"> </span><span class="o">|&gt;</span><span class="w"> </span><span class="nx">List</span><span class="p">.</span><span class="nx">append</span><span class="w"> </span><span class="nx">val</span><span class="w"> </span><span class="c1"># should always be Ok</span>
<span class="w">            </span><span class="nx">Err</span><span class="w"> </span><span class="nx">_</span><span class="w"> </span><span class="nf">-&gt;</span><span class="w"> </span><span class="nx">crash</span><span class="w"> </span><span class="s">"Expected a value at index \(Num.toStr index)"</span>
</code></pre></div>



<a name="413051624"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/%E2%9C%94%20Missing%20final%20expression%20/%20nested%20definition%20error/near/413051624" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/.E2.9C.94.20Missing.20final.20expression.20.2F.20nested.20definition.20error.html#413051624">(Jan 16 2024 at 00:31)</a>:</h4>
<p>You may get simpler/cleaner code if you switch to always recursing down both the left and the right side.</p>
<p>Then as the first part of the recurse, you check if the current node exits. If it doesn't, early return.<br>
I think that would remove some duplicate logic.</p>
<p>Of course could always just pull that logic into a helper if wanted</p>



<a name="413052067"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/%E2%9C%94%20Missing%20final%20expression%20/%20nested%20definition%20error/near/413052067" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ian McLerran <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/.E2.9C.94.20Missing.20final.20expression.20.2F.20nested.20definition.20error.html#413052067">(Jan 16 2024 at 00:33)</a>:</h4>
<p>Great point. Gonna do exactly that. <span aria-label="working on it" class="emoji emoji-1f6e0" role="img" title="working on it">:working_on_it:</span></p>



<a name="413061150"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/%E2%9C%94%20Missing%20final%20expression%20/%20nested%20definition%20error/near/413061150" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ian McLerran <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/.E2.9C.94.20Missing.20final.20expression.20.2F.20nested.20definition.20error.html#413061150">(Jan 16 2024 at 01:37)</a>:</h4>
<p>Refactored version is much cleaner:</p>
<div class="codehilite" data-code-language="CoffeeScript"><pre><span></span><code><span class="nv">inorderTraversalRecur</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="nx">Tree</span><span class="w"> </span><span class="nx">a</span><span class="p">,</span><span class="w"> </span><span class="nx">Nat</span><span class="p">,</span><span class="w"> </span><span class="nx">List</span><span class="w"> </span><span class="nx">a</span><span class="w"> </span><span class="nf">-&gt;</span><span class="w"> </span><span class="nx">List</span><span class="w"> </span><span class="nx">a</span><span class="w"> </span><span class="nx">where</span><span class="w"> </span><span class="nx">a</span><span class="w"> </span><span class="nx">implements</span><span class="w"> </span><span class="nx">Inspect</span><span class="p">.</span><span class="nx">Inspect</span>
<span class="nv">inorderTraversalRecur</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="err">\</span><span class="nx">tree</span><span class="p">,</span><span class="w"> </span><span class="nx">index</span><span class="p">,</span><span class="w"> </span><span class="nx">valsList</span><span class="w"> </span><span class="nf">-&gt;</span>
<span class="w">    </span><span class="k">when</span><span class="w"> </span><span class="nx">getValAtIdx</span><span class="w"> </span><span class="nx">tree</span><span class="w"> </span><span class="nx">index</span><span class="w"> </span><span class="o">is</span>
<span class="w">        </span><span class="nx">Ok</span><span class="w"> </span><span class="nx">val</span><span class="w"> </span><span class="nf">-&gt;</span>
<span class="w">            </span><span class="nv">valsListWithLeft</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">inorderTraversalRecur</span><span class="w"> </span><span class="nx">tree</span><span class="w"> </span><span class="p">(</span><span class="nx">getLhsIdx</span><span class="w"> </span><span class="nx">index</span><span class="p">)</span><span class="w"> </span><span class="nx">valsList</span>
<span class="w">            </span><span class="nv">valsListWithCurrent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">valsListWithLeft</span><span class="w"> </span><span class="o">|&gt;</span><span class="w"> </span><span class="nx">List</span><span class="p">.</span><span class="nx">append</span><span class="w"> </span><span class="nx">val</span>
<span class="w">            </span><span class="nx">inorderTraversalRecur</span><span class="w"> </span><span class="nx">tree</span><span class="w"> </span><span class="p">(</span><span class="nx">getRhsIdx</span><span class="w"> </span><span class="nx">index</span><span class="p">)</span><span class="w"> </span><span class="nx">valsListWithCurrent</span>
<span class="w">        </span><span class="nx">Err</span><span class="w"> </span><span class="nx">_</span><span class="w"> </span><span class="nf">-&gt;</span><span class="w"> </span><span class="nx">valsList</span>
</code></pre></div>



<a name="413063864"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/%E2%9C%94%20Missing%20final%20expression%20/%20nested%20definition%20error/near/413063864" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/.E2.9C.94.20Missing.20final.20expression.20.2F.20nested.20definition.20error.html#413063864">(Jan 16 2024 at 01:59)</a>:</h4>
<p>Wow. Did not realize it would be that level of reduction. Awesome!</p>



<a name="413070227"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/%E2%9C%94%20Missing%20final%20expression%20/%20nested%20definition%20error/near/413070227" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ian McLerran <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/.E2.9C.94.20Missing.20final.20expression.20.2F.20nested.20definition.20error.html#413070227">(Jan 16 2024 at 02:59)</a>:</h4>
<p>Haha yeah, that was a very good call! So many unnecessary branches!</p>



<a name="413070235"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/%E2%9C%94%20Missing%20final%20expression%20/%20nested%20definition%20error/near/413070235" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Notification Bot <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/.E2.9C.94.20Missing.20final.20expression.20.2F.20nested.20definition.20error.html#413070235">(Jan 16 2024 at 02:59)</a>:</h4>
<p><span class="user-mention silent" data-user-id="518883">Ian McLerran</span> has marked this topic as resolved.</p>



<hr><p>Last updated: Nov 01 2025 at 12:13 UTC</p>
</html>