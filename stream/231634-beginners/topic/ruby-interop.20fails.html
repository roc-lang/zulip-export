<html>
<head><meta charset="utf-8"><title>ruby-interop fails Â· beginners Â· Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/index.html">beginners</a></h2>
<h3>Topic: <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/ruby-interop.20fails.html">ruby-interop fails</a></h3>

<hr>

<base href="https://roc.zulipchat.com">

<head><link href="https://roc-lang.github.io/zulip-export/style.css" rel="stylesheet"></head>

<a name="327660265"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/ruby-interop%20fails/near/327660265" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> dank <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/ruby-interop.20fails.html#327660265">(Feb 13 2023 at 22:45)</a>:</h4>
<div class="codehilite"><pre><span></span><code>[nix-shell:~/dev/roc/examples]$ cd ruby-interop/ &amp;&amp; ../../target/release/roc build --lib
0 errors and 0 warnings found in 194 ms while successfully building:

    libhello

[nix-shell:~/dev/roc/examples/ruby-interop]$ ruby extconf.rb
checking for -lhello... no
creating extconf.h
creating Makefile

[nix-shell:~/dev/roc/examples/ruby-interop]$ make
compiling demo.c
linking shared-object demo.so

[nix-shell:~/dev/roc/examples/ruby-interop]$ irb
irb(main):001:0&gt; require_relative &#39;demo&#39;
Traceback (most recent call last):
        5: from /nix/store/2xvc6i6dnar93p1wvh335jjsgmmjqg5c-ruby-2.7.7/bin/irb:23:in `&lt;main&gt;&#39;
        4: from /nix/store/2xvc6i6dnar93p1wvh335jjsgmmjqg5c-ruby-2.7.7/bin/irb:23:in `load&#39;
        3: from /nix/store/2xvc6i6dnar93p1wvh335jjsgmmjqg5c-ruby-2.7.7/lib/ruby/gems/2.7.0/gems/irb-1.2.6/exe/irb:11:in `&lt;top (required)&gt;&#39;
        2: from (irb):1
        1: from (irb):1:in `require_relative&#39;
LoadError (/home/dankey/dev/roc/examples/ruby-interop/demo.so: undefined symbol: roc__mainForHost_1_exposed_generic - /home/dankey/dev/roc/examples/ruby-interop/demo.so)
</code></pre></div>
<p>I think i did everything right?</p>
<div class="codehilite"><pre><span></span><code>ruby 2.7.7p221 (2022-11-24 revision 168ec2b1e5) [x86_64-linux]
clang version 13.0.1
GNU Make 4.3
</code></pre></div>
<p>i actually am not sure how that's supposed to work<br>
both host.c and demo.c are declaring an external <code>roc__mainForHost_1_exposed_generic</code>,  but who implements it? <span aria-label="thinking" class="emoji emoji-1f914" role="img" title="thinking">:thinking:</span></p>



<a name="327661456"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/ruby-interop%20fails/near/327661456" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Carroll <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/ruby-interop.20fails.html#327661456">(Feb 13 2023 at 22:54)</a>:</h4>
<p>The Roc app implements it. In the Roc code it would just be called <code>mainForHost</code></p>



<a name="327671926"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/ruby-interop%20fails/near/327671926" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/ruby-interop.20fails.html#327671926">(Feb 14 2023 at 00:22)</a>:</h4>
<p>hm, so it looks like <code>extconf.rb</code> isn't finding <code>libhello</code></p>



<a name="327671934"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/ruby-interop%20fails/near/327671934" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/ruby-interop.20fails.html#327671934">(Feb 14 2023 at 00:22)</a>:</h4>
<p>when I run it, I get this:</p>
<div class="codehilite"><pre><span></span><code>$ ruby extconf.rb
checking for -lhello... yes
creating extconf.h
creating Makefile
</code></pre></div>



<a name="327671960"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/ruby-interop%20fails/near/327671960" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/ruby-interop.20fails.html#327671960">(Feb 14 2023 at 00:22)</a>:</h4>
<p>so <code>yes</code> instead of <code>no</code> after <code>checking for -lhello</code></p>



<a name="327671980"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/ruby-interop%20fails/near/327671980" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/ruby-interop.20fails.html#327671980">(Feb 14 2023 at 00:22)</a>:</h4>
<p>admittedly I haven't tried it on NixOS</p>



<a name="327672049"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/ruby-interop%20fails/near/327672049" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/ruby-interop.20fails.html#327672049">(Feb 14 2023 at 00:23)</a>:</h4>
<p>so maybe <code>extconf.rb</code> is passing <code>-lhello</code> to <code>clang</code> or <code>ld</code> or something, and on NixOS it doesn't look in the current directory for a <code>libhello</code>?</p>



<a name="327672072"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/ruby-interop%20fails/near/327672072" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/ruby-interop.20fails.html#327672072">(Feb 14 2023 at 00:23)</a>:</h4>
<p>or maybe it needs a different file extension on <code>libhello</code>?</p>



<a name="327716954"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/ruby-interop%20fails/near/327716954" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> dank <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/ruby-interop.20fails.html#327716954">(Feb 14 2023 at 08:34)</a>:</h4>
<p><span class="user-mention silent" data-user-id="281383">Richard Feldman</span> <a href="#narrow/stream/231634-beginners/topic/ruby-interop.20fails/near/327672072">said</a>:</p>
<blockquote>
<p>or maybe it needs a different file extension on <code>libhello</code>?</p>
</blockquote>
<p>yea that's what i suspected. there's <code>libhello.so.1.0</code>. not sure how to validate that that's what wrong</p>
<p>also it might be a nixos thing, yes</p>



<a name="327717205"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/ruby-interop%20fails/near/327717205" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> dank <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/ruby-interop.20fails.html#327717205">(Feb 14 2023 at 08:36)</a>:</h4>
<p>BTW full discretion I actually barely know ruby at all, but I figured if i can get it working and understand how it works, I might be able to replicate your work for a python-interop, which shouldn't be that hard</p>



<a name="327717465"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/ruby-interop%20fails/near/327717465" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> dank <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/ruby-interop.20fails.html#327717465">(Feb 14 2023 at 08:38)</a>:</h4>
<p>in the meantime I'll maybe test on my debian machine to see if it actually is just a nixos thing</p>



<a name="327721177"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/ruby-interop%20fails/near/327721177" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> dank <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/ruby-interop.20fails.html#327721177">(Feb 14 2023 at 08:58)</a>:</h4>
<p>also changing the extension to <a href="http://libhello.so">libhello.so</a> etc doesn't make a difference ruby still doesn't get it<br>
i figured maybe playing with <code>dir_config</code> would solve it but doesnt seem so <br>
(even creating a lib dir and moving <a href="http://libhello.so">libhello.so</a> there, weird stuff)</p>



<a name="327731306"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/ruby-interop%20fails/near/327731306" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> dank <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/ruby-interop.20fails.html#327731306">(Feb 14 2023 at 09:49)</a>:</h4>
<p>doesn't work on debian either<br>
(as in nixos it says no after checking for -lhello)</p>



<a name="327731399"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/ruby-interop%20fails/near/327731399" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> dank <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/ruby-interop.20fails.html#327731399">(Feb 14 2023 at 09:49)</a>:</h4>
<p>I assume <span class="user-mention" data-user-id="281383">@Richard Feldman</span> you're using macos?</p>



<a name="327776608"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/ruby-interop%20fails/near/327776608" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/ruby-interop.20fails.html#327776608">(Feb 14 2023 at 13:35)</a>:</h4>
<p>yup, interesting</p>



<a name="327776730"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/ruby-interop%20fails/near/327776730" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/ruby-interop.20fails.html#327776730">(Feb 14 2023 at 13:36)</a>:</h4>
<p>one of my coworkers get it working at NoRedInk on Linux, but I forget what the trick was</p>



<a name="327776794"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/ruby-interop%20fails/near/327776794" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/ruby-interop.20fails.html#327776794">(Feb 14 2023 at 13:36)</a>:</h4>
<p>I think it had to do with file extension though - did you try <code>libhello.so.1</code>?</p>



<a name="327776883"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/ruby-interop%20fails/near/327776883" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/ruby-interop.20fails.html#327776883">(Feb 14 2023 at 13:36)</a>:</h4>
<p>cc <span class="user-mention" data-user-id="524658">@Juliano</span></p>



<a name="327784142"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/ruby-interop%20fails/near/327784142" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> dank <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/ruby-interop.20fails.html#327784142">(Feb 14 2023 at 14:09)</a>:</h4>
<p><span class="user-mention silent" data-user-id="281383">Richard Feldman</span> <a href="#narrow/stream/231634-beginners/topic/ruby-interop.20fails/near/327776794">said</a>:</p>
<blockquote>
<p>I think it had to do with file extension though - did you try <code>libhello.so.1</code>?</p>
</blockquote>
<p>yes. no change</p>



<a name="327791661"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/ruby-interop%20fails/near/327791661" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Juliano <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/ruby-interop.20fails.html#327791661">(Feb 14 2023 at 14:40)</a>:</h4>
<p>i don't remember hitting this <code>mainForHost</code> problem specifically</p>



<a name="327791847"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/ruby-interop%20fails/near/327791847" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Juliano <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/ruby-interop.20fails.html#327791847">(Feb 14 2023 at 14:40)</a>:</h4>
<p>lemme look at our setup to see what extra we got compared to dank's stuff</p>



<a name="327792299"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/ruby-interop%20fails/near/327792299" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Juliano <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/ruby-interop.20fails.html#327792299">(Feb 14 2023 at 14:42)</a>:</h4>
<p>we had to <code>ln -sf libhello.so.1.0 libhello.so.1</code> and <code>ln -sf libhello.so.1 libhello.so</code>, else <code>demo.so</code> wouldn't be properly linked (different error tho)</p>



<a name="327792530"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/ruby-interop%20fails/near/327792530" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Juliano <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/ruby-interop.20fails.html#327792530">(Feb 14 2023 at 14:43)</a>:</h4>
<p>On Linux, for this to work we also needed to set either <code>LD_LIBRARY_PATH</code> to this directory or <code>LD_PRELOAD</code> to the absolute path of <code>libhello.so</code></p>



<a name="327792782"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/ruby-interop%20fails/near/327792782" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Juliano <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/ruby-interop.20fails.html#327792782">(Feb 14 2023 at 14:44)</a>:</h4>
<p>i think patchelf could've helped avoid <code>LD_LIBRARY_PATH</code> stuff, but i was lazy</p>



<a name="327793384"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/ruby-interop%20fails/near/327793384" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Juliano <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/ruby-interop.20fails.html#327793384">(Feb 14 2023 at 14:47)</a>:</h4>
<p>it might be some difference in <code>demo.c</code>? also we're using a pretty old version of roc (3-4mo old?)</p>



<a name="327793511"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/ruby-interop%20fails/near/327793511" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Juliano <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/ruby-interop.20fails.html#327793511">(Feb 14 2023 at 14:47)</a>:</h4>
<p>this is my demo.c <a href="https://gist.github.com/omnibs/e6c09b8fee711549d7009e234c34f438">https://gist.github.com/omnibs/e6c09b8fee711549d7009e234c34f438</a></p>



<a name="327794400"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/ruby-interop%20fails/near/327794400" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Juliano <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/ruby-interop.20fails.html#327794400">(Feb 14 2023 at 14:50)</a>:</h4>
<p>might also be something with your roc lib's platform? our PoC used this: <a href="https://gist.github.com/omnibs/8cd4eedae5f4c645fc857c86bc213d6a">https://gist.github.com/omnibs/8cd4eedae5f4c645fc857c86bc213d6a</a></p>



<a name="327794516"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/ruby-interop%20fails/near/327794516" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Juliano <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/ruby-interop.20fails.html#327794516">(Feb 14 2023 at 14:51)</a>:</h4>
<p>then you use it in your lib's <code>main.roc</code> like so:</p>
<div class="codehilite"><pre><span></span><code>app &quot;libhello&quot;
    packages { pf: &quot;platform/main.roc&quot; }
    imports []
    provides [makeItRoc] to pf

makeItRoc : Str -&gt; Str
makeItRoc = \str -&gt;
    if Str.isEmpty str then
        &quot;I need a string here!&quot;
    else
        &quot;\(str), OH YEAH!!! ðŸ¤˜ðŸ¤˜&quot;
</code></pre></div>



<a name="327853391"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/ruby-interop%20fails/near/327853391" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> dank <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/ruby-interop.20fails.html#327853391">(Feb 14 2023 at 19:08)</a>:</h4>
<p>the other stuff mentioned didnt seem to make a difference but</p>
<div class="codehilite" data-code-language="Bash"><pre><span></span><code><span class="o">[</span>nix-shell:~/dev/roc/examples/ruby-interop<span class="o">]</span>$<span class="w"> </span><span class="nv">LD_PRELOAD</span><span class="o">=</span><span class="s2">"</span><span class="k">$(</span><span class="nb">pwd</span><span class="k">)</span><span class="s2">/libhello.so.1.0"</span><span class="w"> </span>ruby<span class="w"> </span>extconf.rb
ruby:<span class="w"> </span>symbol<span class="w"> </span>lookup<span class="w"> </span>error:<span class="w"> </span>/home/dankey/dev/roc/examples/ruby-interop/libhello.so.1.0:<span class="w"> </span>undefined<span class="w"> </span>symbol:<span class="w"> </span>roc_alloc
</code></pre></div>



<a name="328128102"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/ruby-interop%20fails/near/328128102" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> dank <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/ruby-interop.20fails.html#328128102">(Feb 15 2023 at 23:29)</a>:</h4>
<p>good news bad news<br>
bad news is that the ruby-interop doesn't work and idk how to make it work</p>
<p>good news:</p>



<a name="328128129"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/ruby-interop%20fails/near/328128129" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> dank <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/ruby-interop.20fails.html#328128129">(Feb 15 2023 at 23:30)</a>:</h4>
<p><a href="/user_uploads/22008/PFgeg1Y1QxjW2wFklE_G-cMS/image.png">image.png</a></p>
<div class="message_inline_image"><a href="/user_uploads/22008/PFgeg1Y1QxjW2wFklE_G-cMS/image.png" title="image.png"><img src="/user_uploads/22008/PFgeg1Y1QxjW2wFklE_G-cMS/image.png"></a></div>



<a name="328128178"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/ruby-interop%20fails/near/328128178" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> dank <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/ruby-interop.20fails.html#328128178">(Feb 15 2023 at 23:30)</a>:</h4>
<p>gottem</p>



<a name="328129094"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/ruby-interop%20fails/near/328129094" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/ruby-interop.20fails.html#328129094">(Feb 15 2023 at 23:38)</a>:</h4>
<p>haha. cool</p>



<a name="328132248"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/ruby-interop%20fails/near/328132248" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/ruby-interop.20fails.html#328132248">(Feb 16 2023 at 00:08)</a>:</h4>
<p>yooooo awesome!!!</p>



<a name="328132262"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/ruby-interop%20fails/near/328132262" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/ruby-interop.20fails.html#328132262">(Feb 16 2023 at 00:08)</a>:</h4>
<p>want to make a PR to add that to <code>examples</code>?</p>



<a name="328132281"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/ruby-interop%20fails/near/328132281" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/ruby-interop.20fails.html#328132281">(Feb 16 2023 at 00:09)</a>:</h4>
<p>that would be our second dynamic language interop example ever!</p>



<a name="328157857"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/ruby-interop%20fails/near/328157857" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/ruby-interop.20fails.html#328157857">(Feb 16 2023 at 05:43)</a>:</h4>
<p>Wow, this is very cool!!</p>



<a name="328272582"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/ruby-interop%20fails/near/328272582" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> dank <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/ruby-interop.20fails.html#328272582">(Feb 16 2023 at 15:51)</a>:</h4>
<p><span class="user-mention silent" data-user-id="281383">Richard Feldman</span> <a href="#narrow/stream/231634-beginners/topic/ruby-interop.20fails/near/328132262">said</a>:</p>
<blockquote>
<p>want to make a PR to add that to <code>examples</code>?</p>
</blockquote>
<p>PR's up :)</p>



<a name="328355604"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/ruby-interop%20fails/near/328355604" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> dank <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/ruby-interop.20fails.html#328355604">(Feb 16 2023 at 23:21)</a>:</h4>
<p><a href="/user_uploads/22008/4TOjtwlDHYy_VUSvYizDcfPl/image.png">image.png</a> <br>
why does it say it like that<br>
sounds so rude lol</p>
<div class="message_inline_image"><a href="/user_uploads/22008/4TOjtwlDHYy_VUSvYizDcfPl/image.png" title="image.png"><img src="/user_uploads/22008/4TOjtwlDHYy_VUSvYizDcfPl/image.png"></a></div>



<a name="328355730"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/ruby-interop%20fails/near/328355730" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> dank <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/ruby-interop.20fails.html#328355730">(Feb 16 2023 at 23:22)</a>:</h4>
<p>in any case <span class="user-mention" data-user-id="281383">@Richard Feldman</span> I added zulip link + some readme cleanup bc it seemed not great + some key notes on the demo.c implementation<br>
hope that's better</p>



<a name="328363209"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/ruby-interop%20fails/near/328363209" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/ruby-interop.20fails.html#328363209">(Feb 17 2023 at 00:27)</a>:</h4>
<p>looks great, thank you - approved!</p>



<a name="328536270"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/ruby-interop%20fails/near/328536270" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/ruby-interop.20fails.html#328536270">(Feb 17 2023 at 18:23)</a>:</h4>
<p>the ruby interop example is/was broken. I'm not sure it ever really worked</p>



<a name="328543778"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/ruby-interop%20fails/near/328543778" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/ruby-interop.20fails.html#328543778">(Feb 17 2023 at 19:04)</a>:</h4>
<p>it definitely did on a M1 Mac (I haven't tried recently though; it may have regressed), and Juliano and I used it to get Ruby interop working on NixOS</p>



<a name="328579223"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/ruby-interop%20fails/near/328579223" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> dank <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/ruby-interop.20fails.html#328579223">(Feb 17 2023 at 23:03)</a>:</h4>
<p>good thing I stumbled upon that ruby-interop example though</p>
<p><a href="/user_uploads/22008/2PXX6R4kdBeVLo7YjEdjnhMd/image.png">image.png</a> <br>
I'm no expert, but I'd say that's pretty dank</p>
<div class="message_inline_image"><a href="/user_uploads/22008/2PXX6R4kdBeVLo7YjEdjnhMd/image.png" title="image.png"><img src="/user_uploads/22008/2PXX6R4kdBeVLo7YjEdjnhMd/image.png"></a></div>



<a name="328592708"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/ruby-interop%20fails/near/328592708" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/ruby-interop.20fails.html#328592708">(Feb 18 2023 at 01:25)</a>:</h4>
<p>Lots of languages can speak c. Though some may make it hard to deal with more complex roc types</p>



<a name="328599290"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/ruby-interop%20fails/near/328599290" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/ruby-interop.20fails.html#328599290">(Feb 18 2023 at 03:02)</a>:</h4>
<p>yoooo that's awesome!!!</p>



<a name="328599321"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/ruby-interop%20fails/near/328599321" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/ruby-interop.20fails.html#328599321">(Feb 18 2023 at 03:02)</a>:</h4>
<p>is that using JNI?</p>



<a name="328629682"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/ruby-interop%20fails/near/328629682" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> dank <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/ruby-interop.20fails.html#328629682">(Feb 18 2023 at 09:04)</a>:</h4>
<p>yes indeed<br>
gotta say JNI is much nicer to work with than I anticipated</p>



<a name="328650068"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/ruby-interop%20fails/near/328650068" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> dank <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/ruby-interop.20fails.html#328650068">(Feb 18 2023 at 11:34)</a>:</h4>
<p>actually panama might be better for us<br>
cause jextract can auto generate the java glue</p>
<p>meaning the user wouldn't need to write any java (including the static load and native method decls)</p>
<p>so that he could, from any jvm lang at all (be it clojure scala or whatnot), build the deps and import functions from the java glue</p>



<a name="328652176"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/ruby-interop%20fails/near/328652176" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> dank <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/ruby-interop.20fails.html#328652176">(Feb 18 2023 at 11:47)</a>:</h4>
<p>also that would make it work for jshell<br>
bc jshell and JNI do not play nice as it turns out</p>



<a name="328705091"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/ruby-interop%20fails/near/328705091" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/ruby-interop.20fails.html#328705091">(Feb 18 2023 at 17:35)</a>:</h4>
<p>interesting! Would any of the JNI alternatives require a third-party dependency?</p>



<a name="328705173"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/ruby-interop%20fails/near/328705173" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/ruby-interop.20fails.html#328705173">(Feb 18 2023 at 17:36)</a>:</h4>
<p>when it comes to interop, I generally try to avoid third-party deps if possible</p>



<a name="328708927"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/ruby-interop%20fails/near/328708927" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> dank <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/ruby-interop.20fails.html#328708927">(Feb 18 2023 at 18:08)</a>:</h4>
<p>damn i thought it wouldn't but it seems that openjdk, even 19 only contains only the api for it, <br>
and the  jextract binary ships separately <br>
so it is kinda third party dep <a href="https://jdk.java.net/panama/">https://jdk.java.net/panama/</a></p>



<a name="328708993"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/ruby-interop%20fails/near/328708993" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> dank <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/ruby-interop.20fails.html#328708993">(Feb 18 2023 at 18:09)</a>:</h4>
<p>btw are you ok with having <a href="https://github.com/sheredom/json.h">https://github.com/sheredom/json.h</a> ?<br>
java doesn't have a json parser</p>



<a name="328709044"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/ruby-interop%20fails/near/328709044" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/ruby-interop.20fails.html#328709044">(Feb 18 2023 at 18:09)</a>:</h4>
<p>yeah seems reasonable as a starting point</p>



<a name="328709128"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/ruby-interop%20fails/near/328709128" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/ruby-interop.20fails.html#328709128">(Feb 18 2023 at 18:10)</a>:</h4>
<p>eventually JSON shouldn't be necessary, it's just a really convenient way to get interop with a given language up and running <span aria-label="big smile" class="emoji emoji-1f604" role="img" title="big smile">:big_smile:</span></p>



<a name="328709151"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/ruby-interop%20fails/near/328709151" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/ruby-interop.20fails.html#328709151">(Feb 18 2023 at 18:10)</a>:</h4>
<p>you mean for an <code>examples/</code> entry, yeah?</p>



<a name="328709159"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/ruby-interop%20fails/near/328709159" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> dank <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/ruby-interop.20fails.html#328709159">(Feb 18 2023 at 18:10)</a>:</h4>
<p>yea</p>



<a name="328709169"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/ruby-interop%20fails/near/328709169" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/ruby-interop.20fails.html#328709169">(Feb 18 2023 at 18:10)</a>:</h4>
<p>yeah sounds good!</p>



<a name="340237880"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/ruby-interop%20fails/near/340237880" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> dank <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/ruby-interop.20fails.html#340237880">(Mar 07 2023 at 23:56)</a>:</h4>
<p>just letting u know  i haven't forgot about the jvm-interop, just ran into some issues trying to generalize to langs like clojure<br>
right now kinda waiting for the headless release to come out so my mate who's a jvm god will help smooth out some rough jvm edges</p>



<a name="340251499"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/ruby-interop%20fails/near/340251499" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/ruby-interop.20fails.html#340251499">(Mar 08 2023 at 01:47)</a>:</h4>
<p>nice, thanks for the update - looking forward to it! <span aria-label="smiley" class="emoji emoji-1f603" role="img" title="smiley">:smiley:</span></p>



<a name="340303198"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/ruby-interop%20fails/near/340303198" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anton <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/ruby-interop.20fails.html#340303198">(Mar 08 2023 at 09:11)</a>:</h4>
<p>What OS is your friend using <span class="user-mention" data-user-id="583319">@dank</span>? I'll make sure to test the headless release on that OS once it's ready</p>



<a name="340303521"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/ruby-interop%20fails/near/340303521" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> dank <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/ruby-interop.20fails.html#340303521">(Mar 08 2023 at 09:13)</a>:</h4>
<p>debian</p>



<a name="341179735"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/ruby-interop%20fails/near/341179735" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> dank <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/ruby-interop.20fails.html#341179735">(Mar 11 2023 at 19:59)</a>:</h4>
<p>hello hello<br>
i think jvm-interop is ready<br>
<a href="https://github.com/dankeyy/roc/tree/jvm-interop/examples/jvm-interop">https://github.com/dankeyy/roc/tree/jvm-interop/examples/jvm-interop</a></p>
<p>tested on java kotlin and scala</p>
<p>couldn't get clojure to work because its import system is weird. <br>
people suggested all kinda import tools and deps which i didn't want to dive into. <br>
if anyone here though got a simple solution that'd be great</p>
<p>also i kinda ditched the json encoding part, hope that's ok (?)<br>
Was kinda trivial to just grab the bytes, but tell me if that's bad somehow and we can switch back</p>
<p>also have to say jvm Strings are an absolute meme <a href="https://docs.oracle.com/javase/1.5.0/docs/guide/jni/spec/types.html#wp16542">https://docs.oracle.com/javase/1.5.0/docs/guide/jni/spec/types.html#wp16542</a><br>
spent way too long trying to find a way around it that wouldn't require rewriting utf8 lmao, but i did find a pretty nice simple solution which is to convert it first into a java byte array, then to string. by that "outsourcing" the conversion to the jvm </p>
<p>so yea pretty fun.  tell me what you think, and ill pr if it's ready</p>



<a name="341179958"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/ruby-interop%20fails/near/341179958" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/ruby-interop.20fails.html#341179958">(Mar 11 2023 at 20:02)</a>:</h4>
<p><span class="user-mention silent" data-user-id="583319">dank</span> <a href="#narrow/stream/231634-beginners/topic/ruby-interop.20fails/near/341179735">said</a>:</p>
<blockquote>
<p>also i kinda ditched the json encoding part, hope that's ok (?)</p>
</blockquote>
<p>yeah totally! That was just a way to quickly get a more useful proof-of-concept than just sending (for example) strings or bytes across, without having to go as far as to write translations for all the target language's datatypes <span aria-label="sweat smile" class="emoji emoji-1f605" role="img" title="sweat smile">:sweat_smile:</span></p>



<a name="341179992"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/ruby-interop%20fails/near/341179992" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/ruby-interop.20fails.html#341179992">(Mar 11 2023 at 20:03)</a>:</h4>
<p>of course if you want a fully-featured interop, you'd need to actually do that (e.g. in the Ruby one, converting not just Ruby strings to/from Roc strings, but also Roc Lists to Ruby Arrays...etc)</p>



<a name="341180016"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/ruby-interop%20fails/near/341180016" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/ruby-interop.20fails.html#341180016">(Mar 11 2023 at 20:03)</a>:</h4>
<p>but you gotta start somewhere, and these examples that just demonstrate the interop with one datatype are still super useful!</p>



<a name="341180217"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/ruby-interop%20fails/near/341180217" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/ruby-interop.20fails.html#341180217">(Mar 11 2023 at 20:06)</a>:</h4>
<p>that totally looks ready to PR to me</p>



<a name="341180233"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/ruby-interop%20fails/near/341180233" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/ruby-interop.20fails.html#341180233">(Mar 11 2023 at 20:07)</a>:</h4>
<p>wow, I'm impressed by how little code it takes on the JVM side</p>



<a name="341180237"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/ruby-interop%20fails/near/341180237" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/ruby-interop.20fails.html#341180237">(Mar 11 2023 at 20:07)</a>:</h4>
<p>I was expecting a lot more!</p>



<a name="341180778"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/ruby-interop%20fails/near/341180778" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> dank <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/ruby-interop.20fails.html#341180778">(Mar 11 2023 at 20:13)</a>:</h4>
<p>yeaa, was really surprised by jni here<br>
also in the beginning the bridge function was more involved but i managed to cut some stuff out which was great</p>



<a name="341180939"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/ruby-interop%20fails/near/341180939" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> dank <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/ruby-interop.20fails.html#341180939">(Mar 11 2023 at 20:15)</a>:</h4>
<p><span class="user-mention silent" data-user-id="281383">Richard Feldman</span> <a href="#narrow/stream/231634-beginners/topic/ruby-interop.20fails/near/341180016">said</a>:</p>
<blockquote>
<p>but you gotta start somewhere, and these examples that just demonstrate the interop with one datatype are still super useful!</p>
</blockquote>
<p>yea it'd be nice if we'd have that but i feel like a break from jvm lol</p>
<p>so i say we pr it and if anyone here want to interop arrays too, build on it !</p>



<a name="341181081"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/ruby-interop%20fails/near/341181081" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/ruby-interop.20fails.html#341181081">(Mar 11 2023 at 20:17)</a>:</h4>
<p>yeah totally!</p>



<a name="341186565"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/ruby-interop%20fails/near/341186565" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> dank <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/ruby-interop.20fails.html#341186565">(Mar 11 2023 at 21:30)</a>:</h4>
<p>happy to say clojure example works aswell<br>
turns out in clojure u need to mention the path like so <code>clj -Sdeps '{:paths ["."]}'</code></p>



<a name="341186923"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/ruby-interop%20fails/near/341186923" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/ruby-interop.20fails.html#341186923">(Mar 11 2023 at 21:34)</a>:</h4>
<p>ooo nice!</p>



<a name="341889866"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/ruby-interop%20fails/near/341889866" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> dank <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/ruby-interop.20fails.html#341889866">(Mar 14 2023 at 19:47)</a>:</h4>
<p>so i wanna make the interops more complete and i have a couple questions</p>
<ol>
<li>
<p>what do you think are compelling function examples for interops?<br>
needs to be cool, but not too complex as to not distract from the subject<br>
something like take this java array + scalar and return a new java array with all elements multipled by the scalar?</p>
</li>
<li>
<p>to pass the platform a List &lt;N&gt;, I need a RocBytes+init_rocbytes of appropriate size, right?<br>
but what if i have a couple of those<br>
like i want List U8 and also List U32<br>
RocBytes can only have one definition <span aria-label="thinking" class="emoji emoji-1f914" role="img" title="thinking">:thinking:</span></p>
</li>
</ol>



<a name="341892266"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/ruby-interop%20fails/near/341892266" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> dank <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/ruby-interop.20fails.html#341892266">(Mar 14 2023 at 19:59)</a>:</h4>
<p>oh wait i might be dense<br>
The "RocBytes" name isn't demanded by the platform</p>
<p>yea nvm about the second point then<br>
I can just make RocBytesN structs and populate them however i want from roc side,  i think</p>



<a name="341912578"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/ruby-interop%20fails/near/341912578" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> dank <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/ruby-interop.20fails.html#341912578">(Mar 14 2023 at 21:57)</a>:</h4>
<p>i also understand host.c serves no purpose in my impl. kinda carried over from ruby interop (looking back im not even sure why it has a main)</p>
<p>like all of the necessary logic is in bridge.c<br>
<span class="user-mention" data-user-id="281383">@Richard Feldman</span> you know what im saying?</p>



<a name="341913357"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/ruby-interop%20fails/near/341913357" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> dank <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/ruby-interop.20fails.html#341913357">(Mar 14 2023 at 22:02)</a>:</h4>
<p>and if no decoding is necessary, then the indirection between platform/main.roc and main.roc is redundant (all the platform/main.roc) does it call the app's function</p>



<a name="341913579"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/ruby-interop%20fails/near/341913579" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> dank <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/ruby-interop.20fails.html#341913579">(Mar 14 2023 at 22:04)</a>:</h4>
<p>rather it's not that the platform is redundant<br>
it's that the app isn't really an app, it just serves like a proxy here</p>
<p>it might just be that a language interop is a special case but it seems to me that here, all logic is platform logic</p>



<a name="341913704"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/ruby-interop%20fails/near/341913704" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> dank <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/ruby-interop.20fails.html#341913704">(Mar 14 2023 at 22:05)</a>:</h4>
<p>to make a long story short i feel like all that is needed here is one .c file and one .roc file</p>



<hr><p>Last updated: Mar 01 2026 at 12:20 UTC</p>
</html>