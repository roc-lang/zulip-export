<html>
<head><meta charset="utf-8"><title>json parser · beginners · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/index.html">beginners</a></h2>
<h3>Topic: <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/json.20parser.html">json parser</a></h3>

<hr>

<base href="https://roc.zulipchat.com">

<head><link href="https://roc-lang.github.io/zulip-export/style.css" rel="stylesheet"></head>

<a name="264797154"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/json%20parser/near/264797154" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Warner <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/json.20parser.html#264797154">(Dec 14 2021 at 01:59)</a>:</h4>
<p>Thinking about tackling a json parser library for roc; does that seem overly ambitious at this point? Any tips on the best way to lay out the interface? For instance, I see <code>packages/parser</code>; would it be appropriate to base things on that?</p>



<a name="264802401"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/json%20parser/near/264802401" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lucas Rosa <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/json.20parser.html#264802401">(Dec 14 2021 at 03:06)</a>:</h4>
<p>You should be fine. I think you just need stuff from the Str module for that</p>



<a name="264802446"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/json%20parser/near/264802446" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lucas Rosa <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/json.20parser.html#264802446">(Dec 14 2021 at 03:06)</a>:</h4>
<p>it could also be a good stress test and uncover some more bugs</p>



<a name="264802480"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/json%20parser/near/264802480" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lucas Rosa <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/json.20parser.html#264802480">(Dec 14 2021 at 03:07)</a>:</h4>
<p>I remember some discussion around encoders and decoders but I forget where that went.</p>



<a name="264809041"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/json%20parser/near/264809041" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Warner <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/json.20parser.html#264809041">(Dec 14 2021 at 04:22)</a>:</h4>
<p>Fun times! Pretty sure I hit a compiler bug already.<br>
Here's the code:</p>
<div class="codehilite"><pre><span></span><code>#!/usr/bin/env roc

app &quot;json&quot;
    packages { base: &quot;platform&quot;, }
    imports [
        base.Task.{ Task, await },
        base.Stdout,
    ]
    provides [ main ] to base

main : Task {} *
main =
    {} &lt;- await (Stdout.line &quot;ready&quot;)

    parsed = Number (42)
    serialized = formatJson parsed

    # If instead of the above two lines, I do the following, things work fine:
    # serialized = formatJson (Number (42))

    Stdout.line serialized

JsonValue : [
    Number I64,
    String Str,]

formatJson: JsonValue -&gt; Str
formatJson = \value -&gt;
    when value is
        Number n -&gt; Num.toStr n
        String s -&gt; Str.concat &quot;\&quot;&quot; (Str.concat (escape s) &quot;\&quot;&quot;)

escape: Str -&gt; Str
escape = \text -&gt; text # TODO
</code></pre></div>
<p>Here's the error:</p>
<div class="codehilite"><pre><span></span><code>joshw@Joshuas-MacBook-Air ~/s/g/r/roc (joshuawarner32/extract-spaced-enum-2) [101]&gt; cargo run -- examples/cli/Json.roc
    Finished dev [unoptimized + debuginfo] target(s) in 0.38s
     Running `target/debug/roc examples/cli/Json.roc`
[compiler/load/src/file.rs:2606] loc_package_entry = |L 3-3, C 15-31| PackageEntry {
    shorthand: &quot;base&quot;,
    spaces_after_shorthand: [],
    package_or_path: |L 3-3, C 21-31| Path(
        PlainLine(
            &quot;platform&quot;,
        ),
    ),
}
[compiler/load/src/file.rs:2608] existing_package = &quot;base&quot;
thread &#39;main&#39; panicked at &#39;Error in alias analysis: error in module ModName(&quot;UserApp&quot;), function definition FuncName(&quot;\x08\x00\x00\x00\x04\x00\x00\x00}\x0b\x1fU\xbe,v\x90&quot;), definition of value binding ValueId(4): expected type &#39;(union { ((),), ((heap_cell,),) },)&#39;, found type &#39;((),)&#39;&#39;, compiler/gen_llvm/src/llvm/build.rs:4051:19
stack backtrace:
🔨 Rebuilding host... Done!
   0: rust_begin_unwind
             at /rustc/f1edd0429582dd29cccacaf50fd134b05593bd9c/library/std/src/panicking.rs:517:5
   1: std::panicking::begin_panic_fmt
             at /rustc/f1edd0429582dd29cccacaf50fd134b05593bd9c/library/std/src/panicking.rs:460:5
   2: roc_gen_llvm::llvm::build::build_procedures_help
             at ./compiler/gen_llvm/src/llvm/build.rs:4051:19
   3: roc_gen_llvm::llvm::build::build_procedures
             at ./compiler/gen_llvm/src/llvm/build.rs:4024:5
   4: roc_build::program::gen_from_mono_module_llvm
             at ./compiler/build/src/program.rs:301:5
   5: roc_build::program::gen_from_mono_module
             at ./compiler/build/src/program.rs:207:50
   6: roc_cli::build::build_file
             at ./cli/src/build.rs:181:27
   7: roc_cli::build
             at ./cli/src/lib.rs:312:27
   8: roc::main
             at ./cli/src/main.rs:30:21
   9: core::ops::function::FnOnce::call_once
             at /rustc/f1edd0429582dd29cccacaf50fd134b05593bd9c/library/core/src/ops/function.rs:227:5
note: Some details are omitted, run with `RUST_BACKTRACE=full` for a verbose backtrace.
</code></pre></div>



<a name="264810442"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/json%20parser/near/264810442" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Warner <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/json.20parser.html#264810442">(Dec 14 2021 at 04:39)</a>:</h4>
<p>Also I've learned that the compiler panics if you try to call <code>List.map</code> with the arguments reversed, e.g. <code>List.map formatJson items</code>. (rather than showing a type error)</p>



<a name="264811294"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/json%20parser/near/264811294" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Warner <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/json.20parser.html#264811294">(Dec 14 2021 at 04:50)</a>:</h4>
<p><span aria-label="grimacing" class="emoji emoji-1f62c" role="img" title="grimacing">:grimacing:</span> Been running into a non-stop stream of internal compiler errors. Some of them _might_ be my fault, not super clear based on the error messages.</p>



<a name="264811447"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/json%20parser/near/264811447" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Warner <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/json.20parser.html#264811447">(Dec 14 2021 at 04:52)</a>:</h4>
<p>The most recent is: </p>
<div class="codehilite"><pre><span></span><code>thread &#39;&lt;unnamed&gt;&#39; panicked at &#39;TODO layout_from_flat_type for Apply(`#UserApp.Pair`, [])&#39;, compiler/mono/src/layout.rs:1483:21
</code></pre></div>



<a name="264812572"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/json%20parser/near/264812572" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lucas Rosa <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/json.20parser.html#264812572">(Dec 14 2021 at 05:05)</a>:</h4>
<p>It’s never the users fault!</p>



<a name="264812843"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/json%20parser/near/264812843" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Warner <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/json.20parser.html#264812843">(Dec 14 2021 at 05:09)</a>:</h4>
<p>^^^ 100% agreed. What I meant by that was, "Maybe I wrote code that wasn't technically valid Roc, and the compiler is still learning how to express its emotions" <span aria-label="stuck out tongue wink" class="emoji emoji-1f61c" role="img" title="stuck out tongue wink">:stuck_out_tongue_wink:</span></p>



<a name="264814096"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/json%20parser/near/264814096" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Warner <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/json.20parser.html#264814096">(Dec 14 2021 at 05:22)</a>:</h4>
<p>For bugs in places like <code>compiler/unify/src/unify.rs</code> and <code>compiler/solve/src/solve.rs</code>, what's the best way to figure the things in the error message map back to source locations in the input program?</p>



<a name="264820894"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/json%20parser/near/264820894" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lucas Rosa <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/json.20parser.html#264820894">(Dec 14 2021 at 07:29)</a>:</h4>
<p>For sure, I understand :p. I was just being silly :)</p>



<a name="264820985"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/json%20parser/near/264820985" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lucas Rosa <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/json.20parser.html#264820985">(Dec 14 2021 at 07:30)</a>:</h4>
<p>I think the exprs are usually wrapped in Loc which should carry source info</p>



<a name="264821033"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/json%20parser/near/264821033" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lucas Rosa <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/json.20parser.html#264821033">(Dec 14 2021 at 07:31)</a>:</h4>
<p>I have to double check though or maybe I misunderstood your question</p>



<a name="264848368"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/json%20parser/near/264848368" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/json.20parser.html#264848368">(Dec 14 2021 at 12:19)</a>:</h4>
<p>you get panics in type checking? Also are you using <code>roc check</code> or <code>cargo run -- check</code> ? that will usually show the (type) errors</p>



<a name="264848379"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/json%20parser/near/264848379" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/json.20parser.html#264848379">(Dec 14 2021 at 12:19)</a>:</h4>
<p>the real problem is that we panic before those errors can be shown</p>



<a name="264848483"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/json%20parser/near/264848483" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/json.20parser.html#264848483">(Dec 14 2021 at 12:20)</a>:</h4>
<p>or I mean the real real problem is that we're not correctly handling incorrect programs, but for now a quick fix might be just running the type checker until it is satisfied, and then hopefully codegen just works at that point</p>



<a name="264951088"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/json%20parser/near/264951088" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Warner <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/json.20parser.html#264951088">(Dec 15 2021 at 00:51)</a>:</h4>
<p><code>cargo run -- check</code> is definitely better. I came back to the problem with fresh eyes and realized I was missing a <code>,</code> between variants in my tag union / enum.</p>



<a name="264951167"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/json%20parser/near/264951167" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Warner <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/json.20parser.html#264951167">(Dec 15 2021 at 00:52)</a>:</h4>
<p>It definitely seems like the parser _should_ have yelled at me in that condition.</p>



<a name="264951618"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/json%20parser/near/264951618" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Warner <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/json.20parser.html#264951618">(Dec 15 2021 at 00:57)</a>:</h4>
<p>Ok, I think I'm past the main problems, but encountering some new interesting challenges.</p>
<p>Is it possible to use a self-referential type? e.g.</p>
<div class="codehilite"><pre><span></span><code>JsonValue :
    [
        Number I64,
        String Str,
        Array (List JsonValue),
        Object (List { key: Str, value: JsonValue}),
    ]
</code></pre></div>
<p>When I try to construct a literal of that type (<code>Object [ { key: "testing", value: Number (42) }]</code>) and serialize it, I'm getting this compiler error:</p>
<div class="codehilite"><pre><span></span><code>── CIRCULAR TYPE ───────────────────────────────────────────────────────────────

I&#39;m inferring a weird self-referential type for printKeyValue:

46│  printKeyValue = \{key, value} -&gt;
     ^^^^^^^^^^^^^

Here is my best effort at writing down the type. You will see ∞ for
parts of the type that repeat something already printed out
infinitely.

    { key : Str, value : [ Array (List a), Number I64,
    Object (List ∞), String Str ] as a } -&gt; Str
</code></pre></div>



<a name="264951859"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/json%20parser/near/264951859" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/json.20parser.html#264951859">(Dec 15 2021 at 01:00)</a>:</h4>
<p>it _should_ work, but recursive types with just aliases are tricky</p>



<a name="264951879"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/json%20parser/near/264951879" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/json.20parser.html#264951879">(Dec 15 2021 at 01:00)</a>:</h4>
<p>we have plans for proper newtypes</p>



<a name="264951888"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/json%20parser/near/264951888" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/json.20parser.html#264951888">(Dec 15 2021 at 01:00)</a>:</h4>
<p>which should make all this much more reliable</p>



<a name="264951911"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/json%20parser/near/264951911" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Warner <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/json.20parser.html#264951911">(Dec 15 2021 at 01:00)</a>:</h4>
<p>Is there a hacky way I can make this work for now?</p>



<a name="302268157"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/json%20parser/near/302268157" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/json.20parser.html#302268157">(Oct 04 2022 at 14:05)</a>:</h4>
<p>Hello. I'm having fun learning while (attempting to) make a json parser with roc.  Is this a good place to ask questions?</p>



<a name="302268955"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/json%20parser/near/302268955" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anton <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/json.20parser.html#302268955">(Oct 04 2022 at 14:09)</a>:</h4>
<p>Hi Travis,<br>
I've moved your question to a new topic, ask away :)</p>



<a name="302270660"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/json%20parser/near/302270660" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/json.20parser.html#302270660">(Oct 04 2022 at 14:18)</a>:</h4>
<p>Hi Anton. Thanks for making a topic.  I wonder is there a way to debug what type the compiler is expecting akin to 'holes' in haskell? Forgive me if thats the wrong term.  The compiler does a pretty good job of explaining type errors.  But it might be nice sometime to force it to stop and just output what the type of something is.</p>



<a name="302272397"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/json%20parser/near/302272397" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anton <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/json.20parser.html#302272397">(Oct 04 2022 at 14:27)</a>:</h4>
<p><span class="user-mention" data-user-id="454654">@Ayaz Hafiz</span> <span class="user-mention" data-user-id="281543">@Folkert de Vries</span></p>



<a name="302274470"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/json%20parser/near/302274470" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ayaz Hafiz <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/json.20parser.html#302274470">(Oct 04 2022 at 14:37)</a>:</h4>
<p>We don't have typed holes exposed in the surface syntax. I think it would be useful to add, but there are some implications regarding syntax that would need to be figured out - for example, we may not be able to use <code>_</code>, since that is used commonly for other purposes already</p>



<a name="302275160"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/json%20parser/near/302275160" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/json.20parser.html#302275160">(Oct 04 2022 at 14:40)</a>:</h4>
<p>a quick trick: replace whatever type you're curious about with <code>[]</code> so it will fail type checking, and then look at the error message to see what the compiler inferred</p>



<a name="302276412"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/json%20parser/near/302276412" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/json.20parser.html#302276412">(Oct 04 2022 at 14:46)</a>:</h4>
<p>thats pretty handy. i hadn't thought of using <code>[]</code>. <span aria-label="+1" class="emoji emoji-1f44d" role="img" title="+1">:+1:</span></p>



<a name="302565070"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/json%20parser/near/302565070" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/json.20parser.html#302565070">(Oct 06 2022 at 00:08)</a>:</h4>
<p>how can i format code? ```roc doesn't seem to work</p>



<a name="302565158"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/json%20parser/near/302565158" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/json.20parser.html#302565158">(Oct 06 2022 at 00:09)</a>:</h4>
<p>and ```haskell doesn't look great either</p>



<a name="302565377"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/json%20parser/near/302565377" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/json.20parser.html#302565377">(Oct 06 2022 at 00:10)</a>:</h4>
<p>I tend to use ```coffee</p>
<p>or ```elixir</p>



<a name="302565733"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/json%20parser/near/302565733" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/json.20parser.html#302565733">(Oct 06 2022 at 00:14)</a>:</h4>
<p>Thanks.</p>



<a name="302565798"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/json%20parser/near/302565798" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/json.20parser.html#302565798">(Oct 06 2022 at 00:15)</a>:</h4>
<p>elixir looks passable</p>



<a name="302565817"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/json%20parser/near/302565817" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/json.20parser.html#302565817">(Oct 06 2022 at 00:15)</a>:</h4>
<p>any ideas on how i could allow for a leading minus in manyDigitsP?  i'm relying on examples/parser/Parser/{Core,Str}.roc but haven't shown their imports.  thinking i need a slightly different approach but not sure. </p>
<p>Error:</p>
<div class="codehilite" data-code-language="Bash Session"><pre><span></span><code><span class="go">The argument is an anonymous function of type:</span>
<span class="go">    [Err [Nothing], Ok Str] -&gt; [Ok Str]a</span>
<span class="go">But map needs its 2nd argument to be:</span>
<span class="go">    Result U8 [Nothing] -&gt; [Ok Str]a</span>
</code></pre></div>
<div class="codehilite" data-code-language="Elixir"><pre><span></span><code><span class="n">minus</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">codeunit</span><span class="w"> </span><span class="mi">45</span><span class="w"> </span><span class="c1"># '-'</span><span class="w"></span>
<span class="n">maybeMinus</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">maybe</span><span class="w"> </span><span class="n">minus</span><span class="w"></span>
<span class="w">    </span><span class="o">|&gt;</span><span class="w"> </span><span class="n">map</span><span class="w"> </span><span class="err">\</span><span class="n">res</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="c1"># &lt;-- Here is the problem line</span><span class="w"></span>
<span class="w">        </span><span class="ow">when</span><span class="w"> </span><span class="n">res</span><span class="w"> </span><span class="n">is</span><span class="w"></span>
<span class="w">            </span><span class="nc">Ok</span><span class="w"> </span><span class="n">m</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="nc">Ok</span><span class="w"> </span><span class="n">m</span><span class="w"></span>
<span class="w">            </span><span class="nc">Err</span><span class="w"> </span><span class="bp">_</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="nc">Ok</span><span class="w"> </span><span class="s2">""</span><span class="w"></span>

<span class="n">manyDigitsP</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="nc">Parser</span><span class="w"> </span><span class="nc">RawStr</span><span class="w"> </span><span class="nc">RawStr</span><span class="w"></span>
<span class="n">manyDigitsP</span><span class="w"> </span><span class="o">=</span><span class="w"></span>
<span class="w">    </span><span class="n">sepBy1</span><span class="w"> </span><span class="n">maybeMinus</span><span class="w"> </span><span class="p">(</span><span class="n">oneOrMore</span><span class="w"> </span><span class="p">(</span><span class="n">codeunitSatisfies</span><span class="w"> </span><span class="p">(</span><span class="err">\</span><span class="n">c</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="mi">48</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">c</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">c</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="mi">59</span><span class="w"> </span><span class="p">)))</span><span class="w"></span>

<span class="n">u64P</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="nc">Parser</span><span class="w"> </span><span class="nc">RawStr</span><span class="w"> </span><span class="nc">Value</span><span class="w"></span>
<span class="n">u64P</span><span class="w"> </span><span class="o">=</span><span class="w"></span>
<span class="w">    </span><span class="n">manyDigitsP</span><span class="w"></span>
<span class="w">    </span><span class="o">|&gt;</span><span class="w"> </span><span class="n">map</span><span class="w"> </span><span class="err">\</span><span class="n">rawStr</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"></span>
<span class="w">        </span><span class="n">str</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">strFromRaw</span><span class="w"> </span><span class="n">rawStr</span><span class="w"></span>
<span class="w">        </span><span class="ow">when</span><span class="w"> </span><span class="nc">Str</span><span class="o">.</span><span class="n">toI64</span><span class="w"> </span><span class="n">str</span><span class="w"> </span><span class="n">is</span><span class="w"></span>
<span class="w">            </span><span class="nc">Ok</span><span class="w"> </span><span class="n">num</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="nc">Ok</span><span class="w"> </span><span class="p">(</span><span class="nc">JsonNumber</span><span class="w"> </span><span class="n">num</span><span class="p">)</span><span class="w"></span>
<span class="w">            </span><span class="nc">Err</span><span class="w"> </span><span class="bp">_</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="nc">Err</span><span class="w"> </span><span class="s2">"`\(str)` is not a I64"</span><span class="w"></span>
<span class="w">    </span><span class="o">|&gt;</span><span class="w"> </span><span class="n">flatten</span><span class="w"></span>
</code></pre></div>



<a name="302565986"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/json%20parser/near/302565986" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/json.20parser.html#302565986">(Oct 06 2022 at 00:17)</a>:</h4>
<p>seems like i just need to map a non-minus to an empty list</p>



<a name="302566033"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/json%20parser/near/302566033" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ayaz Hafiz <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/json.20parser.html#302566033">(Oct 06 2022 at 00:18)</a>:</h4>
<p>try changing</p>
<div class="codehilite" data-code-language="Diff"><pre><span></span><code><span class="gd">-            Ok m -&gt; Ok m</span><span class="w"></span>
<span class="gi">+            Ok _ -&gt; Ok "-"</span><span class="w"></span>
</code></pre></div>



<a name="302566282"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/json%20parser/near/302566282" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/json.20parser.html#302566282">(Oct 06 2022 at 00:21)</a>:</h4>
<p>ah. thank you. so that gets rid of one error. now just this:</p>
<div class="codehilite" data-code-language="Bash Session"><pre><span></span><code><span class="go">43│  manyDigitsP : Parser RawStr RawStr</span>
<span class="go">44│  manyDigitsP =</span>
<span class="go">45│      sepBy1 maybeMinus (oneOrMore (codeunitSatisfies (\c -&gt; 48 &lt;= c &amp;&amp; c &lt;= 59 )))</span>
<span class="go">         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^</span>

<span class="go">This Parser.Core.sepBy1 call produces:</span>

<span class="go">    Parser RawStr (List [Ok Str]a) ?</span>

<span class="go">But the type annotation on manyDigitsP says it should be:</span>

<span class="go">    Parser RawStr (List U8) ?</span>
</code></pre></div>



<a name="302566378"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/json%20parser/near/302566378" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/json.20parser.html#302566378">(Oct 06 2022 at 00:22)</a>:</h4>
<p>maybe <a href="http://List.map">List.map</a>? <span aria-label="thinking" class="emoji emoji-1f914" role="img" title="thinking">:thinking:</span></p>



<a name="302566745"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/json%20parser/near/302566745" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/json.20parser.html#302566745">(Oct 06 2022 at 00:29)</a>:</h4>
<p>think i just need to get change that type annotation and handle the result of manyDigitsP differently - as a List instead of as a raw string.</p>



<a name="302567805"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/json%20parser/near/302567805" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/json.20parser.html#302567805">(Oct 06 2022 at 00:45)</a>:</h4>
<p>any advice on how to transform a <code>List [Ok Str]</code> to a <code>Str</code>?</p>



<a name="302567814"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/json%20parser/near/302567814" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/json.20parser.html#302567814">(Oct 06 2022 at 00:45)</a>:</h4>
<p>is there maybe a List.mapConcat or something?</p>



<a name="302568038"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/json%20parser/near/302568038" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/json.20parser.html#302568038">(Oct 06 2022 at 00:48)</a>:</h4>
<p>nevermind. i think i'm onto something.</p>



<a name="302568738"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/json%20parser/near/302568738" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/json.20parser.html#302568738">(Oct 06 2022 at 00:57)</a>:</h4>
<p>found a solution.  now returning <code>List U8</code> rather than <code>Ok Str</code> from maybeMinus and just doing <code>List.join</code> on its result to get a raw str.</p>



<a name="302568876"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/json%20parser/near/302568876" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/json.20parser.html#302568876">(Oct 06 2022 at 00:59)</a>:</h4>
<p>now i've discovered that <code>Str.toI64</code> doesn't allow for a leading minus which is what i was hoping for... <span aria-label="face palm" class="emoji emoji-1f926" role="img" title="face palm">:face_palm:</span></p>



<a name="302569341"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/json%20parser/near/302569341" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/json.20parser.html#302569341">(Oct 06 2022 at 01:06)</a>:</h4>
<p>or wait. no it looks like perhaps <code>sepBy1</code> isn't doing what i thought it was. i expected to get '-123' but actually getting just '-'. hmm not sure why.</p>



<a name="302569368"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/json%20parser/near/302569368" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/json.20parser.html#302569368">(Oct 06 2022 at 01:06)</a>:</h4>
<p><code>While reading: </code>-123<code> or </code>-<code> is not a I64</code></p>



<a name="302569464"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/json%20parser/near/302569464" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ayaz Hafiz <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/json.20parser.html#302569464">(Oct 06 2022 at 01:08)</a>:</h4>
<p>Probably <code>-</code> does not parse to an i64</p>



<a name="302570009"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/json%20parser/near/302570009" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/json.20parser.html#302570009">(Oct 06 2022 at 01:16)</a>:</h4>
<p>yeah i was confused what the error message meant.  but i think its actually passing just '-' to <code>Str.toI64</code></p>



<a name="302570046"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/json%20parser/near/302570046" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/json.20parser.html#302570046">(Oct 06 2022 at 01:17)</a>:</h4>
<p>yep. this prints <code>-123</code>:</p>
<div class="codehilite" data-code-language="CoffeeScript"><pre><span></span><code><span class="nv">main</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="nx">Str</span><span class="w"></span>
<span class="nv">main</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Num</span><span class="p">.</span><span class="nx">toStr</span><span class="w"> </span><span class="p">(</span><span class="nx">Result</span><span class="p">.</span><span class="nx">withDefault</span><span class="w"> </span><span class="p">(</span><span class="nx">Str</span><span class="p">.</span><span class="nx">toI64</span><span class="w"> </span><span class="s">"-123"</span><span class="p">)</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">)</span><span class="w"></span>
</code></pre></div>



<a name="302570136"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/json%20parser/near/302570136" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/json.20parser.html#302570136">(Oct 06 2022 at 01:18)</a>:</h4>
<p>so it looks like i'm not getting the full result from <code>sepBy1</code></p>



<a name="302570703"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/json%20parser/near/302570703" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/json.20parser.html#302570703">(Oct 06 2022 at 01:28)</a>:</h4>
<p>well i'm taking a break. heres my code if anyone is curious. <a href="https://pastebin.com/VQjVetHt">https://pastebin.com/VQjVetHt</a><br>
also let me know if there is a better place to paste code.</p>



<a name="302570845"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/json%20parser/near/302570845" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/json.20parser.html#302570845">(Oct 06 2022 at 01:30)</a>:</h4>
<p>also any critiques are welcome <span aria-label="+1" class="emoji emoji-1f44d" role="img" title="+1">:+1:</span>  i'm very new and likely making lots of mistakes.</p>



<a name="302571224"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/json%20parser/near/302571224" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/json.20parser.html#302571224">(Oct 06 2022 at 01:37)</a>:</h4>
<p>incase anyone wants to try running it. i've been running it like this from the roc repo's root directory :<br>
<code>$ roc examples/parser/parse-json.roc</code></p>



<a name="302571409"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/json%20parser/near/302571409" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ayaz Hafiz <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/json.20parser.html#302571409">(Oct 06 2022 at 01:40)</a>:</h4>
<p>this is super cool!!</p>



<a name="302693208"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/json%20parser/near/302693208" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Qqwy / Marten <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/json.20parser.html#302693208">(Oct 06 2022 at 16:31)</a>:</h4>
<p>Nice work! <span aria-label="blush" class="emoji emoji-1f60a" role="img" title="blush">:blush:</span></p>



<a name="302775923"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/json%20parser/near/302775923" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/json.20parser.html#302775923">(Oct 07 2022 at 03:32)</a>:</h4>
<p>so i figured out how to allow a leading minus.  i was infact using <code>sepBy1</code> incorrectly.  the solution i found uses <code>const</code> and <code>apply</code>.  it also disallows leading zeroes. here it is:</p>
<div class="codehilite" data-code-language="CoffeeScript"><pre><span></span><code><span class="nv">minus</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">codeunit</span><span class="w"> </span><span class="mi">45</span><span class="w"> </span><span class="c1"># '-'</span><span class="w"></span>
<span class="nv">maybeMinusP</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="nx">Parser</span><span class="w"> </span><span class="nx">RawStr</span><span class="w"> </span><span class="nx">RawStr</span><span class="w"></span>
<span class="nv">maybeMinusP</span><span class="w"> </span><span class="o">=</span><span class="w"></span>
<span class="w">    </span><span class="nx">maybe</span><span class="w"> </span><span class="nx">minus</span><span class="w"></span>
<span class="w">    </span><span class="o">|&gt;</span><span class="w"> </span><span class="nx">map</span><span class="w"> </span><span class="err">\</span><span class="nx">res</span><span class="w"> </span><span class="nf">-&gt;</span><span class="w"></span>
<span class="w">        </span><span class="k">when</span><span class="w"> </span><span class="nx">res</span><span class="w"> </span><span class="o">is</span><span class="w"></span>
<span class="w">            </span><span class="nx">Ok</span><span class="w"> </span><span class="nx">_</span><span class="w"> </span><span class="nf">-&gt;</span><span class="w"> </span><span class="p">[</span><span class="mi">45</span><span class="nx">u8</span><span class="p">]</span><span class="w"></span>
<span class="w">            </span><span class="nx">Err</span><span class="w"> </span><span class="nx">_</span><span class="w"> </span><span class="nf">-&gt;</span><span class="w"> </span><span class="p">[]</span><span class="w"></span>

<span class="nv">oneToNineP</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">codeunitSatisfies</span><span class="w"> </span><span class="p">(</span><span class="err">\</span><span class="nx">c</span><span class="w"> </span><span class="nf">-&gt;</span><span class="w"> </span><span class="mi">49</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="nx">c</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nx">c</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="mi">59</span><span class="w"> </span><span class="p">)</span><span class="w">  </span><span class="c1"># '1'..'9'</span><span class="w"></span>
<span class="nv">zeroToNineP</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">codeunitSatisfies</span><span class="w"> </span><span class="p">(</span><span class="err">\</span><span class="nx">c</span><span class="w"> </span><span class="nf">-&gt;</span><span class="w"> </span><span class="mi">48</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="nx">c</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nx">c</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="mi">59</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="c1"># '0'..'9'</span><span class="w"></span>

<span class="nv">rawIntP</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="nx">Parser</span><span class="w"> </span><span class="nx">RawStr</span><span class="w"> </span><span class="nx">RawStr</span><span class="w"></span>
<span class="nv">rawIntP</span><span class="w"> </span><span class="o">=</span><span class="w"></span>
<span class="w">    </span><span class="nx">const</span><span class="w"> </span><span class="p">(</span><span class="err">\</span><span class="nx">vals0</span><span class="w"> </span><span class="nf">-&gt;</span><span class="w"> </span><span class="err">\</span><span class="nx">val1</span><span class="w"> </span><span class="nf">-&gt;</span><span class="w"> </span><span class="err">\</span><span class="nx">vals</span><span class="w"> </span><span class="nf">-&gt;</span><span class="w"> </span><span class="nx">List</span><span class="p">.</span><span class="nx">join</span><span class="w"> </span><span class="p">[</span><span class="nx">vals0</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="nx">val1</span><span class="p">],</span><span class="w"> </span><span class="nx">vals</span><span class="p">])</span><span class="w"></span>
<span class="w">    </span><span class="o">|&gt;</span><span class="w"> </span><span class="nx">apply</span><span class="w"> </span><span class="nx">maybeMinusP</span><span class="w"></span>
<span class="w">    </span><span class="o">|&gt;</span><span class="w"> </span><span class="nx">apply</span><span class="w"> </span><span class="nx">oneToNineP</span><span class="w"></span>
<span class="w">    </span><span class="o">|&gt;</span><span class="w"> </span><span class="nx">apply</span><span class="w"> </span><span class="p">(</span><span class="nx">many</span><span class="w"> </span><span class="nx">zeroToNineP</span><span class="p">)</span><span class="w"></span>

<span class="nv">intP</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="nx">Parser</span><span class="w"> </span><span class="nx">RawStr</span><span class="w"> </span><span class="nx">Value</span><span class="w"></span>
<span class="nv">intP</span><span class="w"> </span><span class="o">=</span><span class="w"></span>
<span class="w">    </span><span class="nx">rawIntP</span><span class="w"></span>
<span class="w">    </span><span class="o">|&gt;</span><span class="w"> </span><span class="nx">map</span><span class="w"> </span><span class="err">\</span><span class="nx">rawStr</span><span class="w"> </span><span class="nf">-&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nv">str</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">strFromRaw</span><span class="w"> </span><span class="nx">rawStr</span><span class="w"></span>
<span class="w">        </span><span class="k">when</span><span class="w"> </span><span class="nx">Str</span><span class="p">.</span><span class="nx">toI64</span><span class="w"> </span><span class="nx">str</span><span class="w"> </span><span class="o">is</span><span class="w"></span>
<span class="w">            </span><span class="nx">Ok</span><span class="w"> </span><span class="nx">num</span><span class="w"> </span><span class="nf">-&gt;</span><span class="w"> </span><span class="nx">Ok</span><span class="w"> </span><span class="p">(</span><span class="nb">Number</span><span class="w"> </span><span class="nx">num</span><span class="p">)</span><span class="w"></span>
<span class="w">            </span><span class="nx">Err</span><span class="w"> </span><span class="nx">_</span><span class="w"> </span><span class="nf">-&gt;</span><span class="w"> </span><span class="nx">Err</span><span class="w"> </span><span class="s">"`\(str)` is not a I64"</span><span class="w"></span>
<span class="w">    </span><span class="o">|&gt;</span><span class="w"> </span><span class="nx">flatten</span><span class="w"></span>
</code></pre></div>



<a name="302776128"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/json%20parser/near/302776128" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/json.20parser.html#302776128">(Oct 07 2022 at 03:36)</a>:</h4>
<p>and now i'm trying to move to parsing arrays.  but i can't understand what this error message needs me to do</p>
<div class="codehilite" data-code-language="Bash Session"><pre><span></span><code><span class="go">── TYPE MISMATCH ────────────────────────────── examples/parser/parse-json.roc ─</span>

<span class="go">Something is off with the body of the arrayP definition:</span>

<span class="go">82│   arrayP : Parser RawStr Value</span>
<span class="go">83│   arrayP =</span>
<span class="go">84│&gt;      string "[]"</span>
<span class="go">85│&gt;      |&gt; map (\_ -&gt; Ok (Array emptyArray))</span>

<span class="go">This Parser.Core.map call produces:</span>

<span class="go">    Parser RawStr [Ok [Array (List Value)]b]c ?</span>

<span class="go">But the type annotation on arrayP says it should be:</span>

<span class="go">    Parser RawStr [Array (List a), Boolean Bool, Null, Number I64,</span>
<span class="go">    String Str] as a ?</span>

<span class="go">────────────────────────────────────────────────────────────────────────────────</span>
</code></pre></div>



<a name="302776231"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/json%20parser/near/302776231" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/json.20parser.html#302776231">(Oct 07 2022 at 03:38)</a>:</h4>
<p>here is the relevant code:</p>
<div class="codehilite" data-code-language="CoffeeScript"><pre><span></span><code><span class="nv">Value</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="w"></span>
<span class="w">    </span><span class="nx">Null</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="nb">Boolean</span><span class="w"> </span><span class="nx">Bool</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="nb">Number</span><span class="w"> </span><span class="nx">I64</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="nb">String</span><span class="w"> </span><span class="nx">Str</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="nb">Array</span><span class="w"> </span><span class="p">(</span><span class="nx">List</span><span class="w"> </span><span class="nx">Value</span><span class="p">),</span><span class="w"></span>
<span class="p">]</span><span class="w"></span>

<span class="c1">#...</span><span class="w"></span>

<span class="nv">emptyArray</span><span class="o">:</span><span class="w"> </span><span class="p">(</span><span class="nx">List</span><span class="w"> </span><span class="nx">Value</span><span class="p">)</span><span class="w"></span>
<span class="nv">emptyArray</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[]</span><span class="w"></span>

<span class="nv">arrayP</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="nx">Parser</span><span class="w"> </span><span class="nx">RawStr</span><span class="w"> </span><span class="nx">Value</span><span class="w"></span>
<span class="nv">arrayP</span><span class="w"> </span><span class="o">=</span><span class="w"></span>
<span class="w">    </span><span class="c1"># dummy impl just trying to get typing right</span><span class="w"></span>
<span class="w">    </span><span class="nx">string</span><span class="w"> </span><span class="s">"[]"</span><span class="w"></span>
<span class="w">    </span><span class="o">|&gt;</span><span class="w"> </span><span class="nx">map</span><span class="w"> </span><span class="p">(</span><span class="err">\</span><span class="nx">_</span><span class="w"> </span><span class="nf">-&gt;</span><span class="w"> </span><span class="nx">Ok</span><span class="w"> </span><span class="p">(</span><span class="nb">Array</span><span class="w"> </span><span class="nx">emptyArray</span><span class="p">))</span><span class="w"></span>
</code></pre></div>



<a name="302776428"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/json%20parser/near/302776428" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/json.20parser.html#302776428">(Oct 07 2022 at 03:41)</a>:</h4>
<p>am i perhaps missing a type specifier somewhere?</p>



<a name="302776687"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/json%20parser/near/302776687" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/json.20parser.html#302776687">(Oct 07 2022 at 03:46)</a>:</h4>
<p>it looks like there's an <code>Ok</code> somewhere that shouldn't be there</p>



<a name="302776716"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/json%20parser/near/302776716" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/json.20parser.html#302776716">(Oct 07 2022 at 03:46)</a>:</h4>
<p>so maybe <code>|&gt; map (\_ -&gt; Ok (Array emptyArray))</code> shouldn't have the <code>Ok</code> there?</p>



<a name="302776738"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/json%20parser/near/302776738" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/json.20parser.html#302776738">(Oct 07 2022 at 03:47)</a>:</h4>
<p>I think that because I'm seeing in the error message that it produces <code>Parser RawStr [Ok [Array ...</code> but expects <code>Parser RawStr [Array ...</code> (without the <code>Ok</code>)</p>



<a name="302776792"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/json%20parser/near/302776792" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/json.20parser.html#302776792">(Oct 07 2022 at 03:48)</a>:</h4>
<p>I'm guessing this is because <code>map</code> already takes care of unwrapping and re-wrapping the <code>Result</code> for you maybe?</p>



<a name="302777078"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/json%20parser/near/302777078" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/json.20parser.html#302777078">(Oct 07 2022 at 03:54)</a>:</h4>
<p>hmm yeah i think you're right.  I've been using Ok elsewhere and copied it. <br>
but now when i remove the <code>Ok</code> i get a segfault. here is what triggered it:</p>
<div class="codehilite" data-code-language="CoffeeScript"><pre><span></span><code><span class="nv">arrayP</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="nx">Parser</span><span class="w"> </span><span class="nx">RawStr</span><span class="w"> </span><span class="nx">Value</span><span class="w"></span>
<span class="nv">arrayP</span><span class="w"> </span><span class="o">=</span><span class="w"></span>
<span class="w">    </span><span class="nx">string</span><span class="w"> </span><span class="s">"[]"</span><span class="w"></span>
<span class="w">    </span><span class="o">|&gt;</span><span class="w"> </span><span class="nx">map</span><span class="w"> </span><span class="p">(</span><span class="err">\</span><span class="nx">_</span><span class="w"> </span><span class="nf">-&gt;</span><span class="w"> </span><span class="nb">Array</span><span class="w"> </span><span class="nx">emptyArray</span><span class="p">)</span><span class="w"></span>
</code></pre></div>



<a name="302777132"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/json%20parser/near/302777132" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/json.20parser.html#302777132">(Oct 07 2022 at 03:55)</a>:</h4>
<p>does <code>roc check</code> give you any errors?</p>



<a name="302777200"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/json%20parser/near/302777200" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/json.20parser.html#302777200">(Oct 07 2022 at 03:56)</a>:</h4>
<p>nope.</p>
<div class="codehilite" data-code-language="Bash Session"><pre><span></span><code><span class="gp">$ </span>roc check examples/parser/parse-json.roc
<span class="go">0 errors and 0 warnings found in 17 ms.</span>
</code></pre></div>



<a name="302777247"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/json%20parser/near/302777247" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/json.20parser.html#302777247">(Oct 07 2022 at 03:57)</a>:</h4>
<div class="codehilite" data-code-language="Bash Session"><pre><span></span><code><span class="gp">$ </span>roc version
<span class="go">roc nightly pre-release, built from commit 2b91154 on Sa 01 Okt 2022 09:15:07 UTC</span>
</code></pre></div>



<a name="302777765"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/json%20parser/near/302777765" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/json.20parser.html#302777765">(Oct 07 2022 at 04:05)</a>:</h4>
<p>here is all the code if you need a repro: <a href="https://gist.github.com/travisstaloch/7add1274a085f1e6cba59ca93d991d9c">https://gist.github.com/travisstaloch/7add1274a085f1e6cba59ca93d991d9c</a></p>



<a name="302777767"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/json%20parser/near/302777767" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/json.20parser.html#302777767">(Oct 07 2022 at 04:05)</a>:</h4>
<p>gotcha - is there anyplace this code is pushed, so we can try to reproduce?</p>



<a name="302777769"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/json%20parser/near/302777769" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/json.20parser.html#302777769">(Oct 07 2022 at 04:05)</a>:</h4>
<p>perfect!</p>



<a name="302777845"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/json%20parser/near/302777845" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/json.20parser.html#302777845">(Oct 07 2022 at 04:06)</a>:</h4>
<p>that segfaults. the offending line is line 90</p>



<a name="302777856"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/json%20parser/near/302777856" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/json.20parser.html#302777856">(Oct 07 2022 at 04:06)</a>:</h4>
<p>does <code>roc build</code> succeed?</p>



<a name="302777875"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/json%20parser/near/302777875" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/json.20parser.html#302777875">(Oct 07 2022 at 04:06)</a>:</h4>
<p>yes it does</p>



<a name="302777898"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/json%20parser/near/302777898" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/json.20parser.html#302777898">(Oct 07 2022 at 04:07)</a>:</h4>
<p>ok, created an issue to track this: <a href="https://github.com/roc-lang/roc/issues/4233">https://github.com/roc-lang/roc/issues/4233</a></p>



<a name="302777904"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/json%20parser/near/302777904" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/json.20parser.html#302777904">(Oct 07 2022 at 04:07)</a>:</h4>
<p>thanks for the concise reproductoin!</p>



<a name="302777905"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/json%20parser/near/302777905" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/json.20parser.html#302777905">(Oct 07 2022 at 04:07)</a>:</h4>
<p>*reproduction</p>



<a name="302777909"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/json%20parser/near/302777909" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/json.20parser.html#302777909">(Oct 07 2022 at 04:07)</a>:</h4>
<p>interesting. i thought it was a compiler segfault. no its a runtime fault.</p>



<a name="302777911"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/json%20parser/near/302777911" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/json.20parser.html#302777911">(Oct 07 2022 at 04:08)</a>:</h4>
<p>no problem. thanks for the help</p>



<a name="302778174"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/json%20parser/near/302778174" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/json.20parser.html#302778174">(Oct 07 2022 at 04:12)</a>:</h4>
<p>not sure if this is relevant, but does roc perhaps require a specific clang version? i've symlinked clang -&gt; system installed clang-14 on debian</p>



<a name="302778542"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/json%20parser/near/302778542" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/json.20parser.html#302778542">(Oct 07 2022 at 04:19)</a>:</h4>
<p>oh yes - we need 13</p>



<a name="302778557"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/json%20parser/near/302778557" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/json.20parser.html#302778557">(Oct 07 2022 at 04:20)</a>:</h4>
<p>upgrading to 14 will be a significant project unfortunately <span aria-label="big smile" class="emoji emoji-1f604" role="img" title="big smile">:big_smile:</span></p>



<a name="302778649"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/json%20parser/near/302778649" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/json.20parser.html#302778649">(Oct 07 2022 at 04:21)</a>:</h4>
<p>although - do other examples work for you?</p>



<a name="302778709"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/json%20parser/near/302778709" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/json.20parser.html#302778709">(Oct 07 2022 at 04:22)</a>:</h4>
<p>that's the type of thing where I'd expect either everything works or nothing works; I wouldn't expect it to cause project-specific segfaults</p>



<a name="302778969"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/json%20parser/near/302778969" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/json.20parser.html#302778969">(Oct 07 2022 at 04:27)</a>:</h4>
<p>yeah i everything else has worked so far. <br>
i'll check back later on. gotta run. thanks! o/</p>



<a name="302782241"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/json%20parser/near/302782241" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/json.20parser.html#302782241">(Oct 07 2022 at 05:23)</a>:</h4>
<p>can anyone else perhaps try running this file to see if they get a segfault too?  i just want to make sure its not a local setup problem like using clang-14.</p>



<a name="302782245"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/json%20parser/near/302782245" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/json.20parser.html#302782245">(Oct 07 2022 at 05:23)</a>:</h4>
<p><a href="https://gist.github.com/travisstaloch/7add1274a085f1e6cba59ca93d991d9c">https://gist.github.com/travisstaloch/7add1274a085f1e6cba59ca93d991d9c</a></p>



<a name="302782251"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/json%20parser/near/302782251" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/json.20parser.html#302782251">(Oct 07 2022 at 05:23)</a>:</h4>
<p>there are instructions at the top for running it</p>



<a name="302782387"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/json%20parser/near/302782387" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jan kili <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/json.20parser.html#302782387">(Oct 07 2022 at 05:25)</a>:</h4>
<div class="codehilite"><pre><span></span><code>[jan@framey parser]$ roc run parse-json.roc
roc: /lib64/libtinfo.so.6: no version information available (required by roc)
🔨 Rebuilding platform...

── UNRECOGNIZED NAME ────────────────────────────────────────── parse-json.roc ─

The Parser.Str module does not expose anything by the name strToRaw.

────────────────────────────────────────────────────────────────────────────────

1 error and 13 warnings found in 744 ms.

Running program anyway…

────────────────────────────────────────────────────────────────────────────────
Segmentation fault (core dumped)
[jan@framey parser]$
</code></pre></div>



<a name="302782913"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/json%20parser/near/302782913" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/json.20parser.html#302782913">(Oct 07 2022 at 05:32)</a>:</h4>
<p>ah thanks. i just noticed that. forgot i edited a file. updated now.</p>



<a name="302783001"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/json%20parser/near/302783001" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/json.20parser.html#302783001">(Oct 07 2022 at 05:33)</a>:</h4>
<p>here's a one liner if you like. </p>
<div class="codehilite" data-code-language="Bash Session"><pre><span></span><code><span class="gp">$ </span><span class="nb">cd</span> /tmp <span class="o">&amp;&amp;</span> git clone git@github.com:roc-lang/roc.git <span class="o">&amp;&amp;</span> <span class="nb">cd</span> roc <span class="o">&amp;&amp;</span> wget https://gist.github.com/travisstaloch/7add1274a085f1e6cba59ca93d991d9c/raw/a1fcbbd67e4fadc1d938303d192b022cfdd0da64/parse-json.roc -O examples/parser/parse-json.roc <span class="o">&amp;&amp;</span> roc examples/parser/parse-json.roc
</code></pre></div>



<a name="302783028"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/json%20parser/near/302783028" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/json.20parser.html#302783028">(Oct 07 2022 at 05:33)</a>:</h4>
<p>i'm expecting a segfault</p>



<a name="302783111"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/json%20parser/near/302783111" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/json.20parser.html#302783111">(Oct 07 2022 at 05:34)</a>:</h4>
<p>here's what i see</p>
<div class="codehilite" data-code-language="Bash Session"><pre><span></span><code><span class="gp">$ </span>roc examples/parser/parse-json.roc
<span class="go">🔨 Rebuilding platform...</span>
<span class="go">Segmentation fault</span>
</code></pre></div>



<a name="302783122"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/json%20parser/near/302783122" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jan kili <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/json.20parser.html#302783122">(Oct 07 2022 at 05:34)</a>:</h4>
<div class="codehilite"><pre><span></span><code>[jan@framey parser]$ cd /tmp &amp;&amp; git clone git@github.com:roc-lang/roc.git &amp;&amp; cd roc &amp;&amp; wget https://gist.github.com/travisstaloch/7add1274a085f1e6cba59ca93d991d9c/raw/a1fcbbd67e4fadc1d938303d192b022cfdd0da64/parse-json.roc -O examples/parser/parse-json.roc &amp;&amp; roc examples/parser/parse-json.roc
Cloning into &#39;roc&#39;...
remote: Enumerating objects: 165051, done.
remote: Counting objects: 100% (1076/1076), done.
remote: Compressing objects: 100% (494/494), done.
remote: Total 165051 (delta 617), reused 1002 (delta 573), pack-reused 163975
Receiving objects: 100% (165051/165051), 64.41 MiB | 6.44 MiB/s, done.
Resolving deltas: 100% (111974/111974), done.
--2022-10-06 23:34:13--  https://gist.github.com/travisstaloch/7add1274a085f1e6cba59ca93d991d9c/raw/a1fcbbd67e4fadc1d938303d192b022cfdd0da64/parse-json.roc
Resolving gist.github.com (gist.github.com)... 140.82.112.3
Connecting to gist.github.com (gist.github.com)|140.82.112.3|:443... connected.
HTTP request sent, awaiting response... 301 Moved Permanently
Location: https://gist.githubusercontent.com/travisstaloch/7add1274a085f1e6cba59ca93d991d9c/raw/a1fcbbd67e4fadc1d938303d192b022cfdd0da64/parse-json.roc [following]
--2022-10-06 23:34:14--  https://gist.githubusercontent.com/travisstaloch/7add1274a085f1e6cba59ca93d991d9c/raw/a1fcbbd67e4fadc1d938303d192b022cfdd0da64/parse-json.roc
Resolving gist.githubusercontent.com (gist.githubusercontent.com)... 185.199.110.133, 185.199.109.133, 185.199.108.133, ...
Connecting to gist.githubusercontent.com (gist.githubusercontent.com)|185.199.110.133|:443... connected.
HTTP request sent, awaiting response... 200 OK
Length: 3208 (3.1K) [text/plain]
Saving to: ‘examples/parser/parse-json.roc’

examples/parser/parse-j 100%[============================&gt;]   3.13K  --.-KB/s    in 0s

2022-10-06 23:34:14 (23.7 MB/s) - ‘examples/parser/parse-json.roc’ saved [3208/3208]

roc: /lib64/libtinfo.so.6: no version information available (required by roc)

── UNUSED IMPORT ────────────────────────────── examples/parser/parse-json.roc ─

Parser.Core.sepBy1 is not used in this module.

9│              parsePartial, ignore, between, many, flatten, oneOrMore, maybe, sepBy1, oneOrMore, alt },
                                                                                ^^^^^^

Since Parser.Core.sepBy1 isn&#39;t used, you don&#39;t need to import it.


── UNUSED IMPORT ────────────────────────────── examples/parser/parse-json.roc ─

Parser.Core.alt is not used in this module.

9│              parsePartial, ignore, between, many, flatten, oneOrMore, maybe, sepBy1, oneOrMore, alt },
                                                                                                   ^^^

Since Parser.Core.alt isn&#39;t used, you don&#39;t need to import it.


── UNUSED IMPORT ────────────────────────────── examples/parser/parse-json.roc ─

Parser.Str.parseStr is not used in this module.

11│              codeunitSatisfies, strFromRaw, digits, digit, parseRawStr, parseStr }
                                                                            ^^^^^^^^

Since Parser.Str.parseStr isn&#39;t used, you don&#39;t need to import it.


── UNUSED IMPORT ────────────────────────────── examples/parser/parse-json.roc ─

Parser.Str.parseRawStr is not used in this module.

11│              codeunitSatisfies, strFromRaw, digits, digit, parseRawStr, parseStr }
                                                               ^^^^^^^^^^^

Since Parser.Str.parseRawStr isn&#39;t used, you don&#39;t need to import it.


── UNUSED IMPORT ────────────────────────────── examples/parser/parse-json.roc ─

Parser.Core.parse is not used in this module.

8│          Parser.Core.{ Parser, parse, map, apply, const, buildPrimitiveParser, Result, oneOf,
                                  ^^^^^

Since Parser.Core.parse isn&#39;t used, you don&#39;t need to import it.


── UNUSED IMPORT ────────────────────────────── examples/parser/parse-json.roc ─

Parser.Str.stringRaw is not used in this module.

10│          Parser.Str.{ string, stringRaw, RawStr, parseStrPartial, anyString, codeunit,
                                  ^^^^^^^^^

Since Parser.Str.stringRaw isn&#39;t used, you don&#39;t need to import it.


── UNUSED IMPORT ────────────────────────────── examples/parser/parse-json.roc ─

Parser.Str.digits is not used in this module.

11│              codeunitSatisfies, strFromRaw, digits, digit, parseRawStr, parseStr }
                                                ^^^^^^

Since Parser.Str.digits isn&#39;t used, you don&#39;t need to import it.


── UNUSED IMPORT ────────────────────────────── examples/parser/parse-json.roc ─

Parser.Core.ignore is not used in this module.

9│              parsePartial, ignore, between, many, flatten, oneOrMore, maybe, sepBy1, oneOrMore, alt },
                              ^^^^^^

Since Parser.Core.ignore isn&#39;t used, you don&#39;t need to import it.


── UNUSED IMPORT ────────────────────────────── examples/parser/parse-json.roc ─

Parser.Str.anyString is not used in this module.

10│          Parser.Str.{ string, stringRaw, RawStr, parseStrPartial, anyString, codeunit,
                                                                      ^^^^^^^^^

Since Parser.Str.anyString isn&#39;t used, you don&#39;t need to import it.


── UNUSED IMPORT ────────────────────────────── examples/parser/parse-json.roc ─

Parser.Core.parsePartial is not used in this module.

9│              parsePartial, ignore, between, many, flatten, oneOrMore, maybe, sepBy1, oneOrMore, alt },
                ^^^^^^^^^^^^

Since Parser.Core.parsePartial isn&#39;t used, you don&#39;t need to import
it.


── UNUSED IMPORT ────────────────────────────── examples/parser/parse-json.roc ─

Parser.Core.buildPrimitiveParser is not used in this module.

8│          Parser.Core.{ Parser, parse, map, apply, const, buildPrimitiveParser, Result, oneOf,
                                                            ^^^^^^^^^^^^^^^^^^^^

Since Parser.Core.buildPrimitiveParser isn&#39;t used, you don&#39;t need to
import it.


── UNUSED IMPORT ────────────────────────────── examples/parser/parse-json.roc ─

Parser.Str.digit is not used in this module.

11│              codeunitSatisfies, strFromRaw, digits, digit, parseRawStr, parseStr }
                                                        ^^^^^

Since Parser.Str.digit isn&#39;t used, you don&#39;t need to import it.


── UNUSED IMPORT ────────────────────────────── examples/parser/parse-json.roc ─

Parser.Core.oneOrMore is not used in this module.

9│              parsePartial, ignore, between, many, flatten, oneOrMore, maybe, sepBy1, oneOrMore, alt },
                                                                                        ^^^^^^^^^

Since Parser.Core.oneOrMore isn&#39;t used, you don&#39;t need to import it.

────────────────────────────────────────────────────────────────────────────────

0 errors and 13 warnings found in 50 ms.

You can run the program anyway with roc run examples/parser/parse-json.roc
[jan@framey roc]$
</code></pre></div>



<a name="302783290"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/json%20parser/near/302783290" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/json.20parser.html#302783290">(Oct 07 2022 at 05:36)</a>:</h4>
<p>oh boy. i don't see those ununsed imports locally. could you try <code>roc run ...</code>?</p>



<a name="302783312"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/json%20parser/near/302783312" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/json.20parser.html#302783312">(Oct 07 2022 at 05:37)</a>:</h4>
<p><code>$ roc run examples/parser/parse-json.roc</code></p>



<a name="302783369"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/json%20parser/near/302783369" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/json.20parser.html#302783369">(Oct 07 2022 at 05:37)</a>:</h4>
<p>i'm just curious to see if the segfault is reproducible</p>



<a name="302783478"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/json%20parser/near/302783478" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jan kili <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/json.20parser.html#302783478">(Oct 07 2022 at 05:39)</a>:</h4>
<p>Same output with the segfault after:</p>
<div class="codehilite"><pre><span></span><code>Segmentation fault (core dumped)
</code></pre></div>



<a name="302783511"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/json%20parser/near/302783511" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/json.20parser.html#302783511">(Oct 07 2022 at 05:39)</a>:</h4>
<p>ok thanks. <span aria-label="+1" class="emoji emoji-1f44d" role="img" title="+1">:+1:</span>  good to know its not just on my system.</p>



<a name="302783535"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/json%20parser/near/302783535" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jan kili <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/json.20parser.html#302783535">(Oct 07 2022 at 05:39)</a>:</h4>
<p>:)</p>



<a name="302783651"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/json%20parser/near/302783651" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/json.20parser.html#302783651">(Oct 07 2022 at 05:41)</a>:</h4>
<p>i'll clean up those unused imports. wonder why i'm not seeing them <span aria-label="thinking" class="emoji emoji-1f914" role="img" title="thinking">:thinking:</span></p>



<a name="302786809"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/json%20parser/near/302786809" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/json.20parser.html#302786809">(Oct 07 2022 at 06:19)</a>:</h4>
<p>i wonder if this segfault is related to the recursive type?</p>
<div class="codehilite" data-code-language="CoffeeScript"><pre><span></span><code><span class="nv">Value</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="w"></span>
<span class="w">    </span><span class="c1"># ...</span><span class="w"></span>
<span class="w">    </span><span class="nb">Array</span><span class="w"> </span><span class="p">(</span><span class="nx">List</span><span class="w"> </span><span class="nx">Value</span><span class="p">),</span><span class="w"></span>
<span class="p">]</span><span class="w"></span>
</code></pre></div>



<a name="302807482"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/json%20parser/near/302807482" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/json.20parser.html#302807482">(Oct 07 2022 at 09:04)</a>:</h4>
<p>encountered a different compiler error while attempting float parsing. created issue <a href="https://github.com/roc-lang/roc/issues/4236">https://github.com/roc-lang/roc/issues/4236</a></p>



<a name="302810098"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/json%20parser/near/302810098" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/json.20parser.html#302810098">(Oct 07 2022 at 09:21)</a>:</h4>
<p>what OS are you running on? (I'm guessing Linux?)</p>



<a name="302814949"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/json%20parser/near/302814949" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/json.20parser.html#302814949">(Oct 07 2022 at 09:54)</a>:</h4>
<p>yes this is a debian based distro</p>



<a name="302853794"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/json%20parser/near/302853794" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/json.20parser.html#302853794">(Oct 07 2022 at 13:39)</a>:</h4>
<p>Yeah, that issue is known. It is an edge case in the surgical linker that is hit by some builtins. Mostly the float to/from string ones (but i am sure there are others). To be unblocked, user <code>--linker=legacy</code> for now</p>



<a name="302861045"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/json%20parser/near/302861045" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/json.20parser.html#302861045">(Oct 07 2022 at 14:13)</a>:</h4>
<p>yep can confirm i'm able to successfully run the reproduction using the <code>--linker=legacy</code> flag.</p>



<a name="302864608"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/json%20parser/near/302864608" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/json.20parser.html#302864608">(Oct 07 2022 at 14:31)</a>:</h4>
<p>now i'm seeing a different build error. goes away if i remove intP from this line.</p>
<div class="codehilite" data-code-language="CoffeeScript"><pre><span></span><code><span class="nv">valueP</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="nx">Parser</span><span class="w"> </span><span class="nx">RawStr</span><span class="w"> </span><span class="nx">Value</span><span class="w"></span>
<span class="nv">valueP</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">oneOf</span><span class="w"> </span><span class="p">[</span><span class="nx">nullP</span><span class="p">,</span><span class="w"> </span><span class="nx">trueP</span><span class="p">,</span><span class="w"> </span><span class="nx">falseP</span><span class="p">,</span><span class="w"> </span><span class="nx">strP</span><span class="p">,</span><span class="w"> </span><span class="nx">intP</span><span class="p">,</span><span class="w"> </span><span class="nx">floatP</span><span class="p">]</span><span class="w"></span>
</code></pre></div>
<p>intP and floatP are very similar</p>
<div class="codehilite" data-code-language="CoffeeScript"><pre><span></span><code><span class="nv">rawIntP</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="nx">Parser</span><span class="w"> </span><span class="nx">RawStr</span><span class="w"> </span><span class="nx">RawStr</span><span class="w"></span>
<span class="nv">rawIntP</span><span class="w"> </span><span class="o">=</span><span class="w"></span>
<span class="w">    </span><span class="nx">const</span><span class="w"> </span><span class="p">(</span><span class="err">\</span><span class="nx">mminus</span><span class="w"> </span><span class="nf">-&gt;</span><span class="w"> </span><span class="err">\</span><span class="nx">digit0</span><span class="w"> </span><span class="nf">-&gt;</span><span class="w"> </span><span class="err">\</span><span class="nx">digits</span><span class="w"> </span><span class="nf">-&gt;</span><span class="w"> </span><span class="nx">List</span><span class="p">.</span><span class="nx">join</span><span class="w"> </span><span class="p">[</span><span class="nx">mminus</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="nx">digit0</span><span class="p">],</span><span class="w"> </span><span class="nx">digits</span><span class="p">])</span><span class="w"></span>
<span class="w">    </span><span class="o">|&gt;</span><span class="w"> </span><span class="nx">apply</span><span class="w"> </span><span class="nx">maybeMinusP</span><span class="w"></span>
<span class="w">    </span><span class="o">|&gt;</span><span class="w"> </span><span class="nx">apply</span><span class="w"> </span><span class="nx">oneToNineP</span><span class="w"></span>
<span class="w">    </span><span class="o">|&gt;</span><span class="w"> </span><span class="nx">apply</span><span class="w"> </span><span class="p">(</span><span class="nx">many</span><span class="w"> </span><span class="nx">zeroToNineP</span><span class="p">)</span><span class="w"></span>

<span class="nv">intP</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="nx">Parser</span><span class="w"> </span><span class="nx">RawStr</span><span class="w"> </span><span class="nx">Value</span><span class="w"></span>
<span class="nv">intP</span><span class="w"> </span><span class="o">=</span><span class="w"></span>
<span class="w">    </span><span class="nx">rawIntP</span><span class="w"></span>
<span class="w">    </span><span class="o">|&gt;</span><span class="w"> </span><span class="nx">map</span><span class="w"> </span><span class="err">\</span><span class="nx">rawStr</span><span class="w"> </span><span class="nf">-&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nv">str</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">strFromRaw</span><span class="w"> </span><span class="nx">rawStr</span><span class="w"></span>
<span class="w">        </span><span class="k">when</span><span class="w"> </span><span class="nx">Str</span><span class="p">.</span><span class="nx">toI64</span><span class="w"> </span><span class="nx">str</span><span class="w"> </span><span class="o">is</span><span class="w"></span>
<span class="w">            </span><span class="nx">Ok</span><span class="w"> </span><span class="nx">num</span><span class="w"> </span><span class="nf">-&gt;</span><span class="w"> </span><span class="nx">Ok</span><span class="w"> </span><span class="p">(</span><span class="nb">Number</span><span class="w"> </span><span class="nx">num</span><span class="p">)</span><span class="w"></span>
<span class="w">            </span><span class="nx">Err</span><span class="w"> </span><span class="nx">_</span><span class="w"> </span><span class="nf">-&gt;</span><span class="w"> </span><span class="nx">Err</span><span class="w"> </span><span class="s">"`\(str)` is not a valid I64"</span><span class="w"></span>
<span class="w">    </span><span class="o">|&gt;</span><span class="w"> </span><span class="nx">flatten</span><span class="w"></span>

<span class="nv">rawFloatP</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="nx">Parser</span><span class="w"> </span><span class="nx">RawStr</span><span class="w"> </span><span class="nx">RawStr</span><span class="w"></span>
<span class="nv">rawFloatP</span><span class="w"> </span><span class="o">=</span><span class="w"></span>
<span class="w">    </span><span class="nx">const</span><span class="w"> </span><span class="p">(</span><span class="w"></span>
<span class="w">        </span><span class="err">\</span><span class="nx">mminus</span><span class="w"> </span><span class="nf">-&gt;</span><span class="w"> </span><span class="err">\</span><span class="nx">dig0</span><span class="w"> </span><span class="nf">-&gt;</span><span class="w"> </span><span class="err">\</span><span class="nx">digs</span><span class="w"> </span><span class="nf">-&gt;</span><span class="w"></span>
<span class="w">        </span><span class="err">\</span><span class="nx">ddot</span><span class="w"> </span><span class="nf">-&gt;</span><span class="w"> </span><span class="err">\</span><span class="nx">digsRhs</span><span class="w"> </span><span class="nf">-&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nx">List</span><span class="p">.</span><span class="nx">join</span><span class="w"> </span><span class="p">[</span><span class="w"></span>
<span class="w">            </span><span class="nx">mminus</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="nx">dig0</span><span class="p">],</span><span class="w"> </span><span class="nx">digs</span><span class="p">,</span><span class="w"></span>
<span class="w">            </span><span class="nx">ddot</span><span class="p">,</span><span class="w"> </span><span class="nx">digsRhs</span><span class="w"></span>
<span class="w">        </span><span class="p">]</span><span class="w"></span>
<span class="w">    </span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="o">|&gt;</span><span class="w"> </span><span class="nx">apply</span><span class="w"> </span><span class="nx">maybeMinusP</span><span class="w"></span>
<span class="w">    </span><span class="o">|&gt;</span><span class="w"> </span><span class="nx">apply</span><span class="w"> </span><span class="nx">oneToNineP</span><span class="w"></span>
<span class="w">    </span><span class="o">|&gt;</span><span class="w"> </span><span class="nx">apply</span><span class="w"> </span><span class="p">(</span><span class="nx">many</span><span class="w"> </span><span class="nx">zeroToNineP</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="o">|&gt;</span><span class="w"> </span><span class="nx">apply</span><span class="w"> </span><span class="nx">maybeDotP</span><span class="w"></span>
<span class="w">    </span><span class="o">|&gt;</span><span class="w"> </span><span class="nx">apply</span><span class="w"> </span><span class="p">(</span><span class="nx">many</span><span class="w"> </span><span class="nx">zeroToNineP</span><span class="p">)</span><span class="w"></span>

<span class="nv">floatP</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="nx">Parser</span><span class="w"> </span><span class="nx">RawStr</span><span class="w"> </span><span class="nx">Value</span><span class="w"></span>
<span class="nv">floatP</span><span class="w"> </span><span class="o">=</span><span class="w"></span>
<span class="w">    </span><span class="nx">rawFloatP</span><span class="w"></span>
<span class="w">    </span><span class="o">|&gt;</span><span class="w"> </span><span class="nx">map</span><span class="w"> </span><span class="err">\</span><span class="nx">rawStr</span><span class="w"> </span><span class="nf">-&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nv">str</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">strFromRaw</span><span class="w"> </span><span class="nx">rawStr</span><span class="w"></span>
<span class="w">        </span><span class="k">when</span><span class="w"> </span><span class="nx">Str</span><span class="p">.</span><span class="nx">toF64</span><span class="w"> </span><span class="nx">str</span><span class="w"> </span><span class="o">is</span><span class="w"></span>
<span class="w">            </span><span class="nx">Ok</span><span class="w"> </span><span class="nx">num</span><span class="w"> </span><span class="nf">-&gt;</span><span class="w"> </span><span class="nx">Ok</span><span class="w"> </span><span class="p">(</span><span class="nx">Float</span><span class="w"> </span><span class="nx">num</span><span class="p">)</span><span class="w"></span>
<span class="w">            </span><span class="nx">Err</span><span class="w"> </span><span class="nx">_</span><span class="w"> </span><span class="nf">-&gt;</span><span class="w"> </span><span class="nx">Err</span><span class="w"> </span><span class="s">"`\(str)` is not a valid F64"</span><span class="w"></span>
<span class="w">    </span><span class="o">|&gt;</span><span class="w"> </span><span class="nx">flatten</span><span class="w"></span>
</code></pre></div>
<p>here's the error trace:</p>
<div class="codehilite" data-code-language="Bash Session"><pre><span></span><code><span class="go">stack backtrace:</span>
<span class="go">   0: rust_begin_unwind</span>
<span class="go">             at /rustc/fe5b13d681f25ee6474be29d748c65adcd91f69e/library/std/src/panicking.rs:584:5</span>
<span class="go">   1: core::panicking::panic_fmt</span>
<span class="go">             at /rustc/fe5b13d681f25ee6474be29d748c65adcd91f69e/library/core/src/panicking.rs:143:14</span>
<span class="go">   2: roc_mono::borrow::ParamMap::get_param_offset</span>
<span class="go">   3: roc_mono::borrow::BorrowInfState::collect_expr</span>
<span class="go">   4: roc_mono::borrow::BorrowInfState::collect_stmt</span>
<span class="go">   5: roc_mono::borrow::BorrowInfState::collect_stmt</span>
<span class="go">   6: roc_mono::borrow::BorrowInfState::collect_stmt</span>
<span class="go">   7: roc_mono::borrow::infer_borrow</span>
<span class="go">   8: roc_mono::ir::Proc::insert_refcount_operations</span>
<span class="go">   9: roc_load_internal::file::update</span>
<span class="go">  10: roc_load_internal::file::state_thread_step</span>
<span class="go">  11: roc_load_internal::file::load_multi_threaded</span>
<span class="go">  12: roc_load_internal::file::load</span>
<span class="go">  13: roc_load::load_and_monomorphize</span>
<span class="go">  14: roc_cli::build::build_file</span>
<span class="go">  15: roc_cli::build</span>
<span class="go">  16: roc::main</span>
</code></pre></div>



<a name="302865067"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/json%20parser/near/302865067" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/json.20parser.html#302865067">(Oct 07 2022 at 14:33)</a>:</h4>
<p>maybe i'll try do de-dupe some of this and see what happens.</p>



<a name="302865369"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/json%20parser/near/302865369" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/json.20parser.html#302865369">(Oct 07 2022 at 14:35)</a>:</h4>
<p>Does <code>roc check</code> give a better error at all?</p>



<a name="302865869"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/json%20parser/near/302865869" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/json.20parser.html#302865869">(Oct 07 2022 at 14:37)</a>:</h4>
<p><code>roc check</code> shows  0 errors 0 warnings</p>



<a name="302866408"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/json%20parser/near/302866408" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/json.20parser.html#302866408">(Oct 07 2022 at 14:39)</a>:</h4>
<p>same error when </p>
<ol>
<li>moving floatP before intP</li>
<li>reusing rawIntP in rawFloatP</li>
</ol>



<a name="302876106"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/json%20parser/near/302876106" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/json.20parser.html#302876106">(Oct 07 2022 at 15:19)</a>:</h4>
<p>ended up working around the above issue by moving intP and floatP from the top-level <code>oneOf</code> to  an <code>alt</code> parser:</p>
<div class="codehilite" data-code-language="CoffeeScript"><pre><span></span><code><span class="nv">numberP</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="nx">Parser</span><span class="w"> </span><span class="nx">RawStr</span><span class="w"> </span><span class="nx">Value</span><span class="w"></span>
<span class="nv">numberP</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">alt</span><span class="w"> </span><span class="nx">floatP</span><span class="w"> </span><span class="nx">intP</span><span class="w"></span>
</code></pre></div>
<div class="codehilite" data-code-language="Bash Session"><pre><span></span><code><span class="gp">$ </span>roc  examples/parser/parse-json.roc --linker<span class="o">=</span>legacy
<span class="go">🔨 Rebuilding platform...</span>
<span class="go">null</span>
<span class="go">true</span>
<span class="go">false</span>
<span class="go">"null"</span>
<span class="go">123</span>
<span class="go">-123</span>
<span class="go">-1.23</span>
</code></pre></div>



<a name="302923408"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/json%20parser/near/302923408" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/json.20parser.html#302923408">(Oct 07 2022 at 19:44)</a>:</h4>
<p>good news here. somehow the errors related to arrays i was getting earlier (<a href="#narrow/stream/231634-beginners/topic/json.20parser/near/302777078">https://roc.zulipchat.com/#narrow/stream/231634-beginners/topic/json.20parser/near/302777078</a>) seem to have ceased.  i did a bunch of refactoring and i think roc is telling me i'm on the right track <span aria-label="smiley" class="emoji emoji-1f603" role="img" title="smiley">:smiley:</span></p>



<a name="302923595"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/json%20parser/near/302923595" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/json.20parser.html#302923595">(Oct 07 2022 at 19:45)</a>:</h4>
<p>so now i'm able to use my recursive array type and i think i need to use <code>examples/parsing/Parser/Core.roc#lazy</code></p>



<a name="302923803"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/json%20parser/near/302923803" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/json.20parser.html#302923803">(Oct 07 2022 at 19:47)</a>:</h4>
<p>does anyone have advice on how i can use it?  i've searched and found some strange syntax i don't understand like this: <code>lazy (\{} -&gt; fn)</code></p>



<a name="302924039"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/json%20parser/near/302924039" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/json.20parser.html#302924039">(Oct 07 2022 at 19:48)</a>:</h4>
<p>here is the error i'm running into</p>
<div class="codehilite" data-code-language="Bash Session"><pre><span></span><code><span class="go">── CIRCULAR DEFINITION ──────────────────────── examples/parser/parse-json.roc ─</span>

<span class="go">The arrayP definition is causing a very tricky infinite loop:</span>

<span class="go">163│  arrayP =</span>
<span class="go">      ^^^^^^</span>

<span class="go">The arrayP value depends on itself through the following chain of</span>
<span class="go">definitions:</span>

<span class="go">    ┌─────┐</span>
<span class="go">    │     arrayP</span>
<span class="go">    │     ↓</span>
<span class="go">    │     valueP</span>
<span class="go">    └─────┘</span>

<span class="go">────────────────────────────────────────────────────────────────────────────────</span>
</code></pre></div>



<a name="302924618"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/json%20parser/near/302924618" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/json.20parser.html#302924618">(Oct 07 2022 at 19:52)</a>:</h4>
<p>here is my attempt to use <code>lazy</code> which yields the error above</p>
<div class="codehilite" data-code-language="CoffeeScript"><pre><span></span><code><span class="nv">arrayP</span><span class="w"> </span><span class="o">=</span><span class="w"></span>
<span class="w">    </span><span class="nv">elements</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">sepBy</span><span class="w"> </span><span class="p">(</span><span class="nx">lazy</span><span class="w"> </span><span class="p">(</span><span class="err">\</span><span class="p">{}</span><span class="w"> </span><span class="nf">-&gt;</span><span class="w"> </span><span class="nx">valueP</span><span class="p">))</span><span class="w"> </span><span class="p">(</span><span class="nx">codeunit</span><span class="w"> </span><span class="nx">commaC</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="c1"># ...</span><span class="w"></span>

<span class="nv">valueP</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">oneOf</span><span class="w"> </span><span class="p">[</span><span class="nx">nullP</span><span class="p">,</span><span class="w"> </span><span class="nx">trueP</span><span class="p">,</span><span class="w"> </span><span class="nx">falseP</span><span class="p">,</span><span class="w"> </span><span class="nx">strlitP</span><span class="p">,</span><span class="w"> </span><span class="nx">numberP</span><span class="p">,</span><span class="w"> </span><span class="nx">lazy</span><span class="w"> </span><span class="p">(</span><span class="err">\</span><span class="p">{}</span><span class="w"> </span><span class="nf">-&gt;</span><span class="w"> </span><span class="nx">arrayP</span><span class="p">)]</span><span class="w"></span>
</code></pre></div>



<a name="302931775"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/json%20parser/near/302931775" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Carroll <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/json.20parser.html#302931775">(Oct 07 2022 at 20:45)</a>:</h4>
<p>You're using it correctly except you only need it once, not twice.</p>



<a name="302931857"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/json%20parser/near/302931857" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Carroll <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/json.20parser.html#302931857">(Oct 07 2022 at 20:46)</a>:</h4>
<p>Try getting rid of one of the lazy calls</p>



<a name="302931994"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/json%20parser/near/302931994" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Carroll <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/json.20parser.html#302931994">(Oct 07 2022 at 20:46)</a>:</h4>
<p><code>{}</code> is the empty record. The equivalent in C or JavaScript would be calling a function with no arguments.</p>



<a name="302932181"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/json%20parser/near/302932181" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Carroll <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/json.20parser.html#302932181">(Oct 07 2022 at 20:48)</a>:</h4>
<p>The point of using lazy is to break the recursion cycle so it doesn't blow up. But you only need to break the cycle in one place.</p>



<a name="302934162"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/json%20parser/near/302934162" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/json.20parser.html#302934162">(Oct 07 2022 at 21:02)</a>:</h4>
<p>Thanks. That syntax does seem strange.  Having someone explain its meaning helps a lot. <br>
To your suggestion, thats what I thought at first and tried using lazy once at each location and got the same error before trying both locations as shown above.</p>



<a name="302934654"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/json%20parser/near/302934654" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/json.20parser.html#302934654">(Oct 07 2022 at 21:06)</a>:</h4>
<p>So perhaps this means its something else?   Here is the full arrayP - after moving the lazy call to valueP below - incase it's relevant</p>
<div class="codehilite" data-code-language="CoffeeScript"><pre><span></span><code><span class="nv">arrayP</span><span class="w"> </span><span class="o">=</span><span class="w"></span>
<span class="w">    </span><span class="nv">elements</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">sepBy</span><span class="w"> </span><span class="nx">valueP</span><span class="w"> </span><span class="p">(</span><span class="nx">codeunit</span><span class="w"> </span><span class="nx">commaC</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="nx">const</span><span class="w"> </span><span class="p">(</span><span class="err">\</span><span class="nx">_</span><span class="w"> </span><span class="nf">-&gt;</span><span class="w"> </span><span class="err">\</span><span class="nx">_</span><span class="w"> </span><span class="nf">-&gt;</span><span class="w"> </span><span class="err">\</span><span class="nx">vals</span><span class="w"> </span><span class="nf">-&gt;</span><span class="w"> </span><span class="err">\</span><span class="nx">_</span><span class="w"> </span><span class="nf">-&gt;</span><span class="w"> </span><span class="err">\</span><span class="nx">_</span><span class="w"> </span><span class="nf">-&gt;</span><span class="w"> </span><span class="nx">vals</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="o">|&gt;</span><span class="w"> </span><span class="nx">apply</span><span class="w"> </span><span class="p">(</span><span class="nx">codeunit</span><span class="w"> </span><span class="nx">lbraceC</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="o">|&gt;</span><span class="w"> </span><span class="nx">apply</span><span class="w"> </span><span class="nx">wsP</span><span class="w"></span>
<span class="w">    </span><span class="o">|&gt;</span><span class="w"> </span><span class="nx">apply</span><span class="w"> </span><span class="nx">elements</span><span class="w"></span>
<span class="w">    </span><span class="o">|&gt;</span><span class="w"> </span><span class="nx">apply</span><span class="w"> </span><span class="nx">wsP</span><span class="w"></span>
<span class="w">    </span><span class="o">|&gt;</span><span class="w"> </span><span class="nx">apply</span><span class="w"> </span><span class="p">(</span><span class="nx">codeunit</span><span class="w"> </span><span class="nx">rbraceC</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="o">|&gt;</span><span class="w"> </span><span class="nx">map</span><span class="w"> </span><span class="p">(</span><span class="err">\</span><span class="nx">vals</span><span class="w"> </span><span class="nf">-&gt;</span><span class="w"> </span><span class="nb">Array</span><span class="w"> </span><span class="nx">vals</span><span class="p">)</span><span class="w"></span>
</code></pre></div>



<a name="302935477"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/json%20parser/near/302935477" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/json.20parser.html#302935477">(Oct 07 2022 at 21:12)</a>:</h4>
<p>otherwise it seems like i'm either using <code>lazy</code> incorrectly or missing some detail of how its used.</p>



<a name="302935591"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/json%20parser/near/302935591" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/json.20parser.html#302935591">(Oct 07 2022 at 21:13)</a>:</h4>
<p>maybe it doesn't work or works differently than expected?  i couldn't find any uses of it in the roc repo.</p>



<a name="302935864"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/json%20parser/near/302935864" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/json.20parser.html#302935864">(Oct 07 2022 at 21:15)</a>:</h4>
<p>here are two of the functions being used from examples/parser/Parser/Core.roc</p>
<div class="codehilite" data-code-language="CoffeeScript"><pre><span></span><code><span class="c1"># Internal utility function. Not exposed to users, since usage is discouraged!</span><span class="w"></span>
<span class="c1">#</span><span class="w"></span>
<span class="c1"># Runs `firstParser` and (only) if it succeeds,</span><span class="w"></span>
<span class="c1"># runs the function `buildNextParser` on its result value.</span><span class="w"></span>
<span class="c1"># This function returns a new parser, which is finally run.</span><span class="w"></span>
<span class="c1">#</span><span class="w"></span>
<span class="c1"># `andThen` is usually more flexible than necessary, and less efficient</span><span class="w"></span>
<span class="c1"># than using `const` with `map` and/or `apply`.</span><span class="w"></span>
<span class="c1"># Consider using those functions first.</span><span class="w"></span>
<span class="nv">andThen</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="nx">Parser</span><span class="w"> </span><span class="nx">input</span><span class="w"> </span><span class="nx">a</span><span class="p">,</span><span class="w"> </span><span class="nf">(a -&gt; Parser input b) -&gt;</span><span class="w"> </span><span class="nx">Parser</span><span class="w"> </span><span class="nx">input</span><span class="w"> </span><span class="nx">b</span><span class="w"></span>
<span class="nv">andThen</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="err">\</span><span class="nx">firstParser</span><span class="p">,</span><span class="w"> </span><span class="nx">buildNextParser</span><span class="w"> </span><span class="nf">-&gt;</span><span class="w"></span>
<span class="w">    </span><span class="nv">fun</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="err">\</span><span class="nx">input</span><span class="w"> </span><span class="nf">-&gt;</span><span class="w"></span>
<span class="w">        </span><span class="p">{</span><span class="w"> </span><span class="nv">val</span><span class="o">:</span><span class="w"> </span><span class="nx">firstVal</span><span class="p">,</span><span class="w"> </span><span class="nv">input</span><span class="o">:</span><span class="w"> </span><span class="nx">rest</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nx">Result</span><span class="p">.</span><span class="nx">try</span><span class="w"> </span><span class="p">(</span><span class="nx">parsePartial</span><span class="w"> </span><span class="nx">firstParser</span><span class="w"> </span><span class="nx">input</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="nv">nextParser</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">buildNextParser</span><span class="w"> </span><span class="nx">firstVal</span><span class="w"></span>

<span class="w">        </span><span class="nx">parsePartial</span><span class="w"> </span><span class="nx">nextParser</span><span class="w"> </span><span class="nx">rest</span><span class="w"></span>

<span class="w">    </span><span class="nx">buildPrimitiveParser</span><span class="w"> </span><span class="nx">fun</span><span class="w"></span>

<span class="c1">## Runs a parser lazily</span><span class="w"></span>
<span class="c1">##</span><span class="w"></span>
<span class="c1">## This is (only) useful when dealing with a recursive structure.</span><span class="w"></span>
<span class="c1">## For instance, consider a type `Comment : { message: String, responses: List Comment }`.</span><span class="w"></span>
<span class="c1">## Without `lazy`, you would ask the compiler to build an infinitely deep parser.</span><span class="w"></span>
<span class="c1">## (Resulting in a compiler error.)</span><span class="w"></span>
<span class="c1">##</span><span class="w"></span>
<span class="nv">lazy</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="nf">({} -&gt; Parser input a) -&gt;</span><span class="w"> </span><span class="nx">Parser</span><span class="w"> </span><span class="nx">input</span><span class="w"> </span><span class="nx">a</span><span class="w"></span>
<span class="nv">lazy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="err">\</span><span class="nx">thunk</span><span class="w"> </span><span class="nf">-&gt;</span><span class="w"></span>
<span class="w">    </span><span class="nx">const</span><span class="w"> </span><span class="p">{}</span><span class="w"></span>
<span class="w">    </span><span class="o">|&gt;</span><span class="w"> </span><span class="nx">andThen</span><span class="w"> </span><span class="nx">thunk</span><span class="w"></span>
</code></pre></div>



<a name="302938817"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/json%20parser/near/302938817" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ayaz Hafiz <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/json.20parser.html#302938817">(Oct 07 2022 at 21:42)</a>:</h4>
<p>could you add type annotations to <code>arrayP</code> and <code>valueP</code>? What are their types exactly?</p>



<a name="302938889"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/json%20parser/near/302938889" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ayaz Hafiz <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/json.20parser.html#302938889">(Oct 07 2022 at 21:43)</a>:</h4>
<p>It's possible this is a type checker bug, I made it do some trickery so that if it sees an infinitely-sized type, you get that error. But it's possible it's overly conservative</p>



<a name="302939032"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/json%20parser/near/302939032" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ayaz Hafiz <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/json.20parser.html#302939032">(Oct 07 2022 at 21:44)</a>:</h4>
<p>(As an aside - we recently landed some changes so that where you have <code>codeunit commaC</code>, you should be able to just use <code>codeunit ','</code> now)</p>



<a name="302939720"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/json%20parser/near/302939720" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/json.20parser.html#302939720">(Oct 07 2022 at 21:51)</a>:</h4>
<p>oh cool. glad to hear char literals are happening. i'll have to get a new compiler soon.</p>



<a name="302939841"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/json%20parser/near/302939841" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/json.20parser.html#302939841">(Oct 07 2022 at 21:52)</a>:</h4>
<p>here they are with type annotations:</p>
<div class="codehilite" data-code-language="CoffeeScript"><pre><span></span><code><span class="nv">arrayP</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="nx">Parser</span><span class="w"> </span><span class="nx">RawStr</span><span class="w"> </span><span class="nx">Value</span><span class="w"></span>
<span class="nv">arrayP</span><span class="w"> </span><span class="o">=</span><span class="w"></span>
<span class="w">    </span><span class="nv">elements</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">sepBy</span><span class="w"> </span><span class="nx">valueP</span><span class="w"> </span><span class="p">(</span><span class="nx">codeunit</span><span class="w"> </span><span class="nx">commaC</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="nx">const</span><span class="w"> </span><span class="p">(</span><span class="err">\</span><span class="nx">_</span><span class="w"> </span><span class="nf">-&gt;</span><span class="w"> </span><span class="err">\</span><span class="nx">_</span><span class="w"> </span><span class="nf">-&gt;</span><span class="w"> </span><span class="err">\</span><span class="nx">vals</span><span class="w"> </span><span class="nf">-&gt;</span><span class="w"> </span><span class="err">\</span><span class="nx">_</span><span class="w"> </span><span class="nf">-&gt;</span><span class="w"> </span><span class="err">\</span><span class="nx">_</span><span class="w"> </span><span class="nf">-&gt;</span><span class="w"> </span><span class="nx">vals</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="o">|&gt;</span><span class="w"> </span><span class="nx">apply</span><span class="w"> </span><span class="p">(</span><span class="nx">codeunit</span><span class="w"> </span><span class="nx">lbraceC</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="o">|&gt;</span><span class="w"> </span><span class="nx">apply</span><span class="w"> </span><span class="nx">wsP</span><span class="w"></span>
<span class="w">    </span><span class="o">|&gt;</span><span class="w"> </span><span class="nx">apply</span><span class="w"> </span><span class="nx">elements</span><span class="w"></span>
<span class="w">    </span><span class="o">|&gt;</span><span class="w"> </span><span class="nx">apply</span><span class="w"> </span><span class="nx">wsP</span><span class="w"></span>
<span class="w">    </span><span class="o">|&gt;</span><span class="w"> </span><span class="nx">apply</span><span class="w"> </span><span class="p">(</span><span class="nx">codeunit</span><span class="w"> </span><span class="nx">rbraceC</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="o">|&gt;</span><span class="w"> </span><span class="nx">map</span><span class="w"> </span><span class="p">(</span><span class="err">\</span><span class="nx">vals</span><span class="w"> </span><span class="nf">-&gt;</span><span class="w"> </span><span class="nb">Array</span><span class="w"> </span><span class="nx">vals</span><span class="p">)</span><span class="w"></span>


<span class="nv">valueP</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="nx">Parser</span><span class="w"> </span><span class="nx">RawStr</span><span class="w"> </span><span class="nx">Value</span><span class="w"></span>
<span class="nv">valueP</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">oneOf</span><span class="w"> </span><span class="p">[</span><span class="nx">nullP</span><span class="p">,</span><span class="w"> </span><span class="nx">trueP</span><span class="p">,</span><span class="w"> </span><span class="nx">falseP</span><span class="p">,</span><span class="w"> </span><span class="nx">strlitP</span><span class="p">,</span><span class="w"> </span><span class="nx">numberP</span><span class="p">,</span><span class="w"> </span><span class="nx">lazy</span><span class="w"> </span><span class="p">(</span><span class="err">\</span><span class="p">{}</span><span class="w"> </span><span class="nf">-&gt;</span><span class="w"> </span><span class="nx">arrayP</span><span class="p">)]</span><span class="w"></span>
</code></pre></div>



<a name="302940084"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/json%20parser/near/302940084" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/json.20parser.html#302940084">(Oct 07 2022 at 21:54)</a>:</h4>
<p>i can post the whole file somewhere if you want too</p>



<a name="302940321"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/json%20parser/near/302940321" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ayaz Hafiz <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/json.20parser.html#302940321">(Oct 07 2022 at 21:57)</a>:</h4>
<p>Hm. Yeah this might be a compiler bug, unless I'm misunderstanding the program. Could you please file a bug report with a link to the whole file? If possible, we'd appreciate minimizing the file to a minimal reproduction of the error. I can take a look at this early next week.</p>



<a name="302940467"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/json%20parser/near/302940467" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/json.20parser.html#302940467">(Oct 07 2022 at 21:58)</a>:</h4>
<p>yes certainly will do. i'll work on whittling down to a smaller repro a bit later. will post back here then.</p>



<a name="302976446"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/json%20parser/near/302976446" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/json.20parser.html#302976446">(Oct 08 2022 at 07:30)</a>:</h4>
<p><span class="user-mention" data-user-id="454654">@Ayaz Hafiz</span> here is the issue. <a href="https://github.com/roc-lang/roc/issues/4246">https://github.com/roc-lang/roc/issues/4246</a> let me know if the repro looks ok.</p>



<a name="303028936"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/json%20parser/near/303028936" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ayaz Hafiz <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/json.20parser.html#303028936">(Oct 08 2022 at 14:50)</a>:</h4>
<p>Thanks!</p>



<a name="303028985"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/json%20parser/near/303028985" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ayaz Hafiz <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/json.20parser.html#303028985">(Oct 08 2022 at 14:51)</a>:</h4>
<p>In that repro, though, the error makes sense - because you can't build <code>a</code> without having to inline it an infinite number of times</p>



<a name="303029009"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/json%20parser/near/303029009" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ayaz Hafiz <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/json.20parser.html#303029009">(Oct 08 2022 at 14:51)</a>:</h4>
<p>which makes me think, maybe the way to solve your problem is like this?</p>



<a name="303029129"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/json%20parser/near/303029129" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ayaz Hafiz <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/json.20parser.html#303029129">(Oct 08 2022 at 14:52)</a>:</h4>
<div class="codehilite"><pre><span></span><code>arrayP : Parser RawStr Value
arrayP =
    lazy (\{} -&gt;
    elements = sepBy valueP (codeunit commaC)
    const (\_ -&gt; \_ -&gt; \vals -&gt; \_ -&gt; \_ -&gt; vals)
    |&gt; apply (codeunit lbraceC)
    |&gt; apply wsP
    |&gt; apply elements
    |&gt; apply wsP
    |&gt; apply (codeunit rbraceC)
    |&gt; map (\vals -&gt; Array vals)
    )


valueP : Parser RawStr Value
valueP = oneOf [nullP, trueP, falseP, strlitP, numberP, arrayP]
</code></pre></div>



<a name="303029158"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/json%20parser/near/303029158" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ayaz Hafiz <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/json.20parser.html#303029158">(Oct 08 2022 at 14:52)</a>:</h4>
<p>(sorry for the terrible formatting, can't tab-indent in Zulip</p>



<a name="303029191"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/json%20parser/near/303029191" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ayaz Hafiz <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/json.20parser.html#303029191">(Oct 08 2022 at 14:53)</a>:</h4>
<p>Or, conversely,</p>
<div class="codehilite"><pre><span></span><code>arrayP : Parser RawStr Value
arrayP =
    elements = sepBy valueP (codeunit commaC)
    const (\_ -&gt; \_ -&gt; \vals -&gt; \_ -&gt; \_ -&gt; vals)
    |&gt; apply (codeunit lbraceC)
    |&gt; apply wsP
    |&gt; apply elements
    |&gt; apply wsP
    |&gt; apply (codeunit rbraceC)
    |&gt; map (\vals -&gt; Array vals)


valueP : Parser RawStr Value
valueP = lazy (\{} -&gt; oneOf [nullP, trueP, falseP, strlitP, numberP, arrayP])
</code></pre></div>



<a name="303029254"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/json%20parser/near/303029254" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ayaz Hafiz <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/json.20parser.html#303029254">(Oct 08 2022 at 14:53)</a>:</h4>
<p>So that the whole parser is forced to be lazy, rather a subpart</p>



<a name="303030013"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/json%20parser/near/303030013" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ayaz Hafiz <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/json.20parser.html#303030013">(Oct 08 2022 at 14:59)</a>:</h4>
<p>oh nevermind</p>



<a name="303030035"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/json%20parser/near/303030035" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ayaz Hafiz <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/json.20parser.html#303030035">(Oct 08 2022 at 14:59)</a>:</h4>
<p>The parser is a function so it's fine</p>



<a name="303030672"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/json%20parser/near/303030672" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ayaz Hafiz <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/json.20parser.html#303030672">(Oct 08 2022 at 15:04)</a>:</h4>
<p>okay, it's a compiler bug. I'll make a PR</p>



<a name="303031611"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/json%20parser/near/303031611" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ayaz Hafiz <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/json.20parser.html#303031611">(Oct 08 2022 at 15:11)</a>:</h4>
<p><a href="https://github.com/roc-lang/roc/pull/4257">https://github.com/roc-lang/roc/pull/4257</a> should fix it</p>



<a name="303071552"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/json%20parser/near/303071552" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/json.20parser.html#303071552">(Oct 08 2022 at 23:05)</a>:</h4>
<p>Wow very cool. Thanks for the quick response.  Hope this gets merged so i can try it out.</p>



<a name="303071613"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/json%20parser/near/303071613" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/json.20parser.html#303071613">(Oct 08 2022 at 23:06)</a>:</h4>
<p>i don't have a proper dev setup yet and relying on download assets.  no rust / cargo install here.</p>



<a name="303072550"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/json%20parser/near/303072550" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/json.20parser.html#303072550">(Oct 08 2022 at 23:21)</a>:</h4>
<p>just merged it!</p>



<a name="303072561"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/json%20parser/near/303072561" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/json.20parser.html#303072561">(Oct 08 2022 at 23:21)</a>:</h4>
<p>so it'll be included in tonight's nightly release</p>



<a name="303148914"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/json%20parser/near/303148914" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/json.20parser.html#303148914">(Oct 09 2022 at 16:09)</a>:</h4>
<p>looks like the new character literals are <code>U32</code>s not <code>U8</code>s.  is this correct?</p>



<a name="303148927"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/json%20parser/near/303148927" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/json.20parser.html#303148927">(Oct 09 2022 at 16:10)</a>:</h4>
<p>i tried yesterday's nightly and seeing this new error</p>
<div class="codehilite" data-code-language="Bash Session"><pre><span></span><code><span class="go">── TYPE MISMATCH ────────────────────────────── examples/parser/Parser/Str.roc ─</span>

<span class="go">This 2nd argument to map has an unexpected type:</span>

<span class="go">181│&gt;          |&gt; List.map \digitNum -&gt;</span>
<span class="go">182│&gt;              digitNum</span>
<span class="go">183│&gt;              |&gt; codeunit</span>
<span class="go">184│&gt;              |&gt; map (\_ -&gt; digitNum)</span>

<span class="go">The argument is an anonymous function of type:</span>

<span class="go">    U8 -&gt; Parser RawStr U8 ?</span>

<span class="go">But map needs its 2nd argument to be:</span>

<span class="go">    Int Unsigned32 -&gt; Parser RawStr U8 ?</span>

<span class="go">────────────────────────────────────────────────────────────────────────────────</span>
</code></pre></div>



<a name="303149114"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/json%20parser/near/303149114" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/json.20parser.html#303149114">(Oct 09 2022 at 16:11)</a>:</h4>
<p>oops nevermind. the above uses Oct 7 release, not Oct 8</p>



<a name="303149634"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/json%20parser/near/303149634" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/json.20parser.html#303149634">(Oct 09 2022 at 16:17)</a>:</h4>
<p>and the error is gone in Oct 8 release</p>



<a name="303149838"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/json%20parser/near/303149838" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/json.20parser.html#303149838">(Oct 09 2022 at 16:19)</a>:</h4>
<p>character literals working now <span aria-label="tada" class="emoji emoji-1f389" role="img" title="tada">:tada:</span> <span aria-label="rock on" class="emoji emoji-1f918" role="img" title="rock on">:rock_on:</span></p>



<a name="303305683"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/json%20parser/near/303305683" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/json.20parser.html#303305683">(Oct 10 2022 at 18:11)</a>:</h4>
<p>seems that the 2022-10-10-07ceabc build has problems. it no longer catches the cyclic dependency when i don't do the lazy calls.</p>



<a name="303305869"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/json%20parser/near/303305869" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/json.20parser.html#303305869">(Oct 10 2022 at 18:12)</a>:</h4>
<p>and it crashes trying to build if i do the lazy calls</p>
<div class="codehilite" data-code-language="Bash Session"><pre><span></span><code><span class="gp">$ </span>roc build examples/parser/parse-json.roc

<span class="go">thread '&lt;unknown&gt;' has overflowed its stack</span>
<span class="go">fatal runtime error: stack overflow</span>
<span class="go">Aborted</span>
</code></pre></div>



<a name="303305932"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/json%20parser/near/303305932" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ayaz Hafiz <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/json.20parser.html#303305932">(Oct 10 2022 at 18:12)</a>:</h4>
<p>I think your implementation was right all along because parsers are functions, so you may not strictly need <code>lazy</code> in your use case</p>



<a name="303305961"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/json%20parser/near/303305961" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ayaz Hafiz <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/json.20parser.html#303305961">(Oct 10 2022 at 18:12)</a>:</h4>
<p>well.. that's no good</p>



<a name="303306148"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/json%20parser/near/303306148" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ayaz Hafiz <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/json.20parser.html#303306148">(Oct 10 2022 at 18:14)</a>:</h4>
<p>does it build if you do it without lazy</p>



<a name="303306219"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/json%20parser/near/303306219" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/json.20parser.html#303306219">(Oct 10 2022 at 18:14)</a>:</h4>
<p>yep. it also crashes with the same message on build without the lazy calls</p>



<a name="303306481"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/json%20parser/near/303306481" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ayaz Hafiz <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/json.20parser.html#303306481">(Oct 10 2022 at 18:17)</a>:</h4>
<p>Do you have lldb or gdb on your machine?</p>



<a name="303306601"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/json%20parser/near/303306601" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/json.20parser.html#303306601">(Oct 10 2022 at 18:18)</a>:</h4>
<p>just gdb atm. shall i try for a backtrace? last time i tried it was garbled.</p>



<a name="303306670"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/json%20parser/near/303306670" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ayaz Hafiz <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/json.20parser.html#303306670">(Oct 10 2022 at 18:18)</a>:</h4>
<p>Yes please</p>



<a name="303306695"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/json%20parser/near/303306695" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ayaz Hafiz <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/json.20parser.html#303306695">(Oct 10 2022 at 18:18)</a>:</h4>
<p>this is an error in the compiler so it should be better I think</p>



<a name="303306827"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/json%20parser/near/303306827" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/json.20parser.html#303306827">(Oct 10 2022 at 18:19)</a>:</h4>
<p>yes its better now. here is the first page</p>
<div class="codehilite" data-code-language="Bash Session"><pre><span></span><code><span class="gp">$ </span>gdb -args roc build examples/parser/parse-json.roc
<span class="go">GNU gdb (Debian 10.1-1.7) 10.1.90.20210103-git</span>
<span class="go">Copyright (C) 2021 Free Software Foundation, Inc.</span>
<span class="go">License GPLv3+: GNU GPL version 3 or later &lt;http://gnu.org/licenses/gpl.html&gt;</span>
<span class="go">This is free software: you are free to change and redistribute it.</span>
<span class="go">There is NO WARRANTY, to the extent permitted by law.</span>
<span class="go">Type "show copying" and "show warranty" for details.</span>
<span class="go">This GDB was configured as "x86_64-linux-gnu".</span>
<span class="go">Type "show configuration" for configuration details.</span>
<span class="go">For bug reporting instructions, please see:</span>
<span class="go">&lt;https://www.gnu.org/software/gdb/bugs/&gt;.</span>
<span class="go">Find the GDB manual and other documentation resources online at:</span>
<span class="go">    &lt;http://www.gnu.org/software/gdb/documentation/&gt;.</span>

<span class="go">For help, type "help".</span>
<span class="go">Type "apropos word" to search for commands related to "word"...</span>
<span class="go">Reading symbols from roc...</span>
<span class="gp gp-VirtualEnv">(gdb)</span> <span class="go">run</span>
<span class="go">Starting program: /home/travis/.local/bin/roc build examples/parser/parse-json.roc</span>
<span class="go">[Thread debugging using libthread_db enabled]</span>
<span class="go">Using host libthread_db library "/lib/x86_64-linux-gnu/libthread_db.so.1".</span>
<span class="go">[New Thread 0x7ffff75ff700 (LWP 163044)]</span>
<span class="go">[New Thread 0x7fffeffff700 (LWP 163045)]</span>
<span class="go">[New Thread 0x7ffff6dfe700 (LWP 163046)]</span>
<span class="go">[New Thread 0x7ffff65fd700 (LWP 163047)]</span>
<span class="go">[New Thread 0x7ffff5dfc700 (LWP 163048)]</span>
<span class="go">[New Thread 0x7ffff55fb700 (LWP 163049)]</span>
<span class="go">[New Thread 0x7ffff4dfa700 (LWP 163050)]</span>
<span class="go">[New Thread 0x7fffef7fe700 (LWP 163051)]</span>
<span class="go">[New Thread 0x7fffeeffd700 (LWP 163052)]</span>
<span class="go">[New Thread 0x7fffee7fc700 (LWP 163053)]</span>
<span class="go">[New Thread 0x7fffedffb700 (LWP 163054)]</span>

<span class="go">Thread 5 "roc" received signal SIGSEGV, Segmentation fault.</span>
<span class="go">[Switching to Thread 0x7ffff65fd700 (LWP 163047)]</span>
<span class="go">0x00005555562eee34 in roc_mono::layout::layout_from_flat_type ()</span>
<span class="gp gp-VirtualEnv">(gdb)</span> <span class="go">bt</span>
<span class="gp">#</span><span class="m">0</span>  0x00005555562eee34 <span class="k">in</span> roc_mono::layout::layout_from_flat_type <span class="o">()</span>
<span class="gp">#</span><span class="m">1</span>  0x00005555562ed57f <span class="k">in</span> roc_mono::layout::Layout::new_help <span class="o">()</span>
<span class="gp">#</span><span class="m">2</span>  0x00005555562edeca <span class="k">in</span> roc_mono::layout::Layout::from_var <span class="o">()</span>
<span class="gp">#</span><span class="m">3</span>  0x00005555562edeca <span class="k">in</span> roc_mono::layout::Layout::from_var <span class="o">()</span>
<span class="gp">#</span><span class="m">4</span>  0x000055555630381f <span class="k">in</span> roc_mono::layout::list_layout_from_elem <span class="o">()</span>
<span class="gp">#</span><span class="m">5</span>  0x00005555562f3ea4 <span class="k">in</span> roc_mono::layout::layout_from_flat_type <span class="o">()</span>
<span class="gp">#</span><span class="m">6</span>  0x00005555562ed57f <span class="k">in</span> roc_mono::layout::Layout::new_help <span class="o">()</span>
<span class="gp">#</span><span class="m">7</span>  0x00005555562edeca <span class="k">in</span> roc_mono::layout::Layout::from_var <span class="o">()</span>
<span class="gp">#</span><span class="m">8</span>  0x00005555562f2e41 <span class="k">in</span> roc_mono::layout::layout_from_flat_type <span class="o">()</span>
<span class="gp">#</span><span class="m">9</span>  0x00005555562ed57f <span class="k">in</span> roc_mono::layout::Layout::new_help <span class="o">()</span>
<span class="gp">#</span><span class="m">10</span> 0x00005555562edeca <span class="k">in</span> roc_mono::layout::Layout::from_var <span class="o">()</span>
<span class="gp">#</span><span class="m">11</span> 0x00005555562edeca <span class="k">in</span> roc_mono::layout::Layout::from_var <span class="o">()</span>
<span class="gp">#</span><span class="m">12</span> 0x000055555630381f <span class="k">in</span> roc_mono::layout::list_layout_from_elem <span class="o">()</span>
<span class="gp">#</span><span class="m">13</span> 0x00005555562f3ea4 <span class="k">in</span> roc_mono::layout::layout_from_flat_type <span class="o">()</span>
<span class="gp">#</span><span class="m">14</span> 0x00005555562ed57f <span class="k">in</span> roc_mono::layout::Layout::new_help <span class="o">()</span>
<span class="gp">#</span><span class="m">15</span> 0x00005555562edeca <span class="k">in</span> roc_mono::layout::Layout::from_var <span class="o">()</span>
<span class="gp">#</span><span class="m">16</span> 0x00005555562f2e41 <span class="k">in</span> roc_mono::layout::layout_from_flat_type <span class="o">()</span>
<span class="gp">#</span><span class="m">17</span> 0x00005555562ed57f <span class="k">in</span> roc_mono::layout::Layout::new_help <span class="o">()</span>
<span class="gp">#</span><span class="m">18</span> 0x00005555562edeca <span class="k">in</span> roc_mono::layout::Layout::from_var <span class="o">()</span>
<span class="gp">#</span><span class="m">19</span> 0x00005555562edeca <span class="k">in</span> roc_mono::layout::Layout::from_var <span class="o">()</span>
<span class="gp">#</span><span class="m">20</span> 0x000055555630381f <span class="k">in</span> roc_mono::layout::list_layout_from_elem <span class="o">()</span>
<span class="gp">#</span><span class="m">21</span> 0x00005555562f3ea4 <span class="k">in</span> roc_mono::layout::layout_from_flat_type <span class="o">()</span>
<span class="gp">#</span><span class="m">22</span> 0x00005555562ed57f <span class="k">in</span> roc_mono::layout::Layout::new_help <span class="o">()</span>
<span class="gp">#</span><span class="m">23</span> 0x00005555562edeca <span class="k">in</span> roc_mono::layout::Layout::from_var <span class="o">()</span>
<span class="gp">#</span><span class="m">24</span> 0x00005555562f2e41 <span class="k">in</span> roc_mono::layout::layout_from_flat_type <span class="o">()</span>
<span class="gp">#</span><span class="m">25</span> 0x00005555562ed57f <span class="k">in</span> roc_mono::layout::Layout::new_help <span class="o">()</span>
<span class="gp">#</span><span class="m">26</span> 0x00005555562edeca <span class="k">in</span> roc_mono::layout::Layout::from_var <span class="o">()</span>
<span class="gp">#</span><span class="m">27</span> 0x00005555562edeca <span class="k">in</span> roc_mono::layout::Layout::from_var <span class="o">()</span>
<span class="gp">#</span><span class="m">28</span> 0x000055555630381f <span class="k">in</span> roc_mono::layout::list_layout_from_elem <span class="o">()</span>
<span class="gp">#</span><span class="m">29</span> 0x00005555562f3ea4 <span class="k">in</span> roc_mono::layout::layout_from_flat_type <span class="o">()</span>
<span class="gp">#</span><span class="m">30</span> 0x00005555562ed57f <span class="k">in</span> roc_mono::layout::Layout::new_help <span class="o">()</span>
<span class="gp">#</span><span class="m">31</span> 0x00005555562edeca <span class="k">in</span> roc_mono::layout::Layout::from_var <span class="o">()</span>
</code></pre></div>



<a name="303306977"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/json%20parser/near/303306977" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/json.20parser.html#303306977">(Oct 10 2022 at 18:21)</a>:</h4>
<p>looks like similar repeated many times</p>



<a name="303307019"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/json%20parser/near/303307019" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ayaz Hafiz <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/json.20parser.html#303307019">(Oct 10 2022 at 18:21)</a>:</h4>
<p>yeah we're very familiar with this one <span aria-label="sweat smile" class="emoji emoji-1f605" role="img" title="sweat smile">:sweat_smile:</span> happens a lot these days</p>



<a name="303307043"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/json%20parser/near/303307043" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ayaz Hafiz <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/json.20parser.html#303307043">(Oct 10 2022 at 18:22)</a>:</h4>
<p>and <code>roc check</code> passes?</p>



<a name="303307204"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/json%20parser/near/303307204" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/json.20parser.html#303307204">(Oct 10 2022 at 18:23)</a>:</h4>
<p>yeah roc check passed on both (lazy and no lazy). there is one warning but thats just unused warning</p>



<a name="303307420"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/json%20parser/near/303307420" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ayaz Hafiz <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/json.20parser.html#303307420">(Oct 10 2022 at 18:25)</a>:</h4>
<p>I'm really sorry you're blocked again right after the other fix <span aria-label="disappointed" class="emoji emoji-1f61e" role="img" title="disappointed">:disappointed:</span></p>



<a name="303307470"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/json%20parser/near/303307470" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ayaz Hafiz <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/json.20parser.html#303307470">(Oct 10 2022 at 18:25)</a>:</h4>
<p>Would you mind trying to whittle down a smaller reproduction and filing a bug report again?</p>



<a name="303307510"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/json%20parser/near/303307510" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ayaz Hafiz <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/json.20parser.html#303307510">(Oct 10 2022 at 18:26)</a>:</h4>
<p>In the meantime, you could try removing all type annotations from your program - that might actually fix the compiler bug</p>



<a name="303307717"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/json%20parser/near/303307717" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/json.20parser.html#303307717">(Oct 10 2022 at 18:27)</a>:</h4>
<p>sure. no problem. understood that lots of development going on, young lang etc.</p>



<a name="303307849"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/json%20parser/near/303307849" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/json.20parser.html#303307849">(Oct 10 2022 at 18:28)</a>:</h4>
<p>sure i'll reopen the last issue. should work on repro pretty soon</p>



<a name="303307890"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/json%20parser/near/303307890" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/json.20parser.html#303307890">(Oct 10 2022 at 18:29)</a>:</h4>
<p>will let you know if removing type annotations works</p>



<a name="303307957"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/json%20parser/near/303307957" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ayaz Hafiz <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/json.20parser.html#303307957">(Oct 10 2022 at 18:29)</a>:</h4>
<p>thanks!</p>



<a name="303308002"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/json%20parser/near/303308002" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/json.20parser.html#303308002">(Oct 10 2022 at 18:29)</a>:</h4>
<p>looks like the end of that trace is different if you want to see it. i forgot to let it run out before.</p>



<a name="303308486"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/json%20parser/near/303308486" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ayaz Hafiz <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/json.20parser.html#303308486">(Oct 10 2022 at 18:33)</a>:</h4>
<p>It's okay, the trace you showed tells us enough about what the problem is. I'll dig deeper into it with a debug build of the compiler which provides more stack trace info</p>



<a name="303309065"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/json%20parser/near/303309065" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/json.20parser.html#303309065">(Oct 10 2022 at 18:37)</a>:</h4>
<p>ok. i'm seeing a different error after removing the annotations</p>
<div class="codehilite" data-code-language="Bash Session"><pre><span></span><code><span class="gp"># </span>with lazy call
<span class="gp">$ </span>roc build examples/parser/parse-json.roc
<span class="go">thread '&lt;unnamed&gt;' panicked at 'not yet implemented: recursive closures', crates/compiler/mono/src/layout.rs:1524:61</span>
<span class="go">note: run with `RUST_BACKTRACE=1` environment variable to display a backtrace</span>
</code></pre></div>



<a name="303309206"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/json%20parser/near/303309206" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ayaz Hafiz <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/json.20parser.html#303309206">(Oct 10 2022 at 18:38)</a>:</h4>
<p>okay, that is a lot more promising</p>



<a name="303309207"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/json%20parser/near/303309207" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/json.20parser.html#303309207">(Oct 10 2022 at 18:38)</a>:</h4>
<p>without lazy calls i see the same error message</p>



<a name="303309242"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/json%20parser/near/303309242" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/json.20parser.html#303309242">(Oct 10 2022 at 18:38)</a>:</h4>
<p>*as before</p>



<a name="303309293"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/json%20parser/near/303309293" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/json.20parser.html#303309293">(Oct 10 2022 at 18:39)</a>:</h4>
<p>this one</p>
<div class="codehilite" data-code-language="Bash Session"><pre><span></span><code><span class="gp"># </span>no lazy calls and no annotations
<span class="gp">$ </span>roc build examples/parser/parse-json.roc

<span class="go">thread '&lt;unknown&gt;' has overflowed its stack</span>
<span class="go">fatal runtime error: stack overflow</span>
<span class="go">Aborted</span>
</code></pre></div>



<a name="303309380"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/json%20parser/near/303309380" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/json.20parser.html#303309380">(Oct 10 2022 at 18:39)</a>:</h4>
<p>sorry that sentence was ambiguous</p>



<a name="303309560"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/json%20parser/near/303309560" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ayaz Hafiz <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/json.20parser.html#303309560">(Oct 10 2022 at 18:41)</a>:</h4>
<p>all good</p>



<a name="303318594"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/json%20parser/near/303318594" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/json.20parser.html#303318594">(Oct 10 2022 at 19:59)</a>:</h4>
<p>shoot i can't reopen it. will make a new one w/ reference</p>



<a name="303320427"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/json%20parser/near/303320427" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/json.20parser.html#303320427">(Oct 10 2022 at 20:15)</a>:</h4>
<p><a href="https://github.com/roc-lang/roc/issues/4288">https://github.com/roc-lang/roc/issues/4288</a></p>



<a name="303320506"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/json%20parser/near/303320506" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/json.20parser.html#303320506">(Oct 10 2022 at 20:16)</a>:</h4>
<p>let me know if the repro needs any changes</p>



<a name="303320635"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/json%20parser/near/303320635" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/json.20parser.html#303320635">(Oct 10 2022 at 20:18)</a>:</h4>
<p>wasn't sure wether to include the last two which have annotations</p>



<a name="303322297"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/json%20parser/near/303322297" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/json.20parser.html#303322297">(Oct 10 2022 at 20:32)</a>:</h4>
<p>is it known or expected that '\b' and '\f' aren't legal char literals?</p>



<a name="303326107"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/json%20parser/near/303326107" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/json.20parser.html#303326107">(Oct 10 2022 at 21:11)</a>:</h4>
<p>I forget - what do those do?</p>



<a name="303326655"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/json%20parser/near/303326655" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/json.20parser.html#303326655">(Oct 10 2022 at 21:17)</a>:</h4>
<p>backspace and form feed</p>



<a name="303326712"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/json%20parser/near/303326712" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/json.20parser.html#303326712">(Oct 10 2022 at 21:17)</a>:</h4>
<p>i forget if they're legal in json but happened to have them being escaped for some reason</p>



<a name="303327408"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/json%20parser/near/303327408" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/json.20parser.html#303327408">(Oct 10 2022 at 21:24)</a>:</h4>
<p>oh yeah if I remember right, I think I evaluated those and concluded they probably weren't a good idea to have first class support for</p>



<a name="303327564"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/json%20parser/near/303327564" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/json.20parser.html#303327564">(Oct 10 2022 at 21:26)</a>:</h4>
<p>sounds good <span aria-label="+1" class="emoji emoji-1f44d" role="img" title="+1">:+1:</span> . just checking to make sure it was intended.</p>



<a name="303353444"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/json%20parser/near/303353444" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/json.20parser.html#303353444">(Oct 11 2022 at 03:06)</a>:</h4>
<p><span class="user-mention silent" data-user-id="551275">Travis</span> <a href="#narrow/stream/231634-beginners/topic/json.20parser/near/303320427">said</a>:</p>
<blockquote>
<p><a href="https://github.com/roc-lang/roc/issues/4288">https://github.com/roc-lang/roc/issues/4288</a></p>
</blockquote>
<p><span class="user-mention" data-user-id="454654">@Ayaz Hafiz</span> did you see this?</p>



<a name="303354013"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/json%20parser/near/303354013" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ayaz Hafiz <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/json.20parser.html#303354013">(Oct 11 2022 at 03:17)</a>:</h4>
<p>Yes - thanks for the report. I don't know when I'll get to it but it's definitely on my radar!</p>



<a name="303864967"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/json%20parser/near/303864967" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/json.20parser.html#303864967">(Oct 13 2022 at 15:38)</a>:</h4>
<p><span class="user-mention" data-user-id="551275">@Travis</span> do you have the current code for your json parser posted anywhere?</p>



<a name="303867342"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/json%20parser/near/303867342" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/json.20parser.html#303867342">(Oct 13 2022 at 15:49)</a>:</h4>
<p>not yet. i'll create a new gist incase the old one is of use for #4233.</p>



<a name="303867377"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/json%20parser/near/303867377" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/json.20parser.html#303867377">(Oct 13 2022 at 15:49)</a>:</h4>
<p>thanks! <span aria-label="smiley" class="emoji emoji-1f603" role="img" title="smiley">:smiley:</span></p>



<a name="303867408"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/json%20parser/near/303867408" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/json.20parser.html#303867408">(Oct 13 2022 at 15:49)</a>:</h4>
<p>here you go. <a href="https://gist.github.com/travisstaloch/acae64ec4d8346597f1aaecfe8c401e4">https://gist.github.com/travisstaloch/acae64ec4d8346597f1aaecfe8c401e4</a></p>



<a name="303867596"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/json%20parser/near/303867596" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/json.20parser.html#303867596">(Oct 13 2022 at 15:50)</a>:</h4>
<p>no problem. as is, its using <code>lazy</code> in one place, the main <code>valueP</code> parser</p>



<a name="303879628"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/json%20parser/near/303879628" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/json.20parser.html#303879628">(Oct 13 2022 at 16:45)</a>:</h4>
<p>oh yeah i forgot i also removed all the type annotations trying to repro.  i think there is a different error if they are added back.</p>



<hr><p>Last updated: Nov 01 2025 at 12:13 UTC</p>
</html>