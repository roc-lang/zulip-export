<html>
<head><meta charset="utf-8"><title>compiling for wasi · beginners · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/index.html">beginners</a></h2>
<h3>Topic: <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/compiling.20for.20wasi.html">compiling for wasi</a></h3>

<hr>

<base href="https://roc.zulipchat.com">

<head><link href="https://roc-lang.github.io/zulip-export/style.css" rel="stylesheet"></head>

<a name="405155641"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/compiling%20for%20wasi/near/405155641" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthew Phillips <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/compiling.20for.20wasi.html#405155641">(Nov 30 2023 at 16:37)</a>:</h4>
<p>How do you build a hello world to compile to wasi?</p>



<a name="405155906"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/compiling%20for%20wasi/near/405155906" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthew Phillips <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/compiling.20for.20wasi.html#405155906">(Nov 30 2023 at 16:38)</a>:</h4>
<p>I've compiled the wasm example but that requires a JS host.</p>



<a name="405159892"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/compiling%20for%20wasi/near/405159892" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Notification Bot <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/compiling.20for.20wasi.html#405159892">(Nov 30 2023 at 16:57)</a>:</h4>
<p>2 messages were moved here from <a class="stream-topic" data-stream-id="231634" href="/#narrow/stream/231634-beginners/topic/syntax.3A.20whitespace.20vs.20comma.20for.20items">#beginners &gt; syntax: whitespace vs comma for items</a> by <span class="user-mention silent" data-user-id="343810">Brendan Hansknecht</span>.</p>



<a name="405160455"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/compiling%20for%20wasi/near/405160455" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/compiling.20for.20wasi.html#405160455">(Nov 30 2023 at 17:00)</a>:</h4>
<p>To my understanding, wasi would use something like a zig host that contains a main with a roc platform. I think we support it, but I have not messed with that pipeline in a long time.</p>
<p>In the worst case, you can just compile the roc code with <code>--no-link</code> and targeting wasm. Then have a platform built for wasi link against that.</p>



<a name="405161464"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/compiling%20for%20wasi/near/405161464" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/compiling.20for.20wasi.html#405161464">(Nov 30 2023 at 17:04)</a>:</h4>
<p>As a clarifying note, all roc code is totally agnostic of that information. Whether it is for the browser or wasi roc will generate the exact same thing. It is up to some sort of host to deal with mapping browser/wasi primitives to roc io primitives.</p>



<a name="405161468"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/compiling%20for%20wasi/near/405161468" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Oskar Hahn <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/compiling.20for.20wasi.html#405161468">(Nov 30 2023 at 17:04)</a>:</h4>
<p>I have played around with wasi some time ago. I did not go far, but the hello world example worked.</p>
<p>I pushed the code here: <a href="https://github.com/ostcar/roc-wasi-platform">https://github.com/ostcar/roc-wasi-platform</a></p>
<p>It is its own platform, written in zig. Currently, it only knows the Task <code>writeLine</code>. My goal was to support <a href="https://github.com/ziglang/zig/blob/master/lib/std/os/wasi.zig">all wasi functions</a>. But I lost the motivation :)</p>



<a name="405161588"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/compiling%20for%20wasi/near/405161588" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthew Phillips <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/compiling.20for.20wasi.html#405161588">(Nov 30 2023 at 17:05)</a>:</h4>
<p>ah ok, this is my confusion then</p>



<a name="405161625"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/compiling%20for%20wasi/near/405161625" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthew Phillips <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/compiling.20for.20wasi.html#405161625">(Nov 30 2023 at 17:05)</a>:</h4>
<p>wasi requires a bunch of bindings. I wasn't sure if that was built-in to Roc or not</p>



<a name="405161685"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/compiling%20for%20wasi/near/405161685" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthew Phillips <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/compiling.20for.20wasi.html#405161685">(Nov 30 2023 at 17:05)</a>:</h4>
<p>So it sounds like someone needs to build that via a runtime. And Oskar has started that. Very cool</p>



<a name="405161827"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/compiling%20for%20wasi/near/405161827" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/compiling.20for.20wasi.html#405161827">(Nov 30 2023 at 17:06)</a>:</h4>
<p>Yeah, Roc has no io primitives and depends on a platform for them. More context here: <a href="http://roc-lang.org/platforms">roc-lang.org/platforms</a></p>



<a name="405162387"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/compiling%20for%20wasi/near/405162387" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthew Phillips <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/compiling.20for.20wasi.html#405162387">(Nov 30 2023 at 17:08)</a>:</h4>
<p><span class="user-mention" data-user-id="496321">@Oskar Hahn</span> doesn't wasi expect a "wasi_snapshot_preview1" imported value from the host? I don't see that in your host.zig</p>



<a name="405162409"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/compiling%20for%20wasi/near/405162409" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Oskar Hahn <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/compiling.20for.20wasi.html#405162409">(Nov 30 2023 at 17:08)</a>:</h4>
<p>It is very easy to build this in zig. Zig has build an abstraction layer around wasi, so you can use the normal zig functions. </p>
<p>For example, the <code>writeLine</code> Task is just:</p>
<div class="codehilite" data-code-language="Zig"><pre><span></span><code><span class="kr">export</span><span class="w"> </span><span class="k">fn</span><span class="w"> </span><span class="n">roc_fx_stdoutLine</span><span class="p">(</span><span class="n">str</span><span class="o">:</span><span class="w"> </span><span class="o">*</span><span class="n">RocStr</span><span class="p">)</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kr">const</span><span class="w"> </span><span class="n">stdout</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">io</span><span class="p">.</span><span class="n">getStdOut</span><span class="p">().</span><span class="n">writer</span><span class="p">();</span>
<span class="w">    </span><span class="n">stdout</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">"{s}</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span><span class="w"> </span><span class="p">.{</span><span class="n">str</span><span class="p">.</span><span class="o">*</span><span class="p">.</span><span class="n">asSlice</span><span class="p">()})</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="k">unreachable</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<p>There is nothing wasi specific about it.</p>



<a name="405162627"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/compiling%20for%20wasi/near/405162627" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/compiling.20for.20wasi.html#405162627">(Nov 30 2023 at 17:10)</a>:</h4>
<p>I wonder if we could just compile the rust basic cli for wasi?</p>



<a name="405162633"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/compiling%20for%20wasi/near/405162633" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthew Phillips <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/compiling.20for.20wasi.html#405162633">(Nov 30 2023 at 17:10)</a>:</h4>
<p>ok, so I'm trying to understand how things are linked here.</p>



<a name="405162746"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/compiling%20for%20wasi/near/405162746" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthew Phillips <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/compiling.20for.20wasi.html#405162746">(Nov 30 2023 at 17:10)</a>:</h4>
<p>Doesn't wasi have some sort of concept for logging? And if so, how does <code>roc_fx_stdoutLine</code> get linked to that?</p>



<a name="405162829"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/compiling%20for%20wasi/near/405162829" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthew Phillips <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/compiling.20for.20wasi.html#405162829">(Nov 30 2023 at 17:11)</a>:</h4>
<p>I was expecting to see some sort of mapping from "wasi method" to the implementation method roc_fx_stdoutLine but i don't see any such thing.</p>



<a name="405163087"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/compiling%20for%20wasi/near/405163087" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthew Phillips <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/compiling.20for.20wasi.html#405163087">(Nov 30 2023 at 17:13)</a>:</h4>
<p>I will of course pull down your project and try it out :)</p>



<a name="405164219"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/compiling%20for%20wasi/near/405164219" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthew Phillips <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/compiling.20for.20wasi.html#405164219">(Nov 30 2023 at 17:20)</a>:</h4>
<p>It does indeed work! I'm going to play around with this some more.</p>



<a name="405170812"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/compiling%20for%20wasi/near/405170812" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/compiling.20for.20wasi.html#405170812">(Nov 30 2023 at 18:00)</a>:</h4>
<p><span class="user-mention" data-user-id="431893">@Brian Carroll</span> might have some more info on this!</p>



<a name="405171856"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/compiling%20for%20wasi/near/405171856" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Carroll <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/compiling.20for.20wasi.html#405171856">(Nov 30 2023 at 18:04)</a>:</h4>
<p>Well in terms of what to do, Oskar has covered it.<br>
I think there's a misunderstanding about how the various layers fit together.<br>
<span class="user-mention" data-user-id="668654">@Matthew Phillips</span> you actually wouldn't see names of WASI methods at the source code level unless you looked inside libc implementation code or something.</p>



<a name="405172341"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/compiling%20for%20wasi/near/405172341" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Carroll <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/compiling.20for.20wasi.html#405172341">(Nov 30 2023 at 18:07)</a>:</h4>
<p>So in the Zig code above, <code>stdout.print</code> will compile to different things on different targets.<br>
If you compile for Windows then there will be some Windows API call in there.<br>
If you compile for a Unix system there will be syscalls like <code>write</code> or something.<br>
And if you compile that same Zig code for WASI then it will compile to WASI's version of <code>write</code>. I can't remember what it's called.</p>



<a name="405172878"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/compiling%20for%20wasi/near/405172878" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Carroll <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/compiling.20for.20wasi.html#405172878">(Nov 30 2023 at 18:10)</a>:</h4>
<p>Roc has no concept of Windows syscalls or Linux syscalls or WASI syscalls.</p>



<a name="405172916"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/compiling%20for%20wasi/near/405172916" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Carroll <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/compiling.20for.20wasi.html#405172916">(Nov 30 2023 at 18:11)</a>:</h4>
<p>Those things are dealt with by the compiler of the host language.</p>



<a name="405173914"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/compiling%20for%20wasi/near/405173914" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Carroll <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/compiling.20for.20wasi.html#405173914">(Nov 30 2023 at 18:17)</a>:</h4>
<p>Also WASI does not directly have a concept of "logging" really. It's a POSIX-like system interface, so it has a concept of stdout, and it has a concept of writing to files, and you can use those for logging if you want.</p>



<a name="405174310"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/compiling%20for%20wasi/near/405174310" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthew Phillips <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/compiling.20for.20wasi.html#405174310">(Nov 30 2023 at 18:20)</a>:</h4>
<p>Ah ok, so in this case there's no connection because WASI doesn't have a concept of logging</p>



<a name="405174389"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/compiling%20for%20wasi/near/405174389" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthew Phillips <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/compiling.20for.20wasi.html#405174389">(Nov 30 2023 at 18:20)</a>:</h4>
<p>But it does have one of filesystem access presumably</p>



<a name="405174485"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/compiling%20for%20wasi/near/405174485" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthew Phillips <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/compiling.20for.20wasi.html#405174485">(Nov 30 2023 at 18:21)</a>:</h4>
<p>So <em>somehow</em> there needs to a connection between the platform's "readFile" method and the WASI "readFile" method</p>



<a name="405174520"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/compiling%20for%20wasi/near/405174520" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthew Phillips <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/compiling.20for.20wasi.html#405174520">(Nov 30 2023 at 18:21)</a>:</h4>
<p>The platform being the roc platform, i mean</p>



<a name="405174644"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/compiling%20for%20wasi/near/405174644" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthew Phillips <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/compiling.20for.20wasi.html#405174644">(Nov 30 2023 at 18:22)</a>:</h4>
<p>Or wait</p>



<a name="405174658"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/compiling%20for%20wasi/near/405174658" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Carroll <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/compiling.20for.20wasi.html#405174658">(Nov 30 2023 at 18:22)</a>:</h4>
<p><span class="user-mention silent" data-user-id="668654">Matthew Phillips</span> <a href="#narrow/stream/231634-beginners/topic/compiling.20for.20wasi/near/405174389">said</a>:</p>
<blockquote>
<p>But it does have one of filesystem access presumably</p>
</blockquote>
<p>Yes it has the same concepts as Unix or Linux has. It's an interface layer to the OS. It has the same concepts as any OS.</p>



<a name="405174698"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/compiling%20for%20wasi/near/405174698" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthew Phillips <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/compiling.20for.20wasi.html#405174698">(Nov 30 2023 at 18:22)</a>:</h4>
<p>OK, maybe I get it now</p>



<a name="405174781"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/compiling%20for%20wasi/near/405174781" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthew Phillips <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/compiling.20for.20wasi.html#405174781">(Nov 30 2023 at 18:23)</a>:</h4>
<p>So, in the host.zig you would call zig's "readFile" method, and <em>that</em> thing, under the hood, connects to WASI's readFile method</p>



<a name="405174806"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/compiling%20for%20wasi/near/405174806" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Carroll <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/compiling.20for.20wasi.html#405174806">(Nov 30 2023 at 18:23)</a>:</h4>
<p>yep</p>



<a name="405175106"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/compiling%20for%20wasi/near/405175106" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthew Phillips <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/compiling.20for.20wasi.html#405175106">(Nov 30 2023 at 18:25)</a>:</h4>
<p>Ok, then as far as the connection between the Roc code and the <code>host.zig</code>, I see <code>roc_fx_stdoutLine</code> as a Zig method. I assume that this is some sort of method naming convention that causes the connection?</p>



<a name="405175143"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/compiling%20for%20wasi/near/405175143" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Carroll <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/compiling.20for.20wasi.html#405175143">(Nov 30 2023 at 18:25)</a>:</h4>
<p>yes, the <code>roc_fx_</code> prefix</p>



<a name="405175181"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/compiling%20for%20wasi/near/405175181" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthew Phillips <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/compiling.20for.20wasi.html#405175181">(Nov 30 2023 at 18:25)</a>:</h4>
<p><code>roc_</code> probably always in front, then <code>fx_</code> because that's the exported module in the <code>main.roc</code></p>



<a name="405175243"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/compiling%20for%20wasi/near/405175243" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Carroll <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/compiling.20for.20wasi.html#405175243">(Nov 30 2023 at 18:26)</a>:</h4>
<p>fx is short for "effects"</p>



<a name="405175336"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/compiling%20for%20wasi/near/405175336" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthew Phillips <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/compiling.20for.20wasi.html#405175336">(Nov 30 2023 at 18:26)</a>:</h4>
<p>Oh, so <code>roc_fx_</code> is always the name? It's not because this module happens to export something "as Fx"?</p>



<a name="405175378"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/compiling%20for%20wasi/near/405175378" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthew Phillips <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/compiling.20for.20wasi.html#405175378">(Nov 30 2023 at 18:27)</a>:</h4>
<p>If I changed that to <code>as Something</code> then it doesn't because <code>roc_something_</code></p>



<a name="405175425"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/compiling%20for%20wasi/near/405175425" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthew Phillips <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/compiling.20for.20wasi.html#405175425">(Nov 30 2023 at 18:27)</a>:</h4>
<p>It expects to be an Effects</p>



<a name="405175461"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/compiling%20for%20wasi/near/405175461" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Carroll <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/compiling.20for.20wasi.html#405175461">(Nov 30 2023 at 18:27)</a>:</h4>
<p>Oh wow OK if we're digging in this deep I'd have to look it up, I dunno</p>



<a name="405175497"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/compiling%20for%20wasi/near/405175497" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthew Phillips <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/compiling.20for.20wasi.html#405175497">(Nov 30 2023 at 18:27)</a>:</h4>
<p>Not important :)</p>



<a name="405175533"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/compiling%20for%20wasi/near/405175533" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthew Phillips <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/compiling.20for.20wasi.html#405175533">(Nov 30 2023 at 18:27)</a>:</h4>
<p>I know enough to know what to do to add a new method, so this has been a lot of help, thanks!</p>



<a name="405176815"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/compiling%20for%20wasi/near/405176815" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/compiling.20for.20wasi.html#405176815">(Nov 30 2023 at 18:35)</a>:</h4>
<p>Name comes from here: <a href="https://github.com/ostcar/roc-wasi-platform/blob/1796542883803f9a573e1b29f89d0348e1e4d617/src/Effect.roc#L14">https://github.com/ostcar/roc-wasi-platform/blob/1796542883803f9a573e1b29f89d0348e1e4d617/src/Effect.roc#L14</a></p>



<a name="405176862"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/compiling%20for%20wasi/near/405176862" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/compiling.20for.20wasi.html#405176862">(Nov 30 2023 at 18:35)</a>:</h4>
<p>Always prefixed with <code>roc_fx_</code></p>



<a name="405177060"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/compiling%20for%20wasi/near/405177060" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/compiling.20for.20wasi.html#405177060">(Nov 30 2023 at 18:37)</a>:</h4>
<p><code>as Fx</code> from: <a href="https://github.com/ostcar/roc-wasi-platform/blob/1796542883803f9a573e1b29f89d0348e1e4d617/src/main.roc#L10">https://github.com/ostcar/roc-wasi-platform/blob/1796542883803f9a573e1b29f89d0348e1e4d617/src/main.roc#L10</a><br>
is used for other generation.</p>



<a name="405178599"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/compiling%20for%20wasi/near/405178599" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthew Phillips <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/compiling.20for.20wasi.html#405178599">(Nov 30 2023 at 18:46)</a>:</h4>
<p>So you mean, the <code>roc_fx_</code> prefix is defined somewhere in the Roc compiler and not in the platform's code, right?</p>



<a name="405179316"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/compiling%20for%20wasi/near/405179316" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthew Phillips <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/compiling.20for.20wasi.html#405179316">(Nov 30 2023 at 18:50)</a>:</h4>
<p>Not important that I understand this part just yet :) I'm unblocked to experiment.</p>



<a name="405179451"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/compiling%20for%20wasi/near/405179451" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/compiling.20for.20wasi.html#405179451">(Nov 30 2023 at 18:51)</a>:</h4>
<blockquote>
<p>the <code>roc_fx_</code> prefix is defined somewhere in the Roc compiler and not in the platform's code, right?</p>
</blockquote>
<p>yep</p>



<a name="405191383"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/compiling%20for%20wasi/near/405191383" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/compiling.20for.20wasi.html#405191383">(Nov 30 2023 at 20:00)</a>:</h4>
<p>Oh neat <span class="user-mention" data-user-id="496321">@Oskar Hahn</span>, I was thinking about starting one of these. </p>
<p>It would be awesome to write up a zig glue spec which would make zig platforms so much quicker to write.</p>
<p>Definitely an after AoC project I'm keen to look at.</p>



<a name="405191983"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/compiling%20for%20wasi/near/405191983" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthew Phillips <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/compiling.20for.20wasi.html#405191983">(Nov 30 2023 at 20:02)</a>:</h4>
<p>AoC?</p>



<a name="405192187"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/compiling%20for%20wasi/near/405192187" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/compiling.20for.20wasi.html#405192187">(Nov 30 2023 at 20:03)</a>:</h4>
<p>Advent of Code</p>



<a name="405192879"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/compiling%20for%20wasi/near/405192879" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/compiling.20for.20wasi.html#405192879">(Nov 30 2023 at 20:07)</a>:</h4>
<blockquote>
<p>to write up a zig glue spec</p>
</blockquote>
<p>I have been debating doing this for a long time. I think zig would be the easiest language to build a nice spec for. <code>comptime</code> will make a lot of it super easy. <code>c++</code> would also be pretty easy, but probably messier than zig due to more complex templates and some other struggles. <code>c</code> you have to use macros and repeated imports or way more code gen to get all of the types and it is much more painful.</p>



<a name="405193022"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/compiling%20for%20wasi/near/405193022" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthew Phillips <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/compiling.20for.20wasi.html#405193022">(Nov 30 2023 at 20:08)</a>:</h4>
<p>This would be really amazing :)</p>



<a name="405193029"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/compiling%20for%20wasi/near/405193029" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/compiling.20for.20wasi.html#405193029">(Nov 30 2023 at 20:08)</a>:</h4>
<blockquote>
<p>I have been debating doing this for a long time.</p>
</blockquote>
<p>That said, my list of things to look at or work on is quite large rn.</p>



<a name="405193113"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/compiling%20for%20wasi/near/405193113" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthew Phillips <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/compiling.20for.20wasi.html#405193113">(Nov 30 2023 at 20:09)</a>:</h4>
<p>If I understand, it would be a single implementation of the IO methods that you could then use in any platform, right?</p>



<a name="405193168"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/compiling%20for%20wasi/near/405193168" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/compiling.20for.20wasi.html#405193168">(Nov 30 2023 at 20:09)</a>:</h4>
<p>the zig glue spec?</p>



<a name="405194837"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/compiling%20for%20wasi/near/405194837" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthew Phillips <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/compiling.20for.20wasi.html#405194837">(Nov 30 2023 at 20:19)</a>:</h4>
<p>Yeah</p>



<a name="405194958"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/compiling%20for%20wasi/near/405194958" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthew Phillips <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/compiling.20for.20wasi.html#405194958">(Nov 30 2023 at 20:20)</a>:</h4>
<p>Like, it would be nice if there was a library that implemented readFile, other IO methods, and then you could use that library in a platform that compiles to WASI, and in a platform that compiles to native, etc.</p>



<a name="405195010"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/compiling%20for%20wasi/near/405195010" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthew Phillips <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/compiling.20for.20wasi.html#405195010">(Nov 30 2023 at 20:21)</a>:</h4>
<p>So that the platforms don't all have to implement those themselves.</p>



<a name="405195756"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/compiling%20for%20wasi/near/405195756" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/compiling.20for.20wasi.html#405195756">(Nov 30 2023 at 20:26)</a>:</h4>
<p>So zig glue spec is different. It is about automatically generating zig code that interacts with roc. That way you don't need to know roc internal details to write a zig platform. Instead, that will all be automatically generated. For example, all the code here was auto generated by the rust glue: <a href="https://github.com/roc-lang/basic-webserver/tree/main/platform/src/glue">https://github.com/roc-lang/basic-webserver/tree/main/platform/src/glue</a></p>



<a name="405195846"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/compiling%20for%20wasi/near/405195846" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/compiling.20for.20wasi.html#405195846">(Nov 30 2023 at 20:26)</a>:</h4>
<p>That said, someone could totally make a zig library for implementing a number of common primitives that would then be shared between many platforms (like readFile).</p>



<a name="405196063"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/compiling%20for%20wasi/near/405196063" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/compiling.20for.20wasi.html#405196063">(Nov 30 2023 at 20:28)</a>:</h4>
<p>That said, it would be up to each platform as to whether or not they support a readFile primitive. It may make sense for a cli platform to have read file, but it probably doesn't make sense for frontend webpage platform.</p>



<a name="405196200"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/compiling%20for%20wasi/near/405196200" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/compiling.20for.20wasi.html#405196200">(Nov 30 2023 at 20:29)</a>:</h4>
<p><span class="user-mention" data-user-id="668654">@Matthew Phillips</span> you're going to love the Module Params design. I just added a link on <a href="https://github.com/lukewilliamboswell/roc-awesome">https://github.com/lukewilliamboswell/roc-awesome</a> It's a longer read, and I think Agus has just started on parts of it. But yeah, platform independent libraries will be great!</p>



<a name="405196806"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/compiling%20for%20wasi/near/405196806" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthew Phillips <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/compiling.20for.20wasi.html#405196806">(Nov 30 2023 at 20:33)</a>:</h4>
<p><span class="user-mention silent" data-user-id="343810">Brendan Hansknecht</span> <a href="#narrow/stream/231634-beginners/topic/compiling.20for.20wasi/near/405196063">said</a>:</p>
<blockquote>
<p>That said, it would be up to each platform as to whether or not they support a readFile primitive. It may make sense for a cli platform to have read file, but it probably doesn't make sense for frontend webpage platform.</p>
</blockquote>
<p>yep, agree!</p>



<a name="405198525"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/compiling%20for%20wasi/near/405198525" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthew Phillips <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/compiling.20for.20wasi.html#405198525">(Nov 30 2023 at 20:45)</a>:</h4>
<p><span class="user-mention silent" data-user-id="515757">Luke Boswell</span> <a href="#narrow/stream/231634-beginners/topic/compiling.20for.20wasi/near/405196200">said</a>:</p>
<blockquote>
<p><span class="user-mention silent" data-user-id="668654">Matthew Phillips</span> you're going to love the Module Params design. I just added a link on <a href="https://github.com/lukewilliamboswell/roc-awesome">https://github.com/lukewilliamboswell/roc-awesome</a> It's a longer read, and I think Agus has just started on parts of it. But yeah, platform independent libraries will be great!</p>
</blockquote>
<p>I don't know Roc well enough yet to fully get it, but in general this makes me very happy :) Going to pour over the proposal some more</p>



<a name="405208076"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/compiling%20for%20wasi/near/405208076" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/compiling.20for.20wasi.html#405208076">(Nov 30 2023 at 21:27)</a>:</h4>
<p>I think for platforms, they will just expose low level primitive IO like TCP/IP or Streams etc and then the package/library ecosystem takes thing from there. With all modules being platform independent by design, this makes it really easy to share things across platforms that have similar functionality. E.g. any platform that has TCP/IP can use Agu's roc-pg to work with PostgreSQL servers etc</p>



<hr><p>Last updated: Nov 01 2025 at 12:13 UTC</p>
</html>