<html>
<head><meta charset="utf-8"><title>Possible bug uncovered while trying to calculate nth root · beginners · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/index.html">beginners</a></h2>
<h3>Topic: <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Possible.20bug.20uncovered.20while.20trying.20to.20calculate.20nth.20root.html">Possible bug uncovered while trying to calculate nth root</a></h3>

<hr>

<base href="https://roc.zulipchat.com">

<head><link href="https://roc-lang.github.io/zulip-export/style.css" rel="stylesheet"></head>

<a name="428405144"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Possible%20bug%20uncovered%20while%20trying%20to%20calculate%20nth%20root/near/428405144" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Hristo <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Possible.20bug.20uncovered.20while.20trying.20to.20calculate.20nth.20root.html#428405144">(Mar 22 2024 at 20:30)</a>:</h4>
<p>This isn't a serious blocker. I'm just writing to report that I've run into it and to flag it as a possible bug. If confirmed as a bug by the maintainers' team, I'd be happy to file a GitHub issue, if that'd be the preferred course of action,</p>
<p>Roc online <a href="https://www.roc-lang.org/repl">REPL</a>:</p>
<div class="codehilite" data-code-language="Elm"><pre><span></span><code><span class="err">»</span><span class="w"> </span><span class="nv">f</span><span class="w"> </span><span class="nf">=</span><span class="w"> </span><span class="nf">\</span><span class="nv">n</span><span class="p">,</span><span class="w"> </span><span class="nv">p</span><span class="w"> </span><span class="nf">-&gt;</span><span class="w"> </span><span class="kt">Num</span><span class="nf">.</span><span class="nv">pow</span><span class="w"> </span><span class="kt">Num</span><span class="nf">.</span><span class="nv">e</span><span class="w"> </span><span class="p">(</span><span class="kt">Num</span><span class="nf">.</span><span class="nv">div</span><span class="w"> </span><span class="p">(</span><span class="kt">Num</span><span class="nf">.</span><span class="nv">log</span><span class="w"> </span><span class="nv">n</span><span class="p">)</span><span class="w"> </span><span class="nv">p</span><span class="p">)</span>
<span class="nv">panicked</span><span class="w"> </span><span class="nv">at</span><span class="w"> </span><span class="nf">'</span><span class="kt">Invalid</span><span class="w"> </span><span class="nv">return</span><span class="w"> </span><span class="nv">layout</span><span class="w"> </span><span class="nv">for</span><span class="w"> </span><span class="kt">NumLogUnchecked</span><span class="nf">:</span><span class="w"> </span><span class="kt">InLayout</span><span class="p">(</span><span class="kt">DEC</span><span class="p">)</span><span class="nf">'</span><span class="p">,</span><span class="w"> </span><span class="nv">crates</span><span class="nf">/</span><span class="nv">compiler</span><span class="nf">/</span><span class="nv">gen_wasm</span><span class="nf">/</span><span class="nv">src</span><span class="nf">/</span><span class="nv">low_level</span><span class="nf">.</span><span class="nv">rs</span><span class="nf">:</span><span class="mi">178</span><span class="nf">:</span><span class="mi">13</span>
</code></pre></div>
<div class="codehilite" data-code-language="Elm"><pre><span></span><code><span class="err">»</span><span class="w"> </span><span class="nv">f</span><span class="w"> </span><span class="nf">=</span><span class="w"> </span><span class="nf">\</span><span class="nv">n</span><span class="p">,</span><span class="w"> </span><span class="nv">p</span><span class="w"> </span><span class="nf">-&gt;</span><span class="w"> </span><span class="kt">Num</span><span class="nf">.</span><span class="nv">pow</span><span class="w"> </span><span class="kt">Num</span><span class="nf">.</span><span class="nv">e</span><span class="w"> </span><span class="p">(</span><span class="kt">Num</span><span class="nf">.</span><span class="nv">div</span><span class="w"> </span><span class="p">(</span><span class="kt">Num</span><span class="nf">.</span><span class="nv">logChecked</span><span class="w"> </span><span class="nv">n</span><span class="w"> </span><span class="nf">|&gt;</span><span class="w"> </span><span class="kt">Result</span><span class="nf">.</span><span class="nv">withDefault</span><span class="w"> </span><span class="mf">0.</span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="nv">p</span><span class="p">)</span>
<span class="nv">panicked</span><span class="w"> </span><span class="nv">at</span><span class="w"> </span><span class="nf">'</span><span class="kt">Invalid</span><span class="w"> </span><span class="nv">return</span><span class="w"> </span><span class="nv">layout</span><span class="w"> </span><span class="nv">for</span><span class="w"> </span><span class="kt">NumLogUnchecked</span><span class="nf">:</span><span class="w"> </span><span class="kt">InLayout</span><span class="p">(</span><span class="kt">DEC</span><span class="p">)</span><span class="nf">'</span><span class="p">,</span><span class="w"> </span><span class="nv">crates</span><span class="nf">/</span><span class="nv">compiler</span><span class="nf">/</span><span class="nv">gen_wasm</span><span class="nf">/</span><span class="nv">src</span><span class="nf">/</span><span class="nv">low_level</span><span class="nf">.</span><span class="nv">rs</span><span class="nf">:</span><span class="mi">178</span><span class="nf">:</span><span class="mi">13</span>
</code></pre></div>
<p>Locally (not in REPL, but via <code>roc test</code>):</p>
<div class="codehilite" data-code-language="Bash"><pre><span></span><code>thread<span class="w"> </span><span class="s1">'main'</span><span class="w"> </span>panicked<span class="w"> </span>at<span class="w"> </span><span class="s1">'internal error: entered unreachable code: Unrecognized dec unary operation: NumLogUnchecked'</span>,<span class="w"> </span>crates/compiler/gen_llvm/src/llvm/lowlevel.rs:2209:13
</code></pre></div>
<p>Thanks!</p>



<a name="428407516"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Possible%20bug%20uncovered%20while%20trying%20to%20calculate%20nth%20root/near/428407516" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Possible.20bug.20uncovered.20while.20trying.20to.20calculate.20nth.20root.html#428407516">(Mar 22 2024 at 20:49)</a>:</h4>
<p>Ah, we are missing some wiring in the wasm backend to newer builtins. Yeah, definitely a bug</p>



<a name="428409171"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Possible%20bug%20uncovered%20while%20trying%20to%20calculate%20nth%20root/near/428409171" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Hristo <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Possible.20bug.20uncovered.20while.20trying.20to.20calculate.20nth.20root.html#428409171">(Mar 22 2024 at 21:03)</a>:</h4>
<p>Hi <span class="user-mention" data-user-id="343810">@Brendan Hansknecht</span>, thanks for looking into this!</p>
<p>Given that this is also reproducible locally, in a non-REPL context, wouldn't it be considered a more general than just WASM? I've run into a similar bug when attempting other <code>Num.log</code>-based calculations.</p>
<p>This time around I've accompanied my reproducible example with output from the online REPL, because in my previous reports (unrelated to this thread), I wasn't really sure how much was due to my local environment.</p>



<a name="428412615"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Possible%20bug%20uncovered%20while%20trying%20to%20calculate%20nth%20root/near/428412615" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Possible.20bug.20uncovered.20while.20trying.20to.20calculate.20nth.20root.html#428412615">(Mar 22 2024 at 21:33)</a>:</h4>
<p>Ah yeah error is hit in llvm backend too. Yeah probably all backend would hit it.</p>



<a name="428412685"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Possible%20bug%20uncovered%20while%20trying%20to%20calculate%20nth%20root/near/428412685" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Possible.20bug.20uncovered.20while.20trying.20to.20calculate.20nth.20root.html#428412685">(Mar 22 2024 at 21:34)</a>:</h4>
<p>I guess that means we have it wired up for floats but not dec</p>



<a name="428415489"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Possible%20bug%20uncovered%20while%20trying%20to%20calculate%20nth%20root/near/428415489" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Hristo <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Possible.20bug.20uncovered.20while.20trying.20to.20calculate.20nth.20root.html#428415489">(Mar 22 2024 at 22:00)</a>:</h4>
<blockquote>
<p>I guess that means we have it wired up for floats but not dec</p>
</blockquote>
<p>Yes, the error messages suggest something like that might've happened indeed <span aria-label="thumbs up" class="emoji emoji-1f44d" role="img" title="thumbs up">:thumbs_up:</span></p>



<hr><p>Last updated: Nov 01 2025 at 12:13 UTC</p>
</html>