<html>
<head><meta charset="utf-8"><title>Am I doing something silly? · beginners · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/index.html">beginners</a></h2>
<h3>Topic: <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Am.20I.20doing.20something.20silly.3F.html">Am I doing something silly?</a></h3>

<hr>

<base href="https://roc.zulipchat.com">

<head><link href="https://roc-lang.github.io/zulip-export/style.css" rel="stylesheet"></head>

<a name="267153164"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Am%20I%20doing%20something%20silly%3F/near/267153164" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jan kili <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Am.20I.20doing.20something.20silly.3F.html#267153164">(Jan 07 2022 at 05:31)</a>:</h4>
<p>Happy to make an issue for this, but I just want a sanity check - does this make sense to anyone?</p>



<a name="267153187"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Am%20I%20doing%20something%20silly%3F/near/267153187" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jan kili <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Am.20I.20doing.20something.20silly.3F.html#267153187">(Jan 07 2022 at 05:31)</a>:</h4>
<p>Module A:</p>
<div class="codehilite"><pre><span></span><code>main =
    _ &lt;- await (line &quot;&quot;)
    double = \x -&gt; x * 2
    doubleBind = \x -&gt; (\_ -&gt; double x)
    six = (doubleBind 3) {}
    line (Num.toStr six)
</code></pre></div>
<p>Output A:</p>
<div class="codehilite"><pre><span></span><code>6
</code></pre></div>



<a name="267153247"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Am%20I%20doing%20something%20silly%3F/near/267153247" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jan kili <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Am.20I.20doing.20something.20silly.3F.html#267153247">(Jan 07 2022 at 05:32)</a>:</h4>
<p>Module B:</p>
<div class="codehilite"><pre><span></span><code>main =
    _ &lt;- await (line &quot;&quot;)
    double = \x -&gt; x * 2
    doubleBind = \x -&gt; (\_ -&gt; double x)
    doubleThree = doubleBind 3
    six = doubleThree {}
    line (Num.toStr six)
</code></pre></div>
<p>Output B:</p>
<div class="codehilite"><pre><span></span><code>thread &#39;main&#39; panicked at &#39;internal error: entered unreachable code: symbol/layout `8.IdentId(8)` ProcLayout { arguments: [Struct([]), LambdaSet(LambdaSet { set: [(`8.IdentId(8)`, [Builtin(Int(I64))])], representation: Struct([Builtin(Int(I64))]) })], result: Builtin(Int(I64)) } combo must be in DeclarationToIndex&#39;, compiler/mono/src/borrow.rs:227:9
</code></pre></div>



<a name="267153286"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Am%20I%20doing%20something%20silly%3F/near/267153286" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jan kili <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Am.20I.20doing.20something.20silly.3F.html#267153286">(Jan 07 2022 at 05:33)</a>:</h4>
<p>Changed lines:</p>
<div class="codehilite"><pre><span></span><code>six = (doubleBind 3) {}
</code></pre></div>
<p>vs.</p>
<div class="codehilite"><pre><span></span><code>doubleThree = doubleBind 3
six = doubleThree {}
</code></pre></div>
<p>(I've removed <code>roc/examples/cli/platform</code> boilerplate for succinctness)</p>



<a name="267153363"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Am%20I%20doing%20something%20silly%3F/near/267153363" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jan kili <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Am.20I.20doing.20something.20silly.3F.html#267153363">(Jan 07 2022 at 05:34)</a>:</h4>
<p>Is there an obvious reason that defining <code>doubleThree</code> causes a panic? <code>roc check</code> is clean on both, btw.</p>



<a name="267156854"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Am%20I%20doing%20something%20silly%3F/near/267156854" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Carroll <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Am.20I.20doing.20something.20silly.3F.html#267156854">(Jan 07 2022 at 06:52)</a>:</h4>
<p>That looks like a compiler bug. The panic is in a file related to refcount insertion. That phase comes after type checking, so wouldn't show up in roc check.</p>



<a name="267156877"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Am%20I%20doing%20something%20silly%3F/near/267156877" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jan kili <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Am.20I.20doing.20something.20silly.3F.html#267156877">(Jan 07 2022 at 06:52)</a>:</h4>
<p>Thanks! I'll report it and temporarily modify my code to use an anonymous binding/closure :)</p>



<a name="267156896"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Am%20I%20doing%20something%20silly%3F/near/267156896" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Carroll <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Am.20I.20doing.20something.20silly.3F.html#267156896">(Jan 07 2022 at 06:53)</a>:</h4>
<p>Great!</p>



<a name="267156967"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Am%20I%20doing%20something%20silly%3F/near/267156967" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jan kili <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Am.20I.20doing.20something.20silly.3F.html#267156967">(Jan 07 2022 at 06:54)</a>:</h4>
<p>That's a relief - I was worried that I'd messed up some great-grandchild binding in my confusing code... but by the time I boiled it down to the minimal reproduction above I was half-sure that something fishy was going on.</p>



<a name="267157142"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Am%20I%20doing%20something%20silly%3F/near/267157142" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jan kili <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Am.20I.20doing.20something.20silly.3F.html#267157142">(Jan 07 2022 at 06:58)</a>:</h4>
<p><a href="https://github.com/rtfeldman/roc/issues/2322">https://github.com/rtfeldman/roc/issues/2322</a></p>



<a name="267388890"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Am%20I%20doing%20something%20silly%3F/near/267388890" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> David Rojas Camaggi <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Am.20I.20doing.20something.20silly.3F.html#267388890">(Jan 10 2022 at 01:52)</a>:</h4>
<p>HI all, I am trying to set up my m1 mac for development with nix (using rosetta. i.e. platform is still x86_64). I am getting the following error</p>
<p>CMake Error at /nix/store/gxqi9sjvvwmf86qx075alg376x32s0zc-llvm-7.1.0-dev/lib/cmake/llvm/TableGen.cmake:14 (message):<br>
  LLVM_TABLEGEN_EXE not set<br>
Call Stack (most recent call first):<br>
  include/clang/Driver/CMakeLists.txt:2 (tablegen)</p>
<p>Also tried with UTM and nix-shell also fails on aarch64 (different error), next week I will try another VM on x86 which would be slower but perhaps easier to set up.</p>
<p>I wonder if anyone has experience to share on M1 macs with nix (macos) or nixos.</p>



<a name="267392073"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Am%20I%20doing%20something%20silly%3F/near/267392073" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Am.20I.20doing.20something.20silly.3F.html#267392073">(Jan 10 2022 at 03:17)</a>:</h4>
<p>I use an m1 mac with nix. No rosetta</p>



<a name="267392076"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Am%20I%20doing%20something%20silly%3F/near/267392076" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Am.20I.20doing.20something.20silly.3F.html#267392076">(Jan 10 2022 at 03:17)</a>:</h4>
<p>Tends to just work</p>



<a name="267392084"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Am%20I%20doing%20something%20silly%3F/near/267392084" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Am.20I.20doing.20something.20silly.3F.html#267392084">(Jan 10 2022 at 03:17)</a>:</h4>
<p>Though has some limitations were we don't fully support arm. Not a problem for the main llvm backend.</p>



<a name="267393169"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Am%20I%20doing%20something%20silly%3F/near/267393169" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> David Rojas Camaggi <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Am.20I.20doing.20something.20silly.3F.html#267393169">(Jan 10 2022 at 03:47)</a>:</h4>
<p>something must be off on my setup, this is what I get with system = aarch64-darwin -&gt; "       &gt;...libredirect.dylib' (mach-o file, but is an incompatible architecture (have 'arm64', need 'arm64e'))"</p>



<a name="267394847"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Am%20I%20doing%20something%20silly%3F/near/267394847" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Am.20I.20doing.20something.20silly.3F.html#267394847">(Jan 10 2022 at 04:29)</a>:</h4>
<p>I have never seen that, when does it come up?</p>



<a name="267394858"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Am%20I%20doing%20something%20silly%3F/near/267394858" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Am.20I.20doing.20something.20silly.3F.html#267394858">(Jan 10 2022 at 04:29)</a>:</h4>
<p>Also, my setup may be leaky (i.e, I also have rust outside of nix and maybe zig), which may fix potential nix issues</p>



<a name="267397765"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Am%20I%20doing%20something%20silly%3F/near/267397765" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> David Rojas Camaggi <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Am.20I.20doing.20something.20silly.3F.html#267397765">(Jan 10 2022 at 05:38)</a>:</h4>
<p>found it was OpenAL (audio fw specific to macos), not sure why yet but commenting it out allows me to run a shell</p>



<a name="267397862"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Am%20I%20doing%20something%20silly%3F/near/267397862" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> David Rojas Camaggi <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Am.20I.20doing.20something.20silly.3F.html#267397862">(Jan 10 2022 at 05:41)</a>:</h4>
<p>doing that on x86 system, but that arm64 thing is from when I was trying aarch64-darwin</p>



<a name="267607941"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Am%20I%20doing%20something%20silly%3F/near/267607941" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lucas Rosa <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Am.20I.20doing.20something.20silly.3F.html#267607941">(Jan 11 2022 at 16:34)</a>:</h4>
<p>I use the M1 Max and no nix</p>



<a name="267830076"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Am%20I%20doing%20something%20silly%3F/near/267830076" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jan kili <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Am.20I.20doing.20something.20silly.3F.html#267830076">(Jan 13 2022 at 06:48)</a>:</h4>
<p>How can I write a function that accepts a tag argument that could be either an <code>A</code> tag or a <code>B</code> tag? I tried this, but it doesn't work:</p>
<div class="codehilite"><pre><span></span><code>» a : [ A Str ]
… a = A &quot;A&quot;
… f : [ A Str, B Str ] -&gt; Str
… f = \x -&gt;
…     when x is
…         A y -&gt; y
…         B y -&gt; y
… f a

── TYPE MISMATCH ───────────────────────────────────────────────────────────────

The 1st argument to f is not what I expect:

11│      f a
           ^

This a value is a:

    [ A Str ]

But f needs the 1st argument to be:

    [ A Str, B Str ]

Tip: Looks like a closed tag union does not have the B tag.

Tip: Closed tag unions can&#39;t grow, because that might change the size
in memory. Can you use an open tag union?
</code></pre></div>



<a name="267830566"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Am%20I%20doing%20something%20silly%3F/near/267830566" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Carroll <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Am.20I.20doing.20something.20silly.3F.html#267830566">(Jan 13 2022 at 06:56)</a>:</h4>
<p>Yeah I've run into this kind of thing as well. It's because of the language supporting open tag unions. So in theory <code>A Str</code> could be part of any other union besides this one. Longer term I imagine we'll be able to figure it out, I'm not sure. But we don't right now.<br>
I have found a type annotation works in this kind of situation. If you give a name to your union like <code>AorB : [A Str, B Str]</code> and then give <code>a</code> a type annotation like <code>a : AorB</code></p>



<a name="267830669"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Am%20I%20doing%20something%20silly%3F/near/267830669" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Carroll <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Am.20I.20doing.20something.20silly.3F.html#267830669">(Jan 13 2022 at 06:58)</a>:</h4>
<p>Or I suppose you could probably type it out again rather than naming it! But you'll probably want to name it anyway.</p>



<a name="267830715"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Am%20I%20doing%20something%20silly%3F/near/267830715" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jan kili <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Am.20I.20doing.20something.20silly.3F.html#267830715">(Jan 13 2022 at 06:59)</a>:</h4>
<p>Interesting, so now I notice that the inferred type for <code>a = A "A"</code> is <code>[ A Str ]*</code></p>



<a name="267830740"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Am%20I%20doing%20something%20silly%3F/near/267830740" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jan kili <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Am.20I.20doing.20something.20silly.3F.html#267830740">(Jan 13 2022 at 06:59)</a>:</h4>
<p>This is confusing to me, because how could <code>a</code> ever accumulate additional tags in its union? It will only ever be that <code>A</code> tag.</p>



<a name="267831340"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Am%20I%20doing%20something%20silly%3F/near/267831340" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Carroll <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Am.20I.20doing.20something.20silly.3F.html#267831340">(Jan 13 2022 at 07:09)</a>:</h4>
<p>Yeah I agree and I suspect that it's more of a bug than a feature. But I don't work on that part of the compiler so I'm not 100% sure!</p>



<a name="267831348"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Am%20I%20doing%20something%20silly%3F/near/267831348" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jan kili <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Am.20I.20doing.20something.20silly.3F.html#267831348">(Jan 13 2022 at 07:10)</a>:</h4>
<p>Is the real meaning more like "<code>a</code> can be used anywhere a tag union matches this pattern: <code>[ A Str ]*</code>"?</p>



<a name="267831498"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Am%20I%20doing%20something%20silly%3F/near/267831498" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jan kili <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Am.20I.20doing.20something.20silly.3F.html#267831498">(Jan 13 2022 at 07:12)</a>:</h4>
<p>I was initially interpreting its inferred type as saying "<code>a</code> is a tag could be <code>A Str</code> or something else"</p>



<a name="267831528"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Am%20I%20doing%20something%20silly%3F/near/267831528" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jan kili <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Am.20I.20doing.20something.20silly.3F.html#267831528">(Jan 13 2022 at 07:12)</a>:</h4>
<p>That's what I gathered from this part of the tutorial:</p>
<blockquote>
<p>If you have a closed union, that means it has all the tags it ever will, and can't accumulate more.<br>
If you have an open union, that means it can accumulate more tags through conditional branches.</p>
</blockquote>



<a name="267831540"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Am%20I%20doing%20something%20silly%3F/near/267831540" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Carroll <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Am.20I.20doing.20something.20silly.3F.html#267831540">(Jan 13 2022 at 07:12)</a>:</h4>
<p>Hold on, that's not the type of <code>a</code>! There's no <code>*</code></p>



<a name="267831550"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Am%20I%20doing%20something%20silly%3F/near/267831550" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Carroll <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Am.20I.20doing.20something.20silly.3F.html#267831550">(Jan 13 2022 at 07:13)</a>:</h4>
<p>In your example code</p>



<a name="267831567"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Am%20I%20doing%20something%20silly%3F/near/267831567" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jan kili <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Am.20I.20doing.20something.20silly.3F.html#267831567">(Jan 13 2022 at 07:13)</a>:</h4>
<p>True, but in the REPL if I drop my manual annotation, I get this:</p>
<div class="codehilite"><pre><span></span><code>  The rockin’ roc repl
────────────────────────

Enter an expression, or :help, or :exit/:q.

» a = A &quot;A&quot;
… a

A &quot;A&quot; : [ A Str ]*

»
</code></pre></div>



<a name="267831569"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Am%20I%20doing%20something%20silly%3F/near/267831569" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Carroll <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Am.20I.20doing.20something.20silly.3F.html#267831569">(Jan 13 2022 at 07:13)</a>:</h4>
<p>So it's a closed union that says <code>a</code> can only be <code>A Str</code> and never any other tag. So that's a different type.</p>



<a name="267831581"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Am%20I%20doing%20something%20silly%3F/near/267831581" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jan kili <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Am.20I.20doing.20something.20silly.3F.html#267831581">(Jan 13 2022 at 07:13)</a>:</h4>
<p>The "inferred" type</p>



<a name="267831584"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Am%20I%20doing%20something%20silly%3F/near/267831584" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Carroll <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Am.20I.20doing.20something.20silly.3F.html#267831584">(Jan 13 2022 at 07:13)</a>:</h4>
<p>yes but your two examples have different types for the same expression</p>



<a name="267831685"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Am%20I%20doing%20something%20silly%3F/near/267831685" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Carroll <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Am.20I.20doing.20something.20silly.3F.html#267831685">(Jan 13 2022 at 07:15)</a>:</h4>
<p>The inferred type will have a <code>*</code> but if you annotate it without one you are telling the compiler you explicitly do not want any other tag to be a valid part of the type of <code>a</code>.</p>



<a name="267831690"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Am%20I%20doing%20something%20silly%3F/near/267831690" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jan kili <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Am.20I.20doing.20something.20silly.3F.html#267831690">(Jan 13 2022 at 07:15)</a>:</h4>
<p>I see, so basically if a function can handle multiple tags, it's illegal to call it with an input that can't be all of those tags.</p>



<a name="267831810"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Am%20I%20doing%20something%20silly%3F/near/267831810" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jan kili <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Am.20I.20doing.20something.20silly.3F.html#267831810">(Jan 13 2022 at 07:17)</a>:</h4>
<p>i.e. if I have an HTTP response that is somehow guaranteed to be a <code>404</code>, I can't pass that to a function that processes both <code>200</code> and <code>404</code> responses?</p>



<a name="267831861"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Am%20I%20doing%20something%20silly%3F/near/267831861" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Carroll <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Am.20I.20doing.20something.20silly.3F.html#267831861">(Jan 13 2022 at 07:17)</a>:</h4>
<p>That very much depends on the types they have!</p>



<a name="267831910"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Am%20I%20doing%20something%20silly%3F/near/267831910" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Carroll <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Am.20I.20doing.20something.20silly.3F.html#267831910">(Jan 13 2022 at 07:18)</a>:</h4>
<p>There are lots of ways to represent HTTP responses in the type system</p>



<a name="267831955"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Am%20I%20doing%20something%20silly%3F/near/267831955" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Carroll <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Am.20I.20doing.20something.20silly.3F.html#267831955">(Jan 13 2022 at 07:19)</a>:</h4>
<p>Do you still get this error in the repl case with the inferred type?</p>



<a name="267831967"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Am%20I%20doing%20something%20silly%3F/near/267831967" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jan kili <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Am.20I.20doing.20something.20silly.3F.html#267831967">(Jan 13 2022 at 07:19)</a>:</h4>
<p>No, I actually get a panic <span aria-label="laughing" class="emoji emoji-1f606" role="img" title="laughing">:laughing:</span></p>



<a name="267832014"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Am%20I%20doing%20something%20silly%3F/near/267832014" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jan kili <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Am.20I.20doing.20something.20silly.3F.html#267832014">(Jan 13 2022 at 07:20)</a>:</h4>
<p>But that's probably irrelevant <a href="https://github.com/rtfeldman/roc/issues/2344">https://github.com/rtfeldman/roc/issues/2344</a></p>



<a name="267832021"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Am%20I%20doing%20something%20silly%3F/near/267832021" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Carroll <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Am.20I.20doing.20something.20silly.3F.html#267832021">(Jan 13 2022 at 07:20)</a>:</h4>
<p><span aria-label="laughing" class="emoji emoji-1f606" role="img" title="laughing">:laughing:</span></p>



<a name="267832039"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Am%20I%20doing%20something%20silly%3F/near/267832039" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jan kili <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Am.20I.20doing.20something.20silly.3F.html#267832039">(Jan 13 2022 at 07:20)</a>:</h4>
<p>Could you please give me an example of a situation where I would want to manually annotate a def as being a closed tag union instead of an open one?</p>



<a name="267832060"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Am%20I%20doing%20something%20silly%3F/near/267832060" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jan kili <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Am.20I.20doing.20something.20silly.3F.html#267832060">(Jan 13 2022 at 07:20)</a>:</h4>
<div class="codehilite"><pre><span></span><code>a : [ A Str ]
a = A &quot;A&quot;
</code></pre></div>
<p>vs.</p>
<div class="codehilite"><pre><span></span><code>a : [ A Str ]*
a = A &quot;A&quot;
</code></pre></div>



<a name="267832085"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Am%20I%20doing%20something%20silly%3F/near/267832085" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jan kili <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Am.20I.20doing.20something.20silly.3F.html#267832085">(Jan 13 2022 at 07:21)</a>:</h4>
<p>The bottom one seems objectively better, if the top one can't be passed to functions that accept other tags.</p>



<a name="267832166"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Am%20I%20doing%20something%20silly%3F/near/267832166" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jan kili <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Am.20I.20doing.20something.20silly.3F.html#267832166">(Jan 13 2022 at 07:22)</a>:</h4>
<p>I ask because I'm still confused what the distinction is. I get why functions would accept closed vs. open, but I don't get how a def can BE closed or open.</p>



<a name="267832178"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Am%20I%20doing%20something%20silly%3F/near/267832178" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Carroll <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Am.20I.20doing.20something.20silly.3F.html#267832178">(Jan 13 2022 at 07:22)</a>:</h4>
<p>I don't know, I didn't design this feature, I was just trying to help with your specific error but you probably want to talk to someone who was involved in designing it</p>



<a name="267832192"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Am%20I%20doing%20something%20silly%3F/near/267832192" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jan kili <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Am.20I.20doing.20something.20silly.3F.html#267832192">(Jan 13 2022 at 07:22)</a>:</h4>
<p>:) Makes sense, thanks!</p>



<a name="267832202"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Am%20I%20doing%20something%20silly%3F/near/267832202" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jan kili <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Am.20I.20doing.20something.20silly.3F.html#267832202">(Jan 13 2022 at 07:23)</a>:</h4>
<p>I'll open a new topic for this, since you helped me figure out the silly thing.</p>



<a name="268172162"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Am%20I%20doing%20something%20silly%3F/near/268172162" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jan kili <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Am.20I.20doing.20something.20silly.3F.html#268172162">(Jan 16 2022 at 08:17)</a>:</h4>
<p>I modified the example CLI platform to use Rust's <code>print</code> instead of <code>println</code>, and now I'm successfully writing a lot of Rust-based <code>print</code>s to <code>stdout</code> (with a <code>\r</code> between each, so that the line overwrites itself)! However, after ~47,000 consecutive (very fast) writes to stdout, I'm getting a <code>Segmentation fault: 11</code>. Since these writes are generated by recursive <code>_ &lt;- await ...</code> calls, is this an expected "stack overflow"-type problem with having too many callbacks? Is there a better way to do a lot of I/O tasks without causing such a segfault? My instinct is to replace the recursion with a <code>while</code> loop, but that doesn't exist in Roc.</p>



<a name="268172471"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Am%20I%20doing%20something%20silly%3F/near/268172471" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jan kili <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Am.20I.20doing.20something.20silly.3F.html#268172471">(Jan 16 2022 at 08:25)</a>:</h4>
<p>The only way I can think to get more writes out of this program would be to wrap the Roc <code>main</code> function in a Rust <code>while</code> loop at the platform level (and make the Roc <code>main</code> function responsible for only one write), but I don't know enough about platforms to know if that would somehow break the platform/application contract.</p>



<a name="268172671"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Am%20I%20doing%20something%20silly%3F/near/268172671" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jan kili <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Am.20I.20doing.20something.20silly.3F.html#268172671">(Jan 16 2022 at 08:31)</a>:</h4>
<p>The context for this I/O use case is that I'm experimenting with how one might use Roc to do ASCII animation for things like CLI loading spinners or simple CLI games (Snake? Space Invaders?) <span aria-label="smile" class="emoji emoji-1f642" role="img" title="smile">:smile:</span></p>



<a name="268179188"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Am%20I%20doing%20something%20silly%3F/near/268179188" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Carroll <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Am.20I.20doing.20something.20silly.3F.html#268179188">(Jan 16 2022 at 11:25)</a>:</h4>
<p>I can help with one piece of this: Getting the compiler to generate <code>while</code> loops.<br>
Any function that is tail-recursive will be automatically transformed into a <code>while</code> loop. If you're not familiar with that concept, here's an article that explains it: <a href="https://www.geeksforgeeks.org/tail-recursion/">https://www.geeksforgeeks.org/tail-recursion/</a>. Normally you need to refactor your code so that any value that's preserved from one iteration to the next becomes an <em>argument</em> of the recursive call. Those extra arguments usually make the function ugly to use from the outside world, so you end up wrapping it in another function to make it nicer.</p>



<a name="268182385"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Am%20I%20doing%20something%20silly%3F/near/268182385" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jan kili <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Am.20I.20doing.20something.20silly.3F.html#268182385">(Jan 16 2022 at 12:44)</a>:</h4>
<p>Ah, that's super useful! Does that only apply to functions <code>provide</code>d to the platform, or all of them?</p>



<a name="268184599"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Am%20I%20doing%20something%20silly%3F/near/268184599" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jan kili <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Am.20I.20doing.20something.20silly.3F.html#268184599">(Jan 16 2022 at 13:33)</a>:</h4>
<p><span class="user-mention" data-user-id="431893">@Brian Carroll</span> Would this module get the <code>while</code> loop optimization? It seems like it might, as it is still running and hasn't crashed yet <span aria-label="smiley" class="emoji emoji-1f603" role="img" title="smiley">:smiley:</span> </p>
<div class="codehilite"><pre><span></span><code>#!/usr/bin/env roc

app &quot;example&quot;
    packages { pf: &quot;./roc/examples/cli/platform&quot; }
    imports [ pf.Stdout.{ line }, pf.Task.{ await } ]
    provides [ main ] to pf

main =
    _ &lt;- await (line &quot;&quot;)
    tick 1000000000000

tick = \count -&gt;
    if count == 0 then
        line &quot;Done!&quot;
    else
        # _ &lt;- await (line (Num.toStr count))
        tick (count - 1)
</code></pre></div>



<a name="268185015"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Am%20I%20doing%20something%20silly%3F/near/268185015" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Carroll <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Am.20I.20doing.20something.20silly.3F.html#268185015">(Jan 16 2022 at 13:42)</a>:</h4>
<p>Nope, it's any function that calls itself and immediately returns the result. This is an optimisation that is implemented in pretty much every functional language. It's the standard trick for doing loops without mutation. I think it was figured out in the 70s, like everything else! It's called tail-call optimisation or tail-call elimination.</p>



<a name="268185042"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Am%20I%20doing%20something%20silly%3F/near/268185042" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Carroll <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Am.20I.20doing.20something.20silly.3F.html#268185042">(Jan 16 2022 at 13:43)</a>:</h4>
<p>I had lots of fun learning to use this when I discovered it!</p>



<a name="268185447"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Am%20I%20doing%20something%20silly%3F/near/268185447" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Am.20I.20doing.20something.20silly.3F.html#268185447">(Jan 16 2022 at 13:52)</a>:</h4>
<p>eh, in the above case <code>tick</code> will be TCO'd</p>



<a name="268187322"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Am%20I%20doing%20something%20silly%3F/near/268187322" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jan kili <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Am.20I.20doing.20something.20silly.3F.html#268187322">(Jan 16 2022 at 14:15)</a>:</h4>
<p>Would uncommenting the <code>await</code> change that?</p>



<a name="268187520"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Am%20I%20doing%20something%20silly%3F/near/268187520" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Am.20I.20doing.20something.20silly.3F.html#268187520">(Jan 16 2022 at 14:18)</a>:</h4>
<p>today, probably yes</p>



<a name="268187528"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Am%20I%20doing%20something%20silly%3F/near/268187528" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Am.20I.20doing.20something.20silly.3F.html#268187528">(Jan 16 2022 at 14:18)</a>:</h4>
<p>but LLVM may be able to turn the recursion back into a loop after some inlining</p>



<a name="268189426"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Am%20I%20doing%20something%20silly%3F/near/268189426" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jan kili <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Am.20I.20doing.20something.20silly.3F.html#268189426">(Jan 16 2022 at 14:50)</a>:</h4>
<p>I see! Thanks. So then... is it impossible today to avoid a stack overflow when infinitely-repeating an I/O cycle?</p>



<a name="268189721"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Am%20I%20doing%20something%20silly%3F/near/268189721" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jan kili <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Am.20I.20doing.20something.20silly.3F.html#268189721">(Jan 16 2022 at 14:57)</a>:</h4>
<p>(I'm glad there's a path to clean TCO for I/O, though!)</p>



<a name="268205149"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Am%20I%20doing%20something%20silly%3F/near/268205149" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Am.20I.20doing.20something.20silly.3F.html#268205149">(Jan 16 2022 at 20:30)</a>:</h4>
<p>This is actually an interesting question. So say we start with something of this form</p>
<div class="codehilite"><pre><span></span><code>tick = \count -&gt;
    if count == 0 then
        Effect.putLine &quot;done&quot;

    else
        Effect.await (Effect.putLine &quot;step&quot;) \{} -&gt; tick (count - 1)
</code></pre></div>

<p>Where <code>Effect a : [ @Effect (World -&gt; { a, world: World } ) ]</code> and</p>
<div class="codehilite"><pre><span></span><code>Effect.await : Effect a, (a -&gt; Effect b) -&gt; Effect b 
Effect.await = \@Effect thunk, toEffect -&gt; 
    @Effect \world1 -&gt;
        { a, world: world2 } = thunk world1

        @Effect thunk2 = toEffect a

        thunk2 world2
</code></pre></div>

<p>Inlining gives</p>
<div class="codehilite"><pre><span></span><code>tick = \count -&gt;
    if count == 0 then
        Effect.putLine &quot;done&quot;

    else
        @Effect thunk = Effect.putLine &quot;step&quot; 
        toEffect = \{} -&gt; tick (count - 1)

        @Effect \world1 -&gt;
            { a, world: world2 } = thunk world1

            @Effect thunk2 = toEffect a

            thunk2 world2
</code></pre></div>

<p>The <code>@Effect</code> wrapper melts away</p>
<div class="codehilite"><pre><span></span><code>tick = \count -&gt;
    if count == 0 then
        Effect.putLine &quot;done&quot;

    else
        thunk = Effect.putLine &quot;step&quot; 
        toEffect = \{} -&gt; tick (count - 1)

        \world1 -&gt;
            { a, world: world2 } = thunk world1

            thunk2 = toEffect a

            thunk2 world2
</code></pre></div>

<p>We can clean this up slightly</p>
<div class="codehilite"><pre><span></span><code>tick = \count -&gt;
    if count == 0 then
        Effect.putLine &quot;done&quot;

    else
        thunk = Effect.putLine &quot;step&quot; 
        toEffect = \{} -&gt; tick (count - 1)

        \world1 -&gt;
            { a, world: world2 } = thunk world1

            (toEffect a) world2
</code></pre></div>

<p>In this case we can inline <code>toEffect</code>, because the data dependency on <code>world2</code> ensures correct evaluation order <br>
Also we can move thunk into the closure and inline it (this does not happen today, but it's semantically valid)</p>
<div class="codehilite"><pre><span></span><code>tick : I64 -&gt; (World -&gt; { a: {}, world : World })
tick = \count -&gt;
    if count == 0 then
        Effect.putLine &quot;done&quot;

    else
        \world1 -&gt;
            { a: _, world: world2 } = (Effect.putLine &quot;step&quot;) world1

            (tick (count - 1)) world2
</code></pre></div>

<p>now we lift functions to the toplevel, and run into issues with closures</p>
<div class="codehilite"><pre><span></span><code>helper \world1, { count } -&gt;
    { a: _, world: world2 } = (Effect.putLine &quot;step&quot;) world1

    (tick (count - 1)) world2

tick : I64 -&gt; (World -&gt; { a: {}, world : World })
tick = \count -&gt;
    if count == 0 then
        Effect.putLine &quot;done&quot;

    else
        helper ??? { count }
</code></pre></div>

<p>we need to complete the closure conversion</p>
<div class="codehilite"><pre><span></span><code>helper : World, { count : I64 } -&gt; { a: {}, world : World }
helper \world1, { count } -&gt;
    { a: _, world: world2 } = (Effect.putLine &quot;step&quot;) world1

    when tick (count - 1) is    
        C1 { msg } -&gt; (Effect.putLine msg) world2
        C2 { count } -&gt; helper world2 { count }

tick : I64 -&gt; [ C1 Effect.putLine { msg: Str }, C2 helper { count: I64 } ]
tick = \count -&gt;
    if count == 0 then
        C1 { msg: &quot;done&quot; }

    else
        C2 { count }
</code></pre></div>

<p>and now <code>helper</code> can be TCO'd.</p>



<a name="268205201"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Am%20I%20doing%20something%20silly%3F/near/268205201" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Am.20I.20doing.20something.20silly.3F.html#268205201">(Jan 16 2022 at 20:31)</a>:</h4>
<p>given that we can do this with some simple rewriting, it seems plausible that LLVM could already figure this out today</p>



<a name="268205336"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Am%20I%20doing%20something%20silly%3F/near/268205336" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Am.20I.20doing.20something.20silly.3F.html#268205336">(Jan 16 2022 at 20:34)</a>:</h4>
<p>indeed, for this example the LLVM gets there</p>
<div class="codehilite"><pre><span></span><code>  %call1.i.i = tail call fastcc %str.RocStr @&quot;#UserApp_tick_6cc39a125db7a4f2ba7ee17ffefa9ff1fe97baed9c849631614587aef96caa15&quot;(i64 %operation_result.i.i.i)
  ret %str.RocStr %call1.i.i
</code></pre></div>



<a name="268207401"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Am%20I%20doing%20something%20silly%3F/near/268207401" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jan kili <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Am.20I.20doing.20something.20silly.3F.html#268207401">(Jan 16 2022 at 21:18)</a>:</h4>
<p>🤯</p>



<a name="268207431"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Am%20I%20doing%20something%20silly%3F/near/268207431" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jan kili <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Am.20I.20doing.20something.20silly.3F.html#268207431">(Jan 16 2022 at 21:19)</a>:</h4>
<p><span aria-label="bow" class="emoji emoji-1f647" role="img" title="bow">:bow:</span></p>



<a name="268207908"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Am%20I%20doing%20something%20silly%3F/near/268207908" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jan kili <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Am.20I.20doing.20something.20silly.3F.html#268207908">(Jan 16 2022 at 21:28)</a>:</h4>
<p>How does <code>tick</code> not need to call <code>helper</code>?<br>
How is its annotation (<code>tick : I64 -&gt; [ C1 Effect.putLine { msg: Str }, C2 helper { count: I64 } ]</code>) legal if <code>Effect.putLine</code> and <code>helper</code> are functions?<br>
Are the functions called implicitly or something?</p>



<a name="268208355"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Am%20I%20doing%20something%20silly%3F/near/268208355" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Am.20I.20doing.20something.20silly.3F.html#268208355">(Jan 16 2022 at 21:38)</a>:</h4>
<p>trying to figure out how to explain this, but that's kind of the idea yes</p>



<a name="268208674"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Am%20I%20doing%20something%20silly%3F/near/268208674" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Am.20I.20doing.20something.20silly.3F.html#268208674">(Jan 16 2022 at 21:45)</a>:</h4>
<p>We're missing main here </p>
<div class="codehilite"><pre><span></span><code>main : Effect {}
main = tick 5
</code></pre></div>

<p>Based on the return type for <code>tick</code>, this should be</p>
<div class="codehilite"><pre><span></span><code>main : [ C1 Effect.putLine { msg: Str }, C2 helper { count: I64 } ]
main = tick 5
</code></pre></div>

<p>This is the main function we expose. What it returns is really a suspended computation, or a recipe for a computation. We also expose an evaluator for this recipe. Intuitively </p>
<div class="codehilite"><pre><span></span><code>cheatyActualMain : Effect a -&gt; a 
cheatyActualMain = \effect -&gt; 
    @Effect thunk = effect

    thunk world
</code></pre></div>

<p>The closure transform turns that into (we're pretending here that <code>cheatyActualMain main</code> is called:</p>
<div class="codehilite"><pre><span></span><code>cheatyActualMain : [ C1 Effect.putLine { msg: Str }, C2 helper { count: I64 } ] -&gt; {}
cheatyActualMain = \closure -&gt; 
    when closure is
        C1 { msg } -&gt; (Effect.putLine msg) world
        C2 { count } -&gt; helper world { count }
</code></pre></div>



<a name="268208771"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Am%20I%20doing%20something%20silly%3F/near/268208771" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jan kili <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Am.20I.20doing.20something.20silly.3F.html#268208771">(Jan 16 2022 at 21:47)</a>:</h4>
<p>Where is <code>World</code> defined? (I've never heard of "worlds" in Roc before.)</p>



<a name="268208843"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Am%20I%20doing%20something%20silly%3F/near/268208843" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Am.20I.20doing.20something.20silly.3F.html#268208843">(Jan 16 2022 at 21:49)</a>:</h4>
<p>it's something I stole from haskell real quick to make sure the ordering of operations is fixed</p>



<a name="268208850"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Am%20I%20doing%20something%20silly%3F/near/268208850" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Am.20I.20doing.20something.20silly.3F.html#268208850">(Jan 16 2022 at 21:49)</a>:</h4>
<p>you could say <code>World : {}</code></p>



<a name="268208859"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Am%20I%20doing%20something%20silly%3F/near/268208859" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Am.20I.20doing.20something.20silly.3F.html#268208859">(Jan 16 2022 at 21:49)</a>:</h4>
<p>haskell's IO monad is defined in this way</p>



<a name="268208861"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Am%20I%20doing%20something%20silly%3F/near/268208861" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jan kili <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Am.20I.20doing.20something.20silly.3F.html#268208861">(Jan 16 2022 at 21:50)</a>:</h4>
<p>How does <code>Effect a</code> unify with <code>[ C1 Effect.putLine { msg: Str }, C2 helper { count: I64 } ]</code>? (I may be using the world "unify" incorrectly here, but I don't see how <code>cheatyActualMain</code> can accept <code>main</code> as its argument.</p>



<a name="268208903"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Am%20I%20doing%20something%20silly%3F/near/268208903" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Am.20I.20doing.20something.20silly.3F.html#268208903">(Jan 16 2022 at 21:50)</a>:</h4>
<p>where <code>IO a : (RealWorld -&gt; (a, RealWorld)</code></p>



<a name="268208927"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Am%20I%20doing%20something%20silly%3F/near/268208927" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Am.20I.20doing.20something.20silly.3F.html#268208927">(Jan 16 2022 at 21:51)</a>:</h4>
<p>right, so they don't unify but they are related in this case</p>



<a name="268208938"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Am%20I%20doing%20something%20silly%3F/near/268208938" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Am.20I.20doing.20something.20silly.3F.html#268208938">(Jan 16 2022 at 21:51)</a>:</h4>
<p>in e.g. elm we think of function types as just <code>a -&gt; b</code></p>



<a name="268208957"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Am%20I%20doing%20something%20silly%3F/near/268208957" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Am.20I.20doing.20something.20silly.3F.html#268208957">(Jan 16 2022 at 21:52)</a>:</h4>
<p>but, we extend that with an extra piece of information: what values (and with which types) are captured by the function</p>



<a name="268209043"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Am%20I%20doing%20something%20silly%3F/near/268209043" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Am.20I.20doing.20something.20silly.3F.html#268209043">(Jan 16 2022 at 21:53)</a>:</h4>
<p>So given</p>
<div class="codehilite"><pre><span></span><code>identity = \x -&gt; x
</code></pre></div>

<p>where elm would say </p>
<div class="codehilite"><pre><span></span><code>identity : a -&gt; a
</code></pre></div>

<p>we under the hood say</p>
<div class="codehilite"><pre><span></span><code>identity : a [ C identity {} ] -&gt; a
</code></pre></div>



<a name="268209103"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Am%20I%20doing%20something%20silly%3F/near/268209103" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jan kili <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Am.20I.20doing.20something.20silly.3F.html#268209103">(Jan 16 2022 at 21:54)</a>:</h4>
<p>Whoa! So is <code>[ C1 Effect.putLine { msg: Str }, C2 helper { count: I64 } ]</code> an annotation for only under-the-hood or is it also legal above-the-hood?</p>



<a name="268209107"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Am%20I%20doing%20something%20silly%3F/near/268209107" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Am.20I.20doing.20something.20silly.3F.html#268209107">(Jan 16 2022 at 21:54)</a>:</h4>
<p>and more interestingly</p>
<div class="codehilite"><pre><span></span><code>f = \x -&gt; Str.concat x y
</code></pre></div>

<p>(note, y is not bound within f, it is a free variable, and captured by this closure)</p>
<div class="codehilite"><pre><span></span><code>f : Str [ C f { y : Str } ] -&gt; Str
</code></pre></div>



<a name="268209115"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Am%20I%20doing%20something%20silly%3F/near/268209115" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Am.20I.20doing.20something.20silly.3F.html#268209115">(Jan 16 2022 at 21:54)</a>:</h4>
<p>the closure part is under-the-hood entirely</p>



<a name="268209118"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Am%20I%20doing%20something%20silly%3F/near/268209118" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jan kili <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Am.20I.20doing.20something.20silly.3F.html#268209118">(Jan 16 2022 at 21:54)</a>:</h4>
<p>I'm wondering whether I can stitch these code snippets into a module and run it on <code>./roc/examples/cli/platform</code></p>



<a name="268209202"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Am%20I%20doing%20something%20silly%3F/near/268209202" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Am.20I.20doing.20something.20silly.3F.html#268209202">(Jan 16 2022 at 21:56)</a>:</h4>
<p>in any case, to bring this together, we eliminate function values, and replace them by their captured environment. So <code>main : Effect a</code> really has a function type <code>main : World [ some things ] -&gt; { a, World }</code>, and that function value we represent by the closure tag union</p>



<a name="268209270"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Am%20I%20doing%20something%20silly%3F/near/268209270" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Am.20I.20doing.20something.20silly.3F.html#268209270">(Jan 16 2022 at 21:58)</a>:</h4>
<p>and then by doing some bookkeeping we can later know how to evaluate a closure value: simply match on all possible functions that it could be and pass along the arguments</p>



<a name="268209802"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Am%20I%20doing%20something%20silly%3F/near/268209802" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jan kili <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Am.20I.20doing.20something.20silly.3F.html#268209802">(Jan 16 2022 at 22:09)</a>:</h4>
<p>Are these tricks possible in a simple application outside of its platform? Above the platform/application boundary?</p>



<a name="268209848"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Am%20I%20doing%20something%20silly%3F/near/268209848" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jan kili <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Am.20I.20doing.20something.20silly.3F.html#268209848">(Jan 16 2022 at 22:10)</a>:</h4>
<p>For example, using the <code>examples/cli/platform</code> as-is?</p>



<a name="268209861"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Am%20I%20doing%20something%20silly%3F/near/268209861" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Am.20I.20doing.20something.20silly.3F.html#268209861">(Jan 16 2022 at 22:10)</a>:</h4>
<p>not in user code, because <code>Effect</code> is made with a private tag</p>



<a name="268209866"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Am%20I%20doing%20something%20silly%3F/near/268209866" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Am.20I.20doing.20something.20silly.3F.html#268209866">(Jan 16 2022 at 22:10)</a>:</h4>
<p>so you cannot unpack it or manually make an <code>Effect</code> from a function</p>



<a name="268210073"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Am%20I%20doing%20something%20silly%3F/near/268210073" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jan kili <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Am.20I.20doing.20something.20silly.3F.html#268210073">(Jan 16 2022 at 22:16)</a>:</h4>
<p>Ah, I see. Does that mean that today there's no <em>platform-agnostic</em> way to avoid a stack overflow when infinitely-repeating an I/O cycle?</p>



<a name="268210148"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Am%20I%20doing%20something%20silly%3F/near/268210148" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Am.20I.20doing.20something.20silly.3F.html#268210148">(Jan 16 2022 at 22:17)</a>:</h4>
<p>there is no guaranteed way</p>



<a name="268210157"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Am%20I%20doing%20something%20silly%3F/near/268210157" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jan kili <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Am.20I.20doing.20something.20silly.3F.html#268210157">(Jan 16 2022 at 22:17)</a>:</h4>
<p>Platforms have to explicitly support any infinite loops required for servers / games / long-running processes?</p>



<a name="268210162"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Am%20I%20doing%20something%20silly%3F/near/268210162" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Am.20I.20doing.20something.20silly.3F.html#268210162">(Jan 16 2022 at 22:17)</a>:</h4>
<p>but with <code>--optimize</code> tail optimization already happens</p>



<a name="268210204"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Am%20I%20doing%20something%20silly%3F/near/268210204" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Am.20I.20doing.20something.20silly.3F.html#268210204">(Jan 16 2022 at 22:18)</a>:</h4>
<p>in these cases</p>



<a name="268210228"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Am%20I%20doing%20something%20silly%3F/near/268210228" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Am.20I.20doing.20something.20silly.3F.html#268210228">(Jan 16 2022 at 22:19)</a>:</h4>
<p>I'd like to add <code>Effect.forever : Effect a -&gt; Effect b</code> for that</p>



<a name="268210372"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Am%20I%20doing%20something%20silly%3F/near/268210372" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jan kili <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Am.20I.20doing.20something.20silly.3F.html#268210372">(Jan 16 2022 at 22:22)</a>:</h4>
<p>Thank you for all this info!</p>



<a name="268210413"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Am%20I%20doing%20something%20silly%3F/near/268210413" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jan kili <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Am.20I.20doing.20something.20silly.3F.html#268210413">(Jan 16 2022 at 22:23)</a>:</h4>
<p>I'm disappointed that my pure-Roc CLI-based ASCII game hopes must be put on hold, but I'm hopeful it'll get support in the future :)</p>



<a name="268210414"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Am%20I%20doing%20something%20silly%3F/near/268210414" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Am.20I.20doing.20something.20silly.3F.html#268210414">(Jan 16 2022 at 22:23)</a>:</h4>
<p>did you run into stack issues?</p>



<a name="268210418"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Am%20I%20doing%20something%20silly%3F/near/268210418" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jan kili <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Am.20I.20doing.20something.20silly.3F.html#268210418">(Jan 16 2022 at 22:23)</a>:</h4>
<p>Yeah, I got a segfault after 47k frames</p>



<a name="268210425"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Am%20I%20doing%20something%20silly%3F/near/268210425" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Am.20I.20doing.20something.20silly.3F.html#268210425">(Jan 16 2022 at 22:23)</a>:</h4>
<p>ah, ok</p>



<a name="268210428"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Am%20I%20doing%20something%20silly%3F/near/268210428" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Am.20I.20doing.20something.20silly.3F.html#268210428">(Jan 16 2022 at 22:23)</a>:</h4>
<p>you did use <code>--optimize</code>?</p>



<a name="268210476"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Am%20I%20doing%20something%20silly%3F/near/268210476" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jan kili <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Am.20I.20doing.20something.20silly.3F.html#268210476">(Jan 16 2022 at 22:24)</a>:</h4>
<p>I didn't! What command is that a flag for?</p>



<a name="268210483"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Am%20I%20doing%20something%20silly%3F/near/268210483" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Am.20I.20doing.20something.20silly.3F.html#268210483">(Jan 16 2022 at 22:24)</a>:</h4>
<p>you can do <code>cargo run -- --optimize foo/bar/Baz.roc</code></p>



<a name="268210491"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Am%20I%20doing%20something%20silly%3F/near/268210491" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jan kili <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Am.20I.20doing.20something.20silly.3F.html#268210491">(Jan 16 2022 at 22:24)</a>:</h4>
<p>Ooh, I'll try</p>



<a name="268210504"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Am%20I%20doing%20something%20silly%3F/near/268210504" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jan kili <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Am.20I.20doing.20something.20silly.3F.html#268210504">(Jan 16 2022 at 22:25)</a>:</h4>
<p>And that might work with a mid-<code>tick</code> <code>_ &lt;- await</code>?</p>



<a name="268210513"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Am%20I%20doing%20something%20silly%3F/near/268210513" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Am.20I.20doing.20something.20silly.3F.html#268210513">(Jan 16 2022 at 22:25)</a>:</h4>
<p>certainly worth a try</p>



<a name="268211393"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Am%20I%20doing%20something%20silly%3F/near/268211393" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jan kili <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Am.20I.20doing.20something.20silly.3F.html#268211393">(Jan 16 2022 at 22:48)</a>:</h4>
<p><a href="/user_uploads/22008/EOlK4aYKs6e_yjWLcMFmAINZ/gogogo.gif">gogogo.gif</a></p>
<div class="message_inline_image"><a href="/user_uploads/22008/EOlK4aYKs6e_yjWLcMFmAINZ/gogogo.gif" title="gogogo.gif"><img src="/user_uploads/22008/EOlK4aYKs6e_yjWLcMFmAINZ/gogogo.gif"></a></div>



<a name="268211402"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Am%20I%20doing%20something%20silly%3F/near/268211402" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Am.20I.20doing.20something.20silly.3F.html#268211402">(Jan 16 2022 at 22:49)</a>:</h4>
<p>nice!</p>



<a name="268211412"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Am%20I%20doing%20something%20silly%3F/near/268211412" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Am.20I.20doing.20something.20silly.3F.html#268211412">(Jan 16 2022 at 22:49)</a>:</h4>
<p>so yeah we should figure out how to also make this work in non-optimized modes</p>



<a name="268211467"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Am%20I%20doing%20something%20silly%3F/near/268211467" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jan kili <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Am.20I.20doing.20something.20silly.3F.html#268211467">(Jan 16 2022 at 22:50)</a>:</h4>
<p><code>Am I doing something silly?</code> Yes, I'm running unoptimized code!</p>



<a name="268211488"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Am%20I%20doing%20something%20silly%3F/near/268211488" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jan kili <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Am.20I.20doing.20something.20silly.3F.html#268211488">(Jan 16 2022 at 22:50)</a>:</h4>
<p>Space Invaders, here I come.</p>



<a name="268211712"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Am%20I%20doing%20something%20silly%3F/near/268211712" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jan kili <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Am.20I.20doing.20something.20silly.3F.html#268211712">(Jan 16 2022 at 22:56)</a>:</h4>
<p>Thank you!</p>



<a name="268211796"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Am%20I%20doing%20something%20silly%3F/near/268211796" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jan kili <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Am.20I.20doing.20something.20silly.3F.html#268211796">(Jan 16 2022 at 22:58)</a>:</h4>
<p>(Side note, my mac went to sleep twice during the one minute I was running that infinite sleepless loop <span aria-label="joy" class="emoji emoji-1f602" role="img" title="joy">:joy:</span>)</p>



<a name="268211822"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Am%20I%20doing%20something%20silly%3F/near/268211822" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jan kili <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Am.20I.20doing.20something.20silly.3F.html#268211822">(Jan 16 2022 at 22:59)</a>:</h4>
<p>(I think I might need to add a <code>sleep</code> function to the platform's API)</p>



<a name="268211890"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Am%20I%20doing%20something%20silly%3F/near/268211890" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Am.20I.20doing.20something.20silly.3F.html#268211890">(Jan 16 2022 at 23:00)</a>:</h4>
<p>really, it can go to sleep during busy-waiting loops?</p>



<a name="268235182"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Am%20I%20doing%20something%20silly%3F/near/268235182" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Pit Capitain <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Am.20I.20doing.20something.20silly.3F.html#268235182">(Jan 17 2022 at 07:17)</a>:</h4>
<p>Thank you both for this really interesting discussion <span aria-label="smile" class="emoji emoji-1f642" role="img" title="smile">:smile:</span></p>



<a name="268252047"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Am%20I%20doing%20something%20silly%3F/near/268252047" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Carroll <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Am.20I.20doing.20something.20silly.3F.html#268252047">(Jan 17 2022 at 10:24)</a>:</h4>
<p>Yeah, interesting stuff!</p>



<a name="268252178"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Am%20I%20doing%20something%20silly%3F/near/268252178" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Carroll <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Am.20I.20doing.20something.20silly.3F.html#268252178">(Jan 17 2022 at 10:25)</a>:</h4>
<p>Great we can do this as well. Having a main loop with I/O inside it will be useful in all sorts of places!</p>



<a name="268297264"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Am%20I%20doing%20something%20silly%3F/near/268297264" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Am.20I.20doing.20something.20silly.3F.html#268297264">(Jan 17 2022 at 17:28)</a>:</h4>
<p>I wonder if <a href="https://github.com/rtfeldman/roc/issues/1778">https://github.com/rtfeldman/roc/issues/1778</a> would still be reproducible with <code>--optimize</code> <span aria-label="thinking" class="emoji emoji-1f914" role="img" title="thinking">:thinking:</span></p>



<a name="268300651"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Am%20I%20doing%20something%20silly%3F/near/268300651" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Am.20I.20doing.20something.20silly.3F.html#268300651">(Jan 17 2022 at 18:05)</a>:</h4>
<p>I think the inliner is not able to make the same thing happen there. We definitely tried it with <code>--optimize</code></p>



<a name="268564550"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Am%20I%20doing%20something%20silly%3F/near/268564550" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Am.20I.20doing.20something.20silly.3F.html#268564550">(Jan 19 2022 at 16:23)</a>:</h4>
<div class="codehilite"><pre><span></span><code>define internal fastcc {} @Effect_forever_inner_fb5e512425fc9449316ec95969ebe71e2d576dbab833d61e2a5b9330fd70ee2({} %&quot;5&quot;, { { %str.RocStr } } %&quot;#arg_closure&quot;) {
entry:
  br label %tailrecurse

tailrecurse:                                      ; preds = %tailrecurse, %entry
  %&quot;5.tr&quot; = phi {} [ %&quot;5&quot;, %entry ], [ zeroinitializer, %tailrecurse ]
  %&quot;#arg_closure.tr&quot; = phi { { %str.RocStr } } [ %&quot;#arg_closure&quot;, %entry ], [ %call1, %tailrecurse ]
  %struct_field_access_record_0 = extractvalue { { %str.RocStr } } %&quot;#arg_closure.tr&quot;, 0
  tail call fastcc void @&quot;#Attr_#inc_2&quot;({ %str.RocStr } %struct_field_access_record_0, i64 1)
  tail call fastcc void @&quot;#Attr_#dec_3&quot;({ { %str.RocStr } } %&quot;#arg_closure.tr&quot;)
  tail call fastcc void @&quot;#Attr_#inc_2&quot;({ %str.RocStr } %struct_field_access_record_0, i64 1)
  %call = tail call fastcc {} @Effect_effect_closure_putLine_9d9f29527a6be626a8f5985b26e19b237b44872b03631811df4416fc1713178({} zeroinitializer, { %str.RocStr } %struct_field_access_record_0)
  %call1 = tail call fastcc { { %str.RocStr } } @Effect_forever_67abdd721024f0ff4eb3f4c2fc13bc5bad42db7851d456d88d203d15aaa450({ %str.RocStr } %struct_field_access_record_0)
  br label %tailrecurse
}
</code></pre></div>
<p>it's beautiful</p>



<a name="268564708"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Am%20I%20doing%20something%20silly%3F/near/268564708" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Am.20I.20doing.20something.20silly.3F.html#268564708">(Jan 19 2022 at 16:24)</a>:</h4>
<p>This is an <code>Effect.forever</code> (used as e.g. <code>Effect.forever (Effect.putLine "hello world")</code> to print that line forever) and llvm turns it into a loop</p>



<a name="268564964"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Am%20I%20doing%20something%20silly%3F/near/268564964" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Am.20I.20doing.20something.20silly.3F.html#268564964">(Jan 19 2022 at 16:26)</a>:</h4>
<p>still needs some cleanup, and then maybe some variations that could iterate while some condition is true</p>



<a name="268565271"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Am%20I%20doing%20something%20silly%3F/near/268565271" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jan kili <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Am.20I.20doing.20something.20silly.3F.html#268565271">(Jan 19 2022 at 16:28)</a>:</h4>
<p>Nice! Is this for use in appcode or platformcode?</p>



<a name="268565628"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Am%20I%20doing%20something%20silly%3F/near/268565628" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Am.20I.20doing.20something.20silly.3F.html#268565628">(Jan 19 2022 at 16:30)</a>:</h4>
<p>a platform author could now expose <code>Task.forever</code> building upon this function</p>



<a name="268565633"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Am%20I%20doing%20something%20silly%3F/near/268565633" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Am.20I.20doing.20something.20silly.3F.html#268565633">(Jan 19 2022 at 16:30)</a>:</h4>
<p>so, both kinda</p>



<a name="268565719"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Am%20I%20doing%20something%20silly%3F/near/268565719" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jan kili <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Am.20I.20doing.20something.20silly.3F.html#268565719">(Jan 19 2022 at 16:31)</a>:</h4>
<p>That's super useful.</p>



<a name="268574795"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Am%20I%20doing%20something%20silly%3F/near/268574795" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Am.20I.20doing.20something.20silly.3F.html#268574795">(Jan 19 2022 at 17:28)</a>:</h4>
<p>wow, fantastic!!! <span aria-label="heart eyes" class="emoji emoji-1f60d" role="img" title="heart eyes">:heart_eyes:</span></p>
<p>this may end up becoming one of the most commonly used functions among all Roc programs!</p>



<a name="268594278"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Am%20I%20doing%20something%20silly%3F/near/268594278" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lucas Rosa <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Am.20I.20doing.20something.20silly.3F.html#268594278">(Jan 19 2022 at 19:53)</a>:</h4>
<p>omg! I wanted this for an event loop when I was trying to wrap SDL in a platform</p>



<a name="268594292"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Am%20I%20doing%20something%20silly%3F/near/268594292" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lucas Rosa <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Am.20I.20doing.20something.20silly.3F.html#268594292">(Jan 19 2022 at 19:53)</a>:</h4>
<p>this is very cool!</p>



<a name="268608470"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Am%20I%20doing%20something%20silly%3F/near/268608470" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Am.20I.20doing.20something.20silly.3F.html#268608470">(Jan 19 2022 at 21:51)</a>:</h4>
<p>This now also works</p>
<div class="codehilite" data-code-language="CoffeeScript"><pre><span></span><code><span class="nv">main : </span><span class="nx">Task</span><span class="p">.</span><span class="nx">Task</span> <span class="p">{}</span> <span class="p">[]</span>
<span class="nv">main =</span>
    <span class="nx">Task</span><span class="p">.</span><span class="nx">loop</span> <span class="mi">0</span> <span class="nx">looper</span>

<span class="nv">looper = </span><span class="err">\</span><span class="nx">n</span> <span class="nf">-&gt;</span>
    <span class="k">if</span> <span class="nx">n</span> <span class="o">&lt;</span> <span class="mi">10</span> <span class="k">then</span>
        <span class="nv">s = </span><span class="nx">Num</span><span class="p">.</span><span class="nx">toStr</span> <span class="nx">n</span>

        <span class="p">{}</span> <span class="o">&lt;-</span> <span class="nx">Task</span><span class="p">.</span><span class="nx">after</span> <span class="p">(</span><span class="nx">Task</span><span class="p">.</span><span class="nx">putLine</span> <span class="s">"Iteration: \(s)"</span><span class="p">)</span>

        <span class="nx">Task</span><span class="p">.</span><span class="nx">succeed</span> <span class="p">(</span><span class="nx">Step</span> <span class="p">(</span><span class="nx">n</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>

    <span class="k">else</span>
        <span class="nx">Task</span><span class="p">.</span><span class="nx">succeed</span> <span class="p">(</span><span class="nx">Done</span> <span class="p">{})</span>
</code></pre></div>



<a name="268609746"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Am%20I%20doing%20something%20silly%3F/near/268609746" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Am.20I.20doing.20something.20silly.3F.html#268609746">(Jan 19 2022 at 22:00)</a>:</h4>
<p>plus we get</p>
<div class="codehilite" data-code-language="CoffeeScript"><pre><span></span><code><span class="nv">forever : </span><span class="nx">Task</span> <span class="nx">val</span> <span class="nx">err</span> <span class="nf">-&gt;</span> <span class="nx">Task</span> <span class="o">*</span> <span class="nx">err</span>
<span class="nv">forever = </span><span class="err">\</span><span class="nx">task</span> <span class="nf">-&gt;</span>
    <span class="nv">helper = </span><span class="err">\</span><span class="p">{}</span> <span class="nf">-&gt;</span>
        <span class="nx">task</span>
            <span class="o">|&gt;</span> <span class="nx">Effect</span><span class="p">.</span><span class="nx">map</span> <span class="err">\</span><span class="nx">res</span> <span class="nf">-&gt;</span>
                <span class="k">when</span> <span class="nx">res</span> <span class="o">is</span>
                    <span class="nx">Ok</span> <span class="nx">_</span> <span class="nf">-&gt;</span> <span class="nx">Step</span> <span class="p">{}</span>
                    <span class="nx">Err</span> <span class="nx">e</span> <span class="nf">-&gt;</span> <span class="nx">Done</span> <span class="p">(</span><span class="nx">Err</span> <span class="nx">e</span><span class="p">)</span>

    <span class="nx">Effect</span><span class="p">.</span><span class="nx">loop</span> <span class="p">{}</span> <span class="nx">helper</span>
</code></pre></div>
<p>i.e. a <code>forever</code> on tasks that terminates when a task fails</p>



<a name="268614180"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Am%20I%20doing%20something%20silly%3F/near/268614180" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jan kili <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Am.20I.20doing.20something.20silly.3F.html#268614180">(Jan 19 2022 at 22:41)</a>:</h4>
<p>Yesss</p>



<a name="268614268"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Am%20I%20doing%20something%20silly%3F/near/268614268" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jan kili <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Am.20I.20doing.20something.20silly.3F.html#268614268">(Jan 19 2022 at 22:42)</a>:</h4>
<p>Are you planning to add any of these examples to <code>examples/</code>?</p>



<a name="268614377"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Am%20I%20doing%20something%20silly%3F/near/268614377" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jan kili <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Am.20I.20doing.20something.20silly.3F.html#268614377">(Jan 19 2022 at 22:43)</a>:</h4>
<p>This feature is invaluable to web servers, games, etc! Thank you :D</p>



<a name="268614423"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Am%20I%20doing%20something%20silly%3F/near/268614423" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Am.20I.20doing.20something.20silly.3F.html#268614423">(Jan 19 2022 at 22:43)</a>:</h4>
<p>the <code>loop</code> and <code>forever</code> task functions are added to the benchmarks and cli platforms in my PRs</p>



<a name="268614474"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Am%20I%20doing%20something%20silly%3F/near/268614474" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Am.20I.20doing.20something.20silly.3F.html#268614474">(Jan 19 2022 at 22:44)</a>:</h4>
<p>no usage examples yet though</p>



<a name="268614591"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Am%20I%20doing%20something%20silly%3F/near/268614591" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jan kili <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Am.20I.20doing.20something.20silly.3F.html#268614591">(Jan 19 2022 at 22:45)</a>:</h4>
<p>I might add some usage examples (unless you want to)</p>



<a name="268614739"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Am%20I%20doing%20something%20silly%3F/near/268614739" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jan kili <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Am.20I.20doing.20something.20silly.3F.html#268614739">(Jan 19 2022 at 22:46)</a>:</h4>
<p>to give <code>examples/cli/Echo.roc</code> some friends</p>



<a name="268620556"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Am%20I%20doing%20something%20silly%3F/near/268620556" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lucas Rosa <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Am.20I.20doing.20something.20silly.3F.html#268620556">(Jan 19 2022 at 23:44)</a>:</h4>
<p>this does make building a REPL in roc possible now</p>



<a name="268620571"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Am%20I%20doing%20something%20silly%3F/near/268620571" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lucas Rosa <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Am.20I.20doing.20something.20silly.3F.html#268620571">(Jan 19 2022 at 23:44)</a>:</h4>
<p>well I should say easier*</p>



<a name="271731301"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Am%20I%20doing%20something%20silly%3F/near/271731301" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jan kili <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Am.20I.20doing.20something.20silly.3F.html#271731301">(Feb 13 2022 at 06:46)</a>:</h4>
<p>Should this cause an Eldritch horror to be unleashed on my REPL? <span aria-label="scared" class="emoji emoji-1f628" role="img" title="scared">:scared:</span> </p>
<div class="codehilite"><pre><span></span><code>x : F32
x = 1.5
x * Num.toFloat 4
</code></pre></div>



<a name="271731590"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Am%20I%20doing%20something%20silly%3F/near/271731590" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jan kili <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Am.20I.20doing.20something.20silly.3F.html#271731590">(Feb 13 2022 at 06:54)</a>:</h4>
<p>I'm thinking no: <a href="https://github.com/rtfeldman/roc/issues/2476">https://github.com/rtfeldman/roc/issues/2476</a> <span aria-label="laughing" class="emoji emoji-1f606" role="img" title="laughing">:laughing:</span></p>



<a name="275091719"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Am%20I%20doing%20something%20silly%3F/near/275091719" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jan kili <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Am.20I.20doing.20something.20silly.3F.html#275091719">(Mar 12 2022 at 11:24)</a>:</h4>
<p>I'm back with more tag union panics! <span aria-label="laughing" class="emoji emoji-1f606" role="img" title="laughing">:laughing:</span> </p>
<div class="codehilite"><pre><span></span><code>» x : [ Y U8 ]*
… x = Y 3
… x
thread &#39;&lt;unnamed&gt;&#39; panicked at &#39;invalid content in tag union variable: (114, RigidVar(SubsIndex&lt;roc_module::ident::Lowercase&gt;(0)))&#39;, compiler/mono/src/layout.rs:2002:23
note: run with `RUST_BACKTRACE=1` environment variable to display a backtrace
^C
</code></pre></div>
<p>Am I doing something silly?</p>



<a name="275091733"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Am%20I%20doing%20something%20silly%3F/near/275091733" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jan kili <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Am.20I.20doing.20something.20silly.3F.html#275091733">(Mar 12 2022 at 11:24)</a>:</h4>
<p>(a closed tag union works fine here)</p>
<div class="codehilite"><pre><span></span><code>» x : [ Y U8 ]
… x = Y 3
… x

Y 3 : [ Y U8 ]
</code></pre></div>



<a name="275092883"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Am%20I%20doing%20something%20silly%3F/near/275092883" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jan kili <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Am.20I.20doing.20something.20silly.3F.html#275092883">(Mar 12 2022 at 11:54)</a>:</h4>
<p>I've got a second one! The silliness continues?</p>
<div class="codehilite"><pre><span></span><code>» wrap = \value -&gt; Tag value
… wrap

&lt;function&gt; : a -&gt; [ Tag a ]*

» wrap = \value -&gt; Tag value
… wrapIt = wrap
… wrapIt

&lt;function&gt; : a -&gt; [ Tag a ]*

» wrap = \value -&gt; Tag value
… wrap 42

Tag 42 : [ Tag (Num *) ]*

» wrap = \value -&gt; Tag value
… wrapIt = wrap
… wrapIt 42
thread &#39;main&#39; panicked at &#39;Roc failed with message: &quot;UnresolvedTypeVar compiler/mono/src/ir.rs line 6842&quot;&#39;, repl_cli/src/lib.rs:137:9
note: run with `RUST_BACKTRACE=1` environment variable to display a backtrace
</code></pre></div>



<a name="275097561"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Am%20I%20doing%20something%20silly%3F/near/275097561" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ayaz Hafiz <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Am.20I.20doing.20something.20silly.3F.html#275097561">(Mar 12 2022 at 13:40)</a>:</h4>
<p>Could you file bugs for these? The second one is known I think but would be good to have a record of both!</p>



<a name="288307335"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Am%20I%20doing%20something%20silly%3F/near/288307335" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jan kili <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Am.20I.20doing.20something.20silly.3F.html#288307335">(Jul 03 2022 at 04:43)</a>:</h4>
<p>Silliness detected? <a href="https://github.com/rtfeldman/roc/issues/3377">https://github.com/rtfeldman/roc/issues/3377</a></p>



<a name="288307736"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Am%20I%20doing%20something%20silly%3F/near/288307736" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jan kili <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Am.20I.20doing.20something.20silly.3F.html#288307736">(Jul 03 2022 at 04:53)</a>:</h4>
<p>(I'm causing a segfault by substituting <code>[0, 1, 2]</code> with <code>List.range 0 3</code>)</p>



<a name="288309036"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Am%20I%20doing%20something%20silly%3F/near/288309036" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jan kili <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Am.20I.20doing.20something.20silly.3F.html#288309036">(Jul 03 2022 at 05:22)</a>:</h4>
<p>I've encountered a second problem! Am I missing something about this syntax, because this seems like a reasonable recursion pattern to me:</p>
<div class="codehilite"><pre><span></span><code>» a = \b -&gt;
…     c = \d -&gt;
…         if d &gt;= 10 then d else c (d+b)
…     c 0
… a 6
thread &#39;main&#39; panicked at &#39;internal error: entered unreachable code: symbol/layout `#UserApp.c` ProcLayout { arguments: [Builtin(Int(I64))], result: Builtin(Int(I64)) } combo must be in DeclarationToIndex&#39;, crates/compiler/mono/src/borrow.rs:165:9
note: run with `RUST_BACKTRACE=1` environment variable to display a backtrace
[jan@framey roc]$
</code></pre></div>



<a name="288309056"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Am%20I%20doing%20something%20silly%3F/near/288309056" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jan kili <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Am.20I.20doing.20something.20silly.3F.html#288309056">(Jul 03 2022 at 05:23)</a>:</h4>
<p>(btw, that inner function is fine by itself)</p>
<div class="codehilite"><pre><span></span><code>» c = \d -&gt;
…     if d &gt;= 10 then d else c (d+3)
… c 0

12 : Num *

»
</code></pre></div>



<a name="288309132"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Am%20I%20doing%20something%20silly%3F/near/288309132" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jan kili <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Am.20I.20doing.20something.20silly.3F.html#288309132">(Jul 03 2022 at 05:25)</a>:</h4>
<p>I'll go ahead and report that second "internal error" problem as an issue, too.</p>



<a name="288309179"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Am%20I%20doing%20something%20silly%3F/near/288309179" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jan kili <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Am.20I.20doing.20something.20silly.3F.html#288309179">(Jul 03 2022 at 05:26)</a>:</h4>
<p>I expect that I'm exhibiting minimal silliness here today. Sorry for being boring!</p>



<a name="288309324"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Am%20I%20doing%20something%20silly%3F/near/288309324" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jan kili <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Am.20I.20doing.20something.20silly.3F.html#288309324">(Jul 03 2022 at 05:31)</a>:</h4>
<p><a href="https://github.com/rtfeldman/roc/issues/3378">https://github.com/rtfeldman/roc/issues/3378</a></p>



<a name="289218204"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Am%20I%20doing%20something%20silly%3F/near/289218204" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jan kili <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Am.20I.20doing.20something.20silly.3F.html#289218204">(Jul 11 2022 at 16:41)</a>:</h4>
<p>Ummm what am I missing here?</p>
<div class="codehilite" data-code-language="CoffeeScript"><pre><span></span><code><span class="nv">main</span><span class="w"> </span><span class="o">=</span><span class="w"></span>
<span class="w">    </span><span class="nv">deck</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">myDeck</span><span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="nx">card</span><span class="p">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">dealMe</span><span class="w"> </span><span class="nx">deck</span><span class="w"></span>
<span class="w">    </span><span class="nv">rank</span><span class="w"> </span><span class="o">=</span><span class="w"></span>
<span class="w">        </span><span class="k">when</span><span class="w"> </span><span class="nx">card</span><span class="p">.</span><span class="nx">rank</span><span class="w"> </span><span class="o">is</span><span class="w"></span>
<span class="w">            </span><span class="nx">Ace</span><span class="w"> </span><span class="nf">-&gt;</span><span class="w"> </span><span class="s">"Ace"</span><span class="w"></span>
<span class="w">            </span><span class="nx">King</span><span class="w"> </span><span class="nf">-&gt;</span><span class="w"> </span><span class="s">"King"</span><span class="w"></span>
<span class="w">            </span><span class="nx">Queen</span><span class="w"> </span><span class="nf">-&gt;</span><span class="w"> </span><span class="s">"Queen"</span><span class="w"></span>
<span class="w">            </span><span class="nx">Jack</span><span class="w"> </span><span class="nf">-&gt;</span><span class="w"> </span><span class="s">"Jack"</span><span class="w"></span>
<span class="w">    </span><span class="nv">suit</span><span class="w"> </span><span class="o">=</span><span class="w"></span>
<span class="w">        </span><span class="k">when</span><span class="w"> </span><span class="nx">card</span><span class="p">.</span><span class="nx">suit</span><span class="w"> </span><span class="o">is</span><span class="w"></span>
<span class="w">            </span><span class="nx">Club</span><span class="w"> </span><span class="nf">-&gt;</span><span class="w"> </span><span class="s">"Clubs"</span><span class="w"></span>
<span class="w">            </span><span class="nx">Diamond</span><span class="w"> </span><span class="nf">-&gt;</span><span class="w"> </span><span class="s">"Diamonds"</span><span class="w"></span>
<span class="w">            </span><span class="nx">Heart</span><span class="w"> </span><span class="nf">-&gt;</span><span class="w"> </span><span class="s">"Hearts"</span><span class="w"></span>
<span class="w">            </span><span class="nx">Spade</span><span class="w"> </span><span class="nf">-&gt;</span><span class="w"> </span><span class="s">"Spades"</span><span class="w"></span>
<span class="w">    </span><span class="s">"My card is the \(card.rank) of \(card.suit)!\n"</span><span class="w"></span>
</code></pre></div>
<div class="codehilite"><pre><span></span><code>── MISSING EXPRESSION ─ ..._roc/domain-modeling-in-roc/step_2__card_game_A.roc ─

I am partway through parsing a definition, but I got stuck here:

 4│      provides [main] to pf
...
23│  main =
24│      deck = myDeck
25│      {card} = dealMe deck
26│      rank =
27│          when card.rank is
                              ^

I was expecting to see an expression like 42 or &quot;hello&quot;.
</code></pre></div>
<p><span aria-label="thinking" class="emoji emoji-1f914" role="img" title="thinking">:thinking:</span></p>



<a name="289218617"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Am%20I%20doing%20something%20silly%3F/near/289218617" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Am.20I.20doing.20something.20silly.3F.html#289218617">(Jul 11 2022 at 16:44)</a>:</h4>
<p>Whitespace bug? That is definitely what it looks like to me.</p>



<a name="289218762"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Am%20I%20doing%20something%20silly%3F/near/289218762" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jan kili <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Am.20I.20doing.20something.20silly.3F.html#289218762">(Jul 11 2022 at 16:45)</a>:</h4>
<p>Ooh, I'll check for that</p>



<a name="289218889"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Am%20I%20doing%20something%20silly%3F/near/289218889" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Am.20I.20doing.20something.20silly.3F.html#289218889">(Jul 11 2022 at 16:46)</a>:</h4>
<p>Might be worth running roc format and seeing the diff? might fix it?</p>



<a name="289218991"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Am%20I%20doing%20something%20silly%3F/near/289218991" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jan kili <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Am.20I.20doing.20something.20silly.3F.html#289218991">(Jul 11 2022 at 16:47)</a>:</h4>
<p>Success!</p>



<a name="289219030"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Am%20I%20doing%20something%20silly%3F/near/289219030" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jan kili <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Am.20I.20doing.20something.20silly.3F.html#289219030">(Jul 11 2022 at 16:47)</a>:</h4>
<p>I didn't try the formatter, but I think it was a funky newline.</p>



<a name="289219036"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Am%20I%20doing%20something%20silly%3F/near/289219036" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jan kili <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Am.20I.20doing.20something.20silly.3F.html#289219036">(Jul 11 2022 at 16:47)</a>:</h4>
<p>Thank you :)</p>



<a name="289219129"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Am%20I%20doing%20something%20silly%3F/near/289219129" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Am.20I.20doing.20something.20silly.3F.html#289219129">(Jul 11 2022 at 16:48)</a>:</h4>
<p>If it seems worth tracking/filing an issue, maybe we can make a better error message or fix the parsing around this.</p>



<a name="289219418"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Am%20I%20doing%20something%20silly%3F/near/289219418" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jan kili <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Am.20I.20doing.20something.20silly.3F.html#289219418">(Jul 11 2022 at 16:50)</a>:</h4>
<p>While I have you here, any tips for this?</p>
<div class="codehilite"><pre><span></span><code>[jan@framey roc]$ export RUST_BACKTRACE=full
[jan@framey roc]$ cargo run ../domain-modeling-in-roc/step_2__card_game_A.roc
    Finished dev [unoptimized + debuginfo] target(s) in 0.44s
     Running `target/debug/roc ../domain-modeling-in-roc/step_2__card_game_A.roc`
thread &#39;&lt;unnamed&gt;&#39; panicked at &#39;not yet implemented&#39;, crates/compiler/mono/src/ir.rs:2382:23
stack backtrace:
   0:     0x5635ba31fb9d - std::backtrace_rs::backtrace::libunwind::trace::hee598835bc88d35b
                               at /rustc/7737e0b5c4103216d6fd8cf941b7ab9bdbaace7c/library/std/src/../../backtrace/src/backtrace/libunwind.rs:93:5
   1:     0x5635ba31fb9d - std::backtrace_rs::backtrace::trace_unsynchronized::h9cdc730ba5cf5d72
                               at /rustc/7737e0b5c4103216d6fd8cf941b7ab9bdbaace7c/library/std/src/../../backtrace/src/backtrace/mod.rs:66:5
   2:     0x5635ba31fb9d - std::sys_common::backtrace::_print_fmt::h75aeaf7ed30e43fa
                               at /rustc/7737e0b5c4103216d6fd8cf941b7ab9bdbaace7c/library/std/src/sys_common/backtrace.rs:66:5
   3:     0x5635ba31fb9d - &lt;std::sys_common::backtrace::_print::DisplayBacktrace as core::fmt::Display&gt;::fmt::h606862f787600875
                               at /rustc/7737e0b5c4103216d6fd8cf941b7ab9bdbaace7c/library/std/src/sys_common/backtrace.rs:45:22
   4:     0x5635ba34aadc - core::fmt::write::he803f0f418caf762
                               at /rustc/7737e0b5c4103216d6fd8cf941b7ab9bdbaace7c/library/core/src/fmt/mod.rs:1190:17
   5:     0x5635ba319d28 - std::io::Write::write_fmt::h70bc45872f37e7bb
                               at /rustc/7737e0b5c4103216d6fd8cf941b7ab9bdbaace7c/library/std/src/io/mod.rs:1657:15
   6:     0x5635ba321dd7 - std::sys_common::backtrace::_print::h64d038cf8ac3e13e
                               at /rustc/7737e0b5c4103216d6fd8cf941b7ab9bdbaace7c/library/std/src/sys_common/backtrace.rs:48:5
   7:     0x5635ba321dd7 - std::sys_common::backtrace::print::h359300b4a7fccf65
                               at /rustc/7737e0b5c4103216d6fd8cf941b7ab9bdbaace7c/library/std/src/sys_common/backtrace.rs:35:9
   8:     0x5635ba321dd7 - std::panicking::default_hook::{{closure}}::hf51be35e2f510149
                               at /rustc/7737e0b5c4103216d6fd8cf941b7ab9bdbaace7c/library/std/src/panicking.rs:295:22
   9:     0x5635ba321aa0 - std::panicking::default_hook::h03ca0f22e1d2d25e
                               at /rustc/7737e0b5c4103216d6fd8cf941b7ab9bdbaace7c/library/std/src/panicking.rs:314:9
  10:     0x5635ba322529 - std::panicking::rust_panic_with_hook::h3b7380e99b825b63
                               at /rustc/7737e0b5c4103216d6fd8cf941b7ab9bdbaace7c/library/std/src/panicking.rs:698:17
  11:     0x5635ba3221d9 - std::panicking::begin_panic_handler::{{closure}}::h8e849d0710154ce0
                               at /rustc/7737e0b5c4103216d6fd8cf941b7ab9bdbaace7c/library/std/src/panicking.rs:586:13
  12:     0x5635ba320064 - std::sys_common::backtrace::__rust_end_short_backtrace::hedcdaddbd4c46cc5
                               at /rustc/7737e0b5c4103216d6fd8cf941b7ab9bdbaace7c/library/std/src/sys_common/backtrace.rs:138:18
  13:     0x5635ba321f29 - rust_begin_unwind
                               at /rustc/7737e0b5c4103216d6fd8cf941b7ab9bdbaace7c/library/std/src/panicking.rs:584:5
  14:     0x5635b5b4ae83 - core::panicking::panic_fmt::he1bbc7336d49a357
                               at /rustc/7737e0b5c4103216d6fd8cf941b7ab9bdbaace7c/library/core/src/panicking.rs:143:14
  15:     0x5635b5b4ad4d - core::panicking::panic::h4241c5ccea17faca
                               at /rustc/7737e0b5c4103216d6fd8cf941b7ab9bdbaace7c/library/core/src/panicking.rs:48:5
  16:     0x5635b99cc490 - roc_mono::ir::from_can_let::he631a1fd2e7f1db7
                               at /home/jan/_code/_roc/roc/crates/compiler/mono/src/ir.rs:2382:23
  17:     0x5635b9a09970 - roc_mono::ir::from_can::h6c53f19073fb59f4
                               at /home/jan/_code/_roc/roc/crates/compiler/mono/src/ir.rs:5932:33
  18:     0x5635b996e417 - roc_mono::ir::from_can_let::{{closure}}::hb169aff3d0732e09
                               at /home/jan/_code/_roc/roc/crates/compiler/mono/src/ir.rs:2206:25
  19:     0x5635b99769d7 - roc_mono::ir::handle_variable_aliasing::h457631afa9a49d05
                               at /home/jan/_code/_roc/roc/crates/compiler/mono/src/ir.rs:7025:16
  20:     0x5635b99d0e75 - roc_mono::ir::from_can_let::he631a1fd2e7f1db7
                               at /home/jan/_code/_roc/roc/crates/compiler/mono/src/ir.rs:2209:24
  21:     0x5635b9a09970 - roc_mono::ir::from_can::h6c53f19073fb59f4
                               at /home/jan/_code/_roc/roc/crates/compiler/mono/src/ir.rs:5932:33
  22:     0x5635b99d6413 - roc_mono::ir::specialize_external::h014c8ba65786d364
                               at /home/jan/_code/_roc/roc/crates/compiler/mono/src/ir.rs:2988:32
  23:     0x5635b996ebf8 - roc_mono::ir::specialize_variable_help::hc0e86a21717b3946
                               at /home/jan/_code/_roc/roc/crates/compiler/mono/src/ir.rs:3465:23
  24:     0x5635b99dbbf3 - roc_mono::ir::specialize_variable::h0634205863a1b1ec
                               at /home/jan/_code/_roc/roc/crates/compiler/mono/src/ir.rs:3414:5
  25:     0x5635b99d4cb4 - roc_mono::ir::specialize_external_help::he85ecfa478515205
                               at /home/jan/_code/_roc/roc/crates/compiler/mono/src/ir.rs:2767:33
  26:     0x5635b99d4aa2 - roc_mono::ir::specialize_external_specializations::h03afe44495a518a6
                               at /home/jan/_code/_roc/roc/crates/compiler/mono/src/ir.rs:2740:13
  27:     0x5635b99d400e - roc_mono::ir::specialize_all::h38efe702f28bba33
                               at /home/jan/_code/_roc/roc/crates/compiler/mono/src/ir.rs:2673:9
  28:     0x5635b7436e4e - roc_load_internal::file::make_specializations::h624990574ec76565
                               at /home/jan/_code/_roc/roc/crates/compiler/load_internal/src/file.rs:4519:13
  29:     0x5635b743c47b - roc_load_internal::file::run_task::h6036f07fd619b017
                               at /home/jan/_code/_roc/roc/crates/compiler/load_internal/src/file.rs:4996:17
  30:     0x5635b741559a - roc_load_internal::file::worker_task::hebe41c651db0920e
                               at /home/jan/_code/_roc/roc/crates/compiler/load_internal/src/file.rs:1817:34
  31:     0x5635b7440e1a - roc_load_internal::file::load_multi_threaded::{{closure}}::{{closure}}::h16d5eba0a83616fc
                               at /home/jan/_code/_roc/roc/crates/compiler/load_internal/src/file.rs:1659:25
  32:     0x5635b744caf7 - crossbeam_utils::thread::ScopedThreadBuilder::spawn::{{closure}}::ha411c1ac2e878ff5
                               at /home/jan/.cargo/registry/src/github.com-1ecc6299db9ec823/crossbeam-utils-0.8.10/src/thread.rs:438:31
  33:     0x5635b73d3fef - core::ops::function::FnOnce::call_once{{vtable.shim}}::h182bc693cee28e90
                               at /rustc/7737e0b5c4103216d6fd8cf941b7ab9bdbaace7c/library/core/src/ops/function.rs:227:5
  34:     0x5635b740505d - &lt;alloc::boxed::Box&lt;F,A&gt; as core::ops::function::FnOnce&lt;Args&gt;&gt;::call_once::hee34075471a3830c
                               at /rustc/7737e0b5c4103216d6fd8cf941b7ab9bdbaace7c/library/alloc/src/boxed.rs:1853:9
  35:     0x5635b74eed84 - std::sys_common::backtrace::__rust_begin_short_backtrace::h74784c32857fa8b7
                               at /rustc/7737e0b5c4103216d6fd8cf941b7ab9bdbaace7c/library/std/src/sys_common/backtrace.rs:122:18
  36:     0x5635b74dd8d4 - std::thread::Builder::spawn_unchecked_::{{closure}}::{{closure}}::h54bd13ac090e0e91
                               at /rustc/7737e0b5c4103216d6fd8cf941b7ab9bdbaace7c/library/std/src/thread/mod.rs:498:17
  37:     0x5635b74efaa4 - &lt;core::panic::unwind_safe::AssertUnwindSafe&lt;F&gt; as core::ops::function::FnOnce&lt;()&gt;&gt;::call_once::he1cf1df6def34f88
                               at /rustc/7737e0b5c4103216d6fd8cf941b7ab9bdbaace7c/library/core/src/panic/unwind_safe.rs:271:9
  38:     0x5635b74ef26d - std::panicking::try::do_call::h48b63b9234108830
                               at /rustc/7737e0b5c4103216d6fd8cf941b7ab9bdbaace7c/library/std/src/panicking.rs:492:40
  39:     0x5635b74ef49b - __rust_try
  40:     0x5635b74ef1bd - std::panicking::try::hb3ba778589fab460
                               at /rustc/7737e0b5c4103216d6fd8cf941b7ab9bdbaace7c/library/std/src/panicking.rs:456:19
  41:     0x5635b74ec7d4 - std::panic::catch_unwind::h7c5138398b54d137
                               at /rustc/7737e0b5c4103216d6fd8cf941b7ab9bdbaace7c/library/std/src/panic.rs:137:14
  42:     0x5635b74dd6f3 - std::thread::Builder::spawn_unchecked_::{{closure}}::hd3349d142c8673c4
                               at /rustc/7737e0b5c4103216d6fd8cf941b7ab9bdbaace7c/library/std/src/thread/mod.rs:497:30
  43:     0x5635b73d3f0f - core::ops::function::FnOnce::call_once{{vtable.shim}}::h14f5d8c93db30fba
                               at /rustc/7737e0b5c4103216d6fd8cf941b7ab9bdbaace7c/library/core/src/ops/function.rs:227:5
  44:     0x5635ba329d03 - &lt;alloc::boxed::Box&lt;F,A&gt; as core::ops::function::FnOnce&lt;Args&gt;&gt;::call_once::hf70ac038171e3e1a
                               at /rustc/7737e0b5c4103216d6fd8cf941b7ab9bdbaace7c/library/alloc/src/boxed.rs:1853:9
  45:     0x5635ba329d03 - &lt;alloc::boxed::Box&lt;F,A&gt; as core::ops::function::FnOnce&lt;Args&gt;&gt;::call_once::he6690128792365ad
                               at /rustc/7737e0b5c4103216d6fd8cf941b7ab9bdbaace7c/library/alloc/src/boxed.rs:1853:9
  46:     0x5635ba329d03 - std::sys::unix::thread::Thread::new::thread_start::ha07928d93d5a5ec9
                               at /rustc/7737e0b5c4103216d6fd8cf941b7ab9bdbaace7c/library/std/src/sys/unix/thread.rs:108:17
  47:     0x7f8513f29d40 - start_thread
  48:     0x7f8513a8703f - __GI___clone
  49:                0x0 - &lt;unknown&gt;
^C
[jan@framey roc]$
</code></pre></div>



<a name="289219479"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Am%20I%20doing%20something%20silly%3F/near/289219479" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Am.20I.20doing.20something.20silly.3F.html#289219479">(Jul 11 2022 at 16:51)</a>:</h4>
<p>does it pass <code>roc check</code>?</p>



<a name="289219513"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Am%20I%20doing%20something%20silly%3F/near/289219513" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Am.20I.20doing.20something.20silly.3F.html#289219513">(Jul 11 2022 at 16:51)</a>:</h4>
<p>That catches a lot that might crash the compiler.</p>



<a name="289219518"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Am%20I%20doing%20something%20silly%3F/near/289219518" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jan kili <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Am.20I.20doing.20something.20silly.3F.html#289219518">(Jul 11 2022 at 16:51)</a>:</h4>
<p>GAH I always forget to go back to checking</p>



<a name="289219596"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Am%20I%20doing%20something%20silly%3F/near/289219596" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jan kili <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Am.20I.20doing.20something.20silly.3F.html#289219596">(Jul 11 2022 at 16:52)</a>:</h4>
<p>I do check check check check, then the first time it passes I go straight to run run run run while editing :facepalm:</p>



<a name="289219624"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Am%20I%20doing%20something%20silly%3F/near/289219624" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jan kili <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Am.20I.20doing.20something.20silly.3F.html#289219624">(Jul 11 2022 at 16:52)</a>:</h4>
<p>Thanks again, check has my answers :)</p>



<a name="289219753"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Am%20I%20doing%20something%20silly%3F/near/289219753" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Am.20I.20doing.20something.20silly.3F.html#289219753">(Jul 11 2022 at 16:53)</a>:</h4>
<p>that's surprising actually - <code>cargo run</code> should do the "<code>check</code> and then only run if there are no errors reported" flow <span aria-label="thinking" class="emoji emoji-1f914" role="img" title="thinking">:thinking:</span></p>



<a name="289219830"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Am%20I%20doing%20something%20silly%3F/near/289219830" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Am.20I.20doing.20something.20silly.3F.html#289219830">(Jul 11 2022 at 16:53)</a>:</h4>
<p>so I'm surprised that <code>cargo run ../domain-modeling-in-roc/step_2__card_game_A.roc</code> would report no compile-time errors but <code>cargo run check</code> would!</p>



<a name="289220468"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Am%20I%20doing%20something%20silly%3F/near/289220468" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Am.20I.20doing.20something.20silly.3F.html#289220468">(Jul 11 2022 at 16:59)</a>:</h4>
<p>really? I thought <code>cargo run &lt;script&gt;</code> and <code>roc &lt;script&gt;</code> did not run check. That would definitely be useful.</p>



<a name="289220505"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Am%20I%20doing%20something%20silly%3F/near/289220505" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Am.20I.20doing.20something.20silly.3F.html#289220505">(Jul 11 2022 at 16:59)</a>:</h4>
<p>so <code>roc foo.roc</code> does this, but <code>roc run foo.roc</code> just runs and doesn't check</p>



<a name="289220532"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Am%20I%20doing%20something%20silly%3F/near/289220532" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Am.20I.20doing.20something.20silly.3F.html#289220532">(Jul 11 2022 at 16:59)</a>:</h4>
<p>hmm. Yeah, I don't think that is working</p>



<a name="289220538"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Am%20I%20doing%20something%20silly%3F/near/289220538" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Am.20I.20doing.20something.20silly.3F.html#289220538">(Jul 11 2022 at 16:59)</a>:</h4>
<p>so it's the difference between <code>cargo run run</code> and <code>cargo run</code> <span aria-label="big smile" class="emoji emoji-1f604" role="img" title="big smile">:big_smile:</span></p>



<a name="289220633"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Am%20I%20doing%20something%20silly%3F/near/289220633" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Am.20I.20doing.20something.20silly.3F.html#289220633">(Jul 11 2022 at 17:00)</a>:</h4>
<p>Or maybe it does part of the check but not all of it...not sure</p>



<a name="289220644"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Am%20I%20doing%20something%20silly%3F/near/289220644" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Am.20I.20doing.20something.20silly.3F.html#289220644">(Jul 11 2022 at 17:00)</a>:</h4>
<p>I definitely need to use <code>check</code> still.</p>



<a name="289220685"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Am%20I%20doing%20something%20silly%3F/near/289220685" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Am.20I.20doing.20something.20silly.3F.html#289220685">(Jul 11 2022 at 17:00)</a>:</h4>
<p>hm, if you can reproduce an example of it not working right, maybe it's an easy fix!</p>



<a name="290709825"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Am%20I%20doing%20something%20silly%3F/near/290709825" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jan kili <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Am.20I.20doing.20something.20silly.3F.html#290709825">(Jul 25 2022 at 01:24)</a>:</h4>
<p>Hello, it's me again, <strong><em>Dr. Help I. M. Crashing</em></strong> <span aria-label="laughing" class="emoji emoji-1f606" role="img" title="laughing">:laughing:</span></p>



<a name="290709837"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Am%20I%20doing%20something%20silly%3F/near/290709837" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jan kili <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Am.20I.20doing.20something.20silly.3F.html#290709837">(Jul 25 2022 at 01:24)</a>:</h4>
<p>This behavior seems like it shouldn't be possible, unless there's a bug in the release build process:</p>
<div class="codehilite"><pre><span></span><code>[jan@framey ~]$ cd ~/_code/_roc/roc
[jan@framey roc]$
[jan@framey roc]$ nix develop
[jan@framey roc]$
[jan@framey roc]$ cargo run ../project-euler-in-roc/2.roc
    Finished dev [unoptimized + debuginfo] target(s) in 0.46s
     Running `target/debug/roc ../project-euler-in-roc/2.roc`
🔨 Rebuilding host...
4613732
[jan@framey roc]$
[jan@framey roc]$ cargo build --release
    Finished release [optimized] target(s) in 0.48s
[jan@framey roc]$
[jan@framey roc]$ exit
exit
[jan@framey roc]$
[jan@framey roc]$ cd ~/_code/_roc/project-euler-in-roc/
[jan@framey project-euler-in-roc]$
[jan@framey project-euler-in-roc]$ ../roc/target/release/roc 2.roc
🔨 Rebuilding host...
thread &#39;&lt;unnamed&gt;&#39; panicked at &#39;called `Result::unwrap()` on an `Err` value: Os { code: 2, kind: NotFound, message: &quot;No such file or directory&quot; }&#39;, crates/compiler/build/src/link.rs:360:22
note: run with `RUST_BACKTRACE=1` environment variable to display a backtrace
thread &#39;main&#39; panicked at &#39;called `Result::unwrap()` on an `Err` value: Any { .. }&#39;, crates/cli/src/build.rs:283:46
[jan@framey project-euler-in-roc]$
[jan@framey project-euler-in-roc]$ ../roc/target/release/roc check 2.roc
0 errors and 0 warnings found in 20 ms.
[jan@framey project-euler-in-roc]$
[jan@framey project-euler-in-roc]$ ???
</code></pre></div>



<a name="290709862"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Am%20I%20doing%20something%20silly%3F/near/290709862" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jan kili <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Am.20I.20doing.20something.20silly.3F.html#290709862">(Jul 25 2022 at 01:25)</a>:</h4>
<p>It seems to not matter which app I run, the same "yes inside <code>nix develop</code>, no outside it" happens</p>



<a name="290709917"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Am%20I%20doing%20something%20silly%3F/near/290709917" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jan kili <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Am.20I.20doing.20something.20silly.3F.html#290709917">(Jul 25 2022 at 01:26)</a>:</h4>
<p>Did I miss a step? (I remembered to <code>check</code> this time! haha)</p>



<a name="290709989"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Am%20I%20doing%20something%20silly%3F/near/290709989" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jan kili <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Am.20I.20doing.20something.20silly.3F.html#290709989">(Jul 25 2022 at 01:28)</a>:</h4>
<p>(on Linux, Fedora 36)</p>



<a name="290711351"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Am%20I%20doing%20something%20silly%3F/near/290711351" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jan kili <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Am.20I.20doing.20something.20silly.3F.html#290711351">(Jul 25 2022 at 01:56)</a>:</h4>
<p>Oh, and I guess this is additional info + a more concise repro:</p>
<div class="codehilite"><pre><span></span><code>[jan@framey roc]$ ./target/release/roc ../project-euler-in-roc/2.roc
🔨 Rebuilding host...
4613732
[jan@framey roc]$
[jan@framey roc]$ exit
exit
[jan@framey roc]$
[jan@framey roc]$ cd ../project-euler-in-roc/
[jan@framey project-euler-in-roc]$
[jan@framey project-euler-in-roc]$ ../roc/target/release/roc 2.roc
🔨 Rebuilding host...
thread &#39;&lt;unnamed&gt;&#39; panicked at &#39;called `Result::unwrap()` on an `Err` value: Os { code: 2, kind: NotFound, message: &quot;No such file or directory&quot; }&#39;, crates/compiler/build/src/link.rs:360:22
note: run with `RUST_BACKTRACE=1` environment variable to display a backtrace
thread &#39;main&#39; panicked at &#39;called `Result::unwrap()` on an `Err` value: Any { .. }&#39;, crates/cli/src/build.rs:283:46
[jan@framey project-euler-in-roc]$
</code></pre></div>



<a name="290711425"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Am%20I%20doing%20something%20silly%3F/near/290711425" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jan kili <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Am.20I.20doing.20something.20silly.3F.html#290711425">(Jul 25 2022 at 01:58)</a>:</h4>
<p>Summary:</p>
<ul>
<li><code>cargo run myApp.roc</code> works inside <code>nix develop</code></li>
<li><code>cargo build --release</code> works inside <code>nix develop</code></li>
<li><code>target/release/roc myApp.roc</code> works inside <code>nix develop</code></li>
<li><code>target/release/roc myApp.roc</code> panics outside <code>nix develop</code></li>
</ul>



<a name="290711448"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Am%20I%20doing%20something%20silly%3F/near/290711448" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jan kili <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Am.20I.20doing.20something.20silly.3F.html#290711448">(Jul 25 2022 at 01:59)</a>:</h4>
<p>I thought builds were self-contained, but are they not?</p>



<a name="290713905"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Am%20I%20doing%20something%20silly%3F/near/290713905" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Am.20I.20doing.20something.20silly.3F.html#290713905">(Jul 25 2022 at 02:45)</a>:</h4>
<p>Your missing zig on your machine?</p>



<a name="290713920"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Am%20I%20doing%20something%20silly%3F/near/290713920" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Am.20I.20doing.20something.20silly.3F.html#290713920">(Jul 25 2022 at 02:45)</a>:</h4>
<p>*line 360 not 310, so clang</p>



<a name="290713936"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Am%20I%20doing%20something%20silly%3F/near/290713936" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Am.20I.20doing.20something.20silly.3F.html#290713936">(Jul 25 2022 at 02:45)</a>:</h4>
<p>You can't build the platform</p>



<a name="290713984"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Am%20I%20doing%20something%20silly%3F/near/290713984" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Am.20I.20doing.20something.20silly.3F.html#290713984">(Jul 25 2022 at 02:46)</a>:</h4>
<p>If you were to build in nix and then build outside of nix with <code>--precompiled-host=true</code>, it should work.</p>



<a name="290714086"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Am%20I%20doing%20something%20silly%3F/near/290714086" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Am.20I.20doing.20something.20silly.3F.html#290714086">(Jul 25 2022 at 02:48)</a>:</h4>
<p>We should improve those error messages</p>



<a name="290714139"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Am%20I%20doing%20something%20silly%3F/near/290714139" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jan kili <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Am.20I.20doing.20something.20silly.3F.html#290714139">(Jul 25 2022 at 02:50)</a>:</h4>
<p><span aria-label="check" class="emoji emoji-2705" role="img" title="check">:check:</span> Wow, that was fast.</p>
<div class="codehilite"><pre><span></span><code>[jan@framey project-euler-in-roc]$ ../roc/target/release/roc 2.roc --precompiled-host=true
4613732
[jan@framey project-euler-in-roc]$
</code></pre></div>



<a name="290714186"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Am%20I%20doing%20something%20silly%3F/near/290714186" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jan kili <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Am.20I.20doing.20something.20silly.3F.html#290714186">(Jul 25 2022 at 02:51)</a>:</h4>
<p>I didn't know about that flag, and I assumed a Roc build could compile platforms/hosts without any system dependencies!</p>



<a name="290714286"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Am%20I%20doing%20something%20silly%3F/near/290714286" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Am.20I.20doing.20something.20silly.3F.html#290714286">(Jul 25 2022 at 02:52)</a>:</h4>
<p>The host is still in another language, so that has all the dependencies that other language brings in. Long term, you should be able to just download the package as a precompiled host. Once that is the norm, all the host building shouldn't matter to anyone except platform authors.</p>



<a name="290714404"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Am%20I%20doing%20something%20silly%3F/near/290714404" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jan kili <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Am.20I.20doing.20something.20silly.3F.html#290714404">(Jul 25 2022 at 02:55)</a>:</h4>
<p>Nice! So right now, the <code>--precompiled-host=true</code> tells the Roc executable to look in the platform dir for a platform executable?</p>



<a name="290714489"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Am%20I%20doing%20something%20silly%3F/near/290714489" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jan kili <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Am.20I.20doing.20something.20silly.3F.html#290714489">(Jul 25 2022 at 02:56)</a>:</h4>
<p>Should the word "host" be replaced with "platform" in all app-developer-facing messaging?</p>



<a name="290714508"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Am%20I%20doing%20something%20silly%3F/near/290714508" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Am.20I.20doing.20something.20silly.3F.html#290714508">(Jul 25 2022 at 02:57)</a>:</h4>
<p>It basically says, trust me, the platform was already compiled and has not changed. Don't spawn the thread that compiles the platform. We will use the existing executable file.</p>



<a name="290714629"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Am%20I%20doing%20something%20silly%3F/near/290714629" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Am.20I.20doing.20something.20silly.3F.html#290714629">(Jul 25 2022 at 03:00)</a>:</h4>
<p>And probably to the <code>host</code> vs <code>platform</code> question. It is a terminology thing that has turned into them essentially being used interchangeably (though there is technically a difference). Platform is definitely the term I would expect an app author to see and use.</p>



<a name="290714714"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Am%20I%20doing%20something%20silly%3F/near/290714714" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jan kili <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Am.20I.20doing.20something.20silly.3F.html#290714714">(Jul 25 2022 at 03:00)</a>:</h4>
<p>Great! Thank you very much for these great explanations :)</p>



<a name="290714810"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Am%20I%20doing%20something%20silly%3F/near/290714810" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jan kili <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Am.20I.20doing.20something.20silly.3F.html#290714810">(Jul 25 2022 at 03:02)</a>:</h4>
<p>This will definitely become part of my workflow:</p>
<div class="codehilite"><pre><span></span><code>[jan@framey project-euler-in-roc]$ alias roc=&#39;../roc/target/release/roc --precompiled-ho
st=true&#39;
[jan@framey project-euler-in-roc]$ roc 2.roc
4613732
[jan@framey project-euler-in-roc]$
</code></pre></div>



<a name="290715041"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Am%20I%20doing%20something%20silly%3F/near/290715041" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jan kili <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Am.20I.20doing.20something.20silly.3F.html#290715041">(Jul 25 2022 at 03:08)</a>:</h4>
<p>Regarding <code>host</code> vs. <code>platform</code>: <a href="https://github.com/rtfeldman/roc/issues/3630">https://github.com/rtfeldman/roc/issues/3630</a></p>



<a name="290715200"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Am%20I%20doing%20something%20silly%3F/near/290715200" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jan kili <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Am.20I.20doing.20something.20silly.3F.html#290715200">(Jul 25 2022 at 03:12)</a>:</h4>
<p>Regarding panic/error messaging: <a href="https://github.com/rtfeldman/roc/issues/3631">https://github.com/rtfeldman/roc/issues/3631</a></p>



<a name="290717289"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Am%20I%20doing%20something%20silly%3F/near/290717289" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Carroll <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Am.20I.20doing.20something.20silly.3F.html#290717289">(Jul 25 2022 at 04:01)</a>:</h4>
<p>On terminology: The platform consists of a non-Roc "host" and a Roc API to interface to it.</p>



<a name="290717495"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Am%20I%20doing%20something%20silly%3F/near/290717495" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Carroll <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Am.20I.20doing.20something.20silly.3F.html#290717495">(Jul 25 2022 at 04:05)</a>:</h4>
<p>So the message is referring to technically the right thing, but using a term that isn't explained anywhere in the docs yet.</p>



<a name="290717674"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Am%20I%20doing%20something%20silly%3F/near/290717674" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Am.20I.20doing.20something.20silly.3F.html#290717674">(Jul 25 2022 at 04:10)</a>:</h4>
<p>Sure, but to a roc app author, they will only ever interact with platforms as a unit, never the host directly. So flags and error messages should generally be catered to that?</p>



<a name="290717678"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Am%20I%20doing%20something%20silly%3F/near/290717678" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Am.20I.20doing.20something.20silly.3F.html#290717678">(Jul 25 2022 at 04:10)</a>:</h4>
<p>At least that is my thought</p>



<a name="290717775"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Am%20I%20doing%20something%20silly%3F/near/290717775" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Carroll <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Am.20I.20doing.20something.20silly.3F.html#290717775">(Jul 25 2022 at 04:13)</a>:</h4>
<p>I wasn't disagreeing, just explaining to anyone following who didn't know.</p>



<a name="290717831"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Am%20I%20doing%20something%20silly%3F/near/290717831" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jan kili <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Am.20I.20doing.20something.20silly.3F.html#290717831">(Jul 25 2022 at 04:14)</a>:</h4>
<p>Nice, does that API include only <code>.roc</code> files?</p>



<a name="290718001"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Am%20I%20doing%20something%20silly%3F/near/290718001" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Carroll <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Am.20I.20doing.20something.20silly.3F.html#290718001">(Jul 25 2022 at 04:19)</a>:</h4>
<p>Yes</p>



<a name="302379431"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Am%20I%20doing%20something%20silly%3F/near/302379431" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jan kili <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Am.20I.20doing.20something.20silly.3F.html#302379431">(Oct 05 2022 at 02:59)</a>:</h4>
<p>How do I bool?</p>
<div class="codehilite"><pre><span></span><code>        |&gt; List.map (\sum -&gt;
            when sum * 2 &gt; rowCount is
                Bool.true -&gt; 1
                _ -&gt; 0)
</code></pre></div>
<div class="codehilite"><pre><span></span><code>── SYNTAX PROBLEM ──────────────────────────────────────── day_3_solutions.roc ─

This pattern is malformed:

37│                  Bool.true -&gt; 1
                     ^^^^^^^^^
</code></pre></div>



<a name="302379861"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Am%20I%20doing%20something%20silly%3F/near/302379861" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jan kili <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Am.20I.20doing.20something.20silly.3F.html#302379861">(Oct 05 2022 at 03:06)</a>:</h4>
<p>It works as an <code>if ... then ... else ...</code> expression but not a <code>when ... is ...</code> expression</p>



<a name="302379868"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Am%20I%20doing%20something%20silly%3F/near/302379868" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jan kili <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Am.20I.20doing.20something.20silly.3F.html#302379868">(Oct 05 2022 at 03:06)</a>:</h4>
<p>I'll just switch it to if/else</p>



<a name="302379892"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Am%20I%20doing%20something%20silly%3F/near/302379892" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jan kili <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Am.20I.20doing.20something.20silly.3F.html#302379892">(Oct 05 2022 at 03:07)</a>:</h4>
<p>Dang functional programming... making me forget about good old-fashioned <code>if</code>/<code>else</code>... <span aria-label="angry cat" class="emoji emoji-1f63e" role="img" title="angry cat">:angry_cat:</span> <span aria-label="laughing" class="emoji emoji-1f606" role="img" title="laughing">:laughing:</span></p>



<a name="302380478"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Am%20I%20doing%20something%20silly%3F/near/302380478" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Am.20I.20doing.20something.20silly.3F.html#302380478">(Oct 05 2022 at 03:17)</a>:</h4>
<p>oh yeah, this is supposed to work exactly the way you tried to write it - it just hasn't been implemened yet <span aria-label="sweat smile" class="emoji emoji-1f605" role="img" title="sweat smile">:sweat_smile:</span></p>



<a name="302380580"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Am%20I%20doing%20something%20silly%3F/near/302380580" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Am.20I.20doing.20something.20silly.3F.html#302380580">(Oct 05 2022 at 03:18)</a>:</h4>
<p><code>Foo.bar -&gt; ...</code> should desugar to essentially <code>x if x == Foo.bar -&gt; ...</code></p>



<a name="302380603"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Am%20I%20doing%20something%20silly%3F/near/302380603" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Am.20I.20doing.20something.20silly.3F.html#302380603">(Oct 05 2022 at 03:19)</a>:</h4>
<p>which you can always write by hand, but yes - in the case of booleans specifically, might as well use <code>if</code>! <span aria-label="big smile" class="emoji emoji-1f604" role="img" title="big smile">:big_smile:</span></p>



<a name="302380614"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Am%20I%20doing%20something%20silly%3F/near/302380614" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jan kili <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Am.20I.20doing.20something.20silly.3F.html#302380614">(Oct 05 2022 at 03:19)</a>:</h4>
<p>Any hope for <code>[a, b, c] -&gt; ...</code>? <span aria-label="fingers crossed" class="emoji emoji-1f91e" role="img" title="fingers crossed">:fingers_crossed:</span> <span aria-label="present" class="emoji emoji-1f381" role="img" title="present">:present:</span> <span aria-label="santa" class="emoji emoji-1f385" role="img" title="santa">:santa:</span></p>



<a name="302380730"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Am%20I%20doing%20something%20silly%3F/near/302380730" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jan kili <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Am.20I.20doing.20something.20silly.3F.html#302380730">(Oct 05 2022 at 03:20)</a>:</h4>
<p>Maybe tuples will alleviate that need</p>



<a name="302380903"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Am%20I%20doing%20something%20silly%3F/near/302380903" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Am.20I.20doing.20something.20silly.3F.html#302380903">(Oct 05 2022 at 03:23)</a>:</h4>
<p>yeah there was some discussion on Zulip about that awhile back</p>



<a name="302380965"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Am%20I%20doing%20something%20silly%3F/near/302380965" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Am.20I.20doing.20something.20silly.3F.html#302380965">(Oct 05 2022 at 03:24)</a>:</h4>
<p>I think some form of it will turn out to be a good idea!</p>



<a name="303173153"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Am%20I%20doing%20something%20silly%3F/near/303173153" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Duncan <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Am.20I.20doing.20something.20silly.3F.html#303173153">(Oct 09 2022 at 21:27)</a>:</h4>
<p><span class="user-mention" data-user-id="462053">@JanCVanB</span>: In <a href="#narrow/stream/347488-roctoberfest/topic/Day.201/near/303093990">this topic</a>, they show how to pattern match in the way you were looking for.</p>



<hr><p>Last updated: Mar 01 2026 at 12:20 UTC</p>
</html>