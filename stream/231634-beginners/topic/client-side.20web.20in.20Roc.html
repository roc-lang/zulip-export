<html>
<head><meta charset="utf-8"><title>client-side web in Roc · beginners · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/index.html">beginners</a></h2>
<h3>Topic: <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/client-side.20web.20in.20Roc.html">client-side web in Roc</a></h3>

<hr>

<base href="https://roc.zulipchat.com">

<head><link href="https://roc-lang.github.io/zulip-export/style.css" rel="stylesheet"></head>

<a name="484177872"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/client-side%20web%20in%20Roc/near/484177872" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Antonin Komenda <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/client-side.20web.20in.20Roc.html#484177872">(Nov 24 2024 at 20:28)</a>:</h4>
<p>Are there some ambitions (or maybe even examples) to allow writing single page web apps in Roc? I suppose since it aims at the low-level platforms, this would require compiling to WASM and some JS-based interop to manipulate the DOM.</p>



<a name="484179184"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/client-side%20web%20in%20Roc/near/484179184" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/client-side.20web.20in.20Roc.html#484179184">(Nov 24 2024 at 20:50)</a>:</h4>
<p>There is an example WIP virtual dom implementation at <a href="https://github.com/roc-lang/roc/tree/main/examples/virtual-dom-wip"><code>examples/virtual-dom-wip</code> but</a> that <span class="user-mention" data-user-id="431893">@Brian Carroll</span> was working on. That work was blocked due to some type analysis issues in the compiler. Roc has evolved a lot since then, and maybe this project could continue now I'm not sure. </p>
<p>I think it would definitely be feasible to do client side SPAs using roc.</p>



<a name="484242773"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/client-side%20web%20in%20Roc/near/484242773" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Antonin Komenda <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/client-side.20web.20in.20Roc.html#484242773">(Nov 25 2024 at 09:09)</a>:</h4>
<p>Perfect! Thanks, I'll take a look at that and prospectively help.</p>



<a name="484242809"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/client-side%20web%20in%20Roc/near/484242809" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Notification Bot <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/client-side.20web.20in.20Roc.html#484242809">(Nov 25 2024 at 09:09)</a>:</h4>
<p><span class="user-mention silent" data-user-id="782019">Antonin Komenda</span> has marked this topic as resolved.</p>



<a name="484363415"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/client-side%20web%20in%20Roc/near/484363415" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Notification Bot <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/client-side.20web.20in.20Roc.html#484363415">(Nov 25 2024 at 18:13)</a>:</h4>
<p><span class="user-mention silent" data-user-id="782019">Antonin Komenda</span> has marked this topic as unresolved.</p>



<a name="484363421"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/client-side%20web%20in%20Roc/near/484363421" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Antonin Komenda <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/client-side.20web.20in.20Roc.html#484363421">(Nov 25 2024 at 18:13)</a>:</h4>
<p>I've tried to compile <a href="https://github.com/lukewilliamboswell/roc-experiment-js-dom">https://github.com/lukewilliamboswell/roc-experiment-js-dom</a>. The example with writing to the console works nicely. The inner_html example, however, throws a pretty cryptic error during compilation:</p>
<div class="codehilite"><pre><span></span><code>$ RUST_BACKTRACE=full roc build --target wasm32 --no-link --output app.o examples/inner_html.roc
thread &#39;main&#39; panicked at crates/compiler/gen_llvm/src/llvm/build.rs:5748:19:
Error in alias analysis: error in module ModName(&quot;UserApp&quot;), function definition FuncName(&quot;\x11\x00\x00\x00\x00\x00\x00\x80\\\x85\xd0w0\xa31\x8e&quot;), definition of value binding ValueId(16): expected type &#39;union { (((), (heap_cell,)),), ((),) }&#39;, found type &#39;()&#39;
stack backtrace:
   0:     0x57c016b90c2b - &lt;unknown&gt;
   1:     0x57c015e13980 - &lt;unknown&gt;
   2:     0x57c016b8c493 - &lt;unknown&gt;
   3:     0x57c016b909c4 - &lt;unknown&gt;
   4:     0x57c016b92520 - &lt;unknown&gt;
   5:     0x57c016b9223f - &lt;unknown&gt;
   6:     0x57c016b92a3e - &lt;unknown&gt;
   7:     0x57c016b92942 - &lt;unknown&gt;
   8:     0x57c016b91126 - &lt;unknown&gt;
   9:     0x57c016b926a4 - &lt;unknown&gt;
  10:     0x57c015d08e75 - &lt;unknown&gt;
  11:     0x57c016370646 - &lt;unknown&gt;
  12:     0x57c01636a438 - &lt;unknown&gt;
  13:     0x57c01601bffd - &lt;unknown&gt;
  14:     0x57c01601fddf - &lt;unknown&gt;
  15:     0x57c01601ef85 - &lt;unknown&gt;
  16:     0x57c016143952 - &lt;unknown&gt;
  17:     0x57c015fe3769 - &lt;unknown&gt;
  18:     0x57c015fd6073 - &lt;unknown&gt;
  19:     0x57c015fd6093 - &lt;unknown&gt;
  20:     0x57c016b821aa - &lt;unknown&gt;
  21:     0x57c015fe99a5 - &lt;unknown&gt;
  22:     0x70e672e34e08 - &lt;unknown&gt;
  23:     0x70e672e34ecc - __libc_start_main
  24:     0x57c015da6e6e - &lt;unknown&gt;
  25:                0x0 - &lt;unknown&gt;
</code></pre></div>



<a name="484376222"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/client-side%20web%20in%20Roc/near/484376222" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/client-side.20web.20in.20Roc.html#484376222">(Nov 25 2024 at 19:35)</a>:</h4>
<p>Are you using the latest nightly?</p>



<a name="484381873"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/client-side%20web%20in%20Roc/near/484381873" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/client-side.20web.20in.20Roc.html#484381873">(Nov 25 2024 at 20:12)</a>:</h4>
<p>I suspect that's the issue Sam recently fixed with try. Otherwise I may have pushed it in a broken state. I can check later.</p>



<a name="484463489"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/client-side%20web%20in%20Roc/near/484463489" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Antonin Komenda <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/client-side.20web.20in.20Roc.html#484463489">(Nov 26 2024 at 09:06)</a>:</h4>
<p>Hmm, I thought that yes, but maybe not:</p>
<div class="codehilite"><pre><span></span><code>$ yay -S roc-nightly-bin
[...]
loading packages...
resolving dependencies...
looking for conflicting packages...

Package (2)            Old Version  New Version  Net Change

roc-nightly-bin        20241120-6   20241126-6     0,00 MiB
roc-nightly-bin-debug  20241120-6   20241126-6     0,00 MiB

Total Installed Size:  93,29 MiB
Net Upgrade Size:       0,00 MiB

:: Proceed with installation? [Y/n]
(2/2) checking keys in keyring                                                                                                                [---------------------------------------------------------------------------------------] 100%
(2/2) checking package integrity                                                                                                              [---------------------------------------------------------------------------------------] 100%
(2/2) loading package files                                                                                                                   [---------------------------------------------------------------------------------------] 100%
(2/2) checking for file conflicts                                                                                                             [---------------------------------------------------------------------------------------] 100%
:: Processing package changes...
(1/2) upgrading roc-nightly-bin                                                                                                               [---------------------------------------------------------------------------------------] 100%
(2/2) upgrading roc-nightly-bin-debug                                                                                                         [---------------------------------------------------------------------------------------] 100%
:: Running post-transaction hooks...
(1/3) Arming ConditionNeedsUpdate...
(2/3) Refreshing PackageKit...
(3/3) Checking which packages need to be rebuilt
$ roc version
roc nightly pre-release, built from commit 8dbc909 on Fr 15 Nov 2024 09:02:07 UTC
</code></pre></div>



<a name="484468406"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/client-side%20web%20in%20Roc/near/484468406" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anton <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/client-side.20web.20in.20Roc.html#484468406">(Nov 26 2024 at 09:32)</a>:</h4>
<p>There has been a breaking change so nightlies will be on hold for a couple more days until everything is updated but you can download a TESTING release from the <a href="https://github.com/roc-lang/roc/releases">assets here</a> to get the latest updates.</p>



<a name="484599010"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/client-side%20web%20in%20Roc/near/484599010" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Antonin Komenda <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/client-side.20web.20in.20Roc.html#484599010">(Nov 26 2024 at 21:25)</a>:</h4>
<p>With the TESTING release the <code>inner_html</code> example works nicely!<br>
<a href="/user_uploads/22008/gz-RgwdJsmQ2X8ztACNKOI7h/image.png">image.png</a><br>
Thanks <span aria-label="ok" class="emoji emoji-1f44c" role="img" title="ok">:ok:</span></p>
<div class="message_inline_image"><a href="/user_uploads/22008/gz-RgwdJsmQ2X8ztACNKOI7h/image.png" title="image.png"><img data-original-dimensions="798x637" src="/user_uploads/thumbnail/22008/gz-RgwdJsmQ2X8ztACNKOI7h/image.png/840x560.webp"></a></div>



<a name="484698508"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/client-side%20web%20in%20Roc/near/484698508" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Antonin Komenda <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/client-side.20web.20in.20Roc.html#484698508">(Nov 27 2024 at 11:29)</a>:</h4>
<p>A related question, how to debug a platform. I am also playing with the <code>roc-htmx-playground</code> (I am still deciding whether to go elm+roc, htmx+roc or WASM+roc)... and I am getting:</p>
<div class="codehilite"><pre><span></span><code>$ DB_PATH=test.db roc run --linker=legacy src/main.roc
Listening on &lt;http://127.0.0.1:8000&gt;
2024-11-27T11:24:25Z Get /
2024-11-27T11:24:25Z Get /bootstrap.min.css
2024-11-27T11:24:25Z Get /styles.css
2024-11-27T11:24:25Z Get /bootstrap.bundle.min.js
2024-11-27T11:24:25Z Get /htmx.min.js
2024-11-27T11:24:25Z Get /site.js
2024-11-27T11:24:27Z Get /treeview
2024-11-27T11:24:27Z Get /bigTask
2024-11-27T11:24:29Z Get /bigTask?page=2&amp;items=25
2024-11-27T11:24:31Z Get /bigTask?page=3&amp;items=25
2024-11-27T11:24:33Z Get /bigTask?page=4&amp;items=25
2024-11-27T11:24:34Z Get /bigTask?page=2&amp;items=25
malloc(): unaligned tcache chunk detected
</code></pre></div>
<p>I've updated the playground to current Roc (I've tested the TESTING version as well, but the problem is still there): <a href="https://github.com/lukewilliamboswell/roc-htmx-playground/pull/9">https://github.com/lukewilliamboswell/roc-htmx-playground/pull/9</a></p>
<p>I also debugged it to the platform (the Roc part of the playground works fine)... But in the platform I would appreciate some help how to efficiently debug such thing in Rust. Maybe priting all malloc()s... or <code>strace</code> or something  similar?</p>



<a name="484752723"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/client-side%20web%20in%20Roc/near/484752723" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/client-side.20web.20in.20Roc.html#484752723">(Nov 27 2024 at 16:00)</a>:</h4>
<p>Can you run it with Valgrind? That may help.</p>



<a name="484879001"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/client-side%20web%20in%20Roc/near/484879001" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Antonin Komenda <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/client-side.20web.20in.20Roc.html#484879001">(Nov 28 2024 at 09:48)</a>:</h4>
<p>I was not able to crash it, but I found these:</p>
<div class="codehilite"><pre><span></span><code>$ DB_PATH=test.db valgrind src/main
==3385473== Memcheck, a memory error detector
==3385473== Copyright (C) 2002-2024, and GNU GPL&#39;d, by Julian Seward et al.
==3385473== Using Valgrind-3.24.0 and LibVEX; rerun with -h for copyright info
==3385473== Command: src/main
==3385473==
==3385473== posix_memalign() invalid size value: 0
==3385473==    at 0x484CA38: posix_memalign (vg_replace_malloc.c:2226)
==3385473==    by 0x273990: rust_main (in /home/gree/workspace/roc-htmx-playground/src/main)
==3385473==    by 0x48D5E07: (below main) (libc_start_call_main.h:58)
==3385473==
Listening on &lt;http://127.0.0.1:8000&gt;
2024-11-28T09:40:05Z Get /
2024-11-28T09:40:06Z Get /bootstrap.min.css
2024-11-28T09:40:06Z Get /bootstrap.bundle.min.js
2024-11-28T09:40:06Z Get /styles.css
2024-11-28T09:40:06Z Get /htmx.min.js
2024-11-28T09:40:06Z Get /site.js
2024-11-28T09:40:06Z Get /favicon.ico
404 NotFound /favicon.ico
2024-11-28T09:40:07Z Get /bigTask
2024-11-28T09:40:10Z Get /bigTask?page=2&amp;items=25
==3385473== Thread 20 tokio-runtime-w:
==3385473== Invalid read of size 8
==3385473==    at 0x222789: decrement_refcounted_ptr_8 (roc_app:0)
==3385473==    by 0x22277D: ??? (roc_app:0)
==3385473==    by 0x229287: ??? (roc_app:0)
==3385473==    by 0x1C0D18: Task_53_b7f067e6f5939fbe06dd68ed4b36fad898cbfd8ef8d993964d5cd10b12ac3ec (roc_app:0)
==3385473==    by 0x1ECAD1: Task_96_38ac12d038fd8df52070eb8edb3aab96b2fa7b50fc7a9367255428634fa0264e (roc_app:0)
==3385473==    by 0x218289: Task_46_5e6d2773e4caec97557de41edef7addcc8c8bc472f779d224a7d61166dbaabe (roc_app:0)
==3385473==    by 0x1E7D02: _158_3fe74881edf546beefa6734056b1899c37505b1c34fcce49bbd7b44b157595 (roc_app:0)
==3385473==    by 0x22C6CD: roc__forHost_2_caller (in /home/gree/workspace/roc-htmx-playground/src/main)
==3385473==    by 0x29A7ED: tokio::runtime::task::raw::poll (in /home/gree/workspace/roc-htmx-playground/src/main)
==3385473==    by 0x2E762D: std::sys_common::backtrace::__rust_begin_short_backtrace (in /home/gree/workspace/roc-htmx-playground/src/main)
==3385473==    by 0x2E736E: core::ops::function::FnOnce::call_once{{vtable.shim}} (in /home/gree/workspace/roc-htmx-playground/src/main)
==3385473==    by 0x2E3ADA: call_once&lt;(), dyn core::ops::function::FnOnce&lt;(), Output=()&gt;, alloc::alloc::Global&gt; (boxed.rs:2022)
==3385473==    by 0x2E3ADA: call_once&lt;(), alloc::boxed::Box&lt;dyn core::ops::function::FnOnce&lt;(), Output=()&gt;, alloc::alloc::Global&gt;, alloc::alloc::Global&gt; (boxed.rs:2022)
==3385473==    by 0x2E3ADA: std::sys::pal::unix::thread::Thread::new::thread_start (thread.rs:108)
==3385473==  Address 0x77720a0 is 0 bytes inside a block of size 32 free&#39;d
==3385473==    at 0x48478EF: free (vg_replace_malloc.c:989)
==3385473==    by 0x2227CA: decrement_refcounted_ptr_8 (roc_app:0)
==3385473==    by 0x22277D: ??? (roc_app:0)
==3385473==    by 0x1A20BA: Controllers.BigTask_15_36cf1b423d96d0d1f556ed298e83394497cd597c20b08eba5512c2685cd67751 (in /home/gree/workspace/roc-htmx-playground/src/main)
==3385473==    by 0x1C46BD: Task_46_c436285c5b59d7df49ab96ad8476bdb7c10421fe2225ff48721cb48682ff451 (roc_app:0)
==3385473==    by 0x1CCDFE: Task_46_28ea24f1682fb667c3fb23a9dbc02f29e624f88b5aca38a345144704a3139a (roc_app:0)
==3385473==    by 0x1FF9B2: Task_46_ee6d8d949dc3617ea48fd44bd0c8f21be51d3676b1b3bdfdfcf8f559e4e0272f (roc_app:0)
==3385473==    by 0x222172: Task_46_1f3cd98ac177094c9632f9c81aa71556d2feacfd911d3d139427ec94325c8 (roc_app:0)
==3385473==    by 0x1C0D04: Task_53_b7f067e6f5939fbe06dd68ed4b36fad898cbfd8ef8d993964d5cd10b12ac3ec (roc_app:0)
==3385473==    by 0x1ECAD1: Task_96_38ac12d038fd8df52070eb8edb3aab96b2fa7b50fc7a9367255428634fa0264e (roc_app:0)
==3385473==    by 0x218289: Task_46_5e6d2773e4caec97557de41edef7addcc8c8bc472f779d224a7d61166dbaabe (roc_app:0)
==3385473==    by 0x1E7D02: _158_3fe74881edf546beefa6734056b1899c37505b1c34fcce49bbd7b44b157595 (roc_app:0)
==3385473==  Block was alloc&#39;d at
==3385473==    at 0x48447A8: malloc (vg_replace_malloc.c:446)
==3385473==    by 0x2B074D: &lt;roc_std::roc_str::RocStr as core::convert::From&lt;&amp;str&gt;&gt;::from (in /home/gree/workspace/roc-htmx-playground/src/main)
==3385473==    by 0x29A5CA: tokio::runtime::task::raw::poll (in /home/gree/workspace/roc-htmx-playground/src/main)
==3385473==    by 0x2E762D: std::sys_common::backtrace::__rust_begin_short_backtrace (in /home/gree/workspace/roc-htmx-playground/src/main)
==3385473==    by 0x2E736E: core::ops::function::FnOnce::call_once{{vtable.shim}} (in /home/gree/workspace/roc-htmx-playground/src/main)
==3385473==    by 0x2E3ADA: call_once&lt;(), dyn core::ops::function::FnOnce&lt;(), Output=()&gt;, alloc::alloc::Global&gt; (boxed.rs:2022)
==3385473==    by 0x2E3ADA: call_once&lt;(), alloc::boxed::Box&lt;dyn core::ops::function::FnOnce&lt;(), Output=()&gt;, alloc::alloc::Global&gt;, alloc::alloc::Global&gt; (boxed.rs:2022)
==3385473==    by 0x2E3ADA: std::sys::pal::unix::thread::Thread::new::thread_start (thread.rs:108)
==3385473==    by 0x494439C: start_thread (pthread_create.c:447)
==3385473==    by 0x49C92A3: clone (clone.S:100)
==3385473==
==3385473== Invalid write of size 8
==3385473==    at 0x2227AA: decrement_refcounted_ptr_8 (roc_app:0)
==3385473==    by 0x22277D: ??? (roc_app:0)
==3385473==    by 0x229287: ??? (roc_app:0)
==3385473==    by 0x1C0D18: Task_53_b7f067e6f5939fbe06dd68ed4b36fad898cbfd8ef8d993964d5cd10b12ac3ec (roc_app:0)
==3385473==    by 0x1ECAD1: Task_96_38ac12d038fd8df52070eb8edb3aab96b2fa7b50fc7a9367255428634fa0264e (roc_app:0)
==3385473==    by 0x218289: Task_46_5e6d2773e4caec97557de41edef7addcc8c8bc472f779d224a7d61166dbaabe (roc_app:0)
==3385473==    by 0x1E7D02: _158_3fe74881edf546beefa6734056b1899c37505b1c34fcce49bbd7b44b157595 (roc_app:0)
==3385473==    by 0x22C6CD: roc__forHost_2_caller (in /home/gree/workspace/roc-htmx-playground/src/main)
==3385473==    by 0x29A7ED: tokio::runtime::task::raw::poll (in /home/gree/workspace/roc-htmx-playground/src/main)
==3385473==    by 0x2E762D: std::sys_common::backtrace::__rust_begin_short_backtrace (in /home/gree/workspace/roc-htmx-playground/src/main)
==3385473==    by 0x2E736E: core::ops::function::FnOnce::call_once{{vtable.shim}} (in /home/gree/workspace/roc-htmx-playground/src/main)
==3385473==    by 0x2E3ADA: call_once&lt;(), dyn core::ops::function::FnOnce&lt;(), Output=()&gt;, alloc::alloc::Global&gt; (boxed.rs:2022)
==3385473==    by 0x2E3ADA: call_once&lt;(), alloc::boxed::Box&lt;dyn core::ops::function::FnOnce&lt;(), Output=()&gt;, alloc::alloc::Global&gt;, alloc::alloc::Global&gt; (boxed.rs:2022)
==3385473==    by 0x2E3ADA: std::sys::pal::unix::thread::Thread::new::thread_start (thread.rs:108)
==3385473==  Address 0x77720a0 is 0 bytes inside a block of size 32 free&#39;d
==3385473==    at 0x48478EF: free (vg_replace_malloc.c:989)
==3385473==    by 0x2227CA: decrement_refcounted_ptr_8 (roc_app:0)
==3385473==    by 0x22277D: ??? (roc_app:0)
==3385473==    by 0x1A20BA: Controllers.BigTask_15_36cf1b423d96d0d1f556ed298e83394497cd597c20b08eba5512c2685cd67751 (in /home/gree/workspace/roc-htmx-playground/src/main)
==3385473==    by 0x1C46BD: Task_46_c436285c5b59d7df49ab96ad8476bdb7c10421fe2225ff48721cb48682ff451 (roc_app:0)
==3385473==    by 0x1CCDFE: Task_46_28ea24f1682fb667c3fb23a9dbc02f29e624f88b5aca38a345144704a3139a (roc_app:0)
==3385473==    by 0x1FF9B2: Task_46_ee6d8d949dc3617ea48fd44bd0c8f21be51d3676b1b3bdfdfcf8f559e4e0272f (roc_app:0)
==3385473==    by 0x222172: Task_46_1f3cd98ac177094c9632f9c81aa71556d2feacfd911d3d139427ec94325c8 (roc_app:0)
==3385473==    by 0x1C0D04: Task_53_b7f067e6f5939fbe06dd68ed4b36fad898cbfd8ef8d993964d5cd10b12ac3ec (roc_app:0)
==3385473==    by 0x1ECAD1: Task_96_38ac12d038fd8df52070eb8edb3aab96b2fa7b50fc7a9367255428634fa0264e (roc_app:0)
==3385473==    by 0x218289: Task_46_5e6d2773e4caec97557de41edef7addcc8c8bc472f779d224a7d61166dbaabe (roc_app:0)
==3385473==    by 0x1E7D02: _158_3fe74881edf546beefa6734056b1899c37505b1c34fcce49bbd7b44b157595 (roc_app:0)
==3385473==  Block was alloc&#39;d at
==3385473==    at 0x48447A8: malloc (vg_replace_malloc.c:446)
==3385473==    by 0x2B074D: &lt;roc_std::roc_str::RocStr as core::convert::From&lt;&amp;str&gt;&gt;::from (in /home/gree/workspace/roc-htmx-playground/src/main)
==3385473==    by 0x29A5CA: tokio::runtime::task::raw::poll (in /home/gree/workspace/roc-htmx-playground/src/main)
==3385473==    by 0x2E762D: std::sys_common::backtrace::__rust_begin_short_backtrace (in /home/gree/workspace/roc-htmx-playground/src/main)
==3385473==    by 0x2E736E: core::ops::function::FnOnce::call_once{{vtable.shim}} (in /home/gree/workspace/roc-htmx-playground/src/main)
==3385473==    by 0x2E3ADA: call_once&lt;(), dyn core::ops::function::FnOnce&lt;(), Output=()&gt;, alloc::alloc::Global&gt; (boxed.rs:2022)
==3385473==    by 0x2E3ADA: call_once&lt;(), alloc::boxed::Box&lt;dyn core::ops::function::FnOnce&lt;(), Output=()&gt;, alloc::alloc::Global&gt;, alloc::alloc::Global&gt; (boxed.rs:2022)
==3385473==    by 0x2E3ADA: std::sys::pal::unix::thread::Thread::new::thread_start (thread.rs:108)
==3385473==    by 0x494439C: start_thread (pthread_create.c:447)
==3385473==    by 0x49C92A3: clone (clone.S:100)
==3385473==
</code></pre></div>
<p>Looks like a premature <code>free()</code>?</p>



<a name="484900748"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/client-side%20web%20in%20Roc/near/484900748" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anton <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/client-side.20web.20in.20Roc.html#484900748">(Nov 28 2024 at 11:36)</a>:</h4>
<p>Could you make an issue for this (with the valgrind output) <span class="user-mention" data-user-id="782019">@Antonin Komenda</span>?</p>



<a name="484900988"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/client-side%20web%20in%20Roc/near/484900988" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Antonin Komenda <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/client-side.20web.20in.20Roc.html#484900988">(Nov 28 2024 at 11:37)</a>:</h4>
<p>Sure, and is it problem of the basic-webserver platform or Roc?</p>



<a name="484901297"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/client-side%20web%20in%20Roc/near/484901297" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anton <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/client-side.20web.20in.20Roc.html#484901297">(Nov 28 2024 at 11:38)</a>:</h4>
<p>I've never seen the <code>posix_memalign</code> on Roc, let's put it on basic-webserver for now</p>



<a name="484901928"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/client-side%20web%20in%20Roc/near/484901928" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/client-side.20web.20in.20Roc.html#484901928">(Nov 28 2024 at 11:42)</a>:</h4>
<p>I have my suspicions... we might fix it in the upgrade to purity inference by coincidence. Also I think were using glue that probably needs to be updated/rolled by hand. </p>
<p>It'd be nice to find the issues and resolve them with basic-cli though. So I've held off launching into that upgrade.</p>



<a name="484949218"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/client-side%20web%20in%20Roc/near/484949218" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/client-side.20web.20in.20Roc.html#484949218">(Nov 28 2024 at 15:52)</a>:</h4>
<p>Yeah, this suggests that we are allocating something with the wrong size. Allocate something with no size, attempt to read a refcount from it (invalid read cause didn't allocate space for a recount), attempt to write refcount to it (invalid write).</p>



<a name="484949472"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/client-side%20web%20in%20Roc/near/484949472" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/client-side.20web.20in.20Roc.html#484949472">(Nov 28 2024 at 15:54)</a>:</h4>
<p>Also, posix_memalign is just fancy aligned malloc</p>



<a name="484949586"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/client-side%20web%20in%20Roc/near/484949586" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/client-side.20web.20in.20Roc.html#484949586">(Nov 28 2024 at 15:54)</a>:</h4>
<p>My first guess is allocating a <code>Box {}</code> is not adding on the refcount.</p>



<a name="484951689"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/client-side%20web%20in%20Roc/near/484951689" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/client-side.20web.20in.20Roc.html#484951689">(Nov 28 2024 at 16:06)</a>:</h4>
<p>If we run Valgrind in a debug build of the platform and make sure to use the legacy linker, should pinpoint a lot more</p>



<a name="484952756"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/client-side%20web%20in%20Roc/near/484952756" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Antonin Komenda <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/client-side.20web.20in.20Roc.html#484952756">(Nov 28 2024 at 16:13)</a>:</h4>
<p>How to do an appropriate debug build? I've tried <code>roc build --profiling --linker=legacy src/main.roc</code>, but the Valgrind output looks the same.</p>



<a name="484955022"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/client-side%20web%20in%20Roc/near/484955022" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anton <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/client-side.20web.20in.20Roc.html#484955022">(Nov 28 2024 at 16:27)</a>:</h4>
<p>Looks like roc-htmx-playground is using an <a href="https://github.com/lukewilliamboswell/roc-htmx-playground/blob/ac05d427bbafc499035e90fb401cd354c05975da/src/main.roc#L2C5-L2C138">old version of basic-webserver</a>. I recommend trying to upgrade that to the latest main of basic-webserver (in combination with roc TESTING), to do a local platform import use <code>{ pf: platform "path-to-basic-ws/platform/main.roc" }</code>.</p>



<a name="484955182"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/client-side%20web%20in%20Roc/near/484955182" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anton <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/client-side.20web.20in.20Roc.html#484955182">(Nov 28 2024 at 16:28)</a>:</h4>
<p>As build command you'll want to use:</p>
<div class="codehilite"><pre><span></span><code>roc --build-host --suppress-build-host-warning  build --linker=legacy src/main.roc
</code></pre></div>



<a name="484955343"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/client-side%20web%20in%20Roc/near/484955343" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Antonin Komenda <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/client-side.20web.20in.20Roc.html#484955343">(Nov 28 2024 at 16:29)</a>:</h4>
<p>I've already ported the roc-htmx-playground to new Roc and platform: <a href="https://github.com/lukewilliamboswell/roc-htmx-playground/pull/9">https://github.com/lukewilliamboswell/roc-htmx-playground/pull/9</a></p>



<a name="484956883"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/client-side%20web%20in%20Roc/near/484956883" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anton <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/client-side.20web.20in.20Roc.html#484956883">(Nov 28 2024 at 16:39)</a>:</h4>
<p>In that case, I recommend using a local version of basic-webserver 0.9.0. So:</p>
<div class="codehilite"><pre><span></span><code>git clone https://github.com/roc-lang/basic-webserver.git
cd basic-webserver
</code></pre></div>
<p>In that folder modify <code>build.roc</code> by removing <code>--release</code> <a href="https://github.com/roc-lang/basic-webserver/blob/dee0bfcda04ba51076a1e99a57243b37792f5a55/build.roc#L103">here</a>.</p>
<p>Then:</p>
<div class="codehilite"><pre><span></span><code># use latest nightly roc, not TESTING
roc build.roc
</code></pre></div>
<p>Then you'll want to use that built platform by modifying <a href="https://github.com/lukewilliamboswell/roc-htmx-playground/blob/cfb452f792fc2ce68343557da64ed4505fb11c49/src/main.roc#L2">this url</a> to a path; like <code>{ pf: platform "some_path/basic-webserver/platform/main.roc" }</code>.</p>
<p>that should hopefully improve your valgrind output</p>



<a name="484973401"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/client-side%20web%20in%20Roc/near/484973401" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/client-side.20web.20in.20Roc.html#484973401">(Nov 28 2024 at 18:54)</a>:</h4>
<p>Do we need to pass a flag with roc build.roc to get a debug build of the platform? Worth checking it's not building a release build by default.</p>



<a name="484973736"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/client-side%20web%20in%20Roc/near/484973736" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anton <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/client-side.20web.20in.20Roc.html#484973736">(Nov 28 2024 at 18:58)</a>:</h4>
<p>It is building a release build by default which is why I said:</p>
<blockquote>
<p>In that folder modify <code>build.roc</code> by removing <code>--release</code> <a href="https://github.com/roc-lang/basic-webserver/blob/dee0bfcda04ba51076a1e99a57243b37792f5a55/build.roc#L103">here</a>.</p>
</blockquote>
<p>Can you clarify if you mean something else?</p>



<a name="484973806"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/client-side%20web%20in%20Roc/near/484973806" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anton <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/client-side.20web.20in.20Roc.html#484973806">(Nov 28 2024 at 18:59)</a>:</h4>
<blockquote>
<p>Do we need to pass a flag with roc build.roc</p>
</blockquote>
<p>That flag got removed, perhaps because it did not work without --release at the time</p>



<a name="484973809"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/client-side%20web%20in%20Roc/near/484973809" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/client-side.20web.20in.20Roc.html#484973809">(Nov 28 2024 at 18:59)</a>:</h4>
<p>Nw, i missed that you said that.</p>



<a name="484973977"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/client-side%20web%20in%20Roc/near/484973977" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anton <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/client-side.20web.20in.20Roc.html#484973977">(Nov 28 2024 at 19:00)</a>:</h4>
<p>Should optimize be removed for buildStubAppLib to get better valgrind output or will it not matter?</p>
<div class="codehilite"><pre><span></span><code>|&gt; Cmd.exec  [&quot;build&quot;, &quot;--lib&quot;, &quot;platform/libapp.roc&quot;, &quot;--output&quot;, stubLibPath, &quot;--optimize&quot;]
</code></pre></div>



<a name="484974397"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/client-side%20web%20in%20Roc/near/484974397" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/client-side.20web.20in.20Roc.html#484974397">(Nov 28 2024 at 19:03)</a>:</h4>
<p>That's just for the roc part, and I dont think it will change much much for this debugging.</p>



<a name="485079628"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/client-side%20web%20in%20Roc/near/485079628" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Antonin Komenda <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/client-side.20web.20in.20Roc.html#485079628">(Nov 29 2024 at 11:34)</a>:</h4>
<p><span class="user-mention silent" data-user-id="361169">Anton</span> <a href="#narrow/channel/231634-beginners/topic/client-side.20web.20in.20Roc/near/484956883">said</a>:</p>
<blockquote>
<p>In that case, I recommend using a local version of basic-webserver 0.9.0. So:</p>
<div class="codehilite"><pre><span></span><code>git clone https://github.com/roc-lang/basic-webserver.git
cd basic-webserver
</code></pre></div>
<p>In that folder modify <code>build.roc</code> by removing <code>--release</code> <a href="https://github.com/roc-lang/basic-webserver/blob/dee0bfcda04ba51076a1e99a57243b37792f5a55/build.roc#L103">here</a>.</p>
<p>Then:</p>
<div class="codehilite"><pre><span></span><code># use latest nightly roc, not TESTING
roc build.roc
</code></pre></div>
<p>Then you'll want to use that built platform by modifying <a href="https://github.com/lukewilliamboswell/roc-htmx-playground/blob/cfb452f792fc2ce68343557da64ed4505fb11c49/src/main.roc#L2">this url</a> to a path; like <code>{ pf: platform "some_path/basic-webserver/platform/main.roc" }</code>.</p>
<p>that should hopefully improve your valgrind output</p>
</blockquote>
<p>I was able to build the platform, but the build does not contain a <code>.o</code> so the playground compains:</p>
<div class="codehilite"><pre><span></span><code>roc build --build-host --suppress-build-host-warning --linker=legacy src/main.roc
🔨 Building host ...
ld: cannot find src/../../basic-webserver/platform/linux-x64.o: No such file or directory
thread &#39;main&#39; panicked at crates/compiler/build/src/program.rs:1058:17:
not yet implemented: linker failed with exit code Some(1)
note: run with `RUST_BACKTRACE=1` environment variable to display a backtrace
</code></pre></div>
<p>I've got there only <code>libapp.so</code> and <code>linux-x64.a</code>.</p>



<a name="485081962"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/client-side%20web%20in%20Roc/near/485081962" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Antonin Komenda <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/client-side.20web.20in.20Roc.html#485081962">(Nov 29 2024 at 11:48)</a>:</h4>
<p>Did I mess up something in the platform build?</p>



<a name="485083959"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/client-side%20web%20in%20Roc/near/485083959" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Bullard <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/client-side.20web.20in.20Roc.html#485083959">(Nov 29 2024 at 12:01)</a>:</h4>
<p>I also experienced the same on macOS on Apple Silicon.</p>



<a name="485087762"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/client-side%20web%20in%20Roc/near/485087762" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anton <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/client-side.20web.20in.20Roc.html#485087762">(Nov 29 2024 at 12:24)</a>:</h4>
<p>Hmm, can you share the output of <code>ar -t linux-x64.a</code> in the platform folder?</p>



<a name="485092548"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/client-side%20web%20in%20Roc/near/485092548" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Antonin Komenda <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/client-side.20web.20in.20Roc.html#485092548">(Nov 29 2024 at 12:49)</a>:</h4>
<p>Here: </p>
<div class="codehilite"><pre><span></span><code>ar -t linux-x64.a &gt; ~/desktop/ar.output
</code></pre></div>
<p><a href="/user_uploads/22008/rKy4Msfg1FhMGHvR23BnZgCi/ar.output">ar.output</a></p>



<a name="485093748"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/client-side%20web%20in%20Roc/near/485093748" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anton <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/client-side.20web.20in.20Roc.html#485093748">(Nov 29 2024 at 12:56)</a>:</h4>
<p>Thanks, can you share the output of <code>roc version</code>?</p>



<a name="485093924"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/client-side%20web%20in%20Roc/near/485093924" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Antonin Komenda <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/client-side.20web.20in.20Roc.html#485093924">(Nov 29 2024 at 12:57)</a>:</h4>
<p><code>roc nightly pre-release, built from commit 8dbc909 on Fr 15 Nov 2024 09:02:07 UTC</code></p>



<a name="485096172"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/client-side%20web%20in%20Roc/near/485096172" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anton <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/client-side.20web.20in.20Roc.html#485096172">(Nov 29 2024 at 13:11)</a>:</h4>
<p>It should be searching for the .a file, this could be <a href="https://github.com/roc-lang/roc/blob/1c9dc56fdefd5532ede2c034e69d50b81705cfbb/crates/compiler/build/src/link.rs#L448">the problematic line</a>, it may just need to use the <code>prebuilt_static_library</code> function instead. <span class="user-mention" data-user-id="515757">@Luke Boswell</span> may have some useful input as well.</p>
<p>Can you file an issue for this?</p>
<p>If you're up for it you can try that function change yourself, build roc with <code>cargo build --release --bin roc</code>, the binary will then be in <code>./target/release/roc</code>. To use that version of roc with your project you'll also need to switch to basic-webserver 0.10.0</p>



<a name="485099931"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/client-side%20web%20in%20Roc/near/485099931" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Antonin Komenda <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/client-side.20web.20in.20Roc.html#485099931">(Nov 29 2024 at 13:32)</a>:</h4>
<p>Reported here: <a href="https://github.com/roc-lang/roc/issues/7271">https://github.com/roc-lang/roc/issues/7271</a></p>
<p>I'll try to hotfix it in Roc later.</p>



<a name="485165750"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/client-side%20web%20in%20Roc/near/485165750" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/client-side.20web.20in.20Roc.html#485165750">(Nov 29 2024 at 22:00)</a>:</h4>
<p>You shouldn't be using the <code>--build-host</code> flag, that is only intended for internal tests now. I think I've found the issue with the above, and it's caused by using that flag. Specifically <a href="https://github.com/roc-lang/roc/blob/a9682517093f1e8cdd75572269e5acdcadbb45cf/crates/compiler/build/src/program.rs#L1095">at this point </a> if you are interested.</p>



<a name="485165856"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/client-side%20web%20in%20Roc/near/485165856" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/client-side.20web.20in.20Roc.html#485165856">(Nov 29 2024 at 22:01)</a>:</h4>
<p>So you've built the platform correctly, you know this because you can see the <code>linux-x64.a</code> etc files in <code>platform/</code>.</p>



<a name="485165959"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/client-side%20web%20in%20Roc/near/485165959" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/client-side.20web.20in.20Roc.html#485165959">(Nov 29 2024 at 22:02)</a>:</h4>
<p>So now in your app, you should be able to build it using <code>roc build linker=legacy </code>src/main.roc``</p>



<a name="485629393"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/client-side%20web%20in%20Roc/near/485629393" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Antonin Komenda <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/client-side.20web.20in.20Roc.html#485629393">(Dec 02 2024 at 13:53)</a>:</h4>
<p>Hmm, I am getting:</p>
<div class="codehilite"><pre><span></span><code>$ roc build --linker=legacy src/main.roc
ld: /tmp/roc_app43ZQ1f.o: in function `roc_fx_sqliteExecute_fastcc_wrapper&#39;:
builtins-host:(.text+0xfef2c): undefined reference to `roc_fx_sqliteExecute&#39;
thread &#39;main&#39; panicked at crates/compiler/build/src/program.rs:1058:17:
not yet implemented: linker failed with exit code Some(1)
note: run with `RUST_BACKTRACE=1` environment variable to display a backtrace
</code></pre></div>



<a name="485631048"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/client-side%20web%20in%20Roc/near/485631048" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anton <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/client-side.20web.20in.20Roc.html#485631048">(Dec 02 2024 at 14:01)</a>:</h4>
<p>I can try to reproduce this later</p>



<a name="485631660"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/client-side%20web%20in%20Roc/near/485631660" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Antonin Komenda <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/client-side.20web.20in.20Roc.html#485631660">(Dec 02 2024 at 14:04)</a>:</h4>
<p>Thanks a lot (not critical on my side :]). Do I at least get the error correctly: does it mean the built platform is not compatible with the Roc part of the platform?</p>



<a name="485631782"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/client-side%20web%20in%20Roc/near/485631782" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Antonin Komenda <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/client-side.20web.20in.20Roc.html#485631782">(Dec 02 2024 at 14:04)</a>:</h4>
<p>With respect to the sqlite effects?</p>



<a name="485633094"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/client-side%20web%20in%20Roc/near/485633094" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anton <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/client-side.20web.20in.20Roc.html#485633094">(Dec 02 2024 at 14:11)</a>:</h4>
<blockquote>
<p>does it mean the built platform is not compatible with the Roc part of the platform?</p>
</blockquote>
<p>Good catch, yes, this may just be a function name that changed from one version to another</p>



<a name="485690703"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/client-side%20web%20in%20Roc/near/485690703" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anton <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/client-side.20web.20in.20Roc.html#485690703">(Dec 02 2024 at 19:04)</a>:</h4>
<p><code>roc_fx_sqliteExecute</code> is in the linux-x64.a of basic-webserver (0.10.0).<br>
Can you share your code <span class="user-mention" data-user-id="782019">@Antonin Komenda</span>?</p>



<a name="485697224"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/client-side%20web%20in%20Roc/near/485697224" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Antonin Komenda <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/client-side.20web.20in.20Roc.html#485697224">(Dec 02 2024 at 19:44)</a>:</h4>
<p>This is my <code>basic-webserver</code>:</p>
<div class="codehilite"><pre><span></span><code>$ git st
On branch main
Your branch is up to date with &#39;origin/main&#39;.

Changes not staged for commit:
  (use &quot;git add &lt;file&gt;...&quot; to update what will be committed)
  (use &quot;git restore &lt;file&gt;...&quot; to discard changes in working directory)
        modified:   build.roc
        modified:   examples/todos.roc
        modified:   platform/Url.roc

no changes added to commit (use &quot;git add&quot; and/or &quot;git commit -a&quot;)
$ git diff
diff --git a/build.roc b/build.roc
index 3b63032..4746c49 100644
--- a/build.roc
+++ b/build.roc
@@ -1,5 +1,6 @@
 app [main] {
-    cli: platform &quot;https://github.com/roc-lang/basic-cli/releases/download/0.17.0/lZFLstMUCUvd5bjnnpYromZJXkQUrdhbva4xdBInicE.tar.br&quot;,
+    #cli: platform &quot;https://github.com/roc-lang/basic-cli/releases/download/0.17.0/lZFLstMUCUvd5bjnnpYromZJXkQUrdhbva4xdBInicE.tar.br&quot;,
+    cli: platform &quot;https://github.com/roc-lang/basic-cli/releases/download/0.16.0/O00IPk-Krg_diNS2dVWlI0ZQP794Vctxzv0ha96mK0E.tar.br&quot;,
 }

 import cli.Cmd
@@ -100,7 +101,7 @@ cargoBuildHost =
     info! &quot;Building rust host ...&quot;

     &quot;cargo&quot;
-        |&gt; Cmd.exec [&quot;build&quot;, &quot;--release&quot;]
+        |&gt; Cmd.exec [&quot;build&quot;]
         |&gt; Task.mapErr! ErrBuildingHostBinaries

 copyHostLib : OSAndArch, Str -&gt; Task {} _
diff --git a/examples/todos.roc b/examples/todos.roc
index bbf9bd4..73bf2df 100644
--- a/examples/todos.roc
+++ b/examples/todos.roc
@@ -32,7 +32,7 @@ respond = \req, _ -&gt;
             req.url
             |&gt; Url.fromStr
             |&gt; Url.path
-            |&gt; Str.splitOn &quot;/&quot;
+            |&gt; Str.split &quot;/&quot;

         # Route to handler based on url path
         when splitUrl is
diff --git a/platform/Url.roc b/platform/Url.roc
index 817bd31..16c9865 100644
--- a/platform/Url.roc
+++ b/platform/Url.roc
@@ -439,7 +439,7 @@ query = \@Url urlStr -&gt;
 queryParams : Url -&gt; Dict Str Str
 queryParams = \url -&gt;
     query url
-    |&gt; Str.splitOn &quot;&amp;&quot;
+    |&gt; Str.split &quot;&amp;&quot;
     |&gt; List.walk (Dict.empty {}) \dict, pair -&gt;
         when Str.splitFirst pair &quot;=&quot; is
             Ok { before, after } -&gt; Dict.insert dict before after
</code></pre></div>



<a name="485697348"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/client-side%20web%20in%20Roc/near/485697348" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Antonin Komenda <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/client-side.20web.20in.20Roc.html#485697348">(Dec 02 2024 at 19:45)</a>:</h4>
<p>And this the playground:</p>
<div class="codehilite"><pre><span></span><code>$ git st
On branch main
Your branch is up to date with &#39;origin/main&#39;.

Changes not staged for commit:
  (use &quot;git add &lt;file&gt;...&quot; to update what will be committed)
  (use &quot;git restore &lt;file&gt;...&quot; to discard changes in working directory)
        modified:   src/Helpers.roc
        modified:   src/Models/BigTask.roc
        modified:   src/Sql/Session.roc
        modified:   src/main.roc

no changes added to commit (use &quot;git add&quot; and/or &quot;git commit -a&quot;)
$ git diff
diff --git a/src/Helpers.roc b/src/Helpers.roc
index ed6ebee..f30a50e 100644
--- a/src/Helpers.roc
+++ b/src/Helpers.roc
@@ -39,7 +39,7 @@ decodeFormValues = \body -&gt;

 parseQueryParams : Str -&gt; Result (Dict Str Str) _
 parseQueryParams = \url -&gt;
-    when Str.splitOn url &quot;?&quot; is
+    when Str.split url &quot;?&quot; is
         [_, queryPart] -&gt; queryPart |&gt; Str.toUtf8 |&gt; Http.parseFormUrlEncoded
         parts -&gt; Err (InvalidQuery (Inspect.toStr parts))

diff --git a/src/Models/BigTask.roc b/src/Models/BigTask.roc
index 336472b..15e6e52 100644
--- a/src/Models/BigTask.roc
+++ b/src/Models/BigTask.roc
@@ -41,7 +41,7 @@ parseDate = \date -&gt;
     isTwoChars = \str -&gt; List.len (Str.toUtf8 str) == 2

     # Format: yyyy-mm-dd
-    when Str.splitOn date &quot;-&quot; is
+    when Str.split date &quot;-&quot; is
         [&quot;&quot;] -&gt; Ok NotSet
         [yyyy, mm, dd] if isFourChars yyyy &amp;&amp; isTwoChars mm &amp;&amp; isTwoChars dd -&gt;
             when (Str.toI64 yyyy, Str.toI64 mm, Str.toI64 dd) is
diff --git a/src/Sql/Session.roc b/src/Sql/Session.roc
index 608a495..ce8df9b 100644
--- a/src/Sql/Session.roc
+++ b/src/Sql/Session.roc
@@ -32,7 +32,7 @@ parse = \req -&gt;
     when req.headers |&gt; List.keepIf \reqHeader -&gt; reqHeader.name == &quot;cookie&quot; is
         [reqHeader] -&gt;
             reqHeader.value
-            |&gt; Str.splitOn &quot;=&quot;
+            |&gt; Str.split &quot;=&quot;
             |&gt; List.get 1
             |&gt; Result.try Str.toI64
             |&gt; Result.mapErr \_ -&gt; InvalidSessionCookie
diff --git a/src/main.roc b/src/main.roc
index bb91e83..0c810f5 100644
--- a/src/main.roc
+++ b/src/main.roc
@@ -1,5 +1,6 @@
 app [Model, server] {
-    pf: platform &quot;https://github.com/roc-lang/basic-webserver/releases/download/0.10.0/BgDDIykwcg51W8HA58FE_BjdzgXVk--ucv6pVb_Adik.tar.br&quot;,
+    # pf: platform &quot;https://github.com/roc-lang/basic-webserver/releases/download/0.10.0/BgDDIykwcg51W8HA58FE_BjdzgXVk--ucv6pVb_Adik.tar.br&quot;,
+    pf: platform &quot;../../basic-webserver/platform/main.roc&quot;,
     html: &quot;https://github.com/Hasnep/roc-html/releases/download/v0.6.0/IOyNfA4U_bCVBihrs95US9Tf5PGAWh3qvrBN4DRbK5c.tar.br&quot;,
 }

@@ -75,7 +76,7 @@ handleReq = \req -&gt;
         req.url
         |&gt; Url.fromStr
         |&gt; Url.path
-        |&gt; Str.splitOn &quot;/&quot;
+        |&gt; Str.split &quot;/&quot;
         |&gt; List.dropFirst 1

     when (req.method, urlSegments) is
</code></pre></div>



<a name="485697484"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/client-side%20web%20in%20Roc/near/485697484" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Antonin Komenda <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/client-side.20web.20in.20Roc.html#485697484">(Dec 02 2024 at 19:46)</a>:</h4>
<p>I.e. both are <code>main</code>s with the changes to build the platform and then use the locally built platform (and the <code>splitOn</code>/<code>split</code> "backport")</p>



<a name="485698457"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/client-side%20web%20in%20Roc/near/485698457" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Antonin Komenda <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/client-side.20web.20in.20Roc.html#485698457">(Dec 02 2024 at 19:53)</a>:</h4>
<p>If I try to build the <code>basic-webserver</code> with the cli 0.17.0, I get:</p>
<div class="codehilite"><pre><span></span><code>$ roc build.roc

── NOT EXPOSED in .../lZFLstMUCUvd5bjnnpYromZJXkQUrdhbva4xdBInicE/Arg/Help.roc ─

The Str module does not expose `splitOn`:

342│      |&gt; Str.splitOn &quot;\n&quot;
             ^^^^^^^^^^^

Did you mean one of these?

    Str.split
    Str.splitLast
    Str.splitFirst
    Str.isEmpty

────────────────────────────────────────────────────────────────────────────────

1 error and 0 warnings found in 87 ms
.

You can run the program anyway with roc run build.roc
</code></pre></div>
<p>as I am using the non-TESTING Roc, as you suggested before.</p>



<a name="485702169"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/client-side%20web%20in%20Roc/near/485702169" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/client-side.20web.20in.20Roc.html#485702169">(Dec 02 2024 at 20:20)</a>:</h4>
<p>You must be using an older nightly, splitOn is a newer API.</p>



<a name="485790047"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/client-side%20web%20in%20Roc/near/485790047" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Antonin Komenda <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/client-side.20web.20in.20Roc.html#485790047">(Dec 03 2024 at 08:54)</a>:</h4>
<p>Aah, even older... okok, I'll try. Sorry, I didn't get that, I though only non-TESTING.</p>



<a name="485810275"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/client-side%20web%20in%20Roc/near/485810275" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Antonin Komenda <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/client-side.20web.20in.20Roc.html#485810275">(Dec 03 2024 at 10:21)</a>:</h4>
<p>or could I use the nightly Roc from yesterday maybe?</p>



<a name="485811723"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/client-side%20web%20in%20Roc/near/485811723" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anton <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/client-side.20web.20in.20Roc.html#485811723">(Dec 03 2024 at 10:27)</a>:</h4>
<p>yes, that one has the new Str.splitOn API</p>



<a name="485859267"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/client-side%20web%20in%20Roc/near/485859267" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Antonin Komenda <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/client-side.20web.20in.20Roc.html#485859267">(Dec 03 2024 at 13:58)</a>:</h4>
<p>Hmm, still the problem with the sqliteExecure fx:</p>
<div class="codehilite"><pre><span></span><code>$ roc build --linker=legacy src/main.roc
ld: /tmp/roc_appLCFstE.o: in function `roc_fx_sqliteExecute_fastcc_wrapper&#39;:
builtins-host:(.text+0xfe40c): undefined reference to `roc_fx_sqliteExecute&#39;
thread &#39;main&#39; panicked at crates/compiler/build/src/program.rs:1058:17:
not yet implemented: linker failed with exit code Some(1)
note: run with `RUST_BACKTRACE=1` environment variable to display a backtrace
</code></pre></div>
<p>I've updated Roc, the basic-webserver and the playground, the <code>split/splitOn</code> is ok now.</p>



<a name="485859469"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/client-side%20web%20in%20Roc/near/485859469" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Antonin Komenda <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/client-side.20web.20in.20Roc.html#485859469">(Dec 03 2024 at 13:59)</a>:</h4>
<p>I'll try to check the intermediate .o files whether/why not the function is really there</p>



<a name="485863299"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/client-side%20web%20in%20Roc/near/485863299" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Antonin Komenda <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/client-side.20web.20in.20Roc.html#485863299">(Dec 03 2024 at 14:14)</a>:</h4>
<p>I've extracted the <code>linux-x64.a</code> to object files and grepped out the <code>fx_sqlite</code> functions and got only:</p>
<div class="codehilite"><pre><span></span><code>host-6d734d3ba16fa1e3.host.6db8a1e53cb1cd2b-cgu.0.rcgu.o
0000000000000000 T roc_fx_sqliteBind
0000000000000000 T roc_fx_sqliteColumns
0000000000000000 T roc_fx_sqliteColumnValue
0000000000000000 T roc_fx_sqlitePrepare
0000000000000000 T roc_fx_sqliteReset
0000000000000000 T roc_fx_sqliteStep
</code></pre></div>



<a name="485863484"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/client-side%20web%20in%20Roc/near/485863484" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Antonin Komenda <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/client-side.20web.20in.20Roc.html#485863484">(Dec 03 2024 at 14:15)</a>:</h4>
<p>So I really do not have the <code>...Execute</code> there. Any suggestions? Or maybe a pointer where is the host object built?</p>



<a name="485875084"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/client-side%20web%20in%20Roc/near/485875084" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anton <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/client-side.20web.20in.20Roc.html#485875084">(Dec 03 2024 at 15:00)</a>:</h4>
<p><span aria-label="thinking" class="emoji emoji-1f914" role="img" title="thinking">:thinking:</span> this what I get after extracting the linux-x64.a for <a href="http://BgDDIykwcg51W8HA58FE_BjdzgXVk--ucv6pVb_Adik.tar.br">BgDDIykwcg51W8HA58FE_BjdzgXVk--ucv6pVb_Adik.tar.br</a> :</p>
<div class="codehilite"><pre><span></span><code>❯ strings host-b1c017c9b46813ae.host.faf5bafe4a7818bd-cgu.0.rcgu.o | grep fx_sqlite
.rela.text.roc_fx_sqliteExecute
.gcc_except_table.roc_fx_sqliteExecute
.rela.rodata.roc_fx_sqliteExecute
</code></pre></div>



<a name="485875663"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/client-side%20web%20in%20Roc/near/485875663" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Antonin Komenda <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/client-side.20web.20in.20Roc.html#485875663">(Dec 03 2024 at 15:02)</a>:</h4>
<div class="codehilite"><pre><span></span><code>$ strings host-6d734d3ba16fa1e3.host.6db8a1e53cb1cd2b-cgu.0.rcgu.o | grep fx_sqlite
.rela.text.roc_fx_sqliteReset
.rela.text.roc_fx_sqliteColumns
.gcc_except_table.roc_fx_sqliteColumns
.rela.text.roc_fx_sqliteStep
.rela.text.roc_fx_sqliteColumnValue
.gcc_except_table.roc_fx_sqliteColumnValue
.rela.rodata.roc_fx_sqliteColumnValue
.rela.text.roc_fx_sqlitePrepare
.gcc_except_table.roc_fx_sqlitePrepare
.rela.text.roc_fx_sqliteBind
.gcc_except_table.roc_fx_sqliteBind
.rela.rodata.roc_fx_sqliteBind
</code></pre></div>



<a name="485875772"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/client-side%20web%20in%20Roc/near/485875772" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Antonin Komenda <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/client-side.20web.20in.20Roc.html#485875772">(Dec 03 2024 at 15:03)</a>:</h4>
<p>Should we have the hashes the same? Or they are local to the build?</p>



<a name="485876178"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/client-side%20web%20in%20Roc/near/485876178" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anton <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/client-side.20web.20in.20Roc.html#485876178">(Dec 03 2024 at 15:05)</a>:</h4>
<p>I'm not sure about those hashes, but are you also using <a href="http://BgDDIykwcg51W8HA58FE_BjdzgXVk--ucv6pVb_Adik.tar.br">BgDDIykwcg51W8HA58FE_BjdzgXVk--ucv6pVb_Adik.tar.br</a> ?</p>



<a name="485876356"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/client-side%20web%20in%20Roc/near/485876356" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anton <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/client-side.20web.20in.20Roc.html#485876356">(Dec 03 2024 at 15:05)</a>:</h4>
<p>That <a href="http://tar.br">tar.br</a> comes from <a href="https://github.com/roc-lang/basic-webserver/releases/tag/0.10.0">https://github.com/roc-lang/basic-webserver/releases/tag/0.10.0</a></p>



<a name="485876551"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/client-side%20web%20in%20Roc/near/485876551" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Antonin Komenda <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/client-side.20web.20in.20Roc.html#485876551">(Dec 03 2024 at 15:06)</a>:</h4>
<p>nono, I am building the platform locally... that's all because I want the non<code>--release</code> build of the platform to pinpoint the malloc problem I am triggering from the playground</p>



<a name="485878632"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/client-side%20web%20in%20Roc/near/485878632" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anton <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/client-side.20web.20in.20Roc.html#485878632">(Dec 03 2024 at 15:14)</a>:</h4>
<p>Can you try setting <code>CARGO_BUILD_TARGET=x86_64-unknown-linux-musl </code> when you build basic-webserver, that's what I use to build the release</p>



<a name="485880519"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/client-side%20web%20in%20Roc/near/485880519" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Antonin Komenda <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/client-side.20web.20in.20Roc.html#485880519">(Dec 03 2024 at 15:21)</a>:</h4>
<p>that actually worked <span aria-label="tada" class="emoji emoji-1f389" role="img" title="tada">:tada:</span> </p>
<p>however the valgrind output is pretty the same <span aria-label="sweat smile" class="emoji emoji-1f605" role="img" title="sweat smile">:sweat_smile:</span> </p>
<div class="codehilite"><pre><span></span><code>==3181233== Memcheck, a memory error detector
==3181233== Copyright (C) 2002-2024, and GNU GPL&#39;d, by Julian Seward et al.
==3181233== Using Valgrind-3.24.0 and LibVEX; rerun with -h for copyright info
==3181233== Command: src/main
==3181233==
==3181233== posix_memalign() invalid size value: 0
==3181233==    at 0x484CA38: posix_memalign (vg_replace_malloc.c:2226)
==3181233==    by 0x5C0080: aligned_malloc (alloc.rs:102)
==3181233==    by 0x5C0080: alloc (alloc.rs:22)
==3181233==    by 0x5C0080: __rdl_alloc (alloc.rs:394)
==3181233==    by 0x5EAADA: alloc::alloc::alloc (alloc.rs:100)
==3181233==    by 0x27069F: roc_host::roc::call_roc_init (roc.rs:1001)
==3181233==    by 0x60CF3B: roc_host::http_server::start (http_server.rs:25)
==3181233==    by 0x27C615: rust_main (lib.rs:8)
==3181233==    by 0x26F996: main (lib.rs:3)
==3181233==
Listening on &lt;http://127.0.0.1:8000&gt;
2024-12-03T15:20:39Z GET /
2024-12-03T15:20:39Z GET /styles.css
2024-12-03T15:20:40Z GET /bootstrap.bundle.min.js
2024-12-03T15:20:40Z GET /bootstrap.min.css
2024-12-03T15:20:40Z GET /htmx.min.js
2024-12-03T15:20:40Z GET /site.js
2024-12-03T15:20:40Z GET /favicon.ico
404 NotFound /favicon.ico
2024-12-03T15:20:41Z GET /bigTask
2024-12-03T15:20:44Z GET /bigTask?page=2&amp;items=25
==3181233== Thread 18 tokio-runtime-w:
==3181233== Invalid read of size 8
==3181233==    at 0x265499: decrement_refcounted_ptr_8 (roc_app:0)
==3181233==    by 0x26548D: ??? (roc_app:0)
==3181233==    by 0x26B11B: ??? (roc_app:0)
==3181233==    by 0x1FC1A9: Task_53_b7f067e6f5939fbe06dd68ed4b36fad898cbfd8ef8d993964d5cd10b12ac3ec (roc_app:0)
==3181233==    by 0x225CA1: Task_96_38ac12d038fd8df52070eb8edb3aab96b2fa7b50fc7a9367255428634fa0264e (roc_app:0)
==3181233==    by 0x25A208: Task_46_5e6d2773e4caec97557de41edef7addcc8c8bc472f779d224a7d61166dbaabe (roc_app:0)
==3181233==    by 0x21F082: _158_3fe74881edf546beefa6734056b1899c37505b1c34fcce49bbd7b44b157595 (roc_app:0)
==3181233==    by 0x26F94D: roc__forHost_2_caller (in /home/gree/workspace/roc-htmx-playground/src/main)
==3181233==    by 0x270F64: roc_host::roc::call_roc_respond (roc.rs:1086)
==3181233==    by 0x28AC84: roc_host::http_server::call_roc (http_server.rs:62)
==3181233==    by 0x28BB14: roc_host::http_server::handle_req::{{closure}}::{{closure}} (http_server.rs:110)
==3181233==    by 0x60DAE4: &lt;tokio::runtime::blocking::task::BlockingTask&lt;T&gt; as core::future::future::Future&gt;::poll (task.rs:42)
==3181233==  Address 0x7549610 is 0 bytes inside a block of size 32 free&#39;d
==3181233==    at 0x48478EF: free (vg_replace_malloc.c:989)
==3181233==    by 0x26FA02: roc_dealloc (roc.rs:34)
==3181233==    by 0x2654DA: decrement_refcounted_ptr_8 (roc_app:0)
==3181233==    by 0x26548D: ??? (roc_app:0)
==3181233==    by 0x1DFA60: Controllers.BigTask_15_36cf1b423d96d0d1f556ed298e83394497cd597c20b08eba5512c2685cd67751 (in /home/gree/workspace/roc-htmx-playground/src/main)
==3181233==    by 0x20012F: Task_46_c436285c5b59d7df49ab96ad8476bdb7c10421fe2225ff48721cb48682ff451 (roc_app:0)
==3181233==    by 0x2088CC: Task_46_28ea24f1682fb667c3fb23a9dbc02f29e624f88b5aca38a345144704a3139a (roc_app:0)
==3181233==    by 0x23DD1D: Task_46_ee6d8d949dc3617ea48fd44bd0c8f21be51d3676b1b3bdfdfcf8f559e4e0272f (roc_app:0)
==3181233==    by 0x2652E6: Task_46_1f3cd98ac177094c9632f9c81aa71556d2feacfd911d3d139427ec94325c8 (roc_app:0)
==3181233==    by 0x1FC195: Task_53_b7f067e6f5939fbe06dd68ed4b36fad898cbfd8ef8d993964d5cd10b12ac3ec (roc_app:0)
==3181233==    by 0x225CA1: Task_96_38ac12d038fd8df52070eb8edb3aab96b2fa7b50fc7a9367255428634fa0264e (roc_app:0)
==3181233==    by 0x25A208: Task_46_5e6d2773e4caec97557de41edef7addcc8c8bc472f779d224a7d61166dbaabe (roc_app:0)
==3181233==  Block was alloc&#39;d at
==3181233==    at 0x48447A8: malloc (vg_replace_malloc.c:446)
==3181233==    by 0x26F9B2: roc_alloc (roc.rs:19)
==3181233==    by 0x5A075E: roc_std::roc_list::RocList&lt;T&gt;::elems_with_capacity (roc_list.rs:89)
==3181233==    by 0x5A0E7F: roc_std::roc_list::RocList&lt;T&gt;::extend_from_slice (roc_list.rs:371)
==3181233==    by 0x5A0BAC: roc_std::roc_list::RocList&lt;T&gt;::from_slice (roc_list.rs:312)
==3181233==    by 0x59FE98: roc_std::roc_str::RocStr::from_slice_unchecked (roc_str.rs:76)
==3181233==    by 0x5A0074: &lt;roc_std::roc_str::RocStr as core::convert::From&lt;&amp;str&gt;&gt;::from (roc_str.rs:704)
==3181233==    by 0x27D23A: &lt;T as core::convert::Into&lt;U&gt;&gt;::into (mod.rs:759)
==3181233==    by 0x60C2E6: roc_host::roc_http::RequestToAndFromHost::from_reqwest (roc_http.rs:30)
==3181233==    by 0x28AB6C: roc_host::http_server::call_roc (http_server.rs:60)
==3181233==    by 0x28BB14: roc_host::http_server::handle_req::{{closure}}::{{closure}} (http_server.rs:110)
==3181233==    by 0x60DAE4: &lt;tokio::runtime::blocking::task::BlockingTask&lt;T&gt; as core::future::future::Future&gt;::poll (task.rs:42)
==3181233==
==3181233== Invalid write of size 8
==3181233==    at 0x2654BA: decrement_refcounted_ptr_8 (roc_app:0)
==3181233==    by 0x26548D: ??? (roc_app:0)
==3181233==    by 0x26B11B: ??? (roc_app:0)
==3181233==    by 0x1FC1A9: Task_53_b7f067e6f5939fbe06dd68ed4b36fad898cbfd8ef8d993964d5cd10b12ac3ec (roc_app:0)
==3181233==    by 0x225CA1: Task_96_38ac12d038fd8df52070eb8edb3aab96b2fa7b50fc7a9367255428634fa0264e (roc_app:0)
==3181233==    by 0x25A208: Task_46_5e6d2773e4caec97557de41edef7addcc8c8bc472f779d224a7d61166dbaabe (roc_app:0)
==3181233==    by 0x21F082: _158_3fe74881edf546beefa6734056b1899c37505b1c34fcce49bbd7b44b157595 (roc_app:0)
==3181233==    by 0x26F94D: roc__forHost_2_caller (in /home/gree/workspace/roc-htmx-playground/src/main)
==3181233==    by 0x270F64: roc_host::roc::call_roc_respond (roc.rs:1086)
==3181233==    by 0x28AC84: roc_host::http_server::call_roc (http_server.rs:62)
==3181233==    by 0x28BB14: roc_host::http_server::handle_req::{{closure}}::{{closure}} (http_server.rs:110)
==3181233==    by 0x60DAE4: &lt;tokio::runtime::blocking::task::BlockingTask&lt;T&gt; as core::future::future::Future&gt;::poll (task.rs:42)
==3181233==  Address 0x7549610 is 0 bytes inside a block of size 32 free&#39;d
==3181233==    at 0x48478EF: free (vg_replace_malloc.c:989)
==3181233==    by 0x26FA02: roc_dealloc (roc.rs:34)
==3181233==    by 0x2654DA: decrement_refcounted_ptr_8 (roc_app:0)
==3181233==    by 0x26548D: ??? (roc_app:0)
==3181233==    by 0x1DFA60: Controllers.BigTask_15_36cf1b423d96d0d1f556ed298e83394497cd597c20b08eba5512c2685cd67751 (in /home/gree/workspace/roc-htmx-playground/src/main)
==3181233==    by 0x20012F: Task_46_c436285c5b59d7df49ab96ad8476bdb7c10421fe2225ff48721cb48682ff451 (roc_app:0)
==3181233==    by 0x2088CC: Task_46_28ea24f1682fb667c3fb23a9dbc02f29e624f88b5aca38a345144704a3139a (roc_app:0)
==3181233==    by 0x23DD1D: Task_46_ee6d8d949dc3617ea48fd44bd0c8f21be51d3676b1b3bdfdfcf8f559e4e0272f (roc_app:0)
==3181233==    by 0x2652E6: Task_46_1f3cd98ac177094c9632f9c81aa71556d2feacfd911d3d139427ec94325c8 (roc_app:0)
==3181233==    by 0x1FC195: Task_53_b7f067e6f5939fbe06dd68ed4b36fad898cbfd8ef8d993964d5cd10b12ac3ec (roc_app:0)
==3181233==    by 0x225CA1: Task_96_38ac12d038fd8df52070eb8edb3aab96b2fa7b50fc7a9367255428634fa0264e (roc_app:0)
==3181233==    by 0x25A208: Task_46_5e6d2773e4caec97557de41edef7addcc8c8bc472f779d224a7d61166dbaabe (roc_app:0)
==3181233==  Block was alloc&#39;d at
==3181233==    at 0x48447A8: malloc (vg_replace_malloc.c:446)
==3181233==    by 0x26F9B2: roc_alloc (roc.rs:19)
==3181233==    by 0x5A075E: roc_std::roc_list::RocList&lt;T&gt;::elems_with_capacity (roc_list.rs:89)
==3181233==    by 0x5A0E7F: roc_std::roc_list::RocList&lt;T&gt;::extend_from_slice (roc_list.rs:371)
==3181233==    by 0x5A0BAC: roc_std::roc_list::RocList&lt;T&gt;::from_slice (roc_list.rs:312)
==3181233==    by 0x59FE98: roc_std::roc_str::RocStr::from_slice_unchecked (roc_str.rs:76)
==3181233==    by 0x5A0074: &lt;roc_std::roc_str::RocStr as core::convert::From&lt;&amp;str&gt;&gt;::from (roc_str.rs:704)
==3181233==    by 0x27D23A: &lt;T as core::convert::Into&lt;U&gt;&gt;::into (mod.rs:759)
==3181233==    by 0x60C2E6: roc_host::roc_http::RequestToAndFromHost::from_reqwest (roc_http.rs:30)
==3181233==    by 0x28AB6C: roc_host::http_server::call_roc (http_server.rs:60)
==3181233==    by 0x28BB14: roc_host::http_server::handle_req::{{closure}}::{{closure}} (http_server.rs:110)
==3181233==    by 0x60DAE4: &lt;tokio::runtime::blocking::task::BlockingTask&lt;T&gt; as core::future::future::Future&gt;::poll (task.rs:42)
==3181233==
</code></pre></div>



<a name="485888900"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/client-side%20web%20in%20Roc/near/485888900" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anton <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/client-side.20web.20in.20Roc.html#485888900">(Dec 03 2024 at 15:55)</a>:</h4>
<p>I left some more comments <a href="https://github.com/roc-lang/basic-webserver/issues/81">on the issue</a>, but we'll have to wait until a specialist can look at it.</p>



<a name="485889131"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/client-side%20web%20in%20Roc/near/485889131" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Antonin Komenda <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/client-side.20web.20in.20Roc.html#485889131">(Dec 03 2024 at 15:56)</a>:</h4>
<p>I see. Thanks!</p>



<hr><p>Last updated: Nov 01 2025 at 12:13 UTC</p>
</html>