<html>
<head><meta charset="utf-8"><title>testing · beginners · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/index.html">beginners</a></h2>
<h3>Topic: <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/testing.html">testing</a></h3>

<hr>

<base href="https://roc.zulipchat.com">

<head><link href="https://roc-lang.github.io/zulip-export/style.css" rel="stylesheet"></head>

<a name="262824006"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/testing/near/262824006" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Hicks <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/testing.html#262824006">(Nov 26 2021 at 18:17)</a>:</h4>
<p>has anyone done any work on unit testing in Roc?</p>



<a name="262824256"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/testing/near/262824256" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Hicks <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/testing.html#262824256">(Nov 26 2021 at 18:20)</a>:</h4>
<p>made a Roc specification platform maybe? (rspec for short)</p>



<a name="262826073"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/testing/near/262826073" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anton <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/testing.html#262826073">(Nov 26 2021 at 18:45)</a>:</h4>
<p>Yes, Jim did in PR #1590</p>



<a name="262827176"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/testing/near/262827176" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Hicks <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/testing.html#262827176">(Nov 26 2021 at 19:01)</a>:</h4>
<p>niiiice</p>



<a name="262827252"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/testing/near/262827252" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Hicks <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/testing.html#262827252">(Nov 26 2021 at 19:02)</a>:</h4>
<p>know anything about fuzzing? (Actual fuzzing, not property testing)</p>



<a name="262827987"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/testing/near/262827987" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anton <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/testing.html#262827987">(Nov 26 2021 at 19:14)</a>:</h4>
<p><span class="user-mention" data-user-id="343810">@Brendan Hansknecht</span> started on fuzzing (in rust) in compiler/parse/fuzz. But I don't think anyone implemented fuzzing in roc.</p>



<a name="262829218"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/testing/near/262829218" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/testing.html#262829218">(Nov 26 2021 at 19:32)</a>:</h4>
<p>there's a design for baking testing into the language, but nobody's working on the implementation at the moment <span aria-label="big smile" class="emoji emoji-1f604" role="img" title="big smile">:big_smile:</span></p>



<a name="263035050"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/testing/near/263035050" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Hicks <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/testing.html#263035050">(Nov 29 2021 at 16:50)</a>:</h4>
<p><span class="user-mention" data-user-id="281383">@Richard Feldman</span> I think you maybe meant the Advent of Code topic <span aria-label="sweat smile" class="emoji emoji-1f605" role="img" title="sweat smile">:sweat_smile:</span></p>



<a name="263040005"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/testing/near/263040005" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/testing.html#263040005">(Nov 29 2021 at 17:25)</a>:</h4>
<p>ha, yup! fixed!</p>



<a name="263087193"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/testing/near/263087193" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dillon Kearns <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/testing.html#263087193">(Nov 30 2021 at 00:30)</a>:</h4>
<p><span class="user-mention silent" data-user-id="281383">Richard Feldman</span> <a href="#narrow/stream/231634-beginners/topic/testing/near/262829218">said</a>:</p>
<blockquote>
<p>there's a design for baking testing into the language, but nobody's working on the implementation at the moment <span aria-label="big smile" class="emoji emoji-1f604" role="img" title="big smile">:big_smile:</span></p>
</blockquote>
<p>Is that written down anywhere, or just an idea at this point? I got roc setup and the first thing on my mind is always testing, so I'd be curious to explore this more!</p>
<p>One of the things I'm curious about is if you picture the idea of a Platform being something that Roc's testing can swap in for data that it can make assertions against (rather than actually performing things in the platform). Not sure if it's as simple as that, but I'm very curious to discuss and contribute if I can!</p>



<a name="263090617"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/testing/near/263090617" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Whiting <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/testing.html#263090617">(Nov 30 2021 at 01:10)</a>:</h4>
<p>Interesting idea, essentially all effects happen through the platform, so it's a great boundary for testing.</p>



<a name="263173818"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/testing/near/263173818" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dillon Kearns <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/testing.html#263173818">(Nov 30 2021 at 16:54)</a>:</h4>
<p>Yeah, I think we can learn a lot from <a href="https://package.elm-lang.org/packages/avh4/elm-program-test/latest">https://package.elm-lang.org/packages/avh4/elm-program-test/latest</a>. It gives a way to simulate side effects. The way it's done is by wrapping Elm side-effects with an Effect type since currently Elm's Cmds and Tasks can't be inspected. Evan and Aaron were exploring having a way for tests to inspect those side-effects as data, which would allow for testing without creating an Effect type wrapper.</p>



<a name="263176019"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/testing/near/263176019" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/testing.html#263176019">(Nov 30 2021 at 17:07)</a>:</h4>
<blockquote>
<p>One of the things I'm curious about is if you picture the idea of a Platform being something that Roc's testing can swap in for data that it can make assertions against (rather than actually performing things in the platform). Not sure if it's as simple as that, but I'm very curious to discuss and contribute if I can!</p>
</blockquote>
<p>I know we have discussed that exact idea a few times and I think it is definitely a goal, but I don't think anyone has really dug into it yet. Could theoretically even interact with your app while in some sort of "record" mode and then use that to generate test cases.</p>



<a name="263178996"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/testing/near/263178996" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dillon Kearns <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/testing.html#263178996">(Nov 30 2021 at 17:26)</a>:</h4>
<p>I like the idea of "record" mode, that's a nice way of putting it.</p>
<p>One of the biggest benefits of managed effects and pure functions is testability. A lot of the "TDD is Dead" talk from people like DHH are, in my opinion, reactions to the very painful experience of mocking side-effects and environment. So a great testing story is a killer feature. A lot of that comes for free because you don't need to mock pure functions.</p>
<p>But for the managed effects, there does need to be some way to swap things in and "record" effects. For elm-program-test, it's a more tailored way of recording the specific effects that can happen in the Elm platform. With Roc, since Platforms are swappable, it would need to be able to give a way to provide a test harness specific to a given platform.</p>



<a name="263188216"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/testing/near/263188216" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mario <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/testing.html#263188216">(Nov 30 2021 at 18:33)</a>:</h4>
<p><span class="user-mention" data-user-id="432314">@Martin Stewart</span> has done some pretty rad stuff with program-test, expanding it to a full stack version for Lamdera. He already demoed a "time travelling debugger" style replay, so seems logical to go a step further with some sort of record. I think whatever context that's applied in will be a boon to making it easier / more likely to "write" (read: record) acceptance tests.</p>



<a name="295678009"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/testing/near/295678009" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jan kili <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/testing.html#295678009">(Aug 28 2022 at 07:53)</a>:</h4>
<p>I'm trying out the <code>expect</code> keyword for the first time, and I'm confused - what tests are running here?</p>
<div class="codehilite"><pre><span></span><code>$ roc test examples/hello-world/main.roc

0 failed and 5 passed in 729 ms.
</code></pre></div>
<p>I don't see any <code>expects</code> in the two <code>.roc</code> files involved...</p>



<a name="295679222"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/testing/near/295679222" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Carroll <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/testing.html#295679222">(Aug 28 2022 at 08:08)</a>:</h4>
<p>There are other .roc files involved too - all the ones in the standard library! There are three <code>expect</code>s in <code>Str.roc</code> and two in <code>Set.roc</code>. At the moment there's nothing to filter out the ones in the std lib and only run the ones for the app. But longer term, we should implement that!</p>



<a name="295682439"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/testing/near/295682439" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jan kili <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/testing.html#295682439">(Aug 28 2022 at 08:48)</a>:</h4>
<p>I see! Thank you for that insight.</p>



<a name="295682681"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/testing/near/295682681" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jan kili <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/testing.html#295682681">(Aug 28 2022 at 08:50)</a>:</h4>
<p>New question, does/will <code>roc test</code> have any verbosity settings that could display the values of the left and right sides of an equality check? I'd like to know what the left side of this is, for example:</p>
<div class="codehilite"><pre><span></span><code>$ roc test 3.roc
── EXPECT FAILED ─────────────────────────────────────────────────────── 3.roc ─

This expectation failed:

24│  expect (calculatePrimeFactors 2) == [2]
     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

1 failed and 7 passed in 781 ms.
</code></pre></div>



<a name="295683264"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/testing/near/295683264" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anton <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/testing.html#295683264">(Aug 28 2022 at 08:56)</a>:</h4>
<p>We do have <a href="https://github.com/roc-lang/roc/issues/1230">this old issue</a> where the printing of intermediary values is discussed.</p>



<a name="295684284"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/testing/near/295684284" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Carroll <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/testing.html#295684284">(Aug 28 2022 at 09:05)</a>:</h4>
<p>I would think you'd need to implement <code>expectEqual</code> instead of <code>expect</code> in order to do this. The <code>expect</code> function can only really print its argument, which is <code>True</code> or <code>False</code>. Anything more than that requires lots of fancy compiler magic which that issue is describing in detail. If instead you had <code>expectEqual</code> it would have two arguments so it could print both.<br>
But... then you also have to do <code>expectGreaterThan</code> and all that kind of stuff too, so instead of one or two magic functions, there's a whole family of them.<br>
Although if you had something like Elm's <code>Debug.log</code> then you could presumably build <code>expectEqual</code> out of that and <code>expect</code>.</p>



<a name="295684448"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/testing/near/295684448" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Carroll <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/testing.html#295684448">(Aug 28 2022 at 09:07)</a>:</h4>
<p>The logging function would then have to be somehow prevented from being used in production, etc.</p>



<a name="295684572"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/testing/near/295684572" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Carroll <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/testing.html#295684572">(Aug 28 2022 at 09:08)</a>:</h4>
<p>I guess in that design you'd have a whole <code>Expect</code> module in the standard library.</p>



<a name="295684653"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/testing/near/295684653" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Carroll <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/testing.html#295684653">(Aug 28 2022 at 09:09)</a>:</h4>
<p>And <code>expect</code> already works differently in production than test (it's ignored)</p>



<a name="295714017"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/testing/near/295714017" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/testing.html#295714017">(Aug 28 2022 at 14:02)</a>:</h4>
<p>yeah I'd like to print the values of all the arguments to the outermost function call in the <code>expect</code></p>



<a name="295714164"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/testing/near/295714164" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/testing.html#295714164">(Aug 28 2022 at 14:04)</a>:</h4>
<p>(e.g. <code>expect 5 == 5</code> would desugar to <code>expect Bool.isEq 5 5</code> so we'd print the two arguments to <code>Bool.isEq</code>)</p>



<a name="295714234"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/testing/near/295714234" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/testing.html#295714234">(Aug 28 2022 at 14:05)</a>:</h4>
<p>that would take care of all the comparisons you might want to do, not just <code>==</code></p>



<a name="295714328"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/testing/near/295714328" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/testing.html#295714328">(Aug 28 2022 at 14:05)</a>:</h4>
<p>nested function calls would be trickier I imagine, e.g. <code>1 == 1 || 2 == 3</code></p>



<a name="295714998"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/testing/near/295714998" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ayaz Hafiz <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/testing.html#295714998">(Aug 28 2022 at 14:12)</a>:</h4>
<p>Currently it's such that named variables in the expect expressions are printed</p>
<div class="codehilite"><pre><span></span><code>── EXPECT FAILED ─────────────────────────────── examples/hello-world/main.roc ─

This expectation failed:

6│&gt;  expect
7│&gt;      a = &quot;f&quot;
8│&gt;      b = &quot;g&quot;
9│&gt;      a == b

When it failed, these variables had these values:

a : Str
a = &quot;f&quot;

b : Str
b = &quot;g&quot;
</code></pre></div>



<a name="295746744"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/testing/near/295746744" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Qqwy / Marten <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/testing.html#295746744">(Aug 28 2022 at 18:42)</a>:</h4>
<p>That's wonderful, Ayaz! <span aria-label="party ball" class="emoji emoji-1f38a" role="img" title="party ball">:party_ball:</span></p>



<a name="295746804"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/testing/near/295746804" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ayaz Hafiz <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/testing.html#295746804">(Aug 28 2022 at 18:43)</a>:</h4>
<p>well <span class="user-mention" data-user-id="281543">@Folkert de Vries</span> did all this, ups to Folkert</p>



<a name="295747365"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/testing/near/295747365" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Qqwy / Marten <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/testing.html#295747365">(Aug 28 2022 at 18:48)</a>:</h4>
<p>Folkert! <span aria-label="green heart" class="emoji emoji-1f49a" role="img" title="green heart">:green_heart:</span></p>



<a name="295747402"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/testing/near/295747402" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/testing.html#295747402">(Aug 28 2022 at 18:49)</a>:</h4>
<p>Lots of fun code went into making it too</p>



<a name="295768436"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/testing/near/295768436" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jan kili <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/testing.html#295768436">(Aug 29 2022 at 00:45)</a>:</h4>
<p>I just went through my code and added a BUNCH of multi-line <code>expects</code>, and it actually caught some regressions from renamed builtins. Thanks, y'all! <span aria-label="smiley" class="emoji emoji-1f603" role="img" title="smiley">:smiley:</span></p>



<a name="295768494"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/testing/near/295768494" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jan kili <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/testing.html#295768494">(Aug 29 2022 at 00:46)</a>:</h4>
<p>(and as an added bonus, that process also uncovered a formatter bug! <a href="https://github.com/roc-lang/roc/issues/3924#issuecomment-1229604782">https://github.com/roc-lang/roc/issues/3924#issuecomment-1229604782</a> haha)</p>



<a name="295768966"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/testing/near/295768966" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jan kili <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/testing.html#295768966">(Aug 29 2022 at 00:56)</a>:</h4>
<p>What canonical formatting do we want for code like this?</p>
<div class="codehilite"><pre><span></span><code>computeFibonacciNumbersUpTo = \maximum -&gt;
    more = \olds -&gt;
        last2 = List.sublist olds { start: List.len olds - 2, len: 2 }
        next1 = List.sum last2
        news = List.append olds next1
        if next1 &gt; maximum then olds else more news
    more [1, 2]

expect
    fibs = computeFibonacciNumbersUpTo 5
    fibs == [1, 2, 3, 5]
expect
    fibs = computeFibonacciNumbersUpTo 20
    fibs == [1, 2, 3, 5, 8, 13]
</code></pre></div>



<a name="295768990"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/testing/near/295768990" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jan kili <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/testing.html#295768990">(Aug 29 2022 at 00:57)</a>:</h4>
<p>In a file with many function definitions, I want to add a few <code>expect</code>s after each function definition, like above. However, this is what I expect the formatter to do, which looks weird to me:</p>
<div class="codehilite"><pre><span></span><code>computeFibonacciNumbersUpTo = \maximum -&gt;
    more = \olds -&gt;
        last2 = List.sublist olds { start: List.len olds - 2, len: 2 }
        next1 = List.sum last2
        news = List.append olds next1
        if next1 &gt; maximum then olds else more news

    more [1, 2]

expect
    fibs = computeFibonacciNumbersUpTo 5

    fibs == [1, 2, 3, 5]

expect
    fibs = computeFibonacciNumbersUpTo 20

    fibs == [1, 2, 3, 5, 8, 13]
</code></pre></div>



<a name="295769004"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/testing/near/295769004" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jan kili <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/testing.html#295769004">(Aug 29 2022 at 00:57)</a>:</h4>
<p>Do I just need to get used to the pre-return-value newline? #EmbraceTheWhitespace?</p>



<a name="295771759"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/testing/near/295771759" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/testing.html#295771759">(Aug 29 2022 at 02:02)</a>:</h4>
<p>personally the second code snippet looks right to me!</p>



<a name="295787901"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/testing/near/295787901" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Carroll <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/testing.html#295787901">(Aug 29 2022 at 06:33)</a>:</h4>
<p>To me the blank line feels quite excessive when there's only one let-binding above it. I would never do that manually and I don't like when the Roc formatter does it. It always feels to me like our formatter is crudely applying a rule that doesn't really fit this case because it's not smart enough. But maybe that's not the case and it's intended because different people have different preferences.<br>
Some formatters allow you a certain degree of freedom with blank lines. I think the Rust formatter lets you insert one blank line in a function body but if you have two consecutive blank lines it merges them.</p>



<a name="295789438"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/testing/near/295789438" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Carroll <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/testing.html#295789438">(Aug 29 2022 at 06:47)</a>:</h4>
<p>Do we have any flexibility in ours? Could this become something that the user can control?</p>



<a name="295822243"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/testing/near/295822243" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Hicks <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/testing.html#295822243">(Aug 29 2022 at 11:07)</a>:</h4>
<p>are you talking about the blank line between <code>fibs = …</code> and <code>fibs == …</code>? That one actually makes sense to me in a testing context—I tend to arrange my tests in arrange/act/assert style and use whitespace to separate the stages.</p>



<a name="295855450"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/testing/near/295855450" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/testing.html#295855450">(Aug 29 2022 at 14:26)</a>:</h4>
<p>I think the biggest issue for me with that formatting is the that if you add a spacing before the last line, you need at least 2 spaces before the next definition. That being said, i definitely prefer no extra space in this case.</p>
<p>A:</p>
<div class="codehilite" data-code-language="CoffeeScript"><pre><span></span><code><span class="nx">expect</span><span class="w"></span>
<span class="w">    </span><span class="nv">fibs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">computeFibonacciNumbersUpTo</span><span class="w"> </span><span class="mi">5</span><span class="w"></span>

<span class="w">    </span><span class="nx">fibs</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="p">]</span><span class="w"></span>

<span class="nx">expect</span><span class="w"></span>
<span class="w">    </span><span class="nv">fibs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">computeFibonacciNumbersUpTo</span><span class="w"> </span><span class="mi">20</span><span class="w"></span>

<span class="w">    </span><span class="nx">fibs</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="p">,</span><span class="w"> </span><span class="mi">8</span><span class="p">,</span><span class="w"> </span><span class="mi">13</span><span class="p">]</span><span class="w"></span>
</code></pre></div>
<p>B:</p>
<div class="codehilite" data-code-language="CoffeeScript"><pre><span></span><code><span class="nx">expect</span><span class="w"></span>
<span class="w">    </span><span class="nv">fibs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">computeFibonacciNumbersUpTo</span><span class="w"> </span><span class="mi">5</span><span class="w"></span>

<span class="w">    </span><span class="nx">fibs</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="p">]</span><span class="w"></span>


<span class="nx">expect</span><span class="w"></span>
<span class="w">    </span><span class="nv">fibs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">computeFibonacciNumbersUpTo</span><span class="w"> </span><span class="mi">20</span><span class="w"></span>

<span class="w">    </span><span class="nx">fibs</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="p">,</span><span class="w"> </span><span class="mi">8</span><span class="p">,</span><span class="w"> </span><span class="mi">13</span><span class="p">]</span><span class="w"></span>
</code></pre></div>
<p>C:</p>
<div class="codehilite" data-code-language="CoffeeScript"><pre><span></span><code><span class="nx">expect</span><span class="w"></span>
<span class="w">    </span><span class="nv">fibs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">computeFibonacciNumbersUpTo</span><span class="w"> </span><span class="mi">5</span><span class="w"></span>
<span class="w">    </span><span class="nx">fibs</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="p">]</span><span class="w"></span>

<span class="nx">expect</span><span class="w"></span>
<span class="w">    </span><span class="nv">fibs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">computeFibonacciNumbersUpTo</span><span class="w"> </span><span class="mi">20</span><span class="w"></span>
<span class="w">    </span><span class="nx">fibs</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="p">,</span><span class="w"> </span><span class="mi">8</span><span class="p">,</span><span class="w"> </span><span class="mi">13</span><span class="p">]</span><span class="w"></span>
</code></pre></div>
<p>So in the examples, i would say, i dislike A. I think B is ok but still not great. I would definitely personally write C.</p>
<p>Maybe if there were more lines in the definition or if there were curly braces instead of tabs, i would feel better about B, but neither of those are the case here.</p>



<a name="295855778"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/testing/near/295855778" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/testing.html#295855778">(Aug 29 2022 at 14:28)</a>:</h4>
<p>I guess also if there were explicit comments specifying the stages, then more spacing would also make sense to me.</p>



<a name="295857778"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/testing/near/295857778" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/testing.html#295857778">(Aug 29 2022 at 14:39)</a>:</h4>
<p>interesting! I personally prefer A but I'm open to any of them</p>



<a name="295857856"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/testing/near/295857856" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/testing.html#295857856">(Aug 29 2022 at 14:40)</a>:</h4>
<p>I'm curious what others think</p>



<a name="295859100"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/testing/near/295859100" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jan kili <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/testing.html#295859100">(Aug 29 2022 at 14:47)</a>:</h4>
<p>Yeah, if we want a hyperconsistent rule (not allowing C in short cases, for example) then I prefer B</p>



<a name="295859189"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/testing/near/295859189" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jan kili <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/testing.html#295859189">(Aug 29 2022 at 14:47)</a>:</h4>
<p>I always personally do double newline between top-level function definitions in other languages</p>



<a name="295942636"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/testing/near/295942636" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/testing.html#295942636">(Aug 29 2022 at 15:54)</a>:</h4>
<p>I think that's orthogonal to be honest - I think we either ought to have 1 or 2 spaces between all top-level declarations regardless of how we format <code>expect</code></p>



<a name="295942819"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/testing/near/295942819" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/testing.html#295942819">(Aug 29 2022 at 15:55)</a>:</h4>
<p>relatedly, how do people feel about the same thing except when it has to do with defs?</p>



<a name="295942942"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/testing/near/295942942" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/testing.html#295942942">(Aug 29 2022 at 15:56)</a>:</h4>
<p>e.g.</p>
<div class="codehilite" data-code-language="Elixir"><pre><span></span><code><span class="n">foo</span><span class="w"> </span><span class="o">=</span><span class="w"></span>
<span class="w">    </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="w">    </span><span class="n">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">2</span><span class="w"></span>
</code></pre></div>
<p>vs.</p>
<div class="codehilite" data-code-language="Elixir"><pre><span></span><code><span class="n">foo</span><span class="w"> </span><span class="o">=</span><span class="w"></span>
<span class="w">    </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>

<span class="w">    </span><span class="n">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">2</span><span class="w"></span>
</code></pre></div>



<a name="295942996"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/testing/near/295942996" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/testing.html#295942996">(Aug 29 2022 at 15:56)</a>:</h4>
<p>do people prefer the def with or without the blank line?</p>



<a name="295943068"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/testing/near/295943068" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/testing.html#295943068">(Aug 29 2022 at 15:56)</a>:</h4>
<p>(and I guess relevantly, is that preference the same as your preference for <code>expect</code>, or different?)</p>



<a name="295976465"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/testing/near/295976465" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/testing.html#295976465">(Aug 29 2022 at 18:56)</a>:</h4>
<p>For me, exact same comments I made about expect.</p>



<a name="295989217"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/testing/near/295989217" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Carroll <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/testing.html#295989217">(Aug 29 2022 at 20:05)</a>:</h4>
<p>Ditto. There's nothing special for me about expect, I was talking generally about the blank line before the expression value.</p>



<a name="296247280"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/testing/near/296247280" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jan kili <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/testing.html#296247280">(Aug 31 2022 at 02:08)</a>:</h4>
<p>To be honest, this feels like a growing avalanche of reasonable incremental expansions... but at it's core these tests should not take up this much space.</p>



<a name="296247317"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/testing/near/296247317" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jan kili <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/testing.html#296247317">(Aug 31 2022 at 02:10)</a>:</h4>
<p>Options A, B, and C above are 5x, 6x, and 4x (respectively) the line count of what I initially wrote:</p>
<div class="codehilite"><pre><span></span><code>expect computeFibonacciNumbersUpTo 5 == [1, 2, 3, 5]
expect computeFibonacciNumbersUpTo 20 == [1, 2, 3, 5, 8, 13]
</code></pre></div>



<a name="296247368"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/testing/near/296247368" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jan kili <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/testing.html#296247368">(Aug 31 2022 at 02:10)</a>:</h4>
<p>(We could call this Option D, I suppose, but I don't have a holistic formatting algorithm yet)</p>



<a name="296247464"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/testing/near/296247464" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jan kili <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/testing.html#296247464">(Aug 31 2022 at 02:12)</a>:</h4>
<p>Here's another example, to illustrate the value of a concise/terse test format:</p>
<div class="codehilite"><pre><span></span><code>isPrime = \n -&gt;
    when n is
        1 -&gt; False
        _ -&gt; (calculateFactors n) == [1, n]

expect isPrime 1 |&gt; Bool.not
expect isPrime 2
expect isPrime 5
expect isPrime 19
expect isPrime 20 |&gt; Bool.not
expect isPrime 13195 |&gt; Bool.not
</code></pre></div>



<a name="296247558"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/testing/near/296247558" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/testing.html#296247558">(Aug 31 2022 at 02:14)</a>:</h4>
<p>I feel like this is maybe going farther from the original question, but your formatting made me realize something. Realistically in more other languages, would write a table drive test for these examples.</p>
<p>Just a list of tuples (or anonymous structs) of arguments to the function and expected results. Then a simple for loop of expects. Can we do something similar in roc without too much verbosity? Do we have plans for it?</p>



<a name="296247573"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/testing/near/296247573" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jan kili <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/testing.html#296247573">(Aug 31 2022 at 02:14)</a>:</h4>
<p>(This latest example doesn't require multi-line <code>expect</code>s because it doesn't contain any <code>==</code>s to want to analyze.)</p>



<a name="296247599"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/testing/near/296247599" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jan kili <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/testing.html#296247599">(Aug 31 2022 at 02:15)</a>:</h4>
<p>(but in general I want to write several tests for each few-line function, and those tests will usually contain a comparison like <code>==</code> or <code>&gt;</code> etc)</p>



<a name="296247632"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/testing/near/296247632" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jan kili <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/testing.html#296247632">(Aug 31 2022 at 02:15)</a>:</h4>
<p><span class="user-mention" data-user-id="343810">@Brendan Hansknecht</span> Great point!</p>



<a name="296247810"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/testing/near/296247810" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jan kili <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/testing.html#296247810">(Aug 31 2022 at 02:18)</a>:</h4>
<p>Maybe something like</p>
<div class="codehilite"><pre><span></span><code>expect [
    (isPrime 1, `==`, False),
    (isPrime 2, `==`, True),
    (isPrime 5, `==`, True),
    (isPrime 19, `==`, True),
    (isPrime 20, `==`, False),
    (isPrime 13195, `==`, False),
]
</code></pre></div>



<a name="296247880"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/testing/near/296247880" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jan kili <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/testing.html#296247880">(Aug 31 2022 at 02:19)</a>:</h4>
<p>This still makes room for defs inside a multi-line<code>expect</code> (not shown here), but LoC scales sublinearly with test count</p>



<a name="296247951"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/testing/near/296247951" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jan kili <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/testing.html#296247951">(Aug 31 2022 at 02:20)</a>:</h4>
<p>Maybe <code>expects</code>?</p>



<a name="296247965"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/testing/near/296247965" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/testing.html#296247965">(Aug 31 2022 at 02:20)</a>:</h4>
<p>Why repeat the method and comparison on every line?</p>



<a name="296247992"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/testing/near/296247992" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/testing.html#296247992">(Aug 31 2022 at 02:21)</a>:</h4>
<p>In this case I guess it is readable, but in other cases it may be quite verbose.</p>



<a name="296248009"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/testing/near/296248009" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jan kili <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/testing.html#296248009">(Aug 31 2022 at 02:22)</a>:</h4>
<p>Hmm...</p>
<div class="codehilite"><pre><span></span><code>expectsOf isPrime [
    ((1,), False),
    ((2,), True),
    ((5,), True),
    ((19,), True),
    ((20,), False),
    ((13195,), False),
]
</code></pre></div>



<a name="296248057"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/testing/near/296248057" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/testing.html#296248057">(Aug 31 2022 at 02:22)</a>:</h4>
<p>Yeah, i was thinking something like that</p>



<a name="296248063"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/testing/near/296248063" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/testing.html#296248063">(Aug 31 2022 at 02:22)</a>:</h4>
<p>Where isPrime would be any function/lambda.</p>



<a name="296248097"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/testing/near/296248097" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jan kili <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/testing.html#296248097">(Aug 31 2022 at 02:23)</a>:</h4>
<p>I love it</p>



<a name="296248125"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/testing/near/296248125" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jan kili <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/testing.html#296248125">(Aug 31 2022 at 02:23)</a>:</h4>
<p>We could still make room for non-<code>==</code> comparisons, but I like this multiplicity concept</p>



<a name="296248210"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/testing/near/296248210" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jan kili <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/testing.html#296248210">(Aug 31 2022 at 02:24)</a>:</h4>
<p>If we don't make test syntax concise/terse/efficient &amp; readable, I predict that we'll end up with <code>foo.roc</code> &amp; <code>foo.tests.roc</code> files - not a terrible fate, but counter to the stated goals of the <code>expect</code> syntax.</p>



<a name="296248580"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/testing/near/296248580" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jan kili <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/testing.html#296248580">(Aug 31 2022 at 02:31)</a>:</h4>
<p>Because these incrementally-reasonable formatting algorithm decisions are leading to unreasonable formatting:</p>
<div class="codehilite"><pre><span></span><code>rangeExclusive = \low, high -&gt;
    if low == high then [] else List.range low high


expect
    values = rangeExclusive 1 1

    values == []


expect
    values = rangeExclusive 1 2

    values == [1]


expect
    values = rangeExclusive 1 3

    values == [1, 2]


expect
    values = rangeExclusive 2 3

    values == [2]


expect
    values = rangeExclusive 3 3

    values == []
</code></pre></div>



<a name="296248740"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/testing/near/296248740" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jan kili <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/testing.html#296248740">(Aug 31 2022 at 02:34)</a>:</h4>
<p>vs.</p>
<div class="codehilite"><pre><span></span><code>rangeExclusive = \low, high -&gt;
    if low == high then [] else List.range low high


expectsOf rangeExclusive [
    ((1, 1), []),
    ((1, 2), [1]),
    ((1, 3), [1, 2]),
    ((2, 3), [2]),
    ((3, 3), []),
]
</code></pre></div>



<a name="296248856"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/testing/near/296248856" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jan kili <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/testing.html#296248856">(Aug 31 2022 at 02:36)</a>:</h4>
<p>(to be fair, I'm shifting formatter problems onto the compiler by proposing new keywords/behavior, but that might be the best approach when there's no great formatter-only solution)</p>



<a name="296268671"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/testing/near/296268671" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Carroll <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/testing.html#296268671">(Aug 31 2022 at 07:20)</a>:</h4>
<p>Hmm but a lot of the improvement is coming from eliminating that unnecessary <code>values</code> variable.<br>
You could write the first set of examples more concisely like this<br>
<code>expect rangeExclusive 3 3 == []</code><br>
I know there can be more complex cases where you need lots of variables.. but then the <code>expectsOf</code>case wouldn't be as neat either!</p>



<a name="296269090"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/testing/near/296269090" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Carroll <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/testing.html#296269090">(Aug 31 2022 at 07:23)</a>:</h4>
<p>With today's syntax you can implement the <code>expectsOf</code> operator using <code>List.map</code> and <code>List.all</code>.</p>
<div class="codehilite" data-code-language="Elm"><pre><span></span><code><span class="nv">expect</span><span class="w"> </span><span class="kt">List</span><span class="nf">.</span><span class="nv">map</span><span class="w"> </span><span class="p">[</span><span class="w"></span>
<span class="w">    </span><span class="p">((</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">),</span><span class="w"> </span><span class="p">[]),</span><span class="w"></span>
<span class="w">    </span><span class="p">((</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">),</span><span class="w"> </span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span><span class="w"></span>
<span class="w">    </span><span class="p">((</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">),</span><span class="w"> </span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">]),</span><span class="w"></span>
<span class="w">    </span><span class="p">((</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">),</span><span class="w"> </span><span class="p">[</span><span class="mi">2</span><span class="p">]),</span><span class="w"></span>
<span class="w">    </span><span class="p">((</span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">),</span><span class="w"> </span><span class="p">[]),</span><span class="w"></span>
<span class="p">]</span><span class="w"> </span><span class="nf">\</span><span class="p">((</span><span class="nv">a</span><span class="p">,</span><span class="w"> </span><span class="nv">b</span><span class="p">),</span><span class="w"> </span><span class="nv">out</span><span class="p">)</span><span class="w"> </span><span class="nf">-&gt;</span><span class="w"> </span><span class="nv">rangeExclusive</span><span class="w"> </span><span class="nv">a</span><span class="w"> </span><span class="nv">b</span><span class="w"> </span><span class="nf">==</span><span class="w"> </span><span class="nv">out</span><span class="w"></span>
<span class="nf">|&gt;</span><span class="w"> </span><span class="kt">List</span><span class="nf">.</span><span class="nv">all</span><span class="w"></span>
</code></pre></div>



<a name="296269253"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/testing/near/296269253" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Carroll <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/testing.html#296269253">(Aug 31 2022 at 07:25)</a>:</h4>
<p>Then you could extract that logic as a helper function</p>



<a name="296269764"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/testing/near/296269764" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Carroll <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/testing.html#296269764">(Aug 31 2022 at 07:29)</a>:</h4>
<div class="codehilite" data-code-language="Elm"><pre><span></span><code><span class="nv">testLotsOfThings</span><span class="w"> </span><span class="nf">=</span><span class="w"> </span><span class="nf">\</span><span class="nv">f</span><span class="p">,</span><span class="w"> </span><span class="nv">testCases</span><span class="w"> </span><span class="nf">-&gt;</span><span class="w"> </span><span class="kt">List</span><span class="nf">.</span><span class="nv">map</span><span class="w"> </span><span class="nv">testCases</span><span class="w"> </span><span class="p">(</span><span class="nf">\</span><span class="p">((</span><span class="nv">a</span><span class="p">,</span><span class="w"> </span><span class="nv">b</span><span class="p">),</span><span class="w"> </span><span class="nv">out</span><span class="p">)</span><span class="w"> </span><span class="nf">-&gt;</span><span class="w"> </span><span class="nv">f</span><span class="w"> </span><span class="nv">a</span><span class="w"> </span><span class="nv">b</span><span class="w"> </span><span class="nf">==</span><span class="w"> </span><span class="nv">out</span><span class="p">)</span><span class="w"> </span><span class="nf">|&gt;</span><span class="w"> </span><span class="kt">List</span><span class="nf">.</span><span class="nv">all</span><span class="w"></span>
</code></pre></div>



<a name="296286117"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/testing/near/296286117" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anton <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/testing.html#296286117">(Aug 31 2022 at 09:21)</a>:</h4>
<p>I think the <code>values</code> variable is only needed for now so it can be printed on test failure but I don't think we plan to require these variables in the long term right?</p>



<a name="296287442"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/testing/near/296287442" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anton <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/testing.html#296287442">(Aug 31 2022 at 09:30)</a>:</h4>
<p>Given how often they will be used I do see the value in introducing <code>expectsOf</code> (or perhaps <code>expectAll</code>).<br>
<code>expect isPrime 20 |&gt; Bool.not</code> also does not read well. <code>expectFalse isPrime 20</code>feels very nice.</p>



<a name="296329842"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/testing/near/296329842" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/testing.html#296329842">(Aug 31 2022 at 13:55)</a>:</h4>
<p>Note on the <a href="http://list.map">list.map</a> version. It loses two important properties that I would hope expectof would have.</p>
<ol>
<li>Reporting on each test case individually. When test case 3 fails, i would want to see it's args and results printed out.</li>
<li>Reporting on all test cases even if one fails. If test case 3 and 5 fail, i would hope that with one run of the tests, both failures would get reported.</li>
</ol>



<a name="296355885"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/testing/near/296355885" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Carroll <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/testing.html#296355885">(Aug 31 2022 at 15:25)</a>:</h4>
<p>Ah yes, good points!</p>



<hr><p>Last updated: Mar 01 2026 at 12:20 UTC</p>
</html>