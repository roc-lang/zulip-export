<html>
<head><meta charset="utf-8"><title>Unknown tag, known payload · beginners · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/index.html">beginners</a></h2>
<h3>Topic: <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Unknown.20tag.2C.20known.20payload.html">Unknown tag, known payload</a></h3>

<hr>

<base href="https://roc.zulipchat.com">

<head><link href="https://roc-lang.github.io/zulip-export/style.css" rel="stylesheet"></head>

<a name="317228037"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Unknown%20tag%2C%20known%20payload/near/317228037" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tanner Nielsen <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Unknown.20tag.2C.20known.20payload.html#317228037">(Dec 21 2022 at 18:58)</a>:</h4>
<p><strong>Questions</strong></p>
<p>I've been experimenting with Roc for the last several days, searching Zulip &amp; GitHub, but I haven't found the answer to the following related questions:</p>
<ol>
<li>Is it possible to access a Tag's payload without knowing the non-payload portion of the tag?</li>
<li>Is it possible to constrain a type such that is only accepts tags with a particular payload shape?</li>
</ol>
<p><strong>Motivating use case</strong></p>
<p>I'm working on some generic functions that help model state machines and generate diagrams from them (similar to <a href="https://stately.ai/viz">XState</a> from the TypeScript world).  I'd like the input that defines the state machine to be a list of tags, representing every possible state transition.  For example:</p>
<div class="codehilite"><pre><span></span><code>matterStateMachine = stateMachine [
    Melt Solid Liquid,
    Evaporate Liquid Gas,
    Condense Gas Liquid,
    Freeze Liquid Solid,
]
</code></pre></div>
<p>This is a really concise way to simultaneously infer the desired types _and_ list every possible transition, a common technique in TypeScript.  I can do a lot with this information alone:</p>
<ol>
<li>With every possible transition, I can infer every possible state</li>
<li>With every possible transition, I can render a state diagram (e.g., as mermaid or even XState)</li>
<li>With the inferred types, I can enforce that every state &amp; transition is accounted for when rendering the diagram (converting state &amp; transition tags to strings)</li>
<li>With the inferred types, I can enforce that every state transition has an implementation</li>
</ol>
<p>The problem is that I currently have no way to enforce the shape of the tag payloads.  And even if I knew how to do that, I don't know how I could access these tag payloads without knowing the specific tags ahead of time (which won't work for a generic <code>stateMachine</code> function).</p>
<p>Any thoughts or advice on this issue?</p>



<a name="317230315"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Unknown%20tag%2C%20known%20payload/near/317230315" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Unknown.20tag.2C.20known.20payload.html#317230315">(Dec 21 2022 at 19:10)</a>:</h4>
<p>so if you want to enforce a shape, I'd use a record instead:</p>
<div class="codehilite" data-code-language="TypeScript"><pre><span></span><code><span class="nx">matterStateMachine</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">stateMachine</span><span class="w"> </span><span class="p">[</span><span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="w"> </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="kt">Melt</span><span class="p">,</span><span class="w"> </span><span class="nx">from</span><span class="o">:</span><span class="w"> </span><span class="kt">Solid</span><span class="p">,</span><span class="w"> </span><span class="nx">to</span><span class="o">:</span><span class="w"> </span><span class="kt">Liquid</span><span class="w"> </span><span class="p">},</span><span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="w"> </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="kt">Evaporate</span><span class="p">,</span><span class="w"> </span><span class="nx">from</span><span class="o">:</span><span class="w"> </span><span class="kt">Liquid</span><span class="p">,</span><span class="w"> </span><span class="nx">to</span><span class="o">:</span><span class="w"> </span><span class="kt">Gas</span><span class="w"> </span><span class="p">},</span><span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="w"> </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="kt">Condense</span><span class="p">,</span><span class="w"> </span><span class="nx">from</span><span class="o">:</span><span class="w"> </span><span class="kt">Gas</span><span class="p">,</span><span class="w"> </span><span class="nx">to</span><span class="o">:</span><span class="w"> </span><span class="kt">Liquid</span><span class="w"> </span><span class="p">},</span><span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="w"> </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="kt">Freeze</span><span class="p">,</span><span class="w"> </span><span class="nx">from</span><span class="o">:</span><span class="w"> </span><span class="kt">Liquid</span><span class="p">,</span><span class="w"> </span><span class="nx">to</span><span class="o">:</span><span class="w"> </span><span class="kt">Solid</span><span class="w"> </span><span class="p">},</span><span class="w"></span>
<span class="p">]</span><span class="w"></span>
</code></pre></div>
<p>here the type of <code>stateMachine</code> would be:</p>
<div class="codehilite" data-code-language="Elm"><pre><span></span><code><span class="nv">stateMachine</span><span class="w"> </span><span class="nf">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nv">name</span><span class="w"> </span><span class="nf">:</span><span class="w"> </span><span class="nf">*</span><span class="p">,</span><span class="w"> </span><span class="nv">from</span><span class="w"> </span><span class="nf">:</span><span class="w"> </span><span class="nf">*</span><span class="p">,</span><span class="w"> </span><span class="nv">to</span><span class="w"> </span><span class="nf">:</span><span class="w"> </span><span class="nf">*</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="nf">-&gt;</span><span class="w"> </span><span class="kt">StateMachine</span><span class="w"></span>
</code></pre></div>



<a name="317230489"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Unknown%20tag%2C%20known%20payload/near/317230489" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Unknown.20tag.2C.20known.20payload.html#317230489">(Dec 21 2022 at 19:11)</a>:</h4>
<p>we don't have this fully implemented yet, but in the future you could more concisely do it with a tuple:</p>
<div class="codehilite" data-code-language="TypeScript"><pre><span></span><code><span class="nx">matterStateMachine</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">stateMachine</span><span class="w"> </span><span class="p">[</span><span class="w"></span>
<span class="w">    </span><span class="p">(</span><span class="nx">Melt</span><span class="p">,</span><span class="w"> </span><span class="nx">Solid</span><span class="p">,</span><span class="w"> </span><span class="nx">Liquid</span><span class="p">),</span><span class="w"></span>
<span class="w">    </span><span class="p">(</span><span class="nx">Evaporate</span><span class="p">,</span><span class="w"> </span><span class="nx">Liquid</span><span class="p">,</span><span class="w"> </span><span class="nx">Gas</span><span class="p">),</span><span class="w"></span>
<span class="w">    </span><span class="p">(</span><span class="nx">Condense</span><span class="p">,</span><span class="w"> </span><span class="nx">Gas</span><span class="p">,</span><span class="w"> </span><span class="nx">Liquid</span><span class="p">),</span><span class="w"></span>
<span class="w">    </span><span class="p">(</span><span class="nx">Freeze</span><span class="p">,</span><span class="w"> </span><span class="nx">Liquid</span><span class="p">,</span><span class="w"> </span><span class="nx">Solid</span><span class="p">),</span><span class="w"></span>
<span class="p">]</span><span class="w"></span>
</code></pre></div>
<p>here the type of <code>stateMachine</code> would be:</p>
<div class="codehilite" data-code-language="Elm"><pre><span></span><code><span class="nv">stateMachine</span><span class="w"> </span><span class="nf">:</span><span class="w"> </span><span class="p">(</span><span class="nf">*</span><span class="p">,</span><span class="w"> </span><span class="nf">*</span><span class="p">,</span><span class="w"> </span><span class="nf">*</span><span class="p">)</span><span class="w"> </span><span class="nf">-&gt;</span><span class="w"> </span><span class="kt">StateMachine</span><span class="w"></span>
</code></pre></div>



<a name="317230934"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Unknown%20tag%2C%20known%20payload/near/317230934" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Unknown.20tag.2C.20known.20payload.html#317230934">(Dec 21 2022 at 19:14)</a>:</h4>
<p>however, currently you'd have a tough time drawing diagrams from this because there's currently no way to convert a tag to a string</p>



<a name="317231026"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Unknown%20tag%2C%20known%20payload/near/317231026" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Unknown.20tag.2C.20known.20payload.html#317231026">(Dec 21 2022 at 19:14)</a>:</h4>
<p>we have a planned <code>Str.inspect : * -&gt; Str</code> that would convert (for eaxmple) <code>Foo</code> to the string <code>"Foo"</code>, which sounds like a reasonable fit for this use case</p>



<a name="317231201"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Unknown%20tag%2C%20known%20payload/near/317231201" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tanner Nielsen <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Unknown.20tag.2C.20known.20payload.html#317231201">(Dec 21 2022 at 19:15)</a>:</h4>
<p>Thanks for the fast reply <span class="user-mention" data-user-id="281383">@Richard Feldman</span> !  Unfortunately I don't think this would infer the types that I need.  Using the example with records, the inferred type would be</p>
<div class="codehilite"><pre><span></span><code>List {
    name : [Condense, Evaporate, Freeze, Melt],
    from : [Gas, Liquid, Solid],
    to : [Gas, Liquid, Solid],
}
</code></pre></div>
<p>This would allow for things like <code>{name: Condense, from: Solid, to: Liquid}</code>, which isn't desired.</p>



<a name="317231384"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Unknown%20tag%2C%20known%20payload/near/317231384" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Unknown.20tag.2C.20known.20payload.html#317231384">(Dec 21 2022 at 19:16)</a>:</h4>
<p>gotcha, maybe it would help to see what the TypeScript version looks like</p>



<a name="317231422"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Unknown%20tag%2C%20known%20payload/near/317231422" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Unknown.20tag.2C.20known.20payload.html#317231422">(Dec 21 2022 at 19:16)</a>:</h4>
<p>to see what constraints you're going for <span aria-label="big smile" class="emoji emoji-1f604" role="img" title="big smile">:big_smile:</span></p>



<a name="317231562"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Unknown%20tag%2C%20known%20payload/near/317231562" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tanner Nielsen <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Unknown.20tag.2C.20known.20payload.html#317231562">(Dec 21 2022 at 19:17)</a>:</h4>
<p>This is why I wanted to use a tag union as input, because the type that is inferred is very strict:</p>
<div class="codehilite"><pre><span></span><code>[
    Melt [Solid] [Liquid],
    Evaporate [Liquid] [Solid],
    Condense [Gas] [Liquid],
    Freeze [Liquid] [Solid],
]
</code></pre></div>



<a name="317231788"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Unknown%20tag%2C%20known%20payload/near/317231788" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tanner Nielsen <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Unknown.20tag.2C.20known.20payload.html#317231788">(Dec 21 2022 at 19:18)</a>:</h4>
<p>I can whip up something in TypeScript if that would help!  Just doesn't map perfectly because tagged unions have to be emulated in TypeScript via untagged unions</p>



<a name="317232047"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Unknown%20tag%2C%20known%20payload/near/317232047" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tanner Nielsen <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Unknown.20tag.2C.20known.20payload.html#317232047">(Dec 21 2022 at 19:20)</a>:</h4>
<p>I am also aware of the Tag to Str issue <span aria-label="smile" class="emoji emoji-1f642" role="img" title="smile">:smile:</span>  For now I plan on just requiring the user to provide a function that maps the tags to strings, which might be helpful anyway if the diagram needs to use different text than just the tag name</p>



<a name="317233565"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Unknown%20tag%2C%20known%20payload/near/317233565" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tanner Nielsen <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Unknown.20tag.2C.20known.20payload.html#317233565">(Dec 21 2022 at 19:29)</a>:</h4>
<p>Here's a TypeScript translation (<a href="https://www.typescriptlang.org/play#code/C4TwDgpgBAKghgcwDwDk4FtoQB7AgOwBMBnKY4AJwEt8EAaKABThABsB7OQqHPI0gK74A1vnYB3fAD4oAXgCwAKCgqoAbTSYGzNp0IBdANxKloSLApx8xKsCrt8qDFlwESZSjXpQAYhXboPK78HtS0DDDsQXzu5GEIMgrKqvDImhAMan4BEez6UsaKSgBmQgDGdg5QlFY2lY7p0W6kcV4M2YG8zaFtsFFdIa20UgAUSqpQ+M4AXFDpdOOqxf7oAPqzHQvJKsDss5FbAJT7lta29g3O7Su5MgDeiyoUEMACFPjqU1rqywGrDLt9EYlABfEyKUr4CoXDxwPAAWTgZQAFjQIEgYKc6hdSAN3ABBCiWEAYrHnBxIIbeKkMKlSeljbbVMn1YgnWrk6xbCbPIgQCizEY1M71dkinFqfACdAAI35+kOchkNKUioeTIA9BqoAA6PWg8FlBzkKDoOF4CgAZWAcIgiJRaLksIRSNR+AgjImakeE2ZHPqIwA5PCIKxgIGGIHLexWFRCBGoIGADJUACOAjjgcO3N9OxZFyDAFEAG5wMDsSx4BPJtMZ+ORgDicGIWZzueF2IcQYAwg5CARiBBq02W5GU+nM9mfRMO5yg34IBAAF5Dse1zOR6Ox+NTpn6Nt+8VVWT3aeqLVQKjFKAgdgCKAVCisDVldDcZHsYv8qCf78AA1neo-1pTwKmqcAIFIOBnkvfBin5Z5CDPFQLzgVgOHELweC-CgQAfZtoF2KA5SgJEjSEPBuGKCtkKgZ5XneQ9O3wNQAAZgSZEEjkKIA">Playground link</a>):</p>
<div class="codehilite" data-code-language="TypeScript"><pre><span></span><code><span class="kr">type</span><span class="w"> </span><span class="nx">Tag</span><span class="p">&lt;</span><span class="nt">Name</span> <span class="na">extends</span> <span class="na">string</span><span class="err">,</span> <span class="na">Payload</span> <span class="na">extends</span> <span class="na">unknown</span><span class="p">&gt;</span><span class="w"> </span><span class="o">=</span><span class="w"></span>
<span class="w">    </span><span class="p">[</span><span class="nx">Name</span><span class="p">,</span><span class="w"> </span><span class="nx">Payload</span><span class="p">];</span><span class="w"></span>

<span class="kr">type</span><span class="w"> </span><span class="nx">Transition</span><span class="p">&lt;</span><span class="nt">Name</span> <span class="na">extends</span> <span class="na">string</span><span class="err">,</span> <span class="na">From</span> <span class="na">extends</span> <span class="na">string</span><span class="err">,</span> <span class="na">To</span> <span class="na">extends</span> <span class="na">string</span><span class="p">&gt;</span><span class="w"> </span><span class="o">=</span><span class="w"></span>
<span class="w">    </span><span class="nx">Tag</span><span class="p">&lt;</span><span class="nt">Name</span><span class="err">,</span> <span class="err">[</span><span class="na">From</span><span class="err">,</span> <span class="na">To</span><span class="err">]</span><span class="p">&gt;;</span><span class="w"></span>

<span class="kd">function</span><span class="w"> </span><span class="nx">transition</span><span class="p">&lt;</span><span class="nt">Name</span> <span class="na">extends</span> <span class="na">string</span><span class="err">,</span> <span class="na">From</span> <span class="na">extends</span> <span class="na">string</span><span class="err">,</span> <span class="na">To</span> <span class="na">extends</span> <span class="na">string</span><span class="p">&gt;(</span><span class="w"></span>
<span class="w">    </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="kt">Name</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="nx">from_</span><span class="o">:</span><span class="w"> </span><span class="kt">From</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="nx">to</span><span class="o">:</span><span class="w"> </span><span class="kt">To</span><span class="p">,</span><span class="w"></span>
<span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="nx">Transition</span><span class="p">&lt;</span><span class="nt">Name</span><span class="err">,</span> <span class="na">From</span><span class="err">,</span> <span class="na">To</span><span class="p">&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="p">[</span><span class="nx">name</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="nx">from_</span><span class="p">,</span><span class="w"> </span><span class="nx">to</span><span class="p">]];</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="kd">function</span><span class="w"> </span><span class="nx">stateMachine</span><span class="p">&lt;</span><span class="nt">Transitions</span> <span class="na">extends</span> <span class="na">Array</span><span class="err">&lt;</span><span class="na">Transition</span><span class="err">&lt;</span><span class="na">string</span><span class="err">,</span> <span class="na">string</span><span class="err">,</span> <span class="na">string</span><span class="p">&gt;</span><span class="o">&gt;&gt;</span><span class="p">(</span><span class="w"></span>
<span class="w">    </span><span class="nx">transitions</span><span class="o">:</span><span class="w"> </span><span class="kt">Transitions</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="nx">render</span><span class="o">:</span><span class="w"> </span><span class="p">(</span><span class="nx">transition</span><span class="o">:</span><span class="w"> </span><span class="kt">Transitions</span><span class="p">[</span><span class="kt">number</span><span class="p">])</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="kt">string</span><span class="p">,</span><span class="w"></span>
<span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="c1">// ...</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="kd">const</span><span class="w"> </span><span class="nx">matterStateMachine</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">stateMachine</span><span class="p">(</span><span class="w"></span>
<span class="w">    </span><span class="p">[</span><span class="w"></span>
<span class="w">        </span><span class="nx">transition</span><span class="p">(</span><span class="s1">'Melt'</span><span class="p">,</span><span class="w"> </span><span class="s1">'Solid'</span><span class="p">,</span><span class="w"> </span><span class="s1">'Liquid'</span><span class="p">),</span><span class="w"></span>
<span class="w">        </span><span class="nx">transition</span><span class="p">(</span><span class="s1">'Evaporate'</span><span class="p">,</span><span class="w"> </span><span class="s1">'Liquid'</span><span class="p">,</span><span class="w"> </span><span class="s1">'Gas'</span><span class="p">),</span><span class="w"></span>
<span class="w">        </span><span class="nx">transition</span><span class="p">(</span><span class="s1">'Condense'</span><span class="p">,</span><span class="w"> </span><span class="s1">'Gas'</span><span class="p">,</span><span class="w"> </span><span class="s1">'Liquid'</span><span class="p">),</span><span class="w"></span>
<span class="w">        </span><span class="nx">transition</span><span class="p">(</span><span class="s1">'Freeze'</span><span class="p">,</span><span class="w"> </span><span class="s1">'Liquid'</span><span class="p">,</span><span class="w"> </span><span class="s1">'Solid'</span><span class="p">),</span><span class="w"></span>
<span class="w">    </span><span class="p">],</span><span class="w"></span>
<span class="w">    </span><span class="nx">transition</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="c1">// if you ctrl/cmd hover over `transition`, strict types are inferred</span><span class="w"></span>
<span class="w">        </span><span class="c1">// allowing every case to be accounted for</span><span class="w"></span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nx">transition</span><span class="p">[</span><span class="mf">0</span><span class="p">];</span><span class="w"></span>
<span class="w">    </span><span class="p">},</span><span class="w"></span>
<span class="p">);</span><span class="w"></span>
</code></pre></div>



<a name="317235084"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Unknown%20tag%2C%20known%20payload/near/317235084" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Unknown.20tag.2C.20known.20payload.html#317235084">(Dec 21 2022 at 19:38)</a>:</h4>
<p>thanks! Does this TypeScript version capture all the constraints you're looking for? Or are there more constraints on top of that?</p>



<a name="317235425"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Unknown%20tag%2C%20known%20payload/near/317235425" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tanner Nielsen <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Unknown.20tag.2C.20known.20payload.html#317235425">(Dec 21 2022 at 19:40)</a>:</h4>
<p>It does! Specifically it infers the strict types and only allows <code>Transition</code> objects as input</p>



<a name="317235632"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Unknown%20tag%2C%20known%20payload/near/317235632" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Unknown.20tag.2C.20known.20payload.html#317235632">(Dec 21 2022 at 19:42)</a>:</h4>
<p>I could still give it <code>transition('Condense', 'Solid', 'Liquid')</code> though, right?</p>



<a name="317235900"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Unknown%20tag%2C%20known%20payload/near/317235900" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tanner Nielsen <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Unknown.20tag.2C.20known.20payload.html#317235900">(Dec 21 2022 at 19:44)</a>:</h4>
<p>You could if that's what the state machine was allowed to do, but that first input is essentially the definition of what's possible in the state machine.  The render function (in the TypeScript example) would infer no such combination from the input shown above.</p>



<a name="317236276"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Unknown%20tag%2C%20known%20payload/near/317236276" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Unknown.20tag.2C.20known.20payload.html#317236276">(Dec 21 2022 at 19:46)</a>:</h4>
<p>hm, ok I'm missing a part of the motivation</p>



<a name="317236415"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Unknown%20tag%2C%20known%20payload/near/317236415" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Unknown.20tag.2C.20known.20payload.html#317236415">(Dec 21 2022 at 19:47)</a>:</h4>
<p>so you have your <code>matterStateMachine</code> which is defined by this array of transitions</p>



<a name="317236482"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Unknown%20tag%2C%20known%20payload/near/317236482" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Unknown.20tag.2C.20known.20payload.html#317236482">(Dec 21 2022 at 19:47)</a>:</h4>
<p><code>matterStateMachine</code> is a constant which holds onto the data it was given and then can output a diagram</p>



<a name="317236508"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Unknown%20tag%2C%20known%20payload/near/317236508" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Unknown.20tag.2C.20known.20payload.html#317236508">(Dec 21 2022 at 19:47)</a>:</h4>
<p>what else can <code>matterStateMachine</code> do?</p>



<a name="317236602"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Unknown%20tag%2C%20known%20payload/near/317236602" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Unknown.20tag.2C.20known.20payload.html#317236602">(Dec 21 2022 at 19:48)</a>:</h4>
<p>I think the part I'm missing is why it matters to be able to constrain that type</p>



<a name="317236671"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Unknown%20tag%2C%20known%20payload/near/317236671" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Unknown.20tag.2C.20known.20payload.html#317236671">(Dec 21 2022 at 19:48)</a>:</h4>
<p>like in this example the array is created once, given a function that turns it into a string, and then never used again - so I'm wondering how else it might be used where the constraint might actually come up <span aria-label="big smile" class="emoji emoji-1f604" role="img" title="big smile">:big_smile:</span></p>



<a name="317237251"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Unknown%20tag%2C%20known%20payload/near/317237251" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tanner Nielsen <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Unknown.20tag.2C.20known.20payload.html#317237251">(Dec 21 2022 at 19:52)</a>:</h4>
<p>The render function is an example where the type inferred from the array of transitions is used to ensure that every case is covered (without needing to cover cases that aren't actually possible).  The same could be done for implementing the actual transition function.  I think I might be muddying the waters with an overly complex example...  I'll try to boil it down better in a moment (thank you for your patience)</p>



<a name="317237659"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Unknown%20tag%2C%20known%20payload/near/317237659" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Unknown.20tag.2C.20known.20payload.html#317237659">(Dec 21 2022 at 19:54)</a>:</h4>
<p>no worries! It's something that hasn't come up yet, so I'm eager to understand <span aria-label="smiley" class="emoji emoji-1f603" role="img" title="smiley">:smiley:</span></p>



<a name="317238156"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Unknown%20tag%2C%20known%20payload/near/317238156" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Unknown.20tag.2C.20known.20payload.html#317238156">(Dec 21 2022 at 19:57)</a>:</h4>
<p>would this constrain the render function enough?</p>
<div class="codehilite" data-code-language="Elm"><pre><span></span><code><span class="nv">stateMachine</span><span class="w"> </span><span class="nf">:</span><span class="w"> </span><span class="kt">List</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nv">name</span><span class="p">,</span><span class="w"> </span><span class="nv">from</span><span class="p">,</span><span class="w"> </span><span class="nv">to</span><span class="w"> </span><span class="p">},</span><span class="w"> </span><span class="p">({</span><span class="w"> </span><span class="nv">name</span><span class="p">,</span><span class="w"> </span><span class="nv">from</span><span class="p">,</span><span class="w"> </span><span class="nv">to</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="nf">-&gt;</span><span class="w"> </span><span class="kt">Str</span><span class="p">)</span><span class="w"> </span><span class="nf">-&gt;</span><span class="w"> </span><span class="kt">StateMachine</span><span class="w"></span>
</code></pre></div>
<p>(this is syntax sugar for the following)</p>
<div class="codehilite" data-code-language="Elm"><pre><span></span><code><span class="nv">stateMachine</span><span class="w"> </span><span class="nf">:</span><span class="w"> </span><span class="kt">List</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nv">name</span><span class="w"> </span><span class="nf">:</span><span class="w"> </span><span class="nv">n</span><span class="p">,</span><span class="w"> </span><span class="nv">from</span><span class="w"> </span><span class="nf">:</span><span class="w"> </span><span class="nv">f</span><span class="p">,</span><span class="w"> </span><span class="nv">to</span><span class="w"> </span><span class="nf">:</span><span class="w"> </span><span class="nv">t</span><span class="w"> </span><span class="p">},</span><span class="w"> </span><span class="p">({</span><span class="w"> </span><span class="nv">name</span><span class="w"> </span><span class="nf">:</span><span class="w"> </span><span class="nv">n</span><span class="p">,</span><span class="w"> </span><span class="nv">from</span><span class="w"> </span><span class="nf">:</span><span class="w"> </span><span class="nv">f</span><span class="p">,</span><span class="w"> </span><span class="nv">to</span><span class="nf">:</span><span class="w">  </span><span class="nv">t</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="nf">-&gt;</span><span class="w"> </span><span class="kt">Str</span><span class="p">)</span><span class="w"> </span><span class="nf">-&gt;</span><span class="w"> </span><span class="kt">StateMachine</span><span class="w"></span>
</code></pre></div>



<a name="317238295"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Unknown%20tag%2C%20known%20payload/near/317238295" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Unknown.20tag.2C.20known.20payload.html#317238295">(Dec 21 2022 at 19:58)</a>:</h4>
<p>my guess is that the answer is no, because render would have to account for certain possible combinations that should never come up</p>



<a name="317238766"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Unknown%20tag%2C%20known%20payload/near/317238766" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tanner Nielsen <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Unknown.20tag.2C.20known.20payload.html#317238766">(Dec 21 2022 at 20:01)</a>:</h4>
<p>Exactly.  The above would still allow combinations I wouldn't want to account for</p>



<a name="317238805"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Unknown%20tag%2C%20known%20payload/near/317238805" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Unknown.20tag.2C.20known.20payload.html#317238805">(Dec 21 2022 at 20:01)</a>:</h4>
<p>so is the goal here just to render? Or are there other things that would be done with the state machine</p>



<a name="317238844"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Unknown%20tag%2C%20known%20payload/near/317238844" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Unknown.20tag.2C.20known.20payload.html#317238844">(Dec 21 2022 at 20:01)</a>:</h4>
<p>like would it be used in application code too, for example</p>



<a name="317238977"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Unknown%20tag%2C%20known%20payload/near/317238977" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tanner Nielsen <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Unknown.20tag.2C.20known.20payload.html#317238977">(Dec 21 2022 at 20:02)</a>:</h4>
<p>Right, the goal is also to have an associated implementation, which would also leverage the inferred types.</p>



<a name="317239032"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Unknown%20tag%2C%20known%20payload/near/317239032" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tanner Nielsen <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Unknown.20tag.2C.20known.20payload.html#317239032">(Dec 21 2022 at 20:03)</a>:</h4>
<p>Here's a smaller TypeScript example which might get us closer to the essence of what I'm after:</p>



<a name="317239081"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Unknown%20tag%2C%20known%20payload/near/317239081" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tanner Nielsen <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Unknown.20tag.2C.20known.20payload.html#317239081">(Dec 21 2022 at 20:03)</a>:</h4>
<div class="codehilite" data-code-language="TypeScript"><pre><span></span><code><span class="kd">function</span><span class="w"> </span><span class="nx">makeUnion</span><span class="p">&lt;</span><span class="nt">T</span> <span class="na">extends</span> <span class="na">string</span><span class="p">&gt;(</span><span class="nx">...options</span><span class="o">:</span><span class="w"> </span><span class="kt">Array</span><span class="p">&lt;</span><span class="nt">T</span><span class="p">&gt;)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">options</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="c1">// Inferred type of `states` is `Array&lt;'Solid' | 'Liquid' | 'Gas'&gt;`.</span><span class="w"></span>
<span class="c1">// The important thing here is that I'm able to infer a very strict type</span><span class="w"></span>
<span class="c1">// but still constrain the input (e.g., I can't pass numbers or anything else).</span><span class="w"></span>
<span class="c1">// I can accomplish similar inference super powers in Roc, but I can't ALSO</span><span class="w"></span>
<span class="c1">// constrain the input.</span><span class="w"></span>
<span class="kd">const</span><span class="w"> </span><span class="nx">states</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">makeUnion</span><span class="p">(</span><span class="s1">'Solid'</span><span class="p">,</span><span class="w"> </span><span class="s1">'Liquid'</span><span class="p">,</span><span class="w"> </span><span class="s1">'Gas'</span><span class="p">);</span><span class="w"></span>
</code></pre></div>



<a name="317239433"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Unknown%20tag%2C%20known%20payload/near/317239433" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tanner Nielsen <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Unknown.20tag.2C.20known.20payload.html#317239433">(Dec 21 2022 at 20:05)</a>:</h4>
<p>The pattern here allows me to concisely define all the possibilities so they can be iterated over at runtime AND infer the strictest possible typing.</p>



<a name="317239693"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Unknown%20tag%2C%20known%20payload/near/317239693" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tanner Nielsen <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Unknown.20tag.2C.20known.20payload.html#317239693">(Dec 21 2022 at 20:07)</a>:</h4>
<p>Also, I'm sort of treating string literal types in TypeScript as roughly equivalent to tags (without a payload) in Roc here</p>



<a name="317240782"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Unknown%20tag%2C%20known%20payload/near/317240782" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Unknown.20tag.2C.20known.20payload.html#317240782">(Dec 21 2022 at 20:13)</a>:</h4>
<p>cool, so one idea (that has other downsides) is:</p>
<div class="codehilite" data-code-language="Elm"><pre><span></span><code><span class="nv">matterStateMachine</span><span class="w"> </span><span class="nf">=</span><span class="w"> </span><span class="nv">stateMachine</span><span class="w"> </span><span class="p">[</span><span class="kt">Melt</span><span class="p">,</span><span class="w"> </span><span class="kt">Evaporate</span><span class="p">,</span><span class="w"> </span><span class="kt">Condense</span><span class="p">,</span><span class="w"> </span><span class="kt">Freeze</span><span class="p">]</span><span class="w"> </span><span class="nv">transition</span><span class="w"> </span><span class="nv">render</span><span class="w"></span>

<span class="nv">transition</span><span class="w"> </span><span class="nf">:</span><span class="w"> </span><span class="p">[</span><span class="kt">Melt</span><span class="p">,</span><span class="w"> </span><span class="kt">Evaporate</span><span class="p">,</span><span class="w"> </span><span class="kt">Condense</span><span class="p">,</span><span class="w"> </span><span class="kt">Freeze</span><span class="p">],</span><span class="w"> </span><span class="p">[</span><span class="kt">Solid</span><span class="p">,</span><span class="w"> </span><span class="kt">Liquid</span><span class="p">,</span><span class="w"> </span><span class="kt">Gas</span><span class="p">]</span><span class="w"> </span><span class="nf">-&gt;</span><span class="w"> </span><span class="p">[</span><span class="kt">Solid</span><span class="p">,</span><span class="w"> </span><span class="kt">Liquid</span><span class="p">,</span><span class="w"> </span><span class="kt">Gas</span><span class="p">]</span><span class="w"></span>

<span class="nv">render</span><span class="w"> </span><span class="nf">:</span><span class="w"> </span><span class="p">[</span><span class="kt">Melt</span><span class="p">,</span><span class="w"> </span><span class="kt">Evaporate</span><span class="p">,</span><span class="w"> </span><span class="kt">Condense</span><span class="p">,</span><span class="w"> </span><span class="kt">Freeze</span><span class="p">],</span><span class="w"> </span><span class="p">[</span><span class="kt">Solid</span><span class="p">,</span><span class="w"> </span><span class="kt">Liquid</span><span class="p">,</span><span class="w"> </span><span class="kt">Gas</span><span class="p">]</span><span class="w"> </span><span class="nf">-&gt;</span><span class="w"> </span><span class="kt">Str</span><span class="w"></span>
</code></pre></div>



<a name="317240859"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Unknown%20tag%2C%20known%20payload/near/317240859" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Unknown.20tag.2C.20known.20payload.html#317240859">(Dec 21 2022 at 20:13)</a>:</h4>
<p>so this is less concise, but I think satisfies all the constraints (unless I'm missing some!)</p>



<a name="317240993"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Unknown%20tag%2C%20known%20payload/near/317240993" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Unknown.20tag.2C.20known.20payload.html#317240993">(Dec 21 2022 at 20:14)</a>:</h4>
<div class="codehilite" data-code-language="Elm"><pre><span></span><code><span class="nv">stateMachine</span><span class="w"> </span><span class="nf">:</span><span class="w"> </span><span class="nv">tag</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="nv">tag</span><span class="p">,</span><span class="w"> </span><span class="nv">payload</span><span class="w"> </span><span class="nf">-&gt;</span><span class="w"> </span><span class="nv">payload</span><span class="p">),</span><span class="w"> </span><span class="p">(</span><span class="nv">tag</span><span class="p">,</span><span class="w"> </span><span class="nv">payload</span><span class="w"> </span><span class="nf">-&gt;</span><span class="w"> </span><span class="kt">Str</span><span class="p">)</span><span class="w"> </span><span class="nf">-&gt;</span><span class="w"> </span><span class="kt">StateMachine</span><span class="w"></span>
</code></pre></div>



<a name="317241139"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Unknown%20tag%2C%20known%20payload/near/317241139" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Unknown.20tag.2C.20known.20payload.html#317241139">(Dec 21 2022 at 20:15)</a>:</h4>
<p>oh I guess <code>render</code> would also need to be passed either the <code>transition</code> function or else its return value - either would work</p>



<a name="317241185"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Unknown%20tag%2C%20known%20payload/near/317241185" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tanner Nielsen <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Unknown.20tag.2C.20known.20payload.html#317241185">(Dec 21 2022 at 20:15)</a>:</h4>
<p>The conciseness could be solved with aliases, but indeed there is a constraint missing.  I'm imagining what the <code>transition</code> implementation would look like:</p>



<a name="317241314"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Unknown%20tag%2C%20known%20payload/near/317241314" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Unknown.20tag.2C.20known.20payload.html#317241314">(Dec 21 2022 at 20:16)</a>:</h4>
<p>ah I see</p>



<a name="317241340"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Unknown%20tag%2C%20known%20payload/near/317241340" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Unknown.20tag.2C.20known.20payload.html#317241340">(Dec 21 2022 at 20:16)</a>:</h4>
<p>it has to handle combinations that you wouldn't want to support</p>



<a name="317241398"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Unknown%20tag%2C%20known%20payload/near/317241398" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tanner Nielsen <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Unknown.20tag.2C.20known.20payload.html#317241398">(Dec 21 2022 at 20:16)</a>:</h4>
<p>Exactly.  Thanks for saving me the typing, haha</p>



<a name="317241452"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Unknown%20tag%2C%20known%20payload/near/317241452" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Unknown.20tag.2C.20known.20payload.html#317241452">(Dec 21 2022 at 20:17)</a>:</h4>
<p>ok, what if the tag was inferred from the transition? e.g.</p>



<a name="317241578"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Unknown%20tag%2C%20known%20payload/near/317241578" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Unknown.20tag.2C.20known.20payload.html#317241578">(Dec 21 2022 at 20:17)</a>:</h4>
<div class="codehilite" data-code-language="Elm"><pre><span></span><code><span class="nv">transition</span><span class="w"> </span><span class="nf">:</span><span class="w"> </span><span class="p">[</span><span class="kt">Solid</span><span class="p">,</span><span class="w"> </span><span class="kt">Liquid</span><span class="p">,</span><span class="w"> </span><span class="kt">Gas</span><span class="p">],</span><span class="w"> </span><span class="p">[</span><span class="kt">Solid</span><span class="p">,</span><span class="w"> </span><span class="kt">Liquid</span><span class="p">,</span><span class="w"> </span><span class="kt">Gas</span><span class="p">]</span><span class="w"> </span><span class="nf">-&gt;</span><span class="w"> </span><span class="p">[</span><span class="kt">Melt</span><span class="p">,</span><span class="w"> </span><span class="kt">Evaporate</span><span class="p">,</span><span class="w"> </span><span class="kt">Condense</span><span class="p">,</span><span class="w"> </span><span class="kt">Freeze</span><span class="p">]</span><span class="w"></span>
</code></pre></div>
<p>I guess that has the problem of having to specify e.g. how <code>Solid, Solid</code> should be labeled</p>



<a name="317242154"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Unknown%20tag%2C%20known%20payload/near/317242154" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tanner Nielsen <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Unknown.20tag.2C.20known.20payload.html#317242154">(Dec 21 2022 at 20:21)</a>:</h4>
<p>I'm not sure I'm following which tag is being inferred here</p>



<a name="317242309"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Unknown%20tag%2C%20known%20payload/near/317242309" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Unknown.20tag.2C.20known.20payload.html#317242309">(Dec 21 2022 at 20:22)</a>:</h4>
<p>never mind, it's not a good design <span aria-label="laughing" class="emoji emoji-1f606" role="img" title="laughing">:laughing:</span></p>



<a name="317242694"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Unknown%20tag%2C%20known%20payload/near/317242694" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tanner Nielsen <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Unknown.20tag.2C.20known.20payload.html#317242694">(Dec 21 2022 at 20:24)</a>:</h4>
<p>I should clarify that I would be perfectly happy to lose inferring the tag union type from a list of possibilities if I had a way to constrain the input</p>



<a name="317242710"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Unknown%20tag%2C%20known%20payload/near/317242710" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tanner Nielsen <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Unknown.20tag.2C.20known.20payload.html#317242710">(Dec 21 2022 at 20:24)</a>:</h4>
<p>For example:</p>



<a name="317242869"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Unknown%20tag%2C%20known%20payload/near/317242869" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tanner Nielsen <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Unknown.20tag.2C.20known.20payload.html#317242869">(Dec 21 2022 at 20:25)</a>:</h4>
<div class="codehilite" data-code-language="Elm"><pre><span></span><code><span class="nv">stateMachine</span><span class="w"> </span><span class="nf">:</span><span class="w"> </span><span class="p">[]</span><span class="nv">transition</span><span class="w"> </span><span class="nf">-&gt;</span><span class="w"> </span><span class="nf">...</span><span class="w"></span>
<span class="w">   </span><span class="kr">where</span><span class="w"> </span><span class="nv">transition</span><span class="w"> </span><span class="nv">is</span><span class="w"> </span><span class="kt">Tag</span><span class="w"> </span><span class="p">{</span><span class="nv">from</span><span class="nf">:</span><span class="w"> </span><span class="nv">f</span><span class="p">,</span><span class="w"> </span><span class="nv">to</span><span class="nf">:</span><span class="w"> </span><span class="nv">t</span><span class="p">}</span><span class="w"></span>
</code></pre></div>



<a name="317243915"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Unknown%20tag%2C%20known%20payload/near/317243915" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tanner Nielsen <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Unknown.20tag.2C.20known.20payload.html#317243915">(Dec 21 2022 at 20:32)</a>:</h4>
<p>Hmm, maybe that doesn't make any sense.  Let me think about that</p>



<a name="317261472"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Unknown%20tag%2C%20known%20payload/near/317261472" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Johannes Maas <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Unknown.20tag.2C.20known.20payload.html#317261472">(Dec 21 2022 at 22:42)</a>:</h4>
<p>I hope I'm not derailing things. This exchange is quite intriguing. <span class="user-mention" data-user-id="572105">@Tanner Nielsen</span>, would you mind sharing the output of the TypeScript example you gave above? I'm guessing it's a visual graph?</p>



<a name="317264201"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Unknown%20tag%2C%20known%20payload/near/317264201" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tanner Nielsen <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Unknown.20tag.2C.20known.20payload.html#317264201">(Dec 21 2022 at 23:04)</a>:</h4>
<p>Thanks for the curiosity <span class="user-mention" data-user-id="455781">@Johannes Maas</span> <span aria-label="smile" class="emoji emoji-1f642" role="img" title="smile">:smile:</span> The TypeScript code I shared above was just to demonstrate the type inference I'm looking for, so it doesn't actually do anything... but yes -- the idea is that there would be another function that takes one of these state machines and produces a diagram, probably in mermaid and/or xstate format, for example: <a href="/user_uploads/22008/yRqYVFwYAvDfEAS6j2AcHt9q/states-of-matter.png">states-of-matter.png</a>  Not sure that's what you were looking for</p>
<div class="message_inline_image"><a href="/user_uploads/22008/yRqYVFwYAvDfEAS6j2AcHt9q/states-of-matter.png" title="states-of-matter.png"><img src="/user_uploads/22008/yRqYVFwYAvDfEAS6j2AcHt9q/states-of-matter.png"></a></div>



<a name="317264419"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Unknown%20tag%2C%20known%20payload/near/317264419" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tanner Nielsen <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Unknown.20tag.2C.20known.20payload.html#317264419">(Dec 21 2022 at 23:06)</a>:</h4>
<p>That said, I've since come up with a better Roc implementation for what I want to.  I'll share the prototype code later this evening.  If it works well for what I want to use it for, I may make it a public library as well <span aria-label="smile" class="emoji emoji-1f642" role="img" title="smile">:smile:</span></p>



<a name="317265437"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Unknown%20tag%2C%20known%20payload/near/317265437" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Johannes Maas <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Unknown.20tag.2C.20known.20payload.html#317265437">(Dec 21 2022 at 23:15)</a>:</h4>
<p>Thanks for the graphic! That helped me understand what you're trying to achieve.</p>



<a name="317265650"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Unknown%20tag%2C%20known%20payload/near/317265650" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Johannes Maas <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Unknown.20tag.2C.20known.20payload.html#317265650">(Dec 21 2022 at 23:17)</a>:</h4>
<p>I'm getting the feeling that there is a "conflict" between type land and value land. It really is tricky to define what transitions are valid as values (that you can put into a function) and have that reflected in types (which ensure that other functions don't use invalid transitions). I hope this makes sense. <span aria-label="sweat smile" class="emoji emoji-1f605" role="img" title="sweat smile">:sweat_smile:</span></p>



<hr><p>Last updated: Mar 01 2026 at 12:20 UTC</p>
</html>