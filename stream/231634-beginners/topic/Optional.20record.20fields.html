<html>
<head><meta charset="utf-8"><title>Optional record fields · beginners · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/index.html">beginners</a></h2>
<h3>Topic: <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Optional.20record.20fields.html">Optional record fields</a></h3>

<hr>

<base href="https://roc.zulipchat.com">

<head><link href="https://roc-lang.github.io/zulip-export/style.css" rel="stylesheet"></head>

<a name="261840798"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Optional%20record%20fields/near/261840798" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Martin Stewart <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Optional.20record.20fields.html#261840798">(Nov 17 2021 at 20:05)</a>:</h4>
<p>I read about optional record fields here <a href="https://github.com/rtfeldman/roc/blob/trunk/roc-for-elm-programmers.md#optional-record-fields">https://github.com/rtfeldman/roc/blob/trunk/roc-for-elm-programmers.md#optional-record-fields</a> but one thing I didn't understand is the motivation behind them. To me it seems like the record update approach Elm does for config works fine without the need for additional syntax.</p>



<a name="261844978"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Optional%20record%20fields/near/261844978" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Optional.20record.20fields.html#261844978">(Nov 17 2021 at 20:36)</a>:</h4>
<p>so besides the inconvenience factor, one downside of the <code>defaultConfig</code> alternative is that it means adding new config options has to be a breaking change, even if there's a safe default that could be provided in all cases</p>



<a name="261845029"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Optional%20record%20fields/near/261845029" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Optional.20record.20fields.html#261845029">(Nov 17 2021 at 20:36)</a>:</h4>
<p>with optional fields, you can always add new optional fields to your public API and have it be fully backwards-compatible</p>



<a name="261845064"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Optional%20record%20fields/near/261845064" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Optional.20record.20fields.html#261845064">(Nov 17 2021 at 20:37)</a>:</h4>
<p>(not just in practice, but also from the perspective of the package manager's semver inference)</p>



<a name="261845085"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Optional%20record%20fields/near/261845085" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lucas Rosa <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Optional.20record.20fields.html#261845085">(Nov 17 2021 at 20:37)</a>:</h4>
<p>Yea exactly it provides some nice ergonomics for using records as configs</p>



<a name="261846420"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Optional%20record%20fields/near/261846420" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Martin Stewart <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Optional.20record.20fields.html#261846420">(Nov 17 2021 at 20:46)</a>:</h4>
<p>Good point about avoiding major version changes, I hadn't considered that.</p>
<p>Writing rules in elm-review has made me quite apprehensive about adding conveniences to a language's syntax but I understand the advantages with having optional record fields now. Tradeoffs as always <span aria-label="smile" class="emoji emoji-1f642" role="img" title="smile">:smile:</span></p>



<a name="261856659"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Optional%20record%20fields/near/261856659" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Optional.20record.20fields.html#261856659">(Nov 17 2021 at 22:02)</a>:</h4>
<blockquote>
<p>Writing rules in elm-review has made me quite apprehensive about adding conveniences to a language's syntax</p>
</blockquote>
<p>now I'm curious! What rules in particular? <span aria-label="big smile" class="emoji emoji-1f604" role="img" title="big smile">:big_smile:</span></p>



<a name="261862012"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Optional%20record%20fields/near/261862012" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Martin Stewart <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Optional.20record.20fields.html#261862012">(Nov 17 2021 at 22:48)</a>:</h4>
<p>I don't know of any rules that would be directly impacted by optional record fields (maybe the NoUnused rules would get significantly more complicated?) But having it means a more complicated AST, which means more situations that a rule might need to handle in order to be useful.</p>
<p>Here's an example that's a bit contrived because in practice it wouldn't be an issue but maybe can give an idea of possible problems:<br>
At work I've created a rule that converts <code>Element.paddingEach { left = 4, right = 4, top = 0, bottom = 0 }</code> into <code>Element.xy 4 0</code>. With optional record fields, maybe elm-ui would be changed so that someone could write <code>Element.paddingEach { left = 4, right = 4 }</code>. Now this rule would need to look up data from the elm-ui package to know what the defaults are. Again, this is contrived because I'm pretty safe in just assuming the default is 0.</p>
<p>More generally though, I don't know of any other language ecosystem that has something like elm-review*. I believe this is because Elm hits a sweet spot of lightweight syntax and pure functions that makes it easy for anyone to write their own rules or tools. For that reason I'm cautious about adding syntax features, it seems like it can quickly move a language out of the "easy to create tools" zone.</p>
<p>*There are static analysis tools and linters for other languages created by one or more experts but I don't know of any tools in other languages that make it easy for just about anyone to quickly create a useful rule.</p>



<a name="261869483"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Optional%20record%20fields/near/261869483" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Optional.20record.20fields.html#261869483">(Nov 18 2021 at 00:11)</a>:</h4>
<p>gotcha, thanks! Roc's syntax is very similar to elm's overall, and there aren't any plans to make any significant expansions to it. I want it to stay small too!</p>



<a name="261871666"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Optional%20record%20fields/near/261871666" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lucas Rosa <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Optional.20record.20fields.html#261871666">(Nov 18 2021 at 00:39)</a>:</h4>
<p>(deleted)</p>



<a name="261900088"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Optional%20record%20fields/near/261900088" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Martin Stewart <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Optional.20record.20fields.html#261900088">(Nov 18 2021 at 08:46)</a>:</h4>
<p>Oh, I thought of some more questions:</p>
<ol>
<li>I guess optional record fields can't be equatable? Otherwise what should happen here <code>{ fieldA = 5 } == {}</code>?</li>
<li>If they aren't equatable, doesn't that mean it's a breaking change to add the first optional field to an equatable record?</li>
<li>Will compiler error messages get worse? For example here there's some ambiguity</li>
</ol>
<div class="codehilite"><pre><span></span><code>a = { fieldA = 5 }
b = {}
c = a == b # Did the user forget to add fieldA? Or are they trying to test equality on two optional records?
</code></pre></div>



<a name="261903328"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Optional%20record%20fields/near/261903328" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Optional.20record.20fields.html#261903328">(Nov 18 2021 at 09:23)</a>:</h4>
<p>optional fields are not fields with defaults</p>



<a name="261903405"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Optional%20record%20fields/near/261903405" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Optional.20record.20fields.html#261903405">(Nov 18 2021 at 09:24)</a>:</h4>
<p>so <code>{ fieldA : 5 } == {}</code> is just a type error</p>



<a name="261903583"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Optional%20record%20fields/near/261903583" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Optional.20record.20fields.html#261903583">(Nov 18 2021 at 09:26)</a>:</h4>
<p>rather you can check if the field is present in the type, and if not you could then provide the default. It's not baked in</p>



<a name="261904021"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Optional%20record%20fields/near/261904021" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Optional.20record.20fields.html#261904021">(Nov 18 2021 at 09:30)</a>:</h4>
<p>it's a bit like polymorphism. In elm you cannot say</p>
<div class="codehilite"><pre><span></span><code>x : { a | y: Int }
x = { y = 5 }
</code></pre></div>



<a name="261904241"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Optional%20record%20fields/near/261904241" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Optional.20record.20fields.html#261904241">(Nov 18 2021 at 09:33)</a>:</h4>
<p>you also cannot do this</p>
<div class="codehilite"><pre><span></span><code>f : { a | x: Int } -&gt; Bool
f = \r -&gt; r == {x= 5, y= &quot;foo&quot;}
</code></pre></div>



<a name="261906788"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Optional%20record%20fields/near/261906788" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Martin Stewart <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Optional.20record.20fields.html#261906788">(Nov 18 2021 at 10:02)</a>:</h4>
<p>Okay, I think I understand. Writing <code>f : { a : Int, b ? Int} -&gt; Int</code> is like writing this?</p>
<div class="codehilite"><pre><span></span><code>f : { a : Int }* -&gt; Int
f = \record -&gt; fHelper record |&gt; ... #rest of the function

fHelper : { a : Int }e -&gt; { a : Int, b : Int }e
</code></pre></div>



<a name="261907395"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Optional%20record%20fields/near/261907395" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Optional.20record.20fields.html#261907395">(Nov 18 2021 at 10:07)</a>:</h4>
<p>I think you're on the right track. Both of these would fail the type checker</p>
<div class="codehilite"><pre><span></span><code>f : { a : Int, b ? Int} -&gt; Int
f = \r -&gt; { a : 42, b : 43 }

f : { a : Int, b ? Int} -&gt; Int
f = \r -&gt; { a : 42 }
</code></pre></div>

<p>But you can do</p>
<div class="codehilite"><pre><span></span><code>f : { a : Int, b ? Int}, { a : Int, b ? Int} -&gt; Int
f = \r1, r2 -&gt; r1 == r2
</code></pre></div>



<a name="261907522"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Optional%20record%20fields/near/261907522" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Optional.20record.20fields.html#261907522">(Nov 18 2021 at 10:08)</a>:</h4>
<p>or, at least I think you should be able to do that. Not sure if that actually works today now that I look at it</p>



<a name="261907556"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Optional%20record%20fields/near/261907556" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Optional.20record.20fields.html#261907556">(Nov 18 2021 at 10:09)</a>:</h4>
<p>or rather, I don't think the error message is great if you do <code>f {  a } { a, b }</code></p>



<a name="373751263"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Optional%20record%20fields/near/373751263" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ivo Balbaert <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Optional.20record.20fields.html#373751263">(Jul 09 2023 at 17:36)</a>:</h4>
<p>Maybe I'm doing something silly, but I can't get a working example out of the tutorial section: Optional Record Fields. All variations on the following code:</p>
<div class="codehilite"><pre><span></span><code>main =
   # dbg table { height: 100, width: 150, title: &quot;a&quot;, description: &quot;b&quot; }
   # dbg table {100, 150, &quot;a&quot;, &quot;b&quot;}
   # Stdout.line &quot;\(table {100, 150})&quot;
   Stdout.line &quot;the end&quot;

table : { height : Num, width : Num, title ? Str, description ? Str } -&gt; Str
table = \{
        height,
        width,
        title? &quot;oak&quot;,
        description? &quot;a wooden table&quot;
    }
    -&gt; &quot;abc&quot;

give the following compiler error (compiling hangs):
thread &#39;&lt;unnamed&gt;&#39; panicked at &#39;internal error: entered unreachable code: Any other pattern should have given a parse error&#39;, crates/compiler/can/src/pattern.rs:737:26
note: run with `RUST_BACKTRACE=1` environment variable to display a backtrace.

Here is the stack backtrace:
stack backtrace:
   0: rust_begin_unwind
             at /rustc/90743e7298aca107ddaa0c202a4d3604e29bfeb6/library/std/src/panicking.rs:575:5
   1: core::panicking::panic_fmt
             at /rustc/90743e7298aca107ddaa0c202a4d3604e29bfeb6/library/core/src/panicking.rs:65:14
   2: roc_can::pattern::canonicalize_pattern
   3: roc_can::scope::Scope::inner_scope
   4: roc_can::def::canonicalize_pending_body
   5: roc_can::def::canonicalize_value_defs
   6: roc_can::module::canonicalize_module_defs
   7: roc_load_internal::file::run_task
   8: core::ops::function::FnOnce::call_once{{vtable.shim}}

Perhaps this is just a design example and isn&#39;t supposed to work. But if possible I would like to have a more expert advice on this :smile:
</code></pre></div>



<a name="373761759"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Optional%20record%20fields/near/373761759" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Optional.20record.20fields.html#373761759">(Jul 09 2023 at 18:45)</a>:</h4>
<p>Looks like a bug, can you log an issue for this?</p>



<a name="373773171"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Optional%20record%20fields/near/373773171" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ivo Balbaert <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Optional.20record.20fields.html#373773171">(Jul 09 2023 at 19:58)</a>:</h4>
<p>Ok: # 5653</p>



<a name="373854176"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Optional%20record%20fields/near/373854176" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Kilian Vounckx <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Optional.20record.20fields.html#373854176">(Jul 10 2023 at 07:26)</a>:</h4>
<p><span class="user-mention" data-user-id="454208">@Ivo Balbaert</span> I don't know if it's exactly the same, because I don't have my laptop on me. I had a similar error. Putting all function arguments on one long line worked for me</p>



<a name="373854716"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Optional%20record%20fields/near/373854716" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Kilian Vounckx <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Optional.20record.20fields.html#373854716">(Jul 10 2023 at 07:28)</a>:</h4>
<div class="codehilite"><pre><span></span><code>table : { height : Num, width : Num, title ? Str, description ? Str } -&gt; Str
table = \{ height, width, title? &quot;oak&quot;, description? &quot;a wooden table&quot; } -&gt;
   &quot;abc&quot;
</code></pre></div>
<p>Like so. Not the prettiest, but it should work until the bug is fixed. At least if it was the same as mine</p>



<a name="373883391"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Optional%20record%20fields/near/373883391" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ivo Balbaert <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Optional.20record.20fields.html#373883391">(Jul 10 2023 at 09:17)</a>:</h4>
<p>Thanks Kilian, that works! I'll mention your workaround in the issue, but leave it open until the parsing problem is fixed.</p>



<hr><p>Last updated: Nov 01 2025 at 12:13 UTC</p>
</html>