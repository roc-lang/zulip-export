<html>
<head><meta charset="utf-8"><title>✔ performance question · beginners · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/index.html">beginners</a></h2>
<h3>Topic: <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/.E2.9C.94.20performance.20question.html">✔ performance question</a></h3>

<hr>

<base href="https://roc.zulipchat.com">

<head><link href="https://roc-lang.github.io/zulip-export/style.css" rel="stylesheet"></head>

<a name="477922682"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/%E2%9C%94%20performance%20question/near/477922682" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> drew <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/.E2.9C.94.20performance.20question.html#477922682">(Oct 20 2024 at 20:03)</a>:</h4>
<p>does anything strike you all is particularly bad from a perf perspective here? <a href="https://gist.github.com/drewolson/9efeb114307c7323ef5d7bfcf4775a52">https://gist.github.com/drewolson/9efeb114307c7323ef5d7bfcf4775a52</a></p>



<a name="477922696"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/%E2%9C%94%20performance%20question/near/477922696" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> drew <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/.E2.9C.94.20performance.20question.html#477922696">(Oct 20 2024 at 20:03)</a>:</h4>
<p>it's an identical algorithm to this gleam <a href="https://github.com/drewolson/aoc-gleam/blob/main/src/aoc/year2023/day14.gleam">https://github.com/drewolson/aoc-gleam/blob/main/src/aoc/year2023/day14.gleam</a></p>



<a name="477922743"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/%E2%9C%94%20performance%20question/near/477922743" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> drew <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/.E2.9C.94.20performance.20question.html#477922743">(Oct 20 2024 at 20:04)</a>:</h4>
<p>and this ocaml <a href="https://github.com/drewolson/aoc-ocaml/blob/d3bd355365308c018ada088063895b2d4743975f/lib/year2023/day14.ml">https://github.com/drewolson/aoc-ocaml/blob/d3bd355365308c018ada088063895b2d4743975f/lib/year2023/day14.ml</a></p>



<a name="477922751"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/%E2%9C%94%20performance%20question/near/477922751" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> drew <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/.E2.9C.94.20performance.20question.html#477922751">(Oct 20 2024 at 20:04)</a>:</h4>
<p>and in both cases it is effectively an order of magnitude slower</p>



<a name="477922784"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/%E2%9C%94%20performance%20question/near/477922784" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> drew <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/.E2.9C.94.20performance.20question.html#477922784">(Oct 20 2024 at 20:04)</a>:</h4>
<p>this is for part 2. it's a problem that requires some type of caching / dynamic programming. i'm using a dict to cache in all cases</p>



<a name="477922809"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/%E2%9C%94%20performance%20question/near/477922809" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> drew <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/.E2.9C.94.20performance.20question.html#477922809">(Oct 20 2024 at 20:05)</a>:</h4>
<p>ocaml is using a <code>Hashtbl</code> which is mutable, but the gleam solution is very similar (using an immutable dict)</p>



<a name="477922829"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/%E2%9C%94%20performance%20question/near/477922829" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> drew <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/.E2.9C.94.20performance.20question.html#477922829">(Oct 20 2024 at 20:06)</a>:</h4>
<p>i had a version using a <code>State</code> monad in roc initially, but i rewrote it with manual state threading because i was worried that was the performance issue</p>



<a name="477938989"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/%E2%9C%94%20performance%20question/near/477938989" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/.E2.9C.94.20performance.20question.html#477938989">(Oct 21 2024 at 00:06)</a>:</h4>
<p>Are you just running it with roc test? is there a way to run it will full input?</p>



<a name="477939051"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/%E2%9C%94%20performance%20question/near/477939051" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> drew <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/.E2.9C.94.20performance.20question.html#477939051">(Oct 21 2024 at 00:06)</a>:</h4>
<p>yes, <code>roc run — -y 2023 -d 14 -p 2</code></p>



<a name="477939070"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/%E2%9C%94%20performance%20question/near/477939070" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> drew <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/.E2.9C.94.20performance.20question.html#477939070">(Oct 21 2024 at 00:07)</a>:</h4>
<p>the full input is where the performance degradation is obvious</p>



<a name="477939154"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/%E2%9C%94%20performance%20question/near/477939154" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> drew <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/.E2.9C.94.20performance.20question.html#477939154">(Oct 21 2024 at 00:08)</a>:</h4>
<p>this assumes your input is at <code>./data/2023/day14.txt</code></p>



<a name="477939190"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/%E2%9C%94%20performance%20question/near/477939190" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/.E2.9C.94.20performance.20question.html#477939190">(Oct 21 2024 at 00:09)</a>:</h4>
<p>do I need to download a full repo somewhere?</p>



<a name="477939192"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/%E2%9C%94%20performance%20question/near/477939192" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> drew <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/.E2.9C.94.20performance.20question.html#477939192">(Oct 21 2024 at 00:09)</a>:</h4>
<p>let me push it to the full report, one sec</p>



<a name="477939293"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/%E2%9C%94%20performance%20question/near/477939293" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> drew <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/.E2.9C.94.20performance.20question.html#477939293">(Oct 21 2024 at 00:10)</a>:</h4>
<p>apologies, it's here <a href="https://github.com/drewolson/aoc-roc">https://github.com/drewolson/aoc-roc</a></p>



<a name="477939394"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/%E2%9C%94%20performance%20question/near/477939394" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> drew <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/.E2.9C.94.20performance.20question.html#477939394">(Oct 21 2024 at 00:12)</a>:</h4>
<p>for reference, here's roc:</p>



<a name="477939395"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/%E2%9C%94%20performance%20question/near/477939395" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> drew <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/.E2.9C.94.20performance.20question.html#477939395">(Oct 21 2024 at 00:12)</a>:</h4>
<div class="codehilite"><pre><span></span><code>$ time ./main -y 2023 -d 14 -p 2
90982
./main -y 2023 -d 14 -p 2  2.56s user 0.02s system 93% cpu 2.751 total
</code></pre></div>



<a name="477939397"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/%E2%9C%94%20performance%20question/near/477939397" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> drew <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/.E2.9C.94.20performance.20question.html#477939397">(Oct 21 2024 at 00:12)</a>:</h4>
<p>and here's ocaml:</p>



<a name="477939400"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/%E2%9C%94%20performance%20question/near/477939400" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> drew <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/.E2.9C.94.20performance.20question.html#477939400">(Oct 21 2024 at 00:12)</a>:</h4>
<div class="codehilite"><pre><span></span><code>$ time ./_build/install/default/bin/aoc -y 2023 -d 14 -p 2
90982
./_build/install/default/bin/aoc -y 2023 -d 14 -p 2  0.40s user 0.02s system 98% cpu 0.430 total
</code></pre></div>



<a name="477939421"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/%E2%9C%94%20performance%20question/near/477939421" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> drew <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/.E2.9C.94.20performance.20question.html#477939421">(Oct 21 2024 at 00:13)</a>:</h4>
<p>spoiler alert for my answer <span aria-label="smile" class="emoji emoji-1f642" role="img" title="smile">:smile:</span></p>



<a name="477939435"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/%E2%9C%94%20performance%20question/near/477939435" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> drew <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/.E2.9C.94.20performance.20question.html#477939435">(Oct 21 2024 at 00:13)</a>:</h4>
<p>and here's gleam, even including compilation</p>



<a name="477939439"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/%E2%9C%94%20performance%20question/near/477939439" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> drew <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/.E2.9C.94.20performance.20question.html#477939439">(Oct 21 2024 at 00:13)</a>:</h4>
<div class="codehilite"><pre><span></span><code>$ time gleam run -- -y 2023 -d 14 -p 2
   Compiled in 0.01s
    Running aoc.main
90982
gleam run -- -y 2023 -d 14 -p 2  0.47s user 0.18s system 102% cpu 0.636 total
</code></pre></div>



<a name="477939752"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/%E2%9C%94%20performance%20question/near/477939752" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/.E2.9C.94.20performance.20question.html#477939752">(Oct 21 2024 at 00:18)</a>:</h4>
<p>Wow, this program takes forever to compile an optimized build of</p>



<a name="477939791"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/%E2%9C%94%20performance%20question/near/477939791" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> drew <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/.E2.9C.94.20performance.20question.html#477939791">(Oct 21 2024 at 00:19)</a>:</h4>
<p>lol</p>



<a name="477939803"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/%E2%9C%94%20performance%20question/near/477939803" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> drew <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/.E2.9C.94.20performance.20question.html#477939803">(Oct 21 2024 at 00:19)</a>:</h4>
<p>it’s relatively simple, compared to large programs, right?</p>



<a name="477940015"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/%E2%9C%94%20performance%20question/near/477940015" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/.E2.9C.94.20performance.20question.html#477940015">(Oct 21 2024 at 00:22)</a>:</h4>
<p><code>40984032832  peak memory footprint</code></p>
<p>was using about 40GB of ram/swap before I killed it. kinda surprised it runs at all for you</p>



<a name="477940036"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/%E2%9C%94%20performance%20question/near/477940036" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> drew <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/.E2.9C.94.20performance.20question.html#477940036">(Oct 21 2024 at 00:23)</a>:</h4>
<p>just for <code>roc run</code>?</p>



<a name="477940141"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/%E2%9C%94%20performance%20question/near/477940141" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/.E2.9C.94.20performance.20question.html#477940141">(Oct 21 2024 at 00:24)</a>:</h4>
<p>this was <code>roc build --optimize main.roc </code>. Then the crazy memory came from <code>./main -y 2023 -d 14 -p 2</code> with the input data I just downloaded.</p>



<a name="477940722"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/%E2%9C%94%20performance%20question/near/477940722" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> drew <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/.E2.9C.94.20performance.20question.html#477940722">(Oct 21 2024 at 00:34)</a>:</h4>
<p>i don’t understand how i keep hitting all of these things. i swear i’m just trying to write normal programs</p>



<a name="477941041"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/%E2%9C%94%20performance%20question/near/477941041" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/.E2.9C.94.20performance.20question.html#477941041">(Oct 21 2024 at 00:40)</a>:</h4>
<p>This is the big problem location</p>
<div class="codehilite" data-code-language="Elm"><pre><span></span><code><span class="w">    </span><span class="nv">aux</span><span class="w"> </span><span class="nf">=</span><span class="w"> </span><span class="nf">\</span><span class="nv">m</span><span class="p">,</span><span class="w"> </span><span class="nv">acc</span><span class="w"> </span><span class="nf">-&gt;</span>
<span class="w">        </span><span class="nv">when</span><span class="w"> </span><span class="kt">List</span><span class="nf">.</span><span class="nv">mapTry</span><span class="w"> </span><span class="nv">m</span><span class="w"> </span><span class="kt">List</span><span class="nf">.</span><span class="nv">first</span><span class="w"> </span><span class="nv">is</span>
<span class="w">            </span><span class="kt">Ok</span><span class="w"> </span><span class="nv">firsts</span><span class="w"> </span><span class="nf">-&gt;</span>
<span class="w">                </span><span class="nv">rest</span><span class="w"> </span><span class="nf">=</span><span class="w"> </span><span class="kt">List</span><span class="nf">.</span><span class="nv">map</span><span class="w"> </span><span class="nv">m</span><span class="w"> </span><span class="p">(</span><span class="nf">\</span><span class="nv">l</span><span class="w"> </span><span class="nf">-&gt;</span><span class="w"> </span><span class="kt">List</span><span class="nf">.</span><span class="nv">dropFirst</span><span class="w"> </span><span class="nv">l</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span>
<span class="w">                </span><span class="nv">aux</span><span class="w"> </span><span class="nv">rest</span><span class="w"> </span><span class="p">(</span><span class="kt">List</span><span class="nf">.</span><span class="nv">append</span><span class="w"> </span><span class="nv">acc</span><span class="w"> </span><span class="nv">firsts</span><span class="p">)</span>

<span class="w">            </span><span class="kt">Err</span><span class="w"> </span><span class="nv">_</span><span class="w"> </span><span class="nf">-&gt;</span><span class="w"> </span><span class="nv">acc</span>
</code></pre></div>



<a name="477941074"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/%E2%9C%94%20performance%20question/near/477941074" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> drew <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/.E2.9C.94.20performance.20question.html#477941074">(Oct 21 2024 at 00:40)</a>:</h4>
<p>transpose?</p>



<a name="477941077"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/%E2%9C%94%20performance%20question/near/477941077" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> drew <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/.E2.9C.94.20performance.20question.html#477941077">(Oct 21 2024 at 00:40)</a>:</h4>
<p>weird</p>



<a name="477941082"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/%E2%9C%94%20performance%20question/near/477941082" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/.E2.9C.94.20performance.20question.html#477941082">(Oct 21 2024 at 00:40)</a>:</h4>
<p>Specifically aux</p>



<a name="477941084"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/%E2%9C%94%20performance%20question/near/477941084" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> drew <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/.E2.9C.94.20performance.20question.html#477941084">(Oct 21 2024 at 00:40)</a>:</h4>
<p>did i write it strangely?</p>



<a name="477941090"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/%E2%9C%94%20performance%20question/near/477941090" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/.E2.9C.94.20performance.20question.html#477941090">(Oct 21 2024 at 00:40)</a>:</h4>
<p>It makes sense. It is gonna be duplicating <code>m</code> a bunch</p>



<a name="477941115"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/%E2%9C%94%20performance%20question/near/477941115" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/.E2.9C.94.20performance.20question.html#477941115">(Oct 21 2024 at 00:41)</a>:</h4>
<p>Cause you are mutating m twice on every iteration</p>



<a name="477941195"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/%E2%9C%94%20performance%20question/near/477941195" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/.E2.9C.94.20performance.20question.html#477941195">(Oct 21 2024 at 00:42)</a>:</h4>
<p><del>It also is not tail recursive. So that will be a crazy about of live copies for a large array</del></p>



<a name="477941215"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/%E2%9C%94%20performance%20question/near/477941215" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> drew <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/.E2.9C.94.20performance.20question.html#477941215">(Oct 21 2024 at 00:43)</a>:</h4>
<p>how is it not tail recusive?</p>



<a name="477941227"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/%E2%9C%94%20performance%20question/near/477941227" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> drew <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/.E2.9C.94.20performance.20question.html#477941227">(Oct 21 2024 at 00:43)</a>:</h4>
<p>all calls are in the tail position, yeah?</p>



<a name="477941277"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/%E2%9C%94%20performance%20question/near/477941277" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> drew <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/.E2.9C.94.20performance.20question.html#477941277">(Oct 21 2024 at 00:44)</a>:</h4>
<p>also re double mutation, does roc not share structure?</p>



<a name="477941280"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/%E2%9C%94%20performance%20question/near/477941280" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/.E2.9C.94.20performance.20question.html#477941280">(Oct 21 2024 at 00:44)</a>:</h4>
<p>It is, my brain failed for a moment and thought the tail call was within a lambda</p>



<a name="477941281"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/%E2%9C%94%20performance%20question/near/477941281" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> drew <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/.E2.9C.94.20performance.20question.html#477941281">(Oct 21 2024 at 00:44)</a>:</h4>
<p>a la persistent data structures?</p>



<a name="477941314"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/%E2%9C%94%20performance%20question/near/477941314" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/.E2.9C.94.20performance.20question.html#477941314">(Oct 21 2024 at 00:45)</a>:</h4>
<p>Roc does not use persistent data structures, so it requires different design from other ml style languages</p>



<a name="477941336"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/%E2%9C%94%20performance%20question/near/477941336" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/.E2.9C.94.20performance.20question.html#477941336">(Oct 21 2024 at 00:45)</a>:</h4>
<p>Instead it uses flat memory dense data structures.</p>



<a name="477941343"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/%E2%9C%94%20performance%20question/near/477941343" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/.E2.9C.94.20performance.20question.html#477941343">(Oct 21 2024 at 00:45)</a>:</h4>
<p>It just mutates in place wherever possible</p>



<a name="477941410"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/%E2%9C%94%20performance%20question/near/477941410" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> drew <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/.E2.9C.94.20performance.20question.html#477941410">(Oct 21 2024 at 00:46)</a>:</h4>
<p>oof, i had no idea.</p>



<a name="477941416"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/%E2%9C%94%20performance%20question/near/477941416" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> drew <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/.E2.9C.94.20performance.20question.html#477941416">(Oct 21 2024 at 00:46)</a>:</h4>
<p>that’s … tricky</p>



<a name="477941428"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/%E2%9C%94%20performance%20question/near/477941428" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> drew <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/.E2.9C.94.20performance.20question.html#477941428">(Oct 21 2024 at 00:46)</a>:</h4>
<p>also, transpose only happens once in a not that large list</p>



<a name="477941437"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/%E2%9C%94%20performance%20question/near/477941437" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> drew <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/.E2.9C.94.20performance.20question.html#477941437">(Oct 21 2024 at 00:46)</a>:</h4>
<p>so i’m still confused how it is the problem</p>



<a name="477941639"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/%E2%9C%94%20performance%20question/near/477941639" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/.E2.9C.94.20performance.20question.html#477941639">(Oct 21 2024 at 00:50)</a>:</h4>
<p>looks to be <code>1361</code> by <code>17</code> for me</p>



<a name="477941659"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/%E2%9C%94%20performance%20question/near/477941659" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/.E2.9C.94.20performance.20question.html#477941659">(Oct 21 2024 at 00:50)</a>:</h4>
<p>Also, I bet I am missing part of the problem, but not sure how yet</p>



<a name="477941716"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/%E2%9C%94%20performance%20question/near/477941716" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> drew <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/.E2.9C.94.20performance.20question.html#477941716">(Oct 21 2024 at 00:51)</a>:</h4>
<p>appreciate you taking a look</p>



<a name="477941820"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/%E2%9C%94%20performance%20question/near/477941820" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/.E2.9C.94.20performance.20question.html#477941820">(Oct 21 2024 at 00:53)</a>:</h4>
<p>Hmm.... actually rotation looks to happen fast when just running a debug build with <code>roc ...</code>. Maybe something separate is breaking the optimized build for that function...</p>



<a name="477941853"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/%E2%9C%94%20performance%20question/near/477941853" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> drew <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/.E2.9C.94.20performance.20question.html#477941853">(Oct 21 2024 at 00:53)</a>:</h4>
<p>got it. i haven’t attempted an optimized build over here</p>



<a name="477941903"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/%E2%9C%94%20performance%20question/near/477941903" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/.E2.9C.94.20performance.20question.html#477941903">(Oct 21 2024 at 00:54)</a>:</h4>
<p>Ok. So maybe optimized build is broken in a totally different way.</p>



<a name="477941908"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/%E2%9C%94%20performance%20question/near/477941908" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/.E2.9C.94.20performance.20question.html#477941908">(Oct 21 2024 at 00:54)</a>:</h4>
<p>Let me look at a debug build</p>



<a name="477942082"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/%E2%9C%94%20performance%20question/near/477942082" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/.E2.9C.94.20performance.20question.html#477942082">(Oct 21 2024 at 00:56)</a>:</h4>
<p>Ok yeah, optimized builds are just broken in a different way. Debug actually finishes executing without eating tons of memory</p>



<a name="477942832"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/%E2%9C%94%20performance%20question/near/477942832" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> drew <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/.E2.9C.94.20performance.20question.html#477942832">(Oct 21 2024 at 01:07)</a>:</h4>
<p>yep, but it is quite slow compared to other “not known as super fast” languages. but perhaps this is expected for debug builds?</p>



<a name="477943454"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/%E2%9C%94%20performance%20question/near/477943454" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/.E2.9C.94.20performance.20question.html#477943454">(Oct 21 2024 at 01:17)</a>:</h4>
<p>No, I think there is still a deeper issue here. Also, your matrix is ragged, is that intentional? Normally transpose is done on rectangles, not something ragged.</p>



<a name="477943962"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/%E2%9C%94%20performance%20question/near/477943962" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> drew <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/.E2.9C.94.20performance.20question.html#477943962">(Oct 21 2024 at 01:26)</a>:</h4>
<p>is it? i think it is rectangular</p>



<a name="477944109"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/%E2%9C%94%20performance%20question/near/477944109" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> drew <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/.E2.9C.94.20performance.20question.html#477944109">(Oct 21 2024 at 01:28)</a>:</h4>
<p>i definitely is after the first transpose. and i was incorrect, i transpose every cycle</p>



<a name="477944112"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/%E2%9C%94%20performance%20question/near/477944112" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> drew <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/.E2.9C.94.20performance.20question.html#477944112">(Oct 21 2024 at 01:28)</a>:</h4>
<p>so very often</p>



<a name="477944566"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/%E2%9C%94%20performance%20question/near/477944566" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/.E2.9C.94.20performance.20question.html#477944566">(Oct 21 2024 at 01:35)</a>:</h4>
<blockquote>
<p>is it? i think it is rectangular</p>
</blockquote>
<p>From debug prints, it is not, you transpose the entire input. Which is a list a matrices.</p>



<a name="477944576"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/%E2%9C%94%20performance%20question/near/477944576" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/.E2.9C.94.20performance.20question.html#477944576">(Oct 21 2024 at 01:35)</a>:</h4>
<p>Maybe that is related to the root issue</p>



<a name="477944646"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/%E2%9C%94%20performance%20question/near/477944646" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/.E2.9C.94.20performance.20question.html#477944646">(Oct 21 2024 at 01:36)</a>:</h4>
<p>Cause the input isn't like this:</p>
<div class="spoiler-block"><div class="spoiler-header">
</div><div class="spoiler-content" aria-hidden="true">
<div class="codehilite"><pre><span></span><code>#.#.#.#..
#.#.#.##.
#.#.#.##.
#.#.#.#..
...#.....
#..#.##..
....#...#
####....#
#####....
.###.#.##
####...##
.#.#...#.
#....#.#.
</code></pre></div>
</div></div>
<p>It is like:</p>
<div class="spoiler-block"><div class="spoiler-header">
</div><div class="spoiler-content" aria-hidden="true">
<div class="codehilite"><pre><span></span><code>######....#######
..#...####...#..#
.###.#....#.###.#
....##.##.##....#
.##....##....##..
.####...#..####.#
##..#..##..#..###
..#.########.#...
#..#.######.#..#.
.##..#.##.#..##..
###.#.####.#.###.
###.#.####.#.###.
.##..#.##.#..##..
#..#.######.#..#.
..#.########.#...

......##....#
.#.#.##...#.#
.##.#..#..#.#
.##.#..#..#.#
.#.#.##...#.#
......##..#.#
....#.#....#.
...#.###...##
.#.##.#.###..
###.....##.##
#.##..##...#.
###.#..##.##.
#..#######..#
#..#######..#
###.#..##.##.

#.#.#.#..
#.#.#.##.
#.#.#.##.
#.#.#.#..
...#.....
#..#.##..
....#...#
####....#
#####....
.###.#.##
####...##
.#.#...#.
#....#.#.
</code></pre></div>
</div></div>



<a name="477944731"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/%E2%9C%94%20performance%20question/near/477944731" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/.E2.9C.94.20performance.20question.html#477944731">(Oct 21 2024 at 01:38)</a>:</h4>
<p>You are transposing things like the second spoiler here as if they were a single matrix</p>



<a name="477944776"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/%E2%9C%94%20performance%20question/near/477944776" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> drew <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/.E2.9C.94.20performance.20question.html#477944776">(Oct 21 2024 at 01:38)</a>:</h4>
<p>i think you have an issue with your input</p>



<a name="477944780"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/%E2%9C%94%20performance%20question/near/477944780" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> drew <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/.E2.9C.94.20performance.20question.html#477944780">(Oct 21 2024 at 01:38)</a>:</h4>
<p>it should be a single matrix</p>



<a name="477944802"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/%E2%9C%94%20performance%20question/near/477944802" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/.E2.9C.94.20performance.20question.html#477944802">(Oct 21 2024 at 01:38)</a>:</h4>
<p>That is not what I get from the download button here: <a href="https://adventofcode.com/2023/day/13">https://adventofcode.com/2023/day/13</a></p>



<a name="477944850"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/%E2%9C%94%20performance%20question/near/477944850" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> drew <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/.E2.9C.94.20performance.20question.html#477944850">(Oct 21 2024 at 01:39)</a>:</h4>
<p>i just rechecked mine, it is definitely rectangular</p>



<a name="477944919"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/%E2%9C%94%20performance%20question/near/477944919" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> drew <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/.E2.9C.94.20performance.20question.html#477944919">(Oct 21 2024 at 01:40)</a>:</h4>
<div class="codehilite"><pre><span></span><code>$ awk &#39;{print length+1}&#39; data/2023/day14.txt | uniq
101
</code></pre></div>



<a name="477944931"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/%E2%9C%94%20performance%20question/near/477944931" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/.E2.9C.94.20performance.20question.html#477944931">(Oct 21 2024 at 01:41)</a>:</h4>
<p>Oh....I just realized...I downloaded day 13....ugh</p>



<a name="477944943"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/%E2%9C%94%20performance%20question/near/477944943" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/.E2.9C.94.20performance.20question.html#477944943">(Oct 21 2024 at 01:41)</a>:</h4>
<p>So ignore my crazy results, they are all from bad input....</p>



<a name="477944990"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/%E2%9C%94%20performance%20question/near/477944990" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> drew <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/.E2.9C.94.20performance.20question.html#477944990">(Oct 21 2024 at 01:42)</a>:</h4>
<p>ha, phew!</p>



<a name="477945187"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/%E2%9C%94%20performance%20question/near/477945187" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/.E2.9C.94.20performance.20question.html#477945187">(Oct 21 2024 at 01:45)</a>:</h4>
<p>Yeah, rotate does not matter for perf with proper input</p>



<a name="477945310"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/%E2%9C%94%20performance%20question/near/477945310" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/.E2.9C.94.20performance.20question.html#477945310">(Oct 21 2024 at 01:47)</a>:</h4>
<p>about 50% of the time is the concat and prepend in <code>tilt</code></p>



<a name="477945320"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/%E2%9C%94%20performance%20question/near/477945320" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/.E2.9C.94.20performance.20question.html#477945320">(Oct 21 2024 at 01:47)</a>:</h4>
<p>prepend is not friendly to roc lists. They prefer append</p>



<a name="477945429"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/%E2%9C%94%20performance%20question/near/477945429" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/.E2.9C.94.20performance.20question.html#477945429">(Oct 21 2024 at 01:49)</a>:</h4>
<p>Also, optimized build gives a 3 to 4x speed up. Makes the time about the same as gleam.</p>



<a name="477945434"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/%E2%9C%94%20performance%20question/near/477945434" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> drew <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/.E2.9C.94.20performance.20question.html#477945434">(Oct 21 2024 at 01:49)</a>:</h4>
<p>got it. i can try without prepend to see if that helps</p>



<a name="477945449"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/%E2%9C%94%20performance%20question/near/477945449" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> drew <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/.E2.9C.94.20performance.20question.html#477945449">(Oct 21 2024 at 01:50)</a>:</h4>
<p>i’m guessing native ocaml (instead of bytecode) would be even faster</p>



<a name="477945501"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/%E2%9C%94%20performance%20question/near/477945501" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> drew <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/.E2.9C.94.20performance.20question.html#477945501">(Oct 21 2024 at 01:50)</a>:</h4>
<p>but again, it is using mutation</p>



<a name="477945826"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/%E2%9C%94%20performance%20question/near/477945826" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/.E2.9C.94.20performance.20question.html#477945826">(Oct 21 2024 at 01:55)</a>:</h4>
<p>Roughly the perf breakdown of a non-optimized build is:<br>
60% tilt<br>
30% rotate<br>
10% hashing strings for dict</p>



<a name="477946116"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/%E2%9C%94%20performance%20question/near/477946116" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> drew <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/.E2.9C.94.20performance.20question.html#477946116">(Oct 21 2024 at 01:59)</a>:</h4>
<p>thanks. how are you getting this breakdown?</p>



<a name="477946410"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/%E2%9C%94%20performance%20question/near/477946410" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/.E2.9C.94.20performance.20question.html#477946410">(Oct 21 2024 at 02:02)</a>:</h4>
<p>I'm currently on mac and using a profiler called <a href="https://github.com/mstange/samply">samply</a>. Should work on linux too I think. Just have to add <code>--linker=legacy</code> to roc.</p>



<a name="477946425"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/%E2%9C%94%20performance%20question/near/477946425" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/.E2.9C.94.20performance.20question.html#477946425">(Oct 21 2024 at 02:02)</a>:</h4>
<p>Otherwise, I tend to just use <code>perf</code> and a flamegraph tool if on linux</p>



<a name="477946547"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/%E2%9C%94%20performance%20question/near/477946547" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> drew <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/.E2.9C.94.20performance.20question.html#477946547">(Oct 21 2024 at 02:04)</a>:</h4>
<p>thanks!</p>



<a name="477947126"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/%E2%9C%94%20performance%20question/near/477947126" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> drew <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/.E2.9C.94.20performance.20question.html#477947126">(Oct 21 2024 at 02:12)</a>:</h4>
<p>FWIW i replaced all prepends with appends and it's about the same</p>



<a name="477947139"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/%E2%9C%94%20performance%20question/near/477947139" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> drew <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/.E2.9C.94.20performance.20question.html#477947139">(Oct 21 2024 at 02:12)</a>:</h4>
<p>just pushed the change</p>



<a name="477947213"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/%E2%9C%94%20performance%20question/near/477947213" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> drew <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/.E2.9C.94.20performance.20question.html#477947213">(Oct 21 2024 at 02:13)</a>:</h4>
<p>given all of the talk about competing with "fast" languages, i was thinking it would definitely beat gleam (erlang's performance) but perhaps my expectations are not aligned with reality here</p>



<a name="477947467"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/%E2%9C%94%20performance%20question/near/477947467" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> drew <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/.E2.9C.94.20performance.20question.html#477947467">(Oct 21 2024 at 02:17)</a>:</h4>
<p>(my <code>roc build --optimize</code> seems to be taking roughly forever as well)</p>



<a name="477947478"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/%E2%9C%94%20performance%20question/near/477947478" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> drew <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/.E2.9C.94.20performance.20question.html#477947478">(Oct 21 2024 at 02:17)</a>:</h4>
<p>ah finished in 37 seconds</p>



<a name="477947513"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/%E2%9C%94%20performance%20question/near/477947513" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> drew <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/.E2.9C.94.20performance.20question.html#477947513">(Oct 21 2024 at 02:17)</a>:</h4>
<p>certainly faster though</p>



<a name="477947520"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/%E2%9C%94%20performance%20question/near/477947520" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> drew <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/.E2.9C.94.20performance.20question.html#477947520">(Oct 21 2024 at 02:17)</a>:</h4>
<div class="codehilite"><pre><span></span><code>$ time ./main -y 2023 -d 14 -p 2
90982
./main -y 2023 -d 14 -p 2  0.42s user 0.01s system 69% cpu 0.616 total
</code></pre></div>



<a name="477947797"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/%E2%9C%94%20performance%20question/near/477947797" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> drew <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/.E2.9C.94.20performance.20question.html#477947797">(Oct 21 2024 at 02:21)</a>:</h4>
<p>not really related, but running <code>roc check</code> on almost every file in the project causes a compiler bug. i opened a minimal repro on github. thanks again for all the help!</p>



<a name="477947866"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/%E2%9C%94%20performance%20question/near/477947866" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> drew <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/.E2.9C.94.20performance.20question.html#477947866">(Oct 21 2024 at 02:22)</a>:</h4>
<p>(see <a href="https://github.com/roc-lang/roc/issues/7175">https://github.com/roc-lang/roc/issues/7175</a>)</p>



<a name="477948097"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/%E2%9C%94%20performance%20question/near/477948097" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/.E2.9C.94.20performance.20question.html#477948097">(Oct 21 2024 at 02:26)</a>:</h4>
<p>A little off-topic -- but man that samply app is awesome!! Just tested it out on the roc-ray demo I'm working on. &lt; 5% of the time is Roc stuff. <span aria-label="smiley" class="emoji emoji-1f603" role="img" title="smiley">:smiley:</span></p>



<a name="477951916"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/%E2%9C%94%20performance%20question/near/477951916" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/.E2.9C.94.20performance.20question.html#477951916">(Oct 21 2024 at 03:15)</a>:</h4>
<p><span class="user-mention silent" data-user-id="463085">drew</span> <a href="#narrow/channel/231634-beginners/topic/performance.20question/near/477947213">said</a>:</p>
<blockquote>
<p>given all of the talk about competing with "fast" languages, i was thinking it would definitely beat gleam (erlang's performance) but perhaps my expectations are not aligned with reality here</p>
</blockquote>
<p>explanations I can think of for why that might be are:</p>
<ul>
<li>we have an issue somewhere (e.g. in the compiler or builtins) that's causing a slowdown</li>
<li>the program doesn't run long enough for Gleam or Haskell to attempt a GC trace, whereas Roc pays for reference counting along the way, so that automatic memory management cost delta overwhelms the cost of the actual program (I'm not sure how much time is spent in refcounting here)</li>
<li>the applications differ in a way that means the Roc one is doing something slower than the others (e.g. <a href="#narrow/channel/231634-beginners/topic/performance.20question/near/477941041"><code>m</code></a> being deeply cloned in the Roc version but shallowly cloned in the languages that use persistent data structures for that operation - although it sounded like from later on in the conversation that maybe the flame graph showed other places being the bigger issue?)</li>
</ul>



<a name="477958768"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/%E2%9C%94%20performance%20question/near/477958768" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/.E2.9C.94.20performance.20question.html#477958768">(Oct 21 2024 at 04:52)</a>:</h4>
<p>The time of a non-optimized run got cut in half on my machine due to the changes from prepend to append</p>
<p>optimized build is about the same though</p>



<a name="477959051"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/%E2%9C%94%20performance%20question/near/477959051" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/.E2.9C.94.20performance.20question.html#477959051">(Oct 21 2024 at 04:55)</a>:</h4>
<p>About half of all samples in an optimized build are spent in some form of allocation function. That suggests tons of unnecessary data copying going on.</p>



<a name="477959172"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/%E2%9C%94%20performance%20question/near/477959172" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/.E2.9C.94.20performance.20question.html#477959172">(Oct 21 2024 at 04:56)</a>:</h4>
<p>Oh, it looks like small string hashing today leads to an allocation, a copy, hashing, a free....ew</p>



<a name="477959305"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/%E2%9C%94%20performance%20question/near/477959305" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/.E2.9C.94.20performance.20question.html#477959305">(Oct 21 2024 at 04:57)</a>:</h4>
<p>That's costing about 18% of the execution time, but is no where near the biggest contributor to extra allocations.</p>



<a name="477959518"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/%E2%9C%94%20performance%20question/near/477959518" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/.E2.9C.94.20performance.20question.html#477959518">(Oct 21 2024 at 04:59)</a>:</h4>
<p>This example probably will be good to tinker on. Some of it will be wielding roc incorrectly (cause it isn't design to run algorithms the same as gleam). Some of it will be things like extra allocations during string hashing.</p>



<a name="477964868"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/%E2%9C%94%20performance%20question/near/477964868" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/.E2.9C.94.20performance.20question.html#477964868">(Oct 21 2024 at 05:47)</a>:</h4>
<p>Also, simply changing away from all of those single character strings to <code>U8</code> is pretty huge for this app. (to be fair, fixing the str byte allocation thing would get a significant portion of the perf back as well, but still won't be as fast)</p>
<p>For me, changing from <code>Str</code> to <code>U8</code> leads to more than a 2x improvement for the optimized build</p>



<a name="477966477"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/%E2%9C%94%20performance%20question/near/477966477" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/.E2.9C.94.20performance.20question.html#477966477">(Oct 21 2024 at 06:01)</a>:</h4>
<div class="codehilite"><pre><span></span><code>Benchmark 1: ./main-str -y 2023 -d 14 -p 2
  Time (mean ± σ):     367.6 ms ±   3.1 ms    [User: 361.0 ms, System: 5.7 ms]
  Range (min … max):   362.4 ms … 374.0 ms    30 runs

Benchmark 2: ./main-u8 -y 2023 -d 14 -p 2
  Time (mean ± σ):     107.5 ms ±   0.4 ms    [User: 104.5 ms, System: 2.4 ms]
  Range (min … max):   106.8 ms … 108.4 ms    30 runs

Summary
  ./main-u8 -y 2023 -d 14 -p 2 ran
    3.42 ± 0.03 times faster than ./main-str -y 2023 -d 14 -p 2
</code></pre></div>
<p>Note, with <code>time</code> these benchmarks are generally around 2x slower. By running in a hot loop with the benchmarking tool, everything runs faster due to all of the files being fresh and in cache</p>



<a name="477995535"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/%E2%9C%94%20performance%20question/near/477995535" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anton <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/.E2.9C.94.20performance.20question.html#477995535">(Oct 21 2024 at 08:46)</a>:</h4>
<blockquote>
<p>i don’t understand how i keep hitting all of these things. i swear i’m just trying to write normal programs</p>
</blockquote>
<p>Apologies for the frustrating bugs and rough edges <span class="user-mention" data-user-id="463085">@drew</span>!<br>
Roc is a very complicated project and we work with very limited resources.</p>



<a name="478034028"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/%E2%9C%94%20performance%20question/near/478034028" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> drew <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/.E2.9C.94.20performance.20question.html#478034028">(Oct 21 2024 at 11:52)</a>:</h4>
<p>of course, no apologies necessary. i just want to make sure i’m approaching the language correctly. i have baggage from using other fp languages.</p>



<a name="478053027"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/%E2%9C%94%20performance%20question/near/478053027" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> drew <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/.E2.9C.94.20performance.20question.html#478053027">(Oct 21 2024 at 12:55)</a>:</h4>
<p><span class="user-mention silent" data-user-id="281383">Richard Feldman</span> <a href="#narrow/channel/231634-beginners/topic/performance.20question/near/477951916">said</a>:</p>
<blockquote>
<p><span class="user-mention silent" data-user-id="463085">drew</span> <a href="#narrow/channel/231634-beginners/topic/performance.20question/near/477947213">said</a>:</p>
<blockquote>
<p>given all of the talk about competing with "fast" languages, i was thinking it would definitely beat gleam (erlang's performance) but perhaps my expectations are not aligned with reality here</p>
</blockquote>
<p>explanations I can think of for why that might be are:</p>
<ul>
<li>we have an issue somewhere (e.g. in the compiler or builtins) that's causing a slowdown</li>
<li>the program doesn't run long enough for Gleam or Haskell to attempt a GC trace, whereas Roc pays for reference counting along the way, so that automatic memory management cost delta overwhelms the cost of the actual program (I'm not sure how much time is spent in refcounting here)</li>
<li>the applications differ in a way that means the Roc one is doing something slower than the others (e.g. <a href="#narrow/channel/231634-beginners/topic/performance.20question/near/477941041"><code>m</code></a> being deeply cloned in the Roc version but shallowly cloned in the languages that use persistent data structures for that operation - although it sounded like from later on in the conversation that maybe the flame graph showed other places being the bigger issue?)</li>
</ul>
</blockquote>
<p>makes sense, thanks for the detailed breakdown</p>



<a name="478055041"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/%E2%9C%94%20performance%20question/near/478055041" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> drew <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/.E2.9C.94.20performance.20question.html#478055041">(Oct 21 2024 at 13:03)</a>:</h4>
<p>as an aside, given that roc doesn't use persistent data structures, should i be thinking differently about how to write my code? i'm not sure how to idiomatically use immutable data structures that aren't also persistent</p>



<a name="478068290"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/%E2%9C%94%20performance%20question/near/478068290" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> drew <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/.E2.9C.94.20performance.20question.html#478068290">(Oct 21 2024 at 13:59)</a>:</h4>
<p><span class="user-mention silent" data-user-id="343810">Brendan Hansknecht</span> <a href="#narrow/channel/231634-beginners/topic/performance.20question/near/477964868">said</a>:</p>
<blockquote>
<p>Also, simply changing away from all of those single character strings to <code>U8</code> is pretty huge for this app. (to be fair, fixing the str byte allocation thing would get a significant portion of the perf back as well, but still won't be as fast)</p>
<p>For me, changing from <code>Str</code> to <code>U8</code> leads to more than a 2x improvement for the optimized build</p>
</blockquote>
<p>nice, i moved to <code>U8</code> and it was quite easy.</p>



<a name="478068444"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/%E2%9C%94%20performance%20question/near/478068444" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> drew <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/.E2.9C.94.20performance.20question.html#478068444">(Oct 21 2024 at 13:59)</a>:</h4>
<p>is it normal for the optimized builds to take ~30 seconds for this size of codebase? or have i hit something weird?</p>



<a name="478068579"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/%E2%9C%94%20performance%20question/near/478068579" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> drew <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/.E2.9C.94.20performance.20question.html#478068579">(Oct 21 2024 at 14:00)</a>:</h4>
<p>it's very fast now <span aria-label="smile" class="emoji emoji-1f642" role="img" title="smile">:smile:</span></p>



<a name="478068598"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/%E2%9C%94%20performance%20question/near/478068598" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> drew <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/.E2.9C.94.20performance.20question.html#478068598">(Oct 21 2024 at 14:00)</a>:</h4>
<div class="codehilite"><pre><span></span><code>$ time ./main -y 2023 -d 14 -p 2
90982
./main -y 2023 -d 14 -p 2  0.15s user 0.01s system 98% cpu 0.154 total
</code></pre></div>



<a name="478068713"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/%E2%9C%94%20performance%20question/near/478068713" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> drew <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/.E2.9C.94.20performance.20question.html#478068713">(Oct 21 2024 at 14:00)</a>:</h4>
<p>thanks for the help!</p>



<a name="478074371"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/%E2%9C%94%20performance%20question/near/478074371" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/.E2.9C.94.20performance.20question.html#478074371">(Oct 21 2024 at 14:23)</a>:</h4>
<p>awesome! <span aria-label="smiley" class="emoji emoji-1f603" role="img" title="smiley">:smiley:</span></p>



<a name="478074631"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/%E2%9C%94%20performance%20question/near/478074631" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/.E2.9C.94.20performance.20question.html#478074631">(Oct 21 2024 at 14:24)</a>:</h4>
<p>thanks for sticking with it and trying out different things</p>



<a name="478078107"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/%E2%9C%94%20performance%20question/near/478078107" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/.E2.9C.94.20performance.20question.html#478078107">(Oct 21 2024 at 14:39)</a>:</h4>
<p><span class="user-mention silent" data-user-id="463085">drew</span> <a href="#narrow/stream/231634-beginners/topic/performance.20question/near/478068444">said</a>:</p>
<blockquote>
<p>is it normal for the optimized builds to take ~30 seconds for this size of codebase? or have i hit something weird?</p>
</blockquote>
<p>we haven't spent much time trying to make the optimization itself run faster, but that does sound high to me too.</p>



<a name="478083108"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/%E2%9C%94%20performance%20question/near/478083108" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/.E2.9C.94.20performance.20question.html#478083108">(Oct 21 2024 at 14:59)</a>:</h4>
<p>Sounds really high to me. It also spends almost all of that time in the frontend. Not sure what is confusing the compiler, but I definitely think it is a bug or algorithm (in the compiler passes) that is designed fundamentally wrong</p>



<a name="478085278"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/%E2%9C%94%20performance%20question/near/478085278" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> drew <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/.E2.9C.94.20performance.20question.html#478085278">(Oct 21 2024 at 15:08)</a>:</h4>
<p><span class="user-mention silent" data-user-id="281383">Richard Feldman</span> <a href="#narrow/stream/231634-beginners/topic/performance.20question/near/478074631">said</a>:</p>
<blockquote>
<p>thanks for sticking with it and trying out different things</p>
</blockquote>
<p>thanks for the super positive engagement! i hope i’m not coming off as criticizing. i have very high hopes for the language.</p>



<a name="478088172"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/%E2%9C%94%20performance%20question/near/478088172" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anton <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/.E2.9C.94.20performance.20question.html#478088172">(Oct 21 2024 at 15:20)</a>:</h4>
<blockquote>
<p>i hope i’m not coming off as criticizing</p>
</blockquote>
<p>No worries, all cool :)</p>



<a name="478098462"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/%E2%9C%94%20performance%20question/near/478098462" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/.E2.9C.94.20performance.20question.html#478098462">(Oct 21 2024 at 16:07)</a>:</h4>
<p>Definitely not criticizing. This is really important discussion. Part of it is that we need to educate users better on how roc wants to be used for perf. Part of it is just perf bugs in roc. Both very importnant.</p>



<a name="478098773"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/%E2%9C%94%20performance%20question/near/478098773" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> drew <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/.E2.9C.94.20performance.20question.html#478098773">(Oct 21 2024 at 16:09)</a>:</h4>
<p>cool. i feel like i have a bunch of small "paper cut" things in my head, i may write them down in a private gist and share here</p>



<a name="478100211"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/%E2%9C%94%20performance%20question/near/478100211" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/.E2.9C.94.20performance.20question.html#478100211">(Oct 21 2024 at 16:15)</a>:</h4>
<blockquote>
<p>should i be thinking differently about how to write my code?</p>
</blockquote>
<p>In general, roc uses the same low level data structures that would be seen in C/C++/rust/zig. Generally one dense allocation. The big difference in roc is that everything is refcounted and immutable. As such, you have to be careful to design high performance sections of code to only have a single reference to the data structure. If you only have a single reference, roc can be significantly faster than persistent data structures. It will mutate in place. Also, flat data structures are much more cpu friendly than persistent ones. That said, if you have two reference in a hot loop, roc has no option but to copy. This is where perf can get really bad.</p>
<p>We think that in practice, this will be faster overall where it matters (though it may require some perf tuning). A big example showing off that this should work is borrow inference in rust. In rust, they compiler enforces that there is only ever one mutable reference to an object. If you need to mutate something and can't get a mutable reference, you have to manually clone. For most code, you don't have to worry about this too much. Standard code design tends to have few references for most things. Roc does essentially the same thing with 2 caveats: Roc simplifies code greatly by checking at runtime instead of compile time and Roc implicitly adds in the copy. So this is kinda the rust model but at runtime. Has similar theoretical perf limits (though has cost of refcounting added, and less super low level nobs), but requires runtime benchmarking and/or deeper awareness of reference counts when writing code at compile time.</p>



<a name="478101581"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/%E2%9C%94%20performance%20question/near/478101581" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/.E2.9C.94.20performance.20question.html#478101581">(Oct 21 2024 at 16:22)</a>:</h4>
<blockquote>
<p>I definitely think it is a bug or algorithm (in the compiler passes) that is designed fundamentally wrong</p>
</blockquote>
<p>84% of time spent in morphic. Yeah, that matches roughly what I expected. Generally when frontend time explodes, it is morphic</p>



<a name="478101748"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/%E2%9C%94%20performance%20question/near/478101748" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/.E2.9C.94.20performance.20question.html#478101748">(Oct 21 2024 at 16:23)</a>:</h4>
<p>This call stack is crazy recursive</p>



<a name="478102999"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/%E2%9C%94%20performance%20question/near/478102999" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/.E2.9C.94.20performance.20question.html#478102999">(Oct 21 2024 at 16:28)</a>:</h4>
<p>I think I have seen this exact thing before. I tried digging into it and fixing, but I don't understand morphic enough to fix it. I had mostly tried minor changes cause a lot of the time is spent in hash maps and iterators. Probably would really use someone with more context to look into it. That said, maybe we could get a presentation on the morphic code from some of the morphic folks? That might help more people be able to look into this kind of issue.</p>



<a name="478103269"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/%E2%9C%94%20performance%20question/near/478103269" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> drew <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/.E2.9C.94.20performance.20question.html#478103269">(Oct 21 2024 at 16:30)</a>:</h4>
<p>also, is there a better place for me to put these threads? "beginners" feels weird to me, but i couldn't think of anything else that made sense.</p>



<a name="478104332"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/%E2%9C%94%20performance%20question/near/478104332" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/.E2.9C.94.20performance.20question.html#478104332">(Oct 21 2024 at 16:35)</a>:</h4>
<p>Currently this is the best location, but maybe we should have another channel for things like this....not exactly sure what the split would be....performance optimization?</p>



<a name="478105324"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/%E2%9C%94%20performance%20question/near/478105324" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anton <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/.E2.9C.94.20performance.20question.html#478105324">(Oct 21 2024 at 16:41)</a>:</h4>
<p>just "performance" maybe? So people can go there with performance problems too, not just for optimization.</p>



<a name="478110807"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/%E2%9C%94%20performance%20question/near/478110807" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/.E2.9C.94.20performance.20question.html#478110807">(Oct 21 2024 at 17:11)</a>:</h4>
<p>I like that idea!</p>



<a name="478112384"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/%E2%9C%94%20performance%20question/near/478112384" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anton <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/.E2.9C.94.20performance.20question.html#478112384">(Oct 21 2024 at 17:20)</a>:</h4>
<p>For the description, should we go with "To discuss performance of Roc programs and the compiler."</p>



<a name="478112559"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/%E2%9C%94%20performance%20question/near/478112559" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> drew <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/.E2.9C.94.20performance.20question.html#478112559">(Oct 21 2024 at 17:21)</a>:</h4>
<p>should there also be a "bugs" channel? i suppose that could go in "compiler development" but that also feels weird</p>



<a name="478115994"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/%E2%9C%94%20performance%20question/near/478115994" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anton <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/.E2.9C.94.20performance.20question.html#478115994">(Oct 21 2024 at 17:40)</a>:</h4>
<p>Done!</p>



<a name="478129110"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/%E2%9C%94%20performance%20question/near/478129110" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Notification Bot <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/.E2.9C.94.20performance.20question.html#478129110">(Oct 21 2024 at 18:58)</a>:</h4>
<p><span class="user-mention silent" data-user-id="463085">drew</span> has marked this topic as resolved.</p>



<hr><p>Last updated: Nov 01 2025 at 12:13 UTC</p>
</html>