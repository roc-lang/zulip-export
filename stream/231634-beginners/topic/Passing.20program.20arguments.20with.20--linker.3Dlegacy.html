<html>
<head><meta charset="utf-8"><title>Passing program arguments with --linker=legacy · beginners · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/index.html">beginners</a></h2>
<h3>Topic: <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Passing.20program.20arguments.20with.20--linker.3Dlegacy.html">Passing program arguments with --linker=legacy</a></h3>

<hr>

<base href="https://roc.zulipchat.com">

<head><link href="https://roc-lang.github.io/zulip-export/style.css" rel="stylesheet"></head>

<a name="408480000"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Passing%20program%20arguments%20with%20--linker%3Dlegacy/near/408480000" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Karakatiza <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Passing.20program.20arguments.20with.20--linker.3Dlegacy.html#408480000">(Dec 17 2023 at 21:00)</a>:</h4>
<p>Does legacy linker not support cli arguments, e.g. with <code>roc dev --linker=legacy -- http://localhost:8080</code> <code>Arg.list</code> returns an empty list?</p>



<a name="408483110"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Passing%20program%20arguments%20with%20--linker%3Dlegacy/near/408483110" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Passing.20program.20arguments.20with.20--linker.3Dlegacy.html#408483110">(Dec 17 2023 at 21:51)</a>:</h4>
<p>It should do. Also Arg.list should at least return the name of the executable I think.</p>



<a name="408483957"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Passing%20program%20arguments%20with%20--linker%3Dlegacy/near/408483957" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Karakatiza <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Passing.20program.20arguments.20with.20--linker.3Dlegacy.html#408483957">(Dec 17 2023 at 22:03)</a>:</h4>
<p>It does return the name, but with either roc dev or standalone executable args don't seem to get passed.</p>



<a name="408484189"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Passing%20program%20arguments%20with%20--linker%3Dlegacy/near/408484189" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Passing.20program.20arguments.20with.20--linker.3Dlegacy.html#408484189">(Dec 17 2023 at 22:05)</a>:</h4>
<p>Legacy linker should have nothing to do with the args</p>



<a name="408484239"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Passing%20program%20arguments%20with%20--linker%3Dlegacy/near/408484239" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Passing.20program.20arguments.20with.20--linker.3Dlegacy.html#408484239">(Dec 17 2023 at 22:06)</a>:</h4>
<p>Not sure what is eating the args in this case</p>



<a name="408484255"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Passing%20program%20arguments%20with%20--linker%3Dlegacy/near/408484255" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Passing.20program.20arguments.20with.20--linker.3Dlegacy.html#408484255">(Dec 17 2023 at 22:06)</a>:</h4>
<p>I have definitely gotten all args from <code>Args.list</code> maybe an issue specific to OS?</p>



<a name="408484309"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Passing%20program%20arguments%20with%20--linker%3Dlegacy/near/408484309" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Karakatiza <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Passing.20program.20arguments.20with.20--linker.3Dlegacy.html#408484309">(Dec 17 2023 at 22:07)</a>:</h4>
<p>Weird. I'm on non-WSL Ubuntu ~20. I'll do some more testing tomorrow</p>



<a name="408484387"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Passing%20program%20arguments%20with%20--linker%3Dlegacy/near/408484387" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Passing.20program.20arguments.20with.20--linker.3Dlegacy.html#408484387">(Dec 17 2023 at 22:08)</a>:</h4>
<p>Hmm....actually one idea. How does rust initialize args? I have never dug into that. Calling rust from c may not initialize the args. So could be a legacy linker issue due to that.</p>



<a name="408485430"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Passing%20program%20arguments%20with%20--linker%3Dlegacy/near/408485430" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Passing.20program.20arguments.20with.20--linker.3Dlegacy.html#408485430">(Dec 17 2023 at 22:25)</a>:</h4>
<p>Could be an issue with this?</p>
<blockquote>
<p>On glibc Linux systems, arguments are retrieved by placing a function in .init_array. glibc passes argc, argv, and envp to functions in .init_array, as a non-standard extension. This allows std::env::args to work even in a cdylib or staticlib, as it does on macOS and Windows.</p>
</blockquote>



<a name="408485446"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Passing%20program%20arguments%20with%20--linker%3Dlegacy/near/408485446" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Passing.20program.20arguments.20with.20--linker.3Dlegacy.html#408485446">(Dec 17 2023 at 22:25)</a>:</h4>
<p>From the rust docs: <a href="https://doc.rust-lang.org/std/env/fn.args.html">https://doc.rust-lang.org/std/env/fn.args.html</a></p>



<a name="428066594"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Passing%20program%20arguments%20with%20--linker%3Dlegacy/near/428066594" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Karakatiza <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Passing.20program.20arguments.20with.20--linker.3Dlegacy.html#428066594">(Mar 21 2024 at 06:54)</a>:</h4>
<p>Coming back to this as the issue persists; I needed to create a CLI program that both utilizes Arg.list and roc-json library, and it looks like either way one of them gets broken whether or not you use --linker=legacy <span aria-label="smiling face with tear" class="emoji emoji-1f972" role="img" title="smiling face with tear">:smiling_face_with_tear:</span></p>



<a name="428072958"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Passing%20program%20arguments%20with%20--linker%3Dlegacy/near/428072958" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Passing.20program.20arguments.20with.20--linker.3Dlegacy.html#428072958">(Mar 21 2024 at 07:55)</a>:</h4>
<p>What if you build the program first? </p>
<p><code>roc build --linker=legacy abc.roc</code></p>
<p>And then run it passing some args...</p>
<p><code>abc http://localhost:8080 </code></p>



<a name="428073180"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Passing%20program%20arguments%20with%20--linker%3Dlegacy/near/428073180" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Passing.20program.20arguments.20with.20--linker.3Dlegacy.html#428073180">(Mar 21 2024 at 07:57)</a>:</h4>
<p><span class="user-mention silent" data-user-id="654587">Karakatiza</span> <a href="#narrow/stream/231634-beginners/topic/Passing.20program.20arguments.20with.20--linker.3Dlegacy/near/408483957">said</a>:</p>
<blockquote>
<p>It does return the name, but with either roc dev or standalone executable args don't seem to get passed.</p>
</blockquote>
<p>I see you've tried that... strange</p>



<a name="429974055"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Passing%20program%20arguments%20with%20--linker%3Dlegacy/near/429974055" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Karakatiza <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Passing.20program.20arguments.20with.20--linker.3Dlegacy.html#429974055">(Mar 28 2024 at 00:57)</a>:</h4>
<p><span class="user-mention" data-user-id="515757">@Luke Boswell</span> does it make sense to work on my own implementation for JSON in Roc just to get things done? Or is there a specific syntax in roc-json code that could be refactored in a fork to avoid the bug it is blocked by without legacy linker?</p>



<a name="429974890"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Passing%20program%20arguments%20with%20--linker%3Dlegacy/near/429974890" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Passing.20program.20arguments.20with.20--linker.3Dlegacy.html#429974890">(Mar 28 2024 at 01:06)</a>:</h4>
<p>Do you have an example you can share or are working on?</p>



<a name="429974901"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Passing%20program%20arguments%20with%20--linker%3Dlegacy/near/429974901" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Passing.20program.20arguments.20with.20--linker.3Dlegacy.html#429974901">(Mar 28 2024 at 01:06)</a>:</h4>
<p>I wouldn't suggest writing a new implementation</p>



<a name="429975244"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Passing%20program%20arguments%20with%20--linker%3Dlegacy/near/429975244" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Passing.20program.20arguments.20with.20--linker.3Dlegacy.html#429975244">(Mar 28 2024 at 01:11)</a>:</h4>
<p>I can try and re-produce on my linux machine later today, I'll have a look now on my mac</p>



<a name="429975464"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Passing%20program%20arguments%20with%20--linker%3Dlegacy/near/429975464" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Karakatiza <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Passing.20program.20arguments.20with.20--linker.3Dlegacy.html#429975464">(Mar 28 2024 at 01:14)</a>:</h4>
<p>Don't have a share-able piece of code, but I simply would like to write a program that uses Arg.list and roc-json library at the same time</p>



<a name="429975970"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Passing%20program%20arguments%20with%20--linker%3Dlegacy/near/429975970" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Passing.20program.20arguments.20with.20--linker.3Dlegacy.html#429975970">(Mar 28 2024 at 01:19)</a>:</h4>
<p>I'm working on an example now</p>



<a name="429976486"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Passing%20program%20arguments%20with%20--linker%3Dlegacy/near/429976486" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Passing.20program.20arguments.20with.20--linker.3Dlegacy.html#429976486">(Mar 28 2024 at 01:25)</a>:</h4>
<p>Curiously, </p>
<p>This works </p>
<div class="codehilite"><pre><span></span><code>main =
    args &lt;- Arg.list |&gt; Task.await

    Stdout.line &quot;Foo, first: $(Inspect.toStr args)&quot;
</code></pre></div>
<p>But this crashes with <code>panicked at 'called </code>Option::unwrap()<code> on a </code>None<code> value', crates/compiler/mono/src/ir.rs:6143:56</code></p>
<div class="codehilite"><pre><span></span><code>main = run |&gt; Task.onErr \err -&gt; Stdout.line &quot;ERROR: $(Inspect.toStr err)&quot;

run =
    args &lt;- Arg.list |&gt; Task.await

    Stdout.line &quot;Foo, first: $(Inspect.toStr args)&quot;
</code></pre></div>



<a name="429976606"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Passing%20program%20arguments%20with%20--linker%3Dlegacy/near/429976606" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Karakatiza <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Passing.20program.20arguments.20with.20--linker.3Dlegacy.html#429976606">(Mar 28 2024 at 01:26)</a>:</h4>
<p>Does the first program work with --linker=legacy for you?</p>



<a name="429976671"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Passing%20program%20arguments%20with%20--linker%3Dlegacy/near/429976671" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Passing.20program.20arguments.20with.20--linker.3Dlegacy.html#429976671">(Mar 28 2024 at 01:27)</a>:</h4>
<p>Yes,</p>
<div class="codehilite"><pre><span></span><code>$ roc run --linker=legacy test-arg-json.roc -- blah
Foo, first: [&quot;/var/folders/48/39th9k0n0wdcj18k3yhm_g5c0000gn/T/.tmpfcsKBR/roc_app_binary&quot;, &quot;blah&quot;]
</code></pre></div>



<a name="429976756"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Passing%20program%20arguments%20with%20--linker%3Dlegacy/near/429976756" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Passing.20program.20arguments.20with.20--linker.3Dlegacy.html#429976756">(Mar 28 2024 at 01:28)</a>:</h4>
<p>So I suspect there is a bug or something strange in the platform</p>



<a name="429976764"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Passing%20program%20arguments%20with%20--linker%3Dlegacy/near/429976764" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Passing.20program.20arguments.20with.20--linker.3Dlegacy.html#429976764">(Mar 28 2024 at 01:28)</a>:</h4>
<p>Specifically with Arg</p>



<a name="429977134"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Passing%20program%20arguments%20with%20--linker%3Dlegacy/near/429977134" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Passing.20program.20arguments.20with.20--linker.3Dlegacy.html#429977134">(Mar 28 2024 at 01:32)</a>:</h4>
<p>Found the issue</p>



<a name="429977147"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Passing%20program%20arguments%20with%20--linker%3Dlegacy/near/429977147" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Passing.20program.20arguments.20with.20--linker.3Dlegacy.html#429977147">(Mar 28 2024 at 01:33)</a>:</h4>
<p>Have a workaround, just making an example with json for you</p>



<a name="429977170"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Passing%20program%20arguments%20with%20--linker%3Dlegacy/near/429977170" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Karakatiza <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Passing.20program.20arguments.20with.20--linker.3Dlegacy.html#429977170">(Mar 28 2024 at 01:33)</a>:</h4>
<p>Oh well, it doesn't work on Ubuntu 22.04.4 LTS with --linker=legacy for me.</p>



<a name="429977201"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Passing%20program%20arguments%20with%20--linker%3Dlegacy/near/429977201" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Karakatiza <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Passing.20program.20arguments.20with.20--linker.3Dlegacy.html#429977201">(Mar 28 2024 at 01:33)</a>:</h4>
<p>The output without --linker=legacy is as expected, <code>Foo, first: ["/proc/self/fd/3", "blah"]</code></p>



<a name="429977254"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Passing%20program%20arguments%20with%20--linker%3Dlegacy/near/429977254" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Karakatiza <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Passing.20program.20arguments.20with.20--linker.3Dlegacy.html#429977254">(Mar 28 2024 at 01:34)</a>:</h4>
<p>With - <code>Foo, first: []</code></p>



<a name="429977301"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Passing%20program%20arguments%20with%20--linker%3Dlegacy/near/429977301" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Karakatiza <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Passing.20program.20arguments.20with.20--linker.3Dlegacy.html#429977301">(Mar 28 2024 at 01:34)</a>:</h4>
<p>base-cli 0.8.1</p>



<a name="429978074"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Passing%20program%20arguments%20with%20--linker%3Dlegacy/near/429978074" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Passing.20program.20arguments.20with.20--linker.3Dlegacy.html#429978074">(Mar 28 2024 at 01:43)</a>:</h4>
<p>So what I had to do was modify basic-cli and use a local copy. I changed the err type on the <code>Arg.list</code> in the platform as follows.</p>
<div class="codehilite"><pre><span></span><code>## Gives a list of the program&#39;s command-line arguments.
# list : Task (List Str) * &lt;-- err type BROKEN
# list : Task (List Str) a &lt;-- err type BROKEN
# list : Task (List Str) _ &lt;-- err type BROKEN
list : Task (List Str) []
list =
    Effect.args
    |&gt; Effect.map Ok
    |&gt; InternalTask.fromEffect
</code></pre></div>



<a name="429978114"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Passing%20program%20arguments%20with%20--linker%3Dlegacy/near/429978114" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Passing.20program.20arguments.20with.20--linker.3Dlegacy.html#429978114">(Mar 28 2024 at 01:43)</a>:</h4>
<p>The I used the following program with something like <code>$ roc dev test-arg-json.roc -- "{"field":"value"}"</code></p>
<div class="codehilite" data-code-language="roc"><pre><span></span><code>app "json"
    packages {
        cli: "../basic-cli/platform/main.roc",
        # cli: "https://github.com/roc-lang/basic-cli/releases/download/0.8.1/x8URkvfyi9I0QhmVG98roKBUs_AZRkLFwFJVJ3942YA.tar.br",
        json: "https://github.com/lukewilliamboswell/roc-json/releases/download/0.6.3/_2Dh4Eju2v_tFtZeMq8aZ9qw2outG04NbkmKpFhXS_4.tar.br",
    }
    imports [
        cli.Stdout,
        cli.Task.{ Task },
        cli.Arg,
        json.Core.{json},
    ]
    provides [main] to cli

main = run |&gt; Task.onErr \err -&gt; Stdout.line "ERROR: $(Inspect.toStr err)"

run =
    firstArgStr &lt;- getArgs |&gt; Task.await

    result = parseJson firstArgStr

    result
    |&gt; Inspect.toStr
    |&gt; Stdout.line

getArgs : Task Str _
getArgs =
    args &lt;-
        Arg.list
        |&gt; Task.mapErr UnableToGetArgs
        |&gt; Task.await

    when args is
        [_, first, ..] -&gt; Task.ok first
        _ -&gt; Task.err UnableToParseArgs

parseJson : Str -&gt; Result { field: Str } _
parseJson = \str -&gt;
    Decode.fromBytes (Str.toUtf8 str) json
    |&gt; Result.mapErr \err -&gt;
        when err is
            Leftover bytes -&gt; Leftover (Str.fromUtf8 bytes)
            _ -&gt; JsonErr err
</code></pre></div>



<a name="429978196"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Passing%20program%20arguments%20with%20--linker%3Dlegacy/near/429978196" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Passing.20program.20arguments.20with.20--linker.3Dlegacy.html#429978196">(Mar 28 2024 at 01:44)</a>:</h4>
<p>This doesn't parse the json correctly, I'm forgetting how to use roc-json, but it runs and gives an nice error <code>(Err (Leftover (Ok "{field:value}")))</code></p>



<a name="429978235"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Passing%20program%20arguments%20with%20--linker%3Dlegacy/near/429978235" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Passing.20program.20arguments.20with.20--linker.3Dlegacy.html#429978235">(Mar 28 2024 at 01:45)</a>:</h4>
<p>Are you able to test this please?</p>



<a name="429978236"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Passing%20program%20arguments%20with%20--linker%3Dlegacy/near/429978236" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Karakatiza <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Passing.20program.20arguments.20with.20--linker.3Dlegacy.html#429978236">(Mar 28 2024 at 01:45)</a>:</h4>
<p>Could you reproduce my issue, though?</p>



<a name="429978337"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Passing%20program%20arguments%20with%20--linker%3Dlegacy/near/429978337" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Passing.20program.20arguments.20with.20--linker.3Dlegacy.html#429978337">(Mar 28 2024 at 01:46)</a>:</h4>
<p>I don't see any difference with using <code>--linker=legacy</code>, but I'm on my mac</p>



<a name="429979716"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Passing%20program%20arguments%20with%20--linker%3Dlegacy/near/429979716" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Karakatiza <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Passing.20program.20arguments.20with.20--linker.3Dlegacy.html#429979716">(Mar 28 2024 at 02:02)</a>:</h4>
<p>Will have to test your example tomorrow<br>
It seems my issue is a different one, and I do not have the expertise or capacity to debug the Rust implementation you mentioned a while ago in this thread</p>



<a name="429979910"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Passing%20program%20arguments%20with%20--linker%3Dlegacy/near/429979910" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Passing.20program.20arguments.20with.20--linker.3Dlegacy.html#429979910">(Mar 28 2024 at 02:05)</a>:</h4>
<p>In case it helps here is the current implementation of <code>Args.list</code> effect in the platform. </p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="cp">#[no_mangle]</span>
<span class="k">pub</span><span class="w"> </span><span class="k">extern</span><span class="w"> </span><span class="s">"C"</span><span class="w"> </span><span class="k">fn</span> <span class="nf">roc_fx_args</span><span class="p">()</span><span class="w"> </span>-&gt; <span class="nc">RocList</span><span class="o">&lt;</span><span class="n">RocStr</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// TODO: can we be more efficient about reusing the String's memory for RocStr?</span>
<span class="w">    </span><span class="n">std</span>::<span class="n">env</span>::<span class="n">args_os</span><span class="p">()</span>
<span class="w">        </span><span class="p">.</span><span class="n">map</span><span class="p">(</span><span class="o">|</span><span class="n">os_str</span><span class="o">|</span><span class="w"> </span><span class="n">RocStr</span>::<span class="n">from</span><span class="p">(</span><span class="n">os_str</span><span class="p">.</span><span class="n">to_string_lossy</span><span class="p">().</span><span class="n">borrow</span><span class="p">()))</span>
<span class="w">        </span><span class="p">.</span><span class="n">collect</span><span class="p">()</span>
<span class="p">}</span>
</code></pre></div>



<a name="429980075"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Passing%20program%20arguments%20with%20--linker%3Dlegacy/near/429980075" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Passing.20program.20arguments.20with.20--linker.3Dlegacy.html#429980075">(Mar 28 2024 at 02:08)</a>:</h4>
<p>I would recommend writing a simple rust program and seeing what the behaviour is just using <code>std::env::args_os()</code> to see if it is a roc issue or something else.</p>



<a name="429982117"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Passing%20program%20arguments%20with%20--linker%3Dlegacy/near/429982117" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Passing.20program.20arguments.20with.20--linker.3Dlegacy.html#429982117">(Mar 28 2024 at 02:30)</a>:</h4>
<p>Mac is always legacy linker</p>



<a name="429982170"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Passing%20program%20arguments%20with%20--linker%3Dlegacy/near/429982170" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Passing.20program.20arguments.20with.20--linker.3Dlegacy.html#429982170">(Mar 28 2024 at 02:30)</a>:</h4>
<p>So wouldn't be able to repro linking bugs seen on linux</p>



<a name="429982460"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Passing%20program%20arguments%20with%20--linker%3Dlegacy/near/429982460" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Karakatiza <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Passing.20program.20arguments.20with.20--linker.3Dlegacy.html#429982460">(Mar 28 2024 at 02:32)</a>:</h4>
<p>In my case the bug is reproduced with legacy linker, so that would mean the mac and linux legacy linker behavior is different</p>



<a name="429982996"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Passing%20program%20arguments%20with%20--linker%3Dlegacy/near/429982996" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Passing.20program.20arguments.20with.20--linker.3Dlegacy.html#429982996">(Mar 28 2024 at 02:40)</a>:</h4>
<p>Ah, I missed that. Intriguing</p>



<a name="430183096"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Passing%20program%20arguments%20with%20--linker%3Dlegacy/near/430183096" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Karakatiza <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Passing.20program.20arguments.20with.20--linker.3Dlegacy.html#430183096">(Mar 29 2024 at 00:31)</a>:</h4>
<p>I haven't yet tested the above patch to base-cli or a simple Rust program, but it seems like roc-json works as expected without --linker=legacy despite the warning in the docs. I will come back to this thread if I hit a wall</p>



<hr><p>Last updated: Nov 01 2025 at 12:13 UTC</p>
</html>