<html>
<head><meta charset="utf-8"><title>Zig error during build · beginners · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/index.html">beginners</a></h2>
<h3>Topic: <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Zig.20error.20during.20build.html">Zig error during build</a></h3>

<hr>

<base href="https://roc.zulipchat.com">

<head><link href="https://roc-lang.github.io/zulip-export/style.css" rel="stylesheet"></head>

<a name="279820622"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Zig%20error%20during%20build/near/279820622" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Maxime Tremblay <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Zig.20error.20during.20build.html#279820622">(Apr 22 2022 at 13:04)</a>:</h4>
<p>Hello, I follow the manual installation instruction on Fedora 35 since I understand that the nix setup won't allow me to use the editor on my intel machine.</p>
<p>However, I get the following error when running cargo build</p>
<div class="codehilite"><pre><span></span><code>error: failed to run custom build command for `roc_builtins v0.1.0 (/home/maxime/Documents/roc/compiler/builtins)`

Caused by:
  process didn&#39;t exit successfully: `/home/maxime/Documents/roc/target/debug/build/roc_builtins-88c944ea58fa3aaa/build-script-build` (exit status: 101)
  --- stdout
  cargo:rerun-if-changed=build.rs
  Compiling host ir to: /home/maxime/Documents/roc/compiler/builtins/bitcode/builtins-host.ll

  --- stderr
  thread &#39;main&#39; panicked at &#39;zig failed: ./build.zig:60:24: error: expected type &#39;std.build.EmitOption&#39;, found &#39;bool&#39;
      obj.emit_llvm_ir = true;
                         ^
  /usr/lib/zig/std/build.zig:1597:28: note: std.build.EmitOption declared here
      pub const EmitOption = union(enum) {
                             ^
  &#39;, compiler/builtins/build.rs:182:17
  note: run with `RUST_BACKTRACE=1` environment variable to display a backtrace
warning: build failed, waiting
</code></pre></div>



<a name="279820754"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Zig%20error%20during%20build/near/279820754" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Maxime Tremblay <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Zig.20error.20during.20build.html#279820754">(Apr 22 2022 at 13:04)</a>:</h4>
<p>Any idea how to fix that?</p>



<a name="279820763"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Zig%20error%20during%20build/near/279820763" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Zig.20error.20during.20build.html#279820763">(Apr 22 2022 at 13:05)</a>:</h4>
<p>can you run <code>zig version</code>?</p>



<a name="279820952"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Zig%20error%20during%20build/near/279820952" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Maxime Tremblay <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Zig.20error.20during.20build.html#279820952">(Apr 22 2022 at 13:06)</a>:</h4>
<p>0.9.1</p>



<a name="279821064"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Zig%20error%20during%20build/near/279821064" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Zig.20error.20during.20build.html#279821064">(Apr 22 2022 at 13:07)</a>:</h4>
<p>ah, we didn't upgrate to zig 0.9.1 yet</p>



<a name="279821071"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Zig%20error%20during%20build/near/279821071" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Zig.20error.20during.20build.html#279821071">(Apr 22 2022 at 13:07)</a>:</h4>
<p>it's in the pipeline</p>



<a name="279821383"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Zig%20error%20during%20build/near/279821383" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Maxime Tremblay <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Zig.20error.20during.20build.html#279821383">(Apr 22 2022 at 13:10)</a>:</h4>
<p>I tried zig 0.8.1, didn't work either</p>
<div class="codehilite"><pre><span></span><code>Caused by:
  process didn&#39;t exit successfully: `/home/maxime/Documents/roc/target/debug/build/roc_builtins-88c944ea58fa3aaa/build-script-build` (exit status: 101)
  --- stdout
  cargo:rerun-if-changed=build.rs
  Compiling host ir to: /home/maxime/Documents/roc/compiler/builtins/bitcode/builtins-host.ll

  --- stderr
  thread &#39;main&#39; panicked at &#39;zig failed: /home/maxime/Documents/roc/compiler/builtins/bitcode/src/num.zig:27:21: error: unused capture
  /home/maxime/Documents/roc/compiler/builtins/bitcode/src/num.zig:40:21: error: unused capture
  /home/maxime/Documents/roc/compiler/builtins/bitcode/src/str.zig:2044:35: error: unused capture
  /home/maxime/Documents/roc/compiler/builtins/bitcode/src/list.zig:1329:5: error: unused function parameter
  builtins-host...The following command exited with error code 1:
  /usr/bin/zig build-obj /home/maxime/Documents/roc/compiler/builtins/bitcode/src/main.zig -femit-llvm-ir -fno-emit-bin --strip -OReleaseFast --cache-dir /home/maxime/Documents/roc/compiler/builtins/bitcode/zig-cache --global-cache-dir /home/maxime/.cache/zig --name builtins-host -target native-native --enable-cache
  error: the following build command failed with exit code 1:
  /home/maxime/Documents/roc/compiler/builtins/bitcode/zig-cache/o/e85ea97b8a95d34f949e26b3f0ea5c21/build /usr/bin/zig /home/maxime/Documents/roc/compiler/builtins/bitcode /home/maxime/Documents/roc/compiler/builtins/bitcode/zig-cache /home/maxime/.cache/zig ir -Drelease=true
  &#39;, compiler/builtins/build.rs:182:17
  note: run with `RUST_BACKTRACE=1` environment variable to display a backtrace
</code></pre></div>



<a name="279821956"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Zig%20error%20during%20build/near/279821956" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Zig.20error.20during.20build.html#279821956">(Apr 22 2022 at 13:15)</a>:</h4>
<p>CI and I personally use 0.8.0</p>



<a name="279822161"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Zig%20error%20during%20build/near/279822161" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Zig.20error.20during.20build.html#279822161">(Apr 22 2022 at 13:17)</a>:</h4>
<p>I'm on 0.8.1. on macOS <span aria-label="thinking" class="emoji emoji-1f914" role="img" title="thinking">:thinking:</span></p>



<a name="279822421"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Zig%20error%20during%20build/near/279822421" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Zig.20error.20during.20build.html#279822421">(Apr 22 2022 at 13:18)</a>:</h4>
<p>those errors are strange:</p>
<blockquote>
<p>compiler/builtins/bitcode/src/num.zig:27:21: error: unused capture<br>
compiler/builtins/bitcode/src/num.zig:40:21: error: unused capture<br>
compiler/builtins/bitcode/src/str.zig:2044:35: error: unused capture<br>
compiler/builtins/bitcode/src/list.zig:1329:5: error: unused function parameter</p>
</blockquote>
<p>I'd expect everyone using Zig 0.8.1 to get those same errors, or nobody</p>



<a name="279822442"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Zig%20error%20during%20build/near/279822442" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Zig.20error.20during.20build.html#279822442">(Apr 22 2022 at 13:18)</a>:</h4>
<p>I assume this was on <code>trunk</code>?</p>



<a name="279822562"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Zig%20error%20during%20build/near/279822562" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Zig.20error.20during.20build.html#279822562">(Apr 22 2022 at 13:19)</a>:</h4>
<p>well those errors are really just warnings, so you should be close to get it working anyhow</p>



<a name="279822730"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Zig%20error%20during%20build/near/279822730" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Maxime Tremblay <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Zig.20error.20during.20build.html#279822730">(Apr 22 2022 at 13:21)</a>:</h4>
<p>Yes. I pulled again just in case without success. I also try to fix these errors by doing a dummy usage of the variables. </p>
<p>Here is what I have now </p>
<div class="codehilite"><pre><span></span><code>--- stderr
  thread &#39;main&#39; panicked at &#39;zig failed: builtins-host...The following command terminated unexpectedly:
  /usr/bin/zig build-obj /home/maxime/Documents/roc/compiler/builtins/bitcode/src/main.zig -femit-llvm-ir -fno-emit-bin --strip -OReleaseFast --cache-dir /home/maxime/Documents/roc/compiler/builtins/bitcode/zig-cache --global-cache-dir /home/maxime/.cache/zig --name builtins-host -target native-native --enable-cache
  error: the following build command failed with exit code 11:
  /home/maxime/Documents/roc/compiler/builtins/bitcode/zig-cache/o/e85ea97b8a95d34f949e26b3f0ea5c21/build /usr/bin/zig /home/maxime/Documents/roc/compiler/builtins/bitcode /home/maxime/Documents/roc/compiler/builtins/bitcode/zig-cache /home/maxime/.cache/zig ir -Drelease=true
</code></pre></div>



<a name="279822761"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Zig%20error%20during%20build/near/279822761" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Zig.20error.20during.20build.html#279822761">(Apr 22 2022 at 13:21)</a>:</h4>
<p>oh, maybe remove zig-cache</p>



<a name="279822776"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Zig%20error%20during%20build/near/279822776" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Zig.20error.20during.20build.html#279822776">(Apr 22 2022 at 13:21)</a>:</h4>
<p>it does not work so well when you switch zig versions but keep the same cache</p>



<a name="279822783"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Zig%20error%20during%20build/near/279822783" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Zig.20error.20during.20build.html#279822783">(Apr 22 2022 at 13:21)</a>:</h4>
<p>but usually it doesn't fail loudly</p>



<a name="279822841"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Zig%20error%20during%20build/near/279822841" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Zig.20error.20during.20build.html#279822841">(Apr 22 2022 at 13:22)</a>:</h4>
<p>or, well, it doesn't tell you that that is what the problem is</p>



<a name="279823178"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Zig%20error%20during%20build/near/279823178" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Maxime Tremblay <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Zig.20error.20during.20build.html#279823178">(Apr 22 2022 at 13:25)</a>:</h4>
<p>I did <code>rm -r ~/.cache/zig/*</code> and I still get the same error.</p>



<a name="279823180"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Zig%20error%20during%20build/near/279823180" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Maxime Tremblay <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Zig.20error.20during.20build.html#279823180">(Apr 22 2022 at 13:25)</a>:</h4>
<p>(By the way, thanks for helping me out)</p>



<a name="279825117"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Zig%20error%20during%20build/near/279825117" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Zig.20error.20during.20build.html#279825117">(Apr 22 2022 at 13:40)</a>:</h4>
<p>maybe also try this one <code>/home/maxime/Documents/roc/compiler/builtins/bitcode/zig-cache</code></p>



<a name="279826588"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Zig%20error%20during%20build/near/279826588" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Maxime Tremblay <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Zig.20error.20during.20build.html#279826588">(Apr 22 2022 at 13:53)</a>:</h4>
<p>I did. With <code>cargo clean</code>. It didn't work either.</p>



<a name="279827082"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Zig%20error%20during%20build/near/279827082" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Zig.20error.20during.20build.html#279827082">(Apr 22 2022 at 13:57)</a>:</h4>
<p>hmm, what does <code>zig build test</code> do?</p>



<a name="279827327"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Zig%20error%20during%20build/near/279827327" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Maxime Tremblay <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Zig.20error.20during.20build.html#279827327">(Apr 22 2022 at 13:59)</a>:</h4>
<div class="codehilite"><pre><span></span><code>  ~/Documents/roc/compiler/builtins/bitcode   trunk !5 ?2
❯ zig build test
./src/dec.zig:142:82: error: expected type &#39;std.fmt.Case&#39;, found &#39;bool&#39;
        var num_digits = std.fmt.formatIntBuf(digit_bytes_storage[0..], num, 10, false, .{});
                                                                                 ^
/usr/lib/zig/std/fmt.zig:735:18: note: std.fmt.Case declared here
pub const Case = enum { lower, upper };
                 ^
./src/dec.zig:142:46: note: referenced here
        var num_digits = std.fmt.formatIntBuf(digit_bytes_storage[0..], num, 10, false, .{});
                                             ^
The following command exited with error code 1:
/usr/bin/zig test /home/maxime/Documents/roc/compiler/builtins/bitcode/src/main.zig -lc --cache-dir /home/maxime/Documents/roc/compiler/builtins/bitcode/zig-cache --global-cache-dir /home/maxime/.cache/zig --name test
error: the following build command failed with exit code 1:
/home/maxime/Documents/roc/compiler/builtins/bitcode/zig-cache/o/e85ea97b8a95d34f949e26b3f0ea5c21/build /usr/bin/zig /home/maxime/Documents/roc/compiler/builtins/bitcode /home/maxime/Documents/roc/compiler/builtins/bitcode/zig-cache /home/maxime/.cache/zig test
``
</code></pre></div>



<a name="290856048"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Zig%20error%20during%20build/near/290856048" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> mostlyvoid <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Zig.20error.20during.20build.html#290856048">(Jul 26 2022 at 07:05)</a>:</h4>
<p>I am having this same error on NixOS with nix flakes. Have you found any workaround?</p>
<p>Edit: Strange that it compiles in another NixOS machine.</p>



<a name="290866636"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Zig%20error%20during%20build/near/290866636" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anton <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Zig.20error.20during.20build.html#290866636">(Jul 26 2022 at 09:16)</a>:</h4>
<p>Hi <span class="user-mention" data-user-id="482782">@mostlyvoid</span>,<br>
I'm on NixOS as well. So we're on the same page; do you have the error <code>error: failed to run custom build command for roc_builtins v0.1.0</code> when running <code>cargo build</code>after <code>nix develop</code>?</p>



<a name="290866732"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Zig%20error%20during%20build/near/290866732" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> mostlyvoid <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Zig.20error.20during.20build.html#290866732">(Jul 26 2022 at 09:17)</a>:</h4>
<p>Yes, I think so. Here is the full log</p>
<div class="codehilite" data-code-language="Fish"><pre><span></span><code>roc on  trunk via 🦀 v1.61.0 via ❄  impure <span class="o">(</span>nix-shell<span class="o">)</span>
❯ cargo run repl
   Compiling roc_builtins v0.1.0 <span class="o">(</span>/home/halum/code/roc/crates/compiler/builtins<span class="o">)</span>
error: failed to run custom build <span class="nb">command </span><span class="k">for</span> <span class="err">`</span>roc_builtins v0.1.0 <span class="o">(</span>/home/halum/code/roc/crates/compiler/builtins<span class="o">)</span><span class="err">`</span>

Caused by:
  process didn<span class="s1">'t exit successfully: `/home/halum/code/roc/target/debug/build/roc_builtins-ac2eb2303333d02c/build-script-build` (exit status: 101)</span>
<span class="s1">  --- stdout</span>
<span class="s1">  cargo:rerun-if-changed=build.rs</span>
<span class="s1">  Compiling host ir to: /home/halum/code/roc/crates/compiler/builtins/bitcode/builtins-host.ll</span>
<span class="s1">  Compiling 64-bit bitcode to: /home/halum/code/roc/crates/compiler/builtins/bitcode/builtins-host.bc</span>

<span class="s1">  --- stderr</span>
<span class="s1">  thread '</span>main<span class="s1">' panicked at '</span>zig failed: thread <span class="m">50400</span> panic: index out of bounds
  /nix/store/lhfjjvdp51y6lfyg2ssbxbp1plg4p8za-zig-0.9.1/lib/std/zig/system/NativeTargetInfo.zig:662:78: 0x2b16f4 <span class="k">in</span> std.zig.system.NativeTargetInfo.abiAndDynamicLinkerFromFi
                  const <span class="nv">rpath_list</span> <span class="o">=</span> mem.sliceTo<span class="o">(</span>std.meta.assumeSentinel<span class="o">(</span>strtab<span class="o">[</span>rpoff_usize..<span class="o">]</span>.ptr, 0<span class="o">)</span>, 0<span class="o">)</span><span class="p">;</span>
                                                                               <span class="o">^</span>
  /nix/store/lhfjjvdp51y6lfyg2ssbxbp1plg4p8za-zig-0.9.1/lib/std/zig/system/NativeTargetInfo.zig:387:39: 0x2a02e6 <span class="k">in</span> std.zig.system.NativeTargetInfo.detectAbiAndDynamicLinker <span class="o">(</span>build<span class="o">)</span>
      <span class="k">return</span> abiAndDynamicLinkerFromFile<span class="o">(</span>env_file, cpu, os, ld_info_list, cross_target<span class="o">)</span> catch <span class="o">|</span>err<span class="o">|</span> <span class="k">switch</span> <span class="o">(</span>err<span class="o">)</span> <span class="err">{</span>
                                        <span class="o">^</span>
  /nix/store/lhfjjvdp51y6lfyg2ssbxbp1plg4p8za-zig-0.9.1/lib/std/zig/system/NativeTargetInfo.zig:201:47: 0x29ba72 <span class="k">in</span> std.zig.system.NativeTargetInfo.detect <span class="o">(</span>build<span class="o">)</span>
      var <span class="nv">result</span> <span class="o">=</span> try detectAbiAndDynamicLinker<span class="o">(</span>allocator, cpu, os, cross_target<span class="o">)</span><span class="p">;</span>
                                                <span class="o">^</span>
  /nix/store/lhfjjvdp51y6lfyg2ssbxbp1plg4p8za-zig-0.9.1/lib/std/build.zig:166:49: 0x29632e <span class="k">in</span> std.build.Builder.create <span class="o">(</span>build<span class="o">)</span>
          const <span class="nv">host</span> <span class="o">=</span> try NativeTargetInfo.detect<span class="o">(</span>allocator, .<span class="err">{}</span><span class="o">)</span><span class="p">;</span>
                                                  <span class="o">^</span>
  /nix/store/lhfjjvdp51y6lfyg2ssbxbp1plg4p8za-zig-0.9.1/lib/std/special/build_runner.zig:43:39: 0x28c28f <span class="k">in</span> main <span class="o">(</span>build<span class="o">)</span>
      const <span class="nv">builder</span> <span class="o">=</span> try Builder.create<span class="o">(</span>
                                        <span class="o">^</span>
  /nix/store/lhfjjvdp51y6lfyg2ssbxbp1plg4p8za-zig-0.9.1/lib/std/start.zig:561:37: 0x28562a <span class="k">in</span> std.start.callMain <span class="o">(</span>build<span class="o">)</span>
              const <span class="nv">result</span> <span class="o">=</span> root.main<span class="o">()</span> catch <span class="o">|</span>err<span class="o">|</span> <span class="err">{</span>
                                      <span class="o">^</span>
  /nix/store/lhfjjvdp51y6lfyg2ssbxbp1plg4p8za-zig-0.9.1/lib/std/start.zig:495:12: 0x26623e <span class="k">in</span> std.start.callMainWithArgs <span class="o">(</span>build<span class="o">)</span>
      <span class="k">return</span> @call<span class="o">(</span>.<span class="err">{</span> .modifier <span class="o">=</span> .always_inline <span class="err">}</span>, callMain, .<span class="err">{}</span><span class="o">)</span><span class="p">;</span>
             <span class="o">^</span>
  /nix/store/lhfjjvdp51y6lfyg2ssbxbp1plg4p8za-zig-0.9.1/lib/std/start.zig:409:17: 0x2652d6 <span class="k">in</span> std.start.posixCallMainAndExit <span class="o">(</span>build<span class="o">)</span>
      std.os.exit<span class="o">(</span>@call<span class="o">(</span>.<span class="err">{</span> .modifier <span class="o">=</span> .always_inline <span class="err">}</span>, callMainWithArgs, .<span class="err">{</span> argc, argv, envp <span class="err">}</span><span class="o">))</span><span class="p">;</span>
                  <span class="o">^</span>
  /nix/store/lhfjjvdp51y6lfyg2ssbxbp1plg4p8za-zig-0.9.1/lib/std/start.zig:322:5: 0x2650e2 <span class="k">in</span> std.start._start <span class="o">(</span>build<span class="o">)</span>
      @call<span class="o">(</span>.<span class="err">{</span> .modifier <span class="o">=</span> .never_inline <span class="err">}</span>, posixCallMainAndExit, .<span class="err">{}</span><span class="o">)</span><span class="p">;</span>
      <span class="o">^</span>
  error: the following build <span class="nb">command </span>crashed:
  /home/halum/code/roc/crates/compiler/builtins/bitcode/zig-cache/o/73d065ecbb0ad71677b5e532050e3bde/build /nix/store/lhfjjvdp51y6lfyg2ssbxbp1plg4p8za-zig-0.9.1/bin/zig /home/halum/code/roc/crates/compiler/builtins/bitcode /home/halum/code/roc/crates/compiler/builtins/bitcode/zig-cache /home/halum/.cache/zig ir -Drelease<span class="o">=</span><span class="k">true</span>
  <span class="err">'</span>, crates/compiler/builtins/build.rs:207:21
  note: run with <span class="err">`</span><span class="nv">RUST_BACKTRACE</span><span class="o">=</span>1<span class="err">`</span> environment variable to display a backtrace
</code></pre></div>



<a name="290869001"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Zig%20error%20during%20build/near/290869001" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anton <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Zig.20error.20during.20build.html#290869001">(Jul 26 2022 at 09:40)</a>:</h4>
<p>This is an issue with zig, <a href="https://github.com/ziglang/zig/issues/12112">documented here</a>. It's been recently fixed on zig master but that also uses LLVM 14, and it is not easy to upgrade our code to LLVM 14. The issue appears to be hardware specific, I can run the repl without errors on NixOS on the latest version of the trunk branch. If you really want to fix this, you can fork zig 0.9.1, <a href="https://github.com/ziglang/zig/pull/12155/files">apply the fix</a> and update our flake to use your fork.</p>



<a name="290869184"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Zig%20error%20during%20build/near/290869184" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> mostlyvoid <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Zig.20error.20during.20build.html#290869184">(Jul 26 2022 at 09:43)</a>:</h4>
<p><span class="user-mention" data-user-id="361169">@Anton</span> <span class="user-mention" data-user-id="495048">@Maxime Tremblay</span> I think I figured out the bug - <a href="https://github.com/ziglang/zig/issues/12112">https://github.com/ziglang/zig/issues/12112</a></p>
<p>As a temporary fix I changed this in the flake.nix</p>
<div class="codehilite" data-code-language="Diff"><pre><span></span><code><span class="gd">-        zig-toolchain = zig.packages.${system}."0.9.1";</span><span class="w"></span>
<span class="gi">+        zig-toolchain = zig.packages.${system}.master.latest;</span><span class="w"></span>
</code></pre></div>
<p>and also updated the flake.lock file via <code>nix flake update</code>. </p>
<p>Now the repl builds but there is a new error whenever I try to do anything in the repl.</p>
<div class="codehilite" data-code-language="Fish"><pre><span></span><code>  The rockin’ roc repl
────────────────────────

Enter an expression, <span class="k">or</span> :help, <span class="k">or</span> :exit/:q.

» 2
thread <span class="s1">'main'</span> panicked at <span class="s1">'Unable to import builtins bitcode. LLVM error: "Invalid record"'</span>, crates/compiler/gen_llvm/src/llvm/build.rs:493:31
note: run with <span class="err">`</span><span class="nv">RUST_BACKTRACE</span><span class="o">=</span>1<span class="err">`</span> environment variable to display a backtrace
</code></pre></div>
<div class="codehilite"><pre><span></span><code>
</code></pre></div>



<a name="290869461"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Zig%20error%20during%20build/near/290869461" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anton <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Zig.20error.20during.20build.html#290869461">(Jul 26 2022 at 09:45)</a>:</h4>
<p><span class="user-mention" data-user-id="482782">@mostlyvoid</span> you may have missed my previous message. These appear to be LLVM 14 errors that would require a significant upgrade to our code to fix.</p>



<a name="290869577"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Zig%20error%20during%20build/near/290869577" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> mostlyvoid <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Zig.20error.20during.20build.html#290869577">(Jul 26 2022 at 09:46)</a>:</h4>
<p><span class="user-mention" data-user-id="361169">@Anton</span> Sorry! I actually missed your message. Thanks!</p>



<a name="290869925"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Zig%20error%20during%20build/near/290869925" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> mostlyvoid <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Zig.20error.20during.20build.html#290869925">(Jul 26 2022 at 09:50)</a>:</h4>
<p>I am wondering, is there any easier way to use the fix this without forking and all? Can I somehow emulate the hardware/ build a VM where it works? Excuse me if it is a stupid question.</p>



<a name="290869927"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Zig%20error%20during%20build/near/290869927" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anton <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Zig.20error.20during.20build.html#290869927">(Jul 26 2022 at 09:50)</a>:</h4>
<p>For <span class="user-mention" data-user-id="495048">@Maxime Tremblay</span>; although both errors start with <code>failed to run custom build command for roc_builtins v0.1.0</code>the actual zig error is entirely different from this new error. So the fix mentioned in <a href="https://github.com/ziglang/zig/issues/12112">https://github.com/ziglang/zig/issues/12112</a> is not likely to fix Maxime's problem.</p>



<a name="290870150"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Zig%20error%20during%20build/near/290870150" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anton <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Zig.20error.20during.20build.html#290870150">(Jul 26 2022 at 09:53)</a>:</h4>
<p><span class="user-mention" data-user-id="482782">@mostlyvoid</span> the zig issue does not go into detail about the hardware but I estimate that trying an Ubuntu VM has a 65% chance of fixing your problem.</p>



<a name="385590681"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Zig%20error%20during%20build/near/385590681" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matheus Ashton <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Zig.20error.20during.20build.html#385590681">(Aug 17 2023 at 03:58)</a>:</h4>
<p>Hey Folks! Sorry for reviving this topic, but I'm new to Roc, trying to build it locally on my mac from source, in order to contribute with the project. I'm using a MacOs 13.5 on a M1 chip, I tried to install everything that was needed, like LLVM and zig, tried different versions of zig, 0.8.1, 0.9.1, and 0.10.1, each of them I get a different error trying to build roc_bitcode v0.0.1 crate. Is roc compatible with M1 chip? Would I be able to contribute?</p>



<a name="385603091"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Zig%20error%20during%20build/near/385603091" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Zig.20error.20during.20build.html#385603091">(Aug 17 2023 at 06:20)</a>:</h4>
<p>Certainly, I use MacOS 13 with an M2 chip. I normally use <code>nix develop</code> which seems to just make everything work dependency wise. I'm not sure about compiling an individual crate, but normally I just run <code>cargo build --release --locked</code> from the root directory to build from source.</p>



<a name="385603170"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Zig%20error%20during%20build/near/385603170" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Zig.20error.20during.20build.html#385603170">(Aug 17 2023 at 06:21)</a>:</h4>
<p>Do you have any errors you could share?</p>



<a name="385629612"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Zig%20error%20during%20build/near/385629612" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Zig.20error.20during.20build.html#385629612">(Aug 17 2023 at 08:58)</a>:</h4>
<p>you need matching llvm and zig versions (at least). We currently have zig 0.9.1 and llvm 13. But yeah I guess nix is the fastest way to fix these issues if you don't want to deal with them</p>



<a name="385706711"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Zig%20error%20during%20build/near/385706711" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matheus Ashton <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Zig.20error.20during.20build.html#385706711">(Aug 17 2023 at 16:02)</a>:</h4>
<p>I'm already using those versions, I'll try with nix</p>



<a name="385708780"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Zig%20error%20during%20build/near/385708780" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matheus Ashton <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Zig.20error.20during.20build.html#385708780">(Aug 17 2023 at 16:11)</a>:</h4>
<p>It's because I already use homebrew, so I didn't want to install nix too, only for roc, but no problem</p>



<a name="385712379"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Zig%20error%20during%20build/near/385712379" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matheus Ashton <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Zig.20error.20during.20build.html#385712379">(Aug 17 2023 at 16:31)</a>:</h4>
<p>OK, I've got it running with nix</p>



<a name="485001673"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Zig%20error%20during%20build/near/485001673" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Zig.20error.20during.20build.html#485001673">(Nov 29 2024 at 00:33)</a>:</h4>
<p>I'm not sure if it's related to the error in this thread, but I'm seeing <code>zig build ir -Drelease=true</code> on builtin bitcode failing with <code>error: FileNotFound</code></p>
<p>(specifically in crates/compiler/builtins/bitcode/bc/build.rs:117:25)</p>
<p>this is on current <code>main</code> on macOS, with zig and llvm being installed with homebrew, <code>zig version</code> printing <code>0.11.0</code>, and <code>llc --version</code> printing <code>Homebrew LLVM version 16.0.6</code></p>



<a name="485002179"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Zig%20error%20during%20build/near/485002179" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Zig.20error.20during.20build.html#485002179">(Nov 29 2024 at 00:41)</a>:</h4>
<p>I'll do a clean rebuild in nix on my mac</p>



<a name="485002245"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Zig%20error%20during%20build/near/485002245" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Zig.20error.20during.20build.html#485002245">(Nov 29 2024 at 00:42)</a>:</h4>
<p>It looks similar to this CI failure <a href="https://github.com/roc-lang/roc/actions/runs/12076406799/job/33677747603?pr=6921">https://github.com/roc-lang/roc/actions/runs/12076406799/job/33677747603?pr=6921</a></p>



<a name="485002270"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Zig%20error%20during%20build/near/485002270" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Zig.20error.20during.20build.html#485002270">(Nov 29 2024 at 00:43)</a>:</h4>
<p>It builds fine for me in Nix</p>



<a name="485002286"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Zig%20error%20during%20build/near/485002286" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Zig.20error.20during.20build.html#485002286">(Nov 29 2024 at 00:43)</a>:</h4>
<p>hm, that one looks like <code>error: CacheUnavailable</code> <a href="https://github.com/roc-lang/roc/actions/runs/12076406799/job/33677747603?pr=6921#step:8:4607">https://github.com/roc-lang/roc/actions/runs/12076406799/job/33677747603?pr=6921#step:8:4607</a></p>



<a name="485002362"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Zig%20error%20during%20build/near/485002362" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Zig.20error.20during.20build.html#485002362">(Nov 29 2024 at 00:44)</a>:</h4>
<p>And I can also run <code>$ cargo build -p roc_bitcode</code> fine outside of nix</p>



<a name="485002563"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Zig%20error%20during%20build/near/485002563" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Zig.20error.20during.20build.html#485002563">(Nov 29 2024 at 00:47)</a>:</h4>
<p>ok, while trying to git bisect, I found an older commit where it works, and now it works again even when I switch back to the branch...even after deleting <code>zig-out</code> and <code>zig-cache</code> <span aria-label="shrug" class="emoji emoji-1f937" role="img" title="shrug">:shrug:</span></p>



<a name="485002574"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Zig%20error%20during%20build/near/485002574" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Zig.20error.20during.20build.html#485002574">(Nov 29 2024 at 00:47)</a>:</h4>
<p>so, all fixed...somehow!</p>



<a name="485003639"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Zig%20error%20during%20build/near/485003639" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Zig.20error.20during.20build.html#485003639">(Nov 29 2024 at 01:01)</a>:</h4>
<p>is it still <code>zig-cache</code>? I guess it is a newer version of zig that switches to <code>.zig-cache</code>?</p>



<a name="485003741"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Zig%20error%20during%20build/near/485003741" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Zig.20error.20during.20build.html#485003741">(Nov 29 2024 at 01:02)</a>:</h4>
<p>I bet your <code>zig-cache</code> is old (and unrelated to any issues) and switching to an older commit forced <code>.zig-cache</code> to rebuild. That then fixed your issue.</p>



<a name="485003802"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Zig%20error%20during%20build/near/485003802" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Zig.20error.20during.20build.html#485003802">(Nov 29 2024 at 01:03)</a>:</h4>
<p>hmm, scratch that. 0.11.0 still use <code>zig-cache</code> and not the hidden folder yet. So idk...</p>



<hr><p>Last updated: Nov 01 2025 at 12:13 UTC</p>
</html>