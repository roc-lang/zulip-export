<html>
<head><meta charset="utf-8"><title>big executables ¬∑ beginners ¬∑ Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/index.html">beginners</a></h2>
<h3>Topic: <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/big.20executables.html">big executables</a></h3>

<hr>

<base href="https://roc.zulipchat.com">

<head><link href="https://roc-lang.github.io/zulip-export/style.css" rel="stylesheet"></head>

<a name="392871462"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/big%20executables/near/392871462" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Artur Swiderski <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/big.20executables.html#392871462">(Sep 24 2023 at 22:09)</a>:</h4>
<p>Hi I noticed  executable  produced on linux platform  are huge  like  100 MB  which  is crazy</p>



<a name="392873158"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/big%20executables/near/392873158" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/big.20executables.html#392873158">(Sep 24 2023 at 22:43)</a>:</h4>
<p>which platform are you using? That will generally determine the size of the executable</p>



<a name="392873762"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/big%20executables/near/392873762" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Artur Swiderski <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/big.20executables.html#392873762">(Sep 24 2023 at 22:55)</a>:</h4>
<p>ubuntu 20.04</p>



<a name="392873850"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/big%20executables/near/392873850" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Artur Swiderski <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/big.20executables.html#392873850">(Sep 24 2023 at 22:57)</a>:</h4>
<p>both  C and  rust , roc  render  the  same  size</p>



<a name="392874291"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/big%20executables/near/392874291" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/big.20executables.html#392874291">(Sep 24 2023 at 23:04)</a>:</h4>
<p>I mean what roc platform are you using</p>



<a name="392874295"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/big%20executables/near/392874295" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/big.20executables.html#392874295">(Sep 24 2023 at 23:04)</a>:</h4>
<p><code>basic-cli</code>?</p>



<a name="392874316"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/big%20executables/near/392874316" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/big.20executables.html#392874316">(Sep 24 2023 at 23:05)</a>:</h4>
<p>also, are you running <code>roc</code> with the <code>--optimize</code> flag?</p>



<a name="392913861"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/big%20executables/near/392913861" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Artur Swiderski <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/big.20executables.html#392913861">(Sep 25 2023 at 05:36)</a>:</h4>
<p>I am  compiling this  with  recent  build (flag  does not  have impact whatsoever   roc build  --optimize  file.roc )</p>
<div class="codehilite"><pre><span></span><code>app &quot;peek&quot;

packages { pf: &quot;https://github.com/roc-lang/basic-cli/releases/download/0.5.0/Cufzl36_SnJ4QbOoEmiJ5dIpUxBvdB3NEySvuH82Wio.tar.br&quot;
}

imports [

pf.Stdin,

pf.Stdout,

pf.Stderr,

pf.File,

pf.Path,

pf.Task.{ Task
}]

provides [main]
to pf





tokenize = \ str
-&gt;

Str.split str &quot; &quot;

|&gt; List.dropIf Str.isEmpty





filterInternal = \ str, matches,
 inFlag -&gt;

if List.isEmpty matches
== Bool.true
then

str

else

Str.split str &quot;\n&quot;

|&gt; List.walk
&quot;&quot;
( \ state
, elem
-&gt;

checkResult = List.walk matches Bool.false
( \flag, pat
-&gt;

if flag
== Bool.true
then

Bool.true

else

when
(Str.splitFirst elem pat
)
is

Ok _
-&gt; Bool.true

Err _
-&gt; Bool.false)

if
(checkResult
== inFlag)
&amp;&amp;
(Str.isEmpty
(Str.trim elem
)
== Bool.false)
then

Str.concat state elem

|&gt; Str.concat
&quot;\n&quot;

else

state

)



filterOut = \ str, matches
-&gt;


workedOut = List.walk matches
{ whiteList
:
[], blackList
: []
}

( \ state
, word
-&gt;

if Str.startsWith word
&quot;@&quot;
== Bool.true
then

{ state &amp; blackList: List.append state.blackList
(Str.replaceFirst word
&quot;@&quot;
&quot;&quot; )
}

else

{ state &amp; whiteList: List.append state.whiteList word
}

)

filterInternal str workedOut.whiteList Bool.true

|&gt; filterInternal workedOut.blackList Bool.false





main =

read =

path = Path.fromStr
&quot;log.txt&quot;

out = Path.fromStr
&quot;out.txt&quot;

hien &lt;- File.readUtf8 path
|&gt; Task.await


loopTask =

_
&lt;- Stdout.line
&quot;provide your filters: &quot;
|&gt; Task.await

text &lt;- Task.await Stdin.line

result =
(filterOut hien
(tokenize text)
)

_
&lt;- File.writeUtf8 out result
|&gt; Task.await

_
&lt;- Stdout.line result
|&gt; Task.await

_
&lt;- Stdout.line
&quot;\n\nLast you used:
\(text)&quot;
|&gt; Task.await

Stdout.line &quot;\nload data to out.txt&quot;



Task.loop {} \_
-&gt; Task.map loopTask Step




Task.attempt read \result -&gt;

when result
is

Ok {}
-&gt; Stdout.line
&quot;Successfully wrote a string to out.txt&quot;

Err err -&gt;

msg =

when err
is

FileWriteErr _ PermissionDenied
-&gt;
&quot;PermissionDenied&quot;

FileWriteErr _ Unsupported
-&gt;
&quot;Unsupported&quot;

FileWriteErr _
(Unrecognized
_ other)
-&gt; other

FileReadErr _
_
-&gt; &quot;Error reading file&quot;

_
-&gt;
&quot;Uh oh, there was an error!&quot;



{}
&lt;- Stderr.line msg
|&gt; Task.await

Task.ok {}
</code></pre></div>



<a name="392914132"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/big%20executables/near/392914132" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Artur Swiderski <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/big.20executables.html#392914132">(Sep 25 2023 at 05:38)</a>:</h4>
<p>I am getting  like  109 mega bytes  executable  which is outrageous</p>



<a name="392916627"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/big%20executables/near/392916627" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/big.20executables.html#392916627">(Sep 25 2023 at 05:54)</a>:</h4>
<p>Yeah, basic-cli is very bloated as a base. IIRC, we need to update some dead code elimination stuff on the rust side. This isn't exactly a roc issue. A much slimmer platform can be built, but especially with surgical linking, I think we have some changes that need to be done to get rust to slim down the platform binary.</p>



<a name="392916699"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/big%20executables/near/392916699" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/big.20executables.html#392916699">(Sep 25 2023 at 05:55)</a>:</h4>
<p>Almost none of that bloat is from actually roc code.</p>



<a name="392916838"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/big%20executables/near/392916838" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/big.20executables.html#392916838">(Sep 25 2023 at 05:56)</a>:</h4>
<p>Maybe in a bit, I double back to the dead code stuff and basic cli. See if I can get rust to stop including so much extra code and bloating the binary.</p>



<a name="392917756"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/big%20executables/near/392917756" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Artur Swiderski <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/big.20executables.html#392917756">(Sep 25 2023 at 06:00)</a>:</h4>
<p>it happens  also  when I am using C based  platform</p>



<a name="392917969"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/big%20executables/near/392917969" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/big.20executables.html#392917969">(Sep 25 2023 at 06:01)</a>:</h4>
<p>That doesn't make sense. Maybe there is some other bug. Any info on the C platform?</p>



<a name="392918160"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/big%20executables/near/392918160" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Artur Swiderski <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/big.20executables.html#392918160">(Sep 25 2023 at 06:02)</a>:</h4>
<p>and it is not so insignificant yes hard drives are huge nowadays but 100 MB is crazy and unacceptable in  long run  for potential user, it just hurts eyes</p>



<a name="392918396"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/big%20executables/near/392918396" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Artur Swiderski <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/big.20executables.html#392918396">(Sep 25 2023 at 06:04)</a>:</h4>
<p>when I do  ./roc examples/platform-switching/rocLovesC.roc   and  than  compile  resulting  binary  is more or less the  same</p>



<a name="392918567"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/big%20executables/near/392918567" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Artur Swiderski <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/big.20executables.html#392918567">(Sep 25 2023 at 06:05)</a>:</h4>
<p>I am using  ubuntu  20.04  with normal C libraries  from  repository  just  generic  linux</p>



<a name="392920857"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/big%20executables/near/392920857" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/big.20executables.html#392920857">(Sep 25 2023 at 06:17)</a>:</h4>
<p>I'll take a look. See if I can repro</p>



<a name="392922803"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/big%20executables/near/392922803" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Artur Swiderski <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/big.20executables.html#392922803">(Sep 25 2023 at 06:27)</a>:</h4>
<p><a href="/user_uploads/22008/Hf8b4cHF2PjDWLzmeeneilm2/size.png">size.png</a></p>
<div class="message_inline_image"><a href="/user_uploads/22008/Hf8b4cHF2PjDWLzmeeneilm2/size.png" title="size.png"><img src="/user_uploads/22008/Hf8b4cHF2PjDWLzmeeneilm2/size.png"></a></div>



<a name="392923257"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/big%20executables/near/392923257" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/big.20executables.html#392923257">(Sep 25 2023 at 06:30)</a>:</h4>
<p>Hmmm. Yeah... not able to repro for the C platform. <code>du -hs rocLovesC</code> is reporting <code>32K</code></p>
<p>That said, I am seeing this for anything built on <code>basic-cli</code>. Hello world is 105MB because of basic cli.</p>



<a name="392923315"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/big%20executables/near/392923315" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/big.20executables.html#392923315">(Sep 25 2023 at 06:30)</a>:</h4>
<p>I assume peek is based on basic cli?</p>



<a name="392923371"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/big%20executables/near/392923371" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Artur Swiderski <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/big.20executables.html#392923371">(Sep 25 2023 at 06:31)</a>:</h4>
<p>you can  se source code  above</p>



<a name="392923372"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/big%20executables/near/392923372" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/big.20executables.html#392923372">(Sep 25 2023 at 06:31)</a>:</h4>
<p>Also, your screenshot does not show the size of rocLoveC (that or I am missing it)</p>



<a name="392923480"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/big%20executables/near/392923480" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Artur Swiderski <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/big.20executables.html#392923480">(Sep 25 2023 at 06:32)</a>:</h4>
<div class="codehilite"><pre><span></span><code>app &quot;peek&quot;

packages { pf: &quot;https://github.com/roc-lang/basic-cli/releases/download/0.5.0/Cufzl36_SnJ4QbOoEmiJ5dIpUxBvdB3NEySvuH82Wio.tar.br&quot;
}

imports [

pf.Stdin,

pf.Stdout,

pf.Stderr,

pf.File,

pf.Path,

pf.Task.{ Task
}]

provides [main]
to pf





tokenize = \ str
-&gt;

Str.split str &quot; &quot;

|&gt; List.dropIf Str.isEmpty





filterInternal = \ str, matches,
 inFlag -&gt;

if List.isEmpty matches
== Bool.true
then

str

else

Str.split str &quot;\n&quot;

|&gt; List.walk
&quot;&quot;
( \ state
, elem
-&gt;

checkResult = List.walk matches Bool.false
( \flag, pat
-&gt;

if flag
== Bool.true
then

Bool.true

else

when
(Str.splitFirst elem pat
)
is

Ok _
-&gt; Bool.true

Err _
-&gt; Bool.false)

if
(checkResult
== inFlag)
&amp;&amp;
(Str.isEmpty
(Str.trim elem
)
== Bool.false)
then

Str.concat state elem

|&gt; Str.concat
&quot;\n&quot;

else

state

)



filterOut = \ str, matches
-&gt;


workedOut = List.walk matches
{ whiteList
:
[], blackList
: []
}

( \ state
, word
-&gt;

if Str.startsWith word
&quot;@&quot;
== Bool.true
then

{ state &amp; blackList: List.append state.blackList
(Str.replaceFirst word
&quot;@&quot;
&quot;&quot; )
}

else

{ state &amp; whiteList: List.append state.whiteList word
}

)

filterInternal str workedOut.whiteList Bool.true

|&gt; filterInternal workedOut.blackList Bool.false





main =

read =

path = Path.fromStr
&quot;log.txt&quot;

out = Path.fromStr
&quot;out.txt&quot;

hien &lt;- File.readUtf8 path
|&gt; Task.await


loopTask =

_
&lt;- Stdout.line
&quot;provide your filters: &quot;
|&gt; Task.await

text &lt;- Task.await Stdin.line

result =
(filterOut hien
(tokenize text)
)

_
&lt;- File.writeUtf8 out result
|&gt; Task.await

_
&lt;- Stdout.line result
|&gt; Task.await

_
&lt;- Stdout.line
&quot;\n\nLast you used:
\(text)&quot;
|&gt; Task.await

Stdout.line &quot;\nload data to out.txt&quot;



Task.loop {} \_
-&gt; Task.map loopTask Step




Task.attempt read \result -&gt;

when result
is

Ok {}
-&gt; Stdout.line
&quot;Successfully wrote a string to out.txt&quot;

Err err -&gt;

msg =

when err
is

FileWriteErr _ PermissionDenied
-&gt;
&quot;PermissionDenied&quot;

FileWriteErr _ Unsupported
-&gt;
&quot;Unsupported&quot;

FileWriteErr _
(Unrecognized
_ other)
-&gt; other

FileReadErr _
_
-&gt; &quot;Error reading file&quot;

_
-&gt;
&quot;Uh oh, there was an error!&quot;



{}
&lt;- Stderr.line msg
|&gt; Task.await
</code></pre></div>



<a name="392923649"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/big%20executables/near/392923649" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/big.20executables.html#392923649">(Sep 25 2023 at 06:33)</a>:</h4>
<p>Yeah, peek is built on basic CLI which is why it is giant. I'll take a look at that. See if I can fix the platform to properly do dead code elimination and remove bloat.</p>



<a name="392924079"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/big%20executables/near/392924079" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Artur Swiderski <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/big.20executables.html#392924079">(Sep 25 2023 at 06:35)</a>:</h4>
<p>I  checked  size  of rocLoveC  is 32k bytes but is sits in different location</p>



<a name="392924257"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/big%20executables/near/392924257" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/big.20executables.html#392924257">(Sep 25 2023 at 06:36)</a>:</h4>
<p>Ok. Good. So a base c platform has a fine size</p>



<a name="392924343"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/big%20executables/near/392924343" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/big.20executables.html#392924343">(Sep 25 2023 at 06:37)</a>:</h4>
<p>Yeah, so definitely a basic CLI issue leading to the giant binary size.</p>



<a name="392924367"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/big%20executables/near/392924367" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/big.20executables.html#392924367">(Sep 25 2023 at 06:37)</a>:</h4>
<p>Thanks for the report</p>



<a name="392964209"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/big%20executables/near/392964209" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Artur Swiderski <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/big.20executables.html#392964209">(Sep 25 2023 at 09:58)</a>:</h4>
<p>just  a thought, I know  that  from perspective of language creators, things like this do not matter much , but for me as an user they are  vital. I wanted to share this  simple app with my collage,   to make   process of  analyzing logs  a bit more pleasant (I could  do the same with grep but still I like this approach more) and right away he pointed out horrendous size of the file with suspicion. He would be no potential user  or Roc under any circumstances anyway (because he has different interests) but still .. It is not good  advertisement</p>



<a name="392974024"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/big%20executables/near/392974024" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anton <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/big.20executables.html#392974024">(Sep 25 2023 at 10:46)</a>:</h4>
<p>We care deeply about the Roc user experience, including the produced file size. It's important to realize that as an open source project we have very little financial resources which unfortunately results in a user experience that currently falls short of our goals. We easily have enough work to employ 30 engineers full-time but we try to make it work with what we have.</p>



<a name="392989572"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/big%20executables/near/392989572" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Artur Swiderski <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/big.20executables.html#392989572">(Sep 25 2023 at 11:56)</a>:</h4>
<p>ok I got  that</p>



<a name="393062022"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/big%20executables/near/393062022" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anton <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/big.20executables.html#393062022">(Sep 25 2023 at 16:40)</a>:</h4>
<p>I almost forgot; the <code>--opt-size</code> flag can reduce the size of the produced executable a lot:</p>
<div class="codehilite"><pre><span></span><code>roc build your-program.roc --opt-size
</code></pre></div>
<p>Still larger than what we want it to be, but a nice improvement nonetheless.</p>



<a name="393063025"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/big%20executables/near/393063025" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/big.20executables.html#393063025">(Sep 25 2023 at 16:46)</a>:</h4>
<p>That won't affect the platform, which is the problem here.</p>



<a name="393063257"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/big%20executables/near/393063257" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anton <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/big.20executables.html#393063257">(Sep 25 2023 at 16:48)</a>:</h4>
<p>It worked for me</p>
<div class="codehilite"><pre><span></span><code>basic-cli on ÓÇ† main [!?] via ‚ùÑ  impure (nix-shell-env)
‚ùØ ls -lh examples/command
-rwxr-xr-x 1 username users 104M sep 25 18:37 examples/command

basic-cli on ÓÇ† main [!?] via ‚ùÑ  impure (nix-shell-env)
‚ùØ ./roc_nightly/roc build examples/command.roc --opt-size
üî® Rebuilding platform...
0 errors and 0 warnings found in 9239 ms while successfully building:

    examples/command

basic-cli on ÓÇ† main [!?] via ‚ùÑ  impure (nix-shell-env) took 9s
‚ùØ ls -lh examples/command
-rwxr-xr-x 1 username users 21M sep 25 18:38 examples/command
</code></pre></div>



<a name="393064172"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/big%20executables/near/393064172" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/big.20executables.html#393064172">(Sep 25 2023 at 16:52)</a>:</h4>
<p>Oh, you are rebuilding the platform and running the version of command.roc in the basic-cli repo? This would have no affect on the downloaded basic-cli platform.</p>



<a name="393067154"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/big%20executables/near/393067154" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anton <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/big.20executables.html#393067154">(Sep 25 2023 at 17:07)</a>:</h4>
<p>Oh riiight, makes sense <span aria-label="+1" class="emoji emoji-1f44d" role="img" title="+1">:+1:</span></p>



<a name="393073708"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/big%20executables/near/393073708" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/big.20executables.html#393073708">(Sep 25 2023 at 17:41)</a>:</h4>
<p>I think I have a solution that should drop it to about 15MB. (that said, I am not sure if it will run into some linker issues depending on platform)</p>



<a name="393080581"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/big%20executables/near/393080581" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anton <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/big.20executables.html#393080581">(Sep 25 2023 at 18:17)</a>:</h4>
<p>Are the required changes isolated or spread out? I'm asking that to determine if it would be easy to revert if we run into trouble say 3 months from now.</p>



<a name="393083171"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/big%20executables/near/393083171" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/big.20executables.html#393083171">(Sep 25 2023 at 18:33)</a>:</h4>
<p>Very isolated: <a href="https://github.com/roc-lang/roc/pull/5855">https://github.com/roc-lang/roc/pull/5855</a></p>



<a name="393083225"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/big%20executables/near/393083225" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/big.20executables.html#393083225">(Sep 25 2023 at 18:33)</a>:</h4>
<p>Then just need to rebuild basic-cli and other rust platforms and publish a new version.</p>



<a name="393083599"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/big%20executables/near/393083599" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anton <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/big.20executables.html#393083599">(Sep 25 2023 at 18:36)</a>:</h4>
<p>Nice, then it's good for me! I will wait to merge to give others time to object</p>



<a name="393192849"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/big%20executables/near/393192849" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anton <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/big.20executables.html#393192849">(Sep 26 2023 at 09:08)</a>:</h4>
<p>merged <span aria-label="tada" class="emoji emoji-1f389" role="img" title="tada">:tada:</span></p>



<a name="394107352"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/big%20executables/near/394107352" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Artur Swiderski <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/big.20executables.html#394107352">(Sep 30 2023 at 19:13)</a>:</h4>
<p>I took recent build but after  compilation  I am still getting  109 MB  executable, basically the same  code as mentioned earlier</p>



<a name="394111152"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/big%20executables/near/394111152" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/big.20executables.html#394111152">(Sep 30 2023 at 20:28)</a>:</h4>
<p>The basic cli platform hash not been updated yet. So it still has a cached 100MB exe that is being built off of.</p>



<a name="394111163"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/big%20executables/near/394111163" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/big.20executables.html#394111163">(Sep 30 2023 at 20:28)</a>:</h4>
<p>Sorry for the delay. basic-cli just releases separately from the compiler.</p>



<a name="395061522"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/big%20executables/near/395061522" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/big.20executables.html#395061522">(Oct 05 2023 at 14:55)</a>:</h4>
<p>Looping back to this <span class="user-mention" data-user-id="361169">@Anton</span>, can you cut a new release of basic CLI?</p>



<a name="395211419"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/big%20executables/near/395211419" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anton <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/big.20executables.html#395211419">(Oct 06 2023 at 08:55)</a>:</h4>
<p>Yes, I'll try to get it done today</p>



<a name="395306841"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/big%20executables/near/395306841" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anton <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/big.20executables.html#395306841">(Oct 06 2023 at 18:02)</a>:</h4>
<p>I'm hitting this issue only with the musl target:</p>
<div class="codehilite"><pre><span></span><code>‚ùØ export CARGO_BUILD_TARGET=x86_64-unknown-linux-musl

username in üåê ubu-22-04 in Downloads/temp2/roc_nightly
‚ùØ ./roc build ../basic-cli/examples/countdown.roc
üî® Rebuilding platform...
An internal compiler expectation was broken.
This is definitely a compiler bug.
Please file an issue here: https://github.com/roc-lang/roc/issues/new/choose
thread &#39;main&#39; panicked at &#39;Undefined Symbol in relocation, (+a29, Relocation { kind: PltRelative, encoding: Generic, size: +20, target: Symbol(SymbolIndex(+70)), addend: +fffffffffffffffc, implicit_addend: false }): Ok(Symbol { name: &quot;roc_alloc&quot;, address: +0, size: +0, kind: Label, section: Undefined, scope: Unknown, weak: false, flags: Elf { st_info: +10, st_other: +0 } })&#39;, crates/linker/src/elf.rs:1486:25
note: run with `RUST_BACKTRACE=1` environment variable to display a backtrace
</code></pre></div>
<p>I do test basic-cli with the latest nightly once a day, but not with a musl target, so I did not catch it before.<br>
I'll bisect it tomorrow.</p>



<a name="395322585"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/big%20executables/near/395322585" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/big.20executables.html#395322585">(Oct 06 2023 at 20:12)</a>:</h4>
<p>That could be cause by this, but would be surprising if musl refuses to expose symbols, but others dont</p>



<a name="395322641"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/big%20executables/near/395322641" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/big.20executables.html#395322641">(Oct 06 2023 at 20:12)</a>:</h4>
<p>Oh.....wait....musl is fully static? If so, I wonder if rust is ignoring that it should be exposing dynamic symbols......hmm</p>



<a name="395403781"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/big%20executables/near/395403781" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anton <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/big.20executables.html#395403781">(Oct 07 2023 at 10:52)</a>:</h4>
<p>Changing <code>-C link-args=-rdynamic</code> back to <code>-C link-dead-code</code> indeed fixes the issue</p>



<a name="395425028"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/big%20executables/near/395425028" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/big.20executables.html#395425028">(Oct 07 2023 at 14:27)</a>:</h4>
<p>I'll do some testing</p>



<a name="395728282"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/big%20executables/near/395728282" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/big.20executables.html#395728282">(Oct 09 2023 at 15:57)</a>:</h4>
<p><span class="user-mention" data-user-id="361169">@Anton</span>, any tips or setup for building with musl? I am getting weird issues like: <code>cannot find function, tuple struct or tuple variant </code>Some<code> in this scope</code> when building dependencies.</p>



<a name="395739072"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/big%20executables/near/395739072" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anton <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/big.20executables.html#395739072">(Oct 09 2023 at 17:13)</a>:</h4>
<p>Hmm, perhaps you need to install <code>musl-tools</code>?<br>
You can find the exact build steps I use on ubuntu-20.04 github CI <a href="https://github.com/roc-lang/roc/blob/48d1429b75d9662dbfd5c50fe5126cec98ccd6ac/.github/workflows/basic_cli_build_release.yml#L39">here</a> and <a href="https://github.com/roc-lang/roc/blob/48d1429b75d9662dbfd5c50fe5126cec98ccd6ac/ci/build_basic_cli.sh">here</a>.</p>



<a name="397869961"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/big%20executables/near/397869961" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/big.20executables.html#397869961">(Oct 21 2023 at 18:36)</a>:</h4>
<p>I know this is super delayed, but I think this pr should enable you to cut a release of basic cli: <a href="https://github.com/roc-lang/basic-cli/pull/113">https://github.com/roc-lang/basic-cli/pull/113</a></p>



<a name="397994941"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/big%20executables/near/397994941" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/big.20executables.html#397994941">(Oct 23 2023 at 02:26)</a>:</h4>
<p>An extra bonus once the new basic cli is released. Mac linking for basic cli based apps gets about 8x faster</p>



<hr><p>Last updated: Mar 01 2026 at 12:20 UTC</p>
</html>