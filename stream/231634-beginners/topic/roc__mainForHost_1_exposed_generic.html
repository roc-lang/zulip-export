<html>
<head><meta charset="utf-8"><title>roc__mainForHost_1_exposed_generic Â· beginners Â· Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/index.html">beginners</a></h2>
<h3>Topic: <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/roc__mainForHost_1_exposed_generic.html">roc__mainForHost_1_exposed_generic</a></h3>

<hr>

<base href="https://roc.zulipchat.com">

<head><link href="https://roc-lang.github.io/zulip-export/style.css" rel="stylesheet"></head>

<a name="401248015"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/roc__mainForHost_1_exposed_generic/near/401248015" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/roc__mainForHost_1_exposed_generic.html#401248015">(Nov 09 2023 at 22:34)</a>:</h4>
<p>How do you know what the exposed function signature will be for e.g. <code>mainForHost : Str -&gt; Str</code>? I have been having a hard time trying to make a very basic platform using zig than the platform switching example which is just <code>mainForHost : Str</code>. Is there a way to generate the LLVM for example which might provide a clue as to the expected signature?</p>



<a name="401248152"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/roc__mainForHost_1_exposed_generic/near/401248152" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/roc__mainForHost_1_exposed_generic.html#401248152">(Nov 09 2023 at 22:35)</a>:</h4>
<p>For reference I have been trying to get <a href="https://github.com/lukewilliamboswell/roc-serverless">https://github.com/lukewilliamboswell/roc-serverless</a> working.. but even without the wasm part I'm not confident I have the signature correct</p>



<a name="401248518"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/roc__mainForHost_1_exposed_generic/near/401248518" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/roc__mainForHost_1_exposed_generic.html#401248518">(Nov 09 2023 at 22:39)</a>:</h4>
<p>Would it be possible fore something like <code>roc glue</code> to generate this signature in future?</p>



<a name="401250026"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/roc__mainForHost_1_exposed_generic/near/401250026" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/roc__mainForHost_1_exposed_generic.html#401250026">(Nov 09 2023 at 22:55)</a>:</h4>
<p><code>--debug</code></p>



<a name="401250035"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/roc__mainForHost_1_exposed_generic/near/401250035" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/roc__mainForHost_1_exposed_generic.html#401250035">(Nov 09 2023 at 22:55)</a>:</h4>
<p>That will get you the llvm ir</p>



<a name="401250039"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/roc__mainForHost_1_exposed_generic/near/401250039" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/roc__mainForHost_1_exposed_generic.html#401250039">(Nov 09 2023 at 22:55)</a>:</h4>
<p>I think I answered part of my question above. Build it using a debug version of the compiler and I get a <code>.bc</code> file</p>



<a name="401250105"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/roc__mainForHost_1_exposed_generic/near/401250105" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/roc__mainForHost_1_exposed_generic.html#401250105">(Nov 09 2023 at 22:56)</a>:</h4>
<p>And yeah, all of this can be generated by roc glue.</p>



<a name="401250144"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/roc__mainForHost_1_exposed_generic/near/401250144" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/roc__mainForHost_1_exposed_generic.html#401250144">(Nov 09 2023 at 22:56)</a>:</h4>
<p>The roc webserver that Richard is working on in rust had these functions generated (though currently with a bug)</p>



<a name="401250200"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/roc__mainForHost_1_exposed_generic/near/401250200" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/roc__mainForHost_1_exposed_generic.html#401250200">(Nov 09 2023 at 22:57)</a>:</h4>
<p>Also, debug should get you a <code>.ll</code> file</p>



<a name="401250409"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/roc__mainForHost_1_exposed_generic/near/401250409" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/roc__mainForHost_1_exposed_generic.html#401250409">(Nov 09 2023 at 22:59)</a>:</h4>
<p><code>'I could not find the debugir tool on the PATH</code> do you have to build that from source? Is there a distribution for macos?</p>



<a name="401250447"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/roc__mainForHost_1_exposed_generic/near/401250447" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/roc__mainForHost_1_exposed_generic.html#401250447">(Nov 09 2023 at 22:59)</a>:</h4>
<p>You actually don't need it. The <code>.ll</code> file should exist now.</p>



<a name="401251109"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/roc__mainForHost_1_exposed_generic/near/401251109" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/roc__mainForHost_1_exposed_generic.html#401251109">(Nov 09 2023 at 23:03)</a>:</h4>
<p>This will help me investigate further</p>



<a name="401253553"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/roc__mainForHost_1_exposed_generic/near/401253553" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/roc__mainForHost_1_exposed_generic.html#401253553">(Nov 09 2023 at 23:30)</a>:</h4>
<p>The glue from Richard's webserver generates identically to what I expect, two pointers return and argument of RocStr.</p>
<p>The llvm though gives, which looks like it takes a single pointer.</p>
<div class="codehilite"><pre><span></span><code>define void @roc__mainForHost_1_exposed_generic(ptr %0) {
entry:
  %call = call fastcc {} @_mainForHost_f03bf86f79d121cbfd774dec4a65912e99f5f17c33852bbc45e81916e62b53b()
  store {} %call, ptr %0, align 1
  ret void
}
</code></pre></div>
<p>The issue I have is that zig is generating different wasm type signature from roc I think. How is this possible?</p>
<div class="codehilite"><pre><span></span><code>$ roc build --target=wasm32 examples/echo.roc
ðŸ”¨ Rebuilding platform...
LLD Link... warning(link): unexpected LLD stderr:
wasm-ld: warning: function signature mismatch: roc__mainForHost_1_exposed_generic
&gt;&gt;&gt; defined as (i32, i32) -&gt; void in lto.tmp
&gt;&gt;&gt; defined as (i32) -&gt; void in /Users/luke/.cache/zig/o/21804a4778e09cb059cc1335d2b95b55/roc_appxhNgOx.o

0 errors and 0 warnings found in 420 ms while successfully building:

    examples/echo.wasm
</code></pre></div>
<p>I suspect there is some kind of optimization going on maybe?</p>



<a name="401254132"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/roc__mainForHost_1_exposed_generic/near/401254132" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/roc__mainForHost_1_exposed_generic.html#401254132">(Nov 09 2023 at 23:37)</a>:</h4>
<p>I figured it out!! <span aria-label="tada" class="emoji emoji-1f389" role="img" title="tada">:tada:</span> I had to change the platform from <code>mainForHost = main</code> to <code>mainForHost = \str -&gt; main str</code> and then it works. I have no idea why.</p>



<a name="401255185"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/roc__mainForHost_1_exposed_generic/near/401255185" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ayaz Hafiz <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/roc__mainForHost_1_exposed_generic.html#401255185">(Nov 09 2023 at 23:51)</a>:</h4>
<p>sorry, just saw this. it's because of lambda sets <span aria-label="upside down" class="emoji emoji-1f643" role="img" title="upside down">:upside_down:</span></p>



<a name="401255211"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/roc__mainForHost_1_exposed_generic/near/401255211" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ayaz Hafiz <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/roc__mainForHost_1_exposed_generic.html#401255211">(Nov 09 2023 at 23:51)</a>:</h4>
<p>I think there's an issue to make it so that's automatically suggested in these cases</p>



<a name="401255332"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/roc__mainForHost_1_exposed_generic/near/401255332" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/roc__mainForHost_1_exposed_generic.html#401255332">(Nov 09 2023 at 23:52)</a>:</h4>
<p>Can we automatically just wrap/add that on the compiler side so users don't have to?</p>



<a name="401257672"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/roc__mainForHost_1_exposed_generic/near/401257672" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ayaz Hafiz <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/roc__mainForHost_1_exposed_generic.html#401257672">(Nov 10 2023 at 00:14)</a>:</h4>
<p>in theory, yes</p>



<hr><p>Last updated: Mar 01 2026 at 12:20 UTC</p>
</html>