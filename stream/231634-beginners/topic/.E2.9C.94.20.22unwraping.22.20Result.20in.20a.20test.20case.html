<html>
<head><meta charset="utf-8"><title>✔ &quot;unwraping&quot; Result in a test case · beginners · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/index.html">beginners</a></h2>
<h3>Topic: <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/.E2.9C.94.20.22unwraping.22.20Result.20in.20a.20test.20case.html">✔ &quot;unwraping&quot; Result in a test case</a></h3>

<hr>

<base href="https://roc.zulipchat.com">

<head><link href="https://roc-lang.github.io/zulip-export/style.css" rel="stylesheet"></head>

<a name="542993837"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/%E2%9C%94%20%22unwraping%22%20Result%20in%20a%20test%20case/near/542993837" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joseph Montanaro <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/.E2.9C.94.20.22unwraping.22.20Result.20in.20a.20test.20case.html#542993837">(Oct 03 2025 at 17:27)</a>:</h4>
<p>I have a function that can fail. I'd like to write a test case for that function, like so:</p>
<div class="codehilite"><pre><span></span><code>expect
    Ok(parsed) = parse_rule(&quot;34|77&quot;)
    parsed == { before: 34, after: 77}
</code></pre></div>
<p>This results in the following error:</p>
<div class="codehilite"><pre><span></span><code>This expression is used in an unexpected way:

39│      Ok(parsed) = parse_rule(&quot;34|77&quot;)
                      ^^^^^^^^^^^^^^^^^^^

This parse_rule call produces:

    Result {
        after : Int Unsigned64,
        before : Int Unsigned64,
    } [
        InvalidNumStr,
        NotFound,
    ]

But you are trying to use it as:

    [Ok *]
</code></pre></div>
<p>However, if I write it like this:</p>
<div class="codehilite"><pre><span></span><code>expect
    parsed = parse_rule(&quot;34|77&quot;)
    parsed == Ok({ before: 34, after: 77})
</code></pre></div>
<p>it works fine.</p>
<p>The error about <code>[Ok *]</code> made me wonder whether the type inference for <code>parsed</code> was just too general, so I tried adding a type annotation like this:</p>
<div class="codehilite"><pre><span></span><code>parsed : { before: U64, after: U64 }
Ok(parsed) = parse_rule(&quot;34|77&quot;)
</code></pre></div>
<p>But that fails with "Nothing is named <code>parsed</code> in this scope." </p>
<p>Obviously I _could_ just use the second form (<code>parsed == Ok({...})</code>, but I'd like to understand <em>why</em> I can't use the first form. I know you can pattern match when assigning, e.g. <code>{ a, b } = some_record</code>, so what's different here?</p>



<a name="542994286"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/%E2%9C%94%20%22unwraping%22%20Result%20in%20a%20test%20case/near/542994286" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Kiryl Dziamura <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/.E2.9C.94.20.22unwraping.22.20Result.20in.20a.20test.20case.html#542994286">(Oct 03 2025 at 17:30)</a>:</h4>
<p>The <code>Result</code> may return an error as well, so it's not correct to just destruct it as <code>Ok</code> at the type level</p>



<a name="542994542"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/%E2%9C%94%20%22unwraping%22%20Result%20in%20a%20test%20case/near/542994542" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Kiryl Dziamura <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/.E2.9C.94.20.22unwraping.22.20Result.20in.20a.20test.20case.html#542994542">(Oct 03 2025 at 17:32)</a>:</h4>
<p>In other words, you can't do this:</p>
<div class="codehilite"><pre><span></span><code>parsed = Err(&quot;error&quot;)
Ok(x) = parsed
</code></pre></div>



<a name="542994680"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/%E2%9C%94%20%22unwraping%22%20Result%20in%20a%20test%20case/near/542994680" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joseph Montanaro <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/.E2.9C.94.20.22unwraping.22.20Result.20in.20a.20test.20case.html#542994680">(Oct 03 2025 at 17:33)</a>:</h4>
<p>Ok, so this is what Rust calls the distinction between "refutable" and "irrefutable" patterns? That makes sense, so what's the preferred way to say "I just want to early-exit if this isn't Ok"? I can't use <code>?</code> in an expect, it seems.</p>



<a name="542996629"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/%E2%9C%94%20%22unwraping%22%20Result%20in%20a%20test%20case/near/542996629" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anton <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/.E2.9C.94.20.22unwraping.22.20Result.20in.20a.20test.20case.html#542996629">(Oct 03 2025 at 17:47)</a>:</h4>
<p>I think an early exit is not possible, but you could use <a href="https://www.roc-lang.org/builtins/alpha4/Result/#map_ok">Result.map_ok</a>.</p>



<a name="543018499"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/%E2%9C%94%20%22unwraping%22%20Result%20in%20a%20test%20case/near/543018499" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joseph Montanaro <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/.E2.9C.94.20.22unwraping.22.20Result.20in.20a.20test.20case.html#543018499">(Oct 03 2025 at 19:38)</a>:</h4>
<p>Ok, thanks! I think I'll just stick with <code>== Ok(...)</code> for now, it seems simplest.</p>



<a name="543018510"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/%E2%9C%94%20%22unwraping%22%20Result%20in%20a%20test%20case/near/543018510" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Notification Bot <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/.E2.9C.94.20.22unwraping.22.20Result.20in.20a.20test.20case.html#543018510">(Oct 03 2025 at 19:38)</a>:</h4>
<p><span class="user-mention silent" data-user-id="972318">Joseph Montanaro</span> has marked this topic as resolved.</p>



<a name="543018585"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/%E2%9C%94%20%22unwraping%22%20Result%20in%20a%20test%20case/near/543018585" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Kiryl Dziamura <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/.E2.9C.94.20.22unwraping.22.20Result.20in.20a.20test.20case.html#543018585">(Oct 03 2025 at 19:39)</a>:</h4>
<p>I just want to say it's not only simplest, it's correct idiomatically</p>



<a name="543019109"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/%E2%9C%94%20%22unwraping%22%20Result%20in%20a%20test%20case/near/543019109" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Kiryl Dziamura <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/.E2.9C.94.20.22unwraping.22.20Result.20in.20a.20test.20case.html#543019109">(Oct 03 2025 at 19:43)</a>:</h4>
<p>The function returns a particular value and the test asserts this case. It's not only the record inside of the result important here but the whole result of the function! <span aria-label="slight smile" class="emoji emoji-1f642" role="img" title="slight smile">:slight_smile:</span><br>
But I admit I could misunderstand the problem.</p>



<a name="543019339"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/%E2%9C%94%20%22unwraping%22%20Result%20in%20a%20test%20case/near/543019339" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joseph Montanaro <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/.E2.9C.94.20.22unwraping.22.20Result.20in.20a.20test.20case.html#543019339">(Oct 03 2025 at 19:45)</a>:</h4>
<p>It makes sense! I was mostly wondering about more complex future cases, where I might need to work with several Results in sequence as part of the same test. E.g. in Rust I might do something like this:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="cp">#[test]</span>
<span class="k">fn</span><span class="w"> </span><span class="nf">test_thing</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">app</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">App</span><span class="p">::</span><span class="n">load</span><span class="p">()</span>
<span class="w">        </span><span class="p">.</span><span class="n">expect</span><span class="p">(</span><span class="s">"Failed to load the app."</span><span class="p">);</span>
<span class="w">    </span><span class="n">app</span><span class="p">.</span><span class="n">set_some_state</span><span class="p">(</span><span class="s">"blahblah"</span><span class="p">)</span>
<span class="w">        </span><span class="p">.</span><span class="n">expect</span><span class="p">(</span><span class="s">"failed to set state"</span><span class="p">);</span>
<span class="w">    </span><span class="fm">assert_eq!</span><span class="p">(</span><span class="n">get_some_state</span><span class="p">(</span><span class="s">"blahblah"</span><span class="p">),</span><span class="w"> </span><span class="nb">Ok</span><span class="p">(</span><span class="s">"blahblah"</span><span class="p">))</span>
<span class="p">}</span>
</code></pre></div>
<p>But I'm not sure how I would approach that in Roc, outside of using several nested <code>when</code>s or <code>Result.map_ok</code>s. But that doesn't feel very nice.</p>



<a name="543058740"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/%E2%9C%94%20%22unwraping%22%20Result%20in%20a%20test%20case/near/543058740" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/.E2.9C.94.20.22unwraping.22.20Result.20in.20a.20test.20case.html#543058740">(Oct 04 2025 at 04:49)</a>:</h4>
<p>Yeah, I think an unwrapping crash would be nice in tests... if it only works in tests....not sure how we could limited to only tests though</p>



<a name="543058831"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/%E2%9C%94%20%22unwraping%22%20Result%20in%20a%20test%20case/near/543058831" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/.E2.9C.94.20.22unwraping.22.20Result.20in.20a.20test.20case.html#543058831">(Oct 04 2025 at 04:51)</a>:</h4>
<p>Something like this should work</p>
<div class="codehilite"><pre><span></span><code>expect = |res| {
    match(res) {
        Ok(x) -&gt; x
        Err(e) -&gt; crash(e)
    }
}
</code></pre></div>



<a name="543072002"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/%E2%9C%94%20%22unwraping%22%20Result%20in%20a%20test%20case/near/543072002" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Kiryl Dziamura <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/.E2.9C.94.20.22unwraping.22.20Result.20in.20a.20test.20case.html#543072002">(Oct 04 2025 at 08:59)</a>:</h4>
<p>I assume it's already possible if you write a helper function that has expect statements. Then call it within another expect so if it returned anything and didn't crash - the test is passed</p>



<a name="543096394"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/%E2%9C%94%20%22unwraping%22%20Result%20in%20a%20test%20case/near/543096394" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/.E2.9C.94.20.22unwraping.22.20Result.20in.20a.20test.20case.html#543096394">(Oct 04 2025 at 15:33)</a>:</h4>
<p>Yeah, exactly. Though I don't think expects narrow types. So you need a match like above</p>



<a name="543114100"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/%E2%9C%94%20%22unwraping%22%20Result%20in%20a%20test%20case/near/543114100" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joseph Montanaro <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/.E2.9C.94.20.22unwraping.22.20Result.20in.20a.20test.20case.html#543114100">(Oct 04 2025 at 20:15)</a>:</h4>
<p>That's cool, I didn't realize you could straight-up crash in an expect and it wouldn't interfere with the rest of the expects. Thanks!</p>
<p>Might make a nice addition to <code>Result</code> in the stdlib, although like with Rust's <code>unwrap()</code> it would open the door to some abuse.</p>



<a name="543115223"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/%E2%9C%94%20%22unwraping%22%20Result%20in%20a%20test%20case/near/543115223" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/.E2.9C.94.20.22unwraping.22.20Result.20in.20a.20test.20case.html#543115223">(Oct 04 2025 at 20:36)</a>:</h4>
<p>Yeah, I think it is more an open secret than anything that should every officially be in the stdlib</p>



<a name="543115242"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/%E2%9C%94%20%22unwraping%22%20Result%20in%20a%20test%20case/near/543115242" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/.E2.9C.94.20.22unwraping.22.20Result.20in.20a.20test.20case.html#543115242">(Oct 04 2025 at 20:37)</a>:</h4>
<p>We don't want to accidentally promote the use anywhere else</p>



<a name="543118348"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/%E2%9C%94%20%22unwraping%22%20Result%20in%20a%20test%20case/near/543118348" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/.E2.9C.94.20.22unwraping.22.20Result.20in.20a.20test.20case.html#543118348">(Oct 04 2025 at 21:37)</a>:</h4>
<p>yeah I consider <code>unwrap</code> and <code>expect</code> to be design mistakes in Rust's stdlib <span aria-label="smile" class="emoji emoji-1f604" role="img" title="smile">:smile:</span></p>



<a name="543118359"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/%E2%9C%94%20%22unwraping%22%20Result%20in%20a%20test%20case/near/543118359" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/.E2.9C.94.20.22unwraping.22.20Result.20in.20a.20test.20case.html#543118359">(Oct 04 2025 at 21:38)</a>:</h4>
<p>I definitely don't think we should have them either!</p>



<a name="543118393"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/%E2%9C%94%20%22unwraping%22%20Result%20in%20a%20test%20case/near/543118393" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/.E2.9C.94.20.22unwraping.22.20Result.20in.20a.20test.20case.html#543118393">(Oct 04 2025 at 21:39)</a>:</h4>
<p>We've talked in the past about having <code>?</code> inside <code>expect</code> "unwrap" by automatically failing the <code>expect</code> rather than doing an early return</p>



<a name="543118476"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/%E2%9C%94%20%22unwraping%22%20Result%20in%20a%20test%20case/near/543118476" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/.E2.9C.94.20.22unwraping.22.20Result.20in.20a.20test.20case.html#543118476">(Oct 04 2025 at 21:40)</a>:</h4>
<p>I like that idea but we haven't implemented it yet</p>



<a name="543119847"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/%E2%9C%94%20%22unwraping%22%20Result%20in%20a%20test%20case/near/543119847" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joseph Montanaro <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/.E2.9C.94.20.22unwraping.22.20Result.20in.20a.20test.20case.html#543119847">(Oct 04 2025 at 22:11)</a>:</h4>
<p>fast-failing <code>expect</code> via <code>?</code> would be awesome, I think that's actually the first thing I tried</p>



<a name="543120095"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/%E2%9C%94%20%22unwraping%22%20Result%20in%20a%20test%20case/near/543120095" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joseph Montanaro <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/.E2.9C.94.20.22unwraping.22.20Result.20in.20a.20test.20case.html#543120095">(Oct 04 2025 at 22:17)</a>:</h4>
<p>Actually, I just realized there's a super-simple way to do this that works already:</p>
<div class="codehilite"><pre><span></span><code>val = thing_that_can_fail(...) ?? crash &quot;thing failed&quot;
val == &quot;whatever&quot;
</code></pre></div>
<p>Being able to use <code>?</code> in expects would be even easier, plus it could do things like print the actual value inside the <code>Err</code>, but for now this is easier than having to have a helper function available everywhere.</p>



<hr><p>Last updated: Nov 01 2025 at 12:13 UTC</p>
</html>