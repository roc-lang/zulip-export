<html>
<head><meta charset="utf-8"><title>âœ” How to Stdout.line! inside a Result-returning block? Â· beginners Â· Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/index.html">beginners</a></h2>
<h3>Topic: <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/.E2.9C.94.20How.20to.20Stdout.2Eline.21.20inside.20a.20Result-returning.20block.3F.html">âœ” How to Stdout.line! inside a Result-returning block?</a></h3>

<hr>

<base href="https://roc.zulipchat.com">

<head><link href="https://roc-lang.github.io/zulip-export/style.css" rel="stylesheet"></head>

<a name="491625920"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/%E2%9C%94%20How%20to%20Stdout.line%21%20inside%20a%20Result-returning%20block%3F/near/491625920" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jan kili <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/.E2.9C.94.20How.20to.20Stdout.2Eline.21.20inside.20a.20Result-returning.20block.3F.html#491625920">(Jan 02 2025 at 15:26)</a>:</h4>
<p><em>(This might be specific to basic-cli@0.18.0.)</em> I have a function that returns a custom Result, and during its construction I want to use <code>Stdout.line!</code> for info. However, this causes a type mismatch where the Result the block returns conflicts with the Result that <code>line!</code> returns, with no obvious way to deconflict them. What are some small/large changes I can make to this minimal reproduction to get it to compile?</p>
<div class="codehilite" data-code-language="Perl"><pre><span></span><code><span class="n">app</span><span class="w"> </span><span class="p">[</span><span class="n">main</span><span class="o">!</span><span class="p">]</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">basic_cli:</span><span class="w"> </span><span class="n">platform</span><span class="w"> </span><span class="s">"https://github.com/roc-lang/basic-cli/releases/download/0.18.0/0APbwVN1_p1mJ96tXjaoiUCr8NBGamr8G8Ac_DrXR-o.tar.br"</span><span class="p">,</span>
<span class="p">}</span>

<span class="nb">import</span><span class="w"> </span><span class="n">basic_cli</span><span class="o">.</span><span class="n">Stdout</span>

<span class="n">main</span><span class="o">!</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">\</span><span class="nn">_</span><span class="w"> </span><span class="o">-&gt;</span>
<span class="w">    </span><span class="n">s</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">try</span><span class="w"> </span><span class="n">get_string</span><span class="o">!</span><span class="w"> </span><span class="p">{}</span>

<span class="w">    </span><span class="n">Stdout</span><span class="o">.</span><span class="n">line</span><span class="o">!</span><span class="w"> </span><span class="n">s</span>

<span class="n">get_string</span><span class="o">!</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{}</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">Result</span><span class="w"> </span><span class="n">Str</span><span class="w"> </span><span class="n">_</span>
<span class="n">get_string</span><span class="o">!</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">\</span><span class="nn">_</span><span class="w"> </span><span class="o">-&gt;</span>
<span class="w">    </span><span class="n">Str</span><span class="o">.</span><span class="n">fromUtf8</span><span class="w"> </span><span class="p">[</span><span class="mi">100</span><span class="p">]</span>
<span class="w">    </span><span class="o">|&gt;</span><span class="w"> </span><span class="o">\</span><span class="nn">result</span><span class="w"> </span><span class="o">-&gt;</span>
<span class="w">        </span><span class="n">when</span><span class="w"> </span><span class="n">result</span><span class="w"> </span><span class="n">is</span>
<span class="w">            </span><span class="n">Err</span><span class="w"> </span><span class="nn">e</span><span class="w"> </span><span class="o">-&gt;</span>
<span class="w">                </span><span class="n">when</span><span class="w"> </span><span class="n">e</span><span class="w"> </span><span class="n">is</span>
<span class="w">                    </span><span class="n">BadUtf8</span><span class="w"> </span><span class="n">foo</span><span class="w"> </span><span class="nn">bar</span><span class="w"> </span><span class="o">-&gt;</span>
<span class="w">                        </span><span class="n">try</span><span class="w"> </span><span class="n">Stdout</span><span class="o">.</span><span class="n">line</span><span class="o">!</span><span class="w"> </span><span class="s">"BadUtf8: $(Inspect.toStr foo) $(Inspect.toStr bar)"</span>
<span class="w">                        </span><span class="n">Err</span><span class="w"> </span><span class="s">"custom"</span>

<span class="w">            </span><span class="n">Ok</span><span class="w"> </span><span class="nn">s</span><span class="w"> </span><span class="o">-&gt;</span>
<span class="w">                </span><span class="n">Ok</span><span class="w"> </span><span class="n">s</span>
</code></pre></div>
<div class="codehilite"><pre><span></span><code>jan@framey:~/_code/JanCVanB/bug-repros/mixed-errs$ roc check

â”€â”€ TYPE MISMATCH in main.roc â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

This returns something that&#39;s incompatible with the return type of the
enclosing function:

16â”‚           when result is
17â”‚               Err e -&gt;
18â”‚                   when e is
19â”‚                       BadUtf8 foo bar -&gt;
20â”‚&gt;                          try Stdout.line! &quot;BadUtf8: $(Inspect.toStr foo) $(Inspect.toStr bar)&quot;
21â”‚                           Err &quot;custom&quot;
22â”‚
23â”‚               Ok s -&gt;
24â”‚                   Ok s

This returns an Err of type:

    [Err [StdoutErr [
        AlreadyExists,
        BrokenPipe,
        Interrupted,
        NotFound,
        Other Str,
        OutOfMemory,
        PermissionDenied,
        Unsupported,
    ]], â€¦]

But I expected the function to have return type:

    [Err Str, â€¦]

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

1 error and 0 warnings found in 28 ms.

jan@framey:~/_code/JanCVanB/bug-repros/mixed-errs$
</code></pre></div>



<a name="491626894"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/%E2%9C%94%20How%20to%20Stdout.line%21%20inside%20a%20Result-returning%20block%3F/near/491626894" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/.E2.9C.94.20How.20to.20Stdout.2Eline.21.20inside.20a.20Result-returning.20block.3F.html#491626894">(Jan 02 2025 at 15:33)</a>:</h4>
<p>You need to use a tag error</p>



<a name="491626964"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/%E2%9C%94%20How%20to%20Stdout.line%21%20inside%20a%20Result-returning%20block%3F/near/491626964" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/.E2.9C.94.20How.20to.20Stdout.2Eline.21.20inside.20a.20Result-returning.20block.3F.html#491626964">(Jan 02 2025 at 15:34)</a>:</h4>
<p>a Str error can not merge with the tag error being returned from <code>Stdout.line!</code></p>



<a name="491627011"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/%E2%9C%94%20How%20to%20Stdout.line%21%20inside%20a%20Result-returning%20block%3F/near/491627011" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/.E2.9C.94.20How.20to.20Stdout.2Eline.21.20inside.20a.20Result-returning.20block.3F.html#491627011">(Jan 02 2025 at 15:34)</a>:</h4>
<p>That or you need to map the <code>Stdout.line!</code> error into a Str</p>



<a name="491627057"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/%E2%9C%94%20How%20to%20Stdout.line%21%20inside%20a%20Result-returning%20block%3F/near/491627057" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jan kili <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/.E2.9C.94.20How.20to.20Stdout.2Eline.21.20inside.20a.20Result-returning.20block.3F.html#491627057">(Jan 02 2025 at 15:35)</a>:</h4>
<p>Ah! Yes, <code>Err (Custom "custom")</code> resolves the type mismatch.</p>



<a name="491627222"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/%E2%9C%94%20How%20to%20Stdout.line%21%20inside%20a%20Result-returning%20block%3F/near/491627222" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jan kili <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/.E2.9C.94.20How.20to.20Stdout.2Eline.21.20inside.20a.20Result-returning.20block.3F.html#491627222">(Jan 02 2025 at 15:36)</a>:</h4>
<p>Perhaps I need a different minimal reproduction for this that I'm hitting in my real app:</p>
<div class="codehilite"><pre><span></span><code>This returns an `Err` of type:

    [Err [StderrErr [
        AlreadyExists,
        BrokenPipe,
        Interrupted,
        NotFound,
        Other Str,
        OutOfMemory,
        PermissionDenied,
        Unsupported,
    ]], â€¦]

But I expected the function to have return type:

    [Err [
        FileReadErr * *,
        FileReadUtf8Err * *,
    ], â€¦]d
</code></pre></div>



<a name="491627337"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/%E2%9C%94%20How%20to%20Stdout.line%21%20inside%20a%20Result-returning%20block%3F/near/491627337" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jan kili <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/.E2.9C.94.20How.20to.20Stdout.2Eline.21.20inside.20a.20Result-returning.20block.3F.html#491627337">(Jan 02 2025 at 15:37)</a>:</h4>
<p>because I assumed those two tag unions<br>
( <code>[StderrErr ...]</code> and <code>[FileReadErr ..., FileReadUtf8Err ...]</code> )<br>
would merge.</p>



<a name="491627482"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/%E2%9C%94%20How%20to%20Stdout.line%21%20inside%20a%20Result-returning%20block%3F/near/491627482" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jan kili <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/.E2.9C.94.20How.20to.20Stdout.2Eline.21.20inside.20a.20Result-returning.20block.3F.html#491627482">(Jan 02 2025 at 15:38)</a>:</h4>
<p>Real app function:</p>
<div class="codehilite" data-code-language="Perl"><pre><span></span><code><span class="n">read_file</span><span class="o">!</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">PathToFile</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">Result</span><span class="w"> </span><span class="n">Str</span><span class="w"> </span><span class="n">_</span>
<span class="n">read_file</span><span class="o">!</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">\</span><span class="nn">file_path</span><span class="w"> </span><span class="o">-&gt;</span>
<span class="w">    </span><span class="n">file_path</span>
<span class="w">    </span><span class="o">|&gt;</span><span class="w"> </span><span class="n">Path</span><span class="o">.</span><span class="n">read_utf8</span><span class="o">!</span>
<span class="w">    </span><span class="o">|&gt;</span><span class="w"> </span><span class="o">\</span><span class="nn">result</span><span class="w"> </span><span class="o">-&gt;</span>
<span class="w">        </span><span class="n">when</span><span class="w"> </span><span class="n">result</span><span class="w"> </span><span class="n">is</span>
<span class="w">            </span><span class="n">Err</span><span class="w"> </span><span class="nn">e</span><span class="w"> </span><span class="o">-&gt;</span>
<span class="w">                </span><span class="n">when</span><span class="w"> </span><span class="n">e</span><span class="w"> </span><span class="n">is</span>
<span class="w">                    </span><span class="n">FileReadErr</span><span class="w"> </span><span class="n">path</span><span class="w"> </span><span class="nn">io_err</span><span class="w"> </span><span class="o">-&gt;</span>
<span class="w">                        </span><span class="n">try</span><span class="w"> </span><span class="n">Stderr</span><span class="o">.</span><span class="n">line</span><span class="o">!</span><span class="w"> </span><span class="s">"ğŸ“° â— Failed to read file $(Path.display path) because $(Inspect.toStr io_err)"</span>
<span class="w">                        </span><span class="n">try</span><span class="w"> </span><span class="n">Stderr</span><span class="o">.</span><span class="n">line</span><span class="o">!</span><span class="w"> </span><span class="n">tip_for_calling_this_app</span>
<span class="w">                        </span><span class="n">Err</span><span class="w"> </span><span class="n">e</span>

<span class="w">                    </span><span class="n">FileReadUtf8Err</span><span class="w"> </span><span class="n">path</span><span class="w"> </span><span class="nn">io_err</span><span class="w"> </span><span class="o">-&gt;</span>
<span class="w">                        </span><span class="n">try</span><span class="w"> </span><span class="n">Stderr</span><span class="o">.</span><span class="n">line</span><span class="o">!</span><span class="w"> </span><span class="s">"ğŸ“° â— Failed to read file $(Path.display path) because $(Inspect.toStr io_err)"</span>
<span class="w">                        </span><span class="n">Err</span><span class="w"> </span><span class="n">e</span>

<span class="w">            </span><span class="n">Ok</span><span class="w"> </span><span class="nn">file_contents</span><span class="w"> </span><span class="o">-&gt;</span>
<span class="w">                </span><span class="n">Ok</span><span class="w"> </span><span class="n">file_contents</span>
</code></pre></div>



<a name="491627713"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/%E2%9C%94%20How%20to%20Stdout.line%21%20inside%20a%20Result-returning%20block%3F/near/491627713" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jan kili <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/.E2.9C.94.20How.20to.20Stdout.2Eline.21.20inside.20a.20Result-returning.20block.3F.html#491627713">(Jan 02 2025 at 15:40)</a>:</h4>
<div class="codehilite"><pre><span></span><code>jan@framey:~/_code/JanCVanB/roc-typesetter$ roc check

â”€â”€ TYPE MISMATCH in main.roc â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

This returns something that&#39;s incompatible with the return type of the
enclosing function:

50â”‚           when result is
51â”‚               Err e -&gt;
52â”‚                   when e is
53â”‚                       FileReadErr path io_err -&gt;
54â”‚&gt;                          try Stderr.line! &quot;ğŸ“° â— Failed to read file $(Path.display path) because $(Inspect.toStr io_err)&quot;
55â”‚                           try Stderr.line! tip_for_calling_this_app
56â”‚                           Err e
57â”‚
58â”‚                       FileReadUtf8Err path io_err -&gt;
59â”‚                           try Stderr.line! &quot;ğŸ“° â— Failed to read file $(Path.display path) because $(Inspect.toStr io_err)&quot;
60â”‚                           Err e
61â”‚
62â”‚               Ok file_contents -&gt;
63â”‚                   Ok file_contents

This returns an Err of type:

    [Err [StderrErr [
        AlreadyExists,
        BrokenPipe,
        Interrupted,
        NotFound,
        Other Str,
        OutOfMemory,
        PermissionDenied,
        Unsupported,
    ]], â€¦]

But I expected the function to have return type:

    [Err [
        FileReadErr Path.Path val,
        FileReadUtf8Err Path.Path val,
    ], â€¦] where val implements Inspect, val implements Inspect

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

1 error and 0 warnings found in 32 ms.

jan@framey:~/_code/JanCVanB/roc-typesetter$
</code></pre></div>



<a name="491628172"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/%E2%9C%94%20How%20to%20Stdout.line%21%20inside%20a%20Result-returning%20block%3F/near/491628172" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jan kili <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/.E2.9C.94.20How.20to.20Stdout.2Eline.21.20inside.20a.20Result-returning.20block.3F.html#491628172">(Jan 02 2025 at 15:44)</a>:</h4>
<hr>
<hr>
<hr>
<hr>
<hr>
<hr>
<h1>This is a better minimal repro:</h1>
<div class="codehilite" data-code-language="Perl"><pre><span></span><code><span class="n">app</span><span class="w"> </span><span class="p">[</span><span class="n">main</span><span class="o">!</span><span class="p">]</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">basic_cli:</span><span class="w"> </span><span class="n">platform</span><span class="w"> </span><span class="s">"https://github.com/roc-lang/basic-cli/releases/download/0.18.0/0APbwVN1_p1mJ96tXjaoiUCr8NBGamr8G8Ac_DrXR-o.tar.br"</span><span class="p">,</span>
<span class="p">}</span>

<span class="nb">import</span><span class="w"> </span><span class="n">basic_cli</span><span class="o">.</span><span class="n">Stdout</span>

<span class="n">main</span><span class="o">!</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">\</span><span class="nn">_</span><span class="w"> </span><span class="o">-&gt;</span>
<span class="w">    </span><span class="n">s</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">try</span><span class="w"> </span><span class="n">get_string</span><span class="o">!</span><span class="w"> </span><span class="p">{}</span>

<span class="w">    </span><span class="n">Stdout</span><span class="o">.</span><span class="n">line</span><span class="o">!</span><span class="w"> </span><span class="n">s</span>

<span class="n">get_string</span><span class="o">!</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{}</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">Result</span><span class="w"> </span><span class="n">Str</span><span class="w"> </span><span class="n">_</span>
<span class="n">get_string</span><span class="o">!</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">\</span><span class="nn">_</span><span class="w"> </span><span class="o">-&gt;</span>
<span class="w">    </span><span class="n">Str</span><span class="o">.</span><span class="n">fromUtf8</span><span class="w"> </span><span class="p">[</span><span class="mi">100</span><span class="p">]</span>
<span class="w">    </span><span class="o">|&gt;</span><span class="w"> </span><span class="o">\</span><span class="nn">result</span><span class="w"> </span><span class="o">-&gt;</span>
<span class="w">        </span><span class="n">when</span><span class="w"> </span><span class="n">result</span><span class="w"> </span><span class="n">is</span>
<span class="w">            </span><span class="n">Err</span><span class="w"> </span><span class="nn">e</span><span class="w"> </span><span class="o">-&gt;</span>
<span class="w">                </span><span class="n">when</span><span class="w"> </span><span class="n">e</span><span class="w"> </span><span class="n">is</span>
<span class="w">                    </span><span class="n">BadUtf8</span><span class="w"> </span><span class="n">foo</span><span class="w"> </span><span class="nn">bar</span><span class="w"> </span><span class="o">-&gt;</span>
<span class="w">                        </span><span class="n">try</span><span class="w"> </span><span class="n">Stdout</span><span class="o">.</span><span class="n">line</span><span class="o">!</span><span class="w"> </span><span class="s">"BadUtf8: $(Inspect.toStr foo) $(Inspect.toStr bar)"</span>
<span class="w">                        </span><span class="n">Err</span><span class="w"> </span><span class="n">e</span>

<span class="w">            </span><span class="n">Ok</span><span class="w"> </span><span class="nn">s</span><span class="w"> </span><span class="o">-&gt;</span>
<span class="w">                </span><span class="n">Ok</span><span class="w"> </span><span class="n">s</span>
</code></pre></div>
<div class="codehilite"><pre><span></span><code>jan@framey:~/_code/JanCVanB/bug-repros/mixed-errs-2$ roc check

â”€â”€ TYPE MISMATCH in main.roc â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

This returns something that&#39;s incompatible with the return type of the
enclosing function:

16â”‚           when result is
17â”‚               Err e -&gt;
18â”‚                   when e is
19â”‚                       BadUtf8 foo bar -&gt;
20â”‚&gt;                          try Stdout.line! &quot;BadUtf8: $(Inspect.toStr foo) $(Inspect.toStr bar)&quot;
21â”‚                           Err e
22â”‚
23â”‚               Ok s -&gt;
24â”‚                   Ok s

This returns an Err of type:

    [Err [StdoutErr [
        AlreadyExists,
        BrokenPipe,
        Interrupted,
        NotFound,
        Other Str,
        OutOfMemory,
        PermissionDenied,
        Unsupported,
    ]], â€¦]

But I expected the function to have return type:

    [Err [BadUtf8 val val], â€¦] where val implements Inspect, val implements Inspect

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

1 error and 0 warnings found in 25 ms.

jan@framey:~/_code/JanCVanB/bug-repros/mixed-errs-2$
</code></pre></div>



<a name="491628308"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/%E2%9C%94%20How%20to%20Stdout.line%21%20inside%20a%20Result-returning%20block%3F/near/491628308" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/.E2.9C.94.20How.20to.20Stdout.2Eline.21.20inside.20a.20Result-returning.20block.3F.html#491628308">(Jan 02 2025 at 15:46)</a>:</h4>
<p>Yeah, this is a more nuanced issue</p>



<a name="491628436"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/%E2%9C%94%20How%20to%20Stdout.line%21%20inside%20a%20Result-returning%20block%3F/near/491628436" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/.E2.9C.94.20How.20to.20Stdout.2Eline.21.20inside.20a.20Result-returning.20block.3F.html#491628436">(Jan 02 2025 at 15:46)</a>:</h4>
<p>Essentially to be used in the <code>when e is</code> block, <code>e</code> must be either <code>FileReadErr path io_err</code> or <code>FileReadUtf8Err path io_err</code></p>



<a name="491628455"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/%E2%9C%94%20How%20to%20Stdout.line%21%20inside%20a%20Result-returning%20block%3F/near/491628455" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/.E2.9C.94.20How.20to.20Stdout.2Eline.21.20inside.20a.20Result-returning.20block.3F.html#491628455">(Jan 02 2025 at 15:47)</a>:</h4>
<p>This is a closed tag due to the when</p>



<a name="491628487"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/%E2%9C%94%20How%20to%20Stdout.line%21%20inside%20a%20Result-returning%20block%3F/near/491628487" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/.E2.9C.94.20How.20to.20Stdout.2Eline.21.20inside.20a.20Result-returning.20block.3F.html#491628487">(Jan 02 2025 at 15:47)</a>:</h4>
<p><code>e</code> is then returned</p>



<a name="491628546"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/%E2%9C%94%20How%20to%20Stdout.line%21%20inside%20a%20Result-returning%20block%3F/near/491628546" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/.E2.9C.94.20How.20to.20Stdout.2Eline.21.20inside.20a.20Result-returning.20block.3F.html#491628546">(Jan 02 2025 at 15:47)</a>:</h4>
<p>Suddenly, that closed tag is being merged with <code>[StderrErr ...]</code> due to the <code>try StdErr.line</code></p>



<a name="491628676"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/%E2%9C%94%20How%20to%20Stdout.line%21%20inside%20a%20Result-returning%20block%3F/near/491628676" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jan kili <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/.E2.9C.94.20How.20to.20Stdout.2Eline.21.20inside.20a.20Result-returning.20block.3F.html#491628676">(Jan 02 2025 at 15:48)</a>:</h4>
<p>Ayyy, nice, so adding <code>_ -&gt; Err e</code> seems to fix it.</p>



<a name="491628715"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/%E2%9C%94%20How%20to%20Stdout.line%21%20inside%20a%20Result-returning%20block%3F/near/491628715" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/.E2.9C.94.20How.20to.20Stdout.2Eline.21.20inside.20a.20Result-returning.20block.3F.html#491628715">(Jan 02 2025 at 15:49)</a>:</h4>
<p>I think you could add a <code>_ -&gt; crash "unreachable"</code> to your <code>when e is</code> to fix it. </p>
<p>That or instead of returning <code>e</code>, you need to return a new error.</p>
<div class="codehilite" data-code-language="Diff"><pre><span></span><code><span class="w"> </span>                   FileReadErr path io_err -&gt;
<span class="w"> </span>                       try Stderr.line! "ğŸ“° â— Failed to read file $(Path.display path) because $(Inspect.toStr io_err)"
<span class="w"> </span>                       try Stderr.line! tip_for_calling_this_app
<span class="gd">-                       Err e</span>
<span class="gi">+                       Err (FileReadErr path io_err)</span>
</code></pre></div>



<a name="491628832"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/%E2%9C%94%20How%20to%20Stdout.line%21%20inside%20a%20Result-returning%20block%3F/near/491628832" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jan kili <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/.E2.9C.94.20How.20to.20Stdout.2Eline.21.20inside.20a.20Result-returning.20block.3F.html#491628832">(Jan 02 2025 at 15:50)</a>:</h4>
<p>Ooh that's nicer - especially since in real app functions this pattern is usually combined with error customization</p>



<a name="491628898"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/%E2%9C%94%20How%20to%20Stdout.line%21%20inside%20a%20Result-returning%20block%3F/near/491628898" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/.E2.9C.94.20How.20to.20Stdout.2Eline.21.20inside.20a.20Result-returning.20block.3F.html#491628898">(Jan 02 2025 at 15:50)</a>:</h4>
<p>This is an interesting sharp edge <code>try</code>/<code>?</code> when combined with <code>when err is</code></p>



<a name="491629000"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/%E2%9C%94%20How%20to%20Stdout.line%21%20inside%20a%20Result-returning%20block%3F/near/491629000" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jan kili <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/.E2.9C.94.20How.20to.20Stdout.2Eline.21.20inside.20a.20Result-returning.20block.3F.html#491629000">(Jan 02 2025 at 15:51)</a>:</h4>
<p>Yeah, because I'm in a function that returns a <code>Result</code>, when I see the typechecker message say "this function returns" I don't think "oh yeah <code>when</code> is a function that returns a sometimes-closed union"</p>



<a name="491629196"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/%E2%9C%94%20How%20to%20Stdout.line%21%20inside%20a%20Result-returning%20block%3F/near/491629196" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jan kili <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/.E2.9C.94.20How.20to.20Stdout.2Eline.21.20inside.20a.20Result-returning.20block.3F.html#491629196">(Jan 02 2025 at 15:52)</a>:</h4>
<p>I read those typechecker messages as referring to the enclosing function's Result Err, but they're not.</p>



<a name="491629291"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/%E2%9C%94%20How%20to%20Stdout.line%21%20inside%20a%20Result-returning%20block%3F/near/491629291" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Notification Bot <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/.E2.9C.94.20How.20to.20Stdout.2Eline.21.20inside.20a.20Result-returning.20block.3F.html#491629291">(Jan 02 2025 at 15:53)</a>:</h4>
<p><span class="user-mention silent" data-user-id="462053">JanCVanB</span> has marked this topic as resolved.</p>



<a name="491629367"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/%E2%9C%94%20How%20to%20Stdout.line%21%20inside%20a%20Result-returning%20block%3F/near/491629367" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jan kili <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/.E2.9C.94.20How.20to.20Stdout.2Eline.21.20inside.20a.20Result-returning.20block.3F.html#491629367">(Jan 02 2025 at 15:54)</a>:</h4>
<p>I'm happy to continue discussing how to un-sharpen that edge here or elsewhere.</p>



<a name="491629481"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/%E2%9C%94%20How%20to%20Stdout.line%21%20inside%20a%20Result-returning%20block%3F/near/491629481" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jan kili <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/.E2.9C.94.20How.20to.20Stdout.2Eline.21.20inside.20a.20Result-returning.20block.3F.html#491629481">(Jan 02 2025 at 15:55)</a>:</h4>
<p>Side note - where in the typechecker messages does it indicate a closed tag union? I read all those <code>...]</code>-ending types as being open.</p>



<a name="491629844"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/%E2%9C%94%20How%20to%20Stdout.line%21%20inside%20a%20Result-returning%20block%3F/near/491629844" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/.E2.9C.94.20How.20to.20Stdout.2Eline.21.20inside.20a.20Result-returning.20block.3F.html#491629844">(Jan 02 2025 at 15:58)</a>:</h4>
<p>I think this is the only open union cause it is followed by <code>d</code>:</p>
<div class="codehilite"><pre><span></span><code>    [Err [
        FileReadErr * *,
        FileReadUtf8Err * *,
    ], â€¦]d
</code></pre></div>



<a name="491629913"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/%E2%9C%94%20How%20to%20Stdout.line%21%20inside%20a%20Result-returning%20block%3F/near/491629913" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/.E2.9C.94.20How.20to.20Stdout.2Eline.21.20inside.20a.20Result-returning.20block.3F.html#491629913">(Jan 02 2025 at 15:59)</a>:</h4>
<p>That said, any union returned by a function is automatically made open (solves most headaches from open vs closed unions)</p>



<a name="491629935"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/%E2%9C%94%20How%20to%20Stdout.line%21%20inside%20a%20Result-returning%20block%3F/near/491629935" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/.E2.9C.94.20How.20to.20Stdout.2Eline.21.20inside.20a.20Result-returning.20block.3F.html#491629935">(Jan 02 2025 at 15:59)</a>:</h4>
<p>Anyway, sounds like we should at least improve a few error messages here.</p>



<a name="491630064"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/%E2%9C%94%20How%20to%20Stdout.line%21%20inside%20a%20Result-returning%20block%3F/near/491630064" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jan kili <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/.E2.9C.94.20How.20to.20Stdout.2Eline.21.20inside.20a.20Result-returning.20block.3F.html#491630064">(Jan 02 2025 at 16:00)</a>:</h4>
<p>What does <code>...]</code> indicate?</p>



<a name="491630095"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/%E2%9C%94%20How%20to%20Stdout.line%21%20inside%20a%20Result-returning%20block%3F/near/491630095" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/.E2.9C.94.20How.20to.20Stdout.2Eline.21.20inside.20a.20Result-returning.20block.3F.html#491630095">(Jan 02 2025 at 16:00)</a>:</h4>
<p>That it left out information cause it was unimportant for the diff</p>



<a name="491630149"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/%E2%9C%94%20How%20to%20Stdout.line%21%20inside%20a%20Result-returning%20block%3F/near/491630149" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/.E2.9C.94.20How.20to.20Stdout.2Eline.21.20inside.20a.20Result-returning.20block.3F.html#491630149">(Jan 02 2025 at 16:00)</a>:</h4>
<p>In this case, it elided the <code>Ok</code> cases</p>



<a name="491630202"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/%E2%9C%94%20How%20to%20Stdout.line%21%20inside%20a%20Result-returning%20block%3F/near/491630202" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jan kili <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/.E2.9C.94.20How.20to.20Stdout.2Eline.21.20inside.20a.20Result-returning.20block.3F.html#491630202">(Jan 02 2025 at 16:01)</a>:</h4>
<p>Oh, gotcha. Yeah that's outside the Err tag union.</p>



<a name="491630213"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/%E2%9C%94%20How%20to%20Stdout.line%21%20inside%20a%20Result-returning%20block%3F/near/491630213" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/.E2.9C.94.20How.20to.20Stdout.2Eline.21.20inside.20a.20Result-returning.20block.3F.html#491630213">(Jan 02 2025 at 16:01)</a>:</h4>
<p>Eventually we plan to use <code>...</code> for open unions (and combining unions with <code>...OtherUnions</code>), but we don't do that yet.</p>



<a name="491630358"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/%E2%9C%94%20How%20to%20Stdout.line%21%20inside%20a%20Result-returning%20block%3F/near/491630358" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jan kili <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/.E2.9C.94.20How.20to.20Stdout.2Eline.21.20inside.20a.20Result-returning.20block.3F.html#491630358">(Jan 02 2025 at 16:02)</a>:</h4>
<p>Wow, so none of the above Err tags are open, then.</p>



<a name="491630527"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/%E2%9C%94%20How%20to%20Stdout.line%21%20inside%20a%20Result-returning%20block%3F/near/491630527" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jan kili <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/.E2.9C.94.20How.20to.20Stdout.2Eline.21.20inside.20a.20Result-returning.20block.3F.html#491630527">(Jan 02 2025 at 16:03)</a>:</h4>
<p>That makes sense. I think I was biased toward confusion here because I remember seeing that <code>...]</code> is the upcoming openness syntax.</p>



<a name="491630706"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/%E2%9C%94%20How%20to%20Stdout.line%21%20inside%20a%20Result-returning%20block%3F/near/491630706" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jan kili <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/.E2.9C.94.20How.20to.20Stdout.2Eline.21.20inside.20a.20Result-returning.20block.3F.html#491630706">(Jan 02 2025 at 16:04)</a>:</h4>
<p>I should've counted my matching <code>[ ]</code>s more closely!</p>



<a name="491634366"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/%E2%9C%94%20How%20to%20Stdout.line%21%20inside%20a%20Result-returning%20block%3F/near/491634366" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/.E2.9C.94.20How.20to.20Stdout.2Eline.21.20inside.20a.20Result-returning.20block.3F.html#491634366">(Jan 02 2025 at 16:35)</a>:</h4>
<blockquote>
<p>Wow, so none of the above Err tags are open, then</p>
</blockquote>
<p>Except that all tags returned from functions are automatically made open. So it is kinda confusing.</p>



<hr><p>Last updated: Mar 01 2026 at 12:20 UTC</p>
</html>