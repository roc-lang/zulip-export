<html>
<head><meta charset="utf-8"><title>Compiler panic encoding list of lists? · beginners · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/index.html">beginners</a></h2>
<h3>Topic: <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Compiler.20panic.20encoding.20list.20of.20lists.3F.html">Compiler panic encoding list of lists?</a></h3>

<hr>

<base href="https://roc.zulipchat.com">

<head><link href="https://roc-lang.github.io/zulip-export/style.css" rel="stylesheet"></head>

<a name="313698998"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Compiler%20panic%20encoding%20list%20of%20lists%3F/near/313698998" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Juliano <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Compiler.20panic.20encoding.20list.20of.20lists.3F.html#313698998">(Dec 03 2022 at 15:01)</a>:</h4>
<p>The code:</p>
<div class="codehilite" data-code-language="F#"><pre><span></span><code><span class="n">app</span><span class="w"> </span><span class="s">"day1"</span><span class="w"></span>
<span class="w">    </span><span class="n">packages</span><span class="w"> </span><span class="o">{</span><span class="w"> </span><span class="n">pf</span><span class="o">:</span><span class="w"> </span><span class="s">"basic-cli/src/main.roc"</span><span class="w"> </span><span class="o">}</span><span class="w"></span>
<span class="w">    </span><span class="n">imports</span><span class="w"> </span><span class="o">[</span><span class="n">pf</span><span class="o">.</span><span class="n">Stdout</span><span class="o">,</span><span class="w"> </span><span class="n">pf</span><span class="o">.</span><span class="n">File</span><span class="o">,</span><span class="w"> </span><span class="n">pf</span><span class="o">.</span><span class="n">Task</span><span class="o">,</span><span class="w"> </span><span class="n">pf</span><span class="o">.</span><span class="n">Path</span><span class="o">,</span><span class="w"> </span><span class="n">Json</span><span class="o">]</span><span class="w"></span>
<span class="w">    </span><span class="n">provides</span><span class="w"> </span><span class="o">[</span><span class="n">main</span><span class="o">]</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="n">pf</span><span class="w"></span>

<span class="n">main</span><span class="w"> </span><span class="o">=</span><span class="w"></span>
<span class="w">    </span><span class="n">content</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="s">"./aoc22/day1.txt"</span><span class="w"></span>
<span class="w">        </span><span class="o">|&gt;</span><span class="w"> </span><span class="nn">Path</span><span class="p">.</span><span class="n">fromStr</span><span class="w"></span>
<span class="w">        </span><span class="o">|&gt;</span><span class="w"> </span><span class="nn">File</span><span class="p">.</span><span class="n">readUtf8</span><span class="w"></span>
<span class="w">        </span><span class="o">|&gt;</span><span class="w"> </span><span class="nn">Task</span><span class="p">.</span><span class="n">onFail</span><span class="w"> </span><span class="o">(</span><span class="err">\</span><span class="n">err</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"></span>
<span class="w">            </span><span class="k">when</span><span class="w"> </span><span class="n">err</span><span class="w"> </span><span class="n">is</span><span class="w"></span>
<span class="w">                </span><span class="n">FileReadUtf8Err</span><span class="w"> </span><span class="o">_</span><span class="n">path</span><span class="w"> </span><span class="o">_</span><span class="n">fileErr</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">crash</span><span class="w"> </span><span class="s">"FileReadUtf8Err"</span><span class="w"></span>
<span class="w">                </span><span class="n">FileReadErr</span><span class="w"> </span><span class="o">_</span><span class="w"> </span><span class="o">_</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">crash</span><span class="w"> </span><span class="s">"FileReadErr: asd"</span><span class="w"></span>
<span class="w">        </span><span class="o">)</span><span class="w"></span>
<span class="w">        </span><span class="o">|&gt;</span><span class="w"> </span><span class="nn">Task</span><span class="p">.</span><span class="n">await</span><span class="w"></span>

<span class="w">    </span><span class="n">split</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">content</span><span class="w"></span>
<span class="w">        </span><span class="o">|&gt;</span><span class="w"> </span><span class="nn">Str</span><span class="p">.</span><span class="n">split</span><span class="w"> </span><span class="s">"</span><span class="se">\n</span><span class="s">"</span><span class="w"></span>
<span class="w">        </span><span class="o">|&gt;</span><span class="w"> </span><span class="nn">List</span><span class="p">.</span><span class="n">split</span><span class="w"> </span><span class="s">""</span><span class="w"></span>

<span class="w">    </span><span class="n">split</span><span class="w"></span>
<span class="w">        </span><span class="o">|&gt;</span><span class="w"> </span><span class="nn">Encode</span><span class="p">.</span><span class="n">toBytes</span><span class="w"> </span><span class="nn">Json</span><span class="p">.</span><span class="n">toUtf8</span><span class="w"></span>
<span class="w">        </span><span class="o">|&gt;</span><span class="w"> </span><span class="nn">Str</span><span class="p">.</span><span class="n">fromUtf8</span><span class="w"></span>
<span class="w">        </span><span class="o">|&gt;</span><span class="w"> </span><span class="nn">Result</span><span class="p">.</span><span class="n">withDefault</span><span class="w"> </span><span class="s">"err"</span><span class="w"></span>
<span class="w">        </span><span class="o">|&gt;</span><span class="w"> </span><span class="nn">Stdout</span><span class="p">.</span><span class="n">line</span><span class="w"></span>
</code></pre></div>
<p>The error:</p>
<div class="codehilite"><pre><span></span><code>thread &#39;main&#39; panicked at &#39;internal error: entered unreachable code: symbol/layout `pf.InternalTask.fromEffect` ProcLayout {
    arguments: [
        LambdaSet(
            LambdaSet {
                set: [
                    ( pf.Effect.30, [LambdaSet(LambdaSet { set: [( pf.Effect.76, [Union(NonRecursive([]))])], representation: Interned(12, PhantomData) }), LambdaSet(LambdaSet { set: [( pf.Stdout.3, [])], representation: Interned(3, PhantomData) })]),
                    ( pf.Effect.32, [Struct { field_order_hash: FieldOrderHash(0), field_layouts: [] }]),
                ],
                representation: Interned(
                    13,
                    PhantomData,
                ),
            },
        ),
    ],
    result: LambdaSet(
        LambdaSet {
            set: [
                ( pf.Effect.30, [LambdaSet(LambdaSet { set: [( pf.Effect.76, [Union(NonRecursive([]))])], representation: Interned(12, PhantomData) }), LambdaSet(LambdaSet { set: [( pf.Stdout.3, [])], representation: Interned(3, PhantomData) })]),
                ( pf.Effect.32, [Struct { field_order_hash: FieldOrderHash(0), field_layouts: [] }]),
            ],
            representation: Interned(
                13,
                PhantomData,
            ),
        },
    ),
    captures_niche: CapturesNiche(
        [],
    ),
} combo must be in DeclarationToIndex&#39;, crates/compiler/mono/src/borrow.rs:165:9

stack backtrace:
   0: rust_begin_unwind
             at /rustc/a55dd71d5fb0ec5a6a3a9e8c27b2127ba491ce52/library/std/src/panicking.rs:584:5
   1: core::panicking::panic_fmt
             at /rustc/a55dd71d5fb0ec5a6a3a9e8c27b2127ba491ce52/library/core/src/panicking.rs:142:14
   2: roc_mono::borrow::DeclarationToIndex::get_param_offset
             at ./crates/compiler/mono/src/borrow.rs:165:9
   3: roc_mono::borrow::ParamMap::get_param_offset
             at ./crates/compiler/mono/src/borrow.rs:188:9
   4: roc_mono::borrow::ParamMap::get_symbol
             at ./crates/compiler/mono/src/borrow.rs:193:28
   5: roc_mono::borrow::BorrowInfState::collect_call
             at ./crates/compiler/mono/src/borrow.rs:509:26
   6: roc_mono::borrow::BorrowInfState::collect_expr
             at ./crates/compiler/mono/src/borrow.rs:679:27
   7: roc_mono::borrow::BorrowInfState::collect_stmt
             at ./crates/compiler/mono/src/borrow.rs:792:17
   8: roc_mono::borrow::BorrowInfState::collect_proc
             at ./crates/compiler/mono/src/borrow.rs:856:9
   9: roc_mono::borrow::infer_borrow
             at ./crates/compiler/mono/src/borrow.rs:83:17
  10: roc_mono::ir::Proc::insert_refcount_operations
             at ./crates/compiler/mono/src/ir.rs:398:41
  11: roc_load_internal::file::update
             at ./crates/compiler/load_internal/src/file.rs:2912:21
  12: roc_load_internal::file::state_thread_step
             at ./crates/compiler/load_internal/src/file.rs:1749:37
  13: roc_load_internal::file::load_multi_threaded::{{closure}}
             at ./crates/compiler/load_internal/src/file.rs:1970:23
  14: crossbeam_utils::thread::scope::{{closure}}
             at /home/juliano/.cargo/registry/src/github.com-1ecc6299db9ec823/crossbeam-utils-0.8.10/src/thread.rs:161:65
  15: &lt;core::panic::unwind_safe::AssertUnwindSafe&lt;F&gt; as core::ops::function::FnOnce&lt;()&gt;&gt;::call_once
             at /rustc/a55dd71d5fb0ec5a6a3a9e8c27b2127ba491ce52/library/core/src/panic/unwind_safe.rs:271:9
  16: std::panicking::try::do_call
             at /rustc/a55dd71d5fb0ec5a6a3a9e8c27b2127ba491ce52/library/std/src/panicking.rs:492:40
  17: __rust_try
  18: std::panicking::try
             at /rustc/a55dd71d5fb0ec5a6a3a9e8c27b2127ba491ce52/library/std/src/panicking.rs:456:19
  19: std::panic::catch_unwind
             at /rustc/a55dd71d5fb0ec5a6a3a9e8c27b2127ba491ce52/library/std/src/panic.rs:137:14
  20: crossbeam_utils::thread::scope
             at /home/juliano/.cargo/registry/src/github.com-1ecc6299db9ec823/crossbeam-utils-0.8.10/src/thread.rs:161:18
  21: roc_load_internal::file::load_multi_threaded
             at ./crates/compiler/load_internal/src/file.rs:1908:9
  22: roc_load_internal::file::load
             at ./crates/compiler/load_internal/src/file.rs:1543:35
  23: roc_load::load
             at ./crates/compiler/load/src/lib.rs:35:5
  24: roc_load::load_and_monomorphize
             at ./crates/compiler/load/src/lib.rs:132:11
  25: roc_cli::build::build_file
             at ./crates/cli/src/build.rs:95:23
  26: roc_cli::build
             at ./crates/cli/src/lib.rs:655:27
  27: roc::main
             at ./crates/cli/src/main.rs:52:17
  28: core::ops::function::FnOnce::call_once
             at /rustc/a55dd71d5fb0ec5a6a3a9e8c27b2127ba491ce52/library/core/src/ops/function.rs:248:5
</code></pre></div>



<a name="313699343"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Compiler%20panic%20encoding%20list%20of%20lists%3F/near/313699343" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Juliano <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Compiler.20panic.20encoding.20list.20of.20lists.3F.html#313699343">(Dec 03 2022 at 15:04)</a>:</h4>
<p>Oh, 'List.split' doesn't do what I expect, nvm.</p>
<p>I tried to write my own split by character, and I got another panic.</p>
<p>The code</p>
<div class="codehilite" data-code-language="F#"><pre><span></span><code><span class="n">app</span><span class="w"> </span><span class="s">"day1"</span><span class="w"></span>
<span class="w">    </span><span class="n">packages</span><span class="w"> </span><span class="o">{</span><span class="w"> </span><span class="n">pf</span><span class="o">:</span><span class="w"> </span><span class="s">"basic-cli/src/main.roc"</span><span class="w"> </span><span class="o">}</span><span class="w"></span>
<span class="w">    </span><span class="n">imports</span><span class="w"> </span><span class="o">[</span><span class="n">pf</span><span class="o">.</span><span class="n">Stdout</span><span class="o">,</span><span class="w"> </span><span class="n">pf</span><span class="o">.</span><span class="n">File</span><span class="o">,</span><span class="w"> </span><span class="n">pf</span><span class="o">.</span><span class="n">Task</span><span class="o">,</span><span class="w"> </span><span class="n">pf</span><span class="o">.</span><span class="n">Path</span><span class="o">,</span><span class="w"> </span><span class="n">Json</span><span class="o">]</span><span class="w"></span>
<span class="w">    </span><span class="n">provides</span><span class="w"> </span><span class="o">[</span><span class="n">main</span><span class="o">]</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="n">pf</span><span class="w"></span>

<span class="n">splitListOn</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">List</span><span class="w"> </span><span class="n">a</span><span class="o">,</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">List</span><span class="w"> </span><span class="o">(</span><span class="n">List</span><span class="w"> </span><span class="n">a</span><span class="o">)</span><span class="w"></span>
<span class="n">splitListOn</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="err">\</span><span class="kt">list</span><span class="o">,</span><span class="w"> </span><span class="n">delim</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"></span>
<span class="w">    </span><span class="o">{</span><span class="n">cur</span><span class="o">,</span><span class="w"> </span><span class="n">acc</span><span class="o">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nn">List</span><span class="p">.</span><span class="n">walk</span><span class="w"> </span><span class="kt">list</span><span class="w"> </span><span class="o">{</span><span class="n">cur</span><span class="o">:</span><span class="w"> </span><span class="bp">[]</span><span class="o">,</span><span class="w"> </span><span class="n">acc</span><span class="o">:</span><span class="w"> </span><span class="bp">[]</span><span class="o">}</span><span class="w"> </span><span class="o">(</span><span class="err">\</span><span class="o">{</span><span class="n">cur</span><span class="o">,</span><span class="w"> </span><span class="n">acc</span><span class="o">},</span><span class="w"> </span><span class="n">elem</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"></span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="n">elem</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">delim</span><span class="w"> </span><span class="k">then</span><span class="w"></span>
<span class="w">            </span><span class="o">{</span><span class="n">cur</span><span class="o">:</span><span class="w"> </span><span class="bp">[]</span><span class="o">,</span><span class="w"> </span><span class="n">acc</span><span class="o">:</span><span class="w"> </span><span class="nn">List</span><span class="p">.</span><span class="n">append</span><span class="w"> </span><span class="n">acc</span><span class="w"> </span><span class="n">cur</span><span class="o">}</span><span class="w"></span>
<span class="w">        </span><span class="k">else</span><span class="w"></span>
<span class="w">            </span><span class="o">{</span><span class="n">cur</span><span class="o">:</span><span class="w"> </span><span class="nn">List</span><span class="p">.</span><span class="n">append</span><span class="w"> </span><span class="n">cur</span><span class="w"> </span><span class="n">elem</span><span class="o">,</span><span class="w"> </span><span class="n">acc</span><span class="o">:</span><span class="w"> </span><span class="n">acc</span><span class="o">}</span><span class="w"></span>
<span class="w">    </span><span class="o">)</span><span class="w"></span>
<span class="w">    </span><span class="n">acc</span><span class="w"></span>

<span class="n">main</span><span class="w"> </span><span class="o">=</span><span class="w"></span>
<span class="w">    </span><span class="n">content</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="s">"./aoc22/day1.txt"</span><span class="w"></span>
<span class="w">        </span><span class="o">|&gt;</span><span class="w"> </span><span class="nn">Path</span><span class="p">.</span><span class="n">fromStr</span><span class="w"></span>
<span class="w">        </span><span class="o">|&gt;</span><span class="w"> </span><span class="nn">File</span><span class="p">.</span><span class="n">readUtf8</span><span class="w"></span>
<span class="w">        </span><span class="o">|&gt;</span><span class="w"> </span><span class="nn">Task</span><span class="p">.</span><span class="n">onFail</span><span class="w"> </span><span class="o">(</span><span class="err">\</span><span class="n">err</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"></span>
<span class="w">            </span><span class="k">when</span><span class="w"> </span><span class="n">err</span><span class="w"> </span><span class="n">is</span><span class="w"></span>
<span class="w">                </span><span class="n">FileReadUtf8Err</span><span class="w"> </span><span class="o">_</span><span class="n">path</span><span class="w"> </span><span class="o">_</span><span class="n">fileErr</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">crash</span><span class="w"> </span><span class="s">"FileReadUtf8Err"</span><span class="w"></span>
<span class="w">                </span><span class="n">FileReadErr</span><span class="w"> </span><span class="o">_</span><span class="w"> </span><span class="o">_</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">crash</span><span class="w"> </span><span class="s">"FileReadErr: asd"</span><span class="w"></span>
<span class="w">        </span><span class="o">)</span><span class="w"></span>
<span class="w">        </span><span class="o">|&gt;</span><span class="w"> </span><span class="nn">Task</span><span class="p">.</span><span class="n">await</span><span class="w"></span>

<span class="w">    </span><span class="n">split</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">content</span><span class="w"></span>
<span class="w">        </span><span class="o">|&gt;</span><span class="w"> </span><span class="nn">Str</span><span class="p">.</span><span class="n">split</span><span class="w"> </span><span class="s">"</span><span class="se">\n</span><span class="s">"</span><span class="w"></span>
<span class="w">        </span><span class="o">|&gt;</span><span class="w"> </span><span class="n">splitListOn</span><span class="w"> </span><span class="s">""</span><span class="w"></span>

<span class="w">    </span><span class="n">split</span><span class="w"></span>
<span class="w">        </span><span class="o">|&gt;</span><span class="w"> </span><span class="nn">Encode</span><span class="p">.</span><span class="n">toBytes</span><span class="w"> </span><span class="nn">Json</span><span class="p">.</span><span class="n">toUtf8</span><span class="w"></span>
<span class="w">        </span><span class="o">|&gt;</span><span class="w"> </span><span class="nn">Str</span><span class="p">.</span><span class="n">fromUtf8</span><span class="w"></span>
<span class="w">        </span><span class="o">|&gt;</span><span class="w"> </span><span class="nn">Result</span><span class="p">.</span><span class="n">withDefault</span><span class="w"> </span><span class="s">"err"</span><span class="w"></span>
<span class="w">        </span><span class="o">|&gt;</span><span class="w"> </span><span class="nn">Stdout</span><span class="p">.</span><span class="n">line</span><span class="w"></span>
</code></pre></div>
<p>The error:</p>
<div class="codehilite"><pre><span></span><code>thread &#39;main&#39; panicked at &#39;internal error: entered unreachable code: symbol/layout `pf.InternalTask.fromEffect` ProcLayout {
    arguments: [
        LambdaSet(
            LambdaSet {
                set: [
                    ( pf.Effect.30, [LambdaSet(LambdaSet { set: [( pf.Effect.76, [Union(NonRecursive([]))])], representation: Interned(12, PhantomData) }), LambdaSet(LambdaSet { set: [( pf.Stdout.3, [])], representation: Interned(3, PhantomData) })]),
                    ( pf.Effect.32, [Struct { field_order_hash: FieldOrderHash(0), field_layouts: [] }]),
                ],
                representation: Interned(
                    13,
                    PhantomData,
                ),
            },
        ),
    ],
    result: LambdaSet(
        LambdaSet {
            set: [
                ( pf.Effect.30, [LambdaSet(LambdaSet { set: [( pf.Effect.76, [Union(NonRecursive([]))])], representation: Interned(12, PhantomData) }), LambdaSet(LambdaSet { set: [( pf.Stdout.3, [])], representation: Interned(3, PhantomData) })]),
                ( pf.Effect.32, [Struct { field_order_hash: FieldOrderHash(0), field_layouts: [] }]),
            ],
            representation: Interned(
                13,
                PhantomData,
            ),
        },
    ),
    captures_niche: CapturesNiche(
        [],
    ),
} combo must be in DeclarationToIndex&#39;, crates/compiler/mono/src/borrow.rs:165:9
stack backtrace:
   0: rust_begin_unwind
             at /rustc/a55dd71d5fb0ec5a6a3a9e8c27b2127ba491ce52/library/std/src/panicking.rs:584:5
   1: core::panicking::panic_fmt
             at /rustc/a55dd71d5fb0ec5a6a3a9e8c27b2127ba491ce52/library/core/src/panicking.rs:142:14
   2: roc_mono::borrow::DeclarationToIndex::get_param_offset
             at ./crates/compiler/mono/src/borrow.rs:165:9
   3: roc_mono::borrow::ParamMap::get_param_offset
             at ./crates/compiler/mono/src/borrow.rs:188:9
   4: roc_mono::borrow::ParamMap::get_symbol
             at ./crates/compiler/mono/src/borrow.rs:193:28
   5: roc_mono::borrow::BorrowInfState::collect_call
             at ./crates/compiler/mono/src/borrow.rs:509:26
   6: roc_mono::borrow::BorrowInfState::collect_expr
             at ./crates/compiler/mono/src/borrow.rs:679:27
   7: roc_mono::borrow::BorrowInfState::collect_stmt
             at ./crates/compiler/mono/src/borrow.rs:792:17
   8: roc_mono::borrow::BorrowInfState::collect_proc
             at ./crates/compiler/mono/src/borrow.rs:856:9
   9: roc_mono::borrow::infer_borrow
             at ./crates/compiler/mono/src/borrow.rs:83:17
  10: roc_mono::ir::Proc::insert_refcount_operations
             at ./crates/compiler/mono/src/ir.rs:398:41
  11: roc_load_internal::file::update
             at ./crates/compiler/load_internal/src/file.rs:2912:21
  12: roc_load_internal::file::state_thread_step
             at ./crates/compiler/load_internal/src/file.rs:1749:37
  13: roc_load_internal::file::load_multi_threaded::{{closure}}
             at ./crates/compiler/load_internal/src/file.rs:1970:23
  14: crossbeam_utils::thread::scope::{{closure}}
             at /home/juliano/.cargo/registry/src/github.com-1ecc6299db9ec823/crossbeam-utils-0.8.10/src/thread.rs:161:65
  15: &lt;core::panic::unwind_safe::AssertUnwindSafe&lt;F&gt; as core::ops::function::FnOnce&lt;()&gt;&gt;::call_once
             at /rustc/a55dd71d5fb0ec5a6a3a9e8c27b2127ba491ce52/library/core/src/panic/unwind_safe.rs:271:9
  16: std::panicking::try::do_call
             at /rustc/a55dd71d5fb0ec5a6a3a9e8c27b2127ba491ce52/library/std/src/panicking.rs:492:40
  17: __rust_try
  18: std::panicking::try
             at /rustc/a55dd71d5fb0ec5a6a3a9e8c27b2127ba491ce52/library/std/src/panicking.rs:456:19
  19: std::panic::catch_unwind
             at /rustc/a55dd71d5fb0ec5a6a3a9e8c27b2127ba491ce52/library/std/src/panic.rs:137:14
  20: crossbeam_utils::thread::scope
             at /home/juliano/.cargo/registry/src/github.com-1ecc6299db9ec823/crossbeam-utils-0.8.10/src/thread.rs:161:18
  21: roc_load_internal::file::load_multi_threaded
             at ./crates/compiler/load_internal/src/file.rs:1908:9
  22: roc_load_internal::file::load
             at ./crates/compiler/load_internal/src/file.rs:1543:35
  23: roc_load::load
             at ./crates/compiler/load/src/lib.rs:35:5
  24: roc_load::load_and_monomorphize
             at ./crates/compiler/load/src/lib.rs:132:11
  25: roc_cli::build::build_file
             at ./crates/cli/src/build.rs:95:23
  26: roc_cli::build
             at ./crates/cli/src/lib.rs:655:27
  27: roc::main
             at ./crates/cli/src/main.rs:52:17
  28: core::ops::function::FnOnce::call_once
             at /rustc/a55dd71d5fb0ec5a6a3a9e8c27b2127ba491ce52/library/core/src/ops/function.rs:248:5
</code></pre></div>



<a name="313701790"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Compiler%20panic%20encoding%20list%20of%20lists%3F/near/313701790" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Juliano <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Compiler.20panic.20encoding.20list.20of.20lists.3F.html#313701790">(Dec 03 2022 at 15:22)</a>:</h4>
<p>removing <code>|&gt; splitListOn ""</code> made the panic go away and showed me other compilation errors.</p>
<p>some were weird, some were good:</p>
<div class="codehilite"><pre><span></span><code>── DUPLICATE NAME ───────────────────────────────────────────── aoc22/day1.roc ─

The cur name is first defined here:

8│      {cur, acc} = List.walk list {cur: [], acc: []} (\{cur, acc}, elem -&gt;
        ^^^^^^^^^^

But then it&#39;s defined a second time here:

8│      {cur, acc} = List.walk list {cur: [], acc: []} (\{cur, acc}, elem -&gt;
                                                         ^^^^^^^^^^

Since these variables have the same name, it&#39;s easy to use the wrong
one on accident. Give one of them a new name.


── DUPLICATE NAME ───────────────────────────────────────────── aoc22/day1.roc ─

The acc name is first defined here:

8│      {cur, acc} = List.walk list {cur: [], acc: []} (\{cur, acc}, elem -&gt;
        ^^^^^^^^^^

But then it&#39;s defined a second time here:

8│      {cur, acc} = List.walk list {cur: [], acc: []} (\{cur, acc}, elem -&gt;
                                                         ^^^^^^^^^^

Since these variables have the same name, it&#39;s easy to use the wrong
one on accident. Give one of them a new name.


── TYPE MISMATCH ────────────────────────────────────────────── aoc22/day1.roc ─

This 2nd argument to isEq has an unexpected type:

9│          if elem == delim then
                       ^^^^^

This delim value is a:

    a

But isEq needs its 2nd argument to be:

    a | a has Eq

Tip: The type annotation uses the type variable a to say that this
definition can produce any type of value. But in the body I see that
it will only produce an instance of the ability Eq of a single
specific type. Maybe change the type annotation to be more specific?
Maybe change the code to be more general?


── CIRCULAR DEFINITION ──────────────────────────────────────── aoc22/day1.roc ─

The cur definition is causing a very tricky infinite loop:

8│      {cur, acc} = List.walk list {cur: [], acc: []} (\{cur, acc}, elem -&gt;
         ^^^

The cur value depends on itself through the following chain of
definitions:

    ┌─────┐
    │     cur
    │     ↓
    │     acc
    └─────┘

────────────────────────────────────────────────────────────────────────────────

4 errors and 1 warning found in 2987 ms.
</code></pre></div>



<a name="313702240"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Compiler%20panic%20encoding%20list%20of%20lists%3F/near/313702240" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Juliano <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Compiler.20panic.20encoding.20list.20of.20lists.3F.html#313702240">(Dec 03 2022 at 15:26)</a>:</h4>
<p>the Eq restriction on <code>a</code> was <span aria-label="thumbs up" class="emoji emoji-1f44d" role="img" title="thumbs up">:thumbs_up:</span> </p>
<p>the duplicate names were silly, i think? i don't think there's a problem with:</p>
<div class="codehilite"><pre><span></span><code>x = List.map [1] (\x -&gt; x+1)
# or closer to what i did
{a} = {a: 1} |&gt; (\{a} -&gt; {a: a+1})
</code></pre></div>
<p>and with record destructuring we _have_ to use the same name</p>
<p>the circular dependency, i've no idea how the compiler got there</p>



<a name="313702335"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Compiler%20panic%20encoding%20list%20of%20lists%3F/near/313702335" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Juliano <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Compiler.20panic.20encoding.20list.20of.20lists.3F.html#313702335">(Dec 03 2022 at 15:27)</a>:</h4>
<p>after working around compilation errors, re-adding <code>|&gt; splitListOn ""</code> didn't panic anymore</p>



<a name="313711248"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Compiler%20panic%20encoding%20list%20of%20lists%3F/near/313711248" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Compiler.20panic.20encoding.20list.20of.20lists.3F.html#313711248">(Dec 03 2022 at 16:46)</a>:</h4>
<p>Maybe not helpful here, but definitely try running <code>roc check ...</code> when you hit errors like this. It is a lot less likely to crash and will hopefully show the issue that is causing the crash.</p>



<a name="313711437"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Compiler%20panic%20encoding%20list%20of%20lists%3F/near/313711437" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Compiler.20panic.20encoding.20list.20of.20lists.3F.html#313711437">(Dec 03 2022 at 16:48)</a>:</h4>
<p>Also, roc doesn't allow shadowing so the circular definition is probably from naming the returned value <code>cur</code> and having <code>cur</code> as an argument to the lambda. Roc is trying to make them the same thing. Which is why it is getting such a messy error, i think.</p>
<p>(At least that is my guess)</p>



<a name="313711630"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Compiler%20panic%20encoding%20list%20of%20lists%3F/near/313711630" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Compiler.20panic.20encoding.20list.20of.20lists.3F.html#313711630">(Dec 03 2022 at 16:50)</a>:</h4>
<p>Also, you can change name with record destructoring: <code>\{a: newNameA} -&gt; #use newNameA</code></p>



<a name="313718972"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Compiler%20panic%20encoding%20list%20of%20lists%3F/near/313718972" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> OliverHR <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Compiler.20panic.20encoding.20list.20of.20lists.3F.html#313718972">(Dec 03 2022 at 18:05)</a>:</h4>
<p>Hi everyone a Roc newbie here. I'm trying to follow the tutorial but I get stuck on the "<a href="https://www.roc-lang.org/tutorial#building-an-application">Building an Application</a>" section.</p>
<div class="codehilite"><pre><span></span><code>$ roc dev
── FILE NOT FOUND ──────────────────────────────────────────────── UNKNOWN.roc ─

I am looking for this file, but it&#39;s not there:

    https://github.com/roc-lang/basic-cli/releases/download/0.1.1/zAoiC9xtQPHywYk350_b7ust04BmWLW00sjb9ZPtSQk.tar.br

Is the file supposed to be there? Maybe there is a typo in the file
name?%
</code></pre></div>



<a name="313720424"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Compiler%20panic%20encoding%20list%20of%20lists%3F/near/313720424" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anton <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Compiler.20panic.20encoding.20list.20of.20lists.3F.html#313720424">(Dec 03 2022 at 18:20)</a>:</h4>
<p>Hi Oliver, do you happen to be on a macos x86_64 device?</p>



<a name="313720680"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Compiler%20panic%20encoding%20list%20of%20lists%3F/near/313720680" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> OliverHR <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Compiler.20panic.20encoding.20list.20of.20lists.3F.html#313720680">(Dec 03 2022 at 18:22)</a>:</h4>
<p>Hi Anton, yep I'm using an intel macbook running macOS Monterey 12.6.1</p>



<a name="313721242"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Compiler%20panic%20encoding%20list%20of%20lists%3F/near/313721242" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anton <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Compiler.20panic.20encoding.20list.20of.20lists.3F.html#313721242">(Dec 03 2022 at 18:29)</a>:</h4>
<p>A workaround is mentioned in <a href="https://github.com/roc-lang/roc/issues/4655">this issue</a>, I hope to resolve the issue next week. I also have a PR in the oven that adds some warnings in the docs for this issue.</p>



<a name="313721950"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Compiler%20panic%20encoding%20list%20of%20lists%3F/near/313721950" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> OliverHR <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Compiler.20panic.20encoding.20list.20of.20lists.3F.html#313721950">(Dec 03 2022 at 18:36)</a>:</h4>
<p><span class="user-mention" data-user-id="361169">@Anton</span> before I read your comment I've tried decompressing the file tar-brotli and used in the packages section but it didn't work.</p>
<p>But I tried what you suggested on the github issue and it worked!, thank you very much!</p>
<div class="codehilite"><pre><span></span><code>app &quot;cli-tutorial&quot;
    packages { pf: &quot;basic-cli/src/main.roc&quot; }
    imports [pf.Stdout]
    provides [main] to pf

main =
    Stdout.line &quot;Hello, World!&quot;
</code></pre></div>



<a name="313722654"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Compiler%20panic%20encoding%20list%20of%20lists%3F/near/313722654" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anton <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Compiler.20panic.20encoding.20list.20of.20lists.3F.html#313722654">(Dec 03 2022 at 18:44)</a>:</h4>
<p>Happy to help :)</p>



<a name="313723729"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Compiler%20panic%20encoding%20list%20of%20lists%3F/near/313723729" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> OliverHR <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Compiler.20panic.20encoding.20list.20of.20lists.3F.html#313723729">(Dec 03 2022 at 18:58)</a>:</h4>
<p><span class="user-mention silent" data-user-id="361169">Anton</span> <a href="#narrow/stream/231634-beginners/topic/Compiler.20panic.20encoding.20list.20of.20lists.3F/near/313721242">said</a>:</p>
<blockquote>
<p>A workaround is mentioned in <a href="https://github.com/roc-lang/roc/issues/4655">this issue</a>, I hope to resolve the issue next week. I also have a PR in the oven that adds some warnings in the docs for this issue.</p>
</blockquote>
<p><span class="user-mention" data-user-id="361169">@Anton</span> now that you mention I think is also worth to mention that in this document: <a href="https://github.com/roc-lang/roc/blob/main/getting_started/macos_x86_64.md">"Roc installation guide for x86_64 macOS systems"</a></p>
<p>You can't select the zig version </p>
<div class="codehilite"><pre><span></span><code># Install the Zig compiler, for apps with Zig-based platforms:

brew install zig@0.9.1         #   &lt;--- this versioned packages are no longer available
</code></pre></div>
<p>We need to install just the "zig" package:</p>
<div class="codehilite"><pre><span></span><code>brew install zig
</code></pre></div>
<p>Current zig version (at the moment of the comment is 0.10.0) so I don't know if this affects.</p>



<a name="313723829"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Compiler%20panic%20encoding%20list%20of%20lists%3F/near/313723829" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anton <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Compiler.20panic.20encoding.20list.20of.20lists.3F.html#313723829">(Dec 03 2022 at 18:59)</a>:</h4>
<p>Yes, that is a problem, zig 0.10.0 will not work. I'll take a look.</p>



<a name="313726499"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Compiler%20panic%20encoding%20list%20of%20lists%3F/near/313726499" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anton <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Compiler.20panic.20encoding.20list.20of.20lists.3F.html#313726499">(Dec 03 2022 at 19:29)</a>:</h4>
<p>A workaround:</p>
<ul>
<li>remove zig 0.10.0 if you installed it with homebrew</li>
<li>download zig 0.9.1 from the <a href="https://ziglang.org/download/">zig website</a>. </li>
<li>add <code>export PATH=$PATH:~/path/to/zig</code> to your shell startup script (.profile, .zshrc, …)</li>
</ul>
<p>I'll update the documentation tomorrow.</p>



<a name="313726509"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Compiler%20panic%20encoding%20list%20of%20lists%3F/near/313726509" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anton <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Compiler.20panic.20encoding.20list.20of.20lists.3F.html#313726509">(Dec 03 2022 at 19:29)</a>:</h4>
<p>Thanks for bringing this to my attention <span class="user-mention" data-user-id="570074">@OliverHR</span> :)</p>



<a name="313727427"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Compiler%20panic%20encoding%20list%20of%20lists%3F/near/313727427" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Carroll <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Compiler.20panic.20encoding.20list.20of.20lists.3F.html#313727427">(Dec 03 2022 at 19:41)</a>:</h4>
<p>If you are also using Zig for other projects too, you can set the environment variable ROC_ZIG to a specific path for Roc to use.</p>



<a name="313728737"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Compiler%20panic%20encoding%20list%20of%20lists%3F/near/313728737" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Compiler.20panic.20encoding.20list.20of.20lists.3F.html#313728737">(Dec 03 2022 at 19:58)</a>:</h4>
<p>I didnt know you can change name with destructuring... thats cool!</p>



<a name="313729526"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Compiler%20panic%20encoding%20list%20of%20lists%3F/near/313729526" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> OliverHR <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Compiler.20panic.20encoding.20list.20of.20lists.3F.html#313729526">(Dec 03 2022 at 20:09)</a>:</h4>
<p><span class="user-mention" data-user-id="361169">@Anton</span> /<span class="user-mention" data-user-id="431893">@Brian Carroll</span> thank for the suggestions, I've installed manually zig 0.9.1 It was pretty straightforward, and to don't mess with my zsh/bash config I use <a href="https://direnv.net">direnv</a>, so in this way with a <code>.envrc</code> file  I set the environment vars I need.</p>



<a name="313738074"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Compiler%20panic%20encoding%20list%20of%20lists%3F/near/313738074" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Juliano <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Compiler.20panic.20encoding.20list.20of.20lists.3F.html#313738074">(Dec 03 2022 at 22:06)</a>:</h4>
<p>that <code>roc check</code> tip was pure gold <span class="user-mention" data-user-id="343810">@Brendan Hansknecht</span></p>



<hr><p>Last updated: Nov 01 2025 at 12:13 UTC</p>
</html>