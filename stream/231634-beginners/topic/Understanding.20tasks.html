<html>
<head><meta charset="utf-8"><title>Understanding tasks · beginners · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/index.html">beginners</a></h2>
<h3>Topic: <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Understanding.20tasks.html">Understanding tasks</a></h3>

<hr>

<base href="https://roc.zulipchat.com">

<head><link href="https://roc-lang.github.io/zulip-export/style.css" rel="stylesheet"></head>

<a name="426241400"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Understanding%20tasks/near/426241400" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Understanding.20tasks.html#426241400">(Mar 13 2024 at 01:31)</a>:</h4>
<p>I've been thinking about how best to help newcomers with understanding <code>Task</code> and effects. Specifically how with roc we are building up a data structure which describes what to do, and then passing that off to the platform to actually do the thing... so chaining tasks doesn't actually do anything until they are executed.</p>
<p>It feels to me like this is the most important concept to work effectively with roc.</p>
<p>I like a good graph or illustration. </p>
<p>I've been thinking if it would be possible to take a program written for e.g. basic cli, swap out the platform URL, and it generates some kind of graph which shows the task sequencing. </p>
<p>Has anyone ever seen anything like that? </p>
<p>Maybe this platform just boots up a webserver and displays on a webpage?</p>



<a name="426241678"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Understanding%20tasks/near/426241678" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Understanding.20tasks.html#426241678">(Mar 13 2024 at 01:34)</a>:</h4>
<p>I imagine having like an VS Code extension open that displays a window next to my code as I develop it, and I can see in real time what the tasks are doing.</p>



<a name="426242690"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Understanding%20tasks/near/426242690" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Understanding.20tasks.html#426242690">(Mar 13 2024 at 01:44)</a>:</h4>
<p>hm, I think showing a graph would require language-level integration</p>



<a name="426242721"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Understanding%20tasks/near/426242721" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Understanding.20tasks.html#426242721">(Mar 13 2024 at 01:44)</a>:</h4>
<p>because as soon as you hit an <code>await</code>, the platform can't possibly know what comes next until the callback function has actually executed</p>



<a name="426242776"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Understanding%20tasks/near/426242776" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Understanding.20tasks.html#426242776">(Mar 13 2024 at 01:45)</a>:</h4>
<p>the compiler can look at the source code for the callback and analyze which code paths can potentially result in which other tasks, and draw a graph from there</p>



<a name="426242841"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Understanding%20tasks/near/426242841" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Understanding.20tasks.html#426242841">(Mar 13 2024 at 01:45)</a>:</h4>
<p>but the platform can't see the source code, so all it knows is the 1 path that actually got taken, not what the alternatives were</p>



<a name="426243382"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Understanding%20tasks/near/426243382" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Understanding.20tasks.html#426243382">(Mar 13 2024 at 01:50)</a>:</h4>
<p><span class="user-mention silent" data-user-id="281383">Richard Feldman</span> <a href="#narrow/stream/231634-beginners/topic/Understanding.20tasks/near/426242690">said</a>:</p>
<blockquote>
<p>hm, I think showing a graph would require language-level integration</p>
</blockquote>
<p>Like a language server maybe?</p>



<a name="426244851"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Understanding%20tasks/near/426244851" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Understanding.20tasks.html#426244851">(Mar 13 2024 at 02:03)</a>:</h4>
<p>could be!</p>



<a name="426245085"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Understanding%20tasks/near/426245085" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Understanding.20tasks.html#426245085">(Mar 13 2024 at 02:05)</a>:</h4>
<p>Glad to hear it's possible to build. Would that be useful though? Has anyone ever seen anything like that used elsewhere?</p>



<a name="426245276"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Understanding%20tasks/near/426245276" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Understanding.20tasks.html#426245276">(Mar 13 2024 at 02:07)</a>:</h4>
<p>it might be useful, although I'm not sure how much of a problem this is currently <span aria-label="big smile" class="emoji emoji-1f604" role="img" title="big smile">:big_smile:</span></p>



<a name="426245296"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Understanding%20tasks/near/426245296" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Understanding.20tasks.html#426245296">(Mar 13 2024 at 02:07)</a>:</h4>
<p>it doesn't seem to be something I notice a lot of questions about!</p>



<a name="426246073"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Understanding%20tasks/near/426246073" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Understanding.20tasks.html#426246073">(Mar 13 2024 at 02:14)</a>:</h4>
<p>I think async is so common nowadays that it isn't too important</p>



<a name="426246116"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Understanding%20tasks/near/426246116" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Understanding.20tasks.html#426246116">(Mar 13 2024 at 02:15)</a>:</h4>
<p>That said, the task mutation is a bit more than simple async in some cases</p>



<a name="426305166"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Understanding%20tasks/near/426305166" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anton <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Understanding.20tasks.html#426305166">(Mar 13 2024 at 10:36)</a>:</h4>
<blockquote>
<p>Specifically how with roc we are building up a data structure which describes what to do, and then passing that off to the platform to actually do the thing... so chaining tasks doesn't actually do anything until they are executed.</p>
</blockquote>
<p>Can you add that to the tutorial <span class="user-mention" data-user-id="515757">@Luke Boswell</span>? I also think that is worth mentioning.</p>



<a name="426640957"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Understanding%20tasks/near/426640957" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eli Dowling <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Understanding.20tasks.html#426640957">(Mar 14 2024 at 22:34)</a>:</h4>
<p>Generally it's referred to as "cold tasks" it'd be good to mention that c#, JavaScript, and maybe java(I'm not quite sure) all have "hot tasks"</p>



<a name="426641903"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Understanding%20tasks/near/426641903" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Understanding.20tasks.html#426641903">(Mar 14 2024 at 22:42)</a>:</h4>
<p>Is async in rust with Tokio cold tasks? Do you know? I think we theoretically will be compiling to basically the same thing when we switch to effect interpreters.</p>



<a name="426642109"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Understanding%20tasks/near/426642109" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eli Dowling <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Understanding.20tasks.html#426642109">(Mar 14 2024 at 22:44)</a>:</h4>
<p>Something that would be really cool is some kind of task tracer:<br>
Ocaml's effect system has a few, one being this: <br>
<a href="https://github.com/ocaml-multicore/eio-trace">https://github.com/ocaml-multicore/eio-trace</a> <br>
It would be pretty cool if roc could generate similar traces that show a kind of flamegraph all the effects that were run.</p>



<a name="426642791"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Understanding%20tasks/near/426642791" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eli Dowling <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Understanding.20tasks.html#426642791">(Mar 14 2024 at 22:50)</a>:</h4>
<p><span class="user-mention" data-user-id="343810">@Brendan Hansknecht</span> <br>
My brain is telling me yes, but I'm not totally sure. </p>
<p>If you make an Async block it doesn't do anything until you run it on a thread right? And you can do joins, and awaits and everything inside without actually starting the task, you are just bringing up a big future data type, right? </p>
<p>Whereas in JS for example, you can only have a promise when a task is actually running.</p>



<a name="426642801"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Understanding%20tasks/near/426642801" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eli Dowling <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Understanding.20tasks.html#426642801">(Mar 14 2024 at 22:50)</a>:</h4>
<p>I found this:<br>
<a href="https://users.rust-lang.org/t/similarities-between-c-async-await-and-tasks-and-rust-async-await-and-futures/52771/2">https://users.rust-lang.org/t/similarities-between-c-async-await-and-tasks-and-rust-async-await-and-futures/52771/2</a></p>



<a name="426642840"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Understanding%20tasks/near/426642840" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eli Dowling <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Understanding.20tasks.html#426642840">(Mar 14 2024 at 22:50)</a>:</h4>
<p>They say the same thing, rust has cold Async.</p>



<a name="426643240"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Understanding%20tasks/near/426643240" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Understanding.20tasks.html#426643240">(Mar 14 2024 at 22:54)</a>:</h4>
<p>I'm trying to research "hot" and "cold" tasks, but haven't much. Are these similar to hot and cold observables?</p>



<a name="426643319"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Understanding%20tasks/near/426643319" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Understanding.20tasks.html#426643319">(Mar 14 2024 at 22:54)</a>:</h4>
<p>I'm not sure the observer pattern really fits in this context</p>



<a name="426643633"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Understanding%20tasks/near/426643633" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Understanding.20tasks.html#426643633">(Mar 14 2024 at 22:57)</a>:</h4>
<p>Found something that looks right;</p>
<blockquote>
<p><strong>Understanding tasks and task generators</strong><br>
In the paper about asynchronous programming model in F# [1] (written by Don Syme, myself and Dmitry Lomov), we mentioned three possible options that can be used for implementing the asynchronous programming model:</p>
<ul>
<li>Hot tasks (used by C#) - in this case, the asynchronous code block returns a task that has been already started and will eventually produce a value.</li>
<li>Cold tasks - in this model, the code block also returns a task that will eventually produce a value, but it doesn't start the task. The caller is responsible for starting it and may decide not to start it at all.</li>
<li>Task generators (used by F#) - in this case, the code block returns an object that will generate and start a task when it is provided with a continuation to be called when the operation completes.</li>
</ul>
</blockquote>



<a name="426648099"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Understanding%20tasks/near/426648099" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eli Dowling <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Understanding.20tasks.html#426648099">(Mar 14 2024 at 23:40)</a>:</h4>
<p>Yeah, maybe it's a more common term in the f# world, but I have heard it mentioned elsewhere. <br>
I know somewhere I've read a list of examples where what you're used to in hot tasks won't happen with cold tasks<br>
.<br>
The simplest one would be:</p>
<div class="codehilite"><pre><span></span><code>a=
  doThing= Stdout.printLine &quot;hi&quot;
  100
</code></pre></div>
<p>In a hot task model, you would expect this to print "hi", In a cold task model like rock this does nothing.</p>



<a name="426648452"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Understanding%20tasks/near/426648452" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eli Dowling <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Understanding.20tasks.html#426648452">(Mar 14 2024 at 23:44)</a>:</h4>
<p>I'm very used to it now, but I do remember when I was first learning f sharp I had a bunch of times where I thought something should have started and it just didn't run and it was very confusing</p>



<a name="426649605"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Understanding%20tasks/near/426649605" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Understanding.20tasks.html#426649605">(Mar 14 2024 at 23:57)</a>:</h4>
<p>This is really good context or background to explaining tasks in the tutorial as Anton mentioned. It will be good to reference familiar concepts from other languages.</p>



<a name="426650627"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Understanding%20tasks/near/426650627" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Understanding.20tasks.html#426650627">(Mar 15 2024 at 00:06)</a>:</h4>
<p>maybe...I have to admit, I have a bit of a concern that we're talking about solving a problem that doesn't have any symptoms <span aria-label="sweat smile" class="emoji emoji-1f605" role="img" title="sweat smile">:sweat_smile:</span></p>



<a name="426650670"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Understanding%20tasks/near/426650670" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Understanding.20tasks.html#426650670">(Mar 15 2024 at 00:07)</a>:</h4>
<p>is there a reason we suspect beginners are currently having trouble understanding how tasks work in Roc?</p>



<a name="426651575"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Understanding%20tasks/near/426651575" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Understanding.20tasks.html#426651575">(Mar 15 2024 at 00:15)</a>:</h4>
<p>I actually try to minimize referring to features of other languages, for a few reasons:</p>
<ul>
<li>if the learner doesn't know that feature, it can be a negative experience - even if only briefly ("I don't know what that is...<em>should</em> I know what that is? Is this being mentioned because it's some common knowledge I'm missing?")</li>
<li>it can distract focus from what's being taught ("hot and cold tasks...interesting! Now I wonder what the difference is between the two. Does Roc have hot tasks too?")</li>
<li>if the learner does know the feature in the other language, but there are subtle differences, they might build an inaccurate mental model that takes even more time to unlearn later (this can be mitigated with qualifiers like "it's kind of like..." but still has its risks)</li>
</ul>



<a name="426651745"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Understanding%20tasks/near/426651745" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Understanding.20tasks.html#426651745">(Mar 15 2024 at 00:17)</a>:</h4>
<p>I think the most useful ways to refer to things in other languages are for really broad things that appear in multiple languages, e.g. "tasks are kind of like Promises, but they don't do anything right when you create them" or "platforms are kind of like frameworks but they are in charge of more things, such as memory management and all I/O operations"</p>



<a name="426661046"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Understanding%20tasks/near/426661046" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Understanding.20tasks.html#426661046">(Mar 15 2024 at 02:04)</a>:</h4>
<p><span class="user-mention silent" data-user-id="281383">Richard Feldman</span> <a href="#narrow/stream/231634-beginners/topic/Understanding.20tasks/near/426650670">said</a>:</p>
<blockquote>
<p>maybe...I have to admit, I have a bit of a concern that we're talking about solving a problem that doesn't have any symptoms</p>
<p>is there a reason we suspect beginners are currently having trouble understanding how tasks work in Roc?</p>
</blockquote>
<p>I should have provided more background to explain why I think it would be beneficial to explore this idea. I'm not trying to highlight a specific issue; I wanted to explore if there is an opportunity to improve and help people build a mental model.</p>
<p>Getting comfortable putting the lego's together <code>await</code> <code>attempt</code> <code>try</code> <code>loop</code> <code>map</code> <code>fromResult</code> <code>ok</code> <code>err</code> has taken me a while. The first time I wrote two <code>Stdout.line</code> to print to the screen, I was confused about how/why to chain the Tasks together. </p>
<p>Understanding Tasks is fundemental to using roc, and I had to build up a mental model and gradually refine what I understand a Task is and how it works.</p>
<p>My thought was how can I help others to get to a working mental model without needing to spend as much time as I have.</p>
<p>I think the design of Tasks is great - they are really good to work with - so I don't think there is a problem with the design.</p>
<p>I'll sit on these ideas for now and come back to this another time.</p>



<a name="426661801"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Understanding%20tasks/near/426661801" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Understanding.20tasks.html#426661801">(Mar 15 2024 at 02:12)</a>:</h4>
<p>I do think that <code>!</code>, better compiler errors, and some bug fixes around requiring <code>Task.loop</code> will greatly reduce the overhead here. So I think as time passes, there will be less and less to explain.</p>



<a name="426663773"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Understanding%20tasks/near/426663773" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eli Dowling <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Understanding.20tasks.html#426663773">(Mar 15 2024 at 02:36)</a>:</h4>
<p>I actually mostly agree with you <span class="user-mention" data-user-id="281383">@Richard Feldman</span>. I would say in this case people coming from almost any mainstream language would only have experience with hot tasks, and therefore have incorrect assumptions. I do think that it's worth highlighting, that there is a fundamental difference in how they execute. I can obviously only speak to my one experience learning this (if only we could try learning things again) but I would have benefited from being told up front "your assumptions about what a task is doing are likely wrong"</p>



<a name="426663856"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Understanding%20tasks/near/426663856" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Understanding.20tasks.html#426663856">(Mar 15 2024 at 02:37)</a>:</h4>
<p>that all makes sense! <span aria-label="100" class="emoji emoji-1f4af" role="img" title="100">:100:</span></p>



<a name="430413679"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Understanding%20tasks/near/430413679" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Noel R <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Understanding.20tasks.html#430413679">(Mar 30 2024 at 19:18)</a>:</h4>
<p>Ah, this conversation is making me feel better already: I'm having trouble understanding how tasks work in Roc. In my attempts I get the wrong results most of the time, which shows that my mental model of Tasks (and Results and their relationship?) is not good at all.</p>
<p>So, for me at least, it has been a pain point. A fun one, but still <span aria-label="smile" class="emoji emoji-1f642" role="img" title="smile">:smile:</span></p>



<a name="430566065"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Understanding%20tasks/near/430566065" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Hristo <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Understanding.20tasks.html#430566065">(Apr 01 2024 at 09:13)</a>:</h4>
<p>As a Roc/Elm beginner (that I still am), my initial encounter with <code>Tasks</code> was not straightforward, so I'll try to share my perspective, in case it might be of help.</p>
<p>Initially, the crude mental model that I leaned towards was a parallel to how async-await works in languages like Python and JavaScript in terms of being able to chain multiple async functions together, and then do error-handling on top of that correspondingly. In Roc, my conceptual (yet quite far from perfect) understanding is that tasks are currently only platform-specific concepts. Basically, by defining a task (or a chain of tasks), one indicates to the platform <em>what</em> the tasks constitutes of, <em>ahead</em> of execution time. The execution itself happens at a <em>later</em> point in time that's relevant from the perspective of the platform itself, which is <em>after</em> the Roc code has handed over the instructions; and the platform itself implements the lower-level details, pertaining to the <em>how</em> of execution, including scheduling, result gathering etc.</p>
<p>I happened to listen to what I believe is quite a relevant Software Unscripted podcast <a href="https://castbox.fm/episode/Teaching-Functional-Programming-id4744222-id461777514?country=gb">episode</a> yesterday, and I hope the admins wouldn't mind my posting an excerpt from the <a href="https://sites.google.com/noredink.com/podcast-transcriptions/1-2-teaching-functional-programming">transcript</a> here (the excerpt is from page 5/20). I believe this is a much better summary than what my attempt could've made justice to tasks, but I decided to offer my beginner's perspective nevertheless, as a juxtaposition (and also, in case, it'd be helpful to the thread if more experienced Roc/Elm programmers would have time to indicate inaccuracies in my particular perspective):</p>
<blockquote>
<p><strong>Richard Feldman:</strong><br>
Whereas an Elm, I might do the same thing with a task. Like I have a function<br>
that returns a task and just like promises, tasks can be chained together. They<br>
can represent like, I want to do an HTP request and then I want to do this other<br>
thing, yada, yada. But the difference is that in the Elm function, when I return it,<br>
yeah, it's going to return this task, and that task sort of represents the HTTP<br>
request that I want to have done. The difference is just that if I call the<br>
JavaScript function a hundred times, it's going to fire off 100 HTTP requests.<br>
If I call the Elm function 100 times, it's still just going to return this value that<br>
describes, "Hey, I want an HTTP request to happen here." It's not going to fire<br>
off 100 times. It's still just going to be, well, I got this task back. So the<br>
difference between task and promise is really just a question of side effects<br>
versus managed effects. Side effects being right when you make it, it does the<br>
effect. Managed effect being, this is just a description of the effect that I want<br>
the run time to do in the future.<br>
...<br>
And the follow-up to that is that I think people might have an idea in their<br>
head that doing pure functional programming is going to be radically different in<br>
terms of what it feels like day-to-day than something like imperative<br>
programming when it comes to effects. But actually it's really not that different.<br>
You see a lot of things that instead of returning promise, they return task, but<br>
you chain them together in basically the same kinds of ways. The only difference<br>
is when they actually get executed by the run time versus immediately.</p>
</blockquote>



<a name="431991168"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Understanding%20tasks/near/431991168" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Noel R <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Understanding.20tasks.html#431991168">(Apr 08 2024 at 14:56)</a>:</h4>
<p>Thank you @Hristo for sharing the link to that episode; it was helpful.</p>
<p>Going back to what I said about having trouble understanding Tasks: as I make progress, I've been reflecting on the errors I made before, and the beliefs that led to them.</p>
<p><em>Thinking imperatively</em><br>
My head kept reading patterns such as <code>result &lt;- (someFunction "arg")</code> as "ah! we're assigning the result of the task to <code>result</code>, so we should have a string there, right?".</p>
<p>It took some time to understand that I'm writing a recipe to handle the result of something that will run in a parallel universe (the platform). What comes out of that portal is not a string: it's _something_ that could be a string, but all possible cases must be considered.</p>
<p><em>Syntax</em><br>
The backpassing and pipe operators in particular were confusing to me. In my first attempts, I did all sorts of weird stuff that resulted in wrong arguments passed, type mismatches and panics. Writing the same fragments in sweet / sugar-free versions helped a lot.</p>
<p>I think I would have benefited from having more examples in both sugary and desugared versions, considering that the docs are written with syntax sugar.</p>
<p><em>Overconfidence</em><br>
Although I was familiar with the concepts of functional programming, I didn't have hands-on experience —and yet I expected to understand things just from glancing at examples. I was wrong.</p>



<a name="431992827"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Understanding%20tasks/near/431992827" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Understanding.20tasks.html#431992827">(Apr 08 2024 at 15:01)</a>:</h4>
<p>Thank you for sharing <span class="user-mention" data-user-id="678767">@Noel R</span>. Have you seen the <a href="https://docs.google.com/document/d/1mTEZlOKqtMonmVsIGEC1A9ufs1TQHhVgZ52Vn-13GeU/edit?usp=drivesdk">Chaining Syntax design proposal</a>? You may find that interesting, and I would be keen to know what you think. </p>
<p>I've been working on implementing it recently and I think it will be a nice improvement to not use backpassing and have a more direct statement loooking syntax for Tasks.</p>



<a name="432090797"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Understanding%20tasks/near/432090797" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Noel R <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Understanding.20tasks.html#432090797">(Apr 09 2024 at 00:45)</a>:</h4>
<p>I hadn't! I really like that proposal. Reading it, I realized that the visual noise added by the <code>{} &lt;-</code> fragments is significant. The eyes cannot simply scan vertically to understand the outline of the code, so additional effort must be made to first decide where the line starts, and then decode its meaning. For a single line it's trivial but when scanning code my eyes really appreciate the clean edge.</p>
<p>A concern I'd have with using the assignment operator <code>=</code> for two purposes (backpassing and assignment) is that, if I understand correctly, it would be impossible for someoneone reading code to desugar just from the text on screen without fully understanding the code —this could be an issue for beginners like myself.</p>
<p>So, I'm wondering if we can get the best of both worlds by keeping the backpassing operator (not sure if operator is the right word <span aria-label="thinking" class="emoji emoji-1f914" role="img" title="thinking">:thinking:</span> ), while applying the rest of the proposal.</p>
<p>For example:<br>
<code>content &lt;- File.readUtf8! path</code> instead of<br>
<code>content = File.readUtf8! path</code></p>



<a name="432095743"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Understanding%20tasks/near/432095743" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Understanding.20tasks.html#432095743">(Apr 09 2024 at 01:28)</a>:</h4>
<p>I think a main goal of <code>!</code> is accepting that generally speaking, users don't really need to think about the await and it's underlying closure.</p>
<p>They just need to know that <code>!</code> means async function.</p>



<a name="432095838"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Understanding%20tasks/near/432095838" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Understanding.20tasks.html#432095838">(Apr 09 2024 at 01:29)</a>:</h4>
<p>Backpassing is a fundamentally more powerful syntax, while <code>!</code> is simpler and hides more to avoid confusion and details that many users don't need.</p>



<a name="432096004"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Understanding%20tasks/near/432096004" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Understanding.20tasks.html#432096004">(Apr 09 2024 at 01:30)</a>:</h4>
<p>As for desugaring. <code>&lt;-</code> vs <code>=</code> should make no difference. The desugaring happens due to the <code>!</code>. So if you scan for those, you can desugar anything.</p>



<a name="432107670"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Understanding%20tasks/near/432107670" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Przemek Kitszel <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Understanding.20tasks.html#432107670">(Apr 09 2024 at 03:02)</a>:</h4>
<p><span class="user-mention silent" data-user-id="515757">Luke Boswell</span> <a href="#narrow/stream/231634-beginners/topic/Understanding.20tasks/near/431992827">said</a>:</p>
<blockquote>
<p>Thank you for sharing <span class="user-mention silent" data-user-id="678767">Noel R</span>. Have you seen the <a href="https://docs.google.com/document/d/1mTEZlOKqtMonmVsIGEC1A9ufs1TQHhVgZ52Vn-13GeU/edit?usp=drivesdk">Chaining Syntax design proposal</a>? You may find that interesting, and I would be keen to know what you think. </p>
<p>I've been working on implementing it recently and I think it will be a nice improvement to not use backpassing and have a more direct statement loooking syntax for Tasks.</p>
</blockquote>
<p>That's awesome!<br>
Fits perfectly into "let me write core of the $thing in pure functional way, and glue it synchronously using similar syntax".<br>
I'm also for retiring &lt;- syntax.</p>
<p>The only change I will suggest: instead of taking <code>?</code> character for something that typical code will not do, consider changing it so you have <code>(! SomeTask.await)</code>, aka the same <code>!</code>, but with parens and argument.</p>



<a name="432108759"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Understanding%20tasks/near/432108759" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Understanding.20tasks.html#432108759">(Apr 09 2024 at 03:17)</a>:</h4>
<p>Can you explain your suggestion more? Maybe give an example with args?</p>



<a name="432136448"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Understanding%20tasks/near/432136448" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Przemek Kitszel <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Understanding.20tasks.html#432136448">(Apr 09 2024 at 06:24)</a>:</h4>
<p>(in my suggestion)<code>main = Stdout.line! "Hello, World"</code> could be rewritten as <code>main = Stdout.line (! Task.await) "Hello, World"</code>. Parenthesis makes it more obvious, but could not be removed (same arguments that go against curring).</p>
<p>Looks bloatier that <code>? Task.await</code> - just a bit, but we don't spend the valuable <code>?</code> character that could be used for future extensions.</p>



<a name="432154838"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Understanding%20tasks/near/432154838" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Understanding.20tasks.html#432154838">(Apr 09 2024 at 07:43)</a>:</h4>
<p>I kind of like having the more concise syntax that is in the proposal. Here is an example I've been looking at earlier.</p>
<div class="codehilite" data-code-language="Perl"><pre><span></span><code><span class="c1"># today's syntax w/o backpassing</span>
<span class="n">main</span><span class="w"> </span><span class="o">=</span>
<span class="w">    </span><span class="n">Task</span><span class="o">.</span><span class="n">await</span><span class="w"> </span><span class="p">(</span><span class="n">Stdout</span><span class="o">.</span><span class="n">line</span><span class="w"> </span><span class="s">"Ahoy"</span><span class="p">)</span><span class="w"> </span><span class="o">\</span><span class="p">{}</span><span class="w"> </span><span class="o">-&gt;</span>
<span class="w">        </span><span class="n">Task</span><span class="o">.</span><span class="n">await</span><span class="w"> </span><span class="p">(</span><span class="n">Stdout</span><span class="o">.</span><span class="n">line</span><span class="w"> </span><span class="s">"there"</span><span class="p">)</span><span class="w"> </span><span class="o">\</span><span class="p">{}</span><span class="w"> </span><span class="o">-&gt;</span>
<span class="w">            </span><span class="n">Task</span><span class="o">.</span><span class="n">ok</span><span class="w"> </span><span class="p">{}</span>
</code></pre></div>
<div class="codehilite" data-code-language="Perl"><pre><span></span><code><span class="c1"># with chaining syntax</span>
<span class="n">main</span><span class="w"> </span><span class="o">=</span>
<span class="w">    </span><span class="n">Stdout</span><span class="o">.</span><span class="n">line</span><span class="o">!</span><span class="w"> </span><span class="s">"Ahoy"</span>
<span class="w">    </span><span class="n">Stdout</span><span class="o">.</span><span class="n">line</span><span class="o">!</span><span class="w"> </span><span class="s">"There"</span>

<span class="w">    </span><span class="n">Task</span><span class="o">.</span><span class="n">ok</span><span class="w"> </span><span class="p">{}</span>
</code></pre></div>
<p>Both of these print out <code>Ahoy There</code> to stdio, but I think the second is much easier to follow at a glance.</p>



<a name="432155058"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Understanding%20tasks/near/432155058" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Understanding.20tasks.html#432155058">(Apr 09 2024 at 07:44)</a>:</h4>
<p>The former will still be valid as the <code>!</code> is just syntax sugar and unwrap to the exact same code.</p>



<a name="432265202"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Understanding%20tasks/near/432265202" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Noel R <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Understanding.20tasks.html#432265202">(Apr 09 2024 at 14:59)</a>:</h4>
<blockquote>
<p>I think a main goal of <code>!</code> is accepting that generally speaking, users don't really need to think about the await and it's underlying closure.</p>
</blockquote>
<p>I'm not sure if I would actually want the existence of the await and underlying closure to be hidden: it seems to me that async code and task handling are fundamental to the language.</p>
<p>As a learner, I'd rather keep that in mind, but having a syntax alternative that's nicer to write and read is great. I'm not sure I understand the power of backpassing so I can't comment on that.</p>
<p>This example can be found in the proposal:</p>
<div class="codehilite"><pre><span></span><code>main =
        Stdout.line! &quot;one&quot;
        Stdout.line! &quot;two&quot;
</code></pre></div>
<p>Would that be valid? From Luke's example above, and considering that it's just syntax sugar, I think it wouldn't: the last line should not have the <code>!</code> or it should be followed by something that produces a task. </p>
<p>If that's correct, then it's one of those cases that make me think that we can't hide the existence of tasks and async behavior from users. The readability can improve for sure and, in that line, I really like this proposal <span aria-label="ok" class="emoji emoji-1f44c" role="img" title="ok">:ok:</span> </p>
<p>I'm pretty new to Roc and have zero experience in language design, so take all of this as newbie opinion.</p>



<a name="432265881"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Understanding%20tasks/near/432265881" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Understanding.20tasks.html#432265881">(Apr 09 2024 at 15:01)</a>:</h4>
<p>That is allowed. It is a special exception to the sugar. A <code>!</code> on the final task of a function is just ignored. It enables users to write consistent code.</p>



<a name="432266276"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Understanding%20tasks/near/432266276" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Understanding.20tasks.html#432266276">(Apr 09 2024 at 15:03)</a>:</h4>
<p>Also, by hide, I mostly mean we can teach the simple thing first and if that is enough for users, they can just play with the language. If not, we can dive in and explain the sugar to give them more understanding.</p>



<a name="432269112"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Understanding%20tasks/near/432269112" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Understanding.20tasks.html#432269112">(Apr 09 2024 at 15:16)</a>:</h4>
<p><span class="user-mention silent" data-user-id="343810">Brendan Hansknecht</span> <a href="#narrow/stream/231634-beginners/topic/Understanding.20tasks/near/432265881">said</a>:</p>
<blockquote>
<p>That is allowed. It is a special exception to the sugar. A <code>!</code> on the final task of a function is just ignored. It enables users to write consistent code.</p>
</blockquote>
<p>as a minor note, I'd like to try not allowing this at first and seeing how it goes (maybe with a nice compiler error if you include it but shouldn't; that's a very easy scenario to detect)</p>



<a name="432269268"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Understanding%20tasks/near/432269268" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Understanding.20tasks.html#432269268">(Apr 09 2024 at 15:16)</a>:</h4>
<p>a downside of optionally allowing it that I hadn't thought of originally is that there's no way for <code>roc format</code> to enforce the convention that you should always have it</p>



<a name="432269374"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Understanding%20tasks/near/432269374" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Understanding.20tasks.html#432269374">(Apr 09 2024 at 15:16)</a>:</h4>
<p>because <code>roc format</code> doesn't know the types of the program, so it can't know what is and isn't a task</p>



<a name="432269468"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Understanding%20tasks/near/432269468" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Understanding.20tasks.html#432269468">(Apr 09 2024 at 15:17)</a>:</h4>
<p>and it certainly can't go around adding <code>!</code> to every function call at the end of defs, because that would not work out most of the time <span aria-label="sweat smile" class="emoji emoji-1f605" role="img" title="sweat smile">:sweat_smile:</span></p>



<a name="432269529"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Understanding%20tasks/near/432269529" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Understanding.20tasks.html#432269529">(Apr 09 2024 at 15:17)</a>:</h4>
<p>so I think we should do the experiment of not allowing the optional <code>!</code> at the end and see how it goes</p>



<a name="432269603"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Understanding%20tasks/near/432269603" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Understanding.20tasks.html#432269603">(Apr 09 2024 at 15:17)</a>:</h4>
<p>because it's trivial to have a consistent style with that design</p>



<a name="432271463"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Understanding%20tasks/near/432271463" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Understanding.20tasks.html#432271463">(Apr 09 2024 at 15:25)</a>:</h4>
<p>actually we could have it be a warning, come to think of it</p>



<a name="432271513"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Understanding%20tasks/near/432271513" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Understanding.20tasks.html#432271513">(Apr 09 2024 at 15:25)</a>:</h4>
<p>(with a helpful message)</p>



<a name="432275762"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Understanding%20tasks/near/432275762" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Understanding.20tasks.html#432275762">(Apr 09 2024 at 15:42)</a>:</h4>
<p>I get the reasons, but it does lose a solid chunk of the benefit of <code>!</code> in my opinion. Will make people question it more and pull back the covers sooners.</p>



<a name="432279254"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Understanding%20tasks/near/432279254" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Understanding.20tasks.html#432279254">(Apr 09 2024 at 15:57)</a>:</h4>
<p>hm that's a good point</p>



<a name="432279347"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Understanding%20tasks/near/432279347" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Understanding.20tasks.html#432279347">(Apr 09 2024 at 15:57)</a>:</h4>
<p>I guess a related question is: how much of a concern is it if people use it inconsistently? <span aria-label="thinking" class="emoji emoji-1f914" role="img" title="thinking">:thinking:</span></p>



<a name="432279620"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Understanding%20tasks/near/432279620" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Understanding.20tasks.html#432279620">(Apr 09 2024 at 15:59)</a>:</h4>
<p>like how annoyed would I be if a code base formatted using <code>roc format</code> sometimes did and sometimes didn't use the trailing <code>!</code></p>



<a name="432280120"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Understanding%20tasks/near/432280120" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Understanding.20tasks.html#432280120">(Apr 09 2024 at 16:00)</a>:</h4>
<p>hm, maybe the better experiment to run is whether <code>roc format</code> not enforcing it is actually a problem in practice</p>



<a name="432280804"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Understanding%20tasks/near/432280804" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Understanding.20tasks.html#432280804">(Apr 09 2024 at 16:03)</a>:</h4>
<p>Also, I guess we have 3 possible styles:</p>
<div class="codehilite"><pre><span></span><code>main =
   Stdout.line! &quot;A&quot;
   Stdout.line &quot;B&quot;
</code></pre></div>
<div class="codehilite"><pre><span></span><code>main =
   Stdout.line! &quot;A&quot;
   Stdout.line! &quot;B&quot;
</code></pre></div>
<div class="codehilite"><pre><span></span><code>main =
   Stdout.line! &quot;A&quot;
   Stdout.line! &quot;B&quot;
   Task.ok {}
</code></pre></div>



<a name="432281008"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Understanding%20tasks/near/432281008" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Understanding.20tasks.html#432281008">(Apr 09 2024 at 16:04)</a>:</h4>
<p>First and last valid for sure. Middle depends on the optional last <code>!</code></p>



<a name="432286000"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Understanding%20tasks/near/432286000" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Understanding.20tasks.html#432286000">(Apr 09 2024 at 16:25)</a>:</h4>
<p>yeah whenever I write out nontrivial examples I prefer the middle style</p>



<a name="432286330"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Understanding%20tasks/near/432286330" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Understanding.20tasks.html#432286330">(Apr 09 2024 at 16:26)</a>:</h4>
<p>it's kinda like how in Rust I always put <code>;</code> at the end of things that return <code>()</code> even when it's at the end of the expression and I don't need to</p>



<a name="432286332"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Understanding%20tasks/near/432286332" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Understanding.20tasks.html#432286332">(Apr 09 2024 at 16:26)</a>:</h4>
<p>Same. I think I actually like the first example the least. Even though I know it isn't inconsistent, it feels inconsistent.</p>



<a name="432286479"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Understanding%20tasks/near/432286479" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Understanding.20tasks.html#432286479">(Apr 09 2024 at 16:27)</a>:</h4>
<p>and I guess actually that's an interesting precedent; <code>rustfmt</code> doesn't enforce trailing semicolon consistency (probably because that would also require type information) and it seems totally fine in practice</p>



<a name="432300141"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Understanding%20tasks/near/432300141" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Noel R <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Understanding.20tasks.html#432300141">(Apr 09 2024 at 17:32)</a>:</h4>
<blockquote>
<p>as a minor note, I'd like to try not allowing this at first and seeing how it goes (maybe with a nice compiler error if you include it but shouldn't; that's a very easy scenario to detect)</p>
</blockquote>
<p>I like not having the exception since having an exception adds a conditional meaning to <code>!</code>.</p>
<p>From the three styles, I'd lean towards 3 since it's more explicit (and 1 looks weird...)</p>



<a name="432352305"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Understanding%20tasks/near/432352305" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Understanding.20tasks.html#432352305">(Apr 09 2024 at 22:22)</a>:</h4>
<p><span class="user-mention silent" data-user-id="343810">Brendan Hansknecht</span> <a href="#narrow/stream/231634-beginners/topic/Understanding.20tasks/near/432275762">said</a>:</p>
<blockquote>
<p>I get the reasons, but it does lose a solid chunk of the benefit of <code>!</code> in my opinion. Will make people question it more and pull back the covers sooners.</p>
</blockquote>
<p>This could be a good thing though. It's convenient for the common case, but still encourages people to understand "why do I need to add the Task.ok {}?"?</p>
<p>I've had a couple of cracks at supporting the optional last place thing. It's probably doable, but it will require some changes in the parser. I think the issue is where does an expression end, at the moment an expression can continue across a newline at the same indent, but that means it's hard to detect a final expression like this.</p>



<a name="432352331"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Understanding%20tasks/near/432352331" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Understanding.20tasks.html#432352331">(Apr 09 2024 at 22:23)</a>:</h4>
<p>So the PR I'm working on doesn't have that feature yet.</p>



<a name="432353962"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Understanding%20tasks/near/432353962" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Understanding.20tasks.html#432353962">(Apr 09 2024 at 22:39)</a>:</h4>
<p>Personally, I have no issues with either of these syntaxes:</p>
<div class="codehilite"><pre><span></span><code>main =
   Stdout.line! &quot;A&quot;
   Stdout.line! &quot;B&quot;
</code></pre></div>
<div class="codehilite"><pre><span></span><code>main =
   Stdout.line! &quot;A&quot;
   Stdout.line! &quot;B&quot;
   Task.ok {}
</code></pre></div>
<p>This is the only syntax that I think will be inconsistent/confusing:</p>
<div class="codehilite"><pre><span></span><code>main =
   Stdout.line! &quot;A&quot;
   Stdout.line &quot;B&quot;
</code></pre></div>



<a name="432356348"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Understanding%20tasks/near/432356348" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Hristo <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Understanding.20tasks.html#432356348">(Apr 09 2024 at 23:01)</a>:</h4>
<p>For completeness, could somebody provide an example of how (a relatively non-trivial chain of) error handling might look like (in case there'd be distinctive differences) with the proposed alternative syntax?<br>
Thanks!</p>



<a name="432356862"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Understanding%20tasks/near/432356862" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Understanding.20tasks.html#432356862">(Apr 09 2024 at 23:06)</a>:</h4>
<p>I don't think the<code>Task.ok {}</code> design is nice in longer examples <span aria-label="big smile" class="emoji emoji-1f604" role="img" title="big smile">:big_smile:</span></p>



<a name="432356881"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Understanding%20tasks/near/432356881" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Understanding.20tasks.html#432356881">(Apr 09 2024 at 23:06)</a>:</h4>
<p>it looks fine here but not in a big chunk of code that's doing a bunch of I/O</p>



<a name="432357160"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Understanding%20tasks/near/432357160" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Understanding.20tasks.html#432357160">(Apr 09 2024 at 23:09)</a>:</h4>
<p>I agree, I think it will be nicer. Just wanted to add that it may not be so bad. </p>
<p><span class="user-mention" data-user-id="693045">@Hristo</span></p>



<a name="432357717"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Understanding%20tasks/near/432357717" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Understanding.20tasks.html#432357717">(Apr 09 2024 at 23:15)</a>:</h4>
<div class="codehilite" data-code-language="Perl"><pre><span></span><code><span class="n">main</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">run</span><span class="w"> </span><span class="o">|&gt;</span><span class="w"> </span><span class="n">Task</span><span class="o">.</span><span class="n">onErr</span><span class="w"> </span><span class="o">\</span><span class="nn">err</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">Stdout</span><span class="o">.</span><span class="n">line</span><span class="w"> </span><span class="s">"ERROR: $(Inspect.toStr err)"</span>

<span class="c1"># task that bundles errors</span>
<span class="c1"># into a single tag union</span>
<span class="n">run</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">Task</span><span class="w"> </span><span class="p">{}</span><span class="w"> </span><span class="n">_</span>
<span class="n">run</span><span class="w"> </span><span class="o">=</span>

<span class="w">    </span><span class="c1"># a couple of statements</span>
<span class="w">    </span><span class="n">Stdout</span><span class="o">.</span><span class="n">line</span><span class="o">!</span><span class="w"> </span><span class="s">"Ahoy"</span>
<span class="w">    </span><span class="s">"There"</span><span class="w"> </span><span class="o">|&gt;</span><span class="w"> </span><span class="n">Stdout</span><span class="o">.</span><span class="n">line</span><span class="o">!</span>

<span class="w">    </span><span class="c1"># check jq is available</span>
<span class="w">    </span><span class="n">Cmd</span><span class="o">.</span><span class="k">new</span><span class="w"> </span><span class="s">"jq"</span>
<span class="w">    </span><span class="o">|&gt;</span><span class="w"> </span><span class="n">Cmd</span><span class="o">.</span><span class="n">arg</span><span class="w"> </span><span class="s">"--version"</span>
<span class="w">    </span><span class="o">|&gt;</span><span class="w"> </span><span class="n">Cmd</span><span class="o">.</span><span class="n">status</span>
<span class="w">    </span><span class="o">|&gt;</span><span class="w"> </span><span class="n">Task</span><span class="o">.</span><span class="n">mapErr</span><span class="o">!</span><span class="w"> </span><span class="n">UnableToCheckJQVersion</span>
</code></pre></div>



<a name="432366989"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Understanding%20tasks/near/432366989" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Notification Bot <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Understanding.20tasks.html#432366989">(Apr 10 2024 at 00:45)</a>:</h4>
<p>8 messages were moved from this topic to <a class="stream-topic" data-stream-id="231634" href="/#narrow/stream/231634-beginners/topic/Error.20handling.20with.20tasks">#beginners &gt; Error handling with tasks</a> by <span class="user-mention silent" data-user-id="343810">Brendan Hansknecht</span>.</p>



<a name="432369404"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Understanding%20tasks/near/432369404" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Understanding.20tasks.html#432369404">(Apr 10 2024 at 01:03)</a>:</h4>
<p>To be complete, here are the three versions of a more complex example from the design proposal. I just added in error handling. I internationally made the error handling more explicit to show the apis. Also, I made one function where there is no way to end all branches with bang.</p>
<div class="spoiler-block"><div class="spoiler-header">
<p>Unnecessary ! at end</p>
</div><div class="spoiler-content" aria-hidden="true">
<div class="codehilite" data-code-language="Elixir"><pre><span></span><code><span class="n">withRetries</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="nc">Task</span><span class="w"> </span><span class="n">ok</span><span class="w"> </span><span class="n">err</span><span class="p">,</span><span class="w"> </span><span class="nc">U64</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="nc">Task</span><span class="w"> </span><span class="n">ok</span><span class="w"> </span><span class="n">err</span>
<span class="n">withRetries</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="err">\</span><span class="n">task</span><span class="p">,</span><span class="w"> </span><span class="n">attempts</span><span class="w"> </span><span class="o">-&gt;</span>
<span class="w">    </span><span class="n">res</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">Task</span><span class="o">.</span><span class="n">toResult!</span><span class="w"> </span><span class="n">task</span>
<span class="w">    </span><span class="ow">when</span><span class="w"> </span><span class="n">res</span><span class="w"> </span><span class="n">is</span>
<span class="w">        </span><span class="nc">Ok</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">-&gt;</span>
<span class="w">            </span><span class="nc">Task</span><span class="o">.</span><span class="n">ok</span><span class="w"> </span><span class="n">x</span>
<span class="w">        </span><span class="nc">Err</span><span class="w"> </span><span class="n">e</span><span class="w"> </span><span class="o">-&gt;</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="n">attempts</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="n">then</span>
<span class="w">                </span><span class="nc">Task</span><span class="o">.</span><span class="n">err</span><span class="w"> </span><span class="n">e</span>
<span class="w">            </span><span class="k">else</span>
<span class="w">                </span><span class="n">withRetries!</span><span class="w"> </span><span class="n">task</span><span class="w"> </span><span class="p">(</span><span class="n">attempts</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span>

<span class="n">storeEmail</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="nc">Path</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="nc">Task</span><span class="w"> </span><span class="nc">Str</span><span class="w"> </span><span class="bp">_</span>
<span class="n">storeEmail</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="err">\</span><span class="n">path</span><span class="w"> </span><span class="o">-&gt;</span>
<span class="w">    </span><span class="n">url</span><span class="w"> </span><span class="o">=</span>
<span class="w">        </span><span class="nc">File</span><span class="o">.</span><span class="n">readUtf8</span><span class="w"> </span><span class="n">path</span>
<span class="w">        </span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Task</span><span class="o">.</span><span class="n">mapErr!</span><span class="w"> </span><span class="nc">FailedToReadUrl</span>
<span class="w">    </span><span class="n">loadUser</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">Http</span><span class="o">.</span><span class="n">get</span><span class="w"> </span><span class="n">url</span><span class="w"> </span><span class="nc">Json</span><span class="o">.</span><span class="n">codec</span>
<span class="w">    </span><span class="n">user</span><span class="w"> </span><span class="o">=</span>
<span class="w">        </span><span class="n">withRetries</span><span class="w"> </span><span class="n">loadUser</span><span class="w"> </span><span class="mi">3</span>
<span class="w">        </span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Task</span><span class="o">.</span><span class="n">mapErr!</span><span class="w"> </span><span class="nc">FailedToLoadUser</span>

<span class="w">    </span><span class="n">dest</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"$(user.name).txt"</span>
<span class="w">    </span><span class="nc">File</span><span class="o">.</span><span class="n">writeUtf8</span><span class="w"> </span><span class="n">dest</span><span class="w"> </span><span class="n">user</span><span class="o">.</span><span class="n">email</span>
<span class="w">        </span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Task</span><span class="o">.</span><span class="n">mapErr!</span><span class="w"> </span><span class="nc">FailedToStoreEmail</span>

<span class="w">    </span><span class="nc">Stdout</span><span class="o">.</span><span class="n">line!</span><span class="w"> </span><span class="s2">"Wrote email to $(dest)"</span>
</code></pre></div>
</div></div>
<div class="spoiler-block"><div class="spoiler-header">
<p>Minimal ! possible</p>
</div><div class="spoiler-content" aria-hidden="true">
<div class="codehilite" data-code-language="Elixir"><pre><span></span><code><span class="n">withRetries</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="nc">Task</span><span class="w"> </span><span class="n">ok</span><span class="w"> </span><span class="n">err</span><span class="p">,</span><span class="w"> </span><span class="nc">U64</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="nc">Task</span><span class="w"> </span><span class="n">ok</span><span class="w"> </span><span class="n">err</span>
<span class="n">withRetries</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="err">\</span><span class="n">task</span><span class="p">,</span><span class="w"> </span><span class="n">attempts</span><span class="w"> </span><span class="o">-&gt;</span>
<span class="w">    </span><span class="n">res</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">Task</span><span class="o">.</span><span class="n">toResult!</span><span class="w"> </span><span class="n">task</span>
<span class="w">    </span><span class="ow">when</span><span class="w"> </span><span class="n">res</span><span class="w"> </span><span class="n">is</span>
<span class="w">        </span><span class="nc">Ok</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">-&gt;</span>
<span class="w">            </span><span class="nc">Task</span><span class="o">.</span><span class="n">ok</span><span class="w"> </span><span class="n">x</span>
<span class="w">        </span><span class="nc">Err</span><span class="w"> </span><span class="n">e</span><span class="w"> </span><span class="o">-&gt;</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="n">attempts</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="n">then</span>
<span class="w">                </span><span class="nc">Task</span><span class="o">.</span><span class="n">err</span><span class="w"> </span><span class="n">e</span>
<span class="w">            </span><span class="k">else</span>
<span class="w">                </span><span class="n">withRetries</span><span class="w"> </span><span class="n">task</span><span class="w"> </span><span class="p">(</span><span class="n">attempts</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span>

<span class="n">storeEmail</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="nc">Path</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="nc">Task</span><span class="w"> </span><span class="nc">Str</span><span class="w"> </span><span class="bp">_</span>
<span class="n">storeEmail</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="err">\</span><span class="n">path</span><span class="w"> </span><span class="o">-&gt;</span>
<span class="w">    </span><span class="n">url</span><span class="w"> </span><span class="o">=</span>
<span class="w">        </span><span class="nc">File</span><span class="o">.</span><span class="n">readUtf8</span><span class="w"> </span><span class="n">path</span>
<span class="w">        </span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Task</span><span class="o">.</span><span class="n">mapErr!</span><span class="w"> </span><span class="nc">FailedToReadUrl</span>
<span class="w">    </span><span class="n">loadUser</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">Http</span><span class="o">.</span><span class="n">get</span><span class="w"> </span><span class="n">url</span><span class="w"> </span><span class="nc">Json</span><span class="o">.</span><span class="n">codec</span>
<span class="w">    </span><span class="n">user</span><span class="w"> </span><span class="o">=</span>
<span class="w">        </span><span class="n">withRetries</span><span class="w"> </span><span class="n">loadUser</span><span class="w"> </span><span class="mi">3</span>
<span class="w">        </span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Task</span><span class="o">.</span><span class="n">mapErr!</span><span class="w"> </span><span class="nc">FailedToLoadUser</span>

<span class="w">    </span><span class="n">dest</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"$(user.name).txt"</span>
<span class="w">    </span><span class="nc">File</span><span class="o">.</span><span class="n">writeUtf8</span><span class="w"> </span><span class="n">dest</span><span class="w"> </span><span class="n">user</span><span class="o">.</span><span class="n">email</span>
<span class="w">        </span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Task</span><span class="o">.</span><span class="n">mapErr!</span><span class="w"> </span><span class="nc">FailedToStoreEmail</span>

<span class="w">    </span><span class="nc">Stdout</span><span class="o">.</span><span class="n">line</span><span class="w"> </span><span class="s2">"Wrote email to $(dest)"</span>
</code></pre></div>
</div></div>
<div class="spoiler-block"><div class="spoiler-header">
<p>Explicit result at the end</p>
</div><div class="spoiler-content" aria-hidden="true">
<div class="codehilite" data-code-language="Elixir"><pre><span></span><code><span class="n">withRetries</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="nc">Task</span><span class="w"> </span><span class="n">ok</span><span class="w"> </span><span class="n">err</span><span class="p">,</span><span class="w"> </span><span class="nc">U64</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="nc">Task</span><span class="w"> </span><span class="n">ok</span><span class="w"> </span><span class="n">err</span>
<span class="n">withRetries</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="err">\</span><span class="n">task</span><span class="p">,</span><span class="w"> </span><span class="n">attempts</span><span class="w"> </span><span class="o">-&gt;</span>
<span class="w">    </span><span class="n">res</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">Task</span><span class="o">.</span><span class="n">toResult!</span><span class="w"> </span><span class="n">task</span>
<span class="w">    </span><span class="ow">when</span><span class="w"> </span><span class="n">res</span><span class="w"> </span><span class="n">is</span>
<span class="w">        </span><span class="nc">Ok</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">-&gt;</span>
<span class="w">            </span><span class="nc">Task</span><span class="o">.</span><span class="n">ok</span><span class="w"> </span><span class="n">x</span>
<span class="w">        </span><span class="nc">Err</span><span class="w"> </span><span class="n">e</span><span class="w"> </span><span class="o">-&gt;</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="n">attempts</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="n">then</span>
<span class="w">                </span><span class="nc">Task</span><span class="o">.</span><span class="n">err</span><span class="w"> </span><span class="n">e</span>
<span class="w">            </span><span class="k">else</span>
<span class="w">                </span><span class="n">out</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">withRetries!</span><span class="w"> </span><span class="n">task</span><span class="w"> </span><span class="p">(</span><span class="n">attempts</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span>
<span class="w">                </span><span class="nc">Task</span><span class="o">.</span><span class="n">ok</span><span class="w"> </span><span class="n">out</span>

<span class="n">storeEmail</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="nc">Path</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="nc">Task</span><span class="w"> </span><span class="nc">Str</span><span class="w"> </span><span class="bp">_</span>
<span class="n">storeEmail</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="err">\</span><span class="n">path</span><span class="w"> </span><span class="o">-&gt;</span>
<span class="w">    </span><span class="n">url</span><span class="w"> </span><span class="o">=</span>
<span class="w">        </span><span class="nc">File</span><span class="o">.</span><span class="n">readUtf8</span><span class="w"> </span><span class="n">path</span>
<span class="w">        </span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Task</span><span class="o">.</span><span class="n">mapErr!</span><span class="w"> </span><span class="nc">FailedToReadUrl</span>
<span class="w">    </span><span class="n">loadUser</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">Http</span><span class="o">.</span><span class="n">get</span><span class="w"> </span><span class="n">url</span><span class="w"> </span><span class="nc">Json</span><span class="o">.</span><span class="n">codec</span>
<span class="w">    </span><span class="n">user</span><span class="w"> </span><span class="o">=</span>
<span class="w">        </span><span class="n">withRetries</span><span class="w"> </span><span class="n">loadUser</span><span class="w"> </span><span class="mi">3</span>
<span class="w">        </span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Task</span><span class="o">.</span><span class="n">mapErr!</span><span class="w"> </span><span class="nc">FailedToLoadUser</span>

<span class="w">    </span><span class="n">dest</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"$(user.name).txt"</span>
<span class="w">    </span><span class="nc">File</span><span class="o">.</span><span class="n">writeUtf8</span><span class="w"> </span><span class="n">dest</span><span class="w"> </span><span class="n">user</span><span class="o">.</span><span class="n">email</span>
<span class="w">        </span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Task</span><span class="o">.</span><span class="n">mapErr!</span><span class="w"> </span><span class="nc">FailedToStoreEmail</span>

<span class="w">    </span><span class="nc">Stdout</span><span class="o">.</span><span class="n">line!</span><span class="w"> </span><span class="s2">"Wrote email to $(dest)"</span>
<span class="w">    </span><span class="nc">Task</span><span class="o">.</span><span class="n">ok</span><span class="w"> </span><span class="p">{}</span>
</code></pre></div>
</div></div>



<a name="432369462"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Understanding%20tasks/near/432369462" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Understanding.20tasks.html#432369462">(Apr 10 2024 at 01:04)</a>:</h4>
<p>If anything, this makes me realize that consistantly sticking to any one approach on all functions is unlikely to work well.</p>



<a name="432369653"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Understanding%20tasks/near/432369653" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Understanding.20tasks.html#432369653">(Apr 10 2024 at 01:05)</a>:</h4>
<p>I would use the unnecessary <code>!</code> for <code>storeEmail</code> and would avoid it in <code>withRetries</code>.</p>
<div class="spoiler-block"><div class="spoiler-header">
<p>my perference</p>
</div><div class="spoiler-content" aria-hidden="true">
<div class="codehilite" data-code-language="Elixir"><pre><span></span><code><span class="n">withRetries</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="nc">Task</span><span class="w"> </span><span class="n">ok</span><span class="w"> </span><span class="n">err</span><span class="p">,</span><span class="w"> </span><span class="nc">U64</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="nc">Task</span><span class="w"> </span><span class="n">ok</span><span class="w"> </span><span class="n">err</span>
<span class="n">withRetries</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="err">\</span><span class="n">task</span><span class="p">,</span><span class="w"> </span><span class="n">attempts</span><span class="w"> </span><span class="o">-&gt;</span>
<span class="w">    </span><span class="n">res</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">Task</span><span class="o">.</span><span class="n">toResult!</span><span class="w"> </span><span class="n">task</span>
<span class="w">    </span><span class="ow">when</span><span class="w"> </span><span class="n">res</span><span class="w"> </span><span class="n">is</span>
<span class="w">        </span><span class="nc">Ok</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">-&gt;</span>
<span class="w">            </span><span class="nc">Task</span><span class="o">.</span><span class="n">ok</span><span class="w"> </span><span class="n">x</span>
<span class="w">        </span><span class="nc">Err</span><span class="w"> </span><span class="n">e</span><span class="w"> </span><span class="o">-&gt;</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="n">attempts</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="n">then</span>
<span class="w">                </span><span class="nc">Task</span><span class="o">.</span><span class="n">err</span><span class="w"> </span><span class="n">e</span>
<span class="w">            </span><span class="k">else</span>
<span class="w">                </span><span class="n">withRetries</span><span class="w"> </span><span class="n">task</span><span class="w"> </span><span class="p">(</span><span class="n">attempts</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span>

<span class="n">storeEmail</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="nc">Path</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="nc">Task</span><span class="w"> </span><span class="nc">Str</span><span class="w"> </span><span class="bp">_</span>
<span class="n">storeEmail</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="err">\</span><span class="n">path</span><span class="w"> </span><span class="o">-&gt;</span>
<span class="w">    </span><span class="n">url</span><span class="w"> </span><span class="o">=</span>
<span class="w">        </span><span class="nc">File</span><span class="o">.</span><span class="n">readUtf8</span><span class="w"> </span><span class="n">path</span>
<span class="w">        </span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Task</span><span class="o">.</span><span class="n">mapErr!</span><span class="w"> </span><span class="nc">FailedToReadUrl</span>
<span class="w">    </span><span class="n">loadUser</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">Http</span><span class="o">.</span><span class="n">get</span><span class="w"> </span><span class="n">url</span><span class="w"> </span><span class="nc">Json</span><span class="o">.</span><span class="n">codec</span>
<span class="w">    </span><span class="n">user</span><span class="w"> </span><span class="o">=</span>
<span class="w">        </span><span class="n">withRetries</span><span class="w"> </span><span class="n">loadUser</span><span class="w"> </span><span class="mi">3</span>
<span class="w">        </span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Task</span><span class="o">.</span><span class="n">mapErr!</span><span class="w"> </span><span class="nc">FailedToLoadUser</span>

<span class="w">    </span><span class="n">dest</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"$(user.name).txt"</span>
<span class="w">    </span><span class="nc">File</span><span class="o">.</span><span class="n">writeUtf8</span><span class="w"> </span><span class="n">dest</span><span class="w"> </span><span class="n">user</span><span class="o">.</span><span class="n">email</span>
<span class="w">        </span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Task</span><span class="o">.</span><span class="n">mapErr!</span><span class="w"> </span><span class="nc">FailedToStoreEmail</span>

<span class="w">    </span><span class="nc">Stdout</span><span class="o">.</span><span class="n">line!</span><span class="w"> </span><span class="s2">"Wrote email to $(dest)"</span>
</code></pre></div>
</div></div>



<a name="432370227"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Understanding%20tasks/near/432370227" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Understanding.20tasks.html#432370227">(Apr 10 2024 at 01:09)</a>:</h4>
<p>For completeness:</p>
<div class="spoiler-block"><div class="spoiler-header">
<p>current syntax</p>
</div><div class="spoiler-content" aria-hidden="true">
<div class="codehilite" data-code-language="Elixir"><pre><span></span><code><span class="n">withRetries</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="nc">Task</span><span class="w"> </span><span class="n">ok</span><span class="w"> </span><span class="n">err</span><span class="p">,</span><span class="w"> </span><span class="nc">U64</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="nc">Task</span><span class="w"> </span><span class="n">ok</span><span class="w"> </span><span class="n">err</span>
<span class="n">withRetries</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="err">\</span><span class="n">task</span><span class="p">,</span><span class="w"> </span><span class="n">attempts</span><span class="w"> </span><span class="o">-&gt;</span>
<span class="w">    </span><span class="n">res</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">task</span><span class="w"> </span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Task</span><span class="o">.</span><span class="n">attempt</span>
<span class="w">    </span><span class="ow">when</span><span class="w"> </span><span class="n">res</span><span class="w"> </span><span class="n">is</span>
<span class="w">        </span><span class="nc">Ok</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">-&gt;</span>
<span class="w">            </span><span class="nc">Task</span><span class="o">.</span><span class="n">ok</span><span class="w"> </span><span class="n">x</span>
<span class="w">        </span><span class="nc">Err</span><span class="w"> </span><span class="n">e</span><span class="w"> </span><span class="o">-&gt;</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="n">attempts</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="n">then</span>
<span class="w">                </span><span class="nc">Task</span><span class="o">.</span><span class="n">err</span><span class="w"> </span><span class="n">e</span>
<span class="w">            </span><span class="k">else</span>
<span class="w">                </span><span class="n">withRetries</span><span class="w"> </span><span class="n">task</span><span class="w"> </span><span class="p">(</span><span class="n">attempts</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span>

<span class="n">storeEmail</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="nc">Path</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="nc">Task</span><span class="w"> </span><span class="nc">Str</span><span class="w"> </span><span class="bp">_</span>
<span class="n">storeEmail</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="err">\</span><span class="n">path</span><span class="w"> </span><span class="o">-&gt;</span>
<span class="w">    </span><span class="n">url</span><span class="w"> </span><span class="o">&lt;-</span>
<span class="w">        </span><span class="nc">File</span><span class="o">.</span><span class="n">readUtf8</span><span class="w"> </span><span class="n">path</span>
<span class="w">        </span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Task</span><span class="o">.</span><span class="n">mapErr</span><span class="w"> </span><span class="nc">FailedToReadUrl</span>
<span class="w">        </span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Task</span><span class="o">.</span><span class="n">await</span>
<span class="w">    </span><span class="n">loadUser</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">Http</span><span class="o">.</span><span class="n">get</span><span class="w"> </span><span class="n">url</span><span class="w"> </span><span class="nc">Json</span><span class="o">.</span><span class="n">codec</span>
<span class="w">    </span><span class="n">user</span><span class="w"> </span><span class="o">&lt;-</span>
<span class="w">        </span><span class="n">withRetries</span><span class="w"> </span><span class="n">loadUser</span><span class="w"> </span><span class="mi">3</span>
<span class="w">        </span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Task</span><span class="o">.</span><span class="n">mapErr</span><span class="w"> </span><span class="nc">FailedToLoadUser</span>
<span class="w">        </span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Task</span><span class="o">.</span><span class="n">await</span>

<span class="w">    </span><span class="n">dest</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"$(user.name).txt"</span>
<span class="w">    </span><span class="p">{}</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nc">File</span><span class="o">.</span><span class="n">writeUtf8</span><span class="w"> </span><span class="n">dest</span><span class="w"> </span><span class="n">user</span><span class="o">.</span><span class="n">email</span>
<span class="w">        </span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Task</span><span class="o">.</span><span class="n">mapErr</span><span class="w"> </span><span class="nc">FailedToStoreEmail</span>
<span class="w">        </span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Task</span><span class="o">.</span><span class="n">await</span>

<span class="w">    </span><span class="p">{}</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nc">Stdout</span><span class="o">.</span><span class="n">line</span><span class="w"> </span><span class="s2">"Wrote email to $(dest)"</span><span class="w"> </span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Task</span><span class="o">.</span><span class="n">await</span>
</code></pre></div>
</div></div>



<a name="432378432"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Understanding%20tasks/near/432378432" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> timotree <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Understanding.20tasks.html#432378432">(Apr 10 2024 at 02:02)</a>:</h4>
<p>This reminds me of the discussion of "<code>Ok</code>-wrapping" for Rust's <code>try {}</code> blocks feature. With <code>Ok</code>-wrapping, the final expression in a <code>try</code> block is automatically wrapped in <code>Ok()</code>. (And if it's omitted, then it defaults to <code>Ok(())</code>, the equivalent of Roc's <code>Task.ok {}</code>.) If Roc were to adopt some kind of <code>Task.ok</code>-wrapping, I think it would force a more consistent style where you always use <code>!</code> for trailing function calls.</p>



<a name="432379328"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Understanding%20tasks/near/432379328" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> timotree <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Understanding.20tasks.html#432379328">(Apr 10 2024 at 02:10)</a>:</h4>
<p>With ok-wrapping, Brendan's example might look like this</p>
<div class="codehilite" data-code-language="roc"><pre><span></span><code>withRetries : Task ok err, U64 -&gt; Task ok err
withRetries = \task, attempts -&gt;
    res = Task.toResult! task
    when res is
        Ok x -&gt; x
        Err e -&gt;
            if attempts == 0 then
                Task.err! e
            else
                withRetries! task (attempts - 1)
</code></pre></div>



<a name="432382079"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Understanding%20tasks/near/432382079" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Understanding.20tasks.html#432382079">(Apr 10 2024 at 02:28)</a>:</h4>
<p>Interesting. So it makes the <code>!</code> required on all paths even the error path.</p>



<a name="432382220"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Understanding%20tasks/near/432382220" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Understanding.20tasks.html#432382220">(Apr 10 2024 at 02:29)</a>:</h4>
<p>Ah, though it has <code>Ok x -&gt; x</code> as well. Cause <code>x</code> is of the ok result type and will be wrapped automatically.</p>



<a name="432385138"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Understanding%20tasks/near/432385138" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> timotree <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Understanding.20tasks.html#432385138">(Apr 10 2024 at 02:49)</a>:</h4>
<p>Exactly. And if <code>Task.err!</code> reads weirdly, you might create an alias like <code>throw!</code> or <code>bail!</code> to make it read more like an imperative command</p>



<a name="432444882"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Understanding%20tasks/near/432444882" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> witoldsz <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Understanding.20tasks.html#432444882">(Apr 10 2024 at 08:23)</a>:</h4>
<p><span class="user-mention silent" data-user-id="515757">Luke Boswell</span> <a href="#narrow/stream/231634-beginners/topic/Understanding.20tasks/near/431992827">said</a>:</p>
<blockquote>
<p>Thank you for sharing <span class="user-mention silent" data-user-id="678767">Noel R</span>. Have you seen the <a href="https://docs.google.com/document/d/1mTEZlOKqtMonmVsIGEC1A9ufs1TQHhVgZ52Vn-13GeU/edit?usp=drivesdk">Chaining Syntax design proposal</a>? You may find that interesting, and I would be keen to know what you think. </p>
</blockquote>
<p>This is so impressive! I'd like to add that F# has gone similar way, but with one distinct difference: the meaning of the <code>!</code> syntax (it is kind of similar to the new syntax design proposal above) can vary depending on the <a href="https://docs.microsoft.com/en-us/dotnet/fsharp/language-reference/computation-expressions">computation expressions</a> and there are some included in the standard library and also by 3rd parties.</p>
<p>Example:</p>
<div class="codehilite"><pre><span></span><code>let doThingsAsync url =
    async { // &lt;-------- this is the computation expression defining the meaning of ! within
        let! data = getDataAsync url
        do! sendDataAsync data
    }
</code></pre></div>
<p>So, the <code>!</code> is for chaining async tasks, but in other environment they do other things, basically it all revolves around chaining monads and/or applicatives. </p>
<p>I am not suggesting the Roc should have something similar, but F# is not very popular, but it has lots of interesting (i.e. inspiring) stuff, sometimes I can't help but feel obliged to share it to wider audience :)</p>
<blockquote>
<p>Computation expressions in F# provide a convenient syntax for writing computations that can be sequenced and combined using control flow constructs and bindings. Depending on the kind of computation expression, they can be thought of as a way to express monads, monoids, monad transformers, and applicative functors. However, unlike other languages (such as do-notation in Haskell), they are not tied to a single abstraction, and do not rely on macros or other forms of metaprogramming to accomplish a convenient and context-sensitive syntax.</p>
</blockquote>



<a name="432449806"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Understanding%20tasks/near/432449806" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Przemek Kitszel <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Understanding.20tasks.html#432449806">(Apr 10 2024 at 08:44)</a>:</h4>
<p>additional reason for allowing (and preferring) a trailing <code>!</code> is usage with git, when you add a new action as a new last, it's best when you don't touch previous line (think git blame).</p>
<p>sometimes it would be beneficial to remove the trailing <code>!</code>, which would mean 'no more code expected after this line'</p>
<p>Such convention works fine for C <code>enum</code>s, you always add a <code>,</code> at the end, but don't if it's something intended to be the last one (size/count/max).</p>



<a name="432517845"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Understanding%20tasks/near/432517845" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Understanding.20tasks.html#432517845">(Apr 10 2024 at 14:32)</a>:</h4>
<p><span class="user-mention" data-user-id="515922">@witoldsz</span> I think the original discussion and design was actually more similar to the F# version.</p>
<p>Something like</p>
<div class="codehilite"><pre><span></span><code>with Task.await
    Stdout.line!
    ...
</code></pre></div>
<p>I think in the end the preference leaned more towards it probably only being needed for a few types with Roc's current design (Task and Result for example). So it would be nicer to make it less noisy and just work. There was also discussion of making it just work with any <code>andThen</code> style function that is specified for a type. But that would only be added with significant demand due to the extra complexity.</p>
<p>For now it is just being added as special magic for Task.</p>



<a name="432526056"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Understanding%20tasks/near/432526056" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> witoldsz <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Understanding.20tasks.html#432526056">(Apr 10 2024 at 15:05)</a>:</h4>
<p>Yes, I do find it attractive that the current proposal focuses on <code>!</code> as a specialized construct just for <code>Task.await</code>, so the entry point is so low that pure-fp Roc stands up to an even fight with folks like Ruby or Python in scripting capabilities.</p>
<p>Now, I do notice the <code>with ...</code> syntax is more like computation expressions of F# but as far as I can see the Roc proposition is not as powerful, especially when it comes to applicatives. Applicatives are superb for example when you want to validate a form and do not want to stop on a single error, but continue with all checks and collect errors. In F# you can do it like this:</p>
<div class="codehilite"><pre><span></span><code>        validate {
            let! country = Check.optional (asString &gt;=&gt; isCountryCode) $&quot;{field}.country&quot; (decode json &quot;country&quot;)
            and! city = Check.optional (asString &gt;=&gt; Check.String.betweenLen 2 100) $&quot;{field}.city&quot; (decode json &quot;city&quot;)
            and! postCode = Check.optional (asString &gt;=&gt; isPostCode) $&quot;{field}.postCode&quot; (decode json &quot;postCode&quot;)

            and! streetAndNumber =
                Check.optional
                    (asString &gt;=&gt; Check.String.betweenLen 1 250)
                    $&quot;{field}.streetAndNumber&quot;
                    (decode json &quot;streetAndNumber&quot;)

            return
                { Country = country
                  City = city
                  PostCode = postCode
                  StreetAndNumber = streetAndNumber }
        }
</code></pre></div>
<p>Notice: <code>validate</code> CE comes from 3rd party library. The result is either a record or a collection of errors.</p>



<a name="432533637"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Understanding%20tasks/near/432533637" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Understanding.20tasks.html#432533637">(Apr 10 2024 at 15:41)</a>:</h4>
<p>That is very similar to our record builder syntax, which I think was built for this purpose. Recently there was an example of it in <a class="stream-topic" data-stream-id="304902" href="/#narrow/stream/304902-show-and-tell/topic/Weaver.3A.20record.20builder.20CLI.20parsing.20library">#show and tell &gt; Weaver: record builder CLI parsing library</a></p>



<a name="432546591"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Understanding%20tasks/near/432546591" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jasper Woudenberg <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Understanding.20tasks.html#432546591">(Apr 10 2024 at 16:50)</a>:</h4>
<p>Wait, clarifying question: is record builder syntax it's own thing, separate from backpassing?</p>



<a name="432548905"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Understanding%20tasks/near/432548905" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anton <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Understanding.20tasks.html#432548905">(Apr 10 2024 at 17:02)</a>:</h4>
<p>Yes</p>



<a name="432972488"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Understanding%20tasks/near/432972488" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Understanding.20tasks.html#432972488">(Apr 12 2024 at 19:54)</a>:</h4>
<p><span class="user-mention" data-user-id="477725">@Jasper Woudenberg</span> we ended up changing the syntax slightly, but here is the original design doc: <a href="https://docs.google.com/document/d/1Jo9nZCekkoF6SaDcRqPqoPcgPaAAvlNZC7v3kgVQ3Tc/edit?usp=sharing">https://docs.google.com/document/d/1Jo9nZCekkoF6SaDcRqPqoPcgPaAAvlNZC7v3kgVQ3Tc/edit?usp=sharing</a></p>



<a name="443303039"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Understanding%20tasks/near/443303039" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Vinicius Ataide <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Understanding.20tasks.html#443303039">(Jun 07 2024 at 13:53)</a>:</h4>
<p>I'm really excited to see the new language constructs introduced in the latests version. looks like there's no pushback operator anymore for Task.await right</p>



<a name="443304522"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Understanding%20tasks/near/443304522" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anton <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Understanding.20tasks.html#443304522">(Jun 07 2024 at 14:00)</a>:</h4>
<p>I think you mean the "backpassing" (<code>&lt;-</code>) operator?<br>
It's still there but we would like to remove it in the future</p>



<hr><p>Last updated: Nov 01 2025 at 12:13 UTC</p>
</html>