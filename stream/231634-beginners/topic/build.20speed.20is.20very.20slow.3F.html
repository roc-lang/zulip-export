<html>
<head><meta charset="utf-8"><title>build speed is very slow? · beginners · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/index.html">beginners</a></h2>
<h3>Topic: <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/build.20speed.20is.20very.20slow.3F.html">build speed is very slow?</a></h3>

<hr>

<base href="https://roc.zulipchat.com">

<head><link href="https://roc-lang.github.io/zulip-export/style.css" rel="stylesheet"></head>

<a name="318911985"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/build%20speed%20is%20very%20slow%3F/near/318911985" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jared <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/build.20speed.20is.20very.20slow.3F.html#318911985">(Jan 01 2023 at 22:29)</a>:</h4>
<p>I thought I'd use roc for some january generative art hacking, but the hello world compile time is looking like it'll be prohibitive. I'm seeing ~4 seconds to run <code>roc dev</code>, with nothing more than the basic "I'm a roc application" cli file from the tutorial. Is this expected? Do I have something wrong with my setup?</p>



<a name="318914583"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/build%20speed%20is%20very%20slow%3F/near/318914583" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Carroll <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/build.20speed.20is.20very.20slow.3F.html#318914583">(Jan 01 2023 at 23:09)</a>:</h4>
<p>No, that doesn't sound normal at all. The compiler is so fast that sometimes I double check to see if it's showing me cached data, but it's not. Can you say more about your setup? Like is it a release or development build of the compiler itself?</p>



<a name="318985810"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/build%20speed%20is%20very%20slow%3F/near/318985810" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jared <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/build.20speed.20is.20very.20slow.3F.html#318985810">(Jan 02 2023 at 12:45)</a>:</h4>
<p><span class="user-mention" data-user-id="431893">@Brian Carroll</span> </p>
<div class="codehilite"><pre><span></span><code>genuary on  main ➜ ./roc version
roc nightly pre-release, built from commit faaa466 on Sat Dec 17 09:07:43 UTC 2022
</code></pre></div>
<p>are the nightlies a dev build or something?</p>



<a name="318986360"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/build%20speed%20is%20very%20slow%3F/near/318986360" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jared <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/build.20speed.20is.20very.20slow.3F.html#318986360">(Jan 02 2023 at 12:49)</a>:</h4>
<div class="codehilite"><pre><span></span><code>    Code Generation
           53.487 ms   Generate Assembly from Mono IR

Finished compilation and code gen in 87 ms

Produced a app.o file of size 4744

Finished linking in 3674 ms
</code></pre></div>
<p>wow lol what's up with linking</p>



<a name="318986480"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/build%20speed%20is%20very%20slow%3F/near/318986480" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jared <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/build.20speed.20is.20very.20slow.3F.html#318986480">(Jan 02 2023 at 12:49)</a>:</h4>
<p>I'm on an intel MBP monterey fwiw</p>



<a name="318986772"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/build%20speed%20is%20very%20slow%3F/near/318986772" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Carroll <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/build.20speed.20is.20very.20slow.3F.html#318986772">(Jan 02 2023 at 12:51)</a>:</h4>
<p><span class="user-mention silent" data-user-id="404111">Jared</span> <a href="#narrow/stream/231634-beginners/topic/build.20speed.20is.20very.20slow.3F/near/318985810">said</a>:</p>
<blockquote>
<p><span class="user-mention silent" data-user-id="431893">Brian Carroll</span> </p>
<div class="codehilite"><pre><span></span><code>genuary on  main ➜ ./roc version
roc nightly pre-release, built from commit faaa466 on Sat Dec 17 09:07:43 UTC 2022
</code></pre></div>
<p>are the nightlies a dev build or something?</p>
</blockquote>
<p>Nope! They're release builds.</p>



<a name="318987028"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/build%20speed%20is%20very%20slow%3F/near/318987028" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Carroll <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/build.20speed.20is.20very.20slow.3F.html#318987028">(Jan 02 2023 at 12:53)</a>:</h4>
<p>Wow that link time is crazy. I'm not the best person to investigate but I'm sure someone will. Thanks for bringing it up!</p>



<a name="318990282"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/build%20speed%20is%20very%20slow%3F/near/318990282" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Named-entity <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/build.20speed.20is.20very.20slow.3F.html#318990282">(Jan 02 2023 at 13:15)</a>:</h4>
<p>For what it's worth linking is a bottleneck for some of the other languages that I explore.</p>



<a name="318990813"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/build%20speed%20is%20very%20slow%3F/near/318990813" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Carroll <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/build.20speed.20is.20very.20slow.3F.html#318990813">(Jan 02 2023 at 13:18)</a>:</h4>
<p>Yes, that's true for us too, but this still seems well outside the normal range.</p>



<a name="319020866"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/build%20speed%20is%20very%20slow%3F/near/319020866" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/build.20speed.20is.20very.20slow.3F.html#319020866">(Jan 02 2023 at 16:14)</a>:</h4>
<p><del>Can you share a gist of the exact code you are running?</del> I can take a look. Though there is a chance I won't be able to repro if it depends on running on an Intel Mac.</p>



<a name="319033978"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/build%20speed%20is%20very%20slow%3F/near/319033978" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/build.20speed.20is.20very.20slow.3F.html#319033978">(Jan 02 2023 at 17:57)</a>:</h4>
<p>Actually, I think I was able to repro. Though not to the same extent. On an M1 mac. linking takes about 1.6 seconds. Which is still super slow for a hello world app</p>



<a name="319079679"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/build%20speed%20is%20very%20slow%3F/near/319079679" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/build.20speed.20is.20very.20slow.3F.html#319079679">(Jan 02 2023 at 18:31)</a>:</h4>
<p>Ok. So I think I know the root cause, but I am not sure how we will want to go about fixing it.</p>
<p>For <code>ld</code> almost all of the time is spent in writing the output file: <code>write output:    1.3 seconds (  82.8%)</code><br>
This is because the output file is about 32 megabytes.</p>
<p>The reason for this is 2 fold:</p>
<ol>
<li>we add the reqwest library to the cli platform (this pulls in a ton of dependencies like tokio).</li>
<li>when rust generates a <code>staticlib</code>, it seems to link everything even if it isn't used (I have not figured out a way to stop this).</li>
</ol>
<p>As such, the staticlib is about 32 megabytes. On the other hand, when directly linking an executable and cleaning up dead code, the total size is about 0.5 megabytes.</p>



<a name="319079995"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/build%20speed%20is%20very%20slow%3F/near/319079995" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/build.20speed.20is.20very.20slow.3F.html#319079995">(Jan 02 2023 at 18:34)</a>:</h4>
<p>Possible fixes:</p>
<ul>
<li>remove http requests from the cli platform or hide them behind a feature flag.</li>
<li>find some lightweight alternative library to reqwest (maybe ureq?).</li>
<li>get surgical linking working on macos so that dead code elimination works correctly.</li>
<li>figure out why rust <code>staticlib</code> seems to link in everything/how to fix that.</li>
</ul>



<a name="319081341"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/build%20speed%20is%20very%20slow%3F/near/319081341" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/build.20speed.20is.20very.20slow.3F.html#319081341">(Jan 02 2023 at 18:47)</a>:</h4>
<p>I think switching to from <code>reqwest</code> to <code>ureq</code> will be the easiest short term solution.</p>



<a name="319081409"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/build%20speed%20is%20very%20slow%3F/near/319081409" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/build.20speed.20is.20very.20slow.3F.html#319081409">(Jan 02 2023 at 18:48)</a>:</h4>
<p>though it only cuts from ~30MB to ~20MB...so not a big win actually....</p>



<a name="319081411"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/build%20speed%20is%20very%20slow%3F/near/319081411" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/build.20speed.20is.20very.20slow.3F.html#319081411">(Jan 02 2023 at 18:48)</a>:</h4>
<p>hmmm</p>



<a name="319081590"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/build%20speed%20is%20very%20slow%3F/near/319081590" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/build.20speed.20is.20very.20slow.3F.html#319081590">(Jan 02 2023 at 18:50)</a>:</h4>
<p>Oh, though it cuts link time from 1.6s to 0.6s for me. So that is a solid win.</p>



<a name="319086173"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/build%20speed%20is%20very%20slow%3F/near/319086173" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/build.20speed.20is.20very.20slow.3F.html#319086173">(Jan 02 2023 at 19:35)</a>:</h4>
<p>how long is the link time on Linux with the surgical linker?</p>



<a name="319087858"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/build%20speed%20is%20very%20slow%3F/near/319087858" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/build.20speed.20is.20very.20slow.3F.html#319087858">(Jan 02 2023 at 19:52)</a>:</h4>
<p>~0ms</p>



<a name="319088010"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/build%20speed%20is%20very%20slow%3F/near/319088010" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/build.20speed.20is.20very.20slow.3F.html#319088010">(Jan 02 2023 at 19:53)</a>:</h4>
<p><del>That or the the timing is broken for the surgical linker.</del> The timing seems to a be accurate, but I am not 100% convinced that includes dumping to file. That said, the entire process runs in ~200ms while compilation takes ~190ms. The last ~10ms would include loading the roc application itself and maybe dumping to file.</p>



<a name="319088530"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/build%20speed%20is%20very%20slow%3F/near/319088530" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/build.20speed.20is.20very.20slow.3F.html#319088530">(Jan 02 2023 at 19:58)</a>:</h4>
<p>Yeah, on my Linux machine, the legacy linker takes ~4s. So that matches the slow macos timing pretty well. It is linking ~35MB. The surgical linker only has to link ~7MB. Though obviously is faster for other reasons as well.</p>



<a name="319103175"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/build%20speed%20is%20very%20slow%3F/near/319103175" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/build.20speed.20is.20very.20slow.3F.html#319103175">(Jan 02 2023 at 22:48)</a>:</h4>
<p>nice! So presumably surgical linking the fix we really want on macOS <span aria-label="big smile" class="emoji emoji-1f604" role="img" title="big smile">:big_smile:</span></p>



<a name="319105172"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/build%20speed%20is%20very%20slow%3F/near/319105172" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/build.20speed.20is.20very.20slow.3F.html#319105172">(Jan 02 2023 at 23:15)</a>:</h4>
<p>Yep</p>



<a name="319120947"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/build%20speed%20is%20very%20slow%3F/near/319120947" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jared <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/build.20speed.20is.20very.20slow.3F.html#319120947">(Jan 03 2023 at 03:06)</a>:</h4>
<p>how far off is surgical for mac?</p>



<a name="319127123"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/build%20speed%20is%20very%20slow%3F/near/319127123" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/build.20speed.20is.20very.20slow.3F.html#319127123">(Jan 03 2023 at 04:44)</a>:</h4>
<p>That's a hard question to answer. Theoretically the code is pretty close, but:</p>
<ol>
<li>No one is actively working on it</li>
<li>Connecting the final pieces and getting things working in practice can be a ton of time and debugging</li>
<li>Documentation for macos linking is sparse and we could be missing some complicated piece or minor detail that makes everything a lot more painful to finish</li>
</ol>



<hr><p>Last updated: Nov 01 2025 at 12:13 UTC</p>
</html>