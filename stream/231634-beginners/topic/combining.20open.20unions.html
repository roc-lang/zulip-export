<html>
<head><meta charset="utf-8"><title>combining open unions · beginners · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/index.html">beginners</a></h2>
<h3>Topic: <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/combining.20open.20unions.html">combining open unions</a></h3>

<hr>

<base href="https://roc.zulipchat.com">

<head><link href="https://roc-lang.github.io/zulip-export/style.css" rel="stylesheet"></head>

<a name="434275242"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/combining%20open%20unions/near/434275242" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jens Petersen <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/combining.20open.20unions.html#434275242">(Apr 19 2024 at 03:32)</a>:</h4>
<p>I don't really understand the table in <a href="https://www.roc-lang.org/tutorial#combining-open-unions">https://www.roc-lang.org/tutorial#combining-open-unions</a><br>
or maybe it is just a wording issue perhaps, or I am really not understanding</p>
<p>Surely <code>[Ok Str]*</code> can also include <code>Other field</code>, which would be rejected by <code>[Ok Str] -&gt; Bool</code>, no?<br>
I <em>think</em> the second column means "can receive" <code>Ok Str</code> (eg <code>Ok "hi"</code>) from an <code>[Ok Str]*</code> perhaps?</p>



<a name="434283131"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/combining%20open%20unions/near/434283131" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/combining.20open.20unions.html#434283131">(Apr 19 2024 at 04:59)</a>:</h4>
<p>I think the confusion here is about what open means. Opens means that it can be merged with something else. So, if a function returns <code>[Ok Str]*</code>, it would never be <code>Other field</code>. It could merge with something that generates <code>Other field</code>, but it couldn't possibly be returned from the original function with the return type of <code>[Ok Str]*</code>.</p>



<a name="434283265"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/combining%20open%20unions/near/434283265" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/combining.20open.20unions.html#434283265">(Apr 19 2024 at 05:00)</a>:</h4>
<p><code>*</code> in general is a bit confusing. It is so unconstrained that it can't contain any useful information.</p>



<a name="434283464"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/combining%20open%20unions/near/434283464" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/combining.20open.20unions.html#434283464">(Apr 19 2024 at 05:01)</a>:</h4>
<p><code>[Ok Str]a</code> is a different story that probably works how you currently think <code>[Ok Str]*</code> works.</p>



<a name="434289226"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/combining%20open%20unions/near/434289226" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/combining.20open.20unions.html#434289226">(Apr 19 2024 at 05:50)</a>:</h4>
<p>Also, I think there is a bug currently. Tag unions are meant to be open by default in the return position. Sometimes I have to add an underscore to make this work correctly, so I'll write it out like this <code>thing: Task {} [Tag1, Tag2]_</code></p>



<a name="434475271"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/combining%20open%20unions/near/434475271" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jens Petersen <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/combining.20open.20unions.html#434475271">(Apr 20 2024 at 06:25)</a>:</h4>
<p>But it is not in the return position in the examples: it is being received, that is my point</p>



<a name="434509279"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/combining%20open%20unions/near/434509279" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/combining.20open.20unions.html#434509279">(Apr 20 2024 at 15:17)</a>:</h4>
<p>Yeah, this is not related to returned tags being open</p>



<a name="434509448"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/combining%20open%20unions/near/434509448" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/combining.20open.20unions.html#434509448">(Apr 20 2024 at 15:19)</a>:</h4>
<p>Let me try to write out some examples to explain better.</p>



<a name="434511236"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/combining%20open%20unions/near/434511236" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/combining.20open.20unions.html#434511236">(Apr 20 2024 at 15:35)</a>:</h4>
<p>Hopefully a decent explanation of why <code>[Ok Str]*</code> can be passed to <code>[Ok Str] -&gt; Bool</code></p>
<div class="spoiler-block"><div class="spoiler-header">
</div><div class="spoiler-content" aria-hidden="true">
<div class="codehilite" data-code-language="Elixir"><pre><span></span><code><span class="n">interface</span><span class="w"> </span><span class="nc">Test</span>
<span class="w">    </span><span class="n">exposes</span><span class="w"> </span><span class="p">[]</span>
<span class="w">    </span><span class="n">imports</span><span class="w"> </span><span class="p">[]</span>

<span class="c1"># Note: all returned tags are open, so this is the same</span>
<span class="c1"># generateOpenOkStr : Str -&gt; [Ok Str]</span>
<span class="n">generateOpenOkStr</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="nc">Str</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="p">[</span><span class="nc">Ok</span><span class="w"> </span><span class="nc">Str</span><span class="p">]</span><span class="o">*</span>
<span class="n">generateOpenOkStr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="err">\</span><span class="n">s</span><span class="w"> </span><span class="o">-&gt;</span>
<span class="w">    </span><span class="c1"># Really super imporant note in this first function.</span>
<span class="w">    </span><span class="c1"># I can not return `Other` here.</span>
<span class="w">    </span><span class="c1"># I have to return `Ok` with a `Str` in it.</span>
<span class="w">    </span><span class="c1"># That is the only data the matches `[Ok Str]*` as an output</span>
<span class="w">    </span><span class="nc">Ok</span><span class="w"> </span><span class="n">s</span>


<span class="n">usesAsOpen</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="nc">Ok</span><span class="w"> </span><span class="nc">Str</span><span class="p">]</span><span class="o">*</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="nc">Bool</span>
<span class="n">usesAsOpen</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="err">\</span><span class="n">union</span><span class="w"> </span><span class="o">-&gt;</span>
<span class="w">    </span><span class="c1"># A user can pass any tag into this.</span>
<span class="w">    </span><span class="c1"># The tag is just guaranteed to have `Ok Str` as an option</span>
<span class="w">    </span><span class="ow">when</span><span class="w"> </span><span class="n">union</span><span class="w"> </span><span class="n">is</span>
<span class="w">        </span><span class="nc">Ok</span><span class="w"> </span><span class="n">s</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="o">!</span><span class="p">(</span><span class="nc">Str</span><span class="o">.</span><span class="n">isEmpty</span><span class="w"> </span><span class="n">s</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="nc">Bool</span><span class="o">.</span><span class="no">true</span>
<span class="w">        </span><span class="nc">Ok</span><span class="w"> </span><span class="bp">_</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="nc">Bool</span><span class="o">.</span><span class="no">false</span>
<span class="w">        </span><span class="c1"># `_ -&gt;` is required to deal with everything else</span>
<span class="w">        </span><span class="bp">_</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="nc">Bool</span><span class="o">.</span><span class="no">false</span>

<span class="n">expect</span>
<span class="w">    </span><span class="ow">in</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">generateOpenOkStr</span><span class="w"> </span><span class="s2">""</span>
<span class="w">    </span><span class="n">out</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">usesAsOpen</span><span class="w"> </span><span class="ow">in</span>
<span class="w">    </span><span class="n">out</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nc">Bool</span><span class="o">.</span><span class="no">false</span>

<span class="n">expect</span>
<span class="w">    </span><span class="ow">in</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">generateOpenOkStr</span><span class="w"> </span><span class="s2">"123"</span>
<span class="w">    </span><span class="n">out</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">usesAsOpen</span><span class="w"> </span><span class="ow">in</span>
<span class="w">    </span><span class="n">out</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nc">Bool</span><span class="o">.</span><span class="no">true</span>


<span class="n">restrictsToClosed</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="nc">Ok</span><span class="w"> </span><span class="nc">Str</span><span class="p">]</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="nc">Bool</span>
<span class="n">restrictsToClosed</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="err">\</span><span class="n">union</span><span class="w"> </span><span class="o">-&gt;</span>
<span class="w">    </span><span class="c1"># The only tag possible here is `Ok Str`</span>
<span class="w">    </span><span class="c1"># Nothing else</span>

<span class="w">    </span><span class="c1"># Since there is only one option, we can directly pattern match</span>
<span class="w">    </span><span class="nc">Ok</span><span class="w"> </span><span class="n">s</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">union</span>

<span class="w">    </span><span class="o">!</span><span class="p">(</span><span class="nc">Str</span><span class="o">.</span><span class="n">isEmpty</span><span class="w"> </span><span class="n">s</span><span class="p">)</span>

<span class="c1"># In both of these, `[Ok Str]*` is safe to restrict to `[Ok Str]`.</span>
<span class="c1"># So everything works fine.</span>
<span class="n">expect</span>
<span class="w">    </span><span class="ow">in</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">generateOpenOkStr</span><span class="w"> </span><span class="s2">""</span>
<span class="w">    </span><span class="n">out</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">restrictsToClosed</span><span class="w"> </span><span class="ow">in</span>
<span class="w">    </span><span class="n">out</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nc">Bool</span><span class="o">.</span><span class="no">false</span>

<span class="n">expect</span>
<span class="w">    </span><span class="ow">in</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">generateOpenOkStr</span><span class="w"> </span><span class="s2">"123"</span>
<span class="w">    </span><span class="n">out</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">restrictsToClosed</span><span class="w"> </span><span class="ow">in</span>
<span class="w">    </span><span class="n">out</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nc">Bool</span><span class="o">.</span><span class="no">true</span>


<span class="c1"># Where the closed version fails, but the open version is fine.</span>
<span class="n">expect</span>
<span class="w">    </span><span class="c1"># `in` will expand the type from `[Ok Str]*` to `[Ok Str, Other]*` due to merging branches.</span>
<span class="w">    </span><span class="ow">in</span><span class="w"> </span><span class="o">=</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="nc">Bool</span><span class="o">.</span><span class="no">true</span><span class="w"> </span><span class="n">then</span>
<span class="w">            </span><span class="n">generateOpenOkStr</span><span class="w"> </span><span class="s2">""</span>
<span class="w">        </span><span class="k">else</span>
<span class="w">            </span><span class="nc">Other</span>

<span class="w">    </span><span class="c1"># Not possible, will type mismatch</span>
<span class="w">    </span><span class="c1"># out = restrictsToClosed in</span>

<span class="w">    </span><span class="n">out</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">usesAsOpen</span><span class="w"> </span><span class="ow">in</span>

<span class="w">    </span><span class="n">out</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nc">Bool</span><span class="o">.</span><span class="no">false</span>
</code></pre></div>
</div></div>



<a name="434518329"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/combining%20open%20unions/near/434518329" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> timotree <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/combining.20open.20unions.html#434518329">(Apr 20 2024 at 17:06)</a>:</h4>
<p>I think Jens has a point here. <code>[Ok Str]*</code> can't always be passed to <code>[Ok Str] -&gt; Bool</code>. In particular, if the value of type <code>[Ok Str]*</code> is a function argument, then it really could contain <code>Other x</code>. Example:</p>
<div class="codehilite" data-code-language="CoffeeScript"><pre><span></span><code><span class="nv">acceptsClosed</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="nx">Ok</span><span class="w"> </span><span class="nx">Str</span><span class="p">]</span><span class="w"> </span><span class="nf">-&gt;</span><span class="w"> </span><span class="p">{}</span>
<span class="nv">acceptsClosed</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="err">\</span><span class="nx">_</span><span class="w"> </span><span class="nf">-&gt;</span><span class="w"> </span><span class="p">{}</span>

<span class="nv">acceptsOpen</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="nx">Ok</span><span class="w"> </span><span class="nx">Str</span><span class="p">]</span><span class="o">*</span><span class="w"> </span><span class="nf">-&gt;</span><span class="w"> </span><span class="p">{}</span>
<span class="nv">acceptsOpen</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="err">\</span><span class="nx">openParameter</span><span class="w"> </span><span class="nf">-&gt;</span>
<span class="w">    </span><span class="nx">acceptsClosed</span><span class="w"> </span><span class="nx">openParameter</span><span class="w"> </span><span class="c1"># ERROR (mismatch between [...]* and [...])</span>

<span class="nv">returnsOpen</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="p">{}</span><span class="w"> </span><span class="nf">-&gt;</span><span class="w"> </span><span class="p">[</span><span class="nx">Ok</span><span class="w"> </span><span class="nx">Str</span><span class="p">]</span><span class="o">*</span>
<span class="nv">returnsOpen</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="err">\</span><span class="p">{}</span><span class="w"> </span><span class="nf">-&gt;</span><span class="w"> </span><span class="nx">Ok</span><span class="w"> </span><span class="s">"foo"</span>

<span class="nv">passesOpen</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="p">{}</span><span class="w"> </span><span class="nf">-&gt;</span><span class="w"> </span><span class="p">{}</span>
<span class="nv">passesOpen</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="err">\</span><span class="p">{}</span><span class="w"> </span><span class="nf">-&gt;</span>
<span class="w">    </span><span class="nv">openLocalVariable</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">returnsOpen</span><span class="w"> </span><span class="p">{}</span>
<span class="w">    </span><span class="nx">acceptsClosed</span><span class="w"> </span><span class="nx">openLocalVariable</span><span class="w"> </span><span class="c1"># no error...</span>
</code></pre></div>



<a name="434519823"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/combining%20open%20unions/near/434519823" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> timotree <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/combining.20open.20unions.html#434519823">(Apr 20 2024 at 17:27)</a>:</h4>
<p>In fact, if I add a type annotation <code>openLocalVariable : [Ok Str]*</code>, then both examples error</p>
<div class="codehilite" data-code-language="CoffeeScript"><pre><span></span><code><span class="nv">passesOpenAnnotated</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="p">{}</span><span class="w"> </span><span class="nf">-&gt;</span><span class="w"> </span><span class="p">{}</span>
<span class="nv">passesOpenAnnotated</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="err">\</span><span class="p">{}</span><span class="w"> </span><span class="nf">-&gt;</span>
<span class="w">    </span><span class="nv">openLocalVariable</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="nx">Ok</span><span class="w"> </span><span class="nx">Str</span><span class="p">]</span><span class="o">*</span>
<span class="w">    </span><span class="nv">openLocalVariable</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">returnsOpen</span><span class="w"> </span><span class="p">{}</span>
<span class="w">    </span><span class="nx">acceptsClosed</span><span class="w"> </span><span class="nx">openLocalVariable</span><span class="w"> </span><span class="c1"># ERROR (mismatch between [...]* and [...])</span>
</code></pre></div>



<a name="434520014"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/combining%20open%20unions/near/434520014" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> timotree <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/combining.20open.20unions.html#434520014">(Apr 20 2024 at 17:30)</a>:</h4>
<p>I think it might be helpful to distinguish between <code>[Ok Str]*</code> and <code>[Ok Str]_</code> here. If I write <code>openLocalVariable : [Ok Str]_</code> then there's no error, because <code>_</code> can be chosen to be <code>[]</code>, and <code>[Ok Str][]</code> is <code>[Ok Str]</code>, which makes the whole thing type correct.</p>



<a name="434520080"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/combining%20open%20unions/near/434520080" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> timotree <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/combining.20open.20unions.html#434520080">(Apr 20 2024 at 17:31)</a>:</h4>
<p>It would be an accurate statement to say "If I have a local of type <code>[Ok Str]_</code>, it can be passed to a function of type <code>[Ok Str] -&gt; Bool</code>" But I don't think the original statement is accurate</p>



<a name="434520339"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/combining%20open%20unions/near/434520339" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> timotree <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/combining.20open.20unions.html#434520339">(Apr 20 2024 at 17:35)</a>:</h4>
<p>It seems that in general in Roc, when you're defining a top-level function, <code>*</code> represents a placeholder instantiated by each of your callers, whereas <code>_</code> represents a placeholder which you get to instantiate.</p>



<a name="434521128"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/combining%20open%20unions/near/434521128" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/combining.20open.20unions.html#434521128">(Apr 20 2024 at 17:47)</a>:</h4>
<blockquote>
<p>In fact, if I add a type annotation <code>openLocalVariable : [Ok Str]*</code>, then both examples error</p>
</blockquote>
<p>Yeah, I'm not sure if that is a bug or not. It definitely is confusing. Realized that early and started <a class="stream-topic" data-stream-id="395097" href="/#narrow/stream/395097-compiler-development/topic/Is.20this.20a.20bug.3F">#compiler development &gt; Is this a bug?</a>.</p>
<blockquote>
<p>"If I have a local of type <code>[Ok Str]_</code>, it can be passed to a function of type <code>[Ok Str] -&gt; Bool</code>"</p>
</blockquote>
<p>Need to add a caveat that the <code>_</code> needs to not merge with anything else for that to work.</p>
<p>Eg</p>
<div class="codehilite" data-code-language="Elixir"><pre><span></span><code><span class="n">generateOpenOkStr</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="nc">Str</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="p">[</span><span class="nc">Ok</span><span class="w"> </span><span class="nc">Str</span><span class="p">]</span><span class="o">*</span>
<span class="n">generateOpenOkStr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="err">\</span><span class="n">s</span><span class="w"> </span><span class="o">-&gt;</span>
<span class="w">    </span><span class="nc">Ok</span><span class="w"> </span><span class="n">s</span>

<span class="n">restrictsToClosed</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="nc">Ok</span><span class="w"> </span><span class="nc">Str</span><span class="p">]</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="nc">Bool</span>
<span class="n">restrictsToClosed</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="err">\</span><span class="nc">Ok</span><span class="w"> </span><span class="n">s</span><span class="o">-&gt;</span>
<span class="w">    </span><span class="o">!</span><span class="p">(</span><span class="nc">Str</span><span class="o">.</span><span class="n">isEmpty</span><span class="w"> </span><span class="n">s</span><span class="p">)</span>

<span class="n">restrictsToDifferentClosed</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="nc">Ok</span><span class="w"> </span><span class="nc">Str</span><span class="p">,</span><span class="w"> </span><span class="nc">Other</span><span class="p">]</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="nc">Bool</span>
<span class="n">restrictsToDifferentClosed</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="err">\</span><span class="n">union</span><span class="o">-&gt;</span>
<span class="w">    </span><span class="ow">when</span><span class="w"> </span><span class="n">union</span><span class="w"> </span><span class="n">is</span>
<span class="w">        </span><span class="nc">Ok</span><span class="w"> </span><span class="n">s</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="o">!</span><span class="p">(</span><span class="nc">Str</span><span class="o">.</span><span class="n">isEmpty</span><span class="w"> </span><span class="n">s</span><span class="p">)</span>
<span class="w">        </span><span class="nc">Other</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="nc">Bool</span><span class="o">.</span><span class="no">false</span>

<span class="n">expect</span>
<span class="w">    </span><span class="ow">in</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="nc">Ok</span><span class="w"> </span><span class="nc">Str</span><span class="p">]</span><span class="bp">_</span>
<span class="w">    </span><span class="ow">in</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">generateOpenOkStr</span><span class="w"> </span><span class="s2">""</span>
<span class="w">    </span><span class="n">out0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">restrictsToDifferentClosed</span><span class="w"> </span><span class="ow">in</span>
<span class="w">    </span><span class="n">out1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">restrictsToClosed</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="c1"># Type error: `[Other, …]` vs `[…]`</span>
<span class="w">    </span><span class="n">out0</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">out1</span>
</code></pre></div>



<hr><p>Last updated: Nov 01 2025 at 12:13 UTC</p>
</html>