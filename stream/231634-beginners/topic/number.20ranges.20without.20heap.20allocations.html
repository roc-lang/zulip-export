<html>
<head><meta charset="utf-8"><title>number ranges without heap allocations · beginners · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/index.html">beginners</a></h2>
<h3>Topic: <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/number.20ranges.20without.20heap.20allocations.html">number ranges without heap allocations</a></h3>

<hr>

<base href="https://roc.zulipchat.com">

<head><link href="https://roc-lang.github.io/zulip-export/style.css" rel="stylesheet"></head>

<a name="465252871"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/number%20ranges%20without%20heap%20allocations/near/465252871" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alexander Pyattaev <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/number.20ranges.20without.20heap.20allocations.html#465252871">(Aug 26 2024 at 18:46)</a>:</h4>
<p>Can someone explain a way to make a generator for a long array of numbers that would just, well, make numbers? List.range is no good as it seems to allocate the actual list (even if I will only ever walk the thing)</p>



<a name="465253263"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/number%20ranges%20without%20heap%20allocations/near/465253263" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/number.20ranges.20without.20heap.20allocations.html#465253263">(Aug 26 2024 at 18:48)</a>:</h4>
<p>This may be helpful <a href="https://github.com/lukewilliamboswell/roc-random">https://github.com/lukewilliamboswell/roc-random</a></p>



<a name="465253717"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/number%20ranges%20without%20heap%20allocations/near/465253717" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alexander Pyattaev <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/number.20ranges.20without.20heap.20allocations.html#465253717">(Aug 26 2024 at 18:51)</a>:</h4>
<p><span class="user-mention silent" data-user-id="515757">Luke Boswell</span> <a href="#narrow/stream/231634-beginners/topic/Processing.20output.20in.20a.20CLI.20tool/near/465253263">said</a>:</p>
<blockquote>
<p>This may be helpful <a href="https://github.com/lukewilliamboswell/roc-random">https://github.com/lukewilliamboswell/roc-random</a></p>
</blockquote>
<p>which part of it? it still uses List.range to make the numbers, so it will OOM if I want to loop over 10 billion numbers</p>



<a name="465255299"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/number%20ranges%20without%20heap%20allocations/near/465255299" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/number.20ranges.20without.20heap.20allocations.html#465255299">(Aug 26 2024 at 19:02)</a>:</h4>
<p>If you want to loop over 10 billion numbers in a functional language, you'll want to write a recursive function that is <a href="https://stackoverflow.com/questions/310974/what-is-tail-call-optimization">tail call optimized</a> into a "while loop" at runtime.</p>



<a name="465255542"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/number%20ranges%20without%20heap%20allocations/near/465255542" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alexander Pyattaev <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/number.20ranges.20without.20heap.20allocations.html#465255542">(Aug 26 2024 at 19:04)</a>:</h4>
<p>Well I do not want 10billion, I just want 1 billion, and I get a segfault with this...</p>
<div class="codehilite"><pre><span></span><code>app [main] { pf: platform &quot;https://github.com/roc-lang/basic-cli/releases/download/0.14.0/dC5ceT962N_4jmoyoffVdphJ_4GlW3YMhAPyGPr-nU0.tar.br&quot; }

import pf.Stdout
import pf.Task

loop = \i, max -&gt;
    if i &lt; max then
        i + loop (i + 1) max
    else
        i

main =
    x = 1000 * 1000 * 1000
    z = loop 0 x
    # z = List.range {start: At 0, end: Before x} |&gt; List.walk 0 Num.add
    Stdout.line! &quot;Hello, World! $(Num.toStr z)&quot;
</code></pre></div>



<a name="465255675"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/number%20ranges%20without%20heap%20allocations/near/465255675" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alexander Pyattaev <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/number.20ranges.20without.20heap.20allocations.html#465255675">(Aug 26 2024 at 19:05)</a>:</h4>
<p>and yes, I am fully aware that this not what roc was designed to do, but I think it is still relevant for the language that aims at high performance to not allocate arrays on the heap that will be insta-discarded after 1 use. even python is not that wasteful =)</p>



<a name="465255723"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/number%20ranges%20without%20heap%20allocations/near/465255723" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alexander Pyattaev <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/number.20ranges.20without.20heap.20allocations.html#465255723">(Aug 26 2024 at 19:06)</a>:</h4>
<p>Of course, not segfaulting would be nice too =)I'll go file a bug.</p>



<a name="465255763"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/number%20ranges%20without%20heap%20allocations/near/465255763" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/number.20ranges.20without.20heap.20allocations.html#465255763">(Aug 26 2024 at 19:06)</a>:</h4>
<p>Well, that's not gonna be tail-call optimized, since the looping happens in the middle of the function</p>



<a name="465255842"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/number%20ranges%20without%20heap%20allocations/near/465255842" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alexander Pyattaev <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/number.20ranges.20without.20heap.20allocations.html#465255842">(Aug 26 2024 at 19:06)</a>:</h4>
<p><span class="user-mention silent" data-user-id="461444">Sam Mohr</span> <a href="#narrow/stream/231634-beginners/topic/Processing.20output.20in.20a.20CLI.20tool/near/465255763">said</a>:</p>
<blockquote>
<p>Well, that's not gonna be tail-call optimized, since the looping happens in the middle of the function</p>
</blockquote>
<p>em? it is for all practical purposes... how else should I write it?</p>



<a name="465256060"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/number%20ranges%20without%20heap%20allocations/near/465256060" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/number.20ranges.20without.20heap.20allocations.html#465256060">(Aug 26 2024 at 19:08)</a>:</h4>
<p>It isn't a tail call cause addition has to happen after the next loop call returns.</p>
<p>You need a state to accumulate into</p>



<a name="465256153"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/number%20ranges%20without%20heap%20allocations/near/465256153" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alexander Pyattaev <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/number.20ranges.20without.20heap.20allocations.html#465256153">(Aug 26 2024 at 19:09)</a>:</h4>
<p>errrr... hmhmh. ok. still it should not segfault on me, right?</p>



<a name="465256219"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/number%20ranges%20without%20heap%20allocations/near/465256219" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/number.20ranges.20without.20heap.20allocations.html#465256219">(Aug 26 2024 at 19:09)</a>:</h4>
<div class="codehilite" data-code-language="Elm"><pre><span></span><code><span class="nv">loop</span><span class="w"> </span><span class="nf">=</span><span class="w"> </span><span class="nf">\</span><span class="nv">sum</span><span class="p">,</span><span class="w"> </span><span class="nv">i</span><span class="p">,</span><span class="w"> </span><span class="nv">max</span><span class="w"> </span><span class="nf">-&gt;</span>
<span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nv">i</span><span class="w"> </span><span class="nf">&lt;</span><span class="w"> </span><span class="nv">max</span><span class="w"> </span><span class="kr">then</span>
<span class="w">        </span><span class="nv">loop</span><span class="w"> </span><span class="p">(</span><span class="nv">sum</span><span class="w"> </span><span class="nf">+</span><span class="w"> </span><span class="nv">i</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="nv">i</span><span class="w"> </span><span class="nf">+</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="nv">max</span>
<span class="w">    </span><span class="kr">else</span>
<span class="w">        </span><span class="nv">sum</span>
</code></pre></div>



<a name="465256414"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/number%20ranges%20without%20heap%20allocations/near/465256414" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/number.20ranges.20without.20heap.20allocations.html#465256414">(Aug 26 2024 at 19:10)</a>:</h4>
<p>Yeah, probably not. It <em>might</em> be segfaulting because of an addition overflow? I'd have to <code>gdb</code> it</p>



<a name="465256452"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/number%20ranges%20without%20heap%20allocations/near/465256452" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/number.20ranges.20without.20heap.20allocations.html#465256452">(Aug 26 2024 at 19:11)</a>:</h4>
<p>I would expect it to stack overflow</p>



<a name="465256458"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/number%20ranges%20without%20heap%20allocations/near/465256458" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/number.20ranges.20without.20heap.20allocations.html#465256458">(Aug 26 2024 at 19:11)</a>:</h4>
<p>I presume you're running <code>roc &lt;your-file&gt;.roc</code>, which would run the dev backend</p>



<a name="465256603"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/number%20ranges%20without%20heap%20allocations/near/465256603" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/number.20ranges.20without.20heap.20allocations.html#465256603">(Aug 26 2024 at 19:12)</a>:</h4>
<p>So something in our custom assembly builder isn't handling either a stack overflow or a number addition failure, probably the first</p>



<a name="465256631"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/number%20ranges%20without%20heap%20allocations/near/465256631" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alexander Pyattaev <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/number.20ranges.20without.20heap.20allocations.html#465256631">(Aug 26 2024 at 19:12)</a>:</h4>
<p>I am not getting the stack overflow, only SEGV.</p>



<a name="465256845"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/number%20ranges%20without%20heap%20allocations/near/465256845" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alexander Pyattaev <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/number.20ranges.20without.20heap.20allocations.html#465256845">(Aug 26 2024 at 19:14)</a>:</h4>
<div class="codehilite"><pre><span></span><code>rustc  count.rs
headhunter@hunter-laptop /tmp&gt; ./count
499999999500000000
headhunter@hunter-laptop /tmp&gt; cat count.rs
fn main(){
   let s:u64 = (0u64..1000*1000*1000).sum();
    println!(&quot;{s}&quot;);
}
</code></pre></div>
<p>there is no overflow in this program as far as rust can tell</p>



<a name="465256926"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/number%20ranges%20without%20heap%20allocations/near/465256926" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alexander Pyattaev <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/number.20ranges.20without.20heap.20allocations.html#465256926">(Aug 26 2024 at 19:15)</a>:</h4>
<p>I'm assuming that roc defaults to u64 for num representation here (not sure that is true, and even if it does not the program would just run forever)</p>



<a name="465256950"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/number%20ranges%20without%20heap%20allocations/near/465256950" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/number.20ranges.20without.20heap.20allocations.html#465256950">(Aug 26 2024 at 19:15)</a>:</h4>
<p>I64</p>



<a name="465257003"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/number%20ranges%20without%20heap%20allocations/near/465257003" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/number.20ranges.20without.20heap.20allocations.html#465257003">(Aug 26 2024 at 19:15)</a>:</h4>
<p>But yeah, definitely more than just the stack overflow issue being hit here</p>



<a name="465257123"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/number%20ranges%20without%20heap%20allocations/near/465257123" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alexander Pyattaev <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/number.20ranges.20without.20heap.20allocations.html#465257123">(Aug 26 2024 at 19:16)</a>:</h4>
<div class="codehilite" data-code-language="roc"><pre><span></span><code>loop = \sum, i, max -&gt;
    if i &lt; max then
        loop (sum + i) (i + 1) max
    else
        sum
</code></pre></div>
<p>this does not crash and gives correct answer</p>



<a name="465257166"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/number%20ranges%20without%20heap%20allocations/near/465257166" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alexander Pyattaev <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/number.20ranges.20without.20heap.20allocations.html#465257166">(Aug 26 2024 at 19:17)</a>:</h4>
<p>so yes, missing TCO apparently leads to SEGV. which is kinda sad.</p>



<a name="465257220"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/number%20ranges%20without%20heap%20allocations/near/465257220" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alexander Pyattaev <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/number.20ranges.20without.20heap.20allocations.html#465257220">(Aug 26 2024 at 19:17)</a>:</h4>
<p>but I would not even be here if I could have a generator for this sort of thing that I can then walk over</p>



<a name="465257278"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/number%20ranges%20without%20heap%20allocations/near/465257278" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alexander Pyattaev <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/number.20ranges.20without.20heap.20allocations.html#465257278">(Aug 26 2024 at 19:18)</a>:</h4>
<p>feel like I'm inventing a range from python here, which feels wrong</p>



<a name="465257356"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/number%20ranges%20without%20heap%20allocations/near/465257356" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alexander Pyattaev <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/number.20ranges.20without.20heap.20allocations.html#465257356">(Aug 26 2024 at 19:18)</a>:</h4>
<p>I mean rust has (min..max) notation that just gives you an iterator and you do not even need to think about it, would not be out of place in roc imo</p>



<a name="465257638"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/number%20ranges%20without%20heap%20allocations/near/465257638" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/number.20ranges.20without.20heap.20allocations.html#465257638">(Aug 26 2024 at 19:20)</a>:</h4>
<p>Yeah, iterators/streams have been talked about a few times on Zulip. There are concerns about splitting the ecosystem between lists and streams. But they are the right solution for certain problems.</p>



<a name="465257784"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/number%20ranges%20without%20heap%20allocations/near/465257784" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alexander Pyattaev <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/number.20ranges.20without.20heap.20allocations.html#465257784">(Aug 26 2024 at 19:22)</a>:</h4>
<p><span class="user-mention silent" data-user-id="343810">Brendan Hansknecht</span> <a href="#narrow/stream/231634-beginners/topic/Processing.20output.20in.20a.20CLI.20tool/near/465257638">said</a>:</p>
<blockquote>
<p>Yeah, iterators/streams have been talked about a few times on Zulip. There are concerns about splitting the ecosystem between lists and streams. But they are the right solution for certain problems.</p>
</blockquote>
<p>well its either that or better optimization passes that can detect when list is abused as iterator so it does not get backed by memory.</p>



<a name="465257840"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/number%20ranges%20without%20heap%20allocations/near/465257840" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alexander Pyattaev <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/number.20ranges.20without.20heap.20allocations.html#465257840">(Aug 26 2024 at 19:22)</a>:</h4>
<p>either way it is a massive gotcha, as I would have never in my life expected List.range to allocate</p>



<a name="465257876"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/number%20ranges%20without%20heap%20allocations/near/465257876" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/number.20ranges.20without.20heap.20allocations.html#465257876">(Aug 26 2024 at 19:22)</a>:</h4>
<p>Interesting. It returns a <code>List</code> though</p>



<a name="465258043"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/number%20ranges%20without%20heap%20allocations/near/465258043" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/number.20ranges.20without.20heap.20allocations.html#465258043">(Aug 26 2024 at 19:24)</a>:</h4>
<p>Today, has gotchas but forces users to be explicit about allocations. Technically iterators can be built up in userland if required. But yeah, it isn't a great state for usability.</p>



<a name="465258198"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/number%20ranges%20without%20heap%20allocations/near/465258198" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alexander Pyattaev <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/number.20ranges.20without.20heap.20allocations.html#465258198">(Aug 26 2024 at 19:25)</a>:</h4>
<p>Feels like roc needs an Iterator <del>trait</del> ability</p>



<a name="465258292"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/number%20ranges%20without%20heap%20allocations/near/465258292" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alexander Pyattaev <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/number.20ranges.20without.20heap.20allocations.html#465258292">(Aug 26 2024 at 19:26)</a>:</h4>
<p>this way you can have functions taking in things that have Iterator ability rather than specifically Lists</p>



<a name="465258530"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/number%20ranges%20without%20heap%20allocations/near/465258530" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/number.20ranges.20without.20heap.20allocations.html#465258530">(Aug 26 2024 at 19:28)</a>:</h4>
<p>That would sadly require higher kinded abilites. Which roc does not have.</p>



<a name="465258555"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/number%20ranges%20without%20heap%20allocations/near/465258555" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/number.20ranges.20without.20heap.20allocations.html#465258555">(Aug 26 2024 at 19:28)</a>:</h4>
<p>At least that is my understanding of the issue</p>



<a name="465258575"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/number%20ranges%20without%20heap%20allocations/near/465258575" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/number.20ranges.20without.20heap.20allocations.html#465258575">(Aug 26 2024 at 19:28)</a>:</h4>
<p>But haven't looked into it in a while</p>



<a name="465260262"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/number%20ranges%20without%20heap%20allocations/near/465260262" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alexander Pyattaev <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/number.20ranges.20without.20heap.20allocations.html#465260262">(Aug 26 2024 at 19:40)</a>:</h4>
<p><span class="user-mention silent" data-user-id="343810">Brendan Hansknecht</span> <a href="#narrow/stream/231634-beginners/topic/Processing.20output.20in.20a.20CLI.20tool/near/465258530">said</a>:</p>
<blockquote>
<p>That would sadly require higher kinded abilites. Which roc does not have.</p>
</blockquote>
<p>what are those?</p>



<a name="465264060"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/number%20ranges%20without%20heap%20allocations/near/465264060" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/number.20ranges.20without.20heap.20allocations.html#465264060">(Aug 26 2024 at 20:09)</a>:</h4>
<p>An ability with a type variable. In the case of an iterator, it is needed to capture the element type.</p>
<p>In roc, you could make an I64Iterator ability, but not a generic Iterator ability</p>



<a name="465343021"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/number%20ranges%20without%20heap%20allocations/near/465343021" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alexander Pyattaev <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/number.20ranges.20without.20heap.20allocations.html#465343021">(Aug 27 2024 at 06:38)</a>:</h4>
<p>Well in this case maybe some methods on numeric types would be nice to make ranges?</p>



<a name="465343083"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/number%20ranges%20without%20heap%20allocations/near/465343083" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alexander Pyattaev <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/number.20ranges.20without.20heap.20allocations.html#465343083">(Aug 27 2024 at 06:38)</a>:</h4>
<p>as a stopgap measure at least</p>



<a name="465413205"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/number%20ranges%20without%20heap%20allocations/near/465413205" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> batyoullfly <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/number.20ranges.20without.20heap.20allocations.html#465413205">(Aug 27 2024 at 11:13)</a>:</h4>
<p><span class="user-mention silent" data-user-id="343810">Brendan Hansknecht</span> <a href="#narrow/stream/231634-beginners/topic/Processing.20output.20in.20a.20CLI.20tool/near/465258530">said</a>:</p>
<blockquote>
<p>That would sadly require higher kinded abilites. Which roc does not have.</p>
</blockquote>
<p>It would? You can have type variables in the functions belonging to an ability, and there are iterator interfaces in languages like C#/F# and Java where there are no higher kinded types</p>



<a name="465415511"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/number%20ranges%20without%20heap%20allocations/near/465415511" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> batyoullfly <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/number.20ranges.20without.20heap.20allocations.html#465415511">(Aug 27 2024 at 11:24)</a>:</h4>
<p><code>Iterator implements next : {} -&gt; Result a [NoMoreElements]</code> something like this?</p>



<a name="465415876"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/number%20ranges%20without%20heap%20allocations/near/465415876" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> batyoullfly <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/number.20ranges.20without.20heap.20allocations.html#465415876">(Aug 27 2024 at 11:26)</a>:</h4>
<p>Or I guess there’s a rule about the type variables needing to implement the ability</p>



<a name="465418326"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/number%20ranges%20without%20heap%20allocations/near/465418326" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> batyoullfly <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/number.20ranges.20without.20heap.20allocations.html#465418326">(Aug 27 2024 at 11:34)</a>:</h4>
<p>Why is that a restriction exactly?</p>



<a name="465420428"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/number%20ranges%20without%20heap%20allocations/near/465420428" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> batyoullfly <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/number.20ranges.20without.20heap.20allocations.html#465420428">(Aug 27 2024 at 11:44)</a>:</h4>
<p>Oh, well I guess these aren’t methods with implicit access to an iterator object so you would need to have the iterator as an argument even if that wasn’t being enforced. Hmm. <br>
Couldn’t you still do something like<br>
<code>Iterator implements next : iter, a -&gt; { state: iter, elem: Result a [NoMoreElements] } where iter implements Iterator</code><br>
and just leave it up to the implementation to ensure that <code>a</code> is in fact the element type of the type implementing the ability?</p>



<a name="465426570"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/number%20ranges%20without%20heap%20allocations/near/465426570" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> batyoullfly <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/number.20ranges.20without.20heap.20allocations.html#465426570">(Aug 27 2024 at 12:07)</a>:</h4>
<p>I guess then the issue is you couldn’t actually use it very effectively. Is there any reason abilities shouldn’t be able to take type parameters themselves as long as they are concrete types?</p>



<a name="465506645"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/number%20ranges%20without%20heap%20allocations/near/465506645" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/number.20ranges.20without.20heap.20allocations.html#465506645">(Aug 27 2024 at 16:55)</a>:</h4>
<p>This is the general faq on that: <a href="https://www.roc-lang.org/faq#arbitrary-rank-types">https://www.roc-lang.org/faq#arbitrary-rank-types</a></p>



<a name="465530796"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/number%20ranges%20without%20heap%20allocations/near/465530796" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Notification Bot <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/number.20ranges.20without.20heap.20allocations.html#465530796">(Aug 27 2024 at 18:41)</a>:</h4>
<p>47 messages were moved here from <a class="stream-topic" data-stream-id="231634" href="/#narrow/stream/231634-beginners/topic/Processing.20output.20in.20a.20CLI.20tool">#beginners &gt; Processing output in a CLI tool</a> by <span class="user-mention silent" data-user-id="281383">Richard Feldman</span>.</p>



<a name="465531500"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/number%20ranges%20without%20heap%20allocations/near/465531500" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/number.20ranges.20without.20heap.20allocations.html#465531500">(Aug 27 2024 at 18:44)</a>:</h4>
<p><span class="user-mention silent" data-user-id="674610">Alexander Pyattaev</span> <a href="#narrow/stream/231634-beginners/topic/number.20ranges.20without.20heap.20allocations/near/465252871">said</a>:</p>
<blockquote>
<p>Can someone explain a way to make a generator for a long array of numbers that would just, well, make numbers? List.range is no good as it seems to allocate the actual list (even if I will only ever walk the thing)</p>
</blockquote>
<p>what if we added this to <code>Num</code>? (the <code>...etc</code> part is the rest of the configuration record that <code>List.range</code> uses)</p>
<div class="codehilite" data-code-language="Haskell"><pre><span></span><code><span class="kt">Num</span><span class="o">.</span><span class="n">walkRange</span><span class="w"> </span><span class="kt">:</span>
<span class="w">    </span><span class="p">{</span><span class="w"> </span><span class="n">start</span><span class="kt">:</span><span class="w"> </span><span class="p">[</span><span class="kt">At</span><span class="w"> </span><span class="p">(</span><span class="kt">Int</span><span class="w"> </span><span class="n">a</span><span class="p">),</span><span class="w"> </span><span class="kt">Before</span><span class="w"> </span><span class="p">(</span><span class="kt">Int</span><span class="w"> </span><span class="n">a</span><span class="p">),</span><span class="w"> </span><span class="kt">After</span><span class="w"> </span><span class="p">(</span><span class="kt">Int</span><span class="w"> </span><span class="n">a</span><span class="p">)],</span><span class="w"> </span><span class="o">...</span><span class="n">etc</span><span class="w"> </span><span class="p">},</span>
<span class="w">    </span><span class="n">state</span><span class="p">,</span>
<span class="w">    </span><span class="p">(</span><span class="n">state</span><span class="p">,</span><span class="w"> </span><span class="kt">Num</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="ow">-&gt;</span><span class="w"> </span><span class="n">state</span><span class="p">)</span>
<span class="w">    </span><span class="ow">-&gt;</span><span class="w"> </span><span class="n">state</span>
</code></pre></div>



<a name="465532329"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/number%20ranges%20without%20heap%20allocations/near/465532329" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/number.20ranges.20without.20heap.20allocations.html#465532329">(Aug 27 2024 at 18:49)</a>:</h4>
<p>I think this would be a great allocation-free way to achieve the result, but points to an underlying issue that streams would solve in many ways. We have</p>
<ul>
<li>List.walk</li>
<li>List.walkWithIndex</li>
<li>List.walkWithIndexUntil</li>
<li>List.walkUntil</li>
<li>List.walkBackwards</li>
<li>and so on...</li>
</ul>
<p>Because we want to have iterators, but don't want to support higher-kinded types. So having some mechanism to achieve that result would lower the cardinality of our APIs while also avoiding allocations.</p>



<a name="465532563"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/number%20ranges%20without%20heap%20allocations/near/465532563" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/number.20ranges.20without.20heap.20allocations.html#465532563">(Aug 27 2024 at 18:50)</a>:</h4>
<p>I will try to look around this weekend at potential solutions that won't require our language to open the floodgates for type abuse</p>



<a name="465551833"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/number%20ranges%20without%20heap%20allocations/near/465551833" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> batyoullfly <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/number.20ranges.20without.20heap.20allocations.html#465551833">(Aug 27 2024 at 20:05)</a>:</h4>
<p><span class="user-mention silent" data-user-id="343810">Brendan Hansknecht</span> <a href="#narrow/stream/231634-beginners/topic/number.20ranges.20without.20heap.20allocations/near/465506645">said</a>:</p>
<blockquote>
<p>This is the general faq on that: <a href="https://www.roc-lang.org/faq#arbitrary-rank-types">https://www.roc-lang.org/faq#arbitrary-rank-types</a></p>
</blockquote>
<p>Would allowing abilities to have type parameters be a form of higher ranked types?</p>



<a name="465556429"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/number%20ranges%20without%20heap%20allocations/near/465556429" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> batyoullfly <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/number.20ranges.20without.20heap.20allocations.html#465556429">(Aug 27 2024 at 20:23)</a>:</h4>
<p>Would it be rank 2? Because instead of a function in an implementation being able to satisfy a signature of <code>a -&gt; a</code> by accepting a specific type and returning that specific type, it would have to be able to accept any arbitrary type?</p>



<a name="465556454"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/number%20ranges%20without%20heap%20allocations/near/465556454" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sven van Caem <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/number.20ranges.20without.20heap.20allocations.html#465556454">(Aug 27 2024 at 20:23)</a>:</h4>
<p><span class="user-mention silent" data-user-id="461444">Sam Mohr</span> <a href="#narrow/stream/231634-beginners/topic/number.20ranges.20without.20heap.20allocations/near/465532563">said</a>:</p>
<blockquote>
<p>I will try to look around this weekend at potential solutions that won't require our language to open the floodgates for type abuse</p>
</blockquote>
<p>I believe, to this end, the plan is for the compiler to eventually support deforestation/stream fusion, which would automatically combine successive list operations to avoid intermediate allocations. This way <code>List.walkBackwards</code> could be replaced by <code>List.reverse |&gt; List.walk</code> with no loss in performance. In the meantime though, having this expanded family of list operations acts as a stop-gap to achieve the desired performance characteristics anyway.</p>



<a name="465561091"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/number%20ranges%20without%20heap%20allocations/near/465561091" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/number.20ranges.20without.20heap.20allocations.html#465561091">(Aug 27 2024 at 20:43)</a>:</h4>
<p>Yes, that was a mechanism proposed by Rich. It would probably be better for users to not need to know the difference between List and Iterators for perf reasons, but there are some spots where we avoid giving "easy ways out", e.g. roc-unicode being a separate package instead of a standard library add with simple <code>Str.len</code> tools.</p>



<a name="465561653"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/number%20ranges%20without%20heap%20allocations/near/465561653" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/number.20ranges.20without.20heap.20allocations.html#465561653">(Aug 27 2024 at 20:45)</a>:</h4>
<p>So yes, I'm okay with the expanded family for now, but it seems like if we could find a way to do iterators, that would be better than what we have. Meaning the issue isn't that iterators are the wrong solution, but that we don't know how to implement them in Roc's current type system.</p>



<a name="465566532"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/number%20ranges%20without%20heap%20allocations/near/465566532" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/number.20ranges.20without.20heap.20allocations.html#465566532">(Aug 27 2024 at 21:02)</a>:</h4>
<p>for what it's worth, I spent a lot of time looking into various iterator designs and my conclusion was that "there are more functions exposed" was a better design than any of the ones I came up with</p>



<a name="465566940"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/number%20ranges%20without%20heap%20allocations/near/465566940" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/number.20ranges.20without.20heap.20allocations.html#465566940">(Aug 27 2024 at 21:05)</a>:</h4>
<p>maybe another way to say it is that I prefer the downside of "this API could be a few functions smaller" to the downside of "there is a new entire chapter's worth of complexity in the tutorial on iterators"</p>



<a name="465567432"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/number%20ranges%20without%20heap%20allocations/near/465567432" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/number.20ranges.20without.20heap.20allocations.html#465567432">(Aug 27 2024 at 21:09)</a>:</h4>
<p>that's not to say we should never do it, just that it's in the "explored various designs and none seemed like they were worth the complexity cost" state rather than the "hasn't really been investigated seriously" state <span aria-label="big smile" class="emoji emoji-1f604" role="img" title="big smile">:big_smile:</span></p>



<a name="465568840"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/number%20ranges%20without%20heap%20allocations/near/465568840" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/number.20ranges.20without.20heap.20allocations.html#465568840">(Aug 27 2024 at 21:19)</a>:</h4>
<p>Yeah, that tracks. If there was an easy way to do it, it would've been in the language a few years ago.</p>



<a name="465569082"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/number%20ranges%20without%20heap%20allocations/near/465569082" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/number.20ranges.20without.20heap.20allocations.html#465569082">(Aug 27 2024 at 21:20)</a>:</h4>
<p>Which is why I think maybe some macro to combine the various walk* functions in the compiler would be the way to go. Duplication in the compiler isn't bad if the stdlib API is nicer to use.</p>



<a name="465572631"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/number%20ranges%20without%20heap%20allocations/near/465572631" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> batyoullfly <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/number.20ranges.20without.20heap.20allocations.html#465572631">(Aug 27 2024 at 21:39)</a>:</h4>
<p>Other than the number of functions for dealing with Lists, lack of any way to implement iterators still means there’s no generic way of writing a function that works with an unknown type of collection, right?</p>



<a name="465573160"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/number%20ranges%20without%20heap%20allocations/near/465573160" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/number.20ranges.20without.20heap.20allocations.html#465573160">(Aug 27 2024 at 21:41)</a>:</h4>
<p>Actually that is doable and done for decode and encode</p>



<a name="465573250"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/number%20ranges%20without%20heap%20allocations/near/465573250" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/number.20ranges.20without.20heap.20allocations.html#465573250">(Aug 27 2024 at 21:41)</a>:</h4>
<p>Or maybe it is done for the future version of encode and decode that aren't implemented yet</p>



<a name="465574480"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/number%20ranges%20without%20heap%20allocations/near/465574480" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/number.20ranges.20without.20heap.20allocations.html#465574480">(Aug 27 2024 at 21:46)</a>:</h4>
<div class="codehilite" data-code-language="Elm"><pre><span></span><code><span class="kt">SequenceWalker</span><span class="w"> </span><span class="nv">state</span><span class="w"> </span><span class="nv">seq</span><span class="w"> </span><span class="nv">elem</span><span class="w"> </span><span class="nf">:</span><span class="w"> </span><span class="nv">seq</span><span class="p">,</span><span class="w"> </span><span class="nv">state</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="nv">state</span><span class="p">,</span><span class="w"> </span><span class="nv">elem</span><span class="w"> </span><span class="nf">-&gt;</span><span class="w"> </span><span class="nv">state</span><span class="p">)</span><span class="w"> </span><span class="nf">-&gt;</span><span class="w"> </span><span class="nv">state</span>
<span class="kt">LengthInfo</span><span class="w"> </span><span class="nf">:</span><span class="w"> </span><span class="p">[</span><span class="kt">Length</span><span class="w"> </span><span class="kt">U64</span><span class="p">,</span><span class="w"> </span><span class="kt">UnknownLength</span><span class="p">]</span>

<span class="err">#</span><span class="w"> </span><span class="kt">In</span><span class="w"> </span><span class="nv">the</span><span class="w"> </span><span class="nv">encode</span><span class="w"> </span><span class="nv">ability</span><span class="w"> </span><span class="nv">for</span><span class="w"> </span><span class="nv">sequences</span><span class="nf">:</span>
<span class="w">    </span><span class="nv">sequence</span><span class="w"> </span><span class="nf">:</span>
<span class="w">        </span><span class="nv">seq</span><span class="p">,</span>
<span class="w">        </span><span class="kt">LengthInfo</span><span class="p">,</span>
<span class="w">        </span><span class="kt">SequenceWalker</span><span class="w"> </span><span class="nv">state</span><span class="w"> </span><span class="nv">seq</span><span class="w"> </span><span class="nv">elem</span><span class="p">,</span>
<span class="w">        </span><span class="p">(</span><span class="nv">elem</span><span class="w"> </span><span class="nf">-&gt;</span><span class="w"> </span><span class="kt">FutureEncoder</span><span class="w"> </span><span class="nv">state</span><span class="p">)</span>
<span class="w">        </span><span class="nf">-&gt;</span><span class="w"> </span><span class="kt">FutureEncoder</span><span class="w"> </span><span class="nv">state</span><span class="w"> </span><span class="kr">where</span><span class="w"> </span><span class="nv">state</span><span class="w"> </span><span class="nv">implements</span><span class="w"> </span><span class="kt">FutureEncoderFormatting</span>
</code></pre></div>



<a name="465574618"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/number%20ranges%20without%20heap%20allocations/near/465574618" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/number.20ranges.20without.20heap.20allocations.html#465574618">(Aug 27 2024 at 21:46)</a>:</h4>
<p>You then can pass <code>List.walk</code> or <code>Set.walk</code> into that and it would work. Theoretically could also pass a lazy <code>Iterator.walk</code>.</p>



<a name="465574883"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/number%20ranges%20without%20heap%20allocations/near/465574883" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/number.20ranges.20without.20heap.20allocations.html#465574883">(Aug 27 2024 at 21:47)</a>:</h4>
<p>That said, it is technically missing information. It doesn't know the type of the element in the container. It just knows you have an impl of <code>Container.walk</code> that generates an element type. Technically that walk function could be mapping the element type to something different</p>



<a name="465575489"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/number%20ranges%20without%20heap%20allocations/near/465575489" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> batyoullfly <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/number.20ranges.20without.20heap.20allocations.html#465575489">(Aug 27 2024 at 21:49)</a>:</h4>
<p>So I guess similar to what I asked about earlier with having an iterator ability, you could do operations on the collection but you couldn’t, for example,  implement a sum function that works for all collections of Nums</p>



<a name="465575658"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/number%20ranges%20without%20heap%20allocations/near/465575658" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/number.20ranges.20without.20heap.20allocations.html#465575658">(Aug 27 2024 at 21:51)</a>:</h4>
<p>that's correct</p>



<a name="465575673"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/number%20ranges%20without%20heap%20allocations/near/465575673" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/number.20ranges.20without.20heap.20allocations.html#465575673">(Aug 27 2024 at 21:51)</a>:</h4>
<p>that was actually the original motivation for my looking into it</p>



<a name="465575743"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/number%20ranges%20without%20heap%20allocations/near/465575743" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/number.20ranges.20without.20heap.20allocations.html#465575743">(Aug 27 2024 at 21:51)</a>:</h4>
<p>it seemed like something that the language "should be able to do" in the abstract, but when I got down to it I honestly had more and more trouble convincing myself it was actually important in practice as opposed to something that sounds important in the abstract <span aria-label="sweat smile" class="emoji emoji-1f605" role="img" title="sweat smile">:sweat_smile:</span></p>



<a name="465575761"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/number%20ranges%20without%20heap%20allocations/near/465575761" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/number.20ranges.20without.20heap.20allocations.html#465575761">(Aug 27 2024 at 21:51)</a>:</h4>
<p>Yeah, and you have to be careful about some weird cases. Like if you require <code>elem</code> as an input to specify the input type, that may lead to impossible cases the user doesn't have a way to generate an element type</p>



<a name="465575893"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/number%20ranges%20without%20heap%20allocations/near/465575893" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> batyoullfly <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/number.20ranges.20without.20heap.20allocations.html#465575893">(Aug 27 2024 at 21:52)</a>:</h4>
<p>I was kind of thinking the same. Like in my mind it seems frustrating and strange that you wouldn’t be able to operate on generic collections of some specific type, but also I have never needed to do that really so it wouldn’t change anything for me in practice using the language</p>



<a name="465575917"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/number%20ranges%20without%20heap%20allocations/near/465575917" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/number.20ranges.20without.20heap.20allocations.html#465575917">(Aug 27 2024 at 21:53)</a>:</h4>
<p>Aside, isn't sequence walker almost the entire definitely or an iterator? Besides making apis inconvenient cause you have to pass in a input type and a walk function, I think it would work for most things iterators</p>



<a name="465575993"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/number%20ranges%20without%20heap%20allocations/near/465575993" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/number.20ranges.20without.20heap.20allocations.html#465575993">(Aug 27 2024 at 21:53)</a>:</h4>
<p>You could make a version that uses <code>Num a</code> as the element type and implement sum</p>



<a name="465576348"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/number%20ranges%20without%20heap%20allocations/near/465576348" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> batyoullfly <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/number.20ranges.20without.20heap.20allocations.html#465576348">(Aug 27 2024 at 21:56)</a>:</h4>
<p>Oh? That’s cool, I think I don’t quite understand the usage of the example you gave then. I guess in situations where you’re writing library code and really anticipate people wanting to swap in their own data structure rather than using lists, you could always provide an alternate API for doing so, even if it’s a little awkward, because most of the time you’ll just use a list anyway</p>



<a name="465576509"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/number%20ranges%20without%20heap%20allocations/near/465576509" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/number.20ranges.20without.20heap.20allocations.html#465576509">(Aug 27 2024 at 21:57)</a>:</h4>
<p>Yeah, if you expect that you need to support multiple container types and you only need to walk the container. You could force the user to pass on the walk function and it would be functional. And they could even define a "container" that is really an iterator and doesn't have backing storage.</p>



<a name="465607401"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/number%20ranges%20without%20heap%20allocations/near/465607401" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/number.20ranges.20without.20heap.20allocations.html#465607401">(Aug 28 2024 at 02:28)</a>:</h4>
<p>So I guess iterables can actually work today in roc. A bit of a strange setup, but should be functional. Also, the typing is a bit jank. It does work though..</p>
<p>Also, I'm sure something nicer could be made from this. Just the first thing I tested really:</p>
<div class="spoiler-block"><div class="spoiler-header">
<p>Functional iterator</p>
</div><div class="spoiler-content" aria-hidden="true">
<div class="codehilite" data-code-language="Elm"><pre><span></span><code><span class="nv">app</span><span class="w"> </span><span class="p">[</span><span class="nv">main</span><span class="p">]</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nv">pf</span><span class="nf">:</span><span class="w"> </span><span class="nv">platform</span><span class="w"> </span><span class="s">"https://github.com/roc-lang/basic-cli/releases/download/0.14.0/dC5ceT962N_4jmoyoffVdphJ_4GlW3YMhAPyGPr-nU0.tar.br"</span><span class="w"> </span><span class="p">}</span>

<span class="kn">import</span><span class="w"> </span><span class="nc">pf.Stdout</span>
<span class="kn">import</span><span class="w"> </span><span class="nc">pf.Task</span><span class="w"> </span><span class="nv">exposing</span><span class="w"> </span><span class="p">[</span><span class="kt">Task</span><span class="p">]</span>

<span class="kt">Walker</span><span class="w"> </span><span class="nv">state</span><span class="w"> </span><span class="nv">elem</span><span class="w"> </span><span class="nf">:</span><span class="w"> </span><span class="nv">state</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="nv">state</span><span class="p">,</span><span class="w"> </span><span class="nv">elem</span><span class="w"> </span><span class="nf">-&gt;</span><span class="w"> </span><span class="nv">state</span><span class="p">)</span><span class="w"> </span><span class="nf">-&gt;</span><span class="w"> </span><span class="nv">state</span>

<span class="kt">Iterable</span><span class="w"> </span><span class="nv">implements</span>
<span class="w">    </span><span class="nv">createWalkFn</span><span class="w"> </span><span class="nf">:</span><span class="w"> </span><span class="nv">iter</span><span class="w"> </span><span class="nf">-&gt;</span><span class="w"> </span><span class="kt">Walker</span><span class="w"> </span><span class="nv">state</span><span class="w"> </span><span class="nv">elem</span><span class="w"> </span><span class="kr">where</span><span class="w"> </span><span class="nv">iter</span><span class="w"> </span><span class="nv">implements</span><span class="w"> </span><span class="kt">Iterable</span>

<span class="kt">IterList</span><span class="w"> </span><span class="nv">elem</span><span class="w"> </span><span class="nf">:=</span><span class="w"> </span><span class="kt">List</span><span class="w"> </span><span class="nv">elem</span><span class="w"> </span><span class="nv">implements</span><span class="w"> </span><span class="p">[</span>
<span class="w">        </span><span class="kt">Iterable</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nv">createWalkFn</span><span class="nf">:</span><span class="w"> </span><span class="nv">createIterListWalkFn</span><span class="p">,</span>
<span class="w">        </span><span class="p">},</span>
<span class="w">    </span><span class="p">]</span>

<span class="nv">createIterListWalkFn</span><span class="w"> </span><span class="nf">=</span><span class="w"> </span><span class="nf">\</span><span class="err">@</span><span class="kt">IterList</span><span class="w"> </span><span class="nv">list</span><span class="w"> </span><span class="nf">-&gt;</span>
<span class="w">    </span><span class="nf">\</span><span class="nv">state</span><span class="p">,</span><span class="w"> </span><span class="nv">step</span><span class="w"> </span><span class="nf">-&gt;</span><span class="w"> </span><span class="kt">List</span><span class="nf">.</span><span class="nv">walk</span><span class="w"> </span><span class="nv">list</span><span class="w"> </span><span class="nv">state</span><span class="w"> </span><span class="nv">step</span>

<span class="kt">Range</span><span class="w"> </span><span class="nf">:=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nv">start</span><span class="w"> </span><span class="nf">:</span><span class="w"> </span><span class="kt">I64</span><span class="p">,</span><span class="w"> </span><span class="nv">stop</span><span class="w"> </span><span class="nf">:</span><span class="w"> </span><span class="kt">I64</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="nv">implements</span><span class="w"> </span><span class="p">[</span>
<span class="w">        </span><span class="kt">Iterable</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nv">createWalkFn</span><span class="nf">:</span><span class="w"> </span><span class="nv">createRangeWalkFn</span><span class="p">,</span>
<span class="w">        </span><span class="p">},</span>
<span class="w">    </span><span class="p">]</span>

<span class="nv">createRangeWalkFn</span><span class="w"> </span><span class="nf">=</span><span class="w"> </span><span class="nf">\</span><span class="err">@</span><span class="kt">Range</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nv">start</span><span class="p">,</span><span class="w"> </span><span class="nv">stop</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="nf">-&gt;</span>
<span class="w">    </span><span class="nv">helper</span><span class="w"> </span><span class="nf">=</span><span class="w"> </span><span class="nf">\</span><span class="nv">state</span><span class="p">,</span><span class="w"> </span><span class="nv">step</span><span class="p">,</span><span class="w"> </span><span class="nv">i</span><span class="w"> </span><span class="nf">-&gt;</span>
<span class="w">        </span><span class="kr">if</span><span class="w"> </span><span class="nv">i</span><span class="w"> </span><span class="nf">&lt;</span><span class="w"> </span><span class="nv">stop</span><span class="w"> </span><span class="kr">then</span>
<span class="w">            </span><span class="nv">helper</span><span class="w"> </span><span class="p">(</span><span class="nv">step</span><span class="w"> </span><span class="nv">state</span><span class="w"> </span><span class="nv">i</span><span class="p">)</span><span class="w"> </span><span class="nv">step</span><span class="w"> </span><span class="p">(</span><span class="nv">i</span><span class="w"> </span><span class="nf">+</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span>
<span class="w">        </span><span class="kr">else</span>
<span class="w">            </span><span class="nv">state</span>

<span class="w">    </span><span class="nf">\</span><span class="nv">state</span><span class="p">,</span><span class="w"> </span><span class="nv">step</span><span class="w"> </span><span class="nf">-&gt;</span>
<span class="w">        </span><span class="nv">helper</span><span class="w"> </span><span class="nv">state</span><span class="w"> </span><span class="nv">step</span><span class="w"> </span><span class="nv">start</span>

<span class="kr">main </span><span class="nf">=</span>

<span class="w">    </span><span class="nv">a</span><span class="w"> </span><span class="nf">=</span><span class="w"> </span><span class="err">@</span><span class="kt">IterList</span><span class="w"> </span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">7</span><span class="p">,</span><span class="w"> </span><span class="mi">8</span><span class="p">]</span>
<span class="w">    </span><span class="nv">walkA</span><span class="w"> </span><span class="nf">=</span><span class="w"> </span><span class="nv">createWalkFn</span><span class="w"> </span><span class="nv">a</span>

<span class="w">    </span><span class="nv">printA</span><span class="w"> </span><span class="nf">=</span>
<span class="w">        </span><span class="nv">walkA</span><span class="w"> </span><span class="p">(</span><span class="kt">Task</span><span class="nf">.</span><span class="nv">ok</span><span class="w"> </span><span class="p">{})</span><span class="w"> </span><span class="nf">\</span><span class="nv">prev</span><span class="p">,</span><span class="w"> </span><span class="nv">elem</span><span class="w"> </span><span class="nf">-&gt;</span>
<span class="w">            </span><span class="nv">prev</span><span class="err">!</span>

<span class="w">            </span><span class="kt">Num</span><span class="nf">.</span><span class="nv">toStr</span><span class="w"> </span><span class="nv">elem</span>
<span class="w">            </span><span class="nf">|&gt;</span><span class="w"> </span><span class="kt">Stdout</span><span class="nf">.</span><span class="nv">line</span>

<span class="w">    </span><span class="nv">printA</span><span class="err">!</span>

<span class="w">    </span><span class="nv">b</span><span class="w"> </span><span class="nf">=</span><span class="w"> </span><span class="err">@</span><span class="kt">Range</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nv">start</span><span class="nf">:</span><span class="w"> </span><span class="mi">7</span><span class="p">,</span><span class="w"> </span><span class="nv">stop</span><span class="nf">:</span><span class="w"> </span><span class="mi">22</span><span class="w"> </span><span class="p">}</span>
<span class="w">    </span><span class="nv">walkB</span><span class="w"> </span><span class="nf">=</span><span class="w"> </span><span class="nv">createWalkFn</span><span class="w"> </span><span class="nv">b</span>

<span class="w">    </span><span class="nv">printB</span><span class="w"> </span><span class="nf">=</span>
<span class="w">        </span><span class="nv">walkB</span><span class="w"> </span><span class="p">(</span><span class="kt">Task</span><span class="nf">.</span><span class="nv">ok</span><span class="w"> </span><span class="p">{})</span><span class="w"> </span><span class="nf">\</span><span class="nv">prev</span><span class="p">,</span><span class="w"> </span><span class="nv">elem</span><span class="w"> </span><span class="nf">-&gt;</span>
<span class="w">            </span><span class="nv">prev</span><span class="err">!</span>

<span class="w">            </span><span class="kt">Num</span><span class="nf">.</span><span class="nv">toStr</span><span class="w"> </span><span class="nv">elem</span>
<span class="w">            </span><span class="nf">|&gt;</span><span class="w"> </span><span class="kt">Stdout</span><span class="nf">.</span><span class="nv">line</span>

<span class="w">    </span><span class="nv">printB</span><span class="err">!</span>
</code></pre></div>
</div></div>



<a name="465607491"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/number%20ranges%20without%20heap%20allocations/near/465607491" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/number.20ranges.20without.20heap.20allocations.html#465607491">(Aug 28 2024 at 02:29)</a>:</h4>
<p>Since abilities get monomorphize, roc will generate the concrete <code>Walker</code> type that is created by a walk function. Thus, later uses will type check/error correctly based on the concrete final types.</p>



<a name="465607923"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/number%20ranges%20without%20heap%20allocations/near/465607923" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/number.20ranges.20without.20heap.20allocations.html#465607923">(Aug 28 2024 at 02:33)</a>:</h4>
<p>I guess that would suggest that something like this should just work:</p>
<div class="codehilite" data-code-language="Elm"><pre><span></span><code><span class="kt">Iterator</span><span class="w"> </span><span class="nv">implements</span>
<span class="w">    </span><span class="nv">next</span><span class="w"> </span><span class="nf">:</span><span class="w"> </span><span class="nv">iter</span><span class="w"> </span><span class="nf">-&gt;</span><span class="w"> </span><span class="p">(</span><span class="nv">iter</span><span class="p">,</span><span class="w"> </span><span class="kt">Result</span><span class="w"> </span><span class="nv">elm</span><span class="w"> </span><span class="p">[</span><span class="kt">NoMoreElements</span><span class="p">])</span><span class="w"> </span><span class="kr">where</span><span class="w"> </span><span class="nv">iter</span><span class="w"> </span><span class="nv">implements</span><span class="w"> </span><span class="kt">Iterator</span>
</code></pre></div>



<a name="465608124"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/number%20ranges%20without%20heap%20allocations/near/465608124" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/number.20ranges.20without.20heap.20allocations.html#465608124">(Aug 28 2024 at 02:35)</a>:</h4>
<p>Of course you really need an extra layer of indirection. Cause an iterator is not just a container. It is general a container plus some extra state. But I guess it could be paired with:</p>
<div class="codehilite" data-code-language="Elm"><pre><span></span><code><span class="kt">Iterable</span><span class="w"> </span><span class="nv">implements</span>
<span class="w">    </span><span class="nv">toIter</span><span class="w"> </span><span class="nf">:</span><span class="w"> </span><span class="nv">iterable</span><span class="w"> </span><span class="nf">-&gt;</span><span class="w"> </span><span class="nv">iterator</span><span class="w"> </span><span class="kr">where</span><span class="w"> </span><span class="nv">iterable</span><span class="w"> </span><span class="nv">implements</span><span class="w"> </span><span class="kt">Iterable</span><span class="p">,</span><span class="w"> </span><span class="nv">iterator</span><span class="w"> </span><span class="nv">implements</span><span class="w"> </span><span class="kt">Iterator</span>
</code></pre></div>
<p>This definitely is throwing out some type information. Like we have no idea what the element type is from the signature, but I think it would still compile and work in roc.</p>



<a name="465608138"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/number%20ranges%20without%20heap%20allocations/near/465608138" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/number.20ranges.20without.20heap.20allocations.html#465608138">(Aug 28 2024 at 02:35)</a>:</h4>
<p>Kinda feels like magic that shouldn't work.</p>



<a name="465608158"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/number%20ranges%20without%20heap%20allocations/near/465608158" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/number.20ranges.20without.20heap.20allocations.html#465608158">(Aug 28 2024 at 02:36)</a>:</h4>
<p>I did something earlier at work, I'm gonna benchmark stuff when I get home</p>



<hr><p>Last updated: Mar 01 2026 at 12:20 UTC</p>
</html>