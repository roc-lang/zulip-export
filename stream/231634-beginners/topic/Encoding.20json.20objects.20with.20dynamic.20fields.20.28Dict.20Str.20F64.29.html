<html>
<head><meta charset="utf-8"><title>Encoding json objects with dynamic fields (Dict Str F64) · beginners · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/index.html">beginners</a></h2>
<h3>Topic: <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Encoding.20json.20objects.20with.20dynamic.20fields.20.28Dict.20Str.20F64.29.html">Encoding json objects with dynamic fields (Dict Str F64)</a></h3>

<hr>

<base href="https://roc.zulipchat.com">

<head><link href="https://roc-lang.github.io/zulip-export/style.css" rel="stylesheet"></head>

<a name="476148217"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Encoding%20json%20objects%20with%20dynamic%20fields%20%28Dict%20Str%20F64%29/near/476148217" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Niklas Konstenius <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Encoding.20json.20objects.20with.20dynamic.20fields.20.28Dict.20Str.20F64.29.html#476148217">(Oct 10 2024 at 14:27)</a>:</h4>
<p>What is the Roc idiomatic way of encoding Dicts to json? </p>
<p>I'm trying to solve the rest-api excercise on Exercism and my first try was to just use the Encoding ability of the platform to encode a Dict as JSON. </p>
<p>Getting this error though:</p>
<div class="codehilite"><pre><span></span><code>I can&#39;t generate an implementation of the Encoding ability for

    List User

In particular, an implementation for

    Dict Str F64

cannot be generated.
</code></pre></div>
<p>My next idea was to use some json encoding primitives like in Elm but this does not seem to be an idiomatic way to do it in Roc? I could not find any Elm like encoding functions anyway.</p>
<p>Is string concatenation really my only option to build json objects with dynamic field names in Roc right now?</p>



<a name="476164103"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Encoding%20json%20objects%20with%20dynamic%20fields%20%28Dict%20Str%20F64%29/near/476164103" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Encoding.20json.20objects.20with.20dynamic.20fields.20.28Dict.20Str.20F64.29.html#476164103">(Oct 10 2024 at 15:40)</a>:</h4>
<p>Encode and Decode before Dict and Set where really proper types. They need to be expanded</p>



<a name="476164417"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Encoding%20json%20objects%20with%20dynamic%20fields%20%28Dict%20Str%20F64%29/near/476164417" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Encoding.20json.20objects.20with.20dynamic.20fields.20.28Dict.20Str.20F64.29.html#476164417">(Oct 10 2024 at 15:42)</a>:</h4>
<p>We actually have a proposal and partial implementation of a much more flexible implementation. Sadly, I think it is currently stuck in some lambaset bugs.</p>



<a name="476164520"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Encoding%20json%20objects%20with%20dynamic%20fields%20%28Dict%20Str%20F64%29/near/476164520" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Encoding.20json.20objects.20with.20dynamic.20fields.20.28Dict.20Str.20F64.29.html#476164520">(Oct 10 2024 at 15:42)</a>:</h4>
<p>That said, the current version of encode and decode definitely could be expanded to support dict and set directly.</p>



<a name="476164945"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Encoding%20json%20objects%20with%20dynamic%20fields%20%28Dict%20Str%20F64%29/near/476164945" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Encoding.20json.20objects.20with.20dynamic.20fields.20.28Dict.20Str.20F64.29.html#476164945">(Oct 10 2024 at 15:45)</a>:</h4>
<p>New encode and decode idea discussed in <a class="stream-topic" data-stream-id="304641" href="/#narrow/stream/304641-ideas/topic/Revamped.20Encode.20and.20Decode">#ideas &gt; Revamped Encode and Decode</a>.</p>
<p>I should probably circle back to the partial implementation to see if I can push it farther</p>



<a name="476169192"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Encoding%20json%20objects%20with%20dynamic%20fields%20%28Dict%20Str%20F64%29/near/476169192" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Niklas Konstenius <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Encoding.20json.20objects.20with.20dynamic.20fields.20.28Dict.20Str.20F64.29.html#476169192">(Oct 10 2024 at 16:05)</a>:</h4>
<p>Thanks for the link to the Revamped Encode and Decode discusson. Interesting read indeed, hope you will manage to finish it. </p>
<p>Do you know if there is any other (possibly Elm style) Roc json-libraries in the wild? I really like the simplicity of Elms approach to json encoding / decoding and wouldn't mind using the same approach in Roc. </p>
<p>The Roc Encode / Decode stuff is still a bit magical to me. :-)</p>



<a name="476172746"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Encoding%20json%20objects%20with%20dynamic%20fields%20%28Dict%20Str%20F64%29/near/476172746" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Encoding.20json.20objects.20with.20dynamic.20fields.20.28Dict.20Str.20F64.29.html#476172746">(Oct 10 2024 at 16:19)</a>:</h4>
<p>I don't know if any other library for json</p>



<a name="476173492"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Encoding%20json%20objects%20with%20dynamic%20fields%20%28Dict%20Str%20F64%29/near/476173492" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Encoding.20json.20objects.20with.20dynamic.20fields.20.28Dict.20Str.20F64.29.html#476173492">(Oct 10 2024 at 16:22)</a>:</h4>
<p>it would definitely be possible to port elm-json-decode-pipeline to Roc!</p>



<a name="476173554"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Encoding%20json%20objects%20with%20dynamic%20fields%20%28Dict%20Str%20F64%29/near/476173554" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Encoding.20json.20objects.20with.20dynamic.20fields.20.28Dict.20Str.20F64.29.html#476173554">(Oct 10 2024 at 16:22)</a>:</h4>
<p>you could even use record builder syntax to make it even nicer</p>



<a name="476185115"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Encoding%20json%20objects%20with%20dynamic%20fields%20%28Dict%20Str%20F64%29/near/476185115" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Niklas Konstenius <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Encoding.20json.20objects.20with.20dynamic.20fields.20.28Dict.20Str.20F64.29.html#476185115">(Oct 10 2024 at 17:29)</a>:</h4>
<p>Cool, I need to read up on that record builder syntax now. :-)</p>



<a name="476193964"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Encoding%20json%20objects%20with%20dynamic%20fields%20%28Dict%20Str%20F64%29/near/476193964" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Encoding.20json.20objects.20with.20dynamic.20fields.20.28Dict.20Str.20F64.29.html#476193964">(Oct 10 2024 at 18:19)</a>:</h4>
<p>That one is in the tutorial</p>



<a name="476194043"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Encoding%20json%20objects%20with%20dynamic%20fields%20%28Dict%20Str%20F64%29/near/476194043" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Encoding.20json.20objects.20with.20dynamic.20fields.20.28Dict.20Str.20F64.29.html#476194043">(Oct 10 2024 at 18:19)</a>:</h4>
<p>Feel free to ask anyone about it, but I in particular have good experience building interfaces with them</p>



<a name="476288143"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Encoding%20json%20objects%20with%20dynamic%20fields%20%28Dict%20Str%20F64%29/near/476288143" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Agus Zubiaga <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Encoding.20json.20objects.20with.20dynamic.20fields.20.28Dict.20Str.20F64.29.html#476288143">(Oct 11 2024 at 03:45)</a>:</h4>
<p>I think this would be very useful in code generated from an API contract. Like type-safe GraphQL or OpenAPI clients. You don’t want those to use the derived Encode/Decode abilities.</p>



<a name="476302027"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Encoding%20json%20objects%20with%20dynamic%20fields%20%28Dict%20Str%20F64%29/near/476302027" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Encoding.20json.20objects.20with.20dynamic.20fields.20.28Dict.20Str.20F64.29.html#476302027">(Oct 11 2024 at 05:30)</a>:</h4>
<p>Couldn't GraphQL just generate the correct records and then use decode and encode?</p>



<a name="476311741"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Encoding%20json%20objects%20with%20dynamic%20fields%20%28Dict%20Str%20F64%29/near/476311741" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Niklas Konstenius <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Encoding.20json.20objects.20with.20dynamic.20fields.20.28Dict.20Str.20F64.29.html#476311741">(Oct 11 2024 at 06:32)</a>:</h4>
<p>From my perspective I don't really think that decoding JSON =&gt; Record  is very useful except for very simple cases. Optimizing for simple decoding of json into record structures  only means (if I understand it correctly) that I need to have a "simple" record typ that represents the structure of the json document 1-to-1 and then <em>parse</em> this json-record  into my domain types.  For this more advanced case its just much simpler to write a elm-style decoder from json directly to my domain model imho. </p>
<p>There could of course be something I'm missing in this Encode/Decode architecture.  I must confess that I don't have all the concepts totally clear in my head right now. :)</p>



<a name="476316740"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Encoding%20json%20objects%20with%20dynamic%20fields%20%28Dict%20Str%20F64%29/near/476316740" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nathan Kramer <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Encoding.20json.20objects.20with.20dynamic.20fields.20.28Dict.20Str.20F64.29.html#476316740">(Oct 11 2024 at 06:56)</a>:</h4>
<p>I personally struggled a bit with elm JSON decoders in terms of the learning curve. </p>
<p>Definitely powerful but a bit of a mind bending experience for me.</p>



<a name="476322685"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Encoding%20json%20objects%20with%20dynamic%20fields%20%28Dict%20Str%20F64%29/near/476322685" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Niklas Konstenius <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Encoding.20json.20objects.20with.20dynamic.20fields.20.28Dict.20Str.20F64.29.html#476322685">(Oct 11 2024 at 07:22)</a>:</h4>
<p>I struggled with json decoders in Elm too. :-)</p>
<p>I <em>do</em> think that json =&gt; record is very good for beginners and simple usecases. But the moment you want something that is not easily represented 1-to-1 as a record it starts to get more complicated to <em>not</em> use elm style decoders imho. </p>
<p>A good example is sum-types  and how the "tag" are represented in the json structure.</p>



<a name="476362698"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Encoding%20json%20objects%20with%20dynamic%20fields%20%28Dict%20Str%20F64%29/near/476362698" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Agus Zubiaga <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Encoding.20json.20objects.20with.20dynamic.20fields.20.28Dict.20Str.20F64.29.html#476362698">(Oct 11 2024 at 11:00)</a>:</h4>
<p>Yeah, exactly. I think this applies primarily to clients, servers are more likely to match because they own the structure.</p>



<a name="476363863"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Encoding%20json%20objects%20with%20dynamic%20fields%20%28Dict%20Str%20F64%29/near/476363863" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Agus Zubiaga <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Encoding.20json.20objects.20with.20dynamic.20fields.20.28Dict.20Str.20F64.29.html#476363863">(Oct 11 2024 at 11:07)</a>:</h4>
<p>When you’re building a client, it’s quite common that (even if it’s within the same company) the structure defined in the API is inconvenient for your use case. Things might be too nested, too general, have confusing names, or abuse primitives.</p>



<a name="476364452"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Encoding%20json%20objects%20with%20dynamic%20fields%20%28Dict%20Str%20F64%29/near/476364452" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Agus Zubiaga <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Encoding.20json.20objects.20with.20dynamic.20fields.20.28Dict.20Str.20F64.29.html#476364452">(Oct 11 2024 at 11:11)</a>:</h4>
<p>With<code>dillonkearns/elm-graphql</code>, I can deal with all of that complexity at the border right where I define the query selection.</p>



<a name="476365379"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Encoding%20json%20objects%20with%20dynamic%20fields%20%28Dict%20Str%20F64%29/near/476365379" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Agus Zubiaga <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Encoding.20json.20objects.20with.20dynamic.20fields.20.28Dict.20Str.20F64.29.html#476365379">(Oct 11 2024 at 11:17)</a>:</h4>
<p>APIs become messy over time as they evolve, but a client is often relying on a subset or a specific point in time where certain properties hold true. This is the mismatch that warrants this approach.</p>



<a name="476365920"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Encoding%20json%20objects%20with%20dynamic%20fields%20%28Dict%20Str%20F64%29/near/476365920" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Agus Zubiaga <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Encoding.20json.20objects.20with.20dynamic.20fields.20.28Dict.20Str.20F64.29.html#476365920">(Oct 11 2024 at 11:21)</a>:</h4>
<p>Another thing this applies to is database schemas, which is why I designed the <code>roc-pg</code>’s selection builder after <code>elm-graphql</code>’s. You can rename columns, map them, or even change the structure at the query.</p>



<a name="476368035"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Encoding%20json%20objects%20with%20dynamic%20fields%20%28Dict%20Str%20F64%29/near/476368035" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Agus Zubiaga <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Encoding.20json.20objects.20with.20dynamic.20fields.20.28Dict.20Str.20F64.29.html#476368035">(Oct 11 2024 at 11:33)</a>:</h4>
<p>All that said, that applies at a certain level of complexity and depth. There’s so many clients that only need to work with a few fields in mostly flat structures, and the derived abilities would work great <span aria-label="grinning" class="emoji emoji-1f600" role="img" title="grinning">:grinning:</span></p>



<a name="476410016"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Encoding%20json%20objects%20with%20dynamic%20fields%20%28Dict%20Str%20F64%29/near/476410016" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Encoding.20json.20objects.20with.20dynamic.20fields.20.28Dict.20Str.20F64.29.html#476410016">(Oct 11 2024 at 15:20)</a>:</h4>
<p>I'd be curious which of these critiques apply to serde from rust. It is used very comprehensively in the rust ecosystem. I think people rarely reach for something else. (Graphql maybe being special due to flexible queries). But for most things, I think it full covers everything. So encode and decode should theoretically as well.</p>



<a name="476419611"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Encoding%20json%20objects%20with%20dynamic%20fields%20%28Dict%20Str%20F64%29/near/476419611" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Isaac Van Doren <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Encoding.20json.20objects.20with.20dynamic.20fields.20.28Dict.20Str.20F64.29.html#476419611">(Oct 11 2024 at 16:13)</a>:</h4>
<p>The jackson library is very popular in Java and it is similar in that your json is serialized and deserialized based on the fields on your objects so usually the structure of your json and objects is very closely related. That being said, there is a lot of customization you can do that makes it more flexible. The kind I end up using most is field level customizations like specifying how a date should be formatted.</p>



<a name="476426252"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Encoding%20json%20objects%20with%20dynamic%20fields%20%28Dict%20Str%20F64%29/near/476426252" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Niklas Konstenius <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Encoding.20json.20objects.20with.20dynamic.20fields.20.28Dict.20Str.20F64.29.html#476426252">(Oct 11 2024 at 16:56)</a>:</h4>
<p>I would argue that the way json serialization are done in Java (with for example the Jackson library) more has to do with tradition and Javas background in OOP than it has to do with being  a "good" way. <span aria-label="smile" class="emoji emoji-1f642" role="img" title="smile">:smile:</span> </p>
<p>I have seen (and produced myself) lots of Java code with tons and tons of annotations polluting the carefully crafted domain objects just to configure how the objects properties should serialize to json. The rationale for all this noise  is that its "just configuration" and somehow configuration is always better than code...</p>
<p>Imho, simple Elm-style transformation functions that maps the domain objects to it's json representation often is way more compact, more flexible and easier to read than all the  annotation mess and I really wish these functional approaches would find its way into Java land. Tradition is hard to change though...</p>
<p>Since Roc aims to be a functional language I really hope Roc will take the more functional approach, or at least have good support for both approaches.</p>



<a name="476431052"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Encoding%20json%20objects%20with%20dynamic%20fields%20%28Dict%20Str%20F64%29/near/476431052" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Encoding.20json.20objects.20with.20dynamic.20fields.20.28Dict.20Str.20F64.29.html#476431052">(Oct 11 2024 at 17:29)</a>:</h4>
<p>I'm sure both approaches can work and will be supported. I think with decode instead of annotations it would be specified in the types. Occasionally with custom abilities impls.</p>
<p>Like you might have a <code>Nullable I64</code> json field that allows for the field to be missing.</p>
<p>I'm mostly just curious where decode will fall short and why. Is it personal preference or something more fundamental. I probably should look more into where serde falls short cause decode is based on serde.</p>



<a name="476434807"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Encoding%20json%20objects%20with%20dynamic%20fields%20%28Dict%20Str%20F64%29/near/476434807" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Encoding.20json.20objects.20with.20dynamic.20fields.20.28Dict.20Str.20F64.29.html#476434807">(Oct 11 2024 at 17:56)</a>:</h4>
<p>I don't think either approach is more or less functional than the other <span aria-label="big smile" class="emoji emoji-1f604" role="img" title="big smile">:big_smile:</span></p>



<a name="476434885"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Encoding%20json%20objects%20with%20dynamic%20fields%20%28Dict%20Str%20F64%29/near/476434885" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Encoding.20json.20objects.20with.20dynamic.20fields.20.28Dict.20Str.20F64.29.html#476434885">(Oct 11 2024 at 17:57)</a>:</h4>
<p>one is more flexible but also more repetitive in common cases</p>



<a name="476434948"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Encoding%20json%20objects%20with%20dynamic%20fields%20%28Dict%20Str%20F64%29/near/476434948" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Encoding.20json.20objects.20with.20dynamic.20fields.20.28Dict.20Str.20F64.29.html#476434948">(Oct 11 2024 at 17:57)</a>:</h4>
<p>that's the main tradeoff I see in terms of usage</p>



<a name="476434999"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Encoding%20json%20objects%20with%20dynamic%20fields%20%28Dict%20Str%20F64%29/near/476434999" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Encoding.20json.20objects.20with.20dynamic.20fields.20.28Dict.20Str.20F64.29.html#476434999">(Oct 11 2024 at 17:57)</a>:</h4>
<p>there's also a major learning curve gap between them for common cases though</p>



<a name="476438192"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Encoding%20json%20objects%20with%20dynamic%20fields%20%28Dict%20Str%20F64%29/near/476438192" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Niklas Konstenius <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Encoding.20json.20objects.20with.20dynamic.20fields.20.28Dict.20Str.20F64.29.html#476438192">(Oct 11 2024 at 18:20)</a>:</h4>
<blockquote>
<p>I'm mostly just curious where decode will fall short and why. Is it personal preference or something more fundamental.</p>
</blockquote>
<p>For me it's a personal preference of wanting to have a clear separation of the domain model and it's representation as json. That's why I don't usually find generic json =&gt; record mappings (and the other way around) that useful. In Java that means I often end up with a set of simple classes representing the wanted json-structure (which is serialized/deserialized using jackson or similar) and then a set of transformation functions to and from the domain-model.</p>
<p>Since the json-model is just something thats needed by Jackson its just boilerplate and I would rather use an Elm style  decoder/encoder pattern to do the mapping to/from json directly. For me this is a way more ergonomic / flexible pattern than the traditional style using annotations and reflection through jackson. </p>
<p>But I do understand that for simple usecases and beginners this may be a big hurdle.</p>



<a name="476445112"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Encoding%20json%20objects%20with%20dynamic%20fields%20%28Dict%20Str%20F64%29/near/476445112" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Niklas Konstenius <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Encoding.20json.20objects.20with.20dynamic.20fields.20.28Dict.20Str.20F64.29.html#476445112">(Oct 11 2024 at 19:14)</a>:</h4>
<blockquote>
<p>Like you might have a <code>Nullable I64</code> json field that allows for the field to be missing.</p>
</blockquote>
<p>This is actually a good example of what I DON'T want : smile:</p>
<p>I do not want my domain types be polluted by stuff that only makes sense in the context of how it´s represented as json.</p>



<a name="476452814"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Encoding%20json%20objects%20with%20dynamic%20fields%20%28Dict%20Str%20F64%29/near/476452814" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Encoding.20json.20objects.20with.20dynamic.20fields.20.28Dict.20Str.20F64.29.html#476452814">(Oct 11 2024 at 20:16)</a>:</h4>
<p>Fair enough. I think the standard for more complex inputs and something like serde is to represent the input exactly, map it into the happy land of a typed language with all the worts like <code>Nullable</code> (this guarantees it is fully represented and subsequent logic handles all cases), map it to a nice struct for domain use and without worts.</p>



<a name="476452870"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Encoding%20json%20objects%20with%20dynamic%20fields%20%28Dict%20Str%20F64%29/near/476452870" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Encoding.20json.20objects.20with.20dynamic.20fields.20.28Dict.20Str.20F64.29.html#476452870">(Oct 11 2024 at 20:17)</a>:</h4>
<p>So you still have a domain type and logic. It is just split into two parts.</p>



<a name="476535436"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Encoding%20json%20objects%20with%20dynamic%20fields%20%28Dict%20Str%20F64%29/near/476535436" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Niklas Konstenius <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Encoding.20json.20objects.20with.20dynamic.20fields.20.28Dict.20Str.20F64.29.html#476535436">(Oct 12 2024 at 16:24)</a>:</h4>
<p>I've been thinking a bit and realised that the only thing I really need is a way to Decode / Encode json-text into a general ADT  like this:</p>
<div class="codehilite"><pre><span></span><code>Json : [
    True,
    False,
    Null,
    Number F64,
    String Str,
    Array (List Json),
    Object (List (Str, Json)),
]
</code></pre></div>
<p>Do you think this is something that could be achieved using the Roc Decode/Encode functions and the existing Json library? Or maybe something as general as this is out of the scope for the Decode/Encode feature?</p>



<a name="476537818"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Encoding%20json%20objects%20with%20dynamic%20fields%20%28Dict%20Str%20F64%29/near/476537818" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Encoding.20json.20objects.20with.20dynamic.20fields.20.28Dict.20Str.20F64.29.html#476537818">(Oct 12 2024 at 17:00)</a>:</h4>
<p>With a custom implementation of the ability, that should be doable. Then you could encode/decode any json.</p>



<a name="476537931"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Encoding%20json%20objects%20with%20dynamic%20fields%20%28Dict%20Str%20F64%29/near/476537931" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Encoding.20json.20objects.20with.20dynamic.20fields.20.28Dict.20Str.20F64.29.html#476537931">(Oct 12 2024 at 17:02)</a>:</h4>
<p>That said, may be faster in many cases to lazily decode json. That way you only load the parts of the message you care about. That would not be possible with encode/decode.</p>



<a name="476538520"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Encoding%20json%20objects%20with%20dynamic%20fields%20%28Dict%20Str%20F64%29/near/476538520" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Niklas Konstenius <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Encoding.20json.20objects.20with.20dynamic.20fields.20.28Dict.20Str.20F64.29.html#476538520">(Oct 12 2024 at 17:11)</a>:</h4>
<p>Not sure about what you mean by <em>lazy</em> but being able to just extract specific parts of a json-document is really valuable and something I do a lot.  I have not realised that this could be a problem with Decode though.</p>
<p>Do you mean that the record structure must match the json structure <em>exactly</em>  (like all fields must be included) to be able to decode it?</p>



<a name="476538736"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Encoding%20json%20objects%20with%20dynamic%20fields%20%28Dict%20Str%20F64%29/near/476538736" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Encoding.20json.20objects.20with.20dynamic.20fields.20.28Dict.20Str.20F64.29.html#476538736">(Oct 12 2024 at 17:14)</a>:</h4>
<p>What I mean is Decode will parse the entire json document into a roc record. If the document is 100MB and you want to access 1 specific field, that is a huge waste of time parsing the entire document.</p>



<a name="476538797"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Encoding%20json%20objects%20with%20dynamic%20fields%20%28Dict%20Str%20F64%29/near/476538797" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Encoding.20json.20objects.20with.20dynamic.20fields.20.28Dict.20Str.20F64.29.html#476538797">(Oct 12 2024 at 17:15)</a>:</h4>
<p>A lazy parser could do the minimal work to grab the one field. Then if you need a second field, it would again do minimal work to grab the second field.</p>
<p>Really depends on the use case though. If you are always gonna access most fields, this won't matter.</p>



<a name="476538918"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Encoding%20json%20objects%20with%20dynamic%20fields%20%28Dict%20Str%20F64%29/near/476538918" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Encoding.20json.20objects.20with.20dynamic.20fields.20.28Dict.20Str.20F64.29.html#476538918">(Oct 12 2024 at 17:17)</a>:</h4>
<p>In tag terms, it might represent json as:</p>
<div class="codehilite" data-code-language="Elm"><pre><span></span><code><span class="kt">Json</span><span class="w"> </span><span class="nf">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">    </span><span class="kt">True</span><span class="p">,</span>
<span class="w">    </span><span class="kt">False</span><span class="p">,</span>
<span class="w">    </span><span class="kt">Null</span><span class="p">,</span>
<span class="w">    </span><span class="kt">Number</span><span class="w"> </span><span class="kt">F64</span><span class="p">,</span>
<span class="w">    </span><span class="kt">String</span><span class="w"> </span><span class="kt">Str</span><span class="p">,</span>
<span class="w">    </span><span class="kt">Array</span><span class="w"> </span><span class="p">(</span><span class="kt">List</span><span class="w"> </span><span class="kt">Json</span><span class="p">),</span>
<span class="w">    </span><span class="kt">Object</span><span class="w"> </span><span class="p">(</span><span class="kt">List</span><span class="w"> </span><span class="p">(</span><span class="kt">Str</span><span class="p">,</span><span class="w"> </span><span class="kt">Json</span><span class="p">)),</span>
<span class="w">    </span><span class="kt">Lazy</span><span class="w"> </span><span class="p">({}</span><span class="w"> </span><span class="nf">-&gt;</span><span class="w"> </span><span class="kt">Json</span><span class="p">),</span>
<span class="p">]</span>
</code></pre></div>
<p>This way, it can stop parsing part way instead of parsing everything.</p>



<a name="476539150"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Encoding%20json%20objects%20with%20dynamic%20fields%20%28Dict%20Str%20F64%29/near/476539150" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Niklas Konstenius <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Encoding.20json.20objects.20with.20dynamic.20fields.20.28Dict.20Str.20F64.29.html#476539150">(Oct 12 2024 at 17:20)</a>:</h4>
<p>I'm not an expert on parsing but I'm not sure how one could parse a JSON file without reading  the complete document? I mean, if just the last closing curly bracket is missing the document is invalid.</p>



<a name="476539327"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Encoding%20json%20objects%20with%20dynamic%20fields%20%28Dict%20Str%20F64%29/near/476539327" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Encoding.20json.20objects.20with.20dynamic.20fields.20.28Dict.20Str.20F64.29.html#476539327">(Oct 12 2024 at 17:23)</a>:</h4>
<p>2 main options:</p>
<ol>
<li>ignore those kinds of errors and trust the main body of json is valid (or that it doesn't matter if it is invalid)</li>
</ol>
<p>For example, if I want to get <code>foo.bar</code>, I can still do so from this:</p>
<div class="codehilite" data-code-language="JSON"><pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="nt">"baz"</span><span class="p">:</span><span class="w"> </span><span class="p">[]</span>
<span class="w">  </span><span class="nt">"foo"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">"something"</span><span class="p">:</span><span class="w"> </span><span class="s2">"abc"</span><span class="p">,</span>
<span class="w">    </span><span class="nt">"bar"</span><span class="p">:</span><span class="w"> </span><span class="mi">42</span><span class="p">,</span>
<span class="w">    </span><span class="nt">"other"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span>
</code></pre></div>
<ol start="2">
<li>do a much quicker single scan to validate the brackets and braces first.</li>
</ol>



<a name="476540297"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Encoding%20json%20objects%20with%20dynamic%20fields%20%28Dict%20Str%20F64%29/near/476540297" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Niklas Konstenius <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Encoding.20json.20objects.20with.20dynamic.20fields.20.28Dict.20Str.20F64.29.html#476540297">(Oct 12 2024 at 17:38)</a>:</h4>
<p>Still not sure how one could do 2 without proper parsing but as I said, I'm not an parsing expert. <span aria-label="smile" class="emoji emoji-1f642" role="img" title="smile">:smile:</span> </p>
<p>To me it seems like there is an opportunity to fill a missing space in the Roc ecosystem by writing a generic JSON parser library ( json text =&gt; tag union ADT) that can be used as a building block for other libraries like for example Elm style json-decoder / encoder. </p>
<p>I'm tempted to have a go at it to be honest. Would be a great way to learn more about Roc  as a programming language too.</p>



<a name="476541067"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Encoding%20json%20objects%20with%20dynamic%20fields%20%28Dict%20Str%20F64%29/near/476541067" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Encoding.20json.20objects.20with.20dynamic.20fields.20.28Dict.20Str.20F64.29.html#476541067">(Oct 12 2024 at 17:50)</a>:</h4>
<blockquote>
<p>by writing a generic JSON parser library</p>
</blockquote>
<p>That could definitely be useful for when decode isn't enough. That said, Decode should be able to generate the tag you shared above.</p>



<a name="476541399"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Encoding%20json%20objects%20with%20dynamic%20fields%20%28Dict%20Str%20F64%29/near/476541399" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Encoding.20json.20objects.20with.20dynamic.20fields.20.28Dict.20Str.20F64.29.html#476541399">(Oct 12 2024 at 17:55)</a>:</h4>
<blockquote>
<p>Still not sure how one could do 2 without proper parsing but as I said</p>
</blockquote>
<p>You have to be delaying some of the errors if you want max perf. So it is a fundamental trade off. That said, validating an entire json has correct syntax can still be faster than actual parsing the json into a nested tag</p>



<a name="476541730"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Encoding%20json%20objects%20with%20dynamic%20fields%20%28Dict%20Str%20F64%29/near/476541730" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Niklas Konstenius <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Encoding.20json.20objects.20with.20dynamic.20fields.20.28Dict.20Str.20F64.29.html#476541730">(Oct 12 2024 at 18:00)</a>:</h4>
<blockquote>
<p>That said, Decode should be able to generate the tag you shared above.</p>
</blockquote>
<p>Cool, I'll have a look.  It it is not obvious for me where to start though.  <br>
Is it the <code>DecoderFormatting</code> interface that i should implement to make this work?</p>



<a name="476542531"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Encoding%20json%20objects%20with%20dynamic%20fields%20%28Dict%20Str%20F64%29/near/476542531" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Encoding.20json.20objects.20with.20dynamic.20fields.20.28Dict.20Str.20F64.29.html#476542531">(Oct 12 2024 at 18:13)</a>:</h4>
<p>You would implement <code>Decoding</code> then using the existing roc json decoder in combination. It would provide ways to decode all of the primitives. You need to map them to the the generic tag structure.</p>



<a name="476544858"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Encoding%20json%20objects%20with%20dynamic%20fields%20%28Dict%20Str%20F64%29/near/476544858" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Niklas Konstenius <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Encoding.20json.20objects.20with.20dynamic.20fields.20.28Dict.20Str.20F64.29.html#476544858">(Oct 12 2024 at 18:52)</a>:</h4>
<p>Ok, I think I understand how one could use the DecoderFormatter from roc -json to parse the primitives even though it feels a little bit <em>backwards</em> to use parsers  named after Roc primitives to parse json elements. But thats just a consequence of Encode/Decode being an generalised  abstraction of serialising Roc types I guess.</p>



<a name="476545448"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Encoding%20json%20objects%20with%20dynamic%20fields%20%28Dict%20Str%20F64%29/near/476545448" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Encoding.20json.20objects.20with.20dynamic.20fields.20.28Dict.20Str.20F64.29.html#476545448">(Oct 12 2024 at 19:01)</a>:</h4>
<p>Yeah...</p>



<a name="476545505"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Encoding%20json%20objects%20with%20dynamic%20fields%20%28Dict%20Str%20F64%29/near/476545505" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Encoding.20json.20objects.20with.20dynamic.20fields.20.28Dict.20Str.20F64.29.html#476545505">(Oct 12 2024 at 19:02)</a>:</h4>
<p>You also can just write a direct parser</p>



<a name="476545510"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Encoding%20json%20objects%20with%20dynamic%20fields%20%28Dict%20Str%20F64%29/near/476545510" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Encoding.20json.20objects.20with.20dynamic.20fields.20.28Dict.20Str.20F64.29.html#476545510">(Oct 12 2024 at 19:02)</a>:</h4>
<p>Might be more reasonable with your goals</p>



<a name="476545920"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Encoding%20json%20objects%20with%20dynamic%20fields%20%28Dict%20Str%20F64%29/near/476545920" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Niklas Konstenius <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Encoding.20json.20objects.20with.20dynamic.20fields.20.28Dict.20Str.20F64.29.html#476545920">(Oct 12 2024 at 19:09)</a>:</h4>
<p>Yes I think I'll aim  for the simplest possible parser from text =&gt; ADT that can be used to build higher level features on as a proof of concept. </p>
<p>I read in another thread something about implementing simdjson as a very fast built in support for JSON in the language itself.</p>
<p>If that feature could be used to provide the  ADT  a parser built with Roc would be obsolete pretty fast :-)</p>



<a name="476547227"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Encoding%20json%20objects%20with%20dynamic%20fields%20%28Dict%20Str%20F64%29/near/476547227" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Encoding.20json.20objects.20with.20dynamic.20fields.20.28Dict.20Str.20F64.29.html#476547227">(Oct 12 2024 at 19:31)</a>:</h4>
<p>I think <span class="user-mention" data-user-id="701847">@Monica</span> has made one of these for a talk she gave recently on Roc.</p>



<a name="476547297"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Encoding%20json%20objects%20with%20dynamic%20fields%20%28Dict%20Str%20F64%29/near/476547297" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Encoding.20json.20objects.20with.20dynamic.20fields.20.28Dict.20Str.20F64.29.html#476547297">(Oct 12 2024 at 19:32)</a>:</h4>
<p>I would like to include decoding into a generic ADT JsonValue into roc-json too, I think it will be helpful.</p>



<a name="476547415"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Encoding%20json%20objects%20with%20dynamic%20fields%20%28Dict%20Str%20F64%29/near/476547415" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Encoding.20json.20objects.20with.20dynamic.20fields.20.28Dict.20Str.20F64.29.html#476547415">(Oct 12 2024 at 19:35)</a>:</h4>
<p><a href="https://github.com/roc-lang/book-of-examples/pull/68">https://github.com/roc-lang/book-of-examples/pull/68</a></p>



<a name="476584005"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Encoding%20json%20objects%20with%20dynamic%20fields%20%28Dict%20Str%20F64%29/near/476584005" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Niklas Konstenius <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Encoding.20json.20objects.20with.20dynamic.20fields.20.28Dict.20Str.20F64.29.html#476584005">(Oct 13 2024 at 07:25)</a>:</h4>
<p>Cool, Monica seems to like elm style decoding/encoding as much as I do. <span aria-label="smile" class="emoji emoji-1f642" role="img" title="smile">:smile:</span></p>
<p>As far as I could see Monicas example left out the step of parsing json text to the the Json ADT (or tag union which I understand is the correct term in Roc), right? </p>
<p>I think that makes the case for a library (or a bultin way) of generic json parsing to ADT in Roc even stronger. Anyone that reads that example and thinks, cool I want to use that technique in may app, will otherwise inevitably be forced to first implement his own json parser. That would be really confusing for a beginner I think...</p>



<a name="476585690"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Encoding%20json%20objects%20with%20dynamic%20fields%20%28Dict%20Str%20F64%29/near/476585690" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Niklas Konstenius <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Encoding.20json.20objects.20with.20dynamic.20fields.20.28Dict.20Str.20F64.29.html#476585690">(Oct 13 2024 at 07:35)</a>:</h4>
<p>Another case thats a confusing for a Roc beginner like me is the RestApi exercise on Exercism. You can't solve it using Roc's bultin Encode/Decode but instead have to resort to string concatenation hacks just to serialise a json object.  This certainly is not something that makes Roc shine compared to other languages. I was really disappointed myself by this (and the reason why I started this thread in the first place).</p>



<a name="476586211"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Encoding%20json%20objects%20with%20dynamic%20fields%20%28Dict%20Str%20F64%29/near/476586211" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Niklas Konstenius <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Encoding.20json.20objects.20with.20dynamic.20fields.20.28Dict.20Str.20F64.29.html#476586211">(Oct 13 2024 at 07:43)</a>:</h4>
<p>But I should stop whining now and instead start implementing my json parser <span aria-label="smile" class="emoji emoji-1f642" role="img" title="smile">:smile:</span></p>



<a name="476623601"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Encoding%20json%20objects%20with%20dynamic%20fields%20%28Dict%20Str%20F64%29/near/476623601" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Encoding.20json.20objects.20with.20dynamic.20fields.20.28Dict.20Str.20F64.29.html#476623601">(Oct 13 2024 at 17:40)</a>:</h4>
<blockquote>
<p>You can't solve it using Roc's bultin Encode/Decode</p>
</blockquote>
<p>Is this only due to dictionaries not encoding/decoding or are there other issues for that exercise specifically?</p>



<a name="476631377"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Encoding%20json%20objects%20with%20dynamic%20fields%20%28Dict%20Str%20F64%29/near/476631377" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Niklas Konstenius <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Encoding.20json.20objects.20with.20dynamic.20fields.20.28Dict.20Str.20F64.29.html#476631377">(Oct 13 2024 at 19:38)</a>:</h4>
<p>No, I think it's only the Dict encoding that's missing.</p>



<a name="476724573"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Encoding%20json%20objects%20with%20dynamic%20fields%20%28Dict%20Str%20F64%29/near/476724573" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anton <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Encoding.20json.20objects.20with.20dynamic.20fields.20.28Dict.20Str.20F64.29.html#476724573">(Oct 14 2024 at 09:03)</a>:</h4>
<blockquote>
<p>Another case thats a confusing for a Roc beginner like me is the RestApi exercise on Exercism. You can't solve it using Roc's bultin Encode/Decode but instead have to resort to string concatenation hacks just to serialise a json object. This certainly is not something that makes Roc shine compared to other languages. I was really disappointed myself by this (and the reason why I started this thread in the first place).</p>
</blockquote>
<p>Perhaps we should take out  this exercise until dict encoding/decoding is fixed <span class="user-mention" data-user-id="734214">@Aurélien Geron</span>?</p>



<a name="476809401"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Encoding%20json%20objects%20with%20dynamic%20fields%20%28Dict%20Str%20F64%29/near/476809401" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Monica <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Encoding.20json.20objects.20with.20dynamic.20fields.20.28Dict.20Str.20F64.29.html#476809401">(Oct 14 2024 at 15:17)</a>:</h4>
<p><span class="user-mention silent" data-user-id="544552">Niklas Konstenius</span> <a href="#narrow/stream/231634-beginners/topic/Encoding.20json.20objects.20with.20dynamic.20fields.20.28Dict.20Str.20F64.29/near/476584005">said</a>:</p>
<blockquote>
<p>Cool, Monica seems to like elm style decoding/encoding as much as I do. <span aria-label="smile" class="emoji emoji-1f642" role="img" title="smile">:smile:</span></p>
<p>As far as I could see Monicas example left out the step of parsing json text to the the Json ADT (or tag union which I understand is the correct term in Roc), right? </p>
<p>I think that makes the case for a library (or a bultin way) of generic json parsing to ADT in Roc even stronger. Anyone that reads that example and thinks, cool I want to use that technique in may app, will otherwise inevitably be forced to first implement his own json parser. That would be really confusing for a beginner I think...</p>
</blockquote>
<p>Sorry bit late to the party - yeh my example is strictly Json decoding from a tag union/ADT representation into a domain model, along with some helper functions to abstract away the error handling bits.</p>



<a name="476847476"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Encoding%20json%20objects%20with%20dynamic%20fields%20%28Dict%20Str%20F64%29/near/476847476" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Aurélien Geron <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Encoding.20json.20objects.20with.20dynamic.20fields.20.28Dict.20Str.20F64.29.html#476847476">(Oct 14 2024 at 20:21)</a>:</h4>
<p><span class="user-mention silent" data-user-id="361169">Anton</span> <a href="#narrow/stream/231634-beginners/topic/Encoding.20json.20objects.20with.20dynamic.20fields.20.28Dict.20Str.20F64.29/near/476724573">said</a>:</p>
<blockquote>
<p>Perhaps we should take out  this exercise until dict encoding/decoding is fixed <span class="user-mention silent" data-user-id="734214">Aurélien Geron</span>?</p>
</blockquote>
<p>The platform does not allow a track to delete an exercise, but we can <a href="https://exercism.org/docs/building/tracks/deprecated-exercises">mark it as deprecated</a>: it will make no change to anyone who has already started the exercise, but it will hide it from everyone else. </p>
<p>I see two other options:</p>
<ol>
<li>add a disclaimer in <code>.docs/instructions.append.md</code>, so users know what to expect and they can skip the exercise if they want to.</li>
<li>add helper functions in the stub code <code>RestApi.roc</code></li>
</ol>
<p>I think I would prefer alternative 1, but it's not a strong opinion, I'm happy to go any direction here.</p>



<a name="476853302"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Encoding%20json%20objects%20with%20dynamic%20fields%20%28Dict%20Str%20F64%29/near/476853302" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Encoding.20json.20objects.20with.20dynamic.20fields.20.28Dict.20Str.20F64.29.html#476853302">(Oct 14 2024 at 21:21)</a>:</h4>
<p>we could also prioritize fixing that <span aria-label="grinning face with smiling eyes" class="emoji emoji-1f601" role="img" title="grinning face with smiling eyes">:grinning_face_with_smiling_eyes:</span></p>



<a name="476853479"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Encoding%20json%20objects%20with%20dynamic%20fields%20%28Dict%20Str%20F64%29/near/476853479" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Encoding.20json.20objects.20with.20dynamic.20fields.20.28Dict.20Str.20F64.29.html#476853479">(Oct 14 2024 at 21:23)</a>:</h4>
<p>Yeah, it would be really nice to have Dict supported. I thought someone worked on it for a bit, though I've not been able to find the old PR or branch (or remember who). I thought it was <span class="user-mention" data-user-id="611722">@Isaac Van Doren</span>??</p>



<a name="476853617"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Encoding%20json%20objects%20with%20dynamic%20fields%20%28Dict%20Str%20F64%29/near/476853617" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Encoding.20json.20objects.20with.20dynamic.20fields.20.28Dict.20Str.20F64.29.html#476853617">(Oct 14 2024 at 21:24)</a>:</h4>
<p>Is it a big job to do? I don't have much idea in that part of the compiler</p>



<a name="476854779"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Encoding%20json%20objects%20with%20dynamic%20fields%20%28Dict%20Str%20F64%29/near/476854779" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Isaac Van Doren <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Encoding.20json.20objects.20with.20dynamic.20fields.20.28Dict.20Str.20F64.29.html#476854779">(Oct 14 2024 at 21:36)</a>:</h4>
<p>I took a stab at decoding tag unions not Dict, but I agree that fixing it sounds like a good approach <span aria-label="smiley" class="emoji emoji-1f603" role="img" title="smiley">:smiley:</span></p>



<a name="476928308"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Encoding%20json%20objects%20with%20dynamic%20fields%20%28Dict%20Str%20F64%29/near/476928308" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Oskar Hahn <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Encoding.20json.20objects.20with.20dynamic.20fields.20.28Dict.20Str.20F64.29.html#476928308">(Oct 15 2024 at 07:58)</a>:</h4>
<p>Decoding Tag Unions is one of my most wanted issues. If you could solve it in the same run, I would be so thankful.<span aria-label="pleading face" class="emoji emoji-1f97a" role="img" title="pleading face">:pleading_face:</span><span aria-label="kissing cat" class="emoji emoji-1f63d" role="img" title="kissing cat">:kissing_cat:</span></p>



<a name="476935531"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Encoding%20json%20objects%20with%20dynamic%20fields%20%28Dict%20Str%20F64%29/near/476935531" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Niklas Konstenius <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Encoding.20json.20objects.20with.20dynamic.20fields.20.28Dict.20Str.20F64.29.html#476935531">(Oct 15 2024 at 08:38)</a>:</h4>
<blockquote>
<p>I took a stab at decoding tag unions...</p>
</blockquote>
<p>Cool. I'm curious in how the design of decoding tag unions would work from a user perspective? <br>
What kind of structures would be possible to decode? I guess it has to be the "inverse" of the <code>tag</code> function in <code>EncoderFormatting</code> in some way?</p>



<a name="476955858"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Encoding%20json%20objects%20with%20dynamic%20fields%20%28Dict%20Str%20F64%29/near/476955858" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anton <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Encoding.20json.20objects.20with.20dynamic.20fields.20.28Dict.20Str.20F64.29.html#476955858">(Oct 15 2024 at 10:22)</a>:</h4>
<blockquote>
<p>they can skip the exercise if they want to.</p>
</blockquote>
<p>Can exercises be skipped? I know there is some kind of unlocking of exercises mechanism</p>



<a name="476957049"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Encoding%20json%20objects%20with%20dynamic%20fields%20%28Dict%20Str%20F64%29/near/476957049" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Oskar Hahn <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Encoding.20json.20objects.20with.20dynamic.20fields.20.28Dict.20Str.20F64.29.html#476957049">(Oct 15 2024 at 10:30)</a>:</h4>
<p>Yes. For roc (at the Moment) no exercise is locked. You can start with any of them.</p>



<a name="476977323"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Encoding%20json%20objects%20with%20dynamic%20fields%20%28Dict%20Str%20F64%29/near/476977323" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Isaac Van Doren <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Encoding.20json.20objects.20with.20dynamic.20fields.20.28Dict.20Str.20F64.29.html#476977323">(Oct 15 2024 at 12:26)</a>:</h4>
<blockquote>
<p>Cool. I'm curious in how the design of decoding tag unions would work from a user perspective?<br>
What kind of structures would be possible to decode? I guess it has to be the "inverse" of the <code>tag</code> function in <code>EncoderFormatting</code> in some way?</p>
</blockquote>
<p>It would be up to the DecoderFormatting implementation (such as roc-json) to decide how to handle the decoding. I think the way that makes the most sense as a start would be to decode the following json into the following roc:</p>
<div class="codehilite" data-code-language="JSON"><pre><span></span><code><span class="p">[{</span><span class="w"> </span><span class="nt">"a"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nt">"field1"</span><span class="p">:</span><span class="w"> </span><span class="s2">"foo"</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">},</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nt">"b"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nt">"field2"</span><span class="p">:</span><span class="w"> </span><span class="s2">"bar"</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">}]</span>
</code></pre></div>
<div class="codehilite" data-code-language="Elm"><pre><span></span><code><span class="p">[</span><span class="kt">A</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nv">field1</span><span class="nf">:</span><span class="w"> </span><span class="s">"foo"</span><span class="w"> </span><span class="p">},</span><span class="w"> </span><span class="kt">B</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nv">field2</span><span class="nf">:</span><span class="w"> </span><span class="s">"bar"</span><span class="w"> </span><span class="p">}]</span>
</code></pre></div>
<p>But there could be other approaches. Special casing for <code>null</code> would probably be a good thing to include also.</p>



<hr><p>Last updated: Nov 01 2025 at 12:13 UTC</p>
</html>