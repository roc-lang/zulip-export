<html>
<head><meta charset="utf-8"><title>✔ I need help understanding opaque types · beginners · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/index.html">beginners</a></h2>
<h3>Topic: <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/.E2.9C.94.20I.20need.20help.20understanding.20opaque.20types.html">✔ I need help understanding opaque types</a></h3>

<hr>

<base href="https://roc.zulipchat.com">

<head><link href="https://roc-lang.github.io/zulip-export/style.css" rel="stylesheet"></head>

<a name="501242783"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/%E2%9C%94%20I%20need%20help%20understanding%20opaque%20types/near/501242783" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Kevin Hovsäter <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/.E2.9C.94.20I.20need.20help.20understanding.20opaque.20types.html#501242783">(Feb 22 2025 at 08:40)</a>:</h4>
<p>For my upcoming talk about parser combinators, I've defined the following types:</p>
<div class="codehilite" data-code-language="roc"><pre><span></span><code>Parser a := Str -&gt; ParseResult a
ParseResult a : Result { value : a, rest : Str } Str
</code></pre></div>
<p>An opaque <code>Parser</code> type and a <code>ParseResult</code> type alias. I now tried to define a simple parser like so:</p>
<div class="codehilite" data-code-language="roc"><pre><span></span><code>parse_digit : Parser U8
parse_digit = |input|
  Err("not implemented")
</code></pre></div>
<p>This fails with the following message:</p>
<div class="codehilite"><pre><span></span><code>── TYPE MISMATCH in Parser.roc ─────────────────────────────────────────────────

Something is off with the body of the parse_digit definition:

7│   parse_digit : Parser U8
8│&gt;  parse_digit = |input|
9│&gt;    Err(&quot;not implemented&quot;)

The body is an anonymous function of type:

    (* -&gt; [Err Str])

But the type annotation on parse_digit says it should be:

    Parser U8
</code></pre></div>
<p>I'm not entirely sure why as I've annotated <code>parse_digit</code> as <code>Parser U8</code>, but ok. Next, after looking through the Zulip conversations I found out that you can <code>@</code> prefix the lambda. Let's try that.</p>
<div class="codehilite" data-code-language="roc"><pre><span></span><code>parse_digit : Parser U8
parse_digit = |@Parser input|
  Err("not implemented")
</code></pre></div>
<p>But this also fail with a somewhat different message:</p>
<div class="codehilite"><pre><span></span><code>── TYPE MISMATCH in Parser.roc ─────────────────────────────────────────────────

Something is off with the body of the parse_digit definition:

7│   parse_digit : Parser U8
8│&gt;  parse_digit = |@Parser input|
9│&gt;    Err(&quot;not implemented&quot;)

The body is an anonymous function of type:

    (Parser * -&gt; [Err Str])

But the type annotation on parse_digit says it should be:

    Parser U8
</code></pre></div>
<p>I'm sure I don't understand what's going on here, so any pointers would be much appreciated. I understand the problem must be related to how opaque types work, because if it's not opaque it compiles.</p>



<a name="501263753"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/%E2%9C%94%20I%20need%20help%20understanding%20opaque%20types/near/501263753" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/.E2.9C.94.20I.20need.20help.20understanding.20opaque.20types.html#501263753">(Feb 22 2025 at 13:08)</a>:</h4>
<p>To create an opaque value, you wrap the value with the name of the tag prefixed with @</p>



<a name="501263794"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/%E2%9C%94%20I%20need%20help%20understanding%20opaque%20types/near/501263794" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/.E2.9C.94.20I.20need.20help.20understanding.20opaque.20types.html#501263794">(Feb 22 2025 at 13:09)</a>:</h4>
<p>To take the inner data out of the opaque value, you do what you did with the function args</p>



<a name="501263815"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/%E2%9C%94%20I%20need%20help%20understanding%20opaque%20types/near/501263815" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/.E2.9C.94.20I.20need.20help.20understanding.20opaque.20types.html#501263815">(Feb 22 2025 at 13:09)</a>:</h4>
<p>Where you make a pattern that matches on <code>@Opaque(inner)</code></p>



<a name="501263874"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/%E2%9C%94%20I%20need%20help%20understanding%20opaque%20types/near/501263874" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Kevin Hovsäter <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/.E2.9C.94.20I.20need.20help.20understanding.20opaque.20types.html#501263874">(Feb 22 2025 at 13:10)</a>:</h4>
<p><span class="user-mention silent" data-user-id="461444">Sam Mohr</span> <a href="#narrow/channel/231634-beginners/topic/I.20need.20help.20understanding.20opaque.20types/near/501263753">said</a>:</p>
<blockquote>
<p>To create an opaque value, you wrap the value with the name of the tag prefixed with @</p>
</blockquote>
<p>Right. What I don't understand is why <code>parse_digit</code> isn't compatible with <code>Parser U8</code>. My understanding is that the type is only opaque outside the module?</p>



<a name="501263892"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/%E2%9C%94%20I%20need%20help%20understanding%20opaque%20types/near/501263892" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/.E2.9C.94.20I.20need.20help.20understanding.20opaque.20types.html#501263892">(Feb 22 2025 at 13:10)</a>:</h4>
<p>So to do what you want, you'll need to wrap the entire function in the opaque wrapper, not just the args or the return value</p>



<a name="501263912"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/%E2%9C%94%20I%20need%20help%20understanding%20opaque%20types/near/501263912" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/.E2.9C.94.20I.20need.20help.20understanding.20opaque.20types.html#501263912">(Feb 22 2025 at 13:10)</a>:</h4>
<p>The type is the same inside and outside the module where the opaque type is defined</p>



<a name="501263933"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/%E2%9C%94%20I%20need%20help%20understanding%20opaque%20types/near/501263933" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Kevin Hovsäter <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/.E2.9C.94.20I.20need.20help.20understanding.20opaque.20types.html#501263933">(Feb 22 2025 at 13:11)</a>:</h4>
<p><span class="user-mention silent" data-user-id="461444">Sam Mohr</span> <a href="#narrow/channel/231634-beginners/topic/I.20need.20help.20understanding.20opaque.20types/near/501263892">said</a>:</p>
<blockquote>
<p>So to do what you want, you'll need to wrap the entire function in the opaque wrapper, not just the args or the return value</p>
</blockquote>
<p>I'm pretty sure I tried that. Hold on.</p>



<a name="501263944"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/%E2%9C%94%20I%20need%20help%20understanding%20opaque%20types/near/501263944" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/.E2.9C.94.20I.20need.20help.20understanding.20opaque.20types.html#501263944">(Feb 22 2025 at 13:11)</a>:</h4>
<p>The only difference is that you can't create or unwrap an opaque value outside of its defining module</p>



<a name="501264074"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/%E2%9C%94%20I%20need%20help%20understanding%20opaque%20types/near/501264074" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/.E2.9C.94.20I.20need.20help.20understanding.20opaque.20types.html#501264074">(Feb 22 2025 at 13:12)</a>:</h4>
<p>This error message isn't super useful, but I'm not sure what specific improvement we could make</p>



<a name="501264147"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/%E2%9C%94%20I%20need%20help%20understanding%20opaque%20types/near/501264147" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/.E2.9C.94.20I.20need.20help.20understanding.20opaque.20types.html#501264147">(Feb 22 2025 at 13:13)</a>:</h4>
<p>We could suggest moving where the opaque wrapper is if there's an opaque type on one side and a non-opaque type on the other side</p>



<a name="501264217"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/%E2%9C%94%20I%20need%20help%20understanding%20opaque%20types/near/501264217" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Kevin Hovsäter <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/.E2.9C.94.20I.20need.20help.20understanding.20opaque.20types.html#501264217">(Feb 22 2025 at 13:14)</a>:</h4>
<p>When I wrap the entire lambda in <code>@Parser</code>, I get an error message saying I can't call the function with an argument because the type is opaque. Which I guess makes sense? What I wanted to achieve was having <code>Parser</code> be opaque as in you can't construct them yourself, you'll have to use the module interface, but perhaps I need some sort of constructor to achieve that then?</p>



<a name="501264525"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/%E2%9C%94%20I%20need%20help%20understanding%20opaque%20types/near/501264525" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/.E2.9C.94.20I.20need.20help.20understanding.20opaque.20types.html#501264525">(Feb 22 2025 at 13:16)</a>:</h4>
<p>Yes, for others to construct a parser they'll need a constructor</p>



<a name="501264577"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/%E2%9C%94%20I%20need%20help%20understanding%20opaque%20types/near/501264577" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Kevin Hovsäter <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/.E2.9C.94.20I.20need.20help.20understanding.20opaque.20types.html#501264577">(Feb 22 2025 at 13:17)</a>:</h4>
<p>Yeah, I figured. But from within the module itself I was hoping that I can construct my own parsers without having to do that, but I can't really make it work.</p>



<a name="501264588"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/%E2%9C%94%20I%20need%20help%20understanding%20opaque%20types/near/501264588" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/.E2.9C.94.20I.20need.20help.20understanding.20opaque.20types.html#501264588">(Feb 22 2025 at 13:17)</a>:</h4>
<div class="codehilite" data-code-language="roc"><pre><span></span><code>parse_digit : Parser U8
parse_digit = @Parser(|input| Err("not implemented"))
</code></pre></div>



<a name="501264595"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/%E2%9C%94%20I%20need%20help%20understanding%20opaque%20types/near/501264595" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/.E2.9C.94.20I.20need.20help.20understanding.20opaque.20types.html#501264595">(Feb 22 2025 at 13:17)</a>:</h4>
<p>Does this not work?</p>



<a name="501264600"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/%E2%9C%94%20I%20need%20help%20understanding%20opaque%20types/near/501264600" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Kevin Hovsäter <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/.E2.9C.94.20I.20need.20help.20understanding.20opaque.20types.html#501264600">(Feb 22 2025 at 13:17)</a>:</h4>
<p>Nope.</p>



<a name="501264622"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/%E2%9C%94%20I%20need%20help%20understanding%20opaque%20types/near/501264622" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/.E2.9C.94.20I.20need.20help.20understanding.20opaque.20types.html#501264622">(Feb 22 2025 at 13:17)</a>:</h4>
<p>Getting a laptop...</p>



<a name="501264675"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/%E2%9C%94%20I%20need%20help%20understanding%20opaque%20types/near/501264675" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Kevin Hovsäter <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/.E2.9C.94.20I.20need.20help.20understanding.20opaque.20types.html#501264675">(Feb 22 2025 at 13:18)</a>:</h4>
<p>Well, it compiles, but my <code>expect</code> fails saying I can't call my parser. This is all done in the same module.</p>



<a name="501264696"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/%E2%9C%94%20I%20need%20help%20understanding%20opaque%20types/near/501264696" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Kevin Hovsäter <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/.E2.9C.94.20I.20need.20help.20understanding.20opaque.20types.html#501264696">(Feb 22 2025 at 13:18)</a>:</h4>
<div class="codehilite"><pre><span></span><code>── TOO MANY ARGS in Parser.roc ─────────────────────────────────────────────────

The parse_digit value is an opaque type, so it cannot be called with
an argument:

11│  expect parse_digit(&quot;123&quot;) == Ok { value: 1, rest: &quot;123&quot; }
            ^^^^^^^^^^^

I can&#39;t call an opaque type because I don&#39;t know what it is! Maybe you
meant to unwrap it first?

────────────────────────────────────────────────────────────────────────────────
</code></pre></div>



<a name="501265020"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/%E2%9C%94%20I%20need%20help%20understanding%20opaque%20types/near/501265020" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/.E2.9C.94.20I.20need.20help.20understanding.20opaque.20types.html#501265020">(Feb 22 2025 at 13:20)</a>:</h4>
<p>Oh yeah, you can't call it!</p>



<a name="501265045"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/%E2%9C%94%20I%20need%20help%20understanding%20opaque%20types/near/501265045" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/.E2.9C.94.20I.20need.20help.20understanding.20opaque.20types.html#501265045">(Feb 22 2025 at 13:21)</a>:</h4>
<p>The hint at the bottom is right in that you need to get the inner function out of the opaque value first</p>



<a name="501265084"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/%E2%9C%94%20I%20need%20help%20understanding%20opaque%20types/near/501265084" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/.E2.9C.94.20I.20need.20help.20understanding.20opaque.20types.html#501265084">(Feb 22 2025 at 13:21)</a>:</h4>
<p>There's no auto dereferencing in Roc</p>



<a name="501265360"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/%E2%9C%94%20I%20need%20help%20understanding%20opaque%20types/near/501265360" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Kevin Hovsäter <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/.E2.9C.94.20I.20need.20help.20understanding.20opaque.20types.html#501265360">(Feb 22 2025 at 13:23)</a>:</h4>
<p>Oh, I see, because <code>Parser</code> is opaque, you can’t really make assumptions about it. So I guess that means I need to change how <code>parse_digit</code> works then. Because unwrapping only works within the module, right?</p>



<a name="501265694"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/%E2%9C%94%20I%20need%20help%20understanding%20opaque%20types/near/501265694" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/.E2.9C.94.20I.20need.20help.20understanding.20opaque.20types.html#501265694">(Feb 22 2025 at 13:26)</a>:</h4>
<p>Yep, unless you provide a <code>get_inner : Parser a -&gt; (Str -&gt; ParseResult a)</code> equivalent</p>



<a name="501265722"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/%E2%9C%94%20I%20need%20help%20understanding%20opaque%20types/near/501265722" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/.E2.9C.94.20I.20need.20help.20understanding.20opaque.20types.html#501265722">(Feb 22 2025 at 13:26)</a>:</h4>
<p>But I'd recommend something like this</p>



<a name="501265953"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/%E2%9C%94%20I%20need%20help%20understanding%20opaque%20types/near/501265953" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/.E2.9C.94.20I.20need.20help.20understanding.20opaque.20types.html#501265953">(Feb 22 2025 at 13:27)</a>:</h4>
<div class="codehilite" data-code-language="Elm"><pre><span></span><code><span class="kn">module</span><span class="w"> </span><span class="err">[]</span>

<span class="kt">Parser</span><span class="w"> </span><span class="nv">a</span><span class="w"> </span><span class="nf">:=</span><span class="w"> </span><span class="kt">Str</span><span class="w"> </span><span class="nf">-&gt;</span><span class="w"> </span><span class="kt">ParserResult</span><span class="w"> </span><span class="nv">a</span>
<span class="kt">ParserResult</span><span class="w"> </span><span class="nv">a</span><span class="w"> </span><span class="nf">:</span><span class="w"> </span><span class="kt">Result</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nv">data</span><span class="w"> </span><span class="nf">:</span><span class="w"> </span><span class="nv">a</span><span class="p">,</span><span class="w"> </span><span class="nv">rest</span><span class="w"> </span><span class="nf">:</span><span class="w"> </span><span class="kt">Str</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kt">Str</span>

<span class="nv">word</span><span class="w"> </span><span class="nf">:</span><span class="w"> </span><span class="kt">Parser</span><span class="w"> </span><span class="kt">Str</span>
<span class="nv">word</span><span class="w"> </span><span class="nf">=</span><span class="w"> </span><span class="err">@</span><span class="kt">Parser</span><span class="p">(</span>
<span class="w">    </span><span class="nf">|</span><span class="nv">input</span><span class="nf">|</span>
<span class="w">        </span><span class="p">{</span><span class="w"> </span><span class="nv">before</span><span class="p">,</span><span class="w"> </span><span class="nv">after</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="nf">=</span>
<span class="w">            </span><span class="kt">Str</span><span class="nf">.</span><span class="nv">split_last</span><span class="p">(</span><span class="nv">input</span><span class="p">,</span><span class="w"> </span><span class="s">" "</span><span class="p">)</span>
<span class="w">            </span><span class="err">?</span><span class="w"> </span><span class="nf">|</span><span class="nv">_</span><span class="nf">|</span><span class="w"> </span><span class="s">"Failed to split string"</span>

<span class="w">        </span><span class="kt">Ok</span><span class="p">({</span><span class="w"> </span><span class="nv">data</span><span class="nf">:</span><span class="w"> </span><span class="nv">before</span><span class="p">,</span><span class="w"> </span><span class="nv">rest</span><span class="nf">:</span><span class="w"> </span><span class="nv">after</span><span class="w"> </span><span class="p">}),</span>
<span class="p">)</span>

<span class="nv">parse</span><span class="w"> </span><span class="nf">:</span><span class="w"> </span><span class="kt">Parser</span><span class="w"> </span><span class="nv">a</span><span class="p">,</span><span class="w"> </span><span class="kt">Str</span><span class="w"> </span><span class="nf">-&gt;</span><span class="w"> </span><span class="kt">ParserResult</span><span class="w"> </span><span class="nv">a</span>
<span class="nv">parse</span><span class="w"> </span><span class="nf">=</span><span class="w"> </span><span class="nf">|</span><span class="err">@</span><span class="kt">Parser</span><span class="p">(</span><span class="nv">parser</span><span class="p">),</span><span class="w"> </span><span class="nv">input</span><span class="nf">|</span><span class="w"> </span><span class="nv">parser</span><span class="p">(</span><span class="nv">input</span><span class="p">)</span>

<span class="nv">expect</span>
<span class="w">    </span><span class="nv">word</span>
<span class="w">    </span><span class="nf">|&gt;</span><span class="w"> </span><span class="nv">parse</span><span class="w"> </span><span class="s">"abc def"</span>
<span class="w">    </span><span class="nf">==</span><span class="w"> </span><span class="kt">Ok</span><span class="p">({</span><span class="w"> </span><span class="nv">data</span><span class="nf">:</span><span class="w"> </span><span class="s">"abc"</span><span class="p">,</span><span class="w"> </span><span class="nv">rest</span><span class="nf">:</span><span class="w"> </span><span class="s">"def"</span><span class="w"> </span><span class="p">})</span>
</code></pre></div>



<a name="501266157"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/%E2%9C%94%20I%20need%20help%20understanding%20opaque%20types/near/501266157" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/.E2.9C.94.20I.20need.20help.20understanding.20opaque.20types.html#501266157">(Feb 22 2025 at 13:28)</a>:</h4>
<p>In that you provide an interface using the opaque value that doesn't leak the encapsulated impl</p>



<a name="501266169"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/%E2%9C%94%20I%20need%20help%20understanding%20opaque%20types/near/501266169" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Kevin Hovsäter <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/.E2.9C.94.20I.20need.20help.20understanding.20opaque.20types.html#501266169">(Feb 22 2025 at 13:28)</a>:</h4>
<p>Ah, that makes sense! I test using the public interface. I have a <code>run</code> equivalent.</p>



<a name="501266232"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/%E2%9C%94%20I%20need%20help%20understanding%20opaque%20types/near/501266232" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/.E2.9C.94.20I.20need.20help.20understanding.20opaque.20types.html#501266232">(Feb 22 2025 at 13:29)</a>:</h4>
<p>Yeah, <code>run</code> works!</p>



<a name="501266488"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/%E2%9C%94%20I%20need%20help%20understanding%20opaque%20types/near/501266488" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Kevin Hovsäter <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/.E2.9C.94.20I.20need.20help.20understanding.20opaque.20types.html#501266488">(Feb 22 2025 at 13:30)</a>:</h4>
<p>Thanks for the help, <span class="user-mention" data-user-id="461444">@Sam Mohr</span>. Appreciate it. <span aria-label="smile" class="emoji emoji-1f642" role="img" title="smile">:smile:</span></p>



<a name="501266609"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/%E2%9C%94%20I%20need%20help%20understanding%20opaque%20types/near/501266609" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/.E2.9C.94.20I.20need.20help.20understanding.20opaque.20types.html#501266609">(Feb 22 2025 at 13:31)</a>:</h4>
<p>Of course!</p>



<a name="501266689"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/%E2%9C%94%20I%20need%20help%20understanding%20opaque%20types/near/501266689" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/.E2.9C.94.20I.20need.20help.20understanding.20opaque.20types.html#501266689">(Feb 22 2025 at 13:32)</a>:</h4>
<p>And of course, expect minor changes to this with the new compiler</p>



<a name="501266753"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/%E2%9C%94%20I%20need%20help%20understanding%20opaque%20types/near/501266753" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/.E2.9C.94.20I.20need.20help.20understanding.20opaque.20types.html#501266753">(Feb 22 2025 at 13:32)</a>:</h4>
<p>Namely, custom/nominal types will not need the @ in the future, but will otherwise work very similarly</p>



<a name="501266822"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/%E2%9C%94%20I%20need%20help%20understanding%20opaque%20types/near/501266822" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/.E2.9C.94.20I.20need.20help.20understanding.20opaque.20types.html#501266822">(Feb 22 2025 at 13:33)</a>:</h4>
<p>But you can optionally expose the tags of a custom union to other modules...</p>



<a name="501266853"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/%E2%9C%94%20I%20need%20help%20understanding%20opaque%20types/near/501266853" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/.E2.9C.94.20I.20need.20help.20understanding.20opaque.20types.html#501266853">(Feb 22 2025 at 13:33)</a>:</h4>
<p>It's a bit more complicated, but <em>basically</em> the same</p>



<a name="501266868"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/%E2%9C%94%20I%20need%20help%20understanding%20opaque%20types/near/501266868" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/.E2.9C.94.20I.20need.20help.20understanding.20opaque.20types.html#501266868">(Feb 22 2025 at 13:33)</a>:</h4>
<p>We'll put out docs when they're implemented!</p>



<a name="501266908"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/%E2%9C%94%20I%20need%20help%20understanding%20opaque%20types/near/501266908" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/.E2.9C.94.20I.20need.20help.20understanding.20opaque.20types.html#501266908">(Feb 22 2025 at 13:33)</a>:</h4>
<p>When/where is your parser combinator talk?</p>



<a name="501269084"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/%E2%9C%94%20I%20need%20help%20understanding%20opaque%20types/near/501269084" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Kevin Hovsäter <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/.E2.9C.94.20I.20need.20help.20understanding.20opaque.20types.html#501269084">(Feb 22 2025 at 13:50)</a>:</h4>
<p><span class="user-mention silent" data-user-id="461444">Sam Mohr</span> <a href="#narrow/channel/231634-beginners/topic/I.20need.20help.20understanding.20opaque.20types/near/501266908">said</a>:</p>
<blockquote>
<p>When/where is your parser combinator talk?</p>
</blockquote>
<p>February 27, so Thursday next week. It's for a local meetup where I live, but fun nevertheless. I've never held one before. <span aria-label="sweat smile" class="emoji emoji-1f605" role="img" title="sweat smile">:sweat_smile:</span> I'm going to walkthrough building a parser for arithmetic expressions, e.g., <code>1 * (1 + 3) + 2</code>.</p>



<a name="501269107"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/%E2%9C%94%20I%20need%20help%20understanding%20opaque%20types/near/501269107" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/.E2.9C.94.20I.20need.20help.20understanding.20opaque.20types.html#501269107">(Feb 22 2025 at 13:50)</a>:</h4>
<p>Awesome! A very fun usage of FP</p>



<a name="501269142"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/%E2%9C%94%20I%20need%20help%20understanding%20opaque%20types/near/501269142" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/.E2.9C.94.20I.20need.20help.20understanding.20opaque.20types.html#501269142">(Feb 22 2025 at 13:51)</a>:</h4>
<p>If you want to do idiomatic Roc, consider throwing on record builders right at the end for an advanced feature</p>



<a name="501269150"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/%E2%9C%94%20I%20need%20help%20understanding%20opaque%20types/near/501269150" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/.E2.9C.94.20I.20need.20help.20understanding.20opaque.20types.html#501269150">(Feb 22 2025 at 13:51)</a>:</h4>
<p>Might be to complex for a short talk</p>



<a name="501269233"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/%E2%9C%94%20I%20need%20help%20understanding%20opaque%20types/near/501269233" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Kevin Hovsäter <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/.E2.9C.94.20I.20need.20help.20understanding.20opaque.20types.html#501269233">(Feb 22 2025 at 13:52)</a>:</h4>
<p><span class="user-mention silent" data-user-id="461444">Sam Mohr</span> <a href="#narrow/channel/231634-beginners/topic/I.20need.20help.20understanding.20opaque.20types/near/501269142">said</a>:</p>
<blockquote>
<p>If you want to do idiomatic Rust, consider throwing on record builders right at the end for an advanced feature</p>
</blockquote>
<p>Roc you mean? I think I have roughly an hour allocated, so it could work.</p>



<a name="501269278"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/%E2%9C%94%20I%20need%20help%20understanding%20opaque%20types/near/501269278" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/.E2.9C.94.20I.20need.20help.20understanding.20opaque.20types.html#501269278">(Feb 22 2025 at 13:53)</a>:</h4>
<p><a href="https://github.com/roc-lang/examples/blob/main/examples/RecordBuilder/DateParser.roc">https://github.com/roc-lang/examples/blob/main/examples/RecordBuilder/DateParser.roc</a></p>



<a name="501269309"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/%E2%9C%94%20I%20need%20help%20understanding%20opaque%20types/near/501269309" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/.E2.9C.94.20I.20need.20help.20understanding.20opaque.20types.html#501269309">(Feb 22 2025 at 13:53)</a>:</h4>
<p>Yep, typo</p>



<a name="501269372"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/%E2%9C%94%20I%20need%20help%20understanding%20opaque%20types/near/501269372" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/.E2.9C.94.20I.20need.20help.20understanding.20opaque.20types.html#501269372">(Feb 22 2025 at 13:54)</a>:</h4>
<p>It's a very clean interface, you just need to figure out how to explain it well enough</p>



<a name="501269413"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/%E2%9C%94%20I%20need%20help%20understanding%20opaque%20types/near/501269413" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Kevin Hovsäter <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/.E2.9C.94.20I.20need.20help.20understanding.20opaque.20types.html#501269413">(Feb 22 2025 at 13:55)</a>:</h4>
<p>Yeah, that would actually be an interesting "alternative" to what I'll go through. Record builders completely slipped my mind.</p>



<a name="501270188"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/%E2%9C%94%20I%20need%20help%20understanding%20opaque%20types/near/501270188" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/.E2.9C.94.20I.20need.20help.20understanding.20opaque.20types.html#501270188">(Feb 22 2025 at 14:05)</a>:</h4>
<p>They're an unusual feature, but they're really nice</p>



<a name="501275744"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/%E2%9C%94%20I%20need%20help%20understanding%20opaque%20types/near/501275744" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Niclas Ahden <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/.E2.9C.94.20I.20need.20help.20understanding.20opaque.20types.html#501275744">(Feb 22 2025 at 15:16)</a>:</h4>
<p><span class="user-mention silent" data-user-id="452574">Kevin Hovsäter</span> <a href="#narrow/channel/231634-beginners/topic/I.20need.20help.20understanding.20opaque.20types/near/501269084">said</a>:</p>
<blockquote>
<p><span class="user-mention silent" data-user-id="461444">Sam Mohr</span> <a href="#narrow/channel/231634-beginners/topic/I.20need.20help.20understanding.20opaque.20types/near/501266908">said</a>:</p>
<blockquote>
<p>When/where is your parser combinator talk?</p>
</blockquote>
<p>February 27, so Thursday next week. It's for a local meetup where I live, but fun nevertheless. I've never held one before. <span aria-label="sweat smile" class="emoji emoji-1f605" role="img" title="sweat smile">:sweat_smile:</span> I'm going to walkthrough building a parser for arithmetic expressions, e.g., <code>1 * (1 + 3) + 2</code>.</p>
</blockquote>
<p>Does this meetup happen to be in/around Stockholm? I could be your cheerleader (outfit not included) <span aria-label="sweat smile" class="emoji emoji-1f605" role="img" title="sweat smile">:sweat_smile:</span></p>



<a name="501276025"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/%E2%9C%94%20I%20need%20help%20understanding%20opaque%20types/near/501276025" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Kevin Hovsäter <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/.E2.9C.94.20I.20need.20help.20understanding.20opaque.20types.html#501276025">(Feb 22 2025 at 15:20)</a>:</h4>
<p><span class="user-mention silent" data-user-id="524503">Niclas Ahden</span> <a href="#narrow/channel/231634-beginners/topic/I.20need.20help.20understanding.20opaque.20types/near/501275744">said</a>:</p>
<blockquote>
<p><span class="user-mention silent" data-user-id="452574">Kevin Hovsäter</span> <a href="#narrow/channel/231634-beginners/topic/I.20need.20help.20understanding.20opaque.20types/near/501269084">said</a>:</p>
<blockquote>
<p><span class="user-mention silent" data-user-id="461444">Sam Mohr</span> <a href="#narrow/channel/231634-beginners/topic/I.20need.20help.20understanding.20opaque.20types/near/501266908">said</a>:</p>
<blockquote>
<p>When/where is your parser combinator talk?</p>
</blockquote>
<p>February 27, so Thursday next week. It's for a local meetup where I live, but fun nevertheless. I've never held one before. <span aria-label="sweat smile" class="emoji emoji-1f605" role="img" title="sweat smile">:sweat_smile:</span> I'm going to walkthrough building a parser for arithmetic expressions, e.g., <code>1 * (1 + 3) + 2</code>.</p>
</blockquote>
<p>Does this meetup happen to be in/around Stockholm? I could be your cheerleader (outfit not included) <span aria-label="sweat smile" class="emoji emoji-1f605" role="img" title="sweat smile">:sweat_smile:</span></p>
</blockquote>
<p>Haha!  it's happening in Växjö, so unfortunately not close by.</p>



<a name="501276101"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/%E2%9C%94%20I%20need%20help%20understanding%20opaque%20types/near/501276101" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Niclas Ahden <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/.E2.9C.94.20I.20need.20help.20understanding.20opaque.20types.html#501276101">(Feb 22 2025 at 15:21)</a>:</h4>
<p>Crap, I never get to practice my <em>moves</em> -- next time!</p>



<a name="501280412"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/%E2%9C%94%20I%20need%20help%20understanding%20opaque%20types/near/501280412" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Notification Bot <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/.E2.9C.94.20I.20need.20help.20understanding.20opaque.20types.html#501280412">(Feb 22 2025 at 16:15)</a>:</h4>
<p><span class="user-mention silent" data-user-id="452574">Kevin Hovsäter</span> has marked this topic as resolved.</p>



<hr><p>Last updated: Mar 01 2026 at 12:20 UTC</p>
</html>