<html>
<head><meta charset="utf-8"><title>optional field problem · beginners · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/index.html">beginners</a></h2>
<h3>Topic: <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/optional.20field.20problem.html">optional field problem</a></h3>

<hr>

<base href="https://roc.zulipchat.com">

<head><link href="https://roc-lang.github.io/zulip-export/style.css" rel="stylesheet"></head>

<a name="430855645"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/optional%20field%20problem/near/430855645" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> witoldsz <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/optional.20field.20problem.html#430855645">(Apr 02 2024 at 19:06)</a>:</h4>
<p>I have declared a type alias with optional field, but I am not able to satisfy the type system, see below.<br>
Is it a compiler bug or what do I do wrong?</p>
<div class="codehilite"><pre><span></span><code>package &quot;testing&quot; exposes [] packages {}

EventSystemAlertsCreate : {
    submitId : Str,
    refs ? Str,
}

event1: EventSystemAlertsCreate
event1 = {
    submitId: &quot;123&quot;,
    refs: &quot;456&quot;
}

event2: EventSystemAlertsCreate
event2 = {
    submitId: &quot;123&quot;,

}
</code></pre></div>
<div class="codehilite"><pre><span></span><code>$ roc check test.roc

── TYPE MISMATCH in test.roc ───────────────────────────────────────────────────

Something is off with the body of the event1 definition:

 8│   event1: EventSystemAlertsCreate
 9│&gt;  event1 = {
10│&gt;      submitId: &quot;123&quot;,
11│&gt;      refs: &quot;456&quot;
12│&gt;  }

The body is a record of type:

    {
        refs : Str,
        submitId : Str,
    }

But the type annotation on event1 says it should be:

    {
        refs ? Str,
        submitId : Str,
    }

Tip: To extract the .refs field it must be non-optional, but the type
says this field is optional. Learn more about optional fields at TODO.


── TYPE MISMATCH in test.roc ───────────────────────────────────────────────────

Something is off with the body of the event2 definition:

14│   event2: EventSystemAlertsCreate
15│&gt;  event2 = {
16│&gt;      submitId: &quot;123&quot;,
17│&gt;
18│&gt;  }

The body is a record of type:

    { submitId : Str }

But the type annotation on event2 says it should be:

    {
        refs ? Str,
        submitId : Str,
    }

Tip: Looks like the refs field is missing.

────────────────────────────────────────────────────────────────────────────────

2 errors and 2 warnings found in 30 ms
</code></pre></div>
<div class="codehilite"><pre><span></span><code>$ roc version
roc nightly pre-release, built from commit 62cc19c on Di 02 Apr 2024 09:01:38 UTC
</code></pre></div>



<a name="430862164"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/optional%20field%20problem/near/430862164" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/optional.20field.20problem.html#430862164">(Apr 02 2024 at 19:50)</a>:</h4>
<p>Optional fields are named poorly. They are really default value fields. They require a value. The value will be specified during a destructuring. This generally happens when passing a record into a function and wanted default values.</p>



<a name="430862225"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/optional%20field%20problem/near/430862225" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/optional.20field.20problem.html#430862225">(Apr 02 2024 at 19:51)</a>:</h4>
<p>You probably want to directly represent an optional in the type system</p>



<a name="430862370"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/optional%20field%20problem/near/430862370" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/optional.20field.20problem.html#430862370">(Apr 02 2024 at 19:52)</a>:</h4>
<p>Something like <code>refs: Result Str [NoRefSpecified]</code></p>



<a name="430892267"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/optional%20field%20problem/near/430892267" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> witoldsz <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/optional.20field.20problem.html#430892267">(Apr 02 2024 at 23:35)</a>:</h4>
<p>Ok, so how do I use optional fields? I know I have to destructure to access them, but in my example I was unable just to create an object.</p>



<a name="430894841"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/optional%20field%20problem/near/430894841" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/optional.20field.20problem.html#430894841">(Apr 03 2024 at 00:04)</a>:</h4>
<p>Generally as a function input, something like:</p>
<div class="codehilite"><pre><span></span><code>someFn: EventSystemAlertsCreate -&gt; ...
someFn = \{ submitId, refs ? &quot;default value&quot; } -&gt;
    ...

someFn { submitId: &quot;123&quot;, refs: &quot;456&quot; }
someFn { submitId: &quot;123&quot; }
</code></pre></div>



<a name="430933875"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/optional%20field%20problem/near/430933875" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> witoldsz <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/optional.20field.20problem.html#430933875">(Apr 03 2024 at 07:17)</a>:</h4>
<p>OK, but how do I assign to a variable? How do I pass it around?</p>



<a name="430947495"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/optional%20field%20problem/near/430947495" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Hristo <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/optional.20field.20problem.html#430947495">(Apr 03 2024 at 08:35)</a>:</h4>
<p><span class="user-mention" data-user-id="515922">@witoldsz</span>, my understanding is that those are not intended to be passed around as named values.</p>
<p>From the corresponding tutorial <a href="https://www.roc-lang.org/tutorial#optional-record-fields">section</a> (which is quite helpful in its entirety, as it discusses example use-cases where such fields are applicable; I believe Brendan's example was an instance of one class of possible applications):</p>
<blockquote>
<p>Destructuring is the only way to implement a record with optional fields. For example, if you write the expression config.title and title is an optional field, you'll get a compile error.</p>
<p>This means it's never possible to end up with an optional value that exists outside a record field. Optionality is a concept that exists only in record fields, and it's intended for the use case of config records like this. The ergonomics of destructuring mean this wouldn't be a good fit for data modeling, consider using a Result type instead.</p>
</blockquote>



<a name="430959022"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/optional%20field%20problem/near/430959022" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> witoldsz <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/optional.20field.20problem.html#430959022">(Apr 03 2024 at 09:26)</a>:</h4>
<p>As I said, I got the message "Destructuring is the only way to implement a record with optional fields". I have literally studied that tutorial section before asking this question. I still do not understand how a value (I mean a record with an optional field) cannot be passed around. This seems very strange.</p>



<a name="430967697"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/optional%20field%20problem/near/430967697" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/optional.20field.20problem.html#430967697">(Apr 03 2024 at 10:09)</a>:</h4>
<p>They're not optional in that they are either there or they arent. </p>
<p>The field is always there. Just when you pass a record to a function that field is optional. So you can pass a record that doesn't have that field, and it will be given the default value.</p>



<a name="430971092"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/optional%20field%20problem/near/430971092" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Hristo <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/optional.20field.20problem.html#430971092">(Apr 03 2024 at 10:28)</a>:</h4>
<p><span class="user-mention" data-user-id="515922">@witoldsz</span>, first - my apologies, I definitely didn't mean to imply that you hadn't read the tutorial before asking your question <span aria-label="pray" class="emoji emoji-1f64f" role="img" title="pray">:pray:</span> </p>
<p>If you're familiar with Python (or equivalent), perhaps this example might be of help, conceptually speaking only:</p>
<div class="codehilite" data-code-language="Python"><pre><span></span><code><span class="k">def</span> <span class="nf">add3</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="mi">5</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">a</span> <span class="o">+</span> <span class="n">b</span> <span class="o">+</span> <span class="n">c</span>

<span class="n">add3</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="c1"># ~&gt; 8</span>
<span class="n">add3</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">15</span><span class="p">)</span> <span class="c1"># ~&gt; 18</span>
<span class="n">add3</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span> <span class="c1"># ~&gt; 18</span>
</code></pre></div>
<p><code>a</code>, <code>b</code> and <code>c</code> are values that can be passed around and Roc's optional fields enable you to achieve similar functionality. But <code>c = 5</code> isn't a value in itself (it's an assignment; it's not something that signifies "I'm giving you something that may optionally be equal to <code>5</code>, if you're to pass it to <code>add3</code> as a value which you'd previously stored; Python doesn't allow that either) and can't be passed around (of course, you can do <code>d = c = 5</code> but it has a completely different meaning). It's used in the signature to indicate a default value, which may be optionally overriden.</p>
<p>Of course this isn't a perfect analogy in terms of language specifics, but - as mentioned above - this isn't the goal of the example.</p>
<p>Perhaps record types with optional fields could be viewed as what are referred to as "interfaces" in some languages. And the corresponding records with non-optional fields, which are subset of the former, are concrete instances conforming to those "interfaces". The "interfaces" facilitate substituting in default values when the desired behaviour is being able to specify the corresponding fields optionally only.</p>
<p>If your question is pertaining to the language-design level and programming language theory (e.g., why Roc doesn't implement this functionality) - then I'm afraid I cannot help at that kind of level of abstraction. I know that I couldn't think of any use-cases why I'd need this kind of language feature, but that's about it.</p>



<a name="430977836"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/optional%20field%20problem/near/430977836" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> witoldsz <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/optional.20field.20problem.html#430977836">(Apr 03 2024 at 11:12)</a>:</h4>
<p><span class="user-mention" data-user-id="693045">@Hristo</span> no apologies needed, I do not feel offended in any way <span aria-label="smile" class="emoji emoji-1f642" role="img" title="smile">:smile:</span> <br>
My only problem is that I have no idea how can I use the type as in my example:</p>
<div class="codehilite"><pre><span></span><code>EventSystemAlertsCreate : {
    submitId : Str,
    refs ? Str,
}

event1: EventSystemAlertsCreate
event1 = {
    submitId: &quot;123&quot;,
    refs: &quot;456&quot;, # &lt;----- error
}

event2: EventSystemAlertsCreate
event2 = {
    submitId: &quot;123&quot;, # &lt;----- error
}

# now I could use event1 or event2 to pass to a function.
</code></pre></div>
<p>Neither of that <span aria-label="point up" class="emoji emoji-1f446" role="img" title="point up">:point_up:</span> works. From  my perspective, whenever I use an optional field in record, there is no way to create an instance and pass it around.</p>
<p>My only way out of it is to stop using optional fields in a record, but there is no a "default" <code>Option</code> type, so I have to either come up with a custom tag union or use something like <code>Result a {}</code>?</p>



<a name="430978187"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/optional%20field%20problem/near/430978187" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Hristo <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/optional.20field.20problem.html#430978187">(Apr 03 2024 at 11:14)</a>:</h4>
<blockquote>
<p>whenever I use an optional field in record, there is no way to create an instance and pass it around.</p>
</blockquote>
<p>Yes, indeed. That's expected behaviour, by design.</p>
<blockquote>
<p>so I have to either come up with a custom tag union </p>
</blockquote>
<p>Yes, my understanding is that was essentially Brendan's suggestion <a href="#narrow/stream/231634-beginners/topic/optional.20field.20problem/near/430862370">above</a>:</p>
<blockquote>
<p>You probably want to directly represent an optional in the type system<br>
Something like <code>refs: Result Str [NoRefSpecified]</code></p>
</blockquote>
<p>That would be the idiomatic way to achieve the desired functionality in Roc.</p>



<a name="430978220"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/optional%20field%20problem/near/430978220" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> witoldsz <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/optional.20field.20problem.html#430978220">(Apr 03 2024 at 11:14)</a>:</h4>
<p>P.S.<br>
I am looking hopefully at this thread: <a href="#narrow/stream/304641-ideas/topic/Builtin.20Option.20type.20for.20decoding">https://roc.zulipchat.com/#narrow/stream/304641-ideas/topic/Builtin.20Option.20type.20for.20decoding</a></p>



<a name="430978364"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/optional%20field%20problem/near/430978364" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Hristo <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/optional.20field.20problem.html#430978364">(Apr 03 2024 at 11:15)</a>:</h4>
<blockquote>
<p>I am looking hopefully at this thread: <a href="#narrow/stream/304641-ideas/topic/Builtin.20Option.20type.20for.20decoding">https://roc.zulipchat.com/#narrow/stream/304641-ideas/topic/Builtin.20Option.20type.20for.20decoding</a></p>
</blockquote>
<p>Good point - yes, I was meaning to reference that as a related as well.</p>



<a name="430979359"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/optional%20field%20problem/near/430979359" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> witoldsz <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/optional.20field.20problem.html#430979359">(Apr 03 2024 at 11:21)</a>:</h4>
<p>One little problem with <code>Result</code> is that it does not feel idiomatic. <em>Result</em> sounds like a… result of something. The upside though is there are ready-to-use functions to deal with results. Using custom tag union seems more idiomatic, but then I have to create all the map/join/etc functions just for this…</p>



<a name="430979789"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/optional%20field%20problem/near/430979789" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> witoldsz <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/optional.20field.20problem.html#430979789">(Apr 03 2024 at 11:24)</a>:</h4>
<p>I have a feeling that everything is moving towards the solution of introducing <code>Option</code> anyway. Even if this is going to be an alias for <code>Result * {}</code>. I don't know…</p>



<a name="430980566"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/optional%20field%20problem/near/430980566" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Hristo <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/optional.20field.20problem.html#430980566">(Apr 03 2024 at 11:30)</a>:</h4>
<p>So, I'll share a pattern that I've been using in my own Roc code and I'm not sure how relevant that might be to your use case, but it might potentially be of help.</p>
<ul>
<li>So, I've got models which, upon initialisation, take parameters (a record, containing optional fields), then I store the parameters in association with the models (I've got a parameters record field in a model record).</li>
<li>Since I don't want to have to specify all parameters upon initialisation, and instead I want to be able to provide default values, I define one record type that contains optional fields and another record type that contains the same subset of fields, but none of them are optional. This way I'm passing in a subset of the parameters as a record (not explicitly typed), destructuring the input to utilise the defaults and storing this as an instance of the non-optional-field parameters type.</li>
</ul>
<p>There might be a better and/or more idiomatic Roc way to achieve the same, but in terms of API readability and associated experience, this has been working particularly well in my use-case.</p>



<a name="430981362"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/optional%20field%20problem/near/430981362" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> witoldsz <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/optional.20field.20problem.html#430981362">(Apr 03 2024 at 11:35)</a>:</h4>
<p>Could you provide a small example? Does it work well in a scenario where you have to deal with massive data structures with dozens of (possibly nested) fields?</p>



<a name="430981664"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/optional%20field%20problem/near/430981664" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Hristo <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/optional.20field.20problem.html#430981664">(Apr 03 2024 at 11:37)</a>:</h4>
<p>My use-case doesn't involve yet more than 2-3 levels of nesting, so I'm yet to see how that might hold up eventually, if/when such necessity arises.</p>
<p>I'll be able to share some minimal example later today after work, yes.</p>



<a name="430982255"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/optional%20field%20problem/near/430982255" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eli Dowling <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/optional.20field.20problem.html#430982255">(Apr 03 2024 at 11:40)</a>:</h4>
<p>I sway back and forth, <span class="user-mention" data-user-id="515922">@witoldsz</span>, but I do have some reasons to like using results for Options. So maybe as a fellow sceptic I can give you some food for thought  :<br>
In the thread you linked discussing Option as a builtin <span class="user-mention" data-user-id="343810">@Brendan Hansknecht</span> mentioned using a result and I was initially skeptical but after some consideration I came around to it.</p>
<ol>
<li>No duplication of functionality/more simplicity. This is obvious, if you can have less things you should, less choices, better interop, less complexity</li>
<li>For decoding it's super convenient because of error accumulation. <br>
Usually decoding looks like this:</li>
</ol>
<ul>
<li>check if the field exists</li>
<li>Perform some validation and maybe a transformation, eg: check if a filepath exists, if a string matches some regex etc</li>
<li>output the final validated happy path object <br>
Because results accumulate Errors your final return for that field might be `Result val [Null, NotValidEmail] instead of Option (Result val [NotValidEmail])</li>
</ul>



<a name="431117893"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/optional%20field%20problem/near/431117893" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/optional.20field.20problem.html#431117893">(Apr 03 2024 at 15:19)</a>:</h4>
<p>Going back to the original example here:</p>
<div class="codehilite" data-code-language="Elm"><pre><span></span><code><span class="kt">EventSystemAlertsCreate</span><span class="w"> </span><span class="nf">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nv">submitId</span><span class="w"> </span><span class="nf">:</span><span class="w"> </span><span class="kt">Str</span><span class="p">,</span>
<span class="w">    </span><span class="nv">refs</span><span class="w"> </span><span class="err">?</span><span class="w"> </span><span class="kt">Str</span><span class="p">,</span>
<span class="p">}</span>

<span class="nv">event1</span><span class="nf">:</span><span class="w"> </span><span class="kt">EventSystemAlertsCreate</span>
<span class="nv">event1</span><span class="w"> </span><span class="nf">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nv">submitId</span><span class="nf">:</span><span class="w"> </span><span class="s">"123"</span><span class="p">,</span>
<span class="w">    </span><span class="nv">refs</span><span class="nf">:</span><span class="w"> </span><span class="s">"456"</span>
<span class="p">}</span>

<span class="nv">event2</span><span class="nf">:</span><span class="w"> </span><span class="kt">EventSystemAlertsCreate</span>
<span class="nv">event2</span><span class="w"> </span><span class="nf">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nv">submitId</span><span class="nf">:</span><span class="w"> </span><span class="s">"123"</span><span class="p">,</span>

<span class="p">}</span>
</code></pre></div>
<p><strong>I think this should compile as is. I think it not working is a bug.</strong></p>
<p>Note: the <code>refs</code> field would not be useable until destructing happens to initialize the field with a default value:</p>
<div class="codehilite" data-code-language="Elm"><pre><span></span><code><span class="p">{</span><span class="w"> </span><span class="nv">submitId</span><span class="p">,</span><span class="w"> </span><span class="nv">refs</span><span class="w"> </span><span class="err">?</span><span class="w"> </span><span class="s">"default"</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="nf">=</span><span class="w"> </span><span class="nv">event1</span>
</code></pre></div>
<p>The reason why, both of these types are clearly fine to be <code>EventSystemAlertsCreate</code> because both of these compile just fine:</p>
<div class="codehilite" data-code-language="Elm"><pre><span></span><code><span class="nv">event1</span><span class="w"> </span><span class="nf">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nv">submitId</span><span class="nf">:</span><span class="w"> </span><span class="s">"123"</span><span class="p">,</span>
<span class="w">    </span><span class="nv">refs</span><span class="nf">:</span><span class="w"> </span><span class="s">"456"</span>
<span class="p">}</span>

<span class="nv">eventFn</span><span class="w"> </span><span class="nf">:</span><span class="w"> </span><span class="kt">EventSystemAlertsCreate</span><span class="w"> </span><span class="nf">-&gt;</span><span class="w"> </span><span class="kt">Str</span>
<span class="nv">eventFn</span><span class="w"> </span><span class="nf">=</span><span class="w"> </span><span class="nf">\</span><span class="p">{</span><span class="nv">submitId</span><span class="p">,</span><span class="w"> </span><span class="nv">refs</span><span class="err">?</span><span class="w"> </span><span class="s">"default"</span><span class="p">}</span><span class="w"> </span><span class="nf">-&gt;</span>
<span class="w">    </span><span class="kt">Str</span><span class="nf">.</span><span class="nv">concat</span><span class="w"> </span><span class="nv">submitId</span><span class="w"> </span><span class="nv">refs</span>

<span class="nv">event1Str</span><span class="w"> </span><span class="nf">=</span><span class="w"> </span><span class="nv">eventFn</span><span class="w"> </span><span class="nv">event1</span>
</code></pre></div>
<p>and</p>
<div class="codehilite" data-code-language="Elm"><pre><span></span><code><span class="nv">event2</span><span class="w"> </span><span class="nf">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nv">submitId</span><span class="nf">:</span><span class="w"> </span><span class="s">"123"</span><span class="p">,</span>
<span class="p">}</span>

<span class="nv">eventFn</span><span class="w"> </span><span class="nf">:</span><span class="w"> </span><span class="kt">EventSystemAlertsCreate</span><span class="w"> </span><span class="nf">-&gt;</span><span class="w"> </span><span class="kt">Str</span>
<span class="nv">eventFn</span><span class="w"> </span><span class="nf">=</span><span class="w"> </span><span class="nf">\</span><span class="p">{</span><span class="nv">submitId</span><span class="p">,</span><span class="w"> </span><span class="nv">refs</span><span class="err">?</span><span class="w"> </span><span class="s">"default"</span><span class="p">}</span><span class="w"> </span><span class="nf">-&gt;</span>
<span class="w">    </span><span class="kt">Str</span><span class="nf">.</span><span class="nv">concat</span><span class="w"> </span><span class="nv">submitId</span><span class="w"> </span><span class="nv">refs</span>

<span class="nv">event2Str</span><span class="w"> </span><span class="nf">=</span><span class="w"> </span><span class="nv">eventFn</span><span class="w"> </span><span class="nv">event2</span>
</code></pre></div>
<p>Note, we currently have another bug in specialization that breaks this:</p>
<div class="codehilite" data-code-language="Elm"><pre><span></span><code><span class="nv">event1</span><span class="w"> </span><span class="nf">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nv">submitId</span><span class="nf">:</span><span class="w"> </span><span class="s">"123"</span><span class="p">,</span>
<span class="w">    </span><span class="nv">refs</span><span class="nf">:</span><span class="w"> </span><span class="s">"456"</span>
<span class="p">}</span>

<span class="nv">event2</span><span class="w"> </span><span class="nf">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nv">submitId</span><span class="nf">:</span><span class="w"> </span><span class="s">"123"</span><span class="p">,</span>
<span class="p">}</span>

<span class="nv">eventFn</span><span class="w"> </span><span class="nf">:</span><span class="w"> </span><span class="kt">EventSystemAlertsCreate</span><span class="w"> </span><span class="nf">-&gt;</span><span class="w"> </span><span class="kt">Str</span>
<span class="nv">eventFn</span><span class="w"> </span><span class="nf">=</span><span class="w"> </span><span class="nf">\</span><span class="p">{</span><span class="nv">submitId</span><span class="p">,</span><span class="w"> </span><span class="nv">refs</span><span class="err">?</span><span class="w"> </span><span class="s">"default"</span><span class="p">}</span><span class="w"> </span><span class="nf">-&gt;</span>
<span class="w">    </span><span class="kt">Str</span><span class="nf">.</span><span class="nv">concat</span><span class="w"> </span><span class="nv">submitId</span><span class="w"> </span><span class="nv">refs</span>

<span class="nv">event1Str</span><span class="w"> </span><span class="nf">=</span><span class="w"> </span><span class="nv">eventFn</span><span class="w"> </span><span class="nv">event1</span>
<span class="nv">event2Str</span><span class="w"> </span><span class="nf">=</span><span class="w"> </span><span class="nv">eventFn</span><span class="w"> </span><span class="nv">event2</span>
</code></pre></div>



<a name="431181945"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/optional%20field%20problem/near/431181945" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Hristo <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/optional.20field.20problem.html#431181945">(Apr 03 2024 at 21:45)</a>:</h4>
<p>Coincidentally, I've just run into what seems to be exactly the same issue (although, I thought I didn't expect it to fail in this new use-case of mine). The minimum reproducible example is as follows (please, note the difference between <code>OptionalFields1.roc</code> and <code>OptionalFields2.roc</code> and their corresponding compilation results):</p>
<div class="codehilite" data-code-language="Elm"><pre><span></span><code><span class="nf">&gt;</span><span class="w"> </span><span class="nv">cat</span><span class="w"> </span><span class="kt">OptionalFields2</span><span class="nf">.</span><span class="nv">roc</span>
<span class="nv">interface</span><span class="w"> </span><span class="kt">OptionalFields2</span>
<span class="w">    </span><span class="nv">exposes</span><span class="w"> </span><span class="p">[]</span>
<span class="w">    </span><span class="nv">imports</span><span class="w"> </span><span class="p">[]</span>

<span class="kt">RecordWithOptional</span><span class="w"> </span><span class="nf">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nv">abc</span><span class="w"> </span><span class="nf">:</span><span class="w"> </span><span class="kt">U64</span><span class="p">,</span><span class="w"> </span><span class="nv">def</span><span class="w"> </span><span class="err">?</span><span class="w"> </span><span class="kt">U64</span><span class="w"> </span><span class="p">}</span>

<span class="nv">sumRecord</span><span class="w"> </span><span class="nf">:</span><span class="w"> </span><span class="kt">RecordWithOptional</span><span class="w"> </span><span class="nf">-&gt;</span><span class="w"> </span><span class="kt">U64</span>
<span class="nv">sumRecord</span><span class="w"> </span><span class="nf">=</span><span class="w"> </span><span class="nf">\</span><span class="p">{</span><span class="w"> </span><span class="nv">abc</span><span class="p">,</span><span class="w"> </span><span class="nv">def</span><span class="w"> </span><span class="err">?</span><span class="w"> </span><span class="mi">5</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="nf">-&gt;</span><span class="w"> </span><span class="nv">abc</span><span class="w"> </span><span class="nf">+</span><span class="w"> </span><span class="nv">def</span>

<span class="nv">expect</span>
<span class="w">    </span><span class="nv">sumRecord</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nv">abc</span><span class="w"> </span><span class="nf">:</span><span class="w"> </span><span class="mi">3</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="nf">==</span><span class="w"> </span><span class="mi">8</span>

<span class="nv">expect</span>
<span class="w">    </span><span class="nv">sumRecord</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nv">abc</span><span class="w"> </span><span class="nf">:</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="nv">def</span><span class="w"> </span><span class="nf">:</span><span class="w"> </span><span class="mi">8</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="nf">==</span><span class="w"> </span><span class="mi">11</span><span class="w"> </span><span class="err">#</span><span class="w"> </span><span class="nf">&lt;-</span><span class="c1">------ this is the only effective difference between the two files</span>

<span class="nf">&gt;</span><span class="w"> </span><span class="nv">roc</span><span class="w"> </span><span class="nv">test</span><span class="w"> </span><span class="kt">OptionalFields2</span><span class="nf">.</span><span class="nv">roc</span>

<span class="err">──</span><span class="w"> </span><span class="kt">TYPE</span><span class="w"> </span><span class="kt">MISMATCH</span><span class="w"> </span><span class="kr">in</span><span class="w"> </span><span class="kt">OptionalFields</span><span class="nf">.</span><span class="nv">roc</span><span class="w"> </span><span class="err">─────────────────────────────────────────</span>

<span class="kt">This</span><span class="w"> </span><span class="mi">1</span><span class="nv">st</span><span class="w"> </span><span class="nv">argument</span><span class="w"> </span><span class="nv">to</span><span class="w"> </span><span class="nv">sumRecord</span><span class="w"> </span><span class="nv">has</span><span class="w"> </span><span class="nv">an</span><span class="w"> </span><span class="nv">unexpected</span><span class="w"> </span><span class="kr">type</span><span class="nf">:</span>

<span class="mi">11</span><span class="err">│</span><span class="w">      </span><span class="nv">sumRecord</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nv">abc</span><span class="w"> </span><span class="nf">:</span><span class="w"> </span><span class="mi">3</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="nf">==</span><span class="w"> </span><span class="mi">8</span>
<span class="w">                   </span><span class="nf">^^^^^^^^^^^</span>

<span class="kt">The</span><span class="w"> </span><span class="nv">argument</span><span class="w"> </span><span class="nv">is</span><span class="w"> </span><span class="nv">a</span><span class="w"> </span><span class="nv">record</span><span class="w"> </span><span class="kr">of</span><span class="w"> </span><span class="kr">type</span><span class="nf">:</span>

<span class="w">    </span><span class="p">{</span><span class="w"> </span><span class="err">…</span><span class="w"> </span><span class="p">}</span>

<span class="kt">But</span><span class="w"> </span><span class="nv">sumRecord</span><span class="w"> </span><span class="nv">needs</span><span class="w"> </span><span class="nv">its</span><span class="w"> </span><span class="mi">1</span><span class="nv">st</span><span class="w"> </span><span class="nv">argument</span><span class="w"> </span><span class="nv">to</span><span class="w"> </span><span class="nv">be</span><span class="nf">:</span>

<span class="w">    </span><span class="p">{</span><span class="w"> </span><span class="nv">def</span><span class="w"> </span><span class="nf">:</span><span class="w"> </span><span class="kt">Int</span><span class="w"> </span><span class="kt">Unsigned64</span><span class="p">,</span><span class="w"> </span><span class="err">…</span><span class="w"> </span><span class="p">}</span>

<span class="kt">Tip</span><span class="nf">:</span><span class="w"> </span><span class="kt">Looks</span><span class="w"> </span><span class="nv">like</span><span class="w"> </span><span class="nv">the</span><span class="w"> </span><span class="nv">def</span><span class="w"> </span><span class="nv">field</span><span class="w"> </span><span class="nv">is</span><span class="w"> </span><span class="nv">missing</span><span class="nf">.</span>
<span class="err">────────────────────────────────────────────────────────────────────────────────</span>

<span class="mi">1</span><span class="w"> </span><span class="nv">error</span><span class="w"> </span><span class="nv">and</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="nv">warnings</span><span class="w"> </span><span class="nv">found</span><span class="w"> </span><span class="kr">in</span><span class="w"> </span><span class="mi">34</span><span class="w"> </span><span class="nv">ms</span>
</code></pre></div>
<div class="codehilite" data-code-language="Elm"><pre><span></span><code><span class="nf">&gt;</span><span class="w"> </span><span class="nv">cat</span><span class="w"> </span><span class="kt">OptionalFields1</span><span class="nf">.</span><span class="nv">roc</span>
<span class="nv">interface</span><span class="w"> </span><span class="kt">OptionalFields1</span>
<span class="w">    </span><span class="nv">exposes</span><span class="w"> </span><span class="p">[]</span>
<span class="w">    </span><span class="nv">imports</span><span class="w"> </span><span class="p">[]</span>

<span class="kt">RecordWithOptional</span><span class="w"> </span><span class="nf">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nv">abc</span><span class="w"> </span><span class="nf">:</span><span class="w"> </span><span class="kt">U64</span><span class="p">,</span><span class="w"> </span><span class="nv">def</span><span class="w"> </span><span class="err">?</span><span class="w"> </span><span class="kt">U64</span><span class="w"> </span><span class="p">}</span>

<span class="nv">sumRecord</span><span class="w"> </span><span class="nf">:</span><span class="w"> </span><span class="kt">RecordWithOptional</span><span class="w"> </span><span class="nf">-&gt;</span><span class="w"> </span><span class="kt">U64</span>
<span class="nv">sumRecord</span><span class="w"> </span><span class="nf">=</span><span class="w"> </span><span class="nf">\</span><span class="p">{</span><span class="w"> </span><span class="nv">abc</span><span class="p">,</span><span class="w"> </span><span class="nv">def</span><span class="w"> </span><span class="err">?</span><span class="w"> </span><span class="mi">5</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="nf">-&gt;</span><span class="w"> </span><span class="nv">abc</span><span class="w"> </span><span class="nf">+</span><span class="w"> </span><span class="nv">def</span>

<span class="nv">expect</span>
<span class="w">    </span><span class="nv">sumRecord</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nv">abc</span><span class="w"> </span><span class="nf">:</span><span class="w"> </span><span class="mi">3</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="nf">==</span><span class="w"> </span><span class="mi">8</span>

<span class="nf">&gt;</span><span class="w"> </span><span class="nv">roc</span><span class="w"> </span><span class="nv">test</span><span class="w"> </span><span class="kt">OptionalFields1</span><span class="nf">.</span><span class="nv">roc</span>

<span class="mi">0</span><span class="w"> </span><span class="nv">failed</span><span class="w"> </span><span class="nv">and</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="nv">passed</span><span class="w"> </span><span class="kr">in</span><span class="w"> </span><span class="mi">147</span><span class="w"> </span><span class="nv">ms</span><span class="nf">.</span>
</code></pre></div>
<p>Please, note that if we stick to records containing the same subset of non-optional fields, then the compiler is happy in such instances:</p>
<div class="codehilite" data-code-language="Elm"><pre><span></span><code><span class="nf">&gt;</span><span class="w"> </span><span class="nv">cat</span><span class="w"> </span><span class="kt">OptionalFields3</span><span class="nf">.</span><span class="nv">roc</span>
<span class="nv">interface</span><span class="w"> </span><span class="kt">OptionalFields3</span>
<span class="w">    </span><span class="nv">exposes</span><span class="w"> </span><span class="p">[]</span>
<span class="w">    </span><span class="nv">imports</span><span class="w"> </span><span class="p">[]</span>

<span class="kt">RecordWithOptional</span><span class="w"> </span><span class="nf">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nv">abc</span><span class="w"> </span><span class="nf">:</span><span class="w"> </span><span class="kt">U64</span><span class="p">,</span><span class="w"> </span><span class="nv">def</span><span class="w"> </span><span class="err">?</span><span class="w"> </span><span class="kt">U64</span><span class="w"> </span><span class="p">}</span>

<span class="nv">sumRecord</span><span class="w"> </span><span class="nf">:</span><span class="w"> </span><span class="kt">RecordWithOptional</span><span class="w"> </span><span class="nf">-&gt;</span><span class="w"> </span><span class="kt">U64</span>
<span class="nv">sumRecord</span><span class="w"> </span><span class="nf">=</span><span class="w"> </span><span class="nf">\</span><span class="p">{</span><span class="w"> </span><span class="nv">abc</span><span class="p">,</span><span class="w"> </span><span class="nv">def</span><span class="w"> </span><span class="err">?</span><span class="w"> </span><span class="mi">5</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="nf">-&gt;</span><span class="w"> </span><span class="nv">abc</span><span class="w"> </span><span class="nf">+</span><span class="w"> </span><span class="nv">def</span>

<span class="nv">expect</span>
<span class="w">    </span><span class="nv">sumRecord</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nv">abc</span><span class="w"> </span><span class="nf">:</span><span class="w"> </span><span class="mi">3</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="nf">==</span><span class="w"> </span><span class="mi">8</span>

<span class="nv">expect</span>
<span class="w">    </span><span class="nv">sumRecord</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nv">abc</span><span class="w"> </span><span class="nf">:</span><span class="w"> </span><span class="mi">5</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="nf">==</span><span class="w"> </span><span class="mi">10</span><span class="w">  </span><span class="err">#</span><span class="w"> </span><span class="nf">&lt;-</span><span class="c1">--------- same subset of fields as in the first `expect` block</span>

<span class="nf">&gt;</span><span class="w"> </span><span class="nv">roc</span><span class="w"> </span><span class="nv">test</span><span class="w"> </span><span class="kt">OptionalFields3</span><span class="nf">.</span><span class="nv">roc</span>

<span class="mi">0</span><span class="w"> </span><span class="nv">failed</span><span class="w"> </span><span class="nv">and</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="nv">passed</span><span class="w"> </span><span class="kr">in</span><span class="w"> </span><span class="mi">143</span><span class="w"> </span><span class="nv">ms</span><span class="nf">.</span>
</code></pre></div>



<a name="431184501"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/optional%20field%20problem/near/431184501" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/optional.20field.20problem.html#431184501">(Apr 03 2024 at 22:03)</a>:</h4>
<p>Yep, that is the specialization bug.</p>



<hr><p>Last updated: Mar 01 2026 at 12:20 UTC</p>
</html>