<html>
<head><meta charset="utf-8"><title>Platform question · beginners · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/index.html">beginners</a></h2>
<h3>Topic: <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html">Platform question</a></h3>

<hr>

<base href="https://roc.zulipchat.com">

<head><link href="https://roc-lang.github.io/zulip-export/style.css" rel="stylesheet"></head>

<a name="258722406"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/258722406" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Martin Stewart <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#258722406">(Oct 22 2021 at 14:51)</a>:</h4>
<p>One thing I really like about Elm is that there's a single well written elm/http package that lots of other packages have built off of to support various rest APIs. In Roc, if I want to write a package to support a rest API, do I need to maintain multiple versions of it for each platforms own http API?</p>



<a name="258723148"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/258723148" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#258723148">(Oct 22 2021 at 14:55)</a>:</h4>
<p>our vision is that there is one package that exposes a <code>Request</code> type, and then many platforms can interpret that request description in whatever way they want</p>



<a name="258724107"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/258724107" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lucas Rosa <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#258724107">(Oct 22 2021 at 15:01)</a>:</h4>
<p>I believe Richard called these capability modules?</p>



<a name="258724169"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/258724169" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lucas Rosa <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#258724169">(Oct 22 2021 at 15:01)</a>:</h4>
<p>They essentially can be a base for common APIs</p>



<a name="258725162"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/258725162" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Martin Stewart <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#258725162">(Oct 22 2021 at 15:08)</a>:</h4>
<p>Cool, that's an interesting idea!</p>



<a name="259389597"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/259389597" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Oliver Schöning <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#259389597">(Oct 28 2021 at 13:41)</a>:</h4>
<p>Unsure if we should create new topics on Zulip or write in those that have a similar name to our question?</p>
<p>So I have been playing around with the rust examples and am also learning some more rust along the way since I am completely new to the language. <br>
What I want to accomplish to get more familar with roc and writing platforms:</p>
<p>I want to write a little roc platform example that extends the <code>cli</code> <code>readLine</code> / <code>writeLine</code> example. But instead of shutting down after writing out your first and lastname I want it to repeat from the start and ask again! That seems like a reasonably small project.<br>
But I don't want to just while loop / re-allocating the unsafe block in the cli <code>lib.rs</code> main example.<br>
I want to learn and understand how to keep the roc program alive and let it recive / emit "events" / "callbacks".</p>
<div class="codehilite"><pre><span></span><code>#[no_mangle]
pub extern &quot;C&quot; fn rust_main() -&gt; i32 {
    let size = unsafe { roc_main_size() } as usize;
    let layout = Layout::array::&lt;u8&gt;(size).unwrap();
    // I don&#39;t just want to while loop around this block and endlessly re-init the roc program...
    unsafe {
        // TODO allocate on the stack if it&#39;s under a certain size
        let buffer = std::alloc::alloc(layout);

        roc_main(buffer);

        let result = call_the_closure(buffer);

        std::alloc::dealloc(buffer, layout);

        result
    };

    // Exit code
    0
}
</code></pre></div>
<p>Could i get some help in how to accomplish that? <span aria-label="big smile" class="emoji emoji-1f604" role="img" title="big smile">:big_smile:</span><br>
Currently I do not know how to keep a roc program alive... or how to send "messages" back and forth between roc and the platform.</p>



<a name="259406015"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/259406015" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#259406015">(Oct 28 2021 at 15:29)</a>:</h4>
<p>Yeah, platforms can be a bit complex and are still in the process of being made nicer. I think the process of making them will probably be some of the biggest Roc library and abi changes in the future. There are also still a few missing pieces that make certain platform architectures painful or at least hard to make.</p>
<p>Anyway, to attempt to answer your questions.<br>
1) Your goal shouldn't need any platform changes. You should just be able to use recursion in the roc app.<br>
2) Calling a closure is unsafe, so you would need the repeated unsafe block if you want to change the platform as you mentioned. That being said, you should be able to keep the allocation and deallocation outside of the loop and just reuse the buffer.<br>
3) Keeping a roc program alive with some basic state and event handling done in the host is currently really annoying to maybe impossible to do as expected (should hopefully be updated soonish). Currently the sdl example is blocked on issues related to that (<a href="https://github.com/rtfeldman/roc/issues/1797">exposing multiple functions to host</a> and type boxing). The easier option currently is probably to define your context in Roc and recursively use it. The false-interpreter example does everything in Roc with a context for state.</p>



<a name="259448007"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/259448007" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Oliver Schöning <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#259448007">(Oct 28 2021 at 20:33)</a>:</h4>
<p>Thank you for that detailed step by step  <span class="user-mention" data-user-id="343810">@Brendan Hansknecht</span> !</p>
<p>I added <code>main</code> as the last line and it did indeed work:</p>
<div class="codehilite"><pre><span></span><code>main : Task {} *
main =
    {} &lt;- await (Stdout.line &quot;What&#39;s your first name?&quot;)

    firstName &lt;- await Stdin.line

    {} &lt;- await (Stdout.line &quot;What&#39;s your last name?&quot;)

    lastName &lt;- await Stdin.line

    Stdout.line &quot;Hi, \(firstName) \(lastName)!&quot;

    main
</code></pre></div>
<p>Altho I feel like this is not what I had in mind exactly, it certainly is a step in the right direction <span aria-label="smile" class="emoji emoji-1f642" role="img" title="smile">:smile:</span> <br>
There is no really any back and forth going on between Rust and Roc here. Would not work with a webserver platform for example. (if Roc blocks the thread in an infinite recursion "loop" and never lets the platform do anything anymore).<br>
I think part of my confusion might come from being a JS developer. The browser does not shut down after a "main" function has completed.<br>
I am so used to event based systems. Gonna take a look at that SDL github issue. Thank you.</p>



<a name="259451037"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/259451037" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#259451037">(Oct 28 2021 at 20:58)</a>:</h4>
<p>Also, it is possible to have a webserver, it's just that currently it would have to be a webserver with only a single function exposed to the host. That function either would get called directly on each request, or it would return a list of closures to be called on specific requests. So definitely doable with current roc, but not a nice event loop structure where you expose a small handful of functions (eg: model, view, update).</p>



<a name="259451379"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/259451379" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#259451379">(Oct 28 2021 at 21:00)</a>:</h4>
<p>There is a pr with a simple webserver. It probably still works, but hasn't been touched in a while. It opts for the first option of calling the same function for every request. It may also match what you are looking for.</p>



<a name="259451504"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/259451504" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#259451504">(Oct 28 2021 at 21:01)</a>:</h4>
<p><a href="https://github.com/rtfeldman/roc/pull/1635">Pr link</a></p>



<a name="259723235"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/259723235" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthias Beyer <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#259723235">(Oct 30 2021 at 10:29)</a>:</h4>
<p>I am hijacking this, hope this is okay.</p>
<p>So what I do not quite understand yet is how the link from my C API in the platform is made to the Roc code. Where is declared that I have to export <code>roc__mainForHost_1_exposed_generic</code> which then is <code>mainForHost</code> in the roc code? I do not see where that connection is made. And in addition: Am I allowed to export any symbol and it is automatically linked to roc? So for example if I have a <code>fn get_four() -&gt; i32 { 4 }</code> and I want to make that available in roc (of course via C calling convention, not via Rust calling convention), how do I export it to roc?</p>



<a name="259723473"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/259723473" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Oliver Schöning <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#259723473">(Oct 30 2021 at 10:35)</a>:</h4>
<p><span class="user-mention" data-user-id="343810">@Brendan Hansknecht</span> but that "one function exposed to the host" is the "main" is it not?</p>



<a name="259739406"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/259739406" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#259739406">(Oct 30 2021 at 16:30)</a>:</h4>
<p>The one function exposed to the host could be any one function with any set of arguments and return value. So it could be an event handler or something similar.</p>



<a name="259739600"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/259739600" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#259739600">(Oct 30 2021 at 16:35)</a>:</h4>
<p><span class="user-mention" data-user-id="453579">@Matthias Beyer</span> we definitely need to start improving the docs around this especially for platform builders. Essentially the package-config.roc defines the c API. It specifies which functions are imported and exported from roc. Then roc, when compiling, expects those functions with some minor name changes. Exposed functions from roc are definitely the most complex because they may return closures.</p>



<a name="259739755"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/259739755" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#259739755">(Oct 30 2021 at 16:38)</a>:</h4>
<p>All functions provided to roc that are specific to the platform are in the form <code>roc_fx_...</code></p>



<a name="259739891"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/259739891" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#259739891">(Oct 30 2021 at 16:41)</a>:</h4>
<p>There is also another set of functions that must always be provided that are used for memory management and panicking: <code>roc_panic</code>, <code>roc_alloc</code> <code>roc_realloc</code>, <code>rpc_dealloc</code> also 2 others that might go away in the Future: <code>roc_memcpy</code> and <code>roc_memset</code></p>



<a name="259740012"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/259740012" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#259740012">(Oct 30 2021 at 16:43)</a>:</h4>
<p>Then, if roc is exposing only a simple function, the function is just <code>roc__&lt;name&gt;_1_exposed</code>. If it is returning a closure, another set of extra information is exposed so the host can understand the closure.</p>



<a name="259740083"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/259740083" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthias Beyer <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#259740083">(Oct 30 2021 at 16:45)</a>:</h4>
<p>So if I implement a function <code>roc_fx_hereBeDragons</code> with a C ABI, I can call <code>hereBeDragons</code> from roc? Is it that simple?</p>



<a name="259740166"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/259740166" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#259740166">(Oct 30 2021 at 16:46)</a>:</h4>
<p>Have to add to the <code>Package-Config.roc</code> as well. Like the function signiture</p>



<a name="259740262"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/259740262" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#259740262">(Oct 30 2021 at 16:48)</a>:</h4>
<p>Also, roc forces it to be an effect so calling is normally done through tasks, not directly, but it is pretty similar.</p>



<a name="259796800"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/259796800" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tom Small <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#259796800">(Oct 31 2021 at 16:45)</a>:</h4>
<p>Can you explain a bit about how tasks and effects work? I've been trying to expose my own platform functions to my Roc code too, but haven't had much success yet.</p>



<a name="259808276"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/259808276" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#259808276">(Oct 31 2021 at 21:03)</a>:</h4>
<p>I will try, but I may not have the best answer. If I am off base, hopefully someone will jump in and correct me.</p>
<p>Essentially an Effect is a promise or a future. A wrapper that is capable of giving you a value. This is a type built into Roc. I think (though I could be wrong) that it is required as the return type from all platform functions. Roc deals with this translation internally, and the platform can still just return raw types.</p>
<p>A Task on the other hand is a common Roc module that is used to deal with the possibility of failure. A task is defined as <code>Task ok err : Effect.Effect (Result ok err)</code>. It enables nice chain-ability when it comes to the potential of errors. For example, <code>Task.await</code>, takes a task, runs a transformation on result if it is not an error and then returns a task that might or might not be an error.</p>



<a name="259949205"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/259949205" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tom Small <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#259949205">(Nov 02 2021 at 03:15)</a>:</h4>
<p>Thank you, Brendan! That's very helpful.</p>



<a name="263333202"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/263333202" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jason Hobbs <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#263333202">(Dec 01 2021 at 18:15)</a>:</h4>
<p>Where can I find documentation for Roc Platforms? (and the Roc Platforms themselves)</p>



<a name="263333452"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/263333452" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#263333452">(Dec 01 2021 at 18:16)</a>:</h4>
<p>it doesn't exist yet - my plan has been to write the tutorial for application authors first and then to move on to platform authors!</p>



<a name="263333863"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/263333863" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jason Hobbs <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#263333863">(Dec 01 2021 at 18:19)</a>:</h4>
<p>Ah, okay... how would you recommend I learn a platform's API? Maybe your "Edges of Cutting-Edge  Languages talk?"   Just figuring out where to go from looking at the initial Hello World examples (and this seems to be the next step).</p>



<a name="263334179"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/263334179" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#263334179">(Dec 01 2021 at 18:21)</a>:</h4>
<p>basically yes. Most examples have platforms written in rust or zig, so pick your favorite out of the 2 and see how the platform connects to the app</p>



<a name="263334273"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/263334273" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jason Hobbs <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#263334273">(Dec 01 2021 at 18:22)</a>:</h4>
<p>Actually, what you just said just clicked lol... I'm looking to be an Application author.</p>



<a name="263334370"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/263334370" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#263334370">(Dec 01 2021 at 18:22)</a>:</h4>
<p>for an app author the platform is just a bunch of roc code</p>



<a name="263334397"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/263334397" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#263334397">(Dec 01 2021 at 18:23)</a>:</h4>
<p>usually there is a <code>Task</code> module</p>



<a name="263334414"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/263334414" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#263334414">(Dec 01 2021 at 18:23)</a>:</h4>
<p>and then there can be some extra stuff around that</p>



<a name="263355729"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/263355729" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lucas Rosa <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#263355729">(Dec 01 2021 at 20:50)</a>:</h4>
<p><span class="user-mention" data-user-id="460629">@Jason Hobbs</span> I also gave a talk on zig showtime with a demo on how to work with platforms</p>



<a name="263355760"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/263355760" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lucas Rosa <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#263355760">(Dec 01 2021 at 20:50)</a>:</h4>
<p>you can skip the roc intro and go straight to the demo</p>



<a name="263355822"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/263355822" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lucas Rosa <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#263355822">(Dec 01 2021 at 20:51)</a>:</h4>
<p>if you're curious that is, but the examples folders are also good</p>



<a name="263355902"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/263355902" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jason Hobbs <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#263355902">(Dec 01 2021 at 20:51)</a>:</h4>
<p>So funny.. I just finished watching that like 5 minutes ago. Great talk on it... has me curious about using Node.js as a platform for kicks</p>



<a name="263355992"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/263355992" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lucas Rosa <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#263355992">(Dec 01 2021 at 20:52)</a>:</h4>
<p>hm interesting thought, I hadn't considered that<br>
and thanks :), it was my first public talk</p>



<a name="263356095"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/263356095" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#263356095">(Dec 01 2021 at 20:53)</a>:</h4>
<p>Probably would not be a pleasant experience. I would assume cffi in node would be annoying. Also, with rocs current compilation model and setup, I think extra work would need to be done manually or via updates to the compiler.</p>



<a name="263356222"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/263356222" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lucas Rosa <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#263356222">(Dec 01 2021 at 20:54)</a>:</h4>
<p>maybe it could work if you use zig to import node as a c lib?</p>



<a name="263356342"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/263356342" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#263356342">(Dec 01 2021 at 20:55)</a>:</h4>
<p>Is that a thing?</p>



<a name="263356473"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/263356473" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lucas Rosa <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#263356473">(Dec 01 2021 at 20:56)</a>:</h4>
<p>idk I'm just spit balling lol</p>



<a name="263356490"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/263356490" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lucas Rosa <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#263356490">(Dec 01 2021 at 20:56)</a>:</h4>
<p><span aria-label="rolling on the floor laughing" class="emoji emoji-1f923" role="img" title="rolling on the floor laughing">:rolling_on_the_floor_laughing:</span></p>



<a name="263358591"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/263358591" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jason Hobbs <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#263358591">(Dec 01 2021 at 21:14)</a>:</h4>
<p>lol I guess I imagined the Platform-to-Application API as being more loosely connected. Makes sense for performance it isn't.</p>



<a name="263358787"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/263358787" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#263358787">(Dec 01 2021 at 21:16)</a>:</h4>
<p>A roc application is essentially a static library that the platform depends on.</p>



<a name="263359456"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/263359456" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jason Hobbs <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#263359456">(Dec 01 2021 at 21:22)</a>:</h4>
<p>Is it the LLVM that makes it compatible across different languages? Or is there some other common protocol for the static libraries to work? (Might be an odd question - I don't have much experience linking libraries or using systems-level languages)</p>



<a name="263359567"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/263359567" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lucas Rosa <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#263359567">(Dec 01 2021 at 21:23)</a>:</h4>
<p>it's the C ABI</p>



<a name="263359569"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/263359569" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#263359569">(Dec 01 2021 at 21:23)</a>:</h4>
<p>cffi is a standard protocol supported by most languages.</p>



<a name="263359747"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/263359747" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jason Hobbs <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#263359747">(Dec 01 2021 at 21:25)</a>:</h4>
<p>oh, okay.. nice.</p>



<a name="267044110"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/267044110" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jan kili <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#267044110">(Jan 06 2022 at 10:10)</a>:</h4>
<p>If an application wants to use any pseudo-random number generation, will the application need to use a platform that exports a pRNG function?</p>



<a name="267044201"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/267044201" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jan kili <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#267044201">(Jan 06 2022 at 10:11)</a>:</h4>
<p>(or a noise function, from like a clock or thermometer)</p>



<a name="267044842"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/267044842" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jan kili <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#267044842">(Jan 06 2022 at 10:19)</a>:</h4>
<p>I'm just thinking of simple randomness ergonomics like Python's <code>random.choice([a, b, c, ...])</code>, but maybe randomness in FP is its own can of worms?</p>



<a name="267045495"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/267045495" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#267045495">(Jan 06 2022 at 10:27)</a>:</h4>
<p>in elm it's enough for the platform to provide a seed value</p>



<a name="267047132"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/267047132" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jan kili <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#267047132">(Jan 06 2022 at 10:47)</a>:</h4>
<p>(After quickly reading about RNG in Elm...) Are you referring to Elm's <code>step</code> function? Or would an effectful function like <code>generate</code> be preferable?</p>
<p>Perhaps RNG-supportive Roc platforms should provide a seed generator function like <code>getSeed : {} -&gt; U128</code>, and then platform-agnostic randomness packages can provide ergonomic abstractions. (Ex: <code>choice : List a, U128 -&gt; a</code>)</p>
<p>Of course, platforms could also provide their own domain-specific abstractions. (Hmm, I can't think of a good example.)</p>



<a name="267047868"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/267047868" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#267047868">(Jan 06 2022 at 10:55)</a>:</h4>
<p>it would have to be a <code>{} -&gt; Random.Random U128</code> function; the value returned by getSeed is different every time, so it needs to be somehow wrapped to keep the rest of the language pure</p>



<a name="267048179"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/267048179" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jan kili <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#267048179">(Jan 06 2022 at 10:59)</a>:</h4>
<p>Is that to prevent inaccurate memoization? Is that wrapper somehow recognized as opaque?</p>



<a name="267048420"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/267048420" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#267048420">(Jan 06 2022 at 11:01)</a>:</h4>
<p>purity (same input always gives the same output) is very core to roc, a bunch of things don't make sense without it</p>



<a name="267048498"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/267048498" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#267048498">(Jan 06 2022 at 11:02)</a>:</h4>
<p>for instance we can currently freely reorder definitions in a let block. That's not true without purity</p>



<a name="267048567"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/267048567" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#267048567">(Jan 06 2022 at 11:03)</a>:</h4>
<p>and yeah a wrapper like <code>Seed : [ @Seed U128 ]</code> is opaque and has no runtime cost versus just the U128</p>



<a name="267048602"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/267048602" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#267048602">(Jan 06 2022 at 11:03)</a>:</h4>
<p>the <code>Random.Random</code> (or <code>Random.Generator</code>) is meant to chain randomness</p>



<a name="267048675"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/267048675" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#267048675">(Jan 06 2022 at 11:04)</a>:</h4>
<p>it's defined as <code>Random a : [ @Random (Seed -&gt; { value : a, newSeed : Seed }) ]</code></p>



<a name="267048692"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/267048692" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#267048692">(Jan 06 2022 at 11:04)</a>:</h4>
<p>and on that type you can define <code>map2</code> and <code>after/andThen</code> ect</p>



<a name="267049064"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/267049064" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jan kili <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#267049064">(Jan 06 2022 at 11:09)</a>:</h4>
<p>Gotcha! Thanks for that great explanation. Are those built-in Elm types that you expect to be emulated by many Roc platform authors?</p>



<a name="267049491"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/267049491" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#267049491">(Jan 06 2022 at 11:15)</a>:</h4>
<p>this is similar to http I think where there could be a generic <code>Random</code> package with the types and map2/andThen, and the platform provides the function to get a new seed</p>



<a name="267049513"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/267049513" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#267049513">(Jan 06 2022 at 11:15)</a>:</h4>
<p>actually that would be <code>getSeed : Task Seed *</code> in practice I think</p>



<a name="267049620"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/267049620" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#267049620">(Jan 06 2022 at 11:17)</a>:</h4>
<p>and of course you could also have a <code>constantSeed : U128 -&gt; Seed</code> or something like that in the random package, mostly for testing</p>



<a name="267050101"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/267050101" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jan kili <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#267050101">(Jan 06 2022 at 11:22)</a>:</h4>
<p>Perfect. I wonder what percentage of platforms will support RNG! I'm used to it as a language built-in, but I suppose that some application categories need it more than others (game engines vs. text editors?). That might be reflected in different platform authors seeing it as critical vs. bloat.</p>



<a name="267051512"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/267051512" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#267051512">(Jan 06 2022 at 11:40)</a>:</h4>
<p>yes. Note that with the <code>constantSeed</code> you could use any entropy. So e.g. if your application has users, you could use the username as the initial seed (need some hashing or something to turn it into a number, but it's doable)</p>



<a name="267051562"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/267051562" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#267051562">(Jan 06 2022 at 11:41)</a>:</h4>
<p>so even if the platform does not provide it conveniently, if it gives you anything that is varying in a meaningful way (time of day, ...) you could use that to make an effectively random seed</p>



<a name="267051568"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/267051568" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#267051568">(Jan 06 2022 at 11:41)</a>:</h4>
<p>(this is all not cryptographic of course)</p>



<a name="267080489"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/267080489" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#267080489">(Jan 06 2022 at 16:23)</a>:</h4>
<p>yeah, actually the package that eventually became <code>elm/random</code> was originally implemented entirely as a third-party package with no language integration or dependency on effects: <a href="https://github.com/mgold/elm-random-pcg">https://github.com/mgold/elm-random-pcg</a></p>



<a name="267080544"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/267080544" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#267080544">(Jan 06 2022 at 16:23)</a>:</h4>
<p>it was eventually moved into <code>elm/random</code> because it became the recommended way to do things, and at that point it also picked up the <code>generate</code> task</p>



<a name="267080715"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/267080715" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#267080715">(Jan 06 2022 at 16:25)</a>:</h4>
<p>so in Roc it could just be implemented as a third-party library along the same lines as the original Elm implementation, which would naturally imply that it's platform-agnostic!</p>



<a name="267080865"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/267080865" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#267080865">(Jan 06 2022 at 16:26)</a>:</h4>
<p>that Elm implementation is based on <a href="https://www.pcg-random.org/">https://www.pcg-random.org/</a> (hence the name <code>random-pcg</code>), although it had to do some tricks to work around how browsers don't support 64-bit integers natively (or didn't at the time), such as using two 32-bit integers instead</p>



<a name="267081173"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/267081173" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#267081173">(Jan 06 2022 at 16:28)</a>:</h4>
<p>so an ideal Roc implementation would probably have a public API with a lot of similarities to the Elm one, but an internal implementation that might look more like a Roc port of <a href="https://github.com/rust-random/rand">https://github.com/rust-random/rand</a> because of the 64-bit integer support</p>



<a name="267140482"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/267140482" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jan kili <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#267140482">(Jan 07 2022 at 01:29)</a>:</h4>
<p>Well that sounds like a good <code>## Goals</code> section to me!</p>



<a name="267140494"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/267140494" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jan kili <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#267140494">(Jan 07 2022 at 01:29)</a>:</h4>
<p>Let the RNG begin: <a href="https://github.com/JanCVanB/roc-random">https://github.com/JanCVanB/roc-random</a></p>



<a name="267140533"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/267140533" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jan kili <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#267140533">(Jan 07 2022 at 01:30)</a>:</h4>
<p>Contributors welcome!</p>



<a name="267142591"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/267142591" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#267142591">(Jan 07 2022 at 02:04)</a>:</h4>
<p>yoooooo, that's awesome! lmk if you have any questions about the Elm version - Max and I used to go to San Francisco Elm meetups back in the day and talk about it when he was developing it <span aria-label="smiley" class="emoji emoji-1f603" role="img" title="smiley">:smiley:</span></p>



<a name="267142946"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/267142946" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jan kili <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#267142946">(Jan 07 2022 at 02:11)</a>:</h4>
<p>Thanks, right now I'm having fun contorting my brain to translate code with <code>[personally-semi-advanced math concept]</code> from <code>[personally-unlearned programming language] </code> to <code>[objectively-unfinished programming language]</code> while utilizing <code>[newly-proposed platform-agnosticity pattern]</code> to future-proof it for use with <code>[nonexistent potential platforms]</code> through <code>[nonexistent publishing system]</code> <span aria-label="sweat smile" class="emoji emoji-1f605" role="img" title="sweat smile">:sweat_smile:</span></p>



<a name="267143027"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/267143027" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#267143027">(Jan 07 2022 at 02:13)</a>:</h4>
<p>I love the ambition! <span aria-label="smiley" class="emoji emoji-1f603" role="img" title="smiley">:smiley:</span></p>



<a name="267144863"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/267144863" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#267144863">(Jan 07 2022 at 02:44)</a>:</h4>
<p>The nice part is that even without a packaging system, it can probably be copied into any random platform and used.</p>



<a name="267186295"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/267186295" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#267186295">(Jan 07 2022 at 13:05)</a>:</h4>
<p>to be fair, that's how you end up being the person who says "I wrote the random generation library everybody uses in Roc" <span aria-label="grinning face with smiling eyes" class="emoji emoji-1f601" role="img" title="grinning face with smiling eyes">:grinning_face_with_smiling_eyes:</span></p>



<a name="267197037"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/267197037" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Carroll <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#267197037">(Jan 07 2022 at 14:48)</a>:</h4>
<p><span class="user-mention" data-user-id="462053">@JanCVanB</span> this is great!<br>
Not sure if you're aware of this already but if you're trying to figure out what some unfamiliar Elm code is doing, then <a href="https://package.elm-lang.org/packages/elm/core/latest/Debug#log">Debug.log</a> is your friend. For example you could clone the repo and then start inserting <code>_ = Debug.log "some_var" some_var</code> into <code>let</code> blocks all over the place, then run the tests and see what comes out on the console.</p>



<a name="269865764"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/269865764" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jan kili <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#269865764">(Jan 29 2022 at 13:57)</a>:</h4>
<p>I (a newborn Rustling) am trying to create a Bevy <a href="https://docs.rs/bevy/latest/bevy/">https://docs.rs/bevy/latest/bevy/</a> "hello world" platform by adapting <code>examples/hello-rust/platform</code>. While I could post the wide and wild variety of errors I'm getting, what files would you expect me to need to change to get Bevy to compile (just a minimal hello popup)? I'm currently changing <code>platform/sec/lib.rs</code> and <code>platform/Cargo.toml</code>.</p>



<a name="269866886"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/269866886" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#269866886">(Jan 29 2022 at 14:18)</a>:</h4>
<p>that page you link has an example. In theory you could just have the platform not use any roc code at all, so changing the platform rust code to that example should do it? (swap <code>main</code> for <code>rust_main</code>)</p>



<a name="269867404"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/269867404" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jan kili <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#269867404">(Jan 29 2022 at 14:29)</a>:</h4>
<p>So no <code>Cargo.toml</code> changes necessary?</p>



<a name="269867489"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/269867489" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jan kili <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#269867489">(Jan 29 2022 at 14:30)</a>:</h4>
<p>Last night I tried injecting Bevy main into Rust main function and got so many angry messages haha</p>



<a name="269867493"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/269867493" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#269867493">(Jan 29 2022 at 14:30)</a>:</h4>
<p>oh, yes sure</p>



<a name="269867498"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/269867498" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#269867498">(Jan 29 2022 at 14:30)</a>:</h4>
<p>you'd need to add bevy to the dependencies section of the <code>Cargo.toml</code></p>



<a name="269867516"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/269867516" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#269867516">(Jan 29 2022 at 14:31)</a>:</h4>
<p>typically you can find what to add on <code>crates.io</code>: <a href="https://crates.io/crates/bevy">https://crates.io/crates/bevy</a></p>



<a name="269867523"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/269867523" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#269867523">(Jan 29 2022 at 14:31)</a>:</h4>
<p>so <code>bevy = "0.6.0"</code> in this case</p>



<a name="269867711"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/269867711" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jan kili <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#269867711">(Jan 29 2022 at 14:35)</a>:</h4>
<p>Great - sounds like I'm on the right track :)</p>



<a name="269867814"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/269867814" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jan kili <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#269867814">(Jan 29 2022 at 14:37)</a>:</h4>
<p>Bevy recommends "dynamic" in its dependency definition, but that causes errors about bevy missing "rlib"</p>



<a name="269867898"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/269867898" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jan kili <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#269867898">(Jan 29 2022 at 14:38)</a>:</h4>
<p>Last I saw, without bevy dynamic, it was complaining about hundreds of missing files that started with underscores - can post details later</p>



<a name="269867905"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/269867905" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jan kili <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#269867905">(Jan 29 2022 at 14:38)</a>:</h4>
<p>Thanks!</p>



<a name="269868026"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/269868026" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#269868026">(Jan 29 2022 at 14:40)</a>:</h4>
<p>hmm you could try getting bevy to run just outside of a roc context</p>



<a name="269868042"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/269868042" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#269868042">(Jan 29 2022 at 14:40)</a>:</h4>
<p>it's hard to know now if the problem is with roc or with rust or bevy</p>



<a name="269870311"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/269870311" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jan kili <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#269870311">(Jan 29 2022 at 15:23)</a>:</h4>
<p>I got their hello world working normally, but when I integrated with Roc it was hard to say what failed</p>



<a name="269904015"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/269904015" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jan kili <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#269904015">(Jan 30 2022 at 02:25)</a>:</h4>
<p>Here's where I'm stuck, if anyone can help <span aria-label="smile" class="emoji emoji-1f642" role="img" title="smile">:smile:</span> <a href="https://github.com/rtfeldman/roc/commit/88c94bf3031feb7f9bad4008cd403bd0b2f42db5">https://github.com/rtfeldman/roc/commit/88c94bf3031feb7f9bad4008cd403bd0b2f42db5</a><br>
(This is not intended as a WIP contribution, it's just pushed to the repo for convenient diff-ing)</p>



<a name="269932763"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/269932763" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jan kili <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#269932763">(Jan 30 2022 at 13:23)</a>:</h4>
<p>Well, this seems solidly beyond my Rust abilities now:<br>
<code>ld: symbol(s) not found for architecture x86_64</code><br>
<code>error: linking with </code>cc<code> failed: exit status: 1</code><br>
<code>  = note: clang-7: error: invalid version number in '-mmacosx-version-min=12.0'</code><br>
I seem to be experiencing <a href="https://github.com/rust-lang/rust/issues/91372">https://github.com/rust-lang/rust/issues/91372</a> via <a href="https://github.com/rust-lang/rust/issues/91781">https://github.com/rust-lang/rust/issues/91781</a>, but the fixes they mention don't seem to work for me. <span aria-label="shrug" class="emoji emoji-1f937" role="img" title="shrug">:shrug:</span></p>



<a name="269932883"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/269932883" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#269932883">(Jan 30 2022 at 13:25)</a>:</h4>
<p><span class="user-mention" data-user-id="281383">@Richard Feldman</span> could this be because we have some C code in the rust platforms? I always forget why that was needed, but maybe information gets lost in the process?</p>



<a name="269933392"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/269933392" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#269933392">(Jan 30 2022 at 13:36)</a>:</h4>
<p>it's needed until we can switch over to surgical linking for everything</p>



<a name="269933423"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/269933423" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#269933423">(Jan 30 2022 at 13:37)</a>:</h4>
<p><a href="https://users.rust-lang.org/t/error-when-compiling-linking-with-o-files/49635/5?u=rtfeldman">https://users.rust-lang.org/t/error-when-compiling-linking-with-o-files/49635/5?u=rtfeldman</a></p>



<a name="269933542"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/269933542" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#269933542">(Jan 30 2022 at 13:39)</a>:</h4>
<p><span class="user-mention" data-user-id="462053">@JanCVanB</span> is there a commit somewhere I can check out so I can try it on my machine?</p>



<a name="269933554"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/269933554" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jan kili <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#269933554">(Jan 30 2022 at 13:39)</a>:</h4>
<p>Yes! <a href="https://github.com/rtfeldman/roc/commit/88c94bf3031feb7f9bad4008cd403bd0b2f42db5">https://github.com/rtfeldman/roc/commit/88c94bf3031feb7f9bad4008cd403bd0b2f42db5</a></p>



<a name="269933584"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/269933584" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jan kili <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#269933584">(Jan 30 2022 at 13:40)</a>:</h4>
<p>Thank you both :)</p>



<a name="269939872"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/269939872" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#269939872">(Jan 30 2022 at 15:51)</a>:</h4>
<p>hm, I can't build bevy at all on my M1 (even outside Roc) because I'm running into <a href="https://github.com/bevyengine/bevy/issues/928#issuecomment-943882168">https://github.com/bevyengine/bevy/issues/928#issuecomment-943882168</a> <span aria-label="sweat smile" class="emoji emoji-1f605" role="img" title="sweat smile">:sweat_smile:</span></p>



<a name="269939882"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/269939882" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#269939882">(Jan 30 2022 at 15:51)</a>:</h4>
<p><span class="user-mention" data-user-id="462053">@JanCVanB</span> are you on an M1 or x64 mac?</p>



<a name="269941226"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/269941226" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jan kili <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#269941226">(Jan 30 2022 at 16:14)</a>:</h4>
<p>x64</p>



<a name="269941240"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/269941240" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jan kili <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#269941240">(Jan 30 2022 at 16:14)</a>:</h4>
<p>Their helloworld &amp; breakout examples build for me</p>



<a name="269943684"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/269943684" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ayaz Hafiz <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#269943684">(Jan 30 2022 at 17:05)</a>:</h4>
<p>I tried this with the latest nightly of rust, which is supposed to have the fix for #91372, and that didn't work either</p>



<a name="269963251"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/269963251" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#269963251">(Jan 30 2022 at 22:59)</a>:</h4>
<p>so I guess a reasonable question is: how important is it that it be bevy specifically? <span aria-label="sweat smile" class="emoji emoji-1f605" role="img" title="sweat smile">:sweat_smile:</span></p>



<a name="269963303"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/269963303" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#269963303">(Jan 30 2022 at 23:00)</a>:</h4>
<p>I have an x64 mac I can try it on tomorrow</p>



<a name="269963723"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/269963723" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jan kili <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#269963723">(Jan 30 2022 at 23:08)</a>:</h4>
<p>Haha, to me? Very. To the community? Probably not.</p>



<a name="269963738"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/269963738" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jan kili <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#269963738">(Jan 30 2022 at 23:09)</a>:</h4>
<p>I haven't tried the fix yet, but might get some coding in tonight to try it :) thanks!</p>



<a name="269963889"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/269963889" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#269963889">(Jan 30 2022 at 23:12)</a>:</h4>
<p>shot in the dark: <code>clang-7: error: invalid version number in '-mmacosx-version-min=12.0'</code> - when you run <code>clang --version</code> what does it say?</p>



<a name="269963929"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/269963929" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#269963929">(Jan 30 2022 at 23:13)</a>:</h4>
<p>oh also what version of macOS are you on?</p>



<a name="269963996"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/269963996" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jan kili <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#269963996">(Jan 30 2022 at 23:14)</a>:</h4>
<p>That's a good question - I'm afk right now, but that was my error when running with some recommended env var like <code>MACOSX_DEPLOYMENT_TARGET=12.0 &amp;&amp; cargo run examples/hello-rust/Hello.roc</code></p>



<a name="269964000"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/269964000" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jan kili <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#269964000">(Jan 30 2022 at 23:14)</a>:</h4>
<p>I'm on 12.0.1</p>



<a name="269978159"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/269978159" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jan kili <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#269978159">(Jan 31 2022 at 04:15)</a>:</h4>
<div class="codehilite"><pre><span></span><code>[nix-shell:~/code/clones/roc]$ clang --version
clang version 7.1.0 (tags/RELEASE_710/final)
Target: x86_64-apple-darwin
Thread model: posix
InstalledDir: /nix/store/zfh3npfhfjjgwi0dqpriklip5k15ppmj-clang-7.1.0/bin
</code></pre></div>



<a name="269979245"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/269979245" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jan kili <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#269979245">(Jan 31 2022 at 04:39)</a>:</h4>
<p>I'll take this debugging into <a href="https://github.com/rtfeldman/roc/issues/2432">https://github.com/rtfeldman/roc/issues/2432</a></p>



<a name="269980772"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/269980772" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jan kili <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#269980772">(Jan 31 2022 at 05:09)</a>:</h4>
<p>Unrelated to this debugging, Bevy's API looks super-resistant to first-level Roc-ification:</p>
<ul>
<li>struct literals</li>
<li>derive macros</li>
<li><code>mut</code> parameters<br>
<span aria-label="laughter tears" class="emoji emoji-1f602" role="img" title="laughter tears">:laughter_tears:</span></li>
</ul>



<a name="269980942"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/269980942" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jan kili <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#269980942">(Jan 31 2022 at 05:12)</a>:</h4>
<p>However, second-level Roc-ification seems promising:</p>
<ul>
<li>platform is bound to one game genre/subgenre (entities, components, systems, and composing them into an app)</li>
<li>apps define internal logic for those game systems (setup, scoring, interactions, etc.)</li>
</ul>



<a name="269981227"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/269981227" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jan kili <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#269981227">(Jan 31 2022 at 05:17)</a>:</h4>
<p>Example for a 2D platformer (like Super Mario): The platform says that there must be a <code>Player</code> that <code>jump</code>s, but the Roc app must specify when the jump happens via keymapping, how the jump looks via animation curve, when the jump is allowed via state machine rules, and how the jump is interrupted via collision rules. <span aria-label="smiley" class="emoji emoji-1f603" role="img" title="smiley">:smiley:</span></p>



<a name="270158131"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/270158131" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jan kili <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#270158131">(Feb 01 2022 at 06:11)</a>:</h4>
<p>Can a platform <code>requires</code> multiple things?<br>
I can make a one-<code>requires</code> platform work, even if the def isn't named <code>main</code>.<br>
Now I'm trying to get this two-<code>requires</code> platform to work:</p>
<div class="codehilite" data-code-language="Haskell"><pre><span></span><code><span class="nf">platform</span><span class="w"> </span><span class="s">"breakout"</span><span class="w"></span>
<span class="w">    </span><span class="n">requires</span><span class="w"> </span><span class="p">{}</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">ballSpeed</span><span class="w"> </span><span class="kt">:</span><span class="w"> </span><span class="kt">Dec</span><span class="p">,</span><span class="w"> </span><span class="n">paddleSpeed</span><span class="w"> </span><span class="kt">:</span><span class="w"> </span><span class="kt">Dec</span><span class="w"> </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="n">exposes</span><span class="w"> </span><span class="kt">[]</span><span class="w"></span>
<span class="w">    </span><span class="n">packages</span><span class="w"> </span><span class="p">{}</span><span class="w"></span>
<span class="w">    </span><span class="n">imports</span><span class="w"> </span><span class="kt">[]</span><span class="w"></span>
<span class="w">    </span><span class="n">provides</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="n">ballSpeedForHost</span><span class="p">,</span><span class="w"> </span><span class="n">paddleSpeedForHost</span><span class="w"> </span><span class="p">]</span><span class="w"></span>
<span class="w">    </span><span class="n">effects</span><span class="w"> </span><span class="n">fx</span><span class="o">.</span><span class="kt">Effect</span><span class="w"> </span><span class="p">{}</span><span class="w"></span>

<span class="nf">ballSpeedForHost</span><span class="w"> </span><span class="kt">:</span><span class="w"> </span><span class="kt">Dec</span><span class="w"></span>
<span class="nf">ballSpeedForHost</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="n">ballSpeed</span><span class="w"></span>

<span class="nf">paddleSpeedForHost</span><span class="w"> </span><span class="kt">:</span><span class="w"> </span><span class="kt">Dec</span><span class="w"></span>
<span class="nf">paddleSpeedForHost</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="n">paddleSpeed</span><span class="w"></span>
</code></pre></div>
<p>but I get this error:</p>
<div class="codehilite" data-code-language="Haskell"><pre><span></span><code><span class="err">──</span><span class="w"> </span><span class="kt">MISSING</span><span class="w"> </span><span class="kt">REQUIRES</span><span class="w"> </span><span class="err">────────────────────────────────────────────────────────────</span><span class="w"></span>

<span class="kt">I</span><span class="w"> </span><span class="n">am</span><span class="w"> </span><span class="n">partway</span><span class="w"> </span><span class="n">through</span><span class="w"> </span><span class="n">parsing</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">header</span><span class="p">,</span><span class="w"> </span><span class="n">but</span><span class="w"> </span><span class="kt">I</span><span class="w"> </span><span class="n">got</span><span class="w"> </span><span class="n">stuck</span><span class="w"> </span><span class="n">here</span><span class="kt">:</span><span class="w"></span>

<span class="mi">1</span><span class="err">│</span><span class="w">  </span><span class="n">platform</span><span class="w"> </span><span class="s">"breakout"</span><span class="w"></span>
<span class="mi">2</span><span class="err">│</span><span class="w">      </span><span class="n">requires</span><span class="w"> </span><span class="p">{}</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">ballSpeed</span><span class="w"> </span><span class="kt">:</span><span class="w"> </span><span class="kt">Str</span><span class="p">,</span><span class="w"> </span><span class="n">paddleSpeed</span><span class="w"> </span><span class="kt">:</span><span class="w"> </span><span class="kt">Str</span><span class="w"> </span><span class="p">}</span><span class="w"></span>
<span class="w">                                     </span><span class="o">^</span><span class="w"></span>

<span class="kt">I</span><span class="w"> </span><span class="n">am</span><span class="w"> </span><span class="n">expecting</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">requires</span><span class="w"> </span><span class="n">keyword</span><span class="w"> </span><span class="n">next</span><span class="p">,</span><span class="w"> </span><span class="n">like</span><span class="w"></span>

<span class="w">    </span><span class="n">requires</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">main</span><span class="w"> </span><span class="kt">:</span><span class="w"> </span><span class="kt">Task</span><span class="w"> </span><span class="kt">I64</span><span class="w"> </span><span class="kt">Str</span><span class="w"> </span><span class="p">}</span><span class="w"></span>
</code></pre></div>



<a name="270167584"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/270167584" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#270167584">(Feb 01 2022 at 08:22)</a>:</h4>
<p>not currently, a quick fix is to accept a record with the fields that you want</p>



<a name="270167836"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/270167836" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jan kili <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#270167836">(Feb 01 2022 at 08:24)</a>:</h4>
<p>That would be great, though since I didn't see a <code>RocRecord</code> in <code>roc_std</code>, I didn't know how to proceed with that approach.</p>



<a name="270167936"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/270167936" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#270167936">(Feb 01 2022 at 08:25)</a>:</h4>
<p>you can expose multiple things from the package config</p>



<a name="270167946"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/270167946" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#270167946">(Feb 01 2022 at 08:25)</a>:</h4>
<p>hmm wait no</p>



<a name="270167948"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/270167948" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#270167948">(Feb 01 2022 at 08:25)</a>:</h4>
<p>well kinda</p>



<a name="270168094"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/270168094" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#270168094">(Feb 01 2022 at 08:27)</a>:</h4>
<p>you can expose a record, and that turns into a rust struct in a predictable way</p>



<a name="270168160"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/270168160" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#270168160">(Feb 01 2022 at 08:28)</a>:</h4>
<p>on the rust side you need to make sure the struct sorts its fields first by alignment, then by name of the field, and it's annotated with <code>#[repr(C)]</code></p>



<a name="270931424"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/270931424" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jan kili <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#270931424">(Feb 07 2022 at 04:28)</a>:</h4>
<p><span class="user-mention silent" data-user-id="281543">Folkert de Vries</span> <a href="#narrow/stream/231634-beginners/topic/Platform.20question/near/270168160">said</a>:</p>
<blockquote>
<p>on the rust side you need to make sure the struct sorts its fields first by alignment, then by name of the field, and it's annotated with <code>#[repr(C)]</code></p>
</blockquote>
<p>I just tried this, and it works!</p>



<a name="270931440"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/270931440" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jan kili <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#270931440">(Feb 07 2022 at 04:28)</a>:</h4>
<p>I never expected to dive this much into platform development, but it's smooth!</p>



<a name="270936510"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/270936510" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jan kili <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#270936510">(Feb 07 2022 at 06:04)</a>:</h4>
<p><a href="/user_uploads/22008/s8XjKzkl2AxdEJdxsfTpDZQE/hello_world.png">hello_world.png</a></p>
<div class="message_inline_image"><a href="/user_uploads/22008/s8XjKzkl2AxdEJdxsfTpDZQE/hello_world.png" title="hello_world.png"><img src="/user_uploads/22008/s8XjKzkl2AxdEJdxsfTpDZQE/hello_world.png"></a></div>



<a name="270938493"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/270938493" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jan kili <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#270938493">(Feb 07 2022 at 06:43)</a>:</h4>
<p><span class="user-mention" data-user-id="281543">@Folkert de Vries</span> are nested Records expose-able?</p>



<a name="270938517"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/270938517" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jan kili <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#270938517">(Feb 07 2022 at 06:43)</a>:</h4>
<p>I'm getting this: <code>emitted runtime error function "The </code>8.IdentId(0)<code> function could not be generated, likely due to a type error."</code><br>
(though it may be from some unrelated mistake)</p>



<a name="270943420"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/270943420" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jan kili <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#270943420">(Feb 07 2022 at 07:59)</a>:</h4>
<p>Also, any tips on passing a record field like <code>List F32</code> to Rust? Or should I just experiment?</p>



<a name="271003639"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/271003639" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#271003639">(Feb 07 2022 at 16:24)</a>:</h4>
<p>it should just work</p>



<a name="271003717"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/271003717" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#271003717">(Feb 07 2022 at 16:24)</a>:</h4>
<p>and nested records also should just work</p>



<a name="271003776"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/271003776" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#271003776">(Feb 07 2022 at 16:25)</a>:</h4>
<p>only tricky thing is the order of record fields on the C/Rust/... side</p>



<a name="271017707"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/271017707" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jan kili <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#271017707">(Feb 07 2022 at 18:01)</a>:</h4>
<p>How would you write/order the matching Rust struct for this Record?</p>
<div class="codehilite"><pre><span></span><code>a : {
    b : Str,
    c : U8,
    d : U32,
    e : List U8,
    f : List U32,
    g : {
        h : U32,
        i : I32,
        j : List U32,
        k : List I32},
    x : List { y : Str, z : Str } }
</code></pre></div>



<a name="271022827"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/271022827" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#271022827">(Feb 07 2022 at 18:36)</a>:</h4>
<p>Allright, adding an alias for clarity</p>
<div class="codehilite"><pre><span></span><code>T : 
    {
        h : U32,
        i : I32,
        j : List U32,
        k : List I32,
    }

U : 
    {
        b : Str,
        c : U8,
        d : U32,
        e : List U8,
        f : List U32,
        g : T,
        x : List { y : Str, z : Str } 
    }
</code></pre></div>

<p>We can start with <code>T</code>: the rule is sort first by alignment, then by field name.<br>
(for this you need to know some stuff about alignment, I can elaborate if you're not sure how that works)</p>
<p>For this record, we're done immediately (lists store a pointer and a length (as a nat/usize) and hence have the alignment of a pointer which is equal to the alignment of a usize). </p>
<div class="codehilite"><pre><span></span><code>{
    h : U32,
    i : I32,
    j : List U32,
    k : List I32,
}
</code></pre></div>

<p>Compound structures have the alignment equal to the maximum of the alignment of their fields. That means we can sort the fields by alignmenthere:</p>
<div class="codehilite"><pre><span></span><code>{
    c : U8,
    d : U32,
    b : Str,
    e : List U8,
    f : List U32,
    g : T,
    x : List { y : Str, z : Str } 
}
</code></pre></div>

<p>because of the names you picked this is also already sorted by field name</p>



<a name="271030505"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/271030505" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jan kili <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#271030505">(Feb 07 2022 at 19:34)</a>:</h4>
<p>I see, so small-to-large alignment order goes like this?</p>
<div class="codehilite"><pre><span></span><code>I8 == U8
I16 == U16
I32 == U32
I64 == U64 == Str == List * == Record *
I128 == U128
</code></pre></div>



<a name="271030729"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/271030729" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#271030729">(Feb 07 2022 at 19:36)</a>:</h4>
<p><code>Record *</code> is not correct there. Record fields are stored on the stack (while list elements are stored on the heap)</p>



<a name="271030752"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/271030752" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#271030752">(Feb 07 2022 at 19:36)</a>:</h4>
<p>that means that what types a record's fields have influence the record's alignment</p>



<a name="271030792"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/271030792" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#271030792">(Feb 07 2022 at 19:36)</a>:</h4>
<p>so a record <code>{ x : u8 }</code> has an alignment of 1, but a record <code>{ x : U128 }</code> has an alignment of 16</p>



<a name="271030911"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/271030911" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jan kili <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#271030911">(Feb 07 2022 at 19:37)</a>:</h4>
<p>Side question: Are <code>Nat</code>s weird? Would <code>V : { r: U32, s: U64, t: Nat }</code> require different struct definitions for different systems?</p>



<a name="271031006"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/271031006" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#271031006">(Feb 07 2022 at 19:38)</a>:</h4>
<p>yes, I was thinking about that too when writing this out</p>



<a name="271031061"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/271031061" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#271031061">(Feb 07 2022 at 19:38)</a>:</h4>
<p>in particular this is kinda weird if you mix targets, e.g. a rust project with a wasm frontend and normal x86 backend</p>



<a name="271031090"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/271031090" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#271031090">(Feb 07 2022 at 19:39)</a>:</h4>
<p>then you need to order the fields depending on your target</p>



<a name="271031106"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/271031106" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#271031106">(Feb 07 2022 at 19:39)</a>:</h4>
<p>which you can do, but it's not awesome</p>



<a name="271031169"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/271031169" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jan kili <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#271031169">(Feb 07 2022 at 19:39)</a>:</h4>
<p>Maybe <code>Nat</code>s shouldn't pass between platform and app</p>



<a name="271031402"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/271031402" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#271031402">(Feb 07 2022 at 19:41)</a>:</h4>
<p>it's inevitable</p>



<a name="271031428"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/271031428" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#271031428">(Feb 07 2022 at 19:41)</a>:</h4>
<p>e.g. a <code>List *</code> also has a different alignment</p>



<a name="271031440"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/271031440" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#271031440">(Feb 07 2022 at 19:41)</a>:</h4>
<p>because it contains nats and pointers</p>



<a name="271032417"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/271032417" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jan kili <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#271032417">(Feb 07 2022 at 19:49)</a>:</h4>
<p>Is this alignment-based sorting algorithm...<br>
a) an unbending constraint?<br>
b) a performance optimization?<br>
c) a placeholder?<br>
Just curious whether pure-alphabetical sorting is possible/optimal.</p>



<a name="271032457"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/271032457" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#271032457">(Feb 07 2022 at 19:49)</a>:</h4>
<p>it's a performance optimization</p>



<a name="271032480"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/271032480" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#271032480">(Feb 07 2022 at 19:49)</a>:</h4>
<p>when we don't sort by alignment, we can get gaps between fields</p>



<a name="271032548"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/271032548" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#271032548">(Feb 07 2022 at 19:50)</a>:</h4>
<p>e.g. { x : u32, y: i128 }</p>



<a name="271032591"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/271032591" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jan kili <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#271032591">(Feb 07 2022 at 19:50)</a>:</h4>
<p>Maybe this sorting would benefit from a compiler flag? <code>--alphabetical-structs</code></p>



<a name="271032604"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/271032604" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#271032604">(Feb 07 2022 at 19:50)</a>:</h4>
<p>an <code>i128</code> has an alignment of 16, meaning that its start address needs to be a multiple of 16</p>



<a name="271032640"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/271032640" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jan kili <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#271032640">(Feb 07 2022 at 19:50)</a>:</h4>
<p>If a platform developer wants to pass strange values or be flexible somehow</p>



<a name="271032658"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/271032658" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#271032658">(Feb 07 2022 at 19:51)</a>:</h4>
<p>assuming we start at 0, we put in the <code>u32</code> field , taking up 4 bytes. But now we need to add 12 bytes of padding before we can put in the <code>i128</code>field</p>



<a name="271032721"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/271032721" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#271032721">(Feb 07 2022 at 19:51)</a>:</h4>
<p>the opposite order is not beneficial in this example, but in general sorting by alignment minimizes the amount of padding you need</p>



<a name="271032749"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/271032749" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jan kili <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#271032749">(Feb 07 2022 at 19:51)</a>:</h4>
<p>Ah, that makes sense</p>



<a name="271032961"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/271032961" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#271032961">(Feb 07 2022 at 19:53)</a>:</h4>
<p>e.g. C says: definition order is what we use, if that means we need to insert padding to get the alignment right then that is what we do</p>



<a name="271032981"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/271032981" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#271032981">(Feb 07 2022 at 19:53)</a>:</h4>
<p>rust says: don't worry about it, we will lay it out in an optimal way</p>



<a name="271033009"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/271033009" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#271033009">(Feb 07 2022 at 19:53)</a>:</h4>
<p>except if you use <code>#[repr(C)]</code></p>



<a name="271033023"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/271033023" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jan kili <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#271033023">(Feb 07 2022 at 19:53)</a>:</h4>
<p>With an algorithm toggle, platform developers would be responsible for optimizing performance via field name alphabetization, which might be a nice tradeoff</p>



<a name="271033100"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/271033100" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jan kili <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#271033100">(Feb 07 2022 at 19:54)</a>:</h4>
<p>(basically to let developers use that C mode you just described)</p>



<a name="271033102"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/271033102" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#271033102">(Feb 07 2022 at 19:54)</a>:</h4>
<p>well the order of record fields is not well-defined</p>



<a name="271034966"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/271034966" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#271034966">(Feb 07 2022 at 20:07)</a>:</h4>
<p>I think the best long-term solution is to have a compiler command to generate the entire definition, including ordering - but in the short term, maybe we could make a quick compiler flag that prints out the sorted versions of all type aliases in the program?</p>



<a name="271035075"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/271035075" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#271035075">(Feb 07 2022 at 20:08)</a>:</h4>
<p>like it just takes the AST of the type alias, sorts everything, and then runs the formatter on it to get a string</p>



<a name="271035085"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/271035085" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#271035085">(Feb 07 2022 at 20:08)</a>:</h4>
<p>and then prints the string</p>



<a name="271035119"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/271035119" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#271035119">(Feb 07 2022 at 20:08)</a>:</h4>
<p>so at least platform authors don't have to figure all that out in their heads until we have that long-term solution</p>



<a name="271035508"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/271035508" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jan kili <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#271035508">(Feb 07 2022 at 20:11)</a>:</h4>
<p>I'd love that. To be clear, I don't have an immediate need for such complex records, but it's right around the corner (especially since only one def can be passed from app to platform right now, I think)</p>



<a name="271036537"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/271036537" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#271036537">(Feb 07 2022 at 20:20)</a>:</h4>
<p>yeah and tag unions are even harder than records <span aria-label="sweat smile" class="emoji emoji-1f605" role="img" title="sweat smile">:sweat_smile:</span></p>



<a name="271234023"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/271234023" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jan kili <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#271234023">(Feb 09 2022 at 05:51)</a>:</h4>
<p><span class="user-mention" data-user-id="281543">@Folkert de Vries</span> I successfully implemented a Roc-to-Rust record/struct with 3 <code>Str</code>s and 2 <code>U32</code>s in the (WIP) plotting platform, but now I'm having trouble simply adding a second <code>F32</code> to the game platform.<br>
<a href="https://github.com/JanCVanB/roc-bevies/pull/3/commits/768ad5d">https://github.com/JanCVanB/roc-bevies/pull/3/commits/768ad5d</a><br>
Do you know why only the first <code>f32</code> is being heard? Depending on which field comes first in the struct, the debug print looks like<br>
<code>Config { ballSpeed: 400.0, paddleSpeed: 0.0 }</code><br>
or<br>
<code>Config { paddleSpeed: 400.0, ballSpeed: 0.0 }</code>.<br>
<span aria-label="confused" class="emoji emoji-1f615" role="img" title="confused">:confused:</span></p>



<a name="271234087"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/271234087" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jan kili <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#271234087">(Feb 09 2022 at 05:52)</a>:</h4>
<p>I'm probably just not seeing a typo or something, but at this point I can't see it.</p>



<a name="271234359"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/271234359" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jan kili <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#271234359">(Feb 09 2022 at 05:57)</a>:</h4>
<p>The behavior is the same if I change them both to <code>i16</code>s or <code>u16</code>s.</p>



<a name="271235251"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/271235251" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jan kili <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#271235251">(Feb 09 2022 at 06:13)</a>:</h4>
<p>Whoa, when I add another <code>F32</code> between them, it hears the 1st as the 1st and the 2nd as the 3rd!<br>
Roc source: <code>config = { ballSpeed: 111, manualPadding: 222, paddleSpeed: 333 }</code><br>
Rust debug: <code>Config { ballSpeed: 111.0, manualPadding: 0.0, paddleSpeed: 222.0 }</code><br>
This must be related to alignment, but I don't know how. Maybe... Roc is writing the record with 8-byte alignment (because it's represented with an 8-byte pointer) but then Rust isn't recognizing the padding between the 4-byte <code>F32</code>s?<br>
<a href="https://github.com/JanCVanB/roc-bevies/pull/3/commits/8eed55c">https://github.com/JanCVanB/roc-bevies/pull/3/commits/8eed55c</a></p>



<a name="271266784"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/271266784" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#271266784">(Feb 09 2022 at 12:05)</a>:</h4>
<p>I'm seeing no problems when using </p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">fn</span> <span class="nf">roc_config</span><span class="p">()</span><span class="w"> </span>-&gt; <span class="nc">Config</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">extern</span><span class="w"> </span><span class="s">"C"</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="cp">#[link_name = </span><span class="s">"roc__configForHost_1_exposed_generic"</span><span class="cp">]</span><span class="w"></span>
<span class="w">        </span><span class="k">fn</span> <span class="nf">roc_config_internal</span><span class="p">(</span><span class="n">_</span>: <span class="kp">&amp;</span><span class="nc">mut</span><span class="w"> </span><span class="n">Config</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">config</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Config</span>::<span class="n">default</span><span class="p">();</span><span class="w"></span>
<span class="w">    </span><span class="k">unsafe</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">roc_config_internal</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="n">config</span><span class="p">)</span><span class="w"> </span><span class="p">};</span><span class="w"></span>

<span class="w">    </span><span class="n">config</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="cp">#[repr(C)]</span><span class="w"></span>
<span class="cp">#[derive(Default, Debug)]</span><span class="w"></span>
<span class="k">struct</span> <span class="nc">Config</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">pub</span><span class="w"> </span><span class="n">ballSpeed</span>: <span class="kt">f32</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="k">pub</span><span class="w"> </span><span class="n">paddleSpeed</span>: <span class="kt">f32</span><span class="p">,</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>



<a name="271266846"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/271266846" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#271266846">(Feb 09 2022 at 12:06)</a>:</h4>
<p>I'm using the <code>_generic</code> version of configForHost here, which takes a pointer that it writes the value into</p>



<a name="271266925"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/271266925" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#271266925">(Feb 09 2022 at 12:07)</a>:</h4>
<p>that is the safer way of doing this, because simply returning values (like <code>-&gt; Config</code>) seems to break in some cases across the C FFI boundary</p>



<a name="271268838"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/271268838" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jan kili <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#271268838">(Feb 09 2022 at 12:26)</a>:</h4>
<p>Well that's nice that the extern and unsafe can both be absorbed into the <code>roc_config</code> function - that's how I'll do every Roc call from now on.</p>



<a name="271268915"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/271268915" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jan kili <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#271268915">(Feb 09 2022 at 12:27)</a>:</h4>
<p>This Rustling never would have found that <code>_generic</code> solution, thank you very much</p>



<a name="271268945"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/271268945" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#271268945">(Feb 09 2022 at 12:27)</a>:</h4>
<p>yeah I wonder if we should actually remove the non-generic version</p>



<a name="271269001"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/271269001" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#271269001">(Feb 09 2022 at 12:28)</a>:</h4>
<p>since it causes a bunch of problems</p>



<a name="271269012"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/271269012" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#271269012">(Feb 09 2022 at 12:28)</a>:</h4>
<p>on the other hand, it's not entirely clear why it causes problems</p>



<a name="271433435"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/271433435" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jan kili <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#271433435">(Feb 10 2022 at 13:52)</a>:</h4>
<p>Okay, here's a new request... is passing a function as a record field possible?</p>
<p>Since only one def can be passed from an app to a platform, I see only two ways of passing both static primitive data and dynamic function logic:</p>
<ol>
<li>pass a record containing both primitive fields and function fields</li>
<li>pass a function that either returns primitive data or performs dynamic logic, depending on the input</li>
</ol>
<p>I've tried the following, but the Rust compiler is complaining about methods &amp; traits, so I'm out of my Rust depth <span aria-label="sweat smile" class="emoji emoji-1f605" role="img" title="sweat smile">:sweat_smile:</span> </p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">use</span><span class="w"> </span><span class="n">std</span>::<span class="n">boxed</span>::<span class="nb">Box</span><span class="p">;</span><span class="w"></span>
<span class="k">use</span><span class="w"> </span><span class="n">std</span>::<span class="n">ops</span>::<span class="nb">Fn</span><span class="p">;</span><span class="w"></span>

<span class="cp">#[derive(Default)]</span><span class="w"></span>
<span class="cp">#[repr(C)]</span><span class="w"></span>
<span class="k">pub</span><span class="w"> </span><span class="k">struct</span> <span class="nc">Config</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">pub</span><span class="w"> </span><span class="n">ballSpeed</span>: <span class="kt">f32</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="k">pub</span><span class="w"> </span><span class="n">paddleSpeed</span>: <span class="kt">f32</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="k">pub</span><span class="w"> </span><span class="n">todo</span>: <span class="nb">Box</span><span class="o">&lt;</span><span class="k">dyn</span><span class="w"> </span><span class="nb">Fn</span><span class="p">(</span><span class="kt">i16</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="kt">i16</span><span class="o">&gt;</span><span class="p">,</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>



<a name="271433570"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/271433570" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#271433570">(Feb 10 2022 at 13:53)</a>:</h4>
<p>the <code>tui</code> example exposes a record with functions and values</p>



<a name="271433711"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/271433711" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#271433711">(Feb 10 2022 at 13:54)</a>:</h4>
<p>the trick here is that the field in the record only contains the captured environment of the function (usually that is a unit value, because the exposed function is top-level)</p>



<a name="271433732"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/271433732" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#271433732">(Feb 10 2022 at 13:54)</a>:</h4>
<p>we then expose an additional extern function to actually call the function</p>



<a name="271433956"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/271433956" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jan kili <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#271433956">(Feb 10 2022 at 13:56)</a>:</h4>
<p><code>tui</code> is in Zig - does the same system apply to Rust?</p>



<a name="271434036"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/271434036" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#271434036">(Feb 10 2022 at 13:56)</a>:</h4>
<p>yes both languages use the C api that we expose</p>



<a name="271435655"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/271435655" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jan kili <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#271435655">(Feb 10 2022 at 14:08)</a>:</h4>
<p>Phew, complex platform APIs hurt my brain <span aria-label="sweat smile" class="emoji emoji-1f605" role="img" title="sweat smile">:sweat_smile:</span> <br>
<code>extern fn roc__mainForHost_1_Update_caller(ConstModel, *const RocStr, [*]u8, MutModel) void;</code></p>



<a name="271436035"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/271436035" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#271436035">(Feb 10 2022 at 14:11)</a>:</h4>
<p>that's the downside. Hopefully you get that right once and can then build a nicer api on the rust/zig side</p>



<a name="271436312"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/271436312" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#271436312">(Feb 10 2022 at 14:13)</a>:</h4>
<p>also platform author ergonomics might be most underdeveloped part of Roc tooling right now <span aria-label="big smile" class="emoji emoji-1f604" role="img" title="big smile">:big_smile:</span></p>



<a name="271436322"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/271436322" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#271436322">(Feb 10 2022 at 14:13)</a>:</h4>
<p>we have no way to help generate these things yet</p>



<a name="271436349"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/271436349" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#271436349">(Feb 10 2022 at 14:13)</a>:</h4>
<p>but we can in the future!</p>



<a name="271437793"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/271437793" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jan kili <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#271437793">(Feb 10 2022 at 14:24)</a>:</h4>
<p>Unrelated, I find this file hilarious:</p>
<div class="codehilite" data-code-language="Haskell"><pre><span></span><code><span class="nf">platform</span><span class="w"> </span><span class="s">"roc-plotters/bitmap-chart"</span><span class="w"></span>
<span class="w">    </span><span class="n">requires</span><span class="w"> </span><span class="p">{}</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">config</span><span class="w"> </span><span class="kt">:</span><span class="w"> </span><span class="kt">Config</span><span class="w"> </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="n">exposes</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="kt">Config</span><span class="w"> </span><span class="p">]</span><span class="w"></span>
<span class="w">    </span><span class="n">packages</span><span class="w"> </span><span class="p">{}</span><span class="w"></span>
<span class="w">    </span><span class="n">imports</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="kt">Config</span><span class="o">.</span><span class="p">{</span><span class="w"> </span><span class="kt">Config</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">]</span><span class="w"></span>
<span class="w">    </span><span class="n">provides</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="n">configForHost</span><span class="w"> </span><span class="p">]</span><span class="w"></span>

<span class="nf">configForHost</span><span class="w"> </span><span class="kt">:</span><span class="w"> </span><span class="kt">Config</span><span class="w"></span>
<span class="nf">configForHost</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="n">config</span><span class="w"></span>
</code></pre></div>



<a name="271437822"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/271437822" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jan kili <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#271437822">(Feb 10 2022 at 14:24)</a>:</h4>
<p>The cherry on top is that the file name is <code>Package-Config.roc</code> <span aria-label="laughter tears" class="emoji emoji-1f602" role="img" title="laughter tears">:laughter_tears:</span></p>



<a name="271438086"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/271438086" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jan kili <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#271438086">(Feb 10 2022 at 14:26)</a>:</h4>
<p>config x 10 == 10x engineering</p>



<a name="271438170"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/271438170" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#271438170">(Feb 10 2022 at 14:27)</a>:</h4>
<p>this reminds me of the greatest talk of all time <a href="https://www.youtube.com/watch?v=yL_-1d9OSdk">https://www.youtube.com/watch?v=yL_-1d9OSdk</a></p>
<div class="youtube-video message_inline_image"><a data-id="yL_-1d9OSdk" href="https://www.youtube.com/watch?v=yL_-1d9OSdk"><img src="https://uploads.zulipusercontent.net/a7fdd754f6461078d6915a407229cb277f964d95/68747470733a2f2f692e7974696d672e636f6d2f76692f794c5f2d3164394f53646b2f64656661756c742e6a7067"></a></div>



<a name="271438220"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/271438220" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#271438220">(Feb 10 2022 at 14:27)</a>:</h4>
<p>config config, config config config. Config</p>



<a name="271455499"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/271455499" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jan kili <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#271455499">(Feb 10 2022 at 16:23)</a>:</h4>
<p><span class="user-mention silent" data-user-id="281383">Richard Feldman</span> <a href="#narrow/stream/231634-beginners/topic/Platform.20question/near/271036537">said</a>:</p>
<blockquote>
<p>yeah and tag unions are even harder than records <span aria-label="sweat smile" class="emoji emoji-1f605" role="img" title="sweat smile">:sweat_smile:</span></p>
</blockquote>
<p>Is this a solved problem? I just ran into a use case for a tag union <span aria-label="stuck out tongue" class="emoji emoji-1f61b" role="img" title="stuck out tongue">:stuck_out_tongue:</span></p>



<a name="271455697"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/271455697" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#271455697">(Feb 10 2022 at 16:25)</a>:</h4>
<p>what kind of tag union?</p>



<a name="271455721"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/271455721" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#271455721">(Feb 10 2022 at 16:25)</a>:</h4>
<p>we have support for <code>RocResult</code>, and an enum is actually easy</p>



<a name="271456834"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/271456834" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jan kili <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#271456834">(Feb 10 2022 at 16:33)</a>:</h4>
<p>I suppose it's an enum: <code>format : [ Bitmap, Svg ]</code></p>



<a name="271456949"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/271456949" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jan kili <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#271456949">(Feb 10 2022 at 16:34)</a>:</h4>
<p>Is there an enum example in <code>examples/</code>?</p>



<a name="271459100"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/271459100" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#271459100">(Feb 10 2022 at 16:48)</a>:</h4>
<p>no but you can treat this as if you're sending a <code>u8</code> over</p>



<a name="271459225"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/271459225" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#271459225">(Feb 10 2022 at 16:49)</a>:</h4>
<p>this might also work</p>
<div class="codehilite"><pre><span></span><code>#[repr(u8)]
enum {
    Bitmap = 0,
    Svg = 1,
}
</code></pre></div>



<a name="271459253"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/271459253" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#271459253">(Feb 10 2022 at 16:49)</a>:</h4>
<p>not sure if that plays nicely with extern functions</p>



<a name="271487821"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/271487821" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jan kili <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#271487821">(Feb 10 2022 at 20:12)</a>:</h4>
<p>How about lists like <code>List I64</code> or <code>List List { label: Str, values: List I64 }</code>?</p>
<p>I see a <code>List I64</code> passing between Zig &amp; Roc in <code>examples/quicksort/</code>, but I'm hoping to pass complex lists from Roc to Rust (without knowing their length at compile-time, which requires <code>Vec</code>s?). Will that require any tricks that (a) aren't demonstrated in <code>examples/quicksort/</code> or (b) look different in Rust than in Zig?</p>



<a name="271488110"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/271488110" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jan kili <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#271488110">(Feb 10 2022 at 20:15)</a>:</h4>
<p>Thanks for all of this help on these API patterns :) I hope to produce some useful examples of these patterns, so that future devs can simply copy/paste the goods!</p>



<a name="271488306"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/271488306" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jan kili <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#271488306">(Feb 10 2022 at 20:17)</a>:</h4>
<p>(Side note, I just fought with Rust generics for 2 hours and won!!! I feel like I just received my second Rustling badge, haha)</p>



<a name="271488510"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/271488510" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jan kili <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#271488510">(Feb 10 2022 at 20:18)</a>:</h4>
<p>(perhaps I should have read a Rust guide/tutorial/book, but instead I'm just guessing the syntax until the compiler finally gives in! <span aria-label="sweat smile" class="emoji emoji-1f605" role="img" title="sweat smile">:sweat_smile:</span>)</p>



<a name="271490458"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/271490458" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#271490458">(Feb 10 2022 at 20:35)</a>:</h4>
<p>you can use <code>RocList</code> from <code>roc_std</code></p>



<a name="271490497"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/271490497" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#271490497">(Feb 10 2022 at 20:35)</a>:</h4>
<p>although you have to carefully think about who owns the memory</p>



<a name="271512028"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/271512028" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jan kili <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#271512028">(Feb 10 2022 at 23:52)</a>:</h4>
<p><span class="user-mention" data-user-id="478159">@Philippe Hosey-Vinchon</span> Do you want to help me make some fun Roc platforms? :) I'm pretty comfortable in Roc after a couple of months with it, but Rust is brand new for me! After fighting with Rust generics today, I can see that platform-ifying existing Rust libraries can have surprise traps, some of which are best defused by a more-experience Rustacean than myself <span aria-label="crab" class="emoji emoji-1f980" role="img" title="crab">:crab:</span></p>



<a name="271512597"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/271512597" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jan kili <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#271512597">(Feb 10 2022 at 23:59)</a>:</h4>
<p><span aria-label="loudspeaker" class="emoji emoji-1f4e2" role="img" title="loudspeaker">:loudspeaker:</span> In fact, anyone is welcome to collaborate! Help me Roc-ify some useful+popular Rust libraries: <span aria-label="smiley" class="emoji emoji-1f603" role="img" title="smiley">:smiley:</span> <br>
Plots/charts/graphics: <a href="https://github.com/JanCVanB/roc-plotters">https://github.com/JanCVanB/roc-plotters</a><br>
Games/simulations/UIs: <a href="https://github.com/JanCVanB/roc-bevies">https://github.com/JanCVanB/roc-bevies</a></p>



<a name="271513247"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/271513247" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Andrew Thompson <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#271513247">(Feb 11 2022 at 00:05)</a>:</h4>
<p>Hi, new here. I read through a bunch of platform posts here, but after looking at the examples, I don't think I understand platforms at all. Should I, some time in the future, decide to write a simple cli tool in Roc, would there be a standard platform for this purpose? Would it only support nix or windows at one time? I'm confused why there are rust examples and zig examples, and why anyone writing an app would care what language the platform is written in?</p>



<a name="271513567"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/271513567" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jan kili <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#271513567">(Feb 11 2022 at 00:09)</a>:</h4>
<p>Hi, Andrew! I'd recommend using <a href="https://github.com/rtfeldman/roc/tree/trunk/examples/cli"><code>examples/cli/</code></a>, as it's the only platform thusfar that supports general-purpose CLI apps.</p>



<a name="271513794"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/271513794" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jan kili <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#271513794">(Feb 11 2022 at 00:12)</a>:</h4>
<p>In addition to the example CLI apps in that dir (<code>form.roc</code>, <code>countdown.roc</code>, <code>echo.roc</code>), I have some more (mostly-redundant) examples in <a href="https://github.com/JanCVanB/advent-of-code-2021/blob/main/solutions/day-1-sonar-sweep/solution_1_part_1.roc">this abandoned repo</a>.</p>



<a name="271513946"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/271513946" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jan kili <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#271513946">(Feb 11 2022 at 00:14)</a>:</h4>
<p>Regarding Nix/Windows, what operating system are you on? I'm using macOS, and Nix is super convenient for hopping into a Roc-friendly environment.</p>



<a name="271514673"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/271514673" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Andrew Thompson <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#271514673">(Feb 11 2022 at 00:23)</a>:</h4>
<p>Sorry, I meant *nix, as any random linux. I run Windows, but built Roc in WSL Ubuntu last night, and will be playing with it there.<br>
The platforms that are in the examples seem(and this is fine for this purpose) custom built out with just enough functionality to support the example they work for. This is part of my confusion. Would you expect there to be a batteries included platform that would meet most needs of a particular type of app?</p>



<a name="271514759"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/271514759" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jan kili <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#271514759">(Feb 11 2022 at 00:24)</a>:</h4>
<p>I recommend this thread: <a href="#narrow/stream/304641-ideas/topic/A.20platform.20for.20production.20CLIs">https://roc.zulipchat.com/#narrow/stream/304641-ideas/topic/A.20platform.20for.20production.20CLIs</a><br>
(TL;DR: Not yet, but it's an inevitability that can be accelerated by demand &amp; contributions)</p>



<a name="271515433"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/271515433" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jan kili <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#271515433">(Feb 11 2022 at 00:33)</a>:</h4>
<p>Regarding Rust/Zig, Roc app developers shouldn't care what language their platform is written in.</p>
<p>I think about Roc platforms like this:</p>
<ul>
<li>Roc is basically a scripting language for C-interoperable languages like Rust/Zig, and a Roc platform is basically a Rust/Zig app with some Roc-specific metadata/decoration.</li>
<li>When the Roc CLI builds a Roc app, it does two things: it compiles the Roc app into a set of C functions that the Roc platform can call via CFFI (calling C functions from a C-interoperable language), and then it uses the Roc platform's language's compiler to compile those C functions together with the Roc platform into machine code.</li>
<li>A Roc platform must define all data types that it sends/receives to/from Roc apps, and a Roc app must provide its Roc platform with the def (in the future hopefully multiple defs) that the platform requires.</li>
<li>Meanwhile, a Roc platform can use any of its language's features (Rust crates, Zig libraries, etc.), and a Roc app can use any Roc features (Roc libraries, etc.).</li>
<li>Therefore, the only reasons for a Roc platform developer to choose Rust vs. Zig (vs. something else?) is the libraries they want to leverage and their personal preferences.</li>
<li>As (I think) the example platforms in <code>examples/</code> don't use any unique libraries, I expect that the languages chosen in there were mostly chosen arbitrarily, to demonstrate Roc's flexibility.</li>
</ul>
<p>I hope that makes platforms make more sense, but now that I've written it all out I realize this could just confuse the issue <span aria-label="sweat smile" class="emoji emoji-1f605" role="img" title="sweat smile">:sweat_smile:</span></p>



<a name="271517691"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/271517691" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Andrew Thompson <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#271517691">(Feb 11 2022 at 01:03)</a>:</h4>
<p><span class="user-mention silent" data-user-id="462053">JanCVanB</span> <a href="#narrow/stream/231634-beginners/topic/Platform.20question/near/271515433">said</a>:</p>
<blockquote>
<ul>
<li>Meanwhile, a Roc platform can use any of its language's features (Rust crates, Zig libraries, etc.), and a Roc app can use any Roc features (Roc libraries, etc.).</li>
<li>Therefore, the only reasons for a Roc platform developer to choose Rust vs. Zig (vs. something else?) is the libraries they want to leverage and their personal preferences.</li>
</ul>
</blockquote>
<p>These still feels like you would be in a place where a Roc app developer could need to also write their underlying platform(or copy/paste from a previous similar app and add new lib Y). Am I misunderstanding?</p>



<a name="271517921"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/271517921" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#271517921">(Feb 11 2022 at 01:06)</a>:</h4>
<p>in the future platforms will be available in the package registry (which doesn't exist yet!) so you can just say what platform you want and the compiler download and install it behind the scenes, just like any other package</p>



<a name="271517947"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/271517947" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#271517947">(Feb 11 2022 at 01:07)</a>:</h4>
<p>but since we don't have a package registry yet, for now it's all copying and pasting onto the local filesystem <span aria-label="big smile" class="emoji emoji-1f604" role="img" title="big smile">:big_smile:</span></p>



<a name="271517990"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/271517990" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jan kili <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#271517990">(Feb 11 2022 at 01:08)</a>:</h4>
<blockquote>
<p>add new lib Y). Am I misunderstanding?</p>
</blockquote>
<p>No, you're correct. If an app wants to do something that its platform doesn't support, then it will need to fork+modify the platform or find another platform. That's by design, so that app consumers/end-users can be absolutely certain what any app might do when they run it. For example, if an app's platform doesn't have networking or file-writing functionalities, you know it's (relatively) safe to run.</p>



<a name="271518028"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/271518028" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#271518028">(Feb 11 2022 at 01:08)</a>:</h4>
<p>but the idea is for obtaining a platform to feel equivalent to obtaining a framework in another language: you just list it as a package dependency and it gets installed for you</p>



<a name="271518175"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/271518175" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#271518175">(Feb 11 2022 at 01:10)</a>:</h4>
<p>of note, it's theoretically possible for a platform author to provide a C FFI (via normal function calls, just asking for the name of a dynamic library along with binary encoders and decoders for its arguments and return value) but of course any platform that does that can no longer offer any security guarantees, so it's a strictly opt-in thing <span aria-label="big smile" class="emoji emoji-1f604" role="img" title="big smile">:big_smile:</span></p>



<a name="271518217"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/271518217" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#271518217">(Feb 11 2022 at 01:11)</a>:</h4>
<p>(that's not a special language feature or anything, it's just an observation that any platform author can in fact do that if they want to and it will work)</p>



<a name="271518355"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/271518355" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Andrew Thompson <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#271518355">(Feb 11 2022 at 01:12)</a>:</h4>
<p>I know this isn't strictly a platform question, but I think it's related to <span class="user-mention" data-user-id="281383">@Richard Feldman</span> 's comment: If I wanted to use that handy dandy Random lib, would I always expect to get just the source(and drop it right in my app folder?), or is a Roc compiled binary of some kind possible/intended?</p>



<a name="271518485"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/271518485" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jan kili <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#271518485">(Feb 11 2022 at 01:14)</a>:</h4>
<p>For now, copy/paste it or use a Git submodule. In the indeterminate future, something like npm or pypi for Roc will exist.</p>



<a name="271518649"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/271518649" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jan kili <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#271518649">(Feb 11 2022 at 01:16)</a>:</h4>
<p>However, I don't believe Roc libraries will ever be pre-compiled, as compilation only happens in conjunction with a specific platform. Roc libraries must perform a delicate dance of platform-agnosticity, so that any Roc app (on any Roc platform) can use them.</p>



<a name="271527881"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/271527881" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#271527881">(Feb 11 2022 at 03:44)</a>:</h4>
<p><span class="user-mention" data-user-id="462053">@JanCVanB</span> if you are interested, I would be up for helping you with some of the platform stuff and rust type fun. I should theoretically have an ok understanding of the underlying types and rust.</p>



<a name="272109665"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/272109665" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tom Dohrmann <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#272109665">(Feb 16 2022 at 12:35)</a>:</h4>
<p>Are there any stability guarantees regarding <code>roc_std</code>?</p>



<a name="272109834"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/272109834" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#272109834">(Feb 16 2022 at 12:37)</a>:</h4>
<p>not really, if we think a change is necessary we make it and then update all code in the compiler repo</p>



<a name="272110209"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/272110209" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#272110209">(Feb 16 2022 at 12:41)</a>:</h4>
<p>so far <code>RocList</code> is not used that much, <code>RocStr</code> a bit more but even there it's just more convenient to quickly turn that into a <code>String</code>/<code>&amp;str</code> or whatever the host language wants</p>



<a name="272111263"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/272111263" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#272111263">(Feb 16 2022 at 12:51)</a>:</h4>
<p>there will be eventually, but a major part of the reason the repo is private now is to set expectations around the fact that Roc isn't ready for production use yet, so we may make breaking changes on short notice! <span aria-label="big smile" class="emoji emoji-1f604" role="img" title="big smile">:big_smile:</span></p>



<a name="272156399"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/272156399" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tom Dohrmann <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#272156399">(Feb 16 2022 at 18:16)</a>:</h4>
<p>When passing a List from a platform to a Roc application, does the List always have to be reference counted? <code>compiler/str/README.md</code> mentions that the platform can't assume anything about Lists provided by Roc application, but AFAICT doesn't say anything about Lists passed the other way around.<br>
I'm asking because valgrind is reporting that I'm leaking memory which I tracked down to being caused by returning a unique List with a capacity to a Roc application.</p>



<a name="272156780"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/272156780" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#272156780">(Feb 16 2022 at 18:19)</a>:</h4>
<p>All list are reference counted in general. If Roc returns a list and it has only 1 reference count left (which is the normal case), it is the host's job to free the memory.</p>



<a name="272156868"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/272156868" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#272156868">(Feb 16 2022 at 18:19)</a>:</h4>
<p>If it had a higher than 1 reference count, it would be expected that the host lowers the reference count by one when dropping the list.</p>



<a name="272156943"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/272156943" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#272156943">(Feb 16 2022 at 18:20)</a>:</h4>
<p>that misses capacity. But the capacity as it's currently used in <code>roc_std</code> is an older idea that we'll likely not use any more</p>



<a name="272157037"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/272157037" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#272157037">(Feb 16 2022 at 18:20)</a>:</h4>
<p>currently, RC grows from <code>isize::MIN</code> upwards. At 0, the RC reaches "infinity" and an object with that refcount will live forever</p>



<a name="272157126"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/272157126" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#272157126">(Feb 16 2022 at 18:21)</a>:</h4>
<p>a positive value in that location used to indicate a capacity. But we now want to store the capacity on the stack</p>



<a name="272157151"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/272157151" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#272157151">(Feb 16 2022 at 18:21)</a>:</h4>
<p>so in effect that means that a positive value in the refcount position is invalid</p>



<a name="272158114"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/272158114" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tom Dohrmann <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#272158114">(Feb 16 2022 at 18:29)</a>:</h4>
<p><span class="user-mention silent" data-user-id="281543">Folkert de Vries</span> <a href="#narrow/stream/231634-beginners/topic/Platform.20question/near/272156943">said</a>:</p>
<blockquote>
<p>that misses capacity. But the capacity as it's currently used in <code>roc_std</code> is an older idea that we'll likely not use any more</p>
</blockquote>
<p>Oh ok, good to know.</p>



<a name="272167386"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/272167386" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#272167386">(Feb 16 2022 at 19:37)</a>:</h4>
<p>but we plan to transition that to basically exactly what <code>Vec</code> does in rust</p>



<a name="272167407"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/272167407" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#272167407">(Feb 16 2022 at 19:37)</a>:</h4>
<p>with capacity stored in the struct, not behind the pointer</p>



<a name="272381031"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/272381031" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jorge Acereda <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#272381031">(Feb 18 2022 at 09:54)</a>:</h4>
<p>Hi all, I'm trying to build Roc (update_zig_09 branch) on Guix but I'm facing unresolved LLVM symbols when linking roc_cli. LLVM_SYS_130_PREFIX is set, and llvm-config is in PATH. I have zero knowledge of Rust, any hint?</p>



<a name="272381205"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/272381205" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#272381205">(Feb 18 2022 at 09:56)</a>:</h4>
<p>that branch doesn't quite work for most things related to lists/strings.</p>



<a name="272381217"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/272381217" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#272381217">(Feb 18 2022 at 09:56)</a>:</h4>
<p>if you still want to try it: what errors are you getting exactly?</p>



<a name="272381574"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/272381574" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jorge Acereda <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#272381574">(Feb 18 2022 at 10:00)</a>:</h4>
<p><a href="/user_uploads/22008/uH8BI03M0DCyOd4-UtsKApea/err.txt">err.txt</a></p>



<a name="272381640"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/272381640" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jorge Acereda <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#272381640">(Feb 18 2022 at 10:00)</a>:</h4>
<p>Looks like every LLVM symbol is undefined.</p>



<a name="272381718"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/272381718" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jorge Acereda <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#272381718">(Feb 18 2022 at 10:01)</a>:</h4>
<p>I went with the 09 branch because that's the zig version that happens to be packaged on Guix, but I guess I can downgrade.</p>



<a name="272382586"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/272382586" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#272382586">(Feb 18 2022 at 10:09)</a>:</h4>
<p>you can set the zig version with <code>ROC_ZIG=path/to/zig</code></p>



<a name="272382594"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/272382594" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#272382594">(Feb 18 2022 at 10:09)</a>:</h4>
<p>if you don't want to touch the system version</p>



<a name="272383100"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/272383100" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jorge Acereda <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#272383100">(Feb 18 2022 at 10:14)</a>:</h4>
<p>So, should I give up the 09 branch and try with master? Will that get rid of the llvm unresolveds?</p>



<a name="272383389"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/272383389" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#272383389">(Feb 18 2022 at 10:17)</a>:</h4>
<p>I think trying <code>trunk</code> is the best approach for now. Even if you get this branch to compile, it won't really give you much</p>



<a name="272383405"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/272383405" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#272383405">(Feb 18 2022 at 10:17)</a>:</h4>
<p>because most examples will just fail to compile</p>



<a name="272383418"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/272383418" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#272383418">(Feb 18 2022 at 10:17)</a>:</h4>
<p>note that trunk uses llvm12</p>



<a name="272383526"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/272383526" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jorge Acereda <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#272383526">(Feb 18 2022 at 10:18)</a>:</h4>
<p>Ok, I'll try that over the weekend, thanks.</p>



<a name="272383588"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/272383588" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#272383588">(Feb 18 2022 at 10:19)</a>:</h4>
<p>btw it does look like llvm cannot be found by the linker. it looks like gcc is used?!</p>



<a name="272383605"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/272383605" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#272383605">(Feb 18 2022 at 10:19)</a>:</h4>
<p>so, using trunk may not solve that problem</p>



<a name="272386769"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/272386769" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jorge Acereda <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#272386769">(Feb 18 2022 at 10:51)</a>:</h4>
<p>Ups, good catch. Looks like I depend on clang instead of clang-toolchain in the package definition, that might well be the problem.</p>



<a name="272423448"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/272423448" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Andrew Thompson <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#272423448">(Feb 18 2022 at 16:32)</a>:</h4>
<p>I compiled Roc in Ubuntu on Windows(WSL). Compiles seem to take a really long time. Is this expected? <a href="/user_uploads/22008/c_JDajmP9Bb-eWvJ1nAZu7-Z/image.png">image.png</a></p>
<div class="message_inline_image"><a href="/user_uploads/22008/c_JDajmP9Bb-eWvJ1nAZu7-Z/image.png" title="image.png"><img src="/user_uploads/22008/c_JDajmP9Bb-eWvJ1nAZu7-Z/image.png"></a></div>



<a name="272423791"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/272423791" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#272423791">(Feb 18 2022 at 16:35)</a>:</h4>
<p>WSL is very slow if the code is stored on the windows side, but compiled from the linux side</p>



<a name="272423850"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/272423850" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#272423850">(Feb 18 2022 at 16:36)</a>:</h4>
<p><span class="user-mention" data-user-id="431893">@Brian Carroll</span> knows more about how to fix this</p>



<a name="272424353"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/272424353" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Andrew Thompson <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#272424353">(Feb 18 2022 at 16:40)</a>:</h4>
<p>I saw something related to that, and copied all the code into the linux side, but it didn't make any appreciable difference. I'll try compiling it in native windows this weekend. (I only compiled it from linux because I thought it'd be a smoother process. Hint: it was bumpy)</p>



<a name="272424499"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/272424499" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#272424499">(Feb 18 2022 at 16:41)</a>:</h4>
<p>we don't currently support windows outputs, so that means that if you compile a program with the compiler, you need to then run it in WSL</p>



<a name="272424568"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/272424568" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#272424568">(Feb 18 2022 at 16:41)</a>:</h4>
<p>also, nobody has actually tried compiling on windows I think. I guess it should work?</p>



<a name="272426940"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/272426940" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#272426940">(Feb 18 2022 at 16:58)</a>:</h4>
<p>I remember trying and running into a lot of issues, but that was quite a while ago on a mini pc without a lot of storage. I don't remember why (maybe for llvm-as, maybe for something else), but I needed to compile llvm from source and it ate loads and loads of disk space.</p>



<a name="272436711"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/272436711" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jose Quesada <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#272436711">(Feb 18 2022 at 18:11)</a>:</h4>
<p>I have a quick question, when specifying the path to a platform, does the path have to be absolute?<br>
I'm asking because relative paths don't seem to work, but not sure.</p>
<div class="codehilite"><pre><span></span><code>app &quot;Hello&quot;
    packages { pf: &quot;../bin/examples/cli/platform&quot; }
    imports [ pf.Stdout ]
    provides [ main ] to pf
</code></pre></div>



<a name="272437007"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/272437007" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jose Quesada <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#272437007">(Feb 18 2022 at 18:13)</a>:</h4>
<p>nevermind, I was being silly lol</p>



<a name="272437876"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/272437876" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Carroll <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#272437876">(Feb 18 2022 at 18:20)</a>:</h4>
<p><span class="user-mention silent" data-user-id="281543">Folkert de Vries</span> <a href="#narrow/stream/231634-beginners/topic/Platform.20question/near/272423850">said</a>:</p>
<blockquote>
<p><span class="user-mention silent" data-user-id="431893">Brian Carroll</span> knows more about how to fix this</p>
</blockquote>
<p>Just to add a bit more detail, the exact issue I had was that my clone of the repo, and therefore the Cargo <code>target</code> folder, was on the Windows side in the NTFS filesystem. But I was running <code>cargo test</code> and <code>cargo build</code> in the Linux terminal, so Cargo was also using the <code>~/.cargo</code> folder from the Linux ext4 filesystem. So it must have been talking to both filesystems, maybe copying stuff between them, probably going through some sort of translation layer...</p>
<p>The fix that worked for me was to move everything to the Linux filesystem. There were no other steps to it, just that.</p>
<p>But the commands that Andrew ran in his screenshot don't look like they would have the same issue since all the files are on the Linux side, and he's running Roc rather than Cargo.</p>



<a name="272438449"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/272438449" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Carroll <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#272438449">(Feb 18 2022 at 18:25)</a>:</h4>
<p>But I'm not sure what else to suggest since the only WSL-specific issue we know about is this one</p>



<a name="272438555"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/272438555" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Carroll <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#272438555">(Feb 18 2022 at 18:26)</a>:</h4>
<p>I'll try running the same command on my machine and see what happens.</p>



<a name="272439299"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/272439299" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Carroll <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#272439299">(Feb 18 2022 at 18:31)</a>:</h4>
<div class="codehilite"><pre><span></span><code>brian@acer:~/code/roc$ time target/debug/roc build examples/cli/form.roc
🔨 Rebuilding host... Done!
🎉 Built examples/cli/form in 2268 ms

real    0m2.314s
user    0m1.997s
sys     0m0.380s
brian@acer:~/code/roc$ time target/debug/roc build examples/cli/form.roc
🔨 Rebuilding host... Done!
🎉 Built examples/cli/form in 317 ms

real    0m0.327s
user    0m0.400s
sys     0m0.064s
brian@acer:~/code/roc$ time target/debug/roc build --precompiled-host examples/cli/form.roc
🎉 Built examples/cli/form in 201 ms

real    0m0.210s
user    0m0.299s
sys     0m0.031s
</code></pre></div>



<a name="272439480"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/272439480" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Carroll <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#272439480">(Feb 18 2022 at 18:32)</a>:</h4>
<p>From the Windows "System &gt; About" menu:</p>
<div class="codehilite"><pre><span></span><code>Device name acer
Processor   11th Gen Intel(R) Core(TM) i7-1165G7 @ 2.80GHz   2.80 GHz
Installed RAM   8.00 GB (7.80 GB usable)
Device ID   8E0330F2-1463-4F8C-8E66-5A35508DA65E
Product ID  00325-96756-33883-AAOEM
System type 64-bit operating system, x64-based processor
Pen and touch   Touch support with 10 touch points
</code></pre></div>



<a name="272448932"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/272448932" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Aaron <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#272448932">(Feb 18 2022 at 19:54)</a>:</h4>
<p>Why does hello.roc link against all these libraries on MacOS ?<br>
<code>AudioUnit.framework, Cocoa.framework, CoreAudio.framework, CoreVideo.framework, IOKit.framework, Metal.framework, QuartzCore.framework, Security.framework</code></p>



<a name="272449052"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/272449052" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#272449052">(Feb 18 2022 at 19:55)</a>:</h4>
<p>I think those libraries are needed for some programs, so for now they are included in all programs</p>



<a name="272449096"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/272449096" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Aaron <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#272449096">(Feb 18 2022 at 19:55)</a>:</h4>
<p>Is that something the platform does?</p>



<a name="272450550"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/272450550" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jan kili <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#272450550">(Feb 18 2022 at 20:02)</a>:</h4>
<p>Yeah, today Roc platforms can't specify which OS libraries they need, but there's a plan for that. Until then, link ALL the things!</p>



<a name="272450619"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/272450619" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Aaron <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#272450619">(Feb 18 2022 at 20:03)</a>:</h4>
<p>i haven't finished the tutorial yet but is there an argc/argv interface in the common platforms ?</p>



<a name="272457289"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/272457289" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#272457289">(Feb 18 2022 at 21:05)</a>:</h4>
<p>all of that linking will go away when we have surgical linking working on macOS - currently that only works on Linux, but the x86 macOS implementation is partially complete</p>



<a name="272457347"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/272457347" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#272457347">(Feb 18 2022 at 21:05)</a>:</h4>
<p>the current linking solution on <code>trunk</code> has a bunch of problems, but it was a lot faster to get up and running than the long-term implementation we're working towards <span aria-label="big smile" class="emoji emoji-1f604" role="img" title="big smile">:big_smile:</span></p>



<a name="272457407"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/272457407" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#272457407">(Feb 18 2022 at 21:06)</a>:</h4>
<p>so wheneever any platform needs to link something new, we just add it in there</p>



<a name="272457420"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/272457420" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#272457420">(Feb 18 2022 at 21:06)</a>:</h4>
<p>eventually that whole <code>.rs</code> file will be unnecessary and get deleted</p>



<a name="272459311"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/272459311" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ayaz Hafiz <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#272459311">(Feb 18 2022 at 21:23)</a>:</h4>
<p><span class="user-mention silent" data-user-id="479763">Aaron</span> <a href="#narrow/stream/231634-beginners/topic/Platform.20question/near/272450619">said</a>:</p>
<blockquote>
<p>i haven't finished the tutorial yet but is there an argc/argv interface in the common platforms ?</p>
</blockquote>
<p>I don't think any platform in the examples currently exposes this, though it shouldn't be too hard to do. This could be a candidate for a <a href="https://github.com/rtfeldman/roc/issues/2498">standard platform</a>.</p>
<p>(Digression: I wonder if argc/argv should be more standardized in the language, or always handled in the host, because right now if the host exposes them they must be wrapped in an Effect - but (I think) they need not be effect-ful, since they're supplied by the kernel)</p>



<a name="272461408"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/272461408" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Aaron <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#272461408">(Feb 18 2022 at 21:43)</a>:</h4>
<p>Could this be a similar interface to the way Elm accepts flags on init?</p>



<a name="272465706"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/272465706" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Carroll <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#272465706">(Feb 18 2022 at 22:17)</a>:</h4>
<p>Yeah so the classic <code>argc</code> and <code>argv</code> interface is just the way that you represent an array of strings in C. In Roc, the same information would be represented as <code>List Str</code>. So I think platforms would expose command line arguments to Roc as <code>List Str</code>. Once it's in Roc you'll generally want to parse the CLI arguments for your program into a nice Tag Union. That parsing library can be pure Roc code. There are similar libraries in Elm for URLs, for example.</p>



<a name="272465910"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/272465910" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#272465910">(Feb 18 2022 at 22:19)</a>:</h4>
<p>and we do allow passing in flags in e.g. the <code>tui</code> platform</p>



<a name="272465915"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/272465915" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#272465915">(Feb 18 2022 at 22:19)</a>:</h4>
<p>at least in theory</p>



<a name="272468704"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/272468704" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jan kili <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#272468704">(Feb 18 2022 at 22:46)</a>:</h4>
<p>Does <a href="https://github.com/rtfeldman/roc/blob/trunk/examples/tui/platform/host.zig">tui</a> have an example of that today or no?</p>



<a name="272468817"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/272468817" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#272468817">(Feb 18 2022 at 22:47)</a>:</h4>
<div class="codehilite"><pre><span></span><code>mainForHost : { init : ({} -&gt; Model) as Init, update : (Model, Str -&gt; Model) as Update, view : (Model -&gt; Str) as View }
mainForHost = main
</code></pre></div>



<a name="272468835"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/272468835" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#272468835">(Feb 18 2022 at 22:47)</a>:</h4>
<p>so currently it takes <code>{}</code> as the flags value</p>



<a name="272468873"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/272468873" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#272468873">(Feb 18 2022 at 22:48)</a>:</h4>
<p>but that can be turned into something else</p>



<a name="272468960"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/272468960" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jan kili <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#272468960">(Feb 18 2022 at 22:48)</a>:</h4>
<p>Nice!</p>



<a name="272482416"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/272482416" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jan kili <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#272482416">(Feb 19 2022 at 01:39)</a>:</h4>
<p>I'm not sure if this is called tree shaking or lazy loading or what...<br>
Is there any way for a platform to include/exclude imported libraries in/from the eventual machine code if the app does/doesn't use them? Example: A Rust-based platform imports two different stdout formatting crates, A and B. An app might do either <code>Task.await (Stdout.lineA "hello")</code> or <code>Task.await (Stdout.lineB "hello")</code>, and therefore the executable might only need crate A or crate B but not both. Is that a possible optimization, or does CFFI not grant us that level of compile-time insight?</p>



<a name="272482563"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/272482563" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jan kili <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#272482563">(Feb 19 2022 at 01:41)</a>:</h4>
<p>(For a more realistic example, I'm thinking that a video game platform might have a lot of heavy dependencies, but an individual video game might not need everything - physics simulation, programmatic map generation, etc.)</p>



<a name="272482568"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/272482568" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#272482568">(Feb 19 2022 at 01:41)</a>:</h4>
<p>do you mean things the host imports?</p>



<a name="272482573"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/272482573" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#272482573">(Feb 19 2022 at 01:41)</a>:</h4>
<p>or like Roc code</p>



<a name="272482647"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/272482647" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#272482647">(Feb 19 2022 at 01:42)</a>:</h4>
<p>maybe to put it another way: are we talking about machine code that was originally Rust code getting eliminated, or machine code that was originally Roc code getting eliminated?</p>



<a name="272482650"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/272482650" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jan kili <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#272482650">(Feb 19 2022 at 01:42)</a>:</h4>
<p>Rust</p>



<a name="272482664"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/272482664" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jan kili <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#272482664">(Feb 19 2022 at 01:42)</a>:</h4>
<p>My question might be: "Can we tree-shake Rust code that isn't used by Roc?"</p>



<a name="272482675"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/272482675" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#272482675">(Feb 19 2022 at 01:42)</a>:</h4>
<p>so I believe that's possible in the general case, although it's out of scope for Roc itself</p>



<a name="272482682"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/272482682" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#272482682">(Feb 19 2022 at 01:42)</a>:</h4>
<p>I remember reading about this</p>



<a name="272482713"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/272482713" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#272482713">(Feb 19 2022 at 01:43)</a>:</h4>
<p>it's something like there's a way to tell compilers (and I think Rust does this by default?) to emit each function into its own separate section of the binary</p>



<a name="272482722"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/272482722" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#272482722">(Feb 19 2022 at 01:43)</a>:</h4>
<p>The answer is definitely possible. Requires function sections and the linker doing GC</p>



<a name="272482726"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/272482726" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#272482726">(Feb 19 2022 at 01:43)</a>:</h4>
<p>which then lets you run a tool afterwards that says "if nothing ever calls into this section, eliminate the section"</p>



<a name="272482732"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/272482732" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#272482732">(Feb 19 2022 at 01:43)</a>:</h4>
<p>yeah exactly <span aria-label="point up" class="emoji emoji-1f446" role="img" title="point up">:point_up:</span></p>



<a name="272482781"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/272482781" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#272482781">(Feb 19 2022 at 01:44)</a>:</h4>
<p>so it depends on whether the host compiler supports emitting code that way</p>



<a name="272482786"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/272482786" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#272482786">(Feb 19 2022 at 01:44)</a>:</h4>
<p><span class="user-mention" data-user-id="343810">@Brendan Hansknecht</span> I don't think surgical linking should affect that, right?</p>



<a name="272482800"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/272482800" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#272482800">(Feb 19 2022 at 01:44)</a>:</h4>
<p>but yeah, regardless - it'd be something you would do without getting Roc involved at all</p>



<a name="272482833"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/272482833" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#272482833">(Feb 19 2022 at 01:45)</a>:</h4>
<p>there's just a tool you can run on the final binary that does it, assuming the binary was originally set up in a way that permits the tool do that</p>



<a name="272482834"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/272482834" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#272482834">(Feb 19 2022 at 01:45)</a>:</h4>
<p>The surgical linker wouldn't be able to clean up unused sections. They would already be baked into the binary.</p>



<a name="272482839"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/272482839" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#272482839">(Feb 19 2022 at 01:45)</a>:</h4>
<p>right, but it wouldn't affect those sections being there</p>



<a name="272482847"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/272482847" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#272482847">(Feb 19 2022 at 01:45)</a>:</h4>
<p>It also would probably cost way to much performance</p>



<a name="272482849"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/272482849" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#272482849">(Feb 19 2022 at 01:45)</a>:</h4>
<p>like you could still run the "DCE unused sections" tool separately later</p>



<a name="272482870"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/272482870" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#272482870">(Feb 19 2022 at 01:45)</a>:</h4>
<p>and it would still work, because the surgical linker didn't (for example) combine those sections or anything</p>



<a name="272482934"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/272482934" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#272482934">(Feb 19 2022 at 01:46)</a>:</h4>
<p>like it wouldn't touch them, so if they were set up that way by the host, they'd still be set up that way after surgical linking, and thus still eligible for DCE by a third-party tool</p>



<a name="272482966"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/272482966" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#272482966">(Feb 19 2022 at 01:47)</a>:</h4>
<p>Yeah, the section would just sit there and never get called into</p>



<a name="272483071"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/272483071" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jan kili <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#272483071">(Feb 19 2022 at 01:48)</a>:</h4>
<p>I see, and this is machine code? assembly? C?</p>



<a name="272483126"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/272483126" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jan kili <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#272483126">(Feb 19 2022 at 01:49)</a>:</h4>
<p>And the app developer would run a Dead Code Elimination tool on the output of the Roc CLI's compile/build?</p>



<a name="272483209"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/272483209" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jan kili <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#272483209">(Feb 19 2022 at 01:50)</a>:</h4>
<p>This will be more common if kitchen-sink-style (all-in-one) platforms are popular. Idk that they will be</p>



<a name="272483238"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/272483238" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jan kili <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#272483238">(Feb 19 2022 at 01:51)</a>:</h4>
<p>This will also be more common if app developers don't want to fork their platform, for whatever reasons</p>



<a name="272483271"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/272483271" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jan kili <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#272483271">(Feb 19 2022 at 01:51)</a>:</h4>
<p>I'm new to systems languages, so maybe this DCE thing is commonplace?</p>



<a name="272483368"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/272483368" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jan kili <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#272483368">(Feb 19 2022 at 01:53)</a>:</h4>
<p>Motivation for this question: I saw a cool looking Bevy (Rust video game engine) plugin in my GitHub feed and thought "add it to the pile! no downside! wait..."</p>



<a name="272483448"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/272483448" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Andrew Thompson <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#272483448">(Feb 19 2022 at 01:54)</a>:</h4>
<p>I wonder if you could have an empty shell host, where you'd opt into components somehow, and then codegen or let the host compile in just the chosen components.</p>



<a name="272483520"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/272483520" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#272483520">(Feb 19 2022 at 01:55)</a>:</h4>
<blockquote>
<p>I see, and this is machine code? assembly? C?</p>
</blockquote>
<p>machine code!</p>



<a name="272483536"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/272483536" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#272483536">(Feb 19 2022 at 01:55)</a>:</h4>
<blockquote>
<p>And the app developer would run a Dead Code Elimination tool on the output of the Roc CLI's compile/build?</p>
</blockquote>
<p>right, exactly - assuming they cared to <span aria-label="big smile" class="emoji emoji-1f604" role="img" title="big smile">:big_smile:</span></p>



<a name="272483632"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/272483632" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#272483632">(Feb 19 2022 at 01:56)</a>:</h4>
<blockquote>
<p>I wonder if you could have an empty shell host, where you'd opt into components somehow, and then codegen or let the host compile in just the chosen components.</p>
</blockquote>
<p>that's already if you do load them on startup (or later) with dynamic linking</p>



<a name="272483647"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/272483647" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#272483647">(Feb 19 2022 at 01:57)</a>:</h4>
<p>I hadn't thought about it, but it's conceivable we could let platforms ship with multiple binaries so they could load some of them on the fly if they wanted to</p>



<a name="272483729"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/272483729" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#272483729">(Feb 19 2022 at 01:58)</a>:</h4>
<p>I hope platform authors wouldn't use dynamic linking that searches the system path (unless absolutely necessary, e.g. it's needed on macOS for system libraries, and in practice <code>glibc</code> needs it on Linux too)</p>



<a name="272483743"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/272483743" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#272483743">(Feb 19 2022 at 01:58)</a>:</h4>
<p>because inevitably that would mean that some people would go to run the platform and get an error on startup <span aria-label="confused" class="emoji emoji-1f615" role="img" title="confused">:confused:</span></p>



<a name="272483755"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/272483755" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Andrew Thompson <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#272483755">(Feb 19 2022 at 01:59)</a>:</h4>
<p>I wasn't thinking dynamic linking, more I'll include these definitions in the compiled platform if you ask for them. (And if you don't, your compile goes boom before you've ever delivered an app to anyone)</p>



<a name="272483986"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/272483986" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#272483986">(Feb 19 2022 at 02:01)</a>:</h4>
<p>ah gotcha</p>



<a name="272483989"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/272483989" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Andrew Thompson <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#272483989">(Feb 19 2022 at 02:01)</a>:</h4>
<p>But now I'm thinking about configuring kernels with <code>make menuconfig</code>, and I'm getting feint.</p>



<a name="272483991"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/272483991" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#272483991">(Feb 19 2022 at 02:01)</a>:</h4>
<p><span aria-label="laughing" class="emoji emoji-1f606" role="img" title="laughing">:laughing:</span></p>



<a name="272484050"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/272484050" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#272484050">(Feb 19 2022 at 02:02)</a>:</h4>
<p>since the DCE thing already works without adding anything to the language, I'd say we should start with that and see if there's a compelling use case for more than that in practice!</p>



<a name="272484101"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/272484101" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jan kili <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#272484101">(Feb 19 2022 at 02:03)</a>:</h4>
<p><span class="user-mention" data-user-id="477743">@Andrew Thompson</span> Am I following? <span aria-label="fear" class="emoji emoji-1f628" role="img" title="fear">:fear:</span></p>
<div class="codehilite" data-code-language="CoffeeScript"><pre><span></span><code><span class="nx">app</span> <span class="s">"fear_the_night"</span>
    <span class="nx">packages</span> <span class="p">{</span> <span class="nv">pf: </span><span class="s">"the-changeling"</span> <span class="p">}</span>
    <span class="nx">imports</span> <span class="p">[]</span>
    <span class="nx">provides</span> <span class="p">[</span> <span class="mi">666</span> <span class="p">]</span> <span class="nx">to</span> <span class="nx">pf</span>

<span class="mi">666</span> <span class="o">=</span> <span class="p">{</span> <span class="nv">realPlatform: </span><span class="s">"./roc/examples/cli/platform"</span> <span class="p">}</span>
</code></pre></div>



<a name="272484203"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/272484203" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Andrew Thompson <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#272484203">(Feb 19 2022 at 02:04)</a>:</h4>
<p><span class="user-mention" data-user-id="462053">@JanCVanB</span> sorry, I'm too new to follow. I looked at compiling roc code, but haven't made my way through the tutorials.</p>



<a name="272484231"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/272484231" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jan kili <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#272484231">(Feb 19 2022 at 02:05)</a>:</h4>
<p>No worries, I'm probably misunderstanding your "empty shell host" - it conjures horror movie vibes <span aria-label="laughing" class="emoji emoji-1f606" role="img" title="laughing">:laughing:</span></p>



<a name="272492015"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/272492015" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jose Quesada <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#272492015">(Feb 19 2022 at 04:25)</a>:</h4>
<p>There might be another way to support dead code elimination at the platform level, platform language permitting. </p>
<p>Por example, let's say every publicaclly exposed function in Rust gets its own feature flag (this can be done automatically). Roc knows what functions are being exposed by rust, and can therefore emit the feature flags for the exact functions it needs. Rustc would take care of DCE natively.</p>
<p>I believe something similar should be possible with zig, but don't know.</p>



<a name="272495659"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/272495659" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#272495659">(Feb 19 2022 at 05:44)</a>:</h4>
<p>That definitely would work. That being said, I think generally speaking DCE doesn't matter too much, but if we want it in the future, there are many ways to add it. Personally I think feature flags are a less optimal solution. They require rebuilding the host and would have to be uniquely done for each host language.</p>



<a name="272517569"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/272517569" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jose Quesada <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#272517569">(Feb 19 2022 at 13:09)</a>:</h4>
<p>Yes, the language by language basis would be the worst part.<br>
You are also correct that DCE isn't super beneficial in most situations. Though I could imagine it being so for embedded systems. But as mentioned, there are alternative approaches for now.</p>



<a name="272526275"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/272526275" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Andrew Thompson <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#272526275">(Feb 19 2022 at 16:01)</a>:</h4>
<p>Is the expectation that platforms would be delivered normally as binaries?</p>



<a name="272526765"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/272526765" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#272526765">(Feb 19 2022 at 16:10)</a>:</h4>
<p>yeah the plan is that every platform ships with precompiled binaries</p>



<a name="272526772"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/272526772" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#272526772">(Feb 19 2022 at 16:10)</a>:</h4>
<p>for each target they support (e.g. Mac, Linux, Windows, etc.)</p>



<a name="272526876"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/272526876" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#272526876">(Feb 19 2022 at 16:12)</a>:</h4>
<p>I'm strongly opposed to the typical way that package managers handle native code, which is to say "build it on your local machine, and then some percentage of the time have installation fail with something cryptic like <code>ld: could not resolve symbol __cxx_mumbo_jumbo in libwhatever.so</code>"</p>



<a name="272526971"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/272526971" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#272526971">(Feb 19 2022 at 16:14)</a>:</h4>
<p>the design goal I have in mind is that from any clean operating system install, you can download the <code>roc</code> binary and use it to start writing Roc code, including automatically downloading and installing any platforms you specify, without needing any other tools installed on the system, and with platform compilation always succeeding</p>



<a name="272527020"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/272527020" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#272527020">(Feb 19 2022 at 16:15)</a>:</h4>
<p>ideally I'd also like the package repo to verify this - e.g. if the platform says it supports x64 Linux, then it looks for a precompiled binary and verifies that it's valid ELF, etc.</p>



<a name="272527094"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/272527094" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#272527094">(Feb 19 2022 at 16:16)</a>:</h4>
<p>so as an application author, the only programming language you should need to know to use Roc is Roc, and the only tool you should need to program Roc applications is <code>roc</code></p>



<a name="272527124"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/272527124" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#272527124">(Feb 19 2022 at 16:17)</a>:</h4>
<p>Roc should never tell you "ok it's time to go learn about shared libraries now"</p>



<a name="272527135"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/272527135" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#272527135">(Feb 19 2022 at 16:17)</a>:</h4>
<p>unless the particular platform you're using is for building shared libraries or something <span aria-label="stuck out tongue" class="emoji emoji-1f61b" role="img" title="stuck out tongue">:stuck_out_tongue:</span></p>



<a name="272527216"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/272527216" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#272527216">(Feb 19 2022 at 16:18)</a>:</h4>
<p>separately, I also like the idea of (but haven't thought it through completely yet) having a requirement that published platforms declare all their dynamically linked dependencies, and provide links for how to obtain them</p>



<a name="272527248"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/272527248" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Carroll <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#272527248">(Feb 19 2022 at 16:19)</a>:</h4>
<p>So as a platform author the number of binaries you need to build is (number of OS's) x (number of CPUs), right? I guess that's the same as anywhere else you download pre-built binaries.</p>



<a name="272527250"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/272527250" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#272527250">(Feb 19 2022 at 16:20)</a>:</h4>
<p>so if it's absolutely unavoidable to depend on a dynamic library (e.g. for licensing reasons), we can actually detect when it's missing right when you install the platform, and say "hey your system can't install this platform because it needs this other thing to be installed first; here are the instructions the platform author wrote for what to do if you find yourself in this situation: _______"</p>



<a name="272537122"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/272537122" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#272537122">(Feb 19 2022 at 19:24)</a>:</h4>
<p><span class="user-mention silent" data-user-id="479655">Jose Quesada</span> <a href="#narrow/stream/231634-beginners/topic/Platform.20question/near/272517569">said</a>:</p>
<blockquote>
<p>Yes, the language by language basis would be the worst part.<br>
You are also correct that DCE isn't super beneficial in most situations. Though I could imagine it being so for embedded systems. But as mentioned, there are alternative approaches for now.</p>
</blockquote>
<p>100% true. I have been messing around with embedded Roc and it currently wastes a lot memory. The current problem is that Roc compiles for speed rather than size, and it's unused functions are not garbage collected. So it is actually roc side problems, not host side.</p>



<a name="272537229"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/272537229" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#272537229">(Feb 19 2022 at 19:26)</a>:</h4>
<p>I think I need to downgrade it's symbols to no longer be global so that they will properly get garbage collected.</p>



<a name="272537749"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/272537749" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#272537749">(Feb 19 2022 at 19:36)</a>:</h4>
<blockquote>
<p>its unused functions are not garbage collected</p>
</blockquote>
<p>do you mean builtins?</p>



<a name="272537774"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/272537774" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#272537774">(Feb 19 2022 at 19:36)</a>:</h4>
<p>I think unused functions written in Roc by the author of the program shouldn't get emitted in the first place <span aria-label="thinking" class="emoji emoji-1f914" role="img" title="thinking">:thinking:</span></p>



<a name="272538016"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/272538016" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#272538016">(Feb 19 2022 at 19:40)</a>:</h4>
<p>No, I mean for example, <code>roc__mainForHost_1_exposed_generic</code> when only <code>roc__mainForHost_1_exposed</code> is used.</p>



<a name="272538033"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/272538033" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#272538033">(Feb 19 2022 at 19:41)</a>:</h4>
<p>Oh, and <code>__muloti4</code> which we still always emit</p>



<a name="272539673"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/272539673" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#272539673">(Feb 19 2022 at 20:10)</a>:</h4>
<p>Hmm, actually I am wrong about the size cost here. The real problem looks to be the loss of inlining. The binary bloats by way more than the size of the roc app. So when the app was completely rust, it inlined and greatly simplified most of the code. Since part is in roc, the inline potential is much more limited.<br>
In this case, the Roc app is 1582 bytes, but using roc leads to the binary bloating by 4120 bytes.</p>



<a name="272575787"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/272575787" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> J.R. &#x27;hiljusti&#x27; Hill <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#272575787">(Feb 20 2022 at 08:12)</a>:</h4>
<p>I like the idea of 4120 bytes being considered bloat...</p>
<p>I've seen codebases that generate multi-GB server applications and yet they amount to little more than request -&gt; call 0|n other things -&gt; response.</p>



<a name="272723595"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/272723595" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Christian Dereck <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#272723595">(Feb 21 2022 at 18:50)</a>:</h4>
<p>Noob question: would this (having the platforms already compiled) simplify cross compiling or would the same problems still exist?</p>



<a name="272724961"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/272724961" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#272724961">(Feb 21 2022 at 19:04)</a>:</h4>
<p>If the platform is precompiled for all the architectures you want to target, roc essentially just hooks into that and is extremely portable. So cross compilation should be very easy. But yeah, depends on the platform supporting your target and llvm at least supporting the CPU architecture you're targeting.</p>



<a name="272897146"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/272897146" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jose Quesada <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#272897146">(Feb 23 2022 at 02:31)</a>:</h4>
<p>I have an issue that perhaps someone else has run into?</p>
<p>I am implementing a custom platform, only modifying the <code>roc_main</code> function from a hello example. Everything in the platform side seems to not have an issue, however, I seem to be getting an error that doesn't make sense to me. Provided the following code:</p>
<div class="codehilite"><pre><span></span><code>app &quot;hello-rust&quot;
    packages { pf: &quot;platform&quot; }
    imports []
    provides [ main ] to pf

greeting =
    hi = &quot;Hello&quot;
    name = &quot;World&quot;

    &quot;\(hi), \(name)!\n&quot;

main = greeting
</code></pre></div>
<p>I am getting the following error when running:</p>
<div class="codehilite"><pre><span></span><code>    Finished dev [unoptimized + debuginfo] target(s) in 0.24s
     Running `target/debug/roc ./examples/speak-aloud/Speak.roc DDDDD`
🔨 Rebuilding host... Done!
SIOD ERROR: unbound variable : Hello
SIOD ERROR: comma-not-inside-backquote
</code></pre></div>
<p>The <code>Hello</code> it seems to be referring to is <code>hello = "Hello"</code> because if I change what's inside the quotes, the error changes with it</p>



<a name="272897164"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/272897164" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jose Quesada <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#272897164">(Feb 23 2022 at 02:31)</a>:</h4>
<p>Any guesses as to a possible cause?</p>



<a name="272897278"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/272897278" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jose Quesada <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#272897278">(Feb 23 2022 at 02:33)</a>:</h4>
<p>I can run other examples and code without issue, so I seem to be running into something else, but no idea how to trubleshoot in this case</p>



<a name="272916700"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/272916700" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anton <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#272916700">(Feb 23 2022 at 08:22)</a>:</h4>
<p>Your platform sees <code>Hello</code> as a variable, perhaps it is expecting double quotes inside the string to interpret it as a string?<br>
So something like:</p>
<div class="codehilite" data-code-language="CoffeeScript"><pre><span></span><code><span class="nx">app</span> <span class="s">"hello-rust"</span>
    <span class="nx">packages</span> <span class="p">{</span> <span class="nv">pf: </span><span class="s">"platform"</span> <span class="p">}</span>
    <span class="nx">imports</span> <span class="p">[]</span>
    <span class="nx">provides</span> <span class="p">[</span> <span class="nx">main</span> <span class="p">]</span> <span class="nx">to</span> <span class="nx">pf</span>

<span class="nv">main = </span><span class="s">"\"Hello\""</span>
</code></pre></div>



<a name="272958778"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/272958778" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jose Quesada <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#272958778">(Feb 23 2022 at 14:54)</a>:</h4>
<p>Thank you Anton. I'll check it out. It shouldn't be the case, as all I am doing is slightly modifying the original hello rust example. Though it very much could be as most of the functions aren't documented yet <span aria-label="sweat smile" class="emoji emoji-1f605" role="img" title="sweat smile">:sweat_smile:</span></p>



<a name="272961459"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/272961459" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anton <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#272961459">(Feb 23 2022 at 15:11)</a>:</h4>
<p>I'm not following completely, for which functions would you like to see more documentation?<br>
Feel free to push a new branch to the repo with the speak-aloud example if you'd like anyone to help make it work.</p>



<a name="272972465"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/272972465" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jose Quesada <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#272972465">(Feb 23 2022 at 16:26)</a>:</h4>
<p><span class="user-mention" data-user-id="361169">@Anton</span>, you were 100% right. I didn't really understand what you meant. I got it to work. I was spawning a child thread, but was expecting the program to panic on invalid input, but that didn't happen. I assumed the output I was getting was actually comming from Roc, but it was the child process. Thanks again.</p>



<a name="272976352"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/272976352" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anton <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#272976352">(Feb 23 2022 at 16:53)</a>:</h4>
<p>Happy to help :)</p>



<a name="273018821"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/273018821" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jorge Acereda <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#273018821">(Feb 23 2022 at 22:12)</a>:</h4>
<p>Why does <a href="http://link.rs">link.rs</a> mess environment variables? If I'm reading correctly, looks like it's clearing everything except HOME/PATH. That's a problem on Guix,  it relies on environment variables to find includes and libs. Also, why isn't it using CC when building C host files?</p>



<a name="273020273"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/273020273" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#273020273">(Feb 23 2022 at 22:23)</a>:</h4>
<p><code>link.rs</code> was cobbled together and has grown naturally. It really is not how we want to do linking in the long term. It works for most people, so it generally doesn't get messed with too much. I don't remember why, but I know that not clearing environment variables led to breakages on some machines<br>
 I know at one point there were some modifications to get it working on nixos (not sure if they got merged). Those might help with getting it working on guix.<br>
Overall, please feel free to modify it and open pull requests. It could use some cleanup.</p>



<a name="273020439"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/273020439" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#273020439">(Feb 23 2022 at 22:24)</a>:</h4>
<p>In the future, platforms will be downloaded precompiled and/or specify their own build commands and linking will always go through the roc linker.</p>



<a name="273156390"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/273156390" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jorge Acereda <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#273156390">(Feb 24 2022 at 22:11)</a>:</h4>
<p>LTO+musl:</p>
<p><code>jacereda@mbp ~/src/roc [env]$ size examples/hello-world/hello-world
   text    data     bss     dec     hex filename
  14971     568    1664   17203    4333 examples/hello-world/hello-world
</code></p>



<a name="273156647"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/273156647" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jorge Acereda <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#273156647">(Feb 24 2022 at 22:13)</a>:</h4>
<p>Why glibc? IMHO it would be a good thing to decouple Roc from the C compiler/runtime, just use whatever CC/CFLAGS/LDFLAGS are defined... That would simplify quite a bit <a href="http://link.rs">link.rs</a>.</p>



<a name="273156870"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/273156870" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#273156870">(Feb 24 2022 at 22:15)</a>:</h4>
<p>the surgical linker is already that way, it just only works on Linux right now</p>



<a name="273156931"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/273156931" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jorge Acereda <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#273156931">(Feb 24 2022 at 22:16)</a>:</h4>
<p>how do I invoke that?</p>



<a name="273157069"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/273157069" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#273157069">(Feb 24 2022 at 22:17)</a>:</h4>
<p>pass <code>--roc-linker</code> to the Roc compiler</p>



<a name="273157179"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/273157179" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#273157179">(Feb 24 2022 at 22:19)</a>:</h4>
<p>honestly I think it might simplify conversations around <code>link.rs</code> if we renamed it to <code>temporary_pile_of_hacks.rs</code> so it's more self-descriptive about how we should be thinking about investing in making it more robust <span aria-label="laughing" class="emoji emoji-1f606" role="img" title="laughing">:laughing:</span></p>



<a name="273157258"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/273157258" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jorge Acereda <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#273157258">(Feb 24 2022 at 22:19)</a>:</h4>
<p>what size does that yield on your box?</p>



<a name="273157277"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/273157277" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#273157277">(Feb 24 2022 at 22:19)</a>:</h4>
<p>and/or put a comment at the top explaining how it's going away? <span aria-label="thinking" class="emoji emoji-1f914" role="img" title="thinking">:thinking:</span></p>



<a name="273157374"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/273157374" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#273157374">(Feb 24 2022 at 22:19)</a>:</h4>
<p>I'm on macOS at the moment, so I'm not sure offhand</p>



<a name="273157620"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/273157620" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#273157620">(Feb 24 2022 at 22:20)</a>:</h4>
<p><span class="user-mention silent" data-user-id="479704">Jorge Acereda</span> <a href="#narrow/stream/231634-beginners/topic/Platform.20question/near/273157258">said</a>:</p>
<blockquote>
<p>what size does that yield on your box?</p>
</blockquote>
<p>What specifically are you looking at the size for? Also, the roc linker + some changes to how platforms specify build commands would enable the platform to choose if it wants to use musl or not.</p>



<a name="273157840"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/273157840" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#273157840">(Feb 24 2022 at 22:22)</a>:</h4>
<p>to elaborate a bit, the surgical linker basically says "give me a working executable that attempts to dynamically link the Roc application entrypoint" (typically the <code>main</code> provided by the application author) and after the Roc application gets compiled into machine code, I will incorporate it into that executable and replace that dynamic linking with static linking after the fact</p>



<a name="273157905"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/273157905" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jorge Acereda <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#273157905">(Feb 24 2022 at 22:23)</a>:</h4>
<p>Well, I do care about code bloat. I'm considering if this would be an appropriate language for embedded.</p>



<a name="273157975"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/273157975" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#273157975">(Feb 24 2022 at 22:24)</a>:</h4>
<p>so what you start out with is an executable that has some dynamic linking for the Roc application entrypoint, and what you end up with is that same executable except it's no longer doing dynamic linking for the Roc application entrypoint; instead, the entire compiled application has been added to the binary</p>



<a name="273157986"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/273157986" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#273157986">(Feb 24 2022 at 22:24)</a>:</h4>
<p>the Roc stdlib doesn't depend on libc at all</p>



<a name="273158025"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/273158025" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#273158025">(Feb 24 2022 at 22:24)</a>:</h4>
<p>it just says the host needs to provide a few functions (<code>roc_alloc</code>, <code>roc_dealloc</code>, <code>roc_realloc</code>, <code>roc_memcpy</code>, and <code>roc_panic</code>)</p>



<a name="273158069"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/273158069" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#273158069">(Feb 24 2022 at 22:25)</a>:</h4>
<p>it's completely up to the host how they want to implement those, they just need to be provided</p>



<a name="273158107"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/273158107" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#273158107">(Feb 24 2022 at 22:25)</a>:</h4>
<p>it's also completely up to the host how the executable gets compiled in the first place</p>



<a name="273158111"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/273158111" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#273158111">(Feb 24 2022 at 22:25)</a>:</h4>
<p>so there's no need for glibc or any libc at all</p>



<a name="273158119"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/273158119" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#273158119">(Feb 24 2022 at 22:25)</a>:</h4>
<p>at least from Roc's perspective</p>



<a name="273158175"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/273158175" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jorge Acereda <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#273158175">(Feb 24 2022 at 22:26)</a>:</h4>
<p>how does that differ from -static plus  -flto or --gc-sections?</p>



<a name="273158189"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/273158189" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#273158189">(Feb 24 2022 at 22:26)</a>:</h4>
<p>it's completely unrelated to them</p>



<a name="273158217"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/273158217" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#273158217">(Feb 24 2022 at 22:26)</a>:</h4>
<p>we don't call <code>ld</code> or anything like that</p>



<a name="273158281"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/273158281" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#273158281">(Feb 24 2022 at 22:27)</a>:</h4>
<p>the reason we call it the surgical linker is that literally all it's doing is adding the compiled application bytes to the binary, and then rewriting some headers to make some direct calls into dynamic ones</p>



<a name="273158309"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/273158309" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#273158309">(Feb 24 2022 at 22:27)</a>:</h4>
<p>so if you want to do another pass afterwards with a separate tool to GC sections, you totally can!</p>



<a name="273158338"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/273158338" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#273158338">(Feb 24 2022 at 22:27)</a>:</h4>
<p>but the Roc linker is narrowly scoped to only incorporate the compiled application into the precompiled host binary executable</p>



<a name="273158346"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/273158346" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#273158346">(Feb 24 2022 at 22:27)</a>:</h4>
<p>that's its entire job, it doesn't do anything else</p>



<a name="273158394"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/273158394" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#273158394">(Feb 24 2022 at 22:28)</a>:</h4>
<p>which is both super fast and also gives platform authors maximum flexibility</p>



<a name="273158413"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/273158413" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#273158413">(Feb 24 2022 at 22:28)</a>:</h4>
<p>because any linking system needs to do that at the bare minimum</p>



<a name="273158443"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/273158443" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jorge Acereda <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#273158443">(Feb 24 2022 at 22:28)</a>:</h4>
<p>do you mean patching the elf headers?</p>



<a name="273158447"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/273158447" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#273158447">(Feb 24 2022 at 22:28)</a>:</h4>
<p>yeah exactly</p>



<a name="273158471"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/273158471" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#273158471">(Feb 24 2022 at 22:29)</a>:</h4>
<p>and Mach-O on macOS - that one's in progress</p>



<a name="273158476"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/273158476" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#273158476">(Feb 24 2022 at 22:29)</a>:</h4>
<p><span class="user-mention silent" data-user-id="479704">Jorge Acereda</span> <a href="#narrow/stream/231634-beginners/topic/Platform.20question/near/273157905">said</a>:</p>
<blockquote>
<p>Well, I do care about code bloat. I'm considering if this would be an appropriate language for embedded.</p>
</blockquote>
<p>Very cool. Great to know the goal. For the embedded case, I don't think you will touch any roc linking stuff at all. Instead, I believe that you would just have roc emit a static library. Then you would have the embedded targeting platform deal with all of the linking.<br>
That is what I am doing <a href="https://github.com/bhansconnect/roc-microbit">here</a> when targeting the nrf chip on the microbit.</p>



<a name="273158484"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/273158484" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jorge Acereda <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#273158484">(Feb 24 2022 at 22:29)</a>:</h4>
<p>and does that work for static and dynamic executables?</p>



<a name="273158500"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/273158500" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#273158500">(Feb 24 2022 at 22:29)</a>:</h4>
<p>oh, also currently the surgical linker works for x64 ELF only - that's probably relevant!</p>



<a name="273158783"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/273158783" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jorge Acereda <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#273158783">(Feb 24 2022 at 22:32)</a>:</h4>
<p>Also, have you considered APE?</p>



<a name="273158814"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/273158814" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jorge Acereda <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#273158814">(Feb 24 2022 at 22:32)</a>:</h4>
<p>cosmopolitan libc</p>



<a name="273158848"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/273158848" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jorge Acereda <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#273158848">(Feb 24 2022 at 22:32)</a>:</h4>
<p>having a single binary across OSs could be really nice</p>



<a name="273158889"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/273158889" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#273158889">(Feb 24 2022 at 22:33)</a>:</h4>
<p>never heard of APE or cosmopolitan libc</p>



<a name="273158898"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/273158898" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jorge Acereda <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#273158898">(Feb 24 2022 at 22:33)</a>:</h4>
<p><a href="https://justine.lol/cosmopolitan/index.html">https://justine.lol/cosmopolitan/index.html</a></p>



<a name="273158977"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/273158977" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#273158977">(Feb 24 2022 at 22:34)</a>:</h4>
<p>That would be tagential to Roc. That would be a platform decision.</p>



<a name="273159294"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/273159294" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#273159294">(Feb 24 2022 at 22:37)</a>:</h4>
<p>right - from the Roc compiler's perspective, the goal is to be completely decoupled from libc</p>



<a name="273159350"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/273159350" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#273159350">(Feb 24 2022 at 22:38)</a>:</h4>
<p>so platform authors can use whatever libc they want, or decline to use libc altogether</p>



<a name="273159369"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/273159369" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#273159369">(Feb 24 2022 at 22:38)</a>:</h4>
<p>and everything still works!</p>



<a name="273159577"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/273159577" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jorge Acereda <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#273159577">(Feb 24 2022 at 22:40)</a>:</h4>
<p>with cosmopolitan and some hacks you can end up having a single executable with OpenGL graphics running on Windows/Linux/NetBSD/FreeBSD, I did some experiments and it's totally possible... The only showstopper so far was OpenBSD that has some security measures that would need to be circumvented, but it's also possible with some more work.<br>
<a href="https://github.com/jacereda/cosmogfx">https://github.com/jacereda/cosmogfx</a></p>



<a name="273159678"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/273159678" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#273159678">(Feb 24 2022 at 22:41)</a>:</h4>
<p>The main problem that I believe will limit roc for embedded is that roc and the platform are two separate chunks of code. They are not compiled together. They can't take advantage of inlining. This can add a huge number of bytes to an executable. In the roc-microbit case, using roc costs about 2500 bytes more than just using rust due to the loss of inlining.</p>
<p>Of course, depending on the platform boundary this could potentially be greatly reduced.<br>
In reality, the solution is probably LTO between the platform and the Roc app, but that is hard because LTO is dependent on the specific version of LLVM. So it would be very brittle. Also more complex to setup in general.</p>



<a name="273159836"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/273159836" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jorge Acereda <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#273159836">(Feb 24 2022 at 22:43)</a>:</h4>
<p>is having a C codegen out of question?</p>



<a name="273159909"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/273159909" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jorge Acereda <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#273159909">(Feb 24 2022 at 22:43)</a>:</h4>
<p>well, another alternative could be to use -flto</p>



<a name="273159981"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/273159981" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jorge Acereda <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#273159981">(Feb 24 2022 at 22:44)</a>:</h4>
<p>that way the embedded platforms could inline just fine</p>



<a name="273160012"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/273160012" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#273160012">(Feb 24 2022 at 22:44)</a>:</h4>
<p>C codegen technically could be done, but I don't think anyone in the project would really want to support that.</p>



<a name="273160044"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/273160044" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#273160044">(Feb 24 2022 at 22:44)</a>:</h4>
<p>heh, I've actually thought about it for exactly that use case</p>



<a name="273160050"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/273160050" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#273160050">(Feb 24 2022 at 22:44)</a>:</h4>
<p>it's a big can of worms though</p>



<a name="273160082"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/273160082" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#273160082">(Feb 24 2022 at 22:45)</a>:</h4>
<p>"that use case" being compiling platforms and applications together into one executable</p>



<a name="273160099"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/273160099" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#273160099">(Feb 24 2022 at 22:45)</a>:</h4>
<p>that can be optimized as a whole</p>



<a name="273160112"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/273160112" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#273160112">(Feb 24 2022 at 22:45)</a>:</h4>
<p>Also, lto require llvm version matching which is doable, but brittle. If roc is using llvm version 13 and the c compiler for your device is only on gcc or is llvm 12, lto won't work.</p>



<a name="273160129"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/273160129" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#273160129">(Feb 24 2022 at 22:45)</a>:</h4>
<p>the original idea was to do that via LLVM bytecode, but...yeah, that <span aria-label="point up" class="emoji emoji-1f446" role="img" title="point up">:point_up:</span></p>



<a name="273160141"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/273160141" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#273160141">(Feb 24 2022 at 22:45)</a>:</h4>
<p>that would be a nightmare to maintain</p>



<a name="273160221"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/273160221" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#273160221">(Feb 24 2022 at 22:46)</a>:</h4>
<p>in comparison, we could emit (for example) C99 and say "here you go, do whatever you want with it"</p>



<a name="273160234"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/273160234" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#273160234">(Feb 24 2022 at 22:46)</a>:</h4>
<p>and that's at least a stable interface!</p>



<a name="273160381"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/273160381" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jorge Acereda <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#273160381">(Feb 24 2022 at 22:48)</a>:</h4>
<p>I guess the dependency on the LLVM version is just a matter of leaving LLVM mature a bit?</p>



<a name="273160520"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/273160520" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#273160520">(Feb 24 2022 at 22:49)</a>:</h4>
<p>Not really. LLVM intentionally wants people not to depend on that so that they can change it if they every think of better representations or other ideas.</p>



<a name="273160684"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/273160684" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jorge Acereda <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#273160684">(Feb 24 2022 at 22:50)</a>:</h4>
<p>I see... that makes a C (or zig?) backend more interesting then.</p>



<a name="273160688"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/273160688" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#273160688">(Feb 24 2022 at 22:50)</a>:</h4>
<p>I guess theoretically it should stabilize, but LLVM still will never make promises about the stability or that tools will work when dealing with multiple versions.</p>



<a name="273160726"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/273160726" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#273160726">(Feb 24 2022 at 22:51)</a>:</h4>
<p><span class="user-mention silent" data-user-id="479704">Jorge Acereda</span> <a href="#narrow/stream/231634-beginners/topic/Platform.20question/near/273160684">said</a>:</p>
<blockquote>
<p>I see... that makes a C (or zig?) backend more interesting then.</p>
</blockquote>
<p>As weird as that sounds. 100%.</p>



<a name="273160847"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/273160847" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#273160847">(Feb 24 2022 at 22:52)</a>:</h4>
<p>That or accepting the loss of inlining between platform and application/ architecturing platforms in ways that make it matter less.</p>



<a name="273160988"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/273160988" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#273160988">(Feb 24 2022 at 22:53)</a>:</h4>
<p>For example, I think things are made worse by embedded rust. Embedded rust is a giant pile of "zero" cost abstractions. The issue is that they depend on inline to be abstracted away. So when we break the inlining, I think it causes the rust to bloat. I think C or rust without the abstractions could be done in a way that the inlining basically didn't cause any problems.</p>



<a name="273161087"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/273161087" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#273161087">(Feb 24 2022 at 22:54)</a>:</h4>
<p>Oh also, we have to figure out to optimize roc for size. Currently we can only optimize for speed or not at all. Some reason size optimization isn't exposed through the libraries we use.</p>



<a name="273161523"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/273161523" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#273161523">(Feb 24 2022 at 22:58)</a>:</h4>
<p>Also, emitting C or Zig doesn't innately solve this. If I was still trying to use embedded rust and you emit C, I still wouldn't get inlining without all of the llvm hassles.</p>



<a name="273161594"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/273161594" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#273161594">(Feb 24 2022 at 22:59)</a>:</h4>
<p>well you could probably run a script to translate the C to Rust</p>



<a name="273161596"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/273161596" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#273161596">(Feb 24 2022 at 22:59)</a>:</h4>
<p>But emitting C does fix it for C and C++ and Zig. Also, probably easier to get a C compiler with the right llvm version to match my rust compiler.</p>



<a name="273161870"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/273161870" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ayaz Hafiz <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#273161870">(Feb 24 2022 at 23:01)</a>:</h4>
<p><span class="user-mention silent" data-user-id="343810">Brendan Hansknecht</span> <a href="#narrow/stream/231634-beginners/topic/Platform.20question/near/273161087">said</a>:</p>
<blockquote>
<p>Oh also, we have to figure out to optimize roc for size. Currently we can only optimize for speed or not at all. Some reason size optimization isn't exposed through the libraries we use.</p>
</blockquote>
<p>I think optimizing for speed may be the same as -O2: <a href="https://llvm.org/doxygen/CodeGen_8h_source.html">https://llvm.org/doxygen/CodeGen_8h_source.html</a></p>



<a name="273162658"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/273162658" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#273162658">(Feb 24 2022 at 23:08)</a>:</h4>
<p>Ah, that would make sense. So it looks like <code>Os</code> is <code>O2</code> minus some things and <code>Oz</code> is <code>Os</code> minus loop vectorization: <a href="https://stackoverflow.com/questions/15548023/clang-optimization-levels">https://stackoverflow.com/questions/15548023/clang-optimization-levels</a></p>



<a name="273166610"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/273166610" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#273166610">(Feb 24 2022 at 23:51)</a>:</h4>
<p>So I just tested adding optimizing for size to roc. Makes quicksort 3x larger. I guess something we do in our llvm generation really depends on some of the more aggressive optimizations.</p>



<a name="273167429"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/273167429" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#273167429">(Feb 25 2022 at 00:00)</a>:</h4>
<p>Ah, nvm. <code>link.rs</code> was still compiling the platform in debug mode. That makes way more sense.</p>



<a name="273168710"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/273168710" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#273168710">(Feb 25 2022 at 00:16)</a>:</h4>
<p>Ok, after updating <code>link.rs</code> to also build for size, quicksort goes from 256K to 148K.</p>



<a name="273168723"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/273168723" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#273168723">(Feb 25 2022 at 00:16)</a>:</h4>
<p>So definitely works</p>



<a name="273168875"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/273168875" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#273168875">(Feb 25 2022 at 00:18)</a>:</h4>
<p>Though I guess most of that is attributed to zig having <code>ReleaseSmall</code></p>



<a name="362701532"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/362701532" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ivo Balbaert <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#362701532">(Jun 01 2023 at 10:25)</a>:</h4>
<p>(<a href="https://github.com/roc-lang/basic-cli/tree/main/examples">https://github.com/roc-lang/basic-cli/tree/main/examples</a>)<br>
Hi all, I am a beginner to Roc, so I might overlook something, but I can't explain the following incomplete output when running time.roc:</p>
<div class="codehilite"><pre><span></span><code>main =
    start &lt;- Utc.now |&gt; Task.await
    dbg start       # =&gt; [time.roc 14:9] @Utc 1685614693863401198
    {} &lt;- slowTask |&gt; Task.await    # =&gt; Tried to open a file...
    finish &lt;- Utc.now |&gt; Task.await
    dbg finish      # =&gt; [time.roc 18:9] @Utc 1685614693863545706
    duration = Utc.deltaAsNanos start finish |&gt; Num.toStr
    dbg duration
    Stdout.line &quot;Completed in \(duration)ns&quot;

slowTask : Task.Task {} []
slowTask =
    path = Path.fromStr &quot;not-a-file-but-try-to-read-anyway&quot;
    result &lt;- File.readUtf8 path |&gt; Task.attempt
    when result is
        _ -&gt; Stdout.line &quot;Tried to open a file...&quot;
</code></pre></div>
<p>The dbg output of start and finish is shown, as well as Stdout.line from slowtask, but no output of dbg duration or no Stdout.line with durarion output. What could be a reason for this? Is this a bug? Thanks!</p>



<a name="362720766"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/362720766" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Fábio Beirão <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#362720766">(Jun 01 2023 at 11:34)</a>:</h4>
<p>If you remove that <code>|&gt; Num.toStr</code> after the <code>Utc.deltaAsNanos</code> would the dbg print?</p>



<a name="362721003"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/362721003" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Fábio Beirão <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#362721003">(Jun 01 2023 at 11:35)</a>:</h4>
<p>I could be confusing with other topics, but I think there's some bugfixing happening around <code>Num.toStr</code> and I'm just wondering if that would be the culprit as to why <code>dbg duration</code> would not print <span aria-label="thinking" class="emoji emoji-1f914" role="img" title="thinking">:thinking:</span></p>



<a name="362732265"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/362732265" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ivo Balbaert <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#362732265">(Jun 01 2023 at 12:12)</a>:</h4>
<p><span class="user-mention silent" data-user-id="620083">Fábio Beirão</span> <a href="#narrow/stream/231634-beginners/topic/Platform.20question/near/362720766">said</a>:</p>
<blockquote>
<p>If you remove that <code>|&gt; Num.toStr</code> after the <code>Utc.deltaAsNanos</code> would the dbg print?</p>
</blockquote>
<p>You're right! dbg duration then prints out! But there is no Stdout.line display of duration. The problem with Num.toStr  probably  still prevents that, no error is shown, just no output.  Thanks anyway!</p>



<a name="362732675"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/362732675" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Fábio Beirão <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#362732675">(Jun 01 2023 at 12:14)</a>:</h4>
<p>Just out of curiosity, which roc version are you using? ( <code>roc --version</code> )</p>



<a name="362738346"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/362738346" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ivo Balbaert <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#362738346">(Jun 01 2023 at 12:34)</a>:</h4>
<p>My fault! I was using a version of perhaps 1.5 weeks old. Before answering, I did an update to most recent source and build it, and the duration now is displayed:<br>
Tried to open a file...<br>
Completed in 59922ns<br>
Thanks for being patient !</p>



<a name="362738939"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/362738939" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Fábio Beirão <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#362738939">(Jun 01 2023 at 12:37)</a>:</h4>
<p>Absolutely not your fault :) I am happy I could help, with my very very limited roc knowledge. <span aria-label="pray" class="emoji emoji-1f64f" role="img" title="pray">:pray:</span></p>



<a name="409932654"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/409932654" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Slazaa <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#409932654">(Dec 25 2023 at 18:48)</a>:</h4>
<p>I'm trying to write a platform in Zig and I get the following  error when running <code>roc run</code></p>
<div class="codehilite"><pre><span></span><code>thread &#39;main&#39; panicked at &#39;There were still outstanding Arc references to module_ids&#39;, crates/compiler/load_internal/src/file.rs:1560:37
note: run with `RUST_BACKTRACE=1` environment variable to display a backtrace
</code></pre></div>



<a name="409939313"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/409939313" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#409939313">(Dec 25 2023 at 20:52)</a>:</h4>
<p>We will need to see more source to diagnose that. Probably has nothing to do with zig, but instead roc loading or specific parsing issues.</p>



<a name="409939341"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/409939341" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#409939341">(Dec 25 2023 at 20:53)</a>:</h4>
<p>Try <code>roc check</code> may reveal the real issue, if not, we probably need to see the code and mess around to figure out what is going on.</p>



<a name="409939497"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/409939497" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#409939497">(Dec 25 2023 at 20:56)</a>:</h4>
<p>I thi k I've seen this error or similar before, something like the way Interface or Package modules imported incorrectly. It's a shame we dont have a better error here yet, but if we can get a minimal repro maybe that would help.</p>



<a name="409939538"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/409939538" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#409939538">(Dec 25 2023 at 20:57)</a>:</h4>
<p>Though I think Agu's work implementing module params design will cleanup and fix those issues soon.</p>



<a name="409939635"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Platform%20question/near/409939635" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Platform.20question.html#409939635">(Dec 25 2023 at 20:59)</a>:</h4>
<p>Yeah, sounds like what I remember when it was last hit.</p>



<hr><p>Last updated: Nov 01 2025 at 12:13 UTC</p>
</html>