<html>
<head><meta charset="utf-8"><title>Debugging bitcode? · beginners · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/index.html">beginners</a></h2>
<h3>Topic: <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Debugging.20bitcode.3F.html">Debugging bitcode?</a></h3>

<hr>

<base href="https://roc.zulipchat.com">

<head><link href="https://roc-lang.github.io/zulip-export/style.css" rel="stylesheet"></head>

<a name="289328190"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Debugging%20bitcode%3F/near/289328190" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Qqwy / Marten <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Debugging.20bitcode.3F.html#289328190">(Jul 12 2022 at 14:03)</a>:</h4>
<p>I'm trying to add some debug printing to the <code>List.appendUnsafe</code> builtin. If my understanding is correct, this should be done in the Zig code in <code>compiler/builtins/bitcode/src/list.zig</code>.</p>
<p>Adding a simple <code>std.debug.print("appendUnsafe called!", .{})</code> does not work. Compilation fails with the error</p>
<div class="codehilite"><pre><span></span><code>&#39;zig failed: /home/qqwy/.asdf/installs/zig/0.9.1/lib/std/os.zig:134:24: error: container &#39;std.os.system&#39; has no member called &#39;fd_t&#39;
  pub const fd_t = system.fd_t;
</code></pre></div>



<a name="289328271"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Debugging%20bitcode%3F/near/289328271" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Qqwy / Marten <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Debugging.20bitcode.3F.html#289328271">(Jul 12 2022 at 14:04)</a>:</h4>
<p>This looks like this code is being compiled in some kind of 'no std'-like kind of mode.</p>



<a name="289328462"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Debugging%20bitcode%3F/near/289328462" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Qqwy / Marten <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Debugging.20bitcode.3F.html#289328462">(Jul 12 2022 at 14:04)</a>:</h4>
<p>What is the proper way to do this?</p>



<a name="289328611"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Debugging%20bitcode%3F/near/289328611" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ayaz Hafiz <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Debugging.20bitcode.3F.html#289328611">(Jul 12 2022 at 14:05)</a>:</h4>
<p>you need to turn on DEBUG mode in builtins/build.rs</p>



<a name="289328657"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Debugging%20bitcode%3F/near/289328657" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ayaz Hafiz <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Debugging.20bitcode.3F.html#289328657">(Jul 12 2022 at 14:05)</a>:</h4>
<p>it's because WASM doesn't have that type</p>



<a name="289328766"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Debugging%20bitcode%3F/near/289328766" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Qqwy / Marten <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Debugging.20bitcode.3F.html#289328766">(Jul 12 2022 at 14:06)</a>:</h4>
<p>Ah, so switching that flag to true essentially disables WASM?</p>



<a name="289328824"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Debugging%20bitcode%3F/near/289328824" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ayaz Hafiz <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Debugging.20bitcode.3F.html#289328824">(Jul 12 2022 at 14:06)</a>:</h4>
<p>it disables the wasm backend builtins but do you need that for your debugging?</p>



<a name="289328852"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Debugging%20bitcode%3F/near/289328852" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Qqwy / Marten <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Debugging.20bitcode.3F.html#289328852">(Jul 12 2022 at 14:07)</a>:</h4>
<p>Nope! Just trying to understand how it works. Thanks <span aria-label="+1" class="emoji emoji-1f44d" role="img" title="+1">:+1:</span></p>



<a name="289331956"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Debugging%20bitcode%3F/near/289331956" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Qqwy / Marten <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Debugging.20bitcode.3F.html#289331956">(Jul 12 2022 at 14:27)</a>:</h4>
<p>Hmm. Using <code>std.debug.print</code> results in an immediate segfault on app startup.<br>
Using <code>std.os.write</code> works, but there is no way to format numbers.</p>



<a name="289332058"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Debugging%20bitcode%3F/near/289332058" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ayaz Hafiz <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Debugging.20bitcode.3F.html#289332058">(Jul 12 2022 at 14:28)</a>:</h4>
<p>what are you running over? do you have a branch?</p>



<a name="289336461"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Debugging%20bitcode%3F/near/289336461" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Qqwy / Marten <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Debugging.20bitcode.3F.html#289336461">(Jul 12 2022 at 14:56)</a>:</h4>
<p>Publishing the branch now</p>



<a name="289337797"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Debugging%20bitcode%3F/near/289337797" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Qqwy / Marten <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Debugging.20bitcode.3F.html#289337797">(Jul 12 2022 at 15:04)</a>:</h4>
<p><a href="https://github.com/rtfeldman/roc/issues/3494">https://github.com/rtfeldman/roc/issues/3494</a></p>



<a name="289338550"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Debugging%20bitcode%3F/near/289338550" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ayaz Hafiz <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Debugging.20bitcode.3F.html#289338550">(Jul 12 2022 at 15:09)</a>:</h4>
<p>how do you repro the segfault? is it only with the debug.print?</p>



<a name="289338903"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Debugging%20bitcode%3F/near/289338903" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Debugging.20bitcode.3F.html#289338903">(Jul 12 2022 at 15:10)</a>:</h4>
<p><span class="user-mention" data-user-id="454654">@Ayaz Hafiz</span> Marten noted earlier that there is almost no debug info in the final binary. That used to work  with debugir, I believe it worked with llvm13 too. Any idea what might have changed recently? (or am I misremenbering hand and has this not worked for a long time)</p>



<a name="289339407"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Debugging%20bitcode%3F/near/289339407" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Debugging.20bitcode.3F.html#289339407">(Jul 12 2022 at 15:14)</a>:</h4>
<p>Surgical linking? It is default now and doesn't handle debug info</p>



<a name="289339552"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Debugging%20bitcode%3F/near/289339552" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Debugging.20bitcode.3F.html#289339552">(Jul 12 2022 at 15:14)</a>:</h4>
<p>ah, that might be it</p>



<a name="289339570"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Debugging%20bitcode%3F/near/289339570" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Debugging.20bitcode.3F.html#289339570">(Jul 12 2022 at 15:14)</a>:</h4>
<p>good to know</p>



<a name="289339600"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Debugging%20bitcode%3F/near/289339600" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Qqwy / Marten <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Debugging.20bitcode.3F.html#289339600">(Jul 12 2022 at 15:14)</a>:</h4>
<p>Yep! That is the reason! I have line numbers now <span aria-label="heart eyes" class="emoji emoji-1f60d" role="img" title="heart eyes">:heart_eyes:</span></p>



<a name="289339840"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Debugging%20bitcode%3F/near/289339840" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Debugging.20bitcode.3F.html#289339840">(Jul 12 2022 at 15:16)</a>:</h4>
<p>Yeah, eventually need to look into linking dwarf debug info.</p>



<a name="289340290"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Debugging%20bitcode%3F/near/289340290" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ayaz Hafiz <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Debugging.20bitcode.3F.html#289340290">(Jul 12 2022 at 15:19)</a>:</h4>
<p>debugir shouldn't be touching debug symbols from the zig builtins anyway I think, it only aids in debugging the generated LLVM</p>



<a name="289340645"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Debugging%20bitcode%3F/near/289340645" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Qqwy / Marten <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Debugging.20bitcode.3F.html#289340645">(Jul 12 2022 at 15:21)</a>:</h4>
<p>Seems like there is a double free of a refcounted object (which manifests as invalid read of the refcount -&gt; invalid write of the refcount-&gt; invalid free).</p>



<a name="289340797"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Debugging%20bitcode%3F/near/289340797" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ayaz Hafiz <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Debugging.20bitcode.3F.html#289340797">(Jul 12 2022 at 15:22)</a>:</h4>
<p>is there a free of the address before the first read?</p>



<a name="289341038"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Debugging%20bitcode%3F/near/289341038" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Qqwy / Marten <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Debugging.20bitcode.3F.html#289341038">(Jul 12 2022 at 15:24)</a>:</h4>
<p>There is</p>



<a name="289341089"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Debugging%20bitcode%3F/near/289341089" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Qqwy / Marten <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Debugging.20bitcode.3F.html#289341089">(Jul 12 2022 at 15:24)</a>:</h4>
<p>Interestingly memory is also leaked, depending on how long the input is to this example</p>



<a name="289341279"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Debugging%20bitcode%3F/near/289341279" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Qqwy / Marten <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Debugging.20bitcode.3F.html#289341279">(Jul 12 2022 at 15:26)</a>:</h4>
<p>(Short inputs 'only' leak, inputs &gt; 23 characters result in the double-free)</p>



<a name="289341363"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Debugging%20bitcode%3F/near/289341363" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Qqwy / Marten <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Debugging.20bitcode.3F.html#289341363">(Jul 12 2022 at 15:26)</a>:</h4>
<p>Which makes me think that it might be related to the short string optimization</p>



<a name="289341398"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Debugging%20bitcode%3F/near/289341398" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ayaz Hafiz <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Debugging.20bitcode.3F.html#289341398">(Jul 12 2022 at 15:26)</a>:</h4>
<p>yes almost certainly</p>



<a name="289341401"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Debugging%20bitcode%3F/near/289341401" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Qqwy / Marten <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Debugging.20bitcode.3F.html#289341401">(Jul 12 2022 at 15:26)</a>:</h4>
<p>Even though 99% of the code manipulates <code>List U8</code></p>



<a name="289341458"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Debugging%20bitcode%3F/near/289341458" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Qqwy / Marten <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Debugging.20bitcode.3F.html#289341458">(Jul 12 2022 at 15:27)</a>:</h4>
<p>It is turned from a Str into a List U8 at the very beginning and turned back at the very end.</p>



<a name="289346210"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Debugging%20bitcode%3F/near/289346210" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Debugging.20bitcode.3F.html#289346210">(Jul 12 2022 at 15:57)</a>:</h4>
<p>hold up</p>



<a name="289346223"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Debugging%20bitcode%3F/near/289346223" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Debugging.20bitcode.3F.html#289346223">(Jul 12 2022 at 15:57)</a>:</h4>
<p>are you using the hello world platform?</p>



<a name="289346312"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Debugging%20bitcode%3F/near/289346312" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Debugging.20bitcode.3F.html#289346312">(Jul 12 2022 at 15:58)</a>:</h4>
<p>in that platform's source code, we have </p>
<div class="codehilite"><pre><span></span><code>  // Write to stdout
  if (write(1, str_bytes, str_len) &gt;= 0) {
    // Writing succeeded!

    // NOTE: the string is a static string, read from in the binary
    // if you make it a heap-allocated string, it&#39;ll be leaked here
    return 0;
  } else {
    printf(&quot;Error writing to stdout: %s\n&quot;, strerror(errno));

    // NOTE: the string is a static string, read from in the binary
    // if you make it a heap-allocated string, it&#39;ll be leaked here
    return 1;
  }
</code></pre></div>



<a name="289346369"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Debugging%20bitcode%3F/near/289346369" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Qqwy / Marten <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Debugging.20bitcode.3F.html#289346369">(Jul 12 2022 at 15:58)</a>:</h4>
<p>Ah!</p>



<a name="289346427"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Debugging%20bitcode%3F/near/289346427" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Qqwy / Marten <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Debugging.20bitcode.3F.html#289346427">(Jul 12 2022 at 15:58)</a>:</h4>
<p>That would explain the leaking</p>



<a name="289346474"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Debugging%20bitcode%3F/near/289346474" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Qqwy / Marten <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Debugging.20bitcode.3F.html#289346474">(Jul 12 2022 at 15:59)</a>:</h4>
<p>But not the memory corruption</p>



<a name="289346527"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Debugging%20bitcode%3F/near/289346527" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Debugging.20bitcode.3F.html#289346527">(Jul 12 2022 at 15:59)</a>:</h4>
<p>yeah, so what I usually do is use the <code>platform-switching</code> platform and pick the zig one there</p>



<a name="289346693"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Debugging%20bitcode%3F/near/289346693" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Qqwy / Marten <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Debugging.20bitcode.3F.html#289346693">(Jul 12 2022 at 16:00)</a>:</h4>
<p>The sole reason I'm using <code>hello-world</code> while developing the parser rather than <code>cli-platform</code> is that that one currently does not compile <span aria-label="sweat" class="emoji emoji-1f613" role="img" title="sweat">:sweat:</span></p>



<a name="289346710"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Debugging%20bitcode%3F/near/289346710" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Qqwy / Marten <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Debugging.20bitcode.3F.html#289346710">(Jul 12 2022 at 16:00)</a>:</h4>
<p>I'll try to use the zig one <span aria-label="+1" class="emoji emoji-1f44d" role="img" title="+1">:+1:</span></p>



<a name="289346728"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Debugging%20bitcode%3F/near/289346728" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Qqwy / Marten <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Debugging.20bitcode.3F.html#289346728">(Jul 12 2022 at 16:00)</a>:</h4>
<p>But I have to leave for a couple of hours first</p>



<a name="289346985"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Debugging%20bitcode%3F/near/289346985" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Debugging.20bitcode.3F.html#289346985">(Jul 12 2022 at 16:01)</a>:</h4>
<p>that platform also has a convenient <code>const DEBUG: bool = false;</code></p>



<a name="289347979"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Debugging%20bitcode%3F/near/289347979" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anton <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Debugging.20bitcode.3F.html#289347979">(Jul 12 2022 at 16:09)</a>:</h4>
<p>Can you make an issue for the cli-platform <span class="user-mention" data-user-id="508003">@Qqwy / Marten</span>?</p>



<a name="289351041"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Debugging%20bitcode%3F/near/289351041" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Debugging.20bitcode.3F.html#289351041">(Jul 12 2022 at 16:30)</a>:</h4>
<p>I got it down to</p>
<div class="codehilite"><pre><span></span><code>main =
    when manyImpl [48u8] [] is
        _ -&gt; &quot;done&quot;

manyImpl = \input, vals -&gt;
    { before: start, others: inputRest } = List.split input 1

    when List.get start 0 is
        Err _ -&gt;
            Ok { val: vals, input: input }
        Ok _startCodepoint -&gt;
            manyImpl inputRest []
</code></pre></div>



<a name="289351077"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Debugging%20bitcode%3F/near/289351077" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Debugging.20bitcode.3F.html#289351077">(Jul 12 2022 at 16:31)</a>:</h4>
<p>the allocation of <code>[48u8]</code> does not get freed, really not sure why</p>



<a name="289351086"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Debugging%20bitcode%3F/near/289351086" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Debugging.20bitcode.3F.html#289351086">(Jul 12 2022 at 16:31)</a>:</h4>
<p>RC just loses track of it</p>



<a name="289351100"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Debugging%20bitcode%3F/near/289351100" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Debugging.20bitcode.3F.html#289351100">(Jul 12 2022 at 16:31)</a>:</h4>
<p>no decrement for it is emitted</p>



<a name="289352992"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Debugging%20bitcode%3F/near/289352992" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Qqwy / Marten <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Debugging.20bitcode.3F.html#289352992">(Jul 12 2022 at 16:45)</a>:</h4>
<p><span class="user-mention silent" data-user-id="361169">Anton</span> <a href="#narrow/stream/231634-beginners/topic/Debugging.20bitcode.3F/near/289347979">said</a>:</p>
<blockquote>
<p>Can you make an issue for the cli-platform <span class="user-mention silent" data-user-id="508003">Qqwy / Marten</span>?</p>
</blockquote>
<p>It was this one: <a href="https://github.com/rtfeldman/roc/issues/3438">https://github.com/rtfeldman/roc/issues/3438</a></p>



<a name="289353206"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Debugging%20bitcode%3F/near/289353206" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Qqwy / Marten <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Debugging.20bitcode.3F.html#289353206">(Jul 12 2022 at 16:46)</a>:</h4>
<p><span class="user-mention silent" data-user-id="281543">Folkert de Vries</span> <a href="#narrow/stream/231634-beginners/topic/Debugging.20bitcode.3F/near/289351100">said</a>:</p>
<blockquote>
<p>no decrement for it is emitted</p>
</blockquote>
<p>Really odd that the opposite (double free) happens for large inputs.</p>



<a name="289353767"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Debugging%20bitcode%3F/near/289353767" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Debugging.20bitcode.3F.html#289353767">(Jul 12 2022 at 16:51)</a>:</h4>
<p>often the one snowballs into the other</p>



<a name="289353776"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Debugging%20bitcode%3F/near/289353776" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Debugging.20bitcode.3F.html#289353776">(Jul 12 2022 at 16:51)</a>:</h4>
<p>it just means RC is wrong and then all bets are off</p>



<a name="289355616"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Debugging%20bitcode%3F/near/289355616" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Debugging.20bitcode.3F.html#289355616">(Jul 12 2022 at 17:05)</a>:</h4>
<p>got it</p>



<a name="289355704"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Debugging%20bitcode%3F/near/289355704" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Debugging.20bitcode.3F.html#289355704">(Jul 12 2022 at 17:06)</a>:</h4>
<p>when the slice we end up making is empty, the logic is wrong</p>



<a name="289355883"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Debugging%20bitcode%3F/near/289355883" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Debugging.20bitcode.3F.html#289355883">(Jul 12 2022 at 17:07)</a>:</h4>
<p>just need to turn <code>sublist</code> into</p>
<div class="codehilite"><pre><span></span><code>sublist : List elem, { start : Nat, len : Nat } -&gt; List elem
sublist = \list, config -&gt;
    if config.len == 0 then
        []
    else
        sublistLowlevel list config.start config.len
</code></pre></div>
<p>in <code>List.roc</code></p>



<a name="289371474"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Debugging%20bitcode%3F/near/289371474" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Qqwy / Marten <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Debugging.20bitcode.3F.html#289371474">(Jul 12 2022 at 19:06)</a>:</h4>
<p>Even with this fix in place, the larger example still fails with a use-after-free <span aria-label="sad" class="emoji emoji-2639" role="img" title="sad">:sad:</span></p>



<a name="289371590"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Debugging%20bitcode%3F/near/289371590" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Debugging.20bitcode.3F.html#289371590">(Jul 12 2022 at 19:07)</a>:</h4>
<p>can you minimize the example again?</p>



<a name="289378752"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Debugging%20bitcode%3F/near/289378752" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Qqwy / Marten <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Debugging.20bitcode.3F.html#289378752">(Jul 12 2022 at 20:07)</a>:</h4>
<p>I'm not sure; when I tried minimizing it further before, Roc no longer used refcounting and then the problem disappears</p>



<a name="289378859"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Debugging%20bitcode%3F/near/289378859" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Debugging.20bitcode.3F.html#289378859">(Jul 12 2022 at 20:08)</a>:</h4>
<p>so long as you use lists it should just be using RC</p>



<a name="289381811"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Debugging%20bitcode%3F/near/289381811" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Qqwy / Marten <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Debugging.20bitcode.3F.html#289381811">(Jul 12 2022 at 20:35)</a>:</h4>
<p>I managed to make the example shorter</p>



<a name="289381830"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Debugging%20bitcode%3F/near/289381830" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Qqwy / Marten <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Debugging.20bitcode.3F.html#289381830">(Jul 12 2022 at 20:35)</a>:</h4>
<div class="codehilite"><pre><span></span><code># Use after free. List has 24 elems.
# Making list 1 elem shorter resolves problem (short string optimization?)
main =
    [65u8,65u8,65u8,65u8,65u8,65u8,65u8,65u8,65u8,65u8,65u8,65u8,65u8,65u8,65u8,65u8,65u8,65u8,65u8,65u8,65u8,65u8,65u8,65u8,]
    |&gt; Str.fromUtf8
    |&gt; Result.withDefault &quot;(not used)&quot;
</code></pre></div>
<p>This breaks also in the REPL</p>



<a name="289381849"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Debugging%20bitcode%3F/near/289381849" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Qqwy / Marten <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Debugging.20bitcode.3F.html#289381849">(Jul 12 2022 at 20:35)</a>:</h4>
<p>And obviously also with Valgrind</p>



<a name="289381898"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Debugging%20bitcode%3F/near/289381898" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Qqwy / Marten <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Debugging.20bitcode.3F.html#289381898">(Jul 12 2022 at 20:35)</a>:</h4>
<p>I think that <code>Str.fromUtf8</code> encounters a problem iff the resulting string is 'big'</p>



<a name="289381969"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Debugging%20bitcode%3F/near/289381969" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Qqwy / Marten <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Debugging.20bitcode.3F.html#289381969">(Jul 12 2022 at 20:36)</a>:</h4>
<p>In the REPL, the output becomes <code>"%v����AAAAAAAAAAAAAAAA" : Str</code>. (Deterministic because of WASM?)</p>



<a name="289382105"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Debugging%20bitcode%3F/near/289382105" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Qqwy / Marten <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Debugging.20bitcode.3F.html#289382105">(Jul 12 2022 at 20:37)</a>:</h4>
<p>And running the binary outside of valgrind gives arbitrary output for the first 8 characters of the 'hello world' example.</p>



<a name="289383489"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Debugging%20bitcode%3F/near/289383489" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Debugging.20bitcode.3F.html#289383489">(Jul 12 2022 at 20:49)</a>:</h4>
<p>got that one too, now there is just a memory leak that remains</p>



<a name="289383529"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Debugging%20bitcode%3F/near/289383529" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Qqwy / Marten <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Debugging.20bitcode.3F.html#289383529">(Jul 12 2022 at 20:49)</a>:</h4>
<p>Wait you already fixed this one somehow?</p>



<a name="289383536"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Debugging%20bitcode%3F/near/289383536" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Debugging.20bitcode.3F.html#289383536">(Jul 12 2022 at 20:49)</a>:</h4>
<p>for the small string cases</p>



<a name="289383549"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Debugging%20bitcode%3F/near/289383549" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Qqwy / Marten <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Debugging.20bitcode.3F.html#289383549">(Jul 12 2022 at 20:50)</a>:</h4>
<p>Do I need to update the current branch with trunk or something?</p>



<a name="289383599"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Debugging%20bitcode%3F/near/289383599" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Debugging.20bitcode.3F.html#289383599">(Jul 12 2022 at 20:50)</a>:</h4>
<p>yeah it's an RC thing where you flip a bool and it works</p>



<a name="289383608"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Debugging%20bitcode%3F/near/289383608" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Debugging.20bitcode.3F.html#289383608">(Jul 12 2022 at 20:50)</a>:</h4>
<p>oh, it's not on trunk</p>



<a name="289383613"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Debugging%20bitcode%3F/near/289383613" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Debugging.20bitcode.3F.html#289383613">(Jul 12 2022 at 20:50)</a>:</h4>
<p>just locally</p>



<a name="289383659"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Debugging%20bitcode%3F/near/289383659" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Debugging.20bitcode.3F.html#289383659">(Jul 12 2022 at 20:50)</a>:</h4>
<p>I can make a branch, then you can cherry-pick to get unblocked</p>



<a name="289383669"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Debugging%20bitcode%3F/near/289383669" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Qqwy / Marten <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Debugging.20bitcode.3F.html#289383669">(Jul 12 2022 at 20:50)</a>:</h4>
<p><span aria-label="+1" class="emoji emoji-1f44d" role="img" title="+1">:+1:</span></p>



<a name="289384169"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Debugging%20bitcode%3F/near/289384169" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Debugging.20bitcode.3F.html#289384169">(Jul 12 2022 at 20:55)</a>:</h4>
<p>see the <code>string-memory-problems</code> branch</p>



<a name="289384230"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Debugging%20bitcode%3F/near/289384230" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Debugging.20bitcode.3F.html#289384230">(Jul 12 2022 at 20:55)</a>:</h4>
<p>eww that has a build error,</p>



<a name="289384518"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Debugging%20bitcode%3F/near/289384518" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Debugging.20bitcode.3F.html#289384518">(Jul 12 2022 at 20:58)</a>:</h4>
<p>allright, all good. The example from the issue now compiles without valgrind errors</p>



<a name="289385121"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Debugging%20bitcode%3F/near/289385121" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Qqwy / Marten <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Debugging.20bitcode.3F.html#289385121">(Jul 12 2022 at 21:03)</a>:</h4>
<p>OK, <span aria-label="cherries" class="emoji emoji-1f352" role="img" title="cherries">:cherries:</span> <span aria-label="ok" class="emoji emoji-1f44c" role="img" title="ok">:ok:</span>  time</p>



<a name="289385249"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Debugging%20bitcode%3F/near/289385249" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Qqwy / Marten <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Debugging.20bitcode.3F.html#289385249">(Jul 12 2022 at 21:04)</a>:</h4>
<p>Your fix resolves the problem. I only see the one leak from the hello-world platform now</p>



<a name="289385260"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Debugging%20bitcode%3F/near/289385260" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Carroll <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Debugging.20bitcode.3F.html#289385260">(Jul 12 2022 at 21:04)</a>:</h4>
<p><span class="user-mention silent" data-user-id="508003">Qqwy / Marten</span> <a href="#narrow/stream/231634-beginners/topic/Debugging.20bitcode.3F/near/289381969">said</a>:</p>
<blockquote>
<p>In the REPL, the output becomes <code>"%v����AAAAAAAAAAAAAAAA" : Str</code>. (Deterministic because of WASM?)</p>
</blockquote>
<p>If you mean the web REPL, which runs in Wasm, then be aware that on a 32-bit platform, short strings are &lt;=11 bytes rather than &lt;=23</p>



<a name="289385319"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Debugging%20bitcode%3F/near/289385319" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Carroll <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Debugging.20bitcode.3F.html#289385319">(Jul 12 2022 at 21:04)</a>:</h4>
<p>Not sure if that affects your conclusions or not</p>



<a name="289385566"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Debugging%20bitcode%3F/near/289385566" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Qqwy / Marten <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Debugging.20bitcode.3F.html#289385566">(Jul 12 2022 at 21:06)</a>:</h4>
<p>No, I meant the command-line <code>roc repl</code></p>



<a name="289385636"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Debugging%20bitcode%3F/near/289385636" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Qqwy / Marten <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Debugging.20bitcode.3F.html#289385636">(Jul 12 2022 at 21:07)</a>:</h4>
<p>Does that one use WASM or LLVM?</p>



<a name="289385653"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Debugging%20bitcode%3F/near/289385653" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Carroll <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Debugging.20bitcode.3F.html#289385653">(Jul 12 2022 at 21:07)</a>:</h4>
<p>LLVM</p>



<a name="289386772"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Debugging%20bitcode%3F/near/289386772" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Debugging.20bitcode.3F.html#289386772">(Jul 12 2022 at 21:17)</a>:</h4>
<p>though given the speed of our wasm backend  now, using wasm there might not be a bad idea</p>



<a name="289386790"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Debugging%20bitcode%3F/near/289386790" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Debugging.20bitcode.3F.html#289386790">(Jul 12 2022 at 21:17)</a>:</h4>
<p>eventually we'd go for just assembly I think, but that backend is fairly immature</p>



<hr><p>Last updated: Mar 01 2026 at 12:20 UTC</p>
</html>