<html>
<head><meta charset="utf-8"><title>&quot;expect&quot; feature ¬∑ beginners ¬∑ Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/index.html">beginners</a></h2>
<h3>Topic: <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/.22expect.22.20feature.html">&quot;expect&quot; feature</a></h3>

<hr>

<base href="https://roc.zulipchat.com">

<head><link href="https://roc-lang.github.io/zulip-export/style.css" rel="stylesheet"></head>

<a name="308769130"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/%22expect%22%20feature/near/308769130" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ghislain <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/.22expect.22.20feature.html#308769130">(Nov 09 2022 at 11:43)</a>:</h4>
<p>Hi,<br>
I would like to know the current expectations I can have with <code>expect</code>, or if I'm using it in a wrong way. My current observations are:</p>
<ol>
<li>It doesn't work inside functions</li>
<li>It works outside functions but prints a different message if the variable is declared inside or outside of the <code>expect</code> scope.<br>
<a href="/user_uploads/22008/-_WR431tGHo-eOczYP1Iv36_/Screenshot-2022-11-09-at-12.40.12.png">Screenshot-2022-11-09-at-12.40.12.png</a><div class="message_inline_image"><a href="/user_uploads/22008/-_WR431tGHo-eOczYP1Iv36_/Screenshot-2022-11-09-at-12.40.12.png" title="Screenshot-2022-11-09-at-12.40.12.png"><img src="/user_uploads/22008/-_WR431tGHo-eOczYP1Iv36_/Screenshot-2022-11-09-at-12.40.12.png"></a></div></li>
</ol>



<a name="308769982"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/%22expect%22%20feature/near/308769982" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/.22expect.22.20feature.html#308769982">(Nov 09 2022 at 11:49)</a>:</h4>
<p>it should work inside functions too when you use <code>roc dev file.roc</code> with a recent build of the compiler</p>



<a name="308770078"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/%22expect%22%20feature/near/308770078" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/.22expect.22.20feature.html#308770078">(Nov 09 2022 at 11:50)</a>:</h4>
<p>assuming the <code>expect</code> is reached from <code>main</code></p>



<a name="308770905"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/%22expect%22%20feature/near/308770905" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anton <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/.22expect.22.20feature.html#308770905">(Nov 09 2022 at 11:55)</a>:</h4>
<p>I just uploaded the latest nightlies (except for macos x86_64) so those should be good</p>



<a name="308772163"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/%22expect%22%20feature/near/308772163" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ghislain <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/.22expect.22.20feature.html#308772163">(Nov 09 2022 at 12:03)</a>:</h4>
<p>I built today from the source, to be sure I tested with your nightlies <span class="user-mention" data-user-id="361169">@Anton</span> but I get the same output</p>



<a name="308772857"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/%22expect%22%20feature/near/308772857" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/.22expect.22.20feature.html#308772857">(Nov 09 2022 at 12:07)</a>:</h4>
<p>well yeah so regarding what is shown: your observations are roughly correct. We look at what values are captured by the expect. other top-level values are constants, so they are not considered to be captured. So maybe we should tweak that slightly</p>



<a name="308773243"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/%22expect%22%20feature/near/308773243" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/.22expect.22.20feature.html#308773243">(Nov 09 2022 at 12:10)</a>:</h4>
<p>inline expects do work right? This is with latest main</p>
<div class="codehilite"><pre><span></span><code>main =
    expect 1 == 2
    &quot;Roc &lt;3 Zig!\n&quot;
</code></pre></div>
<p>gives </p>
<div class="codehilite"><pre><span></span><code>&gt; cargo run -- dev examples/platform-switching/rocLovesZig.roc
    Finished dev [unoptimized + debuginfo] target(s) in 0.25s
     Running `target/debug/roc dev examples/platform-switching/rocLovesZig.roc`
üî® Rebuilding platform...
Roc &lt;3 Zig!
runtime: 0.057ms
‚îÄ‚îÄ EXPECT FAILED ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ examples/platform-switching/rocLovesZig.roc ‚îÄ

This expectation failed:

7‚îÇ      expect 1 == 2
               ^^^^^^‚èé
</code></pre></div>



<a name="308774161"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/%22expect%22%20feature/near/308774161" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ghislain <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/.22expect.22.20feature.html#308774161">(Nov 09 2022 at 12:16)</a>:</h4>
<p>Ok, there is something weird on my Mac, I did exactly the same and I don't get the <code>EXPECT FAILED</code>:</p>
<div class="codehilite" data-code-language="Bash"><pre><span></span><code>$ cat examples/platform-switching/rocLovesZig.roc
app <span class="s2">"rocLovesZig"</span>
    packages <span class="o">{</span> pf: <span class="s2">"zig-platform/main.roc"</span> <span class="o">}</span>
    imports <span class="o">[]</span>
    provides <span class="o">[</span>main<span class="o">]</span> to pf

<span class="nv">main</span> <span class="o">=</span>
    expect <span class="nv">1</span> <span class="o">==</span> <span class="m">2</span>
    <span class="s2">"Roc &lt;3 Zig!\n"</span>
$ cargo run -- dev examples/platform-switching/rocLovesZig.roc
    Finished dev <span class="o">[</span>unoptimized + debuginfo<span class="o">]</span> target<span class="o">(</span>s<span class="o">)</span> <span class="k">in</span> <span class="m">0</span>.17s
     Running <span class="sb">`</span>target/debug/roc dev examples/platform-switching/rocLovesZig.roc<span class="sb">`</span>
üî® Rebuilding platform...
Roc &lt;<span class="m">3</span> Zig!
runtime: <span class="m">0</span>.075ms
$
</code></pre></div>



<a name="308776543"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/%22expect%22%20feature/near/308776543" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/.22expect.22.20feature.html#308776543">(Nov 09 2022 at 12:31)</a>:</h4>
<p>interesting! we'll have to debug that then. On linux it does work, so there must be some subtle difference again that makes it fail on mac</p>



<a name="308776628"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/%22expect%22%20feature/near/308776628" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/.22expect.22.20feature.html#308776628">(Nov 09 2022 at 12:32)</a>:</h4>
<p><span class="user-mention" data-user-id="454654">@Ayaz Hafiz</span> it did work on mac at some point right?</p>



<a name="308776745"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/%22expect%22%20feature/near/308776745" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/.22expect.22.20feature.html#308776745">(Nov 09 2022 at 12:33)</a>:</h4>
<p>maybe it's a good idea to <code>strace</code> (does that work on mac?) the process to see what syscalls actually happen</p>



<a name="308791503"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/%22expect%22%20feature/near/308791503" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ayaz Hafiz <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/.22expect.22.20feature.html#308791503">(Nov 09 2022 at 13:54)</a>:</h4>
<p>fwiw I never got inline expects to work on the M1 I use</p>



<a name="308791674"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/%22expect%22%20feature/near/308791674" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ayaz Hafiz <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/.22expect.22.20feature.html#308791674">(Nov 09 2022 at 13:55)</a>:</h4>
<p>I see no execution at all as of e589dc88a3dfc2d5bc14aac1c7d319d716bece0a</p>
<div class="codehilite"><pre><span></span><code>app &quot;rocLovesC&quot;
    packages { pf: &quot;c-platform/main.roc&quot; }
    imports []
    provides [main] to pf

main =
    expect 1 == 2
    &quot;Roc &lt;3 C!\n&quot;
</code></pre></div>
<div class="codehilite"><pre><span></span><code>‚ùØ target/debug/roc dev examples/platform-switching/rocLovesC.roc
üî® Rebuilding platform...
</code></pre></div>



<a name="308792265"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/%22expect%22%20feature/near/308792265" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ayaz Hafiz <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/.22expect.22.20feature.html#308792265">(Nov 09 2022 at 13:58)</a>:</h4>
<p>what syscalls do you need to trace? <code>strace</code> isn't a thing on Mac, the two other options (dtruss and Instruments) have only ever hung and sigsegv'd for me over roc binaries</p>



<a name="308792517"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/%22expect%22%20feature/near/308792517" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/.22expect.22.20feature.html#308792517">(Nov 09 2022 at 13:59)</a>:</h4>
<p>ah, ok</p>



<a name="308792635"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/%22expect%22%20feature/near/308792635" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/.22expect.22.20feature.html#308792635">(Nov 09 2022 at 14:00)</a>:</h4>
<p>well, I'm assuming that the expect does fail, but the parent process just gets an empty buffer and hence prints nothing</p>



<a name="308805746"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/%22expect%22%20feature/near/308805746" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ayaz Hafiz <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/.22expect.22.20feature.html#308805746">(Nov 09 2022 at 15:01)</a>:</h4>
<p>we can check what bytes expect is seeing before doing the printing. I can take a look later if you'd like</p>



<a name="308806679"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/%22expect%22%20feature/near/308806679" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/.22expect.22.20feature.html#308806679">(Nov 09 2022 at 15:05)</a>:</h4>
<p>I'll look at it with Richard too later today if you don't get to it before then</p>



<a name="308883107"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/%22expect%22%20feature/near/308883107" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/.22expect.22.20feature.html#308883107">(Nov 09 2022 at 22:07)</a>:</h4>
<p><span class="user-mention" data-user-id="454654">@Ayaz Hafiz</span> we didn't get to this, so if you can do some troubleshooting that would be great</p>



<a name="308884916"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/%22expect%22%20feature/near/308884916" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ayaz Hafiz <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/.22expect.22.20feature.html#308884916">(Nov 09 2022 at 22:18)</a>:</h4>
<p>understood</p>



<hr><p>Last updated: Nov 01 2025 at 12:13 UTC</p>
</html>