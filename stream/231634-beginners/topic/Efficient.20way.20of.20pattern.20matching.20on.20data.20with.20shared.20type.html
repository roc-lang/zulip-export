<html>
<head><meta charset="utf-8"><title>Efficient way of pattern matching on data with shared type · beginners · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/index.html">beginners</a></h2>
<h3>Topic: <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Efficient.20way.20of.20pattern.20matching.20on.20data.20with.20shared.20type.html">Efficient way of pattern matching on data with shared type</a></h3>

<hr>

<base href="https://roc.zulipchat.com">

<head><link href="https://roc-lang.github.io/zulip-export/style.css" rel="stylesheet"></head>

<a name="419780375"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Efficient%20way%20of%20pattern%20matching%20on%20data%20with%20shared%20type/near/419780375" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eli Dowling <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Efficient.20way.20of.20pattern.20matching.20on.20data.20with.20shared.20type.html#419780375">(Feb 05 2024 at 07:50)</a>:</h4>
<p>I'm wondering if there is some better way to match on these? i feel like it should be possible  using an or patttern or somesuch.</p>
<div class="codehilite" data-code-language="Elm"><pre><span></span><code><span class="kt">LList</span><span class="w"> </span><span class="nv">a</span><span class="w"> </span><span class="nf">:=</span><span class="w"> </span><span class="p">[</span><span class="kt">Node</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nv">data</span><span class="w"> </span><span class="nf">:</span><span class="w"> </span><span class="nv">a</span><span class="p">,</span><span class="w"> </span><span class="nv">next</span><span class="w"> </span><span class="nf">:</span><span class="w"> </span><span class="kt">LList</span><span class="w"> </span><span class="nv">a</span><span class="p">,</span><span class="w"> </span><span class="nv">prev</span><span class="w"> </span><span class="nf">:</span><span class="w"> </span><span class="kt">LList</span><span class="w"> </span><span class="nv">a</span><span class="w"> </span><span class="p">},</span><span class="w"> </span><span class="kt">First</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nv">data</span><span class="w"> </span><span class="nf">:</span><span class="w"> </span><span class="nv">a</span><span class="p">,</span><span class="w"> </span><span class="nv">next</span><span class="w"> </span><span class="nf">:</span><span class="w"> </span><span class="kt">LList</span><span class="w"> </span><span class="nv">a</span><span class="w"> </span><span class="p">},</span><span class="w"> </span><span class="kt">Last</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nv">data</span><span class="w"> </span><span class="nf">:</span><span class="w"> </span><span class="nv">a</span><span class="p">,</span><span class="w"> </span><span class="nv">prev</span><span class="w"> </span><span class="nf">:</span><span class="w"> </span><span class="kt">LList</span><span class="w"> </span><span class="nv">a</span><span class="w"> </span><span class="p">}]</span>
<span class="nv">value</span><span class="w"> </span><span class="nf">=</span><span class="w"> </span><span class="nf">\</span><span class="err">@</span><span class="kt">LList</span><span class="w"> </span><span class="nv">list</span><span class="w"> </span><span class="nf">-&gt;</span>
<span class="w">    </span><span class="nv">when</span><span class="w"> </span><span class="nv">list</span><span class="w"> </span><span class="nv">is</span>
<span class="w">        </span><span class="kt">Node</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nv">data</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="nf">-&gt;</span><span class="w"> </span><span class="nv">data</span>
<span class="w">        </span><span class="kt">Last</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nv">data</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="nf">-&gt;</span><span class="w"> </span><span class="nv">data</span>
<span class="w">        </span><span class="kt">First</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nv">data</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="nf">-&gt;</span><span class="w"> </span><span class="nv">data</span>
</code></pre></div>



<a name="419782479"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Efficient%20way%20of%20pattern%20matching%20on%20data%20with%20shared%20type/near/419782479" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Efficient.20way.20of.20pattern.20matching.20on.20data.20with.20shared.20type.html#419782479">(Feb 05 2024 at 08:06)</a>:</h4>
<p>Looks good to me.</p>



<a name="419810969"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Efficient%20way%20of%20pattern%20matching%20on%20data%20with%20shared%20type/near/419810969" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Efficient.20way.20of.20pattern.20matching.20on.20data.20with.20shared.20type.html#419810969">(Feb 05 2024 at 10:54)</a>:</h4>
<p>you can do <code>Node { data } | Last { data } | First { data } -&gt; data</code> as a single branch</p>



<a name="419811061"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Efficient%20way%20of%20pattern%20matching%20on%20data%20with%20shared%20type/near/419811061" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Efficient.20way.20of.20pattern.20matching.20on.20data.20with.20shared.20type.html#419811061">(Feb 05 2024 at 10:55)</a>:</h4>
<p>has no impact on runtime performance but you might like it better in terms of style</p>



<a name="419811271"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Efficient%20way%20of%20pattern%20matching%20on%20data%20with%20shared%20type/near/419811271" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eli Dowling <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Efficient.20way.20of.20pattern.20matching.20on.20data.20with.20shared.20type.html#419811271">(Feb 05 2024 at 10:56)</a>:</h4>
<p>I tried that because I thought it should work and it actually gave me a compile error complaining about shadowing.</p>



<a name="419811312"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Efficient%20way%20of%20pattern%20matching%20on%20data%20with%20shared%20type/near/419811312" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eli Dowling <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Efficient.20way.20of.20pattern.20matching.20on.20data.20with.20shared.20type.html#419811312">(Feb 05 2024 at 10:56)</a>:</h4>
<p>And yes, I wasn't looking for fast performance just a cleaner representation</p>



<a name="419813024"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Efficient%20way%20of%20pattern%20matching%20on%20data%20with%20shared%20type/near/419813024" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Efficient.20way.20of.20pattern.20matching.20on.20data.20with.20shared.20type.html#419813024">(Feb 05 2024 at 11:05)</a>:</h4>
<p>in this case <code>Node r | Last r | First r -&gt; r.data</code> might work?</p>



<a name="419813073"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Efficient%20way%20of%20pattern%20matching%20on%20data%20with%20shared%20type/near/419813073" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Efficient.20way.20of.20pattern.20matching.20on.20data.20with.20shared.20type.html#419813073">(Feb 05 2024 at 11:05)</a>:</h4>
<p>shadowing is weird here, I would consider that a bug</p>



<a name="419813088"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Efficient%20way%20of%20pattern%20matching%20on%20data%20with%20shared%20type/near/419813088" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eli Dowling <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Efficient.20way.20of.20pattern.20matching.20on.20data.20with.20shared.20type.html#419813088">(Feb 05 2024 at 11:05)</a>:</h4>
<p>Haha, yup tried that too</p>



<a name="419813109"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Efficient%20way%20of%20pattern%20matching%20on%20data%20with%20shared%20type/near/419813109" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eli Dowling <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Efficient.20way.20of.20pattern.20matching.20on.20data.20with.20shared.20type.html#419813109">(Feb 05 2024 at 11:05)</a>:</h4>
<p>Also didn't work</p>



<a name="419813125"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Efficient%20way%20of%20pattern%20matching%20on%20data%20with%20shared%20type/near/419813125" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Efficient.20way.20of.20pattern.20matching.20on.20data.20with.20shared.20type.html#419813125">(Feb 05 2024 at 11:06)</a>:</h4>
<p>what is the error exactly?</p>



<a name="419813785"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Efficient%20way%20of%20pattern%20matching%20on%20data%20with%20shared%20type/near/419813785" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eli Dowling <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Efficient.20way.20of.20pattern.20matching.20on.20data.20with.20shared.20type.html#419813785">(Feb 05 2024 at 11:09)</a>:</h4>
<p>Jumped back on my computer:<br>
That's your first suggestion</p>
<div class="codehilite"><pre><span></span><code>── DUPLICATE NAME in ./LList.roc ───────────────────────────────────────────────

The data name is first defined here:

13│          Node { data }
                  ^^^^^^^^

But then it&#39;s defined a second time here:

14│          | Last { data }
                    ^^^^^^^^

Since these variables have the same name, it&#39;s easy to use the wrong
one by accident. Give one of them a new name.


── DUPLICATE NAME in ./LList.roc ───────────────────────────────────────────────

The data name is first defined here:

13│          Node { data }
                  ^^^^^^^^

But then it&#39;s defined a second time here:

15│          | First { data } -&gt; data
                     ^^^^^^^^

Since these variables have the same name, it&#39;s easy to use the wrong
one by accident. Give one of them a new name.


── NAME NOT BOUND IN ALL PATTERNS in ./LList.roc ───────────────────────────────

data is not bound in all patterns of this when branch

13│          Node { data }
                    ^^^^

Identifiers introduced in a when branch must be bound in all patterns
of the branch. Otherwise, the program would crash when it tries to use
an identifier that wasn&#39;t bound!

────────────────────────────────────────────────────────────────────────────────
</code></pre></div>



<a name="419814163"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Efficient%20way%20of%20pattern%20matching%20on%20data%20with%20shared%20type/near/419814163" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eli Dowling <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Efficient.20way.20of.20pattern.20matching.20on.20data.20with.20shared.20type.html#419814163">(Feb 05 2024 at 11:12)</a>:</h4>
<p>now the other</p>
<div class="codehilite"><pre><span></span><code>value2 = \@LList list -&gt;
    when list is
        Node d | Last d | First d -&gt; d.data
</code></pre></div>
<div class="codehilite"><pre><span></span><code>── TYPE MISMATCH in ./LList.roc ────────────────────────────────────────────────

The branches of this when expression don&#39;t match the condition:

12│&gt;      when list is
13│           Node d | Last d | First d -&gt; d.data

This list value is a:

    [
        First {
            data : a,
            next : LList a,
        },
        Last {
            data : a,
            prev : LList a,
        },
        Node {
            data : a,
            next : LList a,
            prev : LList a,
        },
    ] as b

But the branch patterns have type:

    [
        First {
            data : a,
            next : LList a,
        },
        Last {
            data : a,
            next : LList a,
        },
        Node {
            data : a,
            next : LList a,
        },
    ]

The branches must be cases of the when condition&#39;s type!

────────────────────────────────────────────────────────────────────────────────
</code></pre></div>



<a name="419814820"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Efficient%20way%20of%20pattern%20matching%20on%20data%20with%20shared%20type/near/419814820" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eli Dowling <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Efficient.20way.20of.20pattern.20matching.20on.20data.20with.20shared.20type.html#419814820">(Feb 05 2024 at 11:15)</a>:</h4>
<p>I think my intuition is that because records are "open" in that you can require a subset and not care about the rest of them and unions are open in that same sense. However It seems that slightly unintuitively breaks down when matching union containing a record  for which you only want the shared subset</p>



<a name="419815791"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Efficient%20way%20of%20pattern%20matching%20on%20data%20with%20shared%20type/near/419815791" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eli Dowling <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Efficient.20way.20of.20pattern.20matching.20on.20data.20with.20shared.20type.html#419815791">(Feb 05 2024 at 11:21)</a>:</h4>
<p>Okay, this simpler example does work </p>
<div class="codehilite" data-code-language="Elm"><pre><span></span><code><span class="nv">fun</span><span class="w"> </span><span class="nf">=</span><span class="w"> </span><span class="nf">\</span><span class="nv">tag</span><span class="w"> </span><span class="nf">-&gt;</span>
<span class="w">    </span><span class="nv">when</span><span class="w"> </span><span class="nv">tag</span><span class="w"> </span><span class="nv">is</span>
<span class="w">        </span><span class="kt">AA</span><span class="w"> </span><span class="nv">t</span><span class="w"> </span><span class="nf">|</span><span class="w"> </span><span class="kt">BB</span><span class="w"> </span><span class="nv">t</span><span class="w"> </span><span class="nf">-&gt;</span><span class="w"> </span><span class="nv">t</span><span class="nf">.</span><span class="nv">data</span>
<span class="kr">main </span><span class="nf">=</span>
<span class="w">    </span><span class="nv">b</span><span class="w"> </span><span class="nf">=</span><span class="w"> </span><span class="kt">AA</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nv">data</span><span class="nf">:</span><span class="w"> </span><span class="mi">10</span><span class="p">,</span><span class="w"> </span><span class="nv">other</span><span class="nf">:</span><span class="w"> </span><span class="mi">20</span><span class="w"> </span><span class="p">}</span>
<span class="w">    </span><span class="nv">fun</span><span class="w"> </span><span class="nv">b</span>
</code></pre></div>



<a name="419816679"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Efficient%20way%20of%20pattern%20matching%20on%20data%20with%20shared%20type/near/419816679" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eli Dowling <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Efficient.20way.20of.20pattern.20matching.20on.20data.20with.20shared.20type.html#419816679">(Feb 05 2024 at 11:26)</a>:</h4>
<p>It's because opaque unions are closed, right? It all works fine until i get the opaque types involved</p>



<a name="419817095"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Efficient%20way%20of%20pattern%20matching%20on%20data%20with%20shared%20type/near/419817095" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eli Dowling <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Efficient.20way.20of.20pattern.20matching.20on.20data.20with.20shared.20type.html#419817095">(Feb 05 2024 at 11:28)</a>:</h4>
<p>Okay so this works with a single case</p>
<div class="codehilite" data-code-language="Elm"><pre><span></span><code><span class="kt">Opaque</span><span class="w"> </span><span class="nf">:=</span><span class="w"> </span><span class="p">[</span><span class="kt">AA</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nv">data</span><span class="w"> </span><span class="nf">:</span><span class="w"> </span><span class="kt">U64</span><span class="p">,</span><span class="w"> </span><span class="nv">other</span><span class="nf">:</span><span class="kt">U64</span><span class="w"> </span><span class="p">}]</span>

<span class="nv">fun</span><span class="w"> </span><span class="nf">=</span><span class="w"> </span><span class="nf">\</span><span class="nv">tag</span><span class="w"> </span><span class="nf">-&gt;</span>
<span class="w">    </span><span class="nv">when</span><span class="w"> </span><span class="nv">tag</span><span class="w"> </span><span class="nv">is</span>
<span class="w">        </span><span class="kt">AA</span><span class="w"> </span><span class="nv">t</span><span class="w"> </span><span class="nf">-&gt;</span><span class="w"> </span><span class="nv">t</span><span class="nf">.</span><span class="nv">data</span>
<span class="nv">funWrap</span><span class="w"> </span><span class="nf">=</span><span class="w"> </span><span class="nf">\</span><span class="err">@</span><span class="kt">Opaque</span><span class="w"> </span><span class="nv">tag</span><span class="w"> </span><span class="nf">-&gt;</span>
<span class="w">    </span><span class="nv">fun</span><span class="w"> </span><span class="nv">tag</span>
<span class="kr">main </span><span class="nf">=</span>
<span class="w">    </span><span class="nv">b</span><span class="w"> </span><span class="nf">=</span><span class="w"> </span><span class="err">@</span><span class="kt">Opaque</span><span class="w"> </span><span class="p">(</span><span class="kt">AA</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nv">data</span><span class="nf">:</span><span class="w"> </span><span class="mi">10</span><span class="p">,</span><span class="w"> </span><span class="nv">other</span><span class="nf">:</span><span class="mi">10</span><span class="w"> </span><span class="p">})</span>
<span class="w">    </span><span class="nv">funWrap</span><span class="w"> </span><span class="nv">b</span>
</code></pre></div>



<a name="419818120"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Efficient%20way%20of%20pattern%20matching%20on%20data%20with%20shared%20type/near/419818120" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eli Dowling <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Efficient.20way.20of.20pattern.20matching.20on.20data.20with.20shared.20type.html#419818120">(Feb 05 2024 at 11:34)</a>:</h4>
<p>This also works when i remove other from AA</p>
<div class="codehilite" data-code-language="Elm"><pre><span></span><code><span class="kt">Opaque</span><span class="w"> </span><span class="nf">:=</span><span class="w"> </span><span class="p">[</span><span class="kt">AA</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nv">data</span><span class="w"> </span><span class="nf">:</span><span class="w"> </span><span class="kt">U64</span><span class="w"> </span><span class="p">},</span><span class="w"> </span><span class="kt">BB</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nv">data</span><span class="w"> </span><span class="nf">:</span><span class="w"> </span><span class="kt">U64</span><span class="w"> </span><span class="p">}]</span>

<span class="nv">fun</span><span class="w"> </span><span class="nf">:</span><span class="w"> </span><span class="p">[</span><span class="kt">AA</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nv">data</span><span class="w"> </span><span class="nf">:</span><span class="w"> </span><span class="kt">U64</span><span class="w"> </span><span class="p">},</span><span class="w"> </span><span class="kt">BB</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nv">data</span><span class="w"> </span><span class="nf">:</span><span class="w"> </span><span class="kt">U64</span><span class="w"> </span><span class="p">}]</span><span class="nf">*</span><span class="w"> </span><span class="nf">-&gt;</span><span class="w"> </span><span class="kt">U64</span>
<span class="nv">fun</span><span class="w"> </span><span class="nf">=</span><span class="w"> </span><span class="nf">\</span><span class="nv">tag</span><span class="w"> </span><span class="nf">-&gt;</span>
<span class="w">    </span><span class="nv">when</span><span class="w"> </span><span class="nv">tag</span><span class="w"> </span><span class="nv">is</span>
<span class="w">        </span><span class="kt">AA</span><span class="w"> </span><span class="nv">t</span><span class="w"> </span><span class="nf">|</span><span class="w"> </span><span class="kt">BB</span><span class="w"> </span><span class="nv">t</span><span class="w"> </span><span class="nf">-&gt;</span><span class="w"> </span><span class="nv">t</span><span class="nf">.</span><span class="nv">data</span>
<span class="w">        </span><span class="nv">_</span><span class="w"> </span><span class="nf">-&gt;</span><span class="w"> </span><span class="nv">crash</span><span class="w"> </span><span class="s">""</span>
<span class="nv">funWrap</span><span class="w"> </span><span class="nf">=</span><span class="w"> </span><span class="nf">\</span><span class="err">@</span><span class="kt">Opaque</span><span class="w"> </span><span class="nv">tag</span><span class="w"> </span><span class="nf">-&gt;</span>
<span class="w">    </span><span class="nv">fun</span><span class="w"> </span><span class="nv">tag</span>

<span class="kr">main </span><span class="nf">=</span>
<span class="w">    </span><span class="err">@</span><span class="kt">Opaque</span><span class="w"> </span><span class="p">(</span><span class="kt">AA</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nv">data</span><span class="nf">:</span><span class="w"> </span><span class="mi">10</span><span class="w"> </span><span class="p">})</span><span class="w"> </span><span class="nf">|&gt;</span><span class="w"> </span><span class="nv">funWrap</span>
</code></pre></div>



<a name="419819072"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Efficient%20way%20of%20pattern%20matching%20on%20data%20with%20shared%20type/near/419819072" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eli Dowling <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Efficient.20way.20of.20pattern.20matching.20on.20data.20with.20shared.20type.html#419819072">(Feb 05 2024 at 11:40)</a>:</h4>
<p>It's like we can't have both an open union and an open record at the same time.<br>
When i try to force everything to be open with annotation things get really weird:</p>
<div class="codehilite" data-code-language="Elm"><pre><span></span><code><span class="kt">Opaque</span><span class="w"> </span><span class="nv">a</span><span class="w"> </span><span class="nv">b</span><span class="w"> </span><span class="nf">:=</span><span class="w"> </span><span class="p">[</span><span class="kt">AA</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nv">data</span><span class="w"> </span><span class="nf">:</span><span class="w"> </span><span class="kt">U64</span><span class="p">,</span><span class="w"> </span><span class="nv">other</span><span class="w"> </span><span class="nf">:</span><span class="w"> </span><span class="kt">U64</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="nv">b</span><span class="p">,</span><span class="w"> </span><span class="kt">BB</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nv">data</span><span class="w"> </span><span class="nf">:</span><span class="w"> </span><span class="kt">U64</span><span class="w"> </span><span class="p">}</span><span class="nv">a</span><span class="p">]</span>

<span class="nv">fun</span><span class="w"> </span><span class="nf">:</span><span class="w"> </span><span class="p">[</span><span class="kt">AA</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nv">data</span><span class="w"> </span><span class="nf">:</span><span class="w"> </span><span class="kt">U64</span><span class="w"> </span><span class="p">}</span><span class="nf">*</span><span class="p">,</span><span class="w"> </span><span class="kt">BB</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nv">data</span><span class="w"> </span><span class="nf">:</span><span class="w"> </span><span class="kt">U64</span><span class="w"> </span><span class="p">}</span><span class="nf">*</span><span class="p">]</span><span class="nf">*</span><span class="w"> </span><span class="nf">-&gt;</span><span class="w"> </span><span class="kt">U64</span>
<span class="nv">fun</span><span class="w"> </span><span class="nf">=</span><span class="w"> </span><span class="nf">\</span><span class="nv">tag</span><span class="w"> </span><span class="nf">-&gt;</span>
<span class="w">    </span><span class="nv">when</span><span class="w"> </span><span class="nv">tag</span><span class="w"> </span><span class="nv">is</span>
<span class="w">        </span><span class="kt">AA</span><span class="w"> </span><span class="nv">t</span><span class="w"> </span><span class="nf">|</span><span class="w"> </span><span class="kt">BB</span><span class="w"> </span><span class="nv">t</span><span class="w"> </span><span class="nf">-&gt;</span><span class="w"> </span><span class="nv">t</span><span class="nf">.</span><span class="nv">data</span>
<span class="w">        </span><span class="nv">_</span><span class="w"> </span><span class="nf">-&gt;</span><span class="w"> </span><span class="nv">crash</span><span class="w"> </span><span class="s">""</span>
<span class="nv">funWrap</span><span class="w"> </span><span class="nf">=</span><span class="w"> </span><span class="nf">\</span><span class="err">@</span><span class="kt">Opaque</span><span class="w"> </span><span class="nv">tag</span><span class="w"> </span><span class="nf">-&gt;</span>
<span class="w">    </span><span class="nv">fun</span><span class="w"> </span><span class="nv">tag</span>

<span class="kr">main </span><span class="nf">=</span>
<span class="w">    </span><span class="err">@</span><span class="kt">Opaque</span><span class="w"> </span><span class="p">(</span><span class="kt">AA</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nv">data</span><span class="nf">:</span><span class="w"> </span><span class="mi">10</span><span class="w"> </span><span class="p">})</span><span class="w"> </span><span class="nf">|&gt;</span><span class="w"> </span><span class="nv">funWrap</span>
</code></pre></div>
<p>error:</p>
<div class="codehilite"><pre><span></span><code>── TYPE MISMATCH in ./LList.roc ────────────────────────────────────────────────

The branches of this when expression don&#39;t match the condition:

43│&gt;      when tag is
44│           AA t | BB t -&gt; t.data
45│           _ -&gt; crash &quot;&quot;

This tag value is a:

    […]*

But the branch patterns have type:

    […]*

The branches must be cases of the when condition&#39;s type!

────────────────────────────────────────────────────────────────────────────────
</code></pre></div>



<a name="419871253"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Efficient%20way%20of%20pattern%20matching%20on%20data%20with%20shared%20type/near/419871253" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Efficient.20way.20of.20pattern.20matching.20on.20data.20with.20shared.20type.html#419871253">(Feb 05 2024 at 15:52)</a>:</h4>
<p>My guess is that patterns just don't have enough flexibility when being nested.</p>



<hr><p>Last updated: Mar 01 2026 at 12:20 UTC</p>
</html>