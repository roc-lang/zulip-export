<html>
<head><meta charset="utf-8"><title>Effective error handling techniques Â· beginners Â· Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/index.html">beginners</a></h2>
<h3>Topic: <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Effective.20error.20handling.20techniques.html">Effective error handling techniques</a></h3>

<hr>

<base href="https://roc.zulipchat.com">

<head><link href="https://roc-lang.github.io/zulip-export/style.css" rel="stylesheet"></head>

<a name="314852068"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Effective%20error%20handling%20techniques/near/314852068" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Kevin Gillette <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Effective.20error.20handling.20techniques.html#314852068">(Dec 09 2022 at 09:34)</a>:</h4>
<p>(forked from <a href="#narrow/stream/231634-beginners/topic/Task.2Ferror.20handling.20.26.20platform.20use/near/314385634">https://roc.zulipchat.com/#narrow/stream/231634-beginners/topic/Task.2Ferror.20handling.20.26.20platform.20use/near/314385634</a>)</p>
<p>At least basic-cli main to have the signature <code>main : Task {} []</code>, which I take to mean that we can't leave any errors unhandled. I've seen the available options in the Task package (such as await vs attempt, onFail, etc), but, at least at my experience level they don't seem to combine well.</p>
<p>For example, the tutorial extensively highlights <code>await</code>, though...</p>
<ol>
<li><code>await</code>, afaict, prevents the remainder of the surrounding function from being able to handle any errors that came out of the application of awaited task.</li>
<li><code>attempt</code> does allow handling errors in the same function, but is not nearly as convenient, and must be paired with <code>Result</code> functions (not too bad) or <code>when</code>.</li>
<li>A <code>when</code> expression (for error checking) disrupts the visual flow (and thus readability/pacing) of what otherwise might be a nicely pipeline or back-passed function.</li>
</ol>
<p>I'm hoping someone can share some technique(s) for use in throwaway/non-productionized programs ("scripts"), such as in Advent of Code solutions, in which I can conveniently use backpassing with <code>await</code> throughout <code>main</code>, while being able to capture errors and log a generic failure message to Stderr.</p>
<p>For serious programs, I would of course take errors seriously, but at present I do find myself regularly switching a given function back and forth between Task functions (such as backpassing await vs backpassing attempt vs forward-piping onFail to attempt) in order to find a good balance of succinctness and simplicity while satisfying platform requirements.</p>



<a name="314883351"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Effective%20error%20handling%20techniques/near/314883351" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Effective.20error.20handling.20techniques.html#314883351">(Dec 09 2022 at 12:24)</a>:</h4>
<p>one idea: we could change <code>basic-cli</code> to accept <code>main : Task {} *</code> - and then have it crash automatically for unhandled errors</p>



<a name="314883507"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Effective%20error%20handling%20techniques/near/314883507" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Effective.20error.20handling.20techniques.html#314883507">(Dec 09 2022 at 12:25)</a>:</h4>
<p>this would be convenient for quick scripts, and if you wanted to force error handling, it would be as trivial as annotating your application with <code>main : Task {} []</code> like today</p>



<a name="314922536"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Effective%20error%20handling%20techniques/near/314922536" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Effective.20error.20handling.20techniques.html#314922536">(Dec 09 2022 at 15:41)</a>:</h4>
<p>Generally, what i have found pretty reasonable is to make a task that is chained with await. Only at the very end use a <code>when</code> to do any error handling. If no error handling is wanted, I think you can just <code>crash</code> on all errors.</p>
<p>Theoretically, it should be possible to chain a <code>Task.onFail</code> to deal with error handling (again, this could just be a call to <code>crash</code>).  That said, i would need to double check if this is convenient or if the types don't exactly align happily.</p>



<a name="314922967"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Effective%20error%20handling%20techniques/near/314922967" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Effective.20error.20handling.20techniques.html#314922967">(Dec 09 2022 at 15:43)</a>:</h4>
<p>We also could just expose something like <code>Task.crashOnErr</code> to the end user that would print the error and crash. Requires a way to print tag unions first, but in general should work</p>



<a name="314965121"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Effective%20error%20handling%20techniques/near/314965121" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Kevin Gillette <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Effective.20error.20handling.20techniques.html#314965121">(Dec 09 2022 at 19:18)</a>:</h4>
<p><span class="user-mention" data-user-id="343810">@Brendan Hansknecht</span> by chained, do you mean <code>|&gt;</code> ?</p>
<p>I could see how that'd work, but isn't that still also mutually exclusive with a predominant backpassing task construction style? I couldn't figure out how to make the type system work with await, backpassing, _and_ error handling.</p>
<p>I may just be trying to over-leverage backpassing + await when backpassing + attempt or chaining + await would be more suitable for these situations?</p>
<p>It's been the better part of a year since I've given the tutorial a full read through, but in my recent skimming, it seemed like await + backpassing were prominently advertised together without mention of caveats, so I figured that combination was the most conventional choice whenever tasks were involved.</p>



<a name="316385610"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Effective%20error%20handling%20techniques/near/316385610" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Effective.20error.20handling.20techniques.html#316385610">(Dec 17 2022 at 00:37)</a>:</h4>
<p>I'm still having a hard time sometimes getting tasks to work together. I spent a fair amount of time working with them; but it still hasn't fully clicked for me. Below is a concrete example; I have been trying for about 15mins now to figure out what is causing this error. I am sure it is something really obvious that I am missing here.</p>
<p>I thought I would share as this is probably a common experience. </p>
<p>I am not sure which <code>await</code> has the issue here. </p>
<div class="codehilite" data-code-language="Elixir"><pre><span></span><code><span class="n">main</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="nc">Task</span><span class="w"> </span><span class="p">{}</span><span class="w"> </span><span class="p">[]</span><span class="w"></span>
<span class="n">main</span><span class="w"> </span><span class="o">=</span><span class="w"></span>

<span class="w">    </span><span class="n">task</span><span class="w"> </span><span class="o">=</span><span class="w"></span>
<span class="w">        </span><span class="n">fileInput</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nc">File</span><span class="o">.</span><span class="n">readUtf8</span><span class="w"> </span><span class="p">(</span><span class="nc">Path</span><span class="o">.</span><span class="n">fromStr</span><span class="w"> </span><span class="s2">"input-day-15.txt"</span><span class="p">)</span><span class="w"> </span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Task</span><span class="o">.</span><span class="n">await</span><span class="w"></span>
<span class="w">        </span><span class="n">fileData</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">parseInput</span><span class="w"> </span><span class="p">(</span><span class="nc">Str</span><span class="o">.</span><span class="n">toUtf8</span><span class="w"> </span><span class="n">fileInput</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="p">{}</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">part1</span><span class="w"> </span><span class="p">(</span><span class="n">withColor</span><span class="w"> </span><span class="s2">"Part 1 Sample:"</span><span class="w"> </span><span class="nc">Green</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="n">initialState</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">sampleData</span><span class="p">}</span><span class="w"> </span><span class="mi">10</span><span class="w"> </span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Task</span><span class="o">.</span><span class="n">await</span><span class="w"></span>
<span class="w">        </span><span class="p">{}</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">part1</span><span class="w"> </span><span class="p">(</span><span class="n">withColor</span><span class="w"> </span><span class="s2">"Part 1 File:"</span><span class="w"> </span><span class="nc">Green</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="n">initialState</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">fileData</span><span class="p">}</span><span class="w"> </span><span class="mi">2_000_000</span><span class="w"> </span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Task</span><span class="o">.</span><span class="n">await</span><span class="w"></span>

<span class="w">        </span><span class="nc">Stdout</span><span class="o">.</span><span class="n">line</span><span class="w"> </span><span class="s2">"Complete"</span><span class="w"></span>

<span class="w">    </span><span class="nc">Task</span><span class="o">.</span><span class="n">onFail</span><span class="w"> </span><span class="n">task</span><span class="w"> </span><span class="err">\</span><span class="bp">_</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">crash</span><span class="w"> </span><span class="s2">"Oops, something went wrong."</span><span class="w"></span>

<span class="n">part1</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="nc">Str</span><span class="p">,</span><span class="w"> </span><span class="nc">State</span><span class="p">,</span><span class="w"> </span><span class="nc">I64</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="nc">Task</span><span class="w"> </span><span class="p">{}</span><span class="w"> </span><span class="p">[]</span><span class="w"></span>
</code></pre></div>
<div class="codehilite" data-code-language="Bash"><pre><span></span><code>% roc dev day15.roc

â”€â”€ TYPE MISMATCH â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ day15.roc â”€

This 2nd argument to await has an unexpected type:

<span class="m">22</span>â”‚&gt;          fileInput &lt;- File.readUtf8 <span class="o">(</span>Path.fromStr <span class="s2">"input-day-15.txt"</span><span class="o">)</span> <span class="p">|</span>&gt; Task.await
<span class="m">23</span>â”‚&gt;          <span class="nv">fileData</span> <span class="o">=</span> parseInput <span class="o">(</span>Str.toUtf8 fileInput<span class="o">)</span>
<span class="m">24</span>â”‚&gt;          <span class="o">{}</span> &lt;- part1 <span class="o">(</span>withColor <span class="s2">"Part 1 Sample:"</span> Green<span class="o">)</span> <span class="o">{</span>initialState <span class="p">&amp;</span> data : sampleData<span class="o">}</span> <span class="m">10</span> <span class="p">|</span>&gt; Task.await
<span class="m">25</span>â”‚&gt;          <span class="o">{}</span> &lt;- part1 <span class="o">(</span>withColor <span class="s2">"Part 1 File:"</span> Green<span class="o">)</span> <span class="o">{</span>initialState <span class="p">&amp;</span> data : fileData<span class="o">}</span> 2_000_000 <span class="p">|</span>&gt; Task.await
<span class="m">26</span>â”‚&gt;
<span class="m">27</span>â”‚&gt;          Stdout.line <span class="s2">"Complete"</span>

The argument is an anonymous <span class="k">function</span> of type:

    Str -&gt; Task <span class="o">{}</span> <span class="o">[]</span>

But await needs its 2nd argument to be:

    Str -&gt; Task <span class="o">{}</span> <span class="o">[</span>FileReadErr Path.Path InternalFile.ReadErr,
    FileReadUtf8Err Path.Path <span class="o">[</span>BadUtf8 Utf8ByteProblem Nat<span class="o">]]</span>

Tip: Looks like a closed tag union does not have the FileReadErr and
FileReadUtf8Err tags.

Tip: Closed tag unions can<span class="err">'</span>t grow, because that might change the size
<span class="k">in</span> memory. Can you use an open tag union?

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

<span class="m">1</span> error and <span class="m">0</span> warnings found <span class="k">in</span> <span class="m">25</span> ms.
</code></pre></div>



<a name="316386923"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Effective%20error%20handling%20techniques/near/316386923" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Erik <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Effective.20error.20handling.20techniques.html#316386923">(Dec 17 2022 at 00:53)</a>:</h4>
<p>does part1 does more file reading stuff? Im not sure what is going on there but I think we need to see more of the code.</p>



<a name="316387351"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Effective%20error%20handling%20techniques/near/316387351" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Effective.20error.20handling.20techniques.html#316387351">(Dec 17 2022 at 00:58)</a>:</h4>
<p>I got it working. If I handle the error case for <code>File.readUtf8</code> it works fine. I guess my understanding was that errors would flow all the way up to the <code>task</code> and then get captured in the <code>Task.onFail task \_ -&gt; crash "Oops, something went wrong."</code></p>
<p>Changing it to the following works now. It was a little confusing; as I've used this same pattern for the last 14 AoC days and haven't had this issue before.</p>
<div class="codehilite"><pre><span></span><code>fileInput &lt;-
    File.readUtf8 (Path.fromStr &quot;input-day-15.txt&quot;)
    |&gt; Task.mapFail \_ -&gt; crash &quot;couldnt read file&quot;
    |&gt; Task.await

fileData = parseInput (Str.toUtf8 fileInput)
</code></pre></div>



<a name="316388076"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Effective%20error%20handling%20techniques/near/316388076" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Erik <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Effective.20error.20handling.20techniques.html#316388076">(Dec 17 2022 at 01:07)</a>:</h4>
<p>Hmmm it may have been one of the earlier awaits. Since part1 says it returns a task with no error tags. But at that point the task flowing through still has the file read errors as apart of its type. I think that could explain why adding the crash earlier takes care of it.</p>



<a name="316388163"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Effective%20error%20handling%20techniques/near/316388163" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Erik <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Effective.20error.20handling.20techniques.html#316388163">(Dec 17 2022 at 01:08)</a>:</h4>
<p>I wanna see if I can get that rudimentary language server going being able to hover the types here might help.</p>



<a name="316388230"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Effective%20error%20handling%20techniques/near/316388230" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Erik <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Effective.20error.20handling.20techniques.html#316388230">(Dec 17 2022 at 01:09)</a>:</h4>
<p>To test my theory u could remove the early crash and change the task type on part1</p>



<a name="316389174"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Effective%20error%20handling%20techniques/near/316389174" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Effective.20error.20handling.20techniques.html#316389174">(Dec 17 2022 at 01:23)</a>:</h4>
<blockquote>
<p>To test my theory u could remove the early crash and change the task type on part1</p>
</blockquote>
<p>Yep, that works. Having the definition on <code>part1</code> meant that it couldn't flow the error all the way through. I guess I added that to assist with fault finding something else, which then causes this issue.</p>



<a name="316389906"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Effective%20error%20handling%20techniques/near/316389906" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Effective.20error.20handling.20techniques.html#316389906">(Dec 17 2022 at 01:34)</a>:</h4>
<p>Ooh, I just realised that if I handle the errors correctly, then I can simplify the whole main to the following. After playing with it a while, I really like this pattern!</p>
<div class="codehilite" data-code-language="Elixir"><pre><span></span><code><span class="n">main</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="nc">Task</span><span class="w"> </span><span class="p">{}</span><span class="w"> </span><span class="p">[]</span><span class="w"></span>
<span class="n">main</span><span class="w"> </span><span class="o">=</span><span class="w"></span>

<span class="w">    </span><span class="n">fileInput</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"></span>
<span class="w">        </span><span class="nc">File</span><span class="o">.</span><span class="n">readUtf8</span><span class="w"> </span><span class="p">(</span><span class="nc">Path</span><span class="o">.</span><span class="n">fromStr</span><span class="w"> </span><span class="s2">"input-day-15.txt"</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Task</span><span class="o">.</span><span class="n">mapFail</span><span class="w"> </span><span class="err">\</span><span class="bp">_</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">crash</span><span class="w"> </span><span class="s2">"couldn't read input"</span><span class="w"></span>
<span class="w">        </span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Task</span><span class="o">.</span><span class="n">await</span><span class="w"></span>

<span class="w">    </span><span class="n">fileData</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">parseInput</span><span class="w"> </span><span class="p">(</span><span class="nc">Str</span><span class="o">.</span><span class="n">toUtf8</span><span class="w"> </span><span class="n">fileInput</span><span class="p">)</span><span class="w"></span>

<span class="w">    </span><span class="p">{}</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">part1</span><span class="w"> </span><span class="s2">"Sample"</span><span class="w"> </span><span class="p">{</span><span class="n">initState</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">sampleData</span><span class="p">}</span><span class="w"> </span><span class="mi">10</span><span class="w"> </span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Stdout</span><span class="o">.</span><span class="n">line</span><span class="w"> </span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Task</span><span class="o">.</span><span class="n">await</span><span class="w"></span>
<span class="w">    </span><span class="p">{}</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">part1</span><span class="w"> </span><span class="s2">"File"</span><span class="w"> </span><span class="p">{</span><span class="n">initState</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">fileData</span><span class="p">}</span><span class="w"> </span><span class="mi">2_000_000</span><span class="w"> </span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Stdout</span><span class="o">.</span><span class="n">line</span><span class="w"> </span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Task</span><span class="o">.</span><span class="n">await</span><span class="w"></span>

<span class="w">    </span><span class="nc">Stdout</span><span class="o">.</span><span class="n">line</span><span class="w"> </span><span class="s2">"Completed processsing ğŸ˜Š"</span><span class="w"></span>

<span class="n">part1</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="nc">Str</span><span class="p">,</span><span class="w"> </span><span class="nc">State</span><span class="p">,</span><span class="w"> </span><span class="nc">I64</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="nc">Str</span><span class="w"></span>
</code></pre></div>



<a name="316390238"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Effective%20error%20handling%20techniques/near/316390238" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Effective.20error.20handling.20techniques.html#316390238">(Dec 17 2022 at 01:40)</a>:</h4>
<p>Erik, I think you're observation about seeing the types is a good one. If we could "see" the types flow through the code then that would be awesome.</p>



<a name="316392040"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Effective%20error%20handling%20techniques/near/316392040" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Effective.20error.20handling.20techniques.html#316392040">(Dec 17 2022 at 02:09)</a>:</h4>
<p>I thought we made it so that all returned tags are now open, so i am a bit surprised by this error. That said, don't have access to a computer right now, so can't mess with it to figure these things out.</p>



<a name="316401006"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Effective%20error%20handling%20techniques/near/316401006" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Erik <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Effective.20error.20handling.20techniques.html#316401006">(Dec 17 2022 at 04:29)</a>:</h4>
<p>Interesting, ok I narrowed down the example to not require anything more than the following</p>
<div class="codehilite" data-code-language="Elixir"><pre><span></span><code><span class="n">app</span><span class="w"> </span><span class="s2">"main"</span><span class="w"></span>
<span class="w">    </span><span class="n">packages</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="ss">pf</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://github.com/roc-lang/basic-cli/releases/download/0.1.3/5SXwdW7rH8QAOnD71IkHcFxCmBEPtFSLAIkclPEgjHQ.tar.br"</span><span class="w"> </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="n">imports</span><span class="w"> </span><span class="p">[</span><span class="w"></span>
<span class="w">        </span><span class="n">pf</span><span class="o">.</span><span class="nc">File</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="n">pf</span><span class="o">.</span><span class="nc">Path</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="n">pf</span><span class="o">.</span><span class="nc">Stdout</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="n">pf</span><span class="o">.</span><span class="nc">Task</span><span class="o">.</span><span class="p">{</span><span class="w"> </span><span class="nc">Task</span><span class="w"> </span><span class="p">},</span><span class="w"></span>
<span class="w">    </span><span class="p">]</span><span class="w"></span>
<span class="w">    </span><span class="n">provides</span><span class="w"> </span><span class="p">[</span><span class="n">main</span><span class="p">]</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">pf</span><span class="w"></span>

<span class="n">main</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="nc">Task</span><span class="w"> </span><span class="p">{}</span><span class="w"> </span><span class="p">[]</span><span class="w"></span>
<span class="n">main</span><span class="w"> </span><span class="o">=</span><span class="w"></span>
<span class="w">    </span><span class="n">task</span><span class="w"> </span><span class="o">=</span><span class="w"></span>
<span class="w">        </span><span class="n">_fileInput</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nc">File</span><span class="o">.</span><span class="n">readUtf8</span><span class="w"> </span><span class="p">(</span><span class="nc">Path</span><span class="o">.</span><span class="n">fromStr</span><span class="w"> </span><span class="s2">"some-file.txt"</span><span class="p">)</span><span class="w"> </span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Task</span><span class="o">.</span><span class="n">await</span><span class="w"></span>

<span class="w">        </span><span class="p">{}</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">part1</span><span class="w"> </span><span class="p">(</span><span class="s2">"Some Str"</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="ss">data</span><span class="p">:</span><span class="w"> </span><span class="s2">"Some Data"</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="mi">10</span><span class="w"> </span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Task</span><span class="o">.</span><span class="n">await</span><span class="w"></span>
<span class="w">        </span><span class="p">{}</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">part1</span><span class="w"> </span><span class="p">(</span><span class="s2">"Some Str"</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="ss">data</span><span class="p">:</span><span class="w"> </span><span class="s2">"Some Data"</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="mi">2_000_000</span><span class="w"> </span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Task</span><span class="o">.</span><span class="n">await</span><span class="w"></span>

<span class="w">        </span><span class="nc">Stdout</span><span class="o">.</span><span class="n">line</span><span class="w"> </span><span class="s2">"Complete"</span><span class="w"></span>

<span class="w">    </span><span class="nc">Task</span><span class="o">.</span><span class="n">onFail</span><span class="w"> </span><span class="n">task</span><span class="w"> </span><span class="err">\</span><span class="bp">_</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">crash</span><span class="w"> </span><span class="s2">"Oops, something went wrong."</span><span class="w"></span>

<span class="n">part1</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="nc">Str</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="nc">Str</span><span class="w"> </span><span class="p">},</span><span class="w"> </span><span class="nc">I64</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="nc">Task</span><span class="w"> </span><span class="p">{}</span><span class="w"> </span><span class="p">[]</span><span class="w"></span>
</code></pre></div>



<a name="316401112"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Effective%20error%20handling%20techniques/near/316401112" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Erik <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Effective.20error.20handling.20techniques.html#316401112">(Dec 17 2022 at 04:31)</a>:</h4>
<p>which reproduces the error</p>
<div class="codehilite"><pre><span></span><code>â¯ roc check

â”€â”€ TYPE MISMATCH â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ main.roc â”€

This 2nd argument to await has an unexpected type:

14â”‚&gt;          _fileInput &lt;- File.readUtf8 (Path.fromStr &quot;some-file.txt&quot;) |&gt; Task.await
15â”‚&gt;
16â”‚&gt;          {} &lt;- part1 (&quot;Some Str&quot;) { data: &quot;Some Data&quot; } 10 |&gt; Task.await
17â”‚&gt;          {} &lt;- part1 (&quot;Some Str&quot;) { data: &quot;Some Data&quot; } 2_000_000 |&gt; Task.await
18â”‚&gt;
19â”‚&gt;          Stdout.line &quot;Complete&quot;

The argument is an anonymous function of type:

    Str -&gt; Task {} []

But await needs its 2nd argument to be:

    Str -&gt; Task {} [FileReadErr Path.Path InternalFile.ReadErr,
    FileReadUtf8Err Path.Path [BadUtf8 Utf8ByteProblem Nat]]

Tip: Looks like a closed tag union does not have the FileReadErr and
FileReadUtf8Err tags.

Tip: Closed tag unions can&#39;t grow, because that might change the size
in memory. Can you use an open tag union?

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

1 error and 0 warnings found in 13 ms.
</code></pre></div>
<p>I thought changing the annotation on part1 to return <code>Task {} []*</code> might work out to make it explicitely open. But then I get.</p>
<div class="codehilite"><pre><span></span><code>â¯ roc check

â”€â”€ UNNECESSARY WILDCARD â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ main.roc â”€

This type annotation has a wildcard type variable (*) that isn&#39;t
needed.

23â”‚  part1 : Str, { data : Str }, I64 -&gt; Task {} []*
                                                   ^

Annotations for tag unions which are constants, or which are returned
from functions, work the same way with or without a * at the end. (The
* means something different when the tag union is an argument to a
function, though!)

You can safely remove this to make the code more concise without
changing what it means.

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

0 errors and 1 warning found in 13 ms.
</code></pre></div>
<p>Which makes me think I don't fully understand open tag unions <span aria-label="sweat smile" class="emoji emoji-1f605" role="img" title="sweat smile">:sweat_smile:</span></p>



<a name="316401193"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Effective%20error%20handling%20techniques/near/316401193" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Erik <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Effective.20error.20handling.20techniques.html#316401193">(Dec 17 2022 at 04:33)</a>:</h4>
<p>To clarify, I would have expected 0 warnings for that change since the above error made it seem like that tag union needed to be open (or explicitly include those error tags.</p>



<a name="316403440"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Effective%20error%20handling%20techniques/near/316403440" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Effective.20error.20handling.20techniques.html#316403440">(Dec 17 2022 at 05:06)</a>:</h4>
<p>So still haven't had time to dig into this on a computer, but i think the type of await is pretty telling<br>
<code>Task a err, (a -&gt; Task b err) -&gt; Task b err</code></p>
<p>Even if the return type tag is always open, the <code>Task a err</code> is an input to the function, this doesn't have to be open.</p>
<p>On top of that, the 2 error types have to unify and be represented in the same final memory layout based on how await is written. Still not totally sure the ramifications of this/if we can make it more flexible, but just some minor musings.</p>



<a name="316406409"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Effective%20error%20handling%20techniques/near/316406409" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Effective.20error.20handling.20techniques.html#316406409">(Dec 17 2022 at 06:01)</a>:</h4>
<p>Im away from my laptop, but I had a thought, I feel like you need to remove the type definition on <code>main</code>?</p>



<a name="316406977"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Effective%20error%20handling%20techniques/near/316406977" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Effective.20error.20handling.20techniques.html#316406977">(Dec 17 2022 at 06:08)</a>:</h4>
<p>That shouldn't change anything. The type of main is specified in the platform.</p>



<a name="316406996"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Effective%20error%20handling%20techniques/near/316406996" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Effective.20error.20handling.20techniques.html#316406996">(Dec 17 2022 at 06:08)</a>:</h4>
<p>So you can't really change it.</p>



<a name="316407413"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Effective%20error%20handling%20techniques/near/316407413" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Effective.20error.20handling.20techniques.html#316407413">(Dec 17 2022 at 06:15)</a>:</h4>
<p>Oh, the original code works with a minor change. Just needs this type signature:<br>
<code>part1 : Str, State, I64 -&gt; Task {} *</code></p>



<a name="316407483"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Effective%20error%20handling%20techniques/near/316407483" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Effective.20error.20handling.20techniques.html#316407483">(Dec 17 2022 at 06:16)</a>:</h4>
<p>This definitely surprises me since I though we made open tag unions the default for return types. That would mean that returning <code>[]</code> should be the same as using <code>*</code> to my understanding, but that is obviously wrong based on this example.</p>



<a name="316407621"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Effective%20error%20handling%20techniques/near/316407621" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Effective.20error.20handling.20techniques.html#316407621">(Dec 17 2022 at 06:19)</a>:</h4>
<p><span class="user-mention" data-user-id="454654">@Ayaz Hafiz</span> any insights to help us understand the types here especially with the default of returning open tag unions?</p>
<p>Why does <code>part1 : Str, State, I64 -&gt; Task {} *</code> work, but <code>part1 : Str, State, I64 -&gt; Task {} []</code> fail to type check? I still assume this is somehow tied to it being consumed by <code>await</code>. So it isn't really about returning open tag unions. It's about how <code>await</code> is consuming and restricting the tag union. Just don't understand the full picture.</p>



<a name="316409316"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Effective%20error%20handling%20techniques/near/316409316" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Erik <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Effective.20error.20handling.20techniques.html#316409316">(Dec 17 2022 at 06:45)</a>:</h4>
<p>OK maybe this has something to do with it.... when the thing is being sent through <code>await</code> where the return is a <code>Task {} []</code> it raises this issue. But if the error tag union has just one tag in it the error goes away.</p>
<div class="codehilite" data-code-language="Elixir"><pre><span></span><code><span class="n">app</span><span class="w"> </span><span class="s2">"main"</span><span class="w"></span>
<span class="w">    </span><span class="n">packages</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="ss">pf</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://github.com/roc-lang/basic-cli/releases/download/0.1.3/5SXwdW7rH8QAOnD71IkHcFxCmBEPtFSLAIkclPEgjHQ.tar.br"</span><span class="w"> </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="n">imports</span><span class="w"> </span><span class="p">[</span><span class="w"></span>
<span class="w">        </span><span class="n">pf</span><span class="o">.</span><span class="nc">File</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="n">pf</span><span class="o">.</span><span class="nc">Path</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="n">pf</span><span class="o">.</span><span class="nc">Stdout</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="n">pf</span><span class="o">.</span><span class="nc">Task</span><span class="o">.</span><span class="p">{</span><span class="w"> </span><span class="nc">Task</span><span class="w"> </span><span class="p">},</span><span class="w"></span>
<span class="w">    </span><span class="p">]</span><span class="w"></span>
<span class="w">    </span><span class="n">provides</span><span class="w"> </span><span class="p">[</span><span class="n">main</span><span class="p">]</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">pf</span><span class="w"></span>

<span class="n">main</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="nc">Task</span><span class="w"> </span><span class="p">{}</span><span class="w"> </span><span class="p">[]</span><span class="w"></span>
<span class="n">main</span><span class="w"> </span><span class="o">=</span><span class="w"></span>
<span class="w">    </span><span class="n">task</span><span class="w"> </span><span class="o">=</span><span class="w"></span>
<span class="w">        </span><span class="n">_fileInput</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nc">File</span><span class="o">.</span><span class="n">readUtf8</span><span class="w"> </span><span class="p">(</span><span class="nc">Path</span><span class="o">.</span><span class="n">fromStr</span><span class="w"> </span><span class="s2">"some-file.txt"</span><span class="p">)</span><span class="w"> </span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Task</span><span class="o">.</span><span class="n">await</span><span class="w"></span>
<span class="w">        </span><span class="bp">_</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nc">File</span><span class="o">.</span><span class="n">writeBytes</span><span class="w"> </span><span class="p">(</span><span class="nc">Path</span><span class="o">.</span><span class="n">fromStr</span><span class="w"> </span><span class="s2">"myfile.dat"</span><span class="p">)</span><span class="w"> </span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">]</span><span class="w"> </span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Task</span><span class="o">.</span><span class="n">await</span><span class="w"></span>
<span class="w">        </span><span class="p">{}</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">iDontActuallyKnowWhatImDoing</span><span class="w"> </span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Task</span><span class="o">.</span><span class="n">await</span><span class="w"></span>

<span class="w">        </span><span class="nc">Stdout</span><span class="o">.</span><span class="n">line</span><span class="w"> </span><span class="s2">"Donezo"</span><span class="w"></span>

<span class="w">    </span><span class="nc">Task</span><span class="o">.</span><span class="n">onFail</span><span class="w"> </span><span class="n">task</span><span class="w"> </span><span class="err">\</span><span class="bp">_</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">crash</span><span class="w"> </span><span class="s2">"boom"</span><span class="w"></span>

<span class="n">iDontActuallyKnowWhatImDoing</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="nc">Task</span><span class="w"> </span><span class="p">{}</span><span class="w"> </span><span class="p">[</span><span class="nc">Hmm</span><span class="p">]</span><span class="w"></span>
<span class="n">iDontActuallyKnowWhatImDoing</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">Task</span><span class="o">.</span><span class="n">succeed</span><span class="w"> </span><span class="p">{}</span><span class="w"></span>
</code></pre></div>



<a name="316409404"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Effective%20error%20handling%20techniques/near/316409404" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Erik <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Effective.20error.20handling.20techniques.html#316409404">(Dec 17 2022 at 06:46)</a>:</h4>
<p><code>iDontActuallyKnowWhatImDoing : Task {} [Hmm]</code> typechecks but <code>iDontActuallyKnowWhatImDoing : Task {} []</code> does not</p>



<a name="316430658"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Effective%20error%20handling%20techniques/near/316430658" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Carroll <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Effective.20error.20handling.20techniques.html#316430658">(Dec 17 2022 at 10:29)</a>:</h4>
<p>If Roc is encouraging people to crash on any errors because they can't figure out another way then it's a problem we need to fix! The language should be encouraging the opposite - handling everything.</p>
<p>I would suggest trying this pattern:</p>
<p>Put all the logic into a helper function whose return task type has all of the possible error tags in it.</p>
<p>Then all main does is call that helper and handle the returned errors. It would have a <code>when..is</code> to turn the success or any errors into strings, then print it out.</p>
<p>Since main handles all the errors it can return a task with no errors.</p>



<a name="316430828"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Effective%20error%20handling%20techniques/near/316430828" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Carroll <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Effective.20error.20handling.20techniques.html#316430828">(Dec 17 2022 at 10:30)</a>:</h4>
<p>I suppose that's similar to what Erik is doing with the inner <code>task</code></p>



<a name="316430926"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Effective%20error%20handling%20techniques/near/316430926" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Carroll <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Effective.20error.20handling.20techniques.html#316430926">(Dec 17 2022 at 10:31)</a>:</h4>
<p>I'm on my phone now but can try it on a computer later</p>



<a name="316434236"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Effective%20error%20handling%20techniques/near/316434236" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Carroll <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Effective.20error.20handling.20techniques.html#316434236">(Dec 17 2022 at 10:58)</a>:</h4>
<p>OK this is what I meant but it gives the same error</p>
<div class="codehilite" data-code-language="CoffeeScript"><pre><span></span><code><span class="nx">app</span><span class="w"> </span><span class="s">"main"</span><span class="w"></span>
<span class="w">    </span><span class="nx">packages</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nv">pf</span><span class="o">:</span><span class="w"> </span><span class="s">"https://github.com/roc-lang/basic-cli/releases/download/0.1.3/5SXwdW7rH8QAOnD71IkHcFxCmBEPtFSLAIkclPEgjHQ.tar.br"</span><span class="w"> </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="nx">imports</span><span class="w"> </span><span class="p">[</span><span class="w"></span>
<span class="w">        </span><span class="nx">pf</span><span class="p">.</span><span class="nx">File</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="nx">pf</span><span class="p">.</span><span class="nx">Path</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="nx">pf</span><span class="p">.</span><span class="nx">Stdout</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="nx">pf</span><span class="p">.</span><span class="nx">Task</span><span class="p">.{</span><span class="w"> </span><span class="nx">Task</span><span class="w"> </span><span class="p">},</span><span class="w"></span>
<span class="w">    </span><span class="p">]</span><span class="w"></span>
<span class="w">    </span><span class="nx">provides</span><span class="w"> </span><span class="p">[</span><span class="nx">main</span><span class="p">]</span><span class="w"> </span><span class="nx">to</span><span class="w"> </span><span class="nx">pf</span><span class="w"></span>

<span class="nv">main</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="nx">Task</span><span class="w"> </span><span class="p">{}</span><span class="w"> </span><span class="p">[]</span><span class="w"></span>
<span class="nv">main</span><span class="w"> </span><span class="o">=</span><span class="w"></span>
<span class="w">    </span><span class="nx">run</span><span class="w"></span>
<span class="w">    </span><span class="o">|&gt;</span><span class="w"> </span><span class="nx">Task</span><span class="p">.</span><span class="nx">onFail</span><span class="w"> </span><span class="nx">handleErrors</span><span class="w"></span>

<span class="nv">run</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="nx">Task</span><span class="w"> </span><span class="p">{}</span><span class="w"> </span><span class="p">[</span><span class="nx">FileReadErr</span><span class="w"> </span><span class="nx">Path</span><span class="p">.</span><span class="nx">Path</span><span class="w"> </span><span class="nx">InternalFile</span><span class="p">.</span><span class="nx">ReadErr</span><span class="p">,</span><span class="w"> </span><span class="nx">FileReadUtf8Err</span><span class="w"> </span><span class="nx">Path</span><span class="p">.</span><span class="nx">Path</span><span class="w"> </span><span class="p">[</span><span class="nx">BadUtf8</span><span class="w"> </span><span class="nx">_</span><span class="w"> </span><span class="nx">Nat</span><span class="p">]]</span><span class="w"></span>
<span class="nv">run</span><span class="w"> </span><span class="o">=</span><span class="w"></span>
<span class="w">    </span><span class="nx">_fileInput</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nx">File</span><span class="p">.</span><span class="nx">readUtf8</span><span class="w"> </span><span class="p">(</span><span class="nx">Path</span><span class="p">.</span><span class="nx">fromStr</span><span class="w"> </span><span class="s">"some-file.txt"</span><span class="p">)</span><span class="w"> </span><span class="o">|&gt;</span><span class="w"> </span><span class="nx">Task</span><span class="p">.</span><span class="nx">await</span><span class="w"></span>

<span class="w">    </span><span class="p">{}</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nx">part1</span><span class="w"> </span><span class="p">(</span><span class="s">"Some Str"</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nv">data</span><span class="o">:</span><span class="w"> </span><span class="s">"Some Data"</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="mi">10</span><span class="w"> </span><span class="o">|&gt;</span><span class="w"> </span><span class="nx">Task</span><span class="p">.</span><span class="nx">await</span><span class="w"></span>
<span class="w">    </span><span class="p">{}</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nx">part1</span><span class="w"> </span><span class="p">(</span><span class="s">"Some Str"</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nv">data</span><span class="o">:</span><span class="w"> </span><span class="s">"Some Data"</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="mi">2</span><span class="nx">_000_000</span><span class="w"> </span><span class="o">|&gt;</span><span class="w"> </span><span class="nx">Task</span><span class="p">.</span><span class="nx">await</span><span class="w"></span>

<span class="w">    </span><span class="nx">Stdout</span><span class="p">.</span><span class="nx">line</span><span class="w"> </span><span class="s">"Complete"</span><span class="w"></span>

<span class="nv">handleErrors</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="nx">FileReadErr</span><span class="w"> </span><span class="nx">Path</span><span class="p">.</span><span class="nx">Path</span><span class="w"> </span><span class="nx">InternalFile</span><span class="p">.</span><span class="nx">ReadErr</span><span class="p">,</span><span class="w"> </span><span class="nx">FileReadUtf8Err</span><span class="w"> </span><span class="nx">Path</span><span class="p">.</span><span class="nx">Path</span><span class="w"> </span><span class="p">[</span><span class="nx">BadUtf8</span><span class="w"> </span><span class="nx">_</span><span class="w"> </span><span class="nx">Nat</span><span class="p">]]</span><span class="w"> </span><span class="nf">-&gt;</span><span class="w"> </span><span class="nx">Task</span><span class="w"> </span><span class="p">{}</span><span class="w"> </span><span class="p">[]</span><span class="w"></span>
<span class="nv">handleErrors</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="err">\</span><span class="nx">error</span><span class="w"> </span><span class="nf">-&gt;</span><span class="w"></span>
<span class="w">    </span><span class="nv">errorString</span><span class="w"> </span><span class="o">=</span><span class="w"></span>
<span class="w">        </span><span class="k">when</span><span class="w"> </span><span class="nx">error</span><span class="w"> </span><span class="o">is</span><span class="w"></span>
<span class="w">            </span><span class="nx">FileReadErr</span><span class="w"> </span><span class="nx">path</span><span class="w"> </span><span class="nx">_</span><span class="w"> </span><span class="nf">-&gt;</span><span class="w"></span>
<span class="w">                </span><span class="nv">pathStr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Path</span><span class="p">.</span><span class="nx">display</span><span class="w"> </span><span class="nx">path</span><span class="w"></span>

<span class="w">                </span><span class="s">"Could not read the file \(pathStr)"</span><span class="w"></span>

<span class="w">            </span><span class="nx">FileReadUtf8Err</span><span class="w"> </span><span class="nx">path</span><span class="w"> </span><span class="nx">_</span><span class="w"> </span><span class="nf">-&gt;</span><span class="w"></span>
<span class="w">                </span><span class="nv">pathStr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Path</span><span class="p">.</span><span class="nx">display</span><span class="w"> </span><span class="nx">path</span><span class="w"></span>

<span class="w">                </span><span class="s">"Invalid UTF8 in file \(pathStr)"</span><span class="w"></span>

<span class="w">    </span><span class="nx">Stdout</span><span class="p">.</span><span class="nx">line</span><span class="w"> </span><span class="nx">errorString</span><span class="w"></span>

<span class="nv">part1</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="nx">Str</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nv">data</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="nx">Str</span><span class="w"> </span><span class="p">},</span><span class="w"> </span><span class="nx">I64</span><span class="w"> </span><span class="nf">-&gt;</span><span class="w"> </span><span class="nx">Task</span><span class="w"> </span><span class="p">{}</span><span class="w"> </span><span class="p">[]</span><span class="w"></span>
</code></pre></div>



<a name="316460128"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Effective%20error%20handling%20techniques/near/316460128" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ayaz Hafiz <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Effective.20error.20handling.20techniques.html#316460128">(Dec 17 2022 at 13:45)</a>:</h4>
<p>this is a bug in specifically how empty tag unions are handled. For example <code>part1 : Str, { data : Str }, I64 -&gt; Task {} [FileReadErr _ _ ]</code> works. The empty tag union case <code>part1 : Str, { data : Str }, I64 -&gt; Task {} []</code> should work too.</p>



<a name="316477298"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Effective%20error%20handling%20techniques/near/316477298" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Effective.20error.20handling.20techniques.html#316477298">(Dec 17 2022 at 15:44)</a>:</h4>
<p>Ok, this is a bug. I thought this seemed off.</p>



<a name="316477311"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Effective%20error%20handling%20techniques/near/316477311" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Effective.20error.20handling.20techniques.html#316477311">(Dec 17 2022 at 15:44)</a>:</h4>
<p>Thanks</p>



<a name="316506530"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Effective%20error%20handling%20techniques/near/316506530" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Effective.20error.20handling.20techniques.html#316506530">(Dec 17 2022 at 20:20)</a>:</h4>
<p>FWIW after all of this discussion and exploring, I think the current design is really great. My example above feels pretty simple conceptually and it encourages you to handle the errors so they don't accumulate. I think a good introduction with plenty of examples will be sufficient. Also, additional tooling support like an IDE would be nice to have in the future. The error msg could maybe be improved a liite more, im not sure what's possible here though.</p>



<a name="316511438"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Effective%20error%20handling%20techniques/near/316511438" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Effective.20error.20handling.20techniques.html#316511438">(Dec 17 2022 at 21:17)</a>:</h4>
<p>Whether you handle the errors right away, handle them latter, or just crash since it is a quick script, the original error example should type check. It is still a bug specifically around how we handle the empty tag. It should be considered open because it is in a return type. Since it is not considered open it doesn't merge/type check. Including Brian's proper error checking example wouldn't type check in current roc without changing the type of part1.</p>



<a name="316513358"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Effective%20error%20handling%20techniques/near/316513358" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Carroll <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Effective.20error.20handling.20techniques.html#316513358">(Dec 17 2022 at 21:39)</a>:</h4>
<p>Yep good summary.<br>
It certainly did seem like a bug. Thanks for confirming that, Ayaz!</p>



<a name="316529444"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Effective%20error%20handling%20techniques/near/316529444" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ayaz Hafiz <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Effective.20error.20handling.20techniques.html#316529444">(Dec 18 2022 at 01:08)</a>:</h4>
<p>I checked naive type on hover, it doesn't even really help here.. I feel like the editor could do a much nicer job, at least telling you where the type inference went wrong interactively (e.g. linking the relevant part of the <code>part1</code> signature vs the specific problematic part of the backpacking, like the error message but interactive), which even in this compiler bug scenario would make it much easier to recognize as a bug</p>
<p><a href="/user_uploads/22008/Wuh8gho3htxv7UUhlYdwipaU/image.png">image.png</a></p>
<div class="message_inline_image"><a href="/user_uploads/22008/Wuh8gho3htxv7UUhlYdwipaU/image.png" title="image.png"><img src="/user_uploads/22008/Wuh8gho3htxv7UUhlYdwipaU/image.png"></a></div>



<a name="316537952"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Effective%20error%20handling%20techniques/near/316537952" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Erik <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Effective.20error.20handling.20techniques.html#316537952">(Dec 18 2022 at 03:39)</a>:</h4>
<p>Awesome thanks everyone for confirming the bug and the tips/tricks :).</p>



<hr><p>Last updated: Mar 01 2026 at 12:20 UTC</p>
</html>