<html>
<head><meta charset="utf-8"><title>Compiler seems extremely slow on some code · beginners · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/index.html">beginners</a></h2>
<h3>Topic: <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Compiler.20seems.20extremely.20slow.20on.20some.20code.html">Compiler seems extremely slow on some code</a></h3>

<hr>

<base href="https://roc.zulipchat.com">

<head><link href="https://roc-lang.github.io/zulip-export/style.css" rel="stylesheet"></head>

<a name="454798716"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Compiler%20seems%20extremely%20slow%20on%20some%20code/near/454798716" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Aurélien Geron <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Compiler.20seems.20extremely.20slow.20on.20some.20code.html#454798716">(Jul 29 2024 at 11:11)</a>:</h4>
<p>The following <code>main.roc</code> code takes forever to compile, using all my CPU. It's been running for well over 10 minutes, I don't understand why. I tried removing almost everything and adding one piece at a time, and it just gets slower and slower. So I'm guessing the full code will eventually finish compiling one day, but perhaps not today. Any idea what's going on? Sorry if the code is really ugly, I'm a pebble (=a little Roc newbie).</p>
<div class="codehilite" data-code-language="Elm"><pre><span></span><code><span class="nv">app</span><span class="w"> </span><span class="p">[</span><span class="nv">main</span><span class="p">]</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nv">cli</span><span class="nf">:</span><span class="w"> </span><span class="nv">platform</span><span class="w"> </span><span class="s">"https://github.com/roc-lang/basic-cli/releases/download/0.12.0/Lb8EgiejTUzbggO2HVVuPJFkwvvsfW6LojkLR20kTVE.tar.br"</span><span class="w"> </span><span class="p">}</span>

<span class="kn">import</span><span class="w"> </span><span class="nc">cli.Stdout</span>
<span class="kn">import</span><span class="w"> </span><span class="nc">cli.Task</span>
<span class="kn">import</span><span class="w"> </span><span class="nc">cli.Arg</span>
<span class="kn">import</span><span class="w"> </span><span class="nc">cli.File</span>
<span class="kn">import</span><span class="w"> </span><span class="nc">cli.Utc</span>

<span class="kn">import</span><span class="w"> </span><span class="nc">Day01</span>
<span class="kn">import</span><span class="w"> </span><span class="nc">Day02</span>
<span class="kn">import</span><span class="w"> </span><span class="nc">Day03</span>
<span class="kn">import</span><span class="w"> </span><span class="nc">Day04</span>
<span class="kn">import</span><span class="w"> </span><span class="nc">Day05</span>
<span class="kn">import</span><span class="w"> </span><span class="nc">Day06</span>
<span class="kn">import</span><span class="w"> </span><span class="nc">Day07</span>
<span class="kn">import</span><span class="w"> </span><span class="nc">Day08</span>
<span class="kn">import</span><span class="w"> </span><span class="nc">Day09</span>
<span class="kn">import</span><span class="w"> </span><span class="nc">Day10</span>
<span class="kn">import</span><span class="w"> </span><span class="nc">Day11</span>
<span class="kn">import</span><span class="w"> </span><span class="nc">Day12</span>
<span class="kn">import</span><span class="w"> </span><span class="nc">Day13</span>
<span class="kn">import</span><span class="w"> </span><span class="nc">Day14</span>
<span class="kn">import</span><span class="w"> </span><span class="nc">Day15</span>
<span class="kn">import</span><span class="w"> </span><span class="nc">Day16</span>
<span class="kn">import</span><span class="w"> </span><span class="nc">Day17</span>
<span class="kn">import</span><span class="w"> </span><span class="nc">Day18</span>
<span class="kn">import</span><span class="w"> </span><span class="nc">Day19</span>
<span class="kn">import</span><span class="w"> </span><span class="nc">Day20</span>
<span class="kn">import</span><span class="w"> </span><span class="nc">Day21</span>
<span class="kn">import</span><span class="w"> </span><span class="nc">Day22</span>
<span class="kn">import</span><span class="w"> </span><span class="nc">Day23</span>
<span class="kn">import</span><span class="w"> </span><span class="nc">Day24</span>
<span class="kn">import</span><span class="w"> </span><span class="nc">Day25</span>

<span class="nv">dataPath</span><span class="w"> </span><span class="nf">=</span><span class="w"> </span><span class="nf">\</span><span class="nv">day</span><span class="w"> </span><span class="nf">-&gt;</span>
<span class="w">    </span><span class="s">"data/day$(if day &lt; 10 then "</span><span class="mi">0</span><span class="s">" else "")$(Num.toStr day).txt"</span>

<span class="nv">loadData</span><span class="w"> </span><span class="nf">=</span><span class="w"> </span><span class="nf">\</span><span class="nv">day</span><span class="w"> </span><span class="nf">-&gt;</span><span class="w"> </span><span class="nv">day</span><span class="w"> </span><span class="nf">|&gt;</span><span class="w"> </span><span class="nv">dataPath</span><span class="w"> </span><span class="nf">|&gt;</span><span class="w"> </span><span class="kt">File</span><span class="nf">.</span><span class="nv">readUtf8</span><span class="err">!</span>

<span class="nv">solutions</span><span class="w"> </span><span class="nf">=</span><span class="w"> </span><span class="p">[</span>
<span class="w">    </span><span class="p">(</span><span class="kt">Day01</span><span class="nf">.</span><span class="nv">part1</span><span class="p">,</span><span class="w"> </span><span class="kt">Day01</span><span class="nf">.</span><span class="nv">part2</span><span class="p">),</span>
<span class="w">    </span><span class="p">(</span><span class="kt">Day02</span><span class="nf">.</span><span class="nv">part1</span><span class="p">,</span><span class="w"> </span><span class="kt">Day02</span><span class="nf">.</span><span class="nv">part2</span><span class="p">),</span>
<span class="w">    </span><span class="p">(</span><span class="kt">Day03</span><span class="nf">.</span><span class="nv">part1</span><span class="p">,</span><span class="w"> </span><span class="kt">Day03</span><span class="nf">.</span><span class="nv">part2</span><span class="p">),</span>
<span class="w">    </span><span class="p">(</span><span class="kt">Day04</span><span class="nf">.</span><span class="nv">part1</span><span class="p">,</span><span class="w"> </span><span class="kt">Day04</span><span class="nf">.</span><span class="nv">part2</span><span class="p">),</span>
<span class="w">    </span><span class="p">(</span><span class="kt">Day05</span><span class="nf">.</span><span class="nv">part1</span><span class="p">,</span><span class="w"> </span><span class="kt">Day05</span><span class="nf">.</span><span class="nv">part2</span><span class="p">),</span>
<span class="w">    </span><span class="p">(</span><span class="kt">Day06</span><span class="nf">.</span><span class="nv">part1</span><span class="p">,</span><span class="w"> </span><span class="kt">Day06</span><span class="nf">.</span><span class="nv">part2</span><span class="p">),</span>
<span class="w">    </span><span class="p">(</span><span class="kt">Day07</span><span class="nf">.</span><span class="nv">part1</span><span class="p">,</span><span class="w"> </span><span class="kt">Day07</span><span class="nf">.</span><span class="nv">part2</span><span class="p">),</span>
<span class="w">    </span><span class="p">(</span><span class="kt">Day08</span><span class="nf">.</span><span class="nv">part1</span><span class="p">,</span><span class="w"> </span><span class="kt">Day08</span><span class="nf">.</span><span class="nv">part2</span><span class="p">),</span>
<span class="w">    </span><span class="p">(</span><span class="kt">Day09</span><span class="nf">.</span><span class="nv">part1</span><span class="p">,</span><span class="w"> </span><span class="kt">Day09</span><span class="nf">.</span><span class="nv">part2</span><span class="p">),</span>
<span class="w">    </span><span class="p">(</span><span class="kt">Day10</span><span class="nf">.</span><span class="nv">part1</span><span class="p">,</span><span class="w"> </span><span class="kt">Day10</span><span class="nf">.</span><span class="nv">part2</span><span class="p">),</span>
<span class="w">    </span><span class="p">(</span><span class="kt">Day11</span><span class="nf">.</span><span class="nv">part1</span><span class="p">,</span><span class="w"> </span><span class="kt">Day11</span><span class="nf">.</span><span class="nv">part2</span><span class="p">),</span>
<span class="w">    </span><span class="p">(</span><span class="kt">Day12</span><span class="nf">.</span><span class="nv">part1</span><span class="p">,</span><span class="w"> </span><span class="kt">Day12</span><span class="nf">.</span><span class="nv">part2</span><span class="p">),</span>
<span class="w">    </span><span class="p">(</span><span class="kt">Day13</span><span class="nf">.</span><span class="nv">part1</span><span class="p">,</span><span class="w"> </span><span class="kt">Day13</span><span class="nf">.</span><span class="nv">part2</span><span class="p">),</span>
<span class="w">    </span><span class="p">(</span><span class="kt">Day14</span><span class="nf">.</span><span class="nv">part1</span><span class="p">,</span><span class="w"> </span><span class="kt">Day14</span><span class="nf">.</span><span class="nv">part2</span><span class="p">),</span>
<span class="w">    </span><span class="p">(</span><span class="kt">Day15</span><span class="nf">.</span><span class="nv">part1</span><span class="p">,</span><span class="w"> </span><span class="kt">Day15</span><span class="nf">.</span><span class="nv">part2</span><span class="p">),</span>
<span class="w">    </span><span class="p">(</span><span class="kt">Day16</span><span class="nf">.</span><span class="nv">part1</span><span class="p">,</span><span class="w"> </span><span class="kt">Day16</span><span class="nf">.</span><span class="nv">part2</span><span class="p">),</span>
<span class="w">    </span><span class="p">(</span><span class="kt">Day17</span><span class="nf">.</span><span class="nv">part1</span><span class="p">,</span><span class="w"> </span><span class="kt">Day17</span><span class="nf">.</span><span class="nv">part2</span><span class="p">),</span>
<span class="w">    </span><span class="p">(</span><span class="kt">Day18</span><span class="nf">.</span><span class="nv">part1</span><span class="p">,</span><span class="w"> </span><span class="kt">Day18</span><span class="nf">.</span><span class="nv">part2</span><span class="p">),</span>
<span class="w">    </span><span class="p">(</span><span class="kt">Day19</span><span class="nf">.</span><span class="nv">part1</span><span class="p">,</span><span class="w"> </span><span class="kt">Day19</span><span class="nf">.</span><span class="nv">part2</span><span class="p">),</span>
<span class="w">    </span><span class="p">(</span><span class="kt">Day20</span><span class="nf">.</span><span class="nv">part1</span><span class="p">,</span><span class="w"> </span><span class="kt">Day20</span><span class="nf">.</span><span class="nv">part2</span><span class="p">),</span>
<span class="w">    </span><span class="p">(</span><span class="kt">Day21</span><span class="nf">.</span><span class="nv">part1</span><span class="p">,</span><span class="w"> </span><span class="kt">Day21</span><span class="nf">.</span><span class="nv">part2</span><span class="p">),</span>
<span class="w">    </span><span class="p">(</span><span class="kt">Day22</span><span class="nf">.</span><span class="nv">part1</span><span class="p">,</span><span class="w"> </span><span class="kt">Day22</span><span class="nf">.</span><span class="nv">part2</span><span class="p">),</span>
<span class="w">    </span><span class="p">(</span><span class="kt">Day23</span><span class="nf">.</span><span class="nv">part1</span><span class="p">,</span><span class="w"> </span><span class="kt">Day23</span><span class="nf">.</span><span class="nv">part2</span><span class="p">),</span>
<span class="w">    </span><span class="p">(</span><span class="kt">Day24</span><span class="nf">.</span><span class="nv">part1</span><span class="p">,</span><span class="w"> </span><span class="kt">Day24</span><span class="nf">.</span><span class="nv">part2</span><span class="p">),</span>
<span class="w">    </span><span class="p">(</span><span class="kt">Day25</span><span class="nf">.</span><span class="nv">part1</span><span class="p">,</span><span class="w"> </span><span class="kt">Day25</span><span class="nf">.</span><span class="nv">part2</span><span class="p">),</span>
<span class="p">]</span>

<span class="nv">runSolution</span><span class="w"> </span><span class="nf">=</span><span class="w"> </span><span class="nf">\</span><span class="nv">solution</span><span class="p">,</span><span class="w"> </span><span class="nv">index</span><span class="p">,</span><span class="w"> </span><span class="nv">input</span><span class="w"> </span><span class="nf">-&gt;</span>
<span class="w">    </span><span class="kt">Stdout</span><span class="nf">.</span><span class="nv">line</span><span class="err">!</span><span class="w"> </span><span class="s">"Part $(Num.toStr index):"</span>
<span class="w">    </span><span class="nv">startTime</span><span class="w"> </span><span class="nf">=</span><span class="w"> </span><span class="kt">Utc</span><span class="nf">.</span><span class="nv">now</span><span class="err">!</span>
<span class="w">    </span><span class="nv">result</span><span class="w"> </span><span class="nf">=</span><span class="w"> </span><span class="nv">solution</span><span class="w"> </span><span class="nv">input</span>
<span class="w">    </span><span class="nv">endTime</span><span class="w"> </span><span class="nf">=</span><span class="w"> </span><span class="kt">Utc</span><span class="nf">.</span><span class="nv">now</span><span class="err">!</span>
<span class="w">    </span><span class="nv">delta</span><span class="w"> </span><span class="nf">=</span><span class="w"> </span><span class="kt">Utc</span><span class="nf">.</span><span class="nv">deltaAsMillis</span><span class="w"> </span><span class="nv">startTime</span><span class="w"> </span><span class="nv">endTime</span><span class="w"> </span><span class="nf">|&gt;</span><span class="w"> </span><span class="kt">Num</span><span class="nf">.</span><span class="nv">toStr</span>
<span class="w">    </span><span class="kt">Stdout</span><span class="nf">.</span><span class="nv">line</span><span class="err">!</span><span class="w"> </span><span class="s">"$(result) ($(delta)ms)"</span>

<span class="nv">checkDay</span><span class="w"> </span><span class="nf">=</span><span class="w"> </span><span class="nf">\</span><span class="nv">day</span><span class="w"> </span><span class="nf">-&gt;</span>
<span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nv">day</span><span class="w"> </span><span class="nf">&lt;</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="nf">||</span><span class="w"> </span><span class="nv">day</span><span class="w"> </span><span class="nf">&gt;</span><span class="w"> </span><span class="mi">25</span><span class="w"> </span><span class="kr">then</span><span class="w"> </span><span class="kt">Task</span><span class="nf">.</span><span class="nv">err</span><span class="w"> </span><span class="p">(</span><span class="kt">InvalidDay</span><span class="w"> </span><span class="s">"Must be between 1 and 25"</span><span class="p">)</span><span class="w"> </span><span class="kr">else</span><span class="w"> </span><span class="kt">Task</span><span class="nf">.</span><span class="nv">ok</span><span class="w"> </span><span class="p">{}</span>

<span class="nv">runDay</span><span class="w"> </span><span class="nf">=</span><span class="w"> </span><span class="nf">\</span><span class="nv">dayArg</span><span class="w"> </span><span class="nf">-&gt;</span>
<span class="w">    </span><span class="nv">day</span><span class="w"> </span><span class="nf">=</span><span class="w"> </span><span class="kt">Str</span><span class="nf">.</span><span class="nv">toU64</span><span class="w"> </span><span class="nv">dayArg</span><span class="w"> </span><span class="nf">|&gt;</span><span class="w"> </span><span class="kt">Task</span><span class="nf">.</span><span class="nv">fromResult</span><span class="err">!</span>
<span class="w">    </span><span class="nv">checkDay</span><span class="err">!</span><span class="w"> </span><span class="nv">day</span>
<span class="w">    </span><span class="kt">Stdout</span><span class="nf">.</span><span class="nv">line</span><span class="err">!</span><span class="w"> </span><span class="s">"Day $(Num.toStr day)"</span>
<span class="w">    </span><span class="nv">input</span><span class="w"> </span><span class="nf">=</span><span class="w"> </span><span class="nv">loadData</span><span class="err">!</span><span class="w"> </span><span class="nv">day</span>
<span class="w">    </span><span class="p">(</span><span class="nv">part1</span><span class="p">,</span><span class="w"> </span><span class="nv">part2</span><span class="p">)</span><span class="w"> </span><span class="nf">=</span><span class="w"> </span><span class="kt">List</span><span class="nf">.</span><span class="nv">get</span><span class="w"> </span><span class="nv">solutions</span><span class="w"> </span><span class="p">(</span><span class="nv">day</span><span class="w"> </span><span class="nf">-</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="nf">|&gt;</span><span class="w"> </span><span class="kt">Task</span><span class="nf">.</span><span class="nv">fromResult</span><span class="err">!</span>
<span class="w">    </span><span class="nv">runSolution</span><span class="err">!</span><span class="w"> </span><span class="nv">part1</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="nv">input</span>
<span class="w">    </span><span class="nv">runSolution</span><span class="err">!</span><span class="w"> </span><span class="nv">part2</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="nv">input</span>

<span class="kr">main </span><span class="nf">=</span>
<span class="w">    </span><span class="nv">args</span><span class="w"> </span><span class="nf">=</span><span class="w"> </span><span class="kt">Arg</span><span class="nf">.</span><span class="nv">list</span><span class="err">!</span><span class="w"> </span><span class="p">{}</span>
<span class="w">    </span><span class="nv">daysStr</span><span class="w"> </span><span class="nf">=</span><span class="w"> </span><span class="kr">if</span><span class="w"> </span><span class="kt">List</span><span class="nf">.</span><span class="nv">len</span><span class="w"> </span><span class="nv">args</span><span class="w"> </span><span class="nf">&lt;</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="kr">then</span><span class="w"> </span><span class="kt">List</span><span class="nf">.</span><span class="nv">range</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nv">start</span><span class="nf">:</span><span class="w"> </span><span class="kt">At</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="nv">end</span><span class="nf">:</span><span class="w"> </span><span class="kt">At</span><span class="w"> </span><span class="mi">25</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="nf">|&gt;</span><span class="w"> </span><span class="kt">List</span><span class="nf">.</span><span class="nv">map</span><span class="w"> </span><span class="kt">Num</span><span class="nf">.</span><span class="nv">toStr</span><span class="w"> </span><span class="kr">else</span><span class="w"> </span><span class="nv">args</span><span class="w"> </span><span class="nf">|&gt;</span><span class="w"> </span><span class="kt">List</span><span class="nf">.</span><span class="nv">dropFirst</span><span class="w"> </span><span class="mi">1</span>
<span class="w">    </span><span class="nv">_</span><span class="w"> </span><span class="nf">=</span><span class="w"> </span><span class="nv">daysStr</span><span class="w"> </span><span class="nf">|&gt;</span><span class="w"> </span><span class="kt">List</span><span class="nf">.</span><span class="nv">map</span><span class="w"> </span><span class="nv">runDay</span><span class="w"> </span><span class="nf">|&gt;</span><span class="w"> </span><span class="kt">List</span><span class="nf">.</span><span class="nv">reverse</span><span class="w"> </span><span class="nf">|&gt;</span><span class="w"> </span><span class="kt">Task</span><span class="nf">.</span><span class="nv">sequence</span><span class="err">!</span>
<span class="w">    </span><span class="kt">Task</span><span class="nf">.</span><span class="nv">ok</span><span class="w"> </span><span class="p">{}</span>
</code></pre></div>
<p>Every <code>DayXX.roc</code> file contains the same thing:</p>
<div class="codehilite" data-code-language="Elm"><pre><span></span><code><span class="kn">module</span><span class="w"> </span><span class="err">[</span><span class="nc">part1</span><span class="p">,</span><span class="w"> </span><span class="nv">part2</span><span class="p">]</span>
<span class="nv">part1</span><span class="w"> </span><span class="nf">=</span><span class="w"> </span><span class="nf">\</span><span class="nv">input</span><span class="w"> </span><span class="nf">-&gt;</span><span class="w"> </span><span class="s">"Part 1 not implemented"</span>
<span class="nv">part2</span><span class="w"> </span><span class="nf">=</span><span class="w"> </span><span class="nf">\</span><span class="nv">input</span><span class="w"> </span><span class="nf">-&gt;</span><span class="w"> </span><span class="s">"Part 2 not implemented"</span>
</code></pre></div>



<a name="454799428"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Compiler%20seems%20extremely%20slow%20on%20some%20code/near/454799428" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Compiler.20seems.20extremely.20slow.20on.20some.20code.html#454799428">(Jul 29 2024 at 11:13)</a>:</h4>
<p>Are you importing/ingesting file bytes? i.e. like this <a href="https://www.roc-lang.org/examples/IngestFiles/README.html">https://www.roc-lang.org/examples/IngestFiles/README.html</a></p>



<a name="454799539"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Compiler%20seems%20extremely%20slow%20on%20some%20code/near/454799539" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Compiler.20seems.20extremely.20slow.20on.20some.20code.html#454799539">(Jul 29 2024 at 11:13)</a>:</h4>
<p>We have a known LLVM bug that makes that ultra slow -- here is the PR to fix <a href="https://github.com/roc-lang/roc/pull/6832">https://github.com/roc-lang/roc/pull/6832</a></p>



<a name="454799769"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Compiler%20seems%20extremely%20slow%20on%20some%20code/near/454799769" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Aurélien Geron <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Compiler.20seems.20extremely.20slow.20on.20some.20code.html#454799769">(Jul 29 2024 at 11:14)</a>:</h4>
<p>Ah thanks, yes my code does contain<code>File.readUtf8!</code>, is that what you mean?</p>



<a name="454799910"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Compiler%20seems%20extremely%20slow%20on%20some%20code/near/454799910" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Compiler.20seems.20extremely.20slow.20on.20some.20code.html#454799910">(Jul 29 2024 at 11:14)</a>:</h4>
<p>No, <code>File.readUtf8</code> should be fine</p>



<a name="454800160"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Compiler%20seems%20extremely%20slow%20on%20some%20code/near/454800160" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Aurélien Geron <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Compiler.20seems.20extremely.20slow.20on.20some.20code.html#454800160">(Jul 29 2024 at 11:15)</a>:</h4>
<p>My code also uses <code>Utc.now!</code>, maybe that's related?</p>



<a name="454800577"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Compiler%20seems%20extremely%20slow%20on%20some%20code/near/454800577" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Compiler.20seems.20extremely.20slow.20on.20some.20code.html#454800577">(Jul 29 2024 at 11:16)</a>:</h4>
<blockquote>
<p>I'm a pebble (=a little Roc newbie) </p>
</blockquote>
<p>I love this, <span aria-label="smiley" class="emoji emoji-1f603" role="img" title="smiley">:smiley:</span></p>



<a name="454800756"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Compiler%20seems%20extremely%20slow%20on%20some%20code/near/454800756" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Aurélien Geron <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Compiler.20seems.20extremely.20slow.20on.20some.20code.html#454800756">(Jul 29 2024 at 11:17)</a>:</h4>
<p>Basically the code takes some days as command line arguments (e.g., <code>roc main.roc 1 2 3</code>), and for each day it loads the corresponding <code>data/dayXX.txt</code> file, and it runs DayXX.part1 and DayXX.part2, times them, and prints the results along with the times.</p>



<a name="454801101"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Compiler%20seems%20extremely%20slow%20on%20some%20code/near/454801101" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Compiler.20seems.20extremely.20slow.20on.20some.20code.html#454801101">(Jul 29 2024 at 11:19)</a>:</h4>
<p>I'm not seeing anything that looks obviously wrong</p>



<a name="454801378"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Compiler%20seems%20extremely%20slow%20on%20some%20code/near/454801378" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Aurélien Geron <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Compiler.20seems.20extremely.20slow.20on.20some.20code.html#454801378">(Jul 29 2024 at 11:20)</a>:</h4>
<p>So the I/O operations involved are <code>Arg.list</code>, <code>Stdout.line</code>, <code>Utc.now</code>, and <code>File.readUtf8</code>.</p>



<a name="454801492"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Compiler%20seems%20extremely%20slow%20on%20some%20code/near/454801492" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Compiler.20seems.20extremely.20slow.20on.20some.20code.html#454801492">(Jul 29 2024 at 11:21)</a>:</h4>
<p>I suspect we have a bug somewhere related to composing a lot of Tasks in a program</p>



<a name="454801560"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Compiler%20seems%20extremely%20slow%20on%20some%20code/near/454801560" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Compiler.20seems.20extremely.20slow.20on.20some.20code.html#454801560">(Jul 29 2024 at 11:21)</a>:</h4>
<p>Like we a hitting an edge case or something that is blowing up the code gen</p>



<a name="454801757"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Compiler%20seems%20extremely%20slow%20on%20some%20code/near/454801757" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Compiler.20seems.20extremely.20slow.20on.20some.20code.html#454801757">(Jul 29 2024 at 11:22)</a>:</h4>
<p>It could maybe be related to all  the refcounting and other fixes that Brendan fixed recently. All available on the TESTING nightly and basic-cli 0.13.0 if you would like to test that</p>



<a name="454801786"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Compiler%20seems%20extremely%20slow%20on%20some%20code/near/454801786" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Aurélien Geron <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Compiler.20seems.20extremely.20slow.20on.20some.20code.html#454801786">(Jul 29 2024 at 11:23)</a>:</h4>
<p><span class="user-mention silent" data-user-id="515757">Luke Boswell</span> <a href="#narrow/stream/231634-beginners/topic/Compiler.20seems.20extremely.20slow.20on.20some.20code/near/454801101">said</a>:</p>
<blockquote>
<p>I'm not seeing anything that looks obviously wrong</p>
</blockquote>
<p>If you want to test this, you can remove all the <code>import DayXX</code>, and replace the definition of <code>solutions</code> with this:</p>
<div class="codehilite" data-code-language="Elm"><pre><span></span><code><span class="nv">solutions</span><span class="w"> </span><span class="nf">=</span><span class="w"> </span><span class="p">[</span>
<span class="w">    </span><span class="p">(</span><span class="nf">\</span><span class="nv">i</span><span class="w"> </span><span class="nf">-&gt;</span><span class="w"> </span><span class="nv">i</span><span class="p">,</span><span class="w"> </span><span class="nf">\</span><span class="nv">i</span><span class="w"> </span><span class="nf">-&gt;</span><span class="w"> </span><span class="nv">i</span><span class="p">),</span>
<span class="p">]</span>
</code></pre></div>
<p>Then run <code>roc main.roc 1</code></p>
<p>For me, it's still super slow.</p>



<a name="454801886"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Compiler%20seems%20extremely%20slow%20on%20some%20code/near/454801886" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Aurélien Geron <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Compiler.20seems.20extremely.20slow.20on.20some.20code.html#454801886">(Jul 29 2024 at 11:23)</a>:</h4>
<p><span class="user-mention silent" data-user-id="515757">Luke Boswell</span> <a href="#narrow/stream/231634-beginners/topic/Compiler.20seems.20extremely.20slow.20on.20some.20code/near/454801757">said</a>:</p>
<blockquote>
<p>It could maybe be related to all  the refcounting and other fixes that Brendan fixed recently. All available on the TESTING nightly and basic-cli 0.13.0 if you would like to test that</p>
</blockquote>
<p>Ah yes, thanks, I'll give this a shot.</p>



<a name="454802163"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Compiler%20seems%20extremely%20slow%20on%20some%20code/near/454802163" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Compiler.20seems.20extremely.20slow.20on.20some.20code.html#454802163">(Jul 29 2024 at 11:24)</a>:</h4>
<p>Ah, ok... so if you run <code>roc check</code> you will see there are issues</p>



<a name="454802351"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Compiler%20seems%20extremely%20slow%20on%20some%20code/near/454802351" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Compiler.20seems.20extremely.20slow.20on.20some.20code.html#454802351">(Jul 29 2024 at 11:25)</a>:</h4>
<p>check exits earlier in the compiler pipeline so its giving us the problem reports, whereras build is getting stuck trying to resolve stuff that is definitely broken.</p>



<a name="454802449"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Compiler%20seems%20extremely%20slow%20on%20some%20code/near/454802449" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Compiler.20seems.20extremely.20slow.20on.20some.20code.html#454802449">(Jul 29 2024 at 11:25)</a>:</h4>
<p>I think you just need to add an <code>import cli.Task exposing [Task]</code> and that will fix your issue here</p>



<a name="454802658"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Compiler%20seems%20extremely%20slow%20on%20some%20code/near/454802658" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Compiler.20seems.20extremely.20slow.20on.20some.20code.html#454802658">(Jul 29 2024 at 11:26)</a>:</h4>
<p>Or maybe not...</p>



<a name="454802916"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Compiler%20seems%20extremely%20slow%20on%20some%20code/near/454802916" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Aurélien Geron <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Compiler.20seems.20extremely.20slow.20on.20some.20code.html#454802916">(Jul 29 2024 at 11:27)</a>:</h4>
<p>The only issues reported by <code>roc check</code> were warnings about the fact that <code>part1 = \input -&gt; "not implemented"</code> does not use the variable <code>input</code>. I replaced this with <code>part1 = \_ -&gt; "not implemented"</code> and now <code>roc check</code> gives me no warning or errors.</p>



<a name="454802998"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Compiler%20seems%20extremely%20slow%20on%20some%20code/near/454802998" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Aurélien Geron <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Compiler.20seems.20extremely.20slow.20on.20some.20code.html#454802998">(Jul 29 2024 at 11:27)</a>:</h4>
<p>I'm using <code>roc nightly pre-release, built from commit 070d14a on Sat Jul 13 09:01:57 UTC 2024</code></p>



<a name="454803378"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Compiler%20seems%20extremely%20slow%20on%20some%20code/near/454803378" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Aurélien Geron <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Compiler.20seems.20extremely.20slow.20on.20some.20code.html#454803378">(Jul 29 2024 at 11:29)</a>:</h4>
<p>I also tried to change the import as you said, but it didn't fix the issue. I'll try basic-cli 0.13, as you suggested (probably tomorrow because it's pretty late here in Auckland). Cheers!</p>



<a name="454803614"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Compiler%20seems%20extremely%20slow%20on%20some%20code/near/454803614" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Compiler.20seems.20extremely.20slow.20on.20some.20code.html#454803614">(Jul 29 2024 at 11:30)</a>:</h4>
<p>So this kind of issue isn't totally uncommon. I find it's almost always trying to do some kind of alias or type analysis on broken code and stuck in a loop. So I find going through and adding type annotations to "pin" the types can help the compiler tell me where the issue is</p>



<a name="454811693"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Compiler%20seems%20extremely%20slow%20on%20some%20code/near/454811693" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Compiler.20seems.20extremely.20slow.20on.20some.20code.html#454811693">(Jul 29 2024 at 11:55)</a>:</h4>
<p>Yeah, so there's definitely a bug in here somewhere related to composition of Tasks. It may be related to unifying error tags, or the way we are desugaring the <code>!</code>, or some other bug. I spent a while trying to minify it, but haven't been able to isolate it.</p>
<p>This is what I was using... basically just added type annotations. </p>
<div class="codehilite"><pre><span></span><code>app [main] { cli: platform &quot;https://github.com/roc-lang/basic-cli/releases/download/0.13.0/nW9yMRtZuCYf1Oa9vbE5XoirMwzLbtoSgv7NGhUlqYA.tar.br&quot; }

import cli.Stdout
import cli.Task
import cli.Arg
import cli.File
import cli.Utc
import cli.Task exposing [Task]

dataPath : U64 -&gt; Str
dataPath = \day -&gt;
    &quot;data/day$(if day &lt; 10 then &quot;0&quot; else &quot;&quot;)$(Num.toStr day).txt&quot;

loadData : U64 -&gt; Task Str _
loadData = \day -&gt;
    day
    |&gt; dataPath
    |&gt; File.readUtf8
    |&gt; Task.mapErr UnableToReadFile

solutions : List (Str -&gt; Str, Str -&gt; Str)
solutions = [
    (\i -&gt; i,\i -&gt; i),
]

runSolution : (Str -&gt; Str), U64, Str -&gt; Task {} []_
runSolution = \solution, index, input -&gt;
    Stdout.line! &quot;Part $(Num.toStr index):&quot;
    startTime = Utc.now!
    result = solution input
    endTime = Utc.now!
    delta = Utc.deltaAsMillis startTime endTime |&gt; Num.toStr
    Stdout.line! &quot;$(result) ($(delta)ms)&quot;

checkDay : U64 -&gt; Task {} [InvalidDay Str]_
checkDay = \day -&gt;
    if day &lt; 1 || day &gt; 25 then Task.err (InvalidDay &quot;Must be between 1 and 25&quot;) else Task.ok {}

runDay : Str -&gt; Task {} []_
runDay = \dayArg -&gt;
    day = Str.toU64 dayArg |&gt; Task.fromResult!
    checkDay! day
    Stdout.line! &quot;Day $(Num.toStr day)&quot;
    input = loadData! day
    (part1, part2) = List.get solutions (day - 1) |&gt; Task.fromResult!
    runSolution! part1 1 input
    runSolution! part2 2 input

main =
    args = Arg.list! {}
    daysStr = if List.len args &lt; 2 then List.range { start: At 1, end: At 25 } |&gt; List.map Num.toStr else args |&gt; List.dropFirst 1
    _ = daysStr |&gt; List.map runDay |&gt; List.reverse |&gt; Task.sequence!
    Task.ok {}
</code></pre></div>



<a name="454873417"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Compiler%20seems%20extremely%20slow%20on%20some%20code/near/454873417" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Compiler.20seems.20extremely.20slow.20on.20some.20code.html#454873417">(Jul 29 2024 at 15:53)</a>:</h4>
<p>Just to clarify this, no matter the result of any extra analysis done here, this is definitely a compiler bug as well.</p>



<a name="455056047"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Compiler%20seems%20extremely%20slow%20on%20some%20code/near/455056047" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Compiler.20seems.20extremely.20slow.20on.20some.20code.html#455056047">(Jul 30 2024 at 07:46)</a>:</h4>
<p>I'm not sure I found the root of the problem... but I certainly a fix. </p>
<p>I suspected the <code>Task.sequence</code> as I haven't really seen that used much. </p>
<p>I applied <span class="user-mention" data-user-id="343810">@Brendan Hansknecht</span>'s <code>Task.loop</code> implementation on the Task as builtin branch and this runs really nicely.</p>



<a name="455056302"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Compiler%20seems%20extremely%20slow%20on%20some%20code/near/455056302" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Compiler.20seems.20extremely.20slow.20on.20some.20code.html#455056302">(Jul 30 2024 at 07:48)</a>:</h4>
<p>I'll see if the same fix also works with current basic-cli.</p>
<p>I'm not sure we want to make another intermediate release, I think I'd rather just upgrade to builtin-task.</p>



<a name="455057111"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Compiler%20seems%20extremely%20slow%20on%20some%20code/near/455057111" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Compiler.20seems.20extremely.20slow.20on.20some.20code.html#455057111">(Jul 30 2024 at 07:53)</a>:</h4>
<p>Yes also works on basic-cli</p>



<a name="455057650"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Compiler%20seems%20extremely%20slow%20on%20some%20code/near/455057650" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Compiler.20seems.20extremely.20slow.20on.20some.20code.html#455057650">(Jul 30 2024 at 07:57)</a>:</h4>
<p>Here is a draft PR with the fix <a href="https://github.com/roc-lang/basic-cli/pull/236">https://github.com/roc-lang/basic-cli/pull/236</a></p>



<a name="455057822"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Compiler%20seems%20extremely%20slow%20on%20some%20code/near/455057822" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Compiler.20seems.20extremely.20slow.20on.20some.20code.html#455057822">(Jul 30 2024 at 07:58)</a>:</h4>
<p>If anyone would like this, you can build from source by cloning basic-cli on that branch, and then just <code>roc build.roc</code> will do the rest. Just remember to reference the platform using a local relative path instead of a URL.</p>



<a name="455059368"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Compiler%20seems%20extremely%20slow%20on%20some%20code/near/455059368" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Aurélien Geron <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Compiler.20seems.20extremely.20slow.20on.20some.20code.html#455059368">(Jul 30 2024 at 08:04)</a>:</h4>
<p>I just tested, it works fine indeed, thanks again. Note, I did not have to compile from source, I just copied the definition of <code>sequence</code> from the PR into my file and used that instead of <code>Task.sequence</code>. In case anyone else wants to go that route:</p>
<div class="codehilite" data-code-language="Elm"><pre><span></span><code><span class="nv">sequence</span><span class="w"> </span><span class="nf">=</span><span class="w"> </span><span class="nf">\</span><span class="nv">taskList</span><span class="w"> </span><span class="nf">-&gt;</span>
<span class="w">    </span><span class="kt">Task</span><span class="nf">.</span><span class="nv">loop</span><span class="w"> </span><span class="p">(</span><span class="nv">taskList</span><span class="p">,</span><span class="w"> </span><span class="kt">List</span><span class="nf">.</span><span class="nv">withCapacity</span><span class="w"> </span><span class="p">(</span><span class="kt">List</span><span class="nf">.</span><span class="nv">len</span><span class="w"> </span><span class="nv">taskList</span><span class="p">))</span><span class="w"> </span><span class="nf">\</span><span class="p">(</span><span class="nv">tasks</span><span class="p">,</span><span class="w"> </span><span class="nv">values</span><span class="p">)</span><span class="w"> </span><span class="nf">-&gt;</span>
<span class="w">        </span><span class="nv">when</span><span class="w"> </span><span class="nv">tasks</span><span class="w"> </span><span class="nv">is</span>
<span class="w">            </span><span class="p">[</span><span class="nv">task</span><span class="p">,</span><span class="w"> </span><span class="nf">..</span><span class="w"> </span><span class="kr">as</span><span class="w"> </span><span class="nv">rest</span><span class="p">]</span><span class="w"> </span><span class="nf">-&gt;</span>
<span class="w">                </span><span class="nv">value</span><span class="w"> </span><span class="nf">=</span><span class="w"> </span><span class="nv">task</span><span class="err">!</span>
<span class="w">                </span><span class="kt">Task</span><span class="nf">.</span><span class="nv">ok</span><span class="w"> </span><span class="p">(</span><span class="kt">Step</span><span class="w"> </span><span class="p">(</span><span class="nv">rest</span><span class="p">,</span><span class="w"> </span><span class="kt">List</span><span class="nf">.</span><span class="nv">append</span><span class="w"> </span><span class="nv">values</span><span class="w"> </span><span class="nv">value</span><span class="p">))</span>

<span class="w">            </span><span class="p">[]</span><span class="w"> </span><span class="nf">-&gt;</span>
<span class="w">                </span><span class="kt">Task</span><span class="nf">.</span><span class="nv">ok</span><span class="w"> </span><span class="p">(</span><span class="kt">Done</span><span class="w"> </span><span class="nv">values</span><span class="p">)</span>
</code></pre></div>



<a name="455059629"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Compiler%20seems%20extremely%20slow%20on%20some%20code/near/455059629" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Compiler.20seems.20extremely.20slow.20on.20some.20code.html#455059629">(Jul 30 2024 at 08:05)</a>:</h4>
<p>Oh nice. Was that modifying the version in your cache?</p>



<a name="455064958"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Compiler%20seems%20extremely%20slow%20on%20some%20code/near/455064958" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Aurélien Geron <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Compiler.20seems.20extremely.20slow.20on.20some.20code.html#455064958">(Jul 30 2024 at 08:31)</a>:</h4>
<p>I'm sorry, I'm not sure I understand your question. What is the cache you are referring to? I only edited <code>main.roc</code> and added the <code>sequence</code> def there. I had to revert to basic-cli 0.12 because I was getting this error with 0.13:</p>
<div class="codehilite"><pre><span></span><code>roc_app_binary(18551,0x7ff844aa6fc0) malloc: *** error for object 0x7fb44c905b78: pointer being freed was not allocated
roc_app_binary(18551,0x7ff844aa6fc0) malloc: *** set a breakpoint in malloc_error_break to debug
</code></pre></div>



<a name="455067593"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Compiler%20seems%20extremely%20slow%20on%20some%20code/near/455067593" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Compiler.20seems.20extremely.20slow.20on.20some.20code.html#455067593">(Jul 30 2024 at 08:41)</a>:</h4>
<p>Oh ok. That also works too. </p>
<p>I was talking about editing the platform implementation in the downloaded files. When you use a URL package roc downloads and put the .roc files into your .cache folder. So, you might also be able to patch it there. I think the check against files hashing correctly is only at the time when it's first downloaded and put in .cache</p>



<hr><p>Last updated: Nov 01 2025 at 12:13 UTC</p>
</html>