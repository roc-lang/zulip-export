<html>
<head><meta charset="utf-8"><title>Nonempty list · beginners · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/index.html">beginners</a></h2>
<h3>Topic: <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Nonempty.20list.html">Nonempty list</a></h3>

<hr>

<base href="https://roc.zulipchat.com">

<head><link href="https://roc-lang.github.io/zulip-export/style.css" rel="stylesheet"></head>

<a name="289934921"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Nonempty%20list/near/289934921" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Martin Stewart <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Nonempty.20list.html#289934921">(Jul 18 2022 at 08:10)</a>:</h4>
<p>In Elm, if I were to define a nonempty list I'd probably write this <code>type NonemptyList a = NonemptyList a (List a)</code>. This way it's impossible to accidentally create one that is empty.</p>
<p>In Roc I could define it the same way but it seems like it would come at a significant performance cost? For example, </p>
<div class="codehilite" data-code-language="Elm"><pre><span></span><code><span class="kr">type</span><span class="w"> </span><span class="kt">NonemptyList</span><span class="w"> </span><span class="nv">a</span><span class="w"> </span><span class="nf">=</span><span class="w"> </span><span class="kt">NonemptyList</span><span class="w"> </span><span class="nv">a</span><span class="w"> </span><span class="p">(</span><span class="kt">List</span><span class="w"> </span><span class="nv">a</span><span class="p">)</span><span class="w"></span>

<span class="nv">toList</span><span class="w"> </span><span class="nf">:</span><span class="w"> </span><span class="kt">NonemptyList</span><span class="w"> </span><span class="nv">a</span><span class="w"> </span><span class="nf">-&gt;</span><span class="w"> </span><span class="kt">List</span><span class="w"> </span><span class="nv">a</span><span class="w"></span>
<span class="nv">toList</span><span class="w"> </span><span class="nf">\</span><span class="p">(</span><span class="kt">NonemptyList</span><span class="w"> </span><span class="nv">first</span><span class="w"> </span><span class="nv">rest</span><span class="p">)</span><span class="w"> </span><span class="nf">-&gt;</span><span class="w"></span>
<span class="w">    </span><span class="c1">-- Adding an item to the start of the list is slow</span><span class="w"></span>
<span class="w">    </span><span class="kt">List</span><span class="nf">.</span><span class="nv">cons</span><span class="w"> </span><span class="nv">first</span><span class="w"> </span><span class="nv">rest</span><span class="w"></span>

<span class="nv">reverse</span><span class="w"> </span><span class="nf">:</span><span class="w"> </span><span class="kt">NonemptyList</span><span class="w"> </span><span class="nv">a</span><span class="w"> </span><span class="nf">-&gt;</span><span class="w"> </span><span class="kt">NonemptyList</span><span class="w"> </span><span class="nv">a</span><span class="w"></span>
<span class="nv">reverse</span><span class="w"> </span><span class="nf">\</span><span class="p">(</span><span class="kt">NonemptyList</span><span class="w"> </span><span class="nv">first</span><span class="w"> </span><span class="nv">rest</span><span class="p">)</span><span class="w"> </span><span class="nf">-&gt;</span><span class="w"></span>
<span class="w">    </span><span class="c1">-- Adding an item to the start of the list is slow</span><span class="w"></span>
<span class="w">    </span><span class="nv">tempList</span><span class="w"> </span><span class="nf">=</span><span class="w"> </span><span class="kt">List</span><span class="nf">.</span><span class="nv">cons</span><span class="w"> </span><span class="nv">first</span><span class="w"> </span><span class="nv">rest</span><span class="w"> </span><span class="nf">|&gt;</span><span class="w"> </span><span class="kt">List</span><span class="nf">.</span><span class="nv">reverse</span><span class="w"></span>
<span class="w">    </span><span class="nv">when</span><span class="w"> </span><span class="kt">List</span><span class="nf">.</span><span class="nv">get</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="nv">tempList</span><span class="w"> </span><span class="nv">is</span><span class="w"></span>
<span class="w">        </span><span class="kt">Ok</span><span class="w"> </span><span class="nv">value</span><span class="w"> </span><span class="nf">-&gt;</span><span class="w"></span>
<span class="w">            </span><span class="c1">-- Removing one item from the end of the list is slow</span><span class="w"></span>
<span class="w">            </span><span class="kt">NonemptyList</span><span class="w"> </span><span class="nv">value</span><span class="w"> </span><span class="p">(</span><span class="kt">List</span><span class="nf">.</span><span class="nv">drop</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="nv">tempList</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="kt">Err</span><span class="w"> </span><span class="nv">_</span><span class="w"> </span><span class="nf">-&gt;</span><span class="w"></span>
<span class="w">            </span><span class="c1">-- This should never happen but I don't know how to prove it since we don't have list destructuring</span><span class="w"></span>
<span class="w">            </span><span class="p">(</span><span class="kt">NonemptyList</span><span class="w"> </span><span class="nv">first</span><span class="w"> </span><span class="nv">rest</span><span class="p">)</span><span class="w"></span>
</code></pre></div>
<p>My question is, would it make more sense to just implement nonempty list unsafely, i.e. <code>type NonemptyList a = NonemptyList (List a)</code> and then write tests to try catching any potential mistakes?</p>



<a name="289937663"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Nonempty%20list/near/289937663" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Qqwy / Marten <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Nonempty.20list.html#289937663">(Jul 18 2022 at 08:44)</a>:</h4>
<p>Ooh! Interesting idea!</p>



<a name="289938010"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Nonempty%20list/near/289938010" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Qqwy / Marten <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Nonempty.20list.html#289938010">(Jul 18 2022 at 08:49)</a>:</h4>
<p>It might be possible to express <code>NonemptyList</code> just as "an array which is guaranteed to not be empty", which would allow equivalents of the <code>List</code> functions that otherwise have to return a <code>Result</code> to be total (e.g. <code>first</code>, <code>last</code>) to return the success value always.</p>



<a name="289938236"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Nonempty%20list/near/289938236" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Qqwy / Marten <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Nonempty.20list.html#289938236">(Jul 18 2022 at 08:51)</a>:</h4>
<p>Another thing I was thinking about to try more generally to port  linked list-based algorithms to Roc, is to store the elements in reverse inside the underlying array: Appending is fast as reallocation only happens whenever the list size doubles, whereas prepending always requires moving all elements around.</p>



<a name="289938818"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Nonempty%20list/near/289938818" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Martin Stewart <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Nonempty.20list.html#289938818">(Jul 18 2022 at 08:57)</a>:</h4>
<p>Oh, I didn't realize that appending is fast with Roc arrays. In that case I could define my nonempty list as <code>type NonemptyList a = NonemptyList (List a) a</code></p>



<a name="289939541"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Nonempty%20list/near/289939541" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Nonempty.20list.html#289939541">(Jul 18 2022 at 09:05)</a>:</h4>
<p>yes</p>



<a name="289944024"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Nonempty%20list/near/289944024" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Martin Stewart <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Nonempty.20list.html#289944024">(Jul 18 2022 at 09:58)</a>:</h4>
<p>In that case, why can't Roc have list pattern matching like Elm has, only you'd be taking items off the end of the list instead of the start?</p>



<a name="289946130"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Nonempty%20list/near/289946130" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Qqwy / Marten <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Nonempty.20list.html#289946130">(Jul 18 2022 at 10:20)</a>:</h4>
<p>It definitely is possible to add pattern matching syntax for lists. It would be syntactic sugar over a combination of <code>List.sublist</code> + <code>List.get</code> where intermediate bounds checks could be removed in many cases.</p>
<p>There was some talk about this in the past, but no consensus yet. (This is a 'nice to have'; other things have higher priority right now.)<br>
One problem with introducing too liberal pattern matching options, is that people will start using them without considering the potential performance characteristics.<br>
Roc strives for "abstraction without sacrificing performance". In certain areas this is a tricky balancing act.</p>



<a name="289946332"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Nonempty%20list/near/289946332" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Martin Stewart <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Nonempty.20list.html#289946332">(Jul 18 2022 at 10:23)</a>:</h4>
<p>Yeah fair enough that it's a low implementation priority. But what do you mean by "One problem with introducing too liberal pattern matching options, is that people will start using them without considering the potential performance characteristics."? You wrote that list pattern matching would remove a bounds check so wouldn't this be faster?</p>



<a name="289946339"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Nonempty%20list/near/289946339" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Qqwy / Marten <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Nonempty.20list.html#289946339">(Jul 18 2022 at 10:23)</a>:</h4>
<p>For instance, consider <a href="https://play.rust-lang.org/?version=stable&amp;mode=debug&amp;edition=2018&amp;gist=baeec729aea945d2cd98387d1333ba8f">this Rust array-based pattern match example</a>. It is a very elegant-looking implementation of a palindrome checker. However, it is only fast because Rust has a separate abstraction for 'slices' (a cheap view of a subpart of an array using just a pointer + length).</p>



<a name="289946395"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Nonempty%20list/near/289946395" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Qqwy / Marten <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Nonempty.20list.html#289946395">(Jul 18 2022 at 10:24)</a>:</h4>
<p>Without slices, it would require a lot of copying of the underlying array.</p>



<a name="289946630"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Nonempty%20list/near/289946630" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Qqwy / Marten <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Nonempty.20list.html#289946630">(Jul 18 2022 at 10:27)</a>:</h4>
<p>So it is more about what you do with the result of matching in the pattern, than about the pattern matching itself.</p>



<a name="289946768"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Nonempty%20list/near/289946768" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Qqwy / Marten <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Nonempty.20list.html#289946768">(Jul 18 2022 at 10:28)</a>:</h4>
<p>Does that make sense? <span aria-label="blush" class="emoji emoji-1f60a" role="img" title="blush">:blush:</span></p>



<a name="289947009"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Nonempty%20list/near/289947009" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Martin Stewart <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Nonempty.20list.html#289947009">(Jul 18 2022 at 10:31)</a>:</h4>
<p>Yeah, that makes sense. I think I'd still prefer to have list pattern matching even if it introduces a performance foot gun, since it only took me ~20 lines of code to end up with an unreachable pattern that I couldn't remove <span aria-label="sweat smile" class="emoji emoji-1f605" role="img" title="sweat smile">:sweat_smile:</span></p>



<a name="289947104"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Nonempty%20list/near/289947104" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Martin Stewart <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Nonempty.20list.html#289947104">(Jul 18 2022 at 10:32)</a>:</h4>
<p>Though to be clear, I'm not suggesting the user should be able to destruct a single item from the start of a list, only from the end.</p>



<a name="289966002"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Nonempty%20list/near/289966002" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Martin Stewart <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Nonempty.20list.html#289966002">(Jul 18 2022 at 13:37)</a>:</h4>
<p>Never mind, it occurred to me that my nonempty list example isn’t a good motivating use case for list pattern matching since this would be something where I’d want it to run as fast as possible and therefore I wouldn’t be able to use the list pattern match anyway</p>



<a name="289966266"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Nonempty%20list/near/289966266" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Nonempty.20list.html#289966266">(Jul 18 2022 at 13:39)</a>:</h4>
<p>yes I wanted to ask: can't you (easily?) express the logic in terms of map/keepIf/walk?</p>



<a name="289977613"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Nonempty%20list/near/289977613" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Nonempty.20list.html#289977613">(Jul 18 2022 at 15:01)</a>:</h4>
<p>Also, we do plan to add slices eventually, which would fix the performance foot gun (at least to some extent)</p>



<a name="289984037"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Nonempty%20list/near/289984037" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Martin Stewart <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Nonempty.20list.html#289984037">(Jul 18 2022 at 15:45)</a>:</h4>
<p><span class="user-mention silent" data-user-id="281543">Folkert de Vries</span> <a href="#narrow/stream/231634-beginners/topic/Nonempty.20list/near/289966266">said</a>:</p>
<blockquote>
<p>yes I wanted to ask: can't you (easily?) express the logic in terms of map/keepIf/walk?</p>
</blockquote>
<p>True, folding over the list would work too. I used List.reverse because I figured it would be super optimised and maybe doing a fold (I'm guessing List.foldl in Elm is List.walk in Roc?) wouldn't be as efficient</p>



<a name="289992519"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Nonempty%20list/near/289992519" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Nonempty.20list.html#289992519">(Jul 18 2022 at 16:49)</a>:</h4>
<p>Hmm. That's an interesting note on API.</p>
<p>Reverse is actually quite costly because it does the actual work of reversing the list and doesn't just recreate a reverse iterator (or similar).</p>
<p>Looping over the list with fold or map or etc, would likely be much more efficient.</p>



<a name="289992594"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Nonempty%20list/near/289992594" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Nonempty.20list.html#289992594">(Jul 18 2022 at 16:49)</a>:</h4>
<p>Also, if we don't already have <code>walkReverse</code> we should definitely add it.</p>



<a name="289992613"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Nonempty%20list/near/289992613" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Nonempty.20list.html#289992613">(Jul 18 2022 at 16:49)</a>:</h4>
<p>note here is the definition of reverse </p>
<div class="codehilite"><pre><span></span><code>reverse : List a -&gt; List a
reverse = \list -&gt;
    reverseHelp list 0 (Num.subSaturated (List.len list) 1)

reverseHelp = \list, left, right -&gt;
    if left &lt; right then
        reverseHelp (List.swap list left right) (left + 1) (right - 1)
    else
        list
</code></pre></div>



<a name="289992663"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Nonempty%20list/near/289992663" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Nonempty.20list.html#289992663">(Jul 18 2022 at 16:50)</a>:</h4>
<p>and <code>walkBackwards</code> is a thing</p>



<a name="290081821"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Nonempty%20list/near/290081821" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Martin Stewart <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Nonempty.20list.html#290081821">(Jul 19 2022 at 10:57)</a>:</h4>
<p>I got Roc running on my Macbook and decided to try writing NonemptyList for real. Here's the result:</p>
<div class="spoiler-block"><div class="spoiler-header">
<p>NonemptyList</p>
</div><div class="spoiler-content" aria-hidden="true">
<div class="codehilite" data-code-language="Elm"><pre><span></span><code><span class="nv">app</span><span class="w"> </span><span class="s">"helloZig"</span><span class="w"></span>
<span class="w">    </span><span class="nv">packages</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nv">pf</span><span class="nf">:</span><span class="w"> </span><span class="s">"main.roc"</span><span class="w"> </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="nv">imports</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="kt">Result</span><span class="w"> </span><span class="p">]</span><span class="w"></span>
<span class="w">    </span><span class="nv">provides</span><span class="w"> </span><span class="p">[</span><span class="nv">main</span><span class="p">]</span><span class="w"> </span><span class="nv">to</span><span class="w"> </span><span class="nv">pf</span><span class="w"></span>


<span class="kt">NonemptyList</span><span class="w"> </span><span class="nf">:=</span><span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="w"> </span><span class="nv">rest</span><span class="nf">:</span><span class="w"> </span><span class="p">(</span><span class="kt">List</span><span class="w"> </span><span class="kt">Str</span><span class="p">),</span><span class="w"> </span><span class="nv">lastItem</span><span class="nf">:</span><span class="w"> </span><span class="kt">Str</span><span class="w"> </span><span class="p">}</span><span class="w"></span>


<span class="nv">toList</span><span class="w"> </span><span class="nf">:</span><span class="w"> </span><span class="kt">NonemptyList</span><span class="w"> </span><span class="nf">-&gt;</span><span class="w"> </span><span class="kt">List</span><span class="w"> </span><span class="kt">Str</span><span class="w"></span>
<span class="nv">toList</span><span class="w"> </span><span class="nf">=</span><span class="w"> </span><span class="nf">\</span><span class="err">@</span><span class="kt">NonemptyList</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nv">rest</span><span class="p">,</span><span class="w"> </span><span class="nv">lastItem</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="nf">-&gt;</span><span class="w"></span>
<span class="w">    </span><span class="kt">List</span><span class="nf">.</span><span class="nv">append</span><span class="w"> </span><span class="nv">rest</span><span class="w"> </span><span class="nv">lastItem</span><span class="w"></span>


<span class="nv">fromList</span><span class="w"> </span><span class="nf">:</span><span class="w"> </span><span class="kt">List</span><span class="w"> </span><span class="kt">Str</span><span class="w"> </span><span class="nf">-&gt;</span><span class="w"> </span><span class="kt">Result</span><span class="w"> </span><span class="kt">NonemptyList</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="kt">OutOfBounds</span><span class="w"> </span><span class="p">]</span><span class="nf">*</span><span class="w"></span>
<span class="nv">fromList</span><span class="w"> </span><span class="nf">=</span><span class="w"> </span><span class="nf">\</span><span class="nv">list</span><span class="w"> </span><span class="nf">-&gt;</span><span class="w"></span>
<span class="w">    </span><span class="nv">when</span><span class="w"> </span><span class="kt">List</span><span class="nf">.</span><span class="nv">get</span><span class="w"> </span><span class="nv">list</span><span class="w"> </span><span class="p">(</span><span class="kt">List</span><span class="nf">.</span><span class="nv">len</span><span class="w"> </span><span class="nv">list</span><span class="w"> </span><span class="nf">-</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="nv">is</span><span class="w"></span>
<span class="w">        </span><span class="kt">Ok</span><span class="w"> </span><span class="nv">value</span><span class="w"> </span><span class="nf">-&gt;</span><span class="w"></span>
<span class="w">            </span><span class="err">@</span><span class="kt">NonemptyList</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nv">rest</span><span class="nf">:</span><span class="w"> </span><span class="kt">List</span><span class="nf">.</span><span class="nv">dropLast</span><span class="w"> </span><span class="nv">list</span><span class="p">,</span><span class="w"> </span><span class="nv">lastItem</span><span class="nf">:</span><span class="w"> </span><span class="nv">value</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="nf">|&gt;</span><span class="w"> </span><span class="kt">Ok</span><span class="w"></span>

<span class="w">        </span><span class="kt">Err</span><span class="w"> </span><span class="nv">error</span><span class="w"> </span><span class="nf">-&gt;</span><span class="w"></span>
<span class="w">            </span><span class="kt">Err</span><span class="w"> </span><span class="nv">error</span><span class="w"></span>


<span class="nv">fromSingle</span><span class="w"> </span><span class="nf">:</span><span class="w"> </span><span class="kt">Str</span><span class="w"> </span><span class="nf">-&gt;</span><span class="w"> </span><span class="kt">NonemptyList</span><span class="w"></span>
<span class="nv">fromSingle</span><span class="w"> </span><span class="nf">=</span><span class="w"> </span><span class="nf">\</span><span class="nv">item</span><span class="w"> </span><span class="nf">-&gt;</span><span class="w"></span>
<span class="w">    </span><span class="err">@</span><span class="kt">NonemptyList</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nv">rest</span><span class="nf">:</span><span class="w"> </span><span class="p">[],</span><span class="w"> </span><span class="nv">lastItem</span><span class="nf">:</span><span class="w"> </span><span class="nv">item</span><span class="w"> </span><span class="p">}</span><span class="w"></span>


<span class="nv">from</span><span class="w"> </span><span class="nf">:</span><span class="w"> </span><span class="kt">List</span><span class="w"> </span><span class="kt">Str</span><span class="p">,</span><span class="w"> </span><span class="kt">Str</span><span class="w"> </span><span class="nf">-&gt;</span><span class="w"> </span><span class="kt">NonemptyList</span><span class="w"></span>
<span class="nv">from</span><span class="w"> </span><span class="nf">=</span><span class="w"> </span><span class="nf">\</span><span class="nv">rest</span><span class="p">,</span><span class="w"> </span><span class="nv">lastItem</span><span class="w"> </span><span class="nf">-&gt;</span><span class="w"></span>
<span class="w">    </span><span class="err">@</span><span class="kt">NonemptyList</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nv">rest</span><span class="nf">:</span><span class="w"> </span><span class="nv">rest</span><span class="p">,</span><span class="w"> </span><span class="nv">lastItem</span><span class="nf">:</span><span class="w"> </span><span class="nv">lastItem</span><span class="w"> </span><span class="p">}</span><span class="w"></span>


<span class="nv">len</span><span class="w"> </span><span class="nf">:</span><span class="w"> </span><span class="kt">NonemptyList</span><span class="w"> </span><span class="nf">-&gt;</span><span class="w"> </span><span class="kt">Nat</span><span class="w"></span>
<span class="nv">len</span><span class="w"> </span><span class="nf">=</span><span class="w"> </span><span class="nf">\</span><span class="err">@</span><span class="kt">NonemptyList</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nv">rest</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="nf">-&gt;</span><span class="w"></span>
<span class="w">    </span><span class="kt">List</span><span class="nf">.</span><span class="nv">len</span><span class="w"> </span><span class="nv">rest</span><span class="w"> </span><span class="nf">+</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>


<span class="nv">get</span><span class="w"> </span><span class="nf">:</span><span class="w"> </span><span class="kt">NonemptyList</span><span class="p">,</span><span class="w"> </span><span class="kt">Nat</span><span class="w"> </span><span class="nf">-&gt;</span><span class="w"> </span><span class="kt">Result</span><span class="w"> </span><span class="kt">Str</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="kt">OutOfBounds</span><span class="w"> </span><span class="p">]</span><span class="nf">*</span><span class="w"></span>
<span class="nv">get</span><span class="w"> </span><span class="nf">=</span><span class="w"> </span><span class="nf">\</span><span class="nv">nonempty</span><span class="p">,</span><span class="w"> </span><span class="nv">index</span><span class="w"> </span><span class="nf">-&gt;</span><span class="w"></span>
<span class="w">    </span><span class="p">(</span><span class="err">@</span><span class="kt">NonemptyList</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nv">rest</span><span class="p">,</span><span class="w"> </span><span class="nv">lastItem</span><span class="w"> </span><span class="p">})</span><span class="w"> </span><span class="nf">=</span><span class="w"> </span><span class="nv">nonempty</span><span class="w"></span>
<span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nv">index</span><span class="w"> </span><span class="nf">==</span><span class="w"> </span><span class="nv">len</span><span class="w"> </span><span class="nv">nonempty</span><span class="w"> </span><span class="nf">-</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="kr">then</span><span class="w"></span>
<span class="w">        </span><span class="kt">Ok</span><span class="w"> </span><span class="nv">lastItem</span><span class="w"></span>
<span class="w">    </span><span class="kr">else</span><span class="w"></span>
<span class="w">        </span><span class="kt">List</span><span class="nf">.</span><span class="nv">get</span><span class="w"> </span><span class="nv">rest</span><span class="w"> </span><span class="p">(</span><span class="kt">Num</span><span class="nf">.</span><span class="nv">subSaturated</span><span class="w"> </span><span class="nv">index</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"></span>


<span class="nv">set</span><span class="w"> </span><span class="nf">:</span><span class="w"> </span><span class="kt">NonemptyList</span><span class="p">,</span><span class="w"> </span><span class="kt">Nat</span><span class="p">,</span><span class="w"> </span><span class="kt">Str</span><span class="w"> </span><span class="nf">-&gt;</span><span class="w"> </span><span class="kt">NonemptyList</span><span class="w"></span>
<span class="nv">set</span><span class="w"> </span><span class="nf">=</span><span class="w"> </span><span class="nf">\</span><span class="nv">nonempty</span><span class="p">,</span><span class="w"> </span><span class="nv">index</span><span class="p">,</span><span class="w"> </span><span class="nv">value</span><span class="w"> </span><span class="nf">-&gt;</span><span class="w"></span>
<span class="w">    </span><span class="p">(</span><span class="err">@</span><span class="kt">NonemptyList</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nv">rest</span><span class="p">,</span><span class="w"> </span><span class="nv">lastItem</span><span class="w"> </span><span class="p">})</span><span class="w"> </span><span class="nf">=</span><span class="w"> </span><span class="nv">nonempty</span><span class="w"></span>
<span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nv">index</span><span class="w"> </span><span class="nf">==</span><span class="w"> </span><span class="nv">len</span><span class="w"> </span><span class="nv">nonempty</span><span class="w"> </span><span class="nf">-</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="kr">then</span><span class="w"></span>
<span class="w">        </span><span class="err">@</span><span class="kt">NonemptyList</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nv">rest</span><span class="nf">:</span><span class="w"> </span><span class="nv">rest</span><span class="p">,</span><span class="w"> </span><span class="nv">lastItem</span><span class="nf">:</span><span class="w"> </span><span class="nv">value</span><span class="w"> </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="kr">else</span><span class="w"></span>
<span class="w">        </span><span class="p">{</span><span class="w"> </span><span class="nv">rest</span><span class="nf">:</span><span class="w"> </span><span class="kt">List</span><span class="nf">.</span><span class="nv">set</span><span class="w"> </span><span class="nv">rest</span><span class="w"> </span><span class="p">(</span><span class="kt">Num</span><span class="nf">.</span><span class="nv">subSaturated</span><span class="w"> </span><span class="nv">index</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="nv">value</span><span class="p">,</span><span class="w"> </span><span class="nv">lastItem</span><span class="nf">:</span><span class="w"> </span><span class="nv">lastItem</span><span class="w"> </span><span class="p">}</span><span class="w"></span>
<span class="w">            </span><span class="nf">|&gt;</span><span class="w"> </span><span class="err">@</span><span class="kt">NonemptyList</span><span class="w"></span>


<span class="nv">first</span><span class="w"> </span><span class="nf">:</span><span class="w"> </span><span class="kt">NonemptyList</span><span class="w"> </span><span class="nf">-&gt;</span><span class="w"> </span><span class="kt">Str</span><span class="w"></span>
<span class="nv">first</span><span class="w"> </span><span class="nf">=</span><span class="w"> </span><span class="nf">\</span><span class="p">(</span><span class="err">@</span><span class="kt">NonemptyList</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nv">rest</span><span class="p">,</span><span class="w"> </span><span class="nv">lastItem</span><span class="w"> </span><span class="p">})</span><span class="w"> </span><span class="nf">-&gt;</span><span class="w"></span>
<span class="w">    </span><span class="kt">List</span><span class="nf">.</span><span class="nv">first</span><span class="w"> </span><span class="nv">rest</span><span class="w"> </span><span class="nf">|&gt;</span><span class="w"> </span><span class="kt">Result</span><span class="nf">.</span><span class="nv">withDefault</span><span class="w"> </span><span class="nv">lastItem</span><span class="w"></span>


<span class="nv">last</span><span class="w"> </span><span class="nf">:</span><span class="w"> </span><span class="kt">NonemptyList</span><span class="w"> </span><span class="nf">-&gt;</span><span class="w"> </span><span class="kt">Str</span><span class="w"></span>
<span class="nv">last</span><span class="w"> </span><span class="nf">=</span><span class="w"> </span><span class="nf">\</span><span class="p">(</span><span class="err">@</span><span class="kt">NonemptyList</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nv">lastItem</span><span class="w"> </span><span class="p">})</span><span class="w"> </span><span class="nf">-&gt;</span><span class="w"></span>
<span class="w">    </span><span class="nv">lastItem</span><span class="w"></span>


<span class="nv">dropLast</span><span class="w"> </span><span class="nf">:</span><span class="w"> </span><span class="kt">NonemptyList</span><span class="w"> </span><span class="nf">-&gt;</span><span class="w"> </span><span class="kt">List</span><span class="w"> </span><span class="kt">Str</span><span class="w"></span>
<span class="nv">dropLast</span><span class="w"> </span><span class="nf">=</span><span class="w"> </span><span class="nf">\</span><span class="p">(</span><span class="err">@</span><span class="kt">NonemptyList</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nv">rest</span><span class="w"> </span><span class="p">})</span><span class="w"> </span><span class="nf">-&gt;</span><span class="w"></span>
<span class="w">    </span><span class="nv">rest</span><span class="w"></span>


<span class="nv">swap</span><span class="w"> </span><span class="nf">:</span><span class="w"> </span><span class="kt">NonemptyList</span><span class="p">,</span><span class="w"> </span><span class="kt">Nat</span><span class="p">,</span><span class="w"> </span><span class="kt">Nat</span><span class="w"> </span><span class="nf">-&gt;</span><span class="w"> </span><span class="kt">NonemptyList</span><span class="w"></span>
<span class="nv">swap</span><span class="w"> </span><span class="nf">=</span><span class="w"> </span><span class="nf">\</span><span class="nv">nonempty</span><span class="p">,</span><span class="w"> </span><span class="nv">left</span><span class="p">,</span><span class="w"> </span><span class="nv">right</span><span class="w"> </span><span class="nf">-&gt;</span><span class="w"></span>
<span class="w">    </span><span class="p">(</span><span class="err">@</span><span class="kt">NonemptyList</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nv">rest</span><span class="p">,</span><span class="w"> </span><span class="nv">lastItem</span><span class="w"> </span><span class="p">})</span><span class="w"> </span><span class="nf">=</span><span class="w"> </span><span class="nv">nonempty</span><span class="w"></span>
<span class="w">    </span><span class="nv">lastIndex</span><span class="w"> </span><span class="nf">=</span><span class="w"> </span><span class="nv">len</span><span class="w"> </span><span class="nv">nonempty</span><span class="w"> </span><span class="nf">-</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nv">left</span><span class="w"> </span><span class="err">!</span><span class="nf">=</span><span class="w"> </span><span class="nv">lastIndex</span><span class="w"> </span><span class="nf">&amp;&amp;</span><span class="w"> </span><span class="nv">right</span><span class="w"> </span><span class="err">!</span><span class="nf">=</span><span class="w"> </span><span class="nv">lastIndex</span><span class="w"> </span><span class="kr">then</span><span class="w"></span>
<span class="w">        </span><span class="err">@</span><span class="kt">NonemptyList</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nv">rest</span><span class="nf">:</span><span class="w"> </span><span class="kt">List</span><span class="nf">.</span><span class="nv">swap</span><span class="w"> </span><span class="nv">rest</span><span class="w"> </span><span class="nv">left</span><span class="w"> </span><span class="nv">right</span><span class="p">,</span><span class="w"> </span><span class="nv">lastItem</span><span class="nf">:</span><span class="w"> </span><span class="nv">lastItem</span><span class="w"> </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="kr">else</span><span class="w"> </span><span class="kr">if</span><span class="w"> </span><span class="nv">left</span><span class="w"> </span><span class="err">!</span><span class="nf">=</span><span class="w"> </span><span class="nv">lastIndex</span><span class="w"> </span><span class="kr">then</span><span class="w"></span>
<span class="w">        </span><span class="nv">when</span><span class="w"> </span><span class="kt">List</span><span class="nf">.</span><span class="nv">get</span><span class="w"> </span><span class="nv">rest</span><span class="w"> </span><span class="nv">left</span><span class="w"> </span><span class="nv">is</span><span class="w"></span>
<span class="w">            </span><span class="kt">Ok</span><span class="w"> </span><span class="nv">leftValue</span><span class="w"> </span><span class="nf">-&gt;</span><span class="w"></span>
<span class="w">                </span><span class="err">@</span><span class="kt">NonemptyList</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nv">rest</span><span class="nf">:</span><span class="w"> </span><span class="kt">List</span><span class="nf">.</span><span class="nv">set</span><span class="w"> </span><span class="nv">rest</span><span class="w"> </span><span class="nv">left</span><span class="w"> </span><span class="nv">lastItem</span><span class="p">,</span><span class="w"> </span><span class="nv">lastItem</span><span class="nf">:</span><span class="w"> </span><span class="nv">leftValue</span><span class="w"> </span><span class="p">}</span><span class="w"></span>

<span class="w">            </span><span class="kt">Err</span><span class="w"> </span><span class="nv">_</span><span class="w"> </span><span class="nf">-&gt;</span><span class="w"></span>
<span class="w">                </span><span class="nv">nonempty</span><span class="w"></span>

<span class="w">    </span><span class="kr">else</span><span class="w"> </span><span class="kr">if</span><span class="w"> </span><span class="nv">right</span><span class="w"> </span><span class="err">!</span><span class="nf">=</span><span class="w"> </span><span class="nv">lastIndex</span><span class="w"> </span><span class="kr">then</span><span class="w"></span>
<span class="w">        </span><span class="nv">when</span><span class="w"> </span><span class="kt">List</span><span class="nf">.</span><span class="nv">get</span><span class="w"> </span><span class="nv">rest</span><span class="w"> </span><span class="nv">right</span><span class="w"> </span><span class="nv">is</span><span class="w"></span>
<span class="w">            </span><span class="kt">Ok</span><span class="w"> </span><span class="nv">rightValue</span><span class="w"> </span><span class="nf">-&gt;</span><span class="w"></span>
<span class="w">                </span><span class="err">@</span><span class="kt">NonemptyList</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nv">rest</span><span class="nf">:</span><span class="w"> </span><span class="kt">List</span><span class="nf">.</span><span class="nv">set</span><span class="w"> </span><span class="nv">rest</span><span class="w"> </span><span class="nv">right</span><span class="w"> </span><span class="nv">lastItem</span><span class="p">,</span><span class="w"> </span><span class="nv">lastItem</span><span class="nf">:</span><span class="w"> </span><span class="nv">rightValue</span><span class="w"> </span><span class="p">}</span><span class="w"></span>

<span class="w">            </span><span class="kt">Err</span><span class="w"> </span><span class="nv">_</span><span class="w"> </span><span class="nf">-&gt;</span><span class="w"></span>
<span class="w">                </span><span class="nv">nonempty</span><span class="w"></span>

<span class="w">    </span><span class="kr">else</span><span class="w"></span>
<span class="w">        </span><span class="nv">nonempty</span><span class="w"></span>


<span class="nv">reverse</span><span class="w"> </span><span class="nf">:</span><span class="w"> </span><span class="kt">NonemptyList</span><span class="w"> </span><span class="nf">-&gt;</span><span class="w"> </span><span class="kt">NonemptyList</span><span class="w"></span>
<span class="nv">reverse</span><span class="w"> </span><span class="nf">=</span><span class="w"> </span><span class="nf">\</span><span class="nv">nonempty</span><span class="w"> </span><span class="nf">-&gt;</span><span class="w"></span>
<span class="w">    </span><span class="nv">reverseHelp</span><span class="w"> </span><span class="nv">nonempty</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">(</span><span class="kt">Num</span><span class="nf">.</span><span class="nv">subSaturated</span><span class="w"> </span><span class="p">(</span><span class="nv">len</span><span class="w"> </span><span class="nv">nonempty</span><span class="p">)</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"></span>


<span class="nv">reverseHelp</span><span class="w"> </span><span class="nf">:</span><span class="w"> </span><span class="kt">NonemptyList</span><span class="p">,</span><span class="w"> </span><span class="kt">Nat</span><span class="p">,</span><span class="w"> </span><span class="kt">Nat</span><span class="w"> </span><span class="nf">-&gt;</span><span class="w"> </span><span class="kt">NonemptyList</span><span class="w"></span>
<span class="nv">reverseHelp</span><span class="w"> </span><span class="nf">=</span><span class="w"> </span><span class="nf">\</span><span class="nv">nonempty</span><span class="p">,</span><span class="w"> </span><span class="nv">left</span><span class="p">,</span><span class="w"> </span><span class="nv">right</span><span class="w"> </span><span class="nf">-&gt;</span><span class="w"></span>
<span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nv">left</span><span class="w"> </span><span class="nf">&lt;</span><span class="w"> </span><span class="nv">right</span><span class="w"> </span><span class="kr">then</span><span class="w"></span>
<span class="w">        </span><span class="nv">reverseHelp</span><span class="w"> </span><span class="p">(</span><span class="nv">swap</span><span class="w"> </span><span class="nv">nonempty</span><span class="w"> </span><span class="nv">left</span><span class="w"> </span><span class="nv">right</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="nv">left</span><span class="w"> </span><span class="nf">+</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="nv">right</span><span class="w"> </span><span class="nf">-</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="kr">else</span><span class="w"></span>
<span class="w">        </span><span class="nv">nonempty</span><span class="w"></span>


<span class="kr">main </span><span class="nf">=</span><span class="w"></span>
<span class="w">    </span><span class="nv">from</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="s">"D"</span><span class="p">,</span><span class="w"> </span><span class="s">"C"</span><span class="p">,</span><span class="w"> </span><span class="s">"B"</span><span class="w"> </span><span class="p">]</span><span class="w"> </span><span class="s">"A"</span><span class="w"> </span><span class="nf">|&gt;</span><span class="w"> </span><span class="nv">reverse</span><span class="w"> </span><span class="nf">|&gt;</span><span class="w"> </span><span class="nv">toList</span><span class="w"> </span><span class="nf">|&gt;</span><span class="w"> </span><span class="kt">Str</span><span class="nf">.</span><span class="nv">joinWith</span><span class="w"> </span><span class="s">", "</span><span class="w"></span>
</code></pre></div>
</div></div>
<p>I couldn't figure out how to add type variables so for now NonemptyList can only contain Str. Also the reverse function probably isn't optimal. It does a lot of unneeded checks.</p>



<a name="290086176"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Nonempty%20list/near/290086176" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Qqwy / Marten <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Nonempty.20list.html#290086176">(Jul 19 2022 at 11:40)</a>:</h4>
<p>To add type variables you can write the definition as <code>NonemptyList a := { rest: (List a), lastItem: a }</code></p>



<a name="290086851"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Nonempty%20list/near/290086851" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Qqwy / Marten <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Nonempty.20list.html#290086851">(Jul 19 2022 at 11:47)</a>:</h4>
<p>Some other tips:</p>
<ul>
<li>You probably can use <code>List.reverse</code> inside your implementation of <code>reverse</code>.</li>
<li>Maybe you can build <code>swap</code> on top of <code>get</code> and <code>set</code>. I'm not sure whether there are performance benefits from implementing it directly (I think that it is quite likely that LLVM is able to optimize both versions equally well, but this is only an educated guess).</li>
</ul>



<a name="290087201"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Nonempty%20list/near/290087201" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Qqwy / Marten <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Nonempty.20list.html#290087201">(Jul 19 2022 at 11:50)</a>:</h4>
<p>And if you want it to be even more usable, implement <code>iterate</code>. Following that, you can implement <code>walk</code>, <code>walkUntil</code>, <code>find</code>, and many others on top of that. See <a href="https://github.com/rtfeldman/roc/blob/trunk/crates/compiler/builtins/roc/List.roc">the source for List itself</a> for more inspiration. Only the functions which have a type signature without an implementation are implemented as "native builtins", the others are built on top of those inside Roc itself.</p>



<a name="290087462"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Nonempty%20list/near/290087462" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Martin Stewart <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Nonempty.20list.html#290087462">(Jul 19 2022 at 11:53)</a>:</h4>
<p><span class="user-mention silent" data-user-id="508003">Qqwy / Marten</span> <a href="#narrow/stream/231634-beginners/topic/Nonempty.20list/near/290086176">said</a>:</p>
<blockquote>
<p>To add type variables you can write the definition as <code>NonemptyList a := { rest: (List a), lastItem: a }</code></p>
</blockquote>
<p>That's what I tried but I got an error message that I didn't understand</p>



<a name="290087570"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Nonempty%20list/near/290087570" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anton <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Nonempty.20list.html#290087570">(Jul 19 2022 at 11:54)</a>:</h4>
<p>You're welcome to share the error message :)</p>



<a name="290087742"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Nonempty%20list/near/290087742" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Martin Stewart <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Nonempty.20list.html#290087742">(Jul 19 2022 at 11:57)</a>:</h4>
<p>Here's the code with type vars</p>
<div class="spoiler-block"><div class="spoiler-header">
<p>Code</p>
</div><div class="spoiler-content" aria-hidden="true">
<div class="codehilite" data-code-language="Elm"><pre><span></span><code><span class="nv">app</span><span class="w"> </span><span class="s">"helloZig"</span><span class="w"></span>
<span class="w">    </span><span class="nv">packages</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nv">pf</span><span class="nf">:</span><span class="w"> </span><span class="s">"main.roc"</span><span class="w"> </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="nv">imports</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="kt">Result</span><span class="w"> </span><span class="p">]</span><span class="w"></span>
<span class="w">    </span><span class="nv">provides</span><span class="w"> </span><span class="p">[</span><span class="nv">main</span><span class="p">]</span><span class="w"> </span><span class="nv">to</span><span class="w"> </span><span class="nv">pf</span><span class="w"></span>


<span class="kt">NonemptyList</span><span class="w"> </span><span class="nv">a</span><span class="w"> </span><span class="nf">:=</span><span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="w"> </span><span class="nv">rest</span><span class="nf">:</span><span class="w"> </span><span class="p">(</span><span class="kt">List</span><span class="w"> </span><span class="nv">a</span><span class="p">),</span><span class="w"> </span><span class="nv">lastItem</span><span class="nf">:</span><span class="w"> </span><span class="nv">a</span><span class="w"> </span><span class="p">}</span><span class="w"></span>


<span class="nv">toList</span><span class="w"> </span><span class="nf">:</span><span class="w"> </span><span class="kt">NonemptyList</span><span class="w"> </span><span class="nv">a</span><span class="w"> </span><span class="nf">-&gt;</span><span class="w"> </span><span class="kt">List</span><span class="w"> </span><span class="nv">a</span><span class="w"></span>
<span class="nv">toList</span><span class="w"> </span><span class="nf">=</span><span class="w"> </span><span class="nf">\</span><span class="err">@</span><span class="kt">NonemptyList</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nv">rest</span><span class="p">,</span><span class="w"> </span><span class="nv">lastItem</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="nf">-&gt;</span><span class="w"></span>
<span class="w">    </span><span class="kt">List</span><span class="nf">.</span><span class="nv">append</span><span class="w"> </span><span class="nv">rest</span><span class="w"> </span><span class="nv">lastItem</span><span class="w"></span>


<span class="nv">fromList</span><span class="w"> </span><span class="nf">:</span><span class="w"> </span><span class="kt">List</span><span class="w"> </span><span class="nv">a</span><span class="w"> </span><span class="nf">-&gt;</span><span class="w"> </span><span class="kt">Result</span><span class="w"> </span><span class="p">(</span><span class="kt">NonemptyList</span><span class="w"> </span><span class="nv">a</span><span class="p">)</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="kt">OutOfBounds</span><span class="w"> </span><span class="p">]</span><span class="nf">*</span><span class="w"></span>
<span class="nv">fromList</span><span class="w"> </span><span class="nf">=</span><span class="w"> </span><span class="nf">\</span><span class="nv">list</span><span class="w"> </span><span class="nf">-&gt;</span><span class="w"></span>
<span class="w">    </span><span class="nv">when</span><span class="w"> </span><span class="kt">List</span><span class="nf">.</span><span class="nv">get</span><span class="w"> </span><span class="nv">list</span><span class="w"> </span><span class="p">(</span><span class="kt">List</span><span class="nf">.</span><span class="nv">len</span><span class="w"> </span><span class="nv">list</span><span class="w"> </span><span class="nf">-</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="nv">is</span><span class="w"></span>
<span class="w">        </span><span class="kt">Ok</span><span class="w"> </span><span class="nv">value</span><span class="w"> </span><span class="nf">-&gt;</span><span class="w"></span>
<span class="w">            </span><span class="err">@</span><span class="kt">NonemptyList</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nv">rest</span><span class="nf">:</span><span class="w"> </span><span class="kt">List</span><span class="nf">.</span><span class="nv">dropLast</span><span class="w"> </span><span class="nv">list</span><span class="p">,</span><span class="w"> </span><span class="nv">lastItem</span><span class="nf">:</span><span class="w"> </span><span class="nv">value</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="nf">|&gt;</span><span class="w"> </span><span class="kt">Ok</span><span class="w"></span>

<span class="w">        </span><span class="kt">Err</span><span class="w"> </span><span class="nv">error</span><span class="w"> </span><span class="nf">-&gt;</span><span class="w"></span>
<span class="w">            </span><span class="kt">Err</span><span class="w"> </span><span class="nv">error</span><span class="w"></span>


<span class="nv">fromSingle</span><span class="w"> </span><span class="nf">:</span><span class="w"> </span><span class="nv">a</span><span class="w"> </span><span class="nf">-&gt;</span><span class="w"> </span><span class="kt">NonemptyList</span><span class="w"> </span><span class="nv">a</span><span class="w"></span>
<span class="nv">fromSingle</span><span class="w"> </span><span class="nf">=</span><span class="w"> </span><span class="nf">\</span><span class="nv">item</span><span class="w"> </span><span class="nf">-&gt;</span><span class="w"></span>
<span class="w">    </span><span class="err">@</span><span class="kt">NonemptyList</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nv">rest</span><span class="nf">:</span><span class="w"> </span><span class="p">[],</span><span class="w"> </span><span class="nv">lastItem</span><span class="nf">:</span><span class="w"> </span><span class="nv">item</span><span class="w"> </span><span class="p">}</span><span class="w"></span>


<span class="nv">from</span><span class="w"> </span><span class="nf">:</span><span class="w"> </span><span class="kt">List</span><span class="w"> </span><span class="nv">a</span><span class="p">,</span><span class="w"> </span><span class="nv">a</span><span class="w"> </span><span class="nf">-&gt;</span><span class="w"> </span><span class="kt">NonemptyList</span><span class="w"> </span><span class="nv">a</span><span class="w"></span>
<span class="nv">from</span><span class="w"> </span><span class="nf">=</span><span class="w"> </span><span class="nf">\</span><span class="nv">rest</span><span class="p">,</span><span class="w"> </span><span class="nv">lastItem</span><span class="w"> </span><span class="nf">-&gt;</span><span class="w"></span>
<span class="w">    </span><span class="err">@</span><span class="kt">NonemptyList</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nv">rest</span><span class="nf">:</span><span class="w"> </span><span class="nv">rest</span><span class="p">,</span><span class="w"> </span><span class="nv">lastItem</span><span class="nf">:</span><span class="w"> </span><span class="nv">lastItem</span><span class="w"> </span><span class="p">}</span><span class="w"></span>


<span class="nv">len</span><span class="w"> </span><span class="nf">:</span><span class="w"> </span><span class="kt">NonemptyList</span><span class="w"> </span><span class="nv">a</span><span class="w"> </span><span class="nf">-&gt;</span><span class="w"> </span><span class="kt">Nat</span><span class="w"></span>
<span class="nv">len</span><span class="w"> </span><span class="nf">=</span><span class="w"> </span><span class="nf">\</span><span class="err">@</span><span class="kt">NonemptyList</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nv">rest</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="nf">-&gt;</span><span class="w"></span>
<span class="w">    </span><span class="kt">List</span><span class="nf">.</span><span class="nv">len</span><span class="w"> </span><span class="nv">rest</span><span class="w"> </span><span class="nf">+</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>


<span class="nv">get</span><span class="w"> </span><span class="nf">:</span><span class="w"> </span><span class="kt">NonemptyList</span><span class="w"> </span><span class="nv">a</span><span class="p">,</span><span class="w"> </span><span class="kt">Nat</span><span class="w"> </span><span class="nf">-&gt;</span><span class="w"> </span><span class="kt">Result</span><span class="w"> </span><span class="nv">a</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="kt">OutOfBounds</span><span class="w"> </span><span class="p">]</span><span class="nf">*</span><span class="w"></span>
<span class="nv">get</span><span class="w"> </span><span class="nf">=</span><span class="w"> </span><span class="nf">\</span><span class="nv">nonempty</span><span class="p">,</span><span class="w"> </span><span class="nv">index</span><span class="w"> </span><span class="nf">-&gt;</span><span class="w"></span>
<span class="w">    </span><span class="p">(</span><span class="err">@</span><span class="kt">NonemptyList</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nv">rest</span><span class="p">,</span><span class="w"> </span><span class="nv">lastItem</span><span class="w"> </span><span class="p">})</span><span class="w"> </span><span class="nf">=</span><span class="w"> </span><span class="nv">nonempty</span><span class="w"></span>
<span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nv">index</span><span class="w"> </span><span class="nf">==</span><span class="w"> </span><span class="nv">len</span><span class="w"> </span><span class="nv">nonempty</span><span class="w"> </span><span class="nf">-</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="kr">then</span><span class="w"></span>
<span class="w">        </span><span class="kt">Ok</span><span class="w"> </span><span class="nv">lastItem</span><span class="w"></span>
<span class="w">    </span><span class="kr">else</span><span class="w"></span>
<span class="w">        </span><span class="kt">List</span><span class="nf">.</span><span class="nv">get</span><span class="w"> </span><span class="nv">rest</span><span class="w"> </span><span class="p">(</span><span class="kt">Num</span><span class="nf">.</span><span class="nv">subSaturated</span><span class="w"> </span><span class="nv">index</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"></span>


<span class="nv">set</span><span class="w"> </span><span class="nf">:</span><span class="w"> </span><span class="kt">NonemptyList</span><span class="w"> </span><span class="nv">a</span><span class="p">,</span><span class="w"> </span><span class="kt">Nat</span><span class="p">,</span><span class="w"> </span><span class="nv">a</span><span class="w"> </span><span class="nf">-&gt;</span><span class="w"> </span><span class="kt">NonemptyList</span><span class="w"> </span><span class="nv">a</span><span class="w"></span>
<span class="nv">set</span><span class="w"> </span><span class="nf">=</span><span class="w"> </span><span class="nf">\</span><span class="nv">nonempty</span><span class="p">,</span><span class="w"> </span><span class="nv">index</span><span class="p">,</span><span class="w"> </span><span class="nv">value</span><span class="w"> </span><span class="nf">-&gt;</span><span class="w"></span>
<span class="w">    </span><span class="p">(</span><span class="err">@</span><span class="kt">NonemptyList</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nv">rest</span><span class="p">,</span><span class="w"> </span><span class="nv">lastItem</span><span class="w"> </span><span class="p">})</span><span class="w"> </span><span class="nf">=</span><span class="w"> </span><span class="nv">nonempty</span><span class="w"></span>
<span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nv">index</span><span class="w"> </span><span class="nf">==</span><span class="w"> </span><span class="nv">len</span><span class="w"> </span><span class="nv">nonempty</span><span class="w"> </span><span class="nf">-</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="kr">then</span><span class="w"></span>
<span class="w">        </span><span class="err">@</span><span class="kt">NonemptyList</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nv">rest</span><span class="nf">:</span><span class="w"> </span><span class="nv">rest</span><span class="p">,</span><span class="w"> </span><span class="nv">lastItem</span><span class="nf">:</span><span class="w"> </span><span class="nv">value</span><span class="w"> </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="kr">else</span><span class="w"></span>
<span class="w">        </span><span class="p">{</span><span class="w"> </span><span class="nv">rest</span><span class="nf">:</span><span class="w"> </span><span class="kt">List</span><span class="nf">.</span><span class="nv">set</span><span class="w"> </span><span class="nv">rest</span><span class="w"> </span><span class="p">(</span><span class="kt">Num</span><span class="nf">.</span><span class="nv">subSaturated</span><span class="w"> </span><span class="nv">index</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="nv">value</span><span class="p">,</span><span class="w"> </span><span class="nv">lastItem</span><span class="nf">:</span><span class="w"> </span><span class="nv">lastItem</span><span class="w"> </span><span class="p">}</span><span class="w"></span>
<span class="w">            </span><span class="nf">|&gt;</span><span class="w"> </span><span class="err">@</span><span class="kt">NonemptyList</span><span class="w"></span>


<span class="nv">first</span><span class="w"> </span><span class="nf">:</span><span class="w"> </span><span class="kt">NonemptyList</span><span class="w"> </span><span class="nv">a</span><span class="w"> </span><span class="nf">-&gt;</span><span class="w"> </span><span class="nv">a</span><span class="w"></span>
<span class="nv">first</span><span class="w"> </span><span class="nf">=</span><span class="w"> </span><span class="nf">\</span><span class="p">(</span><span class="err">@</span><span class="kt">NonemptyList</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nv">rest</span><span class="p">,</span><span class="w"> </span><span class="nv">lastItem</span><span class="w"> </span><span class="p">})</span><span class="w"> </span><span class="nf">-&gt;</span><span class="w"></span>
<span class="w">    </span><span class="kt">List</span><span class="nf">.</span><span class="nv">first</span><span class="w"> </span><span class="nv">rest</span><span class="w"> </span><span class="nf">|&gt;</span><span class="w"> </span><span class="kt">Result</span><span class="nf">.</span><span class="nv">withDefault</span><span class="w"> </span><span class="nv">lastItem</span><span class="w"></span>


<span class="nv">last</span><span class="w"> </span><span class="nf">:</span><span class="w"> </span><span class="kt">NonemptyList</span><span class="w"> </span><span class="nv">a</span><span class="w"> </span><span class="nf">-&gt;</span><span class="w"> </span><span class="nv">a</span><span class="w"></span>
<span class="nv">last</span><span class="w"> </span><span class="nf">=</span><span class="w"> </span><span class="nf">\</span><span class="p">(</span><span class="err">@</span><span class="kt">NonemptyList</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nv">lastItem</span><span class="w"> </span><span class="p">})</span><span class="w"> </span><span class="nf">-&gt;</span><span class="w"></span>
<span class="w">    </span><span class="nv">lastItem</span><span class="w"></span>


<span class="nv">dropLast</span><span class="w"> </span><span class="nf">:</span><span class="w"> </span><span class="kt">NonemptyList</span><span class="w"> </span><span class="nv">a</span><span class="w"> </span><span class="nf">-&gt;</span><span class="w"> </span><span class="kt">List</span><span class="w"> </span><span class="nv">a</span><span class="w"></span>
<span class="nv">dropLast</span><span class="w"> </span><span class="nf">=</span><span class="w"> </span><span class="nf">\</span><span class="p">(</span><span class="err">@</span><span class="kt">NonemptyList</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nv">rest</span><span class="w"> </span><span class="p">})</span><span class="w"> </span><span class="nf">-&gt;</span><span class="w"></span>
<span class="w">    </span><span class="nv">rest</span><span class="w"></span>


<span class="nv">swap</span><span class="w"> </span><span class="nf">:</span><span class="w"> </span><span class="kt">NonemptyList</span><span class="w"> </span><span class="nv">a</span><span class="p">,</span><span class="w"> </span><span class="kt">Nat</span><span class="p">,</span><span class="w"> </span><span class="kt">Nat</span><span class="w"> </span><span class="nf">-&gt;</span><span class="w"> </span><span class="kt">NonemptyList</span><span class="w"> </span><span class="nv">a</span><span class="w"></span>
<span class="nv">swap</span><span class="w"> </span><span class="nf">=</span><span class="w"> </span><span class="nf">\</span><span class="nv">nonempty</span><span class="p">,</span><span class="w"> </span><span class="nv">left</span><span class="p">,</span><span class="w"> </span><span class="nv">right</span><span class="w"> </span><span class="nf">-&gt;</span><span class="w"></span>
<span class="w">    </span><span class="p">(</span><span class="err">@</span><span class="kt">NonemptyList</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nv">rest</span><span class="p">,</span><span class="w"> </span><span class="nv">lastItem</span><span class="w"> </span><span class="p">})</span><span class="w"> </span><span class="nf">=</span><span class="w"> </span><span class="nv">nonempty</span><span class="w"></span>
<span class="w">    </span><span class="nv">lastIndex</span><span class="w"> </span><span class="nf">=</span><span class="w"> </span><span class="nv">len</span><span class="w"> </span><span class="nv">nonempty</span><span class="w"> </span><span class="nf">-</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nv">left</span><span class="w"> </span><span class="err">!</span><span class="nf">=</span><span class="w"> </span><span class="nv">lastIndex</span><span class="w"> </span><span class="nf">&amp;&amp;</span><span class="w"> </span><span class="nv">right</span><span class="w"> </span><span class="err">!</span><span class="nf">=</span><span class="w"> </span><span class="nv">lastIndex</span><span class="w"> </span><span class="kr">then</span><span class="w"></span>
<span class="w">        </span><span class="err">@</span><span class="kt">NonemptyList</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nv">rest</span><span class="nf">:</span><span class="w"> </span><span class="kt">List</span><span class="nf">.</span><span class="nv">swap</span><span class="w"> </span><span class="nv">rest</span><span class="w"> </span><span class="nv">left</span><span class="w"> </span><span class="nv">right</span><span class="p">,</span><span class="w"> </span><span class="nv">lastItem</span><span class="nf">:</span><span class="w"> </span><span class="nv">lastItem</span><span class="w"> </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="kr">else</span><span class="w"> </span><span class="kr">if</span><span class="w"> </span><span class="nv">left</span><span class="w"> </span><span class="err">!</span><span class="nf">=</span><span class="w"> </span><span class="nv">lastIndex</span><span class="w"> </span><span class="kr">then</span><span class="w"></span>
<span class="w">        </span><span class="nv">when</span><span class="w"> </span><span class="kt">List</span><span class="nf">.</span><span class="nv">get</span><span class="w"> </span><span class="nv">rest</span><span class="w"> </span><span class="nv">left</span><span class="w"> </span><span class="nv">is</span><span class="w"></span>
<span class="w">            </span><span class="kt">Ok</span><span class="w"> </span><span class="nv">leftValue</span><span class="w"> </span><span class="nf">-&gt;</span><span class="w"></span>
<span class="w">                </span><span class="err">@</span><span class="kt">NonemptyList</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nv">rest</span><span class="nf">:</span><span class="w"> </span><span class="kt">List</span><span class="nf">.</span><span class="nv">set</span><span class="w"> </span><span class="nv">rest</span><span class="w"> </span><span class="nv">left</span><span class="w"> </span><span class="nv">lastItem</span><span class="p">,</span><span class="w"> </span><span class="nv">lastItem</span><span class="nf">:</span><span class="w"> </span><span class="nv">leftValue</span><span class="w"> </span><span class="p">}</span><span class="w"></span>

<span class="w">            </span><span class="kt">Err</span><span class="w"> </span><span class="nv">_</span><span class="w"> </span><span class="nf">-&gt;</span><span class="w"></span>
<span class="w">                </span><span class="nv">nonempty</span><span class="w"></span>

<span class="w">    </span><span class="kr">else</span><span class="w"> </span><span class="kr">if</span><span class="w"> </span><span class="nv">right</span><span class="w"> </span><span class="err">!</span><span class="nf">=</span><span class="w"> </span><span class="nv">lastIndex</span><span class="w"> </span><span class="kr">then</span><span class="w"></span>
<span class="w">        </span><span class="nv">when</span><span class="w"> </span><span class="kt">List</span><span class="nf">.</span><span class="nv">get</span><span class="w"> </span><span class="nv">rest</span><span class="w"> </span><span class="nv">right</span><span class="w"> </span><span class="nv">is</span><span class="w"></span>
<span class="w">            </span><span class="kt">Ok</span><span class="w"> </span><span class="nv">rightValue</span><span class="w"> </span><span class="nf">-&gt;</span><span class="w"></span>
<span class="w">                </span><span class="err">@</span><span class="kt">NonemptyList</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nv">rest</span><span class="nf">:</span><span class="w"> </span><span class="kt">List</span><span class="nf">.</span><span class="nv">set</span><span class="w"> </span><span class="nv">rest</span><span class="w"> </span><span class="nv">right</span><span class="w"> </span><span class="nv">lastItem</span><span class="p">,</span><span class="w"> </span><span class="nv">lastItem</span><span class="nf">:</span><span class="w"> </span><span class="nv">rightValue</span><span class="w"> </span><span class="p">}</span><span class="w"></span>

<span class="w">            </span><span class="kt">Err</span><span class="w"> </span><span class="nv">_</span><span class="w"> </span><span class="nf">-&gt;</span><span class="w"></span>
<span class="w">                </span><span class="nv">nonempty</span><span class="w"></span>

<span class="w">    </span><span class="kr">else</span><span class="w"></span>
<span class="w">        </span><span class="nv">nonempty</span><span class="w"></span>


<span class="nv">reverse</span><span class="w"> </span><span class="nf">:</span><span class="w"> </span><span class="kt">NonemptyList</span><span class="w"> </span><span class="nv">a</span><span class="w"> </span><span class="nf">-&gt;</span><span class="w"> </span><span class="kt">NonemptyList</span><span class="w"> </span><span class="nv">a</span><span class="w"></span>
<span class="nv">reverse</span><span class="w"> </span><span class="nf">=</span><span class="w"> </span><span class="nf">\</span><span class="nv">nonempty</span><span class="w"> </span><span class="nf">-&gt;</span><span class="w"></span>
<span class="w">    </span><span class="nv">reverseHelp</span><span class="w"> </span><span class="nv">nonempty</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">(</span><span class="kt">Num</span><span class="nf">.</span><span class="nv">subSaturated</span><span class="w"> </span><span class="p">(</span><span class="nv">len</span><span class="w"> </span><span class="nv">nonempty</span><span class="p">)</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"></span>


<span class="nv">reverseHelp</span><span class="w"> </span><span class="nf">:</span><span class="w"> </span><span class="kt">NonemptyList</span><span class="w"> </span><span class="nv">a</span><span class="p">,</span><span class="w"> </span><span class="kt">Nat</span><span class="p">,</span><span class="w"> </span><span class="kt">Nat</span><span class="w"> </span><span class="nf">-&gt;</span><span class="w"> </span><span class="kt">NonemptyList</span><span class="w"> </span><span class="nv">a</span><span class="w"></span>
<span class="nv">reverseHelp</span><span class="w"> </span><span class="nf">=</span><span class="w"> </span><span class="nf">\</span><span class="nv">nonempty</span><span class="p">,</span><span class="w"> </span><span class="nv">left</span><span class="p">,</span><span class="w"> </span><span class="nv">right</span><span class="w"> </span><span class="nf">-&gt;</span><span class="w"></span>
<span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nv">left</span><span class="w"> </span><span class="nf">&lt;</span><span class="w"> </span><span class="nv">right</span><span class="w"> </span><span class="kr">then</span><span class="w"></span>
<span class="w">        </span><span class="nv">reverseHelp</span><span class="w"> </span><span class="p">(</span><span class="nv">swap</span><span class="w"> </span><span class="nv">nonempty</span><span class="w"> </span><span class="nv">left</span><span class="w"> </span><span class="nv">right</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="nv">left</span><span class="w"> </span><span class="nf">+</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="nv">right</span><span class="w"> </span><span class="nf">-</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="kr">else</span><span class="w"></span>
<span class="w">        </span><span class="nv">nonempty</span><span class="w"></span>


<span class="kr">main </span><span class="nf">=</span><span class="w"></span>
<span class="w">    </span><span class="nv">from</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="s">"D"</span><span class="p">,</span><span class="w"> </span><span class="s">"C"</span><span class="p">,</span><span class="w"> </span><span class="s">"B"</span><span class="w"> </span><span class="p">]</span><span class="w"> </span><span class="s">"A"</span><span class="w"> </span><span class="nf">|&gt;</span><span class="w"> </span><span class="nv">reverse</span><span class="w"> </span><span class="nf">|&gt;</span><span class="w"> </span><span class="nv">toList</span><span class="w"> </span><span class="nf">|&gt;</span><span class="w"> </span><span class="nv">a</span><span class="nf">.</span><span class="nv">joinWith</span><span class="w"> </span><span class="s">", "</span><span class="w"></span>
</code></pre></div>
</div></div>
<p>and here's the error message</p>
<div class="codehilite"><pre><span></span><code>./roc examples/hello-world/zig-platform/helloZig.roc
thread &#39;&lt;unnamed&gt;&#39; panicked at &#39;index out of bounds: the len is 0 but the index is 0&#39;, compiler/mono/src/ir.rs:9147:35
note: run with `RUST_BACKTRACE=1` environment variable to display a backtrace
</code></pre></div>



<a name="290087863"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Nonempty%20list/near/290087863" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Martin Stewart <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Nonempty.20list.html#290087863">(Jul 19 2022 at 11:58)</a>:</h4>
<p>With RUST_BACKTRACE=1 </p>
<div class="codehilite"><pre><span></span><code>RUST_BACKTRACE=1 ./roc examples/hello-world/zig-platform/helloZig.roc
thread &#39;&lt;unnamed&gt;&#39; panicked at &#39;index out of bounds: the len is 0 but the index is 0&#39;, compiler/mono/src/ir.rs:9147:35
stack backtrace:
   0: _rust_begin_unwind
   1: core::panicking::panic_fmt
   2: core::panicking::panic_bounds_check
   3: roc_mono::ir::match_on_lambda_set
   4: roc_mono::ir::with_hole
   5: roc_mono::ir::from_can
   6: roc_mono::ir::specialize_variable_help
   7: roc_mono::ir::specialize_external_help
   8: roc_mono::ir::specialize_all
   9: roc_load_internal::file::run_task
  10: core::ops::function::FnOnce::call_once{{vtable.shim}}
note: Some details are omitted, run with `RUST_BACKTRACE=full` for a verbose backtrace.
</code></pre></div>



<a name="290087941"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Nonempty%20list/near/290087941" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anton <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Nonempty.20list.html#290087941">(Jul 19 2022 at 11:59)</a>:</h4>
<p>Can you make an issue for that? The compiler should never panic.<br>
If you have the time it would be great if you could minimize the code that reproduces the issue.</p>



<a name="290089009"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Nonempty%20list/near/290089009" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Martin Stewart <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Nonempty.20list.html#290089009">(Jul 19 2022 at 12:09)</a>:</h4>
<p><a href="https://github.com/rtfeldman/roc/issues/3584">https://github.com/rtfeldman/roc/issues/3584</a> I figured out the mistake too. I did a find+replace on Str -&gt; a but that messed up <code>Str.joinWith</code> so it became <code>a.joinWith</code>.</p>



<a name="290089263"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Nonempty%20list/near/290089263" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anton <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Nonempty.20list.html#290089263">(Jul 19 2022 at 12:12)</a>:</h4>
<p>Excellent, thanks for making the issue!</p>



<a name="290111537"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Nonempty%20list/near/290111537" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Martin Stewart <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Nonempty.20list.html#290111537">(Jul 19 2022 at 15:00)</a>:</h4>
<p>I've implemented nonempty versions of all the exposed List functions <a href="https://github.com/MartinSStewart/Nonempty">https://github.com/MartinSStewart/Nonempty</a>.</p>
<p>One exception is <code>List.range</code> which currently returns <code>[]</code> if you call it with something like this: <code>List.range 3 1</code>. I was wondering if it would make more sense to have it instead return <code>[ 3, 2, 1 ]</code>? The reason is that then <code>NonemptyList.range</code> could be guaranteed to always return a nonempty list.</p>



<a name="290112982"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Nonempty%20list/near/290112982" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jan kili <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Nonempty.20list.html#290112982">(Jul 19 2022 at 15:09)</a>:</h4>
<p><span class="user-mention" data-user-id="432314">@Martin Stewart</span> We discussed <code>List.range</code> boundaries in another stream earlier this month: <a href="#narrow/stream/231635-compiler-development/topic/List.2Erange.20boundaries/near/288637840">https://roc.zulipchat.com/#narrow/stream/231635-compiler-development/topic/List.2Erange.20boundaries/near/288637840</a></p>



<a name="290113067"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Nonempty%20list/near/290113067" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Martin Stewart <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Nonempty.20list.html#290113067">(Jul 19 2022 at 15:09)</a>:</h4>
<p>That link seems to be broken (or the conversation is private)?</p>



<a name="290113198"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Nonempty%20list/near/290113198" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jan kili <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Nonempty.20list.html#290113198">(Jul 19 2022 at 15:10)</a>:</h4>
<p>Yes that stream is private, and we did not reach a final conclusion. Idk who admins that "compiler development" stream, but I think access is granted automatically when you contribute to the compiler.</p>



<a name="290113271"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Nonempty%20list/near/290113271" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jan kili <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Nonempty.20list.html#290113271">(Jul 19 2022 at 15:11)</a>:</h4>
<p>The topic was a spin-off of another compiler-related discussion, but it probably should be moved out into public - <a class="stream" data-stream-id="304641" href="/#narrow/stream/304641-ideas">#ideas</a> maybe?</p>



<a name="290113305"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Nonempty%20list/near/290113305" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Martin Stewart <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Nonempty.20list.html#290113305">(Jul 19 2022 at 15:11)</a>:</h4>
<p>I'm guessing my one github issue doesn't count? <span aria-label="sweat smile" class="emoji emoji-1f605" role="img" title="sweat smile">:sweat_smile:</span></p>



<a name="290113347"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Nonempty%20list/near/290113347" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jan kili <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Nonempty.20list.html#290113347">(Jul 19 2022 at 15:11)</a>:</h4>
<p>Haha I guess not</p>



<a name="290113419"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Nonempty%20list/near/290113419" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jan kili <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Nonempty.20list.html#290113419">(Jul 19 2022 at 15:12)</a>:</h4>
<p>When my first compiler PR was merged I was invited</p>



<a name="290113483"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Nonempty%20list/near/290113483" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jan kili <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Nonempty.20list.html#290113483">(Jul 19 2022 at 15:12)</a>:</h4>
<p>The smoky back room where the llvm sausage gets made</p>



<a name="290113510"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Nonempty%20list/near/290113510" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jan kili <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Nonempty.20list.html#290113510">(Jul 19 2022 at 15:12)</a>:</h4>
<p>I don't understand half the words in there but it's fun to watch</p>



<a name="290113647"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Nonempty%20list/near/290113647" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Martin Stewart <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Nonempty.20list.html#290113647">(Jul 19 2022 at 15:13)</a>:</h4>
<p>Don't promote it too much or there's going to be hacktoberfest-esque PR spam from people in order to get in <span aria-label="stuck out tongue" class="emoji emoji-1f61b" role="img" title="stuck out tongue">:stuck_out_tongue:</span></p>



<a name="290113649"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Nonempty%20list/near/290113649" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jan kili <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Nonempty.20list.html#290113649">(Jul 19 2022 at 15:13)</a>:</h4>
<p>Can someone with Zulip powers please move that "<code>List.range</code> boundaries" topic into the appropriate public stream?</p>



<a name="290113832"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Nonempty%20list/near/290113832" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anton <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Nonempty.20list.html#290113832">(Jul 19 2022 at 15:15)</a>:</h4>
<p>I moved it to ideas</p>



<a name="290113852"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Nonempty%20list/near/290113852" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jan kili <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Nonempty.20list.html#290113852">(Jul 19 2022 at 15:15)</a>:</h4>
<p><span class="user-mention" data-user-id="361169">@Anton</span> you rock. <a href="#narrow/stream/304641-ideas/topic/List.2Erange.20boundaries/near/290113775">https://roc.zulipchat.com/#narrow/stream/304641-ideas/topic/List.2Erange.20boundaries/near/290113775</a></p>



<a name="290125893"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Nonempty%20list/near/290125893" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jan kili <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Nonempty.20list.html#290125893">(Jul 19 2022 at 16:32)</a>:</h4>
<p><span class="user-mention silent" data-user-id="508003">Qqwy / Marten</span> <a href="#narrow/stream/304641-ideas/topic/List.2Erange.20boundaries/near/290117288">said</a>:</p>
<blockquote>
<p>Unfortunately nothing prevents people from passing in ranges which are outside of the srange of the list, say <code>List.range [1,2,3] 20 100</code>.</p>
</blockquote>
<p>They meant <code>List.sublist</code>.<br>
This is a good point, <span class="user-mention" data-user-id="432314">@Martin Stewart</span>, will you return a <code>Result</code> from functions like <code>List.sublist</code>?</p>



<a name="290126170"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Nonempty%20list/near/290126170" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Martin Stewart <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Nonempty.20list.html#290126170">(Jul 19 2022 at 16:34)</a>:</h4>
<p><code>sublist : NonemptyList a, { start: Nat, len: Nat } -&gt; List a</code></p>
<p>In general, any List function that returns a sub list of the original list was converted to <code>NonemptyList a -&gt; List a</code></p>



<a name="290169557"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/Nonempty%20list/near/290169557" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/Nonempty.20list.html#290169557">(Jul 19 2022 at 22:29)</a>:</h4>
<p>I realized if list pattern matching existed, I would have used it in the demo I'm giving tomorrow: <a href="https://gist.github.com/rtfeldman/8c83efd5e9e091254e3f842f2be217b7">https://gist.github.com/rtfeldman/8c83efd5e9e091254e3f842f2be217b7</a></p>



<hr><p>Last updated: Nov 01 2025 at 12:13 UTC</p>
</html>