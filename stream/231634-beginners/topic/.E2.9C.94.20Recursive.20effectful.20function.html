<html>
<head><meta charset="utf-8"><title>✔ Recursive effectful function · beginners · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/index.html">beginners</a></h2>
<h3>Topic: <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/.E2.9C.94.20Recursive.20effectful.20function.html">✔ Recursive effectful function</a></h3>

<hr>

<base href="https://roc.zulipchat.com">

<head><link href="https://roc-lang.github.io/zulip-export/style.css" rel="stylesheet"></head>

<a name="547147988"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/%E2%9C%94%20Recursive%20effectful%20function/near/547147988" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Claude Précourt <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/.E2.9C.94.20Recursive.20effectful.20function.html#547147988">(Oct 26 2025 at 17:48)</a>:</h4>
<p>Hello!</p>
<p>I am writing a very simple tool which needs to walk a directory structure but I've hit a road block. I get this error :</p>
<div class="codehilite" data-code-language="Text only"><pre><span></span><code>This 2nd argument to |&gt; has an unexpected type:

27│                      Ok children -&gt; children |&gt; List.join_map(|child| walk_hierarchy!(child, depth + 1, hierarchy))
                                                                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

The argument is an anonymous function of type:

    Path.Path =&gt; List Str

But |&gt; needs its 2nd argument to be:

    InternalPath.InternalPath -&gt; List Str
</code></pre></div>
<p>and I suspect that the Path vs InternalPath isn't the issue but rather the fact that I should somehow make my "walk_hierarchy!" function non-effectful? </p>
<p>And this is my little bit a code :</p>
<div class="codehilite" data-code-language="Text only"><pre><span></span><code>app [main!] {
    cli: platform "https://github.com/roc-lang/basic-cli/releases/download/0.19.0/Hj-J_zxz7V9YurCSTFcFdu6cQJie4guzsPMUi5kBYUk.tar.br",
}

import cli.Arg
import cli.Stderr
import cli.Dir
import cli.Path

main! = |args|
    when List.get(args, 1) is
        Ok arg -&gt;
            root_path = Arg.display(arg) |&gt; Path.from_str
            _hierarchy = walk_hierarchy!(root_path, 0, [])
            Ok {}
        Err OutOfBounds -&gt;
            _ = Stderr.line!("Usage: archiveux PATH")
            Ok {}

walk_hierarchy! : Path.Path, U64, List Str =&gt; List Str
walk_hierarchy! = |root, depth, hierarchy|
    current_level = [Str.repeat("\t", depth) |&gt; Str.concat(Path.display(root))]
    subs = when Path.is_dir!(root) is
        Ok is_dir -&gt;
            if is_dir then
                when Path.list_dir!(root) is
                    Ok children -&gt; children |&gt; List.join_map(|child| walk_hierarchy!(child, depth + 1, hierarchy))
                    Err _ -&gt; []
            else
                current_level
        Err _ -&gt; []
    List.concat(hierarchy, subs)
</code></pre></div>
<p>Any hint would be welcome!</p>



<a name="547149138"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/%E2%9C%94%20Recursive%20effectful%20function/near/547149138" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/.E2.9C.94.20Recursive.20effectful.20function.html#547149138">(Oct 26 2025 at 18:04)</a>:</h4>
<p>The issue is fundamentally that <code>join_map</code> does not accept effectful functions. It would need to be <code>join_map!</code> to do so.</p>
<p>There likely should be an effectful version of that function</p>



<a name="547149261"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/%E2%9C%94%20Recursive%20effectful%20function/near/547149261" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/.E2.9C.94.20Recursive.20effectful.20function.html#547149261">(Oct 26 2025 at 18:05)</a>:</h4>
<p>Easiest solution is to write your own for now:</p>
<div class="codehilite" data-code-language="Ruby"><pre><span></span><code><span class="n">join_map!</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="no">List</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="n">a</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="no">List</span><span class="w"> </span><span class="n">b</span><span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="no">List</span><span class="w"> </span><span class="n">b</span>
<span class="n">join_map!</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">|</span><span class="n">list</span><span class="p">,</span><span class="w"> </span><span class="n">mapper</span><span class="o">|</span>
<span class="w">    </span><span class="no">List</span><span class="o">.</span><span class="n">walk!</span><span class="p">(</span><span class="n">list</span><span class="p">,</span><span class="w"> </span><span class="o">[]</span><span class="p">,</span><span class="w"> </span><span class="o">|</span><span class="n">state</span><span class="p">,</span><span class="w"> </span><span class="n">elem</span><span class="o">|</span><span class="w"> </span><span class="no">List</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">state</span><span class="p">,</span><span class="w"> </span><span class="n">mapper</span><span class="p">(</span><span class="n">elem</span><span class="p">)))</span>
</code></pre></div>



<a name="547149485"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/%E2%9C%94%20Recursive%20effectful%20function/near/547149485" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Claude Précourt <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/.E2.9C.94.20Recursive.20effectful.20function.html#547149485">(Oct 26 2025 at 18:08)</a>:</h4>
<p><del>Ha! Great, thanks! Or maybe to use <code>walk!</code> instead ?</del></p>



<a name="547149839"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/%E2%9C%94%20Recursive%20effectful%20function/near/547149839" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Claude Précourt <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/.E2.9C.94.20Recursive.20effectful.20function.html#547149839">(Oct 26 2025 at 18:13)</a>:</h4>
<p>Thank you so much! Worked like a charm. Just needed to add an exclamation point to the <code>mapper</code> arg to get rid of a warning.</p>



<a name="547150715"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/%E2%9C%94%20Recursive%20effectful%20function/near/547150715" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Notification Bot <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/.E2.9C.94.20Recursive.20effectful.20function.html#547150715">(Oct 26 2025 at 18:29)</a>:</h4>
<p><span class="user-mention silent" data-user-id="928710">Claude Précourt</span> has marked this topic as resolved.</p>



<a name="547256867"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/%E2%9C%94%20Recursive%20effectful%20function/near/547256867" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anton <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/.E2.9C.94.20Recursive.20effectful.20function.html#547256867">(Oct 27 2025 at 11:51)</a>:</h4>
<p>I added List.join_map! in <a href="https://github.com/roc-lang/roc/issues/8337">#8337</a></p>



<a name="547311311"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/%E2%9C%94%20Recursive%20effectful%20function/near/547311311" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Claude Précourt <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/.E2.9C.94.20Recursive.20effectful.20function.html#547311311">(Oct 27 2025 at 15:41)</a>:</h4>
<p>As if I didn't love this language enough already! <span aria-label="face holding back tears" class="emoji emoji-1f979" role="img" title="face holding back tears">:face_holding_back_tears:</span></p>



<a name="547311671"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/231634-beginners/topic/%E2%9C%94%20Recursive%20effectful%20function/near/547311671" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anton <a href="https://roc-lang.github.io/zulip-export/stream/231634-beginners/topic/.E2.9C.94.20Recursive.20effectful.20function.html#547311671">(Oct 27 2025 at 15:42)</a>:</h4>
<p>Thanks :)<br>
The new addition will be in tomorrow's <a href="https://github.com/roc-lang/roc/releases/tag/nightly">nightly</a></p>



<hr><p>Last updated: Nov 01 2025 at 12:13 UTC</p>
</html>