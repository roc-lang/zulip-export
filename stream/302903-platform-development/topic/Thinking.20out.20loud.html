<html>
<head><meta charset="utf-8"><title>Thinking out loud ¬∑ platform development ¬∑ Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://roc-lang.github.io/zulip-export/stream/302903-platform-development/index.html">platform development</a></h2>
<h3>Topic: <a href="https://roc-lang.github.io/zulip-export/stream/302903-platform-development/topic/Thinking.20out.20loud.html">Thinking out loud</a></h3>

<hr>

<base href="https://roc.zulipchat.com">

<head><link href="https://roc-lang.github.io/zulip-export/style.css" rel="stylesheet"></head>

<a name="256318339"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/302903-platform%20development/topic/Thinking%20out%20loud/near/256318339" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luis Gutierrez <a href="https://roc-lang.github.io/zulip-export/stream/302903-platform-development/topic/Thinking.20out.20loud.html#256318339">(Oct 05 2021 at 21:01)</a>:</h4>
<p>I‚Äôm going to do some thinking out loud here as I start to get my bearings by reading code and documentation. Feel free to chime in if you‚Äôd like, but I don‚Äôt have any expectation of community responsiveness.ÔøºÔøºÔøº</p>



<a name="256318888"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/302903-platform%20development/topic/Thinking%20out%20loud/near/256318888" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luis Gutierrez <a href="https://roc-lang.github.io/zulip-export/stream/302903-platform-development/topic/Thinking.20out.20loud.html#256318888">(Oct 05 2021 at 21:05)</a>:</h4>
<p>So far I‚Äôve looked at the Hello World examples in C and zig. It looks like the host files implement some common methods (memory management‚Ä¶ anything else?Ôøº). I guess each host must implement some minimal interface to be a valid platform. I wonder if that interface is documented anywhere. (Hmm, also what‚Äôs with the ‚Äúplatform‚Äù and ‚Äúhost‚Äù names? Are they synonyms, or are they different somehow?Ôøº) If not, I wonder if it makes sense to start this documentation. I‚Äôm also curious what this interface depends on‚Äî might give some insight on thinking about the stability of this interface.Ôøº</p>



<a name="303408738"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/302903-platform%20development/topic/Thinking%20out%20loud/near/303408738" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Thomas <a href="https://roc-lang.github.io/zulip-export/stream/302903-platform-development/topic/Thinking.20out.20loud.html#303408738">(Oct 11 2022 at 11:41)</a>:</h4>
<p>I am also interested in some kind of documentation on these things!</p>
<p>What is the "glue"?<br>
What is needed to start a platform from scratch using a C compiler and the roc binary?<br>
Are there any assumptions or dependency on Rust tooling in order to set up a platform from scratch?</p>



<a name="303410595"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/302903-platform%20development/topic/Thinking%20out%20loud/near/303410595" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anton <a href="https://roc-lang.github.io/zulip-export/stream/302903-platform-development/topic/Thinking.20out.20loud.html#303410595">(Oct 11 2022 at 11:53)</a>:</h4>
<p>I'm definitely not a platform expert but to the best of my knowledge:</p>
<blockquote>
<p>What is the "glue"?</p>
</blockquote>
<p>Our <a href="https://github.com/roc-lang/roc/tree/main/crates/glue">glue rust crate</a> <a href="https://github.com/roc-lang/roc/blob/main/crates/glue/src/glue.rs">generates rust code</a> to connect a roc app with its rust platform.</p>
<blockquote>
<p>What is needed to start a platform from scratch using a C compiler and the roc binary?</p>
</blockquote>
<p>Check out <a href="https://github.com/roc-lang/roc/blob/main/crates/cli_testing_examples/platform-switching/c-platform/host.c">this c platform example</a>.</p>
<blockquote>
<p>Are there any assumptions or dependency on Rust tooling in order to set up a platform from scratch?</p>
</blockquote>
<p>Our glue generator is made for rust platforms. If you want to work with a c platform no Rust tooling is necessary.</p>



<a name="303411030"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/302903-platform%20development/topic/Thinking%20out%20loud/near/303411030" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Thomas <a href="https://roc-lang.github.io/zulip-export/stream/302903-platform-development/topic/Thinking.20out.20loud.html#303411030">(Oct 11 2022 at 11:56)</a>:</h4>
<p>I have looked at c-platform / zig-platform and friends here, but I'm mostly confused about how to go from pf.roc + main.roc into something runnable I think...</p>
<p>Does Roc make assumptions about the name or location about my host.c file? (or host.o or similar?)</p>
<p>What exactly do I need to provide to a Roc platform from the native side assuming I start out with a host.c file exactly like the above link</p>



<a name="303411863"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/302903-platform%20development/topic/Thinking%20out%20loud/near/303411863" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Thomas <a href="https://roc-lang.github.io/zulip-export/stream/302903-platform-development/topic/Thinking.20out.20loud.html#303411863">(Oct 11 2022 at 12:00)</a>:</h4>
<p>I tried the following:</p>
<div class="codehilite"><pre><span></span><code>platform &quot;basic&quot;
    requires {} { main : Str }
    exposes []
    packages {}
    imports []
    provides [mainForHost]

mainForHost = main
</code></pre></div>
<p>And I got the following when attempting <code>roc run</code> (main.roc)</p>
<div class="codehilite"><pre><span></span><code>üî® Rebuilding platform...
An internal compiler expectation was broken.
This is definitely a compiler bug.
Please file an issue here: https://github.com/roc-lang/roc/issues/new/choose
thread &#39;&lt;unnamed&gt;&#39; panicked at &#39;No such file or directory (os error 2)&#39;, crates/linker/src/lib.rs:357:29
note: run with `RUST_BACKTRACE=1` environment variable to display a backtrace
thread &#39;main&#39; panicked at &#39;called `Result::unwrap()` on an `Err` value: Any { .. }&#39;, crates/cli/src/build.rs:307:46
</code></pre></div>
<p>What is the "internal compiler expectation", and how to I fulfill it rather than breaking it?</p>



<a name="303422005"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/302903-platform%20development/topic/Thinking%20out%20loud/near/303422005" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Thomas <a href="https://roc-lang.github.io/zulip-export/stream/302903-platform-development/topic/Thinking.20out.20loud.html#303422005">(Oct 11 2022 at 12:01)</a>:</h4>
<p>Interestingly, if I make an empty host.c file in the same directory, I get the following:</p>
<div class="codehilite"><pre><span></span><code>üî® Rebuilding platform...
thread &#39;&lt;unnamed&gt;&#39; panicked at &#39;called `Result::unwrap()` on an `Err` value: Os { code: 2, kind: NotFound, message: &quot;No such file or directory&quot; }&#39;, crates/compiler/build/src/link.rs:456:22
note: run with `RUST_BACKTRACE=1` environment variable to display a backtrace
thread &#39;main&#39; panicked at &#39;called `Result::unwrap()` on an `Err` value: Any { .. }&#39;, crates/cli/src/build.rs:307:46
</code></pre></div>



<a name="303422109"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/302903-platform%20development/topic/Thinking%20out%20loud/near/303422109" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anton <a href="https://roc-lang.github.io/zulip-export/stream/302903-platform-development/topic/Thinking.20out.20loud.html#303422109">(Oct 11 2022 at 12:02)</a>:</h4>
<p>Can you run examples/helloWorld.roc without errors?</p>



<a name="303422236"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/302903-platform%20development/topic/Thinking%20out%20loud/near/303422236" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Thomas <a href="https://roc-lang.github.io/zulip-export/stream/302903-platform-development/topic/Thinking.20out.20loud.html#303422236">(Oct 11 2022 at 12:02)</a>:</h4>
<p>No, because I don't have the Rust tooling correctly set up on my machine</p>



<a name="303422471"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/302903-platform%20development/topic/Thinking%20out%20loud/near/303422471" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anton <a href="https://roc-lang.github.io/zulip-export/stream/302903-platform-development/topic/Thinking.20out.20loud.html#303422471">(Oct 11 2022 at 12:04)</a>:</h4>
<p>How about crates/cli_testing_examples/platform-switching/rocLovesC.roc?</p>



<a name="303422625"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/302903-platform%20development/topic/Thinking%20out%20loud/near/303422625" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Thomas <a href="https://roc-lang.github.io/zulip-export/stream/302903-platform-development/topic/Thinking.20out.20loud.html#303422625">(Oct 11 2022 at 12:05)</a>:</h4>
<p>I'll have to clone the repo, give me a second<br>
I just have the nightly release atm</p>



<a name="303423153"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/302903-platform%20development/topic/Thinking%20out%20loud/near/303423153" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Thomas <a href="https://roc-lang.github.io/zulip-export/stream/302903-platform-development/topic/Thinking.20out.20loud.html#303423153">(Oct 11 2022 at 12:06)</a>:</h4>
<p>Wow, that is actually interesting</p>



<a name="303423198"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/302903-platform%20development/topic/Thinking%20out%20loud/near/303423198" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Thomas <a href="https://roc-lang.github.io/zulip-export/stream/302903-platform-development/topic/Thinking.20out.20loud.html#303423198">(Oct 11 2022 at 12:06)</a>:</h4>
<div class="codehilite"><pre><span></span><code>~/Projects/github.com/roc-lang/roc/crates/cli_testing_examples/platform-switching$ roc run rocLovesC.roc

# (Padding added for separation)

üî® Rebuilding platform...
thread &#39;&lt;unnamed&gt;&#39; panicked at &#39;called `Result::unwrap()` on an `Err` value: Os { code: 2, kind: NotFound, message: &quot;No such file or directory&quot; }&#39;, crates/compiler/build/src/link.rs:456:22
note: run with `RUST_BACKTRACE=1` environment variable to display a backtrace
thread &#39;main&#39; panicked at &#39;called `Result::unwrap()` on an `Err` value: Any { .. }&#39;, crates/cli/src/build.rs:307:46
</code></pre></div>



<a name="303423294"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/302903-platform%20development/topic/Thinking%20out%20loud/near/303423294" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Thomas <a href="https://roc-lang.github.io/zulip-export/stream/302903-platform-development/topic/Thinking.20out.20loud.html#303423294">(Oct 11 2022 at 12:07)</a>:</h4>
<p>I have roc_nightly-linux_x86_64-2022-10-10-07ceabc</p>



<a name="303423462"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/302903-platform%20development/topic/Thinking%20out%20loud/near/303423462" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Thomas <a href="https://roc-lang.github.io/zulip-export/stream/302903-platform-development/topic/Thinking.20out.20loud.html#303423462">(Oct 11 2022 at 12:08)</a>:</h4>
<p>I do have a boken rustc in my PATH, could that be messing with Roc's assumptions? I'll try removing it</p>



<a name="303423633"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/302903-platform%20development/topic/Thinking%20out%20loud/near/303423633" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anton <a href="https://roc-lang.github.io/zulip-export/stream/302903-platform-development/topic/Thinking.20out.20loud.html#303423633">(Oct 11 2022 at 12:09)</a>:</h4>
<p>Not sure what OS you are on but I think you need to do your equivalent of <code>sudo apt install build-essential clang</code></p>



<a name="303424155"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/302903-platform%20development/topic/Thinking%20out%20loud/near/303424155" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Thomas <a href="https://roc-lang.github.io/zulip-export/stream/302903-platform-development/topic/Thinking.20out.20loud.html#303424155">(Oct 11 2022 at 12:10)</a>:</h4>
<p>I am on Debian 11, but is there a way for me to do my host building myself? Or will Roc always rely on system-installed build tools no matter what I do?</p>



<a name="303424411"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/302903-platform%20development/topic/Thinking%20out%20loud/near/303424411" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anton <a href="https://roc-lang.github.io/zulip-export/stream/302903-platform-development/topic/Thinking.20out.20loud.html#303424411">(Oct 11 2022 at 12:12)</a>:</h4>
<p>We have a flag you can pass to the roc binary something like --prebuilt-platform that would allow you to build the host yourself I think.</p>



<a name="303424441"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/302903-platform%20development/topic/Thinking%20out%20loud/near/303424441" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Thomas <a href="https://roc-lang.github.io/zulip-export/stream/302903-platform-development/topic/Thinking.20out.20loud.html#303424441">(Oct 11 2022 at 12:12)</a>:</h4>
<p>I'll look for this, thanks :)</p>



<a name="303424485"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/302903-platform%20development/topic/Thinking%20out%20loud/near/303424485" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anton <a href="https://roc-lang.github.io/zulip-export/stream/302903-platform-development/topic/Thinking.20out.20loud.html#303424485">(Oct 11 2022 at 12:12)</a>:</h4>
<p>I'm going to be AFK for 10 mins</p>



<a name="303425218"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/302903-platform%20development/topic/Thinking%20out%20loud/near/303425218" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Thomas <a href="https://roc-lang.github.io/zulip-export/stream/302903-platform-development/topic/Thinking.20out.20loud.html#303425218">(Oct 11 2022 at 12:16)</a>:</h4>
<p>Roc now spits out <a href="http://libapp.so">libapp.so</a> apparently! (but still errors with the above error) I'll mess around a bit with this file</p>



<a name="303425274"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/302903-platform%20development/topic/Thinking%20out%20loud/near/303425274" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Thomas <a href="https://roc-lang.github.io/zulip-export/stream/302903-platform-development/topic/Thinking.20out.20loud.html#303425274">(Oct 11 2022 at 12:17)</a>:</h4>
<p>I'm not entirely sure what I did differently</p>



<a name="303426798"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/302903-platform%20development/topic/Thinking%20out%20loud/near/303426798" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anton <a href="https://roc-lang.github.io/zulip-export/stream/302903-platform-development/topic/Thinking.20out.20loud.html#303426798">(Oct 11 2022 at 12:26)</a>:</h4>
<p>Can you tell me what <code>clang --version</code> returns?</p>



<a name="303427622"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/302903-platform%20development/topic/Thinking%20out%20loud/near/303427622" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Thomas <a href="https://roc-lang.github.io/zulip-export/stream/302903-platform-development/topic/Thinking.20out.20loud.html#303427622">(Oct 11 2022 at 12:32)</a>:</h4>
<p>I didn't really build anything yet, I don't have clang installed globally, but I would use zig cc, so that returns <code>clang version 15.0.0 (git@github.com:ziglang/zig-bootstrap.git 9be8396b715b10f64d8a94b2d0d9acb77126d8ca)</code></p>



<a name="303427827"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/302903-platform%20development/topic/Thinking%20out%20loud/near/303427827" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Thomas <a href="https://roc-lang.github.io/zulip-export/stream/302903-platform-development/topic/Thinking.20out.20loud.html#303427827">(Oct 11 2022 at 12:33)</a>:</h4>
<p>Roc spits out <a href="http://libapp.so">libapp.so</a> without any global clang installation when I just do <code>roc build</code> now, and it seems to have roc__mainForHost symbols in it, although Roc still crashes with that Rust error above</p>



<a name="303427852"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/302903-platform%20development/topic/Thinking%20out%20loud/near/303427852" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Thomas <a href="https://roc-lang.github.io/zulip-export/stream/302903-platform-development/topic/Thinking.20out.20loud.html#303427852">(Oct 11 2022 at 12:33)</a>:</h4>
<p>Do you want a Rust stack trace?</p>



<a name="303428267"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/302903-platform%20development/topic/Thinking%20out%20loud/near/303428267" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Thomas <a href="https://roc-lang.github.io/zulip-export/stream/302903-platform-development/topic/Thinking.20out.20loud.html#303428267">(Oct 11 2022 at 12:36)</a>:</h4>
<p>Summarized:<br>
Given files:<br>
pf.roc:</p>
<div class="codehilite"><pre><span></span><code>platform &quot;basic&quot;
    requires {} { main : Str }
    exposes []
    packages {}
    imports []
    provides [mainForHost]

mainForHost = main
</code></pre></div>
<p>main.roc:</p>
<div class="codehilite"><pre><span></span><code>app &quot;basic&quot;
    packages { pf: &quot;pf.roc&quot; }
    imports []
    provides [main] to pf

main = &quot;Hello&quot;
</code></pre></div>
<p>Running <code>roc build</code> will produce <a href="http://libapp.so">libapp.so</a> in current folder and then crash with the following message (with RUST_BACKTRACE=1)</p>
<div class="codehilite"><pre><span></span><code>üî® Rebuilding platform...
An internal compiler expectation was broken.
This is definitely a compiler bug.
Please file an issue here: https://github.com/roc-lang/roc/issues/new/choose
thread &#39;&lt;unnamed&gt;&#39; panicked at &#39;No such file or directory (os error 2)&#39;, crates/linker/src/lib.rs:357:29
stack backtrace:
   0: rust_begin_unwind
             at /rustc/fe5b13d681f25ee6474be29d748c65adcd91f69e/library/std/src/panicking.rs:584:5
   1: core::panicking::panic_fmt
             at /rustc/fe5b13d681f25ee6474be29d748c65adcd91f69e/library/core/src/panicking.rs:143:14
   2: roc_linker::open_mmap
   3: roc_linker::elf::preprocess_elf
   4: roc_linker::build_and_preprocess_host
note: Some details are omitted, run with `RUST_BACKTRACE=full` for a verbose backtrace.
thread &#39;main&#39; panicked at &#39;called `Result::unwrap()` on an `Err` value: Any { .. }&#39;, crates/cli/src/build.rs:307:46
stack backtrace:
   0: rust_begin_unwind
             at /rustc/fe5b13d681f25ee6474be29d748c65adcd91f69e/library/std/src/panicking.rs:584:5
   1: core::panicking::panic_fmt
             at /rustc/fe5b13d681f25ee6474be29d748c65adcd91f69e/library/core/src/panicking.rs:143:14
   2: core::result::unwrap_failed
             at /rustc/fe5b13d681f25ee6474be29d748c65adcd91f69e/library/core/src/result.rs:1785:5
   3: roc_cli::build::build_file
   4: roc_cli::build
   5: roc::main
note: Some details are omitted, run with `RUST_BACKTRACE=full` for a verbose backtrace.
</code></pre></div>
<div class="codehilite"><pre><span></span><code>
</code></pre></div>



<a name="303428366"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/302903-platform%20development/topic/Thinking%20out%20loud/near/303428366" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Thomas <a href="https://roc-lang.github.io/zulip-export/stream/302903-platform-development/topic/Thinking.20out.20loud.html#303428366">(Oct 11 2022 at 12:36)</a>:</h4>
<p>(Without rustc or clang in PATH)</p>



<a name="303429047"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/302903-platform%20development/topic/Thinking%20out%20loud/near/303429047" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Thomas <a href="https://roc-lang.github.io/zulip-export/stream/302903-platform-development/topic/Thinking.20out.20loud.html#303429047">(Oct 11 2022 at 12:40)</a>:</h4>
<p>If I pass <code>--prebuilt-platform true</code> it will NOT produce a <a href="http://libapp.so">libapp.so</a> file, and will crash with a similar, but slightly different error:</p>
<div class="codehilite"><pre><span></span><code>thread &#39;&lt;unnamed&gt;&#39; panicked at &#39;called `Result::unwrap()` on an `Err` value: Os { code: 2, kind: NotFound, message: &quot;No such file or directory&quot; }&#39;, crates/cli/src/build.rs:451:74
stack backtrace:
   0: rust_begin_unwind
             at /rustc/fe5b13d681f25ee6474be29d748c65adcd91f69e/library/std/src/panicking.rs:584:5
   1: core::panicking::panic_fmt
             at /rustc/fe5b13d681f25ee6474be29d748c65adcd91f69e/library/core/src/panicking.rs:143:14
   2: core::result::unwrap_failed
             at /rustc/fe5b13d681f25ee6474be29d748c65adcd91f69e/library/core/src/result.rs:1785:5
note: Some details are omitted, run with `RUST_BACKTRACE=full` for a verbose backtrace.
thread &#39;main&#39; panicked at &#39;called `Result::unwrap()` on an `Err` value: Any { .. }&#39;, crates/cli/src/build.rs:307:46
stack backtrace:
   0: rust_begin_unwind
             at /rustc/fe5b13d681f25ee6474be29d748c65adcd91f69e/library/std/src/panicking.rs:584:5
   1: core::panicking::panic_fmt
             at /rustc/fe5b13d681f25ee6474be29d748c65adcd91f69e/library/core/src/panicking.rs:143:14
   2: core::result::unwrap_failed
             at /rustc/fe5b13d681f25ee6474be29d748c65adcd91f69e/library/core/src/result.rs:1785:5
   3: roc_cli::build::build_file
   4: roc_cli::build
   5: roc::main
note: Some details are omitted, run with `RUST_BACKTRACE=full` for a verbose backtrace.
</code></pre></div>



<a name="303435694"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/302903-platform%20development/topic/Thinking%20out%20loud/near/303435694" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anton <a href="https://roc-lang.github.io/zulip-export/stream/302903-platform-development/topic/Thinking.20out.20loud.html#303435694">(Oct 11 2022 at 13:19)</a>:</h4>
<p>The "No such file or directory" is because roc is trying to call <code>clang</code>, see <a href="https://github.com/roc-lang/roc/blob/940be28ef03cff647c048e59e8b147d948cc0372/crates/compiler/build/src/link.rs#L407">this line</a>.</p>



<a name="303442810"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/302903-platform%20development/topic/Thinking%20out%20loud/near/303442810" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Thomas <a href="https://roc-lang.github.io/zulip-export/stream/302903-platform-development/topic/Thinking.20out.20loud.html#303442810">(Oct 11 2022 at 13:54)</a>:</h4>
<p>Only the code path where I don't pass <code>--prebuilt-platform true</code> actually compiles the Roc code though, I'm not sure how to tell it to not compile anything except the Roc parts</p>



<a name="303446845"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/302903-platform%20development/topic/Thinking%20out%20loud/near/303446845" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis <a href="https://roc-lang.github.io/zulip-export/stream/302903-platform-development/topic/Thinking.20out.20loud.html#303446845">(Oct 11 2022 at 14:12)</a>:</h4>
<blockquote>
<p>value: Os { code: 2, kind: NotFound, message: "No such file or directory" }'</p>
</blockquote>
<p>i've seen the same error due to missing clang install.  i wonder how difficult it would be to improve that from a panic to  error message stating something like "'clang' couldn't be found"?  and the same for when rust/zig arent found. i've been confused by similar error messages due to not having a rust compiler.</p>



<a name="303447376"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/302903-platform%20development/topic/Thinking%20out%20loud/near/303447376" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis <a href="https://roc-lang.github.io/zulip-export/stream/302903-platform-development/topic/Thinking.20out.20loud.html#303447376">(Oct 11 2022 at 14:15)</a>:</h4>
<p>i'm on debian too. at the time i had clang-14 installed. my solution was to just <code>ln -s /usr/bin/clang-14 ~/.local/bin/clang</code>. this assumes ~/.local/bin is in your path.</p>



<a name="303448069"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/302903-platform%20development/topic/Thinking%20out%20loud/near/303448069" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis <a href="https://roc-lang.github.io/zulip-export/stream/302903-platform-development/topic/Thinking.20out.20loud.html#303448069">(Oct 11 2022 at 14:18)</a>:</h4>
<p>but then i was told by richard that roc expects clang-13 and that while 14 might be an ok alternative its not recommended</p>



<a name="303448438"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/302903-platform%20development/topic/Thinking%20out%20loud/near/303448438" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/302903-platform-development/topic/Thinking.20out.20loud.html#303448438">(Oct 11 2022 at 14:20)</a>:</h4>
<p>Platforms and building them currently have a lot of sharp edges. We definitely need to plan out and improve their development. Currently, the compiler just implicitly knows a number of commands for building various types of platforms, but it is definitely not scalable. It also does not give good error messages. Long term there are many larger plans around platforms (and the ecosystem), but currently the knowledge is pretty sparse.</p>



<a name="303448590"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/302903-platform%20development/topic/Thinking%20out%20loud/near/303448590" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/302903-platform-development/topic/Thinking.20out.20loud.html#303448590">(Oct 11 2022 at 14:20)</a>:</h4>
<blockquote>
<p>but then i was told by richard that roc expects clang-13 and that 14 might be an ok alternative but not recommended</p>
</blockquote>
<p>Shouldn't actually matter. Richard was trying to match llvm versions, but we consume the platform as an object file which is fully compiled to assembly, so no llvm matching needs to be done.</p>



<a name="303448768"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/302903-platform%20development/topic/Thinking%20out%20loud/near/303448768" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/302903-platform-development/topic/Thinking.20out.20loud.html#303448768">(Oct 11 2022 at 14:21)</a>:</h4>
<blockquote>
<p>What is the "glue"?</p>
</blockquote>
<p>Extra not on glue, the long term plan is for it to generate a mix of languages using plugins that anyone can write. Currently rust is just the only supported language.</p>



<a name="303448928"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/302903-platform%20development/topic/Thinking%20out%20loud/near/303448928" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis <a href="https://roc-lang.github.io/zulip-export/stream/302903-platform-development/topic/Thinking.20out.20loud.html#303448928">(Oct 11 2022 at 14:22)</a>:</h4>
<p>hmm in that case if Thomas already has zig installed maybe just symlink or alias clang to 'zig cc'?</p>



<a name="303448932"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/302903-platform%20development/topic/Thinking%20out%20loud/near/303448932" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/302903-platform-development/topic/Thinking.20out.20loud.html#303448932">(Oct 11 2022 at 14:22)</a>:</h4>
<blockquote>
<p>Does Roc make assumptions about the name or location about my host.c file? (or host.o or similar?)</p>
</blockquote>
<p>Yes. That is all adhoc right now</p>



<a name="303449294"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/302903-platform%20development/topic/Thinking%20out%20loud/near/303449294" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/302903-platform-development/topic/Thinking.20out.20loud.html#303449294">(Oct 11 2022 at 14:24)</a>:</h4>
<blockquote>
<p>hmm in that case if Thomas already has zig installed maybe just symlink or alias clang to 'zig cc'?</p>
</blockquote>
<p>Yeah, that should theoretically work. Though have to make sure the roc program actually reads the alias. Some shells don't seem to pass aliases to run applications (not sure exactly how that works).</p>



<a name="303449395"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/302903-platform%20development/topic/Thinking%20out%20loud/near/303449395" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/302903-platform-development/topic/Thinking.20out.20loud.html#303449395">(Oct 11 2022 at 14:24)</a>:</h4>
<p>Definitely should work to put a <code>clang</code> shell script in your path that just called <code>zig cc</code> with all of the args.</p>



<a name="303449791"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/302903-platform%20development/topic/Thinking%20out%20loud/near/303449791" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/302903-platform-development/topic/Thinking.20out.20loud.html#303449791">(Oct 11 2022 at 14:26)</a>:</h4>
<p>As an extra note, platform pains are extra apparent because we don't have any form of package ecosystem yet. Long term, end users won't need to compile platforms (at least generally speaking). The compiler will download a prebuilt platform and link to that. As such, you would see these errors unless creating a new platform</p>



<a name="303450246"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/302903-platform%20development/topic/Thinking%20out%20loud/near/303450246" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/302903-platform-development/topic/Thinking.20out.20loud.html#303450246">(Oct 11 2022 at 14:28)</a>:</h4>
<p>Also, roc has an option to not link and just dump an object file that can be consumed by anything. That is how I got roc running on a microcontroller, for example. Using that feature means you could use another languages build tooling if wanted.</p>



<a name="303450555"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/302903-platform%20development/topic/Thinking%20out%20loud/near/303450555" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/302903-platform-development/topic/Thinking.20out.20loud.html#303450555">(Oct 11 2022 at 14:30)</a>:</h4>
<p>Also, I think this points more towards the need for a platform dev beginners sessions (along with a write up probably). It used to be that the api change a lot, so we really didn't want to try and document it. Now it has been much more stable, so some good docs and better error messages would probably be worth investing in.</p>



<a name="303455531"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/302903-platform%20development/topic/Thinking%20out%20loud/near/303455531" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jan kili <a href="https://roc-lang.github.io/zulip-export/stream/302903-platform-development/topic/Thinking.20out.20loud.html#303455531">(Oct 11 2022 at 14:52)</a>:</h4>
<p>Any appetite for Roc Meetup #2? I was thinking maybe mid/late November, to give time for both Roctoberfest and AoC23</p>



<a name="303455621"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/302903-platform%20development/topic/Thinking%20out%20loud/near/303455621" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/302903-platform-development/topic/Thinking.20out.20loud.html#303455621">(Oct 11 2022 at 14:52)</a>:</h4>
<p>Haha, just posted a comment about it and in beginners chat.</p>



<a name="303868301"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/302903-platform%20development/topic/Thinking%20out%20loud/near/303868301" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Thomas <a href="https://roc-lang.github.io/zulip-export/stream/302903-platform-development/topic/Thinking.20out.20loud.html#303868301">(Oct 13 2022 at 15:53)</a>:</h4>
<p><span class="user-mention silent" data-user-id="551275">Travis</span> <a href="#narrow/stream/302903-Writing-a-platform/topic/Thinking.20out.20loud/near/303448928">said</a>:</p>
<blockquote>
<p>hmm in that case if Thomas already has zig installed maybe just symlink or alias clang to 'zig cc'?</p>
</blockquote>
<p>I'll try this, thanks :)</p>



<a name="305096814"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/302903-platform%20development/topic/Thinking%20out%20loud/near/305096814" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Thomas <a href="https://roc-lang.github.io/zulip-export/stream/302903-platform-development/topic/Thinking.20out.20loud.html#305096814">(Oct 20 2022 at 07:53)</a>:</h4>
<p>Seems like I got quite a bit further this time around, I made a <code>host.zig</code> file and populated it with stubs, now I'm running into this (<code>roc build &amp;&amp; ./basic</code>):</p>
<div class="codehilite"><pre><span></span><code>üî® Rebuilding platform...
0 errors and 0 warnings found in 767 ms while successfully building:

    basic
./basic: symbol lookup error: ./basic: undefined symbol: roc__mainForHost_1_exposed_generic
</code></pre></div>
<p>main.roc:</p>
<div class="codehilite"><pre><span></span><code>app &quot;basic&quot;
    packages { pf: &quot;pf.roc&quot; }
    imports []
    provides [main] to pf

main = &quot;Hello&quot;
</code></pre></div>
<p>pf.roc:</p>
<div class="codehilite"><pre><span></span><code>platform &quot;basic&quot;
    requires {} { main : Str }
    exposes []
    packages {}
    imports []
    provides [mainForHost]

mainForHost = main
</code></pre></div>



<a name="305096961"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/302903-platform%20development/topic/Thinking%20out%20loud/near/305096961" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Thomas <a href="https://roc-lang.github.io/zulip-export/stream/302903-platform-development/topic/Thinking.20out.20loud.html#305096961">(Oct 20 2022 at 07:54)</a>:</h4>
<p>Here's my host.zig file:</p>
<div class="codehilite" data-code-language="Zig"><pre><span></span><code><span class="kr">const</span><span class="w"> </span><span class="n">std</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">@import</span><span class="p">(</span><span class="s">"std"</span><span class="p">);</span><span class="w"></span>

<span class="kr">extern</span><span class="w"> </span><span class="k">fn</span><span class="w"> </span><span class="n">roc__mainForHost_1_exposed_generic</span><span class="p">([</span><span class="o">*</span><span class="p">]</span><span class="kr">const</span><span class="w"> </span><span class="kt">u8</span><span class="p">)</span><span class="w"> </span><span class="kt">void</span><span class="p">;</span><span class="w"></span>

<span class="kr">pub</span><span class="w"> </span><span class="k">fn</span><span class="w"> </span><span class="n">main</span><span class="p">()</span><span class="w"> </span><span class="o">!</span><span class="kt">void</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kr">var</span><span class="w"> </span><span class="n">buf</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="mi">1024</span><span class="p">]</span><span class="kt">u8</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">undefined</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="n">roc__mainForHost_1_exposed_generic</span><span class="p">(</span><span class="o">&amp;</span><span class="n">buf</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="n">std</span><span class="p">.</span><span class="n">io</span><span class="p">.</span><span class="n">getStdOut</span><span class="p">().</span><span class="n">writer</span><span class="p">().</span><span class="n">print</span><span class="p">(</span><span class="s">"{any}</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span><span class="w"> </span><span class="p">.{</span><span class="n">buf</span><span class="p">})</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">{};</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="kr">export</span><span class="w"> </span><span class="k">fn</span><span class="w"> </span><span class="n">roc_alloc</span><span class="p">()</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="n">std</span><span class="p">.</span><span class="n">io</span><span class="p">.</span><span class="n">getStdOut</span><span class="p">().</span><span class="n">writeAll</span><span class="p">(</span><span class="s">"roc_alloc</span><span class="se">\n</span><span class="s">"</span><span class="p">)</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">{};</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
<span class="kr">export</span><span class="w"> </span><span class="k">fn</span><span class="w"> </span><span class="n">roc_realloc</span><span class="p">()</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="n">std</span><span class="p">.</span><span class="n">io</span><span class="p">.</span><span class="n">getStdOut</span><span class="p">().</span><span class="n">writeAll</span><span class="p">(</span><span class="s">"roc_realloc</span><span class="se">\n</span><span class="s">"</span><span class="p">)</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">{};</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
<span class="kr">export</span><span class="w"> </span><span class="k">fn</span><span class="w"> </span><span class="n">roc_dealloc</span><span class="p">()</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="n">std</span><span class="p">.</span><span class="n">io</span><span class="p">.</span><span class="n">getStdOut</span><span class="p">().</span><span class="n">writeAll</span><span class="p">(</span><span class="s">"roc_dealloc</span><span class="se">\n</span><span class="s">"</span><span class="p">)</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">{};</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
<span class="kr">export</span><span class="w"> </span><span class="k">fn</span><span class="w"> </span><span class="n">roc_panic</span><span class="p">()</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="n">std</span><span class="p">.</span><span class="n">io</span><span class="p">.</span><span class="n">getStdOut</span><span class="p">().</span><span class="n">writeAll</span><span class="p">(</span><span class="s">"roc_panic</span><span class="se">\n</span><span class="s">"</span><span class="p">)</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">{};</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
<span class="kr">export</span><span class="w"> </span><span class="k">fn</span><span class="w"> </span><span class="n">roc_memcpy</span><span class="p">()</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="n">std</span><span class="p">.</span><span class="n">io</span><span class="p">.</span><span class="n">getStdOut</span><span class="p">().</span><span class="n">writeAll</span><span class="p">(</span><span class="s">"roc_memcpy</span><span class="se">\n</span><span class="s">"</span><span class="p">)</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">{};</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
<span class="kr">export</span><span class="w"> </span><span class="k">fn</span><span class="w"> </span><span class="n">roc_memset</span><span class="p">()</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="n">std</span><span class="p">.</span><span class="n">io</span><span class="p">.</span><span class="n">getStdOut</span><span class="p">().</span><span class="n">writeAll</span><span class="p">(</span><span class="s">"roc_memset</span><span class="se">\n</span><span class="s">"</span><span class="p">)</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">{};</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>



<a name="305110463"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/302903-platform%20development/topic/Thinking%20out%20loud/near/305110463" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/302903-platform-development/topic/Thinking.20out.20loud.html#305110463">(Oct 20 2022 at 09:26)</a>:</h4>
<p>hmm</p>



<a name="305110524"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/302903-platform%20development/topic/Thinking%20out%20loud/near/305110524" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/302903-platform-development/topic/Thinking.20out.20loud.html#305110524">(Oct 20 2022 at 09:27)</a>:</h4>
<p>not sure, this looks very similar to the <code>examples/platform-switching/zig-platform/host.zig</code>, which is working fine</p>



<a name="305110613"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/302903-platform%20development/topic/Thinking%20out%20loud/near/305110613" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/302903-platform-development/topic/Thinking.20out.20loud.html#305110613">(Oct 20 2022 at 09:27)</a>:</h4>
<p>why are you passing a <code>const</code> pointer to <code>mainForHost</code>? we're going to write stuff into that pointer</p>



<a name="305110753"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/302903-platform%20development/topic/Thinking%20out%20loud/near/305110753" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/302903-platform-development/topic/Thinking.20out.20loud.html#305110753">(Oct 20 2022 at 09:28)</a>:</h4>
<p>to debug this you'd kind of need to look at the generated llvm IR. are you using nix on linux/mac?</p>



<a name="305110819"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/302903-platform%20development/topic/Thinking%20out%20loud/near/305110819" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/302903-platform-development/topic/Thinking.20out.20loud.html#305110819">(Oct 20 2022 at 09:29)</a>:</h4>
<p>if so you can add the <code>--debug</code> flag, and it will spit out annotated llvm IR next to the .roc file of your app</p>



<a name="305110895"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/302903-platform%20development/topic/Thinking%20out%20loud/near/305110895" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/302903-platform-development/topic/Thinking.20out.20loud.html#305110895">(Oct 20 2022 at 09:29)</a>:</h4>
<p>you need the <code>debugir</code> tool for this which I believe the nix thing will install. You can also build it from source yourself of course</p>



<a name="305110904"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/302903-platform%20development/topic/Thinking%20out%20loud/near/305110904" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/302903-platform-development/topic/Thinking.20out.20loud.html#305110904">(Oct 20 2022 at 09:29)</a>:</h4>
<p>(which is what I do)</p>



<a name="305112738"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/302903-platform%20development/topic/Thinking%20out%20loud/near/305112738" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anton <a href="https://roc-lang.github.io/zulip-export/stream/302903-platform-development/topic/Thinking.20out.20loud.html#305112738">(Oct 20 2022 at 09:43)</a>:</h4>
<p>yes, <code>nix develop</code> will automatically have debugir available.</p>



<a name="305118041"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/302903-platform%20development/topic/Thinking%20out%20loud/near/305118041" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Thomas <a href="https://roc-lang.github.io/zulip-export/stream/302903-platform-development/topic/Thinking.20out.20loud.html#305118041">(Oct 20 2022 at 10:19)</a>:</h4>
<p><span class="user-mention silent" data-user-id="281543">Folkert de Vries</span> <a href="#narrow/stream/302903-Writing-a-platform/topic/Thinking.20out.20loud/near/305110753">said</a>:</p>
<blockquote>
<p>to debug this you'd kind of need to look at the generated llvm IR. are you using nix on linux/mac?</p>
</blockquote>
<p>No, I'm just a user trying to bootstrap a basic app + platform from nothing, I'm not on nix</p>



<a name="305118168"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/302903-platform%20development/topic/Thinking%20out%20loud/near/305118168" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Thomas <a href="https://roc-lang.github.io/zulip-export/stream/302903-platform-development/topic/Thinking.20out.20loud.html#305118168">(Oct 20 2022 at 10:20)</a>:</h4>
<p><span class="user-mention silent" data-user-id="281543">Folkert de Vries</span> <a href="#narrow/stream/302903-Writing-a-platform/topic/Thinking.20out.20loud/near/305110613">said</a>:</p>
<blockquote>
<p>why are you passing a <code>const</code> pointer to <code>mainForHost</code>? we're going to write stuff into that pointer</p>
</blockquote>
<p>Changed, heh, I'm really just trying things until it sticks</p>



<a name="305119952"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/302903-platform%20development/topic/Thinking%20out%20loud/near/305119952" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/302903-platform-development/topic/Thinking.20out.20loud.html#305119952">(Oct 20 2022 at 10:28)</a>:</h4>
<p>right well that symbol should exist, so I'm interested to see what llvm generated</p>



<a name="305125523"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/302903-platform%20development/topic/Thinking%20out%20loud/near/305125523" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Thomas <a href="https://roc-lang.github.io/zulip-export/stream/302903-platform-development/topic/Thinking.20out.20loud.html#305125523">(Oct 20 2022 at 10:55)</a>:</h4>
<p><span class="user-mention silent" data-user-id="281543">Folkert de Vries</span> <a href="#narrow/stream/302903-Writing-a-platform/topic/Thinking.20out.20loud/near/305119952">said</a>:</p>
<blockquote>
<p>right well that symbol should exist, so I'm interested to see what llvm generated</p>
</blockquote>
<p>Can you reproduce the issue on your machine? I posted all files I used</p>



<a name="305795994"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/302903-platform%20development/topic/Thinking%20out%20loud/near/305795994" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Thomas <a href="https://roc-lang.github.io/zulip-export/stream/302903-platform-development/topic/Thinking.20out.20loud.html#305795994">(Oct 24 2022 at 11:20)</a>:</h4>
<p><span class="user-mention silent" data-user-id="281543">Folkert de Vries</span> <a href="#narrow/stream/302903-Writing-a-platform/topic/Thinking.20out.20loud/near/305119952">said</a>:</p>
<blockquote>
<p>right well that symbol should exist, so I'm interested to see what llvm generated</p>
</blockquote>
<p>I got the LLVM IR, from what I can tell, it does output something that looks correct:</p>
<div class="codehilite" data-code-language="LLVM"><pre><span></span><code><span class="k">define</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="vg">@roc__mainForHost_1_exposed_generic</span><span class="p">(</span><span class="nv">%str.RocStr</span><span class="p">*</span><span class="w"> </span><span class="nv nv-Anonymous">%0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
</code></pre></div>
<p><a href="/user_uploads/22008/jI5ZZL2joQ5PxuXBNgg4816D/image.png">image.png</a></p>
<div class="message_inline_image"><a href="/user_uploads/22008/jI5ZZL2joQ5PxuXBNgg4816D/image.png" title="image.png"><img src="/user_uploads/22008/jI5ZZL2joQ5PxuXBNgg4816D/image.png"></a></div>



<a name="305796229"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/302903-platform%20development/topic/Thinking%20out%20loud/near/305796229" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Thomas <a href="https://roc-lang.github.io/zulip-export/stream/302903-platform-development/topic/Thinking.20out.20loud.html#305796229">(Oct 24 2022 at 11:22)</a>:</h4>
<p>I'll try making a git repo for this stuff I think, but first I'll try upgrading</p>



<hr><p>Last updated: Mar 01 2026 at 12:20 UTC</p>
</html>