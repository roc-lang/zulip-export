<html>
<head><meta charset="utf-8"><title>roc-ray · platform development · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://roc-lang.github.io/zulip-export/stream/302903-platform-development/index.html">platform development</a></h2>
<h3>Topic: <a href="https://roc-lang.github.io/zulip-export/stream/302903-platform-development/topic/roc-ray.html">roc-ray</a></h3>

<hr>

<base href="https://roc.zulipchat.com">

<head><link href="https://roc-lang.github.io/zulip-export/style.css" rel="stylesheet"></head>

<a name="476478038"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/302903-platform%20development/topic/roc-ray/near/476478038" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/302903-platform-development/topic/roc-ray.html#476478038">(Oct 12 2024 at 00:54)</a>:</h4>
<p>I'm trying to find a nice API for working with the keyboard...</p>
<p>I've implemented this which works nicely... but it's only "hey this key was pressed" and doesn't really help if I want to detect say <code>Crtl-C</code> or <code>Shift-K</code> etc as I need to know if a key is being pressed which feels like a different thing. </p>
<p>Just trying to think of something that maps nicely as a Task.</p>
<p>Here's the raylib API functions which seem related.</p>
<div class="codehilite"><pre><span></span><code>## Get&#39;s the set of keys pressed since last time this function was called.
## Key presses are queued until read.
getKeysPressed : Task (Set KeyBoardKey) *
</code></pre></div>
<div class="codehilite" data-code-language="Zig"><pre><span></span><code><span class="c1">/// Check if a key has been pressed once</span>
<span class="kr">pub</span><span class="w"> </span><span class="k">fn</span><span class="w"> </span><span class="n">isKeyPressed</span><span class="p">(</span><span class="n">key</span><span class="o">:</span><span class="w"> </span><span class="n">KeyboardKey</span><span class="p">)</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">cdef</span><span class="p">.</span><span class="n">IsKeyPressed</span><span class="p">(</span><span class="n">key</span><span class="p">);</span>
<span class="p">}</span>

<span class="c1">/// Check if a key has been pressed again (Only PLATFORM_DESKTOP)</span>
<span class="kr">pub</span><span class="w"> </span><span class="k">fn</span><span class="w"> </span><span class="n">isKeyPressedRepeat</span><span class="p">(</span><span class="n">key</span><span class="o">:</span><span class="w"> </span><span class="n">KeyboardKey</span><span class="p">)</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">cdef</span><span class="p">.</span><span class="n">IsKeyPressedRepeat</span><span class="p">(</span><span class="n">key</span><span class="p">);</span>
<span class="p">}</span>

<span class="c1">/// Check if a key is being pressed</span>
<span class="kr">pub</span><span class="w"> </span><span class="k">fn</span><span class="w"> </span><span class="n">isKeyDown</span><span class="p">(</span><span class="n">key</span><span class="o">:</span><span class="w"> </span><span class="n">KeyboardKey</span><span class="p">)</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">cdef</span><span class="p">.</span><span class="n">IsKeyDown</span><span class="p">(</span><span class="n">key</span><span class="p">);</span>
<span class="p">}</span>

<span class="c1">/// Check if a key has been released once</span>
<span class="kr">pub</span><span class="w"> </span><span class="k">fn</span><span class="w"> </span><span class="n">isKeyReleased</span><span class="p">(</span><span class="n">key</span><span class="o">:</span><span class="w"> </span><span class="n">KeyboardKey</span><span class="p">)</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">cdef</span><span class="p">.</span><span class="n">IsKeyReleased</span><span class="p">(</span><span class="n">key</span><span class="p">);</span>
<span class="p">}</span>

<span class="c1">/// Check if a key is NOT being pressed</span>
<span class="kr">pub</span><span class="w"> </span><span class="k">fn</span><span class="w"> </span><span class="n">isKeyUp</span><span class="p">(</span><span class="n">key</span><span class="o">:</span><span class="w"> </span><span class="n">KeyboardKey</span><span class="p">)</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">cdef</span><span class="p">.</span><span class="n">IsKeyUp</span><span class="p">(</span><span class="n">key</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>



<a name="476478173"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/302903-platform%20development/topic/roc-ray/near/476478173" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/302903-platform-development/topic/roc-ray.html#476478173">(Oct 12 2024 at 00:56)</a>:</h4>
<p>Here is the WIP branch <a href="https://github.com/lukewilliamboswell/roc-ray/pull/15">https://github.com/lukewilliamboswell/roc-ray/pull/15</a> and a demo using the arrow keys.</p>
<p><a href="/user_uploads/22008/EVwXCiT5GI9lDJT6RMKSd4fn/roc-ray-4.gif">roc-ray-4.gif</a></p>
<div class="message_inline_image"><a href="/user_uploads/22008/EVwXCiT5GI9lDJT6RMKSd4fn/roc-ray-4.gif" title="roc-ray-4.gif"><img data-animated="true" data-original-dimensions="903x432" src="/user_uploads/thumbnail/22008/EVwXCiT5GI9lDJT6RMKSd4fn/roc-ray-4.gif/840x560-anim.webp"></a></div>



<a name="476478385"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/302903-platform%20development/topic/roc-ray/near/476478385" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/302903-platform-development/topic/roc-ray.html#476478385">(Oct 12 2024 at 01:00)</a>:</h4>
<p>I think in many cases keyboard maps best to handlers like <code>onKeyPress</code> that can update the model.</p>



<a name="476478662"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/302903-platform%20development/topic/roc-ray/near/476478662" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/302903-platform-development/topic/roc-ray.html#476478662">(Oct 12 2024 at 01:05)</a>:</h4>
<p>I'm not sure I follow what you mean.</p>



<a name="476478874"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/302903-platform%20development/topic/roc-ray/near/476478874" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/302903-platform-development/topic/roc-ray.html#476478874">(Oct 12 2024 at 01:08)</a>:</h4>
<p>Something like this maybe?</p>
<div class="codehilite"><pre><span></span><code>handleKeyChange : model, (model, KeyBoardKey, [Up, Down] -&gt; model) : Task model *
</code></pre></div>



<a name="476478934"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/302903-platform%20development/topic/roc-ray/near/476478934" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/302903-platform-development/topic/roc-ray.html#476478934">(Oct 12 2024 at 01:09)</a>:</h4>
<p>Yeah. Or have a task to register a key press handler (but that might be hard to get right with current roc glue).</p>



<a name="476479672"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/302903-platform%20development/topic/roc-ray/near/476479672" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/302903-platform-development/topic/roc-ray.html#476479672">(Oct 12 2024 at 01:21)</a>:</h4>
<p>Maybe it would be easiest to pass in the current "state" of the keyboard (and mouse gamepad etc) on every render?</p>
<div class="codehilite"><pre><span></span><code>render : Model, Keyboard -&gt; Task Model {}
</code></pre></div>



<a name="476479797"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/302903-platform%20development/topic/roc-ray/near/476479797" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/302903-platform-development/topic/roc-ray.html#476479797">(Oct 12 2024 at 01:23)</a>:</h4>
<p>This would save a lot of <code>Task</code>s</p>



<a name="476483758"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/302903-platform%20development/topic/roc-ray/near/476483758" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/302903-platform-development/topic/roc-ray.html#476483758">(Oct 12 2024 at 02:18)</a>:</h4>
<p>Oh, I see raylib really doesn't model keys in a handler friendly form. It expects you to requests the key events you care about on each frame.</p>



<a name="476483773"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/302903-platform%20development/topic/roc-ray/near/476483773" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/302903-platform-development/topic/roc-ray.html#476483773">(Oct 12 2024 at 02:19)</a>:</h4>
<p>I feel like I would just model the raylib api directly. (though I would make a Key enum instead of using an int)</p>



<a name="476483799"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/302903-platform%20development/topic/roc-ray/near/476483799" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/302903-platform-development/topic/roc-ray.html#476483799">(Oct 12 2024 at 02:19)</a>:</h4>
<p>If you want to be really fancy, some sort of record builder to get a bunch of keys might be nice. But I also think direct tasks should be fine</p>



<a name="476483913"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/302903-platform%20development/topic/roc-ray/near/476483913" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/302903-platform-development/topic/roc-ray.html#476483913">(Oct 12 2024 at 02:21)</a>:</h4>
<p>All that said, it seems that raylib fundamentally maps all of the keys into two arrays, previousKeyState and currentKeyState. You might be able to directly pass those into roc if you wanted and handle all the checking in roc</p>



<a name="476486290"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/302903-platform%20development/topic/roc-ray/near/476486290" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jared Cone <a href="https://roc-lang.github.io/zulip-export/stream/302903-platform-development/topic/roc-ray.html#476486290">(Oct 12 2024 at 03:00)</a>:</h4>
<p>I've seen raylib has a function to check for new key presses (pops one at a time from a stack), but it doesn't seem to have a function for key releases. My plan was to have the host pass a message to roc on key press, and also keep track of which keys are pressed. Then every frame, the host asks raylib if any of those previously pressed keys are still pressed. If not, send a key release message to roc.</p>



<a name="476587084"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/302903-platform%20development/topic/roc-ray/near/476587084" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/302903-platform-development/topic/roc-ray.html#476587084">(Oct 13 2024 at 07:57)</a>:</h4>
<p>Ok, I've gone a bit crazy today and implemented a bunch of things for roc-ray....</p>
<p>There's now the some common stateful things being passed in to each call to render. That reduces the number of Tasks that we need, and makes the API nicer to use for an app author. </p>
<p>I've also implemented an effect to take a screenshot... however I think the effect is actually running first even though I place it at the end of the task chain. I suspect this is my issue because whenever I take a screenshot it's just the cleared screen. I need to investigate this further.</p>
<p>Checkout the updated <a href="https://github.com/lukewilliamboswell/roc-ray/blob/main/examples/pong.roc">pong example</a> if you're interested.</p>



<a name="476596374"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/302903-platform%20development/topic/roc-ray/near/476596374" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/302903-platform-development/topic/roc-ray.html#476596374">(Oct 13 2024 at 10:36)</a>:</h4>
<p>I can get almost 4,000 frames per second doing normalish things with raylib. So I thought I'd see how much drawing slows down with lots and lots of things on the screen. </p>
<p><a href="https://gist.github.com/lukewilliamboswell/1867f2b495cf22b882a6114dd22bd80d">Here's a test program</a> I wrote to try and stress test it a little. Each frame I'm generating a list of random rectangles and then drawing them.</p>
<p>From my very unscientific testing...  my laptop runs out of memory and crashes before it gets below 60 fps.</p>
<p>Here's a screenshot with 100,000 rectangles randomly generated on each frame.</p>
<p><a href="/user_uploads/22008/mjy2wMklDbds7k4Svij9RVKC/Screenshot-2024-10-13-at-21.27.10.png">Screenshot 2024-10-13 at 21.27.10.png</a></p>
<div class="message_inline_image"><a href="/user_uploads/22008/mjy2wMklDbds7k4Svij9RVKC/Screenshot-2024-10-13-at-21.27.10.png" title="Screenshot 2024-10-13 at 21.27.10.png"><img data-original-dimensions="1626x1678" src="/user_uploads/thumbnail/22008/mjy2wMklDbds7k4Svij9RVKC/Screenshot-2024-10-13-at-21.27.10.png/840x560.webp"></a></div>



<a name="476623110"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/302903-platform%20development/topic/roc-ray/near/476623110" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/302903-platform-development/topic/roc-ray.html#476623110">(Oct 13 2024 at 17:32)</a>:</h4>
<p>Just don't change to drawing circles...those tend to be a lot slower. Though raylib probably has an optimized way to draw them, so maybe not an issue</p>



<a name="476623132"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/302903-platform%20development/topic/roc-ray/near/476623132" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/302903-platform-development/topic/roc-ray.html#476623132">(Oct 13 2024 at 17:32)</a>:</h4>
<blockquote>
<p>I suspect this is my issue because whenever I take a screenshot it's just the cleared screen. I need to investigate this further.</p>
</blockquote>
<p>You may be taking the screenshot before the screen actually renders? But not sure how all of that is wired together.</p>



<a name="476643431"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/302903-platform%20development/topic/roc-ray/near/476643431" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/302903-platform-development/topic/roc-ray.html#476643431">(Oct 13 2024 at 22:52)</a>:</h4>
<blockquote>
<p>Just don't change to drawing circles...those tend to be a lot slower</p>
</blockquote>
<p>Can confirm they are slower <span aria-label="smiley" class="emoji emoji-1f603" role="img" title="smiley">:smiley:</span></p>



<a name="476644812"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/302903-platform%20development/topic/roc-ray/near/476644812" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/302903-platform-development/topic/roc-ray.html#476644812">(Oct 13 2024 at 23:20)</a>:</h4>
<p>Added utc nanos timestamp, and <span class="user-mention" data-user-id="518883">@Ian McLerran</span>'s <a href="https://github.com/imclerran/roc-isodate">imclerran/roc-isodate</a> package works well <span aria-label="smiley" class="emoji emoji-1f603" role="img" title="smiley">:smiley:</span> </p>
<p><a href="/user_uploads/22008/pmLn3qEdb5MrpOTc3DlbnbGo/roc-ray-5.gif">roc-ray-5.gif</a></p>
<div class="message_inline_image"><a href="/user_uploads/22008/pmLn3qEdb5MrpOTc3DlbnbGo/roc-ray-5.gif" title="roc-ray-5.gif"><img data-animated="true" data-original-dimensions="807x155" src="/user_uploads/thumbnail/22008/pmLn3qEdb5MrpOTc3DlbnbGo/roc-ray-5.gif/840x560-anim.webp"></a></div>



<a name="476677682"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/302903-platform%20development/topic/roc-ray/near/476677682" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/302903-platform-development/topic/roc-ray.html#476677682">(Oct 14 2024 at 04:59)</a>:</h4>
<p>Added Camera's and Mode2D drawing... so now you can have separate World and Screen spaces to draw to and provide better support for different screen resolutions etc. </p>
<p><a href="/user_uploads/22008/dlLZlb8HOgu5mOAnx0BM-h1a/roc-ray-6.gif">roc-ray-6.gif</a></p>
<div class="message_inline_image"><a href="/user_uploads/22008/dlLZlb8HOgu5mOAnx0BM-h1a/roc-ray-6.gif" title="roc-ray-6.gif"><img data-animated="true" data-original-dimensions="815x573" src="/user_uploads/thumbnail/22008/dlLZlb8HOgu5mOAnx0BM-h1a/roc-ray-6.gif/840x560-anim.webp"></a></div>



<a name="476677719"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/302903-platform%20development/topic/roc-ray/near/476677719" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/302903-platform-development/topic/roc-ray.html#476677719">(Oct 14 2024 at 04:59)</a>:</h4>
<p>Here's the source for this example <a href="https://github.com/lukewilliamboswell/roc-ray/blob/main/examples/2d_camera.roc">https://github.com/lukewilliamboswell/roc-ray/blob/main/examples/2d_camera.roc</a></p>



<a name="476855106"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/302903-platform%20development/topic/roc-ray/near/476855106" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/302903-platform-development/topic/roc-ray.html#476855106">(Oct 14 2024 at 21:40)</a>:</h4>
<p>Looking to crowdsource some opinions on an idea for roc-ray....</p>
<p>I'm considering changing the API for app authors from this</p>
<div class="codehilite"><pre><span></span><code>Program state : {
    init : Task state {},
    render : state, PlatformState -&gt; Task state {},
}
</code></pre></div>
<p>To something more TEA-like. </p>
<div class="codehilite"><pre><span></span><code>Program state : {
    init : Task state {},
    update : state, PlatformState -&gt; Task state {},
    render : state -&gt; List Elems,
}

Elems : [
    Circle { pos : Vec2, ... },
    Rect { pos : Vec2, ... },
    Text { pos : Vec2, text : Str, ... },
    ...
]
</code></pre></div>
<p>My main motivation is that I have been thinking about how to improve the drawing to be more efficient and avoid deeply nested chains of Tasks. This approach would allow me to batch draw Tasks to one per "type", and can all be done in the platform, while keeping the API across the host boundary very simple.</p>
<p>In future if we needed more performance we can change the host API and do more efficient things without affecting any app authors.</p>
<p>What do people think? Is this a bad idea?</p>
<p>I haven't really investigated how this will work with multiple Camera's and Textures and 2D/3D drawing modes... but I am thinking this will make it easier because I can modify the type of <code>render</code> so that it isn't possible to mess up the order of things as an application author.</p>



<a name="476861646"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/302903-platform%20development/topic/roc-ray/near/476861646" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/302903-platform-development/topic/roc-ray.html#476861646">(Oct 14 2024 at 22:54)</a>:</h4>
<p>Assuming we change to purity inference and synchronous platform calls (which so the coroutines idea), I don't think you will have to worry about the cost here. I will still add a batched draw call though that can take a list of items to draw.</p>



<a name="476861676"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/302903-platform%20development/topic/roc-ray/near/476861676" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/302903-platform-development/topic/roc-ray.html#476861676">(Oct 14 2024 at 22:54)</a>:</h4>
<p>After writing this out... I'm not sure this is a good idea any more. I'm going to think about it some. My main concern is the ordering that raylib wants makes batching things difficult.</p>



<a name="476861734"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/302903-platform%20development/topic/roc-ray/near/476861734" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/302903-platform-development/topic/roc-ray.html#476861734">(Oct 14 2024 at 22:55)</a>:</h4>
<blockquote>
<p>add a batched draw call though that can take a list of items to draw.</p>
</blockquote>
<p>Good idea. I can just make all the draw functions take a <code>RocList</code></p>



<a name="476861894"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/302903-platform%20development/topic/roc-ray/near/476861894" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/302903-platform-development/topic/roc-ray.html#476861894">(Oct 14 2024 at 22:56)</a>:</h4>
<p>I would make two versions of each raw call <code>drawCircle</code> <code>drawCircles</code>...but a list for simplicity in all cases is also fine</p>



<a name="476861911"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/302903-platform%20development/topic/roc-ray/near/476861911" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/302903-platform-development/topic/roc-ray.html#476861911">(Oct 14 2024 at 22:56)</a>:</h4>
<p>I think that has minimal impact anyway... from this **</p>
<div class="codehilite"><pre><span></span><code>Raylib.drawText! { text: &quot;Hello World&quot;, x: 300, y: 50, size: 40, color: Navy }
Raylib.drawRectangle! { x: 100, y: 150, width: 250, height: 100, color: Aqua }
Raylib.drawRectangleGradient! { x: 400, y: 150, width: 250, height: 100, top: Lime, bottom: Green }
Raylib.drawCircle! { x: 200, y: 400, radius: 75, color: Fuchsia }
Raylib.drawCircleGradient! { x: 600, y: 400, radius: 75, inner: Yellow, outer: Maroon }
</code></pre></div>
<p>to this... </p>
<div class="codehilite"><pre><span></span><code>Raylib.drawText! [{ text: &quot;Hello World&quot;, x: 300, y: 50, size: 40, color: Navy }]
Raylib.drawRectangle! [{ x: 100, y: 150, width: 250, height: 100, color: Aqua }]
Raylib.drawRectangleGradient! [{ x: 400, y: 150, width: 250, height: 100, top: Lime, bottom: Green }]
Raylib.drawCircle! [{ x: 200, y: 400, radius: 75, color: Fuchsia }]
Raylib.drawCircleGradient! [{ x: 600, y: 400, radius: 75, inner: Yellow, outer: Maroon }]
</code></pre></div>
<p>edit ** I'm not so sure this is minimal on performance</p>



<a name="476861984"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/302903-platform%20development/topic/roc-ray/near/476861984" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/302903-platform-development/topic/roc-ray.html#476861984">(Oct 14 2024 at 22:57)</a>:</h4>
<p>Maybe the List version would be less efficient if it's only used for one thing everytime, because its adding an allocated type in the middle.</p>



<a name="476862056"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/302903-platform%20development/topic/roc-ray/near/476862056" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/302903-platform-development/topic/roc-ray.html#476862056">(Oct 14 2024 at 22:58)</a>:</h4>
<p>That's fair. Just a ton of extra malloc and free call (but they all should be in the fast bins for single element allocations). So in practice, it should keep reusing the same memory location for all of those list with a good malloc impl</p>



<a name="476862092"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/302903-platform%20development/topic/roc-ray/near/476862092" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/302903-platform-development/topic/roc-ray.html#476862092">(Oct 14 2024 at 22:58)</a>:</h4>
<p>Still extra overhead, but probably fine.</p>



<a name="476862138"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/302903-platform%20development/topic/roc-ray/near/476862138" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/302903-platform-development/topic/roc-ray.html#476862138">(Oct 14 2024 at 22:58)</a>:</h4>
<blockquote>
<p>change to purity inference and synchronous platform calls (which so the coroutines idea)</p>
</blockquote>
<p>Based on this... I'm thinking I'll just leave it. We should see how that pans out in practice.</p>



<a name="476873300"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/302903-platform%20development/topic/roc-ray/near/476873300" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/302903-platform-development/topic/roc-ray.html#476873300">(Oct 15 2024 at 01:24)</a>:</h4>
<p>Also -- I think I'm going to try replacing Zig with Rust for roc-ray. I've been cooking ideas, and my lack of zig experience is a bit of an challenge. I think with rust (and glue) I'll be more confident adding features quickly.</p>



<a name="476889620"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/302903-platform%20development/topic/roc-ray/near/476889620" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/302903-platform-development/topic/roc-ray.html#476889620">(Oct 15 2024 at 03:41)</a>:</h4>
<p>Got something minimal working in <a href="https://github.com/lukewilliamboswell/roc-ray/tree/spike-rust">https://github.com/lukewilliamboswell/roc-ray/tree/spike-rust</a></p>
<div class="codehilite"><pre><span></span><code>$ git checkout spike-rust
$ roc build --no-link examples/basic-shapes.roc
$ cp examples/basic-shapes.o app.o
$ cargo run
</code></pre></div>
<p>But I think I'm going to need to use the <code>ThreadSafeRefcountedResourceHeap</code> or something to keep track of all the resources from Raylib. Like Textures or DrawHandles</p>



<a name="476890470"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/302903-platform%20development/topic/roc-ray/near/476890470" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/302903-platform-development/topic/roc-ray.html#476890470">(Oct 15 2024 at 03:47)</a>:</h4>
<p>Or maybe spawn a single thread to handle all the drawing and have roc passing commands to that thread.</p>



<a name="476900069"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/302903-platform%20development/topic/roc-ray/near/476900069" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/302903-platform-development/topic/roc-ray.html#476900069">(Oct 15 2024 at 05:17)</a>:</h4>
<p>I spent a while poking at it. Working around rust here seems really painful. I'm guessing what we really want is effect interpreters.</p>



<a name="476901018"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/302903-platform%20development/topic/roc-ray/near/476901018" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/302903-platform-development/topic/roc-ray.html#476901018">(Oct 15 2024 at 05:28)</a>:</h4>
<p>Why? I don't understand the dilemma? Why is it different from basic cli or any other current platform? effect interpretters really only help with async (and raylib isn't async)</p>



<a name="476915408"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/302903-platform%20development/topic/roc-ray/near/476915408" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/302903-platform-development/topic/roc-ray.html#476915408">(Oct 15 2024 at 07:00)</a>:</h4>
<p>It feels more like we want good glue gen, which effect interpreters are on the other end of</p>



<a name="476918510"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/302903-platform%20development/topic/roc-ray/near/476918510" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/302903-platform-development/topic/roc-ray.html#476918510">(Oct 15 2024 at 07:13)</a>:</h4>
<p>The raylib-rs library models things in a way to make everything safe... so you need to have a handle that is !Sync and !Send</p>



<a name="476927004"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/302903-platform%20development/topic/roc-ray/near/476927004" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/302903-platform-development/topic/roc-ray.html#476927004">(Oct 15 2024 at 07:51)</a>:</h4>
<p>Here's an example. <a href="https://github.com/raylib-rs/raylib-rs/blob/a170ceed3b4453c3b5287fbc049f2472d3d3425a/raylib/src/core/drawing.rs#L23">https://github.com/raylib-rs/raylib-rs/blob/a170ceed3b4453c3b5287fbc049f2472d3d3425a/raylib/src/core/drawing.rs#L23</a></p>
<p>You call <code>begin_drawing</code> and then get a <code>RaylibDrawHandle</code>... and you need that handle to do any drawing.</p>



<a name="476927588"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/302903-platform%20development/topic/roc-ray/near/476927588" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/302903-platform-development/topic/roc-ray.html#476927588">(Oct 15 2024 at 07:54)</a>:</h4>
<p>I just found the raylib::ffi crate... I think that may what we need -- it's the lower level raylib-sys crate</p>



<a name="476931645"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/302903-platform%20development/topic/roc-ray/near/476931645" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/302903-platform-development/topic/roc-ray.html#476931645">(Oct 15 2024 at 08:16)</a>:</h4>
<p>I got it working!! <span aria-label="tada" class="emoji emoji-1f389" role="img" title="tada">:tada:</span></p>



<a name="476931673"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/302903-platform%20development/topic/roc-ray/near/476931673" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/302903-platform-development/topic/roc-ray.html#476931673">(Oct 15 2024 at 08:17)</a>:</h4>
<p>Literally everything is <code>unsafe</code> ... but that's fine I think.</p>



<a name="477033639"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/302903-platform%20development/topic/roc-ray/near/477033639" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/302903-platform-development/topic/roc-ray.html#477033639">(Oct 15 2024 at 17:03)</a>:</h4>
<blockquote>
<p>Literally everything is <code>unsafe</code></p>
</blockquote>
<p>This is why zig is probably a better medium for platforms a lot of the time (same as with the roc's stdlib).</p>



<a name="477053711"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/302903-platform%20development/topic/roc-ray/near/477053711" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/302903-platform-development/topic/roc-ray.html#477053711">(Oct 15 2024 at 19:05)</a>:</h4>
<p>If we had roc_std in zig and glue for zig then I also think zig is an excellent choice for hosts. I enjoyed working with it, but I'm more comfortable with rust at this point, and for roc-ray I really want to work with larger more complex types across the host interface and glue is really appreciated.</p>



<a name="477054699"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/302903-platform%20development/topic/roc-ray/near/477054699" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/302903-platform-development/topic/roc-ray.html#477054699">(Oct 15 2024 at 19:12)</a>:</h4>
<p>Makes total sense</p>



<a name="477180013"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/302903-platform%20development/topic/roc-ray/near/477180013" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/302903-platform-development/topic/roc-ray.html#477180013">(Oct 16 2024 at 10:27)</a>:</h4>
<p>Ok, completed the switch across to Rust... it's looking pretty nice I think. <a href="https://github.com/lukewilliamboswell/roc-ray">https://github.com/lukewilliamboswell/roc-ray</a></p>
<p>For platform and app authors the dependencies are down to roc, rust, and <code>build-essential + git</code> which is pretty nice. </p>
<p>I realised we can use the release builds from the raylib team directly... and then just generate our own bindings from the C header files. So much simpler to work with and removes a lot of crazy (large and messy) dependencies.</p>
<p>I haven't finished the build config for Windows... but have tested and that is also working nicely. Only set up for x64-linux and aarch64-mac because that's all I have been able to test on. Next up I'd like to investigate support for wasm/browsers.</p>



<a name="477231029"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/302903-platform%20development/topic/roc-ray/near/477231029" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/302903-platform-development/topic/roc-ray.html#477231029">(Oct 16 2024 at 14:34)</a>:</h4>
<p><span class="user-mention silent" data-user-id="515757">Luke Boswell</span> <a href="#narrow/stream/302903-platform-development/topic/roc-ray/near/477180013">said</a>:</p>
<blockquote>
<p>I realised we can use the release builds from the raylib team directly... and then just generate our own bindings from the C header files. So much simpler to work with and removes a lot of crazy (large and messy) dependencies.</p>
</blockquote>
<p>I'm surprised there isn't a raylib-sys or similar that is exactly that.</p>



<a name="477231231"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/302903-platform%20development/topic/roc-ray/near/477231231" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/302903-platform-development/topic/roc-ray.html#477231231">(Oct 16 2024 at 14:35)</a>:</h4>
<p>Normally <code>-sys</code> crates have a feature flag to just download a library instead of compile it.</p>



<a name="477246317"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/302903-platform%20development/topic/roc-ray/near/477246317" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/302903-platform-development/topic/roc-ray.html#477246317">(Oct 16 2024 at 15:39)</a>:</h4>
<p>That is what raylib-sys does, but it builds everything from source using Cmake which was a pain to get working reliably across different OS's.</p>



<a name="477246489"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/302903-platform%20development/topic/roc-ray/near/477246489" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/302903-platform-development/topic/roc-ray.html#477246489">(Oct 16 2024 at 15:40)</a>:</h4>
<p>It introduced a lot of additional dependencies and fragile config.</p>



<a name="477569486"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/302903-platform%20development/topic/roc-ray/near/477569486" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/302903-platform-development/topic/roc-ray.html#477569486">(Oct 18 2024 at 04:27)</a>:</h4>
<p>Question for the crowd ... I'm currently downloading the <code>libraylib.a</code> from the official releases from GH. This is working ok, but it's kind of buried in the build script. I've been thinking it's not great hitting github everytime we build, even though I cache the binary in <code>target/</code>. I'm wondering if I should instead include/vendor the raylib releases in the repository so after cloning there is no need to make any more http requests to get the files.</p>



<a name="477569530"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/302903-platform%20development/topic/roc-ray/near/477569530" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/302903-platform-development/topic/roc-ray.html#477569530">(Oct 18 2024 at 04:27)</a>:</h4>
<p>I'd love for the releases to have a hash or something so we know if they change. I figure if it's in the repository then it wont change under us without a PR.<br>
<em>edit</em> -- I guess I could just hash it myself and store that with the download URL</p>



<a name="477569623"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/302903-platform%20development/topic/roc-ray/near/477569623" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/302903-platform-development/topic/roc-ray.html#477569623">(Oct 18 2024 at 04:28)</a>:</h4>
<p><span class="user-mention" data-user-id="343810">@Brendan Hansknecht</span> <span class="user-mention" data-user-id="430894">@Dan G Knutson</span> what do you guys think?</p>



<a name="477569925"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/302903-platform%20development/topic/roc-ray/near/477569925" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/302903-platform-development/topic/roc-ray.html#477569925">(Oct 18 2024 at 04:31)</a>:</h4>
<p>Some people may want to use the library built from source, so I could include a flag to not copy the vendored version across and leave it up to the user then how they provide the library.</p>



<a name="477569948"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/302903-platform%20development/topic/roc-ray/near/477569948" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/302903-platform-development/topic/roc-ray.html#477569948">(Oct 18 2024 at 04:31)</a>:</h4>
<p>But at least the common experience is simple and reliable.</p>



<a name="477576290"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/302903-platform%20development/topic/roc-ray/near/477576290" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/302903-platform-development/topic/roc-ray.html#477576290">(Oct 18 2024 at 05:45)</a>:</h4>
<blockquote>
<p>Some people may want to use the library built from source</p>
</blockquote>
<p>I honestly wouldn't worry about or support this currently</p>



<a name="477576327"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/302903-platform%20development/topic/roc-ray/near/477576327" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/302903-platform-development/topic/roc-ray.html#477576327">(Oct 18 2024 at 05:46)</a>:</h4>
<p>Caching and vendoring both sound fine</p>



<a name="477576453"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/302903-platform%20development/topic/roc-ray/near/477576453" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/302903-platform-development/topic/roc-ray.html#477576453">(Oct 18 2024 at 05:47)</a>:</h4>
<p>Vendoring means more downloads overall (especially if it recorded in the repro history). How large is the lib?</p>



<a name="477576586"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/302903-platform%20development/topic/roc-ray/near/477576586" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/302903-platform-development/topic/roc-ray.html#477576586">(Oct 18 2024 at 05:48)</a>:</h4>
<p>Lib looks decently big. Some people may prefer just do download and cache the one version they need. So I would maybe push for just caching.</p>



<a name="477593741"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/302903-platform%20development/topic/roc-ray/near/477593741" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/302903-platform-development/topic/roc-ray.html#477593741">(Oct 18 2024 at 07:36)</a>:</h4>
<p>Ok, took some messing around... but we now have CI set up for linux, macos and windows! <span aria-label="smiley" class="emoji emoji-1f603" role="img" title="smiley">:smiley:</span></p>



<a name="477681706"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/302903-platform%20development/topic/roc-ray/near/477681706" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jared Cone <a href="https://roc-lang.github.io/zulip-export/stream/302903-platform-development/topic/roc-ray.html#477681706">(Oct 18 2024 at 15:34)</a>:</h4>
<p>I thought it was nice being able to get the raylib source out of the repo :)</p>



<a name="477771244"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/302903-platform%20development/topic/roc-ray/near/477771244" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/302903-platform-development/topic/roc-ray.html#477771244">(Oct 19 2024 at 04:21)</a>:</h4>
<p>First steps with Textures... literally <span aria-label="smiley" class="emoji emoji-1f603" role="img" title="smiley">:smiley:</span> <br>
<a href="/user_uploads/22008/LEM56a6OQXwb20tbMux319qs/roc-ray-7.gif">roc-ray-7.gif</a></p>
<div class="message_inline_image"><a href="/user_uploads/22008/LEM56a6OQXwb20tbMux319qs/roc-ray-7.gif" title="roc-ray-7.gif"><img data-animated="true" data-original-dimensions="459x213" src="/user_uploads/thumbnail/22008/LEM56a6OQXwb20tbMux319qs/roc-ray-7.gif/840x560-anim.webp"></a></div>



<a name="477773068"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/302903-platform%20development/topic/roc-ray/near/477773068" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/302903-platform-development/topic/roc-ray.html#477773068">(Oct 19 2024 at 04:50)</a>:</h4>
<p>Ooh, textures! You're really filling out that API</p>



<a name="477773101"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/302903-platform%20development/topic/roc-ray/near/477773101" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/302903-platform-development/topic/roc-ray.html#477773101">(Oct 19 2024 at 04:51)</a>:</h4>
<p>I've got an animated dude walking around the screen... <span aria-label="smiley" class="emoji emoji-1f603" role="img" title="smiley">:smiley:</span>  really great fun</p>



<a name="477886639"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/302903-platform%20development/topic/roc-ray/near/477886639" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/302903-platform-development/topic/roc-ray.html#477886639">(Oct 20 2024 at 10:56)</a>:</h4>
<p>Completed the raylib 2d camera core example, <a href="https://github.com/lukewilliamboswell/roc-ray/blob/main/examples/2d_camera.roc">link to roc-ray implementation</a><br>
<a href="/user_uploads/22008/2XAskn1j3tilMqYp8VGj_AOS/roc-ray-9.gif">roc-ray-9.gif</a></p>
<div class="message_inline_image"><a href="/user_uploads/22008/2XAskn1j3tilMqYp8VGj_AOS/roc-ray-9.gif" title="roc-ray-9.gif"><img data-animated="true" data-original-dimensions="803x482" src="/user_uploads/thumbnail/22008/2XAskn1j3tilMqYp8VGj_AOS/roc-ray-9.gif/840x560-anim.webp"></a></div>



<a name="478633507"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/302903-platform%20development/topic/roc-ray/near/478633507" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/302903-platform-development/topic/roc-ray.html#478633507">(Oct 24 2024 at 05:08)</a>:</h4>
<p>Another example -- 2D split-screen multiplayer <span aria-label="smiley" class="emoji emoji-1f603" role="img" title="smiley">:smiley:</span> <a href="https://github.com/lukewilliamboswell/roc-ray/blob/main/examples/2d_camera_split_screen.roc">source code</a></p>
<p>Apologies for the chaotic/erratic player movement... I can't drive a keyboard two handed <span aria-label="sweat smile" class="emoji emoji-1f605" role="img" title="sweat smile">:sweat_smile:</span> .</p>
<p><a href="/user_uploads/22008/uBDlZ56948OokYeGXlRSqRii/roc-ray-10.gif">roc-ray-10.gif</a></p>
<div class="message_inline_image"><a href="/user_uploads/22008/uBDlZ56948OokYeGXlRSqRii/roc-ray-10.gif" title="roc-ray-10.gif"><img data-animated="true" data-original-dimensions="804x472" src="/user_uploads/thumbnail/22008/uBDlZ56948OokYeGXlRSqRii/roc-ray-10.gif/840x560-anim.webp"></a></div>



<a name="478822329"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/302903-platform%20development/topic/roc-ray/near/478822329" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Aurélien Geron <a href="https://roc-lang.github.io/zulip-export/stream/302903-platform-development/topic/roc-ray.html#478822329">(Oct 25 2024 at 00:56)</a>:</h4>
<p>This is so cool!</p>



<a name="481522082"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/302903-platform%20development/topic/roc-ray/near/481522082" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/302903-platform-development/topic/roc-ray.html#481522082">(Nov 10 2024 at 03:41)</a>:</h4>
<p>Does anyone know what happens when <code>roc_panic</code> is called? Say we have called into roc, and then roc panics.... does roc return anything from that original call? </p>
<p>I.e. if the API is:</p>
<div class="codehilite"><pre><span></span><code>renderForHost! : Box Model, Effect.PlatformStateFromHost =&gt; Result (Box Model) Str
</code></pre></div>
<p>And we get a <code>roc_panic</code> during the call to <code>renderForHost!</code> does that return?</p>



<a name="481522368"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/302903-platform%20development/topic/roc-ray/near/481522368" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/302903-platform-development/topic/roc-ray.html#481522368">(Nov 10 2024 at 03:46)</a>:</h4>
<p>I'm guessing I need to <code>panic!</code> or something and then catch that somehow back in the place where we called into roc or something like that... but I really have no idea, just guessing.</p>



<a name="481523684"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/302903-platform%20development/topic/roc-ray/near/481523684" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ayaz Hafiz <a href="https://roc-lang.github.io/zulip-export/stream/302903-platform-development/topic/roc-ray.html#481523684">(Nov 10 2024 at 04:09)</a>:</h4>
<p>its up to the host what panic does</p>



<a name="481523695"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/302903-platform%20development/topic/roc-ray/near/481523695" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ayaz Hafiz <a href="https://roc-lang.github.io/zulip-export/stream/302903-platform-development/topic/roc-ray.html#481523695">(Nov 10 2024 at 04:09)</a>:</h4>
<p>in spirit it should never return</p>



<a name="481523778"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/302903-platform%20development/topic/roc-ray/near/481523778" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/302903-platform-development/topic/roc-ray.html#481523778">(Nov 10 2024 at 04:10)</a>:</h4>
<p>I'm not sure that rust panic works through ffi</p>



<a name="481523802"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/302903-platform%20development/topic/roc-ray/near/481523802" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/302903-platform-development/topic/roc-ray.html#481523802">(Nov 10 2024 at 04:10)</a>:</h4>
<p>Yeah, I think I just found that out the hard way</p>



<a name="481523803"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/302903-platform%20development/topic/roc-ray/near/481523803" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/302903-platform-development/topic/roc-ray.html#481523803">(Nov 10 2024 at 04:10)</a>:</h4>
<p>May need to do something more cursed like setjmp and longjmp</p>



<a name="481523820"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/302903-platform%20development/topic/roc-ray/near/481523820" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/302903-platform-development/topic/roc-ray.html#481523820">(Nov 10 2024 at 04:11)</a>:</h4>
<p>It will leak any live roc memory</p>



<a name="481523846"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/302903-platform%20development/topic/roc-ray/near/481523846" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/302903-platform-development/topic/roc-ray.html#481523846">(Nov 10 2024 at 04:11)</a>:</h4>
<p>This is definitely stretching the limits of my lowlevel knowledge...</p>



<a name="481523961"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/302903-platform%20development/topic/roc-ray/near/481523961" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/302903-platform-development/topic/roc-ray.html#481523961">(Nov 10 2024 at 04:13)</a>:</h4>
<p>Basically, I'm not sure how to get back to the point where I called into roc;</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="c1">// roc might panic in this call... I can do stuff in `roc_panic` ... but I need to get back here</span>
<span class="kd">let</span><span class="w"> </span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">render_caller</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">model</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="bp">self</span><span class="p">.</span><span class="n">state</span><span class="p">);</span>
</code></pre></div>



<a name="481524071"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/302903-platform%20development/topic/roc-ray/near/481524071" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/302903-platform-development/topic/roc-ray.html#481524071">(Nov 10 2024 at 04:14)</a>:</h4>
<p>Claude says it's possible... I'm going to try it</p>



<a name="481524115"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/302903-platform%20development/topic/roc-ray/near/481524115" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/302903-platform-development/topic/roc-ray.html#481524115">(Nov 10 2024 at 04:15)</a>:</h4>
<p>Yeah, you can do it with setjmp and longjmp</p>



<a name="481577354"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/302903-platform%20development/topic/roc-ray/near/481577354" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> teskje <a href="https://roc-lang.github.io/zulip-export/stream/302903-platform-development/topic/roc-ray.html#481577354">(Nov 10 2024 at 16:39)</a>:</h4>
<p>I had that same issue and <code>catch_unwind</code> seems to work for me. In <code>roc_panic</code> I simply convert the Roc panic into a Rust panic (<a href="https://github.com/teskje/roc-plugins-for-rust/blob/8e0ce41bfb8941c301e1ef6f3b66e0be5120fe71/src/roc_host.rs#L36">source</a>) that I then catch at the invocation side (<a href="https://github.com/teskje/roc-plugins-for-rust/blob/8e0ce41bfb8941c301e1ef6f3b66e0be5120fe71/src/plugin.rs#L87">source</a>).</p>
<p>That seems to work for me. I can't say anything about the safety of unwinding through FFI boundaries though.</p>



<a name="481577753"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/302903-platform%20development/topic/roc-ray/near/481577753" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/302903-platform-development/topic/roc-ray.html#481577753">(Nov 10 2024 at 16:44)</a>:</h4>
<p><a href="https://doc.rust-lang.org/nomicon/ffi.html#ffi-and-unwinding">https://doc.rust-lang.org/nomicon/ffi.html#ffi-and-unwinding</a></p>



<a name="481578013"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/302903-platform%20development/topic/roc-ray/near/481578013" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/302903-platform-development/topic/roc-ray.html#481578013">(Nov 10 2024 at 16:47)</a>:</h4>
<p>Sounds like they now have partial solution allowing unwinding c++ stack frames. That said, a roc stack frame is not a c++ stack frame....so probably ub</p>



<a name="481579099"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/302903-platform%20development/topic/roc-ray/near/481579099" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> teskje <a href="https://roc-lang.github.io/zulip-export/stream/302903-platform-development/topic/roc-ray.html#481579099">(Nov 10 2024 at 17:02)</a>:</h4>
<p>Hm, this part:</p>
<blockquote>
<p>If an unwinding operation does encounter an ABI boundary that is not permitted to unwind, the behavior depends on the source of the unwinding (Rust <code>panic</code> or a foreign exception):</p>
<ul>
<li><code>panic</code> will cause the process to safely abort.</li>
</ul>
</blockquote>
<p>makes me wonder why <code>catch_unwind</code> works for me. Seems like it should abort, but it doesn't. Maybe the nomicon is outdated here?</p>



<a name="481579585"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/302903-platform%20development/topic/roc-ray/near/481579585" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> teskje <a href="https://roc-lang.github.io/zulip-export/stream/302903-platform-development/topic/roc-ray.html#481579585">(Nov 10 2024 at 17:08)</a>:</h4>
<p>Ah, never mind. It was me who had an outdated Rust version :)</p>
<div class="codehilite"><pre><span></span><code>thread caused non-unwinding panic. aborting.
fish: Job 1, &#39;cargo run&#39; terminated by signal SIGABRT (Abort)
</code></pre></div>



<a name="481579620"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/302903-platform%20development/topic/roc-ray/near/481579620" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/302903-platform-development/topic/roc-ray.html#481579620">(Nov 10 2024 at 17:08)</a>:</h4>
<p>Rip....I guess it isn't ub anymore</p>



<a name="481579636"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/302903-platform%20development/topic/roc-ray/near/481579636" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/302903-platform-development/topic/roc-ray.html#481579636">(Nov 10 2024 at 17:09)</a>:</h4>
<p>What if you change the function abi to the <code>-unwind</code> variant and just lie to rust</p>



<a name="481579855"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/302903-platform%20development/topic/roc-ray/near/481579855" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> teskje <a href="https://roc-lang.github.io/zulip-export/stream/302903-platform-development/topic/roc-ray.html#481579855">(Nov 10 2024 at 17:11)</a>:</h4>
<p>That gives the old behavior (where things work but are probably UB)</p>



<a name="481580443"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/302903-platform%20development/topic/roc-ray/near/481580443" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/302903-platform-development/topic/roc-ray.html#481580443">(Nov 10 2024 at 17:19)</a>:</h4>
<p>May technically not be ub. Might just be that we have no unwind info, so it just dumps all the functions and leaks anything from the roc side.</p>



<a name="481580842"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/302903-platform%20development/topic/roc-ray/near/481580842" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> teskje <a href="https://roc-lang.github.io/zulip-export/stream/302903-platform-development/topic/roc-ray.html#481580842">(Nov 10 2024 at 17:23)</a>:</h4>
<p>Which would also be the case with setjmp/longjmp, right?</p>



<a name="481581050"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/302903-platform%20development/topic/roc-ray/near/481581050" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/302903-platform-development/topic/roc-ray.html#481581050">(Nov 10 2024 at 17:26)</a>:</h4>
<p>Yep</p>



<a name="481581061"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/302903-platform%20development/topic/roc-ray/near/481581061" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/302903-platform-development/topic/roc-ray.html#481581061">(Nov 10 2024 at 17:26)</a>:</h4>
<p>Eventually roc could theoretically generate unwind info that deals with refcounts</p>



<a name="481581616"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/302903-platform%20development/topic/roc-ray/near/481581616" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> teskje <a href="https://roc-lang.github.io/zulip-export/stream/302903-platform-development/topic/roc-ray.html#481581616">(Nov 10 2024 at 17:34)</a>:</h4>
<p>Since the platform also controls allocation, it seems feasible that it could keep track of all allocations performed by roc and manually free the leaked ones after a crash.</p>



<a name="481582702"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/302903-platform%20development/topic/roc-ray/near/481582702" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/302903-platform-development/topic/roc-ray.html#481582702">(Nov 10 2024 at 17:50)</a>:</h4>
<p>for sure</p>



<a name="481582723"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/302903-platform%20development/topic/roc-ray/near/481582723" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/302903-platform-development/topic/roc-ray.html#481582723">(Nov 10 2024 at 17:50)</a>:</h4>
<p>just less convenient and slower for many use cases</p>



<a name="481582749"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/302903-platform%20development/topic/roc-ray/near/481582749" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/302903-platform-development/topic/roc-ray.html#481582749">(Nov 10 2024 at 17:50)</a>:</h4>
<p>easiest if it works for your use case is just arena allocations</p>



<a name="481582864"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/302903-platform%20development/topic/roc-ray/near/481582864" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/302903-platform-development/topic/roc-ray.html#481582864">(Nov 10 2024 at 17:52)</a>:</h4>
<p>Also, the bigger problem is ensuring all resource are cleaned up more so than memory. For rust we have a solution for that in the roc std library for rust.</p>



<a name="481585278"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/302903-platform%20development/topic/roc-ray/near/481585278" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> teskje <a href="https://roc-lang.github.io/zulip-export/stream/302903-platform-development/topic/roc-ray.html#481585278">(Nov 10 2024 at 18:27)</a>:</h4>
<p>Oh, interesting! Can you link to that?</p>



<a name="481587497"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/302903-platform%20development/topic/roc-ray/near/481587497" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/302903-platform-development/topic/roc-ray.html#481587497">(Nov 10 2024 at 18:56)</a>:</h4>
<p>Library: <a href="https://github.com/roc-lang/roc/blob/main/crates/roc_std_heap/src/lib.rs">https://github.com/roc-lang/roc/blob/main/crates/roc_std_heap/src/lib.rs</a></p>
<p>Use in basic cli to automatically deal with files: <a href="https://github.com/roc-lang/basic-cli/blob/4048641e0067e2be35955226acd50e11eba1cf45/crates/roc_host/src/lib.rs#L34">https://github.com/roc-lang/basic-cli/blob/4048641e0067e2be35955226acd50e11eba1cf45/crates/roc_host/src/lib.rs#L34</a></p>
<p>This enables automatically closing files when roc frees a file object. It would also be possible to keep track of a live list or scan the entire heap during a panic to free all currently open files.</p>



<a name="481587553"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/302903-platform%20development/topic/roc-ray/near/481587553" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/302903-platform-development/topic/roc-ray.html#481587553">(Nov 10 2024 at 18:57)</a>:</h4>
<p>Still not the best solution, but a step closer. That plus arena allocation would let a platform fully clean up everything in roc after a panic without too much overhead.</p>



<a name="481589447"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/302903-platform%20development/topic/roc-ray/near/481589447" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> teskje <a href="https://roc-lang.github.io/zulip-export/stream/302903-platform-development/topic/roc-ray.html#481589447">(Nov 10 2024 at 19:21)</a>:</h4>
<p>Thanks! My current use case uses roc only to run pure functions, so I think I only need to worry about allocations. But in general it would be good to have a blessed way to handle roc crashes in platforms that want to keep going and not just exit the process.</p>



<a name="481589677"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/302903-platform%20development/topic/roc-ray/near/481589677" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/302903-platform-development/topic/roc-ray.html#481589677">(Nov 10 2024 at 19:24)</a>:</h4>
<p>Yeah, currently it is 100% up to the platform and only easy if arena allocations works for you.</p>



<hr><p>Last updated: Nov 01 2025 at 12:13 UTC</p>
</html>