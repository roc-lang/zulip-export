<html>
<head><meta charset="utf-8"><title>&quot;I just want a full stack dev server, but roc zig edition&quot; · platform development · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://roc-lang.github.io/zulip-export/stream/302903-platform-development/index.html">platform development</a></h2>
<h3>Topic: <a href="https://roc-lang.github.io/zulip-export/stream/302903-platform-development/topic/.22I.20just.20want.20a.20full.20stack.20dev.20server.2C.20but.20roc.20zig.20edition.22.html">&quot;I just want a full stack dev server, but roc zig edition&quot;</a></h3>

<hr>

<base href="https://roc.zulipchat.com">

<head><link href="https://roc-lang.github.io/zulip-export/style.css" rel="stylesheet"></head>

<a name="561034583"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/302903-platform%20development/topic/%22I%20just%20want%20a%20full%20stack%20dev%20server%2C%20but%20roc%20zig%20edition%22/near/561034583" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Scott Campbell <a href="https://roc-lang.github.io/zulip-export/stream/302903-platform-development/topic/.22I.20just.20want.20a.20full.20stack.20dev.20server.2C.20but.20roc.20zig.20edition.22.html#561034583">(Nov 30 2025 at 21:33)</a>:</h4>
<p>"I just want a full stack dev server, but roc zig edition"</p>
<p>I'm fairly new to roc &amp; zig...</p>
<p>A messy prototype, it has some features, it's missing features, it's not usable for any real projects yet, but it's a start!</p>
<p><a href="/user_uploads/22008/JlR-wPYrjn2-n917gqlQBP3J/Screenshot_20251201_045942.png">Screenshot_20251201_045942.png</a></p>
<div class="message_inline_image"><a href="/user_uploads/22008/JlR-wPYrjn2-n917gqlQBP3J/Screenshot_20251201_045942.png" title="Screenshot_20251201_045942.png"><img data-original-content-type="image/png" data-original-dimensions="1185x844" src="/user_uploads/thumbnail/22008/JlR-wPYrjn2-n917gqlQBP3J/Screenshot_20251201_045942.png/840x560.webp"></a></div><p><a href="/user_uploads/22008/s9ZQ8oDdh46GA51lxMnjxG5L/Screenshot_20251201_023424.png">Screenshot_20251201_023424.png</a></p>
<div class="message_inline_image"><a href="/user_uploads/22008/s9ZQ8oDdh46GA51lxMnjxG5L/Screenshot_20251201_023424.png" title="Screenshot_20251201_023424.png"><img data-original-content-type="image/png" data-original-dimensions="2558x1358" src="/user_uploads/thumbnail/22008/s9ZQ8oDdh46GA51lxMnjxG5L/Screenshot_20251201_023424.png/840x560.webp"></a></div><p>If you're looking for something you can use today... look at the rust implementations...</p>
<p><a href="https://github.com/kamenchunathan/galena">https://github.com/kamenchunathan/galena</a><br>
<a href="https://github.com/niclas-ahden/joy">https://github.com/niclas-ahden/joy</a><br>
<a href="https://github.com/lukewilliamboswell/roc-experiment-js-dom">https://github.com/lukewilliamboswell/roc-experiment-js-dom</a></p>
<p>... And I'm going to sleep...</p>



<a name="561034766"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/302903-platform%20development/topic/%22I%20just%20want%20a%20full%20stack%20dev%20server%2C%20but%20roc%20zig%20edition%22/near/561034766" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/302903-platform-development/topic/.22I.20just.20want.20a.20full.20stack.20dev.20server.2C.20but.20roc.20zig.20edition.22.html#561034766">(Nov 30 2025 at 21:35)</a>:</h4>
<p>Have you seen my template for zig <a href="https://github.com/lukewilliamboswell/roc-platform-template-zig">https://github.com/lukewilliamboswell/roc-platform-template-zig</a></p>



<a name="561034783"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/302903-platform%20development/topic/%22I%20just%20want%20a%20full%20stack%20dev%20server%2C%20but%20roc%20zig%20edition%22/near/561034783" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/302903-platform-development/topic/.22I.20just.20want.20a.20full.20stack.20dev.20server.2C.20but.20roc.20zig.20edition.22.html#561034783">(Nov 30 2025 at 21:35)</a>:</h4>
<p>That will be much nicer to start from than the fx test platform</p>



<a name="561034833"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/302903-platform%20development/topic/%22I%20just%20want%20a%20full%20stack%20dev%20server%2C%20but%20roc%20zig%20edition%22/near/561034833" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/302903-platform-development/topic/.22I.20just.20want.20a.20full.20stack.20dev.20server.2C.20but.20roc.20zig.20edition.22.html#561034833">(Nov 30 2025 at 21:36)</a>:</h4>
<p>It's a real implementation and even shows how to pass refcounted things when calling  into Roc</p>



<a name="561034973"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/302903-platform%20development/topic/%22I%20just%20want%20a%20full%20stack%20dev%20server%2C%20but%20roc%20zig%20edition%22/near/561034973" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/302903-platform-development/topic/.22I.20just.20want.20a.20full.20stack.20dev.20server.2C.20but.20roc.20zig.20edition.22.html#561034973">(Nov 30 2025 at 21:38)</a>:</h4>
<p>More usefully it's using the new zig compiler which has a much nicer calling convention</p>



<a name="561063937"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/302903-platform%20development/topic/%22I%20just%20want%20a%20full%20stack%20dev%20server%2C%20but%20roc%20zig%20edition%22/near/561063937" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Scott Campbell <a href="https://roc-lang.github.io/zulip-export/stream/302903-platform-development/topic/.22I.20just.20want.20a.20full.20stack.20dev.20server.2C.20but.20roc.20zig.20edition.22.html#561063937">(Dec 01 2025 at 04:55)</a>:</h4>
<p>Yup, seen it...</p>
<p>I'll probably want to look at the zig platform template again soon...</p>



<a name="561086403"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/302903-platform%20development/topic/%22I%20just%20want%20a%20full%20stack%20dev%20server%2C%20but%20roc%20zig%20edition%22/near/561086403" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Scott Campbell <a href="https://roc-lang.github.io/zulip-export/stream/302903-platform-development/topic/.22I.20just.20want.20a.20full.20stack.20dev.20server.2C.20but.20roc.20zig.20edition.22.html#561086403">(Dec 01 2025 at 07:56)</a>:</h4>
<p>Added scaffolding command...</p>
<p><a href="/user_uploads/22008/2B42BT7l9LEY0kJNmK30FjF1/Screenshot_20251201_154441.png">Screenshot_20251201_154441.png</a></p>
<div class="message_inline_image"><a href="/user_uploads/22008/2B42BT7l9LEY0kJNmK30FjF1/Screenshot_20251201_154441.png" title="Screenshot_20251201_154441.png"><img data-original-content-type="image/png" data-original-dimensions="720x946" src="/user_uploads/thumbnail/22008/2B42BT7l9LEY0kJNmK30FjF1/Screenshot_20251201_154441.png/840x560.webp"></a></div><p>Yeah, the zig platform template, is looking pretty good right about now... need a proper standalone build.zig and related files, to throw in <code>./my-roc-app/platform</code>.</p>



<a name="561090741"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/302903-platform%20development/topic/%22I%20just%20want%20a%20full%20stack%20dev%20server%2C%20but%20roc%20zig%20edition%22/near/561090741" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Scott Campbell <a href="https://roc-lang.github.io/zulip-export/stream/302903-platform-development/topic/.22I.20just.20want.20a.20full.20stack.20dev.20server.2C.20but.20roc.20zig.20edition.22.html#561090741">(Dec 01 2025 at 08:19)</a>:</h4>
<p>Yup, perfect... no idea what just happened, but it "just works".</p>
<p><a href="/user_uploads/22008/Rb3jIVY0SCMP86L4ZNM6Wk6U/Screenshot_20251201_161814.png">Screenshot_20251201_161814.png</a></p>
<div class="message_inline_image"><a href="/user_uploads/22008/Rb3jIVY0SCMP86L4ZNM6Wk6U/Screenshot_20251201_161814.png" title="Screenshot_20251201_161814.png"><img data-original-content-type="image/png" data-original-dimensions="1136x885" src="/user_uploads/thumbnail/22008/Rb3jIVY0SCMP86L4ZNM6Wk6U/Screenshot_20251201_161814.png/840x560.webp"></a></div>



<a name="561094827"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/302903-platform%20development/topic/%22I%20just%20want%20a%20full%20stack%20dev%20server%2C%20but%20roc%20zig%20edition%22/near/561094827" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Scott Campbell <a href="https://roc-lang.github.io/zulip-export/stream/302903-platform-development/topic/.22I.20just.20want.20a.20full.20stack.20dev.20server.2C.20but.20roc.20zig.20edition.22.html#561094827">(Dec 01 2025 at 08:37)</a>:</h4>
<p>Ah, had to call <code>zig build</code>, and update the <code>build.zig.zon</code> hash... prior to calling <code>bundle.sh</code></p>
<p><a href="/user_uploads/22008/1WQrAM42SpsSpBnFViEL1kfR/Screenshot_20251201_163610.png">Screenshot_20251201_163610.png</a></p>
<div class="message_inline_image"><a href="/user_uploads/22008/1WQrAM42SpsSpBnFViEL1kfR/Screenshot_20251201_163610.png" title="Screenshot_20251201_163610.png"><img data-original-content-type="image/png" data-original-dimensions="1000x377" src="/user_uploads/thumbnail/22008/1WQrAM42SpsSpBnFViEL1kfR/Screenshot_20251201_163610.png/840x560.webp"></a></div>



<a name="561100181"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/302903-platform%20development/topic/%22I%20just%20want%20a%20full%20stack%20dev%20server%2C%20but%20roc%20zig%20edition%22/near/561100181" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Scott Campbell <a href="https://roc-lang.github.io/zulip-export/stream/302903-platform-development/topic/.22I.20just.20want.20a.20full.20stack.20dev.20server.2C.20but.20roc.20zig.20edition.22.html#561100181">(Dec 01 2025 at 09:01)</a>:</h4>
<p>Would be nice, if it was pinned against a specific git commit instead of <code>#HEAD</code>, then can have a static hash.</p>
<p>I prefer reproduce-ability, and manually bumping, over automated bleeding edge and the occasional breakage.</p>
<p>Which is a good point, i'll add static commit id for the template also...</p>
<p>And i can override with my own zon file with a static commit id for roc.</p>



<a name="561101356"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/302903-platform%20development/topic/%22I%20just%20want%20a%20full%20stack%20dev%20server%2C%20but%20roc%20zig%20edition%22/near/561101356" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/302903-platform-development/topic/.22I.20just.20want.20a.20full.20stack.20dev.20server.2C.20but.20roc.20zig.20edition.22.html#561101356">(Dec 01 2025 at 09:07)</a>:</h4>
<p>Once we have a numbered release I would pin to that, but for now we are updating things quite frequently... though any actual changes to the builtins are rare.</p>
<p>In theory we could have a totally separate library for the RocStr/RocList etc we are using in the platform, but for now it's easy just to treat the roc repository as a library and borrow our builtin module directly.</p>



<a name="561105252"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/302903-platform%20development/topic/%22I%20just%20want%20a%20full%20stack%20dev%20server%2C%20but%20roc%20zig%20edition%22/near/561105252" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Scott Campbell <a href="https://roc-lang.github.io/zulip-export/stream/302903-platform-development/topic/.22I.20just.20want.20a.20full.20stack.20dev.20server.2C.20but.20roc.20zig.20edition.22.html#561105252">(Dec 01 2025 at 09:25)</a>:</h4>
<p>All good, I'm happy to implement it in my specific project.</p>
<p>I'll probably fork the template anyway, when I add some platform APIs</p>
<p><a href="/user_uploads/22008/JEHG0vFEYLy_3X7HD6QZCcZ4/Screenshot_20251201_172205.png">Screenshot_20251201_172205.png</a></p>
<div class="message_inline_image"><a href="/user_uploads/22008/JEHG0vFEYLy_3X7HD6QZCcZ4/Screenshot_20251201_172205.png" title="Screenshot_20251201_172205.png"><img data-original-content-type="image/png" data-original-dimensions="1423x1216" src="/user_uploads/thumbnail/22008/JEHG0vFEYLy_3X7HD6QZCcZ4/Screenshot_20251201_172205.png/840x560.webp"></a></div>



<a name="562061131"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/302903-platform%20development/topic/%22I%20just%20want%20a%20full%20stack%20dev%20server%2C%20but%20roc%20zig%20edition%22/near/562061131" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Scott Campbell <a href="https://roc-lang.github.io/zulip-export/stream/302903-platform-development/topic/.22I.20just.20want.20a.20full.20stack.20dev.20server.2C.20but.20roc.20zig.20edition.22.html#562061131">(Dec 05 2025 at 09:54)</a>:</h4>
<p><a href="/user_uploads/22008/J8Gf3dQ0_cFTffMJe2xiDsGp/Screenshot_20251204_214518.png">Screenshot_20251204_214518.png</a></p>
<div class="message_inline_image"><a href="/user_uploads/22008/J8Gf3dQ0_cFTffMJe2xiDsGp/Screenshot_20251204_214518.png" title="Screenshot_20251204_214518.png"><img data-original-content-type="image/png" data-original-dimensions="1494x1333" src="/user_uploads/thumbnail/22008/J8Gf3dQ0_cFTffMJe2xiDsGp/Screenshot_20251204_214518.png/840x560.webp"></a></div><p>Stuck on...<br>
Server.serve!(Str)</p>
<p>Should really be...<br>
Server.serve!(Str-&gt;Str)</p>
<p>Except I don't know how to implement accepting a function, via the args pointer, in the host platform, for a function. Let alone how to invoke it.</p>
<p>We get a pointer... but a pointer to what exactly? I assume it's an array or struct, that could have multiple arguments passed...</p>
<p>And specifically, the first element in the array, would be some kind of function pointer...?</p>
<p>Reading the interpreter and CallHostedFunction... it's <code>args_buffer</code> of type <code>*anyopaque</code>...</p>
<div class="codehilite" data-code-language="Zig"><pre><span></span><code><span class="k">fn</span><span class="w"> </span><span class="n">callHostedFunction</span><span class="p">(</span>
<span class="w">    </span><span class="n">self</span><span class="o">:</span><span class="w"> </span><span class="o">*</span><span class="n">Interpreter</span><span class="p">,</span>
<span class="w">    </span><span class="n">hosted_fn_index</span><span class="o">:</span><span class="w"> </span><span class="kt">u32</span><span class="p">,</span>
<span class="w">    </span><span class="n">args</span><span class="o">:</span><span class="w"> </span><span class="p">[]</span><span class="n">StackValue</span><span class="p">,</span>
<span class="w">    </span><span class="n">roc_ops</span><span class="o">:</span><span class="w"> </span><span class="o">*</span><span class="n">RocOps</span><span class="p">,</span>
<span class="w">    </span><span class="n">return_rt_var</span><span class="o">:</span><span class="w"> </span><span class="n">types</span><span class="p">.</span><span class="n">Var</span><span class="p">,</span>
<span class="p">)</span><span class="w"> </span><span class="o">!</span><span class="n">StackValue</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// Validate index is within bounds</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">hosted_fn_index</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="n">roc_ops</span><span class="p">.</span><span class="n">hosted_fns</span><span class="p">.</span><span class="n">count</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">self</span><span class="p">.</span><span class="n">triggerCrash</span><span class="p">(</span><span class="s">"Hosted function index out of bounds"</span><span class="p">,</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w"> </span><span class="n">roc_ops</span><span class="p">);</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="k">error</span><span class="p">.</span><span class="n">Crash</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// Get the hosted function pointer from RocOps</span>
<span class="w">    </span><span class="kr">const</span><span class="w"> </span><span class="n">hosted_fn</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">roc_ops</span><span class="p">.</span><span class="n">hosted_fns</span><span class="p">.</span><span class="n">fns</span><span class="p">[</span><span class="n">hosted_fn_index</span><span class="p">];</span>

<span class="w">    </span><span class="c1">// Allocate space for the return value using the actual return type</span>
<span class="w">    </span><span class="kr">const</span><span class="w"> </span><span class="n">return_layout</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">try</span><span class="w"> </span><span class="n">self</span><span class="p">.</span><span class="n">getRuntimeLayout</span><span class="p">(</span><span class="n">return_rt_var</span><span class="p">);</span>
<span class="w">    </span><span class="kr">const</span><span class="w"> </span><span class="n">result_value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">try</span><span class="w"> </span><span class="n">self</span><span class="p">.</span><span class="n">pushRaw</span><span class="p">(</span><span class="n">return_layout</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">);</span>

<span class="w">    </span><span class="c1">// Get return pointer (for ZST returns, use a dummy stack address)</span>
<span class="w">    </span><span class="kr">const</span><span class="w"> </span><span class="n">ret_ptr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">result_value</span><span class="p">.</span><span class="n">ptr</span><span class="p">)</span><span class="w"> </span><span class="o">|</span><span class="n">p</span><span class="o">|</span><span class="w"> </span><span class="n">p</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="nb">@as</span><span class="p">(</span><span class="o">*</span><span class="n">anyopaque</span><span class="p">,</span><span class="w"> </span><span class="nb">@ptrFromInt</span><span class="p">(</span><span class="nb">@intFromPtr</span><span class="p">(</span><span class="o">&amp;</span><span class="n">result_value</span><span class="p">)));</span>

<span class="w">    </span><span class="c1">// Calculate total size needed for packed arguments</span>
<span class="w">    </span><span class="kr">var</span><span class="w"> </span><span class="n">total_args_size</span><span class="o">:</span><span class="w"> </span><span class="kt">usize</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">    </span><span class="kr">var</span><span class="w"> </span><span class="n">max_alignment</span><span class="o">:</span><span class="w"> </span><span class="n">std</span><span class="p">.</span><span class="n">mem</span><span class="p">.</span><span class="n">Alignment</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="err">@</span><span class="s">"1"</span><span class="p">;</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">args</span><span class="p">)</span><span class="w"> </span><span class="o">|</span><span class="n">arg</span><span class="o">|</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kr">const</span><span class="w"> </span><span class="n">arg_size</span><span class="o">:</span><span class="w"> </span><span class="kt">usize</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">self</span><span class="p">.</span><span class="n">runtime_layout_store</span><span class="p">.</span><span class="n">layoutSize</span><span class="p">(</span><span class="n">arg</span><span class="p">.</span><span class="n">layout</span><span class="p">);</span>
<span class="w">        </span><span class="kr">const</span><span class="w"> </span><span class="n">arg_align</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">arg</span><span class="p">.</span><span class="n">layout</span><span class="p">.</span><span class="n">alignment</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">runtime_layout_store</span><span class="p">.</span><span class="n">targetUsize</span><span class="p">());</span>
<span class="w">        </span><span class="n">max_alignment</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">max_alignment</span><span class="p">.</span><span class="n">max</span><span class="p">(</span><span class="n">arg_align</span><span class="p">);</span>
<span class="w">        </span><span class="c1">// Align to the argument's alignment</span>
<span class="w">        </span><span class="n">total_args_size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="p">.</span><span class="n">mem</span><span class="p">.</span><span class="n">alignForward</span><span class="p">(</span><span class="kt">usize</span><span class="p">,</span><span class="w"> </span><span class="n">total_args_size</span><span class="p">,</span><span class="w"> </span><span class="n">arg_align</span><span class="p">.</span><span class="n">toByteUnits</span><span class="p">());</span>
<span class="w">        </span><span class="n">total_args_size</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">arg_size</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">args</span><span class="p">.</span><span class="n">len</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// Zero argument case - pass dummy pointer</span>
<span class="w">        </span><span class="kr">var</span><span class="w"> </span><span class="n">dummy</span><span class="o">:</span><span class="w"> </span><span class="kt">u8</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">        </span><span class="n">hosted_fn</span><span class="p">(</span><span class="n">roc_ops</span><span class="p">,</span><span class="w"> </span><span class="n">ret_ptr</span><span class="p">,</span><span class="w"> </span><span class="nb">@ptrCast</span><span class="p">(</span><span class="o">&amp;</span><span class="n">dummy</span><span class="p">));</span>
<span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// Allocate buffer for packed arguments</span>
<span class="w">        </span><span class="kr">const</span><span class="w"> </span><span class="n">args_buffer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">try</span><span class="w"> </span><span class="n">self</span><span class="p">.</span><span class="n">stack_memory</span><span class="p">.</span><span class="n">alloca</span><span class="p">(</span><span class="nb">@intCast</span><span class="p">(</span><span class="n">total_args_size</span><span class="p">),</span><span class="w"> </span><span class="n">max_alignment</span><span class="p">);</span>

<span class="w">        </span><span class="c1">// Pack each argument into the buffer</span>
<span class="w">        </span><span class="kr">var</span><span class="w"> </span><span class="n">offset</span><span class="o">:</span><span class="w"> </span><span class="kt">usize</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">args</span><span class="p">)</span><span class="w"> </span><span class="o">|</span><span class="n">arg</span><span class="o">|</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="kr">const</span><span class="w"> </span><span class="n">arg_size</span><span class="o">:</span><span class="w"> </span><span class="kt">usize</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">self</span><span class="p">.</span><span class="n">runtime_layout_store</span><span class="p">.</span><span class="n">layoutSize</span><span class="p">(</span><span class="n">arg</span><span class="p">.</span><span class="n">layout</span><span class="p">);</span>
<span class="w">            </span><span class="kr">const</span><span class="w"> </span><span class="n">arg_align</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">arg</span><span class="p">.</span><span class="n">layout</span><span class="p">.</span><span class="n">alignment</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">runtime_layout_store</span><span class="p">.</span><span class="n">targetUsize</span><span class="p">());</span>

<span class="w">            </span><span class="c1">// Align offset</span>
<span class="w">            </span><span class="n">offset</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="p">.</span><span class="n">mem</span><span class="p">.</span><span class="n">alignForward</span><span class="p">(</span><span class="kt">usize</span><span class="p">,</span><span class="w"> </span><span class="n">offset</span><span class="p">,</span><span class="w"> </span><span class="n">arg_align</span><span class="p">.</span><span class="n">toByteUnits</span><span class="p">());</span>

<span class="w">            </span><span class="c1">// Copy argument data</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">arg_size</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">arg</span><span class="p">.</span><span class="n">ptr</span><span class="p">)</span><span class="w"> </span><span class="o">|</span><span class="n">src_ptr</span><span class="o">|</span><span class="w"> </span><span class="p">{</span>
<span class="w">                    </span><span class="kr">const</span><span class="w"> </span><span class="n">dest_ptr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">@as</span><span class="p">([</span><span class="o">*</span><span class="p">]</span><span class="kt">u8</span><span class="p">,</span><span class="w"> </span><span class="nb">@ptrCast</span><span class="p">(</span><span class="n">args_buffer</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">offset</span><span class="p">;</span>
<span class="w">                    </span><span class="nb">@memcpy</span><span class="p">(</span><span class="n">dest_ptr</span><span class="p">[</span><span class="mi">0</span><span class="p">..</span><span class="n">arg_size</span><span class="p">],</span><span class="w"> </span><span class="nb">@as</span><span class="p">([</span><span class="o">*</span><span class="p">]</span><span class="kr">const</span><span class="w"> </span><span class="kt">u8</span><span class="p">,</span><span class="w"> </span><span class="nb">@ptrCast</span><span class="p">(</span><span class="n">src_ptr</span><span class="p">))[</span><span class="mi">0</span><span class="p">..</span><span class="n">arg_size</span><span class="p">]);</span>
<span class="w">                </span><span class="p">}</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">            </span><span class="n">offset</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">arg_size</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="c1">// Invoke the hosted function following RocCall ABI: (ops, ret_ptr, args_ptr)</span>
<span class="w">        </span><span class="n">hosted_fn</span><span class="p">(</span><span class="n">roc_ops</span><span class="p">,</span><span class="w"> </span><span class="n">ret_ptr</span><span class="p">,</span><span class="w"> </span><span class="n">args_buffer</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">result_value</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<p><a href="/user_uploads/22008/c-aE7ikW1OgWUPuVaX9aMCsF/Screenshot_20251205_173745.png">Screenshot_20251205_173745.png</a></p>
<div class="message_inline_image"><a href="/user_uploads/22008/c-aE7ikW1OgWUPuVaX9aMCsF/Screenshot_20251205_173745.png" title="Screenshot_20251205_173745.png"><img data-original-content-type="image/png" data-original-dimensions="787x438" src="/user_uploads/thumbnail/22008/c-aE7ikW1OgWUPuVaX9aMCsF/Screenshot_20251205_173745.png/840x560.webp"></a></div><p>I assume the StackValue, in question is actually a <code>layout.Closure</code>...?</p>
<div class="codehilite" data-code-language="Zig"><pre><span></span><code><span class="c1">/// Represents a closure with its captured environment</span>
<span class="kr">pub</span><span class="w"> </span><span class="kr">const</span><span class="w"> </span><span class="n">Closure</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">body_idx</span><span class="o">:</span><span class="w"> </span><span class="n">CIR</span><span class="p">.</span><span class="n">Expr</span><span class="p">.</span><span class="n">Idx</span><span class="p">,</span>
<span class="w">    </span><span class="n">params</span><span class="o">:</span><span class="w"> </span><span class="n">CIR</span><span class="p">.</span><span class="n">Pattern</span><span class="p">.</span><span class="n">Span</span><span class="p">,</span>
<span class="w">    </span><span class="n">captures_pattern_idx</span><span class="o">:</span><span class="w"> </span><span class="n">CIR</span><span class="p">.</span><span class="n">Pattern</span><span class="p">.</span><span class="n">Idx</span><span class="p">,</span>
<span class="w">    </span><span class="c1">// Layout index for the captured environment record</span>
<span class="w">    </span><span class="n">captures_layout_idx</span><span class="o">:</span><span class="w"> </span><span class="n">Idx</span><span class="p">,</span>
<span class="w">    </span><span class="c1">// Original lambda expression index for accessing captures</span>
<span class="w">    </span><span class="n">lambda_expr_idx</span><span class="o">:</span><span class="w"> </span><span class="n">CIR</span><span class="p">.</span><span class="n">Expr</span><span class="p">.</span><span class="n">Idx</span><span class="p">,</span>
<span class="w">    </span><span class="c1">// Module environment where this closure was created (for correct expression evaluation)</span>
<span class="w">    </span><span class="n">source_env</span><span class="o">:</span><span class="w"> </span><span class="o">*</span><span class="kr">const</span><span class="w"> </span><span class="nb">@import</span><span class="p">(</span><span class="s">"can"</span><span class="p">).</span><span class="n">ModuleEnv</span><span class="p">,</span>
<span class="p">};</span>
</code></pre></div>
<p>I added roc's layout module, to the platform... so I have the struct available... I tried copy pasting the string example...</p>
<div class="codehilite" data-code-language="Zig"><pre><span></span><code><span class="kr">const</span><span class="w"> </span><span class="n">Args</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kr">extern</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">func</span><span class="o">:</span><span class="w"> </span><span class="n">layout</span><span class="p">.</span><span class="n">Closure</span><span class="w"> </span><span class="p">};</span>
<span class="kr">const</span><span class="w"> </span><span class="n">args</span><span class="o">:</span><span class="w"> </span><span class="o">*</span><span class="n">Args</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">@ptrCast</span><span class="p">(</span><span class="nb">@alignCast</span><span class="p">(</span><span class="n">args_ptr</span><span class="p">));</span>
</code></pre></div>
<p>Zig complains that's not not flagged as an ABI sized packed struct... And this is getting a bit more technical then used to... so i'm starting to get slightly confused.</p>
<div class="codehilite"><pre><span></span><code>platform/host.zig:288:46: error: extern structs cannot contain fields of type 'layout.Closure'
    const Args = extern struct { func: layout.Closure };
                                       ~~~~~~^~~~~~~~
platform/host.zig:288:46: note: only extern structs and ABI sized packed structs are extern compatible
/home/anon/.cache/zig/p/roc-0.0.0-NAC9w6FtewDruF0JVeJYUTYDDBMU9xmKwv5RCBoCplzn/src/layout/layout.zig:116:21: note: struct declared here
pub const Closure = struct {
                    ^~~~~~
referenced by:
    hostedZServerServe2: platform/host.zig:288:25
    hosted_function_ptrs: platform/host.zig:317:5
</code></pre></div>
<p>And now I'm kinda stuck...</p>
<div class="codehilite" data-code-language="Zig"><pre><span></span><code><span class="kr">pub</span><span class="w"> </span><span class="kr">const</span><span class="w"> </span><span class="n">RocStr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kr">extern</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="p">{</span>
<span class="c1">// ...</span>
<span class="kr">pub</span><span class="w"> </span><span class="kr">const</span><span class="w"> </span><span class="n">Closure</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="p">{</span>
</code></pre></div>
<p>Hmm...</p>



<a name="562065979"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/302903-platform%20development/topic/%22I%20just%20want%20a%20full%20stack%20dev%20server%2C%20but%20roc%20zig%20edition%22/near/562065979" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Scott Campbell <a href="https://roc-lang.github.io/zulip-export/stream/302903-platform-development/topic/.22I.20just.20want.20a.20full.20stack.20dev.20server.2C.20but.20roc.20zig.20edition.22.html#562065979">(Dec 05 2025 at 10:21)</a>:</h4>
<p>Oh, i see... <code>@This</code>, is actually referring to the fields below?!</p>
<div class="codehilite" data-code-language="Zig"><pre><span></span><code><span class="kr">const</span><span class="w"> </span><span class="n">StackValue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">@This</span><span class="p">();</span>

<span class="c1">/// Type and memory layout information for the result value</span>
<span class="n">layout</span><span class="o">:</span><span class="w"> </span><span class="n">Layout</span><span class="p">,</span>
<span class="c1">/// Ptr to the actual value in stack memory</span>
<span class="n">ptr</span><span class="o">:</span><span class="w"> </span><span class="o">?*</span><span class="n">anyopaque</span><span class="p">,</span>
<span class="c1">/// Flag to track whether the memory has been initialized</span>
<span class="n">is_initialized</span><span class="o">:</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span>
<span class="c1">/// Optional runtime type variable for type information (used in constant folding)</span>
<span class="n">rt_var</span><span class="o">:</span><span class="w"> </span><span class="o">?</span><span class="n">types</span><span class="p">.</span><span class="n">Var</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span>
</code></pre></div>



<a name="562071603"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/302903-platform%20development/topic/%22I%20just%20want%20a%20full%20stack%20dev%20server%2C%20but%20roc%20zig%20edition%22/near/562071603" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Scott Campbell <a href="https://roc-lang.github.io/zulip-export/stream/302903-platform-development/topic/.22I.20just.20want.20a.20full.20stack.20dev.20server.2C.20but.20roc.20zig.20edition.22.html#562071603">(Dec 05 2025 at 10:50)</a>:</h4>
<div class="codehilite" data-code-language="Zig"><pre><span></span><code><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">arg</span><span class="p">.</span><span class="n">ptr</span><span class="p">)</span><span class="w"> </span><span class="o">|</span><span class="n">src_ptr</span><span class="o">|</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kr">const</span><span class="w"> </span><span class="n">dest_ptr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">@as</span><span class="p">([</span><span class="o">*</span><span class="p">]</span><span class="kt">u8</span><span class="p">,</span><span class="w"> </span><span class="nb">@ptrCast</span><span class="p">(</span><span class="n">args_buffer</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">offset</span><span class="p">;</span>
<span class="w">    </span><span class="nb">@memcpy</span><span class="p">(</span><span class="n">dest_ptr</span><span class="p">[</span><span class="mi">0</span><span class="p">..</span><span class="n">arg_size</span><span class="p">],</span><span class="w"> </span><span class="nb">@as</span><span class="p">([</span><span class="o">*</span><span class="p">]</span><span class="kr">const</span><span class="w"> </span><span class="kt">u8</span><span class="p">,</span><span class="w"> </span><span class="nb">@ptrCast</span><span class="p">(</span><span class="n">src_ptr</span><span class="p">))[</span><span class="mi">0</span><span class="p">..</span><span class="n">arg_size</span><span class="p">]);</span>
<span class="p">}</span>
</code></pre></div>
<p>So it looks like, it's <code>memcpy</code>ing, whatever is at the ptr, for whatever the <code>arg_size</code> is... and arg_size is... the size of the layout.</p>
<div class="codehilite" data-code-language="Zig"><pre><span></span><code><span class="c1">/// Get the size in bytes of a layout, given the store's target usize.</span>
<span class="kr">pub</span><span class="w"> </span><span class="k">fn</span><span class="w"> </span><span class="n">layoutSize</span><span class="p">(</span><span class="n">self</span><span class="o">:</span><span class="w"> </span><span class="o">*</span><span class="kr">const</span><span class="w"> </span><span class="n">Self</span><span class="p">,</span><span class="w"> </span><span class="n">layout</span><span class="o">:</span><span class="w"> </span><span class="n">Layout</span><span class="p">)</span><span class="w"> </span><span class="kt">u32</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// TODO change this to SizeAlign (just return both since they're packed into 4B anyway)</span>
<span class="w">    </span><span class="c1">// and also change it to just return that one field instead of doing any conditionals.</span>
<span class="w">    </span><span class="c1">// also have it take an Idx. if you already have a Layout you can just get that.</span>
<span class="w">    </span><span class="kr">const</span><span class="w"> </span><span class="n">target_usize</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">self</span><span class="p">.</span><span class="n">targetUsize</span><span class="p">();</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="k">switch</span><span class="w"> </span><span class="p">(</span><span class="n">layout</span><span class="p">.</span><span class="n">tag</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="p">.</span><span class="n">scalar</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="k">switch</span><span class="w"> </span><span class="p">(</span><span class="n">layout</span><span class="p">.</span><span class="n">data</span><span class="p">.</span><span class="n">scalar</span><span class="p">.</span><span class="n">tag</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="p">.</span><span class="n">int</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">layout</span><span class="p">.</span><span class="n">data</span><span class="p">.</span><span class="n">scalar</span><span class="p">.</span><span class="n">data</span><span class="p">.</span><span class="n">int</span><span class="p">.</span><span class="n">size</span><span class="p">(),</span>
<span class="w">            </span><span class="p">.</span><span class="n">frac</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">layout</span><span class="p">.</span><span class="n">data</span><span class="p">.</span><span class="n">scalar</span><span class="p">.</span><span class="n">data</span><span class="p">.</span><span class="n">frac</span><span class="p">.</span><span class="n">size</span><span class="p">(),</span>
<span class="w">            </span><span class="p">.</span><span class="n">str</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="mi">3</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">target_usize</span><span class="p">.</span><span class="n">size</span><span class="p">(),</span><span class="w"> </span><span class="c1">// ptr, byte length, capacity</span>
<span class="w">            </span><span class="p">.</span><span class="n">opaque_ptr</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">target_usize</span><span class="p">.</span><span class="n">size</span><span class="p">(),</span><span class="w"> </span><span class="c1">// opaque_ptr is pointer-sized</span>
<span class="w">        </span><span class="p">},</span>
<span class="w">        </span><span class="p">.</span><span class="n">box</span><span class="p">,</span><span class="w"> </span><span class="p">.</span><span class="n">box_of_zst</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">target_usize</span><span class="p">.</span><span class="n">size</span><span class="p">(),</span><span class="w"> </span><span class="c1">// a Box is just a pointer to refcounted memory</span>
<span class="w">        </span><span class="p">.</span><span class="n">list</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="mi">3</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">target_usize</span><span class="p">.</span><span class="n">size</span><span class="p">(),</span><span class="w"> </span><span class="c1">// ptr, length, capacity</span>
<span class="w">        </span><span class="p">.</span><span class="n">list_of_zst</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="mi">3</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">target_usize</span><span class="p">.</span><span class="n">size</span><span class="p">(),</span><span class="w"> </span><span class="c1">// list_of_zst has same header structure as list</span>
<span class="w">        </span><span class="p">.</span><span class="n">record</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">self</span><span class="p">.</span><span class="n">record_data</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="nb">@enumFromInt</span><span class="p">(</span><span class="n">layout</span><span class="p">.</span><span class="n">data</span><span class="p">.</span><span class="n">record</span><span class="p">.</span><span class="n">idx</span><span class="p">.</span><span class="n">int_idx</span><span class="p">)).</span><span class="n">size</span><span class="p">,</span>
<span class="w">        </span><span class="p">.</span><span class="n">tuple</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">self</span><span class="p">.</span><span class="n">tuple_data</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="nb">@enumFromInt</span><span class="p">(</span><span class="n">layout</span><span class="p">.</span><span class="n">data</span><span class="p">.</span><span class="n">tuple</span><span class="p">.</span><span class="n">idx</span><span class="p">.</span><span class="n">int_idx</span><span class="p">)).</span><span class="n">size</span><span class="p">,</span>
<span class="w">        </span><span class="p">.</span><span class="n">closure</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="c1">// Closure layout: header + aligned capture data</span>
<span class="w">            </span><span class="kr">const</span><span class="w"> </span><span class="n">header_size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">@sizeOf</span><span class="p">(</span><span class="n">layout_mod</span><span class="p">.</span><span class="n">Closure</span><span class="p">);</span>
<span class="w">            </span><span class="kr">const</span><span class="w"> </span><span class="n">captures_layout</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">self</span><span class="p">.</span><span class="n">getLayout</span><span class="p">(</span><span class="n">layout</span><span class="p">.</span><span class="n">data</span><span class="p">.</span><span class="n">closure</span><span class="p">.</span><span class="n">captures_layout_idx</span><span class="p">);</span>
<span class="w">            </span><span class="kr">const</span><span class="w"> </span><span class="n">captures_alignment</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">captures_layout</span><span class="p">.</span><span class="n">alignment</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">targetUsize</span><span class="p">());</span>
<span class="w">            </span><span class="kr">const</span><span class="w"> </span><span class="n">aligned_captures_offset</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="p">.</span><span class="n">mem</span><span class="p">.</span><span class="n">alignForward</span><span class="p">(</span><span class="kt">u32</span><span class="p">,</span><span class="w"> </span><span class="n">header_size</span><span class="p">,</span><span class="w"> </span><span class="nb">@intCast</span><span class="p">(</span><span class="n">captures_alignment</span><span class="p">.</span><span class="n">toByteUnits</span><span class="p">()));</span>
<span class="w">            </span><span class="kr">const</span><span class="w"> </span><span class="n">captures_size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">self</span><span class="p">.</span><span class="n">layoutSize</span><span class="p">(</span><span class="n">captures_layout</span><span class="p">);</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">aligned_captures_offset</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">captures_size</span><span class="p">;</span>
<span class="w">        </span><span class="p">},</span>
<span class="w">        </span><span class="p">.</span><span class="n">tag_union</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">self</span><span class="p">.</span><span class="n">tag_union_data</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="nb">@enumFromInt</span><span class="p">(</span><span class="n">layout</span><span class="p">.</span><span class="n">data</span><span class="p">.</span><span class="n">tag_union</span><span class="p">.</span><span class="n">idx</span><span class="p">.</span><span class="n">int_idx</span><span class="p">)).</span><span class="n">size</span><span class="p">,</span>
<span class="w">        </span><span class="p">.</span><span class="n">zst</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="c1">// Zero-sized types have size 0</span>
<span class="w">    </span><span class="p">};</span>
<span class="p">}</span>
</code></pre></div>
<p>Hmmm...</p>



<hr><p>Last updated: Mar 01 2026 at 12:20 UTC</p>
</html>