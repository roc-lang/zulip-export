<html>
<head><meta charset="utf-8"><title>Tooling-Aware Language Design - Macro Question · software unscripted podcast · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://roc-lang.github.io/zulip-export/stream/429850-software-unscripted-podcast/index.html">software unscripted podcast</a></h2>
<h3>Topic: <a href="https://roc-lang.github.io/zulip-export/stream/429850-software-unscripted-podcast/topic/Tooling-Aware.20Language.20Design.20-.20Macro.20Question.html">Tooling-Aware Language Design - Macro Question</a></h3>

<hr>

<base href="https://roc.zulipchat.com">

<head><link href="https://roc-lang.github.io/zulip-export/style.css" rel="stylesheet"></head>

<a name="464699810"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/429850-software%20unscripted%20podcast/topic/Tooling-Aware%20Language%20Design%20-%20Macro%20Question/near/464699810" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Der Schutz <a href="https://roc-lang.github.io/zulip-export/stream/429850-software-unscripted-podcast/topic/Tooling-Aware.20Language.20Design.20-.20Macro.20Question.html#464699810">(Aug 23 2024 at 17:20)</a>:</h4>
<p>On the latest podcast, I heard Richard say that macros can hurt editor functionality. The example given was for Rust string interpolation not having type information or renaming things in interpolations. Is this just a result of the Rust implementation? Lean 4 supports arbitrary expressions inside interpolated strings,  each part of the expression has its type displayed in the editor, and also supports renames. Lean has an extremely extensive macro system though and I'm not familiar with how Rust macros work under the hood.</p>



<a name="464702956"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/429850-software%20unscripted%20podcast/topic/Tooling-Aware%20Language%20Design%20-%20Macro%20Question/near/464702956" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/429850-software-unscripted-podcast/topic/Tooling-Aware.20Language.20Design.20-.20Macro.20Question.html#464702956">(Aug 23 2024 at 17:30)</a>:</h4>
<p><span class="user-mention silent" data-user-id="733628">Der Schutz</span> <a href="#narrow/stream/429850-Software-Unscripted-Podcast/topic/Tooling-Aware.20Language.20Design.20-.20Macro.20Question/near/464699810">said</a>:</p>
<blockquote>
<p>Lean 4 supports arbitrary expressions inside interpolated strings,  each part of the expression has its type displayed in the editor, and also supports renames. Lean has an extremely extensive macro system though and I'm not familiar with how Rust macros work under the hood.</p>
</blockquote>
<p>it looks like string interpolation is a first-class language feature in Lean 4: <a href="https://lean-lang.org/lean4/doc/stringinterp.html">https://lean-lang.org/lean4/doc/stringinterp.html</a></p>



<a name="464703159"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/429850-software%20unscripted%20podcast/topic/Tooling-Aware%20Language%20Design%20-%20Macro%20Question/near/464703159" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/429850-software-unscripted-podcast/topic/Tooling-Aware.20Language.20Design.20-.20Macro.20Question.html#464703159">(Aug 23 2024 at 17:31)</a>:</h4>
<p>I don't know Lean 4, but based on the outline in that section, it looks like it's a separate "syntax extension" from macros, which have their own entry:</p>
<p><a href="/user_uploads/22008/8ydMC6FfZNCKs2-sw-kQvs5F/Screenshot-2024-08-23-at-1.31.23PM.png">Screenshot-2024-08-23-at-1.31.23PM.png</a></p>
<div class="message_inline_image"><a href="/user_uploads/22008/8ydMC6FfZNCKs2-sw-kQvs5F/Screenshot-2024-08-23-at-1.31.23PM.png" title="Screenshot-2024-08-23-at-1.31.23PM.png"><img data-original-dimensions="420x288" src="/user_uploads/thumbnail/22008/8ydMC6FfZNCKs2-sw-kQvs5F/Screenshot-2024-08-23-at-1.31.23PM.png/840x560.webp"></a></div>



<a name="464721235"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/429850-software%20unscripted%20podcast/topic/Tooling-Aware%20Language%20Design%20-%20Macro%20Question/near/464721235" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Der Schutz <a href="https://roc-lang.github.io/zulip-export/stream/429850-software-unscripted-podcast/topic/Tooling-Aware.20Language.20Design.20-.20Macro.20Question.html#464721235">(Aug 23 2024 at 18:56)</a>:</h4>
<p><span class="user-mention silent" data-user-id="281383">Richard Feldman</span> <a href="#narrow/stream/429850-Software-Unscripted-Podcast/topic/Tooling-Aware.20Language.20Design.20-.20Macro.20Question/near/464702956">said</a>:</p>
<blockquote>
<p><span class="user-mention silent" data-user-id="733628">Der Schutz</span> <a href="#narrow/stream/429850-Software-Unscripted-Podcast/topic/Tooling-Aware.20Language.20Design.20-.20Macro.20Question/near/464699810">said</a>:</p>
<blockquote>
<p>Lean 4 supports arbitrary expressions inside interpolated strings,  each part of the expression has its type displayed in the editor, and also supports renames. Lean has an extremely extensive macro system though and I'm not familiar with how Rust macros work under the hood.</p>
</blockquote>
<p>it looks like string interpolation is a first-class language feature in Lean 4: <a href="https://lean-lang.org/lean4/doc/stringinterp.html">https://lean-lang.org/lean4/doc/stringinterp.html</a></p>
</blockquote>
<p>The macro is implemented in Lean itself (the implementation is here: <a href="https://github.com/leanprover/lean4/blob/edecf3d4baa30ef9a74d6af78a754d88c30b4386/src/Init/Meta.lean#L1264">https://github.com/leanprover/lean4/blob/edecf3d4baa30ef9a74d6af78a754d88c30b4386/src/Init/Meta.lean#L1264</a> ) and <a href="https://github.com/leanprover/lean4/blob/edecf3d4baa30ef9a74d6af78a754d88c30b4386/src/Init/Data/ToString/Macro.lean#L12">https://github.com/leanprover/lean4/blob/edecf3d4baa30ef9a74d6af78a754d88c30b4386/src/Init/Data/ToString/Macro.lean#L12</a> . So there isn't anything special other than that it's already implemented for you. Also Lean has a configuration file DSL where its still a .lean file but the syntax is custom and you get renaming/hover type info/autocompletion. I'm not too sure how that DSL works implementation wise though. But all of this stuff can be implemented in user-land.</p>
<p>Here is an example of the config file DSL, without opening Lake DSL, this would error out because the syntax isn't "valid" Lean syntax. But you still get autocomplete, type info, and other stuff even though the syntax is "made-up". This is up to the macro author to implement however: <a href="https://github.com/leanprover/lean4/blob/390a9a63a24ca28306a60faa0381d4292d23af95/src/lake/examples/targets/lakefile.lean#L1">https://github.com/leanprover/lean4/blob/390a9a63a24ca28306a60faa0381d4292d23af95/src/lake/examples/targets/lakefile.lean#L1</a></p>



<a name="464724084"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/429850-software%20unscripted%20podcast/topic/Tooling-Aware%20Language%20Design%20-%20Macro%20Question/near/464724084" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Der Schutz <a href="https://roc-lang.github.io/zulip-export/stream/429850-software-unscripted-podcast/topic/Tooling-Aware.20Language.20Design.20-.20Macro.20Question.html#464724084">(Aug 23 2024 at 19:12)</a>:</h4>
<p>If the language provides the right API's to authors, then you can have a good editor experience. That being said though, macros are super powerful. I don't think they should be shoved into the language just because, even if having a good editor experience is not one of the main reasons.</p>



<a name="464734899"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/429850-software%20unscripted%20podcast/topic/Tooling-Aware%20Language%20Design%20-%20Macro%20Question/near/464734899" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/429850-software-unscripted-podcast/topic/Tooling-Aware.20Language.20Design.20-.20Macro.20Question.html#464734899">(Aug 23 2024 at 20:05)</a>:</h4>
<p>cool, TIL! do you know if the editor tooling works just as well with macros defined in userspace?</p>



<a name="464735091"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/429850-software%20unscripted%20podcast/topic/Tooling-Aware%20Language%20Design%20-%20Macro%20Question/near/464735091" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/429850-software-unscripted-podcast/topic/Tooling-Aware.20Language.20Design.20-.20Macro.20Question.html#464735091">(Aug 23 2024 at 20:06)</a>:</h4>
<p>(in other words, is the tooling specific to interpolation because it knows how it's implemented, or just as effective with any arbitrary macro)</p>



<a name="464761885"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/429850-software%20unscripted%20podcast/topic/Tooling-Aware%20Language%20Design%20-%20Macro%20Question/near/464761885" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Der Schutz <a href="https://roc-lang.github.io/zulip-export/stream/429850-software-unscripted-podcast/topic/Tooling-Aware.20Language.20Design.20-.20Macro.20Question.html#464761885">(Aug 23 2024 at 23:42)</a>:</h4>
<p><span class="user-mention silent" data-user-id="281383">Richard Feldman</span> <a href="#narrow/stream/429850-Software-Unscripted-Podcast/topic/Tooling-Aware.20Language.20Design.20-.20Macro.20Question/near/464734899">said</a>:</p>
<blockquote>
<p>cool, TIL! do you know if the editor tooling works just as well with macros defined in userspace?</p>
</blockquote>
<p>I'm definitely not the person to ask because I mainly use the macros rather than make them myself. But for interpolation, a user could implement the exact same thing with the same level of tooling. However the macro author has to write the tooling for the macro itself to some extent. Some of it is automatically handled based off the implementation, and I believe it displays the doc comment for the specific <code>Syntax</code> node on hover for a given <code>Parser</code>. You can also add pretty printing so that it doesn't just print the elaborated form only. toString is carrying here, but this works fine:</p>
<div class="codehilite" data-code-language="Lean4"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="n">Lean</span>

<span class="kn">open</span><span class="w"> </span><span class="n">Lean</span><span class="w"> </span><span class="n">Elab</span><span class="w"> </span><span class="n">Term</span><span class="w"> </span><span class="n">Meta</span>

<span class="sd">/--</span>
<span class="sd">A simple string interpolation macro.</span>
<span class="sd">Usage: `str_interp!{expression}`</span>
<span class="sd">The expression is evaluated and converted to a string.</span>
<span class="sd">-/</span>
<span class="kn">syntax</span><span class="w"> </span><span class="o">(</span><span class="n">name</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="n">strInterp</span><span class="o">)</span><span class="w"> </span><span class="s2">"str_interp!{"</span><span class="w"> </span><span class="n">term</span><span class="w"> </span><span class="s2">"}"</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">term</span>

<span class="kd">@[</span><span class="n">macro</span><span class="w"> </span><span class="n">strInterp</span><span class="kd">]</span>
<span class="kn">def</span><span class="w"> </span><span class="n">expandStrInterp</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">Macro</span>
<span class="w">  </span><span class="bp">|</span><span class="w"> </span><span class="bp">`</span><span class="o">(</span><span class="n">str_interp!</span><span class="o">{</span><span class="bp">$</span><span class="n">e</span><span class="o">})</span><span class="w"> </span><span class="bp">=&gt;</span><span class="w"> </span><span class="k">do</span>
<span class="w">    </span><span class="bp">`</span><span class="o">(</span><span class="n">toString</span><span class="w"> </span><span class="bp">$</span><span class="n">e</span><span class="o">)</span>
<span class="w">  </span><span class="bp">|</span><span class="w"> </span><span class="bp">_</span><span class="w"> </span><span class="bp">=&gt;</span><span class="w"> </span><span class="n">Macro</span><span class="bp">.</span><span class="n">throwUnsupported</span>

<span class="kn">def</span><span class="w"> </span><span class="n">example1</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="n">str_interp!</span><span class="o">{</span><span class="mi">3</span><span class="w"> </span><span class="bp">+</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="bp">+</span><span class="w"> </span><span class="n">factorial</span><span class="w"> </span><span class="mi">2</span><span class="o">}</span>
</code></pre></div>
<p>Hovering over <code>str_interp</code>displays the type <code>String</code> and the doc comment above the strInterp syntax. Can hover over any sub-expressions (including if they're nested) and see its type. I can rename factorial and it will rename it within the string interpolation. I just made a vec! macro (turns <code>vec![]</code> into an List type) also to see if it preserves sub-expression types automatically on hover and it does. This is my first time implementing a macro in their system though as trying to read some of the macro/parser implementations is like voodoo for me.</p>



<a name="464764651"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/429850-software%20unscripted%20podcast/topic/Tooling-Aware%20Language%20Design%20-%20Macro%20Question/near/464764651" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Der Schutz <a href="https://roc-lang.github.io/zulip-export/stream/429850-software-unscripted-podcast/topic/Tooling-Aware.20Language.20Design.20-.20Macro.20Question.html#464764651">(Aug 24 2024 at 00:09)</a>:</h4>
<p>I was trying to see if I have a custom expression type if it would let me rename automatically and it won't, which makes sense. Maybe there is some LSP API you could hook into to tell it how to work with that, but no clue.</p>



<a name="476856224"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/429850-software%20unscripted%20podcast/topic/Tooling-Aware%20Language%20Design%20-%20Macro%20Question/near/476856224" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Greg <a href="https://roc-lang.github.io/zulip-export/stream/429850-software-unscripted-podcast/topic/Tooling-Aware.20Language.20Design.20-.20Macro.20Question.html#476856224">(Oct 14 2024 at 21:53)</a>:</h4>
<p>Hi there Richard,<br>
Just wanted to say I'm really enjoying this podcast! It's a great idea to garner interest for roc and I'm looking forward to giving this language a go. <br>
Thank you and all the best!</p>



<a name="476860769"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/429850-software%20unscripted%20podcast/topic/Tooling-Aware%20Language%20Design%20-%20Macro%20Question/near/476860769" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/429850-software-unscripted-podcast/topic/Tooling-Aware.20Language.20Design.20-.20Macro.20Question.html#476860769">(Oct 14 2024 at 22:46)</a>:</h4>
<p>thanks so much, and glad you're enjoying it! <span aria-label="smiley" class="emoji emoji-1f603" role="img" title="smiley">:smiley:</span></p>



<hr><p>Last updated: Nov 01 2025 at 12:13 UTC</p>
</html>