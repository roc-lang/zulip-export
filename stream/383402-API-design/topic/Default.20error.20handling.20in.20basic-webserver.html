<html>
<head><meta charset="utf-8"><title>Default error handling in basic-webserver · API design · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/index.html">API design</a></h2>
<h3>Topic: <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/Default.20error.20handling.20in.20basic-webserver.html">Default error handling in basic-webserver</a></h3>

<hr>

<base href="https://roc.zulipchat.com">

<head><link href="https://roc-lang.github.io/zulip-export/style.css" rel="stylesheet"></head>

<a name="436375969"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/Default%20error%20handling%20in%20basic-webserver/near/436375969" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/Default.20error.20handling.20in.20basic-webserver.html#436375969">(May 01 2024 at 00:41)</a>:</h4>
<p>I like where our design ended up for <code>basic-cli</code> error handling (<code>Task {} [Exit I32 Str]</code>) and I was thinking we could do something similar for <code>basic-webserver</code> - accept a <code>main</code> with any error type you like, and by default return HTTP status 500 (Internal Server Error) if any error occurs</p>



<a name="436376042"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/Default%20error%20handling%20in%20basic-webserver/near/436376042" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/Default.20error.20handling.20in.20basic-webserver.html#436376042">(May 01 2024 at 00:42)</a>:</h4>
<p>so that way, just like in <code>basic-cli</code>, you can get up and running with no error handling and just add a <code>main : Request -&gt; Task Response []</code> annotation to enable full mandatory handling of all errors whenever you're ready</p>



<a name="436376068"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/Default%20error%20handling%20in%20basic-webserver/near/436376068" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/Default.20error.20handling.20in.20basic-webserver.html#436376068">(May 01 2024 at 00:43)</a>:</h4>
<p>thoughts?</p>



<a name="436376475"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/Default%20error%20handling%20in%20basic-webserver/near/436376475" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Agus Zubiaga <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/Default.20error.20handling.20in.20basic-webserver.html#436376475">(May 01 2024 at 00:49)</a>:</h4>
<p>Hm, I don’t think it works as well for servers. In a CLI application that you’re running in a given machine, you can’t expose anything that the user doesn’t already have access to.<br>
However, in a server/client context, you need to carefully control what you expose.</p>



<a name="436377089"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/Default%20error%20handling%20in%20basic-webserver/near/436377089" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Agus Zubiaga <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/Default.20error.20handling.20in.20basic-webserver.html#436377089">(May 01 2024 at 00:59)</a>:</h4>
<p>It could work if you didn’t return the error to the client or if you only did so in dev mode. That said, I think this is a platform where it’s more important to encourage good error handling.</p>



<a name="436378629"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/Default%20error%20handling%20in%20basic-webserver/near/436378629" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/Default.20error.20handling.20in.20basic-webserver.html#436378629">(May 01 2024 at 01:23)</a>:</h4>
<p>I appreciate that point, but it's super easy to harden it for release - literally adding one type annotation <span aria-label="big smile" class="emoji emoji-1f604" role="img" title="big smile">:big_smile:</span></p>



<a name="436379512"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/Default%20error%20handling%20in%20basic-webserver/near/436379512" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/Default.20error.20handling.20in.20basic-webserver.html#436379512">(May 01 2024 at 01:39)</a>:</h4>
<p>I wonder if we can have a different handler implementation and swap it out for <code>cargo build</code> verse <code>cargo build --release</code></p>



<a name="436380124"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/Default%20error%20handling%20in%20basic-webserver/near/436380124" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/Default.20error.20handling.20in.20basic-webserver.html#436380124">(May 01 2024 at 01:49)</a>:</h4>
<p>I've been thinking about/planning to do some cleanup and improvements for basic-webserver soon. I'm just wanting to finish cleaning up the basic-cli build process I've started on. So if we come up with a nice API, happy to make those changes too</p>



<a name="436380234"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/Default%20error%20handling%20in%20basic-webserver/near/436380234" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/Default.20error.20handling.20in.20basic-webserver.html#436380234">(May 01 2024 at 01:50)</a>:</h4>
<p>I'd rather not make things work differently for dev vs release if we can avoid it</p>



<a name="436380341"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/Default%20error%20handling%20in%20basic-webserver/near/436380341" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/Default.20error.20handling.20in.20basic-webserver.html#436380341">(May 01 2024 at 01:53)</a>:</h4>
<p>What about some kind of logging. Like the  <code>Task {} [Exit I32 Str]</code> could append to a logfile or something</p>



<a name="436380419"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/Default%20error%20handling%20in%20basic-webserver/near/436380419" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Agus Zubiaga <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/Default.20error.20handling.20in.20basic-webserver.html#436380419">(May 01 2024 at 01:54)</a>:</h4>
<p><span class="user-mention silent" data-user-id="281383">Richard Feldman</span> <a href="#narrow/stream/383402-API-Design/topic/Default.20error.20handling.20in.20basic-webserver/near/436378629">said</a>:</p>
<blockquote>
<p>I appreciate that point, but it's super easy to harden it for release - literally adding one type annotation <span aria-label="big smile" class="emoji emoji-1f604" role="img" title="big smile">:big_smile:</span></p>
</blockquote>
<p>I guess my point is that there are good CLI apps were this default crash behavior would be what you want forever. Whereas in a server, you really don’t want this beyond the initial experimentation stage.</p>



<a name="436380420"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/Default%20error%20handling%20in%20basic-webserver/near/436380420" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/Default.20error.20handling.20in.20basic-webserver.html#436380420">(May 01 2024 at 01:54)</a>:</h4>
<p>oh that's interesting - like it returns error 500 but doesn't say what the problem was, but then just logs the <code>Inspect.toStr</code> to stderr?</p>



<a name="436380436"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/Default%20error%20handling%20in%20basic-webserver/near/436380436" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/Default.20error.20handling.20in.20basic-webserver.html#436380436">(May 01 2024 at 01:55)</a>:</h4>
<p>that sounds interesting - would basically only affect initial experimentation then, yeah?</p>



<a name="436380470"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/Default%20error%20handling%20in%20basic-webserver/near/436380470" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/Default.20error.20handling.20in.20basic-webserver.html#436380470">(May 01 2024 at 01:55)</a>:</h4>
<p>yeah <span class="user-mention" data-user-id="489294">@Agus Zubiaga</span> I agree, but I'm mainly thinking about a way to improve the experience of the initial experimentation stage in a way where it's really easy to transition to production once you're ready</p>



<a name="436380486"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/Default%20error%20handling%20in%20basic-webserver/near/436380486" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/Default.20error.20handling.20in.20basic-webserver.html#436380486">(May 01 2024 at 01:55)</a>:</h4>
<p>What I like about that is while I'm developing with localhost I can see any errors in the terminal.</p>



<a name="436380543"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/Default%20error%20handling%20in%20basic-webserver/near/436380543" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/Default.20error.20handling.20in.20basic-webserver.html#436380543">(May 01 2024 at 01:56)</a>:</h4>
<p>It's been a surprisingly nice workflow with the latest basic-cli API that I did not expect</p>



<a name="436380552"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/Default%20error%20handling%20in%20basic-webserver/near/436380552" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/Default.20error.20handling.20in.20basic-webserver.html#436380552">(May 01 2024 at 01:56)</a>:</h4>
<p>we could actually make that a default thing that basic-webserver does automatically</p>



<a name="436380574"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/Default%20error%20handling%20in%20basic-webserver/near/436380574" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/Default.20error.20handling.20in.20basic-webserver.html#436380574">(May 01 2024 at 01:57)</a>:</h4>
<p>Like I've started tagging errors everywhere and it makes it so easy to see where things are broken, and experiment/iterate super quickly</p>



<a name="436380578"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/Default%20error%20handling%20in%20basic-webserver/near/436380578" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Agus Zubiaga <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/Default.20error.20handling.20in.20basic-webserver.html#436380578">(May 01 2024 at 01:57)</a>:</h4>
<p>Yeah, that seems like a good compromise</p>



<a name="436380679"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/Default%20error%20handling%20in%20basic-webserver/near/436380679" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/Default.20error.20handling.20in.20basic-webserver.html#436380679">(May 01 2024 at 01:59)</a>:</h4>
<p>so basically whenever <code>basic-webserver</code> receives a <code>Response</code> where the status code is in the 500 range, it just automatically logs to stderr whatever the response was?</p>



<a name="436380691"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/Default%20error%20handling%20in%20basic-webserver/near/436380691" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/Default.20error.20handling.20in.20basic-webserver.html#436380691">(May 01 2024 at 01:59)</a>:</h4>
<p>and then it does the same if it gets back a <code>Task.err</code></p>



<a name="436380706"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/Default%20error%20handling%20in%20basic-webserver/near/436380706" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Agus Zubiaga <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/Default.20error.20handling.20in.20basic-webserver.html#436380706">(May 01 2024 at 01:59)</a>:</h4>
<p>Oh, I was thinking it would only do this for <code>Task.err</code></p>



<a name="436380893"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/Default%20error%20handling%20in%20basic-webserver/near/436380893" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/Default.20error.20handling.20in.20basic-webserver.html#436380893">(May 01 2024 at 02:01)</a>:</h4>
<p>I was too at first! But this comment:</p>
<p><span class="user-mention silent" data-user-id="515757">Luke Boswell</span> <a href="#narrow/stream/383402-API-Design/topic/Default.20error.20handling.20in.20basic-webserver/near/436380574">said</a>:</p>
<blockquote>
<p>Like I've started tagging errors everywhere and it makes it so easy to see where things are broken, and experiment/iterate super quickly</p>
</blockquote>
<p>...wouldn't you still want that even after you start handling them gracefully? <span aria-label="thinking" class="emoji emoji-1f914" role="img" title="thinking">:thinking:</span></p>



<a name="436381014"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/Default%20error%20handling%20in%20basic-webserver/near/436381014" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Agus Zubiaga <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/Default.20error.20handling.20in.20basic-webserver.html#436381014">(May 01 2024 at 02:03)</a>:</h4>
<p>I don’t know if that would work. Handling them gracefully might mean you won’t return a 5xx.</p>



<a name="436381072"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/Default%20error%20handling%20in%20basic-webserver/near/436381072" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/Default.20error.20handling.20in.20basic-webserver.html#436381072">(May 01 2024 at 02:03)</a>:</h4>
<p>I'm not sure, but I think its nice to have a catchall for unhandled cases. Is it ever valid to send a 500 deliberately??</p>



<a name="436381126"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/Default%20error%20handling%20in%20basic-webserver/near/436381126" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/Default.20error.20handling.20in.20basic-webserver.html#436381126">(May 01 2024 at 02:04)</a>:</h4>
<p>Like maybe a downstream service failed or something??</p>



<a name="436381132"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/Default%20error%20handling%20in%20basic-webserver/near/436381132" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Agus Zubiaga <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/Default.20error.20handling.20in.20basic-webserver.html#436381132">(May 01 2024 at 02:04)</a>:</h4>
<p>Yeah, it can be when you know what went wrong but don’t want to expose it.</p>



<a name="436381139"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/Default%20error%20handling%20in%20basic-webserver/near/436381139" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/Default.20error.20handling.20in.20basic-webserver.html#436381139">(May 01 2024 at 02:04)</a>:</h4>
<p>right</p>



<a name="436381145"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/Default%20error%20handling%20in%20basic-webserver/near/436381145" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/Default.20error.20handling.20in.20basic-webserver.html#436381145">(May 01 2024 at 02:04)</a>:</h4>
<p>for example, a "this should never happen" situation <span aria-label="big smile" class="emoji emoji-1f604" role="img" title="big smile">:big_smile:</span></p>



<a name="436381176"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/Default%20error%20handling%20in%20basic-webserver/near/436381176" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/Default.20error.20handling.20in.20basic-webserver.html#436381176">(May 01 2024 at 02:05)</a>:</h4>
<p>or yeah, you called out to another service and it gave an error, so you can't proceed</p>



<a name="436381208"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/Default%20error%20handling%20in%20basic-webserver/near/436381208" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Agus Zubiaga <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/Default.20error.20handling.20in.20basic-webserver.html#436381208">(May 01 2024 at 02:06)</a>:</h4>
<p>You could have a platform feature to log requests and responses and some logic to filter them</p>



<a name="436381259"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/Default%20error%20handling%20in%20basic-webserver/near/436381259" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/Default.20error.20handling.20in.20basic-webserver.html#436381259">(May 01 2024 at 02:06)</a>:</h4>
<p>true!</p>



<a name="436381272"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/Default%20error%20handling%20in%20basic-webserver/near/436381272" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/Default.20error.20handling.20in.20basic-webserver.html#436381272">(May 01 2024 at 02:06)</a>:</h4>
<p>I mentioned 500s specifically because if gracefully handling it results in a non-500 error, I wouldn't want to see that</p>



<a name="436381285"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/Default%20error%20handling%20in%20basic-webserver/near/436381285" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/Default.20error.20handling.20in.20basic-webserver.html#436381285">(May 01 2024 at 02:06)</a>:</h4>
<p>e.g. if it's a 403 Forbidden then I don't think I need more info logged haha</p>



<a name="436381299"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/Default%20error%20handling%20in%20basic-webserver/near/436381299" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Agus Zubiaga <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/Default.20error.20handling.20in.20basic-webserver.html#436381299">(May 01 2024 at 02:06)</a>:</h4>
<p>Right. I guess it might be a convenient default</p>



<a name="436381419"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/Default%20error%20handling%20in%20basic-webserver/near/436381419" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/Default.20error.20handling.20in.20basic-webserver.html#436381419">(May 01 2024 at 02:08)</a>:</h4>
<p>personally whenever I'm working on a server and I see a 500 my next step is to look into "ok what happened?" and so default logging sounds nice to me! <span aria-label="big smile" class="emoji emoji-1f604" role="img" title="big smile">:big_smile:</span></p>



<a name="436381799"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/Default%20error%20handling%20in%20basic-webserver/near/436381799" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Agus Zubiaga <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/Default.20error.20handling.20in.20basic-webserver.html#436381799">(May 01 2024 at 02:14)</a>:</h4>
<p>Now the problem with the platform logging to stderr is that people are gonna want to log to other places such as Sentry</p>



<a name="436381971"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/Default%20error%20handling%20in%20basic-webserver/near/436381971" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/Default.20error.20handling.20in.20basic-webserver.html#436381971">(May 01 2024 at 02:17)</a>:</h4>
<p>I think that's something we should look into anyway, e.g. for things like this:</p>
<p><span class="user-mention silent" data-user-id="489294">Agus Zubiaga</span> <a href="#narrow/stream/383402-API-Design/topic/Default.20error.20handling.20in.20basic-webserver/near/436381208">said</a>:</p>
<blockquote>
<p>You could have a platform feature to log requests and responses and some logic to filter them</p>
</blockquote>
<p>I'm not sure exactly how we should expose that</p>



<a name="436382167"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/Default%20error%20handling%20in%20basic-webserver/near/436382167" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Agus Zubiaga <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/Default.20error.20handling.20in.20basic-webserver.html#436382167">(May 01 2024 at 02:19)</a>:</h4>
<p>Something like this could work:</p>
<div class="codehilite"><pre><span></span><code>app [main] { pf: &quot;https://../basic-webserver&quot; }

import pf.Logging

main = \req -&gt;
    Logging.onWrite! \level, message -&gt;
        # send to Sentry

    # handle request
</code></pre></div>



<a name="436382169"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/Default%20error%20handling%20in%20basic-webserver/near/436382169" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/Default.20error.20handling.20in.20basic-webserver.html#436382169">(May 01 2024 at 02:19)</a>:</h4>
<p>one idea is that since you can already do that in userspace (e.g. instead of writing all your logic to return <code>Response</code>, instead return something like <code>MyCustomLoggableThing</code> and then translate that to "first log whatever we want and then return the <code>Response</code> that <code>main</code> wants") just offer a way to log <code>crash</code>es, e.g. <code>Str -&gt; Task Response []</code></p>



<a name="436382250"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/Default%20error%20handling%20in%20basic-webserver/near/436382250" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/Default.20error.20handling.20in.20basic-webserver.html#436382250">(May 01 2024 at 02:20)</a>:</h4>
<p>another possibility is to allow logging hooks for all I/O too, e.g. <code>onCrash</code>, <code>onFileRead</code>, <code>onFileWrite</code>, <code>onHttpRequest</code>, etc.</p>



<a name="436382259"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/Default%20error%20handling%20in%20basic-webserver/near/436382259" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/Default.20error.20handling.20in.20basic-webserver.html#436382259">(May 01 2024 at 02:20)</a>:</h4>
<p>since the platform is in charge of all that</p>



<a name="436382274"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/Default%20error%20handling%20in%20basic-webserver/near/436382274" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/Default.20error.20handling.20in.20basic-webserver.html#436382274">(May 01 2024 at 02:20)</a>:</h4>
<p>so yeah I think there's some separate design work to be done there</p>



<a name="436382285"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/Default%20error%20handling%20in%20basic-webserver/near/436382285" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/Default.20error.20handling.20in.20basic-webserver.html#436382285">(May 01 2024 at 02:21)</a>:</h4>
<p>Also instead of </p>
<div class="codehilite"><pre><span></span><code>#[no_mangle]
pub unsafe extern &quot;C&quot; fn roc_panic(msg: &amp;RocStr, _tag_id: u32) {
    panic!(&quot;The Roc app crashed with: {}&quot;, msg.as_str());
}
</code></pre></div>
<p>We might want to turn that into a 500 also and log that too.</p>



<a name="436382294"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/Default%20error%20handling%20in%20basic-webserver/near/436382294" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/Default.20error.20handling.20in.20basic-webserver.html#436382294">(May 01 2024 at 02:21)</a>:</h4>
<p>oh yeah for sure!</p>



<a name="436382318"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/Default%20error%20handling%20in%20basic-webserver/near/436382318" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/Default.20error.20handling.20in.20basic-webserver.html#436382318">(May 01 2024 at 02:21)</a>:</h4>
<p>also while we're at it, I'd like to change the entrypoint name from <code>main</code> to something more like <code>handleRequest</code></p>



<a name="436382330"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/Default%20error%20handling%20in%20basic-webserver/near/436382330" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/Default.20error.20handling.20in.20basic-webserver.html#436382330">(May 01 2024 at 02:22)</a>:</h4>
<p><code>respond</code> maybe?</p>



<a name="436382446"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/Default%20error%20handling%20in%20basic-webserver/near/436382446" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Agus Zubiaga <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/Default.20error.20handling.20in.20basic-webserver.html#436382446">(May 01 2024 at 02:23)</a>:</h4>
<p>I like <code>respond</code>. You might not actually explicitly respond, but the platform will always respond for you <span aria-label="smile" class="emoji emoji-1f642" role="img" title="smile">:smile:</span></p>



<a name="436382570"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/Default%20error%20handling%20in%20basic-webserver/near/436382570" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/Default.20error.20handling.20in.20basic-webserver.html#436382570">(May 01 2024 at 02:25)</a>:</h4>
<p><a href="https://github.com/roc-lang/basic-webserver/issues/49">https://github.com/roc-lang/basic-webserver/issues/49</a> &lt;-- made an issue just to track this thread. I don't want to lose these ideas</p>



<a name="436382581"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/Default%20error%20handling%20in%20basic-webserver/near/436382581" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Agus Zubiaga <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/Default.20error.20handling.20in.20basic-webserver.html#436382581">(May 01 2024 at 02:25)</a>:</h4>
<p>What if in addition to <code>respond</code>, the app provided a <code>config</code> value:</p>
<div class="codehilite"><pre><span></span><code>app [respond, config] { pf: &quot;https://../basic-webserver&quot; }

respond = \req -&gt;
    # handle request

config =
    import pf.Config

    Config.default
    |&gt; Config.port 8080
    |&gt; Config.onLog \req, level, message -&gt;
        # Log to Sentry
    |&gt; Task.ok

  ```
</code></pre></div>



<a name="436382675"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/Default%20error%20handling%20in%20basic-webserver/near/436382675" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Agus Zubiaga <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/Default.20error.20handling.20in.20basic-webserver.html#436382675">(May 01 2024 at 02:26)</a>:</h4>
<p>I guess it makes the hello world a little more wordy, but I think we are going to need something like that eventually</p>



<a name="436382680"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/Default%20error%20handling%20in%20basic-webserver/near/436382680" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/Default.20error.20handling.20in.20basic-webserver.html#436382680">(May 01 2024 at 02:26)</a>:</h4>
<p>I'm wondering if we will need <a href="https://github.com/roc-lang/roc/issues/6382">passed in allocators and context</a> though before I could make roc_panic log errors back on the HTTP response? <span aria-label="thinking" class="emoji emoji-1f914" role="img" title="thinking">:thinking:</span></p>



<a name="436382753"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/Default%20error%20handling%20in%20basic-webserver/near/436382753" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/Default.20error.20handling.20in.20basic-webserver.html#436382753">(May 01 2024 at 02:27)</a>:</h4>
<p><span class="user-mention" data-user-id="489294">@Agus Zubiaga</span> what if we supported another roc app as a plugin that could be used to configure the server on startup?</p>



<a name="436382843"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/Default%20error%20handling%20in%20basic-webserver/near/436382843" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/Default.20error.20handling.20in.20basic-webserver.html#436382843">(May 01 2024 at 02:28)</a>:</h4>
<p>So just <code>roc server.roc</code> would use default config. Or <code>roc server.roc config.roc</code> runs the configuration plugin.</p>



<a name="436382863"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/Default%20error%20handling%20in%20basic-webserver/near/436382863" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Agus Zubiaga <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/Default.20error.20handling.20in.20basic-webserver.html#436382863">(May 01 2024 at 02:29)</a>:</h4>
<p>Interesting. That would require a new language feature, right?</p>



<a name="436382877"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/Default%20error%20handling%20in%20basic-webserver/near/436382877" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Agus Zubiaga <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/Default.20error.20handling.20in.20basic-webserver.html#436382877">(May 01 2024 at 02:29)</a>:</h4>
<p>Cause' otherwise the platform would have to compile the config app on the fly</p>



<a name="436382961"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/Default%20error%20handling%20in%20basic-webserver/near/436382961" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/Default.20error.20handling.20in.20basic-webserver.html#436382961">(May 01 2024 at 02:30)</a>:</h4>
<p>I don't think any new features are required. -- assuming the config is just a value or data that implements Encoding and Decoding</p>



<a name="436382997"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/Default%20error%20handling%20in%20basic-webserver/near/436382997" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/Default.20error.20handling.20in.20basic-webserver.html#436382997">(May 01 2024 at 02:31)</a>:</h4>
<p>We could have the plugin do some setup, maybe it has extra effects or superpowers even, and then it could produce an immutable/ready only config object that is given to each request.</p>



<a name="436383047"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/Default%20error%20handling%20in%20basic-webserver/near/436383047" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Agus Zubiaga <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/Default.20error.20handling.20in.20basic-webserver.html#436383047">(May 01 2024 at 02:32)</a>:</h4>
<p>I don't think roc can run two apps like that</p>



<a name="436383122"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/Default%20error%20handling%20in%20basic-webserver/near/436383122" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/Default.20error.20handling.20in.20basic-webserver.html#436383122">(May 01 2024 at 02:32)</a>:</h4>
<p>I am almost certain I can have the webserver run one app on startup and then another for handling requests</p>



<a name="436383141"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/Default%20error%20handling%20in%20basic-webserver/near/436383141" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/Default.20error.20handling.20in.20basic-webserver.html#436383141">(May 01 2024 at 02:33)</a>:</h4>
<p>Or is the issue the <code>roc build</code> part?</p>



<a name="436383154"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/Default%20error%20handling%20in%20basic-webserver/near/436383154" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/Default.20error.20handling.20in.20basic-webserver.html#436383154">(May 01 2024 at 02:33)</a>:</h4>
<p>I'll need to experiment</p>



<a name="436383231"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/Default%20error%20handling%20in%20basic-webserver/near/436383231" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Agus Zubiaga <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/Default.20error.20handling.20in.20basic-webserver.html#436383231">(May 01 2024 at 02:34)</a>:</h4>
<p>Well, if you build <code>config.roc</code> first, then I guess <code>server.roc</code> can execute it as a command</p>



<a name="436383323"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/Default%20error%20handling%20in%20basic-webserver/near/436383323" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/Default.20error.20handling.20in.20basic-webserver.html#436383323">(May 01 2024 at 02:35)</a>:</h4>
<p>I was thinking the host could look at its args and if it finds a <code>config.roc</code> it <code>roc build --lib</code> that and then dynamically loads it.</p>



<a name="436383339"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/Default%20error%20handling%20in%20basic-webserver/near/436383339" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Agus Zubiaga <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/Default.20error.20handling.20in.20basic-webserver.html#436383339">(May 01 2024 at 02:35)</a>:</h4>
<p>ah right, that's what I meant with building it on the fly</p>



<a name="436383412"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/Default%20error%20handling%20in%20basic-webserver/near/436383412" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Agus Zubiaga <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/Default.20error.20handling.20in.20basic-webserver.html#436383412">(May 01 2024 at 02:36)</a>:</h4>
<p>So the platform ships with the compiler as a lib or it has to be available in the system</p>



<a name="436383430"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/Default%20error%20handling%20in%20basic-webserver/near/436383430" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/Default.20error.20handling.20in.20basic-webserver.html#436383430">(May 01 2024 at 02:36)</a>:</h4>
<p>Roc cli has to be available in the system</p>



<a name="436383441"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/Default%20error%20handling%20in%20basic-webserver/near/436383441" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/Default.20error.20handling.20in.20basic-webserver.html#436383441">(May 01 2024 at 02:37)</a>:</h4>
<p>And the plugin would use a URL release I assume</p>



<a name="436383477"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/Default%20error%20handling%20in%20basic-webserver/near/436383477" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Agus Zubiaga <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/Default.20error.20handling.20in.20basic-webserver.html#436383477">(May 01 2024 at 02:37)</a>:</h4>
<p>Thats interesting, but it doesn’t seem very convenient for deployment</p>



<a name="436383480"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/Default%20error%20handling%20in%20basic-webserver/near/436383480" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/Default.20error.20handling.20in.20basic-webserver.html#436383480">(May 01 2024 at 02:37)</a>:</h4>
<p>Or maybe I'm just overcomplicating this... we just have a second function <code>config</code> alongside <code>respond</code> like you suggested</p>



<a name="436383544"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/Default%20error%20handling%20in%20basic-webserver/near/436383544" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/Default.20error.20handling.20in.20basic-webserver.html#436383544">(May 01 2024 at 02:38)</a>:</h4>
<p>Yeah I think I'm getting carried away with the art of the possible... just throwing ideas out there</p>



<a name="436383579"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/Default%20error%20handling%20in%20basic-webserver/near/436383579" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Agus Zubiaga <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/Default.20error.20handling.20in.20basic-webserver.html#436383579">(May 01 2024 at 02:39)</a>:</h4>
<p>We could maybe make platform <code>requires</code> work like module params in that they are just a record pattern. That would allow us to have optional fields, so <code>config</code> wouldn’t need to be specified if you want the default.</p>



<a name="436383710"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/Default%20error%20handling%20in%20basic-webserver/near/436383710" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/Default.20error.20handling.20in.20basic-webserver.html#436383710">(May 01 2024 at 02:41)</a>:</h4>
<p>That might be nicer than using a record with two functions for main.</p>



<a name="436383821"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/Default%20error%20handling%20in%20basic-webserver/near/436383821" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/Default.20error.20handling.20in.20basic-webserver.html#436383821">(May 01 2024 at 02:43)</a>:</h4>
<p>I just noticed, from the platform side the requires currently is a record or at least </p>
<div class="codehilite"><pre><span></span><code>platform &quot;&quot;
    requires { Model, respond, configure } { ... }
</code></pre></div>
<p>Wheras the app is a list</p>
<div class="codehilite"><pre><span></span><code>provides [Model, respond, configure] to web
</code></pre></div>



<a name="436383952"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/Default%20error%20handling%20in%20basic-webserver/near/436383952" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Agus Zubiaga <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/Default.20error.20handling.20in.20basic-webserver.html#436383952">(May 01 2024 at 02:45)</a>:</h4>
<p><span class="user-mention silent" data-user-id="515757">Luke Boswell</span> <a href="#narrow/stream/383402-API-Design/topic/Default.20error.20handling.20in.20basic-webserver/near/436383710">said</a>:</p>
<blockquote>
<p>That might be nicer than using a record with two functions for main.</p>
</blockquote>
<p>Honestly, that seems totally fine</p>



<a name="436383953"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/Default%20error%20handling%20in%20basic-webserver/near/436383953" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/Default.20error.20handling.20in.20basic-webserver.html#436383953">(May 01 2024 at 02:45)</a>:</h4>
<p>Just threw a sneaky <code>Model</code> in there... it would be awesome to have some kind of in-memory cache</p>



<a name="436459036"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/Default%20error%20handling%20in%20basic-webserver/near/436459036" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jasper Woudenberg <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/Default.20error.20handling.20in.20basic-webserver.html#436459036">(May 01 2024 at 06:49)</a>:</h4>
<p>I really like how <code>Elm</code> implements it's <code>main</code> function. It needs to be assigned a value of type <code>Program</code>,  and the <code>Browser</code> module exports a couple different functions to create a <code>Program</code>.</p>
<p><a href="https://package.elm-lang.org/packages/elm/browser/latest/Browser">https://package.elm-lang.org/packages/elm/browser/latest/Browser</a></p>
<p>The first function displayed is <code>sandbox</code>, and it takes the bare minimum options to construct a basic program, ideal for getting started with Elm and it's basic architecture. Next is <code>element</code>, which adds the option for the program to listen to outside events. Next is <code>document</code>, which adds the capability to perform side-effects. Finally there's <code>application</code>, which allows the program to also own page navigation.</p>
<p>I really like how this teaches you the Elm 'platform' one concept at a time. I think it'd be great if Roc platforms could do something similar.</p>
<p>I wonder what you think (and maybe this has been discussed before) about implementing it like this:</p>
<div class="codehilite"><pre><span></span><code>app [main] { pf: &quot;https://../basic-webserver&quot; }

main = loggingServer { respond, onLog }

respond = \req -&gt;
    # handle request

onLog = \msg -&gt;
    # log something
</code></pre></div>



<a name="436460672"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/Default%20error%20handling%20in%20basic-webserver/near/436460672" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/Default.20error.20handling.20in.20basic-webserver.html#436460672">(May 01 2024 at 07:08)</a>:</h4>
<p>Interesting idea... could we achieve this using Abilities? maybe the platform requires a type that implements the <code>WebServerAbility</code>, and there are a few default implementations provided.</p>
<p>The first might be <code>SimpleServer { respond }</code>, second might be <code>WithLogging { respond, handleLogs }</code>, etc.</p>
<p>The platform then calls all of the functions it needs to build the record to provide to the host. Some of these may be default implementations.</p>



<a name="436489492"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/Default%20error%20handling%20in%20basic-webserver/near/436489492" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Agus Zubiaga <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/Default.20error.20handling.20in.20basic-webserver.html#436489492">(May 01 2024 at 12:09)</a>:</h4>
<p>I don’t know if you need different kinds of servers. You could have something like this:</p>
<div class="codehilite"><pre><span></span><code>app [server] {...}

import pf.Http exposing [Server, Request, Response]

server : Task Server *
server = Http.serve! { respond }

respond : Request -&gt; Task Response *
respond = \req -&gt;
    ...
</code></pre></div>
<p><code>Http.serve</code> takes a record with optional fields so you can pass other config if you need to:</p>
<div class="codehilite"><pre><span></span><code>server : Task Server *
server = Http.serve! {
    respond,
    port: Env.get! &quot;PORT&quot;,
    onLog: \x -&gt; Cloudwatch.log x …
}
</code></pre></div>
<p>If a record with optional fields isn’t enough, you can also use the builder pattern.</p>



<a name="436513113"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/Default%20error%20handling%20in%20basic-webserver/near/436513113" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/Default.20error.20handling.20in.20basic-webserver.html#436513113">(May 01 2024 at 14:36)</a>:</h4>
<p>yeah I'd like to move to this type of API, but it requires being able to send closures to hosts, which we can't do yet <span aria-label="sweat smile" class="emoji emoji-1f605" role="img" title="sweat smile">:sweat_smile:</span></p>



<a name="436513246"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/Default%20error%20handling%20in%20basic-webserver/near/436513246" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/Default.20error.20handling.20in.20basic-webserver.html#436513246">(May 01 2024 at 14:37)</a>:</h4>
<p>Folkert and I have been working on that for awhile, but it's tricky to get right</p>



<a name="436610712"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/Default%20error%20handling%20in%20basic-webserver/near/436610712" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/Default.20error.20handling.20in.20basic-webserver.html#436610712">(May 02 2024 at 03:38)</a>:</h4>
<p>unfortunately, looks like implementing this idea runs into <a href="#narrow/stream/395097-compiler-development/topic/Alias.20analysis.20error.20across.20modules">https://roc.zulipchat.com/#narrow/stream/395097-compiler-development/topic/Alias.20analysis.20error.20across.20modules</a></p>
<blockquote>
<p>thread 'main' panicked at crates/compiler/gen_llvm/src/llvm/build.rs:5759:19:<br>
Error in alias analysis: error in module ModName("UserApp"), function definition FuncName("\x0f\x00\x00\x00\x05\x00\x00\x00\xce\x826j\x04j\xb3\xbf"), definition of value binding ValueId(3): could not find func in module ModName("UserApp") with name FuncName("\x02\x00\x00\x00\x00\x00\x00\x00\x1d\xc8\xcdx&gt;Y\x17\x03")</p>
</blockquote>



<a name="441404917"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/Default%20error%20handling%20in%20basic-webserver/near/441404917" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/Default.20error.20handling.20in.20basic-webserver.html#441404917">(May 30 2024 at 08:06)</a>:</h4>
<p>So to summarise the key points from above, I am going to make the following changes in a PR:</p>
<ol>
<li>change the name of the function provided to the platform from <code>main</code> to <code>respond</code></li>
<li>
<p>change the API to accept tag union of errors e.g. <code>respond : Request -&gt; Task Response [ServerErr Str]_</code>. </p>
<ul>
<li>When the platform see a <code>ServerErr</code> tag, it will respond with a status code of 500 and log the <code>Str</code> to stderr (not in the response). </li>
<li>Any other unhandled errors are automatically converted to a 500 and also <code>Inspect.toStr</code> logged to stderr.</li>
</ul>
</li>
<li>
<p>attempt to convert <code>roc_panic</code> to respond with a 500 and log the stderr, instead of crashing the server</p>
</li>
<li>split the platform and host files into separate crates (like basic-cli)</li>
</ol>



<a name="441407558"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/Default%20error%20handling%20in%20basic-webserver/near/441407558" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/Default.20error.20handling.20in.20basic-webserver.html#441407558">(May 30 2024 at 08:24)</a>:</h4>
<p>For any experienced rust people ... to implement the <code>roc_panic</code> handling I wonder if we can use <a href="https://doc.rust-lang.org/std/panic/fn.catch_unwind.html">std::panic::catch_unwind</a> to wrap the call into roc. </p>
<p>My theory is that then when <code>roc_panic</code> gets called and we <code>panic!</code> in there, that is be somewhere down the stack and this will catch that so we can handle it appropriately.</p>



<a name="441435151"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/Default%20error%20handling%20in%20basic-webserver/near/441435151" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/Default.20error.20handling.20in.20basic-webserver.html#441435151">(May 30 2024 at 11:15)</a>:</h4>
<p><span class="user-mention silent" data-user-id="515757">Luke Boswell</span> <a href="#narrow/stream/383402-API-Design/topic/Default.20error.20handling.20in.20basic-webserver/near/441407558">said</a>:</p>
<blockquote>
<p>For any experienced rust people ... to implement the <code>roc_panic</code> handling I wonder if we can use <a href="https://doc.rust-lang.org/std/panic/fn.catch_unwind.html">std::panic::catch_unwind</a> to wrap the call into roc. </p>
<p>My theory is that then when <code>roc_panic</code> gets called and we <code>panic!</code> in there, that is be somewhere down the stack and this will catch that so we can handle it appropriately.</p>
</blockquote>
<p>I know <span class="user-mention" data-user-id="281543">@Folkert de Vries</span> has looked into this for Nea!</p>



<a name="441438654"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/Default%20error%20handling%20in%20basic-webserver/near/441438654" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/Default.20error.20handling.20in.20basic-webserver.html#441438654">(May 30 2024 at 11:35)</a>:</h4>
<p>this is dangerous in practice. Rust panics are not normally allowed to cross an FFI boundary either way. There is now a special calling convention "C-unwind" but even then I think the unwinding through roc code won't really work?</p>



<a name="441438765"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/Default%20error%20handling%20in%20basic-webserver/near/441438765" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/Default.20error.20handling.20in.20basic-webserver.html#441438765">(May 30 2024 at 11:36)</a>:</h4>
<p>I mean we could make it work technically I guess (though I have no idea how)</p>



<a name="441449408"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/Default%20error%20handling%20in%20basic-webserver/near/441449408" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/Default.20error.20handling.20in.20basic-webserver.html#441449408">(May 30 2024 at 12:45)</a>:</h4>
<p>hm, what should we do instead?</p>



<a name="441449429"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/Default%20error%20handling%20in%20basic-webserver/near/441449429" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/Default.20error.20handling.20in.20basic-webserver.html#441449429">(May 30 2024 at 12:45)</a>:</h4>
<p>setjmp/longjmp?</p>



<a name="441449544"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/Default%20error%20handling%20in%20basic-webserver/near/441449544" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/Default.20error.20handling.20in.20basic-webserver.html#441449544">(May 30 2024 at 12:46)</a>:</h4>
<p>maybe. are we sure we can skip running destructors ?</p>



<a name="441449581"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/Default%20error%20handling%20in%20basic-webserver/near/441449581" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Folkert de Vries <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/Default.20error.20handling.20in.20basic-webserver.html#441449581">(May 30 2024 at 12:46)</a>:</h4>
<p>that would just leak memory otherwise</p>



<a name="441449635"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/Default%20error%20handling%20in%20basic-webserver/near/441449635" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/Default.20error.20handling.20in.20basic-webserver.html#441449635">(May 30 2024 at 12:47)</a>:</h4>
<p>hm, yeah good point</p>



<a name="441449698"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/Default%20error%20handling%20in%20basic-webserver/near/441449698" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/Default.20error.20handling.20in.20basic-webserver.html#441449698">(May 30 2024 at 12:47)</a>:</h4>
<p>this is a good argument for doing the unwinding inside the generated Roc code and having the Roc call return a Result <span aria-label="sweat smile" class="emoji emoji-1f605" role="img" title="sweat smile">:sweat_smile:</span></p>



<a name="441449730"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/Default%20error%20handling%20in%20basic-webserver/near/441449730" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/Default.20error.20handling.20in.20basic-webserver.html#441449730">(May 30 2024 at 12:47)</a>:</h4>
<p>(along with effect interpreters and passing in an Allocator struct)</p>



<a name="441517053"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/Default%20error%20handling%20in%20basic-webserver/near/441517053" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/Default.20error.20handling.20in.20basic-webserver.html#441517053">(May 30 2024 at 17:40)</a>:</h4>
<p>If exceptions are truly rare, returning a result generally has worse performance characteristics. Especially if the result has to accumulate some sort of information related to the stack trace on the error case.</p>



<a name="441517103"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/Default%20error%20handling%20in%20basic-webserver/near/441517103" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/Default.20error.20handling.20in.20basic-webserver.html#441517103">(May 30 2024 at 17:40)</a>:</h4>
<p>True exceptions with unwinding are a better trade off if we expect panics to be rare (which I think we do).</p>



<a name="441522354"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/Default%20error%20handling%20in%20basic-webserver/near/441522354" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/Default.20error.20handling.20in.20basic-webserver.html#441522354">(May 30 2024 at 18:07)</a>:</h4>
<p>true</p>



<a name="441522482"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/Default%20error%20handling%20in%20basic-webserver/near/441522482" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/Default.20error.20handling.20in.20basic-webserver.html#441522482">(May 30 2024 at 18:07)</a>:</h4>
<p>although I guess setjmp has a cost even if we don't end up doing the longjmp</p>



<a name="441522617"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/Default%20error%20handling%20in%20basic-webserver/near/441522617" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/Default.20error.20handling.20in.20basic-webserver.html#441522617">(May 30 2024 at 18:08)</a>:</h4>
<p>and that cost will be higher than the Result handling cost</p>



<a name="441522631"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/Default%20error%20handling%20in%20basic-webserver/near/441522631" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/Default.20error.20handling.20in.20basic-webserver.html#441522631">(May 30 2024 at 18:08)</a>:</h4>
<p>setjmp has a very minor cost. Just saving like 8 registers or something</p>



<a name="441522717"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/Default%20error%20handling%20in%20basic-webserver/near/441522717" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/Default.20error.20handling.20in.20basic-webserver.html#441522717">(May 30 2024 at 18:08)</a>:</h4>
<p>Anyway, I realized that this is kinda something we can easily make an implementation detail</p>



<a name="441523013"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/Default%20error%20handling%20in%20basic-webserver/near/441523013" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/Default.20error.20handling.20in.20basic-webserver.html#441523013">(May 30 2024 at 18:10)</a>:</h4>
<p>Always return a result to the host for a panic.</p>
<p>Internally, we can do:</p>
<ul>
<li>setjmp/longjmp</li>
<li>full exception unwinding</li>
<li>return a result through the stack</li>
<li>return a result through the stack that also records the entire stack trace</li>
</ul>
<p>We could do any of those and still just return a result to a host that represents the potential panic.</p>



<a name="441528795"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/Default%20error%20handling%20in%20basic-webserver/near/441528795" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/Default.20error.20handling.20in.20basic-webserver.html#441528795">(May 30 2024 at 18:43)</a>:</h4>
<p>yeah that sounds awesome! <span aria-label="grinning" class="emoji emoji-1f600" role="img" title="grinning">:grinning:</span></p>



<hr><p>Last updated: Mar 01 2026 at 12:20 UTC</p>
</html>