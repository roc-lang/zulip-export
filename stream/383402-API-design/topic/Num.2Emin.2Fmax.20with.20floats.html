<html>
<head><meta charset="utf-8"><title>Num.min/max with floats · API design · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/index.html">API design</a></h2>
<h3>Topic: <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/Num.2Emin.2Fmax.20with.20floats.html">Num.min/max with floats</a></h3>

<hr>

<base href="https://roc.zulipchat.com">

<head><link href="https://roc-lang.github.io/zulip-export/style.css" rel="stylesheet"></head>

<a name="397995708"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/Num.min/max%20with%20floats/near/397995708" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/Num.2Emin.2Fmax.20with.20floats.html#397995708">(Oct 23 2023 at 02:31)</a>:</h4>
<p>so in a recent Software Unscripted chat with Matt Godbolt, he noted that if <code>min</code> or <code>max</code> are given <code>NaN</code>, it's important that they always return <code>NaN</code> - we actually have a bug with this  right now, where you get a different answer depending on the order of the arguments:</p>
<div class="codehilite"><pre><span></span><code>» Num.min (0f64 / 0) 1

1 : F64
» Num.min 1 (0f64 / 0)

NaN : F64
</code></pre></div>



<a name="397995720"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/Num.min/max%20with%20floats/near/397995720" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/Num.2Emin.2Fmax.20with.20floats.html#397995720">(Oct 23 2023 at 02:31)</a>:</h4>
<p>this is because we have the naive implementation that just does a conditional</p>



<a name="397995836"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/Num.min/max%20with%20floats/near/397995836" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/Num.2Emin.2Fmax.20with.20floats.html#397995836">(Oct 23 2023 at 02:32)</a>:</h4>
<p>so I can see an argument for 3 different potential designs for what we should do instead of this:</p>
<ol>
<li>always return <code>NaN</code></li>
<li><code>crash</code> if either argument is <code>NaN</code></li>
<li>add an <code>implements Eq</code> constraint to <code>min</code> and <code>max</code> so you can't pass them floats anymore</li>
</ol>



<a name="397995853"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/Num.min/max%20with%20floats/near/397995853" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/Num.2Emin.2Fmax.20with.20floats.html#397995853">(Oct 23 2023 at 02:33)</a>:</h4>
<p>anyone have thoughts on which we should do?</p>



<a name="397996691"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/Num.min/max%20with%20floats/near/397996691" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/Num.2Emin.2Fmax.20with.20floats.html#397996691">(Oct 23 2023 at 02:39)</a>:</h4>
<p>Definitely not 2 or 3</p>



<a name="397996805"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/Num.min/max%20with%20floats/near/397996805" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/Num.2Emin.2Fmax.20with.20floats.html#397996805">(Oct 23 2023 at 02:40)</a>:</h4>
<p>I would either do 1 (most correct) or only return NaN if both are NaN (not correct but very useful in certain situations)</p>



<a name="397996837"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/Num.min/max%20with%20floats/near/397996837" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/Num.2Emin.2Fmax.20with.20floats.html#397996837">(Oct 23 2023 at 02:40)</a>:</h4>
<p>But yeah, I would just do 1.</p>



<a name="397996905"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/Num.min/max%20with%20floats/near/397996905" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/Num.2Emin.2Fmax.20with.20floats.html#397996905">(Oct 23 2023 at 02:41)</a>:</h4>
<p>Floats are meant explicitly to accept NaN in order to delay error handling and keep code fast. That is why I think 2 is bad.</p>



<a name="397996960"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/Num.min/max%20with%20floats/near/397996960" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/Num.2Emin.2Fmax.20with.20floats.html#397996960">(Oct 23 2023 at 02:41)</a>:</h4>
<p>in defense of 3, wouldn't some of the same arguments apply here as applied when we decided not to give floats <code>Eq</code>? <span aria-label="thinking" class="emoji emoji-1f914" role="img" title="thinking">:thinking:</span></p>



<a name="397997017"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/Num.min/max%20with%20floats/near/397997017" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/Num.2Emin.2Fmax.20with.20floats.html#397997017">(Oct 23 2023 at 02:42)</a>:</h4>
<p>I think 3 is bad cause comparing floats is super common. For example, which is faster?</p>



<a name="397997139"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/Num.min/max%20with%20floats/near/397997139" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/Num.2Emin.2Fmax.20with.20floats.html#397997139">(Oct 23 2023 at 02:43)</a>:</h4>
<p>There are lots of cases for float ordering where you really don't care if two values are basically the same. If they are basically the same, either answer is really fine. Unlike with equality where being off by a little is super common and causes issues.</p>



<a name="397997245"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/Num.min/max%20with%20floats/near/397997245" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/Num.2Emin.2Fmax.20with.20floats.html#397997245">(Oct 23 2023 at 02:44)</a>:</h4>
<p>Like if 2 values are essentially equal and you call max, it really doesn't matter which value is return or if they are actually equal. So I think not the same as <code>Eq</code></p>



<a name="397997729"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/Num.min/max%20with%20floats/near/397997729" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/Num.2Emin.2Fmax.20with.20floats.html#397997729">(Oct 23 2023 at 02:48)</a>:</h4>
<p>why definitely not 2?</p>



<a name="397997820"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/Num.min/max%20with%20floats/near/397997820" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ayaz Hafiz <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/Num.2Emin.2Fmax.20with.20floats.html#397997820">(Oct 23 2023 at 02:49)</a>:</h4>
<p>3 should really be an <code>implements Ord</code> constraint right? I think it's reasonable because floats don't have a total ordering. but the problem is you may get the very reasonable question "why is there no min for floats when I can do <code>if a &lt; b then a else if b &lt; a then b else a</code>"</p>



<a name="397997943"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/Num.min/max%20with%20floats/near/397997943" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/Num.2Emin.2Fmax.20with.20floats.html#397997943">(Oct 23 2023 at 02:50)</a>:</h4>
<p>hm, interesting - we don't have <code>Ord</code> yet, but I was assuming we'd implement it for all numbers</p>



<a name="397997961"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/Num.min/max%20with%20floats/near/397997961" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ayaz Hafiz <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/Num.2Emin.2Fmax.20with.20floats.html#397997961">(Oct 23 2023 at 02:50)</a>:</h4>
<p>actually, apparently ieee 754 specifies one total ordering for floats, in which case <code>1 &lt; NaN</code> can mean something: <a href="https://en.wikipedia.org/wiki/IEEE_754#Total-ordering_predicate">https://en.wikipedia.org/wiki/IEEE_754#Total-ordering_predicate</a></p>



<a name="397997962"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/Num.min/max%20with%20floats/near/397997962" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/Num.2Emin.2Fmax.20with.20floats.html#397997962">(Oct 23 2023 at 02:50)</a>:</h4>
<p>so the args being <code>Num</code> would suffice there</p>



<a name="397998207"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/Num.min/max%20with%20floats/near/397998207" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/Num.2Emin.2Fmax.20with.20floats.html#397998207">(Oct 23 2023 at 02:52)</a>:</h4>
<p>although I certainly think there's an argument for those being consistent - like surely if we define <code>Ord</code> for floats, then <code>Num.min</code> and <code>Num.max</code> should be available on them (or else none of them should be available)</p>



<a name="397998368"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/Num.min/max%20with%20floats/near/397998368" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/Num.2Emin.2Fmax.20with.20floats.html#397998368">(Oct 23 2023 at 02:54)</a>:</h4>
<p>For 2, NaN is often expected. It means that the rest of a float computation is invalid. So you let the NaN propagate to the end like you would a result (just faster). At the end of the calculations, you handle the NaN. Crashing on NaN would ruin the usability</p>



<a name="397998519"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/Num.min/max%20with%20floats/near/397998519" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ayaz Hafiz <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/Num.2Emin.2Fmax.20with.20floats.html#397998519">(Oct 23 2023 at 02:55)</a>:</h4>
<p>well, it depends what <code>Ord</code> is. Is it a total ordering? If so then yeah, certainly min/max must be available. But if Ord is defined such that <code>a &lt; b</code> being false does not imply that <code>a &gt;= b</code> is true,  then it's a little bit more free (but at that point you probably want to have something like rust's partial Ord too)</p>



<a name="397998594"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/Num.min/max%20with%20floats/near/397998594" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/Num.2Emin.2Fmax.20with.20floats.html#397998594">(Oct 23 2023 at 02:56)</a>:</h4>
<p>Also, I think it is more reasonable to define <code>min</code> and <code>max</code> on floats than to define <code>ord</code>on them.</p>



<a name="397998700"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/Num.min/max%20with%20floats/near/397998700" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/Num.2Emin.2Fmax.20with.20floats.html#397998700">(Oct 23 2023 at 02:57)</a>:</h4>
<p>That said, I think they should have both (or at least <code>min</code>, <code>max</code> and <code>PartialOrd</code>)</p>



<a name="397998705"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/Num.min/max%20with%20floats/near/397998705" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/Num.2Emin.2Fmax.20with.20floats.html#397998705">(Oct 23 2023 at 02:57)</a>:</h4>
<p>I definitely would prefer not to have both <code>Ord</code> and <code>PartialOrd</code> abilities in builtins <span aria-label="sweat smile" class="emoji emoji-1f605" role="img" title="sweat smile">:sweat_smile:</span></p>



<a name="397998777"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/Num.min/max%20with%20floats/near/397998777" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/Num.2Emin.2Fmax.20with.20floats.html#397998777">(Oct 23 2023 at 02:58)</a>:</h4>
<p>I think it makes sense for Rust to have them, but it doesn't seem great for Roc</p>



<a name="397999050"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/Num.min/max%20with%20floats/near/397999050" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/Num.2Emin.2Fmax.20with.20floats.html#397999050">(Oct 23 2023 at 03:00)</a>:</h4>
<p>The reason <code>min</code> and <code>max</code> are more reasonable than <code>Ord</code> on floats is the potential damage that can be done. With <code>Ord</code>, you will hit cases where two floats are <code>approxEq</code>, but <code>Ord</code> gives them a strict ordering. This can lead to mistakes where a user actually wants to treat to <code>approxEq</code> floats as <code>Eq</code>, but doesn't realize that by using <code>Ord</code> everything is exact instead of approximate.</p>



<a name="397999108"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/Num.min/max%20with%20floats/near/397999108" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/Num.2Emin.2Fmax.20with.20floats.html#397999108">(Oct 23 2023 at 03:01)</a>:</h4>
<p>With <code>min</code> and <code>max</code>. If two floats are <code>approxEq</code> the <code>min</code> or <code>max</code> of them will still be <code>approxEq</code>. So no harm done.</p>



<a name="397999224"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/Num.min/max%20with%20floats/near/397999224" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/Num.2Emin.2Fmax.20with.20floats.html#397999224">(Oct 23 2023 at 03:02)</a>:</h4>
<p><code>min</code> and <code>max</code> don't get harmed by float values being super close but not exactly equal.</p>



<a name="397999245"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/Num.min/max%20with%20floats/near/397999245" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/Num.2Emin.2Fmax.20with.20floats.html#397999245">(Oct 23 2023 at 03:02)</a>:</h4>
<p><code>Ord</code> does.</p>



<a name="397999343"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/Num.min/max%20with%20floats/near/397999343" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/Num.2Emin.2Fmax.20with.20floats.html#397999343">(Oct 23 2023 at 03:03)</a>:</h4>
<p>but yeah, float sorting with <code>NaN</code> falls appart because there is no clear place to sort <code>NaNs</code> to.</p>



<a name="397999373"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/Num.min/max%20with%20floats/near/397999373" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/Num.2Emin.2Fmax.20with.20floats.html#397999373">(Oct 23 2023 at 03:03)</a>:</h4>
<p>That is another case where <code>Ord</code> on floats is complicated.</p>



<a name="397999444"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/Num.min/max%20with%20floats/near/397999444" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ayaz Hafiz <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/Num.2Emin.2Fmax.20with.20floats.html#397999444">(Oct 23 2023 at 03:04)</a>:</h4>
<p>why is there no clear place? we could follow the ieee 754 standard, or come up with another one. I don't think there's a technical limitation there.</p>



<a name="397999590"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/Num.min/max%20with%20floats/near/397999590" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ayaz Hafiz <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/Num.2Emin.2Fmax.20with.20floats.html#397999590">(Oct 23 2023 at 03:05)</a>:</h4>
<p>I don't think Ord is a concern for floating points if you only allow a strict order, that is, only comparing <code>a &lt; b</code> rather than <code>a &lt;= b</code> (which is what min/max already do). I think we cannot do <code>a &lt;= b</code>-style total ordering anyway, because otherwise floats can implement Eq via Ord, which is incorrect</p>



<a name="397999786"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/Num.min/max%20with%20floats/near/397999786" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/Num.2Emin.2Fmax.20with.20floats.html#397999786">(Oct 23 2023 at 03:07)</a>:</h4>
<p>There is no clear place because if you implement a userland sort using <code>&lt;</code> or <code>&gt;</code> you will get strange results when <code>NaN</code> is in a the array. It depends on if the comparisons are <code>x &lt; NaN</code> or <code>NaN &lt; x</code>.</p>



<a name="397999894"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/Num.min/max%20with%20floats/near/397999894" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/Num.2Emin.2Fmax.20with.20floats.html#397999894">(Oct 23 2023 at 03:08)</a>:</h4>
<p>The only way the ieee gets a total ordering is by bitcasting to an integer (which roc doesn't allow users to do)</p>



<a name="397999990"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/Num.min/max%20with%20floats/near/397999990" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/Num.2Emin.2Fmax.20with.20floats.html#397999990">(Oct 23 2023 at 03:09)</a>:</h4>
<p><span class="user-mention silent" data-user-id="454654">Ayaz Hafiz</span> <a href="#narrow/stream/383402-API-Design/topic/Num.2Emin.2Fmax.20with.20floats/near/397997820">said</a>:</p>
<blockquote>
<p>3 should really be an <code>implements Ord</code> constraint right? I think it's reasonable because floats don't have a total ordering. but the problem is you may get the very reasonable question "why is there no min for floats when I can do <code>if a &lt; b then a else if b &lt; a then b else a</code>"</p>
</blockquote>
<p>another way of thinking of this: if we don't support <code>Num.min</code> and <code>Num.max</code> on floats, then people will probably implement their own in the naive way and accidentally end up with the same bug we did <span aria-label="grimacing" class="emoji emoji-1f62c" role="img" title="grimacing">:grimacing:</span></p>



<a name="397999995"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/Num.min/max%20with%20floats/near/397999995" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/Num.2Emin.2Fmax.20with.20floats.html#397999995">(Oct 23 2023 at 03:09)</a>:</h4>
<p>So multiple "correct" strict ord based sorting algorythms in roc would put <code>NaNs</code> in different places. This can even happen with the same alg if <code>NaN</code> is just in a different place in the array.</p>



<a name="398000183"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/Num.min/max%20with%20floats/near/398000183" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/Num.2Emin.2Fmax.20with.20floats.html#398000183">(Oct 23 2023 at 03:10)</a>:</h4>
<p>oh yeah, I forgot that sorting requires equality, which floats don't have</p>



<a name="398000226"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/Num.min/max%20with%20floats/near/398000226" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/Num.2Emin.2Fmax.20with.20floats.html#398000226">(Oct 23 2023 at 03:11)</a>:</h4>
<p>(in current Roc I mean)</p>



<a name="398000261"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/Num.min/max%20with%20floats/near/398000261" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/Num.2Emin.2Fmax.20with.20floats.html#398000261">(Oct 23 2023 at 03:11)</a>:</h4>
<p>relevant previous discussion:</p>
<p><span class="user-mention silent" data-user-id="343810">Brendan Hansknecht</span> <a href="#narrow/stream/304641-ideas/topic/supporting.20NaN.2FInfinity.2F-Infinity.3F/near/275915767">said</a>:</p>
<blockquote>
<blockquote>
<p>obviously <code>x &lt; NaN == NaN &lt; x</code> is unintuitive, but can we think of some specific realistic scenarios where this would cause a bug?</p>
</blockquote>
<p>Would this but lead to a bug in most sorting algorithms?</p>
</blockquote>



<a name="398000460"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/Num.min/max%20with%20floats/near/398000460" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/Num.2Emin.2Fmax.20with.20floats.html#398000460">(Oct 23 2023 at 03:13)</a>:</h4>
<blockquote>
<p>oh yeah, I forgot that sorting requires equality, which floats don't have</p>
</blockquote>
<p>Huh, no it doesn't</p>



<a name="398000463"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/Num.min/max%20with%20floats/near/398000463" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/Num.2Emin.2Fmax.20with.20floats.html#398000463">(Oct 23 2023 at 03:13)</a>:</h4>
<p>Just <code>&lt;</code> or <code>&gt;</code></p>



<a name="398000555"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/Num.min/max%20with%20floats/near/398000555" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/Num.2Emin.2Fmax.20with.20floats.html#398000555">(Oct 23 2023 at 03:14)</a>:</h4>
<blockquote>
<p>Would this but lead to a bug in most sorting algorithms?</p>
</blockquote>
<p>Yes, yes it would</p>



<a name="398000671"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/Num.min/max%20with%20floats/near/398000671" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/Num.2Emin.2Fmax.20with.20floats.html#398000671">(Oct 23 2023 at 03:15)</a>:</h4>
<p>I mean, I guess if we want to follow the float total ordering standard, we would change all comparison operators and floats to treat them as signed integers.</p>



<a name="398000703"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/Num.min/max%20with%20floats/near/398000703" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/Num.2Emin.2Fmax.20with.20floats.html#398000703">(Oct 23 2023 at 03:15)</a>:</h4>
<p>Min and max would follow that as well.</p>



<a name="398000781"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/Num.min/max%20with%20floats/near/398000781" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/Num.2Emin.2Fmax.20with.20floats.html#398000781">(Oct 23 2023 at 03:16)</a>:</h4>
<p>but that sounds unexpected and probably bugged in other ways.</p>



<a name="398000919"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/Num.min/max%20with%20floats/near/398000919" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/Num.2Emin.2Fmax.20with.20floats.html#398000919">(Oct 23 2023 at 03:17)</a>:</h4>
<p>a relevant consideration is that we have <code>Dec</code> for reasonableness and floats for performance</p>



<a name="398001000"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/Num.min/max%20with%20floats/near/398001000" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ayaz Hafiz <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/Num.2Emin.2Fmax.20with.20floats.html#398001000">(Oct 23 2023 at 03:18)</a>:</h4>
<p>the total ordering isn't based on casting to integers. it's the "regular" ordering, with negative and positive NaNs pinnned to either ends.</p>



<a name="398001032"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/Num.min/max%20with%20floats/near/398001032" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/Num.2Emin.2Fmax.20with.20floats.html#398001032">(Oct 23 2023 at 03:18)</a>:</h4>
<p>Yeah, that is the same as casting to a signed integer</p>



<a name="398001040"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/Num.min/max%20with%20floats/near/398001040" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/Num.2Emin.2Fmax.20with.20floats.html#398001040">(Oct 23 2023 at 03:19)</a>:</h4>
<p>so there's a case to be made that our tolerance for error-prone-ness in floats should be reduced for the sake of increasing performance, since that's kind of their whole point</p>



<a name="398001045"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/Num.min/max%20with%20floats/near/398001045" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/Num.2Emin.2Fmax.20with.20floats.html#398001045">(Oct 23 2023 at 03:19)</a>:</h4>
<p>or at least their main point</p>



<a name="398001085"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/Num.min/max%20with%20floats/near/398001085" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/Num.2Emin.2Fmax.20with.20floats.html#398001085">(Oct 23 2023 at 03:19)</a>:</h4>
<p>*magnitude integer</p>



<a name="398001107"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/Num.min/max%20with%20floats/near/398001107" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/Num.2Emin.2Fmax.20with.20floats.html#398001107">(Oct 23 2023 at 03:19)</a>:</h4>
<p>cause  it doesn't have the twos compliment</p>



<a name="398001116"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/Num.min/max%20with%20floats/near/398001116" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/Num.2Emin.2Fmax.20with.20floats.html#398001116">(Oct 23 2023 at 03:19)</a>:</h4>
<p>so yeah, sorry, a bit different</p>



<a name="398001208"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/Num.min/max%20with%20floats/near/398001208" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/Num.2Emin.2Fmax.20with.20floats.html#398001208">(Oct 23 2023 at 03:20)</a>:</h4>
<p>from wikipedia:</p>
<blockquote>
<p>the comparison is identical to one that type puns the floating-point numbers to a sign–magnitude integer</p>
</blockquote>



<a name="398001388"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/Num.min/max%20with%20floats/near/398001388" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/Num.2Emin.2Fmax.20with.20floats.html#398001388">(Oct 23 2023 at 03:22)</a>:</h4>
<blockquote>
<p>our tolerance for error-prone-ness in floats should be reduced for the sake of increasing performance</p>
</blockquote>
<p>Can you word that differently? At least as I am reading it, I think it is backwards from what I feel you are trying to say.</p>



<a name="398001743"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/Num.min/max%20with%20floats/near/398001743" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/Num.2Emin.2Fmax.20with.20floats.html#398001743">(Oct 23 2023 at 03:26)</a>:</h4>
<p>haha yeah - basically error-prone APIs are more acceptable when it comes to floats</p>



<a name="398001801"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/Num.min/max%20with%20floats/near/398001801" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/Num.2Emin.2Fmax.20with.20floats.html#398001801">(Oct 23 2023 at 03:26)</a>:</h4>
<p>I should go to sleep <span aria-label="laughing" class="emoji emoji-1f606" role="img" title="laughing">:laughing:</span></p>



<a name="398020186"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/Num.min/max%20with%20floats/near/398020186" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Martin Stewart <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/Num.2Emin.2Fmax.20with.20floats.html#398020186">(Oct 23 2023 at 06:39)</a>:</h4>
<p>Maybe I misunderstood the decision made in an earlier thread or maybe plans have since changed but I thought Roc wasn’t going to allow NaN to exist in order to avoid these sorts of issues. Any functions that could potentially return NaN would either panic or return an error if it were to happen?</p>



<a name="398083755"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/Num.min/max%20with%20floats/near/398083755" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Martin Stewart <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/Num.2Emin.2Fmax.20with.20floats.html#398083755">(Oct 23 2023 at 13:20)</a>:</h4>
<p><a href="#narrow/stream/304641-ideas/topic/supporting.20NaN.2FInfinity.2F-Infinity.3F">https://roc.zulipchat.com/#narrow/stream/304641-ideas/topic/supporting.20NaN.2FInfinity.2F-Infinity.3F</a> Found the discussion. Not sure what conclusion was made though (I guess it was to keep NaN given it's assumed here)</p>



<a name="398109374"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/Num.min/max%20with%20floats/near/398109374" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/Num.2Emin.2Fmax.20with.20floats.html#398109374">(Oct 23 2023 at 15:23)</a>:</h4>
<p>yeah exactly</p>



<a name="398109557"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/Num.min/max%20with%20floats/near/398109557" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/Num.2Emin.2Fmax.20with.20floats.html#398109557">(Oct 23 2023 at 15:23)</a>:</h4>
<p>the problem was that if we don't have it in the language, there's no way to get maximum float performance - and the main point of having floats at all is performance!</p>



<hr><p>Last updated: Mar 01 2026 at 12:20 UTC</p>
</html>