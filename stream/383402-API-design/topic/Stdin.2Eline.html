<html>
<head><meta charset="utf-8"><title>Stdin.line · API design · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/index.html">API design</a></h2>
<h3>Topic: <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/Stdin.2Eline.html">Stdin.line</a></h3>

<hr>

<base href="https://roc.zulipchat.com">

<head><link href="https://roc-lang.github.io/zulip-export/style.css" rel="stylesheet"></head>

<a name="434589657"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/Stdin.line/near/434589657" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/Stdin.2Eline.html#434589657">(Apr 21 2024 at 13:38)</a>:</h4>
<p>so awhile back we <a href="#narrow/stream/231634-beginners/topic/Reading.20Stdin.20until.20EOT.3F">changed <code>Stdin.line</code></a> to produce <code>[Input Str, End]</code></p>



<a name="434589672"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/Stdin.line/near/434589672" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/Stdin.2Eline.html#434589672">(Apr 21 2024 at 13:39)</a>:</h4>
<p>this makes the function a lot less helpful for learning, because this doesn't work:</p>
<div class="codehilite" data-code-language="Bash"><pre><span></span><code><span class="nv">main</span><span class="w"> </span><span class="o">=</span>
<span class="w">    </span>Stdout.line!<span class="w"> </span><span class="s2">"Type something and press Enter."</span>
<span class="w">    </span><span class="nv">input</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>Stdin.line!
<span class="w">    </span>Stdout.line!<span class="w"> </span><span class="s2">"You entered: </span><span class="k">$(</span>input<span class="k">)</span><span class="s2">"</span>
</code></pre></div>



<a name="434589684"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/Stdin.line/near/434589684" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/Stdin.2Eline.html#434589684">(Apr 21 2024 at 13:39)</a>:</h4>
<p>I wonder if we should revisit the original problem and reonsider the API</p>



<a name="434589692"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/Stdin.line/near/434589692" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/Stdin.2Eline.html#434589692">(Apr 21 2024 at 13:40)</a>:</h4>
<p>specifically, I'm wondering if we should solve it with two functions</p>



<a name="434589752"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/Stdin.line/near/434589752" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/Stdin.2Eline.html#434589752">(Apr 21 2024 at 13:40)</a>:</h4>
<p><code>Stdin.line</code> goes back to producing a <code>Str</code> and then we have a different <code>Stdin</code> function for reading until EOT</p>



<a name="434589756"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/Stdin.line/near/434589756" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/Stdin.2Eline.html#434589756">(Apr 21 2024 at 13:40)</a>:</h4>
<p>thoughts?</p>



<a name="434591693"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/Stdin.line/near/434591693" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/Stdin.2Eline.html#434591693">(Apr 21 2024 at 14:12)</a>:</h4>
<p>as a concrete design idea:</p>
<div class="codehilite" data-code-language="Python"><pre><span></span><code><span class="c1">## Reads bytes from stdin until a '\n'</span>
<span class="c1">## byte is encountered, then parses</span>
<span class="c1">## all the bytes before it as utf8</span>
<span class="n">Stdin</span><span class="o">.</span><span class="n">line</span> <span class="p">:</span> <span class="n">Task</span> <span class="n">Str</span> <span class="o">*</span>
</code></pre></div>
<div class="codehilite" data-code-language="Python"><pre><span></span><code><span class="c1">## Reads bytes from stdin until an EOT</span>
<span class="c1">## byte is encountered, then parses</span>
<span class="c1">## all the bytes before it as utf8</span>
<span class="n">Stdin</span><span class="o">.</span><span class="n">eot</span> <span class="p">:</span> <span class="n">Task</span> <span class="n">Str</span> <span class="o">*</span>
</code></pre></div>



<a name="434593348"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/Stdin.line/near/434593348" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Isaac Van Doren <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/Stdin.2Eline.html#434593348">(Apr 21 2024 at 14:37)</a>:</h4>
<p>That sounds great!</p>



<a name="434594555"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/Stdin.line/near/434594555" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/Stdin.2Eline.html#434594555">(Apr 21 2024 at 14:54)</a>:</h4>
<p>I don't think that works. You often have to read in small chunks (like lines), but you also need to know when the stdin stream ends</p>



<a name="434594571"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/Stdin.line/near/434594571" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/Stdin.2Eline.html#434594571">(Apr 21 2024 at 14:54)</a>:</h4>
<p>I think you fundamentally just want the end of the stream to be seen as exceptional and ignore in the normal case</p>



<a name="434594736"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/Stdin.line/near/434594736" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/Stdin.2Eline.html#434594736">(Apr 21 2024 at 14:57)</a>:</h4>
<p>ok so then we could rename the current function to like <code>Stdin.lineOrEot</code> or something?</p>



<a name="434594756"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/Stdin.line/near/434594756" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/Stdin.2Eline.html#434594756">(Apr 21 2024 at 14:57)</a>:</h4>
<p>and then reintroduce the previous <code>Stdin.line</code> design</p>



<a name="434594766"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/Stdin.line/near/434594766" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/Stdin.2Eline.html#434594766">(Apr 21 2024 at 14:57)</a>:</h4>
<p>So I would propose:</p>
<div class="codehilite"><pre><span></span><code>Stdin.line Str [StreamEnd]
</code></pre></div>
<p>So you can do either;</p>
<div class="codehilite"><pre><span></span><code># dont care
In = Stdin.line!
Stdout.line! &quot;You entered: $(in)&quot;

# do care
InRes = Stdin.line |&gt; Task.result!
when inRes is
    ...
</code></pre></div>



<a name="434594787"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/Stdin.line/near/434594787" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/Stdin.2Eline.html#434594787">(Apr 21 2024 at 14:57)</a>:</h4>
<p>Probably with a better error message, but that general idea</p>



<a name="434594829"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/Stdin.line/near/434594829" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/Stdin.2Eline.html#434594829">(Apr 21 2024 at 14:58)</a>:</h4>
<p>to me, the main motivation of this change is to have <code>Task Str *</code> as a beginner learning tool</p>



<a name="434594845"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/Stdin.line/near/434594845" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/Stdin.2Eline.html#434594845">(Apr 21 2024 at 14:58)</a>:</h4>
<p>I don't think we want to have to teach error handling that early</p>



<a name="434594856"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/Stdin.line/near/434594856" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/Stdin.2Eline.html#434594856">(Apr 21 2024 at 14:58)</a>:</h4>
<p>or <code>Result</code></p>



<a name="434594908"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/Stdin.line/near/434594908" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/Stdin.2Eline.html#434594908">(Apr 21 2024 at 15:00)</a>:</h4>
<p>I strongly think <code>Stdin.line</code> should do the right thing and have an error type. (Or just return an union directly)</p>
<p>We should be explicit if we make a version that crashes or just keeps returning empty input. That version should have the longer name<br>
<code>Stdin.lineUnchecked: ...</code> or etc</p>



<a name="434595024"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/Stdin.line/near/434595024" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/Stdin.2Eline.html#434595024">(Apr 21 2024 at 15:01)</a>:</h4>
<p>Also, you can hide the error handling by making the platform handle it by default</p>



<a name="434595031"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/Stdin.line/near/434595031" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/Stdin.2Eline.html#434595031">(Apr 21 2024 at 15:01)</a>:</h4>
<p>Allow any error to be returned to the platform</p>



<a name="434595046"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/Stdin.line/near/434595046" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/Stdin.2Eline.html#434595046">(Apr 21 2024 at 15:01)</a>:</h4>
<p>It can print the error (will be a low quality message) and crash</p>



<a name="434595110"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/Stdin.line/near/434595110" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/Stdin.2Eline.html#434595110">(Apr 21 2024 at 15:02)</a>:</h4>
<p>I think that would be a better way to delay introducing error handling</p>



<a name="434595160"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/Stdin.line/near/434595160" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/Stdin.2Eline.html#434595160">(Apr 21 2024 at 15:03)</a>:</h4>
<p>Stdout.line also should really return an error. Currently I think every call to stdout in basic CLI has 2 different ways to panic in rust. That is bad ux. Random crashes that the roc developer can't control.</p>



<a name="434595238"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/Stdin.line/near/434595238" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/Stdin.2Eline.html#434595238">(Apr 21 2024 at 15:04)</a>:</h4>
<p>We don't have some form of try catch for platform panics. So any errors not given to roc are either fatal or silent without any way to change that from within roc.</p>



<a name="434595511"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/Stdin.line/near/434595511" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/Stdin.2Eline.html#434595511">(Apr 21 2024 at 15:08)</a>:</h4>
<p><span aria-label="thinking" class="emoji emoji-1f914" role="img" title="thinking">:thinking:</span> why would that be true of <code>Stdin.line</code> but not <code>Stdout.line</code>?</p>



<a name="434595529"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/Stdin.line/near/434595529" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/Stdin.2Eline.html#434595529">(Apr 21 2024 at 15:08)</a>:</h4>
<p>(which can also fail)</p>



<a name="434595584"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/Stdin.line/near/434595584" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/Stdin.2Eline.html#434595584">(Apr 21 2024 at 15:09)</a>:</h4>
<p>It's true for both</p>



<a name="434595590"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/Stdin.line/near/434595590" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/Stdin.2Eline.html#434595590">(Apr 21 2024 at 15:09)</a>:</h4>
<p>I think both should return errors to roc</p>



<a name="434595598"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/Stdin.line/near/434595598" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/Stdin.2Eline.html#434595598">(Apr 21 2024 at 15:09)</a>:</h4>
<p><code>!</code> lets you easily ignore them for the most part</p>



<a name="434595613"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/Stdin.line/near/434595613" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/Stdin.2Eline.html#434595613">(Apr 21 2024 at 15:09)</a>:</h4>
<p>So the main code will still read just like a imperative program</p>



<a name="434595621"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/Stdin.line/near/434595621" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/Stdin.2Eline.html#434595621">(Apr 21 2024 at 15:09)</a>:</h4>
<p>Just will accumulate the errors.</p>



<a name="434595688"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/Stdin.line/near/434595688" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/Stdin.2Eline.html#434595688">(Apr 21 2024 at 15:10)</a>:</h4>
<p>ok so what does hello world in Roc look like in that world?</p>



<a name="434595702"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/Stdin.line/near/434595702" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/Stdin.2Eline.html#434595702">(Apr 21 2024 at 15:10)</a>:</h4>
<div class="codehilite" data-code-language="Elixir"><pre><span></span><code><span class="n">main</span><span class="w"> </span><span class="o">=</span>
<span class="w">    </span><span class="nc">Stdout</span><span class="o">.</span><span class="n">line!</span><span class="w"> </span><span class="s2">"Type something and press Enter."</span>
<span class="w">    </span><span class="n">input</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">Stdin</span><span class="o">.</span><span class="n">line!</span>
<span class="w">    </span><span class="nc">Stdout</span><span class="o">.</span><span class="n">line!</span><span class="w"> </span><span class="s2">"You entered: $(input)"</span>
</code></pre></div>



<a name="434595722"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/Stdin.line/near/434595722" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/Stdin.2Eline.html#434595722">(Apr 21 2024 at 15:11)</a>:</h4>
<p>that's a type mismatch because the errors aren't handled</p>



<a name="434595733"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/Stdin.line/near/434595733" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/Stdin.2Eline.html#434595733">(Apr 21 2024 at 15:11)</a>:</h4>
<p>Nope...one sec</p>



<a name="434595974"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/Stdin.line/near/434595974" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/Stdin.2Eline.html#434595974">(Apr 21 2024 at 15:14)</a>:</h4>
<div class="codehilite" data-code-language="Elixir"><pre><span></span><code><span class="n">mainForHost</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="nc">Task</span><span class="w"> </span><span class="p">{}</span><span class="w"> </span><span class="p">[]</span><span class="w"> </span><span class="n">as</span><span class="w"> </span><span class="nc">Fx</span>
<span class="n">mainForHost</span><span class="w"> </span><span class="o">=</span>
<span class="w">    </span><span class="n">res</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">main</span><span class="w"> </span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Task</span><span class="o">.</span><span class="n">result!</span>
<span class="w">    </span><span class="ow">when</span><span class="w"> </span><span class="n">res</span><span class="w"> </span><span class="n">is</span>
<span class="w">        </span><span class="nc">Ok</span><span class="w"> </span><span class="p">{}</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="nc">Task</span><span class="o">.</span><span class="n">ok</span><span class="w"> </span><span class="p">{}</span>
<span class="w">        </span><span class="nc">Err</span><span class="w"> </span><span class="n">e</span><span class="w"> </span><span class="o">-&gt;</span>
<span class="w">            </span><span class="c1"># This could call an unsafe stderr and exit, or just use crash, or etc</span>
<span class="w">            </span><span class="n">crash</span><span class="w"> </span><span class="s2">"Program exited with error: $(Inspect.toStr e)"</span>
</code></pre></div>



<a name="434596017"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/Stdin.line/near/434596017" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/Stdin.2Eline.html#434596017">(Apr 21 2024 at 15:15)</a>:</h4>
<p>So main can return any sort of error to basic cli and it will print out an crash.</p>



<a name="434596066"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/Stdin.line/near/434596066" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/Stdin.2Eline.html#434596066">(Apr 21 2024 at 15:16)</a>:</h4>
<p>Of course, main can also choose to send no errors. In that case, it can handle there errors in a nicer way</p>



<a name="434596083"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/Stdin.line/near/434596083" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/Stdin.2Eline.html#434596083">(Apr 21 2024 at 15:16)</a>:</h4>
<p>Now everything in main has the choice to use <code>!</code> and never think about error handling if wanted</p>



<a name="434596237"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/Stdin.line/near/434596237" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/Stdin.2Eline.html#434596237">(Apr 21 2024 at 15:19)</a>:</h4>
<p>Then we can have:</p>
<div class="codehilite"><pre><span></span><code>Stdout.line: Str -&gt; Task {} [StdoutClosed]
Stderr.line: Str -&gt; Task {} [StderrClosed]
Stdin.line: Task Str [StdinClosed, StdinEndOfStream]
</code></pre></div>
<p>And the end user can just write your original program with <code>!</code>.<br>
Instead of maybe getting some random rust panic, They would get a roc crash (we can pick the exact behaviour) with the message: <code>Program exited with error: StdinEndOfStream</code>.</p>



<a name="434596242"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/Stdin.line/near/434596242" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/Stdin.2Eline.html#434596242">(Apr 21 2024 at 15:19)</a>:</h4>
<p>ahh right, I remember this design!</p>



<a name="434596257"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/Stdin.line/near/434596257" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/Stdin.2Eline.html#434596257">(Apr 21 2024 at 15:19)</a>:</h4>
<p>we talked about it once, but we didn't have <code>Inspect</code> back then</p>



<a name="434596265"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/Stdin.line/near/434596265" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/Stdin.2Eline.html#434596265">(Apr 21 2024 at 15:19)</a>:</h4>
<p>so now it seems more viable <span aria-label="+1" class="emoji emoji-1f44d" role="img" title="+1">:+1:</span></p>



<a name="434596462"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/Stdin.line/near/434596462" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/Stdin.2Eline.html#434596462">(Apr 21 2024 at 15:22)</a>:</h4>
<p>and then if you want to guarantee you've handled all the errors in your application, all you have to do is to add this type annotation to your <code>main</code>:</p>
<div class="codehilite" data-code-language="Elm"><pre><span></span><code><span class="kr">main </span><span class="nf">:</span><span class="w"> </span><span class="kt">Task</span><span class="w"> </span><span class="p">{}</span><span class="w"> </span><span class="p">[]</span>
</code></pre></div>



<a name="434596476"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/Stdin.line/near/434596476" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/Stdin.2Eline.html#434596476">(Apr 21 2024 at 15:23)</a>:</h4>
<p>and then you'll get a type mismatch if any are unhandled</p>



<a name="434596570"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/Stdin.line/near/434596570" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/Stdin.2Eline.html#434596570">(Apr 21 2024 at 15:24)</a>:</h4>
<p>but if you leave off the annotation (e.g. in tutorials) or annotate it as <code>main : Task {} _</code> then it will work</p>



<a name="434596582"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/Stdin.line/near/434596582" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/Stdin.2Eline.html#434596582">(Apr 21 2024 at 15:24)</a>:</h4>
<p>hm, but in that design how do you specify exit code? <span aria-label="thinking" class="emoji emoji-1f914" role="img" title="thinking">:thinking:</span></p>



<a name="434596590"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/Stdin.line/near/434596590" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/Stdin.2Eline.html#434596590">(Apr 21 2024 at 15:24)</a>:</h4>
<p>personally, I would pull the <code>I32</code> out of the api and require calling <code>Program.exit exitCode</code> or something during the error handling.</p>



<a name="434596601"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/Stdin.line/near/434596601" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/Stdin.2Eline.html#434596601">(Apr 21 2024 at 15:24)</a>:</h4>
<p>If you use the default handling, it could just exit with an exit code of <code>1</code></p>



<a name="434596697"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/Stdin.line/near/434596697" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/Stdin.2Eline.html#434596697">(Apr 21 2024 at 15:26)</a>:</h4>
<p>That said, totally could still leave the exit code in if wanted. I just removed it as personal preference.</p>



<a name="434596714"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/Stdin.line/near/434596714" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/Stdin.2Eline.html#434596714">(Apr 21 2024 at 15:26)</a>:</h4>
<div class="codehilite" data-code-language="Elixir"><pre><span></span><code><span class="n">mainForHost</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="nc">Task</span><span class="w"> </span><span class="nc">I32</span><span class="w"> </span><span class="p">[]</span><span class="w"> </span><span class="n">as</span><span class="w"> </span><span class="nc">Fx</span>
<span class="n">mainForHost</span><span class="w"> </span><span class="o">=</span>
<span class="w">    </span><span class="n">res</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">main</span><span class="w"> </span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Task</span><span class="o">.</span><span class="n">result!</span>
<span class="w">    </span><span class="ow">when</span><span class="w"> </span><span class="n">res</span><span class="w"> </span><span class="n">is</span>
<span class="w">        </span><span class="nc">Ok</span><span class="w"> </span><span class="n">exitCode</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="nc">Task</span><span class="o">.</span><span class="n">ok</span><span class="w"> </span><span class="n">exitCode</span>
<span class="w">        </span><span class="nc">Err</span><span class="w"> </span><span class="n">e</span><span class="w"> </span><span class="o">-&gt;</span>
<span class="w">            </span><span class="nc">Stderr</span><span class="o">.</span><span class="n">lineUnchecked!</span><span class="w"> </span><span class="s2">"Program exited with error: $(Inspect.toStr e)"</span>
<span class="w">            </span><span class="nc">Task</span><span class="o">.</span><span class="n">ok</span><span class="w"> </span><span class="mi">1</span>
</code></pre></div>



<a name="434597083"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/Stdin.line/near/434597083" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/Stdin.2Eline.html#434597083">(Apr 21 2024 at 15:33)</a>:</h4>
<p>actually something we could do is have the platform accept this:</p>
<p><code>Task {} [Exit I32]*</code></p>



<a name="434597144"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/Stdin.line/near/434597144" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/Stdin.2Eline.html#434597144">(Apr 21 2024 at 15:34)</a>:</h4>
<p>That is much nicer</p>



<a name="434597148"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/Stdin.line/near/434597148" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/Stdin.2Eline.html#434597148">(Apr 21 2024 at 15:34)</a>:</h4>
<p>so if you return <code>Task.err (Exit 1)</code> then it exits with that code (just like today) but all other errors get handled in the default way</p>



<a name="434597169"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/Stdin.line/near/434597169" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/Stdin.2Eline.html#434597169">(Apr 21 2024 at 15:34)</a>:</h4>
<p>this design also makes basic-cli nicer for scripting in general!</p>



<a name="434597198"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/Stdin.line/near/434597198" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/Stdin.2Eline.html#434597198">(Apr 21 2024 at 15:35)</a>:</h4>
<p>means by default you get the "bail out on error" behavior, but you can easily opt into any amount of granular error handling and guarantees you like</p>



<a name="434597561"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/Stdin.line/near/434597561" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/Stdin.2Eline.html#434597561">(Apr 21 2024 at 15:40)</a>:</h4>
<p>I like not having <code>exit</code> as a <code>Task</code> because it affects control flow in a way that's otherwise reserved for <code>crash</code></p>



<a name="434597591"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/Stdin.line/near/434597591" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/Stdin.2Eline.html#434597591">(Apr 21 2024 at 15:41)</a>:</h4>
<p>I can't name a concrete downside of that, but it feels like an invariant that shouldn't be broken lightly</p>



<a name="434597681"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/Stdin.line/near/434597681" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/Stdin.2Eline.html#434597681">(Apr 21 2024 at 15:42)</a>:</h4>
<p>so I like leaving it out of the API if we can get away with it <span aria-label="big smile" class="emoji emoji-1f604" role="img" title="big smile">:big_smile:</span></p>



<a name="434597852"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/Stdin.line/near/434597852" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/Stdin.2Eline.html#434597852">(Apr 21 2024 at 15:45)</a>:</h4>
<p>ok I'm game to try this design out!</p>



<a name="434598978"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/Stdin.line/near/434598978" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Agus Zubiaga <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/Stdin.2Eline.html#434598978">(Apr 21 2024 at 15:57)</a>:</h4>
<p>This sounds perfect for basic-cli!</p>



<a name="434601915"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/Stdin.line/near/434601915" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/Stdin.2Eline.html#434601915">(Apr 21 2024 at 16:31)</a>:</h4>
<p>Let's do it</p>



<a name="434610077"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/Stdin.line/near/434610077" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/Stdin.2Eline.html#434610077">(Apr 21 2024 at 18:41)</a>:</h4>
<p>I should have some time today to work in this change for basic-cli and to update the examples.</p>



<a name="434611291"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/Stdin.line/near/434611291" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/Stdin.2Eline.html#434611291">(Apr 21 2024 at 18:59)</a>:</h4>
<p>Ah, inconvenient place for this module imports bug to appear... I might have to hack something to get it to work.</p>
<div class="codehilite"><pre><span></span><code>── MODULE NOT IMPORTED in examples/../platform/main.roc ────────────────────────

The `Stderr` module is not imported:

33│                  Stderr.line! &quot;Program exited with error: $(Inspect.toStr e)&quot;
                                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

Did you mean to import it?

────────────────────────────────────────────────────────────────────────────────

1 error and 2 warnings found in 23 ms
</code></pre></div>



<a name="434612098"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/Stdin.line/near/434612098" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/Stdin.2Eline.html#434612098">(Apr 21 2024 at 19:11)</a>:</h4>
<p>Maybe can manually wrap/call the effect?</p>
<p>Will have to be different from the regular <code>Stderr.line</code> anyway since you want to avoid errors.<br>
And the new <code>Stderr.line</code> will have an error case <code>[StderrClosed]</code></p>



<a name="434617881"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/Stdin.line/near/434617881" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/Stdin.2Eline.html#434617881">(Apr 21 2024 at 20:41)</a>:</h4>
<p>Yeah, been playing with that... this bug is a bit nebulous and is proving hard to work around. I'm leaning towards just leaving the "print error" part out for a few days and we can add it back when Agus' PR lands which resolves this specific issue I think.</p>



<a name="434618166"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/Stdin.line/near/434618166" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/Stdin.2Eline.html#434618166">(Apr 21 2024 at 20:45)</a>:</h4>
<p>yeah can just use <code>crash</code> for now</p>



<a name="434618230"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/Stdin.line/near/434618230" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/Stdin.2Eline.html#434618230">(Apr 21 2024 at 20:46)</a>:</h4>
<p>The other wrinkle, is that to use <code>!</code> we need to have <code>Task</code> imported in the app. </p>
<p>But if it's just <code>main = Stdout.line! "Hello, World!"</code> we get <code>**UNUSED IMPORT**:  Nothing from **Task** is used in this module</code> which is a different incantation of the same bug.</p>



<a name="434618288"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/Stdin.line/near/434618288" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/Stdin.2Eline.html#434618288">(Apr 21 2024 at 20:47)</a>:</h4>
<p>Well, at least that this only a Warning so it still runs</p>



<a name="434618380"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/Stdin.line/near/434618380" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/Stdin.2Eline.html#434618380">(Apr 21 2024 at 20:48)</a>:</h4>
<p>But other than a stray Warning, it's working ok.</p>
<p>I'll update the examples.</p>
<p>We can clean it up later to have the nicer <code>Inspect</code> printing.</p>



<a name="434618386"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/Stdin.line/near/434618386" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/Stdin.2Eline.html#434618386">(Apr 21 2024 at 20:48)</a>:</h4>
<p>oh that's funny - it's actually not a bug</p>



<a name="434618414"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/Stdin.line/near/434618414" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/Stdin.2Eline.html#434618414">(Apr 21 2024 at 20:49)</a>:</h4>
<p>Well, I guess we need builtin Task before we can resolve that</p>



<a name="434618428"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/Stdin.line/near/434618428" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/Stdin.2Eline.html#434618428">(Apr 21 2024 at 20:49)</a>:</h4>
<p>in the sense that if the only uses of <code>!</code> are trailing (which desugar to nothing) then after desugaring there really is no use of Task in the module</p>



<a name="434618442"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/Stdin.line/near/434618442" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/Stdin.2Eline.html#434618442">(Apr 21 2024 at 20:49)</a>:</h4>
<p>yeah task as builtin takes care of that nicely</p>



<a name="434618529"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/Stdin.line/near/434618529" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/Stdin.2Eline.html#434618529">(Apr 21 2024 at 20:50)</a>:</h4>
<p>For the short term (like next 24hours) experience, users may get an unused warning in the specific case where they dont use anything from Task in thier app.</p>



<a name="434618543"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/Stdin.line/near/434618543" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/Stdin.2Eline.html#434618543">(Apr 21 2024 at 20:51)</a>:</h4>
<p>yeah which seems fine</p>



<a name="434621256"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/Stdin.line/near/434621256" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/Stdin.2Eline.html#434621256">(Apr 21 2024 at 21:40)</a>:</h4>
<p><a href="https://github.com/roc-lang/basic-cli/pull/184">https://github.com/roc-lang/basic-cli/pull/184</a></p>



<a name="434621287"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/Stdin.line/near/434621287" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/Stdin.2Eline.html#434621287">(Apr 21 2024 at 21:41)</a>:</h4>
<p>^^ PR for the basic-cli changes... will require tomorrow's nightly to pass CI.</p>



<a name="434621299"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/Stdin.line/near/434621299" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/Stdin.2Eline.html#434621299">(Apr 21 2024 at 21:41)</a>:</h4>
<p>Looks like there may be another issue too, so I'll plug away at it until I'm reasonably confident it's just waiting on nightly for Anton</p>



<a name="434621315"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/Stdin.line/near/434621315" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/Stdin.2Eline.html#434621315">(Apr 21 2024 at 21:41)</a>:</h4>
<p>I'll also have a crack at our <a href="https://github.com/roc-lang/examples">https://github.com/roc-lang/examples</a></p>



<a name="434630887"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/Stdin.line/near/434630887" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> drew <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/Stdin.2Eline.html#434630887">(Apr 22 2024 at 00:36)</a>:</h4>
<p>Wait, so is <code>!</code> already released?</p>



<a name="434630972"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/Stdin.line/near/434630972" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/Stdin.2Eline.html#434630972">(Apr 22 2024 at 00:38)</a>:</h4>
<p>yeah, you can use it right now!</p>



<a name="434630997"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/Stdin.line/near/434630997" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/Stdin.2Eline.html#434630997">(Apr 22 2024 at 00:38)</a>:</h4>
<p>the benefits of all-nightly releases <span aria-label="grinning face with smiling eyes" class="emoji emoji-1f601" role="img" title="grinning face with smiling eyes">:grinning_face_with_smiling_eyes:</span></p>



<a name="434631007"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/Stdin.line/near/434631007" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/Stdin.2Eline.html#434631007">(Apr 22 2024 at 00:38)</a>:</h4>
<p>no need to wait for a "stable" release if we don't have them <span aria-label="laughing" class="emoji emoji-1f606" role="img" title="laughing">:laughing:</span></p>



<a name="434631066"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/Stdin.line/near/434631066" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/Stdin.2Eline.html#434631066">(Apr 22 2024 at 00:39)</a>:</h4>
<p><span class="user-mention silent" data-user-id="463085">drew</span> <a href="#narrow/stream/383402-API-Design/topic/Stdin.2Eline/near/434630887">said</a>:</p>
<blockquote>
<p>Wait, so is <code>!</code> already released?</p>
</blockquote>
<p>I updated the <code>roc-wasm4</code> examples... it looks awesome with <code>!</code> suffix <span aria-label="hearts" class="emoji emoji-2665" role="img" title="hearts">:hearts:</span> <a href="https://github.com/lukewilliamboswell/roc-wasm4/blob/main/examples/rocci-bird.roc#L36">https://github.com/lukewilliamboswell/roc-wasm4/blob/main/examples/rocci-bird.roc#L36</a></p>



<a name="434631184"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/Stdin.line/near/434631184" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/Stdin.2Eline.html#434631184">(Apr 22 2024 at 00:41)</a>:</h4>
<p>The other platform that will be nice boost with the <code>!</code> syntax is <a href="https://github.com/lukewilliamboswell/roc-ray">roc-ray</a> for drawing graphics etc. Looking forward to upgrading to zig-12 with that too.</p>



<a name="434631316"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/Stdin.line/near/434631316" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/Stdin.2Eline.html#434631316">(Apr 22 2024 at 00:42)</a>:</h4>
<p>And I should probably make an actual release for macos/linux so people can use from just a URL. I was thinking it might be possible to do that using GH Actions somehow... I've never looked at that before, but it's just running <code>zig build</code> on the different arch's and then packaging up the <code>.a</code> files with the roc platform files.</p>



<a name="434631607"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/Stdin.line/near/434631607" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> drew <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/Stdin.2Eline.html#434631607">(Apr 22 2024 at 00:47)</a>:</h4>
<p>also fwiw strong agree that <code>Stdin.line</code> shouldn’t return a tagged type. the benefits don’t outweigh the costs imo. i was very confused when i randomly saw this API two days ago.</p>



<a name="434631684"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/Stdin.line/near/434631684" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/Stdin.2Eline.html#434631684">(Apr 22 2024 at 00:48)</a>:</h4>
<p>Yeah, I just changed it in <br>
<a href="https://github.com/roc-lang/basic-cli/pull/184">https://github.com/roc-lang/basic-cli/pull/184</a></p>
<p>to <code>Stdin.line : Task Str [End]</code></p>



<a name="434631991"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/Stdin.line/near/434631991" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/Stdin.2Eline.html#434631991">(Apr 22 2024 at 00:53)</a>:</h4>
<p>instead of just <code>End</code>, we should probably make a type alias for <code>StdinErr : [IoErr, Oom, End]</code> (we can add more later)</p>



<a name="434632001"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/Stdin.line/near/434632001" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> drew <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/Stdin.2Eline.html#434632001">(Apr 22 2024 at 00:53)</a>:</h4>
<p>how are task errors handled?</p>



<a name="434632003"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/Stdin.line/near/434632003" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/Stdin.2Eline.html#434632003">(Apr 22 2024 at 00:53)</a>:</h4>
<p>and have it be <code>Task Str [StdinErr StdinErr]</code></p>



<a name="434632009"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/Stdin.line/near/434632009" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> drew <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/Stdin.2Eline.html#434632009">(Apr 22 2024 at 00:53)</a>:</h4>
<p>can you simply ignore them?</p>



<a name="434632017"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/Stdin.line/near/434632017" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/Stdin.2Eline.html#434632017">(Apr 22 2024 at 00:53)</a>:</h4>
<p>essentially yeah</p>



<a name="434632084"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/Stdin.line/near/434632084" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> drew <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/Stdin.2Eline.html#434632084">(Apr 22 2024 at 00:54)</a>:</h4>
<p>but can opt in to handling, i suppose, and then it is exhastive</p>



<a name="434632105"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/Stdin.line/near/434632105" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/Stdin.2Eline.html#434632105">(Apr 22 2024 at 00:54)</a>:</h4>
<p>right, give or take the OS introducing new types of errors that Roc doesn't know about yet <span aria-label="laughing" class="emoji emoji-1f606" role="img" title="laughing">:laughing:</span></p>



<a name="434632133"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/Stdin.line/near/434632133" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> drew <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/Stdin.2Eline.html#434632133">(Apr 22 2024 at 00:55)</a>:</h4>
<p>nice</p>



<a name="434632141"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/Stdin.line/near/434632141" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> drew <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/Stdin.2Eline.html#434632141">(Apr 22 2024 at 00:55)</a>:</h4>
<p>seems like a good compromise</p>



<a name="434633382"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/Stdin.line/near/434633382" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/Stdin.2Eline.html#434633382">(Apr 22 2024 at 01:15)</a>:</h4>
<p>Made an issue <a href="https://github.com/roc-lang/basic-cli/issues/185">https://github.com/roc-lang/basic-cli/issues/185</a> to track this.</p>



<a name="434643543"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/Stdin.line/near/434643543" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/Stdin.2Eline.html#434643543">(Apr 22 2024 at 03:31)</a>:</h4>
<p>speaking of updates, while working on the tutorial I noticed something awkward: if <code>Stderr.line</code> can error, then gracefully handling errors (e.g. by printing a message to stderr and then doing an <code>Exit</code>) becomes pretty cumbersome because you have to do like <code>Stderr.line "Error writing to stdout" |&gt; Task.onErr! \_ -&gt; Task.ok {}</code></p>



<a name="434643548"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/Stdin.line/near/434643548" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/Stdin.2Eline.html#434643548">(Apr 22 2024 at 03:31)</a>:</h4>
<p>what if instead we made it be <code>Exit I32 Str</code>?</p>



<a name="434643619"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/Stdin.line/near/434643619" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/Stdin.2Eline.html#434643619">(Apr 22 2024 at 03:32)</a>:</h4>
<p>and then the platform prints that <code>Str</code> to stderr, while automatically disregarding any errors ("if stderr is broken, you just don't get any output, sorry")</p>



<a name="434643666"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/Stdin.line/near/434643666" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/Stdin.2Eline.html#434643666">(Apr 22 2024 at 03:33)</a>:</h4>
<p>that's also nice in that it makes the errors even more concise to handle, because you can just say:</p>
<div class="codehilite" data-code-language="Elm"><pre><span></span><code><span class="kt">Exit</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="s">"Error writing to stdout"</span>
</code></pre></div>



<a name="434643679"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/Stdin.line/near/434643679" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/Stdin.2Eline.html#434643679">(Apr 22 2024 at 03:33)</a>:</h4>
<p>instead of needing two lines, one of which is always a <code>Stderr.line!</code></p>



<a name="434643735"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/Stdin.line/near/434643735" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/Stdin.2Eline.html#434643735">(Apr 22 2024 at 03:34)</a>:</h4>
<p>also makes it harder to make the mistake of using stdout (by force of habit) instead of stderr for error reporting <span aria-label="big smile" class="emoji emoji-1f604" role="img" title="big smile">:big_smile:</span></p>



<a name="434645053"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/Stdin.line/near/434645053" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Isaac Van Doren <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/Stdin.2Eline.html#434645053">(Apr 22 2024 at 03:53)</a>:</h4>
<p>That sounds nice!</p>



<a name="434645149"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/Stdin.line/near/434645149" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Isaac Van Doren <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/Stdin.2Eline.html#434645149">(Apr 22 2024 at 03:54)</a>:</h4>
<p>I wonder if it would be confusing that if you do <code>Exit 0 "success!"</code> the message would print to stderr. The message could print to stdout if the exit code is 0, but that might encourage people to use the tag instead of just using <code>Stdout.line</code>.</p>



<a name="434645660"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/Stdin.line/near/434645660" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/Stdin.2Eline.html#434645660">(Apr 22 2024 at 04:00)</a>:</h4>
<p>yeah that's probably fine</p>



<a name="434645669"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/Stdin.line/near/434645669" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/Stdin.2Eline.html#434645669">(Apr 22 2024 at 04:00)</a>:</h4>
<p>doing stdout for 0 makes sense to me <span aria-label="thumbs up" class="emoji emoji-1f44d" role="img" title="thumbs up">:thumbs_up:</span></p>



<a name="434646240"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/Stdin.line/near/434646240" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/Stdin.2Eline.html#434646240">(Apr 22 2024 at 04:07)</a>:</h4>
<p>I guess a counterargument would be that it's a weird edge case you could trip over, and maybe you'd want to use <code>Exit 0 "Warning: ..."</code> if you were translating an error into a warning and didn't want to change the exit code</p>



<a name="434646517"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/Stdin.line/near/434646517" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/Stdin.2Eline.html#434646517">(Apr 22 2024 at 04:11)</a>:</h4>
<p>I think it should always print to stderr with <code>Exit</code></p>



<a name="434646587"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/Stdin.line/near/434646587" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/Stdin.2Eline.html#434646587">(Apr 22 2024 at 04:12)</a>:</h4>
<p>stderr tends to also be used for status updates and terminal outputs for pipelined applications</p>



<a name="434646607"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/Stdin.line/near/434646607" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/Stdin.2Eline.html#434646607">(Apr 22 2024 at 04:12)</a>:</h4>
<p>I'm not really following, <code>Stderr.line</code> cant throw an error right now. Are we wanting to update the <a href="https://github.com/roc-lang/basic-cli/blob/86baa48085cab051a11c165264d089a01d135265/platform/src/lib.rs#L392">rust impl</a> to return an error somehow?</p>



<a name="434646758"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/Stdin.line/near/434646758" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/Stdin.2Eline.html#434646758">(Apr 22 2024 at 04:14)</a>:</h4>
<p>yeah. <code>eprintln!</code> just crashes on errror</p>



<a name="434646760"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/Stdin.line/near/434646760" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/Stdin.2Eline.html#434646760">(Apr 22 2024 at 04:14)</a>:</h4>
<p>I guess we could handle this </p>
<div class="codehilite"><pre><span></span><code>Panics if writing to io::stderr fails.

Writing to non-blocking stderr can cause an error, which will lead this macro to panic.
</code></pre></div>



<a name="434646789"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/Stdin.line/near/434646789" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/Stdin.2Eline.html#434646789">(Apr 22 2024 at 04:14)</a>:</h4>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="kd">let</span><span class="w"> </span><span class="n">stderr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">io</span>::<span class="n">stderr</span><span class="p">();</span>
<span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">handle</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">stderr</span><span class="p">.</span><span class="n">lock</span><span class="p">();</span>

<span class="kd">let</span><span class="w"> </span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">handle</span><span class="p">.</span><span class="n">write_all</span><span class="p">(</span><span class="s">b"hello world"</span><span class="p">);</span>
</code></pre></div>



<a name="434646823"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/Stdin.line/near/434646823" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/Stdin.2Eline.html#434646823">(Apr 22 2024 at 04:15)</a>:</h4>
<p>yeah exactly <span aria-label="100" class="emoji emoji-1f4af" role="img" title="100">:100:</span></p>



<a name="434646855"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/Stdin.line/near/434646855" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/Stdin.2Eline.html#434646855">(Apr 22 2024 at 04:15)</a>:</h4>
<p>in general, writing to a file descriptor can fail in various ways</p>



<a name="434646872"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/Stdin.line/near/434646872" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/Stdin.2Eline.html#434646872">(Apr 22 2024 at 04:15)</a>:</h4>
<p>and writing to stdout and to stderr is just writing data to a file descriptor</p>



<a name="434646901"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/Stdin.line/near/434646901" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/Stdin.2Eline.html#434646901">(Apr 22 2024 at 04:16)</a>:</h4>
<p>not all of those possible failure modes apply to stdout and stderr, but plenty of them do!</p>



<a name="434646974"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/Stdin.line/near/434646974" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/Stdin.2Eline.html#434646974">(Apr 22 2024 at 04:16)</a>:</h4>
<p>so in this new design, I think we should have <code>Stdin.line</code>, <code>Stdout.line</code>, and <code>Stderr.line</code> all have errors</p>



<a name="434647128"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/Stdin.line/near/434647128" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/Stdin.2Eline.html#434647128">(Apr 22 2024 at 04:18)</a>:</h4>
<p>Also, lets please make sure to either make them wrapping or descriptive of the filed descriptor they come from. <code>End</code> alone is quite unclear. <code>Stderr End</code> is much much more useful.</p>



<a name="434647144"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/Stdin.line/near/434647144" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/Stdin.2Eline.html#434647144">(Apr 22 2024 at 04:18)</a>:</h4>
<p>I'd like to try out the convention of naming those errors <code>Err</code> and just always fully qualifying them:</p>
<div class="codehilite" data-code-language="Haskell"><pre><span></span><code><span class="kt">Stdout</span><span class="o">.</span><span class="n">line</span><span class="w"> </span><span class="kt">:</span><span class="w"> </span><span class="kt">Str</span><span class="w"> </span><span class="ow">-&gt;</span><span class="w"> </span><span class="kt">Task</span><span class="w"> </span><span class="p">{}</span><span class="w"> </span><span class="p">[</span><span class="kt">StdoutErr</span><span class="w"> </span><span class="kt">Stdout</span><span class="o">.</span><span class="kt">Err</span><span class="p">]</span>
</code></pre></div>
<div class="codehilite" data-code-language="Haskell"><pre><span></span><code><span class="kt">Stderr</span><span class="o">.</span><span class="n">line</span><span class="w"> </span><span class="kt">:</span><span class="w"> </span><span class="kt">Str</span><span class="w"> </span><span class="ow">-&gt;</span><span class="w"> </span><span class="kt">Task</span><span class="w"> </span><span class="p">{}</span><span class="w"> </span><span class="p">[</span><span class="kt">StderrErr</span><span class="w"> </span><span class="kt">Stderr</span><span class="o">.</span><span class="kt">Err</span><span class="p">]</span>
</code></pre></div>
<div class="codehilite" data-code-language="Haskell"><pre><span></span><code><span class="kt">Stdin</span><span class="o">.</span><span class="n">line</span><span class="w"> </span><span class="kt">:</span><span class="w"> </span><span class="kt">Task</span><span class="w"> </span><span class="kt">Str</span><span class="w"> </span><span class="p">[</span><span class="kt">StdinErr</span><span class="w"> </span><span class="kt">Stdin</span><span class="o">.</span><span class="kt">Err</span><span class="p">]</span>
</code></pre></div>



<a name="434647178"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/Stdin.line/near/434647178" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/Stdin.2Eline.html#434647178">(Apr 22 2024 at 04:18)</a>:</h4>
<p>yeah I think <code>End</code> would be part of the <code>Stdin.Err</code> tag union in this design</p>



<a name="434647659"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/Stdin.line/near/434647659" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/Stdin.2Eline.html#434647659">(Apr 22 2024 at 04:23)</a>:</h4>
<p>Sounds great!</p>



<a name="434647730"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/Stdin.line/near/434647730" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/Stdin.2Eline.html#434647730">(Apr 22 2024 at 04:24)</a>:</h4>
<p>Though I guess it only works if everything in <code>Stdin</code> has the exact same <code>Err</code> type.</p>



<a name="434648150"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/Stdin.line/near/434648150" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/Stdin.2Eline.html#434648150">(Apr 22 2024 at 04:28)</a>:</h4>
<p>yeah I can't think of any cases where that wouldn't be true! <span aria-label="big smile" class="emoji emoji-1f604" role="img" title="big smile">:big_smile:</span></p>



<a name="434648594"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/Stdin.line/near/434648594" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/Stdin.2Eline.html#434648594">(Apr 22 2024 at 04:32)</a>:</h4>
<p>I thought file would be a case, but from discussion elsewhere, I guess everything is just io error there</p>



<a name="434649879"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/Stdin.line/near/434649879" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/Stdin.2Eline.html#434649879">(Apr 22 2024 at 04:46)</a>:</h4>
<p>Do we have any ideas around the specific errors here? Rust just has a big <code>std::io::ErrorKind</code> with lots of variants</p>



<a name="434649951"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/Stdin.line/near/434649951" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/Stdin.2Eline.html#434649951">(Apr 22 2024 at 04:47)</a>:</h4>
<p>So the updates I had been making were trending towards using that everywhere... but in the above API it looks like we want to tailor the tags for the specific function, and then maybe have an Other to catch the rest</p>



<a name="434649973"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/Stdin.line/near/434649973" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/Stdin.2Eline.html#434649973">(Apr 22 2024 at 04:47)</a>:</h4>
<p>yeah I think for now we can just put in a couple of them and add more later</p>



<a name="434650030"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/Stdin.line/near/434650030" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/Stdin.2Eline.html#434650030">(Apr 22 2024 at 04:48)</a>:</h4>
<p>the main thing is just switching over to the new "shape" if that makes sense</p>



<a name="434650082"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/Stdin.line/near/434650082" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/Stdin.2Eline.html#434650082">(Apr 22 2024 at 04:48)</a>:</h4>
<p>Also, I would like to use an <code>&lt;u8&gt;</code> for the error tag between rust and roc instead of generating glue for these if that's ok</p>



<a name="434650136"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/Stdin.line/near/434650136" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/Stdin.2Eline.html#434650136">(Apr 22 2024 at 04:49)</a>:</h4>
<p>It's just much simpler. Regenerating glue is very handraulic at the moment because it doesn't generate valid Rust and I have to manually fix things</p>



<a name="434650306"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/Stdin.line/near/434650306" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/Stdin.2Eline.html#434650306">(Apr 22 2024 at 04:51)</a>:</h4>
<p>So <code>stderrLine : Str -&gt; Effect (Result {} U8)</code> instead of  <code>stderrLine : Str -&gt; Effect (Result {} InternalStderrError)</code></p>



<a name="434650485"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/Stdin.line/near/434650485" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/Stdin.2Eline.html#434650485">(Apr 22 2024 at 04:52)</a>:</h4>
<p>as in just on the platform &lt;-&gt; host side?</p>



<a name="434650496"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/Stdin.line/near/434650496" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/Stdin.2Eline.html#434650496">(Apr 22 2024 at 04:52)</a>:</h4>
<p>not visible to application authors</p>



<a name="434650524"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/Stdin.line/near/434650524" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/Stdin.2Eline.html#434650524">(Apr 22 2024 at 04:53)</a>:</h4>
<p>correct</p>



<a name="434650578"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/Stdin.line/near/434650578" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/Stdin.2Eline.html#434650578">(Apr 22 2024 at 04:53)</a>:</h4>
<p>sure, seems reasonable! <span aria-label="thumbs up" class="emoji emoji-1f44d" role="img" title="thumbs up">:thumbs_up:</span></p>



<a name="434651048"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/Stdin.line/near/434651048" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/Stdin.2Eline.html#434651048">(Apr 22 2024 at 04:58)</a>:</h4>
<p>Actually I'm going to use a RocStr, so I can return a description of the error from Rust</p>



<hr><p>Last updated: Mar 01 2026 at 12:20 UTC</p>
</html>