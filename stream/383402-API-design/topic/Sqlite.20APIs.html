<html>
<head><meta charset="utf-8"><title>Sqlite APIs · API design · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/index.html">API design</a></h2>
<h3>Topic: <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/Sqlite.20APIs.html">Sqlite APIs</a></h3>

<hr>

<base href="https://roc.zulipchat.com">

<head><link href="https://roc-lang.github.io/zulip-export/style.css" rel="stylesheet"></head>

<a name="491677085"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/Sqlite%20APIs/near/491677085" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/Sqlite.20APIs.html#491677085">(Jan 02 2025 at 22:58)</a>:</h4>
<p>Ok, two more things that I still don't like with the sqlite api. Thought it would be good to get ideas here.</p>
<p>For a simple query, the sqlite api is pretty reasonable (if a bit much to learn at once):</p>
<div class="codehilite" data-code-language="Ruby"><pre><span></span><code><span class="no">Sqlite</span><span class="o">.</span><span class="n">query_many!</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="ss">path</span><span class="p">:</span><span class="w"> </span><span class="n">db_path</span><span class="p">,</span>
<span class="w">    </span><span class="ss">query</span><span class="p">:</span><span class="w"> </span><span class="s2">"SELECT id, task FROM todos WHERE status = :status;"</span><span class="p">,</span>
<span class="w">    </span><span class="ss">bindings</span><span class="p">:</span><span class="w"> </span><span class="o">[</span><span class="p">{</span><span class="w"> </span><span class="nb">name</span><span class="p">:</span><span class="w"> </span><span class="s2">":status"</span><span class="p">,</span><span class="w"> </span><span class="ss">value</span><span class="p">:</span><span class="w"> </span><span class="nb">String</span><span class="w"> </span><span class="s2">"completed"</span><span class="w"> </span><span class="p">}</span><span class="o">]</span><span class="p">,</span>
<span class="w">    </span><span class="ss">rows</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="no">Sqlite</span><span class="o">.</span><span class="n">decode_record</span><span class="w"> </span><span class="o">&lt;-</span>
<span class="w">        </span><span class="nb">id</span><span class="p">:</span><span class="w"> </span><span class="no">Sqlite</span><span class="o">.</span><span class="n">i64</span><span class="w"> </span><span class="s2">"id"</span><span class="p">,</span>
<span class="w">        </span><span class="ss">task</span><span class="p">:</span><span class="w"> </span><span class="no">Sqlite</span><span class="o">.</span><span class="n">str</span><span class="w"> </span><span class="s2">"task"</span><span class="p">,</span>
<span class="w">    </span><span class="p">},</span>
<span class="p">}</span>
</code></pre></div>
<p>This will grab all todos with a specific status. It will automatically decode them to a <code>Result (List { id: I64, task: Str }) _</code>. I think this api is reasonable enough.</p>
<p>I think the api is a lot less reasonable with prepared queries (<a href="https://github.com/roc-lang/basic-webserver/blob/main/examples/sqlite.roc">simple example</a>). The split of preparing the query and binding/decoding the result leads to a less understandable result:</p>
<div class="codehilite" data-code-language="Ruby"><pre><span></span><code><span class="n">init!</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">\{}</span><span class="w"> </span><span class="o">-&gt;</span>
<span class="w">    </span><span class="n">stmt</span><span class="w"> </span><span class="o">=</span>
<span class="w">        </span><span class="no">Sqlite</span><span class="o">.</span><span class="n">prepare!</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="ss">path</span><span class="p">:</span><span class="w"> </span><span class="n">db_path</span><span class="p">,</span>
<span class="w">            </span><span class="ss">query</span><span class="p">:</span><span class="w"> </span><span class="s2">"SELECT id, task FROM todos WHERE status = :status;"</span><span class="p">,</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="o">...</span>

<span class="n">actually_query!</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">\</span><span class="n">stmt</span><span class="w"> </span><span class="o">-&gt;</span>
<span class="w">    </span><span class="n">result</span><span class="w"> </span><span class="o">=</span>
<span class="w">        </span><span class="no">Sqlite</span><span class="o">.</span><span class="n">query_many_prepared!</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">stmt</span><span class="p">,</span>
<span class="w">            </span><span class="ss">bindings</span><span class="p">:</span><span class="w"> </span><span class="o">[</span><span class="p">{</span><span class="w"> </span><span class="nb">name</span><span class="p">:</span><span class="w"> </span><span class="s2">":status"</span><span class="p">,</span><span class="w"> </span><span class="ss">value</span><span class="p">:</span><span class="w"> </span><span class="nb">String</span><span class="w"> </span><span class="s2">"completed"</span><span class="w"> </span><span class="p">}</span><span class="o">]</span><span class="p">,</span>
<span class="w">            </span><span class="ss">rows</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="no">Sqlite</span><span class="o">.</span><span class="n">decode_record</span><span class="w"> </span><span class="o">&lt;-</span>
<span class="w">                </span><span class="nb">id</span><span class="p">:</span><span class="w"> </span><span class="no">Sqlite</span><span class="o">.</span><span class="n">i64</span><span class="w"> </span><span class="s2">"id"</span><span class="p">,</span>
<span class="w">                </span><span class="ss">task</span><span class="p">:</span><span class="w"> </span><span class="no">Sqlite</span><span class="o">.</span><span class="n">str</span><span class="w"> </span><span class="s2">"task"</span><span class="p">,</span>
<span class="w">            </span><span class="p">},</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="o">...</span>
</code></pre></div>
<p>Maybe the decoder should be specified when preparing the query? That said, there is still not a great link between the bound variables and the original query. The split definitely hurts understandability, but preparing queries is quite important for perf.</p>
<hr>
<p>Secondly, we don't have an api for transactions yet. And they really are not nice to do manually. If you want max perf, it requires adding <a href="https://github.com/roc-lang/basic-webserver/blob/c232429d4193330800d2dc00de4323d986c4bc25/examples/todos.roc#L28-L30">3 extra prepared stmts to your model</a> (begin, end, and rollback). On top of that, the <a href="https://github.com/roc-lang/basic-webserver/blob/c232429d4193330800d2dc00de4323d986c4bc25/examples/todos.roc#L137-L173">actual transaction logic</a> feels a bit inconvenient.</p>
<p>Part of the problem with designing an api for this is that you need to store a prepared query for begin, end, and rollback if you want max perf.</p>
<p>Not that max perf truly matters here, but I really want to design the api to always use prepared queries if possible.</p>
<hr>
<p>Anyway, open to any thoughts and suggestions. Just feel like the api isn't quite right yet.</p>



<a name="491679495"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/Sqlite%20APIs/near/491679495" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jasper Woudenberg <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/Sqlite.20APIs.html#491679495">(Jan 02 2025 at 23:24)</a>:</h4>
<p>I'm curious, why is <code>bindings</code> a list?</p>
<p>For the prepared statement problem, if you move the decoder into the prepared statement as you suggest, would it be possible to let <code>Sqlite.prepare!</code> return a function?</p>
<div class="codehilite"><pre><span></span><code>init! = \{} -&gt;
    query : { status: Str } =&gt; List { id: I64, task: Str }
    query =
        Sqlite.prepare! {
            path: db_path,
            query: &quot;SELECT id, task FROM todos WHERE status = :status;&quot;,
            bindings: \{ status } -&gt; [{ name: &quot;:status&quot;, value: status }],
            rows: { Sqlite.decode_record &lt;-
                id: Sqlite.i64 &quot;id&quot;,
                task: Sqlite.str &quot;task&quot;,
            },
        }
    ...

actually_query! = \stmt -&gt;
    result = query({ status: &quot;completed&quot; })
    ...
</code></pre></div>
<p>Then the type of the function becomes the prepared statement returns is self-explanatory, even without the SQL nearby.</p>



<a name="491679936"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/Sqlite%20APIs/near/491679936" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jasper Woudenberg <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/Sqlite.20APIs.html#491679936">(Jan 02 2025 at 23:28)</a>:</h4>
<p>Neat use of record builders BTW!</p>



<a name="491680036"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/Sqlite%20APIs/near/491680036" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Mohr <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/Sqlite.20APIs.html#491680036">(Jan 02 2025 at 23:29)</a>:</h4>
<p>That's <span class="user-mention" data-user-id="489294">@Agus Zubiaga</span> 's record building handiwork, he pioneered the feature in the first place</p>



<a name="491680465"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/Sqlite%20APIs/near/491680465" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/Sqlite.20APIs.html#491680465">(Jan 02 2025 at 23:33)</a>:</h4>
<blockquote>
<p>why is <code>bindings</code> a list?</p>
</blockquote>
<p>Simplicity</p>



<a name="491680618"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/Sqlite%20APIs/near/491680618" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/Sqlite.20APIs.html#491680618">(Jan 02 2025 at 23:35)</a>:</h4>
<p>I don't want a full query language in roc. Just want an sql string. As such, not sure the best way to do bindings.</p>
<p>Open for suggestions for that too. Only really has to be a list at the low level to pass to the platform (Though even that could get split into many separate bind calls technically)</p>



<a name="491680626"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/Sqlite%20APIs/near/491680626" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jasper Woudenberg <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/Sqlite.20APIs.html#491680626">(Jan 02 2025 at 23:35)</a>:</h4>
<p>For the transaction, maybe a similar thing is possible to the prepared statement is possible, where there is a <code>prepare_transaction</code>function to be called from init. <code>prepare_transaction</code> will immediately prepare the three transaction queries and subsequently return the function to create transactions in actual code.</p>



<a name="491681036"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/Sqlite%20APIs/near/491681036" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jasper Woudenberg <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/Sqlite.20APIs.html#491681036">(Jan 02 2025 at 23:40)</a>:</h4>
<p>Or, another idea, a single <code>Slite.setup</code> function to use in init:</p>
<div class="codehilite"><pre><span></span><code>init! = \{} -&gt;
    db : {
        transaction : {} =&gt; {},
        list_todos! : { status: Str } =&gt; List { id: I64, task: Str },
    }
    db = { Sqlite.setup! &lt;-
        transaction : Sqlite.prepare_transaction!,
        list_todos! : Sqlite.prepare! {
            path: db_path,
            query: &quot;SELECT id, task FROM todos WHERE status = :status;&quot;,
            bindings: \{ status } -&gt; [{ name: &quot;:status&quot;, value: status }],
            rows: { Sqlite.decode_record &lt;-
                id: Sqlite.i64 &quot;id&quot;,
                task: Sqlite.str &quot;task&quot;,
            },
        }
    }
    ...

actually_query! = \db -&gt;
    result = (db.list_todos) { status: &quot;completed&quot; }
    ...
</code></pre></div>



<a name="491681349"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/Sqlite%20APIs/near/491681349" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jasper Woudenberg <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/Sqlite.20APIs.html#491681349">(Jan 02 2025 at 23:43)</a>:</h4>
<p><span class="user-mention silent" data-user-id="343810">Brendan Hansknecht</span> <a href="#narrow/channel/383402-API-design/topic/Sqlite.20APIs/near/491680618">said</a>:</p>
<blockquote>
<p>I don't want a full query language in roc. Just want an sql string. As such, not sure the best way to do bindings.</p>
<p>Open for suggestions for that too. Only really has to be a list at the low level to pass to the platform (Though even that could get split into many separate bind calls technically)</p>
</blockquote>
<p>I like the straigt-forward binding between query and Roc code, that makes sense to me. In the example I notice the list just has a single element, a better way to phrase my question is when you would have multiple bindings in that list, or zero.</p>



<a name="491681435"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/Sqlite%20APIs/near/491681435" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/Sqlite.20APIs.html#491681435">(Jan 02 2025 at 23:44)</a>:</h4>
<p>It's based on the query. One per <code>:name</code> variable in the query.</p>



<a name="491681452"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/Sqlite%20APIs/near/491681452" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/Sqlite.20APIs.html#491681452">(Jan 02 2025 at 23:44)</a>:</h4>
<p>So select everything would have none</p>



<a name="491681466"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/Sqlite%20APIs/near/491681466" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/Sqlite.20APIs.html#491681466">(Jan 02 2025 at 23:44)</a>:</h4>
<p>Selecting with many conditions would have many</p>



<a name="491681508"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/Sqlite%20APIs/near/491681508" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jasper Woudenberg <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/Sqlite.20APIs.html#491681508">(Jan 02 2025 at 23:45)</a>:</h4>
<p>Ohhh, I didn't read that right. I thought there were multiple params in that record already, but it's key-value pairs. That explains it, thanks!</p>



<a name="491681793"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/Sqlite%20APIs/near/491681793" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/Sqlite.20APIs.html#491681793">(Jan 02 2025 at 23:48)</a>:</h4>
<p>Ah. Yeah, just kv pairs</p>



<a name="491682116"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/Sqlite%20APIs/near/491682116" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jasper Woudenberg <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/Sqlite.20APIs.html#491682116">(Jan 02 2025 at 23:53)</a>:</h4>
<p>Oh, that last idea with <code>Sqlite.setup!</code> doesn't make sense, if it's supposed to return a plain record. I guess the app author could opt put all their queries in a record, but they wouldn't need help from the library for that.</p>



<a name="491682244"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/Sqlite%20APIs/near/491682244" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/Sqlite.20APIs.html#491682244">(Jan 02 2025 at 23:54)</a>:</h4>
<p>That said, even your base idea for changes to prepare would solve the issues.</p>



<a name="491682305"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/Sqlite%20APIs/near/491682305" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/Sqlite.20APIs.html#491682305">(Jan 02 2025 at 23:55)</a>:</h4>
<p>And not sure if there is a better higher level solution for transactions but the simple solution may be enough.</p>



<a name="491682561"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/Sqlite%20APIs/near/491682561" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/Sqlite.20APIs.html#491682561">(Jan 02 2025 at 23:58)</a>:</h4>
<p>Just <code>prepare_transaction! : [ Deferred, Immediate, Exclusive ] =&gt; (higher level functions for running a lambda as a transaction)</code></p>



<a name="491682611"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/Sqlite%20APIs/near/491682611" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/Sqlite.20APIs.html#491682611">(Jan 02 2025 at 23:59)</a>:</h4>
<p>Then it would just be missing save points, but I think that is fine for now. Just keep it simple.</p>



<a name="491682721"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/Sqlite%20APIs/near/491682721" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/Sqlite.20APIs.html#491682721">(Jan 03 2025 at 00:00)</a>:</h4>
<p>I'll make this changes. Want to get the nicer API in before whenever we do the next release if possible.</p>



<a name="491682768"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/Sqlite%20APIs/near/491682768" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/Sqlite.20APIs.html#491682768">(Jan 03 2025 at 00:00)</a>:</h4>
<p>Also, let me know if there is a better alternative to bindings as a list you can think of.</p>



<a name="491687590"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/Sqlite%20APIs/near/491687590" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/Sqlite.20APIs.html#491687590">(Jan 03 2025 at 00:55)</a>:</h4>
<p>Thoughts for prepared queries. I think this reads a lot better overall.</p>
<div class="codehilite" data-code-language="Ruby"><pre><span></span><code><span class="n">main!</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">\</span><span class="n">_args</span><span class="w"> </span><span class="o">-&gt;</span>
<span class="w">    </span><span class="n">db_path</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">try</span><span class="w"> </span><span class="no">Env</span><span class="o">.</span><span class="n">var!</span><span class="w"> </span><span class="s2">"DB_PATH"</span>

<span class="w">    </span><span class="n">query_todos_by_status!</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">try</span><span class="w"> </span><span class="no">Sqlite</span><span class="o">.</span><span class="n">prepare_query_many!</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="ss">path</span><span class="p">:</span><span class="w"> </span><span class="n">db_path</span><span class="p">,</span>
<span class="w">        </span><span class="ss">query</span><span class="p">:</span><span class="w"> </span><span class="s2">"SELECT id, task FROM todos WHERE status = :status;"</span><span class="p">,</span>
<span class="w">        </span><span class="ss">bindings</span><span class="p">:</span><span class="w"> </span><span class="p">\</span><span class="n">status</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="o">[</span><span class="p">{</span><span class="w"> </span><span class="nb">name</span><span class="p">:</span><span class="w"> </span><span class="s2">":status"</span><span class="p">,</span><span class="w"> </span><span class="ss">value</span><span class="p">:</span><span class="w"> </span><span class="nb">String</span><span class="w"> </span><span class="n">status</span><span class="w"> </span><span class="p">}</span><span class="o">]</span><span class="p">,</span>
<span class="w">        </span><span class="ss">rows</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="no">Sqlite</span><span class="o">.</span><span class="n">decode_record</span><span class="w"> </span><span class="o">&lt;-</span>
<span class="w">            </span><span class="nb">id</span><span class="p">:</span><span class="w"> </span><span class="no">Sqlite</span><span class="o">.</span><span class="n">i64</span><span class="w"> </span><span class="s2">"id"</span><span class="w"> </span><span class="o">|&gt;</span><span class="w"> </span><span class="no">Sqlite</span><span class="o">.</span><span class="n">map_value</span><span class="w"> </span><span class="no">Num</span><span class="o">.</span><span class="n">toStr</span><span class="p">,</span>
<span class="w">            </span><span class="ss">task</span><span class="p">:</span><span class="w"> </span><span class="no">Sqlite</span><span class="o">.</span><span class="n">str</span><span class="w"> </span><span class="s2">"task"</span><span class="p">,</span>
<span class="w">        </span><span class="p">},</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="n">todo</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">try</span><span class="w"> </span><span class="n">query_todos_by_status!</span><span class="w"> </span><span class="s2">"todo"</span>

<span class="w">    </span><span class="n">try</span><span class="w"> </span><span class="no">Stdout</span><span class="o">.</span><span class="n">line!</span><span class="w"> </span><span class="s2">"Todo Tasks:"</span>
<span class="w">    </span><span class="n">try</span><span class="w"> </span><span class="no">List</span><span class="o">.</span><span class="n">forEachTry!</span><span class="w"> </span><span class="n">todo</span><span class="w"> </span><span class="p">\{</span><span class="w"> </span><span class="nb">id</span><span class="p">,</span><span class="w"> </span><span class="n">task</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="o">-&gt;</span>
<span class="w">        </span><span class="no">Stdout</span><span class="o">.</span><span class="n">line!</span><span class="w"> </span><span class="s2">"</span><span class="se">\t</span><span class="s2">id: $(id), task: $(task)"</span>

<span class="w">    </span><span class="n">completed</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">try</span><span class="w"> </span><span class="n">query_todos_by_status!</span><span class="w"> </span><span class="s2">"completed"</span>

<span class="w">    </span><span class="n">try</span><span class="w"> </span><span class="no">Stdout</span><span class="o">.</span><span class="n">line!</span><span class="w"> </span><span class="s2">"</span><span class="se">\n</span><span class="s2">Completed Tasks:"</span>
<span class="w">    </span><span class="n">try</span><span class="w"> </span><span class="no">List</span><span class="o">.</span><span class="n">forEachTry!</span><span class="w"> </span><span class="n">completed</span><span class="w"> </span><span class="p">\{</span><span class="w"> </span><span class="nb">id</span><span class="p">,</span><span class="w"> </span><span class="n">task</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="o">-&gt;</span>
<span class="w">        </span><span class="no">Stdout</span><span class="o">.</span><span class="n">line!</span><span class="w"> </span><span class="s2">"</span><span class="se">\t</span><span class="s2">id: $(id), task: $(task)"</span>

<span class="w">    </span><span class="no">Ok</span><span class="w"> </span><span class="p">{}</span>
</code></pre></div>



<a name="491690308"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/Sqlite%20APIs/near/491690308" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/Sqlite.20APIs.html#491690308">(Jan 03 2025 at 01:27)</a>:</h4>
<p>And transactions now work like this:</p>
<div class="codehilite" data-code-language="Ruby"><pre><span></span><code><span class="n">exec_transaction!</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">try</span><span class="w"> </span><span class="n">prepare_transaction!</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="ss">path</span><span class="p">:</span><span class="w"> </span><span class="s2">"path/to/database.db"</span><span class="w"> </span><span class="p">}</span>

<span class="n">try</span><span class="w"> </span><span class="n">exec_transaction!</span><span class="w"> </span><span class="p">\{}</span><span class="w"> </span><span class="o">-&gt;</span>
<span class="w">    </span><span class="n">try</span><span class="w"> </span><span class="no">Sqlite</span><span class="o">.</span><span class="n">execute!</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="ss">path</span><span class="p">:</span><span class="w"> </span><span class="s2">"path/to/database.db"</span><span class="p">,</span>
<span class="w">        </span><span class="ss">query</span><span class="p">:</span><span class="w"> </span><span class="s2">"INSERT INTO users (first, last) VALUES (:first, :last);"</span><span class="p">,</span>
<span class="w">        </span><span class="ss">bindings</span><span class="p">:</span><span class="w"> </span><span class="o">[</span>
<span class="w">            </span><span class="p">{</span><span class="w"> </span><span class="nb">name</span><span class="p">:</span><span class="w"> </span><span class="s2">":first"</span><span class="p">,</span><span class="w"> </span><span class="ss">value</span><span class="p">:</span><span class="w"> </span><span class="nb">String</span><span class="w"> </span><span class="s2">"John"</span><span class="w"> </span><span class="p">},</span>
<span class="w">            </span><span class="p">{</span><span class="w"> </span><span class="nb">name</span><span class="p">:</span><span class="w"> </span><span class="s2">":last"</span><span class="p">,</span><span class="w"> </span><span class="ss">value</span><span class="p">:</span><span class="w"> </span><span class="nb">String</span><span class="w"> </span><span class="s2">"Smith"</span><span class="w"> </span><span class="p">},</span>
<span class="w">        </span><span class="o">]</span><span class="p">,</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1"># Oh no, hit an error. Need to rollback.</span>
<span class="w">    </span><span class="c1"># Note: Error could be anything.</span>
<span class="w">    </span><span class="no">Err</span><span class="w"> </span><span class="no">NeedToRollback</span>
</code></pre></div>



<a name="491690378"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/Sqlite%20APIs/near/491690378" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/Sqlite.20APIs.html#491690378">(Jan 03 2025 at 01:28)</a>:</h4>
<p>Both of these feel ok. Though some of the type signatures are definitely a bit complex.</p>



<a name="491690534"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/Sqlite%20APIs/near/491690534" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/Sqlite.20APIs.html#491690534">(Jan 03 2025 at 01:30)</a>:</h4>
<p><a href="https://github.com/roc-lang/basic-cli/pull/302">https://github.com/roc-lang/basic-cli/pull/302</a></p>



<a name="491693942"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/Sqlite%20APIs/near/491693942" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/Sqlite.20APIs.html#491693942">(Jan 03 2025 at 02:15)</a>:</h4>
<p>What is the type of <code>query_todos_by_status!</code>?</p>



<a name="491694015"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/Sqlite%20APIs/near/491694015" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/Sqlite.20APIs.html#491694015">(Jan 03 2025 at 02:16)</a>:</h4>
<p>If these are examples, I feel like we should type annotations... even if they're not required.</p>



<a name="491694454"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/Sqlite%20APIs/near/491694454" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/Sqlite.20APIs.html#491694454">(Jan 03 2025 at 02:22)</a>:</h4>
<p><code>PreparedQueryManyStmt Str { id: Str, task: Str } _</code></p>
<p>Where <code>_</code> is whatever the error type is.</p>



<a name="491694631"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/Sqlite%20APIs/near/491694631" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/Sqlite.20APIs.html#491694631">(Jan 03 2025 at 02:24)</a>:</h4>
<p><span class="user-mention silent" data-user-id="515757">Luke Boswell</span> <a href="#narrow/stream/383402-API-design/topic/Sqlite.20APIs/near/491694015">said</a>:</p>
<blockquote>
<p>If these are examples, I feel like we should type annotations... even if they're not required.</p>
</blockquote>
<p>I personally don't like that. Roc can be used without type annotations and adding the annotations makes everything feel more complex than it is.</p>



<a name="491694691"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/Sqlite%20APIs/near/491694691" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/Sqlite.20APIs.html#491694691">(Jan 03 2025 at 02:25)</a>:</h4>
<p>Also, debating changing the name to <code>QueryManyFn</code> for some simplicity.</p>



<a name="491695224"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/Sqlite%20APIs/near/491695224" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/Sqlite.20APIs.html#491695224">(Jan 03 2025 at 02:33)</a>:</h4>
<p>Pushed the simplified names</p>



<a name="491705934"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/Sqlite%20APIs/near/491705934" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/Sqlite.20APIs.html#491705934">(Jan 03 2025 at 05:13)</a>:</h4>
<p>Ok, so this design still has a major flaw. Due to generating the entire prepared statement into a query function, the errors suck. They are a pain to store in the <code>Model</code> for basic webserver.</p>
<p>Simple example:</p>
<div class="codehilite" data-code-language="Ruby"><pre><span></span><code><span class="n">init!</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{}</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="no">Result</span><span class="w"> </span><span class="no">Model</span><span class="w"> </span><span class="n">_</span>
<span class="n">init!</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">\{}</span><span class="w"> </span><span class="o">-&gt;</span>
<span class="w">    </span><span class="c1"># Read DB_PATH environment variable</span>
<span class="w">    </span><span class="n">db_path</span><span class="w"> </span><span class="o">=</span>
<span class="w">        </span><span class="no">Env</span><span class="o">.</span><span class="n">var!</span><span class="w"> </span><span class="s2">"DB_PATH"</span>
<span class="w">        </span><span class="o">|&gt;</span><span class="w"> </span><span class="no">Result</span><span class="o">.</span><span class="n">mapErr</span><span class="w"> </span><span class="p">\</span><span class="n">_</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="no">ServerErr</span><span class="w"> </span><span class="s2">"DB_PATH not set on environment"</span>
<span class="w">        </span><span class="o">|&gt;</span><span class="w"> </span><span class="n">try</span>

<span class="w">    </span><span class="n">query_todos_by_status!</span><span class="w"> </span><span class="o">=</span>
<span class="w">        </span><span class="no">Sqlite</span><span class="o">.</span><span class="n">prepare_query_many!</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="ss">path</span><span class="p">:</span><span class="w"> </span><span class="n">db_path</span><span class="p">,</span>
<span class="w">            </span><span class="ss">query</span><span class="p">:</span><span class="w"> </span><span class="s2">"SELECT id, task FROM todos WHERE status = :status;"</span><span class="p">,</span>
<span class="w">            </span><span class="ss">bindings</span><span class="p">:</span><span class="w"> </span><span class="p">\</span><span class="nb">name</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="o">[</span><span class="p">{</span><span class="w"> </span><span class="nb">name</span><span class="p">:</span><span class="w"> </span><span class="s2">":status"</span><span class="p">,</span><span class="w"> </span><span class="ss">value</span><span class="p">:</span><span class="w"> </span><span class="nb">String</span><span class="w"> </span><span class="nb">name</span><span class="w"> </span><span class="p">}</span><span class="o">]</span><span class="p">,</span>
<span class="w">            </span><span class="ss">rows</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="no">Sqlite</span><span class="o">.</span><span class="n">decode_record</span><span class="w"> </span><span class="o">&lt;-</span>
<span class="w">                </span><span class="nb">id</span><span class="p">:</span><span class="w"> </span><span class="no">Sqlite</span><span class="o">.</span><span class="n">i64</span><span class="w"> </span><span class="s2">"id"</span><span class="p">,</span>
<span class="w">                </span><span class="ss">task</span><span class="p">:</span><span class="w"> </span><span class="no">Sqlite</span><span class="o">.</span><span class="n">str</span><span class="w"> </span><span class="s2">"task"</span><span class="p">,</span>
<span class="w">            </span><span class="p">},</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="o">|&gt;</span><span class="w"> </span><span class="no">Result</span><span class="o">.</span><span class="n">mapErr</span><span class="w"> </span><span class="p">\</span><span class="n">err</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="no">ServerErr</span><span class="w"> </span><span class="s2">"Failed to prepare Sqlite statement: $(Inspect.toStr err)"</span>
<span class="w">        </span><span class="o">|&gt;</span><span class="w"> </span><span class="n">try</span>

<span class="w">    </span><span class="no">Ok</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">query_todos_by_status!</span><span class="w"> </span><span class="p">}</span>
</code></pre></div>
<p>What is model. It is a:</p>
<div class="codehilite" data-code-language="Ruby"><pre><span></span><code><span class="p">{</span><span class="w"> </span><span class="n">query_todos_by_status!</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="no">Str</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="no">Result</span><span class="w"> </span><span class="p">(</span><span class="no">List</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nb">id</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="no">I64</span><span class="p">,</span>
<span class="w">    </span><span class="n">task</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="no">Str</span><span class="p">,</span>
<span class="p">})</span><span class="w"> </span><span class="p">(</span><span class="no">Sqlite</span><span class="o">.</span><span class="n">SqlDecodeErr</span><span class="w"> </span><span class="o">[</span>
<span class="w">    </span><span class="no">FailedToDecodeInteger</span><span class="w"> </span><span class="o">[]</span><span class="p">,</span>
<span class="w">    </span><span class="no">UnexpectedType</span><span class="w"> </span><span class="o">[</span>
<span class="w">        </span><span class="no">Bytes</span><span class="p">,</span>
<span class="w">        </span><span class="nb">Integer</span><span class="p">,</span>
<span class="w">        </span><span class="no">Null</span><span class="p">,</span>
<span class="w">        </span><span class="no">Real</span><span class="p">,</span>
<span class="w">        </span><span class="nb">String</span><span class="p">,</span>
<span class="w">    </span><span class="o">]</span><span class="p">,</span>
<span class="o">]</span><span class="p">)</span><span class="w"> </span><span class="p">}</span>
</code></pre></div>
<p>With this type alias: <code>QueryManyFn in out err : in =&gt; Result (List out) (SqlDecodeErr err)</code><br>
it is a:</p>
<div class="codehilite" data-code-language="Ruby"><pre><span></span><code><span class="no">Model</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">query_todos_by_status!</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="no">Sqlite</span><span class="o">.</span><span class="n">QueryManyFn</span><span class="w"> </span><span class="no">Str</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nb">id</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="no">I64</span><span class="p">,</span><span class="w"> </span><span class="n">task</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="no">Str</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="o">[</span><span class="no">FailedToDecodeInteger</span><span class="w"> </span><span class="o">[]</span><span class="p">,</span><span class="w"> </span><span class="no">UnexpectedType</span><span class="w"> </span><span class="o">[</span><span class="no">Bytes</span><span class="p">,</span><span class="w"> </span><span class="nb">Integer</span><span class="p">,</span><span class="w"> </span><span class="no">Null</span><span class="p">,</span><span class="w"> </span><span class="no">Real</span><span class="p">,</span><span class="w"> </span><span class="nb">String</span><span class="o">]]</span><span class="w"> </span><span class="p">}</span>
</code></pre></div>
<p>This quickly gets to be a mess (especially with many queries). I am unable to put an <code>_</code> there cause:</p>
<div class="codehilite"><pre><span></span><code>Type alias definitions may not use inferred types (_).
</code></pre></div>
<p>On top of that, even when I type it correctly, it becomes a closed tag union. Due to being a closed tag, the errors no longer propagate.</p>
<hr>
<p>So I went a different route:</p>
<div class="codehilite" data-code-language="Ruby"><pre><span></span><code><span class="no">Model</span><span class="w"> </span><span class="n">err</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">query_todos_by_status!</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="no">Sqlite</span><span class="o">.</span><span class="n">QueryManyFn</span><span class="w"> </span><span class="no">Str</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nb">id</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="no">I64</span><span class="p">,</span><span class="w"> </span><span class="n">task</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="no">Str</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="n">err</span><span class="w"> </span><span class="p">}</span>
</code></pre></div>
<p>This feels like it should work . But it breaks due to the <code>Model</code> being passed to the platform. The use in the platform does not expect a type that takes a type variable.</p>
<p>I tried replacing the entire use in the platform with a type variable, but that also breaks. Cause a <code>model</code> type variable contains no info and can not be used as a <code>Model err</code></p>
<hr>
<p>So the apis are much nicer to use, but the types have become really hard to work with.</p>



<a name="491706157"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/Sqlite%20APIs/near/491706157" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/Sqlite.20APIs.html#491706157">(Jan 03 2025 at 05:16)</a>:</h4>
<p>To make the code actually work, I need to type it like so:</p>
<div class="codehilite" data-code-language="Ruby"><pre><span></span><code><span class="no">Model</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">query_todos_by_status!</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="no">Sqlite</span><span class="o">.</span><span class="n">QueryManyFn</span><span class="w"> </span><span class="no">Str</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nb">id</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="no">I64</span><span class="p">,</span><span class="w"> </span><span class="n">task</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="no">Str</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="o">[</span>
<span class="w">        </span><span class="no">FailedToDecodeInteger</span><span class="w"> </span><span class="o">[]</span><span class="p">,</span>
<span class="w">        </span><span class="no">UnexpectedType</span><span class="w"> </span><span class="o">[</span><span class="no">Bytes</span><span class="p">,</span><span class="w"> </span><span class="nb">Integer</span><span class="p">,</span><span class="w"> </span><span class="no">Null</span><span class="p">,</span><span class="w"> </span><span class="no">Real</span><span class="p">,</span><span class="w"> </span><span class="nb">String</span><span class="o">]</span><span class="p">,</span>
<span class="w">        </span><span class="no">StdoutErr</span><span class="w"> </span><span class="o">[</span>
<span class="w">                </span><span class="no">AlreadyExists</span><span class="p">,</span>
<span class="w">                </span><span class="no">BrokenPipe</span><span class="p">,</span>
<span class="w">                </span><span class="no">Interrupted</span><span class="p">,</span>
<span class="w">                </span><span class="no">NotFound</span><span class="p">,</span>
<span class="w">                </span><span class="no">Other</span><span class="w"> </span><span class="no">Str</span><span class="p">,</span>
<span class="w">                </span><span class="no">OutOfMemory</span><span class="p">,</span>
<span class="w">                </span><span class="no">PermissionDenied</span><span class="p">,</span>
<span class="w">                </span><span class="no">Unsupported</span><span class="p">,</span>
<span class="w">            </span><span class="o">]</span><span class="p">,</span>
<span class="w">        </span><span class="no">ServerErr</span><span class="w"> </span><span class="no">Str</span><span class="p">,</span>
<span class="w">    </span><span class="o">]</span><span class="p">,</span>
<span class="p">}</span>
</code></pre></div>



<a name="491706198"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/Sqlite%20APIs/near/491706198" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/Sqlite.20APIs.html#491706198">(Jan 03 2025 at 05:17)</a>:</h4>
<p>Code here: <a href="https://github.com/roc-lang/basic-webserver/tree/sqlite-better-queries">https://github.com/roc-lang/basic-webserver/tree/sqlite-better-queries</a></p>



<a name="491721256"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/Sqlite%20APIs/near/491721256" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jasper Woudenberg <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/Sqlite.20APIs.html#491721256">(Jan 03 2025 at 08:17)</a>:</h4>
<p>How would you feel about creating a type alias for just the error?</p>
<div class="codehilite"><pre><span></span><code># Sqlite.roc
QueryError : SqlDecodeErr [
    FailedToDecodeInteger [],
    UnexpectedType [
        Bytes,
        Integer,
        Null,
        Real,
        String,
    ],
    ServerErr Str,
]
</code></pre></div>
<p>Then the appliction Model types becomes:</p>
<div class="codehilite"><pre><span></span><code>Model : {
    query_todos_by_status! : Str =&gt; Result (List { id : I64, task : Str })  Sqlite.QueryError
}
</code></pre></div>
<p>I think that's a pretty reasonable type, every bit of it is useful documentation of how <code>query_todos_by_status!</code> is supposed to be used. It takes up a similar amount of space as the <code>Sqlite.QueryManyFn</code>-based type, and using <code>_</code> instead of the input, output, and/or error type should work.</p>



<a name="491723564"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/Sqlite%20APIs/near/491723564" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jasper Woudenberg <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/Sqlite.20APIs.html#491723564">(Jan 03 2025 at 08:41)</a>:</h4>
<p><span class="user-mention silent" data-user-id="343810">Brendan Hansknecht</span> <a href="#narrow/channel/383402-API-design/topic/Sqlite.20APIs/near/491682768">said</a>:</p>
<blockquote>
<p>Also, let me know if there is a better alternative to bindings as a list you can think of.</p>
</blockquote>
<p>The one thing that occured to me is that it would be possible to take any Roc Record as an argument list and then use an encoder to pull out the key-value pairs and put them in the query.</p>
<p>A nice benefit of that approach is that where in the current approach the <code>bindings</code> params contains some "runtime type-annotations" (the constructors to the <code>value</code> field), in the encoder approach the application author could instead specify the types of params using regular Roc type annotations.</p>
<p>A downside is that whereas the current "runtime type-annotations" are required, Roc type annotations are optional. That might lead to problems if the application author chooses not to add them, given the <code>Model</code> needs to be concrete in order for it to be passed to the platform.</p>
<p>A possible fix for that would be to keep the <code>bindings</code> params, but use it solely to describe the expected input type. That would also make it possible to make certain invalid input types compile-time errors, such as attempting to pass <code>List U64]</code> as a param value.</p>
<div class="codehilite"><pre><span></span><code># single param
bindings: Sqlite.Bindings Str
bindings = Sqlite.string

# record of params
bindings : Sqlite.Bindings { status : Str, limit : U64 }
bindings = { Sqlite.bindings &lt;-
    status: Sqlite.str,
    limit: Sqlite.u64,
}

# Sqlite.roc
Bindings a := {}

str : Bindings Str
str = @Bindings {}

u64 : Bindings U64
u64 = @Bindings {}

prepare_query! :
    {
        path : Str,
        query : Str,
        bindings : Bindings in,
        row : SqlDecode out (RowCountErr err),
    }
    =&gt; Result (in =&gt; Result out err) [SqliteErr ErrCode Str]
</code></pre></div>



<a name="491730857"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/Sqlite%20APIs/near/491730857" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jasper Woudenberg <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/Sqlite.20APIs.html#491730857">(Jan 03 2025 at 09:41)</a>:</h4>
<p>Another potential benefit of the <code>Sqlite.Bindings</code> + encoder params API: It would make the types of the parameters passed in knowable when preparing queries. I imagine that means that the following errors could be handled at prepare time, rather than at query time:</p>
<div class="codehilite"><pre><span></span><code>    UnexpectedType [
        Bytes,
        Integer,
        Null,
        Real,
        String,
    ]
</code></pre></div>



<a name="491769056"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/Sqlite%20APIs/near/491769056" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/Sqlite.20APIs.html#491769056">(Jan 03 2025 at 14:59)</a>:</h4>
<p><span class="user-mention silent" data-user-id="477725">Jasper Woudenberg</span> <a href="#narrow/stream/383402-API-design/topic/Sqlite.20APIs/near/491721256">said</a>:</p>
<blockquote>
<p>How would you feel about creating a type alias for just the error?</p>
<p><div class="codehilite"><pre><span></span><code># Sqlite.roc
QueryError : SqlDecodeErr [
    FailedToDecodeInteger [],
    UnexpectedType [
        Bytes,
        Integer,
        Null,
        Real,
        String,
    ],
    ServerErr Str,
]
</code></pre></div><br>
</p>
</blockquote>
<p>That wouldn't t work:</p>
<ol>
<li>The errors depend on the exact row decoder used.</li>
<li>Due to generating a closed tag, some of these errors aren't even from sqlite at all. <code>ServerErr</code> is from the app, not from sqlite.</li>
</ol>



<a name="491769307"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/Sqlite%20APIs/near/491769307" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/Sqlite.20APIs.html#491769307">(Jan 03 2025 at 15:01)</a>:</h4>
<p>Also, unexpected type comes from decoding a row. If you try to decode as strings and one of the items in a column is an int, that will lead to the error.</p>



<a name="491779294"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/Sqlite%20APIs/near/491779294" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jasper Woudenberg <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/Sqlite.20APIs.html#491779294">(Jan 03 2025 at 16:19)</a>:</h4>
<p>Ah, makes sense, too bad. Does it work to remove <code>Sqlite.QueryManyFn</code> and use <code>_</code> in the <code>Model</code> on the error position?</p>
<p>Another approach is to add a <code>onError</code> argument to <code>prepare_query_many!</code>. That would allow the application author to map that error to a more reasonable type, and subsequently you have that type rather than the original in the <code>Model</code>.</p>



<a name="491779544"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/Sqlite%20APIs/near/491779544" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/Sqlite.20APIs.html#491779544">(Jan 03 2025 at 16:22)</a>:</h4>
<p><span class="user-mention silent" data-user-id="477725">Jasper Woudenberg</span> <a href="#narrow/stream/383402-API-design/topic/Sqlite.20APIs/near/491779294">said</a>:</p>
<blockquote>
<p>Ah, makes sense, too bad. Does it work to remove <code>Sqlite.QueryManyFn</code> and use <code>_</code> in the <code>Model</code> on the error position?</p>
</blockquote>
<p>This is what I really wish worked, but isn't allowed in type aliases.</p>



<a name="491779579"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/Sqlite%20APIs/near/491779579" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/Sqlite.20APIs.html#491779579">(Jan 03 2025 at 16:22)</a>:</h4>
<p>Yeah, onError may be the best solution.</p>



<a name="491779623"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/Sqlite%20APIs/near/491779623" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/Sqlite.20APIs.html#491779623">(Jan 03 2025 at 16:23)</a>:</h4>
<p>This feels like a case where there should be a much nicer solution but I'm not seeing it.</p>



<a name="491780102"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/Sqlite%20APIs/near/491780102" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/Sqlite.20APIs.html#491780102">(Jan 03 2025 at 16:27)</a>:</h4>
<p><span class="user-mention silent" data-user-id="343810">Brendan Hansknecht</span> <a href="#narrow/stream/383402-API-design/topic/Sqlite.20APIs/near/491705934">said</a>:</p>
<blockquote>
<p>Ok, so this design still has a major flaw. Due to generating the entire prepared statement into a query function, the errors suck. They are a pain to store in the <code>Model</code> for basic webserver.</p>
</blockquote>
<p><span class="user-mention" data-user-id="454654">@Ayaz Hafiz</span> or <span class="user-mention" data-user-id="281383">@Richard Feldman</span> any thought on the issues being described starting in this comment? Feels like the type system is just too rigid for this design making errors a pain.</p>
<p>A big part of the issue is that stored lambdas no longer return open tags. Maybe that is a bug?</p>



<a name="491780546"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/Sqlite%20APIs/near/491780546" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/Sqlite.20APIs.html#491780546">(Jan 03 2025 at 16:30)</a>:</h4>
<blockquote>
<p>stored lambdas no longer return open tags</p>
</blockquote>
<p>I assume the reason for this is that the hidden type variable doesn't propagate to the lambdas? <span aria-label="thinking" class="emoji emoji-1f914" role="img" title="thinking">:thinking:</span> </p>
<p>Ayaz would know</p>



<a name="491780963"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/Sqlite%20APIs/near/491780963" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ayaz Hafiz <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/Sqlite.20APIs.html#491780963">(Jan 03 2025 at 16:34)</a>:</h4>
<p>yeah the hidden "open" type variable doesn't apply to unions under aliases</p>



<a name="491781008"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/Sqlite%20APIs/near/491781008" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ayaz Hafiz <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/Sqlite.20APIs.html#491781008">(Jan 03 2025 at 16:34)</a>:</h4>
<p>it would break the alias type</p>



<a name="491781141"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/Sqlite%20APIs/near/491781141" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/Sqlite.20APIs.html#491781141">(Jan 03 2025 at 16:35)</a>:</h4>
<p>because the variable doesn't appear in the alias's type parameters?</p>



<a name="491781309"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/Sqlite%20APIs/near/491781309" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ayaz Hafiz <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/Sqlite.20APIs.html#491781309">(Jan 03 2025 at 16:36)</a>:</h4>
<p>yes</p>



<a name="491781371"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/Sqlite%20APIs/near/491781371" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ayaz Hafiz <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/Sqlite.20APIs.html#491781371">(Jan 03 2025 at 16:37)</a>:</h4>
<p>and the type errors would be really weird, because now aliases don't necessarily have the same type</p>



<a name="491781408"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/Sqlite%20APIs/near/491781408" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/Sqlite.20APIs.html#491781408">(Jan 03 2025 at 16:37)</a>:</h4>
<p>so it would have to be</p>
<div class="codehilite" data-code-language="CoffeeScript"><pre><span></span><code><span class="c1"># Sqlite.roc</span>
<span class="nx">QueryError</span><span class="w"> </span><span class="nv">a</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="nx">SqlDecodeErr</span><span class="w"> </span><span class="p">[</span>
<span class="w">    </span><span class="nx">FailedToDecodeInteger</span><span class="w"> </span><span class="p">[],</span>
<span class="w">    </span><span class="nx">UnexpectedType</span><span class="w"> </span><span class="p">[</span>
<span class="w">        </span><span class="nx">Bytes</span><span class="p">,</span>
<span class="w">        </span><span class="nx">Integer</span><span class="p">,</span>
<span class="w">        </span><span class="nx">Null</span><span class="p">,</span>
<span class="w">        </span><span class="nx">Real</span><span class="p">,</span>
<span class="w">        </span><span class="nb">String</span><span class="p">,</span>
<span class="w">    </span><span class="p">]</span><span class="nx">a</span><span class="p">,</span>
<span class="w">    </span><span class="nx">ServerErr</span><span class="w"> </span><span class="nx">Str</span><span class="p">,</span>
<span class="p">]</span>
</code></pre></div>



<a name="491781419"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/Sqlite%20APIs/near/491781419" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ayaz Hafiz <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/Sqlite.20APIs.html#491781419">(Jan 03 2025 at 16:37)</a>:</h4>
<p>ye[</p>



<a name="491786380"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/Sqlite%20APIs/near/491786380" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/Sqlite.20APIs.html#491786380">(Jan 03 2025 at 17:20)</a>:</h4>
<p>The only issue with adding an err type variable is that the Model can't have any type variables with how it is passed to the platform currently.</p>



<a name="491786425"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/Sqlite%20APIs/near/491786425" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/Sqlite.20APIs.html#491786425">(Jan 03 2025 at 17:20)</a>:</h4>
<p>Any idea how to deal with that. I think the type has to be concrete for the platform to use it.</p>



<a name="491786488"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/Sqlite%20APIs/near/491786488" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/Sqlite.20APIs.html#491786488">(Jan 03 2025 at 17:21)</a>:</h4>
<p>Maybe it is just a sign that this kind of design doesn't really work well cause the errors will become a mess and have to be stored.</p>



<a name="491786506"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/Sqlite%20APIs/near/491786506" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ayaz Hafiz <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/Sqlite.20APIs.html#491786506">(Jan 03 2025 at 17:21)</a>:</h4>
<p>i don't think there is a good way to deal with that without upcasting/downcasting</p>



<a name="491786608"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/Sqlite%20APIs/near/491786608" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ayaz Hafiz <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/Sqlite.20APIs.html#491786608">(Jan 03 2025 at 17:22)</a>:</h4>
<p>the less granular api would be to say that the API can return any error, or make the error more opaque (e.g. <code>UnexpectedType Str</code>)</p>



<a name="491786739"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/Sqlite%20APIs/near/491786739" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ayaz Hafiz <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/Sqlite.20APIs.html#491786739">(Jan 03 2025 at 17:23)</a>:</h4>
<p>fwiw i don't think there's really any recovery with sql query errors. You either log the error and emit a 500 or forward the error to the user. So I think a less granular API is okay.</p>



<a name="491802087"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/Sqlite%20APIs/near/491802087" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/Sqlite.20APIs.html#491802087">(Jan 03 2025 at 19:31)</a>:</h4>
<p>That's a good tip.</p>



<a name="492327721"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/Sqlite%20APIs/near/492327721" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/Sqlite.20APIs.html#492327721">(Jan 07 2025 at 15:09)</a>:</h4>
<p>So I just had a realization. If we are willing to switch back to having <code>server = { init!, respond! }</code>. We can link the type variables in basic-webserver.</p>
<p>That enables use to use the platform type as.</p>
<div class="codehilite"><pre><span></span><code>Server model init_err respond_err : {
    init! : {} =&gt; Result model init_err,
    respond! : Http.Request, model =&gt; Result Http.Response respond_err,
}
</code></pre></div>
<p>Then in the app we can define the model as:</p>
<div class="codehilite"><pre><span></span><code>Model err : {
    query_todos_by_status! : Sqlite.QueryManyFn Str { id : I64, task : Str } err,
}
</code></pre></div>
<p>This enables us to keep all the error information and avoid being explicit about all of the error tag union merging.</p>
<p>Thoughts?</p>



<a name="492334289"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/Sqlite%20APIs/near/492334289" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/Sqlite.20APIs.html#492334289">(Jan 07 2025 at 15:40)</a>:</h4>
<p>That leads to this: <a href="https://github.com/roc-lang/basic-webserver/blob/6d47b5b3b992ac36a2aeda6cd01c9362b94de32d/examples/todos.roc#L12-L58">https://github.com/roc-lang/basic-webserver/blob/6d47b5b3b992ac36a2aeda6cd01c9362b94de32d/examples/todos.roc#L12-L58</a></p>
<p>Which on one hand is a lot nicer to use, but the types still aren't nice.</p>



<hr><p>Last updated: Mar 01 2026 at 12:20 UTC</p>
</html>