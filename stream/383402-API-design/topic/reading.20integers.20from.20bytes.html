<html>
<head><meta charset="utf-8"><title>reading integers from bytes · API design · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/index.html">API design</a></h2>
<h3>Topic: <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/reading.20integers.20from.20bytes.html">reading integers from bytes</a></h3>

<hr>

<base href="https://roc.zulipchat.com">

<head><link href="https://roc-lang.github.io/zulip-export/style.css" rel="stylesheet"></head>

<a name="417522743"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/reading%20integers%20from%20bytes/near/417522743" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/reading.20integers.20from.20bytes.html#417522743">(Jan 23 2024 at 20:26)</a>:</h4>
<p>The current <a href="https://www.roc-lang.org/builtins/Num#bytesToU16"><code>Num.bytesToU16</code></a> (and similar) functions don't take <a href="https://en.wikipedia.org/wiki/Endianness">endianness</a> into account, which means they'll give different answers on different CPUs. We've been eliminating those scenarios, and this seems like one worth eliminating too.</p>
<p>More broadly, I recently realized that adding things to <code>Num</code> which rely on endianness (like <code>bytesToU16</code> and similar) was probably premature. I think they should be removed for now and revisited later in the context of specific concrete use cases.</p>
<p>For example, binary serialization formats necessarily specify things like endianness as part of the format, so it's not clear to me how helpful dedicated <code>Num</code> builtins for translating between bytes and certain integer sizes would be in practice.</p>
<p>I don't think this would block anything from being built in Roc. Consider Zig's <a href="https://github.com/ziglang/zig/blob/993a83081a975464d1201597cf6f4cb7f6735284/lib/std/mem.zig#L1574"><code>std.mem.readVarPackedInt</code></a>. It supports decoding bit offsets, and does everything in userspace using (as far as I can see) operations that are available in <code>Num</code> in Roc. If a function like that is implementable in userspace, I think all the relevant use cases should be unblocked here.</p>
<p>Obviously in the future we can revisit this if specific use cases come up which justify builtins, but I think in this case it's worth the forcing function of starting with userspace and seeing what that experience is like in practice.</p>



<a name="417525106"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/reading%20integers%20from%20bytes/near/417525106" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/reading.20integers.20from.20bytes.html#417525106">(Jan 23 2024 at 20:43)</a>:</h4>
<p>The plan here was to change the api and make it take endianness</p>



<a name="417525549"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/reading%20integers%20from%20bytes/near/417525549" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/reading.20integers.20from.20bytes.html#417525549">(Jan 23 2024 at 20:46)</a>:</h4>
<p>Also to make to return a tuple when going from a <code>U16</code> to bytes.</p>



<a name="417525753"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/reading%20integers%20from%20bytes/near/417525753" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/reading.20integers.20from.20bytes.html#417525753">(Jan 23 2024 at 20:48)</a>:</h4>
<p>The apis discussed where the following:</p>
<div class="codehilite"><pre><span></span><code>Num.u16ToBytes : U16, [BE, LE] -&gt; (U8, U8)
Num.u16FromBytes : (U8, U8), [BE, LE] -&gt; U16

Num.appendBytesToList : List U8, Num a, [BE, LE] -&gt; List U8
</code></pre></div>



<a name="417533155"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/reading%20integers%20from%20bytes/near/417533155" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/reading.20integers.20from.20bytes.html#417533155">(Jan 23 2024 at 21:36)</a>:</h4>
<p>yeah I remember the discussion, I just think a better plan is to try taking them out altogether <span aria-label="big smile" class="emoji emoji-1f604" role="img" title="big smile">:big_smile:</span></p>



<a name="417533212"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/reading%20integers%20from%20bytes/near/417533212" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/reading.20integers.20from.20bytes.html#417533212">(Jan 23 2024 at 21:37)</a>:</h4>
<p>and seeing if it really feels like there's justification for making them builtins after all, based on how they end up being used in practice</p>



<a name="417533214"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/reading%20integers%20from%20bytes/near/417533214" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/reading.20integers.20from.20bytes.html#417533214">(Jan 23 2024 at 21:37)</a>:</h4>
<p>I don't understand though. They will clearly be wanted for binary protocols</p>



<a name="417533287"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/reading%20integers%20from%20bytes/near/417533287" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/reading.20integers.20from.20bytes.html#417533287">(Jan 23 2024 at 21:37)</a>:</h4>
<p>They also are much more performant as builtins then as bit shifting.</p>



<a name="417533351"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/reading%20integers%20from%20bytes/near/417533351" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/reading.20integers.20from.20bytes.html#417533351">(Jan 23 2024 at 21:38)</a>:</h4>
<p>hm, why would they be more performant as builtins? <span aria-label="thinking" class="emoji emoji-1f914" role="img" title="thinking">:thinking:</span></p>



<a name="417533386"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/reading%20integers%20from%20bytes/near/417533386" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/reading.20integers.20from.20bytes.html#417533386">(Jan 23 2024 at 21:38)</a>:</h4>
<p>Cause they just use type casting instead of bitshifting.</p>



<a name="417533548"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/reading%20integers%20from%20bytes/near/417533548" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/reading.20integers.20from.20bytes.html#417533548">(Jan 23 2024 at 21:39)</a>:</h4>
<p>Feels like something llvm should be able to optimize to the same thing, but IIRC when working on hashing, that wasn't the case.</p>



<a name="417533590"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/reading%20integers%20from%20bytes/near/417533590" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/reading.20integers.20from.20bytes.html#417533590">(Jan 23 2024 at 21:39)</a>:</h4>
<p>you mean in the case where the target endianness matches the requested endianness?</p>



<a name="417533609"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/reading%20integers%20from%20bytes/near/417533609" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/reading.20integers.20from.20bytes.html#417533609">(Jan 23 2024 at 21:40)</a>:</h4>
<p>yeah I assumed LLVM would optimize that, surprising that it doesn't</p>



<a name="417533656"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/reading%20integers%20from%20bytes/near/417533656" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/reading.20integers.20from.20bytes.html#417533656">(Jan 23 2024 at 21:40)</a>:</h4>
<p>Both are faster, but that is the most affected</p>



<a name="417533675"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/reading%20integers%20from%20bytes/near/417533675" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/reading.20integers.20from.20bytes.html#417533675">(Jan 23 2024 at 21:40)</a>:</h4>
<p>well it's not safe to cast unless the endianness matches, right?</p>



<a name="417533683"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/reading%20integers%20from%20bytes/near/417533683" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/reading.20integers.20from.20bytes.html#417533683">(Jan 23 2024 at 21:40)</a>:</h4>
<p>I can double check. Maybe I had something else off</p>



<a name="417533686"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/reading%20integers%20from%20bytes/near/417533686" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/reading.20integers.20from.20bytes.html#417533686">(Jan 23 2024 at 21:40)</a>:</h4>
<p>otherwise you can end up with the wrong answer</p>



<a name="417533716"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/reading%20integers%20from%20bytes/near/417533716" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/reading.20integers.20from.20bytes.html#417533716">(Jan 23 2024 at 21:40)</a>:</h4>
<p>There is a single instruction to flip the endianness though</p>



<a name="417533744"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/reading%20integers%20from%20bytes/near/417533744" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/reading.20integers.20from.20bytes.html#417533744">(Jan 23 2024 at 21:40)</a>:</h4>
<p>whoa, I didn't know that! <span aria-label="astonished" class="emoji emoji-1f632" role="img" title="astonished">:astonished:</span></p>



<a name="417533786"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/reading%20integers%20from%20bytes/near/417533786" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/reading.20integers.20from.20bytes.html#417533786">(Jan 23 2024 at 21:41)</a>:</h4>
<p>ok if LLVM doesn't optimize that, that's a very important consideration haha</p>



<a name="417533789"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/reading%20integers%20from%20bytes/near/417533789" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/reading.20integers.20from.20bytes.html#417533789">(Jan 23 2024 at 21:41)</a>:</h4>
<p>Yeah cause all the network protocols are big endian but cpus are little endian.</p>



<a name="417533849"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/reading%20integers%20from%20bytes/near/417533849" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/reading.20integers.20from.20bytes.html#417533849">(Jan 23 2024 at 21:41)</a>:</h4>
<p>Will go double check in godbolt now. Maybe before something else was messing up the generation.</p>



<a name="417534346"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/reading%20integers%20from%20bytes/near/417534346" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/reading.20integers.20from.20bytes.html#417534346">(Jan 23 2024 at 21:45)</a>:</h4>
<p>appreciate it!</p>



<a name="417535264"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/reading%20integers%20from%20bytes/near/417535264" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/reading.20integers.20from.20bytes.html#417535264">(Jan 23 2024 at 21:52)</a>:</h4>
<p>Ok, nvm, llvm gets it: <a href="https://zig.godbolt.org/z/xG4YPYcoG">https://zig.godbolt.org/z/xG4YPYcoG</a></p>
<p>I wonder what I hit before that messed this up... <span aria-label="shrug" class="emoji emoji-1f937" role="img" title="shrug">:shrug:</span></p>



<a name="417535311"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/reading%20integers%20from%20bytes/near/417535311" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/reading.20integers.20from.20bytes.html#417535311">(Jan 23 2024 at 21:52)</a>:</h4>
<p>So verbose, but doable</p>



<a name="417535675"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/reading%20integers%20from%20bytes/near/417535675" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/reading.20integers.20from.20bytes.html#417535675">(Jan 23 2024 at 21:54)</a>:</h4>
<p>Oh sorry, I remember the issue I was hitting. It is in bytes to integers.</p>
<p>We would need a way to load a tuple from a list. In current roc, you have to get each individual element. That is a huge cost.</p>
<p>So I guess the primitive that I would need is <code>List.get8: List a, Nat -&gt; Result (a, a, a, a, a, a, a, a) [OutOfBounds]</code>. Same for other numeric sizes.</p>



<a name="417535813"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/reading%20integers%20from%20bytes/near/417535813" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/reading.20integers.20from.20bytes.html#417535813">(Jan 23 2024 at 21:56)</a>:</h4>
<p>Otherwise, you as stuck with n branches to check size (which hopefully optimize into one), and then loading each individual element a single byte at a time.</p>



<a name="417536061"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/reading%20integers%20from%20bytes/near/417536061" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/reading.20integers.20from.20bytes.html#417536061">(Jan 23 2024 at 21:57)</a>:</h4>
<p>Which I guess the proposed <code>Num.*FromBytes</code> apis don't actually fix. So good thing this was thought about now either way.</p>



<a name="417536245"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/reading%20integers%20from%20bytes/near/417536245" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/reading.20integers.20from.20bytes.html#417536245">(Jan 23 2024 at 21:58)</a>:</h4>
<p>ha, makes sense!</p>



<a name="417536285"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/reading%20integers%20from%20bytes/near/417536285" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/reading.20integers.20from.20bytes.html#417536285">(Jan 23 2024 at 21:59)</a>:</h4>
<p>yeah those list primitives seem totally reasonable <span aria-label="+1" class="emoji emoji-1f44d" role="img" title="+1">:+1:</span></p>



<a name="417536478"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/reading%20integers%20from%20bytes/near/417536478" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/reading.20integers.20from.20bytes.html#417536478">(Jan 23 2024 at 22:00)</a>:</h4>
<p>so how about we try adding those primitives and see how it goes in practice?</p>



<a name="417536932"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/reading%20integers%20from%20bytes/near/417536932" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/reading.20integers.20from.20bytes.html#417536932">(Jan 23 2024 at 22:03)</a>:</h4>
<p>Oh wait, even better, we shouldn't need the primitives. Pattern matching and seamless slices for the win.</p>
<div class="codehilite"><pre><span></span><code>when List.dropFirst list index is
    [a, b, c, d, e, f, g, h, ...] -&gt;
    _ -&gt;
</code></pre></div>



<a name="417537138"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/reading%20integers%20from%20bytes/near/417537138" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/reading.20integers.20from.20bytes.html#417537138">(Jan 23 2024 at 22:04)</a>:</h4>
<p>Yeah, I say lets leave it to userland. Should be trivial for someone to make a package for it if they want to.</p>



<a name="417538415"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/reading%20integers%20from%20bytes/near/417538415" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/reading.20integers.20from.20bytes.html#417538415">(Jan 23 2024 at 22:13)</a>:</h4>
<p>wow, great point!!!</p>



<a name="417539452"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/reading%20integers%20from%20bytes/near/417539452" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/reading.20integers.20from.20bytes.html#417539452">(Jan 23 2024 at 22:21)</a>:</h4>
<p>The specific use case I want this for is a binary encoder/decoder so I can efficiently cache data and reuse between calls in basic-webserver, we can add something like <code>set : U64, List U8 -&gt; Task {} [OutOfSpace]</code> and <code>get : U64 -&gt; Task (List U8) [NotFound]</code> and encode/decode in the app or even platform if we want.</p>



<a name="417540041"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/reading%20integers%20from%20bytes/near/417540041" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/reading.20integers.20from.20bytes.html#417540041">(Jan 23 2024 at 22:25)</a>:</h4>
<p>Sure, so when you define the binary encoder/decoder, just have to manually implement this stuff in <code>Encoder.i32</code> and friends.</p>



<a name="417540084"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/reading%20integers%20from%20bytes/near/417540084" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/reading.20integers.20from.20bytes.html#417540084">(Jan 23 2024 at 22:26)</a>:</h4>
<p>It all can be done in userland</p>



<a name="417540231"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/reading%20integers%20from%20bytes/near/417540231" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/reading.20integers.20from.20bytes.html#417540231">(Jan 23 2024 at 22:27)</a>:</h4>
<p>Maybe if you could give me a worked example for I32 or something I can make the rest happen. I'm not sure I follow how it all comes together</p>



<a name="417540642"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/reading%20integers%20from%20bytes/near/417540642" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/reading.20integers.20from.20bytes.html#417540642">(Jan 23 2024 at 22:30)</a>:</h4>
<p>Lets pair, I think we have a few different things to discuss</p>



<a name="417546797"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/reading%20integers%20from%20bytes/near/417546797" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/reading.20integers.20from.20bytes.html#417546797">(Jan 23 2024 at 23:23)</a>:</h4>
<p>Ok. so there are a few functions we do need for binary encoding in the std lib:</p>
<p>We need dec to/from i128. We also need f32/f64 to/from sign, exponent, and mantissa.</p>



<a name="417547016"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/reading%20integers%20from%20bytes/near/417547016" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/reading.20integers.20from.20bytes.html#417547016">(Jan 23 2024 at 23:25)</a>:</h4>
<p>We should use these for the impl</p>
<div class="codehilite" data-code-language="Zig"><pre><span></span><code><span class="kr">inline</span><span class="w"> </span><span class="k">fn</span><span class="w"> </span><span class="n">floatExponentBits</span><span class="p">(</span><span class="kr">comptime</span><span class="w"> </span><span class="n">T</span><span class="o">:</span><span class="w"> </span><span class="kt">type</span><span class="p">)</span><span class="w"> </span><span class="kt">comptime_int</span>
<span class="kr">inline</span><span class="w"> </span><span class="k">fn</span><span class="w"> </span><span class="n">floatMantissaBits</span><span class="p">(</span><span class="kr">comptime</span><span class="w"> </span><span class="n">T</span><span class="o">:</span><span class="w"> </span><span class="kt">type</span><span class="p">)</span><span class="w"> </span><span class="kt">comptime_int</span>
</code></pre></div>



<a name="417558977"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/reading%20integers%20from%20bytes/near/417558977" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/reading.20integers.20from.20bytes.html#417558977">(Jan 24 2024 at 01:23)</a>:</h4>
<p><span class="user-mention" data-user-id="281383">@Richard Feldman</span> For dec, it obviously can't use <code>Num.toI128</code> to get the underlying <code>I128</code>. I'm not exactly sure a good name for it. I guess it technically is <code>atto</code> in terms of metric prefixes. <code>Num.decToAtto</code> doesn't sound even vaguely discoverable. Could do <code>Num.decToBytes</code> and return a tuple of <code>U8</code>. Or maybe <code>Num.decToRaw</code> or something like that....yeah...not sure a good name here.</p>



<a name="417561186"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/reading%20integers%20from%20bytes/near/417561186" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/reading.20integers.20from.20bytes.html#417561186">(Jan 24 2024 at 01:50)</a>:</h4>
<p>I like <code>Num.decToRaw</code> or <code>Num.decToBytes</code></p>



<a name="418464726"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/reading%20integers%20from%20bytes/near/418464726" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/reading.20integers.20from.20bytes.html#418464726">(Jan 28 2024 at 02:29)</a>:</h4>
<p>Cause this will be useful for some of the fuzzing stuff I am currently looking at, wanted to pin down api a bit. Also, will be needed for binary encoding/decoding in roc.</p>
<p>For Dec, I think it can probably simply be this with a doc mentioning that these are integers scaled by 10^-18</p>
<div class="codehilite" data-code-language="Elm"><pre><span></span><code><span class="kt">Num</span><span class="nf">.</span><span class="nv">decToRaw</span><span class="w"> </span><span class="nf">:</span><span class="w"> </span><span class="kt">Dec</span><span class="w"> </span><span class="nf">-&gt;</span><span class="w"> </span><span class="kt">I128</span>
<span class="kt">Num</span><span class="nf">.</span><span class="nv">decFromRaw</span><span class="w"> </span><span class="nf">:</span><span class="w"> </span><span class="kt">I128</span><span class="w"> </span><span class="nf">-&gt;</span><span class="w"> </span><span class="kt">Dec</span>
</code></pre></div>
<p>For float, I think there are a few possibilities for the api.<br>
Probably most direct would be:</p>
<div class="codehilite" data-code-language="Elm"><pre><span></span><code><span class="kt">Num</span><span class="nf">.</span><span class="nv">f32ToRaw</span><span class="w"> </span><span class="nf">:</span><span class="w"> </span><span class="kt">F32</span><span class="w"> </span><span class="nf">-&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nv">sign</span><span class="nf">:</span><span class="w"> </span><span class="kt">Bool</span><span class="p">,</span><span class="w"> </span><span class="nv">exponent</span><span class="nf">:</span><span class="w"> </span><span class="kt">U8</span><span class="p">,</span><span class="w"> </span><span class="nv">fraction</span><span class="nf">:</span><span class="w"> </span><span class="kt">U32</span><span class="w"> </span><span class="p">}</span>
<span class="kt">Num</span><span class="nf">.</span><span class="nv">f64ToRaw</span><span class="w"> </span><span class="nf">:</span><span class="w"> </span><span class="kt">F64</span><span class="w"> </span><span class="nf">-&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nv">sign</span><span class="nf">:</span><span class="w"> </span><span class="kt">Bool</span><span class="p">,</span><span class="w"> </span><span class="nv">exponent</span><span class="nf">:</span><span class="w"> </span><span class="kt">U16</span><span class="p">,</span><span class="w"> </span><span class="nv">fraction</span><span class="nf">:</span><span class="w"> </span><span class="kt">U64</span><span class="w"> </span><span class="p">}</span>

<span class="c1">-- Also the reverse</span>
</code></pre></div>
<p>That said, we could also just allow bitcasting a float to/from a U32/U64.</p>
<div class="codehilite" data-code-language="Elm"><pre><span></span><code><span class="kt">Num</span><span class="nf">.</span><span class="nv">f32ToRaw</span><span class="w"> </span><span class="nf">:</span><span class="w"> </span><span class="kt">F32</span><span class="w"> </span><span class="nf">-&gt;</span><span class="w"> </span><span class="kt">U32</span>
<span class="kt">Num</span><span class="nf">.</span><span class="nv">f64ToRaw</span><span class="w"> </span><span class="nf">:</span><span class="w"> </span><span class="kt">F64</span><span class="w"> </span><span class="nf">-&gt;</span><span class="w"> </span><span class="kt">U64</span>

<span class="c1">-- Also the reverse</span>
</code></pre></div>
<p>Or a direct byte function of some sort that gives a tuple, but I think that would be less useful.</p>
<p>For all the above float APIs, they could also use signed types instead of unsigned.</p>
<p>Anyone have any thoughts and what would be the nicest api here?</p>



<a name="418464816"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/reading%20integers%20from%20bytes/near/418464816" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/reading.20integers.20from.20bytes.html#418464816">(Jan 28 2024 at 02:30)</a>:</h4>
<p>For extract parts of a float, we could make each part its own function, but we can't really do that for building a float. I mean we could, but it would be kinda strange to like apply the fractional part and then add on an exponent</p>



<a name="418481103"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/reading%20integers%20from%20bytes/near/418481103" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/reading.20integers.20from.20bytes.html#418481103">(Jan 28 2024 at 07:39)</a>:</h4>
<p>Looking at the postcard wire format for no particular reason other than it looks like a useful reference, <a href="https://postcard.jamesmunns.com/wire-format#13---f64">https://postcard.jamesmunns.com/wire-format#13---f64</a></p>
<p>They have that an f64 will be bitwise converted into a u64, and encoded as a little-endian array of eight bytes.</p>
<p>For example, the float value -32.005859375f64 would be bitwise represented as 0xc040_00c0_0000_0000u64, and encoded as [0x00, 0x00, 0x00, 0x00, 0xc0, 0x00, 0x40, 0xc0].</p>
<p>Would the above <code>Num.f64ToRaw : F64 -&gt; U64</code> be the same as this? I assume we might want the more explicit <code>{ sign: Bool, exponent: U16, fraction: U64 }</code> if we want to support really specific encoding/decodings?</p>



<a name="418481210"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/reading%20integers%20from%20bytes/near/418481210" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/reading.20integers.20from.20bytes.html#418481210">(Jan 28 2024 at 07:41)</a>:</h4>
<p>I guess we can always just bitshift things around if we need a different ordering. Though maybe the API should be more like <code>Num.f64ToRaw : F64, [BE, LE] -&gt; U64</code>?</p>



<a name="418481515"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/reading%20integers%20from%20bytes/near/418481515" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/reading.20integers.20from.20bytes.html#418481515">(Jan 28 2024 at 07:46)</a>:</h4>
<p>Converting to a U64 without an endian specifier should be fine. It will just stay in the same endian ambiguous form. Then you can write it in little endian form into the final buffer.</p>



<a name="418481608"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/reading%20integers%20from%20bytes/near/418481608" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/reading.20integers.20from.20bytes.html#418481608">(Jan 28 2024 at 07:48)</a>:</h4>
<p>Cause both the float and the int will be in native endian. Then you write the int into the buffer lowest byte to highest byte to get a little endian buffer</p>



<a name="418497836"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/reading%20integers%20from%20bytes/near/418497836" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/reading.20integers.20from.20bytes.html#418497836">(Jan 28 2024 at 12:18)</a>:</h4>
<p>what about these for names?</p>
<div class="codehilite" data-code-language="eln"><pre><span></span><code>Num.withoutDecimalPt : Dec -&gt; I128
Num.withDecimalPt : I128 -&gt; Dec
</code></pre></div>



<a name="418515755"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/reading%20integers%20from%20bytes/near/418515755" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/reading.20integers.20from.20bytes.html#418515755">(Jan 28 2024 at 16:29)</a>:</h4>
<p>Interesting. I definitely get the idea...</p>
<p>I definitely don't think I would ever think to reach for a function named that. Also, I am a bit concerned the name is too close to <code>withoutDecimalPart</code> which sounds like it would return the whole number portion of the Dec.</p>



<a name="418518040"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/reading%20integers%20from%20bytes/near/418518040" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/reading.20integers.20from.20bytes.html#418518040">(Jan 28 2024 at 16:58)</a>:</h4>
<p>yeah I just always try to avoid names that basically say "to internal implementation" because it pretty much guarantees you can never change the internal implementation</p>



<a name="418518097"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/reading%20integers%20from%20bytes/near/418518097" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/reading.20integers.20from.20bytes.html#418518097">(Jan 28 2024 at 16:59)</a>:</h4>
<p>as opposed to a name that describes the transformation, which at least potentially leaves the door open to changing the internal representation in the future and then backporting the function to still return what it says it does</p>



<a name="418518197"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/reading%20integers%20from%20bytes/near/418518197" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/reading.20integers.20from.20bytes.html#418518197">(Jan 28 2024 at 17:00)</a>:</h4>
<p>which in this particular case might never happen, but people look to builtins for naming conventions, so I want to avoid establishing "to internal representation" as a naming convention in builtins if possible! <span aria-label="big smile" class="emoji emoji-1f604" role="img" title="big smile">:big_smile:</span></p>



<a name="418519817"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/reading%20integers%20from%20bytes/near/418519817" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/reading.20integers.20from.20bytes.html#418519817">(Jan 28 2024 at 17:22)</a>:</h4>
<p>True, but these function are actually for serde and binary protocols. They truly are meant to get the raw bytes.</p>



<a name="418519842"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/reading%20integers%20from%20bytes/near/418519842" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/reading.20integers.20from.20bytes.html#418519842">(Jan 28 2024 at 17:23)</a>:</h4>
<p>These types just don't allow raw access like integers (via bit shifts and masks)</p>



<a name="418519979"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/reading%20integers%20from%20bytes/near/418519979" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/reading.20integers.20from.20bytes.html#418519979">(Jan 28 2024 at 17:24)</a>:</h4>
<p>Personally, I think I would prefer just a single generic <code>Num.bitCast</code></p>



<a name="418538547"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/reading%20integers%20from%20bytes/near/418538547" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/reading.20integers.20from.20bytes.html#418538547">(Jan 28 2024 at 21:47)</a>:</h4>
<p><code>Num.bitCast</code> sounds nice. Does it always return a <code>List U8</code>?</p>



<a name="418544253"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/reading%20integers%20from%20bytes/near/418544253" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/reading.20integers.20from.20bytes.html#418544253">(Jan 28 2024 at 23:19)</a>:</h4>
<p>No, it converts any numeric type into any other numeric type by just directly moving the bits.</p>



<a name="418544311"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/reading%20integers%20from%20bytes/near/418544311" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/reading.20integers.20from.20bytes.html#418544311">(Jan 28 2024 at 23:20)</a>:</h4>
<p>No checks. If the old type is smaller, zero pad (maybe sign extend?). If the old type is bigger truncate.</p>



<a name="418544327"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/reading%20integers%20from%20bytes/near/418544327" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/reading.20integers.20from.20bytes.html#418544327">(Jan 28 2024 at 23:20)</a>:</h4>
<p>I think zig has <code>@bitCast</code> that would be the same</p>



<a name="418545158"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/reading%20integers%20from%20bytes/near/418545158" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/reading.20integers.20from.20bytes.html#418545158">(Jan 28 2024 at 23:34)</a>:</h4>
<p>I'm a little worried about that...I don't know if a lot of people appreciate the distinction between bit cast and numeric cast, and I could see people calling <code>Num.bitCast</code> thinking it will work more like <code>Num.intCast</code></p>



<a name="418545373"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/reading%20integers%20from%20bytes/near/418545373" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/reading.20integers.20from.20bytes.html#418545373">(Jan 28 2024 at 23:38)</a>:</h4>
<p>What are intCasts semantics currently? I think it is a bitcast, just only for integers.</p>



<a name="418545488"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/reading%20integers%20from%20bytes/near/418545488" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/reading.20integers.20from.20bytes.html#418545488">(Jan 28 2024 at 23:41)</a>:</h4>
<p>Though maybe it panics if a value doesn't fit or is supposed to panic if a value doesn't fit?</p>



<a name="418548050"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/reading%20integers%20from%20bytes/near/418548050" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/reading.20integers.20from.20bytes.html#418548050">(Jan 29 2024 at 00:23)</a>:</h4>
<p>I'm not sure...also I'm not totally sure we should have that one either <span aria-label="laughing" class="emoji emoji-1f606" role="img" title="laughing">:laughing:</span></p>



<a name="418549151"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/reading%20integers%20from%20bytes/near/418549151" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/reading.20integers.20from.20bytes.html#418549151">(Jan 29 2024 at 00:40)</a>:</h4>
<p>Fair enough. In that case, sounds like a couple of bespoke methods. One to get the parts of a floats and one to remove the decimal point from a dec is probably the way to go.</p>



<a name="418549159"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/reading%20integers%20from%20bytes/near/418549159" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/reading.20integers.20from.20bytes.html#418549159">(Jan 29 2024 at 00:40)</a>:</h4>
<p>Then of course the reverse method for building the types.</p>



<a name="418549425"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/reading%20integers%20from%20bytes/near/418549425" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/reading.20integers.20from.20bytes.html#418549425">(Jan 29 2024 at 00:45)</a>:</h4>
<div class="codehilite" data-code-language="Elm"><pre><span></span><code><span class="kt">Num</span><span class="nf">.</span><span class="nv">withoutDecimalPoint</span><span class="w"> </span><span class="nf">:</span><span class="w"> </span><span class="kt">Dec</span><span class="w"> </span><span class="nf">-&gt;</span><span class="w"> </span><span class="kt">I128</span>
<span class="kt">Num</span><span class="nf">.</span><span class="nv">withDecimalPoint</span><span class="w"> </span><span class="nf">:</span><span class="w"> </span><span class="kt">I128</span><span class="w"> </span><span class="nf">-&gt;</span><span class="w"> </span><span class="kt">Dec</span>

<span class="kt">Num</span><span class="nf">.</span><span class="nv">f32ToParts</span><span class="w"> </span><span class="nf">:</span><span class="w"> </span><span class="kt">F32</span><span class="w"> </span><span class="nf">-&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nv">sign</span><span class="w"> </span><span class="nf">:</span><span class="w"> </span><span class="kt">Bool</span><span class="p">,</span><span class="w"> </span><span class="nv">exponent</span><span class="w"> </span><span class="nf">:</span><span class="w"> </span><span class="kt">U8</span><span class="p">,</span><span class="w"> </span><span class="nv">fraction</span><span class="w"> </span><span class="nf">:</span><span class="w"> </span><span class="kt">U32</span><span class="w"> </span><span class="p">}</span>
<span class="c1">-- plus reverse</span>

<span class="c1">-- plus for f64</span>
</code></pre></div>



<a name="418550042"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/reading%20integers%20from%20bytes/near/418550042" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Feldman <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/reading.20integers.20from.20bytes.html#418550042">(Jan 29 2024 at 00:55)</a>:</h4>
<p>sounds good to me!</p>



<a name="426689445"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/reading%20integers%20from%20bytes/near/426689445" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Fabian Schmalzried <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/reading.20integers.20from.20bytes.html#426689445">(Mar 15 2024 at 07:50)</a>:</h4>
<p>I will try to implement those</p>



<a name="427864996"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/reading%20integers%20from%20bytes/near/427864996" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Fabian Schmalzried <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/reading.20integers.20from.20bytes.html#427864996">(Mar 20 2024 at 07:07)</a>:</h4>
<p>What should happen if the fraction is bigger than allowed in f32FromParts? Ignore the extra bits, or should it return a result?</p>



<a name="511964126"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/reading%20integers%20from%20bytes/near/511964126" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/reading.20integers.20from.20bytes.html#511964126">(Apr 14 2025 at 01:47)</a>:</h4>
<p>Just saw this Issue raised <a href="https://github.com/roc-lang/roc/issues/7739">https://github.com/roc-lang/roc/issues/7739</a> -- is this thread effectively the direction we plan on going for this, so <code>Num.f32ToParts</code>?</p>



<a name="511964303"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/reading%20integers%20from%20bytes/near/511964303" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/reading.20integers.20from.20bytes.html#511964303">(Apr 14 2025 at 01:49)</a>:</h4>
<p>I thought we had an issue for this but maybe we never made one as I cant find it</p>



<a name="511966691"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/reading%20integers%20from%20bytes/near/511966691" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/reading.20integers.20from.20bytes.html#511966691">(Apr 14 2025 at 02:12)</a>:</h4>
<p>They are already implemented?<br>
<a href="https://github.com/roc-lang/roc/blob/966d0459e7ccb1bd28cb77c05b8419953ef167af/crates/compiler/builtins/roc/Num.roc#L154-L157">https://github.com/roc-lang/roc/blob/966d0459e7ccb1bd28cb77c05b8419953ef167af/crates/compiler/builtins/roc/Num.roc#L154-L157</a></p>



<a name="511966733"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/reading%20integers%20from%20bytes/near/511966733" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/reading.20integers.20from.20bytes.html#511966733">(Apr 14 2025 at 02:13)</a>:</h4>
<p>That said, in practice, I think this ended up being the wrong decide (cause roc doesn't have arbitrary width intgers</p>



<a name="511966757"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/reading%20integers%20from%20bytes/near/511966757" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/reading.20integers.20from.20bytes.html#511966757">(Apr 14 2025 at 02:13)</a>:</h4>
<p>Frankly, at this point, I would suggest removing this and going with the raw conversion like the issue you linked suggested.</p>



<a name="511966775"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/reading%20integers%20from%20bytes/near/511966775" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/reading.20integers.20from.20bytes.html#511966775">(Apr 14 2025 at 02:13)</a>:</h4>
<p>let user do the bit twiddling as they need.</p>



<a name="511968776"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/reading%20integers%20from%20bytes/near/511968776" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Boswell <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/reading.20integers.20from.20bytes.html#511968776">(Apr 14 2025 at 02:35)</a>:</h4>
<p>Ahk, I forgot about that. I don't have a strong opinion here, but moving to the simpler API sounds good to me. </p>
<p>I think we should drop a comment/update on that Issue so Lars or someone else has a decision to reference and is unblocked to progress the change.</p>
<p>WDYT <span class="user-mention" data-user-id="343810">@Brendan Hansknecht</span> ?</p>



<a name="511974866"></a>
<h4><a href="https://roc.zulipchat.com#narrow/stream/383402-API%20design/topic/reading%20integers%20from%20bytes/near/511974866" class="zl"><img src="https://roc-lang.github.io/zulip-export/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Hansknecht <a href="https://roc-lang.github.io/zulip-export/stream/383402-API-design/topic/reading.20integers.20from.20bytes.html#511974866">(Apr 14 2025 at 03:44)</a>:</h4>
<p>I commented on the issue</p>



<hr><p>Last updated: Mar 01 2026 at 12:20 UTC</p>
</html>